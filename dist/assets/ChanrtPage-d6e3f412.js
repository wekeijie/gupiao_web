import{_ as Tv}from"./refresh-9fe172ae.js";import{a as Sv,_ as dv}from"./selef-8144ed19.js";import{P as Iv}from"./topWrap-14896c0b.js";import{c as mv}from"./_commonjsHelpers-de833af9.js";import{A as Ua,Q as gv,P as pv,R as Ev,ay as xv,S as Kt,ao as Fv,B as _i,T as qr,y as rr,D as di,J as _t,Z as ze,W as Qt,$ as Mv,E as no,aB as Lv,a0 as Ca,Y as Zl,_ as Ql,C as oo,a8 as Rv,G as ho,F as Nv,a1 as Av,H as yv,I as Ov}from"./index-81fd8131.js";import{_ as Pv}from"./_plugin-vue_export-helper-c27b6911.js";import{V as Bv,a as bv}from"./VTabs-75640210.js";import{V as wv,a as Gv}from"./VList-fcb7d05d.js";import{V as _v}from"./VMenu-73157e86.js";/* empty css                                                                */import"./VWindowItem-a63a8796.js";import"./ssrBoot-d22683ff.js";import"./VSlideGroup-b02d0c99.js";import"./index-e4f9c417.js";import"./VDivider-69e004b8.js";var Vi={},Sh={},xf={exports:{}},Hv=xf.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=Hv);var xa=xf.exports,Ff={exports:{}},Vv=Ff.exports={version:"2.6.12"};typeof __e=="number"&&(__e=Vv);var Ue=Ff.exports,ds=function(e){if(typeof e!="function")throw TypeError(e+" is not a function!");return e},Yv=ds,Ki=function(e,a,r){if(Yv(e),a===void 0)return e;switch(r){case 1:return function(t){return e.call(a,t)};case 2:return function(t,n){return e.call(a,t,n)};case 3:return function(t,n,s){return e.call(a,t,n,s)}}return function(){return e.apply(a,arguments)}},Ha={},fi=function(e){return typeof e=="object"?e!==null:typeof e=="function"},Xv=fi,Mi=function(e){if(!Xv(e))throw TypeError(e+" is not an object!");return e},Hr=function(e){try{return!!e()}catch{return!0}},Va=!Hr(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),$l=fi,Wo=xa.document,kv=$l(Wo)&&$l(Wo.createElement),dh=function(e){return kv?Wo.createElement(e):{}},Mf=!Va&&!Hr(function(){return Object.defineProperty(dh("div"),"a",{get:function(){return 7}}).a!=7}),Ys=fi,Ih=function(e,a){if(!Ys(e))return e;var r,t;if(a&&typeof(r=e.toString)=="function"&&!Ys(t=r.call(e))||typeof(r=e.valueOf)=="function"&&!Ys(t=r.call(e))||!a&&typeof(r=e.toString)=="function"&&!Ys(t=r.call(e)))return t;throw TypeError("Can't convert object to primitive value")},ql=Mi,Wv=Mf,Uv=Ih,Kv=Object.defineProperty;Ha.f=Va?Object.defineProperty:function(a,r,t){if(ql(a),r=Uv(r,!0),ql(t),Wv)try{return Kv(a,r,t)}catch{}if("get"in t||"set"in t)throw TypeError("Accessors not supported!");return"value"in t&&(a[r]=t.value),a};var Is=function(e,a){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:a}},zv=Ha,Jv=Is,zi=Va?function(e,a,r){return zv.f(e,a,Jv(1,r))}:function(e,a,r){return e[a]=r,e},Zv={}.hasOwnProperty,vr=function(e,a){return Zv.call(e,a)},Xs=xa,lo=Ue,jl=Ki,Qv=zi,$v=vr,ks="prototype",aa=function(e,a,r){var t=e&aa.F,n=e&aa.G,s=e&aa.S,o=e&aa.P,l=e&aa.B,h=e&aa.W,u=n?lo:lo[a]||(lo[a]={}),f=u[ks],C=n?Xs:s?Xs[a]:(Xs[a]||{})[ks],D,c,T;n&&(r=a);for(D in r)c=!t&&C&&C[D]!==void 0,!(c&&$v(u,D))&&(T=c?C[D]:r[D],u[D]=n&&typeof C[D]!="function"?r[D]:l&&c?jl(T,Xs):h&&C[D]==T?function(S){var I=function(g,E,F){if(this instanceof S){switch(arguments.length){case 0:return new S;case 1:return new S(g);case 2:return new S(g,E)}return new S(g,E,F)}return S.apply(this,arguments)};return I[ks]=S[ks],I}(T):o&&typeof T=="function"?jl(Function.call,T):T,o&&((u.virtual||(u.virtual={}))[D]=T,e&aa.R&&f&&!f[D]&&Qv(f,D,T)))};aa.F=1;aa.G=2;aa.S=4;aa.P=8;aa.B=16;aa.W=32;aa.U=64;aa.R=128;var na=aa,qv={}.toString,ms=function(e){return qv.call(e).slice(8,-1)},jv=ms,mh=Object("z").propertyIsEnumerable(0)?Object:function(e){return jv(e)=="String"?e.split(""):Object(e)},gh=function(e){if(e==null)throw TypeError("Can't call method on  "+e);return e},tc=mh,ec=gh,Vr=function(e){return tc(ec(e))},ac=Math.ceil,ic=Math.floor,ph=function(e){return isNaN(e=+e)?0:(e>0?ic:ac)(e)},rc=ph,sc=Math.min,dn=function(e){return e>0?sc(rc(e),9007199254740991):0},nc=ph,oc=Math.max,hc=Math.min,lc=function(e,a){return e=nc(e),e<0?oc(e+a,0):hc(e,a)},uc=Vr,fc=dn,Cc=lc,Dc=function(e){return function(a,r,t){var n=uc(a),s=fc(n.length),o=Cc(t,s),l;if(e&&r!=r){for(;s>o;)if(l=n[o++],l!=l)return!0}else for(;s>o;o++)if((e||o in n)&&n[o]===r)return e||o||0;return!e&&-1}},Lf={exports:{}},Rf=!0,vc=Ue,tu=xa,eu="__core-js_shared__",au=tu[eu]||(tu[eu]={});(Lf.exports=function(e,a){return au[e]||(au[e]=a!==void 0?a:{})})("versions",[]).push({version:vc.version,mode:"pure",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"});var Eh=Lf.exports,cc=0,Tc=Math.random(),In=function(e){return"Symbol(".concat(e===void 0?"":e,")_",(++cc+Tc).toString(36))},iu=Eh("keys"),Sc=In,xh=function(e){return iu[e]||(iu[e]=Sc(e))},ru=vr,dc=Vr,Ic=Dc(!1),mc=xh("IE_PROTO"),Nf=function(e,a){var r=dc(e),t=0,n=[],s;for(s in r)s!=mc&&ru(r,s)&&n.push(s);for(;a.length>t;)ru(r,s=a[t++])&&(~Ic(n,s)||n.push(s));return n},Fh="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),gc=Nf,pc=Fh,mn=Object.keys||function(a){return gc(a,pc)},gn={};gn.f=Object.getOwnPropertySymbols;var uo={},su;function pn(){return su||(su=1,uo.f={}.propertyIsEnumerable),uo}var Ec=gh,gs=function(e){return Object(Ec(e))},fo,nu;function xc(){if(nu)return fo;nu=1;var e=Va,a=mn,r=gn,t=pn(),n=gs,s=mh,o=Object.assign;return fo=!o||Hr(function(){var l={},h={},u=Symbol(),f="abcdefghijklmnopqrst";return l[u]=7,f.split("").forEach(function(C){h[C]=C}),o({},l)[u]!=7||Object.keys(o({},h)).join("")!=f})?function(h,u){for(var f=n(h),C=arguments.length,D=1,c=r.f,T=t.f;C>D;)for(var S=s(arguments[D++]),I=c?a(S).concat(c(S)):a(S),g=I.length,E=0,F;g>E;)F=I[E++],(!e||T.call(S,F))&&(f[F]=S[F]);return f}:o,fo}var Co=na;Co(Co.S+Co.F,"Object",{assign:xc()});var Fc=Ue.Object.assign,Mc={default:Fc,__esModule:!0},Mh={},Lc=ph,Rc=gh,Nc=function(e){return function(a,r){var t=String(Rc(a)),n=Lc(r),s=t.length,o,l;return n<0||n>=s?e?"":void 0:(o=t.charCodeAt(n),o<55296||o>56319||n+1===s||(l=t.charCodeAt(n+1))<56320||l>57343?e?t.charAt(n):o:e?t.slice(n,n+2):(o-55296<<10)+(l-56320)+65536)}},Af=zi,ps={},Do,ou;function yf(){if(ou)return Do;ou=1;var e=Ha,a=Mi,r=mn;return Do=Va?Object.defineProperties:function(n,s){a(n);for(var o=r(s),l=o.length,h=0,u;l>h;)e.f(n,u=o[h++],s[u]);return n},Do}var hu=xa.document,Of=hu&&hu.documentElement,Ac=Mi,yc=yf(),lu=Fh,Oc=xh("IE_PROTO"),vo=function(){},Uo="prototype",en=function(){var e=dh("iframe"),a=lu.length,r="<",t=">",n;for(e.style.display="none",Of.appendChild(e),e.src="javascript:",n=e.contentWindow.document,n.open(),n.write(r+"script"+t+"document.F=Object"+r+"/script"+t),n.close(),en=n.F;a--;)delete en[Uo][lu[a]];return en()},En=Object.create||function(a,r){var t;return a!==null?(vo[Uo]=Ac(a),t=new vo,vo[Uo]=null,t[Oc]=a):t=en(),r===void 0?t:yc(t,r)},Pf={exports:{}},Ko=Eh("wks"),Pc=In,zo=xa.Symbol,uu=typeof zo=="function",Bc=Pf.exports=function(e){return Ko[e]||(Ko[e]=uu&&zo[e]||(uu?zo:Pc)("Symbol."+e))};Bc.store=Ko;var Fa=Pf.exports,bc=Ha.f,wc=vr,fu=Fa("toStringTag"),Es=function(e,a,r){e&&!wc(e=r?e:e.prototype,fu)&&bc(e,fu,{configurable:!0,value:a})},Gc=En,_c=Is,Hc=Es,Bf={};zi(Bf,Fa("iterator"),function(){return this});var Vc=function(e,a,r){e.prototype=Gc(Bf,{next:_c(1,r)}),Hc(e,a+" Iterator")},Yc=vr,Xc=gs,Cu=xh("IE_PROTO"),kc=Object.prototype,Wc=Object.getPrototypeOf||function(e){return e=Xc(e),Yc(e,Cu)?e[Cu]:typeof e.constructor=="function"&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?kc:null},co=na,Uc=Af,Kc=zi,Du=ps,zc=Vc,Jc=Es,Zc=Wc,To=Fa("iterator"),So=!([].keys&&"next"in[].keys()),Qc="@@iterator",vu="keys",Ws="values",$c=function(){return this},Lh=function(e,a,r,t,n,s,o){zc(r,a,t);var l=function(F){if(!So&&F in C)return C[F];switch(F){case vu:return function(){return new r(this,F)};case Ws:return function(){return new r(this,F)}}return function(){return new r(this,F)}},h=a+" Iterator",u=n==Ws,f=!1,C=e.prototype,D=C[To]||C[Qc]||n&&C[n],c=D||l(n),T=n?u?l("entries"):c:void 0,S=a=="Array"&&C.entries||D,I,g,E;if(S&&(E=Zc(S.call(new e)),E!==Object.prototype&&E.next&&Jc(E,h,!0)),u&&D&&D.name!==Ws&&(f=!0,c=function(){return D.call(this)}),o&&(So||f||!C[To])&&Kc(C,To,c),Du[a]=c,Du[h]=$c,n)if(I={values:u?c:l(Ws),keys:s?c:l(vu),entries:T},o)for(g in I)g in C||Uc(C,g,I[g]);else co(co.P+co.F*(So||f),a,I);return I},qc=Nc(!0);Lh(String,"String",function(e){this._t=String(e),this._i=0},function(){var e=this._t,a=this._i,r;return a>=e.length?{value:void 0,done:!0}:(r=qc(e,a),this._i+=r.length,{value:r,done:!1})});var cu=Mi,bf=function(e,a,r,t){try{return t?a(cu(r)[0],r[1]):a(r)}catch(s){var n=e.return;throw n!==void 0&&cu(n.call(e)),s}},jc=ps,tT=Fa("iterator"),eT=Array.prototype,wf=function(e){return e!==void 0&&(jc.Array===e||eT[tT]===e)},aT=Ha,iT=Is,rT=function(e,a,r){a in e?aT.f(e,a,iT(0,r)):e[a]=r},Jo=ms,sT=Fa("toStringTag"),nT=Jo(function(){return arguments}())=="Arguments",oT=function(e,a){try{return e[a]}catch{}},Rh=function(e){var a,r,t;return e===void 0?"Undefined":e===null?"Null":typeof(r=oT(a=Object(e),sT))=="string"?r:nT?Jo(a):(t=Jo(a))=="Object"&&typeof a.callee=="function"?"Arguments":t},hT=Rh,lT=Fa("iterator"),uT=ps,Nh=Ue.getIteratorMethod=function(e){if(e!=null)return e[lT]||e["@@iterator"]||uT[hT(e)]},Io,Tu;function Gf(){if(Tu)return Io;Tu=1;var e=Fa("iterator"),a=!1;try{var r=[7][e]();r.return=function(){a=!0},Array.from(r,function(){throw 2})}catch{}return Io=function(t,n){if(!n&&!a)return!1;var s=!1;try{var o=[7],l=o[e]();l.next=function(){return{done:s=!0}},o[e]=function(){return l},t(o)}catch{}return s},Io}var fT=Ki,mo=na,CT=gs,DT=bf,vT=wf,cT=dn,Su=rT,TT=Nh;mo(mo.S+mo.F*!Gf()(function(e){Array.from(e)}),"Array",{from:function(a){var r=CT(a),t=typeof this=="function"?this:Array,n=arguments.length,s=n>1?arguments[1]:void 0,o=s!==void 0,l=0,h=TT(r),u,f,C,D;if(o&&(s=fT(s,n>2?arguments[2]:void 0,2)),h!=null&&!(t==Array&&vT(h)))for(D=h.call(r),f=new t;!(C=D.next()).done;l++)Su(f,l,o?DT(D,s,[C.value,l],!0):C.value);else for(u=cT(r.length),f=new t(u);u>l;l++)Su(f,l,o?s(r[l],l):r[l]);return f.length=l,f}});var ST=Ue.Array.from,_f={default:ST,__esModule:!0};Mh.__esModule=!0;var dT=_f,IT=mT(dT);function mT(e){return e&&e.__esModule?e:{default:e}}Mh.default=function(e){if(Array.isArray(e)){for(var a=0,r=Array(e.length);a<e.length;a++)r[a]=e[a];return r}else return(0,IT.default)(e)};var Hf=function(e,a){return{value:a,done:!!e}},Us=Hf,du=ps,gT=Vr;Lh(Array,"Array",function(e,a){this._t=gT(e),this._i=0,this._k=a},function(){var e=this._t,a=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,Us(1)):a=="keys"?Us(0,r):a=="values"?Us(0,e[r]):Us(0,[r,e[r]])},"values");du.Arguments=du.Array;var pT=xa,ET=zi,Iu=ps,mu=Fa("toStringTag"),gu="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(",");for(var go=0;go<gu.length;go++){var po=gu[go],pu=pT[po],Eo=pu&&pu.prototype;Eo&&!Eo[mu]&&ET(Eo,mu,po),Iu[po]=Iu.Array}var Ah=function(e,a,r,t){if(!(e instanceof a)||t!==void 0&&t in e)throw TypeError(r+": incorrect invocation!");return e},Vf={exports:{}},xT=Ki,FT=bf,MT=wf,LT=Mi,RT=dn,NT=Nh,Zo={},Qo={},Yf=Vf.exports=function(e,a,r,t,n){var s=n?function(){return e}:NT(e),o=xT(r,t,a?2:1),l=0,h,u,f,C;if(typeof s!="function")throw TypeError(e+" is not iterable!");if(MT(s)){for(h=RT(e.length);h>l;l++)if(C=a?o(LT(u=e[l])[0],u[1]):o(e[l]),C===Zo||C===Qo)return C}else for(f=s.call(e);!(u=f.next()).done;)if(C=FT(f,o,u.value,a),C===Zo||C===Qo)return C};Yf.BREAK=Zo;Yf.RETURN=Qo;var xs=Vf.exports,Eu=Mi,AT=ds,yT=Fa("species"),Xf=function(e,a){var r=Eu(e).constructor,t;return r===void 0||(t=Eu(r)[yT])==null?a:AT(t)},OT=function(e,a,r){var t=r===void 0;switch(a.length){case 0:return t?e():e.call(r);case 1:return t?e(a[0]):e.call(r,a[0]);case 2:return t?e(a[0],a[1]):e.call(r,a[0],a[1]);case 3:return t?e(a[0],a[1],a[2]):e.call(r,a[0],a[1],a[2]);case 4:return t?e(a[0],a[1],a[2],a[3]):e.call(r,a[0],a[1],a[2],a[3])}return e.apply(r,a)},Ks=Ki,PT=OT,xu=Of,Fu=dh,mi=xa,Mu=mi.process,$o=mi.setImmediate,qo=mi.clearImmediate,Lu=mi.MessageChannel,xo=mi.Dispatch,Fo=0,rs={},Ru="onreadystatechange",sr,Mo,Lo,as=function(){var e=+this;if(rs.hasOwnProperty(e)){var a=rs[e];delete rs[e],a()}},Nu=function(e){as.call(e.data)};(!$o||!qo)&&($o=function(a){for(var r=[],t=1;arguments.length>t;)r.push(arguments[t++]);return rs[++Fo]=function(){PT(typeof a=="function"?a:Function(a),r)},sr(Fo),Fo},qo=function(a){delete rs[a]},ms(Mu)=="process"?sr=function(e){Mu.nextTick(Ks(as,e,1))}:xo&&xo.now?sr=function(e){xo.now(Ks(as,e,1))}:Lu?(Mo=new Lu,Lo=Mo.port2,Mo.port1.onmessage=Nu,sr=Ks(Lo.postMessage,Lo,1)):mi.addEventListener&&typeof postMessage=="function"&&!mi.importScripts?(sr=function(e){mi.postMessage(e+"","*")},mi.addEventListener("message",Nu,!1)):Ru in Fu("script")?sr=function(e){xu.appendChild(Fu("script"))[Ru]=function(){xu.removeChild(this),as.call(e)}}:sr=function(e){setTimeout(Ks(as,e,1),0)});var kf={set:$o,clear:qo},hr=xa,BT=kf.set,Au=hr.MutationObserver||hr.WebKitMutationObserver,jo=hr.process,Ro=hr.Promise,yu=ms(jo)=="process",bT=function(){var e,a,r,t=function(){var l,h;for(yu&&(l=jo.domain)&&l.exit();e;){h=e.fn,e=e.next;try{h()}catch(u){throw e?r():a=void 0,u}}a=void 0,l&&l.enter()};if(yu)r=function(){jo.nextTick(t)};else if(Au&&!(hr.navigator&&hr.navigator.standalone)){var n=!0,s=document.createTextNode("");new Au(t).observe(s,{characterData:!0}),r=function(){s.data=n=!n}}else if(Ro&&Ro.resolve){var o=Ro.resolve(void 0);r=function(){o.then(t)}}else r=function(){BT.call(hr,t)};return function(l){var h={fn:l,next:void 0};a&&(a.next=h),e||(e=h,r()),a=h}},xn={},Ou=ds;function wT(e){var a,r;this.promise=new e(function(t,n){if(a!==void 0||r!==void 0)throw TypeError("Bad Promise constructor");a=t,r=n}),this.resolve=Ou(a),this.reject=Ou(r)}xn.f=function(e){return new wT(e)};var Wf=function(e){try{return{e:!1,v:e()}}catch(a){return{e:!0,v:a}}},GT=xa,Pu=GT.navigator,_T=Pu&&Pu.userAgent||"",HT=Mi,VT=fi,YT=xn,Uf=function(e,a){if(HT(e),VT(a)&&a.constructor===e)return a;var r=YT.f(e),t=r.resolve;return t(a),r.promise},XT=zi,yh=function(e,a,r){for(var t in a)r&&e[t]?e[t]=a[t]:XT(e,t,a[t]);return e},kT=xa,Bu=Ue,WT=Ha,UT=Va,bu=Fa("species"),Kf=function(e){var a=typeof Bu[e]=="function"?Bu[e]:kT[e];UT&&a&&!a[bu]&&WT.f(a,bu,{configurable:!0,get:function(){return this}})},KT=Rf,Xi=xa,Fr=Ki,zT=Rh,ya=na,JT=fi,ZT=ds,QT=Ah,wu=xs,$T=Xf,zf=kf.set,Jf=bT(),Zf=xn,th=Wf,qT=_T,jT=Uf,Ji="Promise",Qf=Xi.TypeError,Ar=Xi.process,Gu=Ar&&Ar.versions,t0=Gu&&Gu.v8||"",ui=Xi[Ji],os=zT(Ar)=="process",an=function(){},zs,$f,_u,Oh,hs=$f=Zf.f,Fn=!!function(){try{var e=ui.resolve(1),a=(e.constructor={})[Fa("species")]=function(r){r(an,an)};return(os||typeof PromiseRejectionEvent=="function")&&e.then(an)instanceof a&&t0.indexOf("6.6")!==0&&qT.indexOf("Chrome/66")===-1}catch{}}(),qf=function(e){var a;return JT(e)&&typeof(a=e.then)=="function"?a:!1},Ph=function(e,a){if(!e._n){e._n=!0;var r=e._c;Jf(function(){for(var t=e._v,n=e._s==1,s=0,o=function(l){var h=n?l.ok:l.fail,u=l.resolve,f=l.reject,C=l.domain,D,c,T;try{h?(n||(e._h==2&&a0(e),e._h=1),h===!0?D=t:(C&&C.enter(),D=h(t),C&&(C.exit(),T=!0)),D===l.promise?f(Qf("Promise-chain cycle")):(c=qf(D))?c.call(D,u,f):u(D)):f(t)}catch(S){C&&!T&&C.exit(),f(S)}};r.length>s;)o(r[s++]);e._c=[],e._n=!1,a&&!e._h&&e0(e)})}},e0=function(e){zf.call(Xi,function(){var a=e._v,r=Hu(e),t,n,s;if(r&&(t=th(function(){os?Ar.emit("unhandledRejection",a,e):(n=Xi.onunhandledrejection)?n({promise:e,reason:a}):(s=Xi.console)&&s.error&&s.error("Unhandled promise rejection",a)}),e._h=os||Hu(e)?2:1),e._a=void 0,r&&t.e)throw t.v})},Hu=function(e){return e._h!==1&&(e._a||e._c).length===0},a0=function(e){zf.call(Xi,function(){var a;os?Ar.emit("rejectionHandled",e):(a=Xi.onrejectionhandled)&&a({promise:e,reason:e._v})})},Mr=function(e){var a=this;a._d||(a._d=!0,a=a._w||a,a._v=e,a._s=2,a._a||(a._a=a._c.slice()),Ph(a,!0))},eh=function(e){var a=this,r;if(!a._d){a._d=!0,a=a._w||a;try{if(a===e)throw Qf("Promise can't be resolved itself");(r=qf(e))?Jf(function(){var t={_w:a,_d:!1};try{r.call(e,Fr(eh,t,1),Fr(Mr,t,1))}catch(n){Mr.call(t,n)}}):(a._v=e,a._s=1,Ph(a,!1))}catch(t){Mr.call({_w:a,_d:!1},t)}}};Fn||(ui=function(a){QT(this,ui,Ji,"_h"),ZT(a),zs.call(this);try{a(Fr(eh,this,1),Fr(Mr,this,1))}catch(r){Mr.call(this,r)}},zs=function(a){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},zs.prototype=yh(ui.prototype,{then:function(a,r){var t=hs($T(this,ui));return t.ok=typeof a=="function"?a:!0,t.fail=typeof r=="function"&&r,t.domain=os?Ar.domain:void 0,this._c.push(t),this._a&&this._a.push(t),this._s&&Ph(this,!1),t.promise},catch:function(e){return this.then(void 0,e)}}),_u=function(){var e=new zs;this.promise=e,this.resolve=Fr(eh,e,1),this.reject=Fr(Mr,e,1)},Zf.f=hs=function(e){return e===ui||e===Oh?new _u(e):$f(e)});ya(ya.G+ya.W+ya.F*!Fn,{Promise:ui});Es(ui,Ji);Kf(Ji);Oh=Ue[Ji];ya(ya.S+ya.F*!Fn,Ji,{reject:function(a){var r=hs(this),t=r.reject;return t(a),r.promise}});ya(ya.S+ya.F*KT,Ji,{resolve:function(a){return jT(this===Oh?ui:this,a)}});ya(ya.S+ya.F*!(Fn&&Gf()(function(e){ui.all(e).catch(an)})),Ji,{all:function(a){var r=this,t=hs(r),n=t.resolve,s=t.reject,o=th(function(){var l=[],h=0,u=1;wu(a,!1,function(f){var C=h++,D=!1;l.push(void 0),u++,r.resolve(f).then(function(c){D||(D=!0,l[C]=c,--u||n(l))},s)}),--u||n(l)});return o.e&&s(o.v),t.promise},race:function(a){var r=this,t=hs(r),n=t.reject,s=th(function(){wu(a,!1,function(o){r.resolve(o).then(t.resolve,n)})});return s.e&&n(s.v),t.promise}});var No=na,i0=Ue,r0=xa,s0=Xf,Vu=Uf;No(No.P+No.R,"Promise",{finally:function(e){var a=s0(this,i0.Promise||r0.Promise),r=typeof e=="function";return this.then(r?function(t){return Vu(a,e()).then(function(){return t})}:e,r?function(t){return Vu(a,e()).then(function(){throw t})}:e)}});var Yu=na,n0=xn,o0=Wf;Yu(Yu.S,"Promise",{try:function(e){var a=n0.f(this),r=o0(e);return(r.e?a.reject:a.resolve)(r.v),a.promise}});var h0=Ue.Promise,l0={default:h0,__esModule:!0},Xu=na;Xu(Xu.S,"Math",{log10:function(a){return Math.log(a)*Math.LOG10E}});var u0=Ue.Math.log10,f0={default:u0,__esModule:!0},Ao=na;Ao(Ao.S+Ao.F*!Va,"Object",{defineProperties:yf()});var C0=Ue.Object,D0=function(a,r){return C0.defineProperties(a,r)},v0={default:D0,__esModule:!0},ku=na;ku(ku.S,"Object",{create:En});var c0=Ue.Object,T0=function(a,r){return c0.create(a,r)},S0={default:T0,__esModule:!0},Bh={},Mn={};Mn.f=Fa;var d0=Mn.f("iterator"),I0={default:d0,__esModule:!0},jf={exports:{}},lr=In("meta"),m0=fi,bh=vr,g0=Ha.f,p0=0,Ln=Object.isExtensible||function(){return!0},E0=!Hr(function(){return Ln(Object.preventExtensions({}))}),wh=function(e){g0(e,lr,{value:{i:"O"+ ++p0,w:{}}})},x0=function(e,a){if(!m0(e))return typeof e=="symbol"?e:(typeof e=="string"?"S":"P")+e;if(!bh(e,lr)){if(!Ln(e))return"F";if(!a)return"E";wh(e)}return e[lr].i},F0=function(e,a){if(!bh(e,lr)){if(!Ln(e))return!0;if(!a)return!1;wh(e)}return e[lr].w},M0=function(e){return E0&&L0.NEED&&Ln(e)&&!bh(e,lr)&&wh(e),e},L0=jf.exports={KEY:lr,NEED:!1,fastKey:x0,getWeak:F0,onFreeze:M0},Gh=jf.exports,Wu=Ue,R0=Mn,N0=Ha.f,_h=function(e){var a=Wu.Symbol||(Wu.Symbol={});e.charAt(0)!="_"&&!(e in a)&&N0(a,e,{value:R0.f(e)})},A0=mn,y0=gn,O0=pn(),P0=function(e){var a=A0(e),r=y0.f;if(r)for(var t=r(e),n=O0.f,s=0,o;t.length>s;)n.call(e,o=t[s++])&&a.push(o);return a},B0=ms,tC=Array.isArray||function(a){return B0(a)=="Array"},eC={},Hh={},b0=Nf,w0=Fh.concat("length","prototype");Hh.f=Object.getOwnPropertyNames||function(a){return b0(a,w0)};var G0=Vr,aC=Hh.f,_0={}.toString,iC=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],H0=function(e){try{return aC(e)}catch{return iC.slice()}};eC.f=function(a){return iC&&_0.call(a)=="[object Window]"?H0(a):aC(G0(a))};var rC={},V0=pn(),Y0=Is,X0=Vr,k0=Ih,W0=vr,U0=Mf,Uu=Object.getOwnPropertyDescriptor;rC.f=Va?Uu:function(a,r){if(a=X0(a),r=k0(r,!0),U0)try{return Uu(a,r)}catch{}if(W0(a,r))return Y0(!V0.f.call(a,r),a[r])};var Rn=xa,Ze=vr,ah=Va,ia=na,Ku=Af,K0=Gh.KEY,Vh=Hr,Yh=Eh,Xh=Es,z0=In,Fs=Fa,J0=Mn,Z0=_h,Q0=P0,$0=tC,ih=Mi,q0=fi,j0=gs,Nn=Vr,kh=Ih,rh=Is,ls=En,sC=eC,nC=rC,An=gn,oC=Ha,tS=mn,hC=nC.f,nr=oC.f,lC=sC.f,pa=Rn.Symbol,sn=Rn.JSON,Js=sn&&sn.stringify,ki="prototype",ma=Fs("_hidden"),zu=Fs("toPrimitive"),eS={}.propertyIsEnumerable,jr=Yh("symbol-registry"),xi=Yh("symbols"),Ms=Yh("op-symbols"),Ga=Object[ki],Yr=typeof pa=="function"&&!!An.f,yo=Rn.QObject,sh=!yo||!yo[ki]||!yo[ki].findChild,nh=ah&&Vh(function(){return ls(nr({},"a",{get:function(){return nr(this,"a",{value:7}).a}})).a!=7})?function(e,a,r){var t=hC(Ga,a);t&&delete Ga[a],nr(e,a,r),t&&e!==Ga&&nr(Ga,a,t)}:nr,Ju=function(e){var a=xi[e]=ls(pa[ki]);return a._k=e,a},oh=Yr&&typeof pa.iterator=="symbol"?function(e){return typeof e=="symbol"}:function(e){return e instanceof pa},yn=function(a,r,t){return a===Ga&&yn(Ms,r,t),ih(a),r=kh(r,!0),ih(t),Ze(xi,r)?(t.enumerable?(Ze(a,ma)&&a[ma][r]&&(a[ma][r]=!1),t=ls(t,{enumerable:rh(0,!1)})):(Ze(a,ma)||nr(a,ma,rh(1,{})),a[ma][r]=!0),nh(a,r,t)):nr(a,r,t)},uC=function(a,r){ih(a);for(var t=Q0(r=Nn(r)),n=0,s=t.length,o;s>n;)yn(a,o=t[n++],r[o]);return a},aS=function(a,r){return r===void 0?ls(a):uC(ls(a),r)},Zu=function(a){var r=eS.call(this,a=kh(a,!0));return this===Ga&&Ze(xi,a)&&!Ze(Ms,a)?!1:r||!Ze(this,a)||!Ze(xi,a)||Ze(this,ma)&&this[ma][a]?r:!0},fC=function(a,r){if(a=Nn(a),r=kh(r,!0),!(a===Ga&&Ze(xi,r)&&!Ze(Ms,r))){var t=hC(a,r);return t&&Ze(xi,r)&&!(Ze(a,ma)&&a[ma][r])&&(t.enumerable=!0),t}},CC=function(a){for(var r=lC(Nn(a)),t=[],n=0,s;r.length>n;)!Ze(xi,s=r[n++])&&s!=ma&&s!=K0&&t.push(s);return t},DC=function(a){for(var r=a===Ga,t=lC(r?Ms:Nn(a)),n=[],s=0,o;t.length>s;)Ze(xi,o=t[s++])&&(!r||Ze(Ga,o))&&n.push(xi[o]);return n};Yr||(pa=function(){if(this instanceof pa)throw TypeError("Symbol is not a constructor!");var a=z0(arguments.length>0?arguments[0]:void 0),r=function(t){this===Ga&&r.call(Ms,t),Ze(this,ma)&&Ze(this[ma],a)&&(this[ma][a]=!1),nh(this,a,rh(1,t))};return ah&&sh&&nh(Ga,a,{configurable:!0,set:r}),Ju(a)},Ku(pa[ki],"toString",function(){return this._k}),nC.f=fC,oC.f=yn,Hh.f=sC.f=CC,pn().f=Zu,An.f=DC,ah&&!Rf&&Ku(Ga,"propertyIsEnumerable",Zu),J0.f=function(e){return Ju(Fs(e))});ia(ia.G+ia.W+ia.F*!Yr,{Symbol:pa});for(var Qu="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),$u=0;Qu.length>$u;)Fs(Qu[$u++]);for(var qu=tS(Fs.store),ju=0;qu.length>ju;)Z0(qu[ju++]);ia(ia.S+ia.F*!Yr,"Symbol",{for:function(e){return Ze(jr,e+="")?jr[e]:jr[e]=pa(e)},keyFor:function(a){if(!oh(a))throw TypeError(a+" is not a symbol!");for(var r in jr)if(jr[r]===a)return r},useSetter:function(){sh=!0},useSimple:function(){sh=!1}});ia(ia.S+ia.F*!Yr,"Object",{create:aS,defineProperty:yn,defineProperties:uC,getOwnPropertyDescriptor:fC,getOwnPropertyNames:CC,getOwnPropertySymbols:DC});var iS=Vh(function(){An.f(1)});ia(ia.S+ia.F*iS,"Object",{getOwnPropertySymbols:function(a){return An.f(j0(a))}});sn&&ia(ia.S+ia.F*(!Yr||Vh(function(){var e=pa();return Js([e])!="[null]"||Js({a:e})!="{}"||Js(Object(e))!="{}"})),"JSON",{stringify:function(a){for(var r=[a],t=1,n,s;arguments.length>t;)r.push(arguments[t++]);if(s=n=r[1],!(!q0(n)&&a===void 0||oh(a)))return $0(n)||(n=function(o,l){if(typeof s=="function"&&(l=s.call(this,o,l)),!oh(l))return l}),r[1]=n,Js.apply(sn,r)}});pa[ki][zu]||zi(pa[ki],zu,pa[ki].valueOf);Xh(pa,"Symbol");Xh(Math,"Math",!0);Xh(Rn.JSON,"JSON",!0);_h("asyncIterator");_h("observable");var rS=Ue.Symbol,sS={default:rS,__esModule:!0};Bh.__esModule=!0;var nS=I0,vC=cC(nS),oS=sS,Yi=cC(oS),Oo=typeof Yi.default=="function"&&typeof vC.default=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Yi.default=="function"&&e.constructor===Yi.default&&e!==Yi.default.prototype?"symbol":typeof e};function cC(e){return e&&e.__esModule?e:{default:e}}Bh.default=typeof Yi.default=="function"&&Oo(vC.default)==="symbol"?function(e){return typeof e>"u"?"undefined":Oo(e)}:function(e){return e&&typeof Yi.default=="function"&&e.constructor===Yi.default&&e!==Yi.default.prototype?"symbol":typeof e>"u"?"undefined":Oo(e)};var hS=fi,Wh=function(e,a){if(!hS(e)||e._t!==a)throw TypeError("Incompatible receiver, "+a+" required!");return e},lS=Ha.f,uS=En,fS=yh,CS=Ki,DS=Ah,vS=xs,cS=Lh,Zs=Hf,TS=Kf,TC=Va,SC=Gh.fastKey,xr=Wh,ts=TC?"_s":"size",Qs=function(e,a){var r=SC(a),t;if(r!=="F")return e._i[r];for(t=e._f;t;t=t.n)if(t.k==a)return t},dC={getConstructor:function(e,a,r,t){var n=e(function(s,o){DS(s,n,a,"_i"),s._t=a,s._i=uS(null),s._f=void 0,s._l=void 0,s[ts]=0,o!=null&&vS(o,r,s[t],s)});return fS(n.prototype,{clear:function(){for(var o=xr(this,a),l=o._i,h=o._f;h;h=h.n)h.r=!0,h.p&&(h.p=h.p.n=void 0),delete l[h.i];o._f=o._l=void 0,o[ts]=0},delete:function(s){var o=xr(this,a),l=Qs(o,s);if(l){var h=l.n,u=l.p;delete o._i[l.i],l.r=!0,u&&(u.n=h),h&&(h.p=u),o._f==l&&(o._f=h),o._l==l&&(o._l=u),o[ts]--}return!!l},forEach:function(o){xr(this,a);for(var l=CS(o,arguments.length>1?arguments[1]:void 0,3),h;h=h?h.n:this._f;)for(l(h.v,h.k,this);h&&h.r;)h=h.p},has:function(o){return!!Qs(xr(this,a),o)}}),TC&&lS(n.prototype,"size",{get:function(){return xr(this,a)[ts]}}),n},def:function(e,a,r){var t=Qs(e,a),n,s;return t?t.v=r:(e._l=t={i:s=SC(a,!0),k:a,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=t),n&&(n.n=t),e[ts]++,s!=="F"&&(e._i[s]=t)),e},getEntry:Qs,setStrong:function(e,a,r){cS(e,a,function(t,n){this._t=xr(t,a),this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,s=t._l;s&&s.r;)s=s.p;return!t._t||!(t._l=s=s?s.n:t._t._f)?(t._t=void 0,Zs(1)):n=="keys"?Zs(0,s.k):n=="values"?Zs(0,s.v):Zs(0,[s.k,s.v])},r?"entries":"values",!r,!0),TS(a)}},SS=fi,tf=tC,dS=Fa("species"),IS=function(e){var a;return tf(e)&&(a=e.constructor,typeof a=="function"&&(a===Array||tf(a.prototype))&&(a=void 0),SS(a)&&(a=a[dS],a===null&&(a=void 0))),a===void 0?Array:a},mS=IS,gS=function(e,a){return new(mS(e))(a)},pS=Ki,ES=mh,xS=gs,FS=dn,MS=gS,LS=function(e,a){var r=e==1,t=e==2,n=e==3,s=e==4,o=e==6,l=e==5||o,h=a||MS;return function(u,f,C){for(var D=xS(u),c=ES(D),T=pS(f,C,3),S=FS(c.length),I=0,g=r?h(u,S):t?h(u,0):void 0,E,F;S>I;I++)if((l||I in c)&&(E=c[I],F=T(E,I,D),e)){if(r)g[I]=F;else if(F)switch(e){case 3:return!0;case 5:return E;case 6:return I;case 2:g.push(E)}else if(s)return!1}return o?-1:n||s?s:g}},RS=xa,$s=na,NS=Gh,AS=Hr,yS=zi,OS=yh,PS=xs,ef=Ah,BS=fi,bS=Es,wS=Ha.f,GS=LS(0),_S=Va,IC=function(e,a,r,t,n,s){var o=RS[e],l=o,h=n?"set":"add",u=l&&l.prototype,f={};return!_S||typeof l!="function"||!(s||u.forEach&&!AS(function(){new l().entries().next()}))?(l=t.getConstructor(a,e,n,h),OS(l.prototype,r),NS.NEED=!0):(l=a(function(C,D){ef(C,l,e,"_c"),C._c=new o,D!=null&&PS(D,n,C[h],C)}),GS("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(C){var D=C=="add"||C=="set";C in u&&!(s&&C=="clear")&&yS(l.prototype,C,function(c,T){if(ef(this,l,C),!D&&s&&!BS(c))return C=="get"?void 0:!1;var S=this._c[C](c===0?0:c,T);return D?this:S})}),s||wS(l.prototype,"size",{get:function(){return this._c.size}})),bS(l,e),f[e]=l,$s($s.G+$s.W+$s.F,f),s||t.setStrong(l,e,n),l},af=dC,HS=Wh,rf="Set";IC(rf,function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(a){return af.def(HS(this,rf),a=a===0?0:a,a)}},af);var Po,sf;function VS(){if(sf)return Po;sf=1;var e=xs;return Po=function(a,r){var t=[];return e(a,!1,t.push,t,r),t},Po}var Bo,nf;function mC(){if(nf)return Bo;nf=1;var e=Rh,a=VS();return Bo=function(r){return function(){if(e(this)!=r)throw TypeError(r+"#toJSON isn't generic");return a(this)}},Bo}var bo=na;bo(bo.P+bo.R,"Set",{toJSON:mC()("Set")});var of=na,gC=function(e){of(of.S,e,{of:function(){for(var r=arguments.length,t=new Array(r);r--;)t[r]=arguments[r];return new this(t)}})};gC("Set");var hf=na,lf=ds,YS=Ki,uf=xs,pC=function(e){hf(hf.S,e,{from:function(r){var t=arguments[1],n,s,o,l;return lf(this),n=t!==void 0,n&&lf(t),r==null?new this:(s=[],n?(o=0,l=YS(t,arguments[2],2),uf(r,!1,function(h){s.push(l(h,o++))})):uf(r,!1,s.push,s),new this(s))}})};pC("Set");var XS=Ue.Set,EC={default:XS,__esModule:!0},On={},wo=na;wo(wo.S+wo.F*!Va,"Object",{defineProperty:Ha.f});var kS=Ue.Object,WS=function(a,r,t){return kS.defineProperty(a,r,t)},US={default:WS,__esModule:!0};On.__esModule=!0;var KS=US,zS=JS(KS);function JS(e){return e&&e.__esModule?e:{default:e}}On.default=function(e,a,r){return a in e?(0,zS.default)(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e};var ff=Ue,Cf=ff.JSON||(ff.JSON={stringify:JSON.stringify}),ZS=function(a){return Cf.stringify.apply(Cf,arguments)},QS={default:ZS,__esModule:!0},$S=Mi,qS=Nh,jS=Ue.getIterator=function(e){var a=qS(e);if(typeof a!="function")throw TypeError(e+" is not iterable!");return $S(a.call(e))},td=jS,xC={default:td,__esModule:!0},Go=dC,Df=Wh,_o="Map";IC(_o,function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(a){var r=Go.getEntry(Df(this,_o),a);return r&&r.v},set:function(a,r){return Go.def(Df(this,_o),a===0?0:a,r)}},Go,!0);var Ho=na;Ho(Ho.P+Ho.R,"Map",{toJSON:mC()("Map")});gC("Map");pC("Map");var ed=Ue.Map,Uh={default:ed,__esModule:!0},FC={exports:{}};/*!
 * jQuery JavaScript Library v3.7.1
 * https://jquery.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2023-08-28T13:37Z
 */(function(e){(function(a,r){e.exports=a.document?r(a,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return r(t)}})(typeof window<"u"?window:mv,function(a,r){var t=[],n=Object.getPrototypeOf,s=t.slice,o=t.flat?function(m){return t.flat.call(m)}:function(m){return t.concat.apply([],m)},l=t.push,h=t.indexOf,u={},f=u.toString,C=u.hasOwnProperty,D=C.toString,c=D.call(Object),T={},S=function(M){return typeof M=="function"&&typeof M.nodeType!="number"&&typeof M.item!="function"},I=function(M){return M!=null&&M===M.window},g=a.document,E={type:!0,src:!0,nonce:!0,noModule:!0};function F(m,M,N){N=N||g;var O,G,_=N.createElement("script");if(_.text=m,M)for(O in E)G=M[O]||M.getAttribute&&M.getAttribute(O),G&&_.setAttribute(O,G);N.head.appendChild(_).parentNode.removeChild(_)}function R(m){return m==null?m+"":typeof m=="object"||typeof m=="function"?u[f.call(m)]||"object":typeof m}var A="3.7.1",P=/HTML$/i,p=function(m,M){return new p.fn.init(m,M)};p.fn=p.prototype={jquery:A,constructor:p,length:0,toArray:function(){return s.call(this)},get:function(m){return m==null?s.call(this):m<0?this[m+this.length]:this[m]},pushStack:function(m){var M=p.merge(this.constructor(),m);return M.prevObject=this,M},each:function(m){return p.each(this,m)},map:function(m){return this.pushStack(p.map(this,function(M,N){return m.call(M,N,M)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(p.grep(this,function(m,M){return(M+1)%2}))},odd:function(){return this.pushStack(p.grep(this,function(m,M){return M%2}))},eq:function(m){var M=this.length,N=+m+(m<0?M:0);return this.pushStack(N>=0&&N<M?[this[N]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:t.sort,splice:t.splice},p.extend=p.fn.extend=function(){var m,M,N,O,G,_,V=arguments[0]||{},Q=1,J=arguments.length,et=!1;for(typeof V=="boolean"&&(et=V,V=arguments[Q]||{},Q++),typeof V!="object"&&!S(V)&&(V={}),Q===J&&(V=this,Q--);Q<J;Q++)if((m=arguments[Q])!=null)for(M in m)O=m[M],!(M==="__proto__"||V===O)&&(et&&O&&(p.isPlainObject(O)||(G=Array.isArray(O)))?(N=V[M],G&&!Array.isArray(N)?_=[]:!G&&!p.isPlainObject(N)?_={}:_=N,G=!1,V[M]=p.extend(et,_,O)):O!==void 0&&(V[M]=O));return V},p.extend({expando:"jQuery"+(A+Math.random()).replace(/\D/g,""),isReady:!0,error:function(m){throw new Error(m)},noop:function(){},isPlainObject:function(m){var M,N;return!m||f.call(m)!=="[object Object]"?!1:(M=n(m),M?(N=C.call(M,"constructor")&&M.constructor,typeof N=="function"&&D.call(N)===c):!0)},isEmptyObject:function(m){var M;for(M in m)return!1;return!0},globalEval:function(m,M,N){F(m,{nonce:M&&M.nonce},N)},each:function(m,M){var N,O=0;if(w(m))for(N=m.length;O<N&&M.call(m[O],O,m[O])!==!1;O++);else for(O in m)if(M.call(m[O],O,m[O])===!1)break;return m},text:function(m){var M,N="",O=0,G=m.nodeType;if(!G)for(;M=m[O++];)N+=p.text(M);return G===1||G===11?m.textContent:G===9?m.documentElement.textContent:G===3||G===4?m.nodeValue:N},makeArray:function(m,M){var N=M||[];return m!=null&&(w(Object(m))?p.merge(N,typeof m=="string"?[m]:m):l.call(N,m)),N},inArray:function(m,M,N){return M==null?-1:h.call(M,m,N)},isXMLDoc:function(m){var M=m&&m.namespaceURI,N=m&&(m.ownerDocument||m).documentElement;return!P.test(M||N&&N.nodeName||"HTML")},merge:function(m,M){for(var N=+M.length,O=0,G=m.length;O<N;O++)m[G++]=M[O];return m.length=G,m},grep:function(m,M,N){for(var O,G=[],_=0,V=m.length,Q=!N;_<V;_++)O=!M(m[_],_),O!==Q&&G.push(m[_]);return G},map:function(m,M,N){var O,G,_=0,V=[];if(w(m))for(O=m.length;_<O;_++)G=M(m[_],_,N),G!=null&&V.push(G);else for(_ in m)G=M(m[_],_,N),G!=null&&V.push(G);return o(V)},guid:1,support:T}),typeof Symbol=="function"&&(p.fn[Symbol.iterator]=t[Symbol.iterator]),p.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(m,M){u["[object "+M+"]"]=M.toLowerCase()});function w(m){var M=!!m&&"length"in m&&m.length,N=R(m);return S(m)||I(m)?!1:N==="array"||M===0||typeof M=="number"&&M>0&&M-1 in m}function H(m,M){return m.nodeName&&m.nodeName.toLowerCase()===M.toLowerCase()}var W=t.pop,ht=t.sort,rt=t.splice,nt="[\\x20\\t\\r\\n\\f]",vt=new RegExp("^"+nt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+nt+"+$","g");p.contains=function(m,M){var N=M&&M.parentNode;return m===N||!!(N&&N.nodeType===1&&(m.contains?m.contains(N):m.compareDocumentPosition&&m.compareDocumentPosition(N)&16))};var Nt=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function Ft(m,M){return M?m==="\0"?"�":m.slice(0,-1)+"\\"+m.charCodeAt(m.length-1).toString(16)+" ":"\\"+m}p.escapeSelector=function(m){return(m+"").replace(Nt,Ft)};var Bt=g,Jt=l;(function(){var m,M,N,O,G,_=Jt,V,Q,J,et,Ct,Tt=p.expando,st=0,pt=0,zt=Gs(),De=Gs(),ie=Gs(),Qe=Gs(),We=function(K,tt){return K===tt&&(G=!0),0},ii="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ri="(?:\\\\[\\da-fA-F]{1,6}"+nt+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",le="\\["+nt+"*("+ri+")(?:"+nt+"*([*^$|!~]?=)"+nt+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+ri+"))|)"+nt+"*\\]",ar=":("+ri+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+le+")*)|.*)\\)|)",Se=new RegExp(nt+"+","g"),Ge=new RegExp("^"+nt+"*,"+nt+"*"),Zr=new RegExp("^"+nt+"*([>+~]|"+nt+")"+nt+"*"),jn=new RegExp(nt+"|>"),si=new RegExp(ar),Qr=new RegExp("^"+ri+"$"),ni={ID:new RegExp("^#("+ri+")"),CLASS:new RegExp("^\\.("+ri+")"),TAG:new RegExp("^("+ri+"|[*])"),ATTR:new RegExp("^"+le),PSEUDO:new RegExp("^"+ar),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+nt+"*(even|odd|(([+-]|)(\\d*)n|)"+nt+"*(?:([+-]|)"+nt+"*(\\d+)|))"+nt+"*\\)|)","i"),bool:new RegExp("^(?:"+ii+")$","i"),needsContext:new RegExp("^"+nt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+nt+"*((?:-\\d)?\\d*)"+nt+"*\\)|)(?=[^-]|$)","i")},bi=/^(?:input|select|textarea|button)$/i,wi=/^h\d$/i,Ba=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,to=/[+~]/,Ti=new RegExp("\\\\[\\da-fA-F]{1,6}"+nt+"?|\\\\([^\\r\\n\\f])","g"),Si=function(K,tt){var it="0x"+K.slice(1)-65536;return tt||(it<0?String.fromCharCode(it+65536):String.fromCharCode(it>>10|55296,it&1023|56320))},lv=function(){Gi()},uv=Hs(function(K){return K.disabled===!0&&H(K,"fieldset")},{dir:"parentNode",next:"legend"});function fv(){try{return V.activeElement}catch{}}try{_.apply(t=s.call(Bt.childNodes),Bt.childNodes),t[Bt.childNodes.length].nodeType}catch{_={apply:function(tt,it){Jt.apply(tt,s.call(it))},call:function(tt){Jt.apply(tt,s.call(arguments,1))}}}function pe(K,tt,it,lt){var ct,Et,Mt,Ot,Lt,ne,kt,Zt=tt&&tt.ownerDocument,oe=tt?tt.nodeType:9;if(it=it||[],typeof K!="string"||!K||oe!==1&&oe!==9&&oe!==11)return it;if(!lt&&(Gi(tt),tt=tt||V,J)){if(oe!==11&&(Lt=Ba.exec(K)))if(ct=Lt[1]){if(oe===9)if(Mt=tt.getElementById(ct)){if(Mt.id===ct)return _.call(it,Mt),it}else return it;else if(Zt&&(Mt=Zt.getElementById(ct))&&pe.contains(tt,Mt)&&Mt.id===ct)return _.call(it,Mt),it}else{if(Lt[2])return _.apply(it,tt.getElementsByTagName(K)),it;if((ct=Lt[3])&&tt.getElementsByClassName)return _.apply(it,tt.getElementsByClassName(ct)),it}if(!Qe[K+" "]&&(!et||!et.test(K))){if(kt=K,Zt=tt,oe===1&&(jn.test(K)||Zr.test(K))){for(Zt=to.test(K)&&eo(tt.parentNode)||tt,(Zt!=tt||!T.scope)&&((Ot=tt.getAttribute("id"))?Ot=p.escapeSelector(Ot):tt.setAttribute("id",Ot=Tt)),ne=$r(K),Et=ne.length;Et--;)ne[Et]=(Ot?"#"+Ot:":scope")+" "+_s(ne[Et]);kt=ne.join(",")}try{return _.apply(it,Zt.querySelectorAll(kt)),it}catch{Qe(K,!0)}finally{Ot===Tt&&tt.removeAttribute("id")}}}return Jl(K.replace(vt,"$1"),tt,it,lt)}function Gs(){var K=[];function tt(it,lt){return K.push(it+" ")>M.cacheLength&&delete tt[K.shift()],tt[it+" "]=lt}return tt}function Wa(K){return K[Tt]=!0,K}function pr(K){var tt=V.createElement("fieldset");try{return!!K(tt)}catch{return!1}finally{tt.parentNode&&tt.parentNode.removeChild(tt),tt=null}}function Cv(K){return function(tt){return H(tt,"input")&&tt.type===K}}function Dv(K){return function(tt){return(H(tt,"input")||H(tt,"button"))&&tt.type===K}}function Kl(K){return function(tt){return"form"in tt?tt.parentNode&&tt.disabled===!1?"label"in tt?"label"in tt.parentNode?tt.parentNode.disabled===K:tt.disabled===K:tt.isDisabled===K||tt.isDisabled!==!K&&uv(tt)===K:tt.disabled===K:"label"in tt?tt.disabled===K:!1}}function ir(K){return Wa(function(tt){return tt=+tt,Wa(function(it,lt){for(var ct,Et=K([],it.length,tt),Mt=Et.length;Mt--;)it[ct=Et[Mt]]&&(it[ct]=!(lt[ct]=it[ct]))})})}function eo(K){return K&&typeof K.getElementsByTagName<"u"&&K}function Gi(K){var tt,it=K?K.ownerDocument||K:Bt;return it==V||it.nodeType!==9||!it.documentElement||(V=it,Q=V.documentElement,J=!p.isXMLDoc(V),Ct=Q.matches||Q.webkitMatchesSelector||Q.msMatchesSelector,Q.msMatchesSelector&&Bt!=V&&(tt=V.defaultView)&&tt.top!==tt&&tt.addEventListener("unload",lv),T.getById=pr(function(lt){return Q.appendChild(lt).id=p.expando,!V.getElementsByName||!V.getElementsByName(p.expando).length}),T.disconnectedMatch=pr(function(lt){return Ct.call(lt,"*")}),T.scope=pr(function(){return V.querySelectorAll(":scope")}),T.cssHas=pr(function(){try{return V.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),T.getById?(M.filter.ID=function(lt){var ct=lt.replace(Ti,Si);return function(Et){return Et.getAttribute("id")===ct}},M.find.ID=function(lt,ct){if(typeof ct.getElementById<"u"&&J){var Et=ct.getElementById(lt);return Et?[Et]:[]}}):(M.filter.ID=function(lt){var ct=lt.replace(Ti,Si);return function(Et){var Mt=typeof Et.getAttributeNode<"u"&&Et.getAttributeNode("id");return Mt&&Mt.value===ct}},M.find.ID=function(lt,ct){if(typeof ct.getElementById<"u"&&J){var Et,Mt,Ot,Lt=ct.getElementById(lt);if(Lt){if(Et=Lt.getAttributeNode("id"),Et&&Et.value===lt)return[Lt];for(Ot=ct.getElementsByName(lt),Mt=0;Lt=Ot[Mt++];)if(Et=Lt.getAttributeNode("id"),Et&&Et.value===lt)return[Lt]}return[]}}),M.find.TAG=function(lt,ct){return typeof ct.getElementsByTagName<"u"?ct.getElementsByTagName(lt):ct.querySelectorAll(lt)},M.find.CLASS=function(lt,ct){if(typeof ct.getElementsByClassName<"u"&&J)return ct.getElementsByClassName(lt)},et=[],pr(function(lt){var ct;Q.appendChild(lt).innerHTML="<a id='"+Tt+"' href='' disabled='disabled'></a><select id='"+Tt+"-\r\\' disabled='disabled'><option selected=''></option></select>",lt.querySelectorAll("[selected]").length||et.push("\\["+nt+"*(?:value|"+ii+")"),lt.querySelectorAll("[id~="+Tt+"-]").length||et.push("~="),lt.querySelectorAll("a#"+Tt+"+*").length||et.push(".#.+[+~]"),lt.querySelectorAll(":checked").length||et.push(":checked"),ct=V.createElement("input"),ct.setAttribute("type","hidden"),lt.appendChild(ct).setAttribute("name","D"),Q.appendChild(lt).disabled=!0,lt.querySelectorAll(":disabled").length!==2&&et.push(":enabled",":disabled"),ct=V.createElement("input"),ct.setAttribute("name",""),lt.appendChild(ct),lt.querySelectorAll("[name='']").length||et.push("\\["+nt+"*name"+nt+"*="+nt+`*(?:''|"")`)}),T.cssHas||et.push(":has"),et=et.length&&new RegExp(et.join("|")),We=function(lt,ct){if(lt===ct)return G=!0,0;var Et=!lt.compareDocumentPosition-!ct.compareDocumentPosition;return Et||(Et=(lt.ownerDocument||lt)==(ct.ownerDocument||ct)?lt.compareDocumentPosition(ct):1,Et&1||!T.sortDetached&&ct.compareDocumentPosition(lt)===Et?lt===V||lt.ownerDocument==Bt&&pe.contains(Bt,lt)?-1:ct===V||ct.ownerDocument==Bt&&pe.contains(Bt,ct)?1:O?h.call(O,lt)-h.call(O,ct):0:Et&4?-1:1)}),V}pe.matches=function(K,tt){return pe(K,null,null,tt)},pe.matchesSelector=function(K,tt){if(Gi(K),J&&!Qe[tt+" "]&&(!et||!et.test(tt)))try{var it=Ct.call(K,tt);if(it||T.disconnectedMatch||K.document&&K.document.nodeType!==11)return it}catch{Qe(tt,!0)}return pe(tt,V,null,[K]).length>0},pe.contains=function(K,tt){return(K.ownerDocument||K)!=V&&Gi(K),p.contains(K,tt)},pe.attr=function(K,tt){(K.ownerDocument||K)!=V&&Gi(K);var it=M.attrHandle[tt.toLowerCase()],lt=it&&C.call(M.attrHandle,tt.toLowerCase())?it(K,tt,!J):void 0;return lt!==void 0?lt:K.getAttribute(tt)},pe.error=function(K){throw new Error("Syntax error, unrecognized expression: "+K)},p.uniqueSort=function(K){var tt,it=[],lt=0,ct=0;if(G=!T.sortStable,O=!T.sortStable&&s.call(K,0),ht.call(K,We),G){for(;tt=K[ct++];)tt===K[ct]&&(lt=it.push(ct));for(;lt--;)rt.call(K,it[lt],1)}return O=null,K},p.fn.uniqueSort=function(){return this.pushStack(p.uniqueSort(s.apply(this)))},M=p.expr={cacheLength:50,createPseudo:Wa,match:ni,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(K){return K[1]=K[1].replace(Ti,Si),K[3]=(K[3]||K[4]||K[5]||"").replace(Ti,Si),K[2]==="~="&&(K[3]=" "+K[3]+" "),K.slice(0,4)},CHILD:function(K){return K[1]=K[1].toLowerCase(),K[1].slice(0,3)==="nth"?(K[3]||pe.error(K[0]),K[4]=+(K[4]?K[5]+(K[6]||1):2*(K[3]==="even"||K[3]==="odd")),K[5]=+(K[7]+K[8]||K[3]==="odd")):K[3]&&pe.error(K[0]),K},PSEUDO:function(K){var tt,it=!K[6]&&K[2];return ni.CHILD.test(K[0])?null:(K[3]?K[2]=K[4]||K[5]||"":it&&si.test(it)&&(tt=$r(it,!0))&&(tt=it.indexOf(")",it.length-tt)-it.length)&&(K[0]=K[0].slice(0,tt),K[2]=it.slice(0,tt)),K.slice(0,3))}},filter:{TAG:function(K){var tt=K.replace(Ti,Si).toLowerCase();return K==="*"?function(){return!0}:function(it){return H(it,tt)}},CLASS:function(K){var tt=zt[K+" "];return tt||(tt=new RegExp("(^|"+nt+")"+K+"("+nt+"|$)"))&&zt(K,function(it){return tt.test(typeof it.className=="string"&&it.className||typeof it.getAttribute<"u"&&it.getAttribute("class")||"")})},ATTR:function(K,tt,it){return function(lt){var ct=pe.attr(lt,K);return ct==null?tt==="!=":tt?(ct+="",tt==="="?ct===it:tt==="!="?ct!==it:tt==="^="?it&&ct.indexOf(it)===0:tt==="*="?it&&ct.indexOf(it)>-1:tt==="$="?it&&ct.slice(-it.length)===it:tt==="~="?(" "+ct.replace(Se," ")+" ").indexOf(it)>-1:tt==="|="?ct===it||ct.slice(0,it.length+1)===it+"-":!1):!0}},CHILD:function(K,tt,it,lt,ct){var Et=K.slice(0,3)!=="nth",Mt=K.slice(-4)!=="last",Ot=tt==="of-type";return lt===1&&ct===0?function(Lt){return!!Lt.parentNode}:function(Lt,ne,kt){var Zt,oe,Gt,Ae,da,ea=Et!==Mt?"nextSibling":"previousSibling",ba=Lt.parentNode,oi=Ot&&Lt.nodeName.toLowerCase(),Er=!kt&&!Ot,fa=!1;if(ba){if(Et){for(;ea;){for(Gt=Lt;Gt=Gt[ea];)if(Ot?H(Gt,oi):Gt.nodeType===1)return!1;da=ea=K==="only"&&!da&&"nextSibling"}return!0}if(da=[Mt?ba.firstChild:ba.lastChild],Mt&&Er){for(oe=ba[Tt]||(ba[Tt]={}),Zt=oe[K]||[],Ae=Zt[0]===st&&Zt[1],fa=Ae&&Zt[2],Gt=Ae&&ba.childNodes[Ae];Gt=++Ae&&Gt&&Gt[ea]||(fa=Ae=0)||da.pop();)if(Gt.nodeType===1&&++fa&&Gt===Lt){oe[K]=[st,Ae,fa];break}}else if(Er&&(oe=Lt[Tt]||(Lt[Tt]={}),Zt=oe[K]||[],Ae=Zt[0]===st&&Zt[1],fa=Ae),fa===!1)for(;(Gt=++Ae&&Gt&&Gt[ea]||(fa=Ae=0)||da.pop())&&!((Ot?H(Gt,oi):Gt.nodeType===1)&&++fa&&(Er&&(oe=Gt[Tt]||(Gt[Tt]={}),oe[K]=[st,fa]),Gt===Lt)););return fa-=ct,fa===lt||fa%lt===0&&fa/lt>=0}}},PSEUDO:function(K,tt){var it,lt=M.pseudos[K]||M.setFilters[K.toLowerCase()]||pe.error("unsupported pseudo: "+K);return lt[Tt]?lt(tt):lt.length>1?(it=[K,K,"",tt],M.setFilters.hasOwnProperty(K.toLowerCase())?Wa(function(ct,Et){for(var Mt,Ot=lt(ct,tt),Lt=Ot.length;Lt--;)Mt=h.call(ct,Ot[Lt]),ct[Mt]=!(Et[Mt]=Ot[Lt])}):function(ct){return lt(ct,0,it)}):lt}},pseudos:{not:Wa(function(K){var tt=[],it=[],lt=so(K.replace(vt,"$1"));return lt[Tt]?Wa(function(ct,Et,Mt,Ot){for(var Lt,ne=lt(ct,null,Ot,[]),kt=ct.length;kt--;)(Lt=ne[kt])&&(ct[kt]=!(Et[kt]=Lt))}):function(ct,Et,Mt){return tt[0]=ct,lt(tt,null,Mt,it),tt[0]=null,!it.pop()}}),has:Wa(function(K){return function(tt){return pe(K,tt).length>0}}),contains:Wa(function(K){return K=K.replace(Ti,Si),function(tt){return(tt.textContent||p.text(tt)).indexOf(K)>-1}}),lang:Wa(function(K){return Qr.test(K||"")||pe.error("unsupported lang: "+K),K=K.replace(Ti,Si).toLowerCase(),function(tt){var it;do if(it=J?tt.lang:tt.getAttribute("xml:lang")||tt.getAttribute("lang"))return it=it.toLowerCase(),it===K||it.indexOf(K+"-")===0;while((tt=tt.parentNode)&&tt.nodeType===1);return!1}}),target:function(K){var tt=a.location&&a.location.hash;return tt&&tt.slice(1)===K.id},root:function(K){return K===Q},focus:function(K){return K===fv()&&V.hasFocus()&&!!(K.type||K.href||~K.tabIndex)},enabled:Kl(!1),disabled:Kl(!0),checked:function(K){return H(K,"input")&&!!K.checked||H(K,"option")&&!!K.selected},selected:function(K){return K.parentNode&&K.parentNode.selectedIndex,K.selected===!0},empty:function(K){for(K=K.firstChild;K;K=K.nextSibling)if(K.nodeType<6)return!1;return!0},parent:function(K){return!M.pseudos.empty(K)},header:function(K){return wi.test(K.nodeName)},input:function(K){return bi.test(K.nodeName)},button:function(K){return H(K,"input")&&K.type==="button"||H(K,"button")},text:function(K){var tt;return H(K,"input")&&K.type==="text"&&((tt=K.getAttribute("type"))==null||tt.toLowerCase()==="text")},first:ir(function(){return[0]}),last:ir(function(K,tt){return[tt-1]}),eq:ir(function(K,tt,it){return[it<0?it+tt:it]}),even:ir(function(K,tt){for(var it=0;it<tt;it+=2)K.push(it);return K}),odd:ir(function(K,tt){for(var it=1;it<tt;it+=2)K.push(it);return K}),lt:ir(function(K,tt,it){var lt;for(it<0?lt=it+tt:it>tt?lt=tt:lt=it;--lt>=0;)K.push(lt);return K}),gt:ir(function(K,tt,it){for(var lt=it<0?it+tt:it;++lt<tt;)K.push(lt);return K})}},M.pseudos.nth=M.pseudos.eq;for(m in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})M.pseudos[m]=Cv(m);for(m in{submit:!0,reset:!0})M.pseudos[m]=Dv(m);function zl(){}zl.prototype=M.filters=M.pseudos,M.setFilters=new zl;function $r(K,tt){var it,lt,ct,Et,Mt,Ot,Lt,ne=De[K+" "];if(ne)return tt?0:ne.slice(0);for(Mt=K,Ot=[],Lt=M.preFilter;Mt;){(!it||(lt=Ge.exec(Mt)))&&(lt&&(Mt=Mt.slice(lt[0].length)||Mt),Ot.push(ct=[])),it=!1,(lt=Zr.exec(Mt))&&(it=lt.shift(),ct.push({value:it,type:lt[0].replace(vt," ")}),Mt=Mt.slice(it.length));for(Et in M.filter)(lt=ni[Et].exec(Mt))&&(!Lt[Et]||(lt=Lt[Et](lt)))&&(it=lt.shift(),ct.push({value:it,type:Et,matches:lt}),Mt=Mt.slice(it.length));if(!it)break}return tt?Mt.length:Mt?pe.error(K):De(K,Ot).slice(0)}function _s(K){for(var tt=0,it=K.length,lt="";tt<it;tt++)lt+=K[tt].value;return lt}function Hs(K,tt,it){var lt=tt.dir,ct=tt.next,Et=ct||lt,Mt=it&&Et==="parentNode",Ot=pt++;return tt.first?function(Lt,ne,kt){for(;Lt=Lt[lt];)if(Lt.nodeType===1||Mt)return K(Lt,ne,kt);return!1}:function(Lt,ne,kt){var Zt,oe,Gt=[st,Ot];if(kt){for(;Lt=Lt[lt];)if((Lt.nodeType===1||Mt)&&K(Lt,ne,kt))return!0}else for(;Lt=Lt[lt];)if(Lt.nodeType===1||Mt)if(oe=Lt[Tt]||(Lt[Tt]={}),ct&&H(Lt,ct))Lt=Lt[lt]||Lt;else{if((Zt=oe[Et])&&Zt[0]===st&&Zt[1]===Ot)return Gt[2]=Zt[2];if(oe[Et]=Gt,Gt[2]=K(Lt,ne,kt))return!0}return!1}}function ao(K){return K.length>1?function(tt,it,lt){for(var ct=K.length;ct--;)if(!K[ct](tt,it,lt))return!1;return!0}:K[0]}function vv(K,tt,it){for(var lt=0,ct=tt.length;lt<ct;lt++)pe(K,tt[lt],it);return it}function Vs(K,tt,it,lt,ct){for(var Et,Mt=[],Ot=0,Lt=K.length,ne=tt!=null;Ot<Lt;Ot++)(Et=K[Ot])&&(!it||it(Et,lt,ct))&&(Mt.push(Et),ne&&tt.push(Ot));return Mt}function io(K,tt,it,lt,ct,Et){return lt&&!lt[Tt]&&(lt=io(lt)),ct&&!ct[Tt]&&(ct=io(ct,Et)),Wa(function(Mt,Ot,Lt,ne){var kt,Zt,oe,Gt,Ae=[],da=[],ea=Ot.length,ba=Mt||vv(tt||"*",Lt.nodeType?[Lt]:Lt,[]),oi=K&&(Mt||!tt)?Vs(ba,Ae,K,Lt,ne):ba;if(it?(Gt=ct||(Mt?K:ea||lt)?[]:Ot,it(oi,Gt,Lt,ne)):Gt=oi,lt)for(kt=Vs(Gt,da),lt(kt,[],Lt,ne),Zt=kt.length;Zt--;)(oe=kt[Zt])&&(Gt[da[Zt]]=!(oi[da[Zt]]=oe));if(Mt){if(ct||K){if(ct){for(kt=[],Zt=Gt.length;Zt--;)(oe=Gt[Zt])&&kt.push(oi[Zt]=oe);ct(null,Gt=[],kt,ne)}for(Zt=Gt.length;Zt--;)(oe=Gt[Zt])&&(kt=ct?h.call(Mt,oe):Ae[Zt])>-1&&(Mt[kt]=!(Ot[kt]=oe))}}else Gt=Vs(Gt===Ot?Gt.splice(ea,Gt.length):Gt),ct?ct(null,Ot,Gt,ne):_.apply(Ot,Gt)})}function ro(K){for(var tt,it,lt,ct=K.length,Et=M.relative[K[0].type],Mt=Et||M.relative[" "],Ot=Et?1:0,Lt=Hs(function(Zt){return Zt===tt},Mt,!0),ne=Hs(function(Zt){return h.call(tt,Zt)>-1},Mt,!0),kt=[function(Zt,oe,Gt){var Ae=!Et&&(Gt||oe!=N)||((tt=oe).nodeType?Lt(Zt,oe,Gt):ne(Zt,oe,Gt));return tt=null,Ae}];Ot<ct;Ot++)if(it=M.relative[K[Ot].type])kt=[Hs(ao(kt),it)];else{if(it=M.filter[K[Ot].type].apply(null,K[Ot].matches),it[Tt]){for(lt=++Ot;lt<ct&&!M.relative[K[lt].type];lt++);return io(Ot>1&&ao(kt),Ot>1&&_s(K.slice(0,Ot-1).concat({value:K[Ot-2].type===" "?"*":""})).replace(vt,"$1"),it,Ot<lt&&ro(K.slice(Ot,lt)),lt<ct&&ro(K=K.slice(lt)),lt<ct&&_s(K))}kt.push(it)}return ao(kt)}function cv(K,tt){var it=tt.length>0,lt=K.length>0,ct=function(Et,Mt,Ot,Lt,ne){var kt,Zt,oe,Gt=0,Ae="0",da=Et&&[],ea=[],ba=N,oi=Et||lt&&M.find.TAG("*",ne),Er=st+=ba==null?1:Math.random()||.1,fa=oi.length;for(ne&&(N=Mt==V||Mt||ne);Ae!==fa&&(kt=oi[Ae])!=null;Ae++){if(lt&&kt){for(Zt=0,!Mt&&kt.ownerDocument!=V&&(Gi(kt),Ot=!J);oe=K[Zt++];)if(oe(kt,Mt||V,Ot)){_.call(Lt,kt);break}ne&&(st=Er)}it&&((kt=!oe&&kt)&&Gt--,Et&&da.push(kt))}if(Gt+=Ae,it&&Ae!==Gt){for(Zt=0;oe=tt[Zt++];)oe(da,ea,Mt,Ot);if(Et){if(Gt>0)for(;Ae--;)da[Ae]||ea[Ae]||(ea[Ae]=W.call(Lt));ea=Vs(ea)}_.apply(Lt,ea),ne&&!Et&&ea.length>0&&Gt+tt.length>1&&p.uniqueSort(Lt)}return ne&&(st=Er,N=ba),da};return it?Wa(ct):ct}function so(K,tt){var it,lt=[],ct=[],Et=ie[K+" "];if(!Et){for(tt||(tt=$r(K)),it=tt.length;it--;)Et=ro(tt[it]),Et[Tt]?lt.push(Et):ct.push(Et);Et=ie(K,cv(ct,lt)),Et.selector=K}return Et}function Jl(K,tt,it,lt){var ct,Et,Mt,Ot,Lt,ne=typeof K=="function"&&K,kt=!lt&&$r(K=ne.selector||K);if(it=it||[],kt.length===1){if(Et=kt[0]=kt[0].slice(0),Et.length>2&&(Mt=Et[0]).type==="ID"&&tt.nodeType===9&&J&&M.relative[Et[1].type]){if(tt=(M.find.ID(Mt.matches[0].replace(Ti,Si),tt)||[])[0],tt)ne&&(tt=tt.parentNode);else return it;K=K.slice(Et.shift().value.length)}for(ct=ni.needsContext.test(K)?0:Et.length;ct--&&(Mt=Et[ct],!M.relative[Ot=Mt.type]);)if((Lt=M.find[Ot])&&(lt=Lt(Mt.matches[0].replace(Ti,Si),to.test(Et[0].type)&&eo(tt.parentNode)||tt))){if(Et.splice(ct,1),K=lt.length&&_s(Et),!K)return _.apply(it,lt),it;break}}return(ne||so(K,kt))(lt,tt,!J,it,!tt||to.test(K)&&eo(tt.parentNode)||tt),it}T.sortStable=Tt.split("").sort(We).join("")===Tt,Gi(),T.sortDetached=pr(function(K){return K.compareDocumentPosition(V.createElement("fieldset"))&1}),p.find=pe,p.expr[":"]=p.expr.pseudos,p.unique=p.uniqueSort,pe.compile=so,pe.select=Jl,pe.setDocument=Gi,pe.tokenize=$r,pe.escape=p.escapeSelector,pe.getText=p.text,pe.isXML=p.isXMLDoc,pe.selectors=p.expr,pe.support=p.support,pe.uniqueSort=p.uniqueSort})();var te=function(m,M,N){for(var O=[],G=N!==void 0;(m=m[M])&&m.nodeType!==9;)if(m.nodeType===1){if(G&&p(m).is(N))break;O.push(m)}return O},Me=function(m,M){for(var N=[];m;m=m.nextSibling)m.nodeType===1&&m!==M&&N.push(m);return N},we=p.expr.match.needsContext,Oa=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function It(m,M,N){return S(M)?p.grep(m,function(O,G){return!!M.call(O,G,O)!==N}):M.nodeType?p.grep(m,function(O){return O===M!==N}):typeof M!="string"?p.grep(m,function(O){return h.call(M,O)>-1!==N}):p.filter(M,m,N)}p.filter=function(m,M,N){var O=M[0];return N&&(m=":not("+m+")"),M.length===1&&O.nodeType===1?p.find.matchesSelector(O,m)?[O]:[]:p.find.matches(m,p.grep(M,function(G){return G.nodeType===1}))},p.fn.extend({find:function(m){var M,N,O=this.length,G=this;if(typeof m!="string")return this.pushStack(p(m).filter(function(){for(M=0;M<O;M++)if(p.contains(G[M],this))return!0}));for(N=this.pushStack([]),M=0;M<O;M++)p.find(m,G[M],N);return O>1?p.uniqueSort(N):N},filter:function(m){return this.pushStack(It(this,m||[],!1))},not:function(m){return this.pushStack(It(this,m||[],!0))},is:function(m){return!!It(this,typeof m=="string"&&we.test(m)?p(m):m||[],!1).length}});var bt,xt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,qt=p.fn.init=function(m,M,N){var O,G;if(!m)return this;if(N=N||bt,typeof m=="string")if(m[0]==="<"&&m[m.length-1]===">"&&m.length>=3?O=[null,m,null]:O=xt.exec(m),O&&(O[1]||!M))if(O[1]){if(M=M instanceof p?M[0]:M,p.merge(this,p.parseHTML(O[1],M&&M.nodeType?M.ownerDocument||M:g,!0)),Oa.test(O[1])&&p.isPlainObject(M))for(O in M)S(this[O])?this[O](M[O]):this.attr(O,M[O]);return this}else return G=g.getElementById(O[2]),G&&(this[0]=G,this.length=1),this;else return!M||M.jquery?(M||N).find(m):this.constructor(M).find(m);else{if(m.nodeType)return this[0]=m,this.length=1,this;if(S(m))return N.ready!==void 0?N.ready(m):m(p)}return p.makeArray(m,this)};qt.prototype=p.fn,bt=p(g);var ge=/^(?:parents|prev(?:Until|All))/,me={children:!0,contents:!0,next:!0,prev:!0};p.fn.extend({has:function(m){var M=p(m,this),N=M.length;return this.filter(function(){for(var O=0;O<N;O++)if(p.contains(this,M[O]))return!0})},closest:function(m,M){var N,O=0,G=this.length,_=[],V=typeof m!="string"&&p(m);if(!we.test(m)){for(;O<G;O++)for(N=this[O];N&&N!==M;N=N.parentNode)if(N.nodeType<11&&(V?V.index(N)>-1:N.nodeType===1&&p.find.matchesSelector(N,m))){_.push(N);break}}return this.pushStack(_.length>1?p.uniqueSort(_):_)},index:function(m){return m?typeof m=="string"?h.call(p(m),this[0]):h.call(this,m.jquery?m[0]:m):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(m,M){return this.pushStack(p.uniqueSort(p.merge(this.get(),p(m,M))))},addBack:function(m){return this.add(m==null?this.prevObject:this.prevObject.filter(m))}});function ha(m,M){for(;(m=m[M])&&m.nodeType!==1;);return m}p.each({parent:function(m){var M=m.parentNode;return M&&M.nodeType!==11?M:null},parents:function(m){return te(m,"parentNode")},parentsUntil:function(m,M,N){return te(m,"parentNode",N)},next:function(m){return ha(m,"nextSibling")},prev:function(m){return ha(m,"previousSibling")},nextAll:function(m){return te(m,"nextSibling")},prevAll:function(m){return te(m,"previousSibling")},nextUntil:function(m,M,N){return te(m,"nextSibling",N)},prevUntil:function(m,M,N){return te(m,"previousSibling",N)},siblings:function(m){return Me((m.parentNode||{}).firstChild,m)},children:function(m){return Me(m.firstChild)},contents:function(m){return m.contentDocument!=null&&n(m.contentDocument)?m.contentDocument:(H(m,"template")&&(m=m.content||m),p.merge([],m.childNodes))}},function(m,M){p.fn[m]=function(N,O){var G=p.map(this,M,N);return m.slice(-5)!=="Until"&&(O=N),O&&typeof O=="string"&&(G=p.filter(O,G)),this.length>1&&(me[m]||p.uniqueSort(G),ge.test(m)&&G.reverse()),this.pushStack(G)}});var Oe=/[^\x20\t\r\n\f]+/g;function Ni(m){var M={};return p.each(m.match(Oe)||[],function(N,O){M[O]=!0}),M}p.Callbacks=function(m){m=typeof m=="string"?Ni(m):p.extend({},m);var M,N,O,G,_=[],V=[],Q=-1,J=function(){for(G=G||m.once,O=M=!0;V.length;Q=-1)for(N=V.shift();++Q<_.length;)_[Q].apply(N[0],N[1])===!1&&m.stopOnFalse&&(Q=_.length,N=!1);m.memory||(N=!1),M=!1,G&&(N?_=[]:_="")},et={add:function(){return _&&(N&&!M&&(Q=_.length-1,V.push(N)),function Ct(Tt){p.each(Tt,function(st,pt){S(pt)?(!m.unique||!et.has(pt))&&_.push(pt):pt&&pt.length&&R(pt)!=="string"&&Ct(pt)})}(arguments),N&&!M&&J()),this},remove:function(){return p.each(arguments,function(Ct,Tt){for(var st;(st=p.inArray(Tt,_,st))>-1;)_.splice(st,1),st<=Q&&Q--}),this},has:function(Ct){return Ct?p.inArray(Ct,_)>-1:_.length>0},empty:function(){return _&&(_=[]),this},disable:function(){return G=V=[],_=N="",this},disabled:function(){return!_},lock:function(){return G=V=[],!N&&!M&&(_=N=""),this},locked:function(){return!!G},fireWith:function(Ct,Tt){return G||(Tt=Tt||[],Tt=[Ct,Tt.slice?Tt.slice():Tt],V.push(Tt),M||J()),this},fire:function(){return et.fireWith(this,arguments),this},fired:function(){return!!O}};return et};function Te(m){return m}function Ci(m){throw m}function ja(m,M,N,O){var G;try{m&&S(G=m.promise)?G.call(m).done(M).fail(N):m&&S(G=m.then)?G.call(m,M,N):M.apply(void 0,[m].slice(O))}catch(_){N.apply(void 0,[_])}}p.extend({Deferred:function(m){var M=[["notify","progress",p.Callbacks("memory"),p.Callbacks("memory"),2],["resolve","done",p.Callbacks("once memory"),p.Callbacks("once memory"),0,"resolved"],["reject","fail",p.Callbacks("once memory"),p.Callbacks("once memory"),1,"rejected"]],N="pending",O={state:function(){return N},always:function(){return G.done(arguments).fail(arguments),this},catch:function(_){return O.then(null,_)},pipe:function(){var _=arguments;return p.Deferred(function(V){p.each(M,function(Q,J){var et=S(_[J[4]])&&_[J[4]];G[J[1]](function(){var Ct=et&&et.apply(this,arguments);Ct&&S(Ct.promise)?Ct.promise().progress(V.notify).done(V.resolve).fail(V.reject):V[J[0]+"With"](this,et?[Ct]:arguments)})}),_=null}).promise()},then:function(_,V,Q){var J=0;function et(Ct,Tt,st,pt){return function(){var zt=this,De=arguments,ie=function(){var We,ii;if(!(Ct<J)){if(We=st.apply(zt,De),We===Tt.promise())throw new TypeError("Thenable self-resolution");ii=We&&(typeof We=="object"||typeof We=="function")&&We.then,S(ii)?pt?ii.call(We,et(J,Tt,Te,pt),et(J,Tt,Ci,pt)):(J++,ii.call(We,et(J,Tt,Te,pt),et(J,Tt,Ci,pt),et(J,Tt,Te,Tt.notifyWith))):(st!==Te&&(zt=void 0,De=[We]),(pt||Tt.resolveWith)(zt,De))}},Qe=pt?ie:function(){try{ie()}catch(We){p.Deferred.exceptionHook&&p.Deferred.exceptionHook(We,Qe.error),Ct+1>=J&&(st!==Ci&&(zt=void 0,De=[We]),Tt.rejectWith(zt,De))}};Ct?Qe():(p.Deferred.getErrorHook?Qe.error=p.Deferred.getErrorHook():p.Deferred.getStackHook&&(Qe.error=p.Deferred.getStackHook()),a.setTimeout(Qe))}}return p.Deferred(function(Ct){M[0][3].add(et(0,Ct,S(Q)?Q:Te,Ct.notifyWith)),M[1][3].add(et(0,Ct,S(_)?_:Te)),M[2][3].add(et(0,Ct,S(V)?V:Ci))}).promise()},promise:function(_){return _!=null?p.extend(_,O):O}},G={};return p.each(M,function(_,V){var Q=V[2],J=V[5];O[V[1]]=Q.add,J&&Q.add(function(){N=J},M[3-_][2].disable,M[3-_][3].disable,M[0][2].lock,M[0][3].lock),Q.add(V[3].fire),G[V[0]]=function(){return G[V[0]+"With"](this===G?void 0:this,arguments),this},G[V[0]+"With"]=Q.fireWith}),O.promise(G),m&&m.call(G,G),G},when:function(m){var M=arguments.length,N=M,O=Array(N),G=s.call(arguments),_=p.Deferred(),V=function(Q){return function(J){O[Q]=this,G[Q]=arguments.length>1?s.call(arguments):J,--M||_.resolveWith(O,G)}};if(M<=1&&(ja(m,_.done(V(N)).resolve,_.reject,!M),_.state()==="pending"||S(G[N]&&G[N].then)))return _.then();for(;N--;)ja(G[N],V(N),_.reject);return _.promise()}});var Di=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;p.Deferred.exceptionHook=function(m,M){a.console&&a.console.warn&&m&&Di.test(m.name)&&a.console.warn("jQuery.Deferred exception: "+m.message,m.stack,M)},p.readyException=function(m){a.setTimeout(function(){throw m})};var vi=p.Deferred();p.fn.ready=function(m){return vi.then(m).catch(function(M){p.readyException(M)}),this},p.extend({isReady:!1,readyWait:1,ready:function(m){(m===!0?--p.readyWait:p.isReady)||(p.isReady=!0,!(m!==!0&&--p.readyWait>0)&&vi.resolveWith(g,[p]))}}),p.ready.then=vi.then;function ti(){g.removeEventListener("DOMContentLoaded",ti),a.removeEventListener("load",ti),p.ready()}g.readyState==="complete"||g.readyState!=="loading"&&!g.documentElement.doScroll?a.setTimeout(p.ready):(g.addEventListener("DOMContentLoaded",ti),a.addEventListener("load",ti));var la=function(m,M,N,O,G,_,V){var Q=0,J=m.length,et=N==null;if(R(N)==="object"){G=!0;for(Q in N)la(m,M,Q,N[Q],!0,_,V)}else if(O!==void 0&&(G=!0,S(O)||(V=!0),et&&(V?(M.call(m,O),M=null):(et=M,M=function(Ct,Tt,st){return et.call(p(Ct),st)})),M))for(;Q<J;Q++)M(m[Q],N,V?O:O.call(m[Q],Q,M(m[Q],N)));return G?m:et?M.call(m):J?M(m[0],N):_},Ai=/^-ms-/,Zi=/-([a-z])/g;function Qi(m,M){return M.toUpperCase()}function Ta(m){return m.replace(Ai,"ms-").replace(Zi,Qi)}var Ra=function(m){return m.nodeType===1||m.nodeType===9||!+m.nodeType};function je(){this.expando=p.expando+je.uid++}je.uid=1,je.prototype={cache:function(m){var M=m[this.expando];return M||(M={},Ra(m)&&(m.nodeType?m[this.expando]=M:Object.defineProperty(m,this.expando,{value:M,configurable:!0}))),M},set:function(m,M,N){var O,G=this.cache(m);if(typeof M=="string")G[Ta(M)]=N;else for(O in M)G[Ta(O)]=M[O];return G},get:function(m,M){return M===void 0?this.cache(m):m[this.expando]&&m[this.expando][Ta(M)]},access:function(m,M,N){return M===void 0||M&&typeof M=="string"&&N===void 0?this.get(m,M):(this.set(m,M,N),N!==void 0?N:M)},remove:function(m,M){var N,O=m[this.expando];if(O!==void 0){if(M!==void 0)for(Array.isArray(M)?M=M.map(Ta):(M=Ta(M),M=M in O?[M]:M.match(Oe)||[]),N=M.length;N--;)delete O[M[N]];(M===void 0||p.isEmptyObject(O))&&(m.nodeType?m[this.expando]=void 0:delete m[this.expando])}},hasData:function(m){var M=m[this.expando];return M!==void 0&&!p.isEmptyObject(M)}};var dt=new je,Xe=new je,he=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,_n=/[A-Z]/g;function Tr(m){return m==="true"?!0:m==="false"?!1:m==="null"?null:m===+m+""?+m:he.test(m)?JSON.parse(m):m}function As(m,M,N){var O;if(N===void 0&&m.nodeType===1)if(O="data-"+M.replace(_n,"-$&").toLowerCase(),N=m.getAttribute(O),typeof N=="string"){try{N=Tr(N)}catch{}Xe.set(m,M,N)}else N=void 0;return N}p.extend({hasData:function(m){return Xe.hasData(m)||dt.hasData(m)},data:function(m,M,N){return Xe.access(m,M,N)},removeData:function(m,M){Xe.remove(m,M)},_data:function(m,M,N){return dt.access(m,M,N)},_removeData:function(m,M){dt.remove(m,M)}}),p.fn.extend({data:function(m,M){var N,O,G,_=this[0],V=_&&_.attributes;if(m===void 0){if(this.length&&(G=Xe.get(_),_.nodeType===1&&!dt.get(_,"hasDataAttrs"))){for(N=V.length;N--;)V[N]&&(O=V[N].name,O.indexOf("data-")===0&&(O=Ta(O.slice(5)),As(_,O,G[O])));dt.set(_,"hasDataAttrs",!0)}return G}return typeof m=="object"?this.each(function(){Xe.set(this,m)}):la(this,function(Q){var J;if(_&&Q===void 0)return J=Xe.get(_,m),J!==void 0||(J=As(_,m),J!==void 0)?J:void 0;this.each(function(){Xe.set(this,m,Q)})},null,M,arguments.length>1,null,!0)},removeData:function(m){return this.each(function(){Xe.remove(this,m)})}}),p.extend({queue:function(m,M,N){var O;if(m)return M=(M||"fx")+"queue",O=dt.get(m,M),N&&(!O||Array.isArray(N)?O=dt.access(m,M,p.makeArray(N)):O.push(N)),O||[]},dequeue:function(m,M){M=M||"fx";var N=p.queue(m,M),O=N.length,G=N.shift(),_=p._queueHooks(m,M),V=function(){p.dequeue(m,M)};G==="inprogress"&&(G=N.shift(),O--),G&&(M==="fx"&&N.unshift("inprogress"),delete _.stop,G.call(m,V,_)),!O&&_&&_.empty.fire()},_queueHooks:function(m,M){var N=M+"queueHooks";return dt.get(m,N)||dt.access(m,N,{empty:p.Callbacks("once memory").add(function(){dt.remove(m,[M+"queue",N])})})}}),p.fn.extend({queue:function(m,M){var N=2;return typeof m!="string"&&(M=m,m="fx",N--),arguments.length<N?p.queue(this[0],m):M===void 0?this:this.each(function(){var O=p.queue(this,m,M);p._queueHooks(this,m),m==="fx"&&O[0]!=="inprogress"&&p.dequeue(this,m)})},dequeue:function(m){return this.each(function(){p.dequeue(this,m)})},clearQueue:function(m){return this.queue(m||"fx",[])},promise:function(m,M){var N,O=1,G=p.Deferred(),_=this,V=this.length,Q=function(){--O||G.resolveWith(_,[_])};for(typeof m!="string"&&(M=m,m=void 0),m=m||"fx";V--;)N=dt.get(_[V],m+"queueHooks"),N&&N.empty&&(O++,N.empty.add(Q));return Q(),G.promise(M)}});var ys=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,yi=new RegExp("^(?:([+-])=|)("+ys+")([a-z%]*)$","i"),Xa=["Top","Right","Bottom","Left"],Pa=g.documentElement,ei=function(m){return p.contains(m.ownerDocument,m)},Sr={composed:!0};Pa.getRootNode&&(ei=function(m){return p.contains(m.ownerDocument,m)||m.getRootNode(Sr)===m.ownerDocument});var Oi=function(m,M){return m=M||m,m.style.display==="none"||m.style.display===""&&ei(m)&&p.css(m,"display")==="none"};function $i(m,M,N,O){var G,_,V=20,Q=O?function(){return O.cur()}:function(){return p.css(m,M,"")},J=Q(),et=N&&N[3]||(p.cssNumber[M]?"":"px"),Ct=m.nodeType&&(p.cssNumber[M]||et!=="px"&&+J)&&yi.exec(p.css(m,M));if(Ct&&Ct[3]!==et){for(J=J/2,et=et||Ct[3],Ct=+J||1;V--;)p.style(m,M,Ct+et),(1-_)*(1-(_=Q()/J||.5))<=0&&(V=0),Ct=Ct/_;Ct=Ct*2,p.style(m,M,Ct+et),N=N||[]}return N&&(Ct=+Ct||+J||0,G=N[1]?Ct+(N[1]+1)*N[2]:+N[2],O&&(O.unit=et,O.start=Ct,O.end=G)),G}var dr={};function Hn(m){var M,N=m.ownerDocument,O=m.nodeName,G=dr[O];return G||(M=N.body.appendChild(N.createElement(O)),G=p.css(M,"display"),M.parentNode.removeChild(M),G==="none"&&(G="block"),dr[O]=G,G)}function ai(m,M){for(var N,O,G=[],_=0,V=m.length;_<V;_++)O=m[_],O.style&&(N=O.style.display,M?(N==="none"&&(G[_]=dt.get(O,"display")||null,G[_]||(O.style.display="")),O.style.display===""&&Oi(O)&&(G[_]=Hn(O))):N!=="none"&&(G[_]="none",dt.set(O,"display",N)));for(_=0;_<V;_++)G[_]!=null&&(m[_].style.display=G[_]);return m}p.fn.extend({show:function(){return ai(this,!0)},hide:function(){return ai(this)},toggle:function(m){return typeof m=="boolean"?m?this.show():this.hide():this.each(function(){Oi(this)?p(this).show():p(this).hide()})}});var qi=/^(?:checkbox|radio)$/i,Ir=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Os=/^$|^module$|\/(?:java|ecma)script/i;(function(){var m=g.createDocumentFragment(),M=m.appendChild(g.createElement("div")),N=g.createElement("input");N.setAttribute("type","radio"),N.setAttribute("checked","checked"),N.setAttribute("name","t"),M.appendChild(N),T.checkClone=M.cloneNode(!0).cloneNode(!0).lastChild.checked,M.innerHTML="<textarea>x</textarea>",T.noCloneChecked=!!M.cloneNode(!0).lastChild.defaultValue,M.innerHTML="<option></option>",T.option=!!M.lastChild})();var ke={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ke.tbody=ke.tfoot=ke.colgroup=ke.caption=ke.thead,ke.th=ke.td,T.option||(ke.optgroup=ke.option=[1,"<select multiple='multiple'>","</select>"]);function ta(m,M){var N;return typeof m.getElementsByTagName<"u"?N=m.getElementsByTagName(M||"*"):typeof m.querySelectorAll<"u"?N=m.querySelectorAll(M||"*"):N=[],M===void 0||M&&H(m,M)?p.merge([m],N):N}function ci(m,M){for(var N=0,O=m.length;N<O;N++)dt.set(m[N],"globalEval",!M||dt.get(M[N],"globalEval"))}var Vn=/<|&#?\w+;/;function Pi(m,M,N,O,G){for(var _,V,Q,J,et,Ct,Tt=M.createDocumentFragment(),st=[],pt=0,zt=m.length;pt<zt;pt++)if(_=m[pt],_||_===0)if(R(_)==="object")p.merge(st,_.nodeType?[_]:_);else if(!Vn.test(_))st.push(M.createTextNode(_));else{for(V=V||Tt.appendChild(M.createElement("div")),Q=(Ir.exec(_)||["",""])[1].toLowerCase(),J=ke[Q]||ke._default,V.innerHTML=J[1]+p.htmlPrefilter(_)+J[2],Ct=J[0];Ct--;)V=V.lastChild;p.merge(st,V.childNodes),V=Tt.firstChild,V.textContent=""}for(Tt.textContent="",pt=0;_=st[pt++];){if(O&&p.inArray(_,O)>-1){G&&G.push(_);continue}if(et=ei(_),V=ta(Tt.appendChild(_),"script"),et&&ci(V),N)for(Ct=0;_=V[Ct++];)Os.test(_.type||"")&&N.push(_)}return Tt}var ji=/^([^.]*)(?:\.(.+)|)/;function Ke(){return!0}function Bi(){return!1}function ua(m,M,N,O,G,_){var V,Q;if(typeof M=="object"){typeof N!="string"&&(O=O||N,N=void 0);for(Q in M)ua(m,Q,N,O,M[Q],_);return m}if(O==null&&G==null?(G=N,O=N=void 0):G==null&&(typeof N=="string"?(G=O,O=void 0):(G=O,O=N,N=void 0)),G===!1)G=Bi;else if(!G)return m;return _===1&&(V=G,G=function(J){return p().off(J),V.apply(this,arguments)},G.guid=V.guid||(V.guid=p.guid++)),m.each(function(){p.event.add(this,M,G,O,N)})}p.event={global:{},add:function(m,M,N,O,G){var _,V,Q,J,et,Ct,Tt,st,pt,zt,De,ie=dt.get(m);if(Ra(m))for(N.handler&&(_=N,N=_.handler,G=_.selector),G&&p.find.matchesSelector(Pa,G),N.guid||(N.guid=p.guid++),(J=ie.events)||(J=ie.events=Object.create(null)),(V=ie.handle)||(V=ie.handle=function(Qe){return typeof p<"u"&&p.event.triggered!==Qe.type?p.event.dispatch.apply(m,arguments):void 0}),M=(M||"").match(Oe)||[""],et=M.length;et--;)Q=ji.exec(M[et])||[],pt=De=Q[1],zt=(Q[2]||"").split(".").sort(),pt&&(Tt=p.event.special[pt]||{},pt=(G?Tt.delegateType:Tt.bindType)||pt,Tt=p.event.special[pt]||{},Ct=p.extend({type:pt,origType:De,data:O,handler:N,guid:N.guid,selector:G,needsContext:G&&p.expr.match.needsContext.test(G),namespace:zt.join(".")},_),(st=J[pt])||(st=J[pt]=[],st.delegateCount=0,(!Tt.setup||Tt.setup.call(m,O,zt,V)===!1)&&m.addEventListener&&m.addEventListener(pt,V)),Tt.add&&(Tt.add.call(m,Ct),Ct.handler.guid||(Ct.handler.guid=N.guid)),G?st.splice(st.delegateCount++,0,Ct):st.push(Ct),p.event.global[pt]=!0)},remove:function(m,M,N,O,G){var _,V,Q,J,et,Ct,Tt,st,pt,zt,De,ie=dt.hasData(m)&&dt.get(m);if(!(!ie||!(J=ie.events))){for(M=(M||"").match(Oe)||[""],et=M.length;et--;){if(Q=ji.exec(M[et])||[],pt=De=Q[1],zt=(Q[2]||"").split(".").sort(),!pt){for(pt in J)p.event.remove(m,pt+M[et],N,O,!0);continue}for(Tt=p.event.special[pt]||{},pt=(O?Tt.delegateType:Tt.bindType)||pt,st=J[pt]||[],Q=Q[2]&&new RegExp("(^|\\.)"+zt.join("\\.(?:.*\\.|)")+"(\\.|$)"),V=_=st.length;_--;)Ct=st[_],(G||De===Ct.origType)&&(!N||N.guid===Ct.guid)&&(!Q||Q.test(Ct.namespace))&&(!O||O===Ct.selector||O==="**"&&Ct.selector)&&(st.splice(_,1),Ct.selector&&st.delegateCount--,Tt.remove&&Tt.remove.call(m,Ct));V&&!st.length&&((!Tt.teardown||Tt.teardown.call(m,zt,ie.handle)===!1)&&p.removeEvent(m,pt,ie.handle),delete J[pt])}p.isEmptyObject(J)&&dt.remove(m,"handle events")}},dispatch:function(m){var M,N,O,G,_,V,Q=new Array(arguments.length),J=p.event.fix(m),et=(dt.get(this,"events")||Object.create(null))[J.type]||[],Ct=p.event.special[J.type]||{};for(Q[0]=J,M=1;M<arguments.length;M++)Q[M]=arguments[M];if(J.delegateTarget=this,!(Ct.preDispatch&&Ct.preDispatch.call(this,J)===!1)){for(V=p.event.handlers.call(this,J,et),M=0;(G=V[M++])&&!J.isPropagationStopped();)for(J.currentTarget=G.elem,N=0;(_=G.handlers[N++])&&!J.isImmediatePropagationStopped();)(!J.rnamespace||_.namespace===!1||J.rnamespace.test(_.namespace))&&(J.handleObj=_,J.data=_.data,O=((p.event.special[_.origType]||{}).handle||_.handler).apply(G.elem,Q),O!==void 0&&(J.result=O)===!1&&(J.preventDefault(),J.stopPropagation()));return Ct.postDispatch&&Ct.postDispatch.call(this,J),J.result}},handlers:function(m,M){var N,O,G,_,V,Q=[],J=M.delegateCount,et=m.target;if(J&&et.nodeType&&!(m.type==="click"&&m.button>=1)){for(;et!==this;et=et.parentNode||this)if(et.nodeType===1&&!(m.type==="click"&&et.disabled===!0)){for(_=[],V={},N=0;N<J;N++)O=M[N],G=O.selector+" ",V[G]===void 0&&(V[G]=O.needsContext?p(G,this).index(et)>-1:p.find(G,this,null,[et]).length),V[G]&&_.push(O);_.length&&Q.push({elem:et,handlers:_})}}return et=this,J<M.length&&Q.push({elem:et,handlers:M.slice(J)}),Q},addProp:function(m,M){Object.defineProperty(p.Event.prototype,m,{enumerable:!0,configurable:!0,get:S(M)?function(){if(this.originalEvent)return M(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[m]},set:function(N){Object.defineProperty(this,m,{enumerable:!0,configurable:!0,writable:!0,value:N})}})},fix:function(m){return m[p.expando]?m:new p.Event(m)},special:{load:{noBubble:!0},click:{setup:function(m){var M=this||m;return qi.test(M.type)&&M.click&&H(M,"input")&&Ps(M,"click",!0),!1},trigger:function(m){var M=this||m;return qi.test(M.type)&&M.click&&H(M,"input")&&Ps(M,"click"),!0},_default:function(m){var M=m.target;return qi.test(M.type)&&M.click&&H(M,"input")&&dt.get(M,"click")||H(M,"a")}},beforeunload:{postDispatch:function(m){m.result!==void 0&&m.originalEvent&&(m.originalEvent.returnValue=m.result)}}}};function Ps(m,M,N){if(!N){dt.get(m,M)===void 0&&p.event.add(m,M,Ke);return}dt.set(m,M,!1),p.event.add(m,M,{namespace:!1,handler:function(O){var G,_=dt.get(this,M);if(O.isTrigger&1&&this[M]){if(_)(p.event.special[M]||{}).delegateType&&O.stopPropagation();else if(_=s.call(arguments),dt.set(this,M,_),this[M](),G=dt.get(this,M),dt.set(this,M,!1),_!==G)return O.stopImmediatePropagation(),O.preventDefault(),G}else _&&(dt.set(this,M,p.event.trigger(_[0],_.slice(1),this)),O.stopPropagation(),O.isImmediatePropagationStopped=Ke)}})}p.removeEvent=function(m,M,N){m.removeEventListener&&m.removeEventListener(M,N)},p.Event=function(m,M){if(!(this instanceof p.Event))return new p.Event(m,M);m&&m.type?(this.originalEvent=m,this.type=m.type,this.isDefaultPrevented=m.defaultPrevented||m.defaultPrevented===void 0&&m.returnValue===!1?Ke:Bi,this.target=m.target&&m.target.nodeType===3?m.target.parentNode:m.target,this.currentTarget=m.currentTarget,this.relatedTarget=m.relatedTarget):this.type=m,M&&p.extend(this,M),this.timeStamp=m&&m.timeStamp||Date.now(),this[p.expando]=!0},p.Event.prototype={constructor:p.Event,isDefaultPrevented:Bi,isPropagationStopped:Bi,isImmediatePropagationStopped:Bi,isSimulated:!1,preventDefault:function(){var m=this.originalEvent;this.isDefaultPrevented=Ke,m&&!this.isSimulated&&m.preventDefault()},stopPropagation:function(){var m=this.originalEvent;this.isPropagationStopped=Ke,m&&!this.isSimulated&&m.stopPropagation()},stopImmediatePropagation:function(){var m=this.originalEvent;this.isImmediatePropagationStopped=Ke,m&&!this.isSimulated&&m.stopImmediatePropagation(),this.stopPropagation()}},p.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},p.event.addProp),p.each({focus:"focusin",blur:"focusout"},function(m,M){function N(O){if(g.documentMode){var G=dt.get(this,"handle"),_=p.event.fix(O);_.type=O.type==="focusin"?"focus":"blur",_.isSimulated=!0,G(O),_.target===_.currentTarget&&G(_)}else p.event.simulate(M,O.target,p.event.fix(O))}p.event.special[m]={setup:function(){var O;if(Ps(this,m,!0),g.documentMode)O=dt.get(this,M),O||this.addEventListener(M,N),dt.set(this,M,(O||0)+1);else return!1},trigger:function(){return Ps(this,m),!0},teardown:function(){var O;if(g.documentMode)O=dt.get(this,M)-1,O?dt.set(this,M,O):(this.removeEventListener(M,N),dt.remove(this,M));else return!1},_default:function(O){return dt.get(O.target,m)},delegateType:M},p.event.special[M]={setup:function(){var O=this.ownerDocument||this.document||this,G=g.documentMode?this:O,_=dt.get(G,M);_||(g.documentMode?this.addEventListener(M,N):O.addEventListener(m,N,!0)),dt.set(G,M,(_||0)+1)},teardown:function(){var O=this.ownerDocument||this.document||this,G=g.documentMode?this:O,_=dt.get(G,M)-1;_?dt.set(G,M,_):(g.documentMode?this.removeEventListener(M,N):O.removeEventListener(m,N,!0),dt.remove(G,M))}}}),p.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(m,M){p.event.special[m]={delegateType:M,bindType:M,handle:function(N){var O,G=this,_=N.relatedTarget,V=N.handleObj;return(!_||_!==G&&!p.contains(G,_))&&(N.type=V.origType,O=V.handler.apply(this,arguments),N.type=M),O}}}),p.fn.extend({on:function(m,M,N,O){return ua(this,m,M,N,O)},one:function(m,M,N,O){return ua(this,m,M,N,O,1)},off:function(m,M,N){var O,G;if(m&&m.preventDefault&&m.handleObj)return O=m.handleObj,p(m.delegateTarget).off(O.namespace?O.origType+"."+O.namespace:O.origType,O.selector,O.handler),this;if(typeof m=="object"){for(G in m)this.off(G,M,m[G]);return this}return(M===!1||typeof M=="function")&&(N=M,M=void 0),N===!1&&(N=Bi),this.each(function(){p.event.remove(this,m,N,M)})}});var AD=/<script|<style|<link/i,yD=/checked\s*(?:[^=]|=\s*.checked.)/i,OD=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function El(m,M){return H(m,"table")&&H(M.nodeType!==11?M:M.firstChild,"tr")&&p(m).children("tbody")[0]||m}function PD(m){return m.type=(m.getAttribute("type")!==null)+"/"+m.type,m}function BD(m){return(m.type||"").slice(0,5)==="true/"?m.type=m.type.slice(5):m.removeAttribute("type"),m}function xl(m,M){var N,O,G,_,V,Q,J;if(M.nodeType===1){if(dt.hasData(m)&&(_=dt.get(m),J=_.events,J)){dt.remove(M,"handle events");for(G in J)for(N=0,O=J[G].length;N<O;N++)p.event.add(M,G,J[G][N])}Xe.hasData(m)&&(V=Xe.access(m),Q=p.extend({},V),Xe.set(M,Q))}}function bD(m,M){var N=M.nodeName.toLowerCase();N==="input"&&qi.test(m.type)?M.checked=m.checked:(N==="input"||N==="textarea")&&(M.defaultValue=m.defaultValue)}function mr(m,M,N,O){M=o(M);var G,_,V,Q,J,et,Ct=0,Tt=m.length,st=Tt-1,pt=M[0],zt=S(pt);if(zt||Tt>1&&typeof pt=="string"&&!T.checkClone&&yD.test(pt))return m.each(function(De){var ie=m.eq(De);zt&&(M[0]=pt.call(this,De,ie.html())),mr(ie,M,N,O)});if(Tt&&(G=Pi(M,m[0].ownerDocument,!1,m,O),_=G.firstChild,G.childNodes.length===1&&(G=_),_||O)){for(V=p.map(ta(G,"script"),PD),Q=V.length;Ct<Tt;Ct++)J=G,Ct!==st&&(J=p.clone(J,!0,!0),Q&&p.merge(V,ta(J,"script"))),N.call(m[Ct],J,Ct);if(Q)for(et=V[V.length-1].ownerDocument,p.map(V,BD),Ct=0;Ct<Q;Ct++)J=V[Ct],Os.test(J.type||"")&&!dt.access(J,"globalEval")&&p.contains(et,J)&&(J.src&&(J.type||"").toLowerCase()!=="module"?p._evalUrl&&!J.noModule&&p._evalUrl(J.src,{nonce:J.nonce||J.getAttribute("nonce")},et):F(J.textContent.replace(OD,""),J,et))}return m}function Fl(m,M,N){for(var O,G=M?p.filter(M,m):m,_=0;(O=G[_])!=null;_++)!N&&O.nodeType===1&&p.cleanData(ta(O)),O.parentNode&&(N&&ei(O)&&ci(ta(O,"script")),O.parentNode.removeChild(O));return m}p.extend({htmlPrefilter:function(m){return m},clone:function(m,M,N){var O,G,_,V,Q=m.cloneNode(!0),J=ei(m);if(!T.noCloneChecked&&(m.nodeType===1||m.nodeType===11)&&!p.isXMLDoc(m))for(V=ta(Q),_=ta(m),O=0,G=_.length;O<G;O++)bD(_[O],V[O]);if(M)if(N)for(_=_||ta(m),V=V||ta(Q),O=0,G=_.length;O<G;O++)xl(_[O],V[O]);else xl(m,Q);return V=ta(Q,"script"),V.length>0&&ci(V,!J&&ta(m,"script")),Q},cleanData:function(m){for(var M,N,O,G=p.event.special,_=0;(N=m[_])!==void 0;_++)if(Ra(N)){if(M=N[dt.expando]){if(M.events)for(O in M.events)G[O]?p.event.remove(N,O):p.removeEvent(N,O,M.handle);N[dt.expando]=void 0}N[Xe.expando]&&(N[Xe.expando]=void 0)}}}),p.fn.extend({detach:function(m){return Fl(this,m,!0)},remove:function(m){return Fl(this,m)},text:function(m){return la(this,function(M){return M===void 0?p.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=M)})},null,m,arguments.length)},append:function(){return mr(this,arguments,function(m){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var M=El(this,m);M.appendChild(m)}})},prepend:function(){return mr(this,arguments,function(m){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var M=El(this,m);M.insertBefore(m,M.firstChild)}})},before:function(){return mr(this,arguments,function(m){this.parentNode&&this.parentNode.insertBefore(m,this)})},after:function(){return mr(this,arguments,function(m){this.parentNode&&this.parentNode.insertBefore(m,this.nextSibling)})},empty:function(){for(var m,M=0;(m=this[M])!=null;M++)m.nodeType===1&&(p.cleanData(ta(m,!1)),m.textContent="");return this},clone:function(m,M){return m=m??!1,M=M??m,this.map(function(){return p.clone(this,m,M)})},html:function(m){return la(this,function(M){var N=this[0]||{},O=0,G=this.length;if(M===void 0&&N.nodeType===1)return N.innerHTML;if(typeof M=="string"&&!AD.test(M)&&!ke[(Ir.exec(M)||["",""])[1].toLowerCase()]){M=p.htmlPrefilter(M);try{for(;O<G;O++)N=this[O]||{},N.nodeType===1&&(p.cleanData(ta(N,!1)),N.innerHTML=M);N=0}catch{}}N&&this.empty().append(M)},null,m,arguments.length)},replaceWith:function(){var m=[];return mr(this,arguments,function(M){var N=this.parentNode;p.inArray(this,m)<0&&(p.cleanData(ta(this)),N&&N.replaceChild(M,this))},m)}}),p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(m,M){p.fn[m]=function(N){for(var O,G=[],_=p(N),V=_.length-1,Q=0;Q<=V;Q++)O=Q===V?this:this.clone(!0),p(_[Q])[M](O),l.apply(G,O.get());return this.pushStack(G)}});var Yn=new RegExp("^("+ys+")(?!px)[a-z%]+$","i"),Xn=/^--/,Bs=function(m){var M=m.ownerDocument.defaultView;return(!M||!M.opener)&&(M=a),M.getComputedStyle(m)},Ml=function(m,M,N){var O,G,_={};for(G in M)_[G]=m.style[G],m.style[G]=M[G];O=N.call(m);for(G in M)m.style[G]=_[G];return O},wD=new RegExp(Xa.join("|"),"i");(function(){function m(){if(et){J.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",et.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Pa.appendChild(J).appendChild(et);var Ct=a.getComputedStyle(et);N=Ct.top!=="1%",Q=M(Ct.marginLeft)===12,et.style.right="60%",_=M(Ct.right)===36,O=M(Ct.width)===36,et.style.position="absolute",G=M(et.offsetWidth/3)===12,Pa.removeChild(J),et=null}}function M(Ct){return Math.round(parseFloat(Ct))}var N,O,G,_,V,Q,J=g.createElement("div"),et=g.createElement("div");et.style&&(et.style.backgroundClip="content-box",et.cloneNode(!0).style.backgroundClip="",T.clearCloneStyle=et.style.backgroundClip==="content-box",p.extend(T,{boxSizingReliable:function(){return m(),O},pixelBoxStyles:function(){return m(),_},pixelPosition:function(){return m(),N},reliableMarginLeft:function(){return m(),Q},scrollboxSize:function(){return m(),G},reliableTrDimensions:function(){var Ct,Tt,st,pt;return V==null&&(Ct=g.createElement("table"),Tt=g.createElement("tr"),st=g.createElement("div"),Ct.style.cssText="position:absolute;left:-11111px;border-collapse:separate",Tt.style.cssText="box-sizing:content-box;border:1px solid",Tt.style.height="1px",st.style.height="9px",st.style.display="block",Pa.appendChild(Ct).appendChild(Tt).appendChild(st),pt=a.getComputedStyle(Tt),V=parseInt(pt.height,10)+parseInt(pt.borderTopWidth,10)+parseInt(pt.borderBottomWidth,10)===Tt.offsetHeight,Pa.removeChild(Ct)),V}}))})();function Ur(m,M,N){var O,G,_,V,Q=Xn.test(M),J=m.style;return N=N||Bs(m),N&&(V=N.getPropertyValue(M)||N[M],Q&&V&&(V=V.replace(vt,"$1")||void 0),V===""&&!ei(m)&&(V=p.style(m,M)),!T.pixelBoxStyles()&&Yn.test(V)&&wD.test(M)&&(O=J.width,G=J.minWidth,_=J.maxWidth,J.minWidth=J.maxWidth=J.width=V,V=N.width,J.width=O,J.minWidth=G,J.maxWidth=_)),V!==void 0?V+"":V}function Ll(m,M){return{get:function(){if(m()){delete this.get;return}return(this.get=M).apply(this,arguments)}}}var Rl=["Webkit","Moz","ms"],Nl=g.createElement("div").style,Al={};function GD(m){for(var M=m[0].toUpperCase()+m.slice(1),N=Rl.length;N--;)if(m=Rl[N]+M,m in Nl)return m}function kn(m){var M=p.cssProps[m]||Al[m];return M||(m in Nl?m:Al[m]=GD(m)||m)}var _D=/^(none|table(?!-c[ea]).+)/,HD={position:"absolute",visibility:"hidden",display:"block"},yl={letterSpacing:"0",fontWeight:"400"};function Ol(m,M,N){var O=yi.exec(M);return O?Math.max(0,O[2]-(N||0))+(O[3]||"px"):M}function Wn(m,M,N,O,G,_){var V=M==="width"?1:0,Q=0,J=0,et=0;if(N===(O?"border":"content"))return 0;for(;V<4;V+=2)N==="margin"&&(et+=p.css(m,N+Xa[V],!0,G)),O?(N==="content"&&(J-=p.css(m,"padding"+Xa[V],!0,G)),N!=="margin"&&(J-=p.css(m,"border"+Xa[V]+"Width",!0,G))):(J+=p.css(m,"padding"+Xa[V],!0,G),N!=="padding"?J+=p.css(m,"border"+Xa[V]+"Width",!0,G):Q+=p.css(m,"border"+Xa[V]+"Width",!0,G));return!O&&_>=0&&(J+=Math.max(0,Math.ceil(m["offset"+M[0].toUpperCase()+M.slice(1)]-_-J-Q-.5))||0),J+et}function Pl(m,M,N){var O=Bs(m),G=!T.boxSizingReliable()||N,_=G&&p.css(m,"boxSizing",!1,O)==="border-box",V=_,Q=Ur(m,M,O),J="offset"+M[0].toUpperCase()+M.slice(1);if(Yn.test(Q)){if(!N)return Q;Q="auto"}return(!T.boxSizingReliable()&&_||!T.reliableTrDimensions()&&H(m,"tr")||Q==="auto"||!parseFloat(Q)&&p.css(m,"display",!1,O)==="inline")&&m.getClientRects().length&&(_=p.css(m,"boxSizing",!1,O)==="border-box",V=J in m,V&&(Q=m[J])),Q=parseFloat(Q)||0,Q+Wn(m,M,N||(_?"border":"content"),V,O,Q)+"px"}p.extend({cssHooks:{opacity:{get:function(m,M){if(M){var N=Ur(m,"opacity");return N===""?"1":N}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(m,M,N,O){if(!(!m||m.nodeType===3||m.nodeType===8||!m.style)){var G,_,V,Q=Ta(M),J=Xn.test(M),et=m.style;if(J||(M=kn(Q)),V=p.cssHooks[M]||p.cssHooks[Q],N!==void 0){if(_=typeof N,_==="string"&&(G=yi.exec(N))&&G[1]&&(N=$i(m,M,G),_="number"),N==null||N!==N)return;_==="number"&&!J&&(N+=G&&G[3]||(p.cssNumber[Q]?"":"px")),!T.clearCloneStyle&&N===""&&M.indexOf("background")===0&&(et[M]="inherit"),(!V||!("set"in V)||(N=V.set(m,N,O))!==void 0)&&(J?et.setProperty(M,N):et[M]=N)}else return V&&"get"in V&&(G=V.get(m,!1,O))!==void 0?G:et[M]}},css:function(m,M,N,O){var G,_,V,Q=Ta(M),J=Xn.test(M);return J||(M=kn(Q)),V=p.cssHooks[M]||p.cssHooks[Q],V&&"get"in V&&(G=V.get(m,!0,N)),G===void 0&&(G=Ur(m,M,O)),G==="normal"&&M in yl&&(G=yl[M]),N===""||N?(_=parseFloat(G),N===!0||isFinite(_)?_||0:G):G}}),p.each(["height","width"],function(m,M){p.cssHooks[M]={get:function(N,O,G){if(O)return _D.test(p.css(N,"display"))&&(!N.getClientRects().length||!N.getBoundingClientRect().width)?Ml(N,HD,function(){return Pl(N,M,G)}):Pl(N,M,G)},set:function(N,O,G){var _,V=Bs(N),Q=!T.scrollboxSize()&&V.position==="absolute",J=Q||G,et=J&&p.css(N,"boxSizing",!1,V)==="border-box",Ct=G?Wn(N,M,G,et,V):0;return et&&Q&&(Ct-=Math.ceil(N["offset"+M[0].toUpperCase()+M.slice(1)]-parseFloat(V[M])-Wn(N,M,"border",!1,V)-.5)),Ct&&(_=yi.exec(O))&&(_[3]||"px")!=="px"&&(N.style[M]=O,O=p.css(N,M)),Ol(N,O,Ct)}}}),p.cssHooks.marginLeft=Ll(T.reliableMarginLeft,function(m,M){if(M)return(parseFloat(Ur(m,"marginLeft"))||m.getBoundingClientRect().left-Ml(m,{marginLeft:0},function(){return m.getBoundingClientRect().left}))+"px"}),p.each({margin:"",padding:"",border:"Width"},function(m,M){p.cssHooks[m+M]={expand:function(N){for(var O=0,G={},_=typeof N=="string"?N.split(" "):[N];O<4;O++)G[m+Xa[O]+M]=_[O]||_[O-2]||_[0];return G}},m!=="margin"&&(p.cssHooks[m+M].set=Ol)}),p.fn.extend({css:function(m,M){return la(this,function(N,O,G){var _,V,Q={},J=0;if(Array.isArray(O)){for(_=Bs(N),V=O.length;J<V;J++)Q[O[J]]=p.css(N,O[J],!1,_);return Q}return G!==void 0?p.style(N,O,G):p.css(N,O)},m,M,arguments.length>1)}});function Sa(m,M,N,O,G){return new Sa.prototype.init(m,M,N,O,G)}p.Tween=Sa,Sa.prototype={constructor:Sa,init:function(m,M,N,O,G,_){this.elem=m,this.prop=N,this.easing=G||p.easing._default,this.options=M,this.start=this.now=this.cur(),this.end=O,this.unit=_||(p.cssNumber[N]?"":"px")},cur:function(){var m=Sa.propHooks[this.prop];return m&&m.get?m.get(this):Sa.propHooks._default.get(this)},run:function(m){var M,N=Sa.propHooks[this.prop];return this.options.duration?this.pos=M=p.easing[this.easing](m,this.options.duration*m,0,1,this.options.duration):this.pos=M=m,this.now=(this.end-this.start)*M+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),N&&N.set?N.set(this):Sa.propHooks._default.set(this),this}},Sa.prototype.init.prototype=Sa.prototype,Sa.propHooks={_default:{get:function(m){var M;return m.elem.nodeType!==1||m.elem[m.prop]!=null&&m.elem.style[m.prop]==null?m.elem[m.prop]:(M=p.css(m.elem,m.prop,""),!M||M==="auto"?0:M)},set:function(m){p.fx.step[m.prop]?p.fx.step[m.prop](m):m.elem.nodeType===1&&(p.cssHooks[m.prop]||m.elem.style[kn(m.prop)]!=null)?p.style(m.elem,m.prop,m.now+m.unit):m.elem[m.prop]=m.now}}},Sa.propHooks.scrollTop=Sa.propHooks.scrollLeft={set:function(m){m.elem.nodeType&&m.elem.parentNode&&(m.elem[m.prop]=m.now)}},p.easing={linear:function(m){return m},swing:function(m){return .5-Math.cos(m*Math.PI)/2},_default:"swing"},p.fx=Sa.prototype.init,p.fx.step={};var gr,bs,VD=/^(?:toggle|show|hide)$/,YD=/queueHooks$/;function Un(){bs&&(g.hidden===!1&&a.requestAnimationFrame?a.requestAnimationFrame(Un):a.setTimeout(Un,p.fx.interval),p.fx.tick())}function Bl(){return a.setTimeout(function(){gr=void 0}),gr=Date.now()}function ws(m,M){var N,O=0,G={height:m};for(M=M?1:0;O<4;O+=2-M)N=Xa[O],G["margin"+N]=G["padding"+N]=m;return M&&(G.opacity=G.width=m),G}function bl(m,M,N){for(var O,G=(ka.tweeners[M]||[]).concat(ka.tweeners["*"]),_=0,V=G.length;_<V;_++)if(O=G[_].call(N,M,m))return O}function XD(m,M,N){var O,G,_,V,Q,J,et,Ct,Tt="width"in M||"height"in M,st=this,pt={},zt=m.style,De=m.nodeType&&Oi(m),ie=dt.get(m,"fxshow");N.queue||(V=p._queueHooks(m,"fx"),V.unqueued==null&&(V.unqueued=0,Q=V.empty.fire,V.empty.fire=function(){V.unqueued||Q()}),V.unqueued++,st.always(function(){st.always(function(){V.unqueued--,p.queue(m,"fx").length||V.empty.fire()})}));for(O in M)if(G=M[O],VD.test(G)){if(delete M[O],_=_||G==="toggle",G===(De?"hide":"show"))if(G==="show"&&ie&&ie[O]!==void 0)De=!0;else continue;pt[O]=ie&&ie[O]||p.style(m,O)}if(J=!p.isEmptyObject(M),!(!J&&p.isEmptyObject(pt))){Tt&&m.nodeType===1&&(N.overflow=[zt.overflow,zt.overflowX,zt.overflowY],et=ie&&ie.display,et==null&&(et=dt.get(m,"display")),Ct=p.css(m,"display"),Ct==="none"&&(et?Ct=et:(ai([m],!0),et=m.style.display||et,Ct=p.css(m,"display"),ai([m]))),(Ct==="inline"||Ct==="inline-block"&&et!=null)&&p.css(m,"float")==="none"&&(J||(st.done(function(){zt.display=et}),et==null&&(Ct=zt.display,et=Ct==="none"?"":Ct)),zt.display="inline-block")),N.overflow&&(zt.overflow="hidden",st.always(function(){zt.overflow=N.overflow[0],zt.overflowX=N.overflow[1],zt.overflowY=N.overflow[2]})),J=!1;for(O in pt)J||(ie?"hidden"in ie&&(De=ie.hidden):ie=dt.access(m,"fxshow",{display:et}),_&&(ie.hidden=!De),De&&ai([m],!0),st.done(function(){De||ai([m]),dt.remove(m,"fxshow");for(O in pt)p.style(m,O,pt[O])})),J=bl(De?ie[O]:0,O,st),O in ie||(ie[O]=J.start,De&&(J.end=J.start,J.start=0))}}function kD(m,M){var N,O,G,_,V;for(N in m)if(O=Ta(N),G=M[O],_=m[N],Array.isArray(_)&&(G=_[1],_=m[N]=_[0]),N!==O&&(m[O]=_,delete m[N]),V=p.cssHooks[O],V&&"expand"in V){_=V.expand(_),delete m[O];for(N in _)N in m||(m[N]=_[N],M[N]=G)}else M[O]=G}function ka(m,M,N){var O,G,_=0,V=ka.prefilters.length,Q=p.Deferred().always(function(){delete J.elem}),J=function(){if(G)return!1;for(var Tt=gr||Bl(),st=Math.max(0,et.startTime+et.duration-Tt),pt=st/et.duration||0,zt=1-pt,De=0,ie=et.tweens.length;De<ie;De++)et.tweens[De].run(zt);return Q.notifyWith(m,[et,zt,st]),zt<1&&ie?st:(ie||Q.notifyWith(m,[et,1,0]),Q.resolveWith(m,[et]),!1)},et=Q.promise({elem:m,props:p.extend({},M),opts:p.extend(!0,{specialEasing:{},easing:p.easing._default},N),originalProperties:M,originalOptions:N,startTime:gr||Bl(),duration:N.duration,tweens:[],createTween:function(Tt,st){var pt=p.Tween(m,et.opts,Tt,st,et.opts.specialEasing[Tt]||et.opts.easing);return et.tweens.push(pt),pt},stop:function(Tt){var st=0,pt=Tt?et.tweens.length:0;if(G)return this;for(G=!0;st<pt;st++)et.tweens[st].run(1);return Tt?(Q.notifyWith(m,[et,1,0]),Q.resolveWith(m,[et,Tt])):Q.rejectWith(m,[et,Tt]),this}}),Ct=et.props;for(kD(Ct,et.opts.specialEasing);_<V;_++)if(O=ka.prefilters[_].call(et,m,Ct,et.opts),O)return S(O.stop)&&(p._queueHooks(et.elem,et.opts.queue).stop=O.stop.bind(O)),O;return p.map(Ct,bl,et),S(et.opts.start)&&et.opts.start.call(m,et),et.progress(et.opts.progress).done(et.opts.done,et.opts.complete).fail(et.opts.fail).always(et.opts.always),p.fx.timer(p.extend(J,{elem:m,anim:et,queue:et.opts.queue})),et}p.Animation=p.extend(ka,{tweeners:{"*":[function(m,M){var N=this.createTween(m,M);return $i(N.elem,m,yi.exec(M),N),N}]},tweener:function(m,M){S(m)?(M=m,m=["*"]):m=m.match(Oe);for(var N,O=0,G=m.length;O<G;O++)N=m[O],ka.tweeners[N]=ka.tweeners[N]||[],ka.tweeners[N].unshift(M)},prefilters:[XD],prefilter:function(m,M){M?ka.prefilters.unshift(m):ka.prefilters.push(m)}}),p.speed=function(m,M,N){var O=m&&typeof m=="object"?p.extend({},m):{complete:N||!N&&M||S(m)&&m,duration:m,easing:N&&M||M&&!S(M)&&M};return p.fx.off?O.duration=0:typeof O.duration!="number"&&(O.duration in p.fx.speeds?O.duration=p.fx.speeds[O.duration]:O.duration=p.fx.speeds._default),(O.queue==null||O.queue===!0)&&(O.queue="fx"),O.old=O.complete,O.complete=function(){S(O.old)&&O.old.call(this),O.queue&&p.dequeue(this,O.queue)},O},p.fn.extend({fadeTo:function(m,M,N,O){return this.filter(Oi).css("opacity",0).show().end().animate({opacity:M},m,N,O)},animate:function(m,M,N,O){var G=p.isEmptyObject(m),_=p.speed(M,N,O),V=function(){var Q=ka(this,p.extend({},m),_);(G||dt.get(this,"finish"))&&Q.stop(!0)};return V.finish=V,G||_.queue===!1?this.each(V):this.queue(_.queue,V)},stop:function(m,M,N){var O=function(G){var _=G.stop;delete G.stop,_(N)};return typeof m!="string"&&(N=M,M=m,m=void 0),M&&this.queue(m||"fx",[]),this.each(function(){var G=!0,_=m!=null&&m+"queueHooks",V=p.timers,Q=dt.get(this);if(_)Q[_]&&Q[_].stop&&O(Q[_]);else for(_ in Q)Q[_]&&Q[_].stop&&YD.test(_)&&O(Q[_]);for(_=V.length;_--;)V[_].elem===this&&(m==null||V[_].queue===m)&&(V[_].anim.stop(N),G=!1,V.splice(_,1));(G||!N)&&p.dequeue(this,m)})},finish:function(m){return m!==!1&&(m=m||"fx"),this.each(function(){var M,N=dt.get(this),O=N[m+"queue"],G=N[m+"queueHooks"],_=p.timers,V=O?O.length:0;for(N.finish=!0,p.queue(this,m,[]),G&&G.stop&&G.stop.call(this,!0),M=_.length;M--;)_[M].elem===this&&_[M].queue===m&&(_[M].anim.stop(!0),_.splice(M,1));for(M=0;M<V;M++)O[M]&&O[M].finish&&O[M].finish.call(this);delete N.finish})}}),p.each(["toggle","show","hide"],function(m,M){var N=p.fn[M];p.fn[M]=function(O,G,_){return O==null||typeof O=="boolean"?N.apply(this,arguments):this.animate(ws(M,!0),O,G,_)}}),p.each({slideDown:ws("show"),slideUp:ws("hide"),slideToggle:ws("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(m,M){p.fn[m]=function(N,O,G){return this.animate(M,N,O,G)}}),p.timers=[],p.fx.tick=function(){var m,M=0,N=p.timers;for(gr=Date.now();M<N.length;M++)m=N[M],!m()&&N[M]===m&&N.splice(M--,1);N.length||p.fx.stop(),gr=void 0},p.fx.timer=function(m){p.timers.push(m),p.fx.start()},p.fx.interval=13,p.fx.start=function(){bs||(bs=!0,Un())},p.fx.stop=function(){bs=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fn.delay=function(m,M){return m=p.fx&&p.fx.speeds[m]||m,M=M||"fx",this.queue(M,function(N,O){var G=a.setTimeout(N,m);O.stop=function(){a.clearTimeout(G)}})},function(){var m=g.createElement("input"),M=g.createElement("select"),N=M.appendChild(g.createElement("option"));m.type="checkbox",T.checkOn=m.value!=="",T.optSelected=N.selected,m=g.createElement("input"),m.value="t",m.type="radio",T.radioValue=m.value==="t"}();var wl,Kr=p.expr.attrHandle;p.fn.extend({attr:function(m,M){return la(this,p.attr,m,M,arguments.length>1)},removeAttr:function(m){return this.each(function(){p.removeAttr(this,m)})}}),p.extend({attr:function(m,M,N){var O,G,_=m.nodeType;if(!(_===3||_===8||_===2)){if(typeof m.getAttribute>"u")return p.prop(m,M,N);if((_!==1||!p.isXMLDoc(m))&&(G=p.attrHooks[M.toLowerCase()]||(p.expr.match.bool.test(M)?wl:void 0)),N!==void 0){if(N===null){p.removeAttr(m,M);return}return G&&"set"in G&&(O=G.set(m,N,M))!==void 0?O:(m.setAttribute(M,N+""),N)}return G&&"get"in G&&(O=G.get(m,M))!==null?O:(O=p.find.attr(m,M),O??void 0)}},attrHooks:{type:{set:function(m,M){if(!T.radioValue&&M==="radio"&&H(m,"input")){var N=m.value;return m.setAttribute("type",M),N&&(m.value=N),M}}}},removeAttr:function(m,M){var N,O=0,G=M&&M.match(Oe);if(G&&m.nodeType===1)for(;N=G[O++];)m.removeAttribute(N)}}),wl={set:function(m,M,N){return M===!1?p.removeAttr(m,N):m.setAttribute(N,N),N}},p.each(p.expr.match.bool.source.match(/\w+/g),function(m,M){var N=Kr[M]||p.find.attr;Kr[M]=function(O,G,_){var V,Q,J=G.toLowerCase();return _||(Q=Kr[J],Kr[J]=V,V=N(O,G,_)!=null?J:null,Kr[J]=Q),V}});var WD=/^(?:input|select|textarea|button)$/i,UD=/^(?:a|area)$/i;p.fn.extend({prop:function(m,M){return la(this,p.prop,m,M,arguments.length>1)},removeProp:function(m){return this.each(function(){delete this[p.propFix[m]||m]})}}),p.extend({prop:function(m,M,N){var O,G,_=m.nodeType;if(!(_===3||_===8||_===2))return(_!==1||!p.isXMLDoc(m))&&(M=p.propFix[M]||M,G=p.propHooks[M]),N!==void 0?G&&"set"in G&&(O=G.set(m,N,M))!==void 0?O:m[M]=N:G&&"get"in G&&(O=G.get(m,M))!==null?O:m[M]},propHooks:{tabIndex:{get:function(m){var M=p.find.attr(m,"tabindex");return M?parseInt(M,10):WD.test(m.nodeName)||UD.test(m.nodeName)&&m.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),T.optSelected||(p.propHooks.selected={get:function(m){var M=m.parentNode;return M&&M.parentNode&&M.parentNode.selectedIndex,null},set:function(m){var M=m.parentNode;M&&(M.selectedIndex,M.parentNode&&M.parentNode.selectedIndex)}}),p.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){p.propFix[this.toLowerCase()]=this});function tr(m){var M=m.match(Oe)||[];return M.join(" ")}function er(m){return m.getAttribute&&m.getAttribute("class")||""}function Kn(m){return Array.isArray(m)?m:typeof m=="string"?m.match(Oe)||[]:[]}p.fn.extend({addClass:function(m){var M,N,O,G,_,V;return S(m)?this.each(function(Q){p(this).addClass(m.call(this,Q,er(this)))}):(M=Kn(m),M.length?this.each(function(){if(O=er(this),N=this.nodeType===1&&" "+tr(O)+" ",N){for(_=0;_<M.length;_++)G=M[_],N.indexOf(" "+G+" ")<0&&(N+=G+" ");V=tr(N),O!==V&&this.setAttribute("class",V)}}):this)},removeClass:function(m){var M,N,O,G,_,V;return S(m)?this.each(function(Q){p(this).removeClass(m.call(this,Q,er(this)))}):arguments.length?(M=Kn(m),M.length?this.each(function(){if(O=er(this),N=this.nodeType===1&&" "+tr(O)+" ",N){for(_=0;_<M.length;_++)for(G=M[_];N.indexOf(" "+G+" ")>-1;)N=N.replace(" "+G+" "," ");V=tr(N),O!==V&&this.setAttribute("class",V)}}):this):this.attr("class","")},toggleClass:function(m,M){var N,O,G,_,V=typeof m,Q=V==="string"||Array.isArray(m);return S(m)?this.each(function(J){p(this).toggleClass(m.call(this,J,er(this),M),M)}):typeof M=="boolean"&&Q?M?this.addClass(m):this.removeClass(m):(N=Kn(m),this.each(function(){if(Q)for(_=p(this),G=0;G<N.length;G++)O=N[G],_.hasClass(O)?_.removeClass(O):_.addClass(O);else(m===void 0||V==="boolean")&&(O=er(this),O&&dt.set(this,"__className__",O),this.setAttribute&&this.setAttribute("class",O||m===!1?"":dt.get(this,"__className__")||""))}))},hasClass:function(m){var M,N,O=0;for(M=" "+m+" ";N=this[O++];)if(N.nodeType===1&&(" "+tr(er(N))+" ").indexOf(M)>-1)return!0;return!1}});var KD=/\r/g;p.fn.extend({val:function(m){var M,N,O,G=this[0];return arguments.length?(O=S(m),this.each(function(_){var V;this.nodeType===1&&(O?V=m.call(this,_,p(this).val()):V=m,V==null?V="":typeof V=="number"?V+="":Array.isArray(V)&&(V=p.map(V,function(Q){return Q==null?"":Q+""})),M=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()],(!M||!("set"in M)||M.set(this,V,"value")===void 0)&&(this.value=V))})):G?(M=p.valHooks[G.type]||p.valHooks[G.nodeName.toLowerCase()],M&&"get"in M&&(N=M.get(G,"value"))!==void 0?N:(N=G.value,typeof N=="string"?N.replace(KD,""):N??"")):void 0}}),p.extend({valHooks:{option:{get:function(m){var M=p.find.attr(m,"value");return M??tr(p.text(m))}},select:{get:function(m){var M,N,O,G=m.options,_=m.selectedIndex,V=m.type==="select-one",Q=V?null:[],J=V?_+1:G.length;for(_<0?O=J:O=V?_:0;O<J;O++)if(N=G[O],(N.selected||O===_)&&!N.disabled&&(!N.parentNode.disabled||!H(N.parentNode,"optgroup"))){if(M=p(N).val(),V)return M;Q.push(M)}return Q},set:function(m,M){for(var N,O,G=m.options,_=p.makeArray(M),V=G.length;V--;)O=G[V],(O.selected=p.inArray(p.valHooks.option.get(O),_)>-1)&&(N=!0);return N||(m.selectedIndex=-1),_}}}}),p.each(["radio","checkbox"],function(){p.valHooks[this]={set:function(m,M){if(Array.isArray(M))return m.checked=p.inArray(p(m).val(),M)>-1}},T.checkOn||(p.valHooks[this].get=function(m){return m.getAttribute("value")===null?"on":m.value})});var zr=a.location,Gl={guid:Date.now()},zn=/\?/;p.parseXML=function(m){var M,N;if(!m||typeof m!="string")return null;try{M=new a.DOMParser().parseFromString(m,"text/xml")}catch{}return N=M&&M.getElementsByTagName("parsererror")[0],(!M||N)&&p.error("Invalid XML: "+(N?p.map(N.childNodes,function(O){return O.textContent}).join(`
`):m)),M};var _l=/^(?:focusinfocus|focusoutblur)$/,Hl=function(m){m.stopPropagation()};p.extend(p.event,{trigger:function(m,M,N,O){var G,_,V,Q,J,et,Ct,Tt,st=[N||g],pt=C.call(m,"type")?m.type:m,zt=C.call(m,"namespace")?m.namespace.split("."):[];if(_=Tt=V=N=N||g,!(N.nodeType===3||N.nodeType===8)&&!_l.test(pt+p.event.triggered)&&(pt.indexOf(".")>-1&&(zt=pt.split("."),pt=zt.shift(),zt.sort()),J=pt.indexOf(":")<0&&"on"+pt,m=m[p.expando]?m:new p.Event(pt,typeof m=="object"&&m),m.isTrigger=O?2:3,m.namespace=zt.join("."),m.rnamespace=m.namespace?new RegExp("(^|\\.)"+zt.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,m.result=void 0,m.target||(m.target=N),M=M==null?[m]:p.makeArray(M,[m]),Ct=p.event.special[pt]||{},!(!O&&Ct.trigger&&Ct.trigger.apply(N,M)===!1))){if(!O&&!Ct.noBubble&&!I(N)){for(Q=Ct.delegateType||pt,_l.test(Q+pt)||(_=_.parentNode);_;_=_.parentNode)st.push(_),V=_;V===(N.ownerDocument||g)&&st.push(V.defaultView||V.parentWindow||a)}for(G=0;(_=st[G++])&&!m.isPropagationStopped();)Tt=_,m.type=G>1?Q:Ct.bindType||pt,et=(dt.get(_,"events")||Object.create(null))[m.type]&&dt.get(_,"handle"),et&&et.apply(_,M),et=J&&_[J],et&&et.apply&&Ra(_)&&(m.result=et.apply(_,M),m.result===!1&&m.preventDefault());return m.type=pt,!O&&!m.isDefaultPrevented()&&(!Ct._default||Ct._default.apply(st.pop(),M)===!1)&&Ra(N)&&J&&S(N[pt])&&!I(N)&&(V=N[J],V&&(N[J]=null),p.event.triggered=pt,m.isPropagationStopped()&&Tt.addEventListener(pt,Hl),N[pt](),m.isPropagationStopped()&&Tt.removeEventListener(pt,Hl),p.event.triggered=void 0,V&&(N[J]=V)),m.result}},simulate:function(m,M,N){var O=p.extend(new p.Event,N,{type:m,isSimulated:!0});p.event.trigger(O,null,M)}}),p.fn.extend({trigger:function(m,M){return this.each(function(){p.event.trigger(m,M,this)})},triggerHandler:function(m,M){var N=this[0];if(N)return p.event.trigger(m,M,N,!0)}});var zD=/\[\]$/,Vl=/\r?\n/g,JD=/^(?:submit|button|image|reset|file)$/i,ZD=/^(?:input|select|textarea|keygen)/i;function Jn(m,M,N,O){var G;if(Array.isArray(M))p.each(M,function(_,V){N||zD.test(m)?O(m,V):Jn(m+"["+(typeof V=="object"&&V!=null?_:"")+"]",V,N,O)});else if(!N&&R(M)==="object")for(G in M)Jn(m+"["+G+"]",M[G],N,O);else O(m,M)}p.param=function(m,M){var N,O=[],G=function(_,V){var Q=S(V)?V():V;O[O.length]=encodeURIComponent(_)+"="+encodeURIComponent(Q??"")};if(m==null)return"";if(Array.isArray(m)||m.jquery&&!p.isPlainObject(m))p.each(m,function(){G(this.name,this.value)});else for(N in m)Jn(N,m[N],M,G);return O.join("&")},p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var m=p.prop(this,"elements");return m?p.makeArray(m):this}).filter(function(){var m=this.type;return this.name&&!p(this).is(":disabled")&&ZD.test(this.nodeName)&&!JD.test(m)&&(this.checked||!qi.test(m))}).map(function(m,M){var N=p(this).val();return N==null?null:Array.isArray(N)?p.map(N,function(O){return{name:M.name,value:O.replace(Vl,`\r
`)}}):{name:M.name,value:N.replace(Vl,`\r
`)}}).get()}});var QD=/%20/g,$D=/#.*$/,qD=/([?&])_=[^&]*/,jD=/^(.*?):[ \t]*([^\r\n]*)$/mg,tv=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ev=/^(?:GET|HEAD)$/,av=/^\/\//,Yl={},Zn={},Xl="*/".concat("*"),Qn=g.createElement("a");Qn.href=zr.href;function kl(m){return function(M,N){typeof M!="string"&&(N=M,M="*");var O,G=0,_=M.toLowerCase().match(Oe)||[];if(S(N))for(;O=_[G++];)O[0]==="+"?(O=O.slice(1)||"*",(m[O]=m[O]||[]).unshift(N)):(m[O]=m[O]||[]).push(N)}}function Wl(m,M,N,O){var G={},_=m===Zn;function V(Q){var J;return G[Q]=!0,p.each(m[Q]||[],function(et,Ct){var Tt=Ct(M,N,O);if(typeof Tt=="string"&&!_&&!G[Tt])return M.dataTypes.unshift(Tt),V(Tt),!1;if(_)return!(J=Tt)}),J}return V(M.dataTypes[0])||!G["*"]&&V("*")}function $n(m,M){var N,O,G=p.ajaxSettings.flatOptions||{};for(N in M)M[N]!==void 0&&((G[N]?m:O||(O={}))[N]=M[N]);return O&&p.extend(!0,m,O),m}function iv(m,M,N){for(var O,G,_,V,Q=m.contents,J=m.dataTypes;J[0]==="*";)J.shift(),O===void 0&&(O=m.mimeType||M.getResponseHeader("Content-Type"));if(O){for(G in Q)if(Q[G]&&Q[G].test(O)){J.unshift(G);break}}if(J[0]in N)_=J[0];else{for(G in N){if(!J[0]||m.converters[G+" "+J[0]]){_=G;break}V||(V=G)}_=_||V}if(_)return _!==J[0]&&J.unshift(_),N[_]}function rv(m,M,N,O){var G,_,V,Q,J,et={},Ct=m.dataTypes.slice();if(Ct[1])for(V in m.converters)et[V.toLowerCase()]=m.converters[V];for(_=Ct.shift();_;)if(m.responseFields[_]&&(N[m.responseFields[_]]=M),!J&&O&&m.dataFilter&&(M=m.dataFilter(M,m.dataType)),J=_,_=Ct.shift(),_){if(_==="*")_=J;else if(J!=="*"&&J!==_){if(V=et[J+" "+_]||et["* "+_],!V){for(G in et)if(Q=G.split(" "),Q[1]===_&&(V=et[J+" "+Q[0]]||et["* "+Q[0]],V)){V===!0?V=et[G]:et[G]!==!0&&(_=Q[0],Ct.unshift(Q[1]));break}}if(V!==!0)if(V&&m.throws)M=V(M);else try{M=V(M)}catch(Tt){return{state:"parsererror",error:V?Tt:"No conversion from "+J+" to "+_}}}}return{state:"success",data:M}}p.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:zr.href,type:"GET",isLocal:tv.test(zr.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Xl,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":p.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(m,M){return M?$n($n(m,p.ajaxSettings),M):$n(p.ajaxSettings,m)},ajaxPrefilter:kl(Yl),ajaxTransport:kl(Zn),ajax:function(m,M){typeof m=="object"&&(M=m,m=void 0),M=M||{};var N,O,G,_,V,Q,J,et,Ct,Tt,st=p.ajaxSetup({},M),pt=st.context||st,zt=st.context&&(pt.nodeType||pt.jquery)?p(pt):p.event,De=p.Deferred(),ie=p.Callbacks("once memory"),Qe=st.statusCode||{},We={},ii={},ri="canceled",le={readyState:0,getResponseHeader:function(Se){var Ge;if(J){if(!_)for(_={};Ge=jD.exec(G);)_[Ge[1].toLowerCase()+" "]=(_[Ge[1].toLowerCase()+" "]||[]).concat(Ge[2]);Ge=_[Se.toLowerCase()+" "]}return Ge==null?null:Ge.join(", ")},getAllResponseHeaders:function(){return J?G:null},setRequestHeader:function(Se,Ge){return J==null&&(Se=ii[Se.toLowerCase()]=ii[Se.toLowerCase()]||Se,We[Se]=Ge),this},overrideMimeType:function(Se){return J==null&&(st.mimeType=Se),this},statusCode:function(Se){var Ge;if(Se)if(J)le.always(Se[le.status]);else for(Ge in Se)Qe[Ge]=[Qe[Ge],Se[Ge]];return this},abort:function(Se){var Ge=Se||ri;return N&&N.abort(Ge),ar(0,Ge),this}};if(De.promise(le),st.url=((m||st.url||zr.href)+"").replace(av,zr.protocol+"//"),st.type=M.method||M.type||st.method||st.type,st.dataTypes=(st.dataType||"*").toLowerCase().match(Oe)||[""],st.crossDomain==null){Q=g.createElement("a");try{Q.href=st.url,Q.href=Q.href,st.crossDomain=Qn.protocol+"//"+Qn.host!=Q.protocol+"//"+Q.host}catch{st.crossDomain=!0}}if(st.data&&st.processData&&typeof st.data!="string"&&(st.data=p.param(st.data,st.traditional)),Wl(Yl,st,M,le),J)return le;et=p.event&&st.global,et&&p.active++===0&&p.event.trigger("ajaxStart"),st.type=st.type.toUpperCase(),st.hasContent=!ev.test(st.type),O=st.url.replace($D,""),st.hasContent?st.data&&st.processData&&(st.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(st.data=st.data.replace(QD,"+")):(Tt=st.url.slice(O.length),st.data&&(st.processData||typeof st.data=="string")&&(O+=(zn.test(O)?"&":"?")+st.data,delete st.data),st.cache===!1&&(O=O.replace(qD,"$1"),Tt=(zn.test(O)?"&":"?")+"_="+Gl.guid+++Tt),st.url=O+Tt),st.ifModified&&(p.lastModified[O]&&le.setRequestHeader("If-Modified-Since",p.lastModified[O]),p.etag[O]&&le.setRequestHeader("If-None-Match",p.etag[O])),(st.data&&st.hasContent&&st.contentType!==!1||M.contentType)&&le.setRequestHeader("Content-Type",st.contentType),le.setRequestHeader("Accept",st.dataTypes[0]&&st.accepts[st.dataTypes[0]]?st.accepts[st.dataTypes[0]]+(st.dataTypes[0]!=="*"?", "+Xl+"; q=0.01":""):st.accepts["*"]);for(Ct in st.headers)le.setRequestHeader(Ct,st.headers[Ct]);if(st.beforeSend&&(st.beforeSend.call(pt,le,st)===!1||J))return le.abort();if(ri="abort",ie.add(st.complete),le.done(st.success),le.fail(st.error),N=Wl(Zn,st,M,le),!N)ar(-1,"No Transport");else{if(le.readyState=1,et&&zt.trigger("ajaxSend",[le,st]),J)return le;st.async&&st.timeout>0&&(V=a.setTimeout(function(){le.abort("timeout")},st.timeout));try{J=!1,N.send(We,ar)}catch(Se){if(J)throw Se;ar(-1,Se)}}function ar(Se,Ge,Zr,jn){var si,Qr,ni,bi,wi,Ba=Ge;J||(J=!0,V&&a.clearTimeout(V),N=void 0,G=jn||"",le.readyState=Se>0?4:0,si=Se>=200&&Se<300||Se===304,Zr&&(bi=iv(st,le,Zr)),!si&&p.inArray("script",st.dataTypes)>-1&&p.inArray("json",st.dataTypes)<0&&(st.converters["text script"]=function(){}),bi=rv(st,bi,le,si),si?(st.ifModified&&(wi=le.getResponseHeader("Last-Modified"),wi&&(p.lastModified[O]=wi),wi=le.getResponseHeader("etag"),wi&&(p.etag[O]=wi)),Se===204||st.type==="HEAD"?Ba="nocontent":Se===304?Ba="notmodified":(Ba=bi.state,Qr=bi.data,ni=bi.error,si=!ni)):(ni=Ba,(Se||!Ba)&&(Ba="error",Se<0&&(Se=0))),le.status=Se,le.statusText=(Ge||Ba)+"",si?De.resolveWith(pt,[Qr,Ba,le]):De.rejectWith(pt,[le,Ba,ni]),le.statusCode(Qe),Qe=void 0,et&&zt.trigger(si?"ajaxSuccess":"ajaxError",[le,st,si?Qr:ni]),ie.fireWith(pt,[le,Ba]),et&&(zt.trigger("ajaxComplete",[le,st]),--p.active||p.event.trigger("ajaxStop")))}return le},getJSON:function(m,M,N){return p.get(m,M,N,"json")},getScript:function(m,M){return p.get(m,void 0,M,"script")}}),p.each(["get","post"],function(m,M){p[M]=function(N,O,G,_){return S(O)&&(_=_||G,G=O,O=void 0),p.ajax(p.extend({url:N,type:M,dataType:_,data:O,success:G},p.isPlainObject(N)&&N))}}),p.ajaxPrefilter(function(m){var M;for(M in m.headers)M.toLowerCase()==="content-type"&&(m.contentType=m.headers[M]||"")}),p._evalUrl=function(m,M,N){return p.ajax({url:m,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(O){p.globalEval(O,M,N)}})},p.fn.extend({wrapAll:function(m){var M;return this[0]&&(S(m)&&(m=m.call(this[0])),M=p(m,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&M.insertBefore(this[0]),M.map(function(){for(var N=this;N.firstElementChild;)N=N.firstElementChild;return N}).append(this)),this},wrapInner:function(m){return S(m)?this.each(function(M){p(this).wrapInner(m.call(this,M))}):this.each(function(){var M=p(this),N=M.contents();N.length?N.wrapAll(m):M.append(m)})},wrap:function(m){var M=S(m);return this.each(function(N){p(this).wrapAll(M?m.call(this,N):m)})},unwrap:function(m){return this.parent(m).not("body").each(function(){p(this).replaceWith(this.childNodes)}),this}}),p.expr.pseudos.hidden=function(m){return!p.expr.pseudos.visible(m)},p.expr.pseudos.visible=function(m){return!!(m.offsetWidth||m.offsetHeight||m.getClientRects().length)},p.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch{}};var sv={0:200,1223:204},Jr=p.ajaxSettings.xhr();T.cors=!!Jr&&"withCredentials"in Jr,T.ajax=Jr=!!Jr,p.ajaxTransport(function(m){var M,N;if(T.cors||Jr&&!m.crossDomain)return{send:function(O,G){var _,V=m.xhr();if(V.open(m.type,m.url,m.async,m.username,m.password),m.xhrFields)for(_ in m.xhrFields)V[_]=m.xhrFields[_];m.mimeType&&V.overrideMimeType&&V.overrideMimeType(m.mimeType),!m.crossDomain&&!O["X-Requested-With"]&&(O["X-Requested-With"]="XMLHttpRequest");for(_ in O)V.setRequestHeader(_,O[_]);M=function(Q){return function(){M&&(M=N=V.onload=V.onerror=V.onabort=V.ontimeout=V.onreadystatechange=null,Q==="abort"?V.abort():Q==="error"?typeof V.status!="number"?G(0,"error"):G(V.status,V.statusText):G(sv[V.status]||V.status,V.statusText,(V.responseType||"text")!=="text"||typeof V.responseText!="string"?{binary:V.response}:{text:V.responseText},V.getAllResponseHeaders()))}},V.onload=M(),N=V.onerror=V.ontimeout=M("error"),V.onabort!==void 0?V.onabort=N:V.onreadystatechange=function(){V.readyState===4&&a.setTimeout(function(){M&&N()})},M=M("abort");try{V.send(m.hasContent&&m.data||null)}catch(Q){if(M)throw Q}},abort:function(){M&&M()}}}),p.ajaxPrefilter(function(m){m.crossDomain&&(m.contents.script=!1)}),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(m){return p.globalEval(m),m}}}),p.ajaxPrefilter("script",function(m){m.cache===void 0&&(m.cache=!1),m.crossDomain&&(m.type="GET")}),p.ajaxTransport("script",function(m){if(m.crossDomain||m.scriptAttrs){var M,N;return{send:function(O,G){M=p("<script>").attr(m.scriptAttrs||{}).prop({charset:m.scriptCharset,src:m.url}).on("load error",N=function(_){M.remove(),N=null,_&&G(_.type==="error"?404:200,_.type)}),g.head.appendChild(M[0])},abort:function(){N&&N()}}}});var Ul=[],qn=/(=)\?(?=&|$)|\?\?/;p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var m=Ul.pop()||p.expando+"_"+Gl.guid++;return this[m]=!0,m}}),p.ajaxPrefilter("json jsonp",function(m,M,N){var O,G,_,V=m.jsonp!==!1&&(qn.test(m.url)?"url":typeof m.data=="string"&&(m.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&qn.test(m.data)&&"data");if(V||m.dataTypes[0]==="jsonp")return O=m.jsonpCallback=S(m.jsonpCallback)?m.jsonpCallback():m.jsonpCallback,V?m[V]=m[V].replace(qn,"$1"+O):m.jsonp!==!1&&(m.url+=(zn.test(m.url)?"&":"?")+m.jsonp+"="+O),m.converters["script json"]=function(){return _||p.error(O+" was not called"),_[0]},m.dataTypes[0]="json",G=a[O],a[O]=function(){_=arguments},N.always(function(){G===void 0?p(a).removeProp(O):a[O]=G,m[O]&&(m.jsonpCallback=M.jsonpCallback,Ul.push(O)),_&&S(G)&&G(_[0]),_=G=void 0}),"script"}),T.createHTMLDocument=function(){var m=g.implementation.createHTMLDocument("").body;return m.innerHTML="<form></form><form></form>",m.childNodes.length===2}(),p.parseHTML=function(m,M,N){if(typeof m!="string")return[];typeof M=="boolean"&&(N=M,M=!1);var O,G,_;return M||(T.createHTMLDocument?(M=g.implementation.createHTMLDocument(""),O=M.createElement("base"),O.href=g.location.href,M.head.appendChild(O)):M=g),G=Oa.exec(m),_=!N&&[],G?[M.createElement(G[1])]:(G=Pi([m],M,_),_&&_.length&&p(_).remove(),p.merge([],G.childNodes))},p.fn.load=function(m,M,N){var O,G,_,V=this,Q=m.indexOf(" ");return Q>-1&&(O=tr(m.slice(Q)),m=m.slice(0,Q)),S(M)?(N=M,M=void 0):M&&typeof M=="object"&&(G="POST"),V.length>0&&p.ajax({url:m,type:G||"GET",dataType:"html",data:M}).done(function(J){_=arguments,V.html(O?p("<div>").append(p.parseHTML(J)).find(O):J)}).always(N&&function(J,et){V.each(function(){N.apply(this,_||[J.responseText,et,J])})}),this},p.expr.pseudos.animated=function(m){return p.grep(p.timers,function(M){return m===M.elem}).length},p.offset={setOffset:function(m,M,N){var O,G,_,V,Q,J,et,Ct=p.css(m,"position"),Tt=p(m),st={};Ct==="static"&&(m.style.position="relative"),Q=Tt.offset(),_=p.css(m,"top"),J=p.css(m,"left"),et=(Ct==="absolute"||Ct==="fixed")&&(_+J).indexOf("auto")>-1,et?(O=Tt.position(),V=O.top,G=O.left):(V=parseFloat(_)||0,G=parseFloat(J)||0),S(M)&&(M=M.call(m,N,p.extend({},Q))),M.top!=null&&(st.top=M.top-Q.top+V),M.left!=null&&(st.left=M.left-Q.left+G),"using"in M?M.using.call(m,st):Tt.css(st)}},p.fn.extend({offset:function(m){if(arguments.length)return m===void 0?this:this.each(function(G){p.offset.setOffset(this,m,G)});var M,N,O=this[0];if(O)return O.getClientRects().length?(M=O.getBoundingClientRect(),N=O.ownerDocument.defaultView,{top:M.top+N.pageYOffset,left:M.left+N.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var m,M,N,O=this[0],G={top:0,left:0};if(p.css(O,"position")==="fixed")M=O.getBoundingClientRect();else{for(M=this.offset(),N=O.ownerDocument,m=O.offsetParent||N.documentElement;m&&(m===N.body||m===N.documentElement)&&p.css(m,"position")==="static";)m=m.parentNode;m&&m!==O&&m.nodeType===1&&(G=p(m).offset(),G.top+=p.css(m,"borderTopWidth",!0),G.left+=p.css(m,"borderLeftWidth",!0))}return{top:M.top-G.top-p.css(O,"marginTop",!0),left:M.left-G.left-p.css(O,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var m=this.offsetParent;m&&p.css(m,"position")==="static";)m=m.offsetParent;return m||Pa})}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(m,M){var N=M==="pageYOffset";p.fn[m]=function(O){return la(this,function(G,_,V){var Q;if(I(G)?Q=G:G.nodeType===9&&(Q=G.defaultView),V===void 0)return Q?Q[M]:G[_];Q?Q.scrollTo(N?Q.pageXOffset:V,N?V:Q.pageYOffset):G[_]=V},m,O,arguments.length)}}),p.each(["top","left"],function(m,M){p.cssHooks[M]=Ll(T.pixelPosition,function(N,O){if(O)return O=Ur(N,M),Yn.test(O)?p(N).position()[M]+"px":O})}),p.each({Height:"height",Width:"width"},function(m,M){p.each({padding:"inner"+m,content:M,"":"outer"+m},function(N,O){p.fn[O]=function(G,_){var V=arguments.length&&(N||typeof G!="boolean"),Q=N||(G===!0||_===!0?"margin":"border");return la(this,function(J,et,Ct){var Tt;return I(J)?O.indexOf("outer")===0?J["inner"+m]:J.document.documentElement["client"+m]:J.nodeType===9?(Tt=J.documentElement,Math.max(J.body["scroll"+m],Tt["scroll"+m],J.body["offset"+m],Tt["offset"+m],Tt["client"+m])):Ct===void 0?p.css(J,et,Q):p.style(J,et,Ct,Q)},M,V?G:void 0,V)}})}),p.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(m,M){p.fn[M]=function(N){return this.on(M,N)}}),p.fn.extend({bind:function(m,M,N){return this.on(m,null,M,N)},unbind:function(m,M){return this.off(m,null,M)},delegate:function(m,M,N,O){return this.on(M,m,N,O)},undelegate:function(m,M,N){return arguments.length===1?this.off(m,"**"):this.off(M,m||"**",N)},hover:function(m,M){return this.on("mouseenter",m).on("mouseleave",M||m)}}),p.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(m,M){p.fn[M]=function(N,O){return arguments.length>0?this.on(M,null,N,O):this.trigger(M)}});var nv=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;p.proxy=function(m,M){var N,O,G;if(typeof M=="string"&&(N=m[M],M=m,m=N),!!S(m))return O=s.call(arguments,2),G=function(){return m.apply(M||this,O.concat(s.call(arguments)))},G.guid=m.guid=m.guid||p.guid++,G},p.holdReady=function(m){m?p.readyWait++:p.ready(!0)},p.isArray=Array.isArray,p.parseJSON=JSON.parse,p.nodeName=H,p.isFunction=S,p.isWindow=I,p.camelCase=Ta,p.type=R,p.now=Date.now,p.isNumeric=function(m){var M=p.type(m);return(M==="number"||M==="string")&&!isNaN(m-parseFloat(m))},p.trim=function(m){return m==null?"":(m+"").replace(nv,"$1")};var ov=a.jQuery,hv=a.$;return p.noConflict=function(m){return a.$===p&&(a.$=hv),m&&a.jQuery===p&&(a.jQuery=ov),p},typeof r>"u"&&(a.jQuery=a.$=p),p})})(FC);var MC=FC.exports;Object.defineProperty(Sh,"__esModule",{value:!0});var ad=Mc,LC=Ma(ad),id=Mh,rd=Ma(id),sd=l0;Ma(sd);var nd=f0,od=Ma(nd),hd=v0,ld=Ma(hd),ud=S0,vf=Ma(ud),fd=_f,qs=Ma(fd),Cd=Bh,or=Ma(Cd),Dd=EC,Fe=Ma(Dd),vd=On,ae=Ma(vd),cd=QS,Aa=Ma(cd),Td=xC,ye=Ma(Td),Sd=Uh,Dt=Ma(Sd),se,dd=MC,yt=Ma(dd);function Ma(e){return e&&e.__esModule?e:{default:e}}var k={Chart:{Log:console.log,Warn:console.warn},Complier:{Log:console.log,Warn:console.warn},JSTable:{Log:console.log,Warn:console.warn}};function Vt(){}Vt.HttpRequest=function(e){yt.default.ajax({url:e.url,data:e.data,type:e.type,dataType:e.dataType,async:e.async,success:e.success,error:e.error})};var Ce={MINUTE_ID:101,MULTIDAY_MINUTE_ID:102,HISTORY_MINUTE_ID:103,KLINE_DAY_ID:0,KLINE_WEEK_ID:1,KLINE_TWOWEEK_ID:21,KLINE_MONTH_ID:2,KLINE_QUARTER_ID:9,KLINE_YEAR_ID:3,KLINE_MINUTE_ID:4,KLINE_5_MINUTE_ID:5,KLINE_15_MINUTE_ID:6,KLINE_30_MINUTE_ID:7,KLINE_60_MINUTE_ID:8};function Id(){this.DataMap=new Dt.default,this.Get=function(e){return this.DataMap.has(e)?this.DataMap.get(e):null},this.Add=function(e){this.DataMap.set(e.ID,e)}}var RC=new Id;function Z(){this.DataMap=new Dt.default([["MA",this.MA],["均线",this.MA],["MA4",this.MA4],["MA5",this.MA5],["MA6",this.MA6],["MA7",this.MA7],["MA8",this.MA8],["BOLL",this.BOLL],["BOLL副图",this.BOLL2],["BBI",this.BBI],["DKX",this.DKX],["MIKE",this.MIKE],["PBX",this.PBX],["ENE",this.ENE],["MACD",this.MACD],["KDJ",this.KDJ],["MACD2",this.MACD2],["VOL",this.VOL],["VOL2",this.VOL2],["VOL_OVERLAY",this.VOL_OVERLAY],["RSI",this.RSI],["BRAR",this.BRAR],["WR",this.WR],["BIAS",this.BIAS],["OBV",this.OBV],["DMI",this.DMI],["CR",this.CR],["PSY",this.PSY],["CCI",this.CCI],["DMA",this.DMA],["TRIX",this.TRIX],["VR",this.VR],["EMV",this.EMV],["ROC",this.ROC],["MTM",this.MTM],["FSL",this.FSL],["CYR",this.CYR],["MASS",this.MASS],["WAD",this.WAD],["CHO",this.CHO],["ADTM",this.ADTM],["HSL",this.HSL],["BIAS36",this.BIAS36],["BIAS_QL",this.BIAS_QL],["DPO",this.DPO],["OSC",this.OSC],["ATR",this.ATR],["NVI",this.NVI],["PVI",this.PVI],["UOS",this.UOS],["CYW",this.CYW],["LON",this.LON],["NDB",this.NDB],["SKDJ",this.SKDJ],["KD",this.KD],["FKX",this.FKX],["DKCOL",this.DKCOL],["UDL",this.UDL],["MFI",this.MFI],["LWR",this.LWR],["MARSI",this.MARSI],["CYD",this.CYD],["CYF",this.CYF],["TAPI",this.TAPI],["VMACD",this.VMACD],["QACD",this.QACD],["VPT",this.VPT],["WVAD",this.WVAD],["DBQR",this.DBQR],["JS",this.JS],["CYE",this.CYE],["QR",this.QR],["GDX",this.GDX],["JLHB",this.JLHB],["PCNT",this.PCNT],["BTX",this.BTX],["AMO",this.AMO],["VRSI",this.VRSI],["HSCOL",this.HSCOL],["DBQRV",this.DBQRV],["DBLB",this.DBLB],["ACD",this.ACD],["EXPMA",this.EXPMA],["EXPMA_S",this.EXPMA_S],["HMA",this.HMA],["LMA",this.LMA],["VMA",this.VMA],["AMV",this.AMV],["BBIBOLL",this.BBIBOLL],["ALLIGAT",this.ALLIGAT],["ZX",this.ZX],["XS",this.XS],["XS2",this.XS2],["SG-XDT",this.SG_XDT],["SG-SMX",this.SG_SMX],["SG-LB",this.SG_LB],["SG-PF",this.SG_PF],["RAD",this.RAD],["SHT",this.SHT],["ZLJC",this.ZLJC],["ZLMM",this.ZLMM],["SLZT",this.SLZT],["ADVOL",this.ADVOL],["CYC",this.CYC],["CYS",this.CYS],["CYQKL",this.CYQKL],["SCR",this.SCR],["ASR",this.ASR],["SAR",this.SAR],["TJCJL",this.TJCJL],["量比",this.VOLRate],["平均K线",this.HeikinAshi],["ADL",this.ADL],["SQJZ",this.SQJZ],["XT",this.XT],["CFJT",this.CFJT],["CYX",this.CYX],["WAVE",this.WAVE],["VOL-TDX",this.VOL_TDX],["EMPTY",this.EMPTY],["神奇九转",this.NineTurns],["EMA",this.EMA3],["EMA4",this.EMA4],["EMA5",this.EMA5],["EMA6",this.EMA6],["ICHIMOKU",this.ICHIMOKU],["CDP-STD",this.CDP_STD],["TBP-STD",this.TBP_STD],["ADX",this.ADX],["持仓量",this.VOL_POSITION],["散户线",this.ShareholderCount],["NXTS",this.NXTS],["FKX",this.FKX],["两融资金",this.Margin4],["ZSDB",this.ZSDB],["CJL2",this.CJL],["ASI",this.ASI],["DC",this.DC],["DEMA",this.DEMA],["VWAP",this.VWAP],["ZNZ_CBAND",this.ZNZ_CBAND],["ZNZ_RPY2",this.ZNZ_RPY2],["ZNZ_RPY1",this.ZNZ_RPY1],["飞龙四式",this.Dragon4_Main],["飞龙四式-附图",this.Dragon4_Fig],["资金分析",this.FundsAnalysis],["融资占比",this.MarginProportion],["负面新闻",this.NewsNegative],["涨跌趋势",this.UpDownAnalyze],["北上资金",this.HK2SHSZ],["股东人数",this.ShareHolder],["两融余额",this.Margin2],["两融余额2",this.Margin3],["放心股-操盘BS点",this.FXG_BSPoint],["放心股-涨停多空线",this.FXG_INDEX],["放心股-涨停吸筹区",this.FXG_INDEX2],["放心股-量能黄金点",this.FXG_INDEX3],["五彩K线-十字星",this.COLOR_KSTAR1],["五彩K线-早晨之星",this.COLOR_KSTAR2],["五彩K线-黄昏之星",this.COLOR_KSTAR3],["五彩K线-长十字",this.COLOR_SHI1],["五彩K线-身怀六甲",this.COLOR_K220],["五彩K线-三个白武士",this.COLOR_K300],["五彩K线-三只乌鸦",this.COLOR_K310],["五彩K线-光头阳线",this.COLOR_K380],["五彩K线-光脚阴线",this.COLOR_K390],["五彩K线-垂死十字",this.COLOR_K134],["五彩K线-早晨十字星",this.COLOR_K140],["五彩K线-黄昏十字星",this.COLOR_K150],["五彩K线-射击之星",this.COLOR_K160],["五彩K线-倒转锤头",this.COLOR_K165],["五彩K线-锤头",this.COLOR_K170],["五彩K线-吊颈",this.COLOR_K180],["五彩K线-穿头破脚",this.COLOR_K190],["五彩K线-出水芙蓉",this.COLOR_CSFR],["五彩K线-乌云盖顶",this.COLOR_WYGD],["五彩K线-曙光初现",this.COLOR_SGCJ],["五彩K线-十字胎",this.COLOR_SZTAI],["五彩K线-剑",this.COLOR_SWORD],["五彩K线-平顶",this.COLOR_PINGDING],["五彩K线-平底",this.COLOR_PINGDI],["五彩K线-大阳烛",this.COLOR_DAYANZHU],["五彩K线-大阴烛",this.COLOR_DAYINGZHU],["五彩K线-好友反攻",this.COLOR_HYFG],["五彩K线-跳空缺口",this.COLOR_TKQK],["五彩K线-双飞乌鸦",this.COLOR_SFWY],["五彩K线-上升三部曲",this.COLOR_SSSBQ],["五彩K线-下跌三部曲",this.COLOR_XDSBQ],["五彩K线-长下影",this.COLOR_CHXY],["五彩K线-长上影",this.COLOR_CHSY],["五彩K线-分离",this.COLOR_FENLI],["交易系统-BIAS",this.TRADE_BIAS],["交易系统-CCI",this.TRADE_CCI],["交易系统-DMI",this.TRADE_DMI],["交易系统-KD",this.TRADE_KD],["交易系统-BOLL",this.TRADE_BOLL],["交易系统-KDJ",this.TRADE_KDJ],["交易系统-MA",this.TRADE_MA],["交易系统-MACD",this.TRADE_MACD],["交易系统-MTM",this.TRADE_MTM],["交易系统-PSY",this.TRADE_PSY],["交易系统-ROC",this.TRADE_ROC],["交易系统-RSI",this.TRADE_RSI],["交易系统-VR",this.TRADE_VR],["交易系统-DPSJ",this.TRADE_DPSJ],["TEST",this.TEST]])}Z.AddIndex=function(e){for(var a in e)RC.Add(e[a])};Z.ModifyAttribute=function(e,a){if(a&&(a.Args&&(e.Args=a.Args),v.IsNumber(a.FloatPrecision)&&(e.FloatPrecision=a.FloatPrecision),v.IsNumber(a.StringFormat)&&(e.StringFormat=a.StringFormat),v.IsBool(a.IsSync)&&(e.IsSync=a.IsSync),v.IsBool(a.IsShortTitle)&&(e.IsShortTitle=a.IsShortTitle),a.TitleFont&&(e.TitleFont=a.TitleFont),a.Lock&&(e.Lock=a.Lock),v.IsNumber(a.YSplitType)&&(e.YSplitType=a.YSplitType),v.IsBool(a.IsShowIndexTitle)&&(e.IsShowIndexTitle=a.IsShowIndexTitle),v.IsNumber(a.KLineType)&&(e.KLineType=a.KLineType),a.YAxis)){var r=a.YAxis;e.YAxis||(e.YAxis={}),v.IsNumber(r.FloatPrecision)&&(e.YAxis.FloatPrecision=r.FloatPrecision),v.IsNumber(r.StringFormat)&&(e.YAxis.StringFormat=r.StringFormat),v.IsBool(r.EnableRemoveZero)&&(e.YAxis.EnableRemoveZero=r.EnableRemoveZero),v.IsBool(r.ExcludeValue)&&(e.YAxis.ExcludeValue=r.ExcludeValue)}};Z.prototype.Get=function(e){var a=RC.Get(e);if(a)return a;var r=this.DataMap.get(e);if(r){var a=r();return a.ID=e,a}return null};Z.prototype.Search=function(e){var a=[],r=new RegExp(e,"i");return this.DataMap.forEach(function(t,n){n.indexOf("交易系统-")!=0&&n.indexOf("五彩K线-")!=0&&n.search(r)>=0&&a.push(n)}),a};Z.prototype.MA=function(){var e={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"}],Script:`MA1:MA(CLOSE,M1);
MA2:MA(CLOSE,M2);
MA3:MA(CLOSE,M3);`};return e};Z.prototype.MA4=function(){var e={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"}],Script:`MA1:MA(CLOSE,M1);
MA2:MA(CLOSE,M2);
MA3:MA(CLOSE,M3);
MA4:MA(CLOSE,M4);`};return e};Z.prototype.MA5=function(){var e={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"}],Script:`MA1:MA(CLOSE,M1);
MA2:MA(CLOSE,M2);
MA3:MA(CLOSE,M3);
MA4:MA(CLOSE,M4);
MA5:MA(CLOSE,M5);`};return e};Z.prototype.MA6=function(){var e={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"},{Name:"MA6",DynamicName:"MA{M6}"}],Script:`MA1:MA(CLOSE,M1);
MA2:MA(CLOSE,M2);
MA3:MA(CLOSE,M3);
MA4:MA(CLOSE,M4);
MA5:MA(CLOSE,M5);
MA6:MA(CLOSE,M6);`};return e};Z.prototype.MA7=function(){var e={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0},{Name:"M7",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"},{Name:"MA6",DynamicName:"MA{M6}"},{Name:"MA7",DynamicName:"MA{M7}"}],Script:`MA1:MA(CLOSE,M1);
MA2:MA(CLOSE,M2);
MA3:MA(CLOSE,M3);
MA4:MA(CLOSE,M4);
MA5:MA(CLOSE,M5);
MA6:MA(CLOSE,M6);
MA7:MA(CLOSE,M7);`};return e};Z.prototype.MA8=function(){var e={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0},{Name:"M7",Value:0},{Name:"M8",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"},{Name:"MA6",DynamicName:"MA{M6}"},{Name:"MA7",DynamicName:"MA{M7}"},{Name:"MA8",DynamicName:"MA{M8}"}],Script:`MA1:MA(CLOSE,M1);
MA2:MA(CLOSE,M2);
MA3:MA(CLOSE,M3);
MA4:MA(CLOSE,M4);
MA5:MA(CLOSE,M5);
MA6:MA(CLOSE,M6);
MA7:MA(CLOSE,M7);
MA8:MA(CLOSE,M8);`};return e};Z.prototype.EMA3=function(){var e={Name:"EMA",Description:"指数移动平均值",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"}],Script:`MA1:EMA(CLOSE,M1);
MA2:EMA(CLOSE,M2);
MA3:EMA(CLOSE,M3);`};return e};Z.prototype.EMA4=function(){var e={Name:"EMA",Description:"指数移动平均值",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"}],Script:`MA1:EMA(CLOSE,M1);
MA2:EMA(CLOSE,M2);
MA3:EMA(CLOSE,M3);
MA4:EMA(CLOSE,M4);`};return e};Z.prototype.EMA5=function(){var e={Name:"EMA",Description:"指数移动平均值",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"}],Script:`MA1:EMA(CLOSE,M1);
MA2:EMA(CLOSE,M2);
MA3:EMA(CLOSE,M3);
MA4:EMA(CLOSE,M4);
MA5:EMA(CLOSE,M5);`};return e};Z.prototype.EMA6=function(){var e={Name:"EMA",Description:"指数移动平均值",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"},{Name:"MA6",DynamicName:"MA{M6}"}],Script:`MA1:EMA(CLOSE,M1);
MA2:EMA(CLOSE,M2);
MA3:EMA(CLOSE,M3);
MA4:EMA(CLOSE,M4);
MA5:EMA(CLOSE,M5);
MA6:EMA(CLOSE,M6);`};return e};Z.prototype.BOLL=function(){var e={Name:"BOLL",Description:"布林线",IsMainIndex:!0,Args:[{Name:"M",Value:20}],Script:`BOLL:MA(CLOSE,M);
UB:BOLL+2*STD(CLOSE,M);
LB:BOLL-2*STD(CLOSE,M);`};return e};Z.prototype.BOLL2=function(){var e={Name:"BOLL2",Description:"布林线",IsMainIndex:!1,KLineType:0,Args:[{Name:"M",Value:20}],Script:`BOLL:MA(CLOSE,M);
UB:BOLL+2*STD(CLOSE,M);
LB:BOLL-2*STD(CLOSE,M);`};return e};Z.prototype.BBI=function(){var e={Name:"BBI",Description:"多空均线",IsMainIndex:!0,Args:[{Name:"M1",Value:3},{Name:"M2",Value:6},{Name:"M3",Value:12},{Name:"M4",Value:24}],Script:"BBI:(MA(CLOSE,M1)+MA(CLOSE,M2)+MA(CLOSE,M3)+MA(CLOSE,M4))/4;"};return e};Z.prototype.DKX=function(){var e={Name:"DKX",Description:"多空线",IsMainIndex:!1,Args:[{Name:"M",Value:10}],Script:`MID:=(3*CLOSE+LOW+OPEN+HIGH)/6;
DKX:(20*MID+19*REF(MID,1)+18*REF(MID,2)+17*REF(MID,3)+
16*REF(MID,4)+15*REF(MID,5)+14*REF(MID,6)+
13*REF(MID,7)+12*REF(MID,8)+11*REF(MID,9)+
10*REF(MID,10)+9*REF(MID,11)+8*REF(MID,12)+
7*REF(MID,13)+6*REF(MID,14)+5*REF(MID,15)+
4*REF(MID,16)+3*REF(MID,17)+2*REF(MID,18)+REF(MID,20))/210;
MADKX:MA(DKX,M);`};return e};Z.prototype.MIKE=function(){var e={Name:"MIKE",Description:"麦克支撑压力",IsMainIndex:!0,Args:[{Name:"N",Value:10}],Script:`HLC:=REF(MA((HIGH+LOW+CLOSE)/3,N),1);
HV:=EMA(HHV(HIGH,N),3);
LV:=EMA(LLV(LOW,N),3);
STOR:EMA(2*HV-LV,3);
MIDR:EMA(HLC+HV-LV,3);
WEKR:EMA(HLC*2-LV,3);
WEKS:EMA(HLC*2-HV,3);
MIDS:EMA(HLC-HV+LV,3);
STOS:EMA(2*LV-HV,3);`};return e};Z.prototype.PBX=function(){var e={Name:"PBX",Description:"瀑布线",IsMainIndex:!0,Args:[{Name:"M1",Value:4},{Name:"M2",Value:6},{Name:"M3",Value:9},{Name:"M4",Value:13},{Name:"M5",Value:18},{Name:"M6",Value:24}],Script:`PBX1:(EMA(CLOSE,M1)+MA(CLOSE,M1*2)+MA(CLOSE,M1*4))/3;
PBX2:(EMA(CLOSE,M2)+MA(CLOSE,M2*2)+MA(CLOSE,M2*4))/3;
PBX3:(EMA(CLOSE,M3)+MA(CLOSE,M3*2)+MA(CLOSE,M3*4))/3;
PBX4:(EMA(CLOSE,M4)+MA(CLOSE,M4*2)+MA(CLOSE,M4*4))/3;
PBX5:(EMA(CLOSE,M5)+MA(CLOSE,M5*2)+MA(CLOSE,M5*4))/3;
PBX6:(EMA(CLOSE,M6)+MA(CLOSE,M6*2)+MA(CLOSE,M6*4))/3;`};return e};Z.prototype.ENE=function(){var e={Name:"ENE",Description:"轨道线",IsMainIndex:!0,Args:[{Name:"N",Value:25},{Name:"M1",Value:6},{Name:"M2",Value:6}],Script:`UPPER:(1+M1/100)*MA(CLOSE,N);
LOWER:(1-M2/100)*MA(CLOSE,N);
ENE:(UPPER+LOWER)/2;`};return e};Z.prototype.MACD=function(){var e={Name:"MACD",Description:"平滑异同平均",IsMainIndex:!1,Args:[{Name:"SHORT",Value:12},{Name:"LONG",Value:26},{Name:"MID",Value:9}],Script:`DIF:EMA(CLOSE,SHORT)-EMA(CLOSE,LONG);
DEA:EMA(DIF,MID);
MACD:(DIF-DEA)*2,COLORSTICK;`};return e};Z.prototype.MACD2=function(){var e={Name:"MACD",Description:"平滑异同平均",IsMainIndex:!1,Args:[{Name:"SHORT",Value:12},{Name:"LONG",Value:26},{Name:"MID",Value:9}],Script:`DIF2:=EMA(CLOSE,SHORT)-EMA(CLOSE,LONG);
DEA2:=EMA(DIF2,MID);
MACD:(DIF2-DEA2)*2,COLORSTICK,LINETHICK50;
DIF:DIF2;
DEA:DEA2;`};return e};Z.prototype.KDJ=function(){var e={Name:"KDJ",Description:"随机指标",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:`RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;
K:SMA(RSV,M1,1);
D:SMA(K,M2,1);
J:3*K-2*D;`};return e};Z.prototype.VOL=function(){var e={Name:"VOL",Description:"成交量",IsMainIndex:!1,FloatPrecision:0,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"}],Script:`VOL:VOL,VOLSTICK;
MA1:MA(VOL,M1);
MA2:MA(VOL,M2);`};return e};Z.prototype.VOL2=function(){var e={Name:"VOL",Description:"成交量",IsMainIndex:!1,FloatPrecision:0,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"}],Script:`VOL:VOL,VOLSTICK,STICKTYPE(1);
MA1:MA(VOL,M1);
MA2:MA(VOL,M2);`};return e};Z.prototype.VOL_OVERLAY=function(){var e={Name:"VOL",Description:"成交量",IsMainIndex:!1,FloatPrecision:0,Script:"VOL:VOL,VOLSTICK,UPCOLOR(RGBA(255,0,0,0.3)),DOWNCOLOR(RGBA(0,255,0,0.3));"};return e};Z.prototype.VOL_TDX=function(){var e={Name:"VOL-TDX",Description:"成交量(虚拟)",IsMainIndex:!1,FloatPrecision:0,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10}],Script:`TOTAL:=IF(PERIOD=1,5,IF(PERIOD=2,15,IF(PERIOD=3,30,IF(PERIOD=4,60,IF(PERIOD=5,TOTALFZNUM,1)))));
MTIME:=MOD(FROMOPEN,TOTAL);
CTIME:=IF(MTIME<0.5,TOTAL,MTIME);
VVOL:IF((CURRBARSCOUNT=1 AND DYNAINFO(8)>1),VOL*(TOTAL+3)/(CTIME+3),DRAWNULL),NODRAW;
STICKLINE((CURRBARSCOUNT=1 AND DYNAINFO(8)>1),VVOL,0,-1,-1),COLORYELLOW;
VOLUME:VOL,VOLSTICK;
MAVOL1:MA(VOLUME,M1);
MAVOL2:MA(VOLUME,M2);`};return e};Z.prototype.RSI=function(){var e={Name:"RSI",Description:"相对强弱指标",IsMainIndex:!1,Args:[{Name:"N1",Value:6},{Name:"N2",Value:12},{Name:"N3",Value:24}],Script:`LC:=REF(CLOSE,1);
RSI1:SMA(MAX(CLOSE-LC,0),N1,1)/SMA(ABS(CLOSE-LC),N1,1)*100;
RSI2:SMA(MAX(CLOSE-LC,0),N2,1)/SMA(ABS(CLOSE-LC),N2,1)*100;
RSI3:SMA(MAX(CLOSE-LC,0),N3,1)/SMA(ABS(CLOSE-LC),N3,1)*100;`};return e};Z.prototype.BRAR=function(){var e={Name:"BRAR",Description:"情绪指标",IsMainIndex:!1,Args:[{Name:"N",Value:26}],Script:`BR:SUM(MAX(0,HIGH-REF(CLOSE,1)),N)/SUM(MAX(0,REF(CLOSE,1)-LOW),N)*100;
AR:SUM(HIGH-OPEN,N)/SUM(OPEN-LOW,N)*100;`};return e};Z.prototype.WR=function(){var e={Name:"WR",Description:"威廉指标",IsMainIndex:!1,Args:[{Name:"N",Value:10},{Name:"N1",Value:6}],Script:`WR1:100*(HHV(HIGH,N)-CLOSE)/(HHV(HIGH,N)-LLV(LOW,N));
WR2:100*(HHV(HIGH,N1)-CLOSE)/(HHV(HIGH,N1)-LLV(LOW,N1));`};return e};Z.prototype.BIAS=function(){var e={Name:"BIAS",Description:"乖离率",IsMainIndex:!1,Args:[{Name:"N1",Value:6},{Name:"N2",Value:12},{Name:"N3",Value:24}],Script:`BIAS1 :(CLOSE-MA(CLOSE,N1))/MA(CLOSE,N1)*100;
BIAS2 :(CLOSE-MA(CLOSE,N2))/MA(CLOSE,N2)*100;
BIAS3 :(CLOSE-MA(CLOSE,N3))/MA(CLOSE,N3)*100;`};return e};Z.prototype.OBV=function(){var e={Name:"OBV",Description:"累积能量线",IsMainIndex:!1,Args:[{Name:"M",Value:30}],Script:`VA:=IF(CLOSE>REF(CLOSE,1),VOL,-VOL);
OBV:SUM(IF(CLOSE==REF(CLOSE,1),0,VA),0);
MAOBV:MA(OBV,M);`};return e};Z.prototype.DMI=function(){var e={Name:"DMI",Description:"趋向指标",IsMainIndex:!1,Args:[{Name:"N",Value:14},{Name:"MM",Value:6}],Script:`MTR:=EXPMEMA(MAX(MAX(HIGH-LOW,ABS(HIGH-REF(CLOSE,1))),ABS(REF(CLOSE,1)-LOW)),N);
HD :=HIGH-REF(HIGH,1);
LD :=REF(LOW,1)-LOW;
DMP:=EXPMEMA(IF(HD>0&&HD>LD,HD,0),N);
DMM:=EXPMEMA(IF(LD>0&&LD>HD,LD,0),N);
PDI: DMP*100/MTR;
MDI: DMM*100/MTR;
ADX: EXPMEMA(ABS(MDI-PDI)/(MDI+PDI)*100,MM);
ADXR:EXPMEMA(ADX,MM);`};return e};Z.prototype.CR=function(){var e={Name:"CR",Description:"带状能量线",IsMainIndex:!1,Args:[{Name:"N",Value:26},{Name:"M1",Value:10},{Name:"M2",Value:20},{Name:"M3",Value:40},{Name:"M4",Value:62}],Script:`MID:=REF(HIGH+LOW,1)/2;
CR:SUM(MAX(0,HIGH-MID),N)/SUM(MAX(0,MID-LOW),N)*100;
MA1:REF(MA(CR,M1),M1/2.5+1);
MA2:REF(MA(CR,M2),M2/2.5+1);
MA3:REF(MA(CR,M3),M3/2.5+1);
MA4:REF(MA(CR,M4),M4/2.5+1);`};return e};Z.prototype.PSY=function(){var e={Name:"PSY",Description:"心理线",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:"PSY:COUNT(CLOSE>REF(CLOSE,1),N)/N*100;\rPSYMA:MA(PSY,M);"};return e};Z.prototype.CCI=function(){var e={Name:"CCI",Description:"商品路径指标",IsMainIndex:!1,Args:[{Name:"N",Value:14}],Script:`TYP:=(HIGH+LOW+CLOSE)/3;
CCI:(TYP-MA(TYP,N))/(0.015*AVEDEV(TYP,N));`};return e};Z.prototype.DMA=function(){var e={Name:"DMA",Description:"平均差",IsMainIndex:!1,Args:[{Name:"N1",Value:10},{Name:"N2",Value:50},{Name:"M",Value:10}],Script:`DIF:MA(CLOSE,N1)-MA(CLOSE,N2);
DIFMA:MA(DIF,M);`};return e};Z.prototype.TRIX=function(){var e={Name:"TRIX",Description:"三重指数平均线",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:9}],Script:`MTR:=EMA(EMA(EMA(CLOSE,N),N),N);
TRIX:(MTR-REF(MTR,1))/REF(MTR,1)*100;
MATRIX:MA(TRIX,M) ;`};return e};Z.prototype.VR=function(){var e={Name:"VR",Description:"成交量变异率",IsMainIndex:!1,Args:[{Name:"N",Value:26},{Name:"M",Value:6}],Script:`TH:=SUM(IF(CLOSE>REF(CLOSE,1),VOL,0),N);
TL:=SUM(IF(CLOSE<REF(CLOSE,1),VOL,0),N);
TQ:=SUM(IF(CLOSE==REF(CLOSE,1),VOL,0),N);
VR:100*(TH*2+TQ)/(TL*2+TQ);
MAVR:MA(VR,M);`};return e};Z.prototype.EMV=function(){var e={Name:"EMV",Description:"简易波动指标",IsMainIndex:!1,Args:[{Name:"N",Value:14},{Name:"M",Value:9}],Script:`VOLUME:=MA(VOL,N)/VOL;
MID:=100*(HIGH+LOW-REF(HIGH+LOW,1))/(HIGH+LOW);
EMV:MA(MID*VOLUME*(HIGH-LOW)/MA(HIGH-LOW,N),N);
MAEMV:MA(EMV,M);`};return e};Z.prototype.ROC=function(){var e={Name:"ROC",Description:"变动率指标",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:`ROC:100*(CLOSE-REF(CLOSE,N))/REF(CLOSE,N);
MAROC:MA(ROC,M);`};return e};Z.prototype.MTM=function(){var e={Name:"MTM",Description:"动量线",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:`MTM:CLOSE-REF(CLOSE,N);
MAMTM:MA(MTM,M);`};return e};Z.prototype.FSL=function(){var e={Name:"FSL",Description:"分水岭",IsMainIndex:!1,Args:[],Script:`SWL:(EMA(CLOSE,5)*7+EMA(CLOSE,10)*3)/10;
SWS:DMA(EMA(CLOSE,12),MAX(1,100*(SUM(VOL,5)/(3*CAPITAL))));`};return e};Z.prototype.CYR=function(){var e={Name:"CYR",Description:"市场强弱",IsMainIndex:!1,Args:[{Name:"N",Value:13},{Name:"M",Value:5}],Script:`DIVE:=0.01*EMA(AMOUNT,N)/EMA(VOL,N);
CYR:(DIVE/REF(DIVE,1)-1)*100;
MACYR:MA(CYR,M);`};return e};Z.prototype.MASS=function(){var e={Name:"MASS",Description:"市场强弱",IsMainIndex:!1,Args:[{Name:"N1",Value:9},{Name:"N2",Value:25},{Name:"M",Value:6}],Script:`MASS:SUM(MA(HIGH-LOW,N1)/MA(MA(HIGH-LOW,N1),N1),N2);
MAMASS:MA(MASS,M);`};return e};Z.prototype.WAD=function(){var e={Name:"WAD",Description:"威廉多空力度线",IsMainIndex:!1,Args:[{Name:"M",Value:30}],Script:`MIDA:=CLOSE-MIN(REF(CLOSE,1),LOW);
MIDB:=IF(CLOSE<REF(CLOSE,1),CLOSE-MAX(REF(CLOSE,1),HIGH),0);
WAD:SUM(IF(CLOSE>REF(CLOSE,1),MIDA,MIDB),0);
MAWAD:MA(WAD,M);`};return e};Z.prototype.CHO=function(){var e={Name:"CHO",Description:"佳庆指标",IsMainIndex:!1,Args:[{Name:"N1",Value:10},{Name:"N2",Value:20},{Name:"M",Value:6}],Script:`MID:=SUM(VOL*(2*CLOSE-HIGH-LOW)/(HIGH+LOW),0);
CHO:MA(MID,N1)-MA(MID,N2);
MACHO:MA(CHO,M);`};return e};Z.prototype.ADTM=function(){var e={Name:"ADTM",Description:"动态买卖气指标",IsMainIndex:!1,Args:[{Name:"N",Value:23},{Name:"M",Value:8}],Script:`DTM:=IF(OPEN<=REF(OPEN,1),0,MAX((HIGH-OPEN),(OPEN-REF(OPEN,1))));
DBM:=IF(OPEN>=REF(OPEN,1),0,MAX((OPEN-LOW),(OPEN-REF(OPEN,1))));
STM:=SUM(DTM,N);
SBM:=SUM(DBM,N);
ADTM:IF(STM>SBM,(STM-SBM)/STM,IF(STM==SBM,0,(STM-SBM)/SBM));
MAADTM:MA(ADTM,M);`};return e};Z.prototype.HSL=function(){var e={Name:"HSL",Description:"换手线",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:`HSL:IF((SETCODE==0||SETCODE==1),100*VOL,VOL)/(FINANCE(7)/100);
MAHSL:MA(HSL,N);`};return e};Z.prototype.BIAS36=function(){var e={Name:"BIAS36",Description:"三六乖离",IsMainIndex:!1,Args:[{Name:"M",Value:6}],Script:`BIAS36:MA(CLOSE,3)-MA(CLOSE,6);
BIAS612:MA(CLOSE,6)-MA(CLOSE,12);
MABIAS:MA(BIAS36,M);`};return e};Z.prototype.BIAS_QL=function(){var e={Name:"BIAS_QL",Description:"乖离率-传统版",IsMainIndex:!1,Args:[{Name:"N",Value:6},{Name:"M",Value:6}],Script:`BIAS :(CLOSE-MA(CLOSE,N))/MA(CLOSE,N)*100;
BIASMA :MA(BIAS,M);`};return e};Z.prototype.DPO=function(){var e={Name:"DPO",Description:"区间震荡线",IsMainIndex:!1,Args:[{Name:"N",Value:20},{Name:"M",Value:6}],Script:`DPO:CLOSE-REF(MA(CLOSE,N),N/2+1);
MADPO:MA(DPO,M);`};return e};Z.prototype.OSC=function(){var e={Name:"OSC",Description:"变动速率线",IsMainIndex:!1,Args:[{Name:"N",Value:20},{Name:"M",Value:6}],Script:`OSC:100*(CLOSE-MA(CLOSE,N));
MAOSC:EXPMEMA(OSC,M);`};return e};Z.prototype.ATR=function(){var e={Name:"ATR",Description:"真实波幅",IsMainIndex:!1,Args:[{Name:"N",Value:14}],Script:`MTR:MAX(MAX((HIGH-LOW),ABS(REF(CLOSE,1)-HIGH)),ABS(REF(CLOSE,1)-LOW));
ATR:MA(MTR,N);`};return e};Z.prototype.NVI=function(){var e={Name:"ATR",Description:"负成交量",IsMainIndex:!1,Args:[{Name:"N",Value:72}],Script:`NVI:100*MULAR(IF(V<REF(V,1),C/REF(C,1),1),0);
MANVI:MA(NVI,N);`};return e};Z.prototype.PVI=function(){var e={Name:"PVI",Description:"正成交量",IsMainIndex:!1,Args:[{Name:"N",Value:72}],Script:`NVI:100*MULAR(IF(V>REF(V,1),C/REF(C,1),1),0);
MANVI:MA(NVI,N);`};return e};Z.prototype.UOS=function(){var e={Name:"UOS",Description:"终极指标",IsMainIndex:!1,Args:[{Name:"N1",Value:7},{Name:"N2",Value:14},{Name:"N3",Value:28},{Name:"M",Value:6}],Script:`TH:=MAX(HIGH,REF(CLOSE,1));
TL:=MIN(LOW,REF(CLOSE,1));
ACC1:=SUM(CLOSE-TL,N1)/SUM(TH-TL,N1);
ACC2:=SUM(CLOSE-TL,N2)/SUM(TH-TL,N2);
ACC3:=SUM(CLOSE-TL,N3)/SUM(TH-TL,N3);
UOS:(ACC1*N2*N3+ACC2*N1*N3+ACC3*N1*N2)*100/(N1*N2+N1*N3+N2*N3);
MAUOS:EXPMEMA(UOS,M);`};return e};Z.prototype.CYW=function(){var e={Name:"CYW",Description:"主力控盘",IsMainIndex:!1,Args:[],Script:`VAR1:=CLOSE-LOW;
VAR2:=HIGH-LOW;
VAR3:=CLOSE-HIGH;
VAR4:=IF(HIGH>LOW,(VAR1/VAR2+VAR3/VAR2)*VOL,0);
CYW: SUM(VAR4,10)/10000, COLORSTICK;`};return e};Z.prototype.LON=function(){var e={Name:"LON",Description:"龙系长线",IsMainIndex:!1,Args:[{Name:"N",Value:10}],Script:`LC := REF(CLOSE,1);
VID := SUM(VOL,2)/(((HHV(HIGH,2)-LLV(LOW,2)))*100);
RC := (CLOSE-LC)*VID;
LONG := SUM(RC,0);
DIFF := SMA(LONG,10,1);
DEA := SMA(LONG,20,1);
LON : DIFF-DEA;
LONMA : MA(LON,10);
LONT : LON, COLORSTICK;`};return e};Z.prototype.NDB=function(){var e={Name:"NDB",Description:"脑电波",IsMainIndex:!1,Args:[{Name:"P1",Value:5},{Name:"P2",Value:10}],Script:`HH:=IF(C/REF(C,1)>1.098 AND L>REF(H,1),2*C-REF(C,1)-H,2*C-H-L);
V1:= BARSCOUNT(C) - 1;
V2:= 2 * REF(C, V1) - REF(H, V1) - REF(L, V1);
DK: SUM(HH, 0) + V2;
MDK5: MA(DK, P1);
MDK10: MA(DK, P2);`};return e};Z.prototype.SKDJ=function(){var e={Name:"SKDJ",Description:"慢速随机指标",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M",Value:3}],Script:`LOWV:=LLV(LOW,N);
HIGHV:=HHV(HIGH,N);
RSV:=EMA((CLOSE-LOWV)/(HIGHV-LOWV)*100,M);
K:EMA(RSV,M);
D:MA(K,M);`};return e};Z.prototype.KD=function(){var e={Name:"KD",Description:"随机指标KD",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:`RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;
K:SMA(RSV,M1,1);
D:SMA(K,M2,1);`};return e};Z.prototype.FKX=function(){var e={Name:"FKX",Description:"反K线",IsMainIndex:!0,Args:[],Script:"DRAWKLINE(-LOW, -OPEN, -HIGH, -CLOSE);"};return e};Z.prototype.DKCOL=function(){var e={Name:"DKCOL",Description:"多空能量柱(适用于分时主图)",IsMainIndex:!0,Args:[{Name:"N",Value:5}],Script:`FF:=(C-REF(C,N))/REF(C,N);
STICKLINE(FF>0,DYNAINFO(3),DYNAINFO(3)*(1+FF),0.5,0),COLORRED;
STICKLINE(FF<0,DYNAINFO(3),DYNAINFO(3)*(1+FF),0.5,0),COLORGREEN;`};return e};Z.prototype.UDL=function(){var e={Name:"UDL",Description:"引力线",IsMainIndex:!1,Args:[{Name:"N1",Value:3},{Name:"N2",Value:5},{Name:"N3",Value:10},{Name:"N4",Value:20},{Name:"M",Value:6}],Script:`UDL:(MA(CLOSE,N1)+MA(CLOSE,N2)+MA(CLOSE,N3)+MA(CLOSE,N4))/4;
MAUDL:MA(UDL,M);`};return e};Z.prototype.MFI=function(){var e={Name:"MFI",Description:"资金流量指标",IsMainIndex:!1,Args:[{Name:"N",Value:14},{Name:"N2",Value:6}],Script:`TYP := (HIGH + LOW + CLOSE)/3;
V1:=SUM(IF(TYP>REF(TYP,1),TYP*VOL,0),N)/SUM(IF(TYP<REF(TYP,1),TYP*VOL,0),N);
MFI:100-(100/(1+V1));`};return e};Z.prototype.LWR=function(){var e={Name:"LWR",Description:"LWR威廉指标",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:`RSV:= (HHV(HIGH,N)-CLOSE)/(HHV(HIGH,N)-LLV(LOW,N))*100;
LWR1:SMA(RSV,M1,1);
LWR2:SMA(LWR1,M2,1);`};return e};Z.prototype.MARSI=function(){var e={Name:"MARSI",Description:"相对强弱平均线",IsMainIndex:!1,Args:[{Name:"M1",Value:10},{Name:"M2",Value:6}],Script:`DIF:=CLOSE-REF(CLOSE,1);
VU:=IF(DIF>=0,DIF,0);
VD:=IF(DIF<0,-DIF,0);
MAU1:=MEMA(VU,M1);
MAD1:=MEMA(VD,M1);
MAU2:=MEMA(VU,M2);
MAD2:=MEMA(VD,M2);
RSI10:MA(100*MAU1/(MAU1+MAD1),M1);
RSI6:MA(100*MAU2/(MAU2+MAD2),M2);`};return e};Z.prototype.CYD=function(){var e={Name:"CYD",Description:"承接因子",IsMainIndex:!1,Args:[{Name:"N",Value:21}],Script:`CYDS:WINNER(CLOSE)/(VOL/CAPITAL);
CYDN:WINNER(CLOSE)/MA(VOL/CAPITAL,N);`};return e};Z.prototype.CYF=function(){var e={Name:"CYF",Description:"市场能量",IsMainIndex:!1,Args:[{Name:"N",Value:21}],Script:"CYF:100-100/(1+EMA(HSL,N));"};return e};Z.prototype.TAPI=function(){var e={Name:"TAPI",Description:"加权指数成交值",IsMainIndex:!1,Args:[{Name:"M",Value:6}],Script:`TAPI:AMOUNT/INDEXC;
MATAIP:MA(TAPI,M);`};return e};Z.prototype.VMACD=function(){var e={Name:"VMACD",Description:"量平滑异同平均",IsMainIndex:!1,Args:[{Name:"SHORT",Value:12},{Name:"LONG",Value:26},{Name:"MID",Value:9}],Script:`DIF:EMA(VOL,SHORT)-EMA(VOL,LONG);
DEA:EMA(DIF,MID);
MACD:DIF-DEA,COLORSTICK;`};return e};Z.prototype.QACD=function(){var e={Name:"QACD",Description:"快速异同平均",IsMainIndex:!1,Args:[{Name:"N1",Value:12},{Name:"N2",Value:26},{Name:"M",Value:9}],Script:`DIF:EMA(CLOSE,N1)-EMA(CLOSE,N2);
MACD:EMA(DIF,M);
DDIF:DIF-MACD;`};return e};Z.prototype.VPT=function(){var e={Name:"VPT",Description:"量价曲线",IsMainIndex:!1,Args:[{Name:"N",Value:51},{Name:"M",Value:6}],Script:`VPT:SUM(VOL*(CLOSE-REF(CLOSE,1))/REF(CLOSE,1),N);
MAVPT:MA(VPT,M);`};return e};Z.prototype.WVAD=function(){var e={Name:"WVAD",Description:"威廉变异离散量",IsMainIndex:!1,Args:[{Name:"N",Value:24},{Name:"M",Value:6}],Script:`WVAD:SUM((CLOSE-OPEN)/(HIGH-LOW)*VOL,N)/10000;
MAWVAD:MA(WVAD,M);`};return e};Z.prototype.DBQR=function(){var e={Name:"WVAD",Description:"对比强弱",IsMainIndex:!1,Args:[{Name:"N",Value:5},{Name:"M1",Value:10},{Name:"M2",Value:20},{Name:"M3",Value:60}],Script:`ZS:(INDEXC-REF(INDEXC,N))/REF(INDEXC,N);
GG:(CLOSE-REF(CLOSE,N))/REF(CLOSE,N);
MADBQR1:MA(GG,M1);
MADBQR2:MA(GG,M2);
MADBQR3:MA(GG,M3);`};return e};Z.prototype.JS=function(){var e={Name:"JS",Description:"加速线",IsMainIndex:!1,Args:[{Name:"N",Value:5},{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20}],Script:`JS:100*(CLOSE-REF(CLOSE,N))/(N*REF(CLOSE,N));
MAJS1:MA(JS,M1);
MAJS2:MA(JS,M2);
MAJS3:MA(JS,M3);`};return e};Z.prototype.CYE=function(){var e={Name:"CYE",Description:"市场趋势",IsMainIndex:!1,Args:[],Script:`MAL:=MA(CLOSE,5);
MAS:=MA(MA(CLOSE,20),5);
CYEL:(MAL-REF(MAL,1))/REF(MAL,1)*100;
CYES:(MAS-REF(MAS,1))/REF(MAS,1)*100;`};return e};Z.prototype.QR=function(){var e={Name:"QR",Description:"强弱指标",IsMainIndex:!1,Args:[{Name:"N",Value:21}],Script:`个股: (CLOSE-REF(CLOSE,N))/REF(CLOSE,N)*100; 
大盘: (INDEXC-REF(INDEXC,N))/REF(INDEXC,N)*100; 
强弱值:EMA(个股-大盘,2),COLORSTICK;`};return e};Z.prototype.GDX=function(){var e={Name:"GDX",Description:"轨道线",IsMainIndex:!1,Args:[{Name:"N",Value:30},{Name:"M",Value:9}],Script:`AA:=ABS((2*CLOSE+HIGH+LOW)/4-MA(CLOSE,N))/MA(CLOSE,N); 
轨道:DMA(CLOSE,AA);
压力线:(1+M/100)*轨道; 
支撑线:(1-M/100)*轨道;`};return e};Z.prototype.JLHB=function(){var e={Name:"JLHB",Description:"绝路航标",IsMainIndex:!1,Args:[{Name:"N",Value:7},{Name:"M",Value:5}],Script:`VAR1:=(CLOSE-LLV(LOW,60))/(HHV(HIGH,60)-LLV(LOW,60))*80; 
B:SMA(VAR1,N,1); 
VAR2:SMA(B,M,1); 
绝路航标:IF(CROSS(B,VAR2) AND B<40,50,0);`};return e};Z.prototype.PCNT=function(){var e={Name:"PCNT",Description:"幅度比",IsMainIndex:!1,Args:[{Name:"M",Value:5}],Script:`PCNT:(CLOSE-REF(CLOSE,1))/CLOSE*100;
MAPCNT:EXPMEMA(PCNT,M);`};return e};Z.prototype.BTX=function(){var e={Name:"BTX",Description:"宝塔线",IsMainIndex:!1,Args:[],Script:`B1:=REF(C,1);
B2:= REF(C, 2);
SS:= IF(C > REF(C, 1) AND REF(C, 1) >= REF(C, 2), 1, IF(C < REF(C, 1) AND REF(C, 1) <= REF(C, 2), -1, IF(C > REF(C, 2) AND REF(C, 2) > REF(C, 1), 2, IF(C < REF(C, 2) AND REF(C, 2) < REF(C, 1), -2, 0))));
SM:= IF(REF(SS, 1) <> 0, REF(SS, 1), IF(REF(SS, 2) <> 0, REF(SS, 2), IF(REF(SS, 3) <> 0, REF(SS, 3), IF(REF(SS, 5) <> 0, REF(SS, 5), IF(REF(SS, 6) <> 0, REF(SS, 6), IF(REF(SS, 7) <> 0, REF(SS, 7), 0))))));
MC:= IF(REF(SS, 1) <> 0, B2, IF(SM > 0, MIN(B1, B2), MAX(B1, B2)));
TOW1:= IF(C > REF(C, 1), C, REF(C, 1));
TOW2:= IF((SS == -1 OR SS == -2) AND SM > 0, B2, TOW1);
TOWER:= IF(TOW1 > TOW2, TOW1, TOW2);
STICKLINE(SS == 1 OR SM >= 1 AND SS == 0, B1, C, 10, 1), COLORRED;
STICKLINE(SS == -1 OR SM <= -1 AND SS == 0, B1, C, 10, 0), COLORCYAN;
STICKLINE(SS == 2, B2, C, 10, 1), COLORRED;
STICKLINE(SS == -2, B2, C, 10, 0), COLORCYAN;
STICKLINE((SS == -1 OR SS == -2) AND SM > 0, B2, B1, 10, 1), COLORRED;
STICKLINE((SS == 1 OR SS == 2) AND SM < 0, B2, B1, 10, 0), COLORCYAN;`};return e};Z.prototype.AMO=function(){var e={Name:"AMO",Description:"成交金额",IsMainIndex:!1,StringFormat:2,YAxis:{FloatPrecision:0,StringFormat:2},Args:[{Name:"M1",Value:5},{Name:"M2",Value:10}],Script:`AMOW:AMOUNT/10000.0,VOLSTICK;
AMO1:MA(AMOW,M1);
AMO2:MA(AMOW,M2);`};return e};Z.prototype.VRSI=function(){var e={Name:"VRSI",Description:"相对强弱量",IsMainIndex:!1,Args:[{Name:"N1",Value:6},{Name:"N2",Value:12},{Name:"N3",Value:24}],Script:`LC:=REF(VOL,1);
RSI1:SMA(MAX(VOL-LC,0),N1,1)/SMA(ABS(VOL-LC),N1,1)*100;
RSI2:SMA(MAX(VOL-LC,0),N2,1)/SMA(ABS(VOL-LC),N2,1)*100;
RSI3:SMA(MAX(VOL-LC,0),N3,1)/SMA(ABS(VOL-LC),N3,1)*100;`};return e};Z.prototype.HSCOL=function(){var e={Name:"HSCOL",Description:"换手柱",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:`HSCOL:IF((SETCODE==0||SETCODE==1),100*VOL,VOL)/(FINANCE(7)/100),VOLSTICK;
MAHSL:MA(HSCOL,N);`};return e};Z.prototype.DBQRV=function(){var e={Name:"DBQRV",Description:"对比强弱量(需下载日线)",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:`ZS:(INDEXV-REF(INDEXV,N))/REF(INDEXV,N);
GG:(VOL-REF(VOL,N))/REF(VOL,N);`};return e};Z.prototype.DBLB=function(){var e={Name:"DBLB",Description:"对比量比(需下载日线)",IsMainIndex:!1,Args:[{Name:"N",Value:5},{Name:"M",Value:5}],Script:`GG:=VOL/SUM(REF(VOL,1),N);
ZS:=INDEXV/SUM(REF(INDEXV,1),N);
DBLB:GG/ZS;
MADBLB:MA(DBLB,M);`};return e};Z.prototype.ACD=function(){var e={Name:"ACD",Description:"升降线",IsMainIndex:!1,Args:[{Name:"M",Value:20}],Script:`LC:=REF(CLOSE,1);
DIF:=CLOSE-IF(CLOSE>LC,MIN(LOW,LC),MAX(HIGH,LC));
ACD:SUM(IF(CLOSE==LC,0,DIF),0);
MAACD:EXPMEMA(ACD,M);`};return e};Z.prototype.EXPMA=function(){var e={Name:"EXPMA",Description:"指数平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:12},{Name:"M2",Value:50}],Script:`EXP1:EMA(CLOSE,M1);
EXP2:EMA(CLOSE,M2);`};return e};Z.prototype.EXPMA_S=function(){var e={Name:"EXPMA_S",Description:"指数平均线-副图",IsMainIndex:!1,Args:[{Name:"M1",Value:12},{Name:"M2",Value:50}],Script:`EXP1:EMA(CLOSE,M1);
EXP2:EMA(CLOSE,M2);`};return e};Z.prototype.HMA=function(){var e={Name:"HMA",Description:"高价平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:`HMA1:MA(HIGH,M1);
HMA2:MA(HIGH,M2);
HMA3:MA(HIGH,M3);
HMA4:MA(HIGH,M4);
HMA5:MA(HIGH,M5);`};return e};Z.prototype.LMA=function(){var e={Name:"LMA",Description:"低价平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:`LMA1:MA(LOW,M1);
LMA2:MA(LOW,M2);
LMA3:MA(LOW,M3);
LMA4:MA(LOW,M4);
LMA5:MA(LOW,M5);`};return e};Z.prototype.VMA=function(){var e={Name:"VMA",Description:"变异平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:`VV:=(HIGH+OPEN+LOW+CLOSE)/4;
VMA1:MA(VV,M1);
VMA2:MA(VV,M2);
VMA3:MA(VV,M3);
VMA4:MA(VV,M4);
VMA5:MA(VV,M5);`};return e};Z.prototype.AMV=function(){var e={Name:"AMV",Description:"成本价均线",IsMainIndex:!1,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:`AMOV:=VOL*(OPEN+CLOSE)/2;
AMV1:SUM(AMOV,M1)/SUM(VOL,M1);
AMV2:SUM(AMOV,M2)/SUM(VOL,M2);
AMV3:SUM(AMOV,M3)/SUM(VOL,M3);
AMV4:SUM(AMOV,M4)/SUM(VOL,M4);`};return e};Z.prototype.BBIBOLL=function(){var e={Name:"BBIBOLL",Description:"多空布林线",IsMainIndex:!0,Args:[{Name:"N",Value:11},{Name:"M",Value:6}],Script:`CV:=CLOSE;
BBIBOLL:(MA(CV,3)+MA(CV,6)+MA(CV,12)+MA(CV,24))/4;
UPR:BBIBOLL+M*STD(BBIBOLL,N);
DWN:BBIBOLL-M*STD(BBIBOLL,N);`};return e};Z.prototype.ALLIGAT=function(){var e={Name:"ALLIGAT",Description:"鳄鱼线",IsMainIndex:!0,Args:[],Script:`NN:=(H+L)/2;
上唇:REF(MA(NN,5),3),COLOR40FF40;
牙齿:REF(MA(NN,8),5),COLOR0000C0;
下颚:REF(MA(NN,13),8),COLORFF4040;`};return e};Z.prototype.ZX=function(){var e={Name:"ZX",Description:"重心线",IsMainIndex:!1,Args:[],Script:"AV:0.01*AMOUNT/VOL;"};return e};Z.prototype.XS=function(){var e={Name:"XS",Description:"薛斯通道",IsMainIndex:!0,Args:[{Name:"N",Value:13}],Script:`VAR2:=CLOSE*VOL;
VAR3:=EMA((EMA(VAR2,3)/EMA(VOL,3)+EMA(VAR2,6)/EMA(VOL,6)+EMA(VAR2,12)/EMA(VOL,12)+EMA(VAR2,24)/EMA(VOL,24))/4,N);
SUP:1.06*VAR3;
SDN:VAR3*0.94;
VAR4:=EMA(CLOSE,9);
LUP:EMA(VAR4*1.14,5);
LDN:EMA(VAR4*0.86,5);`};return e};Z.prototype.XS2=function(){var e={Name:"XS2",Description:"薛斯通道II",IsMainIndex:!0,Args:[{Name:"N",Value:102},{Name:"M",Value:7}],Script:`AA:=MA((2*CLOSE+HIGH+LOW)/4,5); 
通道1:AA*N/100; 
通道2:AA*(200-N)/100; 
CC:=ABS((2*CLOSE+HIGH+LOW)/4-MA(CLOSE,20))/MA(CLOSE,20); 
DD:=DMA(CLOSE,CC); 
通道3:(1+M/100)*DD; 
通道4:(1-M/100)*DD;`};return e};Z.prototype.SG_XDT=function(){var e={Name:"SG-XDT",Description:"心电图(需下载日线)",IsMainIndex:!1,Args:[{Name:"P1",Value:5},{Name:"P2",Value:10}],Script:`QR:CLOSE/INDEXC*1000;
MQR1:MA(QR,5);
MQR2:MA(QR,10);`};return e};Z.prototype.SG_SMX=function(){var e={Name:"SG-SMX",Description:"生命线(需下载日线)",IsMainIndex:!1,Args:[{Name:"N",Value:50}],Script:`H1:=HHV(HIGH,N);
L1:=LLV(LOW,N);
H2:=HHV(INDEXH,N);
L2:=LLV(INDEXL,N);
ZY:=CLOSE/INDEXC*2000;
ZY1:EMA(ZY,3);
ZY2:EMA(ZY,17);
ZY3:EMA(ZY,34);`};return e};Z.prototype.SG_LB=function(){var e={Name:"SG-LB",Description:"量比(需下载日线)",IsMainIndex:!1,Args:[],Script:`ZY2:=VOL/INDEXV*1000;
量比:ZY2;
MA5:MA(ZY2,5);
MA10:MA(ZY2,10);`};return e};Z.prototype.SG_PF=function(){var e={Name:"SG-PF",Description:"强势股评分(需下载日线)",IsMainIndex:!1,Args:[],Script:`ZY1:=CLOSE/INDEXC*1000;
A1:=IF(ZY1>HHV(ZY1,3),10,0);
A2:=IF(ZY1>HHV(ZY1,5),15,0);
A3:=IF(ZY1>HHV(ZY1,10),20,0);
A4:=IF(ZY1>HHV(ZY1,2),10,0);
A5:=COUNT(ZY1>REF(ZY1,1) ,9)*5;
强势股评分:A1+A2+A3+A4+A5;`};return e};Z.prototype.RAD=function(){var e={Name:"RAD",Description:"威力雷达(需下载日线)",IsMainIndex:!1,Args:[{Name:"D",Value:3},{Name:"S",Value:30},{Name:"M",Value:30}],Script:`SM:=(OPEN+HIGH+CLOSE+LOW)/4;
SMID:=MA(SM,D);
IM:=(INDEXO+INDEXH+INDEXL+INDEXC)/4;
IMID:=MA(IM,D);
SI1:=(SMID-REF(SMID,1))/SMID;
II:=(IMID-REF(IMID,1))/IMID;
RADER1:SUM((SI1-II)*2,S)*1000;
RADERMA:SMA(RADER1,M,1);`};return e};Z.prototype.SHT=function(){var e={Name:"SHT",Description:"龙系短线",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:`VAR1:=MA((VOL-REF(VOL,1))/REF(VOL,1),5);
VAR2:=(CLOSE-MA(CLOSE,24))/MA(CLOSE,24)*100;
MY: VAR2*(1+VAR1);
SHT: MY, COLORSTICK;
SHTMA: MA(SHT,N);`};return e};Z.prototype.ZLJC=function(){var e={Name:"ZLJC",Description:"主力进出",IsMainIndex:!1,Args:[],Script:`VAR1:=(CLOSE+LOW+HIGH)/3; 
VAR2:=SUM(((VAR1-REF(LOW,1))-(HIGH-VAR1))*VOL/100000/(HIGH-LOW),0); 
VAR3:=EMA(VAR2,1); 
JCS:VAR3; 
JCM:MA(VAR3,12); 
JCL:MA(VAR3,26);`};return e};Z.prototype.ZLMM=function(){var e={Name:"ZLMM",Description:"主力买卖",IsMainIndex:!1,Args:[],Script:`LC :=REF(CLOSE,1);
RSI2:=SMA(MAX(CLOSE-LC,0),12,1)/SMA(ABS(CLOSE-LC),12,1)*100;
RSI3:=SMA(MAX(CLOSE-LC,0),18,1)/SMA(ABS(CLOSE-LC),18,1)*100;
MMS:MA(3*RSI2-2*SMA(MAX(CLOSE-LC,0),16,1)/SMA(ABS(CLOSE-LC),16,1)*100,3);
MMM:EMA(MMS,8);
MML:MA(3*RSI3-2*SMA(MAX(CLOSE-LC,0),12,1)/SMA(ABS(CLOSE-LC),12,1)*100,5);`};return e};Z.prototype.SLZT=function(){var e={Name:"SLZT",Description:"神龙在天",IsMainIndex:!1,Args:[],Script:`白龙: MA(CLOSE,125);
黄龙: 白龙+2*STD(CLOSE,170);
紫龙: 白龙-2*STD(CLOSE,145);
青龙: SAR(125,1,7), LINESTICK;
VAR2:=HHV(HIGH,70);
VAR3:=HHV(HIGH,20);
红龙: VAR2*0.83;
蓝龙: VAR3*0.91;`};return e};Z.prototype.ADVOL=function(){var e={Name:"ADVOL",Description:"龙系离散量",IsMainIndex:!1,Args:[],Script:`A:=SUM(((CLOSE-LOW)-(HIGH-CLOSE))*VOL/10000/(HIGH-LOW),0);
ADVOL:A;
MA1:MA(A,30);
MA2:MA(MA1,100);`};return e};Z.prototype.CYC=function(){var e={Name:"CYC",Description:"成本均线",IsMainIndex:!0,Args:[{Name:"P1",Value:5},{Name:"P2",Value:13},{Name:"P3",Value:34}],Script:`JJJ:=IF(DYNAINFO(8)>0.01,0.01*DYNAINFO(10)/DYNAINFO(8),DYNAINFO(3));
DDD:=(DYNAINFO(5)<0.01 || DYNAINFO(6)<0.01);
JJJT:=IF(DDD,1,(JJJ<(DYNAINFO(5)+0.01) && JJJ>(DYNAINFO(6)-0.01)));
CYC1:IF(JJJT,0.01*EMA(AMOUNT,P1)/EMA(VOL,P1),EMA((HIGH+LOW+CLOSE)/3,P1));
CYC2:IF(JJJT,0.01*EMA(AMOUNT,P2)/EMA(VOL,P2),EMA((HIGH+LOW+CLOSE)/3,P2));
CYC3:IF(JJJT,0.01*EMA(AMOUNT,P3)/EMA(VOL,P3),EMA((HIGH+LOW+CLOSE)/3,P3));
CYC4:IF(JJJT,DMA(AMOUNT/(100*VOL),100*VOL/FINANCE(7)),EMA((HIGH+LOW+CLOSE)/3,120));`};return e};Z.prototype.CYS=function(){var e={Name:"CYS",Description:"市场盈亏",IsMainIndex:!1,Args:[],Script:`CYC13:EMA(AMOUNT,13)/EMA(VOL,13);
CYS:(CLOSE-CYC13)/CYC13*100;`};return e};Z.prototype.CYQKL=function(){var e={Name:"CYQKL",Description:"博弈K线长度",IsMainIndex:!1,Args:[],Script:"KL:100*(WINNER(CLOSE)-WINNER(OPEN));"};return e};Z.prototype.SCR=function(){var e={Name:"SCR",Description:"筹码集中度",IsMainIndex:!1,Args:[{Name:"P1",Value:90}],Script:`A:=P1+(100-P1)/2;
B:=(100-P1)/2;
CC:=COST(A);
DD:=COST(B);
SCR:(CC-DD)/(CC+DD)*100/2;`};return e};Z.prototype.ASR=function(){var e={Name:"ASR",Description:"浮筹比例",IsMainIndex:!1,Args:[],Script:"ASR:(WINNER(C*1.1)-WINNER(C*0.9))/WINNER(HHV(H,0))*100;"};return e};Z.prototype.SAR=function(){var e={Name:"SAR",Description:"抛物转向",IsMainIndex:!0,Args:[{Name:"P",Value:10},{Name:"STEP",Value:2},{Name:"MAXP",Value:20}],Script:"S:SAR(P,STEP,MAXP),UPDOWNDOT;"};return e};Z.prototype.TJCJL=function(){var e={Name:"太极成交量",Description:"太极成交量",IsMainIndex:!0,Args:[],Script:`总手:VOL,NODRAW;
DRAWTEXT_FIX(ISLASTBAR,0,0,0,"说明: 红色柱为吸货量,绿色为出货量,黄色为天量,蓝色为地量"),COLORGRAY;
ZZ:=IF(REF(C,1)>REF(O,1) AND O>REF(C,1)*1.014 AND C<O*1.02,1,3);
V5:=MA(V,5);
V12:=MA(V,12);
V34:=MA(V,34);
C6:=MA(C,6);
STICKLINE(VOL,0,VOL,3,0),COLORLIGRAY;
STICKLINE(CROSS(C,C6) AND V>V5*1.2 AND V>V12*1.2 AND ZZ>2 AND C>H*0.975,0,VOL,3,0),COLORRED;
STICKLINE(CROSS(C6,C) AND V>V5*1.2 AND V>V12*1.2,0,VOL,3,0),COLORGREEN;
STICKLINE(VOL>MA(VOL,5)*2 AND V>V34*3 AND C<REF(C,1)*1.05,0,VOL,3,0),COLORYELLOW;
STICKLINE(VOL<MA(VOL,5)/2 AND V<V12/2,0,VOL,3,0),COLORBLUE;
STICKLINE(VOL>MA(VOL,5)*2 AND V>V34*3 AND C<REF(C,1)*1.05 AND CROSS(C,C6) AND V>V5*1.2 AND V>V12*1.2 AND ZZ>2 AND C>H*0.975,VOL*0.5,0,3,0),COLORRED;
STICKLINE(VOL>MA(VOL,5)*2 AND V>V34*3 AND C<REF(C,1)*1.05 AND CROSS(C6,C) AND V>V5*1.2 AND V>V12*1.2,VOL*0.5,0,3,0),COLORRED;`};return e};Z.prototype.Dragon4_Main=function(){var e={Name:"飞龙四式",Description:"飞龙四式",IsMainIndex:!0,Args:[{Name:"N1",Value:5},{Name:"N2",Value:10},{Name:"N3",Value:50},{Name:"N4",Value:60}],Script:`蜻蜓点水:=EMA(CLOSE,N1),COLORGRAY;
魔界:=EMA(CLOSE,N2),COLORGREEN;
水:=EMA(CLOSE,N3),COLORRED;
DRAWKLINE(HIGH,OPEN,LOW,CLOSE);
生命线:MA(CLOSE,N4),COLORBLUE,LINETHICK2;
DRAWBAND(魔界,'RGB(186,225,250)',水,'RGB(253,194,124)');
DRAWBAND(蜻蜓点水,'RGB(128,138,135)',魔界,'RGB(0,0,255)');`};return e};Z.prototype.Dragon4_Fig=function(){var e={Name:"飞龙四式",Description:"飞龙四式",IsMainIndex:!1,Args:[],Script:`倍:VOL>=REF(V,1)*1.90 AND C>REF(C,1),COLORYELLOW;
低:VOL<REF(LLV(VOL,13),1),COLORGREEN;
地:VOL<REF(LLV(VOL,100),1),COLORMAGENTA; 
平:=ABS(VOL-HHV(REF(VOL,1),5))/HHV(REF(VOL,1),5)<=0.03 OR ABS(VOL-REF(VOL,1))/REF(VOL,1)<=0.03,NODRAW,COLORWHITE;
倍缩:VOL<=REF(V,1)*0.5,COLORFF8000;
梯量:COUNT(V>REF(V,1),3)==3 AND COUNT(C>O,3)==3,COLORBROWN;
缩量涨:COUNT(C>REF(C,1),2)==2 AND COUNT(V<REF(V,1),2)==2,COLORBLUE;
STICKLINE(C>=REF(C,1),V,0,2,0),COLORRED;
STICKLINE(C<REF(C,1),V,0,2,0),COLORGREEN;
STICKLINE(倍,0,V,2,0),COLORYELLOW;
STICKLINE(低,0,V,2,0),COLORGREEN;
STICKLINE(地,0,V,2,0),COLORLIMAGENTA;
STICKLINE(平,0,V,2,0),COLORGRAY;
STICKLINE(倍缩,0,V,2,0),COLORFF8000;
STICKLINE(梯量,0,V,2,0),COLORBROWN;
STICKLINE(缩量涨,0,V,2,0),COLORBLUE;`};return e};Z.prototype.FundsAnalysis=function(){var e={Name:"资金分析",Description:"资金分析",IsMainIndex:!1,Args:[{Name:"M",Value:55},{Name:"N",Value:34}],Script:`LC:=REF(CLOSE,1);
RSI:=((SMA(MAX((CLOSE - LC),0),3,1) / SMA(ABS((CLOSE - LC)),3,1)) * 100);
FF:=EMA(CLOSE,3);
MA15:=EMA(CLOSE,21); DRAWTEXT(CROSS(85,RSI),75,'▼'),COLORGREEN;
VAR1:=IF(YEAR>=2038 AND MONTH>=1,0,1);
VAR2:=REF(LOW,1)*VAR1;
VAR3:=SMA(ABS(LOW-VAR2),3,1)/SMA(MAX(LOW-VAR2,0),3,1)*100*VAR1;
VAR4:=EMA(IF(CLOSE*1.3,VAR3*10,VAR3/10),3)*VAR1;
VAR5:=LLV(LOW,30)*VAR1;
VAR6:=HHV(VAR4,30)*VAR1;
VAR7:=IF(MA(CLOSE,58),1,0)*VAR1;
VAR8:=EMA(IF(LOW<=VAR5,(VAR4+VAR6*2)/2,0),3)/618*VAR7*VAR1;
吸筹A:IF(VAR8>100,100,VAR8)*VAR1,COLORFB2F3B;
{吸筹B}STICKLINE(吸筹A>-150,0,吸筹A,8,0),COLORFB2F3B;

散户线: 100*(HHV(HIGH,M)-CLOSE)/(HHV(HIGH,M)-LLV(LOW,M)),COLORAA89BD,LINETHICK2;
RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;
K:=SMA(RSV,3,1);
D:=SMA(K,3,1);
J:=3*K-2*D;
主力线:EMA(J,5),COLORF39800,LINETHICK2;
DRAWICON(CROSS(主力线,散户线),主力线,1);
DRAWICON(CROSS(散户线,主力线),主力线,2);`};return e};Z.prototype.MarginProportion=function(){var e={Name:"融资占比(%)",Description:"融资占比",IsMainIndex:!1,Condition:{Period:[Ce.KLINE_DAY_ID]},Args:[],Script:"占比:MARGIN(2);"};return e};Z.prototype.Margin2=function(){var e={Name:"两融余额",Description:"融资融券余额",IsMainIndex:!1,Condition:{Period:[Ce.KLINE_DAY_ID]},Args:[{Name:"N",Value:5}],Script:`T1:MARGIN(1);
        T2:MA(MARGIN(1),N);`};return e};Z.prototype.Margin3=function(){var e={Name:"两融余额",Description:"融资融券余额",IsMainIndex:!1,Condition:{Period:[Ce.KLINE_DAY_ID]},Args:[{Name:"N",Value:5}],Script:`T1:=MARGIN(1);
        T2:=MA(MARGIN(1),N);
        STICKLINE(T1-T2>=0,0,T1-T2,50,T1>T2),COLORRED;
        STICKLINE(T1-T2<0,T1-T2,0,50,T1>T2),COLORGREEN;`};return e};Z.prototype.FXG_BSPoint=function(){var e={Name:"操盘BS点",Description:"操盘BS点",IsMainIndex:!0,Args:[],Script:`MA5:MA(CLOSE,5);
        MA13:MA(CLOSE,13);
        MA21:MA(CLOSE,21);
        MA34:MA(CLOSE,34);
        {MA55:MA(CLOSE,55),COLOR0000FF;}
        {MA120:=MA(CLOSE,120),COLORFFFF00;}
        天使:=EMA(C,2),COLOR000000;
        魔鬼:=EMA(SLOPE(C,21)*20+C,42),COLOR000000;
        买:=CROSS(天使,魔鬼);
        卖:=CROSS(魔鬼,天使);
        DRAWICON(买,L*0.97,13);
        DRAWICON(卖,H*1.03,14);
        DRAWKLINE_IF(天使>=魔鬼,HIGH,CLOSE,LOW,OPEN),COLORRED;
        DRAWKLINE_IF(天使<魔鬼,HIGH,CLOSE,LOW,OPEN),COLORBLUE;
        DRAWKLINE_IF(CROSS(天使,魔鬼),HIGH,CLOSE,LOW,OPEN),COLORYELLOW;
        DRAWKLINE_IF(CROSS(魔鬼,天使),HIGH,CLOSE,LOW,OPEN),COLORBLACK;`};return e};Z.prototype.FXG_INDEX=function(){var e={Name:"涨停多空线",Description:"涨停多空线",IsMainIndex:!1,Args:[],Script:`做多能量线: SMA((CLOSE-LLV(LOW,9))/(HHV(HIGH,9)-LLV(LOW,9))*100,5,1)-8,COLORRED,LINETHICK3;
做空能量线: SMA((HHV(HIGH,36)-CLOSE)/(HHV(HIGH,36)-LLV(LOW,36))*100,2,1),COLORGREEN,LINETHICK3;
20,POINTDOT,COLORF00FF0;
50,POINTDOT,COLORGREEN;
80,POINTDOT,COLORLIBLUE;`};return e};Z.prototype.FXG_INDEX2=function(){var e={Name:"涨停吸筹区",Description:"涨停吸筹区",IsMainIndex:!1,Args:[],Script:`VAR0:=EMA(HHV(HIGH,500),21); 
VAR1:=EMA(HHV(HIGH,250),21);
VAR2:=EMA(HHV(HIGH,90),21); 
VAR3:=EMA(LLV(LOW,500),21); 
VAR4:=EMA(LLV(LOW,250),21); 
VAR5:=EMA(LLV(LOW,90),21);

VAR6:=EMA((VAR3*0.96+VAR4*0.96+VAR5*0.96+VAR0*0.558+VAR1*0.558+VAR2*0.558)/6,21); 
VAR7:=EMA((VAR3*1.25+VAR4*1.23+VAR5*1.2+VAR0*0.55+VAR1*0.55+VAR2*0.65)/6,21); 
VAR8:=EMA((VAR3*1.3+VAR4*1.3+VAR5*1.3+VAR0*0.68+VAR1*0.68+VAR2*0.68)/6,21); 
VAR9:=EMA((VAR6*3+VAR7*2+VAR8)/6*1.738,21); 
VAR10:=REF(LOW,1); 
VAR11:=SMA(ABS(LOW-VAR10),3,1)/SMA(MAX(LOW-VAR10,0),3,1)*100; 
VAR12:=EMA(IFF(CLOSE*1.35<=VAR9,VAR11*10,VAR11/10),3); 
VAR13:=LLV(LOW,30); 
VAR14:=HHV(VAR12,30); 
VAR15:=IFF(MA(CLOSE,58),1,0); 
VAR16:=EMA(IFF(LOW<=VAR13,(VAR12+VAR14*2)/2,0),3)/618*VAR15;

资金入场:IFF(VAR16>0,VAR16,0),LINETHICK,LINETHICK2, COLORFF0000; 

A1:IFF(资金入场>0,资金入场*1.2,0),STICK,LINETHICK5, COLORFF0000;
A2:IFF(资金入场>0,资金入场*0.8,0),STICK,LINETHICK5, COLORFF6600;
A3:IFF(资金入场>0,资金入场*0.6,0),STICK,LINETHICK5, COLORFF9900;
A4:IFF(资金入场>0,资金入场*0.4,0) ,STICK,LINETHICK5,COLORFFCC00;
A5:IFF(资金入场>0,资金入场*0.2,0) ,STICK,LINETHICK5,COLORFFFF00;`};return e};Z.prototype.FXG_INDEX3=function(){var e={Name:"量能黄金点",Description:"量能黄金点",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:`A:=IFF((CLOSE>126.32),VOL,VOL); 
主力:=MA(A,4),COLORRED;
游资:=MA(A,8),COLORYELLOW;
大户:=MA(A,16),COLORF0F000;
散户:=MA(A,32),COLOR00FF00;
主比:=ABS(((主力)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLORRED;
游比:=ABS(((游资)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLORYELLOW;
大比:=ABS(((大户)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLORF0F000;
散比:=ABS(((散户)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLOR00FF00;
警戒线:MA(A,180),COLORFF66FF;
STICKLINE((主力 > 0),0,主力,2.5,0),COLOR1020BB;
STICKLINE((主力 > 0),0,主力,0.7,0),COLORRED;
STICKLINE((游资 > 0),0,游资,2.5,0),COLOR009CFF;
STICKLINE((游资 > 0),0,游资,0.7,0),COLORYELLOW;
STICKLINE((大户 > 0),0,大户,2.5,0),COLORFF8800;
STICKLINE((大户 > 0),0,大户,0.7,0),COLORLIBLUE;
STICKLINE((散户 > 0),0,散户,2.5,0),COLOR00CA00;
STICKLINE((散户 > 0),0,散户,0.7,0),COLORGREEN;`};return e};Z.prototype.NewsNegative=function(){var e={Name:"负面新闻",Description:"负面新闻统计",IsMainIndex:!1,FloatPrecision:0,Args:[{Name:"N",Value:5},{Name:"N2",Value:10}],Script:`负面:NEWS(1);
MA1:MA(负面,N);
MA2:MA(负面,N2);`};return e};Z.prototype.UpDownAnalyze=function(){var e={Name:"涨跌趋势",Description:"涨跌趋势",IsMainIndex:!1,FloatPrecision:0,Condition:{Period:[Ce.MINUTE_ID,Ce.MULTIDAY_MINUTE_ID,Ce.KLINE_DAY_ID]},Args:[],Script:`上涨家数:UPCOUNT('CNA.CI'),COLORRED;
下跌家数:DOWNCOUNT('CNA.CI'),COLORGREEN;`};return e};Z.prototype.HK2SHSZ=function(){var e={Name:"北上资金",Description:"北上资金",IsMainIndex:!1,FloatPrecision:0,Condition:{Period:[Ce.MINUTE_ID,Ce.MULTIDAY_MINUTE_ID,Ce.KLINE_DAY_ID]},Args:[],Script:"净流入:HK2SHSZ(1),COLORSTICK;"};return e};Z.prototype.ShareHolder=function(){var e={Name:"股东人数",Description:"股东人数",IsMainIndex:!1,FloatPrecision:0,Condition:{Period:[Ce.KLINE_DAY_ID,Ce.KLINE_MONTH_ID,Ce.KLINE_WEEK_ID,Ce.KLINE_YEAR_ID]},Args:[],Script:"人数:FINANCE(100);"};return e};Z.prototype.VOLRate=function(){var e={Name:"量比",Description:"量比",IsMainIndex:!1,Condition:{Period:[Ce.MINUTE_ID,Ce.MULTIDAY_MINUTE_ID]},Args:[],Script:"LIANGBI:VOLR;"};return e};Z.prototype.COLOR_KSTAR1=function(){var e={Name:"十字星",Description:"十字星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:CLOSE==OPEN&&HIGH>LOW;"};return e};Z.prototype.COLOR_KSTAR2=function(){var e={Name:"早晨之星",Description:"早晨之星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:(REF(CLOSE,2)/REF(OPEN,2)<0.95) && (REF(OPEN,1) < REF(CLOSE,2)) && (ABS(REF(OPEN,1)-REF(CLOSE,1))/REF(CLOSE,1)<0.03) && CLOSE/OPEN>1.05 && CLOSE>REF(CLOSE,2);"};return e};Z.prototype.COLOR_KSTAR3=function(){var e={Name:"黄昏之星",Description:"黄昏之星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:REF(CLOSE,2)/REF(OPEN,2)>1.05 && REF(OPEN,1)>REF(CLOSE,2) && ABS(REF(OPEN,1)-REF(CLOSE,1))/REF(CLOSE,1)<0.03 && CLOSE/OPEN<0.95 && CLOSE<REF(CLOSE,2);"};return e};Z.prototype.COLOR_SHI1=function(){var e={Name:"长十字",Description:"长十字",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:CLOSE==OPEN&&HIGH/LOW>1.03;"};return e};Z.prototype.COLOR_K220=function(){var e={Name:"身怀六甲",Description:"身怀六甲",IsMainIndex:!0,InstructionType:2,Script:`KSTAR:ABS(REF(CLOSE,1)-REF(OPEN,1))/REF(CLOSE,1)>0.04&&
            ABS(CLOSE-OPEN)/CLOSE<0.005&&
            MAX(CLOSE,OPEN)<MAX(REF(CLOSE,1),REF(OPEN,1))&&
            MIN(CLOSE,OPEN)>MIN(REF(CLOSE,1),REF(OPEN,1));`};return e};Z.prototype.COLOR_K300=function(){var e={Name:"三个白武士",Description:"三个白武士",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:UPNDAY(CLOSE,3)&&NDAY(CLOSE,OPEN,3);"};return e};Z.prototype.COLOR_K310=function(){var e={Name:"三只乌鸦",Description:"三只乌鸦",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:DOWNNDAY(CLOSE,3)&&NDAY(OPEN,CLOSE,3);"};return e};Z.prototype.COLOR_K380=function(){var e={Name:"光头阳线",Description:"光头阳线",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:HIGH==CLOSE&&HIGH>LOW;"};return e};Z.prototype.COLOR_K390=function(){var e={Name:"光脚阴线",Description:"光脚阴线",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:LOW==CLOSE&&HIGH>LOW;"};return e};Z.prototype.COLOR_K134=function(){var e={Name:"垂死十字",Description:"垂死十字",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:CLOSE==OPEN&&CLOSE==LOW&&CLOSE<HIGH;"};return e};Z.prototype.COLOR_K140=function(){var e={Name:"早晨十字星",Description:"早晨十字星",IsMainIndex:!0,InstructionType:2,Script:`KSTAR:REF(CLOSE,2)/REF(OPEN,2)<0.95&&
REF(OPEN,1)<REF(CLOSE,2)&&
REF(OPEN,1)==REF(CLOSE,1)&&
CLOSE/OPEN>1.05&&CLOSE>REF(CLOSE,2);`};return e};Z.prototype.COLOR_K150=function(){var e={Name:"黄昏十字星",Description:"黄昏十字星",IsMainIndex:!0,InstructionType:2,Script:`KSTAR:REF(CLOSE,2)/REF(OPEN,2)>1.05&&
REF(OPEN,1)>REF(CLOSE,2)&&
REF(OPEN,1)=REF(CLOSE,1)&&
CLOSE/OPEN<0.95&&CLOSE<REF(CLOSE,2);`};return e};Z.prototype.COLOR_K160=function(){var e={Name:"射击之星",Description:"射击之星",IsMainIndex:!0,InstructionType:2,Script:`KSTAR:MIN(OPEN,CLOSE)==LOW&&
HIGH-LOW>3*(MAX(OPEN,CLOSE)-LOW)&&
CLOSE>MA(CLOSE,5);`};return e};Z.prototype.COLOR_K165=function(){var e={Name:"倒转锤头",Description:"倒转锤头",IsMainIndex:!0,InstructionType:2,Script:`KSTAR:MIN(OPEN,CLOSE)==LOW&&
HIGH-LOW>3*(MAX(OPEN,CLOSE)-LOW)&&
CLOSE<MA(CLOSE,5);`};return e};Z.prototype.COLOR_K170=function(){var e={Name:"锤头",Description:"锤头",IsMainIndex:!0,InstructionType:2,Script:`OUT:HIGH==MAX(OPEN,CLOSE)&&
HIGH-LOW>3*(HIGH-MIN(OPEN,CLOSE))&&
CLOSE<MA(CLOSE,5);`};return e};Z.prototype.COLOR_K180=function(){var e={Name:"吊颈",Description:"吊颈",IsMainIndex:!0,InstructionType:2,Script:`OUT:HIGH==MAX(OPEN,CLOSE)&&
HIGH-LOW>3*(HIGH-MIN(OPEN,CLOSE))&&
CLOSE>MA(CLOSE,5);`};return e};Z.prototype.COLOR_K190=function(){var e={Name:"穿头破脚",Description:"穿头破脚",IsMainIndex:!0,InstructionType:2,Script:`OUT:(REF(CLOSE,1)/REF(OPEN,1)>1.03&&
CLOSE/OPEN<0.96&&
CLOSE<REF(OPEN,1)&&OPEN>REF(CLOSE,1))||
(REF(CLOSE,1)/REF(OPEN,1)<0.97&&
CLOSE/OPEN>1.04&&
CLOSE>REF(OPEN,1)&&OPEN<REF(CLOSE,1));`};return e};Z.prototype.COLOR_SWORD=function(){var e={Name:"剑",Description:"剑",IsMainIndex:!0,InstructionType:2,Script:`AA:=VOL>REF(VOL,1)||VOL>(CAPITAL*0.1);
BB:=OPEN>=(REF(HIGH,1))&&REF(HIGH,1)>(REF(HIGH,2)*1.06);
CC:=CLOSE>(REF(CLOSE,1))-(REF(CLOSE,1)*0.01);
DD:=CLOSE<(HIGH*0.965) && HIGH>(OPEN*1.05);
EE:=LOW<OPEN && LOW<CLOSE&&HIGH>(REF(CLOSE,1)*1.06);
FF:=(HIGH-(MAX(OPEN,CLOSE)))/2>(MIN(OPEN,CLOSE))-LOW;
GG:=(ABS(OPEN-CLOSE))/2<(MIN(OPEN,CLOSE)-LOW);
SWORDO:AA&&BB&&CC&&DD&&EE&&FF&&GG;`};return e};Z.prototype.COLOR_CSFR=function(){var e={Name:"出水芙蓉",Description:"出水芙蓉",IsMainIndex:!0,InstructionType:2,Script:`A:=CLOSE>OPEN;
B:=A&&CLOSE>MA(CLOSE,S)&&CLOSE>MA(CLOSE,M)&&CLOSE>MA(CLOSE,LL);
CC:=B&&OPEN<MA(CLOSE,M)&&OPEN<MA(CLOSE,LL);
CSFRO:CC&&(CLOSE-OPEN)>0.0618*CLOSE;`};return e};Z.prototype.COLOR_WYGD=function(){var e={Name:"乌云盖顶",Description:"乌云盖顶",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET( 
REF(CLOSE,1)/REF(OPEN,1)>1.03 AND 
CLOSE/OPEN<0.97 AND 
OPEN>REF(CLOSE,1) AND CLOSE<REF(CLOSE,1), 3);`};return e};Z.prototype.COLOR_SGCJ=function(){var e={Name:"曙光初现",Description:"曙光初现",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET( 
REF(CLOSE,1)/REF(OPEN,1)<0.97 AND 
CLOSE/OPEN>1.03 AND 
OPEN<REF(CLOSE,1) AND CLOSE>REF(CLOSE,1), 3);`};return e};Z.prototype.COLOR_SZTAI=function(){var e={Name:"十字胎",Description:"十字胎",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET( ABS(REF(CLOSE,1)-REF(OPEN,1))/REF(CLOSE,1) > 0.04 AND 
CLOSE==OPEN AND CLOSE < MAX(REF(CLOSE,1),REF(OPEN,1)) AND 
CLOSE > MIN(REF(CLOSE,1),REF(OPEN,1)), 2);`};return e};Z.prototype.COLOR_PINGDING=function(){var e={Name:"平顶",Description:"平顶",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET(ABS(HIGH-REF(HIGH,1))/HIGH<0.001,2);"};return e};Z.prototype.COLOR_PINGDI=function(){var e={Name:"平底",Description:"平底",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET((ABS(LOW-REF(LOW,1))/LOW<0.001 AND 
ABS(REF(LOW,1)-REF(LOW,2))/REF(LOW,1)<=0.001),2);`};return e};Z.prototype.COLOR_DAYANZHU=function(){var e={Name:"大阳烛",Description:"大阳烛",IsMainIndex:!0,InstructionType:2,Script:"VAR1:CLOSE/OPEN>1.05 AND HIGH/LOW < CLOSE/OPEN+0.018;"};return e};Z.prototype.COLOR_DAYINGZHU=function(){var e={Name:"大阴烛",Description:"大阴烛",IsMainIndex:!0,InstructionType:2,Script:"VAR1:OPEN/CLOSE > 1.05 AND HIGH/LOW < OPEN/CLOSE+0.018;"};return e};Z.prototype.COLOR_HYFG=function(){var e={Name:"好友反攻",Description:"好友反攻",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET( (REF(CLOSE,1)<REF(OPEN,1) AND 
CLOSE>OPEN AND ABS(CLOSE-REF(CLOSE,1))/CLOSE<0.002),2);`};return e};Z.prototype.COLOR_TKQK=function(){var e={Name:"跳空缺口",Description:"跳空缺口",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( HIGH<REF(LOW,1) OR LOW>REF(HIGH,1),2);"};return e};Z.prototype.COLOR_SFWY=function(){var e={Name:"双飞乌鸦",Description:"双飞乌鸦",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( REF(CLOSE,1)<REF(OPEN,1) AND CLOSE<OPEN AND CLOSE/OPEN<0.98,1);"};return e};Z.prototype.COLOR_SSSBQ=function(){var e={Name:"上升三部曲",Description:"上升三部曲",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET( 
REF(CLOSE,4)/REF(OPEN,4)>1.03 AND 
REF(CLOSE,3)<REF(OPEN,3) AND 
REF(CLOSE,2)<REF(OPEN,2) AND 
REF(CLOSE,1)<REF(OPEN,1) AND 
REF(LOW,4)<REF(LOW,3) AND 
REF(LOW,4)<REF(LOW,2) AND 
REF(LOW,4)<REF(LOW,1) AND 
REF(HIGH,4)>REF(HIGH,3) AND 
REF(HIGH,4)>REF(HIGH,2) AND 
REF(HIGH,4)>REF(HIGH,1) AND 
CLOSE/OPEN>1.03 AND 
CLOSE>REF(CLOSE,4), 5);`};return e};Z.prototype.COLOR_XDSBQ=function(){var e={Name:"下跌三部曲",Description:"下跌三部曲",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET( 
REF(CLOSE,4)/REF(OPEN,4)<0.97 AND 
REF(CLOSE,3)>REF(OPEN,3) AND 
REF(CLOSE,2)>REF(OPEN,2) AND 
REF(CLOSE,1)>REF(OPEN,1) AND 
REF(LOW,4)<REF(LOW,3) AND 
REF(LOW,4)<REF(LOW,2) AND 
REF(LOW,4)<REF(LOW,1) AND 
REF(HIGH,4)>REF(HIGH,3) AND 
REF(HIGH,4)>REF(HIGH,2) AND 
REF(HIGH,4)>REF(HIGH,1) AND 
CLOSE/OPEN<0.97 AND 
CLOSE<REF(CLOSE,4), 5);`};return e};Z.prototype.COLOR_CHXY=function(){var e={Name:"长下影",Description:"长下影",IsMainIndex:!0,InstructionType:2,Script:"VAR2:(MIN(CLOSE,OPEN)-LOW)/(HIGH-LOW)>0.667;"};return e};Z.prototype.COLOR_CHSY=function(){var e={Name:"长上影",Description:"长上影",IsMainIndex:!0,InstructionType:2,Script:"VAR2:(HIGH-MAX(CLOSE,OPEN))/(HIGH-LOW)>0.667,COLORBLUE;"};return e};Z.prototype.COLOR_FENLI=function(){var e={Name:"分离",Description:"分离",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( OPEN==REF(OPEN,1) AND (CLOSE-OPEN)*(REF(CLOSE,1)-REF(OPEN,1))<0,2);"};return e};Z.prototype.TRADE_BIAS=function(){var e={Name:"BIAS",Description:"乖离率专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:12},{Name:"LL",Value:6},{Name:"LH",Value:6}],Script:`BIAS:=(CLOSE-MA(CLOSE,N))/MA(CLOSE,N)*100;
ENTERLONG:CROSS(-LL,BIAS);
EXITLONG:CROSS(BIAS,LH);`};return e};Z.prototype.TRADE_CCI=function(){var e={Name:"CCI",Description:"CCI专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:14}],Script:`TYP:=(HIGH+LOW+CLOSE)/3;
CCI:=(TYP-MA(TYP,N))/(0.015*AVEDEV(TYP,N));
INDEX:=CCI;
ENTERLONG:CROSS(INDEX,-100);
EXITLONG:CROSS(100,INDEX);`};return e};Z.prototype.TRADE_DMI=function(){var e={Name:"DMI",Description:"趋向专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:14}],Script:`MTR:=SUM(MAX(MAX(HIGH-LOW,ABS(HIGH-REF(CLOSE,1))),ABS(LOW-REF(CLOSE,1))),N);
HD :=HIGH-REF(HIGH,1);
LD :=REF(LOW,1)-LOW;
PDM:=SUM(IF(HD>0&&HD>LD,HD,0),N);
MDM:=SUM(IF(LD>0&&LD>HD,LD,0),N);
PDI:=PDM*100/MTR;
MDI:=MDM*100/MTR;
ENTERLONG:CROSS(PDI,MDI);
EXITLONG:CROSS(MDI,PDI);`};return e};Z.prototype.TRADE_KD=function(){var e={Name:"KD",Description:"KD指标专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:`WRSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;
WK:=SMA(WRSV,M1,1);
D:=SMA(WK,M2,1);
ENTERLONG:CROSS(WK,D)&&WK<20;
EXITLONG:CROSS(D,WK)&&WK>80;`};return e};Z.prototype.TRADE_BOLL=function(){var e={Name:"BOLL",Description:"布林带专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:20}],Script:`MID :=MA(CLOSE,N);
UPPER:=MID+2*STD(CLOSE,N);
LOWER:=MID-2*STD(CLOSE,N);
ENTERLONG:CROSS(CLOSE,LOWER);
EXITLONG:CROSS(CLOSE,UPPER);`};return e};Z.prototype.TRADE_KDJ=function(){var e={Name:"KDJ",Description:"KDJ专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3}],Script:`RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;
K:=SMA(RSV,M1,1);
D:=SMA(K,M1,1);
J:=3*K-2*D;
ENTERLONG:CROSS(J,0);
EXITLONG:CROSS(100,J);`};return e};Z.prototype.TRADE_MA=function(){var e={Name:"MA",Description:"均线专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"SHORT",Value:5},{Name:"LONG",Value:20}],Script:`ENTERLONG:CROSS(MA(CLOSE,SHORT),MA(CLOSE,LONG));
EXITLONG:CROSS(MA(CLOSE,LONG),MA(CLOSE,SHORT));`};return e};Z.prototype.TRADE_MACD=function(){var e={Name:"MACD",Description:"MACD专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"LONG",Value:26},{Name:"SHORT",Value:12},{Name:"M",Value:9}],Script:`DIFF:=EMA(CLOSE,SHORT) - EMA(CLOSE,LONG);
DEA  := EMA(DIFF,M);
MACD := 2*(DIFF-DEA);
ENTERLONG:CROSS(MACD,0);
EXITLONG:CROSS(0,MACD);`};return e};Z.prototype.TRADE_MTM=function(){var e={Name:"MTM",Description:"动力指标专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:6}],Script:`WMTM:=C-REF(C,N);
ENTERLONG:CROSS(WMTM,0);
EXITLONG:CROSS(0,WMTM);`};return e};Z.prototype.TRADE_PSY=function(){var e={Name:"PSY",Description:"PSY心理线专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:12},{Name:"LL",Value:10},{Name:"LH",Value:85}],Script:`MYPSY:=COUNT(CLOSE>REF(CLOSE,1),N)/N*100;
ENTERLONG:CROSS(LL,MYPSY);
EXITLONG:CROSS(MYPSY,LH);`};return e};Z.prototype.TRADE_ROC=function(){var e={Name:"ROC",Description:"变动速率专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:`WROC:=MA(100*(CLOSE-REF(CLOSE,N))/REF(CLOSE,N),M);
ENTERLONG:CROSS(WROC,0);
EXITLONG:CROSS(0,WROC);`};return e};Z.prototype.TRADE_RSI=function(){var e={Name:"RSI",Description:"相对强弱专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:6},{Name:"LL",Value:20},{Name:"LH",Value:80}],Script:`LC:=REF(CLOSE,1);
WRSI:=SMA(MAX(CLOSE-LC,0),N,1)/SMA(ABS(CLOSE-LC),N,1)*100;
ENTERLONG:CROSS(WRSI,LL);
EXITLONG:CROSS(LH,WRSI);`};return e};Z.prototype.TRADE_VR=function(){var e={Name:"VR",Description:"VR容量比率专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:26},{Name:"LL",Value:70},{Name:"LH",Value:250}],Script:`WVR := SUM((IF(CLOSE>OPEN,VOL,0)+IF(CLOSE=OPEN,VOL/2,0)),N)/SUM((IF(CLOSE<OPEN,VOL,0)+IF(CLOSE=OPEN,VOL/2,0)),N)*100;
ENTERLONG:CROSS(LL,WVR);
EXITLONG:CROSS(WVR,LH);`};return e};Z.prototype.TRADE_DPSJ=function(){var e={Name:"DPSJ",Description:"大盘随机专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N1",Value:18},{Name:"N2",Value:12}],Script:`RSV:=(INDEXC-LLV(INDEXL,N1))/(HHV(INDEXH,N1)-LLV(INDEXL,N1))*100;
K:=SMA(RSV,N2,1);
HSL:VOL/100/(FINANCE(7));
ENTERLONG: CROSS(K,20);
EXITLONG: (CROSS(HSL,5) OR CROSS(K,80));`};return e};Z.prototype.HeikinAshi=function(){var e={Name:"平均K线",Description:"Heikin-Ashi 平均K线",IsMainIndex:!0,KLineType:-1,Args:[],Script:`HCLOSE:(OPEN+HIGH+LOW+CLOSE)/4, NODRAW;
HOPEN:(REF(OPEN,1)+REF(CLOSE,1))/2,NODRAW;
HHIGH:MAX(HIGH,MAX(HOPEN,HCLOSE)),NODRAW;
HLOW:MIN(LOW,MIN(HOPEN,HCLOSE)),NODRAW;
DRAWKLINE(HHIGH,HOPEN,HLOW,HCLOSE);`};return e};Z.prototype.ADL=function(){var e={Name:"腾落指标",Description:"腾落指标",IsMainIndex:!1,StringFormat:2,Condition:{Period:[Ce.KLINE_DAY_ID,Ce.KLINE_WEEK_ID,Ce.KLINE_TWOWEEK_ID,Ce.KLINE_MONTH_ID,Ce.KLINE_QUARTER_ID,Ce.KLINE_YEAR_ID],Include:["000001.SH","000003.SH","000016.SH","000300.SH","000905.SH","399001.SZ"," 399005.SZ","399006.SZ"]},Args:[{Name:"M",Value:7}],Script:`ADL:SUM(ADVANCE-DECLINE,0);
MAADL:MA(ADL,M);`};return e};Z.prototype.EMPTY=function(){var e={Name:"",Description:"空指标",IsMainIndex:!0,Args:[],Script:"VAR2:=C;"};return e};Z.prototype.CJL=function(){var e={Name:"CJL",Description:"期货持仓量",IsMainIndex:!1,Args:[],Script:`成交量:VOL,VOLSTICK;
持仓量:VOLINSTK,LINEOVERLAY;`};return e};Z.prototype.VOL_POSITION=function(){var e={Name:"持仓量",Description:"持仓量",IsMainIndex:!1,Args:[],Script:`成交量:VOL,VOLSTICK;
持仓量:VOLINSTK,SINGLELINE;`};return e};Z.prototype.ASI=function(){var e={Name:"ASI",Description:"振动升降指标",IsMainIndex:!1,Args:[{Name:"N1",Value:6}],Script:`X_1:=REF(CLOSE,1);
X_2:=ABS(HIGH-X_1);
X_3:=ABS(LOW-X_1);
X_4:=ABS(HIGH-REF(LOW,1));
X_5:=ABS(X_1-REF(OPEN,1));
X_6:=IF(X_2>X_3 AND X_2>X_4,X_2+X_3/2+X_5/4,IF(X_3>X_4 AND X_3>X_2,X_3+X_2/2+X_5/4,X_4+X_5/4));
X_7:=CLOSE-X_1+(CLOSE-OPEN)/2+X_1-REF(OPEN,1);
X_8:=8*X_7/X_6*MAX(X_2,X_3);
ASI:SUM(X_8,0),LINETHICK2;
MASI:MA(ASI,N1),LINETHICK2;`};return e};Z.prototype.DC=function(){var e={Name:"DC",Description:"唐奇安通道",IsMainIndex:!0,Args:[{Name:"N1",Value:20}],Script:`UPPER:HHV(H,N1),COLORBLUE,LINETHICK2;
LOWER:LLV(L,N1),COLORBLUE,LINETHICK2;
MIDDLE:(UPPER+LOWER)/2,COLORRED,LINETHICK3;`};return e};Z.prototype.DEMA=function(){var e={Name:"DEMA",Description:"双重指数移动均线",IsMainIndex:!0,Args:[{Name:"N1",Value:10}],Script:`ERR:=C-EMA(C,N1);
DEMA:EMA(C,10)+EMA(ERR,N1);`};return e};Z.prototype.VWAP=function(){var e={Name:"VWAP",Description:"成交量加权平均价",IsMainIndex:!0,Args:[{Name:"N1",Value:10}],Script:`PRICE:=(H+L+C)/3;
T2:=VOL*PRICE;
VWAP:SUM(T2,0)/SUM(VOL,0);`};return e};Z.prototype.SQJZ=function(){var e={Name:"SQJZ",Description:"神奇九转",IsMainIndex:!0,Script:`B:=C<REF(C,4);
N:=CURRBARSCOUNT;
B1:=(N=6 AND REFXV(COUNT(B,6),5)=6) OR (N=7 AND REFXV(COUNT(B,7),6)=7) OR (N=8 AND REFXV(COUNT(B,8),7)=8) OR (N>=9 AND REFXV(COUNT(B,9),8)=9);
DRAWNUMBER(B1 AND REF(B,1)=0,L,1),COLORMAGENTA;
B2:=(N=5 AND REFXV(COUNT(B,6),4)=6) OR (N=6 AND REFXV(COUNT(B,7),5)=7) OR (N=7 AND REFXV(COUNT(B,8),6)=8) OR (N>=8 AND REFXV(COUNT(B,9),7)=9);
DRAWNUMBER(B2 AND REF(B,2)=0,L,2),COLORMAGENTA;
B8:=(N=1 AND COUNT(B,8)=8) OR (N>=2 AND REFXV(COUNT(B,9),1)=9);
DRAWNUMBER(B8 AND REF(B,8)=0,L,8),COLORMAGENTA;
B9:=(N>=1 AND COUNT(B,9)=9);
DRAWNUMBER(B9 AND REF(B,9)=0,L,9),COLORBROWN;
S:=C>REF(C,4);
S1:=(N=6 AND REFXV(COUNT(S,6),5)=6) OR (N=7 AND REFXV(COUNT(S,7),6)=7) OR (N=8 AND REFXV(COUNT(S,8),7)=8) OR (N>=9 AND REFXV(COUNT(S,9),8)=9);
DRAWNUMBER(S1 AND REF(S,1)=0,H,1),COLORMAGENTA,DRAWABOVE;
S2:=(N=5 AND REFXV(COUNT(S,6),4)=6) OR (N=6 AND REFXV(COUNT(S,7),5)=7) OR (N=7 AND REFXV(COUNT(S,8),6)=8) OR (N>=8 AND REFXV(COUNT(S,9),7)=9);
DRAWNUMBER(S2 AND REF(S,2)=0,H,2),COLORMAGENTA,DRAWABOVE;
S8:=(N=1 AND COUNT(S,8)=8) OR (N>=2 AND REFXV(COUNT(S,9),1)=9);
DRAWNUMBER(S8 AND REF(S,8)=0,H,8),COLORMAGENTA,DRAWABOVE;
S9:=(N>=1 AND COUNT(S,9)=9);
DRAWNUMBER(S9 AND REF(S,9)=0,H,9),COLORGREEN,DRAWABOVE;`};return e};Z.prototype.XT=function(){var e={Name:"XT",Description:"箱体",IsMainIndex:!0,Args:[{Name:"N",Value:10}],Script:`【箱顶】:PEAK(CLOSE,N,1)*0.98;
【箱底】:TROUGH(CLOSE,N,1)*1.02;
【箱高】:100*(【箱顶】-【箱底】)/【箱底】,NODRAW;`};return e};Z.prototype.CFJT=function(){var e={Name:"CFJT",Description:"财富阶梯",IsMainIndex:!0,Script:`突破:=REF(EMA(C,14),1);
A1X:=(EMA(C,10)-突破)/突破*100;
多方:=IF(A1X>=0,REF(EMA(C,10),BARSLAST(CROSS(A1X,0))+1),DRAWNULL);
空方:=IF(A1X<0,REF(EMA(C,10),BARSLAST(CROSS(0,A1X))+1),DRAWNULL);
STICKLINE(A1X>=0,多方,突破,110,0),COLORRED;
STICKLINE(A1X<0,空方,突破,110,0),COLORGREEN;`};return e};Z.prototype.CYX=function(){var e={Name:"CYX",Description:"撑压线",IsMainIndex:!0,Args:[{Name:"N",Value:7}],Script:`Z1:=STRCAT(HYBLOCK,' ');
Z2:=STRCAT(Z1,DYBLOCK);
Z3:=STRCAT(Z2,' ');
DRAWTEXT_FIX(ISLASTBAR,0,0,0,STRCAT(Z3,GNBLOCK)),COLOR00C0C0;
A1:=REF(H,N)=HHV(H,2*N+1);
B1:=FILTER(A1,N);
C1:=BACKSET(B1,N+1);
D1:=FILTER(C1,N);
A2:=REF(L,N)=LLV(L,2*N+1);
B2:=FILTER(A2,N);
C2:=BACKSET(B2,N+1);
D2:=FILTER(C2,N);
E1:=(REF(LLV(L,2*N),1)+REF(HHV(H,2*N),1))/2;
E2:=(H+L)/2;
H1:=(D1 AND NOT(D2 AND E1>=E2)) OR ISLASTBAR OR BARSCOUNT(C)=1;
L1:=(D2 AND NOT(D1 AND E1<E2));
H2:=D1 AND NOT(D2 AND E1>=E2);
X1:=REF(BARSLAST(H1),1)+1;
F1:=BACKSET(H1 AND COUNT(L1,X1)>0,LLVBARS(IF(L1,L,10000),X1));
G1:=F1>REF(F1,1);
I1:=BACKSET(G1,2);
LD:=I1>REF(I1,1);
L2:=LD OR ISLASTBAR OR BARSCOUNT(C)=1;
X2:=REF(BARSLAST(L2),1)+1;
F2:=BACKSET(L2 AND COUNT(H2,X2)>0,HHVBARS(IF(H2,H,0),X2));
G2:=F2>REF(F2,1);
I2:=BACKSET(G2,2);
HD:=I2>REF(I2,1);
R1:=BACKSET(ISLASTBAR,BARSLAST(HD)+1);
S1:=R1>REF(R1,1);
T1:=BACKSET(ISLASTBAR,BARSLAST(LD)+1);
U1:=T1>REF(T1,1);
R2:=BACKSET(S1,REF(BARSLAST(HD),1)+2);
S2:=R2>REF(R2,1);
T2:=BACKSET(U1,REF(BARSLAST(LD),1)+2);
U2:=T2>REF(T2,1);
DRAWLINE(S2,H,S1,H,1),LINETHICK2,COLORRED;
DRAWLINE(U2,L,U1,L,1),LINETHICK2,COLORGREEN;`};return e};Z.prototype.WAVE=function(){var e={Name:"WAVE",Description:"波浪分析",IsMainIndex:!0,Args:[{Name:"N",Value:5}],Script:"ZIG(3,N);"};return e};Z.prototype.ShareholderCount=function(){var e={Name:"散户线",Description:"散户线",IsMainIndex:!1,Script:"GPJYVALUE(1,1,1);"};return e};Z.prototype.NXTS=function(){var e={Name:"NXTS",Description:"牛熊天数",IsMainIndex:!1,Args:[{Name:"N",Value:20}],Script:`Z:=ZIG(C,N);
高点:=Z>REF(Z,1) AND Z>REFX(Z,1);
低点:=Z<REF(Z,1) AND Z<REFX(Z,1);
NG:=BARSLAST(高点);
ND:=BARSLAST(低点);
D0:=DATETODAY(DATE)-DATETODAY(REF(DATE,BARSSINCE(C)));
DG:=DATETODAY(DATE)-DATETODAY(REF(DATE,NG));
DD:=DATETODAY(DATE)-DATETODAY(REF(DATE,ND));
N1:=(NG>ND OR COUNT(高点,0)=0) AND ND>0 AND (HHV(C,ND)-REF(C,ND))/REF(C,ND)>(N/100);
N2:=NG<ND AND NG>0 AND (LLV(C,NG)-REF(C,NG))/REF(C,NG)>=-(N/100);
N3:=NG<ND AND NG=0;
N4:=COUNT(低点 OR 高点,0)=0 AND (HHV(C,0)-REF(C,BARSSINCE(C)))/REF(C,BARSSINCE(C))>(N/100);
N5:=COUNT(低点,0)=0 AND NG>0 AND (LLV(C,NG)-REF(C,NG))/REF(C,NG)>=-(N/100);
N6:=COUNT(低点,0)=0 AND NG=0;
X1:=(NG<ND OR COUNT(低点,0)=0) AND NG>0 AND (LLV(C,NG)-REF(C,NG))/REF(C,NG)<-(N/100);
X2:=NG>ND AND ND>0 AND (HHV(C,ND)-REF(C,ND))/REF(C,ND)<=(N/100);
X3:=NG>ND AND ND=0;
X4:=COUNT(高点 OR 低点,0)=0 AND (LLV(C,0)-REF(C,BARSSINCE(C)))/REF(C,BARSSINCE(C))<-(N/100);
X5:=COUNT(高点,0)=0 AND ND>0 AND (HHV(C,ND)-REF(C,ND))/REF(C,ND)<=(N/100);
X6:=COUNT(高点,0)=0 AND ND=0;
牛市天数:IF(N4 OR N5 OR N6,D0,IF(N1 OR N2 OR N3,DD,0)),COLORRED;
熊市天数:IF(X4 OR X5 OR X6,D0,IF(X1 OR X2 OR X3,DG,0)),COLORGREEN;`};return e};Z.prototype.FKX=function(){var e={Name:"FKX",Description:"反K线",IsMainIndex:!1,Script:"DRAWKLINE(-LOW, -OPEN, -HIGH, -CLOSE);"};return e};Z.prototype.Margin4=function(){var e={Name:"两融资金",Description:"两融资金",IsMainIndex:!1,Script:`TMPV:=IF(FINANCE(3)==0,REF(SCJYVALUE(1,1,1),1),REF(GPJYVALUE(3,1,1),1));
TMPV1:=IF(FINANCE(3)==0,SCJYVALUE(1,1,0),GPJYVALUE(3,1,0));
两融:IF(TMPV==0 OR TMPV1==0,DRAWNULL,IF(FINANCE(3)==0,(SCJYVALUE(1,1,1)-REF(SCJYVALUE(1,1,1),1))/10000-(SCJYVALUE(1,2,1)-REF(SCJYVALUE(1,2,1),1))/10000,((GPJYVALUE(3,1,1)-REF(GPJYVALUE(3,1,1),1))-((GPJYVALUE(3,2,1)*C/10000-(REF(GPJYVALUE(3,2,1),1)*REF(C,1)/10000)))))),NODRAW;
STICKLINE(两融>0,0,两融,2,0),COLORRED;
STICKLINE(两融<0,0,两融,2,0),COLORCYAN;`};return e};Z.prototype.ZSDB=function(){var e={Name:"ZSDB",Description:"指数对比(副图,需下载日线)",IsMainIndex:!1,Script:`A:=REF(INDEXC,1);
指数涨幅:IF(A>0,(INDEXC-A)*100/A,0),NODRAW;
DRAWKLINE(INDEXH,INDEXO,INDEXL,INDEXC);`};return e};Z.prototype.NineTurns=function(){var e={Name:"神奇九转",Description:"九转指标",IsMainIndex:!0,Script:`A1:=C>REF(C,4);
A2:=C<REF(C,4);
T1:=A2 AND REF(A1,1);
T2:=A2 AND REF(T1,1);
T3:=A2 AND REF(T2,1);
T4:=A2 AND REF(T3,1);
T5:=A2 AND REF(T4,1);
T6:=A2 AND REF(T5,1);
T7:=A2 AND REF(T6,1);
T8:=A2 AND REF(T7,1);
T9:=A2 AND REF(T8,1);
T10:=A2 AND REF(T9,1);
T11:=A2 AND REF(T10,1);
T12:=A2 AND REF(T11,1);
T13:=A2 AND REF(T12,1);
T14:=A2 AND REF(T13,1);
DRAWTEXT(T1,L*0.98,'1'),COLORGREEN;
DRAWTEXT(T2,L*0.98,'2'),COLORGREEN;
DRAWTEXT(T3,L*0.98,'3'),COLORGREEN;
DRAWTEXT(T4,L*0.98,'4'),COLORGREEN;
DRAWTEXT(T5,L*0.98,'5'),COLORGREEN;
DRAWTEXT(T6,L*0.98,'6'),COLORGREEN;
DRAWTEXT(T7,L*0.98,'7'),COLORGREEN;
DRAWTEXT(T8,L*0.98,'8'),COLORGREEN;
DRAWTEXT(T9,L*0.98,'9'),COLORBLUE;
B1:=C<REF(C,4);
B2:=C>REF(C,4);
D1:=B2 AND REF(B1,1);
D2:=B2 AND REF(D1,1);
D3:=B2 AND REF(D2,1);
D4:=B2 AND REF(D3,1);
D5:=B2 AND REF(D4,1);
D6:=B2 AND REF(D5,1);
D7:=B2 AND REF(D6,1);
D8:=B2 AND REF(D7,1);
D9:=B2 AND REF(D8,1);
D10:=B2 AND REF(D9,1);
D11:=B2 AND REF(D10,1);
D12:=B2 AND REF(D11,1);
D13:=B2 AND REF(D12,1);
D14:=B2 AND REF(D13,1);
DRAWTEXT(D1,H*1.010,'1'),COLORBLUE;
DRAWTEXT(D2,H*1.010,'2'),COLORBLUE;
DRAWTEXT(D3,H*1.010,'3'),COLORBLUE;
DRAWTEXT(D4,H*1.010,'4'),COLORBLUE;
DRAWTEXT(D5,H*1.010,'5'),COLORBLUE;
DRAWTEXT(D6,H*1.010,'6'),COLORBLUE;
DRAWTEXT(D7,H*1.010,'7'),COLORBLUE;
DRAWTEXT(D8,H*1.010,'8'),COLORBLUE;
DRAWTEXT(D9,H*1.010,'9'),COLORGREEN;`};return e};Z.prototype.ICHIMOKU=function(){var e={Name:"ICHIMOKU",Description:"一目均衡图",IsMainIndex:!0,Args:[{Name:"SHORT",Value:7},{Name:"MID",Value:22},{Name:"LONG",Value:44}],Script:`转换线:(HHV(H,SHORT)+LLV(L,SHORT))/2,COLORRED,LINETHICK2;
基准线:(HHV(H,MID)+LLV(L,MID))/2,COLORFF8040,LINETHICK2;
迟行带:REFXV(C,MID),COLORGRAY,LINETHICK2;
A:=REF((转换线+基准线)/2,MID);
B:=REF((HHV(H,LONG)+LLV(L,LONG))/2,MID);
STICKLINE(A<B,A,B,2,1),COLOR339933;
STICKLINE(A>=B,A,B,2,1),COLOR0033CC;
先行带A:PLOYLINE(1,A),COLORBROWN;
先行带B:PLOYLINE(1,B),COLORLIGREEN;`};return e};Z.prototype.CDP_STD=function(){var e={Name:"CDP-STD",Description:"逆势操作",IsMainIndex:!0,Script:`CH:=REF(H,1);
CL:=REF(L,1);
CC:=REF(C,1);
CDP:(CH+CL+CC)/3;
AH:2*CDP+CH-2*CL;
NH:CDP+CDP-CL;
NL:CDP+CDP-CH;
AL:2*CDP-2*CH+CL;`};return e};Z.prototype.TBP_STD=function(){var e={Name:"TBP-STD",Description:"趋势平衡点",IsMainIndex:!0,Script:`APX:=(H+L+C)/3;
TR0:=MAX(H-L,MAX(ABS(H-REF(C,1)),ABS(L-REF(C,1))));
MF0:=C-REF(C,2);
MF1:=REF(MF0,1);
MF2:=REF(MF0,2);
DIRECT1:=BARSLAST(MF0>MF1 AND MF0>MF2);
DIRECT2:=BARSLAST(MF0<MF1 AND MF0<MF2);
DIRECT0:=IF(DIRECT1<DIRECT2,100,-100);
TBP:REF(REF(C,1)+IF(DIRECT0>50,MIN(MF0,MF1),MAX(MF0,MF1)),1);
多头获利:REF(IF(DIRECT0>50,APX*2-L,DRAWNULL),1),NODRAW;
多头停损:REF(IF(DIRECT0>50,APX-TR0,DRAWNULL),1),NODRAW;
空头回补:REF(IF(DIRECT0<-50,APX*2-H,DRAWNULL),1),NODRAW;
空头停损:REF(IF(DIRECT0<-50,APX+TR0,DRAWNULL),1),NODRAW;`};return e};Z.prototype.ADX=function(){var e={Name:"ADX",Description:"均趋向指标",IsMainIndex:!1,Args:[{Name:"N",Value:14}],Script:`TR1:=SMA(MAX(MAX(HIGH-LOW,ABS(HIGH-REF(CLOSE,1))),ABS(LOW-REF(CLOSE,1))),N,1);
HD:=HIGH-REF(HIGH,1);
LD:=REF(LOW,1)-LOW;
DMP:=SMA(IF(HD>0 AND HD>LD,HD,0),N,1);
DMM:=SMA(IF(LD>0 AND LD>HD,LD,0),N,1);
PDI:DMP*100/TR1,COLORRED,DOTLINE;
MDI:DMM*100/TR1,COLORGREEN,DOTLINE;
ADX:SMA(ABS(MDI-PDI)/(MDI+PDI)*100,N,1),COLORYELLOW,LINETHICK2;
20;
40;`};return e};Z.prototype.ZNZ_CBAND=function(){var e={Name:"ZNZ_CBAND",Description:"优化成本布林带宽",IsMainIndex:!1,Args:[{Name:"N",Value:20}],Script:`A:=AMOUNT/(100*VOL);
BBI1:=MA(A,N);
UPR0:=BBI1+STD(A,N);
DWN0:=BBI1-STD(A,N);
UPR1:=BBI1+1.7*STD(A,N);
DWN1:=BBI1-1.7*STD(A,N);
优化成本布林带宽:100*1.7*STD(A,N);`};return e};Z.prototype.ZNZ_RPY2=function(){var e={Name:"ZNZ_RPY2",Description:"两年相对价位",IsMainIndex:!1,Script:`A:=REF(HHV(CLOSE,480),1);
B:=REF(LLV(CLOSE,480),1);
100*(CLOSE-B)/(A-B);`};return e};Z.prototype.ZNZ_RPY1=function(){var e={Name:"ZNZ_RPY1",Description:"年相对价位",IsMainIndex:!1,Args:[{Name:"N",Value:240}],Script:`A:=REF(HHV(CLOSE,N),1);
B:=REF(LLV(CLOSE,N),1);
100*(CLOSE-B)/(A-B);`};return e};Z.prototype.TEST=function(){var e={Name:"TEST",Description:"测试脚本",IsMainIndex:!1,Args:[{Name:"N",Value:10}],Script:"DRAWCHANNEL(OPEN>C,H,L, 'RGB(255,94,102)', 2 ,'5,5','RGBA(58,20,62,0.3)' );"};return e};if(!k)var k={Chart:{Log:console.log,Warn:console.warn},Complier:{Log:console.log,Warn:console.warn}};function Ht(e,a,r){this.DivElement=e,this.DivToolElement=null,this.JSChartContainer,this.ResizeListener,this.CanvasElement=document.createElement("canvas"),this.CanvasElement.className="jschart-drawing",this.CanvasElement.id=Re(),this.CanvasElement.setAttribute("tabindex",0),this.CanvasElement.style&&(this.CanvasElement.style.outline="none"),e.hasChildNodes()&&k.Chart.Log("[JSChart::JSChart] divElement hasChildNodes",e.childNodes),e.appendChild(this.CanvasElement),this.OffscreenCanvasElement,a==!0&&(this.OffscreenCanvasElement=document.createElement("canvas")),this.CacheCanvasElement=null,r&&(this.CacheCanvasElement=document.createElement("canvas")),this.MapExtraCanvasElement=new Dt.default,this.CreateExtraCanvasElement=function(t,n){if(this.MapExtraCanvasElement.has(t))return this.MapExtraCanvasElement.get(t);var s=document.createElement("canvas");s.className="jschart-drawing-extra",s.id=Re(),t==Ht.CorssCursorCanvasKey?s.setAttribute("tabindex",5):s.setAttribute("tabindex",1),s.style&&(s.style.outline="none",s.style.position="absolute",s.style.left="0px",s.style.top="0px",s.style["pointer-events"]="none"),n&&(v.IsNumber(n.TabIndex)&&s.setAttribute("tabindex",n.TabIndex),v.IsNumber(n.ZIndex)&&(s.style["z-index"]=n.ZIndex)),this.CanvasElement&&(s.height=this.CanvasElement.height,s.width=this.CanvasElement.width,s.style&&(s.style.width=this.CanvasElement.style.width,s.style.height=this.CanvasElement.style.height)),e.appendChild(s);var o={Element:s,Canvas:null};this.MapExtraCanvasElement.set(t,o)},this.GetExtraCanvas=function(t){if(!this.MapExtraCanvasElement.has(t))return null;var n=this.MapExtraCanvasElement.get(t);return n.Element?(n.Canvas||(n.Canvas=n.Element.getContext("2d")),n):null},this.OnSize=function(t){var n=this.DivElement.offsetHeight,s=this.DivElement.offsetWidth;this.DivElement.style.height&&this.DivElement.style.width&&(this.DivElement.style.height.includes("px")&&(n=parseInt(this.DivElement.style.height.replace("px",""))),this.DivElement.style.width.includes("px")&&(s=parseInt(this.DivElement.style.width.replace("px","")))),this.ToolElement&&(n-=this.ToolElement.style.height.replace("px","")),this.CanvasElement.height=n,this.CanvasElement.width=s,this.CanvasElement.style.width=this.CanvasElement.width+"px",this.CanvasElement.style.height=this.CanvasElement.height+"px";var o=B();this.CanvasElement.height*=o,this.CanvasElement.width*=o,this.OffscreenCanvasElement&&(this.OffscreenCanvasElement.height=this.CanvasElement.height,this.OffscreenCanvasElement.width=this.CanvasElement.width),this.CacheCanvasElement&&(this.CacheCanvasElement.height=this.CanvasElement.height,this.CacheCanvasElement.width=this.CanvasElement.width);var l=!0,h=!1,u=void 0;try{for(var f=(0,ye.default)(this.MapExtraCanvasElement),C;!(l=(C=f.next()).done);l=!0){var D=C.value,c=D[1],T=c.Element;T&&(T.height=this.CanvasElement.height,T.width=this.CanvasElement.width,T.style.width=this.CanvasElement.style.width,T.style.height=this.CanvasElement.style.height)}}catch(S){h=!0,u=S}finally{try{!l&&f.return&&f.return()}finally{if(h)throw u}}k.Chart.Log("[JSChart::OnSize] devicePixelRatio="+window.devicePixelRatio+", height="+this.CanvasElement.height+", width="+this.CanvasElement.width),!(t&&t.Redraw==!1)&&this.JSChartContainer&&(t&&t.XYSplit===!0&&this.JSChartContainer.ResetFrameXYSplit(),this.JSChartContainer.OnSize&&t&&t.Type==1?this.JSChartContainer.OnSize():this.JSChartContainer.ShowAllKLine&&t&&t.Type==2?this.JSChartContainer.ShowAllKLine():(this.JSChartContainer.Frame&&this.JSChartContainer.Frame.SetSizeChage(!0),this.JSChartContainer.Draw()))},this.AdjustChartBorder=function(t){var n=B();if(t.Frame.ChartBorder.Left*=n,t.Frame.ChartBorder.Right*=n,t.Frame.ChartBorder.Top*=n,t.Frame.ChartBorder.Bottom*=n,t.Frame.AutoLeftBorder){var s=t.Frame.AutoLeftBorder;v.IsNumber(s.MinWidth)&&(s.MinWidth*=n),v.IsNumber(s.Blank)&&(s.Blank*=n)}if(t.Frame.AutoRightBorder){var s=t.Frame.AutoRightBorder;v.IsNumber(s.MinWidth)&&(s.MinWidth*=n),v.IsNumber(s.Blank)&&(s.Blank*=n)}},this.AdjustTitleHeight=function(t){for(var n=B(),s=0;s<t.Frame.SubFrame.length;++s)t.Frame.SubFrame[s].Frame.ChartBorder.TitleHeight*=n;t.ChartCorssCursor.TextHeight*=n},this.SetChartBorder=function(t,n){if(n.Border){var s=n.Border;v.IsNumber(n.Border.Left)?t.Frame.ChartBorder.Left=n.Border.Left:n.Border.Left=t.Frame.ChartBorder.Left,v.IsNumber(n.Border.Right)?t.Frame.ChartBorder.Right=n.Border.Right:n.Border.Right=t.Frame.ChartBorder.Right,v.IsNumber(n.Border.Top)?t.Frame.ChartBorder.Top=n.Border.Top:n.Border.Top=t.Frame.ChartBorder.Top,v.IsNumber(n.Border.Bottom)?t.Frame.ChartBorder.Bottom=n.Border.Bottom:n.Border.Bottom=t.Frame.ChartBorder.Bottom,s.AutoLeft&&(t.Frame.AutoLeftBorder={},v.IsNumber(s.AutoLeft.Blank)&&(t.Frame.AutoLeftBorder.Blank=s.AutoLeft.Blank),v.IsNumber(s.AutoLeft.MinWidth)&&(t.Frame.AutoLeftBorder.MinWidth=s.AutoLeft.MinWidth)),s.AutoRight&&(t.Frame.AutoRightBorder={},v.IsNumber(s.AutoRight.Blank)&&(t.Frame.AutoRightBorder.Blank=s.AutoRight.Blank),v.IsNumber(s.AutoRight.MinWidth)&&(t.Frame.AutoRightBorder.MinWidth=s.AutoRight.MinWidth))}},this.SetEventCallback=function(t,n){if(t&&v.IsNonEmptyArray(n))for(var s=0;s<n.length;++s){var o=n[s];t.AddEventCallback(o)}},this.CreateKLineChartContainer=function(t){var n=this,s=null;t.Type==="历史K线图横屏"?s=new pD(this.CanvasElement):s=new de(this.CanvasElement,this.OffscreenCanvasElement,this.CacheCanvasElement),s.GetExtraCanvas=function(W){return n.GetExtraCanvas(W)};var o=this.GetExtraCanvas(Ht.CorssCursorCanvasKey);o&&s.SetCorssCursorElement(o),t.EventCallback&&this.SetEventCallback(s,t.EventCallback),t.NetworkFilter&&(s.NetworkFilter=t.NetworkFilter);var l=B();if(v.IsBool(t.IsShowRightMenu)&&(s.IsShowRightMenu=t.IsShowRightMenu),t.ScriptError&&(s.ScriptErrorCallback=t.ScriptError),t.EnableScrollUpDown==!0&&(s.EnableScrollUpDown=t.EnableScrollUpDown),t.DisableMouse==!0&&(s.DisableMouse=t.DisableMouse),t.TouchMoveMinAngle&&(s.TouchMoveMinAngle=t.TouchMoveMinAngle),t.EnableZoomUpDown&&(s.EnableZoomUpDown=t.EnableZoomUpDown),v.IsString(t.SplashTitle)&&(s.LoadDataSplashTitle=t.SplashTitle),v.IsBool(t.EnableZoomIndexWindow)&&(s.EnableZoomIndexWindow=t.EnableZoomIndexWindow),v.IsBool(t.IsDrawPictureXY)&&(s.IsDrawPictureXY=t.IsDrawPictureXY),v.IsNumber(t.CtrlMoveStep)&&(s.CtrlMoveStep=t.CtrlMoveStep),v.IsBool(t.EnableIndexChartDrag)&&(s.EnableIndexChartDrag=t.EnableIndexChartDrag),v.IsBool(t.EnableVerifyRecvData)&&(s.EnableVerifyRecvData=t.EnableVerifyRecvData),t.GlobalOption){var h=t.GlobalOption;if(v.IsBool(h.IsValueFullRange)&&(s.GlobalOption.IsValueFullRange=h.IsValueFullRange),h.SelectedBorder){var u=h.SelectedBorder;v.IsNumber(u.Mode)&&(s.GlobalOption.SelectedBorder.Mode=u.Mode)}}if(t.EnableYDrag){var h=t.EnableYDrag;v.IsBool(h.Left)&&(s.EnableYDrag.Left=h.Left),v.IsBool(h.Right)&&(s.EnableYDrag.Right=h.Right),v.IsBool(h.Wheel)&&(s.EnableYDrag.Wheel=h.Wheel),v.IsNumber(h.WheelYMove)&&(s.EnableYDrag.WheelYMove=h.WheelYMove)}if(t.KLineTooltip){var h=t.KLineTooltip;v.IsBool(h.Enable)&&(s.KLineTooltipConfig.Enable=h.Enable),v.IsBool(h.EnableKeyDown)&&(s.KLineTooltipConfig.EnableKeyDown=h.EnableKeyDown)}if(t.KLine){var h=t.KLine;t.KLine.DragMode>=0&&(s.DragMode=t.KLine.DragMode),t.KLine.Right>=0&&(s.Right=t.KLine.Right),t.KLine.Period>=0&&(s.Period=t.KLine.Period),t.KLine.MaxReqeustDataCount>0&&(s.MaxRequestDataCount=t.KLine.MaxReqeustDataCount),t.KLine.MaxRequestDataCount>0&&(s.MaxRequestDataCount=t.KLine.MaxRequestDataCount),t.KLine.Info&&t.KLine.Info.length>0&&s.SetKLineInfo(t.KLine.Info,!1),v.IsBool(h.IsShowTooltip)&&(s.IsShowTooltip=h.IsShowTooltip),t.KLine.MaxRequestMinuteDayCount>0&&(s.MaxRequestMinuteDayCount=t.KLine.MaxRequestMinuteDayCount),t.KLine.DrawType&&(s.KLineDrawType=t.KLine.DrawType),t.KLine.FirstShowDate>19910101&&(s.CustomShow={Date:t.KLine.FirstShowDate,PageSize:t.KLine.PageSize});//!!已弃用 新的格式"CustomShow"
t.KLine.RightSpaceCount>0&&(s.RightSpaceCount=t.KLine.RightSpaceCount),t.KLine.ZoomType>0&&(s.ZoomType=t.KLine.ZoomType),t.KLine.DataWidth>=1&&(s.KLineSize={DataWidth:t.KLine.DataWidth}),v.IsNumber(t.KLine.RightFormula)&&(s.RightFormula=t.KLine.RightFormula)}if(t.CustomShow&&v.IsPlusNumber(t.CustomShow.Date)){var h=t.CustomShow;s.CustomShow={Date:h.Date},v.IsNumber(h.Time)&&(s.CustomShow.Time=h.Time),v.IsPlusNumber(h.PageSize)&&(s.CustomShow.PageSize=h.PageSize)}if(t.EnableFlowCapital){var h=t.EnableFlowCapital;h.BIT==!0&&(s.EnableFlowCapital.BIT=h.BIT)}if(v.IsBool(t.EnableBorderDrag)&&(s.EnableBorderDrag=t.EnableBorderDrag),t.Page&&(t.Page.Day&&t.Page.Day.Enable==!0&&(s.Page.Day.Enable=!0),t.Page.Minute&&t.Page.Minute.Enable==!0&&(s.Page.Minute.Enable=!0)),t.DragDownload&&(t.DragDownload.Day&&t.DragDownload.Day.Enable==!0&&(s.DragDownload.Day.Enable=!0),t.DragDownload.Minute&&t.DragDownload.Minute.Enable==!0&&(s.DragDownload.Minute.Enable=!0)),t.ZoomDownload&&(t.ZoomDownload.Day&&v.IsBool(t.ZoomDownload.Day.Enable)&&(s.ZoomDownload.Day.Enable=t.ZoomDownload.Day.Enable),t.ZoomDownload.Minute&&v.IsBool(t.ZoomDownload.Minute.Enable)&&(s.ZoomDownload.Minute.Enable=t.ZoomDownload.Minute.Enable)),t.Language){var f=St.GetLanguageID(t.Language);v.IsNumber(f)&&(s.LanguageID=f)}if(t.SourceDatatLimit&&s.SetSourceDatatLimit(t.SourceDatatLimit),t.DrawPicture&&t.DrawPicture.StorageKey&&s.ChartDrawStorage&&s.ChartDrawStorage.Load(t.DrawPicture.StorageKey),t.DrawTool&&t.DrawTool.StorageKey&&s.ChartDrawStorage&&s.ChartDrawStorage.Load(t.DrawTool.StorageKey),v.IsNumber(t.StepPixel)&&(s.StepPixel=t.StepPixel),t.ZoomStepPixel>0&&(s.ZoomStepPixel=t.ZoomStepPixel),t.IsApiPeriod==!0&&(s.IsApiPeriod=t.IsApiPeriod),t.SelectedChart){var h=t.SelectedChart;v.IsBool(h.EnableSelected)&&(s.SelectedChart.EnableSelected=h.EnableSelected),v.IsBool(h.EnableMoveOn)&&(s.SelectedChart.EnableMoveOn=h.EnableMoveOn)}if(!t.Windows||t.Windows.length<=0)return null;if(v.IsNonEmptyArray(t.KLineCalcOption))for(var C=0;C<t.KLineCalcOption.length;++C){var h=t.KLineCalcOption[C];!h.ClassName||!h.Option||s.SetKLineCalcOption(h.ClassName,h.Option)}if(s.ClassName=="KLineChartContainer"&&(t.DragSelectRect||(t.DragSelectRect={Enable:!0}),t.DragSelectRect)){var D=10,h=t.DragSelectRect;v.IsNumber(h.ZIndex)&&(D=h.ZIndex),h.Enable&&this.CreateExtraCanvasElement(Ht.RectDragCanvasKey,{ZIndex:D})}if(s.Create(t.Windows.length,t),this.SetChartBorder(s,t),this.AdjustChartBorder(s),t.KLine&&t.KLine.PageSize>0){var c=s.GetMaxMinPageSize();c.Max>10&&c.Max<t.KLine.PageSize?s.PageSize=c.Max:c.Min>10&&c.Min>t.KLine.PageSize?s.PageSize=c.Min:s.PageSize=t.KLine.PageSize}if(t.IsCorssOnlyDrawKLine===!0&&(s.ChartCorssCursor.IsOnlyDrawKLine=t.IsCorssOnlyDrawKLine),t.CorssCursorTouchEnd===!0&&(s.CorssCursorTouchEnd=t.CorssCursorTouchEnd),t.IsClickShowCorssCursor==!0&&(s.IsClickShowCorssCursor=t.IsClickShowCorssCursor),t.CorssCursorInfo){var h=t.CorssCursorInfo;isNaN(t.CorssCursorInfo.Left)||(s.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),isNaN(t.CorssCursorInfo.Right)||(s.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),isNaN(t.CorssCursorInfo.Bottom)||(s.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),t.CorssCursorInfo.IsShowCorss===!1&&(s.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),v.IsBool(h.IsShowClose)&&(s.ChartCorssCursor.IsShowClose=h.IsShowClose),v.IsBool(h.IsOnlyDrawKLine)&&(s.ChartCorssCursor.IsOnlyDrawKLine=h.IsOnlyDrawKLine),t.CorssCursorInfo.PressTime&&(s.PressTime=t.CorssCursorInfo.PressTime),v.IsNumber(t.CorssCursorInfo.HPenType)&&(s.ChartCorssCursor.HPenType=t.CorssCursorInfo.HPenType),t.CorssCursorInfo.VPenType>0&&(s.ChartCorssCursor.VPenType=t.CorssCursorInfo.VPenType),v.IsNumber(h.VLineType)&&(s.ChartCorssCursor.VLineType=h.VLineType),t.CorssCursorInfo.DateFormatType>0&&(s.ChartCorssCursor.StringFormatX.DateFormatType=t.CorssCursorInfo.DateFormatType),v.IsBool(h.IsDrawXRangeBG)&&(s.ChartCorssCursor.IsDrawXRangeBG=h.IsDrawXRangeBG),v.IsBool(t.CorssCursorInfo.IsFixXLastTime)&&(s.ChartCorssCursor.IsFixXLastTime=t.CorssCursorInfo.IsFixXLastTime),v.IsNumber(h.TextHeight)&&(s.ChartCorssCursor.TextHeight=h.TextHeight),h.RightButton&&v.IsBool(h.RightButton.Enable)&&(s.ChartCorssCursor.RightButton.Enable=h.RightButton.Enable),v.IsNumber(h.PriceFormatType)&&(s.ChartCorssCursor.StringFormatY.PriceFormatType=h.PriceFormatType),v.IsNumber(h.DataFormatType)&&(s.ChartCorssCursor.StringFormatY.DataFormatType=h.DataFormatType),v.IsBool(h.EnableKeyboard)&&(s.ChartCorssCursor.EnableKeyboard=h.EnableKeyboard)}if(t.CorssCursor={},t.CorssCursor.TitleHeight=s.ChartCorssCursor.TextHeight,v.IsNumber(t.SplashTitlePosition)&&s.ChartSplashPaint&&(s.ChartSplashPaint.Position=t.SplashTitlePosition),t.Frame)for(var C=0;C<t.Frame.length;++C){var h=t.Frame[C];if(s.Frame.SubFrame[C]){var T=s.Frame.SubFrame[C].Frame;v.IsNumber(h.SplitCount)&&(s.Frame.SubFrame[C].Frame.YSplitOperator.SplitCount=h.SplitCount),h.StringFormat&&(s.Frame.SubFrame[C].Frame.YSplitOperator.StringFormat=h.StringFormat),v.IsNumber(h.FloatPrecision)&&(s.Frame.SubFrame[C].Frame.YSplitOperator.FloatPrecision=h.FloatPrecision),h.Custom&&(s.Frame.SubFrame[C].Frame.YSplitOperator.Custom=h.Custom),v.IsNumber(h.SplitType)&&(s.Frame.SubFrame[C].Frame.YSplitOperator.SplitType=h.SplitType,s.Frame.SubFrame[C].Frame.YSplitOperator.DefaultSplitType=h.SplitType),v.IsNumber(h.FilterType)&&(T.YSplitOperator.FilterType=h.FilterType),isNaN(h.Height)||(s.Frame.SubFrame[C].Height=h.Height),(h.IsShowLeftText===!1||h.IsShowLeftText===!0)&&(s.Frame.SubFrame[C].Frame.IsShowYText[0]=h.IsShowLeftText,s.Frame.SubFrame[C].Frame.YSplitOperator.IsShowLeftText=h.IsShowLeftText),(h.IsShowRightText===!1||h.IsShowRightText===!0)&&(s.Frame.SubFrame[C].Frame.IsShowYText[1]=h.IsShowRightText,s.Frame.SubFrame[C].Frame.YSplitOperator.IsShowRightText=h.IsShowRightText),h.TopSpace>=0&&(s.Frame.SubFrame[C].Frame.ChartBorder.TopSpace=h.TopSpace*l),h.BottomSpace>=0&&(s.Frame.SubFrame[C].Frame.ChartBorder.BottomSpace=h.BottomSpace*l),h.RightTextPosition>0&&(s.Frame.SubFrame[C].Frame.YTextPosition[1]=h.RightTextPosition),h.LeftTextPosition>0&&(s.Frame.SubFrame[C].Frame.YTextPosition[0]=h.LeftTextPosition),h.IsShowXLine==!1&&(s.Frame.SubFrame[C].Frame.IsShowXLine=h.IsShowXLine),h.IsShowYLine==!1&&(s.Frame.SubFrame[C].Frame.IsShowYLine=h.IsShowYLine),v.IsNumber(h.YTextBaseline)&&(s.Frame.SubFrame[C].Frame.YTextBaseline=h.YTextBaseline),h.YCoordinateType>0&&(s.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=h.YCoordinateType),h.IsYReverse==!0&&(s.Frame.SubFrame[0].Frame.CoordinateType=1),v.IsNumber(h.PercentageTextFormat)&&(T.YSplitOperator.PercentageTextFormat=h.PercentageTextFormat),h.DefaultYMaxMin&&(s.Frame.SubFrame[C].Frame.YSplitOperator.DefaultYMaxMin=h.DefaultYMaxMin),v.IsBool(h.EnableRemoveZero)&&(s.Frame.SubFrame[C].Frame.YSplitOperator.EnableRemoveZero=h.EnableRemoveZero),v.IsPlusNumber(h.MinYDistance)&&(s.Frame.SubFrame[C].Frame.MinYDistance=h.MinYDistance),v.IsNumber(h.BorderLine)&&(s.Frame.SubFrame[C].Frame.BorderLine=h.BorderLine),v.IsBool(h.IsShowIndexTitle)&&(s.Frame.SubFrame[C].Frame.IsShowIndexTitle=h.IsShowIndexTitle),v.IsBool(h.IsDrawTitleBottomLine)&&(T.IsDrawTitleBottomLine=h.IsDrawTitleBottomLine),v.IsBool(h.IsShowNameArrow)&&(s.Frame.SubFrame[C].Frame.IsShowNameArrow=h.IsShowNameArrow),h.ClientBGColor&&(T.ClientBGColor=h.ClientBGColor)}}if(t.KLine){var h=t.KLine,S=s.ChartPaint[0];t.KLine.ShowKLine==!1&&(S.IsShow=!1),t.KLine.InfoPosition>0&&(S.InfoPosition=t.KLine.InfoPosition),v.IsBool(h.IsShowMaxMinPrice)&&(S.IsShowMaxMinPrice=h.IsShowMaxMinPrice),v.IsNumber(h.OneLimitBarType)&&(S.OneLimitBarType=h.OneLimitBarType),h.PriceGap&&(v.IsBool(h.PriceGap.Enable)&&(S.PriceGap.Enable=h.PriceGap.Enable),v.IsNumber(h.PriceGap.Count)&&(S.PriceGap.Count=h.PriceGap.Count))}if(t.KLineTitle){var h=t.KLineTitle,I=s.TitlePaint[0];if(t.KLineTitle.IsShowName==!1&&(s.TitlePaint[0].IsShowName=!1),t.KLineTitle.IsShowSettingInfo==!1&&(s.TitlePaint[0].IsShowSettingInfo=!1),t.KLineTitle.IsShow==!1&&(s.TitlePaint[0].IsShow=!1),v.IsBool(h.IsTitleShowLatestData)&&(s.IsTitleShowLatestData=h.IsTitleShowLatestData),h.ShowPosition||h.ShowPostion){var u=h.ShowPostion;h.ShowPosition&&(u=h.ShowPosition),I.ShowPositionConfig||(I.ShowPositionConfig={Margin:{}}),v.IsNumber(u.Type)&&(I.ShowPositionConfig.Type=u.Type),u.Margin&&(v.IsNumber(u.Margin.Left)&&(I.ShowPositionConfig.Margin.Left=u.Margin.Left),v.IsNumber(u.Margin.Right)&&(I.ShowPositionConfig.Margin.Right=u.Margin.Right),v.IsNumber(u.Margin.Bottom)&&(I.ShowPositionConfig.Margin.Bottom=u.Margin.Bottom))}}if(t.Overlay)for(var C=0;C<t.Overlay.length;++C){var h=t.Overlay[C];s.OverlaySymbol(h.Symbol,h)}if(t.ExtendChart)for(var C=0;C<t.ExtendChart.length;++C){var h=t.ExtendChart[C];s.CreateExtendChart(h.Name,h)}var g=new Z;if(t.ColorIndex){var h=t.ColorIndex,E=g.Get(h.Index);E&&(E.ID=h.Index,s.ColorIndex=new Ie(E.Name,E.Script,E.Args,E))}if(t.TradeIndex){var h=t.TradeIndex,F=g.Get(h.Index);F&&(F.ID=h.Index,s.TradeIndex=new Ie(F.Name,F.Script,F.Args,F))}for(var C=0;C<t.Windows.length;++C){var h=t.Windows[C];if(h.Script)s.WindowIndex[C]=new Ie(h.Name,h.Script,h.Args,h);else if(h.JsonData)s.WindowIndex[C]=new Om(h.Name,h.Script,h.Args,h);else if(h.Local&&h.Local.Data)s.WindowIndex[C]=new rg(h.Local.Name,h.Local.Args,{JsonData:h.Local.Data});else if(h.API){var R=h.API;s.WindowIndex[C]=new ga(R.Name,R.Script,R.Args,h)}else{var A=$a.Get(h.Index);if(A)s.WindowIndex[C]=A.Create(h.Option),s.WindowIndex[C].SetArgs&&s.WindowIndex[C].SetArgs(h.Args),s.CreateWindowIndex(C);else{var g=new Z,P=g.Get(h.Index);if(!P)continue;Z.ModifyAttribute(P,h),P.ID=h.Index,s.WindowIndex[C]=new Ie(P.Name,P.Script,P.Args,P),h.StringFormat>0&&(s.WindowIndex[C].StringFormat=h.StringFormat),h.FloatPrecision>=0&&(s.WindowIndex[C].FloatPrecision=h.FloatPrecision)}}var p=s.Frame.SubFrame[C].Frame;v.IsBool(h.Modify)&&(p.ModifyIndex=h.Modify),v.IsBool(h.Change)&&(p.ChangeIndex=h.Change),v.IsBool(h.Close)&&(p.CloseIndex=h.Close),v.IsBool(h.Overlay)&&(p.OverlayIndex=h.Overlay),v.IsBool(h.Export)&&(p.ExportData=h.Export),v.IsBool(h.MaxMin)&&(s.Frame.SubFrame[C].Frame.MaxMinWindow=h.MaxMin),v.IsBool(h.TitleWindow)&&(s.Frame.SubFrame[C].Frame.TitleWindow=h.TitleWindow),h.IsDrawTitleBG==!0&&(s.Frame.SubFrame[C].Frame.IsDrawTitleBG=h.IsDrawTitleBG),v.IsBool(h.IsShowNameArrow)&&(s.Frame.SubFrame[C].Frame.IsShowNameArrow=h.IsShowNameArrow),v.IsNumber(h.TitleHeight)?s.Frame.SubFrame[C].Frame.ChartBorder.TitleHeight=h.TitleHeight:h.TitleHeight=s.Frame.SubFrame[C].Frame.ChartBorder.TitleHeight,v.IsBool(h.IsShowTitleArrow)&&(p.IsShowTitleArrow=h.IsShowTitleArrow),v.IsNumber(h.TitleArrowType)&&(p.TitleArrowType=h.TitleArrowType),h.IsShowIndexName==!1&&(s.Frame.SubFrame[C].Frame.IsShowIndexName=!1),h.IsShowOverlayIndexName==!1&&(s.Frame.SubFrame[C].Frame.IsShowOverlayIndexName=!1),v.IsNumber(h.IndexParamSpace)&&(s.Frame.SubFrame[C].Frame.IndexParamSpace=h.IndexParamSpace),v.IsNumber(h.IndexTitleSpace)&&(s.Frame.SubFrame[C].Frame.IndexTitleSpace=h.IndexTitleSpace),v.IsUndefined(h.HorizontalReserved)||(p.HorizontalReserved=h.HorizontalReserved),h.OverlayIndexType&&(v.IsNumber(h.OverlayIndexType.Position)&&(s.Frame.SubFrame[C].Frame.OverlayIndexType.Position=h.OverlayIndexType.Position),v.IsNumber(h.OverlayIndexType.LineSpace)&&(s.Frame.SubFrame[C].Frame.OverlayIndexType.LineSpace=h.OverlayIndexType.LineSpace))}if(t.OverlayIndexFrameWidth>40&&(s.Frame.FixedRightWidth.Overlay=t.OverlayIndexFrameWidth),v.IsNonEmptyArray(t.OverlayIndex))for(var C=0;C<t.OverlayIndex.length;++C){var h=t.OverlayIndex[C];if(!(h.Windows>=s.Frame.SubFrame.length)){var w=(0,Aa.default)(h),H=JSON.parse(w);h.Index&&(H.IndexName=h.Index),h.Windows>=0&&(H.WindowIndex=h.Windows),s.CreateOverlayWindowsIndex(H)}}return this.AdjustTitleHeight(s),s},this.CreateCustomKLineChartContainer=function(t){var n=new Mm(this.CanvasElement);if(v.IsBool(t.IsShowRightMenu)&&(n.IsShowRightMenu=t.IsShowRightMenu),t.KLine&&(t.KLine.DragMode>=0&&(n.DragMode=t.KLine.DragMode),t.KLine.Right>=0&&(n.Right=t.KLine.Right),t.KLine.Period>=0&&(n.Period=t.KLine.Period),t.KLine.MaxRequestDataCount>0&&(n.MaxRequestDataCount=t.KLine.MaxRequestDataCount),t.KLine.Info&&t.KLine.Info.length>0&&n.SetKLineInfo(t.KLine.Info,!1),t.KLine.PageSize>0&&(n.PageSize=t.KLine.PageSize),t.KLine.IsShowTooltip==!1&&(n.IsShowTooltip=!1)),t.CustomStock&&(n.CustomStock=t.CustomStock),t.QueryDate&&(n.QueryDate=t.QueryDate),!t.Windows||t.Windows.length<=0)return null;if(n.Create(t.Windows.length),t.Border&&(isNaN(t.Border.Left)||(n.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(n.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(n.Frame.ChartBorder.Top=t.Border.Top)),t.IsShowCorssCursorInfo==!1&&(n.ChartCorssCursor.IsShowText=t.IsShowCorssCursorInfo),t.Frame)for(var s=0;s<t.Frame.length;++s){var o=t.Frame[s];o.SplitCount&&(n.Frame.SubFrame[s].Frame.YSplitOperator.SplitCount=o.SplitCount),o.StringFormat&&(n.Frame.SubFrame[s].Frame.YSplitOperator.StringFormat=o.StringFormat)}t.KLineTitle&&(t.KLineTitle.IsShowName==!1&&(n.TitlePaint[0].IsShowName=!1),t.KLineTitle.IsShowSettingInfo==!1&&(n.TitlePaint[0].IsShowSettingInfo=!1));for(var l=new Z,s=0;s<t.Windows.length;++s){var o=t.Windows[s];if(o.Script)n.WindowIndex[s]=new Ie(o.Name,o.Script,o.Args,o);else{var h=$a.Get(o.Index);if(h)n.WindowIndex[s]=h.Create(),n.CreateWindowIndex(s);else{var u=l.Get(o.Index);if(!u)continue;o.Lock&&(u.Lock=o.Lock),n.WindowIndex[s]=new Ie(u.Name,u.Script,u.Args,u)}}o.Modify!=null&&(n.Frame.SubFrame[s].Frame.ModifyIndex=o.Modify),o.Change!=null&&(n.Frame.SubFrame[s].Frame.ChangeIndex=o.Change),isNaN(o.TitleHeight)||(n.Frame.SubFrame[s].Frame.ChartBorder.TitleHeight=o.TitleHeight)}return n},this.CreateMinuteChartContainer=function(t){var n=this,s=null;t.Type==="分钟走势图横屏"?s=new Tf(this.CanvasElement):s=new ce(this.CanvasElement,this.OffscreenCanvasElement,this.CacheCanvasElement),s.GetExtraCanvas=function(p){return n.GetExtraCanvas(p)},t.EventCallback&&this.SetEventCallback(s,t.EventCallback),t.NetworkFilter&&(s.NetworkFilter=t.NetworkFilter);var o=B(),l=2;if(t.Windows&&t.Windows.length>0&&(l+=t.Windows.length),t.EnableScrollUpDown==!0&&(s.EnableScrollUpDown=t.EnableScrollUpDown),t.DisableMouse==!0&&(s.DisableMouse=t.DisableMouse),t.ScriptError&&(s.ScriptErrorCallback=t.ScriptError),v.IsString(t.SplashTitle)&&(s.LoadDataSplashTitle=t.SplashTitle),v.IsBool(t.EnableSelectRect)&&(s.EnableSelectRect=t.EnableSelectRect),v.IsBool(t.EnableZoomIndexWindow)&&(s.EnableZoomIndexWindow=t.EnableZoomIndexWindow),v.IsBool(t.IsDrawPictureXY)&&(s.IsDrawPictureXY=t.IsDrawPictureXY),v.IsBool(t.EnableNewIndex)&&(s.EnableNewIndex=t.EnableNewIndex),v.IsBool(t.EnableIndexChartDrag)&&(s.EnableIndexChartDrag=t.EnableIndexChartDrag),v.IsBool(t.EnableVerifyRecvData)&&(s.EnableVerifyRecvData=t.EnableVerifyRecvData),v.IsBool(t.EnableNightDayBG)&&(s.EnableNightDayBG=t.EnableNightDayBG),t.GlobalOption){var h=t.GlobalOption;v.IsBool(h.IsValueFullRange)&&(s.GlobalOption.IsValueFullRange=h.IsValueFullRange),v.IsNumber(h.XDateFormat)&&(s.GlobalOption.XDateFormat=h.XDateFormat)}if(t.DisplayLatest){var h=t.DisplayLatest;v.IsBool(h.Enable)&&(s.DisplayLatestOption.Enable=h.Enable),v.IsNumber(h.DelayTime)&&(s.DisplayLatestOption.DelayTime=h.DelayTime)}if(t.DrawDynamicInfo){var h=t.DrawDynamicInfo;v.IsBool(h.Enable)&&(s.DrawDynamicInfoOption.Enable=h.Enable),v.IsNumber(h.DelayTime)&&(s.DrawDynamicInfoOption.DelayTime=h.DelayTime)}if(t.Minute&&(t.Minute.IsShowTooltip==!1&&(s.IsShowTooltip=!1),t.Minute.DragMode>=0&&(s.DragMode=t.Minute.DragMode)),t.Language){var u=St.GetLanguageID(t.Language);v.IsNumber(u)&&(s.LanguageID=u)}if(t.Info&&t.Info.length>0&&s.SetMinuteInfo(t.Info,!1),t.DrawTool&&t.DrawTool.StorageKey&&s.ChartDrawStorage&&s.ChartDrawStorage.Load(t.DrawTool.StorageKey),t.BeforeOpen){var h=t.BeforeOpen;v.IsBool(h.IsShow)&&(s.IsShowBeforeData=h.IsShow),v.IsNumber(h.Width)&&(s.ExtendWidth.Left=h.Width),v.IsBool(h.IsShowMultiDay)&&(s.IsShowMultiDayBeforeData=h.IsShowMultiDay),v.IsNumber(h.MulitiDayWidth)&&(s.MultiDayExtendWidth.Left=h.MulitiDayWidth)}if(t.AfterClose){var h=t.AfterClose;v.IsBool(h.IsShow)&&(s.IsShowAfterData=h.IsShow),v.IsNumber(h.ShareVol)&&(s.ShareAfterVol=h.ShareVol),v.IsNumber(h.Width)&&(s.ExtendWidth.Right=h.Width),v.IsBool(h.IsShowMultiDay)&&(s.IsShowMultiDayAfterData=h.IsShowMultiDay),v.IsNumber(h.MulitiDayWidth)&&(s.MultiDayExtendWidth.Right=h.MulitiDayWidth)}if(t.SelectedChart){var h=t.SelectedChart;v.IsBool(h.EnableSelected)&&(s.SelectedChart.EnableSelected=h.EnableSelected),v.IsBool(h.EnableMoveOn)&&(s.SelectedChart.EnableMoveOn=h.EnableMoveOn)}if(s.ClassName=="MinuteChartContainer"&&(t.DragSelectRect||(t.DragSelectRect={Enable:!0}),t.DragSelectRect)){var h=t.DragSelectRect,f=10;v.IsNumber(h.ZIndex)&&(f=h.ZIndex),h.Enable&&this.CreateExtraCanvasElement(Ht.RectDragCanvasKey,{ZIndex:f})}if(t.PageInfo&&s.SetPageInfo(t.PageInfo),s.Create(l,t),t.CorssCursorInfo){var h=t.CorssCursorInfo;isNaN(t.CorssCursorInfo.Left)||(s.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),isNaN(t.CorssCursorInfo.Right)||(s.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),isNaN(t.CorssCursorInfo.Bottom)||(s.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),t.CorssCursorInfo.IsShowCorss===!1&&(s.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),t.CorssCursorInfo.RightTextFormat>0&&(s.ChartCorssCursor.TextFormat.Right=t.CorssCursorInfo.RightTextFormat),t.CorssCursorInfo.IsOnlyDrawMinute==!0&&(s.ChartCorssCursor.IsOnlyDrawMinute=t.CorssCursorInfo.IsOnlyDrawMinute),v.IsBool(t.CorssCursorInfo.IsFixXLastTime)&&(s.ChartCorssCursor.IsFixXLastTime=t.CorssCursorInfo.IsFixXLastTime),h.RightButton&&v.IsBool(h.RightButton.Enable)&&(s.ChartCorssCursor.RightButton.Enable=h.RightButton.Enable),v.IsNumber(h.PriceFormatType)&&(s.ChartCorssCursor.StringFormatY.PriceFormatType=h.PriceFormatType),v.IsNumber(h.DataFormatType)&&(s.ChartCorssCursor.StringFormatY.DataFormatType=h.DataFormatType),v.IsNumber(h.HPenType)&&(s.ChartCorssCursor.HPenType=h.HPenType),v.IsNumber(h.VPenType)&&(s.ChartCorssCursor.VPenType=h.VPenType),v.IsBool(h.EnableKeyboard)&&(s.ChartCorssCursor.EnableKeyboard=h.EnableKeyboard)}if(t.MinuteInfo&&s.CreateMinuteInfo(t.MinuteInfo),v.IsBool(t.IsShowRightMenu)&&(s.IsShowRightMenu=t.IsShowRightMenu),v.IsNumber(t.DayCount)&&(s.DayCount=t.DayCount),this.SetChartBorder(s,t),t.SplashTitle&&(s.ChartSplashPaint.SplashTitle=t.SplashTitle),v.IsBool(t.EnableBorderDrag)&&(s.EnableBorderDrag=t.EnableBorderDrag),this.AdjustChartBorder(s),t.Frame){for(var C=0;C<t.Frame.length;++C){var h=t.Frame[C];if(s.Frame.SubFrame[C]){var D=s.Frame.SubFrame[C].Frame;v.IsNumber(h.SplitCount)&&(s.Frame.SubFrame[C].Frame.YSplitOperator.SplitCount=h.SplitCount),h.StringFormat&&(s.Frame.SubFrame[C].Frame.YSplitOperator.StringFormat=h.StringFormat),v.IsNumber(h.SplitType)&&(s.Frame.SubFrame[C].Frame.YSplitOperator.SplitType=h.SplitType,s.Frame.SubFrame[C].Frame.YSplitOperator.DefaultSplitType=h.SplitType),v.IsNumber(h.FilterType)&&(D.YSplitOperator.FilterType=h.FilterType),h.IsShowLeftText==!1&&(s.Frame.SubFrame[C].Frame.IsShowYText[0]=h.IsShowLeftText,s.Frame.SubFrame[C].Frame.YSplitOperator.IsShowLeftText=h.IsShowLeftText),h.IsShowRightText==!1&&(s.Frame.SubFrame[C].Frame.IsShowYText[1]=h.IsShowRightText,s.Frame.SubFrame[C].Frame.YSplitOperator.IsShowRightText=h.IsShowRightText),h.Height>=0&&(s.Frame.SubFrame[C].Height=h.Height),h.Custom&&(s.Frame.SubFrame[C].Frame.YSplitOperator.Custom=h.Custom),h.RightTextFormat>0&&(s.Frame.SubFrame[C].Frame.YSplitOperator.RightTextFormat=h.RightTextFormat),v.IsNumber(h.TitleHeight)&&(s.Frame.SubFrame[C].Frame.ChartBorder.TitleHeight=h.TitleHeight),v.IsNumber(h.BorderLine)&&(s.Frame.SubFrame[C].Frame.BorderLine=h.BorderLine),v.IsBool(h.EnableRemoveZero)&&(s.Frame.SubFrame[C].Frame.YSplitOperator.EnableRemoveZero=h.EnableRemoveZero),v.IsNumber(h.FloatPrecision)&&(s.Frame.SubFrame[C].Frame.YSplitOperator.FloatPrecision=h.FloatPrecision),v.IsBool(h.IsShowXLine)&&(s.Frame.SubFrame[C].Frame.IsShowXLine=h.IsShowXLine),v.IsBool(h.IsShowYLine)&&(s.Frame.SubFrame[C].Frame.IsShowYLine=h.IsShowYLine),v.IsNumber(h.YTextBaseline)&&(s.Frame.SubFrame[C].Frame.YTextBaseline=h.YTextBaseline),v.IsBool(h.IsShowIndexTitle)&&(s.Frame.SubFrame[C].Frame.IsShowIndexTitle=h.IsShowIndexTitle),h.TopSpace>=0&&(s.Frame.SubFrame[C].Frame.ChartBorder.TopSpace=h.TopSpace*o),h.BottomSpace>=0&&(s.Frame.SubFrame[C].Frame.ChartBorder.BottomSpace=h.BottomSpace*o),v.IsNumber(h.CloseBeforeButton)&&(s.Frame.SubFrame[C].Frame.IsShowCloseButton=h.CloseBeforeButton),h.ClientBGColor&&(D.ClientBGColor=h.ClientBGColor),v.IsUndefined(h.HorizontalReserved)||(D.HorizontalReserved=h.HorizontalReserved)}}s.UpdateXShowText()}if(t.ExtendChart)for(var C=0;C<t.ExtendChart.length;++C){var h=t.ExtendChart[C];s.CreateExtendChart(h.Name,h)}if(t.Overlay)for(var C=0;C<t.Overlay.length;++C){var h=t.Overlay[C];s.OverlaySymbol(h.Symbol,h)}if(t.MinuteLine){if(t.MinuteLine.IsDrawAreaPrice==!1&&(s.ChartPaint[0].IsDrawArea=!1),t.MinuteLine.IsShowLead==!1&&(s.IsShowLead=!1),t.MinuteLine.IsShowAveragePrice==!1){s.ChartPaint[1].IsShow=!1,s.TitlePaint[0].IsShowAveragePrice=!1;for(var C=0;C<s.ExtendChartPaint.length;++C){var h=s.ExtendChartPaint[C];h.ClassName=="MinuteTooltipPaint"&&(h.IsShowAveragePrice=!1)}}t.MinuteLine.SplitType>0&&(s.Frame.SubFrame[0].Frame.YSplitOperator.SplitType=t.MinuteLine.SplitType)}if(t.MinuteVol){var h=t.MinuteVol;v.IsNumber(h.BarColorType)&&(s.ChartPaint[2].BarColorType=h.BarColorType)}if(t.MinuteTitle){var h=t.MinuteTitle,c=s.TitlePaint[0];if(v.IsBool(h.IsShowName)&&(s.TitlePaint[0].IsShowName=h.IsShowName),v.IsBool(h.IsShowDate)&&(s.TitlePaint[0].IsShowDate=h.IsShowDate),v.IsBool(h.IsShowTime)&&(s.TitlePaint[0].IsShowTime=h.IsShowTime),v.IsBool(h.IsTitleShowLatestData)&&(s.IsTitleShowLatestData=h.IsTitleShowLatestData),v.IsBool(h.IsAlwaysShowLastData)&&(s.TitlePaint[0].IsAlwaysShowLastData=h.IsAlwaysShowLastData),v.IsNumber(h.ShowLastDataFormat)&&(s.TitlePaint[0].ShowLastDataFormat=h.ShowLastDataFormat),h.TimeFormat&&(s.TitlePaint[0].TimeFormat=h.TimeFormat),h.ShowPostion||h.ShowPosition){var T=h.ShowPostion;h.ShowPosition&&(T=h.ShowPosition),c.ShowPositionConfig||(c.ShowPositionConfig={Margin:{}}),v.IsNumber(T.Type)&&(c.ShowPositionConfig.Type=T.Type),T.Margin&&(v.IsNumber(T.Margin.Left)&&(c.ShowPositionConfig.Margin.Left=T.Margin.Left),v.IsNumber(T.Margin.Right)&&(c.ShowPositionConfig.Margin.Right=T.Margin.Right),v.IsNumber(T.Margin.Bottom)&&(c.ShowPositionConfig.Margin.Bottom=T.Margin.Bottom))}}if(v.IsBool(t.CorssCursorTouchEnd)&&(s.CorssCursorTouchEnd=t.CorssCursorTouchEnd),v.IsBool(t.IsClickShowCorssCursor)&&(s.IsClickShowCorssCursor=t.IsClickShowCorssCursor),t.IsShowBeforeData===!0&&(s.IsShowBeforeData=t.IsShowBeforeData),v.IsNonEmptyArray(t.Windows))for(var S=new Z,C=0;C<t.Windows.length;++C){var I=2+C,h=t.Windows[C];if(h.Script)s.WindowIndex[I]=new Ie(h.Name,h.Script,h.Args,h);else if(h.API){var g=h.API;s.WindowIndex[I]=new ga(g.Name,g.Script,g.Args,h)}else{var E=$a.Get(h.Index);if(E)s.WindowIndex[I]=E.Create(),s.CreateWindowIndex(I);else{var F=S.Get(h.Index);if(!F)continue;Z.ModifyAttribute(F,h),F.ID=h.Index,s.WindowIndex[I]=new Ie(F.Name,F.Script,F.Args,F),h.StringFormat>0&&(s.WindowIndex[I].StringFormat=h.StringFormat),h.FloatPrecision>=0&&(s.WindowIndex[I].FloatPrecision=h.FloatPrecision)}}var R=s.Frame.SubFrame[I].Frame;v.IsBool(h.Modify)&&(R.ModifyIndex=h.Modify),v.IsBool(h.Change)&&(R.ChangeIndex=h.Change),v.IsBool(h.Close)&&(R.CloseIndex=h.Close),v.IsBool(h.Overlay)&&(R.OverlayIndex=h.Overlay),v.IsBool(h.Export)&&(R.ExportData=h.Export),v.IsBool(h.MaxMin)&&(R.MaxMinWindow=h.MaxMin),v.IsBool(h.TitleWindow)&&(R.TitleWindow=h.TitleWindow),v.IsNumber(h.YSplitType)&&(s.Frame.SubFrame[I].Frame.YSplitOperator.SplitType=h.YSplitType),v.IsNumber(h.FilterType)&&(s.Frame.SubFrame[I].Frame.YSplitOperator.FilterType=h.FilterType),isNaN(h.TitleHeight)||(s.Frame.SubFrame[I].Frame.ChartBorder.TitleHeight=h.TitleHeight),v.IsBool(h.IsDrawTitleBG)&&(s.Frame.SubFrame[I].Frame.IsDrawTitleBG=h.IsDrawTitleBG),v.IsBool(h.IsShowNameArrow)&&(s.Frame.SubFrame[I].Frame.IsShowNameArrow=h.IsShowNameArrow),v.IsBool(h.IsShowTitleArrow)&&(R.IsShowTitleArrow=h.IsShowTitleArrow),v.IsNumber(h.TitleArrowType)&&(R.TitleArrowType=h.TitleArrowType),h.IsShowIndexName==!1&&(s.Frame.SubFrame[I].Frame.IsShowIndexName=!1),h.IsShowOverlayIndexName==!1&&(s.Frame.SubFrame[I].Frame.IsShowOverlayIndexName=!1),v.IsUndefined(h.HorizontalReserved)||(R.HorizontalReserved=h.HorizontalReserved)}if(this.AdjustTitleHeight(s),v.IsNonEmptyArray(t.OverlayIndex))for(var C=0;C<t.OverlayIndex.length;++C){var h=t.OverlayIndex[C];if(!(h.Windows>=s.Frame.SubFrame.length)){var A=(0,Aa.default)(h),P=JSON.parse(A);h.Index&&(P.IndexName=h.Index),h.Windows>=0&&(P.WindowIndex=h.Windows),s.CreateOverlayWindowsIndex(P)}}return s},this.CreateMinMinuteChartContainer=function(t){var n=null;t.Type==="迷你分钟走势图横屏"?n=new Tf(this.CanvasElement):n=new ce(this.CanvasElement),t.NetworkFilter&&(n.NetworkFilter=t.NetworkFilter);var s=2;if(t.BeforeOpen){var o=t.BeforeOpen;v.IsBool(o.IsShow)&&(n.IsShowBeforeData=o.IsShow),v.IsNumber(o.Width)&&(n.ExtendWidth.Left=o.Width),v.IsBool(o.IsShowMultiDay)&&(n.IsShowMultiDayBeforeData=o.IsShowMultiDay),v.IsNumber(o.MulitiDayWidth)&&(n.MultiDayExtendWidth.Left=o.MulitiDayWidth)}if(t.AfterClose){var o=t.AfterClose;v.IsBool(o.IsShow)&&(n.IsShowAfterData=o.IsShow),v.IsNumber(o.ShareVol)&&(n.ShareAfterVol=o.ShareVol),v.IsNumber(o.Width)&&(n.ExtendWidth.Right=o.Width),v.IsBool(o.IsShowMultiDay)&&(n.IsShowMultiDayAfterData=o.IsShowMultiDay),v.IsNumber(o.MulitiDayWidth)&&(n.MultiDayExtendWidth.Right=o.MulitiDayWidth)}if(t.Listener||(t.Listener={KeyDown:!1,Wheel:!1}),n.Create(s,t.Listener),t.CorssCursorInfo){var o=t.CorssCursorInfo;v.IsNumber(t.CorssCursorInfo.Left)&&(n.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),v.IsNumber(t.CorssCursorInfo.Right)&&(n.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),v.IsNumber(t.CorssCursorInfo.Bottom)&&(n.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),t.CorssCursorInfo.IsShowCorss===!1&&(n.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),t.CorssCursorInfo.RightTextFormat>0&&(n.ChartCorssCursor.TextFormat.Right=t.CorssCursorInfo.RightTextFormat),t.CorssCursorInfo.IsOnlyDrawMinute==!0&&(n.ChartCorssCursor.IsOnlyDrawMinute=t.CorssCursorInfo.IsOnlyDrawMinute),v.IsBool(t.CorssCursorInfo.IsFixXLastTime)&&(n.ChartCorssCursor.IsFixXLastTime=t.CorssCursorInfo.IsFixXLastTime),o.RightButton&&v.IsBool(o.RightButton.Enable)&&(n.ChartCorssCursor.RightButton.Enable=o.RightButton.Enable),v.IsNumber(o.PriceFormatType)&&(n.ChartCorssCursor.StringFormatY.PriceFormatType=o.PriceFormatType),v.IsNumber(o.DataFormatType)&&(n.ChartCorssCursor.StringFormatY.DataFormatType=o.DataFormatType),v.IsNumber(t.CorssCursorInfo.HPenType)&&(n.ChartCorssCursor.HPenType=t.CorssCursorInfo.HPenType),v.IsNumber(t.CorssCursorInfo.VPenType)&&(n.ChartCorssCursor.VPenType=t.CorssCursorInfo.VPenType)}v.IsNumber(t.DayCount)&&(n.DayCount=t.DayCount),this.SetChartBorder(n,t),t.SplashTitle&&(n.ChartSplashPaint.SplashTitle=t.SplashTitle),v.IsBool(t.EnableVerifyRecvData)&&(n.EnableVerifyRecvData=t.EnableVerifyRecvData),n.TitlePaint[0].IsShow=!1;var l=n.Frame.SubFrame[0];if(l.Frame.IsShowYText[0]=!1,l.Frame.IsShowYText[1]=!1,l.Frame.IsShowXLine=!1,l.Frame.IsShowYLine=!1,l.Frame.BorderLine=0,n.Frame.SubFrame[1].Height=0,n.EnableBorderDrag=!1,t.Frame)for(var h=0;h<t.Frame.length;++h){var o=t.Frame[h];n.Frame.SubFrame[h]&&(o.SplitCount&&(n.Frame.SubFrame[h].Frame.YSplitOperator.SplitCount=o.SplitCount),o.StringFormat&&(n.Frame.SubFrame[h].Frame.YSplitOperator.StringFormat=o.StringFormat),v.IsNumber(o.SplitType)&&(n.Frame.SubFrame[h].Frame.YSplitOperator.SplitType=o.SplitType,n.Frame.SubFrame[h].Frame.YSplitOperator.DefaultSplitType=o.SplitType),v.IsBool(o.IsShowLeftText)&&(n.Frame.SubFrame[h].Frame.IsShowYText[0]=o.IsShowLeftText,n.Frame.SubFrame[h].Frame.YSplitOperator.IsShowLeftText=o.IsShowLeftText),v.IsBool(o.IsShowRightText)&&(n.Frame.SubFrame[h].Frame.IsShowYText[1]=o.IsShowRightText,n.Frame.SubFrame[h].Frame.YSplitOperator.IsShowRightText=o.IsShowRightText),o.Height>=0&&(n.Frame.SubFrame[h].Height=o.Height),o.Custom&&(n.Frame.SubFrame[h].Frame.YSplitOperator.Custom=o.Custom),o.RightTextFormat>0&&(n.Frame.SubFrame[h].Frame.YSplitOperator.RightTextFormat=o.RightTextFormat),v.IsNumber(o.TitleHeight)&&(n.Frame.SubFrame[h].Frame.ChartBorder.TitleHeight=o.TitleHeight),v.IsNumber(o.BorderLine)&&(n.Frame.SubFrame[h].Frame.BorderLine=o.BorderLine),v.IsBool(o.EnableRemoveZero)&&(n.Frame.SubFrame[h].Frame.YSplitOperator.EnableRemoveZero=o.EnableRemoveZero),v.IsNumber(o.FloatPrecision)&&(n.Frame.SubFrame[h].Frame.YSplitOperator.FloatPrecision=o.FloatPrecision),v.IsBool(o.IsShowXLine)&&(n.Frame.SubFrame[h].Frame.IsShowXLine=o.IsShowXLine),v.IsBool(o.IsShowYLine)&&(n.Frame.SubFrame[h].Frame.IsShowYLine=o.IsShowYLine),v.IsNumber(o.YTextBaseline)&&(n.Frame.SubFrame[h].Frame.YTextBaseline=o.YTextBaseline))}if(n.UpdateXShowText(),t.MinuteLine){if(t.MinuteLine.IsDrawAreaPrice==!1&&(n.ChartPaint[0].IsDrawArea=!1),t.MinuteLine.IsShowLead==!1&&(n.IsShowLead=!1),t.MinuteLine.IsShowAveragePrice==!1){n.ChartPaint[1].IsShow=!1,n.TitlePaint[0].IsShowAveragePrice=!1;for(var h=0;h<n.ExtendChartPaint.length;++h){var o=n.ExtendChartPaint[h];o.ClassName=="MinuteTooltipPaint"&&(o.IsShowAveragePrice=!1)}}t.MinuteLine.SplitType>0&&(n.Frame.SubFrame[0].Frame.YSplitOperator.SplitType=t.MinuteLine.SplitType)}if(this.AdjustTitleHeight(n),t.DisableMouseEvent===!0&&(this.CanvasElement.onmousemove=function(u){},this.CanvasElement.oncontextmenu=function(u){},this.CanvasElement.ondblclick=function(u){},this.CanvasElement.onmousedown=function(u){},this.CanvasElement.onmouseout=function(u){},this.CanvasElement.onmouseleave=function(u){}),t.ExtendChart)for(var h=0;h<t.ExtendChart.length;++h){var o=t.ExtendChart[h];n.CreateExtendChart(o.Name,o)}return n},this.CreateKLineTrainChartContainer=function(t){var n=!1;if(t.Type=="简单K线训练"||t.Type=="简单K线训练横屏"){var s=t.Type=="简单K线训练横屏",o=new Lm(this.CanvasElement,s);n=!0}else var s=t.Type=="K线训练横屏",o=new gD(this.CanvasElement,s);if(t.NetworkFilter&&(o.NetworkFilter=t.NetworkFilter),t.IsApiPeriod==!0&&(o.IsApiPeriod=t.IsApiPeriod),t.ScriptError&&(o.ScriptErrorCallback=t.ScriptError),t.KLine&&(t.KLine.Right>=0&&(o.Right=t.KLine.Right),t.KLine.Period>=0&&(o.Period=t.KLine.Period),t.KLine.MaxRequestDataCount>0&&(o.MaxRequestDataCount=t.KLine.MaxRequestDataCount),t.KLine.Info&&t.KLine.Info.length>0&&o.SetKLineInfo(t.KLine.Info,!1),t.KLine.PageSize>0&&(o.PageSize=t.KLine.PageSize),t.KLine.IsShowTooltip==!1&&(o.IsShowTooltip=!1),t.KLine.MaxRequestMinuteDayCount>0&&(o.MaxRequestMinuteDayCount=t.KLine.MaxRequestMinuteDayCount),t.KLine.DrawType&&(o.KLineDrawType=t.KLine.DrawType),v.IsNumber(t.KLine.RightSpaceCount)&&!n&&(o.RightSpaceCount=t.KLine.RightSpaceCount)),t.Train&&(t.Train.DataCount&&(o.TrainDataCount=t.Train.DataCount),t.Train.Callback&&(o.TrainCallback=t.Train.Callback),t.Train.StartDate&&(o.TrainStartDate=t.Train.StartDate)),!t.Windows||t.Windows.length<=0)return null;if(o.Create(t.Windows.length),this.SetChartBorder(o,t),this.AdjustChartBorder(o),t.IsShowCorssCursorInfo==!1&&(o.ChartCorssCursor.IsShowText=t.IsShowCorssCursorInfo),t.IsCorssOnlyDrawKLine===!0&&(o.ChartCorssCursor.IsOnlyDrawKLine=t.IsCorssOnlyDrawKLine),t.CorssCursorTouchEnd===!0&&(o.CorssCursorTouchEnd=t.CorssCursorTouchEnd),t.IsClickShowCorssCursor==!0&&(o.IsClickShowCorssCursor=t.IsClickShowCorssCursor),t.CorssCursorInfo&&(isNaN(t.CorssCursorInfo.Left)||(o.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),isNaN(t.CorssCursorInfo.Right)||(o.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),isNaN(t.CorssCursorInfo.Bottom)||(o.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),t.CorssCursorInfo.IsShowCorss===!1&&(o.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),t.CorssCursorInfo.IsShowClose==!0&&(o.ChartCorssCursor.IsShowClose=t.CorssCursorInfo.IsShowClose),t.CorssCursorInfo.PressTime&&(o.PressTime=t.CorssCursorInfo.PressTime),t.CorssCursorInfo.HPenType>0&&(o.ChartCorssCursor.HPenType=t.CorssCursorInfo.HPenType),t.CorssCursorInfo.VPenType>0&&(o.ChartCorssCursor.VPenType=t.CorssCursorInfo.VPenType)),t.CorssCursor={},t.CorssCursor.TitleHeight=o.ChartCorssCursor.TextHeight,t.Frame)for(var l=0;l<t.Frame.length;++l){var h=t.Frame[l];o.Frame.SubFrame[l]&&(h.SplitCount&&(o.Frame.SubFrame[l].Frame.YSplitOperator.SplitCount=h.SplitCount),h.StringFormat&&(o.Frame.SubFrame[l].Frame.YSplitOperator.StringFormat=h.StringFormat),v.IsNumber(h.FloatPrecision)&&(o.Frame.SubFrame[l].Frame.YSplitOperator.FloatPrecision=h.FloatPrecision),h.Custom&&(o.Frame.SubFrame[l].Frame.YSplitOperator.Custom=h.Custom),v.IsNumber(h.SplitType)&&(o.Frame.SubFrame[l].Frame.YSplitOperator.SplitType=h.SplitType),h.Height>0&&(o.Frame.SubFrame[l].Height=h.Height),h.IsShowLeftText==!1&&(o.Frame.SubFrame[l].Frame.YSplitOperator.IsShowLeftText=h.IsShowLeftText),h.IsShowRightText==!1&&(o.Frame.SubFrame[l].Frame.YSplitOperator.IsShowRightText=h.IsShowRightText))}if(t.KLine&&(t.KLine.ShowKLine==!1&&(o.ChartPaint[0].IsShow=!1),t.KLine.InfoPosition>0&&(o.ChartPaint[0].InfoPosition=t.KLine.InfoPosition),t.KLine.IsShowMaxMinPrice==!1&&(o.ChartPaint[0].IsShowMaxMinPrice=t.KLine.IsShowMaxMinPrice)),t.KLineTitle&&(t.KLineTitle.IsShowName==!1&&(o.TitlePaint[0].IsShowName=!1),t.KLineTitle.IsShowSettingInfo==!1&&(o.TitlePaint[0].IsShowSettingInfo=!1),t.KLineTitle.IsShow==!1&&(o.TitlePaint[0].IsShow=!1)),v.IsNonEmptyArray(t.Overlay))for(var l=0;l<t.Overlay.length;++l){var h=t.Overlay[l];o.OverlaySymbol(h.Symbol,h)}if(t.ExtendChart)for(var l=0;l<t.ExtendChart.length;++l){var h=t.ExtendChart[l];o.CreateExtendChart(h.Name,h)}if(v.IsNonEmptyArray(t.Windows))for(var l=0;l<t.Windows.length;++l){var h=t.Windows[l];if(h.Script)o.WindowIndex[l]=new Ie(h.Name,h.Script,h.Args,h);else{var u=$a.Get(h.Index);if(u)o.WindowIndex[l]=u.Create(),o.CreateWindowIndex(l);else{var f=new Z,C=f.Get(h.Index);if(!C)continue;h.Lock&&(C.Lock=h.Lock),o.WindowIndex[l]=new Ie(C.Name,C.Script,C.Args,C)}}h.Modify!=null&&(o.Frame.SubFrame[l].Frame.ModifyIndex=h.Modify),h.Change!=null&&(o.Frame.SubFrame[l].Frame.ChangeIndex=h.Change),h.Close!=null&&(o.Frame.SubFrame[l].Frame.CloseIndex=h.Close),h.Overlay!=null&&(frame.OverlayIndex=h.Overlay),v.IsBool(h.Export)&&(frame.ExportData=h.Export),v.IsBool(h.MaxMin)&&(o.Frame.SubFrame[l].Frame.MaxMinWindow=h.MaxMin),v.IsBool(h.TitleWindow)&&(o.Frame.SubFrame[l].Frame.TitleWindow=h.TitleWindow),v.IsBool(h.IsDrawTitleBG)&&(o.Frame.SubFrame[l].Frame.IsDrawTitleBG=h.IsDrawTitleBG),v.IsBool(h.IsShowNameArrow)&&(o.Frame.SubFrame[l].Frame.IsShowNameArrow=h.IsShowNameArrow),v.IsNumber(h.TitleHeight)&&(o.Frame.SubFrame[l].Frame.ChartBorder.TitleHeight=h.TitleHeight),v.IsBool(h.IsShowTitleArrow)&&(o.Frame.SubFrame[l].Frame.IsShowTitleArrow=h.IsShowTitleArrow),h.IsShowIndexName==!1&&(o.Frame.SubFrame[l].Frame.IsShowIndexName=!1),h.IsShowOverlayIndexName==!1&&(o.Frame.SubFrame[l].Frame.IsShowOverlayIndexName=!1),v.IsNumber(h.IndexParamSpace)&&(o.Frame.SubFrame[l].Frame.IndexParamSpace=h.IndexParamSpace),v.IsNumber(h.IndexTitleSpace)&&(o.Frame.SubFrame[l].Frame.IndexTitleSpace=h.IndexTitleSpace)}return this.AdjustTitleHeight(o),o},this.CreateDepthChartContainer=function(t){var n=null;if(n=new Rm(this.CanvasElement),t.NetworkFilter&&(n.NetworkFilter=t.NetworkFilter),t.EnableScrollUpDown==!0&&(n.EnableScrollUpDown=t.EnableScrollUpDown),v.IsPlusNumber(t.MaxVolRate)&&(n.MaxVolRate=t.MaxVolRate),t.ZoomStepPixel>0&&(n.ZoomStepPixel=t.ZoomStepPixel),v.IsString(t.SplashTitle)&&(n.LoadDataSplashTitle=t.SplashTitle),v.IsBool(t.EnableVerifyRecvData)&&(n.EnableVerifyRecvData=t.EnableVerifyRecvData),t.Language){var s=St.GetLanguageID(t.Language);v.IsNumber(s)&&(n.LanguageID=s)}if(n.Create(t.Listener),t.Border&&(v.IsNumber(t.Border.Left)?n.Frame.ChartBorder.Left=t.Border.Left:t.Border.Left=n.Frame.ChartBorder.Left,v.IsNumber(t.Border.Right)?n.Frame.ChartBorder.Right=t.Border.Right:t.Border.Right=n.Frame.ChartBorder.Right,v.IsNumber(t.Border.Top)?n.Frame.ChartBorder.Top=t.Border.Top:t.Border.Top=n.Frame.ChartBorder.Top,v.IsNumber(t.Border.Bottom)?n.Frame.ChartBorder.Bottom=t.Border.Bottom:t.Border.Bottom=n.Frame.ChartBorder.Bottom),this.AdjustChartBorder(n),t.CorssCursorTouchEnd===!0&&(n.CorssCursorTouchEnd=t.CorssCursorTouchEnd),t.CorssCursorInfo){var o=t.CorssCursorInfo;v.IsNumber(o.HPenType)&&(n.ChartCorssCursor.HPenType=o.HPenType),v.IsNumber(o.VPenType)&&(n.ChartCorssCursor.VPenType=o.VPenType),v.IsBool(o.IsShowTooltip)&&(n.ChartCorssCursor.IsShowTooltip=o.IsShowTooltip)}if(t.Frame){var o=t.Frame;o.SplitCount&&(n.Frame.YSplitOperator.SplitCount=o.SplitCount),v.IsNumber(o.SplitType)&&(n.Frame.YSplitOperator.SplitType=o.SplitType),v.IsNumber(o.Height)&&(n.Frame.Height=o.Height),v.IsNumber(o.YLineType)&&(n.Frame.YSplitOperator.LineType=o.YLineType),v.IsNumber(o.XLineType)&&(n.Frame.XSplitOperator.LineType=o.XLineType),Array.isArray(o.IgnoreYValue)&&(n.Frame.YSplitOperator.IgnoreYValue=o.IgnoreYValue),(o.IsShowLeftText===!1||o.IsShowLeftText===!0)&&(n.Frame.IsShowYText[0]=o.IsShowLeftText,n.Frame.YSplitOperator.IsShowLeftText=o.IsShowLeftText),(o.IsShowRightText===!1||o.IsShowRightText===!0)&&(n.Frame.IsShowYText[1]=o.IsShowRightText,n.Frame.YSplitOperator.IsShowRightText=o.IsShowRightText),o.IsShowXLine==!1&&(n.Frame.IsShowXLine=o.IsShowXLine),o.IsShowYLine==!1&&(n.Frame.IsShowYLine=o.IsShowYLine),v.IsNumber(o.XSplitCount)&&(n.Frame.XSplitOperator.SplitCount=o.XSplitCount)}return n},this.SetOption=function(t){v.IsNumber(t.ToolbarButtonStyle)&&(d.ToolbarButtonStyle=t.ToolbarButtonStyle);var n=null;switch(t.Type){case"历史K线图":case"历史K线图横屏":n=this.CreateKLineChartContainer(t);break;case"自定义指数历史K线图":n=this.CreateCustomKLineChartContainer(t);break;case"分钟走势图":case"分钟走势图横屏":n=this.CreateMinuteChartContainer(t);break;case"迷你分钟走势图":n=this.CreateMinMinuteChartContainer(t);break;case"K线训练":case"K线训练横屏":case"简单K线训练":case"简单K线训练横屏":n=this.CreateKLineTrainChartContainer(t);break;case"深度图":n=this.CreateDepthChartContainer(t);break;default:return!1}if(!n)return!1;if(this.JSChartContainer=n,n.DivElement=this.DivElement,t.EnableResize==!0&&this.CreateResizeListener(),t.DefaultCursor&&(n.DefaultCursor=t.DefaultCursor),t.OnCreatedCallback&&t.OnCreatedCallback(n),t.IsAutoUpdate!=null&&(n.IsAutoUpdate=t.IsAutoUpdate),t.AutoUpdateFrequency>0&&(n.AutoUpdateFrequency=t.AutoUpdateFrequency),t.EnablePopMenuV2===!0&&n.InitalPopMenu(),t.EnableDrawToolDialogV2===!0&&n.InitalDrawToolDialog(),t.EnableModifyDrawDialogV2===!0&&n.InitalModifyDrawDialog(),t.TooltipDialog&&t.TooltipDialog.Enable&&n.InitalTooltipDialog(t.TooltipDialog),t.FloatTooltip&&t.FloatTooltip.Enable&&n.InitalFloatTooltip(t.FloatTooltip),t.SelectRectDialog&&t.SelectRectDialog.Enable&&n.InitalSelectRectDialog(t.SelectRectDialog),t.ModifyIndexParamDialog&&t.ModifyIndexParamDialog.Enable&&n.InitalModifyIndexParamDialog(t.ModifyIndexParamDialog),t.SearchIndexDialog&&t.SearchIndexDialog.Enable&&n.InitalSearchIndexDialog(t.SearchIndexDialog),t.EventCallback)for(var s=0;s<t.EventCallback.length;++s){var o=t.EventCallback[s];n.AddEventCallback(o)}t.Symbol?(n.Draw(),n.ChangeSymbol(t.Symbol),this.JSChartContainer=n,this.DivElement.JSChart=this,this.JSChartContainer.Draw()):(n.DrawEmpty(),this.JSChartContainer=n,this.DivElement.JSChart=this)},this.CreateResizeListener=function(){var t=this;this.ResizeListener=new ResizeObserver(function(n){t.OnDivResize(n)}),this.ResizeListener.observe(this.DivElement)},this.OnDivResize=function(t){k.Chart.Log("[JSChart::OnDivResize] entries=",t),this.OnSize({Type:1})},this.CreateToolbar=function(t){},this.CreateSettingDiv=function(t){},this.Focus=function(){this.CanvasElement&&this.CanvasElement.focus()},this.ChangeSymbol=function(t,n){this.JSChartContainer&&this.JSChartContainer.ChangeSymbol(t,n)},this.ChangeIndex=function(t,n,s){this.JSChartContainer&&typeof this.JSChartContainer.ChangeIndex=="function"&&this.JSChartContainer.ChangeIndex(t,n,s)},this.ChangeIndexWindow=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.ChangeIndexWindow=="function"&&this.JSChartContainer.ChangeIndexWindow(t,n)},this.AddIndexWindow=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.AddIndexWindow=="function"&&this.JSChartContainer.AddIndexWindow(t,n)},this.AddScriptIndexWindow=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.AddScriptIndexWindow=="function"&&this.JSChartContainer.AddScriptIndexWindow(t,n)},this.AddAPIIndexWindow=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.AddAPIIndexWindow=="function"&&this.JSChartContainer.AddAPIIndexWindow(t,n)},this.RemoveIndexWindow=function(t){this.JSChartContainer&&typeof this.JSChartContainer.RemoveIndexWindow=="function"&&this.JSChartContainer.RemoveIndexWindow(t)},this.ChangeScriptIndex=function(t,n,s){this.JSChartContainer&&typeof this.JSChartContainer.ChangeScriptIndex=="function"&&this.JSChartContainer.ChangeScriptIndex(t,n,s)},this.ChangePyScriptIndex=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.ChangePyScriptIndex=="function"&&this.JSChartContainer.ChangePyScriptIndex(t,n)},this.GetIndexInfo=function(){return this.JSChartContainer&&typeof this.JSChartContainer.GetIndexInfo=="function"?this.JSChartContainer.GetIndexInfo():[]},this.ChangeInstructionIndex=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.ChangeInstructionIndex=="function"&&this.JSChartContainer.ChangeInstructionIndex(t,n)},this.ChangeInstructionScriptIndex=function(t){this.JSChartContainer&&typeof this.JSChartContainer.ChangeInstructionIndex=="function"&&this.JSChartContainer.ChangeInstructionScriptIndex(t)},this.CancelInstructionIndex=function(){this.JSChartContainer&&typeof this.JSChartContainer.CancelInstructionIndex=="function"&&this.JSChartContainer.CancelInstructionIndex()},this.ChangePeriod=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.ChangePeriod=="function"&&this.JSChartContainer.ChangePeriod(t,n)},this.ChangeRight=function(t){this.JSChartContainer&&typeof this.JSChartContainer.ChangeRight=="function"&&this.JSChartContainer.ChangeRight(t)},this.OverlaySymbol=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.OverlaySymbol=="function"&&this.JSChartContainer.OverlaySymbol(t,n)},this.DeleteOverlaySymbol=function(t){this.JSChartContainer&&typeof this.JSChartContainer.DeleteOverlaySymbol=="function"&&this.JSChartContainer.DeleteOverlaySymbol(t)},this.SetFirstShowDate=function(t){this.JSChartContainer&&typeof this.JSChartContainer.SetFirstShowDate=="function"&&this.JSChartContainer.SetFirstShowDate(t)},this.ChangeKLineDrawType=function(t,n,s){this.JSChartContainer&&typeof this.JSChartContainer.ChangeKLineDrawType=="function"&&this.JSChartContainer.ChangeKLineDrawType(t,n,s)},this.ChangeIndexWindowCount=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.ChangeIndexWindowCount=="function"&&this.JSChartContainer.ChangeIndexWindowCount(t,n)},this.ClearOverlaySymbol=function(){this.JSChartContainer&&typeof this.JSChartContainer.ClearOverlaySymbol=="function"&&this.JSChartContainer.ClearOverlaySymbol()},this.DeleteKLineInfo=function(t){this.JSChartContainer&&typeof this.JSChartContainer.DeleteKLineInfo=="function"&&this.JSChartContainer.DeleteKLineInfo(t)},this.ClearKLineInfo=function(){this.JSChartContainer&&typeof this.JSChartContainer.ClearKLineInfo=="function"&&this.JSChartContainer.ClearKLineInfo()},this.AddKLineInfo=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.AddKLineInfo=="function"&&this.JSChartContainer.AddKLineInfo(t,n)},this.AddOverlayIndex=function(t){this.JSChartContainer&&typeof this.JSChartContainer.AddOverlayIndex=="function"&&this.JSChartContainer.AddOverlayIndex(t)},this.MoveOverlayIndex=function(t,n,s){this.JSChartContainer&&typeof this.JSChartContainer.MoveOverlayIndex=="function"&&this.JSChartContainer.MoveOverlayIndex(t,n,s)},this.MoveOverlayIndexToNewWindow=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.MoveOverlayIndexToNewWindow=="function"&&this.JSChartContainer.MoveOverlayIndexToNewWindow(t,n)},this.DeleteOverlayWindowsIndex=function(t){this.JSChartContainer&&typeof this.JSChartContainer.DeleteOverlayWindowsIndex=="function"&&this.JSChartContainer.DeleteOverlayWindowsIndex(t)},this.StopAutoUpdate=function(){this.JSChartContainer&&typeof this.JSChartContainer.StopAutoUpdate=="function"&&this.JSChartContainer.StopAutoUpdate()},this.ChartDestroy=function(){this.JSChartContainer&&typeof this.JSChartContainer.ChartDestroy=="function"&&this.JSChartContainer.ChartDestroy()},this.ChartDestory=this.ChartDestroy,this.SetDepthMapData=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.SetDepthMapData=="function"&&this.JSChartContainer.SetDepthMapData(t,n)},this.ForceLandscape=function(t){this.JSChartContainer&&(k.Chart.Log("[JSChart::ForceLandscape] bForceLandscape="+t),this.JSChartContainer.IsForceLandscape=t)},this.LockIndex=function(t){this.JSChartContainer&&typeof this.JSChartContainer.LockIndex=="function"&&(k.Chart.Log("[JSChart:LockIndex] lockData",t),this.JSChartContainer.LockIndex(t))},this.ChangeDayCount=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.ChangeDayCount=="function"&&(k.Chart.Log("[JSChart:ChangeDayCount] count",t),this.JSChartContainer.ChangeDayCount(t,n))},this.ShowCallAuctionData=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.ShowCallAuctionData=="function"&&(k.Chart.Log("[JSChart:ShowCallAuctionData] obj, option ",t,n),this.JSChartContainer.ShowCallAuctionData(t,n))},this.StartAnimation=function(t){if(this.JSChartContainer&&typeof this.JSChartContainer.StartAnimation=="function")return k.Chart.Log("[JSChart:StartAnimation] start."),this.JSChartContainer.StartAnimation(t)},this.StopAnimation=function(){if(this.JSChartContainer&&typeof this.JSChartContainer.StopAnimation=="function")return k.Chart.Log("[JSChart:StopAnimation] start."),this.JSChartContainer.StopAnimation()},this.SaveToImage=function(t,n){if(this.JSChartContainer&&typeof this.JSChartContainer.SaveToImage=="function")return this.JSChartContainer.SaveToImage(t,n)},this.SaveToImageUrl=function(t,n){if(this.JSChartContainer&&typeof this.JSChartContainer.SaveToImageUrl=="function")return this.JSChartContainer.SaveToImageUrl(t,n)},this.AddEventCallback=function(t){this.JSChartContainer&&typeof this.JSChartContainer.AddEventCallback=="function"&&(k.Chart.Log("[JSChart:AddEventCallback] ",t),this.JSChartContainer.AddEventCallback(t))},this.SetLanguage=function(t){this.JSChartContainer&&typeof this.JSChartContainer.SetLanguage=="function"&&(k.Chart.Log("[JSChart:SetLanguage] ",t),this.JSChartContainer.SetLanguage(t))},this.ChangeIndexTemplate=function(t){this.JSChartContainer&&typeof this.JSChartContainer.ChangeIndexTemplate=="function"&&(k.Chart.Log("[JSChart:ChangeIndexTemplate] ",t),this.JSChartContainer.ChangeIndexTemplate(t))},this.SetChartDrawOption=function(t){this.JSChartContainer&&typeof this.JSChartContainer.SetChartDrawOption=="function"&&(k.Chart.Log("[JSChart:SetChartDrawOption] ",t),this.JSChartContainer.SetChartDrawOption(t))},this.CreateChartDrawPicture=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.CreateChartDrawPicture=="function"&&(k.Chart.Log("[JSChart:CreateChartDrawPicture] ",t),this.JSChartContainer.CreateChartDrawPicture(t,n))},this.AddChartDrawPicture=function(t){if(this.JSChartContainer&&typeof this.JSChartContainer.AddChartDrawPicture=="function")return k.Chart.Log("[JSChart:AddChartDrawPicture] ",t),this.JSChartContainer.AddChartDrawPicture(t)},this.ClearChartDrawPicture=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.ClearChartDrawPicture=="function"&&this.JSChartContainer.ClearChartDrawPicture(t,n)},this.PasteChartDrawPicture=function(t,n,s){if(this.JSChartContainer&&typeof this.JSChartContainer.PasteChartDrawPicture=="function")return k.Chart.Log("[JSChart:PasteChartDrawPicture] ",t,n,s),this.JSChartContainer.PasteChartDrawPicture(t,n,s)},this.ReloadResource=function(t){this.JSChartContainer&&typeof this.JSChartContainer.ReloadResource=="function"&&(k.Chart.Log("[JSChart:ReloadResource] "),this.JSChartContainer.ReloadResource(t))},this.EnableSplashScreen=function(t,n){this.JSChartContainer&&typeof this.JSChartContainer.EnableSplashScreen=="function"&&(k.Chart.Log("[JSChart:EnableSplashScreen] "),this.JSChartContainer.EnableSplashScreen(t,n))},this.Draw=function(){this.JSChartContainer&&typeof this.JSChartContainer.Draw=="function"&&(k.Chart.Log("[JSChart:Draw] "),this.JSChartContainer.Draw())},this.SetFocus=function(){this.JSChartContainer&&typeof this.JSChartContainer.SetFocus=="function"&&(k.Chart.Log("[JSChart:SetFocus] "),this.JSChartContainer.SetFocus())},this.ExportData=function(t){if(this.JSChartContainer&&typeof this.JSChartContainer.ExportData=="function")return k.Chart.Log("[JSChart:ExportData] "),this.JSChartContainer.ExportData(t)},this.ChangePriceGap=function(t){if(this.JSChartContainer&&typeof this.JSChartContainer.ChangePriceGap=="function")return k.Chart.Log("[JSChart:ChangePriceGap] "),this.JSChartContainer.ChangePriceGap(t)},this.PopupMenuByTab=function(t,n){if(this.JSChartContainer&&typeof this.JSChartContainer.PopupMenuByTab=="function")return k.Chart.Log("[JSChart:PopupMenuByTab] "),this.JSChartContainer.PopupMenuByTab(t,n)},this.PopupMenuByDrapdown=function(t,n){if(this.JSChartContainer&&typeof this.JSChartContainer.PopupMenuByDrapdown=="function")return k.Chart.Log("[JSChart:PopupMenuByDrapdown] "),this.JSChartContainer.PopupMenuByDrapdown(t,n)},this.ExecuteMenuCommand=function(t,n){if(this.JSChartContainer&&typeof this.JSChartContainer.ExecuteMenuCommand=="function")return k.Chart.Log("[JSChart:ExecuteMenuCommand] "),this.JSChartContainer.ExecuteMenuCommand(t,n)}}Ht.LastVersion=null;Ht.EnableCanvasWillReadFrequently=!1;Ht.CorssCursorCanvasKey="hqchart_corsscursor";Ht.TooltipCursorCanvasKey="hqchart_tooltip";Ht.RectDragCanvasKey="hqchart_drag_rect";Ht.Init=function(e,a,r){var t=new Ht(e,a,r);return t.OnSize(),t};Ht.SetDomain=function(e,a){e&&(d.Domain=e),a&&(d.CacheDomain=a)};Ht.SetPyIndexDomain=function(e){e&&(d.PyIndexDomain=e)};Ht.SetStyle=function(e){e&&d.SetStyle(e)};Ht.SetTextResource=function(e,a){St.SetTextResource(e,a)};Ht.GetLocalization=function(){return St};Ht.GetDevicePixelRatio=function(){return B()};Ht.CreateGuid=function(){return Re()};Ht.GetResource=function(){return d};Ht.GetMinuteTimeStringData=function(){return Wi};Ht.GetMinuteCoordinateData=function(){return vl};Ht.GetKLineZoom=function(){return ue};Ht.SetKLineZoom=function(e){ue=e};Ht.GetDivTooltipDataFormat=function(){return Je};Ht.GetKLineCustomCalulate=function(){return ID};Ht.SetUSATimeType=function(e){ur.TimeType=e,fr.TimeType=e,Cr.TimeType=e,Dr.TimeType=e};Ht.GetChinaFuturesTimeData=function(){return Rs};Ht.AddPeriodCallback=function(e){$h.AddPeriodCallback(e)};Ht.RemovePeriodCallback=function(e){$h.RemovePeriodCallback(e)};Ht.RegisterDrawPicture=function(e){return gt.RegisterDrawPicture(e)};Ht.RegisterDrawPictureIonFont=function(e){return gt.RegisterIonFont(e)};Ht.GetInternalTimeData=function(e){switch(e){case"NYMEXTimeData":return ur;case"COMEXTimeData":return fr;case"NYBOTTimeData":return Cr;case"CBOTTimeData":return Dr;case"LMETimeData":return wr;case"FuturesTimeData":return Rs;case"TOCOMTimeData":return Gr;case"IPETimeData":return _r;default:return null}};Ht.RegisterExtendChartClass=function(e,a){return Br.Add(e,a)};Ht.AddExtendCallbackDraw=function(e){return Br.AddCallbackDrawClassName(e)};Ht.RegisterChartPaintClass=function(e,a){return Cs.Add(e,a)};Ht.RegisterScriptIndexChart=function(e,a){return Ei.Add(e,a)};Ht.RegisterDialogClass=function(e,a){return ED.Add(e,a)};Ht.RegisterChartFrameClass=function(e,a){return on.Add(e,a)};Ht.ToFixedPoint=function(e){return L(e)};Ht.ToFixedPoint2=function(e,a){return $t(e,a)};Ht.ToFixedRect=function(e){return b(e)};Ht.GetScrollPosition=function(){return Da()};Ht.GetfloatPrecision=function(e){return jt(e)};var $={RECV_INDEX_DATA:2,RECV_HISTROY_DATA:3,RECV_TRAIN_MOVE_STEP:4,CHART_STATUS:5,BARRAGE_PLAY_END:6,RECV_OVERLAY_INDEX_DATA:7,DBCLICK_KLINE:8,RECV_START_AUTOUPDATE:9,RECV_STOP_AUTOUPDATE:10,ON_CONTEXT_MENU:11,ON_TITLE_DRAW:12,ON_SELECT_RECT:13,RECV_MINUTE_DATA:14,ON_CLICK_INDEXTITLE:15,RECV_KLINE_UPDATE_DATA:16,ON_CLICK_DRAWPICTURE:17,ON_FINISH_DRAWPICTURE:18,ON_INDEXTITLE_DRAW:19,ON_CUSTOM_VERTICAL_DRAW:20,RECV_KLINE_MANUAL_UPDATE_DATA:21,ON_ENABLE_SPLASH_DRAW:22,ON_CLICK_CHART_PAINT:23,ON_DRAW_MINUTE_LAST_POINT:24,ON_DRAW_DEPTH_TOOLTIP:25,ON_CLICK:26,ON_PHONE_TOUCH:27,ON_CLICKUP_CHART_PAINT:28,ON_SPLIT_YCOORDINATE:29,ON_DBCLICK:30,ON_SPLIT_XCOORDINATE:31,ON_KEYDOWN_SELECT_RECT:32,ON_DRAG_SELECT_RECT:33,ON_DRAG_SELECT_RECT_MOUSEUP:34,ON_DRAW_KLINE_LAST_POINT:35,ON_CLICK_CROSSCURSOR_RIGHT:36,ON_PLAY_SOUND:37,ON_CALCULATE_INDEX_OX:38,ON_LOAD_DRAWPICTURE:39,ON_DRAW_COUNTDOWN:41,ON_BIND_DRAWICON:42,ON_DRAW_DEAL_VOL_COLOR:43,ON_DRAW_DEAL_TEXT:44,ON_FILTER_DEAL_DATA:45,ON_FILTER_REPORT_DATA:46,ON_CLICK_REPORT_ROW:47,ON_REPORT_MARKET_STATUS:48,ON_DBCLICK_REPORT_ROW:49,ON_RCLICK_REPORT_ROW:50,ON_CLICK_REPORT_HEADER:51,ON_RCLICK_REPORT_HEADER:52,ON_REPORT_LOCAL_SORT:53,ON_DRAW_REPORT_NAME_COLOR:54,ON_DRAW_CUSTOM_TEXT:55,ON_CLICK_REPORT_TAB:56,ON_CLICK_REPORT_TABMENU:57,ON_DRAW_REPORT_FIXEDROW_TEXT:58,ON_CLICK_REPORT_FIXEDROW:59,ON_RCLICK_REPORT_FIXEDROW:60,ON_KEYDOWN_SELECT_RECT_FIRST:61,ON_CLICK_FRAME_TOOLBAR:62,ON_REPORT_DRAG_ROW:63,ON_MOUSE_MOVE:64,ON_MINUTE_PAGE_CHANGED:65,ON_DRAG_SUB_SELECT_RECT:66,ON_DRAG_SUB_SELECT_RECT_MOUSEUP:67,ON_KEYBOARD_SELECTED:68,ON_KEYBOARD_MOUSEUP:69,ON_CLICK_DRAWPICTURE_BUTTON:70,ON_FINISH_MOVE_DRAWPICTURE:71,ON_CLICK_EXTENDCHART_BUTTON:72,ON_SCROLLBAR_SLIDER_CHANGED:73,ON_DISPLAY_LATEST:74,ON_FORMAT_CORSSCURSOR_Y_TEXT:75,ON_FORMAT_INDEX_OUT_TEXT:76,ON_FORMAT_CORSSCURSOR_X_TEXT:77,ON_REPORT_MOUSE_MOVE:78,ON_REPORT_DRAG_HEADER_TOOLTIP:88,ON_REPORT_DRAW_CUSTOM_ICON:89,ON_REPORT_DRAW_KLINE:90,ON_DBCLICK_REPORT_DRAG_COLUMN_WIDTH:91,ON_REPORT_FORMAT_DRAW_INFO:92,ON_FORMAT_INDEX_Y_LABEL:93,ON_FORMAT_OVERLAY_INDEX_Y_LABEL:94,ON_CUSTOM_UNCHANGE_KLINE_COLOR:95,ON_CLICK_TITLE_BUTTON:96,ON_CUSTOM_LEFT_TOOLBAR:97,ON_CUSTOM_RIGHT_TOOLBAR:98,ON_REPORT_DRAG_COLUMN_WIDTH:99,ON_CUSTOM_UNCHANGE_KLINE_TITLE_COLOR:100,ON_CHANGE_KLINE_PERIOD:101,ON_MINUTE_TOUCH_ZOOM:102,ON_RELOAD_INDEX_CHART_RESOURCE:103,ON_RELOAD_OVERLAY_INDEX_CHART_RESOURCE:104,ON_CREATE_FRAME:105,ON_DELETE_FRAME:106,ON_SIZE_FRAME:107,ON_TOUCH_SCROLL_UP_DOWN:108,ON_RECV_REALTIME_DATA:109,ON_CUSTOM_OVERLAY_TOOLBAR:110,ON_BEFORE_DRAW:111,ON_BEFORE_DRAW_DYNAMIC_INFO:112,ON_CUSTOM_DRAG_MOUSE_DOWN:113,ON_CUSTOM_DRAG_DOC_MOUSE_MOVE:114,ON_CUSTOM_DRAG_DOC_MOUSE_UP:115,ON_CUSTOM_DRAG_MOUSE_MOVE:116,ON_KEYDOWN:117,ON_CREATE_OVERLAY_FRAME:118,ON_CREATE_CUSTOM_Y_COORDINATE:119,ON_BEFORE_DRAW_SPLASH_SCREEN:120,ON_TREPORT_MARKET_STATUS:121,ON_DBCLICK_TREPORT_ROW:122,ON_RCLICK_TREPORT_ROW:123,ON_CLICK_TREPORT_HEADER:124,ON_RCLICK_TREPORT_HEADER:125,ON_TREPORT_LOCAL_SORT:126,ON_CLICK_TREPORT_ROW:127,ON_MOVE_SELECTED_TREPORT_ROW:128,ON_DRAW_REPORT_ROW_BG:140,ON_CLICK_REPORT_CHECKBOX:141,ON_CLICK_REPORT_BUTTON:142,ON_CLICK_REPORT_LINK:143,ON_CREATE_REPORT_HEADER_MENU:144,ON_CHANGE_INDEX:150,ON_MENU_COMMAND:151,ON_CREATE_RIGHT_MENU:152,ON_FORMAT_CALL_AUCTION_INDEX_TITLE:153,ON_FORMAT_KLINE_HIGH_LOW_TITLE:154,ON_CUSTOM_CORSSCURSOR_POSITION:155,ON_CUSTOM_MINUTE_NIGHT_DAY_X_INDEX:156,ON_CUSTOM_MINUTE_BG:157,ON_CLICK_HORIZONTAL_LABEL:158,ON_FORMAT_DIALOG_TOOLTIP:159,ON_CHANGE_KLINE_RIGHT:160,ON_FORMAT_KLINE_FLOAT_TOOLTIP:161,ON_FORMAT_KLINE_INFO_FLOAT_TOOLTIP:162,SEARCH_DIALOG_ON_CLICK_INDEX:163,ON_CALCULATE_CHIP_DATA:164},ve={OP_SCROLL_LEFT:1,OP_SCROLL_RIGHT:2,OP_ZOOM_OUT:3,OP_ZOOM_IN:4,OP_GOTO_HOME:5,OP_GOTO_END:6,OP_LEFT_ZOOM_OUT:7,OP_LEFT_ZOOM_IN:8,OP_RIGHT_ZOOM_OUT:9,OP_RIGHT_ZOOM_IN:10,OP_SCROLL_GOTO:11,OP_SET_SELECTRECT:12,OP_SET_SUB_SELECTRECT:13,OP_CORSSCURSOR_GOTO:14,OP_SCROOLBAR_SLIDER_CHANGED:15,OP_GOTO:16,OP_GOTO_BY_DATAINDEX:17},Ve={DISABLE_DRAG_ID:0,CLICK_TOUCH_MODE_ID:3},Rt={CLOSE_BEFOREOPEN_ID:1,CLOSE_OVERLAY_INDEX:2,MODIFY_INDEX_PARAM:3,CHANGE_INDEX:4,CLOSE_INDEX_WINDOW:5,OVERLAY_INDEX:6,MODIFY_OVERLAY_INDEX_PARAM:7,CHIP_DEFULT:8,CHIP_LONG:9,CHIP_RECENT:10,MAX_MIN_WINDOW:11,TITLE_WINDOW:12,DRAW_PICTURE_DELETE:13,DRAW_PICTURE_SETTING:14,EXTEND_CHART_BUTTON_ID:15,EXPORT_DATA:16,DRAW_PICTURE_BUTTON_1:17,DRAW_PICTURE_BUTTON_2:18,DRAW_PICTURE_BUTTON_3:19,DRAW_PICTURE_BUTTON_4:20,DRAW_PICTURE_BUTTON_5:21,DRAW_PICTURE_BUTTON_6:22,DRAW_PICTURE_BUTTON_7:23,DRAW_PICTURE_BUTTON_8:24,DRAW_PICTURE_BUTTON_9:25,DRAW_PICTURE_BUTTON_10:26,DRAW_PICTURE_BUTTON_11:27,DRAW_PICTURE_BUTTON_12:28,DRAW_PICTURE_BUTTON_13:29,DRAW_PICTURE_BUTTON_14:30,DRAW_PICTURE_BUTTON_15:31,DRAW_PICTURE_BUTTON_16:32,DRAW_PICTURE_BUTTON_17:33,DRAW_PICTURE_BUTTON_18:34,POP_MENU_1:40,POP_MENU_2:41,POP_MENU_3:42,INDEX_NAME_BUTTON:43},qe={KLINE_ORDERFLOW:99,MINUTE_MULTI_DAY_EXTENDDATA:21,MINUTE_DAY_EXTENDDATA:21,MINUTE_BEFOREOPEN_EXTENDDATA:21,MINUTE_AFTERCLOSE_EXTENDDATA:21,KLINE_COLOR_DATA:66,KLINE_DAY_EXTENDDATA:25,KLINE_MINUTE_EXTENDDATA:25,KLINE_HEATMAP:67},ss={EXECUTE_SCRIPT:1,FINISH_EXECUTE_SCRIPT:2,ERROR_EXECUTE_SCRIPT:3},q={CMD_CHANGE_PERIOD_ID:1,CMD_CHANGE_WINDOW_COUNT_ID:2,CMD_CHANGE_RIGHT_ID:3,CMD_CHANGE_INDEX_ID:4,CMD_CHANGE_COLOR_INDEX_ID:5,CMD_CHANGE_TRADE_INDEX_ID:6,CMD_DELETE_COLOR_INDEX_ID:7,CMD_DELETE_TRADE_INDEX_ID:8,CMD_CHANGE_KLINE_TYPE_ID:9,CMD_CHANGE_PRICE_GAP_ID:10,CMD_OVERLAY_SYMBOL_ID:11,CMD_DELETE_ALL_OVERLAY_SYMBOL_ID:12,CMD_CHANGE_COORDINATETYPE_ID:13,CMD_CHANGE_KLINE_INFO_ID:14,CMD_DELETE_ALL_KLINE_INFO_ID:15,CMD_CHANGE_DRAG_MODE_ID:16,CMD_CHANGE_BG_SPLIT_ID:17,CMD_SHOW_DRAWTOOL_ID:18,CMD_HIDE_DRAWTOOL_ID:19,CMD_SHOW_STOCKCHIP_ID:20,CMD_HIDE_STOCKCHIP_ID:21,CMD_ENABLE_SELECT_RECT_ID:22,CMD_CHANGE_DAY_COUNT_ID:23,CMD_SHOW_BEFORE_DATA_ID:24,CMD_SELECTED_ZOOM_ID:25,CMD_SELECTED_SUMMARY_ID:26,CMD_SHOW_INDEX_ID:27,CMD_SHOW_OVERLAY_INDEX_ID:28,CMD_DELETE_OVERLAY_INDEX_ID:29,CMD_SHOW_OVERLAY_Y_AXIS_ID:30,CMD_ENABLE_OVERLAY_SHARE_Y_ID:31,CMD_CHANGE_DEFAULTCURSOR_ID:32,CMD_CHANGE_API_INDEX_ID:33,CMD_CHANGE_SCRIPT_INDEX_ID:34,CMD_CHANGE_BASELINE_ID:35,CMD_ADD_OVERLAY_INDEX_ID:36,CMD_CHANGE_LANGUAGE_ID:37,CMD_CHANGE_DRAG_RECT_SHOW_MODE_ID:38,CMD_SHOW_CORSS_LINE_ID:39,CMD_ENABLE_POP_MINUTE_CHART_ID:40,CMD_CHANGE_INFO_POSITION_ID:41,CMD_CHIP_CHART_SETTING_ID:42,CMD_REPORT_CHANGE_BLOCK_ID:60,CMD_REPORT_COLUMN_SORT_ID:61,CMD_REPORT_COLUMN_DEL_ID:62,CMD_REPORT_COLUMN_MOVE_ID:63,CMD_REPORT_COLUMN_FILTER_ID:64,CMD_DIALOG_TOOLTIP_ATTRIBUTE:65,CMD_KLINE_TOOLTIP_ATTRIBUTE:66,CMD_MODIFY_INDEX_PARAM:67,CMD_MODIFY_OVERLAY_INDEX_PARAM:68};function md(){this.Start=[],this.Clear=function(){this.Start=[]},this.AddTouchStart=function(e,a,r){if(this.Start.length>0){var t=this.Start[this.Start.length-1],n=r-t.Time;n>0&&n<300?this.Start.push({X:e,Y:a,Time:r}):this.Start=[]}else this.Start.push({X:e,Y:a,Time:r})},this.IsVaildDBClick=function(){return this.Start.length==2},this.AddTouchEnd=function(e){if(!(this.Start.length<=0)){var a=this.Start[this.Start.length-1],r=e-a.Time;r>=0&&r<150||(this.Start=[])}}}function Kh(e,a,r){var t=this;if(this.ClassName="JSChartContainer",this.Frame,this.ChartPaint=new Array,this.ChartPaintEx=[],this.ChartInfo=new Array,this.ChartInfoPaint,this.ExtendChartPaint=new Array,this.TitlePaint=new Array,this.OverlayChartPaint=new Array,this.ChartDrawPicture=new Array,this.ChartDrawStorage,this.ChartDrawOption={IsLockScreen:!1,Zoom:1,Magnet:null},this.CurrentChartDrawPicture=null,this.SelectChartDrawPicture=null,this.MoveOnChartDrawPicture=null,this.EnableEraseChartDrawPicture=!1,this.IsDrawPictureXY=!1,this.EnableShowCorssCursor={DrawPicture:!0},this.ChartPictureMenu,this.ChartCorssCursor,this.ChartDragSelectRect,this.IsClickShowCorssCursor=!1,this.ChartSplashPaint=null,this.LoadDataSplashTitle="数据加载中",this.DefaultCursor="default",this.CacheCanvas=null,this.CacheElement=null,r&&(this.CacheElement=r,this.CacheCanvas=r.getContext("2d")),a)this.Canvas=a.getContext("2d"),this.OffscreenCanvasElement=a,this.ShowCanvas=e.getContext("2d");else{if(Ht.EnableCanvasWillReadFrequently===!0){var n={willReadFrequently:!0};this.Canvas=e.getContext("2d",n)}else this.Canvas=e.getContext("2d");this.ShowCanvas=null}this.CorssCursorElement,this.CorssCursorCanvas,this.UIElement=e,this.MouseDrag,this.PhoneTouchInfo,this.DragMode=1,this.EnableBorderDrag=!0,this.BorderDrag,this.YDrag,this.TouchStatus={CorssCursorShow:!1},this.DragTimer,this.EnableScrollUpDown=!1,this.ClickChartTimer=null,this.CursorIndex=0,this.LastPoint=new ft,this.IsForceLandscape=!1,this.CorssCursorTouchEnd=!1,this.IsTitleShowLatestData=!1,this.StepPixel=4,this.ZoomStepPixel=5,this.TouchMoveMinAngle=70,this.EnableAnimation=!1,this.Tooltip=document.createElement("div"),this.Tooltip.className="jschart-tooltip",this.Tooltip.style.background=d.TooltipBGColor,this.Tooltip.style.opacity=d.TooltipAlpha,this.Tooltip.style["pointer-events"]="none",this.Tooltip.id=Re(),e.parentNode.appendChild(this.Tooltip),this.IsShowTooltip=!0,this.KLineTooltipConfig={EnableKeyDown:!0,Enable:!0},this.TooltipCache={Type:null,IsShow:!1,X:null,Y:null,Data:null,InnerHTML:null},this.FrameSplitData=new Dt.default,this.FrameSplitData.set("double",new SD),this.FrameSplitData.set("price",new mm),this.mapEvent=new Dt.default,this.PhonePinch=null,this.IsOnTouch=!1,this.TouchDrawCount=0,this.DisableMouse=!1,this.LanguageID=xe.LANGUAGE_CHINESE_ID,this.PressTime=500,this.IsPress=!1,this.NetworkFilter,this.LastMouseStatus={MouseOnToolbar:null},this.ClickDownPoint,this.IsDestroy=!1,this.EnableYDrag={Left:!1,Right:!1,Wheel:!1,WheelYMove:5},this.EnableZoomIndexWindow=!1,this.EnableVerifyRecvData=!1,this.PhoneDBClick=new md,this.SelectedChart={EnableSelected:!1,EnableMoveOn:!1,Selected:{Identify:null},MoveOn:{Identify:null}},this.IndexChartDrag,this.EnableIndexChartDrag=!1,this.GlobalOption={IsValueFullRange:!1,IsDisplayLatest:!1,SelectedBorder:{Mode:0,SelFrame:0},SelectedXBorder:{Mode:0,Date:null},RightHorizontal:{}},this.VerticalDrag,this.EnableVerticalDrag=!1,this.ClickModel={IsShowCorssCursor:!1},this.EnableClickModel=!1,this.DisplayLatestOption={Timer:null,Enable:!1,DelayTime:60*1e3*3,LastPoint:null},this.DrawDynamicInfoOption={Timer:null,Enable:!1,DelayTime:10},this.CustomChartDrag,this.StockCache={Data:null},this.JSPopMenu,this.IsShowRightMenu=!0,this.DialogDrawTool,this.DialogModifyDraw,this.DialogTooltip,this.DialogSelectRect,this.FloatTooltip,this.DialogSearchIndex,this.DialogModifyIndexParam,this.GetVolUnit=function(){var s=this.Symbol?this.Symbol.toUpperCase():null,o=U.GetVolUnit(s);return o},this.ClearStockCache=function(){this.StockCache.Data=null},this.InitalPopMenu=function(){this.JSPopMenu||(this.JSPopMenu=new Ne,this.JSPopMenu.Inital())},this.InitalDrawToolDialog=function(){this.DialogDrawTool||(this.DialogDrawTool=new LD,this.DialogDrawTool.Inital(this),this.DialogDrawTool.Create())},this.InitalTooltipDialog=function(s){this.DialogTooltip||(this.DialogTooltip=new Lg,this.DialogTooltip.Inital(this,s),this.DialogTooltip.Create())},this.InitalFloatTooltip=function(s){this.FloatTooltip||(this.FloatTooltip=new Rg,this.FloatTooltip.Inital(this,s),this.FloatTooltip.Create())},this.InitalModifyDrawDialog=function(){this.DialogModifyDraw||(this.DialogModifyDraw=new Mg,this.DialogModifyDraw.Inital(this),this.DialogModifyDraw.Create())},this.InitalSelectRectDialog=function(s){this.DialogSelectRect||(this.DialogSelectRect=new Ng,this.DialogSelectRect.Inital(this,s),this.DialogSelectRect.Create())},this.InitalSearchIndexDialog=function(s){this.DialogSearchIndex||(this.DialogSearchIndex=new Il,this.DialogSearchIndex.Inital(this,s),this.DialogSearchIndex.Create())},this.InitalModifyIndexParamDialog=function(s){this.DialogModifyIndexParam||(this.DialogModifyIndexParam=new Ag,this.DialogModifyIndexParam.Inital(this,s),this.DialogModifyIndexParam.Create())},this.ShowChangeIndexDialog=function(s){s&&this.DialogSearchIndex&&(s.Title="切换指标 [窗口"+(s.WindowIndex+1)+"]",this.DialogSearchIndex.SetOpData(s),this.DialogSearchIndex.Show())},this.ShowAddOverlayIndexDialog=function(s){s&&this.DialogSearchIndex&&(s.Title="添加叠加指标 [窗口"+(s.WindowIndex+1)+"]",this.DialogSearchIndex.SetOpData(s),this.DialogSearchIndex.Show())},this.ShowAddIndexWindowDialog=function(s){if(this.DialogSearchIndex){var o=s;o||(o={}),o.OpType=3,o.Title="增加指标窗口",this.DialogSearchIndex.SetOpData(o),this.DialogSearchIndex.Show()}},this.ShowModifyIndexParamDialog=function(s){if(this.DialogModifyIndexParam){if(s.Type==1){var o=this.WindowIndex[s.WindowIndex];if(!o)return;s.IndexScript=o,s.Title="["+o.Name+"]参数修改 窗口["+(s.WindowIndex+1)+"]"}else if(s.Type==2){var l=this.GetOverlayIndexByIdentify(s.Identify);if(!l||!l.OverlayItem.Script)return;var o=l.OverlayItem.Script;s.IndexScript=o,s.Title="["+o.Name+"]参数修改 叠加窗口["+(s.WindowIndex+1)+"]"}this.DialogModifyIndexParam.SetIndexData(s),this.DialogModifyIndexParam.Show()}},this.DrawSelectRectDialog=function(){},this.IsShowSelectRectDialog=function(){return this.DialogSelectRect?this.DialogSelectRect.IsShow():!1},this.ShowDrawToolDialog=function(s,o){if(this.DialogDrawTool){var l=this.UIElement.getBoundingClientRect(),h=Da(),u=this.UIElement.offsetTop+15,f=this.UIElement.offsetWidth-this.DialogDrawTool.DivDialog.offsetWidth-15;f+=l.left+h.Left,u+=l.top+h.Top,this.DialogDrawTool.Show(f,u)}},this.IsShowDrawToolDialog=function(){return this.DialogDrawTool?this.DialogDrawTool.IsShow():!1},this.ShowModifyDrawDialog=function(s,o,l){if(this.DialogModifyDraw&&(this.DialogModifyDraw.SetChartPicture(s),!this.DialogModifyDraw.IsShow())){var h=this.UIElement.getBoundingClientRect(),u=Da(),f=this.UIElement.offsetTop+15,C=(this.UIElement.offsetWidth-this.DialogModifyDraw.DivDialog.offsetWidth)/2;C+=h.left+u.Left,f+=h.top+u.Top,this.DialogModifyDraw.Show(C,f)}},this.CloseModifyDrawDialog=function(){this.DialogModifyDraw&&this.DialogModifyDraw.Close()},this.IsShowTooltipDialog=function(){return this.DialogTooltip?this.DialogTooltip.IsShow():!1},this.CloseTooltipDialog=function(){this.DialogTooltip&&this.DialogTooltip.Close()},this.HideFloatTooltip=function(){this.FloatTooltip&&this.FloatTooltip.Hide()},this.DestroyTooltipDialog=function(){this.DialogTooltip&&(this.DialogTooltip.Destroy(),this.DialogTooltip=null)},this.DestroyFloatTooltip=function(){this.FloatTooltip&&(this.FloatTooltip.Destroy(),this.FloatTooltip=null)},this.DestroySearchIndexDialog=function(){this.DialogSearchIndex&&(this.DialogSearchIndex.Destroy(),this.DialogSearchIndex=null)},this.SetCorssCursorElement=function(s){!s||!s.Element||!s.Canvas||(this.CorssCursorElement=s.Element,this.CorssCursorCanvas=s.Canvas)},this.StopDisplayLatest=function(){this.GlobalOption.IsDisplayLatest=!1,this.DisplayLatestOption.Timer&&(clearTimeout(this.DisplayLatestOption.Timer),this.DisplayLatestOption.Timer=null)},this.StartStopDisplayLatest=function(){var s=this;this.StopDisplayLatest(),this.DisplayLatestOption.Enable&&(this.DisplayLatestOption.Timer=setTimeout(function(){s.DisplayLatest&&(k.Chart.Log("[JSChartContainer:StartStopDisplayLatest] call this.DisplayLatest()"),s.DisplayLatest())},this.DisplayLatestOption.DelayTime))},this.StopDrawDynamicInfo=function(){this.DrawDynamicInfoOption.Timer&&(clearTimeout(this.DrawDynamicInfoOption.Timer),this.DrawDynamicInfoOption.Timer=null)},this.ChartDestroy=function(){this.IsDestroy=!0,this.StopAutoUpdate(),this.DestroyTooltipDialog(),this.DestroyFloatTooltip(),this.DestroySearchIndexDialog()},this.ChartDestory=this.ChartDestroy,this.SetFocus=function(){this.UIElement&&this.UIElement.focus()},this.AddEventCallback=function(s){if(!(!s||!s.event||!s.callback)){var o={Callback:s.callback,Source:s};this.mapEvent.set(s.event,o)}},this.RemoveEventCallback=function(s){this.mapEvent.has(s)&&this.mapEvent.delete(s)},this.GetEventCallback=function(s){if(!this.mapEvent.has(s))return null;var o=this.mapEvent.get(s);return o},this.GetIndexEvent=function(){return this.GetEventCallback($.RECV_INDEX_DATA)},this.GetOverlayIndexEvent=function(){return this.GetEventCallback($.RECV_OVERLAY_INDEX_DATA)},e.onmousemove=function(s){t.UIOnMouseMove(s)},e.oncontextmenu=function(s){return t.UIOnContextMenu(s)},e.ondblclick=function(s){t.UIOnDblClick(s)},e.onmousedown=function(s){t.UIOnMouseDown(s)},e.onmouseout=function(s){t.UIOnMounseOut(s)},e.onmouseleave=function(s){t.UIOnMouseleave(s)},this.UIOnMouseMove=function(s){var o=B(),l=(s.clientX-this.UIElement.getBoundingClientRect().left)*o,h=(s.clientY-this.UIElement.getBoundingClientRect().top)*o;if(this.StopDisplayLatest(),this.MoveOnChartDrawPicture=null,!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)&&this.DisableMouse!=!0&&!this.BorderDrag&&!this.YDrag&&!this.IndexChartDrag&&!this.CustomChartDrag){s&&s.type=="mouseout"&&s.buttons==0&&(l=h=-1);var u={X:l,Y:h,IsInClient:this.IsMouseOnClient(l,h)};this.LastMouseStatus.OnMouseMove=u,this.LastMouseStatus.MoveOnPoint={X:l,Y:h};var f=this.GetEventCallback($.ON_MOUSE_MOVE),C=this.TitlePaint[0];f&&C&&(C.OnMouseMoveEvent=f),this.MoveOnPoint={X:l,Y:h},this.OnMouseMove(l,h,s),C&&(C.OnMouseMoveEvent=null),this.StartStopDisplayLatest()}},this.IsMouseOnClient=function(s,o){var l={Left:this.Frame.ChartBorder.GetLeft(),Top:this.Frame.ChartBorder.GetTop(),Width:this.Frame.ChartBorder.GetWidth(),Height:this.Frame.ChartBorder.GetHeight()};return l.Right=l.Left+l.Width,l.Bottom=l.Top+l.Height,s>=l.Left&&s<=l.Right&&o>=l.Top&&o<=l.Bottom},this.UIOnContextMenu=function(s){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)&&this.IsShowRightMenu){var o=s.clientX-this.UIElement.getBoundingClientRect().left,l=s.clientY-this.UIElement.getBoundingClientRect().top;return typeof this.OnRightMenu=="function"&&this.OnRightMenu(o,l,s),!1}},this.UIOnDblClick=function(s){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash)){var o=B(),l=(s.clientX-this.UIElement.getBoundingClientRect().left)*o,h=(s.clientY-this.UIElement.getBoundingClientRect().top)*o;this.OnDoubleClick(l,h,s)}},this.TryYDrag=function(s,o){if(!this.EnableYDrag||!this.EnableYDrag.Left&&!this.EnableYDrag.Right||!this.Frame||!this.Frame.PtInFrameY)return null;var l=this.Frame.PtInFrameY(s,o);return!l||l.Index<0?null:l.IsOverlay===!0?!l.Right||!this.EnableYDrag.Right?null:this.Frame.IsEnableOverlayDragY(l.Index,l.OverlayIndex)?l:null:l.Left&&this.EnableYDrag.Left&&this.Frame.IsEnableDragY(l.Index)||l.Right&&this.EnableYDrag.Right&&this.Frame.IsEnableDragY(l.Index)?l:null},this.TryUpDownDrag=function(s,o){var l=this.Frame.PtInFrame(s,o);if(l<0)return null;var h=this.Frame.SubFrame[l];if(!h||!h.Frame)return null;var u=h.Frame;return!u.YSplitOperator||!u.YSplitOperator.FixedYMaxMin?null:{Index:l,X:s,Y:o}},this.TryRectSelectDrag=function(s,o){var l=this.GetRectSelectPaint();if(!l||l.GetPointCount()<=0)return null;var h=l.PtInPaint(s,o);return{Item:h,X:s,Y:o}},this.TryClickCrossCursor=function(s,o,l){if(this.ChartCorssCursor){var h=this.ChartCorssCursor.PtInButton(s,o);if(!h)return!1;var u=this.GetEventCallback($.ON_CLICK_CROSSCURSOR_RIGHT);if(u&&u.Callback){var f={Button:h,e:l};u.Callback(u,f,this)}return!0}},this.TryClickButton=function(s,o,l){var h=this.Frame.PtInButtons(s,o);if(h&&this.ClickFrameButton)return this.ClickFrameButton(h,l),!0;if(h=this.PtInExtendChartButtons(s,o),h&&this.ClickExtendChartButton)return this.ClickExtendChartButton(h,l),!0;if(h=this.PtInDrawPictureButtons(s,o),h&&this.ClickDrawPictureButton)return this.ClickDrawPictureButton(h,l),!0;if(h=this.PtInTitleButtons(s,o),h&&this.ClickTitleButton)return this.ClickTitleButton(h,l),!0;var u=this.Frame.PtInHorizontalLabel(s,o);return u&&this.ClickHorizontalLabel?(this.ClickHorizontalLabel(u,l),!0):!1},this.TryMouseMove_CustomChartDrag=function(s){var o=this.GetEventCallback($.ON_CUSTOM_DRAG_MOUSE_MOVE);return!o||!o.Callback?!1:o.Callback(o,s,this)},this.TryClick_CustomChartDrag=function(s){var o=this.GetEventCallback($.ON_CUSTOM_DRAG_MOUSE_DOWN);if(!o||!o.Callback)return!1;s.ChartDrag=null,s.Cusrsor=null,o.Callback(o,s,this),this.CustomChartDrag=s.ChartDrag,this.SetCursor(s)},this.TryDragMove_CustomChartDrag=function(s){var o=this.GetEventCallback($.ON_CUSTOM_DRAG_DOC_MOUSE_MOVE);if(!(!o||!o.Callback)){var l=s.e,h=s.Drag;Math.abs(h.LastMove.Y-l.clientY)<2&&Math.abs(h.LastMove.X-l.clientX)<2||o.Callback(o,s,this)&&(h.LastMove.X=l.clientX,h.LastMove.Y=l.clientY)}},this.TryMouseUp_CustomChartDrag=function(s){var o=this.GetEventCallback($.ON_CUSTOM_DRAG_DOC_MOUSE_UP);!o||!o.Callback||o.Callback(o,s,this)},this.UIOnMouseDown=function(s){var o=this;if(this.MoveOnChartDrawPicture=null,!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){this.ClickDownPoint={X:s.clientX,Y:s.clientY},this.IsOnTouch=!0,this.BorderDrag=null,this.YDrag=null,this.UpDownDrag=null,this.RectSelectDrag=null,this.IndexChartDrag=null,this.CustomChartDrag=null;var l=B(),h=(s.clientX-this.UIElement.getBoundingClientRect().left)*l,u=(s.clientY-this.UIElement.getBoundingClientRect().top)*l;if(this.TryClickButton(h,u,s)){this.IsOnTouch=!1;return}var f=!1;if(this.GlobalOption.SelectedBorder&&this.GlobalOption.SelectedBorder.Mode>=1){var C=this.GlobalOption.SelectedBorder,D=this.Frame.PtInFrame(h,u);D>=0&&D!=C.SelFrame&&(C.SelFrame=D,f=!0)}var c=!1;if(this.GlobalOption.SelectedXBorder&&this.GlobalOption.SelectedXBorder.Mode>=1&&this.PtInMulitDayMinute){var C=this.GlobalOption.SelectedXBorder,T=this.PtInMulitDayMinute(h,u);C.Date!=T&&(C.Date=T,c=!0)}if(this.TryClickCrossCursor(h,u,s)){this.IsOnTouch=!1;return}if(this.TryClickChartTooltipData&&this.TryClickChartTooltipData(h,u,s)){this.IsOnTouch=!1;return}if(!(this.TryClickLock&&this.TryClickLock(h,u))){this.HideSelectRect(),this.ClearDragSelectRect(),this.ChartPictureMenu&&this.ChartPictureMenu.Hide();var S=this.GetRectSelectPaint();if(S&&S.GetPointCount()>0){var C=S.PtInPaint(h,u);if(C)if(C.Type==4){this.SetCursor({Cursor:"pointer"});var I={X:s.clientX};this.GetXDataIndex(I)&&(this.RectSelectDrag={DataIndex:I.DataIndex,Type:C.Type,X:s.clientX},k.Chart.Log("[JSChartContainer::UIOnMouseDown] drag sub rect select ",I))}else this.SetCursor({Cursor:"ew-resize"}),this.RectSelectDrag={Index:C.PointIndex,Type:C.Type},k.Chart.Log("[JSChartContainer::UIOnMouseDown] drag rect select ",C)}if(this.IsShowSelectRectDialog()||!this.RectSelectDrag&&this.ClearRectSelect(!1)&&this.Draw(),this.EnableBorderDrag&&this.Frame){var g=this.Frame.PtInFrameBorder(h,u);g&&g.Index>=0&&(this.SetCursor({Cursor:"n-resize"}),this.BorderDrag={Index:g.Index},k.Chart.Log("[JSChartContainer::UIOnMouseDown] DragBorder ",g))}if(!this.BorderDrag){var E=this.TryYDrag(h,u);if(E){var F=E.Position==0?"n-resize":"row-resize";this.SetCursor({Cursor:F}),this.YDrag=E,k.Chart.Log("[JSChartContainer::UIOnMouseDown] dragY ",E)}else{var R=this.TryUpDownDrag(h,u);R&&(this.SetCursor({Cursor:"pointer"}),this.UpDownDrag=R,k.Chart.Log("[JSChartContainer::UIOnMouseDown] dragUpDown ",R))}}var A={X:h,Y:u,e:s};if(this.TryClick_CustomChartDrag(A),this.DragMode!=0){var P={Click:{},LastMove:{},CurrentMove:{}};P.Click.X=s.clientX,P.Click.Y=s.clientY,P.Click.IsInFrameBottom=this.Frame.PtInFrameBottom(h,u),P.LastMove.X=s.clientX,P.LastMove.Y=s.clientY,this.MouseDrag=P;var p=this.GetActiveDrawPicture(),w={Chart:this.SelectedChart.Selected.Chart,Identify:this.SelectedChart.Selected.Identify};if(this.SelectChartDrawPicture=null,!this.BorderDrag){if(!(this.YDrag||this.RectSelectDrag||this.CustomChartDrag))if(this.CurrentChartDrawPicture){this.UpDownDrag=null;var H=this.CurrentChartDrawPicture;H.Status==2?this.SetChartDrawPictureThirdPoint(P.Click.X,P.Click.Y):(this.SetChartDrawPictureFirstPoint(P.Click.X,P.Click.Y),this.FinishChartDrawPicturePoint()&&(H.IsDrawMain?this.Draw():this.DrawDynamicInfo())),p.Select.Guid&&(!this.CurrentChartDrawPicture||p.Select.Guid!=this.CurrentChartDrawPicture.Guid)&&p.Select.Chart.IsDrawMain&&this.Draw()}else{var W={};if(W.X=(s.clientX-this.UIElement.getBoundingClientRect().left)*l,W.Y=(s.clientY-this.UIElement.getBoundingClientRect().top)*l,this.GetChartDrawPictureByPoint(W)){if(this.EnableEraseChartDrawPicture)this.CurrentChartDrawPicture=null,this.SelectChartDrawPicture=null,this.ClearChartDrawPicture(W.ChartDrawPicture);else{this.UpDownDrag=null,this.CurrentChartDrawPicture=W.ChartDrawPicture,this.SelectChartDrawPicture=W.ChartDrawPicture;var ht=!1;(p.Select.Guid&&p.Select.Chart&&p.Select.Chart.IsDrawMain||W.ChartDrawPicture.IsDrawMain)&&(ht=!0),ht&&this.Draw(),W.ChartDrawPicture.EnableMove==!0&&(W.ChartDrawPicture.Status=20),W.ChartDrawPicture.ValueToPoint(),W.ChartDrawPicture.MovePointIndex=W.PointIndex,this.SelectChartDrawPicture.DragInfo={Click:{X:s.clientX,Y:s.clientY}}}var rt=this.GetEventCallback($.ON_CLICK_DRAWPICTURE);if(rt&&rt.Callback){var A={DrawPicture:W.ChartDrawPicture};rt.Callback(rt,A,this)}else this.OnSelectChartPicture(W.ChartDrawPicture)}else{this.ClickChartTimer!=null&&(clearTimeout(this.ClickChartTimer),this.ClickChartTimer=null);var nt=this,vt={X:this.ClickDownPoint.X,Y:this.ClickDownPoint.Y};this.ClickChartTimer=setTimeout(function(){nt.TryClickPaintEvent($.ON_CLICK_CHART_PAINT,vt,s)},250);var Nt=!1;if(this.SelectedChart.EnableSelected){var Ft=this.PtInChart(h,u);Ft?(this.SelectedChart.Selected.Identify!=Ft.Identify&&(this.SelectedChart.Selected.Identify=Ft.Identify,this.SelectedChart.Selected.Chart=Ft.Chart,Nt=!0),this.EnableIndexChartDrag&&(this.IndexChartDrag={SelectedChart:Ft,LastMove:{X:h,Y:u},Click:{X:h,Y:u}},this.IndexChartDrag.Info=this.GetSelectedChartInfo(Ft),this.IndexChartDrag.Info&&(this.IndexChartDrag.Info.FrameID=this.Frame.PtInFrame(h,u)))):this.SelectedChart.Selected.Identify&&(this.SelectedChart.Selected.Identify=null,this.SelectedChart.Selected.Chart=null,Nt=!0)}else this.SelectedChart.Selected.Identify&&(this.SelectedChart.Selected.Identify=null,Nt=!0);if(p.Select.Guid!=null&&this.SelectChartDrawPicture==null||Nt){var Bt=0;if(p.Select.Guid&&p.Select.Chart&&p.Select.Chart.IsDrawMain&&(Bt=1),Nt){var Jt=w.Chart;Jt&&Jt.SetSelectedStatus&&(Jt.SetSelectedStatus(0),Bt=1),Jt=this.SelectedChart.Selected.Chart,Jt&&Jt.SetSelectedStatus&&(Jt.SetSelectedStatus(1),Bt=1)}Bt==1?this.Draw():this.DrawDynamicInfo()}else c?this.Draw():f&&this.DrawDynamicInfo()}}}this.SelectChartDrawPicture||this.CloseModifyDrawDialog(),document.onmousemove=function(te){o.DocOnMouseMove(te)},document.onmouseup=function(te){o.DocOnMouseUp(te)}}}}},this.DocOnMouseMove=function(s){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash)){var o=this.MouseDrag;if(o){var l=Math.abs(o.LastMove.X-s.clientX),h=Math.abs(o.LastMove.Y-s.clientY),u=this.RectSelectDrag&&this.RectSelectDrag.Index>=0,f=this.RectSelectDrag&&this.RectSelectDrag.Type==4;if(o.CurrentMove&&(o.CurrentMove.X=s.clientX,o.CurrentMove.Y=s.clientY),this.BorderDrag&&this.BorderDrag.Index>=0){if(Math.abs(o.LastMove.Y-s.clientY)<5)return;var C=s.clientY-o.LastMove.Y;this.OnMoveFromeBorder(this.BorderDrag.Index,C),o.LastMove.X=s.clientX,o.LastMove.Y=s.clientY}else if(this.YDrag&&this.YDrag.Index>=0){if(h<5)return;var C=s.clientY-o.LastMove.Y;k.Chart.Log("[JSChartContainer::DocOnMouseMove] YDrag ",this.YDrag,C),this.OnZoomUpDownFrameY(this.YDrag,C),o.LastMove.X=s.clientX,o.LastMove.Y=s.clientY}else if(this.IndexChartDrag&&this.IndexChartDrag.SelectedChart){if(Math.abs(o.LastMove.Y-s.clientY)<2&&Math.abs(o.LastMove.X-s.clientX)<2)return;var D=this.GetExtendChartByClassName("DragMovePaint");if(D&&D.Chart){var c=B(),T=(s.clientX-this.UIElement.getBoundingClientRect().left)*c,S=(s.clientY-this.UIElement.getBoundingClientRect().top)*c;D.Chart.Point={X:T,Y:S},D.Chart.IsShow=!0,D.Chart.Info=this.IndexChartDrag.Info,this.DrawDynamicInfo()}this.IndexChartDrag.LastMove.X=T,this.IndexChartDrag.LastMove.Y=S,o.LastMove.X=s.clientX,o.LastMove.Y=s.clientY}else if(this.CustomChartDrag){var c=B(),T=(s.clientX-this.UIElement.getBoundingClientRect().left)*c,S=(s.clientY-this.UIElement.getBoundingClientRect().top)*c,I={X:T,Y:S,e:s,ChartDrag:this.CustomChartDrag,Drag:o};this.TryDragMove_CustomChartDrag(I)}else if(this.CurrentChartDrawPicture&&this.CurrentChartDrawPicture.EnableMove===!0){var g=this.CurrentChartDrawPicture;if(g.Status==1||g.Status==2){if(Math.abs(o.LastMove.X-s.clientX)<5&&Math.abs(o.LastMove.Y-s.clientY)<5)return;this.SetChartDrawPictureSecondPoint(s.clientX,s.clientY)&&this.DrawDynamicInfo()}else if(g.Status==3)this.SetChartDrawPictureThirdPoint(s.clientX,s.clientY)&&this.DrawDynamicInfo();else if(g.Status==20){if(Math.abs(o.LastMove.X-s.clientX)<5&&Math.abs(o.LastMove.Y-s.clientY)<1||this.SelectChartDrawPicture&&this.SelectChartDrawPicture.EnableCtrlMove&&!s.ctrlKey)return;this.SelectChartDrawPicture&&this.SelectChartDrawPicture.DragInfo&&(this.SelectChartDrawPicture.DragInfo.Move={X:s.clientX,Y:s.client}),this.MoveChartDrawPicture(s.clientX-o.LastMove.X,s.clientY-o.LastMove.Y,!1,o)&&this.DrawDynamicInfo()}o.LastMove.X=s.clientX,o.LastMove.Y=s.clientY}else if(this.DragMode==1||u||f)this.OnDragMode_One({X:l,Y:h},s);else if(this.DragMode==2){var E=Math.abs(o.LastMove.Y-s.clientY);if(l<5&&E<5)return;this.SetCursor({Cursor:"default"});var F=this.PointAbsoluteToRelative(o.Click.X,o.Click.Y),R=this.PointAbsoluteToRelative(s.clientX,s.clientY);this.ShowDragSelectRect(F,R),o.LastMove.X=s.clientX,o.LastMove.Y=s.clientY}}}},this.OnDragMode_One=function(s,o){var l=s.X,h=s.Y,u=this.MouseDrag;if(!(l<5&&h<5)){var f=!1,C=!1;if(h>=5&&this.UpDownDrag&&this.UpDownDrag.Index>=0){var D=o.clientY-u.LastMove.Y;k.Chart.Log("[JSChartContainer::OnDragMode_One] UpDownDrag ",this.UpDownDrag,D),this.SetCursor({Cursor:"pointer"}),this.OnUpDonwFrameY(this.UpDownDrag,D)&&(f=!0,C=!0),u.LastMove.Y=o.clientY}if(l>=5){if(this.RectSelectDrag){if(this.RectSelectDrag.Index>=0){var c={X:o.clientX,Y:o.clientY,PointIndex:this.RectSelectDrag.Index,Name:"MoveRectSelectLine"};this.MoveRectSelectPoint(c)&&(f=!0)}else if(this.RectSelectDrag.Type===4){var c={X:o.clientX};if(!this.GetXDataIndex(c)||c.DataIndex==this.RectSelectDrag.DataIndex)return;var T=c.DataIndex-this.RectSelectDrag.DataIndex,S=!0;if(T>0&&(S=!1),!this.MoveSubRectSelect({Step:Math.abs(T),IsLeft:S,X:o.clientX,Y:o.clientY}))return;this.RectSelectDrag.DataIndex=c.DataIndex,this.RectSelectDrag.X=o.clientX,f=!0}}else{var S=!0;u.LastMove.X<o.clientX&&(S=!1);var I="pointer";u.Click.IsInFrameBottom&&(I="ew-resize");var g=this.GetMoveOneStepWidth();if(l<g){this.SetCursor({Cursor:I}),f&&this.Draw();return}else if(u.Click&&u.Click.IsInFrameBottom)this.XCoordinateZoom(l,S)&&(this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),f=!0);else if(this.DataMove(l,S))this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),f=!0;else if(!C&&this.DragDownloadData&&(this.DragDownloadData(),this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash))return;this.SetCursor({Cursor:I})}u.LastMove.X=o.clientX}f&&(this.Draw(),this.OnKLinePageChange("datamove"))}},this.GetXDataIndex=function(s){if(!this.ChartPaint[0]||!this.ChartPaint[0].Data)return!1;var o=this.ChartPaint[0].Data;if(!this.Frame.SubFrame[0])return!1;var l=this.Frame.SubFrame[0].Frame,h=B(),u=(s.X-e.getBoundingClientRect().left)*h,f=l.GetXData(u);f=parseInt(f.toFixed(0));var C=f+o.DataOffset;C>=o.Data.length&&(C=o.Data.length-1);var D=o.Data[C];return s.DataIndex=C,s.Item=D,!0},this.DocOnMouseUp=function(s){document.onmousemove=null,document.onmouseup=null;var o=this.ClassName=="MinuteChartContainer"||this.ClassName=="MinuteChartHScreenContainer",l=this.RectSelectDrag&&this.RectSelectDrag.Index>=0,h=this.RectSelectDrag&&this.RectSelectDrag.Type==4,u=!0;if(this.CurrentChartDrawPicture){var f=this.CurrentChartDrawPicture;f.Status==2||f.Status==1||f.Status==3?(f.PointStatus=f.Status,this.FinishChartDrawPicturePoint()?this.DrawDynamicInfo():u=!1):f.Status==20&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}else if(this.IndexChartDrag&&this.IndexChartDrag.SelectedChart){var C=this.GetExtendChartByClassName("DragMovePaint");C&&C.Chart&&C.Chart.Clear(),this.OnDragChart(this.IndexChartDrag)||this.DrawDynamicInfo(),this.SetCursor({Cursor:"default"})}else if(this.CustomChartDrag){var D={e:s,ChartDrag:this.CustomChartDrag,Drag:this.MouseDrag};this.TryMouseUp_CustomChartDrag(D)}else if(l)this.OnDragSelectRectMouseUp&&this.OnDragSelectRectMouseUp(s);else if(h)this.OnDragSubSelectRectMouseUp&&this.OnDragSubSelectRectMouseUp(s);else if(o)this.OnMinuteSelectRectMouseUp&&this.OnMinuteSelectRectMouseUp(s);else if(this.DragMode==2){var c=this.MouseDrag;c.LastMove.X=s.clientX,c.LastMove.Y=s.clientY;var T=new AC,S=B();if(T.XStart=(c.Click.X-e.getBoundingClientRect().left)*S,T.YStart=(c.Click.Y-e.getBoundingClientRect().top)*S,T.XEnd=(c.LastMove.X-e.getBoundingClientRect().left)*S,T.YEnd=(c.LastMove.Y-e.getBoundingClientRect().top)*S,T.JSChartContainer=this,T.Stock={Symbol:this.Symbol,Name:this.Name},this.ChartDragSelectRect.Enable&&!this.BorderDrag&&this.GetSelectRectData(T)){var I=this.GetEventCallback($.ON_SELECT_RECT),g=this.GetRectSelectPaint(),E=!0;if(I&&I.Callback){var F=(0,ae.default)({X:c.LastMove.X-e.getBoundingClientRect().left,Y:c.LastMove.Y-e.getBoundingClientRect().top,SelectData:T,RectSelectPaint:g,IsShowMenu:!0,e:s},"e",s);I.Callback(I,F,this),E=F.IsShowMenu}if(o)this.HideSelectRect(),this.UpdateSelectRect(T.Start,T.End);else if(E){var F={Chart:this,X:c.LastMove.X-e.getBoundingClientRect().left,Y:c.LastMove.Y-e.getBoundingClientRect().top,SelectData:T,RectSelectPaint:g};s.data=F,this.PopupSelectRectMenuV2(F,s)}}else this.TryClickPaintEvent($.ON_CLICKUP_CHART_PAINT,this.ClickDownPoint,s)}else this.TryClickPaintEvent($.ON_CLICKUP_CHART_PAINT,this.ClickDownPoint,s),this.ClickEvent(s);k.Chart.Log("[KLineChartContainer::document.onmouseup]",s),this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.DragInfo=null),this.SetCursor({Cursor:"default"}),this.MouseDrag=null,this.ClickDownPoint=null,this.IsOnTouch=!1,this.EnableEraseChartDrawPicture==!0&&(this.EnableEraseChartDrawPicture=!1,this.DialogDrawTool&&this.DialogDrawTool.SetEraseChartButtonStatus&&this.DialogDrawTool.SetEraseChartButtonStatus(!1)),this.BorderDrag&&this.BorderDrag.Index>=0&&this.Frame.SaveSubFrameHeightRate(),this.BorderDrag=null,this.YDrag=null,this.UpDownDrag=null,this.RectSelectDrag=null,this.IndexChartDrag=null,this.CustomChartDrag=null,u===!0&&(this.CurrentChartDrawPicture=null)},this.UIOnMounseOut=function(s){k.Chart.Log("[KLineChartContainer::UIOnMounseOut]",s),this.UIOnMouseMove(s)},this.UIOnMouseleave=function(s){k.Chart.Log("[KLineChartContainer::UIOnMouseleave]",s)},this.OnDragChart=function(s){if(!s)return!1;var o=s.Info,l=s.LastMove,h=o.FrameID,u=this.Frame.PtInFrame(l.X,l.Y);return u<0?u==-3?this.MoveIndexToNewWindow({WindowIndex:h,IndexID:o.IndexID},{Operator:0}):!1:h==u?!1:this.MoveIndex({WindowIndex:h,IndexID:o.IndexID},{WindowIndex:u},{Operator:0})},this.GetSelectedChartInfo=function(s){if(!s)return null;var o={Type:0},l=s.Identify;if(l=="Main-KLine")o.Name=this.Name,o.Symbol=this.Symbol,o.Type=Ye.MAIN_KLINE;else if(l.indexOf("Overlay-KLine-")==0)o.Name=s.Chart.Title,o.Symbol=s.Chart.Symbol,o.Type=Ye.OVERLAY_KLINE;else if(l.indexOf("Overlay-Minute-")==0)o.Name=s.Chart.Title,o.Symbol=s.Chart.Symbol,o.Type=Ye.OVERLAY_MINUTE;else if(l=="Minute-Line")o.Name=this.Name,o.Symbol=this.Symbol,o.Type=Ye.MAIN_MINUTE;else if(l=="Minute-Average-Line")o.Name=this.Name,o.Symbol=this.Symbol,o.Type=Ye.MAIN_AVERAGE_MINUTE;else if(l=="Minute-Vol-Bar")o.Name=this.Name,o.Symbol=this.Symbol,o.Type=Ye.MAIN_MINUTE_VOL;else if(l.indexOf("guid")==0)for(var h=0;h<this.TitlePaint.length;++h){var u=this.TitlePaint[h];if(u.ClassName=="DynamicChartTitlePainting"){if(u.Identify==l){o.IndexName=u.Title,o.IndexID=l,o.Type=Ye.MAIN_INDEX;break}var f=!0,C=!1,D=void 0;try{for(var c=(0,ye.default)(u.OverlayIndex),T;!(f=(T=c.next()).done);f=!0){var S=T.value;if(S[0]==l){o.IndexName=S[1].Title,o.IndexID=l,o.Type=Ye.OVERLAY_INDEX;break}}}catch(I){C=!0,D=I}finally{try{!f&&c.return&&c.return()}finally{if(C)throw D}}if(o.Type>0)break}}return o},this.ClickEvent=function(s){var o=this.GetEventCallback($.ON_CLICK);if(!o||!o.Callback||this.ClickDownPoint.X!=s.clientX||this.ClickDownPoint.Y!=s.clientY)return!1;var l=B(),h=(s.clientX-e.getBoundingClientRect().left)*l,u=(s.clientY-e.getBoundingClientRect().top)*l,f={X:s.clientX,Y:s.clientY,FrameID:-1},C=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),C=this.Canvas.isPointInPath(h,u),C){var D={},c=this.Frame.GetYData(u,D);if(v.IsNumber(D.FrameID)&&D.FrameID>=0){var T=this.Frame.GetXData(h);f.FrameID=D.FrameID,f.Data={X:T,Y:c}}}return o.Callback(o,f,this),!0},this.DBClickEvent=function(s,o){var l=this.GetEventCallback($.ON_DBCLICK);if(!l||!l.Callback)return!1;var h=B(),u=(o.clientX-e.getBoundingClientRect().left)*h,f=(o.clientY-e.getBoundingClientRect().top)*h,C={X:o.clientX,Y:o.clientY,FrameID:-1,ClientPos:-1},D=this.PtInClient(u,f);if(C.ClientPos=D,D>0){var c={},T=this.Frame.GetYData(f,c);if(v.IsNumber(c.FrameID)&&c.FrameID>=0){var S=this.Frame.GetXData(u);C.FrameID=c.FrameID,C.Data={X:S,Y:T},this.GetDataItem&&(C.Data.Item=this.GetDataItem({ClientPos:D,Index:S,Point:{X:u,Y:f}}))}}return s&&s.SelectedChart&&(C.SelectedChart=this.GetSelectedChartInfo(s.SelectedChart)),l.Callback(l,C,this),!0},this.PtInChartPaintTooltip=function(s,o,l){for(var h=0;h<this.ChartPaint.length;++h){var u=this.ChartPaint[h];if(u.GetTooltipData(s,o,l))return u}return null},this.PtInOverlayIndexTooltip=function(s,o,l){var h=this.Frame.PtInFrame(s,o);if(h<0||!this.Frame.SubFrame[h])return null;var u=this.Frame.SubFrame[h].OverlayIndex;if(!v.IsNonEmptyArray(u))return null;for(var f=0;f<u.length;++f){var C=u[f];if(v.IsNonEmptyArray(C.ChartPaint))for(var D=0;D<C.ChartPaint.length;++D){var c=C.ChartPaint[D];if(c.IsShow&&!c.IsHideScriptIndex()&&c.GetTooltipData(s,o,l))return l.OverlayIndex={WindowIndex:h,Identify:C.Identify},C.Script&&(l.OverlayIndex.IndexName=C.Script.Name,l.OverlayIndex.IndexID=C.Script.ID),c}}return null},this.PtInOverlayChartPaintTooltip=function(s,o,l){for(var h=0;h<this.OverlayChartPaint.length;++h){var u=this.OverlayChartPaint[h];if(u.GetTooltipData(s,o,l))return u}return null},this.PtInExtendChartPaintTooltip=function(s,o,l){return null},this.TryClickPaintEvent=function(s,o,l){var h=this.GetEventCallback(s);if(h&&h.Callback&&o.X==l.clientX&&o.Y==l.clientY){var u=B(),f=(l.clientX-e.getBoundingClientRect().left)*u,C=(l.clientY-e.getBoundingClientRect().top)*u,D=new ns,c=null,T=this.PtInChartPaintTooltip(f,C,D);if(T&&(c={Symbol:this.Symbol,Name:this.Name}),T||(T=this.PtInOverlayChartPaintTooltip(f,C,D),T&&(c={Symbol:D.ChartPaint.Symbol,Name:D.ChartPaint.Title})),D.Data){var S={X:l.clientX,Y:l.clientY,Stock:c,Tooltip:D};return h.Callback(h,S,this),!0}}return!1},this.IsPhoneDragging=function(s){var o=s.changedTouches.length,l=s.touches.length;return o==1&&l==1},this.IsPhonePinching=function(s){var o=s.changedTouches.length,l=s.touches.length;return(o==1||o==2)&&l==2},this.PreventTouchEvent=function(s){s.cancelable&&s.preventDefault(),s.stopPropagation()},this.GetToucheData=function(s,o){for(var l=new Array,h=B(),u=0;u<s.touches.length;++u){var f=s.touches[u];o?l.push({clientX:f.clientY*h,clientY:f.clientX*h,pageX:f.pageY*h,pageY:f.pageX*h}):l.push({clientX:f.clientX*h,clientY:f.clientY*h,pageX:f.pageX*h,pageY:f.pageY*h})}return l},this.IsSingleTouch=function(s){var o=s.touches.length;return o==1},this.StopDragTimer=function(){v.IsNumber(this.DragTimer)&&(clearTimeout(this.DragTimer),this.DragTimer=null,this.IsPress=!1)},this.GetMoveAngle=function(s,o){var l=Math.abs(s.X-o.X),h=Math.abs(s.Y-o.Y),u=Math.atan(l/h)*180/Math.PI;return u},e.ontouchstart=function(s){t.OnTouchStart(s)},e.ontouchmove=function(s){t.OnTouchMove(s)},e.ontouchend=function(s){t.OnTouchEnd(s)},this.AddPhoneDBClickInfo=function(s,o,l){var h={X:s,Y:o,Time:l};this.PhoneDBClickInfo.Start.push(h)},this.ClearPhoneDBClickInfo=function(){this.PhoneDBClickInfo.Start=[]},this.IsShortPhoneClick=function(s,o,l){},this.OnTouchStart=function(s){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){this.IsPress=!1,this.IsOnTouch=!0,this.TouchDrawCount=0,this.PhonePinch=null,this.StopDragTimer();var o=this.IsSingleTouch(s);if((this.EnableScrollUpDown==!1||!o||this.DragMode==Ve.CLICK_TOUCH_MODE_ID&&this.TouchStatus.CorssCursorShow==!0)&&s.cancelable&&s.preventDefault(),this.IsPhoneDragging(s)){var l=this.GetToucheData(s,this.IsForceLandscape),h=this.PointAbsoluteToRelative(l[0].clientX,l[0].clientY,!0);if(this.TryClickLock||this.TryClickIndexTitle){var u=h.X,f=h.Y;if(this.TryClickLock&&this.TryClickLock(u,f)||this.TryClickIndexTitle&&this.TryClickIndexTitle(u,f))return}if(this.ClickFrameButton){var C=this.Frame.PtInButtons(h.X,h.Y);if(C){this.ClickFrameButton(C,s);return}}this.EnableVerticalDrag&&(this.VerticalDrag={IsDrag:!1},this.Frame.PtInFrameVertical(h.X,h.Y)&&(this.VerticalDrag.IsDrag=!0));var D=!0;this.ChartDrawOption.IsLockScreen?D=!1:this.DragMode==Ve.CLICK_TOUCH_MODE_ID?this.TouchStatus.CorssCursorShow==!0&&(D=!1):this.DragMode==Ve.DISABLE_DRAG_ID?D=!1:o||(D=!1),this.VerticalDrag&&(D=!1),this.EnableClickModel&&this.ClickModel.IsShowCorssCursor==!0&&(D=!1);var c={Click:{},LastMove:{}};c.Click.X=l[0].clientX,c.Click.Y=l[0].clientY,c.LastMove.X=l[0].clientX,c.LastMove.Y=l[0].clientY,this.MouseDrag=c;var T=this.GetActiveDrawPicture();if(this.SelectedChart.Selected.Chart,this.SelectedChart.Selected.Identify,this.PhoneTouchInfo={Start:{X:l[0].clientX,Y:l[0].clientY},End:{X:l[0].clientX,Y:l[0].clientY}},this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.IsSelected=!1),this.SelectChartDrawPicture=null,this.CurrentChartDrawPicture){var S=this.CurrentChartDrawPicture;S.Status==2?this.SetChartDrawPictureThirdPoint(c.Click.X,c.Click.Y,!0):(this.SetChartDrawPictureFirstPoint(c.Click.X,c.Click.Y,!0),this.FinishChartDrawPicturePoint()&&(S.IsDrawMain?this.Draw():this.DrawDynamicInfo({Corss:!1,Tooltip:!1}))),s.cancelable&&s.preventDefault();return}else{var h=this.PointAbsoluteToRelative(l[0].clientX,l[0].clientY,!0),I={X:h.X,Y:h.Y};if(this.GetChartDrawPictureByPoint(I)){I.ChartDrawPicture.EnableMove==!0&&(I.ChartDrawPicture.Status=20),I.ChartDrawPicture.ValueToPoint(),I.ChartDrawPicture.MovePointIndex=I.PointIndex,I.ChartDrawPicture.IsSelected=!0,this.CurrentChartDrawPicture=I.ChartDrawPicture,this.SelectChartDrawPicture=I.ChartDrawPicture;var g=this.GetEventCallback($.ON_CLICK_DRAWPICTURE);if(g&&g.Callback){var E={DrawPicture:I.ChartDrawPicture};g.Callback(g,E,this)}var R=0;(I.ChartDrawPicture.IsDrawMain||T.Select.Guid&&T.Select.Chart&&T.Select.Chart.IsDrawMain)&&(R=1),R==1&&this.Draw(),s.cancelable&&s.preventDefault();return}}if(D){var F=this;this.DragTimer=setTimeout(function(){F.IsPress=!0,c.Click.X==c.LastMove.X&&c.Click.Y==c.LastMove.Y&&(F.MouseDrag,F.MouseDrag=null,F.DragMode==Ve.CLICK_TOUCH_MODE_ID&&(F.TouchStatus.CorssCursorShow=!0),F.EnableClickModel===!0&&(F.ClickModel.IsShowCorssCursor=!0),F.MoveCorssCursor(c.Click,s))},F.PressTime)}this.EnableZoomIndexWindow&&(this.PhoneDBClick.AddTouchStart(l[0].clientX,l[0].clientY,Date.now()),k.Chart.Log("[JSChartContainer::OnTouchStart] PhoneDBClick ",this.PhoneDBClick)),this.ChartDrawOption.IsLockScreen?this.MouseDrag=null:this.DragMode==Ve.CLICK_TOUCH_MODE_ID||(this.DragMode==Ve.DISABLE_DRAG_ID?(this.MouseDrag=null,this.MoveCorssCursor(c.Click,s)):this.EnableClickModel||(this.VerticalDrag?this.VerticalDrag.IsDrag||this.MoveCorssCursor(c.Click,s):this.IsClickShowCorssCursor&&this.MoveCorssCursor(c.Click,s))),this.TouchEvent({EventID:$.ON_PHONE_TOUCH,FunctionName:"OnTouchStart"},s);var R=0;T.Select.Guid!=null&&T.Select.Guid&&T.Select.Chart&&(R=1),R==1&&this.Draw()}else if(this.IsPhonePinching(s)){var A={Start:{},Last:{}},l=this.GetToucheData(s,this.IsForceLandscape);A.Start={X:l[0].pageX,Y:l[0].pageY,X2:l[1].pageX,Y2:l[1].pageY},A.Last={X:l[0].pageX,Y:l[0].pageY,X2:l[1].pageX,Y2:l[1].pageY},this.PhonePinch=A,this.SelectChartDrawPicture=null}}},this.OnTouchMove=function(s){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var o=this.GetToucheData(s,this.IsForceLandscape);if(this.IsPhoneDragging(s)){var l=this.MouseDrag;if(l==null)this.IsForceLandscape&&(y=e.getBoundingClientRect().width-o[0].clientY),this.ChartDrawOption.IsLockScreen||this.MoveCorssCursor({X:o[0].clientX,Y:o[0].clientY},s);else{var h=this.GetMoveAngle(l.LastMove,{X:o[0].clientX,Y:o[0].clientY}),u=Math.abs(l.LastMove.X-o[0].clientX),f=Math.abs(l.LastMove.Y-o[0].clientY);u=parseInt(u);var C=this.DragMode==Ve.CLICK_TOUCH_MODE_ID&&this.TouchStatus.CorssCursorShow==!0;if(this.VerticalDrag&&(this.VerticalDrag.IsDrag===!0?C=!1:C=!0),this.EnableClickModel&&(this.ClickModel.IsShowCorssCursor===!0?C=!0:C=!1),this.CurrentChartDrawPicture&&this.CurrentChartDrawPicture.EnableMove===!0){var D=this.CurrentChartDrawPicture;if(D.Status==1||D.Status==2){if(u<5&&f<5)return;this.SetChartDrawPictureSecondPoint(o[0].clientX,o[0].clientY,!0)&&this.DrawDynamicInfo()}else if(D.Status==3)this.SetChartDrawPictureThirdPoint(o[0].clientX,o[0].clientY,!0)&&this.DrawDynamicInfo();else if(D.Status==20){if(u<5&&f<5)return;this.MoveChartDrawPicture(o[0].clientX-l.LastMove.X,o[0].clientY-l.LastMove.Y,!0)&&this.DrawDynamicInfo()}l.LastMove.X=o[0].clientX,l.LastMove.Y=o[0].clientY}else if(C)this.MouseDrag,this.MouseDrag=null,this.MoveCorssCursor(l.Click,s);else if(this.DragMode==1||C==!1){if((f>0&&u<=3||h<=this.TouchMoveMinAngle)&&this.EnableScrollUpDown==!0){this.StopDragTimer();return}if(u<5||h<=this.TouchMoveMinAngle){this.PreventTouchEvent(s);return}if(this.EnableVerticalDrag&&(!this.VerticalDrag||!this.VerticalDrag.IsDrag))return;var c=!0;l.LastMove.X<o[0].clientX&&(c=!1);var T=this.GetMoveOneStepWidth();if(u<T)return;this.DataMove(u,c)?(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw(),this.OnKLinePageChange("OnTouchMove")):this.DragDownloadData&&this.DragDownloadData(),l.LastMove.X=o[0].clientX,l.LastMove.Y=o[0].clientY}}this.PhoneTouchInfo&&(this.PhoneTouchInfo.End.X=o[0].clientX,this.PhoneTouchInfo.End.Y=o[0].clientY)}else if(this.IsPhonePinching(s)){if(this.DragMode==Ve.DISABLE_DRAG_ID)return;this.PreventTouchEvent(s);var S=this.PhonePinch;if(!S||(S.Operator=null,this.EnableZoomUpDown&&this.EnableZoomUpDown.Touch===!1))return;var I=Math.abs(o[0].pageY-o[1].pageY),g=Math.abs(S.Last.Y-S.Last.Y2),E=I-g,F=Math.abs(o[0].pageX-o[1].pageX),R=Math.abs(S.Last.X-S.Last.X2),A=F-R,P=this.ZoomStepPixel;if(Math.abs(E)<P&&Math.abs(A)<P)return;var p=E;if(Math.abs(E)<P&&(p=A),p>0){var w={IsLockRight:this.IsZoomLockRight};if(w.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomUp(w))return;S.Operator="ZoomUp",this.CursorIndex=w.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.StopDragTimer()}else{var w={IsLockRight:this.IsZoomLockRight};if(w.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomDown(w))return;S.Operator="ZoomDown",this.CursorIndex=w.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.StopDragTimer()}S.Last={X:o[0].pageX,Y:o[0].pageY,X2:o[1].pageX,Y2:o[1].pageY}}this.PreventTouchEvent(s)}},this.OnTouchEnd=function(s){if(k.Chart.Log("[KLineChartContainer:OnTouchEnd]",s),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var o=!0;if(this.CurrentChartDrawPicture){var l=this.CurrentChartDrawPicture;l.Status==2||l.Status==1||l.Status==3?(l.PointStatus=l.Status,this.FinishChartDrawPicturePoint()?this.DrawDynamicInfo():o=!1):l.Status==20&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}if(this.EnableZoomIndexWindow){var h=Date.now();this.PhoneDBClick.AddTouchEnd(h),this.PhoneDBClick.IsVaildDBClick()&&(this.OnTouchDBClick(this.PhoneDBClick.Start),this.PhoneDBClick.Clear())}this.IsOnTouch=!1,this.VerticalDrag=null,o===!0&&(this.CurrentChartDrawPicture=null),this.StopDragTimer(),this.TouchEvent({EventID:$.ON_PHONE_TOUCH,FunctionName:"OnTouchEnd"},s),this.OnTouchFinished(),this.TouchDrawCount=0,this.PhonePinch=null}},this.OnTouchDBClick=function(s){var o=this.PointAbsoluteToRelative(s[0].X,s[0].Y,!0),l=o.X,h=o.Y;k.Chart.Log("[KLineChartContainer:OnTouchDBClick] Phone dbclick absolute ["+l+","+h+"], soruce ["+s[0].X+","+s[0].Y+"]");var u=this.Frame.PtInFrame(l,h);if(k.Chart.Log("[KLineChartContainer::OnTouchDBClick] frameId",u),u>=this.Frame.ZoomStartWindowIndex&&this.ZoomIndexWindow(u,{X:l,Y:h}))return this.Frame.SetSizeChage(!0),this.Draw(),!0},this.TouchEvent=function(s,o){var l=s.EventID,h=this.GetEventCallback(l);if(!h||!h.Callback)return!1;var u=this.PhoneTouchInfo;if(!u||!u.Start||!u.End)return!1;var f=B(),C=u.End.X/f,D=u.End.Y/f,c=u.End.X-this.UIElement.getBoundingClientRect().left*f,T=u.End.Y-this.UIElement.getBoundingClientRect().top*f,S={X:C,Y:D,FrameID:-1,FunctionName:s.FunctionName,Drag:{Start:{X:u.Start.X/f,Y:u.Start.Y/f},End:{X:u.End.X/f,Y:u.End.Y/f}}},I=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),I=this.Canvas.isPointInPath(c,T),I)if(this.Frame&&this.Frame.IsHScreen){var g={},E=this.Frame.GetYData(c,g);if(v.IsNumber(g.FrameID)&&g.FrameID>=0){var F=this.Frame.GetXData(T);S.FrameID=g.FrameID,S.Data={X:F,Y:E}}}else{var g={},E=this.Frame.GetYData(T,g);if(v.IsNumber(g.FrameID)&&g.FrameID>=0){var F=this.Frame.GetXData(c);S.FrameID=g.FrameID,S.Data={X:F,Y:E}}}return h.Callback(h,S,this),!0},this.MoveCorssCursor=function(s,o){var l=B(),h=s.X-this.UIElement.getBoundingClientRect().left*l,u=s.Y-this.UIElement.getBoundingClientRect().top*l;this.DragMode==Ve.CLICK_TOUCH_MODE_ID&&(this.TouchStatus.CorssCursorShow=!0),this.OnMouseMove(h,u,o,!0)},this.DrawEmpty=function(){this.UIElement.width<=0||this.UIElement.height<=0||(this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.Frame&&(this.Frame.ScreenImageData=null,this.Frame.Draw()))},this.PtInChart=function(s,o){for(var l=null,h=0;h<this.ChartPaint.length;++h){var u=this.ChartPaint[h];if(u.PtInChart&&!u.IsHideScriptIndex()&&(l=u.PtInChart(s,o),l))return l}for(var h=0;h<this.OverlayChartPaint.length;++h){var u=this.OverlayChartPaint[h];if(u.PtInChart&&(l=u.PtInChart(s,o),l))return l}return this.Frame.PtInOveralyChart&&(l=this.Frame.PtInOveralyChart(s,o),l)?l:null},this.DrawSelectedStatus=function(){if(!(!this.SelectedChart.MoveOn.Identify&&!this.SelectedChart.Selected.Identify)){for(var s=0;s<this.ChartPaint.length;++s){var o=this.ChartPaint[s];o.Identify&&(o.Identify!=this.SelectedChart.MoveOn.Identify&&o.Identify!=this.SelectedChart.Selected.Identify||o.DrawSelectedStatus&&o.DrawSelectedStatus())}for(var s=0;s<this.OverlayChartPaint.length;++s){var o=this.OverlayChartPaint[s];o.Identify&&(o.Identify!=this.SelectedChart.MoveOn.Identify&&o.Identify!=this.SelectedChart.Selected.Identify||o.DrawSelectedStatus&&o.DrawSelectedStatus())}for(var s=0;s<this.OverlayChartPaint.length;++s){var o=this.OverlayChartPaint[s];o.Identify&&(o.Identify!=this.SelectedChart.MoveOn.Identify&&o.Identify!=this.SelectedChart.Selected.Identify||o.DrawSelectedStatus&&o.DrawSelectedStatus())}this.Frame.DrawOveralySelectedStatus&&this.Frame.DrawOveralySelectedStatus(this.SelectedChart)}},this.SetCanvas=function(s){if(this.Frame)for(var o=this.Frame.SubFrame,l=0;l<o.length;++l){var h=o[l];h.Frame.Canvas=s;for(var u=0;u<h.OverlayIndex.length;++u){var f=h.OverlayIndex[u];f.Frame.Canvas=s;for(var C=0;C<f.ChartPaint.length;++C){var D=f.ChartPaint[C];D.Canvas=s}}}for(var l=0;l<this.ChartDrawPicture.length;++l){var h=this.ChartDrawPicture[l];h.Canvas=s}for(var l=0;l<this.ChartPaint.length;++l){var h=this.ChartPaint[l];h.Canvas=s}for(var l=0;l<this.ChartPaintEx.length;++l){var h=this.ChartPaintEx[l];h.Canvas=s}for(var l=0;l<this.OverlayChartPaint.length;++l){var h=this.OverlayChartPaint[l];h.Canvas=s}for(var l=0;l<this.ExtendChartPaint.length;++l){var h=this.ExtendChartPaint[l];h.Canvas=s}},this.ClearCanvas=function(s){s&&this.UIElement&&s.clearRect(0,0,this.UIElement.width,this.UIElement.height)},this.Draw=function(){var s=this;if(this.ChartCorssCursor&&(this.ChartCorssCursor.Status=0),!(this.UIElement.width<=0||this.UIElement.height<=0)){this.StopDrawDynamicInfo();var o=this.GetEventCallback($.ON_BEFORE_DRAW);if(o&&o.Callback){var l={};o.Callback(o,l,this)}this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.CacheCanvas&&this.CacheCanvas.clearRect(0,0,this.UIElement.width,this.UIElement.height);var h=B();if(this.Canvas.lineWidth=h,this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash){var u=this.InvokeBeforeDrawSplashScreenCallback();if(u&&u.PreventDefault===!0)return;this.Frame.ClearCoordinateText(),this.Frame.Draw({IsEnableSplash:this.ChartSplashPaint.IsEnableSplash}),this.ChartSplashPaint.Draw();return}if(this.CacheCanvas&&this.SetCanvas(this.CacheCanvas),this.Frame.SetBeforeDrawXYCallback&&this.Frame.SetBeforeDrawXYCallback(function(P){s.BeforeDrawXYCoordinate(P)}),this.Frame.Draw(),this.Frame.DrawCustomVertical){var f=this.GetEventCallback($.ON_CUSTOM_VERTICAL_DRAW);this.Frame.DrawCustomVertical(f)}this.Frame.CalculateLock();for(var C=0;C<this.ChartDrawPicture.length;++C){var D=this.ChartDrawPicture[C];D.IsDrawMain&&D.IsDrawMain()&&D.MainDraw()}for(var C=0;C<this.ChartPaint.length;++C){var D=this.ChartPaint[C];D.IsDrawFirst&&D.Draw()}this.Frame.DrawOveraly&&this.Frame.DrawOveraly(!0);for(var C=0;C<this.ChartPaint.length;++C){var D=this.ChartPaint[C];D.IsDrawFirst||D.Draw()}for(var C=0;C<this.ChartPaintEx.length;++C){var D=this.ChartPaintEx[C];D.Draw()}for(var C=0;C<this.OverlayChartPaint.length;++C){var D=this.OverlayChartPaint[C];D.Draw()}this.Frame.DrawOveraly&&this.Frame.DrawOveraly(!1);for(var C=0;C<this.ExtendChartPaint.length;++C){var D=this.ExtendChartPaint[C];D.IsCallbackDraw||D.DrawAfterPicture||!D.IsDynamic&&D.IsAnimation==!1&&D.Draw()}this.Frame.DrawInsideHorizontal&&this.Frame.DrawInsideHorizontal(),this.KLineIncreaseCustomHorizontal(),this.Frame.DrawCustomHorizontal&&this.Frame.DrawCustomHorizontal(),this.Frame.DrawEx&&this.Frame.DrawEx({Symbol:this.Symbol}),this.ChartInfoPaint&&this.ChartInfoPaint.Draw(),this.Frame.DrawLock(),this.Frame.DrawLogo(),this.CacheCanvas?(this.Canvas.drawImage(this.CacheElement,0,0),this.SetCanvas(this.Canvas)):this.Frame.Snapshot(),this.Frame.DrawToolbar&&this.Frame.DrawToolbar(this.LastMouseStatus),this.DrawSelectedStatus(),this.DrawSelectedBorder(),this.DrawSelectedXBorder&&this.DrawSelectedXBorder();var c=null;this.LastMouseStatus&&this.LastMouseStatus.MoveOnPoint&&(c=this.LastMouseStatus.MoveOnPoint);for(var C=0;C<this.ExtendChartPaint.length;++C){var D=this.ExtendChartPaint[C];D.IsCallbackDraw||D.DrawAfterPicture||D.IsDynamic&&D.DrawAfterTitle===!1&&(D.Draw(),D.DrawToolbar&&D.DrawToolbar(c))}for(var C=0;C<this.ChartDrawPicture.length;++C){var D=this.ChartDrawPicture[C];D.IsDrawFirst&&D.Draw()}this.DrawDrawPictureXYCoordinate();var T=!1,S=null;if(this.LastPoint.X!=null||this.LastPoint.Y!=null){if(this.ChartCorssCursor){this.ChartCorssCursor.LastPoint=this.LastPoint,this.ChartCorssCursor.CursorIndex=this.CursorIndex,this.EnableNewIndex&&(this.ChartCorssCursor.CorssCursorIndex=this.CorssCursorIndex,this.ChartCorssCursor.EnableNewIndex=this.EnableNewIndex);var I=!1;this.CorssCursorCanvas&&(this.ChartCorssCursor.Canvas=this.CorssCursorCanvas,this.ChartCorssCursor.Canvas.clearRect(0,0,this.CorssCursorElement.width,this.CorssCursorElement.height),I=!0);var g=this.PtInButton(this.LastPoint.X,this.LastPoint.Y);g||(this.DragMode==Ve.CLICK_TOUCH_MODE_ID?this.TouchStatus.CorssCursorShow==!0&&this.ChartCorssCursor.Draw():this.EnableClickModel?this.ClickModel.IsShowCorssCursor===!0&&this.ChartCorssCursor.Draw():!(this.CorssCursorTouchEnd===!0&&this.MouseDrag)&&!(this.CorssCursorTouchEnd==!0&&this.IsOnTouch==!1)&&this.ChartCorssCursor.Draw()),I&&(this.ChartCorssCursor.Canvas=this.Canvas),T=!0}S=this.Frame.PtInFrame(this.LastPoint.X,this.LastPoint.Y)}var E=this.GetDrawStatus();E.DrawName="Draw";for(var F=this.GetEventCallback($.ON_TITLE_DRAW),R=this.GetEventCallback($.ON_INDEXTITLE_DRAW),C=0;C<this.TitlePaint.length;++C){var D=this.TitlePaint[C];D.IsDynamic&&(D.CursorIndex=this.CursorIndex,D.LastPoint=this.LastPoint,D.ClassName=="DynamicChartTitlePainting"?D.OnDrawEvent=R:D.OnDrawEvent=F,D.OnDrawEvent&&(D.OnDrawEvent.FunctionName="Draw",D.OnDrawEvent.PointPosition=S),D.DrawStatus=E,D.Draw(c,this.LastMouseStatus))}for(var C=0;C<this.ExtendChartPaint.length;++C){var D=this.ExtendChartPaint[C];D.IsCallbackDraw||D.DrawAfterPicture||D.IsDynamic&&D.DrawAfterTitle===!0&&D.IsAnimation==!1&&D.Draw()}if(this.EnableAnimation)for(var C=0;C<this.ExtendChartPaint.length;++C){var D=this.ExtendChartPaint[C];D.IsAnimation===!0&&D.Draw()}for(var C=0;C<this.ChartDrawPicture.length;++C){var D=this.ChartDrawPicture[C];D.IsDrawFirst||D.IsDrawMain&&D.IsDrawMain()||this.SelectChartDrawPicture&&this.SelectChartDrawPicture.Guid==D.Guid||D.Draw()}this.SelectChartDrawPicture&&this.SelectChartDrawPicture.Draw(),this.CurrentChartDrawPicture&&this.CurrentChartDrawPicture.Status!=10&&this.CurrentChartDrawPicture.Draw();for(var C=0;C<this.ExtendChartPaint.length;++C){var D=this.ExtendChartPaint[C];D.DrawAfterPicture&&D.Draw()}if(this.OffscreenToShowCanvas(),typeof this.UpdateScrollBar=="function"&&this.UpdateScrollBar(),this.LastMouseStatus.MouseOnToolbar){var A=this.LastMouseStatus.MouseOnToolbar.Frame;A&&A.DrawToolbarTooltip&&A.DrawToolbarTooltip(this.LastMouseStatus.MouseOnToolbar)}if(T&&this.DrawTooltipDialog(),this.mapEvent.has($.CHART_STATUS)){var o=this.mapEvent.get($.CHART_STATUS),u={};typeof this.GetChartStatus=="function"&&(u=this.GetChartStatus()),o.Callback(o,u,this)}++this.TouchDrawCount}},this.PtInButton=function(s,o){var l=this.Frame.PtInButtons(s,o);return l?{Name:"FrameButton",Button:l}:(l=this.PtInExtendChartButtons(s,o),l?{Name:"ExtendChartButton",Button:l}:(l=this.PtInDrawPictureButtons(s,o),l?{Name:"DrawPictureButton",Button:l}:(l=this.PtInTitleButtons(s,o),l?{Name:"TitleButton",Button:l}:null)))},this.DrawDrawPictureXYCoordinate=function(){var s=null;this.CurrentChartDrawPicture?s=this.CurrentChartDrawPicture:this.SelectChartDrawPicture&&(s=this.SelectChartDrawPicture);for(var o={Symbol:this.Symbol,Period:this.Period},l=0;l<this.ChartDrawPicture.length;++l){var h=this.ChartDrawPicture[l];h&&(this.IsDrawPictureXY&&s&&(s==h||s.Guid==h.Guid)&&this.Frame.DrawPictureCoordinate(s,o)||h.IsShowYCoordinate&&h.Frame&&h.Frame.DrawPicturePointYCoordinate(h,o))}},this.BeforeDrawXYCoordinate=function(s){for(var o=0;o<this.ExtendChartPaint.length;++o){var l=this.ExtendChartPaint[o];l.IsCallbackDraw&&(["KLineYAxisBGPaint","DepthMapPaint","BackgroundPaint","MinuteBackgroundPaint","SessionBreaksPaint"].includes(l.ClassName)?l.FrameID==s.Identify&&l.Draw():Br.IsCallbackDraw(l.ClassName)&&l.FrameID==s.Identify&&l.Draw())}},this.DrawSelectedBorder=function(){if(this.GlobalOption.SelectedBorder){var s=this.GlobalOption.SelectedBorder;if(v.IsPlusNumber(s.Mode)&&!(!v.IsNumber(s.SelFrame)&&s.SelFrame<0)){var o=this.Frame.SubFrame[s.SelFrame];o&&o.Frame.DrawSelectedBorder&&o.Frame.DrawSelectedBorder(s)}}},this.KLineIncreaseCustomHorizontal=function(){if(!(!this.Frame||!this.Frame.SubFrame)){var s=this.Frame.SubFrame[0].Frame;if(s){var o=jt(this.Symbol),l=!1;s.YSplitOperator&&s.YSplitOperator.CoordinateType==1&&(l=!0);for(var h=!1,u=0;u<s.CustomHorizontalInfo.length;++u){var f=s.CustomHorizontalInfo[u];if(f.Type==4&&(h=!0),l&&f.Type==3||f.Type==2){var C=this.ChartPaint[0];if(!C)continue;var D=C.Data;if(!D||!v.IsNonEmptyArray(D.Data)||!v.IsNumber(C.DrawKRange.Start)||!v.IsNumber(C.DrawKRange.End))continue;var c=D.Data[C.DrawKRange.Start],T=D.Data[C.DrawKRange.End],S=(T.Close-c.Close)/c.Close*100;f.Value=T.Close,f.Type==2?(f.Message[1]=T.Close.toFixed(o),T.Close>T.Open?f.LineColor=d.FrameLatestPrice.UpBarColor:T.Close<T.Open?f.LineColor=d.FrameLatestPrice.DownBarColor:f.LineColor=d.FrameLatestPrice.UnchagneBarColor):f.Message[1]=S.toFixed(2)+"%",this.Name&&(f.Title=this.Name)}}if(h){var I=s.CustomHorizontalInfo.filter(function(F,R,A){return F.Type!=4});s.CustomHorizontalInfo=I}for(var u=0;u<this.OverlayChartPaint.length;++u){var C=this.OverlayChartPaint[u];if(C&&C.YInfoType==4){var D=C.Data;if(!(!D||!v.IsNonEmptyArray(D.Data))&&!(!v.IsNumber(C.DrawKRange.Start)||!v.IsNumber(C.DrawKRange.End))){for(var c=null,g=C.DrawKRange.Start;g<=C.DrawKRange.End;++g){var E=D.Data[g];if(v.IsNumber(E.Close)){c=E;break}}if(c){var T=D.Data[C.DrawKRange.End],S=(T.Close-c.Close)/c.Close*100,f=new Ut;f.Value=T.Close/C.ShowRange.FirstOverlayOpen*C.ShowRange.FirstOpen,f.Message[1]=S.toFixed(2)+"%",f.LineType=-1,f.Type=C.YInfoType,f.LineColor=C.Color,f.TextColor=d.FrameLatestPrice.OverlayTextColor,C.Title&&(f.Title=C.Title),s.CustomHorizontalInfo.push(f)}}}}}}},this.OffscreenToShowCanvas=function(){this.ShowCanvas&&(this.ShowCanvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.ShowCanvas.drawImage(this.OffscreenCanvasElement,0,0))},this.GetDrawStatus=function(){var s={Point:{X:this.LastPoint.X,Y:this.LastPoint.Y},IsOnTouch:this.IsOnTouch,CorssCursorTouchEnd:this.CorssCursorTouchEnd,IsTitleShowLatestData:this.IsTitleShowLatestData,IsMinuteChart:this.ClassName=="MinuteChartContainer"||this.ClassName=="MinuteChartHScreenContainer"};return s.FrameID=this.Frame.PtInFrame(this.LastPoint.X,this.LastPoint.Y),s},this.InvokeBeforeDrawSplashScreenCallback=function(){var s=this.GetEventCallback($.ON_BEFORE_DRAW_SPLASH_SCREEN);if(!s||!s.Callback)return null;var o={PreventDefault:!1};return s.Callback(s,o,this),o},this.DrawSplashScreen=function(s){var o=this.InvokeBeforeDrawSplashScreenCallback();if(!(o&&o.PreventDefault===!0)&&!(this.Frame.ScreenImageData==null&&!this.CacheCanvas)){this.Frame.ScreenImageData?this.Canvas.putImageData(this.Frame.ScreenImageData,0,0):this.CacheCanvas&&(this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.Canvas.drawImage(this.CacheElement,0,0));var l=d.SplashScreen.BGColor;if(this.Canvas.fillStyle=l,this.Canvas.fillRect(0,0,this.UIElement.width,this.UIElement.height),this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash){var h=d.SplashScreen.Title;s&&s.Title&&(h=s.Title),this.ChartSplashPaint.SetTitle(h),this.ChartSplashPaint.Draw()}}},this.DrawDynamicInfo=function(s){this.LastMouseStatus.MouseOnToolbar=null;var o=this.GetEventCallback($.ON_BEFORE_DRAW_DYNAMIC_INFO);if(o&&o.Callback){var l={};o.Callback(o,l,this)}if(!(this.Frame.ScreenImageData==null&&!this.CacheCanvas)){var h=!1;if(this.ChartCorssCursor&&(this.ChartCorssCursor.PointX!=null||this.ChartCorssCursor.PointY!=null)&&(h=!0),h=!0,h==!1)for(var u=0;u<this.ExtendChartPaint.length;++u){var f=this.ExtendChartPaint[u];if(!f.IsCallbackDraw&&f.IsDynamic&&f.IsEraseBG){h=!0;break}}h&&(this.Frame.ScreenImageData?this.Canvas.putImageData(this.Frame.ScreenImageData,0,0):this.CacheCanvas&&(this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.Canvas.drawImage(this.CacheElement,0,0))),this.Frame.DrawToolbar&&this.Frame.DrawToolbar(this.LastMouseStatus),this.DrawSelectedStatus(),this.DrawSelectedBorder(),this.DrawSelectedXBorder&&this.DrawSelectedXBorder();var C=null;this.LastMouseStatus&&this.LastMouseStatus.MoveOnPoint&&(C=this.LastMouseStatus.MoveOnPoint);for(var u=0;u<this.ExtendChartPaint.length;++u){var f=this.ExtendChartPaint[u];f.IsCallbackDraw||f.DrawAfterPicture||f.IsDynamic&&f.DrawAfterTitle===!1&&f.IsAnimation==!1&&(f.Draw(),f.DrawToolbar&&f.DrawToolbar(C,this.LastMouseStatus))}for(var u=0;u<this.ChartDrawPicture.length;++u){var f=this.ChartDrawPicture[u];f.IsDrawFirst&&f.Draw()}this.DrawDrawPictureXYCoordinate();var D=!1;if(this.ChartCorssCursor){this.ChartCorssCursor.LastPoint=this.LastPoint,this.ChartCorssCursor.CursorIndex=this.CursorIndex,this.EnableNewIndex&&(this.ChartCorssCursor.CorssCursorIndex=this.CorssCursorIndex,this.ChartCorssCursor.EnableNewIndex=this.EnableNewIndex);var c=!1;this.CorssCursorCanvas&&(this.ChartCorssCursor.Canvas=this.CorssCursorCanvas,this.ChartCorssCursor.Canvas.clearRect(0,0,this.CorssCursorElement.width,this.CorssCursorElement.height),c=!0),s&&s.Corss==!1||(this.DragMode==Ve.CLICK_TOUCH_MODE_ID?this.TouchStatus.CorssCursorShow==!0&&this.ChartCorssCursor.Draw():this.IsOnTouch===!1&&this.CurrentChartDrawPicture&&this.CurrentChartDrawPicture.IsShowCorssCursor===!0?this.ChartCorssCursor.Draw():!(this.IsOnTouch===!1&&this.CorssCursorTouchEnd===!0)&&!this.CurrentChartDrawPicture?this.ChartCorssCursor.Draw():this.IsOnTouch===!0&&this.CurrentChartDrawPicture&&this.EnableShowCorssCursor&&this.EnableShowCorssCursor.DrawPicture==!0&&this.ChartCorssCursor.Draw()),c&&(this.ChartCorssCursor.Canvas=this.Canvas),D=!0}var T=null;s&&s.Point&&(s.ParentFunction=="OnMouseMove"||s.ParentFunction=="MoveCorssCursorIndex")&&(T=this.Frame.PtInFrame(s.Point.X,s.Point.Y));var S=this.GetDrawStatus();S.DrawName="DrawDynamicInfo";for(var u=0;u<this.TitlePaint.length;++u){var f=this.TitlePaint[u];if(f.IsDynamic){f.CursorIndex=this.CursorIndex,f.LastPoint=this.LastPoint,f.OnDrawEvent&&(f.OnDrawEvent.FunctionName="DrawDynamicInfo",f.OnDrawEvent.PointPosition=T),f.DrawStatus=S;var I=null;s&&v.IsNumber(s.ClientPos)&&s.Point&&(I={ClientPos:s.ClientPos,Point:{X:s.Point.X,Y:s.Point.Y}}),f.PointInfo=I,f.Draw(C,this.LastMouseStatus)}}for(var u=0;u<this.ExtendChartPaint.length;++u){var f=this.ExtendChartPaint[u];if(!f.IsCallbackDraw&&!f.DrawAfterPicture){if(f.ClassName=="KLineTooltipPaint"&&s){if(s.Tooltip==!1)continue;s.Point&&(f.LatestPoint=s.Point)}else f.ClassName=="MinuteTooltipPaint"&&s&&s.Point&&(f.LatestPoint=s.Point);f.IsDynamic&&f.DrawAfterTitle===!0&&f.Draw(C,this.LastMouseStatus)}}if(this.EnableAnimation)for(var u=0;u<this.ExtendChartPaint.length;++u){var f=this.ExtendChartPaint[u];f.IsAnimation===!0&&f.Draw()}for(var u=0;u<this.ChartDrawPicture.length;++u){var f=this.ChartDrawPicture[u];f.IsDrawFirst||f.IsDrawMain&&f.IsDrawMain()||this.SelectChartDrawPicture&&f.Guid==this.SelectChartDrawPicture.Guid||f.Draw(C,this.LastMouseStatus)}this.SelectChartDrawPicture&&this.SelectChartDrawPicture.Draw(C,this.LastMouseStatus),this.CurrentChartDrawPicture&&this.CurrentChartDrawPicture.Status!=10&&this.CurrentChartDrawPicture.Draw();for(var u=0;u<this.ExtendChartPaint.length;++u){var f=this.ExtendChartPaint[u];f.DrawAfterPicture&&f.Draw()}if(this.LastMouseStatus.MouseOnToolbar){var g=this.LastMouseStatus.MouseOnToolbar.Frame;g&&g.DrawToolbarTooltip&&g.DrawToolbarTooltip(this.LastMouseStatus.MouseOnToolbar)}this.OffscreenToShowCanvas(),D&&this.DrawTooltipDialog(),++this.TouchDrawCount}},this.DrawAnimation=function(){if(this.EnableAnimation){if(this.Frame.ScreenImageData&&!this.IsOnTouch){for(var s=0;s<this.ExtendChartPaint.length;++s){var o=this.ExtendChartPaint[s];o.IsAnimation===!0&&(o.IsMoveStep=!0)}this.DrawDynamicInfo()}var l=this;window.requestAnimationFrame(function(){l.DrawAnimation()})}},this.StartAnimation=function(s){for(var o=!1,l=null,h=0;h<this.ExtendChartPaint.length;++h){var u=this.ExtendChartPaint[h];if(u.ClassName==="BarragePaint"){o=!0,l=u.BarrageList;break}}if(!o){var f=new fI;f.Canvas=this.Canvas,f.ChartBorder=this.Frame.ChartBorder,f.ChartFrame=this.Frame,f.HQChart=this,f.SetOption(s),this.ExtendChartPaint.push(f),l=f.BarrageList}this.EnableAnimation=!0;var C=this;return window.requestAnimationFrame(function(){C.DrawAnimation()}),l},this.StopAnimation=function(){this.EnableAnimation=!1,this.DrawDynamicInfo()},this.GetChartTooltipData=function(s,o,l){var h=new ns;if(this.ChartInfoPaint&&this.ChartInfoPaint.GetTooltipData(s,o,h)||this.PtInChartPaintTooltip(s,o,h))return h;if(v.IsNonEmptyArray(this.Frame.SubFrame))for(var u=0;u<this.Frame.SubFrame.length;++u)for(var f=this.Frame.SubFrame[u],C=0;C<f.OverlayIndex.length;++C)for(var D=f.OverlayIndex[C],c=0;c<D.ChartPaint.length;++c){var T=D.ChartPaint[c];if(T.GetTooltipData(s,o,h))return h}return this.PtInOverlayChartPaintTooltip(s,o,h)||this.PtInExtendChartPaintTooltip(s,o,h)?h:null},this.PtInExtendChartButtons=function(s,o){for(var l=0;l<this.ExtendChartPaint.length;++l){var h=this.ExtendChartPaint[l];if(h.PtInButtons){var u=h.PtInButtons(s,o);if(u)return u.Chart=h,u}}return null},this.ClickExtendChartButton=function(s,o){var l=this.GetEventCallback($.ON_CLICK_EXTENDCHART_BUTTON);if(l&&l.Callback){var h={Info:s,PreventDefault:!1};if(l.Callback(l,h,this),h.PreventDefault)return}},this.PtInDrawPictureButtons=function(s,o){for(var l=0;l<this.ChartDrawPicture.length;++l){var h=this.ChartDrawPicture[l];if(h.PtInButtons){var u=h.PtInButtons(s,o);if(u)return u.Chart=h,u}}return null},this.ClickDrawPictureButton=function(s,o){var l=this.GetEventCallback($.ON_CLICK_DRAWPICTURE_BUTTON);if(l&&l.Callback){var h={Info:s,PreventDefault:!1};if(l.Callback(l,h,this),h.PreventDefault)return}s.ID==Rt.DRAW_PICTURE_DELETE?(k.Chart.Log(s,"ClickDrawPictureButton"),this.ClearChartDrawPicture(s.Chart)):s.ID==Rt.DRAW_PICTURE_SETTING},this.PtInTitleButtons=function(s,o){for(var l=0;l<this.TitlePaint.length;++l){var h=this.TitlePaint[l];if(h.PtInButtons){var u=h.PtInButtons(s,o);if(u)return u.Chart=h,u}}return null},this.OnMouseMove=function(s,o,l,h){var u=this;this.StopDrawDynamicInfo(),this.LastPoint.X=s,this.LastPoint.Y=o;var f=null,C=null,D=this.Frame.PtInFrame(s,o);if(v.IsNumber(D)&&D>=0&&(this.CursorIndex=this.Frame.GetXData(s)),this.EnableBorderDrag&&this.Frame&&!this.CurrentChartDrawPicture){var c=this.Frame.PtInFrameBorder(s,o);c&&c.Index>=0&&(f={Cursor:"n-resize",Name:"DragBorder"},k.Chart.Log("[JSChartContainer::OnMouseMove] drag border ",c))}if(this.EnableYDrag&&this.Frame&&!this.CurrentChartDrawPicture){var T=this.TryYDrag(s,o);T&&(f={Cursor:T.Position==0?"n-resize":"row-resize",Name:"DragY"},k.Chart.Log("[JSChartContainer::OnMouseMove] drag y ",T))}if(this.CurrentChartDrawPicture||(C=this.PtInButton(s,o),C&&(f={Cursor:"pointer",Name:C.Name},k.Chart.Log("[JSChartContainer::OnMouseMove] frame button ",C))),this.ChartCorssCursor){var S=this.ChartCorssCursor.PtInButton(s,o);S&&(f={Cursor:"pointer",Name:"CorssCursorButton"},k.Chart.Log("[JSChartContainer::OnMouseMove] cross cursor button ",S))}if(this.ClassName=="KLineChartContainer"&&this.Frame.PtInFrameBottom(s,o)&&(f={Cursor:"ew-resize",Name:"FrameButtom"},k.Chart.Log("[JSChartContainer::OnMouseMove] frame bottom ")),this.Frame.PtInHorizontalLabel&&this.Frame.PtInHorizontalLabel(s,o)&&(f={Cursor:"pointer",Name:"HorizontalLabel"},k.Chart.Log("[JSChartContainer::OnMouseMove] frame Horizontal Label ")),this.SelectedChart.EnableMoveOn&&this.PtInChart&&!this.CurrentChartDrawPicture){var I=this.PtInChart(s,o);I&&I.Identify?(f={Cursor:"pointer",Name:"PtInChart"},this.SelectedChart.MoveOn.Identify=I.Identify,this.SelectedChart.MoveOn.Identify=null,k.Chart.Log("[JSChartContainer::OnMouseMove] Point in chart ",I)):this.SelectedChart.MoveOn.Identify=null}else this.SelectedChart.MoveOn.Identify=null;var g=this.GetRectSelectPaint();if(g&&g.GetPointCount()>0){var E=g.PtInPaint(s,o);E&&(E.Type==4?f={Cursor:"pointer",Name:"DragRectSelect"}:f={Cursor:"ew-resize",Name:"DragRectSelect"},k.Chart.Log("[JSChartContainer::OnMouseMove] drag rect select ",E))}var F={MouseStatus:null,X:s,Y:o,FrameID:D,e:l};this.TryMouseMove_CustomChartDrag(F)&&F.MouseStatus&&(f=F.MouseStatus);var R=!1;if(this.CurrentChartDrawPicture){var A=this.Frame.PtInChartFrame(s,o);if(this.CurrentChartDrawPicture.Status!=20){var P=!1;v.IsNumber(this.CurrentChartDrawPicture.LimitFrameID)?A>=0&&A==this.CurrentChartDrawPicture.LimitFrameID&&(P=!0):A>=0&&(P=!0),f={Cursor:P?"crosshair":"not-allowed",Name:"CurrentChartDrawPicture"}}this.CurrentChartDrawPicture.SetLastPoint&&this.CurrentChartDrawPicture.SetLastPoint({X:s,Y:o}),R=!0}else{var p={};p.X=s,p.Y=o,this.GetChartDrawPictureByPoint(p)&&p.ChartDrawPicture?(this.EnableEraseChartDrawPicture?this.SetCursor({Cursor:"grabbing"}):p.ChartDrawPicture.EnableMove==!0&&(p.PointIndex===100?p.Cursor?this.SetCursor(p):this.SetCursor({Cursor:"move"}):p.Cursor?this.SetCursor(p):this.SetCursor({Cursor:"pointer"}),R=!0),this.MoveOnChartDrawPicture=p.ChartDrawPicture):this.MouseDrag||this.SetCursor({Cursor:"default"})}var w=this.PtInClient(s,o),H={ParentFunction:"OnMouseMove",Point:{X:s,Y:o},IsPhone:h===!0,ClientPos:w};if((l&&(l.type=="mouseout"||l.type=="mouseleave")||C)&&(H.Corss=!1),this.SetCorssCursorIndex&&this.SetCorssCursorIndex(H),this.DrawDynamicInfoOption.Enable?this.DrawDynamicInfoOption.Timer=setTimeout(function(){u.DrawDynamicInfo(H)},this.DrawDynamicInfoOption.DelayTime):this.DrawDynamicInfo(H),this.SetCursor(f),this.IsShowTooltip&&R==!1){var W=this.GetChartTooltipData(s,o);if(W&&W.Data){if(h===!0)var ht=l.touches[0],rt=ht.clientX-this.UIElement.getBoundingClientRect().left,nt=ht.clientY-this.UIElement.getBoundingClientRect().top;else var rt=l.clientX-this.UIElement.getBoundingClientRect().left,nt=l.clientY-this.UIElement.getBoundingClientRect().top;this.ShowTooltip(rt,nt,W)}else this.HideTooltip()}},this.SetCursor=function(s){!s||!s.Cursor||(s.Cursor=="default"?this.UIElement.style.cursor=this.DefaultCursor:this.UIElement.style.cursor=s.Cursor)},this.OnKeyDown=function(s){var o=this;if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var l=this.GetEventCallback($.ON_KEYDOWN);if(l&&l.Callback){var h={e:s,PreventDefault:!1};if(l.Callback(l,h,this),h.PreventDefault)return}var u=s.keyCode?s.keyCode:s.which,f=!1;if(this.ChartCorssCursor&&this.ChartCorssCursor.OnKeyDown){var h={e:s,KeyID:u,Draw:!1,PreventDefault:!1};this.ChartCorssCursor.OnKeyDown(h),f=h.Draw}switch(u){case 37:if(s.ctrlKey&&this.OnCustomKeyDown&&this.OnCustomKeyDown(u,s))break;if(this.CursorIndex<=.99999){if(!this.DataMoveLeft()){this.DragDownloadData&&this.DragDownloadData();break}this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXSplit(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("keydown")}else--this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo(),this.ShowTooltipByKeyDown();break;case 39:if(s.ctrlKey&&this.OnCustomKeyDown&&this.OnCustomKeyDown(u,s))break;var C=0;if(this.Frame.XPointCount?C=this.Frame.XPointCount:C=this.Frame.SubFrame[0].Frame.XPointCount,this.CursorIndex+1>=C){if(!this.DataMoveRight())break;this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXSplit(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("keydown")}else{var D=null;if(this.Frame.Data?D=this.Frame.Data:D=this.Frame.SubFrame[0].Frame.Data,!D||this.CursorIndex+D.DataOffset+1>=D.Data.length)break;++this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo(),this.ShowTooltipByKeyDown()}break;case 38:if(this.EnableZoomUpDown&&this.EnableZoomUpDown.Keyboard===!1)break;var c={ZoomType:this.ZoomType,IsLockRight:this.IsZoomLockRight};if(c.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomUp(c))break;this.CursorIndex=c.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.ResetFrameXSplit(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("keydown");break;case 40:if(this.EnableZoomUpDown&&this.EnableZoomUpDown.Keyboard===!1)break;var c={ZoomType:this.ZoomType,IsLockRight:this.IsZoomLockRight};if(c.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomDown(c,{ZoomDownloadDataCallback:function(g){o.ZoomDownloadData(g)}}))break;this.CursorIndex=c.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXSplit(),this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0||this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("keydown");break;case 46:if(this.SelectChartDrawPicture){var T=this.SelectChartDrawPicture;k.Chart.Log("[JSChartContainer::OnKeyDown] delete draw picture."),this.SelectChartDrawPicture=null,this.ChartPictureMenu&&this.ChartPictureMenu.Hide(),this.ClearChartDrawPicture(T),this.CloseModifyDrawDialog()}else if(this.SelectedChart&&this.SelectedChart.Selected.Identify){var S=this.GetSelectedChartInfo(this.SelectedChart.Selected);S&&(S.Type==Ye.OVERLAY_INDEX?this.DeleteOverlayWindowsIndex(S.IndexID):S.Type==Ye.OVERLAY_KLINE&&this.DeleteOverlaySymbol(S.Symbol))}break;case 32:this.OnMarkRectSelect(s);break;case 27:if(this.CurrentChartDrawPicture){var T=this.CurrentChartDrawPicture;T.Status!=20&&(this.CurrentChartDrawPicture=null)}break;default:return}f&&this.DrawDynamicInfo(),s.preventDefault?s.preventDefault():s.returnValue=!1}},this.OnDoubleClick=function(s,o,l){},this.ZoomIndexWindow=function(s,o){return s<0||s>=this.Frame.SubFrame.length?!1:this.Frame.ZoomIndexWindow(s,o)},this.ShowIndexTitleOnly=function(s,o){return s<0||s>=this.Frame.SubFrame.length?!1:this.Frame.ShowIndexTitleOnly(s,o)},this.RemoveMinSizeWindows=function(){if(this.Frame.ZoomWindowsInfo){for(var s=[],o=[],l=0;l<this.Frame.SubFrame.length;++l){var h=this.Frame.SubFrame[l];h.Frame.ClearToolbar(),h.Frame.IsMinSize?s.push(l):o.push(l)}if(this.Frame.ZoomWindowsInfo=null,!(s.length<=0)){for(var l=0;l<s.length;++l)this.DeleteIndexPaint(s[l]);for(var u=[],f=[],C=[this.TitlePaint[0]],l=0;l<o.length;++l){var D=o[l];u[l]=this.Frame.SubFrame[D],f[l]=this.WindowIndex[D],C[l+1]=this.TitlePaint[D+1]}this.Frame.SubFrame=u,this.WindowIndex=f,this.TitlePaint=C;for(var l=0;l<this.Frame.SubFrame.length;++l){var h=this.Frame.SubFrame[l].Frame;l==this.Frame.SubFrame.length-1?h.XSplitOperator.ShowText=!0:h.XSplitOperator.ShowText=!1,h.Identify=l}if(v.IsNonEmptyArray(this.ChartDrawPicture)){for(var c=[],l=0;l<this.ChartDrawPicture.length;++l)for(var h=this.ChartDrawPicture[l],T=0;T<this.Frame.SubFrame.length;++T)if(h.Frame==this.Frame.SubFrame[T].Frame){c.push(h);break}this.ChartDrawPicture=c}}}},this.PtInClient=function(s,o){if(this.Canvas.beginPath(),this.Frame.IsHScreen===!0){var l=this.Frame.ChartBorder.GetHScreenBorder();if(l.DayBorder){for(var h=l.Right-l.Left,u=0;u<l.DayBorder.length;++u){var f=l.DayBorder[u];if(this.Canvas.beginPath(),this.Canvas.rect(l.Left,f.TopEx,h,f.BottomEx-f.TopEx),this.Canvas.isPointInPath(s,o))return 1;if(this.Canvas.beginPath(),this.Canvas.rect(l.Left,f.Top,h,f.TopEx-f.Top),this.Canvas.isPointInPath(s,o))return 200+parseInt(u);if(this.Canvas.beginPath(),this.Canvas.rect(l.Left,f.BottomEx,h,f.Bottom-f.BottomEx),this.Canvas.isPointInPath(s,o))return 300+parseInt(u)}return-1}this.Canvas.rect(l.Left,l.TopEx,l.Right-l.Left,l.BottomEx-l.TopEx)}else{var l=this.Frame.ChartBorder.GetBorder();if(l.DayBorder){for(var u=0;u<l.DayBorder.length;++u){var f=l.DayBorder[u];if(this.Canvas.beginPath(),this.Canvas.rect(f.Left,l.TopEx,f.LeftEx-f.Left,l.BottomEx-l.TopEx),this.Canvas.isPointInPath(s,o))return 200+parseInt(u);if(this.Canvas.beginPath(),this.Canvas.rect(f.LeftEx,l.TopEx,f.RightEx-f.LeftEx,l.BottomEx-l.TopEx),this.Canvas.isPointInPath(s,o))return 1;if(this.Canvas.beginPath(),this.Canvas.rect(f.RightEx,l.TopEx,f.Right-f.RightEx,l.BottomEx-l.TopEx),this.Canvas.isPointInPath(s,o))return 300+parseInt(u)}return-1}this.Canvas.rect(l.LeftEx,l.Top,l.RightEx-l.LeftEx,l.Bottom-l.Top)}return this.Canvas.isPointInPath(s,o)?1:this.Frame.ChartBorder.LeftExtendWidth>10&&(this.Canvas.beginPath(),this.Frame.IsHScreen===!0?this.Canvas.rect(l.Left,l.Top,l.Right-l.Left,l.TopEx-l.Top):this.Canvas.rect(l.Left,l.Top,l.LeftEx-l.Left,l.Bottom-l.Top),this.Canvas.isPointInPath(s,o))?2:this.Frame.ChartBorder.RightExtendWidth>10&&(this.Canvas.beginPath(),this.Frame.IsHScreen===!0?this.Canvas.rect(l.Left,l.BottomEx,l.Right-l.Left,l.Bottom-l.BottomEx):this.Canvas.rect(l.RightEx,l.Top,l.Right-l.RightEx,l.Bottom-l.Top),this.Canvas.isPointInPath(s,o))?3:-1},this.OnMoveFromeBorder=function(s,o){this.Frame&&this.Frame.OnMoveFromeBorder(s,o)&&(this.Frame.SetFrameBorderSizeChange(),this.Frame.ReDrawToolbar(),this.Draw())},this.OnZoomUpDownFrameY=function(s,o){this.Frame&&this.Frame.OnZoomUpDownFrameY(s,o)&&(this.Frame.SetSizeChage(!0),this.Draw())},this.OnUpDonwFrameY=function(s,o){return!this.Frame||!this.Frame.OnUpDonwFrameY(s,o)?!1:(this.Frame.SetSizeChage(!0),!0)},this.CancelZoomUpDownFrameY=function(s){this.Frame&&this.Frame.CancelZoomUpDownFrameY(s)&&(this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw())},this.IsKLineContainer=function(){return this.ClassName=="KLineChartContainer"||this.ClassName=="KLineChartHScreenContainer"||this.ClassName=="KLineTrainChartContainer"||this.ClassName=="CustomKLineChartContainer"},this.IsMinuteContainer=function(){return this.ClassName=="MinuteChartContainer"||this.ClassName=="MinuteChartHScreenContainer"},this.UpdatePointByCursorIndex=function(s){var o={X:null,Y:null};o.X=this.Frame.GetXFromIndex(this.CursorIndex);var l=Math.abs(this.CursorIndex-.5);this.IsKLineContainer()&&(l=this.CursorIndex);var h=this.Frame.Data;if(h.DataOffset+l<h.Data.length){var u=h.Data[h.DataOffset+l].Close;o.Y=this.Frame.GetYFromData(u)}if(s==1&&this.ChartCorssCursor){if(this.ChartCorssCursor.Status!=1){this.LastPoint.X=this.Frame.GetXFromIndex(this.CursorIndex);var l=Math.abs(this.CursorIndex-.5);l=parseInt(l.toFixed(0)),this.IsKLineContainer()&&(l=this.CursorIndex),this.LastPoint.Y=null}}else s==2&&this.ChartCorssCursor?(this.LastPoint.Y=null,this.LastPoint.X=null):(this.LastPoint.X=o.X,this.LastPoint.Y=o.Y)},this.ShowTooltipByKeyDown=function(){if(!(!this.KLineTooltipConfig.Enable||!this.KLineTooltipConfig.EnableKeyDown)){var s=Math.abs(this.CursorIndex-.5);s=parseInt(s.toFixed(0)),(this.ClassName=="KLineChartContainer"||this.ClassName=="KLineTrainChartContainer")&&(s=this.CursorIndex);var o=this.Frame.Data,l=new ns;l.Data=o.Data[o.DataOffset+s],l.ChartPaint=this.ChartPaint[0];var h=B();h===0&&(h=1),this.ShowTooltip(this.LastPoint.X/h,this.LastPoint.Y/h,l)}},this.DrawTooltipDialog=function(){},this.DrawFloatTooltip=function(s,o){this.FloatTooltip&&this.UpdateFloatTooltip(s,o)},this.UpdateFloatTooltip=function(s,o){if(this.FloatTooltip){var l={Tooltip:o,Point:s,Symbol:this.Symbol,Name:this.Name,DataType:1};this.FloatTooltip.Update(l)}},this.UpdateHQFloatTooltip=function(s){},this.ShowTooltip=function(s,o,l){var h=this;if(this.IsShowTooltip){var u=B(),f=15/u;this.TooltipCache.Type=l.Type,this.TooltipCache.Data=null,this.TooltipCache.X=s,this.TooltipCache.Y=o;var C=!0;if(l.Type===0){if(!this.KLineTooltipConfig.Enable)return;if(this.FloatTooltip){this.DrawFloatTooltip({X:s,Y:o,YMove:20/u},l),C=!1;return}Da();var D=s,c=o,T=Je.Create("HistoryDataStringFormat");if(T.Value=l,T.Symbol=this.Symbol,T.LanguageID=this.LanguageID,T.GetEventCallback=function(g){return h.GetEventCallback(g)},!T.Operator())return;var S=T.LineCount*25;T.Height>0&&(S=T.Height);var I=T.Width;this.Tooltip.style.width=I+"px",this.Tooltip.style.height=S+"px",this.Tooltip.style.position="absolute",D+I>this.UIElement.getBoundingClientRect().width?this.Tooltip.style.left=D-I+"px":this.Tooltip.style.left=D+"px",c+f+S>this.UIElement.getBoundingClientRect().height-5?this.Tooltip.style.top=c-S+"px":this.Tooltip.style.top=c+f+"px",this.Tooltip.className="jschart-tooltip",this.Tooltip.innerHTML=T.Text,this.Tooltip.style.display="block",this.TooltipCache.IsShow=!0,this.TooltipCache.Data={Date:l.Data.Date,Time:l.Data.Time},this.TooltipCache.InnerHTML=T.Text}else if(l.Type===1){if(this.FloatTooltip){this.DrawFloatTooltip({X:s,Y:o,YMove:20/u},l),C=!1;return}Da();var D=s,c=o,T=Je.Create("KLineInfoDataStringFormat");if(T.Value=l,T.Symbol=this.Symbol,T.LanguageID=this.LanguageID,!T.Operator())return;var I=T.Width;this.Tooltip.className="jchart-klineinfo-tooltip",this.Tooltip.style.position="absolute",D+I>this.UIElement.getBoundingClientRect().width?this.Tooltip.style.left=D-I+"px":this.Tooltip.style.left=D+"px",this.Tooltip.style.top=c+f+"px",this.Tooltip.style.width=I+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=T.Text,this.Tooltip.style.display="block"}else if(l.Type==2){if(this.FloatTooltip){this.DrawFloatTooltip({X:s,Y:o,YMove:20/u},l),C=!1;return}var D=s,c=o,T=Je.Create("KLineTradeDataStringFormat");if(T.Value=l,T.Symbol=this.Symbol,T.LanguageID=this.LanguageID,!T.Operator())return;var I=T.Width;this.Tooltip.className="jchart-klinetrade-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=D+"px",this.Tooltip.style.top=c+f+"px",this.Tooltip.style.width=I+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=T.Text,this.Tooltip.style.display="block"}else if(l.Type==3){if(this.FloatTooltip){this.DrawFloatTooltip({X:s,Y:o,YMove:20/u},l),C=!1;return}var D=s,c=o,T=Je.Create("MinuteInfoDataStringFormat");if(T.Value=l,T.Symbol=this.Symbol,T.LanguageID=this.LanguageID,!T.Operator())return;var I=T.Width;this.Tooltip.className="jchart-minuteinfo-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=D+"px",this.Tooltip.style.top=c+f+"px",this.Tooltip.style.width=I+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=T.Text,this.Tooltip.style.display="block"}else if(l.Type==4){if(this.FloatTooltip){this.DrawFloatTooltip({X:s,Y:o,YMove:20/u},l),C=!1;return}var D=s,c=o,T=Je.Create("IconDataStringFormat");if(T.Value=l,T.Symbol=this.Symbol,T.LanguageID=this.LanguageID,!T.Operator())return;var I=T.Width;this.Tooltip.className="jchart-iconinfo-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=D+"px",this.Tooltip.style.top=c+f+"px",this.Tooltip.style.width=I+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=T.Text,this.Tooltip.style.display="block"}else if(l.Type==5){if(this.FloatTooltip){this.DrawFloatTooltip({X:s,Y:o,YMove:20/u},l),C=!1;return}var D=s,c=o,T=Je.Create("ChartOXDataStringFormat");if(T.Value=l,T.Symbol=this.Symbol,T.Period=this.Period,T.LanguageID=this.LanguageID,!T.Operator())return;var I=T.Width;this.Tooltip.className="jchart-chartox-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=D+"px",this.Tooltip.style.top=c+f+"px",this.Tooltip.style.width=I+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=T.Text,this.Tooltip.style.display="block"}else if(l.Type==6){if(this.FloatTooltip){this.DrawFloatTooltip({X:s,Y:o,YMove:20/u},l),C=!1;return}var D=s,c=o,T=Je.Create("ScatterPlotDataStringFormat");if(T.Value=l,T.Symbol=this.Symbol,T.Period=this.Period,T.LanguageID=this.LanguageID,!T.Operator())return;var I=T.Width;this.Tooltip.className="jchart-charscatterplot-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=D+"px",this.Tooltip.style.top=c+f+"px",this.Tooltip.style.width=I+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=T.Text,this.Tooltip.style.display="block"}else if(l.Type==7){if(this.FloatTooltip){this.DrawFloatTooltip({X:s,Y:o,YMove:20/u},l),C=!1;return}var D=s,c=o,T=Je.Create("ChartDrawSVGDataStringFormat");if(T.Value=l,T.Symbol=this.Symbol,T.Period=this.Period,T.LanguageID=this.LanguageID,!T.Operator())return;var I=T.Width;this.Tooltip.className="jchart-chartdrawsvg-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=D+"px",this.Tooltip.style.top=c+f+"px",this.Tooltip.style.width=I+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=T.Text,this.Tooltip.style.display="block"}else if(l.Type==8&&this.FloatTooltip){this.DrawFloatTooltip({X:s,Y:o,YMove:20/u},l),C=!1;return}C&&this.HideFloatTooltip()}},this.UpdateDOMTooltip=function(s,o){var l=this;if(this.TooltipCache.IsShow&&this.TooltipCache.Type==s&&this.TooltipCache.Data&&this.TooltipCache.Type===0){if(!o||!v.IsNonEmptyArray(o.Data))return;var h=o.Data[o.Data.length-1];if(h.Date!=this.TooltipCache.Data.Date||v.IsNumber(h.Time)&&h.Time!=this.TooltipCache.Data.Time)return;var u=this.ChartPaint[0],f=Je.Create("HistoryDataStringFormat");if(f.Value={Data:h,ChartPaint:u,Type:this.TooltipCache.Type},f.Symbol=this.Symbol,f.LanguageID=this.LanguageID,f.GetEventCallback=function(C){return l.GetEventCallback(C)},!f.Operator()||f.Text==this.TooltipCache.InnerHTML)return;this.Tooltip.innerHTML=f.Text,this.TooltipCache.InnerHTML=f.Text}},this.HideTooltip=function(){this.TooltipCache.IsShow=!1,this.TooltipCache.Type=null,this.TooltipCache.InnerHTML=null,this.TooltipCache.Data=null,this.Tooltip.style.display!="none"&&(this.Tooltip.style.display="none"),this.HideFloatTooltip()},this.UpdateSelectRect=function(s,o){if(this.ChartPaint[0].Data){var l=this.GetRectSelectPaint();if(l){var h=this.ChartPaint[0].Data,u=h.Data.length;o>=u&&(o=u-1);var f=h.Data[s],C=h.Data[o];k.Chart.Log("[JSChartContainer::UpdateSelectRect]",f,C),l.SetPoint(f,{Index:0,DataIndex:s}),l.SetPoint(C,{Index:1,DataIndex:o}),this.Draw()}}},this.HideSelectRect=function(){this.ClearDragSelectRect()},this.ResetFrameXYSplit=function(){typeof this.Frame.ResetXYSplit=="function"&&this.Frame.ResetXYSplit()},this.ResetFrameXSplit=function(){typeof this.Frame.ResetXSplit=="function"&&this.Frame.ResetXSplit()},this.ResetFrameYCustomSplit=function(s){typeof this.Frame.ResetYCustomSplit=="function"&&this.Frame.ResetYCustomSplit(s)},this.UpdateFrameMaxMinV2=function(){for(var s=new Dt.default,o=0;o<this.Frame.SubFrame.length;++o){var l=this.Frame.SubFrame[o];if(!(!l||!l.Frame)){var h=l.Frame;h.YCustomSplit=!0;for(var u=h.Identify,f={ID:u,Frame:h,ChartPaint:[],Max:null,Min:null,OverlayFrame:[],SingleOverlay:[],MainOverlayFrame:[null,null]},C=0;C<l.OverlayIndex.length;++C){var D=l.OverlayIndex[C],c=D.Frame;if(c.IsShowMainFrame===1?f.MainOverlayFrame[0]=c:c.IsShowMainFrame===2&&(f.MainOverlayFrame[1]=c),c.IsShareY){if(!c.MainFrame||c.IsCalculateYMaxMin===!1)continue;f.OverlayFrame.push(c);for(var T=0;T<D.ChartPaint.length;++T){var S=D.ChartPaint[T];f.ChartPaint.push(S)}}else f.SingleOverlay.push(D)}s.set(u,f)}}for(var o=0;o<this.ChartPaint.length;++o){var S=this.ChartPaint[o],u=S.ChartFrame.Identify;if(s.has(u)){var I=s.get(u);I.ChartPaint.push(S)}}for(var o=0;o<this.OverlayChartPaint.length;++o){var S=this.OverlayChartPaint[o];if(S.ChartFrame){var u=S.ChartFrame.Identify;if(s.has(u)){var I=s.get(u);I.ChartPaint.push(S)}}}var g=!0,E=!1,F=void 0;try{for(var R=(0,ye.default)(s),A;!(g=(A=R.next()).done);g=!0){for(var P=A.value,f=P[1],h=f.Frame,o=0;o<f.ChartPaint.length;++o){var S=f.ChartPaint[o];if(S.IsShow!=!1&&!S.NotSupportMessage&&S.ChartFrame&&S.IsExcludeYValue!==!0){var p=S.GetMaxMin();p==null||p.Max==null||p.Min==null||((f.Max==null||f.Max<p.Max)&&(f.Max=p.Max),(f.Min==null||f.Min>p.Min)&&(f.Min=p.Min))}}if(f.Frame.YSpecificMaxMin&&(f.Min=f.Frame.YSpecificMaxMin.Max,f.Max=f.Frame.YSpecificMaxMin.Min),(!v.IsNumber(h.YMaxMin.Max)||h.YMaxMin.Max!=f.Max)&&(h.YMaxMin.Max=f.Max,h.XYSplit=!0),(!v.IsNumber(h.YMaxMin.Min)||h.YMaxMin.Min!=f.Min)&&(h.YMaxMin.Min=f.Min,h.XYSplit=!0),h.XYSplit){var w=10,H=0;f.Max!=null&&(w=f.Max),f.Min!=null&&(H=f.Min),h.HorizontalMax=w,h.HorizontalMin=H}else h.XSplit=!0;for(var C=0;C<f.OverlayFrame.length;++C)f.OverlayFrame[C].XYSplit=!0;for(var o=0;o<f.MainOverlayFrame.length;++o){var l=f.MainOverlayFrame[o];l&&(l.XYSplit=!0)}for(var o=0;o<f.SingleOverlay.length;++o){var D=f.SingleOverlay[o];D.UpdateFrameMaxMin()}}}catch(W){E=!0,F=W}finally{try{!g&&R.return&&R.return()}finally{if(E)throw F}}},this.UpdateFrameMaxMin=function(){this.UpdateFrameMaxMinV2()},this.DataMoveLeft=function(){var s=null;return this.Frame.Data?s=this.Frame.SubFrame[0].Frame.Data:s=this.Frame.Data,!s||s.DataOffset<=0?!1:(--s.DataOffset,!0)},this.DataMoveRight=function(){var s=null;if(this.Frame.Data?s=this.Frame.SubFrame[0].Frame.Data:s=this.Frame.Data,!s)return!1;var o=0;return this.Frame.XPointCount?o=this.Frame.XPointCount:o=this.Frame.SubFrame[0].Frame.XPointCount,!o||o+s.DataOffset>=s.Data.length?!1:(++s.DataOffset,!0)},this.UpdataDataoffset=function(){var s=null;if(this.Frame.Data?s=this.Frame.Data:s=this.Frame.SubFrame[0].Frame.Data,!!s){for(var o in this.ChartPaint){var l=this.ChartPaint[o];l.Data&&(l.Data.DataOffset=s.DataOffset)}for(var o in this.OverlayChartPaint){var l=this.OverlayChartPaint[o];l.Data&&(l.Data.DataOffset=s.DataOffset)}for(var o in this.Frame.SubFrame){var h=this.Frame.SubFrame[o];for(var u in h.OverlayIndex){var f=h.OverlayIndex[u];for(var C in f.ChartPaint){var l=f.ChartPaint[C];l.Data&&(l.Data.DataOffset=s.DataOffset)}}}}},this.GetMoveOneStepWidth=function(){if(v.IsPlusNumber(this.StepPixel))return this.StepPixel;var s=B(),o=this.Frame.SubFrame[0].Frame,l=o.DataWidth,h=o.DistanceWidth,u=this.StepPixel,u=(l+h)/s;return u<1&&(u=1),u},this.DataMove=function(s,o){var l=this.GetMoveOneStepWidth(),h=s;if(s=parseInt(s/l),s<=0)return!1;var u=null;if(this.Frame.Data?u=this.Frame.SubFrame[0].Frame.Data:u=this.Frame.Data,!u)return!1;var f=0;if(this.Frame.XPointCount?f=this.Frame.XPointCount:f=this.Frame.SubFrame[0].Frame.XPointCount,!f)return!1;if(this.Frame.SubFrame&&this.Frame.SubFrame.length>0&&this.Frame.SubFrame[0].Frame){var C=this.Frame.SubFrame[0].Frame;(C.DataWidth<=1||C.DistanceWidth<=1)&&v.IsPlusNumber(this.StepPixel)&&(s=parseInt(h)*this.StepPixel)}if(o){if(this.RightSpaceCount>0){if(f+u.DataOffset>=u.Data.length+this.RightSpaceCount)return!1;u.DataOffset+=s,u.DataOffset+f>=u.Data.length+this.RightSpaceCount&&(u.DataOffset=u.Data.length-(f-this.RightSpaceCount))}else{if(f+u.DataOffset>=u.Data.length)return!1;u.DataOffset+=s,u.DataOffset+f>=u.Data.length&&(u.DataOffset=u.Data.length-f)}return!0}else return u.DataOffset<=0?!1:(u.DataOffset-=s,u.DataOffset<0&&(u.DataOffset=0),!0)},this.XCoordinateZoom=function(s,o){var l=this.GetMoveOneStepWidth();return s=parseInt(s/l),s<=0?!1:this.Frame.XCoordinateZoom(o)},this.GetSubFrameIndex=function(s,o){if(!this.Frame.SubFrame||this.Frame.SubFrame.length<=0)return-1;for(var l in this.Frame.SubFrame){var h=this.Frame.SubFrame[l].Frame,u=h.ChartBorder.GetLeft(),f=h.ChartBorder.GetTop(),C=h.ChartBorder.GetHeight(),D=h.ChartBorder.GetWidth();if(this.Canvas.beginPath(),this.Canvas.rect(u,f,D,C),this.Canvas.isPointInPath(s,o))return parseInt(l)}return 0},this.GetDataIndexByPoint=function(s){var o=this.Frame;this.Frame.SubFrame&&this.Frame.SubFrame.length>0&&(o=this.Frame.SubFrame[0].Frame);var l=null;if(this.Frame.Data?l=this.Frame.Data:l=this.Frame.SubFrame[0].Frame.Data,!(!l||!o)){var h=parseInt(o.GetXData(s));return l.DataOffset+h}},this.GetSelectRectData=function(s){if(Math.abs(s.XStart-s.XEnd)<5)return!1;this.PtInClient(s.XStart,s.YStart),this.PtInClient(s.XEnd,s.YEnd);var o=null;if(this.Frame.Data?o=this.Frame.Data:o=this.Frame.SubFrame[0].Frame.Data,!o)return!1;var l=this.GetDataIndexByPoint(s.XStart),h=this.GetDataIndexByPoint(s.XEnd);return Math.abs(l-h)<2?!1:(s.Data=o,l>h?(s.Start=h,s.End=l):(s.Start=l,s.End=h),!0)},this.GetChartDrawPictureByPoint=function(s){for(var o=0;o<this.ChartDrawPicture.length;++o){var l=this.ChartDrawPicture[o],h=l.IsPointIn(s.X,s.Y,this.ChartDrawOption);if(h!==!1&&h>=0)return s.ChartDrawPicture=l,s.PointIndex=h,l.GetCursorType&&(s.Cursor=l.GetCursorType(h)),!0}return!1},this.SaveToImage=function(s,o){if(this.UIElement.width<=0||this.UIElement.height<=0||this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash)return null;k.Chart.Log("[JSChartContainer::SaveToImage]",this.UIElement);var l="rgb(255,255,255)";o&&(l=o),this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.Canvas.fillStyle=l,this.Canvas.fillRect(0,0,this.UIElement.width,this.UIElement.height);var h=B();this.Canvas.lineWidth=h,this.Frame.Draw();for(var u in this.ChartPaint){var f=this.ChartPaint[u];f.IsDrawFirst&&f.Draw()}for(var u in this.ChartPaint){var f=this.ChartPaint[u];f.IsDrawFirst||f.Draw()}for(var u in this.ChartPaintEx){var f=this.ChartPaintEx[u];f.Draw()}for(var u in this.OverlayChartPaint){var f=this.OverlayChartPaint[u];f.Draw()}for(var u in this.ExtendChartPaint){var f=this.ExtendChartPaint[u];!f.IsDynamic&&f.IsAnimation==!1&&f.Draw()}this.Frame.DrawInsideHorizontal&&this.Frame.DrawInsideHorizontal(),this.Frame.DrawLock();for(var u in this.ExtendChartPaint){var f=this.ExtendChartPaint[u];f.IsDynamic&&f.DrawAfterTitle===!1&&f.Draw()}(this.LastPoint.X!=null||this.LastPoint.Y!=null)&&this.ChartCorssCursor&&(this.ChartCorssCursor.LastPoint=this.LastPoint,this.ChartCorssCursor.CursorIndex=this.CursorIndex);for(var u in this.TitlePaint){var f=this.TitlePaint[u];f.IsDynamic&&(f.CursorIndex=this.CursorIndex,f.Draw())}for(var u in this.ExtendChartPaint){var f=this.ExtendChartPaint[u];f.IsDynamic&&f.DrawAfterTitle===!0&&f.IsAnimation==!1&&f.Draw()}if(this.EnableAnimation)for(var u in this.ExtendChartPaint){var f=this.ExtendChartPaint[u];f.IsAnimation===!0&&f.Draw()}for(var u in this.ChartDrawPicture){var f=this.ChartDrawPicture[u];f.Draw()}this.CurrentChartDrawPicture&&this.CurrentChartDrawPicture.Status!=10&&this.CurrentChartDrawPicture.Draw();var C=this.UIElement.toDataURL(s||"image/png",1);return k.Chart.Log("[JSChartContainer::SaveToImage] data= ",C),C},this.SaveToImageUrl=function(s,o){s||(s={Format:"image/png",ColorGB:"rgb(255,255,255)"});var l=this.SaveToImage(s.Format,s.ColorGB),h={Base64:l,BucketName:"downloadcache",Path:"hqchart/hq_snapshot"},u=d.Domain+"/API/FileUploadForBase64";Vt.HttpRequest({url:u,method:"POST",dataType:"json",data:h,success:function(C){k.Chart.Log("[JSChartContainer::SaveToImageUrl] recv data",C);var D={Path:C.relativeurl,Domain:"http://127.0.0.1:8087"};D.Url=D.Domain+"/"+D.Path,o&&o(!0,D,"")},error:function(C){k.Chart.Log("[JSChartContainer::SaveToImageUrl] error ",C),o&&o(!1,null,"upload failed")}})},this.ExportDataToCSV=function(s){for(var o="",l="",h=0,u=0;u<s.length;++u){var f=s[u];l+='"'+f.Name+'"',u==s.length-1?l+=`\r
`:l+=",",v.IsNonEmptyArray(f.Data)&&(h=Math.max(h,f.Data.length))}o+=l;for(var u=0,C=0;u<h;++u){for(l="",C=0;C<s.length;++C){var f=s[C],D=null;f.Data&&u<f.Data.length&&(D=f.Data[u]),l+='"'+D+'"',C==s.length-1?l+=`\r
`:l+=","}o+=l}return o="\uFEFF"+o,o},this.SetLanguage=function(s){var o=St.GetLanguageID(s);if(!v.IsNumber(o)){console.warn("[JSChartContainer::SetLanguage] language="+s+" error");return}if(this.LanguageID!=o){this.LanguageID=o,this.ChartCorssCursor&&this.ChartCorssCursor.StringFormatY&&(this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID);for(var l=0;l<this.TitlePaint.length;++l){var h=this.TitlePaint[l];h&&(h.LanguageID=this.LanguageID)}for(var l=0;l<this.ExtendChartPaint.length;++l){var h=this.ExtendChartPaint[l];h&&(h.LanguageID=this.LanguageID)}this.Frame&&this.Frame.SetLanguage&&this.Frame.SetLanguage(this.LanguageID),this.ResetFrameXYSplit(),this.Frame.SetSizeChage(!0),this.Draw(),this.PopMinuteChart&&this.PopMinuteChart.SetLanguage(s)}},this.ReloadTiltePaintResource=function(s){for(var o in this.TitlePaint){var l=this.TitlePaint[o];l.ReloadResource&&l.ReloadResource(s)}},this.ReloadExtendChartPaintResource=function(s){for(var o=0;o<this.ExtendChartPaint.length;++o){var l=this.ExtendChartPaint[o];l.ReloadResource&&l.ReloadResource(s)}this.ChartDragSelectRect&&this.ChartDragSelectRect.ReloadResource&&this.ChartDragSelectRect.ReloadResource(s)},this.ReloadChartDrawPictureResource=function(s){if(v.IsNonEmptyArray(this.ChartDrawPicture))for(var o=0;o<this.ChartDrawPicture.length;++o){var l=this.ChartDrawPicture[o];l.ReloadResource&&l.ReloadResource(s)}},this.ReloadResource=function(s){this.ReloadBorder(s),this.ReloadTiltePaintResource(s.Resource),this.ReloadChartPaint(s.Resource),this.ReloadFrame(s.Resource),this.ReloadExtendChartPaintResource(s.Resource),this.ReloadChartCorssCursor(s,s.Resource),this.ReloadChartDrawPictureResource(s.Resource),s.Update&&this.Update?this.Update({UpdateCursorIndexType:2}):s.Draw==!0&&this.Draw(),this.PopMinuteChart&&this.PopMinuteChart.ReloadResource(s),this.DialogTooltip&&this.DialogTooltip.ReloadResource(s),this.FloatTooltip&&this.FloatTooltip.ReloadResource(s),this.DialogSelectRect&&this.DialogSelectRect.ReloadResource(s),this.DialogSearchIndex&&this.DialogSearchIndex.ReloadResource(s)},this.ReloadBorder=function(s){if(s){var o=B();if(s.Border){var l=s.Border;v.IsNumber(l.Left)&&(this.Frame.ChartBorder.Left=l.Left*o),v.IsNumber(l.Right)&&(this.Frame.ChartBorder.Right=l.Right*o),v.IsNumber(l.Top)&&(this.Frame.ChartBorder.Top=l.Top*o),v.IsNumber(l.Bottom)&&(this.Frame.ChartBorder.Bottom=l.Bottom*o)}for(var h in s.Windows){var l=s.Windows[h];if(!(h>=this.Frame.SubFrame.length)){var u=this.Frame.SubFrame[h],f=u.Frame.ChartBorder;v.IsNumber(l.TitleHeight)&&(f.TitleHeight=l.TitleHeight*o)}}for(var h in s.Frame){var l=s.Frame[h];if(!(h>=this.Frame.SubFrame.length)){var u=this.Frame.SubFrame[h],f=u.Frame.ChartBorder;l.TopSpace>=0&&(f.TopSpace=l.TopSpace*o),l.BottomSpace>=0&&(f.BottomSpace=l.BottomSpace*o)}}}},this.ReloadFrame=function(s){for(var o=0;o<this.Frame.SubFrame.length;++o){var l=this.Frame.SubFrame[o],h=l.Frame;h&&h.ReloadResource&&h.ReloadResource(s);for(var u=0;u<l.OverlayIndex.length;++u){var f=l.OverlayIndex[u];f.Frame&&f.Frame.ReloadResource&&f.Frame.ReloadResource(s)}}},this.ReloadChartPaint=function(s){for(var o=0;o<this.ChartPaint.length;++o){var l=this.ChartPaint[o];l&&l.ReloadResource&&l.ReloadResource(s)}},this.ReloadChartCorssCursor=function(s,o){var l=B();if(s&&s.CorssCursor){var h=s.CorssCursor;v.IsNumber(h.TitleHeight)&&(this.ChartCorssCursor.TextHeight=h.TitleHeight*l)}this.ChartCorssCursor.ReloadResource&&this.ChartCorssCursor.ReloadResource(o)},this.SetDepthMapData=function(s,o){for(var l=0;l<s.length;++l)for(var h=s[l],u=0;u<this.ExtendChartPaint.length;++u){var f=this.ExtendChartPaint[u];if(f.ID==h.ID){f.Data=h.Data;break}}o&&o.Draw==!0&&this.Draw()},this.PointAbsoluteToRelative=function(s,o,l){var h={X:s,Y:o},u=B(),f=this.UIElement.getBoundingClientRect();return l?(h.X=s-f.left*u,h.Y=o-f.top*u):(h.X=(s-f.left)*u,h.Y=(o-f.top)*u),h},this.SetChartDrawPictureFirstPoint=function(s,o,l){var h=this.CurrentChartDrawPicture;if(!h||!this.Frame.SubFrame||this.Frame.SubFrame.length<=0)return!1;for(var u=this.PointAbsoluteToRelative(s,o,l),f=u.X,C=u.Y,D=0;D<this.Frame.SubFrame.length;++D){var c=this.Frame.SubFrame[D].Frame,T=c.ChartBorder.GetLeft(),S=c.ChartBorder.GetTopEx(),I=c.ChartBorder.GetBottomEx(),g=I-S,E=c.ChartBorder.GetWidth();if(this.Canvas.beginPath(),this.Canvas.rect(T,S,E,g),this.Canvas.isPointInPath(f,C)){if(v.IsNumber(h.LimitFrameID)&&D!=h.LimitFrameID)return!1;h.Frame=c;break}}return h.Frame?(h.Point[0]=new ft,h.Point[0].X=f,h.Point[0].Y=C,h.Status=1,h.PointMagnetKLine(),!0):!1},this.SetChartDrawPictureSecondPoint=function(s,o,l){var h=this.CurrentChartDrawPicture;if(!h)return!1;var u=this.PointAbsoluteToRelative(s,o,l);return h.Point[1]=new ft,h.Point[1].X=u.X,h.Point[1].Y=u.Y,h.Status=2,!0},this.SetChartDrawPictureThirdPoint=function(s,o,l){var h=this.CurrentChartDrawPicture;if(!h)return!1;var u=this.PointAbsoluteToRelative(s,o,l);return h.Point[2]=new ft,h.Point[2].X=u.X,h.Point[2].Y=u.Y,h.Status=3,!0},this.MoveChartDrawPicture=function(s,o,l,h){var u=this.CurrentChartDrawPicture;if(!u)return!1;var f=B();l&&(f=1);var C=s*f,D=o*f;return u.Move(C,D,h),!0},this.FinishChartDrawPicturePoint=function(){var s=this.CurrentChartDrawPicture;if(!s||s.PointCount!=s.Point.length)return!1;if(s.ClassName=="ChartDrawRuler")return s.FinishedCallback&&s.FinishedCallback(s),this.CurrentChartDrawPicture=null,!0;s.PointMagnetKLine(),s.Status=10,s.PointToValue(),this.ChartDrawPicture.push(s),this.CurrentChartDrawPicture=null;var o=this.GetEventCallback($.ON_FINISH_DRAWPICTURE);if(o&&o.Callback){var l={DrawPicture:s};o.Callback(o,l,this)}return s.FinishedCallback&&s.FinishedCallback(s),s.OnFinish&&s.OnFinish(),this.ChartDrawStorage&&this.ChartDrawStorage.SaveDrawData(s),!0},this.OnSelectChartPicture=function(s){if(k.Chart.Log("[JSChartContainer::OnSelectChartPicture]",s),!!this.DialogModifyDraw)if(s.ClassName=="ChartDrawPictureText"||s.ClassName=="ChartDrawVolProfile"){if(this.CloseModifyDrawDialog(),this.ChartPictureMenu||(this.ChartPictureMenu=ED.Create("ChartPictureSettingMenu",this.UIElement.parentNode)),!this.ChartPictureMenu)return;var o={data:{ChartPicture:s,HQChart:this}};this.ChartPictureMenu.DoModal(o)}else this.ShowModifyDrawDialog(s)},this.FinishMoveChartDrawPicture=function(){var s=this.CurrentChartDrawPicture;if(!s||s.PointCount!=s.Point.length)return!1;if(s.PointMagnetKLine(),s.Status=10,s.PointToValue(),this.ChartDrawStorage&&this.ChartDrawStorage.SaveDrawData(s),this.CurrentChartDrawPicture=null,this.SelectChartDrawPicture&&this.SelectChartDrawPicture.DragInfo){var o=this.SelectChartDrawPicture.DragInfo;if(o.Click&&o.Move&&(o.Click.X!=o.Move.X||o.Click.Y!=o.Move.Y)){var l=this.GetEventCallback($.ON_FINISH_MOVE_DRAWPICTURE);if(l&&l.Callback){var h={DrawPicture:s};l.Callback(l,h,this)}s.OnMoveFinish&&s.OnMoveFinish()}}return!0},this.ClearChartDrawPicture=function(s,o){var l=!0;if(!s)this.ChartDrawPicture=[],this.ChartDrawStorage&&this.ChartDrawStorage.Clear(),this.SelectChartDrawPicture=null,o&&o.Draw==!1&&(l=!1),l&&this.Draw();else for(var h=0;h<this.ChartDrawPicture.length;++h){var u=this.ChartDrawPicture[h];(u.Guid==s.Guid||u==s)&&(this.ChartDrawStorage&&this.ChartDrawStorage.DeleteDrawData(s),this.ChartDrawPicture.splice(h,1),this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.Guid==s.Guid||this.SelectChartDrawPicture==s)&&(this.SelectChartDrawPicture=null),o&&o.Draw==!1&&(l=!1),l&&this.Draw())}},this.GetActiveDrawPicture=function(){var s={Move:{Guid:null},Select:{Guid:null},MoveOn:{Guid:null}};return this.CurrentChartDrawPicture&&(s.Move={Guid:this.CurrentChartDrawPicture.Guid}),this.SelectChartDrawPicture&&(s.Select={Guid:this.SelectChartDrawPicture.Guid,Chart:this.SelectChartDrawPicture}),this.MoveOnChartDrawPicture&&(s.MoveOn={Guid:this.MoveOnChartDrawPicture.Guid}),s},this.SetChartDrawOption=function(s){if(v.IsBool(s.IsLockScreen)&&(this.ChartDrawOption.IsLockScreen=s.IsLockScreen),v.IsNumber(s.Zoom)&&s.Zoom>=0&&(this.ChartDrawOption.Zoom=s.Zoom),s.Magnet){var o=s.Magnet;this.ChartDrawOption.Magnet||(this.ChartDrawOption.Magnet={Type:0,Distance:20*B(),Enable:!1}),v.IsBool(o.Enable)&&(this.ChartDrawOption.Magnet.Enable=o.Enable),v.IsNumber(o.Type)&&(this.ChartDrawOption.Magnet.Type=o.Type),v.IsNumber(o.Distance)&&(this.ChartDrawOption.Magnet.Distance=o.Distance)}},this.EnableShowCorssCursorLine=function(s){this.ChartCorssCursor&&(this.ChartCorssCursor.IsShowCorss=s)},this.GetExtendChartByClassName=function(s){for(var o=0;o<this.ExtendChartPaint.length;++o){var l=this.ExtendChartPaint[o];if(l.ClassName==s)return{Index:o,Chart:l}}return null},this.GetExtendChartByClassNameV2=function(s){for(var o=[],l=0;l<this.ExtendChartPaint.length;++l){var h=this.ExtendChartPaint[l];h.ClassName==s&&o.push({Index:l,Chart:h})}return o.length<=0?null:o},this.GetExtendChartRightWidth=function(){for(var s=0,o=0;o<this.ExtendChartPaint.length;++o){var l=this.ExtendChartPaint[o];l&&l.ClassName=="StockChip"&&v.IsNumber(l.Width)&&(s+=l.Width)}return s},this.DeleteExtendChart=function(s){s.Index>=this.ExtendChartPaint.length||this.ExtendChartPaint[s.Index]==s.Chart&&(typeof s.Chart.Clear=="function"&&s.Chart.Clear(),this.ExtendChartPaint.splice(s.Index,1))},this.DeleteExtendChartByID=function(s){for(var o=0;o<this.ExtendChartPaint.length;++o){var l=this.ExtendChartPaint[o];if(l.ID==s)return this.ExtendChartPaint.splice(o,1),!0}return!1},this.EnableSplashScreen=function(s,o){this.ChartSplashPaint&&(this.ChartSplashPaint.EnableSplash(s),!(o&&o.Draw===!1)&&(s?this.DrawSplashScreen(o):this.Draw()))},this.SetSubFrameAttribute=function(s,o,l){if(!(!s||!s.Frame)){var h=s.Frame;o&&(v.IsBool(o.Modify)&&(h.ModifyIndex=o.Modify),v.IsBool(o.Change)&&(h.ChangeIndex=o.Change),v.IsBool(o.Close)&&(h.CloseIndex=o.Close),v.IsBool(o.Overlay)&&(h.OverlayIndex=o.Overlay),v.IsBool(o.IsDrawTitleBG)&&(h.IsDrawTitleBG=o.IsDrawTitleBG),v.IsNumber(o.TitleHeight)?h.ChartBorder.TitleHeight=o.TitleHeight:o.TitleHeight=h.ChartBorder.TitleHeight,v.IsBool(o.IsShowTitleArrow)&&(h.IsShowTitleArrow=o.IsShowTitleArrow),v.IsNumber(o.TitleArrowType)&&(h.TitleArrowType=o.TitleArrowType),v.IsBool(o.IsShowIndexName)&&(h.IsShowIndexName=o.IsShowIndexName),v.IsNumber(o.IndexParamSpace)&&(h.IndexParamSpace=o.IndexParamSpace),v.IsNumber(o.IndexTitleSpace)&&(h.IndexTitleSpace=o.IndexTitleSpace),v.IsUndefined(o.HorizontalReserved)||(h.HorizontalReserved=o.HorizontalReserved),v.IsBool(o.IsShowNameArrow)&&(h.IsShowNameArrow=o.IsShowNameArrow)),l&&(l.SplitCount&&(h.YSplitOperator.SplitCount=l.SplitCount),v.IsNumber(l.SplitType)&&(h.YSplitOperator.SplitType=l.SplitType,h.YSplitOperator.DefaultSplitType=l.SplitType),v.IsBool(l.IsShowXLine)&&(h.IsShowXLine=l.IsShowXLine),v.IsBool(l.IsShowYLine)&&(h.IsShowYLine=l.IsShowYLine),v.IsBool(l.IsShowLeftText)&&(h.IsShowYText[0]=l.IsShowLeftText,h.YSplitOperator.IsShowLeftText=l.IsShowLeftText),v.IsBool(l.IsShowRightText)&&(h.IsShowYText[1]=l.IsShowRightText,h.YSplitOperator.IsShowRightText=l.IsShowRightText),v.IsNumber(l.Height)&&l.Height>=0&&(s.Height=l.Height))}},this.SetSubFrameOption=function(s,o){if(o){var l=s.Frame;if(o.Window){var h=o.Window;v.IsBool(h.Modify)&&(l.ModifyIndex=h.Modify),v.IsBool(h.Change)&&(l.ChangeIndex=h.Change),v.IsBool(h.Close)&&(l.CloseIndex=h.Close),v.IsBool(h.Overlay)&&(l.OverlayIndex=h.Overlay),v.IsBool(h.Export)&&(l.ExportData=h.Export),v.IsBool(h.MaxMin)&&(l.MaxMinWindow=h.MaxMin),v.IsBool(h.TitleWindow)&&(l.TitleWindow=h.TitleWindow),v.IsBool(h.IsDrawTitleBG)&&(l.IsDrawTitleBG=h.IsDrawTitleBG),v.IsBool(h.IsShowNameArrow)&&(l.IsShowNameArrow=h.IsShowNameArrow),h.OverlayIndexType&&(v.IsNumber(h.OverlayIndexType.Position)&&(l.OverlayIndexType.Position=h.OverlayIndexType.Position),v.IsNumber(h.OverlayIndexType.LineSpace)&&(l.OverlayIndexType.LineSpace=h.OverlayIndexType.LineSpace)),v.IsNonEmptyArray(h.CustomToolbar)&&(l.CustomToolbar=h.CustomToolbar.slice())}v.IsNumber(o.SplitCount)&&(s.Frame.YSplitOperator.SplitCount=o.SplitCount),v.IsNumber(o.TitleHeight)&&(s.Frame.ChartBorder.TitleHeight=o.TitleHeight),v.IsBool(o.IsShowTitleArrow)&&(s.Frame.IsShowTitleArrow=o.IsShowTitleArrow),v.IsNumber(o.TitleArrowType)&&(s.Frame.TitleArrowType=o.TitleArrowType),v.IsBool(o.IsShowIndexName)&&(s.Frame.IsShowIndexName=o.IsShowIndexName),v.IsBool(o.IsShowOverlayIndexName)&&(s.Frame.IsShowOverlayIndexName=o.IsShowOverlayIndexName),v.IsNumber(o.IndexParamSpace)&&(s.Frame.IndexParamSpace=o.IndexParamSpace),v.IsBool(o.IsShowXLine)&&(s.Frame.IsShowXLine=o.IsShowXLine),v.IsBool(o.IsShowYLine)&&(s.Frame.IsShowYLine=o.IsShowYLine),v.IsBool(o.IsShowIndexTitle)&&(s.Frame.IsShowIndexTitle=o.IsShowIndexTitle),v.IsNumber(o.Height)&&(s.Height=o.Height),v.IsBool(o.IsShowLeftText)&&(s.Frame.IsShowYText[0]=o.IsShowLeftText,s.Frame.YSplitOperator.IsShowLeftText=o.IsShowLeftText),v.IsBool(o.IsShowRightText)&&(s.Frame.IsShowYText[1]=o.IsShowRightText,s.Frame.YSplitOperator.IsShowRightText=o.IsShowRightText)}},this.AddNewSubFrame=function(s){var o=this,l=this.Frame.SubFrame.length,h=this.CreateSubFrameItem(l),u=B();h.Frame.ChartBorder.TitleHeight*=u,this.Frame.SubFrame[l]=h;var f=new Qa;f.Frame=this.Frame.SubFrame[l].Frame,f.Canvas=this.Canvas,f.LanguageID=this.LanguageID,f.GetEventCallback=function(c){return o.GetEventCallback(c)},this.TitlePaint[l+1]=f,this.SetSubFrameOption(h,s);for(var C=0;C<this.Frame.SubFrame.length;++C){var D=this.Frame.SubFrame[C].Frame;C==this.Frame.SubFrame.length-1?D.XSplitOperator.ShowText=!0:D.XSplitOperator.ShowText=!1}return this.UpdataDataoffset(),this.Frame.SetSizeChage(!0),this.UpdateXShowText&&this.UpdateXShowText(),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw(),l},this.AddIndexWindow=function(s,o){var l=new Z,h=l.Get(s);if(h){this.RemoveMinSizeWindows();var u=this.AddNewSubFrame(o);if(Z.ModifyAttribute(h,o),this.WindowIndex[u]=new Ie(h.Name,h.Script,h.Args,h),this.ClassName=="MinuteChartContainer"||this.ClassName=="MinuteChartHScreenContainer")var f=this.SourceData;else var f=this.ChartPaint[0].Data;this.BindIndexData(u,f)}},this.AddAPIIndexWindow=function(s,o){if(s.API){this.RemoveMinSizeWindows();var l=this.AddNewSubFrame(o),h=s.API;if(this.WindowIndex[l]=new ga(h.Name,h.Script,h.Args,s),this.ClassName=="MinuteChartContainer"||this.ClassName=="MinuteChartHScreenContainer")var u=this.SourceData;else var u=this.ChartPaint[0].Data;this.BindIndexData(l,u)}},this.AddScriptIndexWindow=function(s,o){if(!(!s||!s.Script||!s.Name)){this.RemoveMinSizeWindows();var l=this.AddNewSubFrame(o),h={Name:s.Name,Script:s.Script,Args:s.Args,ID:s.Name,KLineType:s.KLineType,YSpecificMaxMin:s.YSpecificMaxMin,YSplitScale:s.YSplitScale,FloatPrecision:s.FloatPrecision,Condition:s.Condition,StringFormat:s.StringFormat,OutName:s.OutName};if(s.ID&&(h.ID=s.ID),this.WindowIndex[l]=new Ie(h.Name,h.Script,h.Args,h),this.ClassName=="MinuteChartContainer"||this.ClassName=="MinuteChartHScreenContainer")var u=this.SourceData;else var u=this.ChartPaint[0].Data;this.BindIndexData(l,u)}},this.GetRectSelectPaint=function(){var s=this.GetExtendChartByClassName("RectSelectPaint");return s?s.Chart:null},this.GetRectDragPaint=function(){var s=this.GetExtendChartByClassName("RectDragPaint");return s?s.Chart:null},this.SetRectSelectData=function(s,o){var l=this.GetRectSelectPaint();if(!l)return!1;if(l.GetPointCount()==2){if(!l.SpaceReselected)return!1;var h=l.PreventClose;l.PreventClose=!1,l.ClearPoint(),l.PreventClose=h}return l.SetPoint(s,{DataIndex:o})},this.MoveRectSelectPoint=function(s){var o=this.GetRectSelectPaint();if(!o||!this.ChartPaint[0]||!this.ChartPaint[0].Data)return!1;var l=this.ChartPaint[0].Data;if(!this.Frame.SubFrame[0])return!1;var h=this.Frame.SubFrame[0].Frame,u=B(),f=(s.X-e.getBoundingClientRect().left)*u,C=h.GetXData(f);C=parseInt(C.toFixed(0));var D=C+l.DataOffset;D>=l.Data.length&&(D=l.Data.length-1);var c=l.Data[D];if(k.Chart.Log("[KLineChartContainer::MoveRectSelectPoint] point, item",s.PointIndex,c),!o.SetPoint(c,{Index:s.PointIndex,DataIndex:D}))return!1;var T=this.GetEventCallback($.ON_DRAG_SELECT_RECT);if(T){var S=o.GetSelectRectData(),I={X:s.X,Y:s.Y,SelectData:S,RectSelectPaint:o};T.Callback(T,I,this)}if(this.IsShowSelectRectDialog()){var S=o.GetSelectRectData(),I={Chart:this,X:s.X,Y:s.Y,SelectData:S,RectSelectPaint:o},g={data:I};this.DrawSelectRectDialog(g)}return!0},this.MoveSubRectSelect=function(s){var o=this.GetRectSelectPaint();if(!o||!o.MoveSubRect(s.Step,s.IsLeft))return!1;var l=this.GetEventCallback($.ON_DRAG_SUB_SELECT_RECT);if(l){var h={Start:o.SubClient.FirstPoint,End:o.SubClient.SecondPoint},u={X:s.X,Y:s.Y,SubRectSelectData:h,RectSelectPaint:o};l.Callback(l,u,this)}return!0},this.ClearRectSelect=function(s){var o=this.GetRectSelectPaint();return o?(s&&(o.PreventClose=!1),o.ClearPoint()):!1},this.DeleteWindowsOverlayIndex=function(s){if(v.IsNumber(s)&&!(s<0||s>=this.Frame.SubFrame.length)){var o=this.Frame.SubFrame[s];if(v.IsNonEmptyArray(o.OverlayIndex)){for(var l=[],h=0;h<o.OverlayIndex.length;++h){var u=o.OverlayIndex[h];l.push(u.Identify);for(var f=0;f<u.ChartPaint.length;++f){var C=u.ChartPaint[f];C&&C.OnDestroy&&C.OnDestroy()}u.ChartPaint=[]}o.OverlayIndex=[];for(var D=this.TitlePaint[s+1],h=0;h<l.length;++h){var c=l[h];D.OverlayIndex.has(c)&&D.OverlayIndex.delete(c),D.OverlayDynamicTitle.has(c)&&D.OverlayDynamicTitle.delete(c)}}}},this.DeleteOverlayIndex=function(s,o){var l=null;if(v.IsNumber(o)){if(o>=0&&o<this.Frame.SubFrame.length)for(var h=this.Frame.SubFrame[o],u=0;u<h.OverlayIndex.length;++u){var f=h.OverlayIndex[u];if(f.Identify===s){for(var C=0;C<f.ChartPaint.length;++C){var D=f.ChartPaint[C];D&&D.OnDestroy&&D.OnDestroy()}h.OverlayIndex.splice(u,1),l=o;break}}}else for(var c=0;c<this.Frame.SubFrame.length;++c)for(var h=this.Frame.SubFrame[c],u=0;u<h.OverlayIndex.length;++u){var f=h.OverlayIndex[u];if(f.Identify===s){for(var C=0;C<f.ChartPaint.length;++C){var D=f.ChartPaint[C];D&&D.OnDestroy&&D.OnDestroy()}h.OverlayIndex.splice(u,1),l=c;break}}if(l==null)return console.warn("[JSChartContainer::DeleteOverlayIndex] can't find overlay index. [identify="+s+"]"),!1;var T=l+1,S=this.TitlePaint[T];return S.OverlayIndex.has(s)&&S.OverlayIndex.delete(s),S.OverlayDynamicTitle.has(s)&&S.OverlayDynamicTitle.delete(s),!0},this.FindScriptIndex=function(s,o){if(v.IsNumber(o)&&o>=0){if(o>=this.Frame.SubFrame.length)return null;var l=this.WindowIndex[o];if(l&&l.Guid==s)return{Type:0,Data:l,WindowIndex:o};for(var l=this.Frame.SubFrame[o],h=0;h<l.OverlayIndex.length;++h){var u=l.OverlayIndex[h];if(u.Identify===s)return{Type:1,Data:u,WindowIndex:o,OverlayIndex:h}}}else for(var h=0;h<this.Frame.SubFrame.length;++h){var l=this.WindowIndex[h];if(l&&l.Guid==s)return{Type:0,Data:l,WindowIndex:h};for(var l=this.Frame.SubFrame[h],f=0;f<l.OverlayIndex.length;++f){var u=l.OverlayIndex[f];if(u.Identify===s)return{Type:1,Data:u,WindowIndex:h,OverlayIndex:f}}}return null},this.MoveIndex=function(s,o,l){var h=this;if(!s||!o||!l||!v.IsNumber(s.WindowIndex)||s.WindowIndex<0||s.WindowIndex>=this.Frame.SubFrame.length||!v.IsNumber(o.WindowIndex)||o.WindowIndex<0||o.WindowIndex>=this.Frame.SubFrame.length)return!1;var u=this.FindScriptIndex(s.IndexID,s.WindowIndex);if(!u)return!1;var f=null,C=null;if(u.Type==0?f=u.Data:u.Type==1&&(C=u.Data),!C&&!f)return!1;var D=0,c=this.ClassName=="MinuteChartContainer"||this.ClassName=="MinuteChartHScreenContainer";if(c&&(D=2),o.WindowIndex>=D&&this.WindowIndex[o.WindowIndex]==null){f?this.WindowIndex[o.WindowIndex]=this.CreateMainScript(f):C&&(this.WindowIndex[o.WindowIndex]=this.CreateMainScript(C.Script)),l.Operator==0&&(C?this.DeleteOverlayIndex(C.Identify,s.WindowIndex):f&&this.DeleteMainIndex(f.Guid,s.WindowIndex));var T=this.GetMainData();this.BindIndexData(o.WindowIndex,T),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}else{var S=this.Frame.SubFrame[o.WindowIndex],I=new ln,g=this.CreateOverlayFrame();g.Canvas=this.Canvas,g.MainFrame=S.Frame,g.ChartBorder=S.Frame.ChartBorder,C&&(g.IsShow=C.Frame.IsShow),g.YSplitOperator=new Za,g.YSplitOperator.LanguageID=this.LanguageID,g.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),g.YSplitOperator.Frame=g,g.YSplitOperator.ChartBorder=g.ChartBorder,g.YSplitOperator.SplitCount=S.Frame.YSplitOperator.SplitCount,g.YSplitOperator.GetEventCallback=function(p){return h.GetEventCallback(p)},I.Frame=g;var E;f?(E=this.CreateOverlayScript(f),E.OverlayIndex={IsOverlay:!0,Identify:I.Identify,WindowIndex:o.WindowIndex,Frame:I}):C&&(E=this.CreateOverlayScript(C.Script),E.OverlayIndex={IsOverlay:!0,Identify:I.Identify,WindowIndex:o.WindowIndex,Frame:I}),I.Script=E;var F=this.GetEventCallback($.ON_CREATE_OVERLAY_FRAME);if(F&&F.Callback){var R={OverlayFrame:I,WindowIndex:o.WindowIndex,SubFrame:S};F.Callback(F,R,this)}S.OverlayIndex.push(I);var A=o.WindowIndex;if(l.Operator==0){if(C)this.DeleteOverlayIndex(C.Identify,s.WindowIndex);else if(f){this.DeleteMainIndex(f.Guid,s.WindowIndex);var u=this.FindScriptIndex(I.Identify);u&&(A=u.WindowIndex)}}var T=this.GetMainData();this.BindOverlayIndexData(I,A,T),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.MoveIndexToNewWindow=function(s,o){var l=this;if(!s||!o||!v.IsNumber(s.WindowIndex)||s.WindowIndex<0||s.WindowIndex>=this.Frame.SubFrame.length)return!1;var h=this.FindScriptIndex(s.IndexID,s.WindowIndex);if(!h)return!1;var u=null,f=null;if(h.Type==0?u=h.Data:h.Type==1&&(f=h.Data),!f&&!u||s.WindowIndex==this.Frame.SubFrame.length-1&&this.Frame.SubFrame[s.WindowIndex].OverlayIndex<=0)return!1;this.RemoveMinSizeWindows();var I=this.Frame.SubFrame.length,C=this.CreateSubFrameItem(I),D=B();C.Frame.ChartBorder.TitleHeight*=D,this.Frame.SubFrame[I]=C;var c=new Qa;c.Frame=this.Frame.SubFrame[I].Frame,c.Canvas=this.Canvas,c.LanguageID=this.LanguageID,c.SelectedChart=this.SelectedChart,c.GetEventCallback=function(E){return l.GetEventCallback(E)},this.TitlePaint[I+1]=c,this.SetSubFrameOption(C,o);for(var T=0;T<this.Frame.SubFrame.length;++T){var S=this.Frame.SubFrame[T].Frame;T==this.Frame.SubFrame.length-1?S.XSplitOperator.ShowText=!0:S.XSplitOperator.ShowText=!1}o.Operator==0&&(f?this.DeleteOverlayIndex(f.Identify,s.WindowIndex):u&&this.DeleteMainIndex(u.Guid,s.WindowIndex)),this.UpdataDataoffset(),this.Frame.SetSizeChage(!0),this.UpdateXShowText&&this.UpdateXShowText(),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw();var I=this.Frame.SubFrame.length-1;u?this.WindowIndex[I]=this.CreateMainScript(u):f&&(this.WindowIndex[I]=this.CreateMainScript(f.Script));var g=this.GetMainData();this.BindIndexData(I,g)},this.CreateOverlayScript=function(s){var o=null;switch(s.ClassName){case"ScriptIndex":o=new cs;break;case"APIScriptIndex":o=new ga(null,null,null,null,!0);break;case"OverlayScriptIndex":o=new cs;break}return s.CopyTo(o),o},this.CreateMainScript=function(s){var o=null;switch(s.ClassName){case"ScriptIndex":case"OverlayScriptIndex":o=new Ie;break;case"APIScriptIndex":o=new ga;break}return s.CopyTo(o),o},this.DeleteMainIndex=function(s,o){var l=this.WindowIndex[o];if(!l)return!1;var h=this.Frame.SubFrame[o];if(!h)return!1;if(!v.IsNonEmptyArray(h.OverlayIndex))this.RemoveIndexWindow(o,{DeleteMainIndex:!0});else{var u=h.OverlayIndex[0];this.DeleteOverlayIndex(u.Identify,o),this.WindowIndex[o]=this.CreateMainScript(u.Script);var f=this.GetMainData();this.BindIndexData(o,f)}},this.GetMainData=function(){switch(this.ClassName){case"MinuteChartContainer":case"MinuteChartHScreenContainer":return this.SourceData;case"KLineChartContainer":case"KLineChartHScreenContainer":return this.ChartPaint[0].Data}},this.CreateOverlayFrame=function(){switch(this.ClassName){case"KLineChartContainer":return new Fd;case"KLineChartHScreenContainer":return new Md;case"MinuteChartContainer":return new hh;case"MinuteChartHScreenContainer":return new lh}},this.ExportData=function(s){if(!this.ExportMainData||!this.ChartPaint[0])return null;var o=this.GetMainData();if(!o||!v.IsNonEmptyArray(o.Data))return null;var l=null,h=o.Data;s.Start&&s.End&&(l=o.GetDataRange(s.Start,s.End));var u=this.ExportMainData(o,l);if(!u)return null;for(var f=1;f<this.ChartPaint.length;++f){var C=this.ChartPaint[f];if(!(!C||!C.ExportData)){var D=C.ExportData(h,l);if(D&&v.IsNonEmptyArray(D))for(var c=0;c<D.length;++c){var T=D[c];C.IndexName?u.push({Name:T.Name+"("+C.IndexName+")",Data:T.Data}):u.push(T)}}}for(var f=0;f<this.OverlayChartPaint.length;++f){var C=this.OverlayChartPaint[f];if(!(!C.Data||!v.IsNonEmptyArray(g.Data.Data))){var D=this.ExportMainData(C.Data,{IsOverlay:!0});if(D&&v.IsNonEmptyArray(D))for(var c=0;c<D.length;++c){var T=D[c];u.push({Name:T.Name+"("+C.Symbol+")",Data:T.Data})}}}for(var f=0,c=0,S=0;f<this.Frame.SubFrame.length;++f){var C=this.Frame.SubFrame[f];for(c=0;c<C.OverlayIndex.length;++c){var I=C.OverlayIndex[c];if(v.IsNonEmptyArray(I.ChartPaint))for(S=0;S<I.ChartPaint.length;++S){var g=I.ChartPaint[S];if(!(!g||!g.ExportData)){var D=g.ExportData(h,l);if(D&&v.IsNonEmptyArray(D))for(var E=0;E<D.length;++E){var T=D[E];g.IndexName?u.push({Name:T.Name+"("+g.IndexName+")",Data:T.Data}):u.push(T)}}}}}return s&&s.Type=="CSV"?this.ExportDataToCSV(u):u},this.ClearIndexRunCount=function(){for(var s=0;s<this.WindowIndex.length;++s){var o=this.WindowIndex[s];o&&(o.RunCount=0)}for(var s=0;s<this.Frame.SubFrame.length;++s)for(var o=this.Frame.SubFrame[s],l=0;l<o.OverlayIndex.length;++l){var h=o.OverlayIndex[l];h.Script&&(h.Script.RunCount=0)}},this.GetIndexInfo=function(){for(var s=[],o=0,l=0;o<this.WindowIndex.length;++o){var h=this.WindowIndex[o];if(h){var u={Name:h.Name,WindowIndex:o,IsOverlay:!1};if(h.ID&&(u.ID=h.ID),v.IsNonEmptyArray(h.Arguments))for(u.Args=[],l=0;l<h.Arguments.length;++l){var f=h.Arguments[l];u.Args.push({Name:f.Name,Value:f.Value})}s.push(u)}}return this.GetOverlayIndexInfo(s),s},this.GetOverlayIndexInfo=function(s){for(var o=0,l=0,h=0;o<this.Frame.SubFrame.length;++o){var u=this.Frame.SubFrame[o];if(v.IsNonEmptyArray(u.OverlayIndex))for(l=0;l<u.OverlayIndex.length;++l){var f=u.OverlayIndex[l];if(f.Script){var C=f.Script,D={Name:C.Name,ID:C.ID,WindowIndex:o,IsOverlay:!0,Identify:f.Identify};if(v.IsNonEmptyArray(C.Arguments))for(D.Args=[],h=0;h<C.Arguments.length;++h){var c=C.Arguments[h];D.Args.push({Name:c.Name,Value:c.Value})}s.push(D)}}}},this.PopupMenuByTab=function(s,o){if(this.JSPopMenu){var l=B(),h={Left:o.Left/l,Right:o.Right/l,Bottom:o.Bottom/l,Top:o.Top/l};h.Width=h.Right-h.Left,h.Height=h.Bottom-h.Top;var u=this.UIElement.getBoundingClientRect(),f=Da(),C=u.left+f.Left,D=u.top+f.Top;h.Left+=C,h.Right+=C,h.Top+=D,h.Bottom+=D,this.JSPopMenu.CreatePopMenu(s),this.JSPopMenu.PopupMenuByTab(h)}},this.PopupMenuByDrapdown=function(s,o){if(this.JSPopMenu){var l=B(),h={Left:o.Left/l,Right:o.Right/l,Bottom:o.Bottom/l,Top:o.Top/l};h.Width=h.Right-h.Left,h.Height=h.Bottom-h.Top;var u=this.UIElement.getBoundingClientRect(),f=Da(),C=u.left+f.Left,D=u.top+f.Top;h.Left+=C,h.Right+=C,h.Top+=D,h.Bottom+=D,this.JSPopMenu.CreatePopMenu(s),this.JSPopMenu.PopupMenuByDrapdown(h)}},this.PopupMenuByRClick=function(s,o,l){if(this.JSPopMenu){var h=this.UIElement.getBoundingClientRect(),u=Da();o+=h.left+u.Left,l+=h.top+u.Top,this.JSPopMenu.CreatePopMenu(s),this.JSPopMenu.PopupMenuByRight(o,l)}},this.ExecuteMenuCommand=function(s,o){k.Chart.Log("[JSChartContainer::ExecuteMenuCommand] cmdID=, aryArgs=",s,o);var l=null,h=null;switch(v.IsNonEmptyArray(o)&&(h=o[0],v.IsNumber(o[0])&&(l=o[0])),s){case q.CMD_CHANGE_PERIOD_ID:this.ChangePeriod&&l!=null&&this.ChangePeriod(l);break;case q.CMD_CHANGE_WINDOW_COUNT_ID:this.ChangeIndexWindowCount&&l!=null&&this.ChangeIndexWindowCount(l);break;case q.CMD_CHANGE_RIGHT_ID:this.ChangeRight&&l!=null&&this.ChangeRight(l);break;case q.CMD_CHANGE_INDEX_ID:this.ChangeIndex&&l!=null&&o[1]&&this.ChangeIndex(l,o[1]);break;case q.CMD_CHANGE_API_INDEX_ID:this.ChangeAPIIndex&&l!=null&&o[1]&&this.ChangeAPIIndex(l,o[1]);break;case q.CMD_CHANGE_SCRIPT_INDEX_ID:this.ChangeScriptIndex&&l!=null&&o[1]&&this.ChangeScriptIndex(l,o[1],o[2]);break;case q.CMD_CHANGE_COLOR_INDEX_ID:case q.CMD_CHANGE_TRADE_INDEX_ID:this.ChangeInstructionIndex&&o[0]&&this.ChangeInstructionIndex(o[0]);break;case q.CMD_DELETE_COLOR_INDEX_ID:case q.CMD_DELETE_TRADE_INDEX_ID:this.CancelInstructionIndex&&this.CancelInstructionIndex();break;case q.CMD_CHANGE_KLINE_TYPE_ID:this.ChangeKLineDrawType&&l!=null&&this.ChangeKLineDrawType(l,o[1],o[2]);break;case q.CMD_CHANGE_PRICE_GAP_ID:this.ChangePriceGap&&v.IsBool(o[0])&&(o[0]==!1?this.ChangePriceGap({Enable:o[0]}):v.IsNumber(o[1])&&this.ChangePriceGap({Enable:o[0],Count:o[1]}));break;case q.CMD_OVERLAY_SYMBOL_ID:o[1]===!0?this.OverlaySymbol&&o[0]&&this.OverlaySymbol(o[0]):o[1]===!1&&this.DeleteOverlaySymbol&&o[0]&&this.DeleteOverlaySymbol(o[0]);break;case q.CMD_DELETE_ALL_OVERLAY_SYMBOL_ID:this.ClearOverlaySymbol&&this.ClearOverlaySymbol();break;case q.CMD_CHANGE_COORDINATETYPE_ID:this.ChangeCoordinateType&&o[0]&&this.ChangeCoordinateType(o[0]);break;case q.CMD_CHANGE_KLINE_INFO_ID:o[0]&&v.IsBool(o[1])&&(o[1]==!0&&this.AddKLineInfo?this.AddKLineInfo(o[0],!0):o[1]==!1&&this.DeleteKLineInfo&&this.DeleteKLineInfo(o[0]));break;case q.CMD_DELETE_ALL_KLINE_INFO_ID:this.ClearKLineInfo&&this.ClearKLineInfo();break;case q.CMD_CHANGE_DRAG_MODE_ID:l!=null&&(this.DragMode=l);break;case q.CMD_CHANGE_BG_SPLIT_ID:if(v.IsBool(h))if(h)this.CreateExtendChart("SessionBreaksPaint",{}),this.Draw();else{var S=this.GetExtendChartByClassName("SessionBreaksPaint");S&&(this.DeleteExtendChartByID(S.Chart.ID),this.Draw())}break;case q.CMD_SHOW_DRAWTOOL_ID:this.IsShowDrawToolDialog()||this.ShowDrawToolDialog();break;case q.CMD_SHOW_STOCKCHIP_ID:var u=this.GetStockChipChart();if(u)return;h&&(this.CreateExtendChart(h,o[1]),this.SetSizeChange(!0),this.Draw());break;case q.CMD_HIDE_STOCKCHIP_ID:this.DeleteStockChipChart&&this.DeleteStockChipChart();break;case q.CMD_CHIP_CHART_SETTING_ID:var u=this.GetStockChipChart();if(!u)return;l!=null&&(u.Chart.ShowType=l,this.SetSizeChange(!0),this.Draw());break;case q.CMD_ENABLE_SELECT_RECT_ID:v.IsBool(h)&&(this.EnableSelectRect=h);break;case q.CMD_CHANGE_DAY_COUNT_ID:this.ChangeDayCount&&l!=null&&this.ChangeDayCount(l);break;case q.CMD_SHOW_BEFORE_DATA_ID:this.ShowCallAuctionData&&v.IsBool(h)&&this.ShowCallAuctionData({Left:h,MultiDay:{Left:h}});break;case q.CMD_CHANGE_BASELINE_ID:this.ChangeBaselineType&&v.IsNumber(l)&&this.ChangeBaselineType(l);break;case q.CMD_SELECTED_ZOOM_ID:this.ShowSelectData&&h&&this.ShowSelectData(h);break;case q.CMD_SELECTED_SUMMARY_ID:this.DialogSelectRect&&h&&this.DrawSelectRectDialog(h);break;case q.CMD_SHOW_INDEX_ID:if(l==null||!v.IsNumber(o[1]))return!1;var f=l,T=o[1],D=this.WindowIndex[f];if(!D)return!1;T==1?D.IsShow=!1:T==2?D.IsShow=!0:D.IsShow=!D.IsShow,this.UpdateWindowIndex(f);break;case q.CMD_SHOW_OVERLAY_INDEX_ID:if(!h||!v.IsNumber(o[1]))return!1;var c=h,T=o[1],C=this.GetOverlayIndexByIdentify(c);if(!C||!C.OverlayItem||!C.OverlayItem.Script)return!1;var D=C.OverlayItem.Script;T==1?D.IsShow=!1:T==2?D.IsShow==!0:D.IsShow=!D.IsShow,this.UpdateOverlayIndex(c);break;case q.CMD_DELETE_OVERLAY_INDEX_ID:h&&this.DeleteOverlayWindowsIndex&&this.DeleteOverlayWindowsIndex(h);break;case q.CMD_SHOW_OVERLAY_Y_AXIS_ID:if(!h||!v.IsNumber(o[1])||!this.GetOverlayIndexByIdentify)return!1;var c=h,T=o[1],S=this.GetOverlayIndexByIdentify(c);if(!S||!S.OverlayItem)return!1;var I=S.OverlayItem.Frame;T==1?I.IsShow=!1:T==2?I.IsShow==!0:I.IsShow=!I.IsShow,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw();break;case q.CMD_ENABLE_OVERLAY_SHARE_Y_ID:if(!h||!v.IsNumber(o[1])||!this.GetOverlayIndexByIdentify)return!1;var c=h,T=o[1],S=this.GetOverlayIndexByIdentify(c);if(!S||!S.OverlayItem)return!1;var I=S.OverlayItem.Frame;T==1?I.IsShareY=!1:T==2?I.IsShareY==!0:I.IsShareY=!I.IsShareY,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw();break;case q.CMD_CHANGE_DEFAULTCURSOR_ID:if(!v.IsString(h))return;this.DefaultCursor=h,this.UIElement.style.cursor=this.DefaultCursor;break;case q.CMD_ADD_OVERLAY_INDEX_ID:if(l==null||!o[1])return!1;var g=o[1];g.WindowIndex=l,this.AddOverlayIndex(g);break;case q.CMD_CHANGE_LANGUAGE_ID:h&&this.SetLanguage(h);break;case q.CMD_CHANGE_DRAG_RECT_SHOW_MODE_ID:l!=null&&this.ChartDragSelectRect&&(this.ChartDragSelectRect.ShowMode=l);break;case q.CMD_SHOW_CORSS_LINE_ID:v.IsBool(h)&&this.ChartCorssCursor&&(this.ChartCorssCursor.IsShowCorss=h);break;case q.CMD_ENABLE_POP_MINUTE_CHART_ID:v.IsBool(h)&&(h?(this.DestroyPopMinuteChart(),this.InitalPopMinuteChart({PopMinuteChart:{Enable:!0}})):this.DestroyPopMinuteChart());break;case q.CMD_CHANGE_INFO_POSITION_ID:if(l==null)return!1;var E=this.ChartPaint[0];if(!E)return!1;E.InfoPosition=l,this.Draw();break;case q.CMD_DIALOG_TOOLTIP_ATTRIBUTE:if(!o[0])return!1;var F=o[0];if(!v.IsBool(F.Enable))return!1;F.Enable===!1?this.DestroyTooltipDialog():(this.DestroyTooltipDialog(),this.InitalTooltipDialog(F));break;case q.CMD_KLINE_TOOLTIP_ATTRIBUTE:if(!o[0])return!1;var F=o[0];v.IsBool(F.Enable)&&(this.KLineTooltipConfig.Enable=F.Enable),v.IsBool(F.EnableKeyDown)&&(this.KLineTooltipConfig.EnableKeyDown=F.EnableKeyDown);break;case q.CMD_MODIFY_INDEX_PARAM:if(l==null)return!1;var R={e:null,WindowIndex:l,Type:1};this.ShowModifyIndexParamDialog(R);break;case q.CMD_MODIFY_OVERLAY_INDEX_PARAM:if(l==null||!o[1])return!1;var R={e:null,WindowIndex:l,Type:2,Identify:o[1]};this.ShowModifyIndexParamDialog(R);break}},this.GetShowIndexMenuData=function(s,o){var l=this.WindowIndex[s];if(!l)return null;var h={Name:l.IsShow?"隐藏指标":"显示指标",Data:{ID:q.CMD_SHOW_INDEX_ID,Args:[s,0]}};return h},this.GetModifyIndexMenuData=function(s){var o={Name:"参数修改",Data:{ID:q.CMD_MODIFY_INDEX_PARAM,Args:[s]}};return o},this.GetShowOverlayIndexMenuData=function(s,o){var l=this.GetOverlayIndexByIdentify(s);if(!l||!l.OverlayItem||!l.OverlayItem.Script)return null;var h=l.OverlayItem.Script,u={Name:h.IsShow?"隐藏指标":"显示指标",Data:{ID:q.CMD_SHOW_OVERLAY_INDEX_ID,Args:[s,0]}};return u},this.GetModifyOverlayIndexMenuData=function(s){var o=this.GetOverlayIndexByIdentify(s);if(!o)return null;var l={Name:"参数修改",Data:{ID:q.CMD_MODIFY_OVERLAY_INDEX_PARAM,Args:[o.WindowIndex,s]}};return l},this.GetShowOverlayIndexYAxisMenuData=function(s,o){var l=this.GetOverlayIndexByIdentify(s);if(!l||!l.OverlayItem||!l.OverlayItem.Script)return null;var h=l.OverlayItem.Frame,u={Name:h.IsShow?"隐藏Y轴":"显示Y轴",Data:{ID:q.CMD_SHOW_OVERLAY_Y_AXIS_ID,Args:[s,0]}};return u},this.GetOverlayIndexShareYMenuData=function(s,o){var l=this.GetOverlayIndexByIdentify(s);if(!l||!l.OverlayItem||!l.OverlayItem.Script)return null;var h=l.OverlayItem.Frame,u={Name:"公用窗口Y轴",Data:{ID:q.CMD_ENABLE_OVERLAY_SHARE_Y_ID,Args:[s,0]},Checked:h.IsShareY};return u},this.OnClickRightMenu=function(s){if(k.Chart.Log("[JSChartContainer::OnClickRightMenu] ",s),!(!s||!s.Data)){var o=s.Data.ID,l=s.Data.Args,h=this.GetEventCallback($.ON_MENU_COMMAND);if(h&&h.Callback){var s={PreventDefault:!1,CommandID:o,Args:l,SrcData:s};if(h.Callback(h,s,this),s.PreventDefault)return}this.ExecuteMenuCommand(o,l)}},this.PopupRightMenuV2=function(s,o){var l=this;if(this.JSPopMenu){var h=s.X,u=s.Y,f=s.FrameID,C={Menu:this.GetRightMenuData(f),Position:Ne.POSITION_ID.RIGHT_MENU_ID};C.ClickCallback=function(T){l.OnClickRightMenu(T)};var D=this.GetEventCallback($.ON_CREATE_RIGHT_MENU);if(D&&D.Callback){var c={MenuData:C,FrameID:f};D.Callback(D,c,this)}this.PopupMenuByRClick(C,h,u)}},this.CreateChartPaintExtend=function(s,o){if(o<0)return!1;var l=this.Frame.SubFrame[o];if(!l||!l.Frame)return!1;var h=l.Frame;return s.Canvas=this.Canvas,s.ChartBorder=h.ChartBorder,s.ChartFrame=h,this.ChartPaintEx.push(s),!0},this.DeleteChartPaintExtend=function(s,o){if(s&&v.IsNonEmptyArray(this.ChartPaintEx)&&v.IsNumber(s.WindowIndex)){var l=s.WindowIndex;if(!this.Frame.SubFrame[l])return;var h=this.Frame.SubFrame[l].Frame;if(!h)return;for(var u=[],f=0,C=0;C<this.ChartPaintEx.length;++C){var D=this.ChartPaintEx[C],c=D.ChartFrame.Guid==h.Guid||D.ChartFrame==h;c?(++f,o===!0&&D&&D.OnDestroy&&D.OnDestroy()):u.push(D)}f>0&&(this.ChartPaintEx=u)}},this.ClearCurrnetDrawPicture=function(){this.CurrentChartDrawPicture=null},this.CreateDragSelectRect=function(s){var o=Br.Create("RectDragPaint",s);if(!o)return null;s&&s.Enable===!0&&(o.Enable=!0),o.ChartBorder=this.Frame.ChartBorder,o.ChartFrame=this.Frame,o.HQChart=this,o.SetOption(s),this.ChartDragSelectRect=o},this.ClearDragSelectRect=function(){this.ChartDragSelectRect&&this.ChartDragSelectRect.ClearPoint()},this.ShowDragSelectRect=function(s,o){this.ChartDragSelectRect&&(this.ChartDragSelectRect.SetFirstPoint(s.X,s.Y),this.ChartDragSelectRect.SetSecondPoint(o.X,o.Y),this.ChartDragSelectRect.Draw())},this.ChangeIndexWindow=function(s,o){if(k.Chart.Log("[KLineChartContainer::ChangeIndexWindow] windowIndex, option",s,o),s<0||s>=this.Frame.SubFrame.length||!o)return!1;var l=this.Frame.SubFrame[s];if(o.Delete){var h=o.Delete;h.Window===!0&&this.DeleteIndexPaint(s),h.Overlay===!0&&this.DeleteWindowsOverlayIndex(s)}var u=s+1;if(this.TitlePaint[u].Data=[],this.TitlePaint[u].Title=null,o.Window){this.DeleteIndexPaint(s);var h=o.Window;if(h.Script)this.WindowIndex[s]=new Ie(h.Name,h.Script,h.Args,h);else if(h.API){var f=h.API;this.WindowIndex[s]=new ga(f.Name,f.Script,f.Args,h)}else{var C=h.Index,D=$a.Get(C);if(D)this.WindowIndex[s]=D.Create(),this.CreateWindowIndex(s);else{var c=new Z,T=c.Get(C);T&&(Z.ModifyAttribute(T,h),this.WindowIndex[s]=new Ie(T.Name,T.Script,T.Args,T))}}this.SetSubFrameAttribute(l,h,o.Frame)}var S=[];if(v.IsNonEmptyArray(o.OverlayIndex)){this.DeleteWindowsOverlayIndex(s);for(var I=0;I<o.OverlayIndex.length;++I){var h=o.OverlayIndex[I];h.Index&&(h.IndexName=h.Index),h.WindowIndex=s,h.Windows>=0&&(h.WindowIndex=h.Windows);var g=this.CreateOverlayWindowsIndex(h);g&&S.push({WindowsIndex:h.WindowIndex,Overlay:g})}}var E=this.ChartPaint[0].Data;this.BindIndexData(s,E);for(var I=0;I<S.length;++I){var h=S[I];this.BindOverlayIndexData(h.Overlay,h.WindowsIndex,E)}this.UpdataDataoffset(),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()},this.ClickHorizontalLabel=function(s,o){var l=this.GetEventCallback($.ON_CLICK_HORIZONTAL_LABEL);if(l&&l.Callback){var h={Info:s,PreventDefault:!1};if(l.Callback(l,h,this),h.PreventDefault)return}},this.ResetOverlaySymbolStatus=function(){for(var s=0;s<this.OverlayChartPaint.length;++s){var o=this.OverlayChartPaint[s];o.Status=Le.STATUS_NONE_ID}},this.OnChangeCorssCursorStatus=function(s,o){s.Type==1&&(s.IsShowCorss||(this.HideTooltip(),this.CloseTooltipDialog()))},this.UpdateWindowIndexV2=function(s){if(!v.IsNonEmptyArray(s))return!1;for(var o=[],l=0;l<this.WindowIndex.length;++l){var h=this.WindowIndex[l];h&&h.ID&&s.find(function(D){return D.ID==h.ID})&&o.push(l)}if(!v.IsNonEmptyArray(o))return!1;if(this.IsKLineContainer()){var u=new Y;if(u.Data=this.SourceData.Data,u.Period=this.Period,u.Right=this.Right,!this.IsApiPeriod){if(u.Right>0){var f=u.GetRightData(u.Right,{AlgorithmType:this.RightFormula});u.Data=f}if(Y.IsDayPeriod(u.Period,!1)||Y.IsMinutePeriod(u.Period,!1)){var C=u.GetPeriodData(u.Period);u.Data=C}}}else if(this.IsMinuteContainer())var u=this.SourceData;else return;for(var l=0;l<o.length;++l)this.BindIndexData(o[l],u);this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}}function B(){return typeof window>"u"?1:window.devicePixelRatio||1}function Ea(e,a,r){if(!e)return null;a&&(e.font=a);var t="擎";v.IsString(r)&&(t=r);var n=e.measureText(t),s=n.fontBoundingBoxAscent+n.fontBoundingBoxDescent;return v.IsNumber(s)||(s=n.width+2*B()),s}function NC(e){this.JSChartContainer&&this.JSChartContainer.OnKeyDown&&this.JSChartContainer.OnKeyDown(e)}function gd(e,a){var r=1;if(isNaN(e))return e;e<0&&(r=-1);var t=Math.pow(10,a),n=Math.round(Math.abs(e)*t)/t*r;if(/^(\d+(?:\.\d+)?)(e)([\-]?\d+)$/.test(n))var s=n.toFixed2(a);else var s=n.toString();var o=s.indexOf(".");for(o<0&&a>0&&(o=s.length,s+=".");s.length<=o+a;)s+="0";return s}Number.prototype.toFixed2=Number.prototype.toFixed;Number.prototype.toFixed=function(e){return gd(this,e)};function Re(){function e(){return((1+Math.random())*65536|0).toString(16).substring(1)}return"guid"+(e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e())}function Da(){var e={},a=0,r=0;return document.documentElement&&(document.documentElement.scrollTop||document.documentElement.scrollLeft)?(a=document.documentElement.scrollTop,r=document.documentElement.scrollLeft):document.body&&(a=document.body.scrollTop,r=document.body.scrollLeft),e.Top=a,e.Left=r,e}function L(e){return parseInt(e)+.5}function $t(e,a){var r=e%2===0?Math.floor(a):Math.floor(a)+.5;return r}function b(e){return .5+e<<0}function pd(e,a,r){return e>=r.Left&&e<=r.Right&&a>=r.Top&&a<=r.Bottom}function At(e){if(!e)return null;var a=(0,Aa.default)(e),r=JSON.parse(a);return r}function wa(e,a){!a||!e||(v.IsNumber(a.Left)&&(e.Left=a.Left),v.IsNumber(a.Top)&&(e.Top=a.Top),v.IsNumber(a.Right)&&(e.Right=a.Right),v.IsNumber(a.Bottom)&&(e.Bottom=a.Bottom))}function nn(){}nn.LT=function(e,a){return v.IsNumberV2(e,a)&&Math.abs(e-a)<1e-7?!1:e<a};nn.GT=function(e,a){return v.IsNumberV2(e,a)&&Math.abs(e-a)<1e-7?!1:e>a};function ft(){this.X,this.Y}function AC(){this.Data,this.JSChartContainer,this.Start,this.End,this.XStart,this.YStart,this.XEnd,this.YEnd}function Ut(){this.Value,this.Message=[],this.TextColor=d.FrameSplitTextColor,this.TextBGColor,this.TextColor2,this.Font=d.FrameSplitTextFont,this.LineColor=d.FrameSplitPen,this.LineDash=null,this.LineType=1,this.LineWidth,this.ExtendLine,this.ExtendData,this.AreaData}function ra(){this.UIElement,this.Left=50,this.Right=80,this.Top=50,this.Bottom=50,this.TitleHeight=24,this.TopSpace=0,this.BottomSpace=0,this.LeftExtendWidth=0,this.RightExtendWidth=0,this.MultiDayMinute={Count:1,Left:0,Right:0},this.IsShowTitleOnly=!1,this.GetBorder=function(){var e={Left:this.Left,LeftEx:this.Left+this.LeftExtendWidth,Right:this.UIElement.width-this.Right,RightEx:this.UIElement.width-this.Right-this.RightExtendWidth,Top:this.Top,TopEx:this.Top+this.TitleHeight+this.TopSpace,TopTitle:this.Top+this.TitleHeight,Bottom:this.UIElement.height-this.Bottom,BottomEx:this.UIElement.height-this.Bottom-this.BottomSpace,ChartWidth:this.UIElement.width,ChartHeight:this.UIElement.height};if(this.MultiDayMinute&&this.MultiDayMinute.Count>1&&(this.MultiDayMinute.Left>0||this.MultiDayMinute.Right>0)){for(var a=this.UIElement.width-this.Left-this.Right,r=a/this.MultiDayMinute.Count,t=[],n=0;n<this.MultiDayMinute.Count;++n){var s={Left:this.Left+r*n,Right:this.Left+r*(n+1)};s.LeftEx=s.Left+this.MultiDayMinute.Left,s.RightEx=s.Right-this.MultiDayMinute.Right,n>0&&(s.Left+=1),t.push(s)}e.DayBorder=t}return e},this.GetHScreenBorder=function(){var e={Left:this.Left,LeftEx:this.Left+this.BottomSpace,Right:this.UIElement.width-this.Right,RightEx:this.UIElement.width-this.Right-this.TitleHeight-this.TopSpace,RightTitle:this.UIElement.width-this.Right-this.TitleHeight,Top:this.Top,TopEx:this.Top+this.LeftExtendWidth,Bottom:this.UIElement.height-this.Bottom,BottomEx:this.UIElement.height-this.Bottom-this.RightExtendWidth,ChartWidth:this.UIElement.width,ChartHeight:this.UIElement.height};if(this.MultiDayMinute&&this.MultiDayMinute.Count>1&&(this.MultiDayMinute.Left>0||this.MultiDayMinute.Right>0)){for(var a=this.UIElement.height-this.Top-this.Bottom,r=a/this.MultiDayMinute.Count,t=[],n=0;n<this.MultiDayMinute.Count;++n){var s={Top:this.Top+r*n,Bottom:this.Top+r*(n+1)};s.TopEx=s.Top+this.MultiDayMinute.Left,s.BottomEx=s.Bottom-this.MultiDayMinute.Right,t.push(s)}e.DayBorder=t}return e},this.PtInClient=function(e,a,r,t){if(t){var n=this.GetHScreenBorder();r.rect(n.Left,n.TopEx,n.Right-n.Left,n.BottomEx-n.TopEx)}else{var n=this.GetBorder();if(n.DayBorder){for(var s=0;s<n.DayBorder.length;++s){var o=n.DayBorder[s];if(r.beginPath(),r.rect(o.LeftEx,n.TopEx,o.RightEx-o.LeftEx,n.BottomEx-n.TopEx),r.isPointInPath(e,a))return 1;if(r.beginPath(),r.rect(o.Left,n.TopEx,o.LeftEx-o.Left,n.BottomEx-n.TopEx),r.isPointInPath(e,a))return 200+parseInt(s);if(r.beginPath(),r.rect(o.RightEx,n.TopEx,o.Right-o.RightEx,n.BottomEx-n.TopEx),r.isPointInPath(e,a))return 300+parseInt(s)}return-1}r.rect(n.LeftEx,n.Top,n.RightEx-n.LeftEx,n.Bottom-n.Top)}return r.isPointInPath(e,a)?1:this.LeftExtendWidth>10&&(r.beginPath(),t===!0?r.rect(n.Left,n.Top,n.Right-n.Left,n.TopEx-n.Top):r.rect(n.Left,n.Top,n.LeftEx-n.Left,n.Bottom-n.Top),r.isPointInPath(e,a))?2:this.RightExtendWidth>10&&(r.beginPath(),t===!0?r.rect(n.Left,n.BottomEx,n.Right-n.Left,n.Bottom-n.BottomEx):r.rect(n.RightEx,n.Top,n.Right-n.RightEx,n.Bottom-n.Top),r.isPointInPath(e,a))?3:-1},this.GetChartWidth=function(){return this.UIElement.width},this.GetChartHeight=function(){return this.UIElement.height},this.GetLeft=function(){return this.Left+this.LeftExtendWidth},this.GetRight=function(){return this.UIElement.width-this.Right-this.RightExtendWidth},this.GetTop=function(){return this.Top},this.GetTopEx=function(){return this.Top+this.TitleHeight+this.TopSpace},this.GetTopTitle=function(){return this.Top+this.TitleHeight},this.GetBottom=function(){return this.UIElement.height-this.Bottom},this.GetBottomEx=function(){return this.UIElement.height-this.Bottom-this.BottomSpace},this.GetWidth=function(){return this.UIElement.width-this.Left-this.Right-this.LeftExtendWidth-this.RightExtendWidth},this.GetHeight=function(){return this.UIElement.height-this.Top-this.Bottom},this.GetHeightEx=function(){return this.UIElement.height-this.Top-this.Bottom-this.TitleHeight-this.TopSpace-this.BottomSpace},this.GetRightEx=function(){return this.UIElement.width-this.Right-this.TitleHeight-this.TopSpace},this.GetWidthEx=function(){return this.UIElement.width-this.Left-this.Right-this.TitleHeight-this.TopSpace-this.BottomSpace},this.GetLeftEx=function(){return this.Left+this.BottomSpace},this.GetRightTitle=function(){return this.UIElement.width-this.Right-this.TitleHeight},this.GetTitleHeight=function(){return this.TitleHeight}}function Ed(){this.DataMap=new Dt.default([["KLineFrame",{Create:function(a){return new us}}],["KLineHScreenFrame",{Create:function(a){return new Zh}}]]),this.Create=function(e,a){if(!this.DataMap.has(e))return k.Warn("[ChartFrameFactory::Create] can't find class="+e+"."),null;var r=this.DataMap.get(e);return r.Create(a)},this.Add=function(e,a){var r=null;return this.DataMap.has(e)&&(r=this.DataMap.get(e)),this.DataMap.set(e,{Create:a.Create}),r}}var on=new Ed;function xd(){this.HorizontalInfo=new Array,this.VerticalInfo=new Array,this.ClassName="IChartFramePainting",this.Canvas,this.Identify,this.Guid=Re(),this.ChartBorder,this.PenBorder=d.FrameBorderPen,this.TitleBGColor=d.FrameTitleBGColor,this.IsShow=!0,this.SizeChange=!0,this.XYSplit=!0,this.XSplit=!0,this.YCustomSplit=!0,this.HorizontalMax,this.HorizontalMin,this.HorizontalReserved=null,this.XPointCount=10,this.ClientBGColor,this.YMaxMin={Max:null,Min:null},this.YSplitOperator,this.XSplitOperator,this.Data,this.IsLocked=!1,this.LockPaint=null,this.YSpecificMaxMin=null,this.IsShowBorder=!0,this.IsShowTitleArrow=d.IndexTitle.EnableIndexArrow,this.TitleArrowType=d.IndexTitle.ArrowType,this.IsShowIndexName=!0,this.IsShowOverlayIndexName=!0,this.OverlayIndexType={Position:1,LineSpace:3},this.IndexParamSpace=2,this.IndexTitleSpace=0,this.IsShowIndexTitle=!0,this.IsDrawTitleBottomLine=!1,this.BorderLine=null,this.Buttons=[],this.LeftButtonWidth=0,this.IsMinSize=!1,this.LogoTextColor=d.FrameLogo.TextColor,this.LogoTextFont=d.FrameLogo.Font,this.LogoBGColor=d.FrameLogo.BGColor,this.GlobalOption,this.IsDrawRightBorder=!1,this.IsDrawLeftBorder=!1,this.HorizontalLabel,this.PtInButtons=function(e,a){for(var r=0;r<this.Buttons.length;++r){var t=this.Buttons[r];if(t.Rect){var n=t.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(n.Left,n.Top,n.Width,n.Height),this.Canvas.isPointInPath(e,a))return{ID:t.ID,Rect:n}}}return null},this.PtInHorizontalLabel=function(e,a){if(!v.IsNonEmptyArray(this.HorizontalLabel))return null;for(var r=0;r<this.HorizontalLabel.length;++r){var t=this.HorizontalLabel[r],n=t.Rect;if(pd(e,a,n))return{ID:t.ID,Rect:n,Item:t.Item,LineID:t.LineID}}},this.GetBorder=function(){return this.IsHScreen?this.ChartBorder.GetHScreenBorder():this.ChartBorder.GetBorder()},this.Draw=function(){this.Buttons=[],this.HorizontalLabel=[],this.DrawClientBG(),this.DrawFrame(),this.DrawBorder(),this.SizeChange=!1,this.XYSplit=!1,this.XSplit=!1,this.YCustomSplit=!1},this.DrawFrame=function(){},this.DrawClientBG=function(){if(this.ClientBGColor){var e=this.IsHScreen==!0?this.ChartBorder.GetHScreenBorder():this.ChartBorder.GetBorder(),a=L(e.Left),r=L(e.Top),t=L(e.Right),n=L(e.Bottom),s=t-a,o=n-r;this.Canvas.fillStyle=this.ClientBGColor,this.Canvas.fillRect(a,r,s,o)}},this.ClearCoordinateText=function(e){if(v.IsNonEmptyArray(this.HorizontalInfo))for(var a=0;a<this.HorizontalInfo.length;++a){var r=this.HorizontalInfo[a];r&&r.Message&&Array.isArray(r.Message)&&(r.Message[0]=r.Message[1]=null)}if(v.IsNonEmptyArray(this.VerticalInfo))for(var a=0;a<this.VerticalInfo.length;++a){var r=this.VerticalInfo[a];r&&r.Message&&Array.isArray(r.Message)&&(r.Message[0]=r.Message[1]=null)}},this.DrawBorder=function(){if(this.IsShowBorder&&!this.IsMinSize){var e=this.IsHScreen==!0?this.ChartBorder.GetHScreenBorder():this.ChartBorder.GetBorder(),a=L(e.Left),r=L(e.Top),t=L(e.Right),n=L(e.Bottom),s=t-a,o=n-r;if(this.BorderLine==null)if(this.IsDrawRightBorder||this.IsDrawLeftBorder){if(this.Canvas.strokeStyle=this.PenBorder,this.IsDrawRightBorder&&this.IsDrawLeftBorder){var l=L(e.ChartWidth),h=L(0);this.Canvas.strokeRect(h,r,l-h-1,o)}else if(this.IsDrawRightBorder){var l=L(e.ChartWidth);this.Canvas.strokeRect(a,r,l-a-1,o)}else if(this.IsDrawLeftBorder){var h=L(0);this.Canvas.strokeRect(h,r,t-h,o)}this.IsDrawRightBorder&&(this.Canvas.beginPath(),this.Canvas.moveTo(t,r),this.Canvas.lineTo(t,n),this.Canvas.stroke()),this.IsDrawLeftBorder&&(this.Canvas.beginPath(),this.Canvas.moveTo(a,r),this.Canvas.lineTo(a,n),this.Canvas.stroke())}else this.Canvas.strokeStyle=this.PenBorder,this.Canvas.strokeRect(a,r,s,o);else v.IsPlusNumber(this.BorderLine)&&(this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),(this.BorderLine&1)>0&&(this.Canvas.moveTo(a,r),this.Canvas.lineTo(t,r)),(this.BorderLine&2)>0&&(this.Canvas.moveTo(a,n),this.Canvas.lineTo(t,n)),(this.BorderLine&4)>0&&(this.Canvas.moveTo(a,r),this.Canvas.lineTo(a,n)),(this.BorderLine&8)>0&&(this.Canvas.moveTo(t,r),this.Canvas.lineTo(t,n)),this.Canvas.stroke())}},this.DrawTitleBG=function(){if(!(this.ChartBorder.TitleHeight<=0)){var e=this.GetBorder(),a=L(e.Left),r=L(e.Top),t=L(e.Right),n=L(this.ChartBorder.GetTopTitle()),s=t-a,o=n-r;this.Canvas.fillStyle=this.TitleBGColor,this.Canvas.fillRect(a,r,s,o),this.IsDrawTitleBottomLine&&(this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(a,L(e.TopTitle)),this.Canvas.lineTo(t,L(e.TopTitle)),this.Canvas.stroke())}},this.DrawLock=function(){this.IsLocked&&(this.LockPaint==null&&(this.LockPaint=new Vo),this.LockPaint.Canvas=this.Canvas,this.LockPaint.ChartBorder=this.ChartBorder,this.LockPaint.ChartFrame=this,this.LockPaint.Draw(!0))},this.DrawLogo=function(){var e=this.GetBorder(),a=d.FrameLogo.Text;if(v.IsString(a)){this.Canvas.font=this.LogoTextFont,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var r=this.Canvas.measureText("擎").width,t=this.Canvas.measureText(a).width;if(this.IsHScreen){var n=e.Left+5,s=e.Top+5;this.Canvas.save(),this.Canvas.translate(n,s),this.Canvas.rotate(90*Math.PI/180);var o={Left:0,Bottom:0,Width:t+4,Height:r+4};o.Top=o.Bottom-o.Height,o.Right=o.Left+o.Width,this.LogoBGColor&&(this.Canvas.fillStyle=this.LogoBGColor,this.Canvas.fillRect(o.Left,o.Top,o.Width,o.Height)),this.Canvas.fillStyle=this.LogoTextColor,this.Canvas.fillText(a,1,0),this.Canvas.restore()}else{var o={Left:e.Left+5,Bottom:e.Bottom-5,Width:t+4,Height:r+4};o.Top=o.Bottom-o.Height,o.Right=o.Left+o.Width,this.LogoBGColor&&(this.Canvas.fillStyle=this.LogoBGColor,this.Canvas.fillRect(o.Left,o.Top,o.Width,o.Height));var n=o.Left+1,s=o.Bottom-1;this.Canvas.fillStyle=this.LogoTextColor,this.Canvas.fillText(a,n,s)}}},this.CalculateLock=function(){this.IsLocked&&(this.LockPaint==null&&(this.LockPaint=new Vo),this.LockPaint.Canvas=this.Canvas,this.LockPaint.ChartBorder=this.ChartBorder,this.LockPaint.ChartFrame=this,this.LockPaint.Draw(!1))},this.SetLock=function(e){if(!e){this.IsLocked=!1;return}this.IsLocked=!0,this.LockPaint||(this.LockPaint=new Vo),e.Callback&&(this.LockPaint.Callback=e.Callback),e.IndexName&&(this.LockPaint.IndexName=e.IndexName),e.ID&&(this.LockPaint.LockID=e.ID),e.BG&&(this.LockPaint.BGColor=e.BG),e.Text&&(this.LockPaint.Title=e.Text),e.TextColor&&(this.LockPaint.TextColor=e.TextColor),e.Font&&(this.LockPaint.Font=e.Font),e.Count&&(this.LockPaint.LockCount=e.Count),e.MinWidth>0&&(this.LockPaint.MinWidth=e.MinWidth)},this.GetLockRect=function(){return!this.IsLocked||!this.LockPaint?null:this.LockPaint.LockRect},this.ReloadResource=function(e){e||(this.PenBorder=d.FrameBorderPen,this.TitleBGColor=d.FrameTitleBGColor);for(var a in this.HorizontalInfo){var r=this.HorizontalInfo[a];r.Font&&(r.Font=d.FrameSplitTextFont),r.TextColor&&(r.TextColor=d.FrameSplitTextColor),r.LineColor&&(r.LineColor=d.FrameSplitPen)}for(var a in this.VerticalInfo){var r=this.VerticalInfo[a];r.Font&&(r.Font=d.FrameSplitTextFont),r.TextColor&&(r.TextColor=d.FrameSplitTextColor),r.LineColor&&(r.LineColor=d.FrameSplitPen)}},this.GetFontHeight=function(e){return Ea(this.Canvas,e,"擎")},this.GetScaleTextWidth=function(){},this.IsMinuteFrame=function(e){var a=["MinuteFrame","MinuteHScreenFrame","OverlayMinuteFrame","OverlayMinuteHScreenFrame"];e===!1&&(a=["MinuteFrame","MinuteHScreenFrame"]);var r=a.includes(this.ClassName);return r},this.IsKLineFrame=function(e){var a=["KLineFrame","KLineHScreenFrame","KLineHScreenFrame","OverlayKLineHScreenFrame"];e===!1&&(a=["KLineFrame","KLineHScreenFrame"]);var r=a.includes(this.ClassName);return r}}function zh(){this.newMethod=xd,this.newMethod(),delete this.newMethod,this.ClassName="AverageWidthFrame",this.DataWidth=50*B(),this.DistanceWidth=10*B(),this.MinXDistance=30*B(),this.MinYDistance=12*B(),this.CoordinateType=0,this.IsShowYText=[!0,!0],this.XBottomOffset=d.Frame.XBottomOffset,this.YTextTopOffset=d.Frame.YTopOffset,this.YTextPosition=[0,0],this.YTextPadding=[d.Frame.YTextPadding[0],d.Frame.YTextPadding[1]],this.IsShowXLine=!0,this.IsShowYLine=!0,this.YInsideOffset=0,this.YTextBaseline=0,this.MultiTextFormat=0,this.RightTextMaxWidth=0,this.ShortYLineLength=5,this.ShortXLineLength=5,this.BeforeDrawXYCallback,this.GetEventCallback,this.ToolbarButtonStyle=d.ToolbarButtonStyle,this.CloseWindowButton=At(d.Buttons.CloseWindow),this.OverlayIndexButton=At(d.Buttons.OverlayIndex),this.ChangeIndexButton=At(d.Buttons.ChangeIndex),this.ModifyIndexParamButton=At(d.Buttons.ModifyIndexParam),this.MaxMinWindowButton=At(d.Buttons.MaxMinWindow),this.TitleWindowButton=At(d.Buttons.TitleWindow),this.ExportDataButton=At(d.Buttons.ExportData),this.ButtonTooltip=At(d.Buttons.Tooltip),this.YLineExtend,this.YTextExtend,this.YRightTextInfo,this.XTextExtend,this.XLineExtend,this.FrameData={SubFrameItem:null},this.DrawPicture={BGColor:d.DrawPicture.XYCoordinate.BGColor,TextBGColor:d.DrawPicture.XYCoordinate.TextBGColor,TextColor:d.DrawPicture.XYCoordinate.TextColor,Font:d.DrawPicture.XYCoordinate.Font},this.IChartFramePainting_ReloadResource=this.ReloadResource,this.ReloadResource=function(e){this.IChartFramePainting_ReloadResource(e),e||(this.ToolbarButtonStyle=d.ToolbarButtonStyle,this.CloseWindowButton=At(d.Buttons.CloseWindow),this.OverlayIndexButton=At(d.Buttons.OverlayIndex),this.ChangeIndexButton=At(d.Buttons.ChangeIndex),this.ModifyIndexParamButton=At(d.Buttons.ModifyIndexParam),this.MaxMinWindowButton=At(d.Buttons.MaxMinWindow),this.TitleWindowButton=At(d.Buttons.TitleWindow),this.ButtonTooltip=At(d.Buttons.Tooltip))},this.DrawFrame=function(){if(this.XPointCount>0){var e=this.ChartBorder.GetWidth()/(6*this.XPointCount);this.DistanceWidth=2*e,this.DataWidth=4*e}this.DrawHorizontal(),this.DrawVertical()},this.DrawTitleButton=function(e,a,r){var t=this.GetBorder();if(this.IsHScreen){var n=t.Bottom-3,s=t.RightTitle+this.ChartBorder.TitleHeight/2;this.Canvas.save(),this.Canvas.translate(s,n),this.Canvas.rotate(90*Math.PI/180);for(var o=0,l=0,h=0,u=0;u<e.length;++u){var f=e[u],C=f.Style.Size,l=h-C-f.Style.MerginLeft,D=C+"px "+f.Style.Family,c=f.Style.Color;this.Canvas.fillStyle=c,this.Canvas.font=D,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(f.Style.Text,l,0);var T={Left:s-C/2,Right:s+C/2,Bottom:n,Width:C,Height:C+f.Style.MerginLeft};T.Top=T.Bottom-C-f.Style.MerginLeft,this.Buttons.push({ID:f.ID,Rect:T}),h=l,n=T.Top}this.Canvas.restore()}else{var S=t.Right-3;t.Left;for(var o=t.Top+this.ChartBorder.TitleHeight/2,u=0;u<e.length;++u){var f=e[u],C=f.Style.Size,I=S-C-f.Style.MerginLeft,D=C+"px "+f.Style.Family,T={Left:I,Top:o-C/2,Right:I+C+f.Style.MerginLeft,Bottom:o+C/2,Width:C+f.Style.MerginLeft,Height:C},c=f.Style.Color;a&&a.X>=T.Left&&a.X<T.Right&&a.Y>=T.Top&&a.Y<=T.Bottom&&(c=f.Style.MoveOnColor,r&&(r.MouseOnToolbar={Rect:T,Item:f,Frame:this,Point:{X:a.X,Y:a.Y}})),this.Canvas.fillStyle=c,this.Canvas.font=D,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(f.Style.Text,I,o),this.Buttons.push({ID:f.ID,Rect:T}),S=I}}},this.DrawToolbarTooltip=function(e){if(e){var a=this.GetBorder(),r=null;if(e.Item.TooltipText)r=e.Item.TooltipText;else{var t="Toolbar-"+e.Item.ID;r=St.GetText(t,0)}if(r){var n=this.Canvas;if(this.GetExtraCanvas){var s=this.GetExtraCanvas(Ht.TooltipCursorCanvasKey);s&&(n=s.Canvas)}var o=e.Rect.Left+e.Rect.Width/2;n.font=this.ButtonTooltip.Font,n.textAlign="left",n.textBaseline="bottom";var l=this.ButtonTooltip.Mergin,h=n.measureText(r).width+l.Left+l.Right,u=this.GetFontHeight(),f=u+l.Top+l.Bottom;if(e.ID=="TitleButton")var C=e.Point.X,D=e.Point.Y+20;else if(Rt.CLOSE_BEFOREOPEN_ID==e.Item.ID)var C=e.Rect.Right+5,D=e.Rect.Top;else if(Rt.DRAW_PICTURE_DELETE==e.Item.ID||Rt.DRAW_PICTURE_SETTING==e.Item.ID||e.Item.ID>=Rt.DRAW_PICTURE_BUTTON_1&&e.Item.ID<=Rt.DRAW_PICTURE_BUTTON_18){var C=e.Point.X,D=e.Point.Y+20;C+h>=a.ChartWidth&&(C=a.ChartWidth-h-2)}else{var C=o-h/2,D=a.Top-f;D<0&&(D=a.TopEx+1),C+h>a.ChartWidth&&(C=a.ChartWidth-h-2)}if(v.IsNumber(this.ButtonTooltip.BorderRadius)){var c=this.ButtonTooltip.BorderRadius;n.beginPath(),n.roundRect(L(C),L(D),b(h),b(f),[c]),n.closePath(),n.fillStyle=this.ButtonTooltip.ColorBG,n.fill(),n.strokeStyle=this.ButtonTooltip.ColorBorder,n.stroke(),n.fillStyle=this.ButtonTooltip.Color,n.fillText(r,C+l.Left,D+f-l.Bottom)}else n.fillStyle=this.ButtonTooltip.ColorBG,n.fillRect(C,D,h,f),n.fillStyle=this.ButtonTooltip.Color,n.fillText(r,C+l.Left,D+f-l.Bottom)}}},this.GetYFromData=function(e,a){if(this.Logarithmic&&this.GetYLogarithmicFromData)return this.GetYLogarithmicFromData(e,a);if(a===!1)if(this.CoordinateType==1){var r=this.ChartBorder.GetHeightEx()*(e-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetTopEx()+r}else{var r=this.ChartBorder.GetHeightEx()*(e-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetBottomEx()-r}else if(this.CoordinateType==1){if(e<=this.HorizontalMin)return this.ChartBorder.GetTopEx();if(e>=this.HorizontalMax)return this.ChartBorder.GetBottomEx();var r=this.ChartBorder.GetHeightEx()*(e-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetTopEx()+r}else{if(e<=this.HorizontalMin)return this.ChartBorder.GetBottomEx();if(e>=this.HorizontalMax)return this.ChartBorder.GetTopEx();var r=this.ChartBorder.GetHeightEx()*(e-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetBottomEx()-r}},this.IsShowRightHorizontal=function(){var e=this.ChartBorder.Right;if(e<=10||this.YTextPosition[1]==2||this.IsShowYText[1]===!1)return!1;if(this.GlobalOption&&this.GlobalOption.RightHorizontal){var a=this.GlobalOption.RightHorizontal;if(a.Show===!1)return!1}return!0},this.DrawHorizontal=function(){if(this.RightTextMaxWidth=0,!!v.IsNonEmptyArray(this.HorizontalInfo)&&!this.ChartBorder.IsShowTitleOnly){var e=this.ChartBorder.GetBorder(),a=e.Left,r=e.Right,t=e.Bottom,n=this.ChartBorder.GetTop();this.ChartBorder.Right;var s=this.ChartBorder.Left,o=s>10&&this.IsShowYText[0]===!0&&this.YTextPosition[0]!=2,l=this.IsShowRightHorizontal(),h=null,u=null;v.IsNonEmptyArray(this.YLineExtend)&&(h=this.YLineExtend[1],u=this.YLineExtend[0]);var f=null,C=null;v.IsNonEmptyArray(this.YTextExtend)&&(C=this.YTextExtend[0],f=this.YTextExtend[1]);for(var D=null,c=B(),T=(e.BottomEx-e.TopEx)/this.HorizontalInfo.length,S=[],I,g,E,F,R=0,A=this.HorizontalInfo.length-1;A>=0;--A){var P=this.HorizontalInfo[A];if(v.IsNumber(P.Value)&&!(nn.GT(P.Value,this.HorizontalMax)||nn.LT(P.Value,this.HorizontalMin))){var p=this.GetYFromData(P.Value);if(!(p!=null&&D!=null&&Math.abs(p-D)<this.MinYDistance)){var w=L(p);if(p!=t&&this.IsShowYLine){var H=!1;v.IsPlusNumber(P.LineWidth)&&(this.Canvas.lineWidth=P.LineWidth*c,H=!0),this.Canvas.strokeStyle=P.LineColor,P.LineType==2?(this.Canvas.save(),P.LineDash?this.Canvas.setLineDash(P.LineDash):this.Canvas.setLineDash([5*c,5*c]),this.Canvas.beginPath(),this.Canvas.moveTo(a,w),this.Canvas.lineTo(r,w),this.Canvas.stroke(),this.Canvas.setLineDash([]),this.Canvas.restore()):P.LineType==3||P.LineType==8||P.LineType==9||P.LineType>0&&(d.FrameYLineDash?(this.Canvas.save(),this.Canvas.setLineDash(d.FrameYLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(a,w),this.Canvas.lineTo(r,w),this.Canvas.stroke(),this.Canvas.setLineDash([]),this.Canvas.restore()):(this.Canvas.beginPath(),this.Canvas.moveTo(a,w),this.Canvas.lineTo(r,w),this.Canvas.stroke())),H&&(this.Canvas.lineWidth=c)}var W=p;if(p>=t-2?(this.Canvas.textBaseline="bottom",R=2):p<=n+2?(this.Canvas.textBaseline="top",W+=this.YTextTopOffset,R=0):(this.Canvas.textBaseline="middle",R=1),this.Canvas.strokeStyle=P.TextColor,this.Canvas.fillStyle=P.TextColor,P.Message[0]!=null&&o){var ht=0;if(v.IsNonEmptyArray(P.YOffset)){var rt=P.YOffset[0];rt&&v.IsNumber(rt.Offset)&&(ht=rt.Offset)}if(Array.isArray(P.Message[0])){if(this.MultiTextFormat==3){var nt={Data:P.Message[0],X:a,Y:W,TextBaseLine:R,IsLeft:!0,Item:P,TextPadding:this.YTextPadding[0]};this.DrawMultiLineText(nt)}}else{P.Font!=null&&(this.Canvas.font=P.Font);var vt=a;if(u&&u.Width>1){var Nt=u.Width;u.Color?this.Canvas.strokeStyle=u.Color:this.Canvas.strokeStyle=P.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(vt,w),this.Canvas.lineTo(vt-Nt,w),this.Canvas.stroke(),vt-=Nt}E=this.GetTextTopBottom(R,W),(!F||E&&!this.IsTextTopBottomOverlap(E,F))&&(C&&C.Align===1?(this.Canvas.textAlign="left",this.Canvas.fillText(P.Message[0],this.YTextPadding[0],W+ht)):(this.Canvas.textAlign="right",this.Canvas.fillText(P.Message[0],vt-this.YTextPadding[0],W+ht),F=E))}}if(P.Message[1]!=null&&l){var ht=0;if(v.IsNonEmptyArray(P.YOffset)){var rt=P.YOffset[1];rt&&v.IsNumber(rt.Offset)&&(ht=rt.Offset)}P.Font!=null&&(this.Canvas.font=P.Font);var vt=r;if(P.LineType==3){var Nt=this.ShortYLineLength*B();this.Canvas.beginPath(),this.Canvas.moveTo(vt,w),this.Canvas.lineTo(vt+Nt,w),this.Canvas.stroke(),vt+=Nt}if(h&&h.Width>1){var Nt=h.Width;h.Color?this.Canvas.strokeStyle=h.Color:this.Canvas.strokeStyle=P.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(vt,w),this.Canvas.lineTo(vt+Nt,w),this.Canvas.stroke(),vt+=Nt+2}if(this.Canvas.textAlign="left",Array.isArray(P.Message[1]))if(this.MultiTextFormat==1){P.ExtendData&&P.ExtendData.Font&&(this.Canvas.font=P.ExtendData.Font);var Ft={Text:[{Text:P.Message[1][0],Width:this.Canvas.measureText(P.Message[1][0]).width},{Text:P.Message[1][1],Width:this.Canvas.measureText(P.Message[1][1]).width}],X:vt+2,Y:W,TextBaseline:this.Canvas.textBaseline,Item:P};S.push(Ft)}else if(this.MultiTextFormat==2){this.Canvas.fillText(P.Message[1][0],vt+this.YTextPadding[1],W);var Bt=this.Canvas.measureText("M").width;T>Bt*2&&this.Canvas.fillText(P.Message[1][1],vt+this.YTextPadding[1],W+Bt)}else if(this.MultiTextFormat==3){var nt={Data:P.Message[1],X:vt,Y:W,TextBaseLine:R,IsLeft:!1,Item:P,TextPadding:this.YTextPadding[1]};this.DrawMultiLineText(nt)}else{var Jt=P.Message[1][0];if(P.TextColor2&&(this.Canvas.fillStyle=P.TextColor2),f&&f.Align===2&&this.YRightTextInfo){this.Canvas.textAlign="right";var te=this.YRightTextInfo.MainTextWidth+r-this.YTextPadding[1];this.Canvas.fillText(Jt,te,W)}else this.Canvas.fillText(Jt,vt+this.YTextPadding[1],W)}else if(g=this.GetTextTopBottom(R,W),!I||g&&!this.IsTextTopBottomOverlap(g,I)){if(P.TextColor2&&(this.Canvas.fillStyle=P.TextColor2),f&&f.Align===2&&this.YRightTextInfo){this.Canvas.textAlign="right";var te=this.YRightTextInfo.MainTextWidth+r-this.YTextPadding[1];this.Canvas.fillText(P.Message[1],te,W+ht)}else this.Canvas.fillText(P.Message[1],vt+this.YTextPadding[1],W+ht);I=g}}D=p}}}if(v.IsNonEmptyArray(S)&&this.MultiTextFormat==1&&this.DrawHorizontalMuText(S),l&&this.IsDrawRightBorder&&this.YRightTextInfo){var te=this.YRightTextInfo.MainTextWidth+r;if(xLine=L(te),this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(xLine,n),this.Canvas.lineTo(xLine,t),this.Canvas.stroke(),v.IsNonEmptyArray(this.YRightTextInfo.AryOverlayWidth)){this.Canvas.beginPath();for(var A=0;A<this.YRightTextInfo.AryOverlayWidth.length;++A){var Me=this.YRightTextInfo.AryOverlayWidth[A];te+=Me,xLine=L(te),this.Canvas.moveTo(xLine,n),this.Canvas.lineTo(xLine,t)}this.Canvas.stroke()}}}},this.DrawMultiLineText=function(e){var a=2,r=this.Canvas.measureText("擎").width,t=e.Data.length,n=r*t+a*(t-1),s=e.Y;if(e.Item.Font!=null&&(this.Canvas.font=e.Item.Font),e.IsLeft){this.Canvas.textAlign="right";var o=e.X-e.TextPadding}else{this.Canvas.textAlign="left";var o=e.X+e.TextPadding}var l=this.Canvas.textBaseline;this.Canvas.textBaseline="top",e.TextBaseLine==1?s-=n/2:e.TextBaseLine==0||e.TextBaseLine==2&&(s-=n);for(var h=0;h<e.Data.length;++h){var u=e.Data[h],f=u.Text,C=null;u.Color&&(C=this.Canvas.fillStyle,this.Canvas.fillStyle=u.Color),this.Canvas.fillText(f,o,s),s+=r+a,C&&(this.Canvas.fillStyle=C)}this.Canvas.textBaseline=l},this.IsTextTopBottomOverlap=function(e,a){return a.Top>=e.Top&&a.Top<=e.Bottom||a.Bottom>=e.Top&&a.Bottom<=e.Bottom},this.GetTextTopBottom=function(e,a){var r=null,t=this.Canvas.measureText("擎").width;return e==0?r={Top:a,Bottom:a+t}:e==1?(r={Top:a-t/2},r.Bottom=r.Top+t):e==2&&(r={Bottom:a},r.Top=r.Bottom-t),r},this.DrawHorizontalMuText=function(e){for(var a=[null,null],r=0;r<e.length;++r){var t=e[r],n=t.Text[0].Width;v.IsNumber(a[0])?a[0]<n&&(a[0]=n):a[0]=n,n=t.Text[1].Width,v.IsNumber(a[1])?a[1]<n&&(a[1]=n):a[1]=n}for(var r=0;r<e.length;++r){var t=e[r],s=t.Item;this.Canvas.textBaseline=s.TextBaseline,s.ExtendData&&s.ExtendData.Font?this.Canvas.font=s.ExtendData.Font:s.Font&&(this.Canvas.font=s.Font),s.ExtendData&&s.ExtendData.PriceColor?this.Canvas.fillStyle=s.ExtendData.PriceColor:this.Canvas.fillStyle=s.TextColor,this.Canvas.textAlign="right";var l=t.X+a[1];this.Canvas.fillText(t.Text[1].Text,l,t.Y),s.ExtendData&&s.ExtendData.SplitColor?this.Canvas.fillStyle=s.ExtendData.SplitColor:this.Canvas.fillStyle=s.TextColor,this.Canvas.textAlign="left";var o=this.Canvas.measureText("/").width;this.Canvas.fillText("/",l,t.Y),s.ExtendData&&s.ExtendData.PercentageColor?this.Canvas.fillStyle=s.ExtendData.PercentageColor:this.Canvas.fillStyle=s.TextColor,this.Canvas.textAlign="right";var l=t.X+a[1]+a[0]+o;this.Canvas.fillText(t.Text[0].Text,l,t.Y);var h=a[1]+a[0]+o*4;this.RightTextMaxWidth<h&&(this.RightTextMaxWidth=h)}},this.DrawInsideClientHorizontal=function(){var e=this.GetBorder();if(e.DayBorder&&v.IsNonEmptyArray(e.DayBorder))var r=e.DayBorder[0],a=r.LeftEx,r=e.DayBorder[e.DayBorder.length-1],t=r.RightEx,n=e.Bottom,s=e.TopTitle;else var a=e.LeftEx,t=e.RightEx,n=e.Bottom,s=e.TopTitle;for(var o=B(),l=null,h=null,u=this.HorizontalInfo.length-1;u>=0;--u){var r=this.HorizontalInfo[u],f=this.GetYFromData(r.Value);if(!(f!=null&&l!=null&&Math.abs(f-l)<this.MinYDistance)){if(r.Message[2]){r.Font!=null&&(this.Canvas.font=r.Font),this.Canvas.fillStyle=r.TextColor,this.Canvas.textAlign="left";var C=f;f>=n-2?this.Canvas.textBaseline="bottom":f<=s+2?(this.Canvas.textBaseline="top",C+=this.YTextTopOffset):this.Canvas.textBaseline="middle";var D={X:a,Y:C,Text:{BaseLine:this.Canvas.textBaseline,TextAlign:this.Canvas.textAlign,Font:this.Canvas.font,Value:r.Message[0]}};(!this.IsOverlayMaxMin||!this.IsOverlayMaxMin(D))&&(this.Canvas.fillText(r.Message[2],a+1*o,C),(h==null||h>C)&&(this.YInsideOffset=this.Canvas.measureText(r.Message[2]).width+4*B(),h=C))}if(r.Message[3]){r.Font!=null&&(this.Canvas.font=r.Font),this.Canvas.fillStyle=r.TextColor,this.Canvas.textAlign="right";var C=f;f>=n-2?this.Canvas.textBaseline="bottom":f<=s+2?(this.Canvas.textBaseline="top",C+=this.YTextTopOffset):this.Canvas.textBaseline="middle";var c=this.Canvas.measureText(r.Message[3]).width,D={X:t-c,Y:C,Text:{BaseLine:this.Canvas.textBaseline,TextAlign:this.Canvas.textAlign,Font:this.Canvas.font,Value:r.Message[1]}};(!this.IsOverlayMaxMin||!this.IsOverlayMaxMin(D))&&this.Canvas.fillText(r.Message[3],t-1*o,C)}l=f}}},this.DrawInsideHorizontal=function(){if(this.IsHScreen!==!0&&!this.IsMinSize&&!this.ChartBorder.IsShowTitleOnly&&!(this.IsShowYText[0]===!1&&this.IsShowYText[1]===!1)){this.DrawInsideClientHorizontal();var e=this.ChartBorder.GetBorder(),a=e.Left,r=e.Right,t=e.Bottom,n=e.TopTitle,s=this.ChartBorder.Right,o=this.ChartBorder.Left;this.ChartBorder.TitleHeight;var l=(o<10||this.YTextPosition[0]==2)&&this.IsShowYText[0]===!0,h=(s<10||this.YTextPosition[1]==2)&&this.IsShowYText[1]===!0;if(l||h)for(var u=B(),f=null,C=null,D=this.HorizontalInfo.length-1;D>=0;--D){var c=this.HorizontalInfo[D],T=this.GetYFromData(c.Value);if(!(T!=null&&f!=null&&Math.abs(T-f)<this.MinYDistance)){if(c.Message[0]!=null&&l){c.Font!=null&&(this.Canvas.font=c.Font),this.Canvas.fillStyle=c.TextColor,this.Canvas.textAlign="left";var S=this.Canvas.measureText("擎").width,I=T;T>=t-2?this.Canvas.textBaseline="bottom":T-S/2<=n?(this.Canvas.textBaseline="top",I+=this.YTextTopOffset):this.YTextBaseline==1?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle";var g={X:a,Y:I,Text:{BaseLine:this.Canvas.textBaseline,TextAlign:this.Canvas.textAlign,Font:this.Canvas.font,Value:c.Message[0]}};(!this.IsOverlayMaxMin||!this.IsOverlayMaxMin(g))&&(this.Canvas.fillText(c.Message[0],a+1*u,I),(C==null||C>I)&&(this.YInsideOffset=this.Canvas.measureText(c.Message[0]).width+4*B(),C=I))}if(c.Message[1]!=null&&h){c.Font!=null&&(this.Canvas.font=c.Font),this.Canvas.fillStyle=c.TextColor,this.Canvas.textAlign="right";var S=this.Canvas.measureText("擎").width,I=T;if(T>=t-2?this.Canvas.textBaseline="bottom":T-S/2<=n?(this.Canvas.textBaseline="top",I+=this.YTextTopOffset):this.YTextBaseline==1?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",Array.isArray(c.Message[1]))var E=c.Message[1][0];else var E=c.Message[1];var F=this.Canvas.measureText(E).width,g={X:r-F,Y:I,Text:{BaseLine:this.Canvas.textBaseline,TextAlign:this.Canvas.textAlign,Font:this.Canvas.font,Value:c.Message[1]}};(!this.IsOverlayMaxMin||!this.IsOverlayMaxMin(g))&&this.Canvas.fillText(E,r-1*u,I)}f=T}}}},this.GetXFromIndex=function(e){var a=this.XPointCount;if(a==1)return e==0?this.ChartBorder.GetLeft():this.ChartBorder.GetRight();if(a<=0)return this.ChartBorder.GetLeft();if(e>=a)return this.ChartBorder.GetRight();var r=this.ChartBorder.GetLeft()+this.ChartBorder.GetWidth()*e/a;return r},this.DrawVertical=function(){var e=this.GetBorder(),a=e.TopTitle,r=e.Bottom,t=e.RightEx,n=B(),s=null;this.GetVerticalXCache&&(s=this.GetVerticalXCache());var o=null;this.XTextExtend&&(o=this.XTextExtend[0]);var l=null;this.XLineExtend&&(l=this.XLineExtend[0]);for(var h=null,u=null,f=0;f<this.VerticalInfo.length;++f){var D=this.VerticalInfo[f],C=null;if(s&&s.has(D.Value)?C=s.get(D.Value):C=this.GetXFromIndex(D.Value),C>t)break;if(!(h!=null&&Math.abs(C-h)<this.MinXDistance)){var D=this.VerticalInfo[f],c=L(C);if(this.IsShowXLine&&(D.LineType==2?(this.Canvas.strokeStyle=this.VerticalInfo[f].LineColor,D.LineDash?this.Canvas.setLineDash(D.LineDash):this.Canvas.setLineDash([5*n,5*n]),this.Canvas.beginPath(),this.Canvas.moveTo(c,a),this.Canvas.lineTo(c,r),this.Canvas.stroke(),this.Canvas.setLineDash([])):D.LineType==3||D.LineType>0&&(d.FrameXLineDash?(this.Canvas.strokeStyle=this.VerticalInfo[f].LineColor,this.Canvas.setLineDash(d.FrameXLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(c,a),this.Canvas.lineTo(c,r),this.Canvas.stroke(),this.Canvas.setLineDash([])):(this.Canvas.strokeStyle=this.VerticalInfo[f].LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(c,a),this.Canvas.lineTo(c,r),this.Canvas.stroke()))),D.BG&&this.DrawDayVertical&&this.DrawDayVertical(D,C,e),this.VerticalInfo[f].Message[0]!=null&&this.ChartBorder.Bottom>5*n){this.VerticalInfo[f].Font&&(this.Canvas.font=this.VerticalInfo[f].Font);var T=0;this.Canvas.strokeStyle=D.TextColor;var S=this.Canvas.measureText(this.VerticalInfo[f].Message[0]).width,I=this.Canvas.measureText("擎").width;if(o&&o.Align==1?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",T=C):C<S/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",T=C):C+S/2>=this.ChartBorder.GetChartWidth()?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top",T=C-S):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top",T=C-S/2),u==null||T>u){var g=r;if(D.LineType==3){var E=this.ShortXLineLength*n;this.Canvas.beginPath(),this.Canvas.moveTo(c,g),this.Canvas.lineTo(c,g+E),this.Canvas.stroke(),g+=E+2*n}if(l){if(l.Mode===1)D.Value>1&&(l.Color&&(this.Canvas.strokeStyle=l.Color),this.Canvas.beginPath(),this.Canvas.moveTo(c,r),this.Canvas.lineTo(c,e.ChartHeight),this.Canvas.stroke(),C+=1);else if(l.Mode===2&&l.Width>=1){var E=l.Width;l.Color&&(this.Canvas.strokeStyle=l.Color),this.Canvas.beginPath(),this.Canvas.moveTo(c,g),this.Canvas.lineTo(c,g+E),this.Canvas.stroke(),g+=E+2}}if(D.TextBGColor){var F={Left:T,Top:g+this.XBottomOffset,Width:S,Height:I};this.Canvas.fillStyle=D.TextBGColor,this.Canvas.fillRect(F.Left-1,F.Top,F.Width+2,F.Height)}this.Canvas.fillStyle=D.TextColor,this.Canvas.fillText(this.VerticalInfo[f].Message[0],C,g+this.XBottomOffset),u=T+S}}h=C}}},this.GetYData=function(e,a){return this.Logarithmic&&this.GetYLogarithmicFromData?this.GetYLogarithmicData(e):this.CoordinateType==1?a==!1?(e-this.ChartBorder.GetTopEx())/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin:e<this.ChartBorder.GetTopEx()?this.HorizontalMin:e>this.ChartBorder.GetBottomEx()?this.HorizontalMax:(e-this.ChartBorder.GetTopEx())/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin:a==!1?(this.ChartBorder.GetBottomEx()-e)/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin:e<this.ChartBorder.GetTopEx()?this.HorizontalMax:e>this.ChartBorder.GetBottomEx()?this.HorizontalMin:(this.ChartBorder.GetBottomEx()-e)/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin},this.GetXData=function(e){return e<=this.ChartBorder.GetLeft()?0:e>=this.ChartBorder.GetRight()?this.XPointCount:(e-this.ChartBorder.GetLeft())*(this.XPointCount*1/this.ChartBorder.GetWidth())},this.DrawPictureXCoordinate=function(e,a,r){if(!this.IsHScreen&&a&&v.IsNonEmptyArray(a.Points)){var t=this.GetBorder(),n=t.Left,s=t.Right;this.Canvas.font=this.DrawPicture.Font;var o=this.GetFontHeight();if(this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",a.X){var l=a.X,h=l.Min.X,u=l.Max.X;h<n&&(h=n),u>s&&(u=s),this.Canvas.fillStyle=this.DrawPicture.BGColor,this.Canvas.fillRect(h,t.Bottom,u-h,o)}for(var f=0;f<a.Points.length;++f){var C=a.Points[f];if(!(C.X<n||C.X>s)){var D=this.GetXData(C.X,!1),D=Math.round(D),c=this.GetKItem(D);if(c){var T=v.FormatDateString(c.Date,null);Y.IsMinutePeriod(r.Period)?T+=" "+v.FormatTimeString(c.Time,"HH:MM"):Y.IsMilliSecondPeriod(r.Period)&&(T+=" "+v.FormatTimeString(c.Time,"HH:MM:SS.fff"));var S=this.Canvas.measureText(T).width+2,I=C.X-S/2;I<n&&(I=n),this.Canvas.fillStyle=this.DrawPicture.TextBGColor,this.Canvas.fillRect(I,t.Bottom,S,o),this.Canvas.fillStyle=this.DrawPicture.TextColor;var g=t.Bottom+o;this.Canvas.fillText(T,I+1,g)}}}}},this.GetKItem=function(e){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return null;var a=this.Data.DataOffset+e;return this.Data.Data[a]},this.DrawPictureYCoordinate=function(e,a,r){if(!this.IsHScreen&&a&&v.IsNonEmptyArray(a.Points)){var t=this.GetBorder(),n=t.TopEx,s=t.BottomEx,o=t.Right;this.Canvas.font=this.DrawPicture.Font;var l=this.GetFontHeight();this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var h=2;r&&r.Symbol&&(h=jt(r.Symbol));for(var u=0,f=0;f<a.Points.length;++f){var C=a.Points[f],D=this.GetYData(C.Y),c=D.toFixed(h),T=this.Canvas.measureText(c).width;u<T&&(u=T),a.Points[f].Text=c}if(u+=this.YTextPadding[1]+2,a.Y){var S=a.Y,I=S.Min.Y,g=S.Max.Y;S.Min.Y<n&&(I=n),S.Max.Y>s&&(g=s),this.Canvas.fillStyle=this.DrawPicture.BGColor,this.Canvas.fillRect(o,I,u+5,g-I)}for(var f=0;f<a.Points.length;++f){var C=a.Points[f];if(!(C.Y<n||C.Y>s)){this.Canvas.fillStyle=this.DrawPicture.TextBGColor,this.Canvas.fillRect(o,C.Y-l/2,u,l),this.Canvas.fillStyle=this.DrawPicture.TextColor;var E=C.Y+l/2;this.Canvas.fillText(C.Text,o+this.YTextPadding[1],E)}}}},this.DrawPicturePointYCoordinate=function(e,a){if(!this.IsHScreen&&e.GetYCoordinatePoint){var r=e.GetYCoordinatePoint();if(v.IsNonEmptyArray(r)){var t=this.GetBorder(),n=t.TopEx,s=t.BottomEx,o=t.Right;this.Canvas.font=this.DrawPicture.Font;var l=this.GetFontHeight();this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var h=2;a&&a.Symbol&&(h=jt(a.Symbol));for(var u=0;u<r.length;++u){var f=r[u];if(f&&!(f.Y<n||f.Y>s)){var C=f.YValue.toFixed(h),D=this.Canvas.measureText(C).width+2;D+=this.YTextPadding[1],this.Canvas.fillStyle=this.DrawPicture.TextBGColor,this.Canvas.fillRect(o,f.Y-l/2,D,l),this.Canvas.fillStyle=this.DrawPicture.TextColor;var c=f.Y+l/2;this.Canvas.fillText(C,o+this.YTextPadding[1],c)}}}}},this.GetCustomItemTextInfo=function(e,a,r){var t=a?e.Message[0]:e.Message[1],n=[],s=0;if(Array.isArray(t)){for(var o=0;o<t.length;++o){var e=t[o];if(e.Type===1)n.push({Type:e.Type});else{var l=this.Canvas.measureText(t[o].Text).width;l>s&&(s=l);var h={Text:t[o].Text,Width:l+2*r};e.TextColor&&(h.TextColor=e.TextColor),e.BGColor&&(h.BGColor=e.BGColor),v.IsBool(e.EnableBGColor)&&(h.EnableBGColor=e.EnableBGColor),n.push(h)}}s>0&&(s+=2*r)}else s=this.Canvas.measureText(t).width+2*r,n.push({Text:t,Width:s});return{MaxWidth:s,Text:n}},this.DrawOutRangeCustomItem=function(e,a){if(this.IsHScreen!==!0&&!(!this.IsShow&&!this.IsYDrawMainFrame)&&!(!e.Message[1]&&!e.Message[0])&&e.OutRange){var r=0;if(e.Value>this.HorizontalMax)r=1;else if(e.Value<this.HorizontalMin)r=2;else return;this.Canvas.save();var t=e.OutRange,n=this.GetBorder(),s=n.Left,o=n.Right;n.Bottom,n.Top;var l=this.ChartBorder.Right,h=this.ChartBorder.Left;this.ChartBorder.TitleHeight,this.IsHScreen&&(h=this.ChartBorder.Top,l=this.ChartBorder.Bottom,n.Top,n.Bottom);var u=B(),f=18*u,C=f;if(e.Message[0]&&h>=10){e.Font!=null&&(this.Canvas.font=e.Font);var D=this.GetCustomItemTextInfo(e,!0,u),c=D.MaxWidth,T=s-c,S=this.GetFontHeight(),C=S>f?S:f;this.Canvas.textAlign="right",this.Canvas.textBaseline="middle";var I=null;r==1?(I=n.TopEx,v.IsNumber(t.TopYOffset)&&(I+=t.TopYOffset)):r==2&&(I=n.BottomEx+C,v.IsNumber(t.BottomYOffset)&&(I+=t.BottomYOffset));for(var g=0;g<D.Text.length;++g){var E=D.Text[g],F={Left:T,Width:E.Width,Bottom:I,Height:C};if(F.Top=F.Bottom-F.Height,F.Right=F.Left+F.Width,e.ExtendLine&&e.ExtendLine[0]){var R=e.ExtendLine[0];if(v.IsNumber(R.Width)){var A=F.Bottom;r==2&&(A=F.Top);var P=e.LineType;v.IsNumber(t.ExtendLine.Type)&&(P=t.ExtendLine.Type),g==0&&this.DrawLine(s,s-R.Width,A,e.LineColor,P,e),F.Left-=R.Width,F.Right-=R.Width}}this.Canvas.fillStyle=t.BGColor,this.Canvas.fillRect(F.Left,F.Top,F.Width,F.Height),t.Border&&t.Border.Color&&(v.IsNonEmptyArray(t.Border.LineDash)&&this.Canvas.setLineDash(t.Border.LineDash),this.Canvas.strokeStyle=t.Border.Color,this.Canvas.strokeRect(L(F.Left),L(F.Top),b(F.Width),b(F.Height))),this.Canvas.fillStyle=t.TextColor,this.Canvas.fillText(E.Text,F.Right-1*u,F.Top+F.Height/2+1*u),I+=C+1}}else if(e.Message[1]&&l>=10){e.Font!=null&&(this.Canvas.font=e.Font);var D=this.GetCustomItemTextInfo(e,!1,u),c=D.MaxWidth,p=o+c,S=this.GetFontHeight(),C=S>f?S:f;this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var I=null;r==1?(I=n.TopEx,v.IsNumber(t.TopYOffset)&&(I+=t.TopYOffset)):r==2&&(I=n.BottomEx+C,v.IsNumber(t.BottomYOffset)&&(I+=t.BottomYOffset));for(var g=0;g<D.Text.length;++g){var E=D.Text[g],F={Right:p,Width:E.Width,Bottom:I,Height:C};if(F.Top=F.Bottom-F.Height,F.Left=F.Right-F.Width,e.ExtendLine&&e.ExtendLine[1]){var R=e.ExtendLine[1];if(v.IsNumber(R.Width)){var A=F.Bottom;r==2&&(A=F.Top);var P=e.LineType;v.IsNumber(t.ExtendLine.Type)&&(P=t.ExtendLine.Type),g==0&&this.DrawLine(o,o+R.Width,A,e.LineColor,P,e),F.Left+=R.Width,F.Right+=R.Width}}this.Canvas.fillStyle=t.BGColor,this.Canvas.fillRect(F.Left,F.Top,F.Width,F.Height),t.Border&&t.Border.Color&&(v.IsNonEmptyArray(t.Border.LineDash)&&this.Canvas.setLineDash(t.Border.LineDash),this.Canvas.strokeStyle=t.Border.Color,this.Canvas.strokeRect(L(F.Left),L(F.Top),b(F.Width),b(F.Height))),this.Canvas.fillStyle=t.TextColor,this.Canvas.fillText(E.Text,F.Left+1*u,F.Top+F.Height/2+1*u),I+=C+1}}this.Canvas.restore()}},this.DrawCustomItem=function(e,a){if(!(!e.Message[1]&&!e.Message[0])){if(e.Value>this.HorizontalMax||e.Value<this.HorizontalMin){this.DrawOutRangeCustomItem(e,a),this.SendDrawCountDownEvent({IsShow:!1});return}var r=this.GetBorder(),t=r.Left,n=r.Right,s=r.Bottom,o=r.Top,l=this.ChartBorder.Right,h=this.ChartBorder.Left;this.ChartBorder.TitleHeight,this.IsHScreen&&(h=this.ChartBorder.Top,l=this.ChartBorder.Bottom,o=r.Top,s=r.Bottom);var u=B(),f=5*u,C=f,D;e.Value=="TopEx"?D=r.TopEx:e.Value=="TopTitle"?D=r.TopTitle:e.Value=="Top"?D=r.Top:e.Value=="BottomEx"?D=r.BottomEx:e.Value=="Bottom"?D=r.Bottom:D=this.GetYFromData(e.Value),v.IsNumber(e.YOffset)&&(D+=e.YOffset);var c=0,T;if(e.ExtendData&&e.ExtendData.Custom){var S=e.ExtendData.Custom;v.IsNumber(S.Position)&&(c=S.Position),S.EmptyBGColor&&(T=S.EmptyBGColor)}if(e.Message[0])if(h<10||c==1||c==2){e.Font!=null&&(this.Canvas.font=e.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(e,!0,u),g=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;var F=e.LineColor,R=this.RGBToStruct(e.LineColor);R&&(F="rgba("+R.R+", "+R.G+", "+R.B+", "+d.FrameLatestPrice.BGAlpha+")"),e.BGColor&&(F=e.BGColor);for(var A=D,P=0;P<I.Text.length;++P){var p=I.Text[P];if(this.IsHScreen){var w=o,H=A-C/2-1*u;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,C,p.Width),this.DrawHScreenText({X:A,Y:w},{Text:p.Text,Color:e.TextColor,XOffset:1*u,YOffset:2*u}),P==0&&this.DrawLine(w+p.Width,s,A,e.LineColor,e.LineType,e),A-=C+1*u}else if(p.Type!==1){c==2&&(t=r.LeftEx-I.MaxWidth);var w=A-C/2-1*u,H=t+1*u;if(e.ExtendLine&&e.ExtendLine[0]&&c==2){var W=e.ExtendLine[0];if(v.IsNumber(W.Width)){var ht=e.LineType;if(v.IsNumber(W.Type)&&(ht=W.Type),P==0){var rt=r.LeftEx-W.Width;this.DrawLine(rt,rt+W.Width,D,e.LineColor,ht,e)}H-=W.Width}}this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,p.Width,C),this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(p.Text,H+1*u,A),P==0&&(c==2?this.DrawLine(r.LeftEx,n,A,e.LineColor,e.LineType,e):this.DrawLine(H+p.Width,n,A,e.LineColor,e.LineType,e)),e.ClickData&&this.AddHorizontalLabel(H,w,p.Width,C,e,P),A+=C+1*u}}}else{e.Font!=null&&(this.Canvas.font=e.Font),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(e,!0,u),g=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;for(var A=D,P=0;P<I.Text.length;++P){var p=I.Text[P];if(this.IsHScreen){if(P==0)var w=o-p.Width;else var w=o-g;var H=A-C/2-1*u;this.Canvas.fillStyle=e.LineColor,this.Canvas.fillRect(H,w,C,p.Width),this.DrawHScreenText({X:A,Y:w},{Text:p.Text,Color:e.TextColor,XOffset:1*u,YOffset:2*u}),P==0&&this.DrawLine(w+p.Width,s,A,e.LineColor,e.LineType,e),A-=C+1*u}else{var w=A-C/2-1*u;if(P==0)var nt=t-p.Width,H=t;else var nt=t-g,H=t-(g-p.Width);if(e.ExtendLine&&e.ExtendLine[0]){var W=e.ExtendLine[0];if(v.IsNumber(W.Width)){var ht=e.LineType;v.IsNumber(W.Type)&&(ht=W.Type);var vt=e.LineColor;W.LineColor&&(vt=W.LineColor),P==0&&this.DrawLine(t,t-W.Width,D,vt,ht,e),H-=W.Width,nt-=W.Width}}if(T)this.Canvas.fillStyle=T,this.Canvas.fillRect(nt-1,w,p.Width+1,C),this.Canvas.strokeStyle=e.LineColor,this.Canvas.strokeRect(L(nt-1),L(w),L(p.Width+1),L(C)),this.Canvas.fillStyle=e.LineColor,this.Canvas.fillText(p.Text,H-1*u,A);else{if(p.EnableBGColor!==!1){var Nt=e.LineColor;p.BGColor&&(Nt=p.BGColor),this.Canvas.fillStyle=Nt,this.Canvas.fillRect(nt,w,p.Width,C)}this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(p.Text,H-1*u,A)}P==0&&this.DrawLine(t,n,A,e.LineColor,e.LineType,e),e.ClickData&&this.AddHorizontalLabel(H,w,p.Width,C,e,P),A+=C+1*u}}}else if(e.Message[1])if(l<10||c==1){e.Font!=null&&(this.Canvas.font=e.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(e,!1,u),g=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;var F=e.LineColor,R=this.RGBToStruct(e.LineColor);R&&(F="rgba("+R.R+", "+R.G+", "+R.B+", "+d.FrameLatestPrice.BGAlpha+")");for(var A=D,P=0;P<I.Text.length;++P){var p=I.Text[P];if(this.IsHScreen){var w=s-p.Width,H=A-C/2-1*u;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,C,p.Width),this.DrawHScreenText({X:A,Y:w},{Text:p.Text,Color:e.TextColor,XOffset:1*u,YOffset:2*u}),P==0&&this.DrawLine(o,w,A,e.LineColor,e.LineType,e),A-=C+1*u}else if(p.Type===1){if(this.GetEventCallback){var w=A-C/2-1*u,Ft={Top:w,Right:n,Height:null,IsShow:!0,BGColor:e.LineColor,TextColor:e.TextColor,PixelTatio:u,Position:"Right",IsInside:!0};this.SendDrawCountDownEvent(Ft)&&v.IsPlusNumber(Ft.Height)&&(A+=C+1*u)}}else{var w=A-C/2-1*u,H=n-p.Width;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,p.Width,C),p.TextColor?this.Canvas.fillStyle=p.TextColor:this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(p.Text,H+1*u,A),P==0&&this.DrawLine(t,H,A,e.LineColor,e.LineType,e),A+=C+1*u}}if((e.Type==3||e.Type==4)&&e.Title){var Bt=this.Canvas.measureText(e.Title).width+2*u;if(this.IsHScreen){var w=s-p.Width-Bt,H=D-C/2-1*u;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,C,Bt),this.DrawHScreenText({X:D,Y:w},{Text:e.Title,Color:e.TextColor,XOffset:1*u,YOffset:2*u})}else{var w=D-C/2-1*u,H=n-g-Bt-1*u;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,Bt,C),this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(e.Title,H+1*u,D)}}}else{e.Font!=null&&(this.Canvas.font=e.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(e,!1,u),g=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;var Jt=null;a&&a.has(3)&&(Jt=a.get(3));for(var A=D,te={},P=0;P<I.Text.length;++P){var p=I.Text[P];if(this.IsHScreen){var w=s,H=A-C/2-1*u;this.Canvas.fillStyle=e.LineColor,this.Canvas.fillRect(H,w,C,p.Width),this.DrawHScreenText({X:A,Y:w},{Text:p.Text,Color:e.TextColor,XOffset:1*u,YOffset:2*u}),P==0&&this.DrawLine(o,w,A,e.LineColor,e.LineType,e),A-=C+1*u}else if(p.Type===1){if(this.GetEventCallback){var w=A-C/2-1*u,Ft={Top:w,Left:n,Right:this.ChartBorder.GetChartWidth(),Height:null,IsShow:!0,BGColor:e.LineColor,TextColor:e.TextColor,PixelTatio:u,Position:"Right",IsInside:!1};this.SendDrawCountDownEvent(Ft)&&v.IsPlusNumber(Ft.Height)&&(A+=C+1*u)}}else{var w=A-C/2-1*u;if(P==0&&I.Text.length==0){var H=n;te.Left=H,Jt&&w<Jt.Rect.Bottom&&(A=Jt.Rect.Bottom,w=A-C/2-1*u)}else var H=n+g-p.Width;if(e.ExtendLine&&e.ExtendLine[1]){var W=e.ExtendLine[1];if(v.IsNumber(W.Width)){var ht=e.LineType;v.IsNumber(W.Type)&&(ht=W.Type),P==0&&this.DrawLine(n,H+W.Width,D,e.LineColor,ht,e),H+=W.Width}}T?(this.Canvas.fillStyle=T,this.Canvas.fillRect(H,w,p.Width+1,C),this.Canvas.strokeStyle=e.LineColor,this.Canvas.strokeRect(L(H),L(w),b(p.Width+1),b(C)),this.Canvas.fillStyle=e.LineColor,this.Canvas.fillText(p.Text,H+2*u,A)):(this.Canvas.fillStyle=e.LineColor,this.Canvas.fillRect(H,w,p.Width,C),p.TextColor?this.Canvas.fillStyle=p.TextColor:this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(p.Text,H+1*u,A)),P==0&&this.DrawLine(t,n,D,e.LineColor,e.LineType,e),e.ClickData&&this.AddHorizontalLabel(H,w,p.Width,C,e,P),A+=C+1*u,te.Bottom=A}}if(a&&v.IsNumber(te.Left)&&v.IsNumber(te.Bottom)&&a.set(3,{Rect:te,Item:e}),(e.Type==3||e.Type==4)&&e.Title){var F=e.LineColor,R=this.RGBToStruct(e.LineColor);R&&(F="rgba("+R.R+", "+R.G+", "+R.B+", "+d.FrameLatestPrice.BGAlpha+")");var Bt=this.Canvas.measureText(e.Title).width+2*u;if(this.IsHScreen){var w=s-Bt,H=D-C/2-1*u;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,C,Bt),this.DrawHScreenText({X:D,Y:w},{Text:e.Title,Color:e.TextColor,XOffset:1*u,YOffset:2*u})}else{var w=D-C/2-1*u,H=n-Bt-1*u;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,Bt,C),this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(e.Title,H+1*u,D)}}}}},this.AddHorizontalLabel=function(e,a,r,t,n,s){var o={Left:e,Top:a,Width:r,Height:t};o.Right=o.Left+o.Width,o.Bottom=o.Top+o.Height;var l={Rect:o,Item:n,ID:n.ClickData.ID,Args:n.ClickData.Args,LineID:s};this.HorizontalLabel.push(l)},this.DrawCustomAreaItem=function(e){if(e.AreaData&&!this.IsHScreen&&!(!v.IsNonEmptyArray(e.AreaData.Value)||e.AreaData.Value.length!=2)){var a=Math.max(e.AreaData.Value[0],e.AreaData.Value[1]),r=Math.min(e.AreaData.Value[0],e.AreaData.Value[1]);if(!(r>=this.HorizontalMax)&&!(a<=this.HorizontalMin)){a>this.HorizontalMax&&(a=this.HorizontalMax),r<this.HorizontalMin&&(r=this.HorizontalMin);var t=this.GetBorder(),n=t.Left,s=t.Right,o=this.ChartBorder.Right,l=this.ChartBorder.Left,h=this.GetYFromData(a),u=this.GetYFromData(r);if(e.AreaData.Position.includes(0)&&l>10){var f={Left:0,Right:n-1,Top:h,Bottom:u};if(f.Height=f.Bottom-f.Top,f.Width=f.Right-f.Left,v.IsNonEmptyArray(e.AreaData.Width)){var C=e.AreaData.Width[0];v.IsNumber(C)&&f.Width>C&&(f.Width=C,f.Left=f.Right-f.Width)}this.Canvas.fillStyle=e.AreaData.BGColor,this.Canvas.fillRect(f.Left,f.Top,f.Width,f.Height),this.DrawCustomAreaText(f,e,0)}if(e.AreaData.Position.includes(1)&&o>10){var f={Left:s+1,Top:h,Bottom:u};if(f.Height=f.Bottom-f.Top,this.YRightTextInfo&&v.IsNumber(this.YRightTextInfo.MainTextWidth)?(f.Width=this.YRightTextInfo.MainTextWidth-1,f.Right=f.Left+f.Width):(f.Right=t.ChartWidth,f.Width=f.Right-f.Left),v.IsNonEmptyArray(e.AreaData.Width)){var C=e.AreaData.Width[1];v.IsNumber(C)&&f.Width>C&&(f.Width=C,f.Right=f.Left+f.Width)}this.Canvas.fillStyle=e.AreaData.BGColor,this.Canvas.fillRect(f.Left,f.Top,f.Width,f.Height),this.DrawCustomAreaText(f,e,1)}}}},this.DrawCustomAreaText=function(e,a,r){a.Font!=null&&(this.Canvas.font=a.Font);var t=this.GetFontHeight();if(!(e.Height<t)){var n=B(),s,o;if(r==0){if(!a.Message[0])return;this.Canvas.textAlign="right",s=a.Message[0],o=e.Right-2*n}else if(r==1){if(!a.Message[1])return;this.Canvas.textAlign="left",s=a.Message[1],o=e.Left+2*n}var l=e.Top+e.Height/2;this.Canvas.textBaseline="middle",this.Canvas.fillStyle=a.TextColor,this.Canvas.fillText(s,o,l)}},this.SendDrawCountDownEvent=function(e){if(!this.GetEventCallback)return!1;var a=this.GetEventCallback($.ON_DRAW_COUNTDOWN);return!a||!a.Callback?!1:(a.Callback(a,e,this),!0)},this.DrawDotLine=function(e,a,r,t,n){var s=B();this.Canvas.save(),this.Canvas.strokeStyle=t,n&&v.IsPlusNumber(n.LineWidth)&&(this.Canvas.lineWidth=n.LineWidth*s),n.LineDash?this.Canvas.setLineDash(n.LineDash):this.Canvas.setLineDash([5*s,5*s]),this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(L(r),e),this.Canvas.lineTo(L(r),a)):(this.Canvas.moveTo(e,L(r)),this.Canvas.lineTo(a,L(r))),this.Canvas.stroke(),this.Canvas.restore()},this.DrawLine=function(e,a,r,t,n,s){if(n!=-1)if(n==0){var o=B();this.Canvas.strokeStyle=t;var l=!1;s&&v.IsPlusNumber(s.LineWidth)&&(this.Canvas.lineWidth=s.LineWidth*o,l=!0),this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(L(r),e),this.Canvas.lineTo(L(r),a)):(this.Canvas.moveTo(e,L(r)),this.Canvas.lineTo(a,L(r))),this.Canvas.stroke(),l&&(this.Canvas.lineWidth=o)}else if(n==3){var h=10*B();this.Canvas.strokeStyle=t,this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(L(r),e),this.Canvas.lineTo(L(r),e+h)):(this.Canvas.moveTo(e,L(r)),this.Canvas.lineTo(e+h,L(r))),this.Canvas.stroke()}else(n==1||n==2)&&this.DrawDotLine(e,a,r,t,s)},this.DrawHScreenText=function(e,a){this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=a.Color,this.Canvas.save(),this.Canvas.translate(e.X,e.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(a.Text,a.XOffset,a.YOffset),this.Canvas.restore()},this.RGBToStruct=function(e){if(/^(rgb|RGB)/.test(e)){var a=e.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),r={};return a.length!=3?null:(r.R=Number(a[0]),r.G=Number(a[1]),r.B=Number(a[2]),r)}return null},this.GetMulitTextMaxWidth=function(e){for(var a=null,r=0;r<e.length;++r){var t=e[r],n=t.Text;if(n){var s=this.Canvas.measureText(n).width;(a==null||a<s)&&(a=s)}}return a},this.GetScaleTextWidth=function(){this.ChartBorder.GetBorder();var e=B();if(this.IsHScreen){var a=this.ChartBorder.Top;this.ChartBorder.Bottom;var r=a>10*e&&this.IsShowYText[0]===!0&&this.YTextPosition[0]!=2,t=this.IsShowRightHorizontal()}else{this.ChartBorder.Right;var n=this.ChartBorder.Left,r=n>10&&this.IsShowYText[0]===!0&&this.YTextPosition[0]!=2,t=this.IsShowRightHorizontal()}if(!t&&!r)return null;var s={Left:null,Right:null},o=0,l=!1;this.YSplitOperator&&this.YSplitOperator.CoordinateType==1&&(l=!0);var h=0,u=0;v.IsNonEmptyArray(this.YLineExtend)&&(this.YLineExtend[0]&&this.YLineExtend[0].Width>1&&(h=this.YLineExtend[0].Width),this.YLineExtend[1]&&this.YLineExtend[1].Width>1&&(u=this.YLineExtend[1].Width));for(var f=0;f<this.HorizontalInfo.length;++f){var C=null,D=this.HorizontalInfo[f];if(D&&(D.Font!=null&&(this.Canvas.font=D.Font),D.Message[0]!=null&&r&&(Array.isArray(D.Message[0])?C=this.GetMulitTextMaxWidth(D.Message[0]):C=this.Canvas.measureText(D.Message[0]).width,(s.Left==null||s.Left<C)&&(s.Left=C)),D.Message[1]!=null&&t)){if(D.Font!=null&&(this.Canvas.font=D.Font),Array.isArray(D.Message[1])){if(this.MultiTextFormat==1){if(D.ExtendData){D.ExtendData.Font&&(this.Canvas.font=D.ExtendData.Font);var c=this.Canvas.measureText(D.Message[1][0]).width,T=this.Canvas.measureText(D.Message[1][1]).width,S=this.Canvas.measureText("/").width;C=c+S,o<T&&(o=T)}}else if(this.MultiTextFormat==2){C=this.Canvas.measureText(D.Message[1][0]).width;var I=this.Canvas.measureText(D.Message[1][1]).width;C<I&&(C=I)}else if(this.MultiTextFormat==3)C=this.GetMulitTextMaxWidth(D.Message[1]);else if(C=this.Canvas.measureText(D.Message[1][0]).width,l){var g=this.Canvas.measureText("-00.00%").width;g>C&&(C=g)}}else C=this.Canvas.measureText(D.Message[1]).width;(s.Right==null||s.Right<C)&&(s.Right=C)}}return v.IsNumber(s.Right)&&(s.Right+=o),v.IsNumber(s.Left)&&(s.Left+=this.YTextPadding[0]+h),v.IsNumber(s.Right)&&(s.Right+=this.YTextPadding[1]+u),{TextWidth:s}},this.ClearToolbar=function(){if(this.ToolbarID){var e=document.getElementById(this.ToolbarID);e&&(this.ChartBorder.UIElement.parentNode.removeChild(e),this.ToolbarRect=null)}},this.HideToolbar=function(){if(this.ToolbarID){this.ToolbarRect=null;var e=document.getElementById(this.ToolbarID);e&&e.style.display!="none"&&(e.style.display="none")}},this.GetMainOverlayFrame=function(){if(!this.FrameData||!this.FrameData.SubFrameItem)return null;for(var e=this.FrameData.SubFrameItem,a=null,r=null,t=0;t<e.OverlayIndex.length;++t){var n=e.OverlayIndex[t],s=n.Frame;s.IsShowMainFrame==2?r=s:s.IsShowMainFrame==1&&(a=s)}return!a&&!r?null:[a,r]}}function hn(){this.newMethod=zh,this.newMethod(),delete this.newMethod,this.ClassName="MinuteFrame",this.DataWidth=1*B(),this.DistanceWidth=1*B(),this.MinuteCount=243,this.BeforeBGColor=d.Minute.Before.BGColor,this.AfterBGColor=d.Minute.After.BGColor,this.MultiDayBorderPen=d.MultiDayBorderPen,this.CustomHorizontalInfo=[],this.RightFrame=null,this.ToolbarID=Re(),this.ReDrawToolbar=!1,this.DayCount=1,this.ModifyIndex=d.MinuteToolbar.ModifyIndex,this.ChangeIndex=d.MinuteToolbar.ChangeIndex,this.CloseIndex=d.MinuteToolbar.CloseIndex,this.MaxMinWindow=d.MinuteToolbar.MaxMinWindow,this.TitleWindow=d.MinuteToolbar.TitleWindow,this.ExportData=d.MinuteToolbar.ExportData,this.OverlayIndex=d.MinuteToolbar.OverlayIndex,this.ToolbarRect=null,this.IsShowPositionTitle=!1,this.LastCalculateStatus={Width:0,XPointCount:0},this.BeforeCloseIcon=At(d.Minute.Before.CloseIcon),this.IsShowCloseButton=!0,this.BeforeOpenVerticalInfo=[],this.AfterCloseVerticalInfo=[],this.NightDayConfig=At(d.Minute.NightDay),this.MinuteFrame_ReloadResource=this.ReloadResource,this.ReloadResource=function(e){this.MinuteFrame_ReloadResource(e),this.BeforeBGColor=d.Minute.Before.BGColor,this.AfterBGColor=d.Minute.After.BGColor,this.MultiDayBorderPen=d.MultiDayBorderPen},this.DrawFrame=function(){this.IsMinSize||(this.SplitXYCoordinate(),this.DrawBeforeDataBG(),this.YInsideOffset=0,this.BeforeDrawXYCallback&&this.BeforeDrawXYCallback(this),this.DrawNightDayBG(),this.DrawCustomBG(),this.DrawTitleBG(),this.DrawCustomHorizontalArea(),this.DrawHorizontal(),this.DrawVertical()),(this.SizeChange==!0||this.ReDrawToolbar==!0)&&(this.DrawToolbar(),this.ReDrawToolbar=!1)},this.DrawCustomHorizontalArea=function(){if(!this.IsMinSize&&!this.ChartBorder.IsShowTitleOnly&&v.IsNonEmptyArray(this.CustomHorizontalInfo))for(var e=0;e<this.CustomHorizontalInfo.length;++e){var a=this.CustomHorizontalInfo[e];a.Type==5&&this.DrawCustomAreaItem(a)}},this.SuperDrawBorder=this.DrawBorder,this.DrawBorder=function(){if(this.IsShowBorder&&!this.IsMinSize&&(this.SuperDrawBorder(),this.Identify==1)){var e=this.ChartBorder.GetBorder(),a=L(e.Left),r=L(e.Top),t=L(e.Right);this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(a,r),this.Canvas.lineTo(t,r),this.Canvas.save(),this.Canvas.lineWidth=2*B(),this.Canvas.stroke(),this.Canvas.restore()}},this.DrawVolTitle=function(e){if(U.IsShowMinuteVolTitle(e)&&this.Identify==1){var a=B(),r=this.ChartBorder.GetLeft()+2*a+this.YInsideOffset,t=this.ChartBorder.GetTopEx()+2*a;if(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",d.Minute.VolBarColor||d.Minute.VolTitleColor){d.Minute.VolBarColor?this.Canvas.fillStyle=d.Minute.VolBarColor:this.Canvas.fillStyle=d.Minute.VolTitleColor;var n=this.YSplitOperator.LanguageID,s=St.GetText("MVol-Vol",n);this.Canvas.fillText(s,r,t),r+=this.Canvas.measureText(s).width,r+=6*B()}this.IsShowPositionTitle&&(s=St.GetText("MVol-Position",n),this.Canvas.fillStyle=d.Minute.PositionColor,this.Canvas.fillText(s,r,t))}},this.DrawToolbar=function(){if(this.ToolbarButtonStyle!=1&&d.IsDOMFrameToolbar!==!0&&!(typeof yt.default>"u")&&!(this.Identify<2)&&this.ChartBorder.UIElement){var e=document.getElementById(this.ToolbarID);if(!(e&&this.SizeChange==!1&&this.ReDrawToolbar==!1)){if(e||(e=document.createElement("div"),e.className="klineframe-toolbar",e.id=this.ToolbarID,e.oncontextmenu=function(){return!1},e.setAttribute("identify",this.Identify.toString()),this.ChartBorder.UIElement.parentNode.appendChild(e)),!this.ModifyIndex&&!this.ChangeIndex&&!this.OverlayIndex&&!this.CloseIndex){e.style.display!="none"&&(e.style.display="none");return}var a=B(),r=parseInt(this.ChartBorder.UIElement.parentElement.style.width.replace("px",""));parseInt(this.ChartBorder.UIElement.parentElement.style.height.replace("px",""));var t=100,n=this.ChartBorder.GetTitleHeight(),s=r-this.ChartBorder.Right/a-t,o=this.ChartBorder.GetTop()/a;if(!(this.ToolbarRect&&this.ToolbarRect.Left==s&&this.ToolbarRect.Top==o&&this.ToolbarRect.Width==t&&this.ToolbarRect.Height==n/a)){this.ToolbarRect={Left:s,Top:o,Width:t,Height:n/a};var l="<span class='index_param icon iconfont icon-index_param' id='modifyindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='调整指标参数'></span>",h="<span class='index_change icon iconfont icon-change_index' id='changeindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='切换指标'></span>",u="<span class='index_close icon iconfont icon-close' id='closeindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='关闭指标窗口'></span>",f=l+h;this.CloseIndex&&(f+=u),e.style.left=s+"px",e.style.top=o+"px",e.style.width=t+"px",e.style.height=n/a+"px",e.innerHTML=f,this.ChartBorder.UIElement.JSChartContainer,this.Identify,this.ModifyIndex?typeof this.ModifyIndexEvent=="function"&&(0,yt.default)("#"+e.id+" .index_param").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},this.ModifyIndexEvent):(0,yt.default)("#"+e.id+" .index_param").hide(),this.ChangeIndex?typeof this.ChangeIndexEvent=="function"&&(0,yt.default)("#"+e.id+" .index_change").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,IsOverlay:!1},this.ChangeIndexEvent):(0,yt.default)("#"+e.id+" .index_change").hide(),(0,yt.default)("#"+e.id+" .index_close").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},function(C){var D=C.data.Chart,c=C.data.Identify;D.RemoveIndexWindow(c)}),e.style.display="block"}}}},this.DrawToolbarV2=function(e,a){if(d.IsDOMFrameToolbar!==!0&&(this.Identify==0&&this.IsShowCloseButton&&this.DrawCloseBeforeButton(e,a),!(this.ChartBorder.TitleHeight<5))){var r=[];if(this.Identify!=0&&this.Identify!=1&&(this.CloseIndex&&r.push({ID:Rt.CLOSE_INDEX_WINDOW,Style:this.CloseWindowButton}),this.MaxMinWindow&&r.push({ID:Rt.MAX_MIN_WINDOW,Style:this.MaxMinWindowButton}),this.TitleWindow&&r.push({ID:Rt.TITLE_WINDOW,Style:this.TitleWindowButton}),this.ExportData&&r.push({ID:Rt.EXPORT_DATA,Style:this.ExportDataButton}),this.OverlayIndex&&r.push({ID:Rt.OVERLAY_INDEX,Style:this.OverlayIndexButton}),this.ChangeIndex&&r.push({ID:Rt.CHANGE_INDEX,Style:this.ChangeIndexButton}),this.ModifyIndex&&r.push({ID:Rt.MODIFY_INDEX_PARAM,Style:this.ModifyIndexParamButton})),v.IsNonEmptyArray(this.CustomToolbar))for(var t=0;t<this.CustomToolbar.length;++t){var n=this.CustomToolbar[t];n.ID&&n.Style&&r.push({ID:n.ID,Style:n.Style,TooltipText:n.TooltipText,Data:n.Data})}this.DrawTitleButton(r,e,a)}},this.DrawCloseBeforeButton=function(e,a){if(this.Identify==0){var r=this.ChartBorder.GetBorder();if(!r.DayBorder&&!(this.ChartBorder.LeftExtendWidth<10)){var t={Left:r.Left,Top:r.TopEx,Width:this.BeforeCloseIcon.Size,Height:this.BeforeCloseIcon.Size};t.Right=t.Left+this.BeforeCloseIcon.Size,t.Bottom=t.Top+this.BeforeCloseIcon.Size;var n={Rect:t,Name:"集合竞价关闭按钮",ID:Rt.CLOSE_BEFOREOPEN_ID},s=this.BeforeCloseIcon.Color;e&&e.X>=t.Left&&e.X<t.Right&&e.Y>=t.Top&&e.Y<=t.Bottom&&(s=this.BeforeCloseIcon.MoveOnColor,a&&(a.MouseOnToolbar={Rect:t,Item:n,Frame:this,Point:{X:e.X,Y:e.Y}}));var o=this.BeforeCloseIcon.Size+"px "+this.BeforeCloseIcon.Family;this.Canvas.font=o,this.Canvas.fillStyle=s,this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.fillText(this.BeforeCloseIcon.Text,r.Left,r.TopEx),this.Buttons.push(n)}}},this.DrawMultiDayBeforeDataBG=function(e){var a=e.DayBorder,r=L(e.Top),t=L(e.Bottom),n=t-r;this.Canvas.strokeStyle=this.MultiDayBorderPen;for(var s=0;s<a.length;++s){var o=0,l=a[s],h=L(l.Left),u=L(l.LeftEx),f=u-h;f>3&&(this.Canvas.fillStyle=this.BeforeBGColor,this.Canvas.fillRect(h,r,f,n),++o);var h=L(l.RightEx),u=L(l.Right),f=u-h;f>3&&(this.Canvas.fillStyle=this.AfterBGColor,this.Canvas.fillRect(h,r,f,n),++o),o==2&&s!=a.length-1&&(this.Canvas.beginPath(),this.Canvas.moveTo(u,r),this.Canvas.lineTo(u,t),this.Canvas.stroke())}},this.DrawCallAuctionVertical=function(e,a,r,t){if(a){var n=r.TopTitle,s=r.Bottom;r.Left;var o=r.LeftEx,l=B(),h=null,u=null;for(var f in e){var C=e[f],D=this.GetLeftExtendXFromIndex(C.Value,a);if(D>o)break;if(!(h!=null&&Math.abs(D-h)<this.MinXDistance)){var c=L(D);if(this.IsShowXLine&&(C.LineType==2?(this.Canvas.strokeStyle=C.LineColor,this.Canvas.setLineDash([5*l,5*l]),this.Canvas.beginPath(),this.Canvas.moveTo(c,n),this.Canvas.lineTo(c,s),this.Canvas.stroke(),this.Canvas.setLineDash([])):C.LineType==3||C.LineType>0&&(d.FrameXLineDash?(this.Canvas.strokeStyle=C.LineColor,this.Canvas.setLineDash(d.FrameXLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(c,n),this.Canvas.lineTo(c,s),this.Canvas.stroke(),this.Canvas.setLineDash([])):(this.Canvas.strokeStyle=C.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(c,n),this.Canvas.lineTo(c,s),this.Canvas.stroke()))),C.Message[0]!=null&&this.ChartBorder.Bottom>5*l){C.Font!=null&&(this.Canvas.font=C.Font);var T=0;this.Canvas.fillStyle=C.TextColor,this.Canvas.strokeStyle=C.TextColor;var S=this.Canvas.measureText(C.Message[0]).width;if(D<S/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",T=D):D+S/2>=r.ChartWidth?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top",T=D-S):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top",T=D-S/2),u==null||T>u){var I=s;if(C.LineType==3){var g=this.ShortXLineLength*l;this.Canvas.beginPath(),this.Canvas.moveTo(c,I),this.Canvas.lineTo(c,I+g),this.Canvas.stroke(),I+=g+2*l}this.Canvas.fillText(C.Message[0],D,I+this.XBottomOffset),u=T+S}}h=D}}}},this.DrawBeforeDataBG=function(){var e=this.ChartBorder.GetBorder();if(e.DayBorder){this.DrawMultiDayBeforeDataBG(e);return}if(!(this.ChartBorder.LeftExtendWidth<10&&this.ChartBorder.RightExtendWidth<10)){var a=L(e.Top),r=L(e.Bottom);if(this.Canvas.fillStyle=this.BeforeBGColor,this.ChartBorder.LeftExtendWidth>10){var t=L(e.Left),n=L(this.ChartBorder.GetLeft()),s=n-t,o=r-a;this.Canvas.fillRect(t,a,s,o),this.DrawCallAuctionVertical(this.BeforeOpenVerticalInfo,this.YSplitOperator.BeforeOpenData,e,!0)}if(this.ChartBorder.RightExtendWidth>10){this.Canvas.fillStyle=this.AfterBGColor;var t=L(this.ChartBorder.GetRight()),n=L(e.Right),s=n-t,o=r-a;this.Canvas.fillRect(t,a,s,o)}}},this.DrawCustomBG=function(){if(this.HQChart&&!this.IsHScreen){var e=this.HQChart.Symbol;if(e){var a=this.GetEventCallback($.ON_CUSTOM_MINUTE_BG);if(!(!a||!a.Callback)){var r=null;if(this.DayCount>1){if(!v.IsNonEmptyArray(this.HQChart.DayData))return;r=[];for(var t=this.HQChart.DayData.length-1;t>=0;--t)r.push({Date:this.HQChart.DayData[t].Date,BGColor:null})}else if(this.DayCount==1){if(!v.IsPlusNumber(this.HQChart.DataStatus.LatestDate))return;r=[{Date:this.HQChart.DataStatus.LatestDate,BGColor:null}]}if(v.IsNonEmptyArray(r)){var n={XPointCount:this.XPointCount,DayCount:this.DayCount,MinuteCount:this.MinuteCount,AryDay:r,PreventDefault:!1};if(a.Callback(a,n,this),!n.PreventDefault)for(var s=this.ChartBorder.GetBorder(),t=0;t<r.length;++t){var o=r[t];if(o.BGColor){var l=t*this.MinuteCount,h=l+this.MinuteCount-1,u=this.GetXFromIndex(l),f=this.GetXFromIndex(h),C={Left:u,Top:s.Top,Right:f,Bottom:s.Bottom};C.Width=C.Right-C.Left,C.Height=C.Bottom-C.Top,this.Canvas.fillStyle=o.BGColor,this.Canvas.fillRect(C.Left,C.Top,C.Width,C.Height)}}}}}}},this.DrawNightDayBG=function(){if(this.DayCount==1&&this.HQChart&&this.HQChart.EnableNightDayBG){var e=this.HQChart.Symbol;if(e){var a=-1,r=this.GetEventCallback($.ON_CUSTOM_MINUTE_NIGHT_DAY_X_INDEX);if(!(!r||!r.Callback)){var t={Symbol:e,XIndex:a,MinuteTimeStringData:Wi};if(r.Callback(r,t,this),a=t.XIndex,!(a<0)){var n=this.ChartBorder.GetBorder(),s=this.GetXFromIndex(a),o={Left:n.Left,Top:n.TopEx,Right:s,Bottom:n.Bottom};if(o.Width=o.Right-o.Left,o.Height=o.Bottom-o.Top,this.Canvas.fillStyle=this.NightDayConfig.NightBGColor,this.Canvas.fillRect(o.Left,o.Top,o.Width,o.Height),this.Identify==0){this.Canvas.font=this.NightDayConfig.Font,this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left";for(var l=[{Title:"夜盘",Position:1,Config:this.NightDayConfig.Night},{Title:"日盘",Position:0,Config:this.NightDayConfig.Day}],h=this.Canvas.measureText("擎").width,u=0;u<l.length;++u){var f=l[u],C=St.GetText(f.Title,this.HQChart.LanguageID),D=this.Canvas.measureText(C).width,c={Width:D+f.Config.Margin.Left+f.Config.Margin.Right,Height:h+f.Config.Margin.Top+f.Config.Margin.Bottom,Bottom:n.Bottom};c.Top=c.Bottom-c.Height,f.Position===1?(c.Right=s-1,c.Left=c.Right-c.Width):(c.Left=s+1,c.Right=c.Left+c.Width),f.Config.BGColor&&(this.Canvas.fillStyle=f.Config.BGColor,this.Canvas.fillRect(c.Left,c.Top,c.Width,c.Height)),f.Config.BorderColor&&(this.Canvas.strokeStyle=f.Config.BorderColor,this.Canvas.strokeRect(L(c.Left),L(c.Top),b(c.Width),b(c.Height))),this.Canvas.fillStyle=f.Config.Color,this.Canvas.fillText(C,c.Left+f.Config.Margin.Left,c.Bottom-f.Config.Margin.Bottom)}}}}}}},this.DrawPictureXCoordinate=function(e,a,r){if(!this.IsHScreen&&a&&v.IsNonEmptyArray(a.Points)){var t=this.GetBorder(),n=t.Left,s=t.Right;this.Canvas.font=this.DrawPicture.Font;var o=this.GetFontHeight();if(a.X){var l=a.X,h=l.Min.X,u=l.Max.X;h<n&&(h=n),u>s&&(u=s),this.Canvas.fillStyle=this.DrawPicture.BGColor,this.Canvas.fillRect(h,t.Bottom,u-h,o)}for(var f=0;f<a.Points.length;++f){var C=a.Points[f];if(!(C.X<n||C.X>s)){var D=parseInt(this.GetXData(C.X)),c=this.GetKItem(D,r);if(c){var T=v.FormatTimeString(c.Time,"HH:MM"),S=this.Canvas.measureText(T).width+2,I=C.X-S/2;I<n&&(I=n),this.Canvas.fillStyle=this.DrawPicture.TextBGColor,this.Canvas.fillRect(I,t.Bottom,S,o),this.Canvas.fillStyle=this.DrawPicture.TextColor;var g=t.Bottom+o;this.Canvas.fillText(T,I+1,g)}}}}},this.GetKItem=function(e,a){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return null;if(e<this.Data.Data.length)return this.Data.Data[e];var r=this.Data.Data[this.Data.Data.length-1],t=Wi.GetTimeData(a.Symbol),n=e%t.length,s=t[n];return{Date:r.Date,Time:s}},this.DrawDayVertical=function(e,a,r){if(e.BG){var t=e.BG,n=this.GetXFromIndex(t.Index.Start),s=this.GetXFromIndex(t.Index.End),o=s-n,l=this.ChartBorder.Bottom;if(v.IsNumber(t.Height)&&(l=t.Height),t.Color){this.Canvas.fillStyle=t.Color;var h={Left:n,Width:o,Top:r.Bottom,Height:l};this.Canvas.fillRect(h.Left,h.Top,h.Width,h.Height)}if(v.IsNonEmptyArray(e.AryText)){this.Canvas.textAlign="left",this.Canvas.textBaseline="top";for(var u=r.Bottom+2,f=this.Canvas.measureText("擎").width+2,C=0,D=0;C<e.AryText.length;++C){var c=e.AryText[C],T=0,S=[];for(D=0;D<c.length;++D){var I=c[D],g=this.Canvas.measureText(I.Text).width;if(T+g>o)break;var E={Text:I.Text,Width:g,Color:I.Color,Space:I.Space};T+=g,I.Width=g,I.Space>=1&&(T+=I.Space),S.push(E)}for(var F=n+(o-T)/2,D=0;D<S.length;++D){var I=S[D];if(!v.IsNumber(I.Width))break;I.Color?this.Canvas.fillStyle=I.Color:e.TextColor&&(this.Canvas.fillStyle=e.TextColor),this.Canvas.fillText(I.Text,F,u),F+=I.Width,I.Space>=1&&(F+=I.Space)}u+=f}}}},this.SplitXYCoordinate=function(){if(this.XYSplit==!1){this.YCustomSplit&&this.YSplitOperator&&this.YSplitOperator.CustomCoordinate&&this.YSplitOperator.CustomCoordinate();return}this.XSplitOperator!=null&&this.XSplitOperator.Operator(),this.YSplitOperator!=null&&this.YSplitOperator.Operator()},this.GetMultiDayXFromIndex=function(e,a){var r=a.DayBorder,t=e%this.MinuteCount,n=parseInt(e/this.MinuteCount);n>=r.length&&(n=r.length-1);var s=r[n],o=this.MinuteCount-1;if(t>=o)return s.RightEx;var l=s.RightEx-s.LeftEx,h=s.LeftEx+l*t/o;return h},this.GetXFromIndex=function(e){var a=this.XPointCount-1,r=this.ChartBorder.GetBorder();if(r.DayBorder)return this.GetMultiDayXFromIndex(e,r);if(a==1)return e==0?r.LeftEx:r.RightEx;if(a<=0)return r.LeftEx;if(e>=a)return r.RightEx;var t=r.RightEx-r.LeftEx,n=r.LeftEx+t*e/a;return n},this.GetMultiDayXData=function(e,a){for(var r=a.DayBorder,t=0;t<r.length;++t){var n=r[t];if(e>=n.Left&&e<=n.Right){var s=this.MinuteCount-1,o=this.MinuteCount*t;if(e<=n.LeftEx)return 0+o;if(e>=n.RightEx)return s+o;var l=n.RightEx-n.LeftEx;return(e-n.LeftEx)*(s*1/l)+o}}},this.GetXData=function(e){var a=this.XPointCount-1;a<0&&(a=0);var r=this.ChartBorder.GetBorder();if(r.DayBorder)return this.GetMultiDayXData(e,r);if(e<=r.LeftEx)return 0;if(e>=r.RightEx)return a;var t=r.RightEx-r.LeftEx;return(e-r.LeftEx)*(a*1/t)},this.DrawCustomHorizontal=function(){if(!this.IsMinSize)for(var e in this.CustomHorizontalInfo){var a=this.CustomHorizontalInfo[e];switch(a.Type){case 0:case 1:case 10:this.DrawCustomItem(a);break}}},this.GetLeftExtendXFromIndex=function(e,a){var r=a.TotalCount-1,t=this.ChartBorder.GetBorder();if(t.DayBorder)return this.GetLeftExtendMultiDayXFromIndex(e,a,t);var n=t.Left,s=this.ChartBorder.LeftExtendWidth,o=n+s*e/r;return o},this.GetLeftExtendMultiDayXFromIndex=function(e,a,r){var t=r.DayBorder,n=t[a.Index],s=a.TotalCount-1,o=n.Left,l=n.LeftEx,h=l-o,u=o+h*e/s;return u},this.GetLeftExtendMultiDayXData=function(e,a,r){for(var t=r.DayBorder,n=0;n<t.length;++n){var s=t[n];if(e>=s.Left&&e<=s.LeftEx){if(!a[n])return null;var o=a[n].TotalCount-1,l=s.Left,h=s.LeftEx,u=h-l,f=(e-l)*(o*1/u);return{DayIndex:parseInt(n),DataIndex:f}}}},this.GetLeftExtendXData=function(e,a){var r=this.ChartBorder.GetBorder();if(r.DayBorder)return this.GetLeftExtendMultiDayXData(e,a,r);var t=a.TotalCount-1;t<0&&(t=0);var n=r.Left,s=r.LeftEx;if(e<=n)return 0;if(e>=s)return t;var o=s-n;return(e-n)*(t*1/o)},this.MoveXIndexLeft=function(e,a){if(k.Chart.Log("[MinuteFrame::MoveXIndexLeft] obj ",a),a.DataType==2){var r=a.IndexData.DayIndex,t=a.IndexData.DataIndex-e,n=-1;if(a.IndexData.Type==20)n=0;else if(a.IndexData.Type==10)n=1;else if(a.IndexData.Type==30)n=2;else return!1;for(var s=r,o=n;s>=0;--s){for(var l=a.Data[s];o>=0;--o){var h=l[o];if(!(!h.DayItem||!h.DayItem.Data)){for(t==null&&(t=h.DayItem.Data.length-1);t>=0;--t){var u=h.DayItem.Data[t];if(u){if(h.Type==10){var f=this.MinuteCount*s+t;return a.Point.X=this.GetXFromIndex(f),a.Point.Y=this.GetYFromData(u.Close),a.IndexData.CursorIndex=f,a.IndexData.DayIndex=s,a.IndexData.DataIndex=t,a.IndexData.Type=h.Type,!0}else if(h.Type==20){if(!v.IsNumber(u.Price))continue;return a.Point.X=this.GetLeftExtendXFromIndex(t,h.DayItem),a.Point.Y=this.GetLeftExtendYFromData(u.Price),a.IndexData.CursorIndex=-1,a.IndexData.DayIndex=s,a.IndexData.DataIndex=t,a.IndexData.Type=h.Type,!0}else if(h.Type==30){if(!v.IsNumber(u.Price))continue;return a.Point.X=this.GetRightExtendXFromIndex(t,h.DayItem),a.Point.Y=this.GetRightExtendYFromData(u.Price),a.IndexData.CursorIndex=-1,a.IndexData.DayIndex=s,a.IndexData.DataIndex=t,a.IndexData.Type=h.Type,!0}}}t=null}}o=2}return!1}else if(a.DataType==1){var r=a.IndexData.DayIndex,t=a.IndexData.DataIndex-e,n=-1;if(a.IndexData.Type==2)n=0;else if(a.IndexData.Type==1)n=1;else if(a.IndexData.Type==3)n=2;else return!1;for(var s=n;s>=0;--s){var h=a.Data[s];if(!(!h||!h.DayItem||!h.DayItem.Data)){for(t==null&&(t=h.DayItem.Data.length-1);t>=0;--t)if(h.Type==1){var C=h.DayItem.DataOffset,u=h.DayItem.Data[t+C];if(!u)continue;var f=t;return a.Point.X=this.GetXFromIndex(f),a.Point.Y=this.GetYFromData(u.Close),a.IndexData.CursorIndex=f,a.IndexData.DayIndex=0,a.IndexData.DataIndex=t,a.IndexData.Type=h.Type,!0}else if(h.Type==2){var u=h.DayItem.Data[t];if(!u||!v.IsNumber(u.Price))continue;return a.Point.X=this.GetLeftExtendXFromIndex(t,h.DayItem),a.Point.Y=this.GetLeftExtendYFromData(u.Price),a.IndexData.CursorIndex=-1,a.IndexData.DayIndex=0,a.IndexData.DataIndex=t,a.IndexData.Type=h.Type,!0}else if(h.Type==3){var u=h.DayItem.Data[t];if(!u||!v.IsNumber(u.Price))continue;return a.Point.X=this.GetRightExtendXFromIndex(t,h.DayItem),a.Point.Y=this.GetRightExtendYFromData(u.Price),a.IndexData.CursorIndex=-1,a.IndexData.DayIndex=0,a.IndexData.DataIndex=t,a.IndexData.Type=h.Type,!0}t=null}}}},this.MoveXIndexRight=function(e,a){if(k.Chart.Log("[MinuteFrame::MoveXIndexRight] obj ",a),a.DataType==2){var r=a.IndexData.DayIndex,t=a.IndexData.DataIndex+e,n=-1;if(a.IndexData.Type==20)n=0;else if(a.IndexData.Type==10)n=1;else if(a.IndexData.Type==30)n=2;else return!1;for(var s=r,o=n;s<a.Data.length;++s){for(var l=a.Data[s];o<3;++o){var h=l[o];if(!(!h.DayItem||!h.DayItem.Data)){for(t==null&&(t=0);t<h.DayItem.Data.length;++t){var u=h.DayItem.Data[t];if(u){if(h.Type==10){var f=this.MinuteCount*s+t;return a.Point.X=this.GetXFromIndex(f),a.Point.Y=this.GetYFromData(u.Close),a.IndexData.CursorIndex=f,a.IndexData.DayIndex=s,a.IndexData.DataIndex=t,a.IndexData.Type=h.Type,!0}else if(h.Type==20){if(!v.IsNumber(u.Price))continue;return a.Point.X=this.GetLeftExtendXFromIndex(t,h.DayItem),a.Point.Y=this.GetLeftExtendYFromData(u.Price),a.IndexData.CursorIndex=-1,a.IndexData.DayIndex=s,a.IndexData.DataIndex=t,a.IndexData.Type=h.Type,!0}else if(h.Type==30){if(!v.IsNumber(u.Price))continue;return a.Point.X=this.GetRightExtendXFromIndex(t,h.DayItem),a.Point.Y=this.GetRightExtendYFromData(u.Price),a.IndexData.CursorIndex=-1,a.IndexData.DayIndex=s,a.IndexData.DataIndex=t,a.IndexData.Type=h.Type,!0}}}t=null}}o=0}return!1}else if(a.DataType==1){var r=a.IndexData.DayIndex,t=a.IndexData.DataIndex+e,n=-1;if(a.IndexData.Type==2)n=0;else if(a.IndexData.Type==1)n=1;else if(a.IndexData.Type==3)n=2;else return!1;for(var s=n;s<a.Data.length;++s){var h=a.Data[s];if(!(!h.DayItem||!h.DayItem.Data)){for(t==null&&(t=0);t<h.DayItem.Data.length;++t)if(h.Type==1){if(t>=this.XPointCount)break;var C=h.DayItem.DataOffset,u=h.DayItem.Data[t+C];if(!u)continue;var f=t;return a.Point.X=this.GetXFromIndex(f),a.Point.Y=this.GetYFromData(u.Close),a.IndexData.CursorIndex=f,a.IndexData.DayIndex=0,a.IndexData.DataIndex=t,a.IndexData.Type=h.Type,!0}else if(h.Type==2){var u=h.DayItem.Data[t];if(!u||!v.IsNumber(u.Price))continue;return a.Point.X=this.GetLeftExtendXFromIndex(t,h.DayItem),a.Point.Y=this.GetLeftExtendYFromData(u.Price),a.IndexData.CursorIndex=-1,a.IndexData.DayIndex=0,a.IndexData.DataIndex=t,a.IndexData.Type=h.Type,!0}else if(h.Type==3){var u=h.DayItem.Data[t];if(!u||!v.IsNumber(u.Price))continue;return a.Point.X=this.GetRightExtendXFromIndex(t,h.DayItem),a.Point.Y=this.GetRightExtendYFromData(u.Price),a.IndexData.CursorIndex=-1,a.IndexData.DayIndex=0,a.IndexData.DataIndex=t,a.IndexData.Type=h.Type,!0}t=null}}}},this.GetLeftExtendXValidData=function(e,a){var r=this.ChartBorder.GetBorder();if(r.DayBorder){var t=this.GetLeftExtendXData(e,a.Data);if(!t)return!1;var n=parseInt(t.DataIndex.toFixed(0)),s=a.Data[t.DayIndex];if(n>=0&&n<s.Data.length){var o=s.Data[n];if(v.IsNumber(o.Price))return a.IndexData.DataIndex=n,!0}n<0?n=0:n>=s.Data.length&&(n=s.Data.length-1);for(var l=-1,h=n;h>=0;--h){var o=s.Data[h];if(o&&v.IsNumber(o.Price)){l=h;break}}return l<0?!1:(a.IndexData.DataIndex=l,a.IndexData.Point.X=this.GetLeftExtendXFromIndex(l,s),k.Chart.Log("[MinuteFrame::GetLeftExtendXValidData] DayIndex:"+a.IndexData.DayIndex+", Type:"+a.IndexData.Type+", x:"+e+"=>"+a.IndexData.Point.X+", index:"+n+"=>"+l),!0)}else{var n=this.GetLeftExtendXData(e,a.Data);if(n=parseInt(n.toFixed(0)),n>=0&&n<a.Data.Data.length){var o=a.Data.Data[n];if(v.IsNumber(o.Price))return a.IndexData.DataIndex=n,!0}n<0?n=0:n>=a.Data.Data.length&&(n=a.Data.Data.length-1);for(var l=-1,h=n;h>=0;--h){var o=a.Data.Data[h];if(v.IsNumber(o.Price)){l=h;break}}if(l<0)for(var h=n+1;h<a.Data.Data.length;++h){var o=a.Data.Data[h];if(v.IsNumber(o.Price)){l=h;break}}return l<0?!1:(a.IndexData.DataIndex=l,a.IndexData.Point.X=this.GetLeftExtendXFromIndex(l,a.Data),k.Chart.Log("[MinuteFrame::GetLeftExtendXValidData] DayIndex:"+a.IndexData.DayIndex+", Type:"+a.IndexData.Type+", x:"+e+"=>"+a.IndexData.Point.X+", index:"+n+"=>"+l),!0)}},this.GetRightExtendXValidData=function(e,a){var r=this.ChartBorder.GetBorder();if(r.DayBorder){var t=this.GetRightExtendXData(e,a.Data);if(!t)return!1;var n=parseInt(t.DataIndex.toFixed(0)),s=a.Data[t.DayIndex];if(n>=0&&n<s.Data.length){var o=s.Data[n];if(v.IsNumber(o.Price))return a.IndexData.DataIndex=n,!0}n<0?n=0:n>=s.Data.length&&(n=s.Data.length-1);for(var l=-1,h=n;h>=0;--h){var o=s.Data[h];if(o&&v.IsNumber(o.Price)){l=h;break}}return l<0?!1:(a.IndexData.DataIndex=l,a.IndexData.Point.X=this.GetRightExtendXFromIndex(l,s),k.Chart.Log("[MinuteFrame::GetRightExtendXValidData] DayIndex:"+a.IndexData.DayIndex+", Type:"+a.IndexData.Type+", x:"+e+"=>"+a.IndexData.Point.X+", index:"+n+"=>"+l),!0)}else{if(!a||!a.Data)return!1;var n=this.GetRightExtendXData(e,a.Data);if(n=parseInt(n.toFixed(0)),n>=0&&n<a.Data.Data.length){var o=a.Data.Data[n];if(v.IsNumber(o.Price))return a.IndexData.DataIndex=n,!0}n<0?n=0:n>=a.Data.Data.length&&(n=a.Data.Data.length-1);for(var l=-1,h=n;h>=0;--h){var o=a.Data.Data[h];if(v.IsNumber(o.Price)){l=h;break}}if(l<0)for(var h=n+1;h<a.Data.Data.length;++h){var o=a.Data.Data[h];if(v.IsNumber(o.Price)){l=h;break}}return l<0?!1:(a.IndexData.DataIndex=l,a.IndexData.Point.X=this.GetRightExtendXFromIndex(l,a.Data),k.Chart.Log("[MinuteFrame::GetRightExtendXValidData] DayIndex:"+a.IndexData.DayIndex+", Type:"+a.IndexData.Type+", x:"+e+"=>"+a.IndexData.Point.X+", index:"+n+"=>"+l),!0)}},this.GetLeftExtendYFromData=function(e,a,r){if(!r||!r.Range)return this.GetYFromData(e,a);var t=r.Range,n=this.ChartBorder.GetBorder(),s=n.BottomEx-n.TopEx,o=s*(e-t.Min)/(t.Max-t.Min);return n.BottomEx-o},this.GetLeftExtendYData=function(e,a,r){if(!r||!r.Range)return this.GetYData(e,a);var t=r.Range,n=this.ChartBorder.GetBorder(),s=n.BottomEx-n.TopEx;return(n.BottomEx-e)/s*(t.Max-t.Min)+t.Min},this.GetRightExtendMultiDayXFromIndex=function(e,a,r){var t=r.DayBorder,n=t[a.Index],s=a.TotalCount-1,o=n.RightEx,l=n.Right,h=l-o,u=o+h*e/s;return u},this.GetRightExtendXFromIndex=function(e,a){var r=a.TotalCount-1,t=this.ChartBorder.GetBorder();if(t.DayBorder)return this.GetRightExtendMultiDayXFromIndex(e,a,t);var n=t.RightEx,s=this.ChartBorder.RightExtendWidth,o=n+s*e/r;return o},this.GetRightExtendYFromData=function(e,a,r){return this.GetLeftExtendYFromData(e,a,r)},this.GetRightExtendYData=function(e,a,r){return!r||!r.Range?this.GetYData(e,a):this.GetLeftExtendYData(e,a,r)},this.GetRightExtendMultiDayXData=function(e,a,r){for(var t=r.DayBorder,n=0;n<t.length;++n){var s=t[n];if(e>=s.RightEx&&e<=s.Right){if(!a[n])return null;var o=a[n].TotalCount-1,l=s.RightEx,h=s.Right,u=h-l,f=(e-l)*(o*1/u);return{DayIndex:parseInt(n),DataIndex:f}}}return null},this.GetRightExtendXData=function(e,a){var r=this.ChartBorder.GetBorder();if(r.DayBorder)return this.GetRightExtendMultiDayXData(e,a,r);var t=a.TotalCount-1;t<0&&(t=0);var n=r.RightEx,s=r.Right;if(e<=n)return 0;if(e>=s)return t;var o=s-n;return(e-n)*(t*1/o)}}function Jh(){this.newMethod=hn,this.newMethod(),delete this.newMethod,this.ClassName="MinuteHScreenFrame",this.IsHScreen=!0,this.DrawTitleBG=function(){if(!(this.ChartBorder.TitleHeight<=0)){var e=this.ChartBorder.GetHScreenBorder(),a=L(e.RightEx),r=L(e.Top),t=L(e.Bottom),n=this.ChartBorder.TitleHeight,s=t-r;this.Canvas.fillStyle=this.TitleBGColor,this.Canvas.fillRect(a,r,n,s)}},this.DrawToolbar=function(){},this.DrawBeforeDataBG=function(){var e=this.ChartBorder.GetHScreenBorder();if(e.DayBorder){this.DrawMultiDayBeforeDataBG(e);return}if(!(this.ChartBorder.LeftExtendWidth<10&&this.ChartBorder.RightExtendWidth<10)){var a=L(e.Left),r=L(e.Right);if(this.Canvas.fillStyle=this.BeforeBGColor,this.ChartBorder.LeftExtendWidth>10){var t=L(e.Top),n=L(e.TopEx),s=r-a,o=n-t;this.Canvas.fillRect(a,t,s,o)}if(this.ChartBorder.RightExtendWidth>10){var t=e.BottomEx,n=e.Bottom,s=r-a,o=n-t;this.Canvas.fillRect(a,t,s,o)}}},this.DrawMultiDayBeforeDataBG=function(e){var a=e.DayBorder,r=L(e.Left),t=L(e.Right),n=t-r;this.Canvas.strokeStyle=this.MultiDayBorderPen;for(var s=0;s<a.length;++s){var o=0,l=a[s],h=L(l.Top),u=L(l.TopEx),f=u-h;f>3&&(this.Canvas.fillStyle=this.BeforeBGColor,this.Canvas.fillRect(r,h,n,f),++o);var h=L(l.BottomEx),u=L(l.Bottom),f=u-h;f>3&&(this.Canvas.fillStyle=this.AfterBGColor,this.Canvas.fillRect(r,h,n,f),++o),o==2&&s!=a.length-1&&(this.Canvas.beginPath(),this.Canvas.moveTo(r,u),this.Canvas.lineTo(t,u),this.Canvas.stroke())}},this.GetYData=function(e){var a=this.ChartBorder.GetHScreenBorder();if(e<a.LeftEx)return this.HorizontalMin;if(e>a.RightEx)return this.HorizontalMax;var r=a.RightEx-a.LeftEx;return(e-a.LeftEx)/r*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin},this.GetMultiDayXData=function(e,a){for(var r=a.DayBorder,t=0;t<r.length;++t){var n=r[t];if(e>=n.Top&&e<=n.Bottom){var s=this.MinuteCount-1,o=this.MinuteCount*t;if(e<=n.TopEx)return 0+o;if(e>=n.BottomEx)return s+o;var l=n.BottomEx-n.TopEx;return(e-n.TopEx)*(s*1/l)+o}}},this.GetXData=function(e){var a=this.XPointCount-1;a<0&&(a=0);var r=this.ChartBorder.GetHScreenBorder();if(r.DayBorder)return this.GetMultiDayXData(e,r);if(e<=r.TopEx)return 0;if(e>=r.BottomEx)return a;var t=r.BottomEx-r.TopEx;return(e-r.TopEx)*(a*1/t)},this.GetMultiDayXFromIndex=function(e,a){var r=a.DayBorder,t=e%this.MinuteCount,n=parseInt(e/this.MinuteCount);n>=r.length&&(n=r.length-1);var s=r[n],o=this.MinuteCount-1;if(t>=o)return s.BottomEx;var l=s.BottomEx-s.TopEx,h=s.TopEx+l*t/o;return h},this.GetXFromIndex=function(e){var a=this.XPointCount-1,r=this.ChartBorder.GetHScreenBorder();if(r.DayBorder)return this.GetMultiDayXFromIndex(e,r);if(a==1)return e==0?r.TopEx:r.BottomEx;if(a<=0)return r.TopEx;if(e>=a)return r.BottomEx;var t=r.BottomEx-r.TopEx,n=r.TopEx+t*e/a;return n},this.GetYFromData=function(e){var a=this.ChartBorder.GetHScreenBorder();if(e<=this.HorizontalMin)return a.LeftEx;if(e>=this.HorizontalMax)return a.RightEx;var r=(a.RightEx-a.LeftEx)*(e-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return a.LeftEx+r},this.DrawVolTitle=function(e){if(U.IsShowMinuteVolTitle(e)&&this.Identify==1){var a=B(),r=this.ChartBorder.GetRight()-2*a,t=this.ChartBorder.GetTopEx()+2*a,n=r,s=t;this.Canvas.save(),this.Canvas.translate(n,s),this.Canvas.rotate(90*Math.PI/180);var o=this.YInsideOffset,l=0;if(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",d.Minute.VolBarColor||d.Minute.VolTitleColor){d.Minute.VolBarColor?this.Canvas.fillStyle=d.Minute.VolBarColor:this.Canvas.fillStyle=d.Minute.VolTitleColor;var h=this.YSplitOperator.LanguageID,u=St.GetText("MVol-Vol",h);this.Canvas.fillText(u,o,l),o+=this.Canvas.measureText(u).width,o+=6*B()}this.IsShowPositionTitle&&(u=St.GetText("MVol-Position",h),this.Canvas.fillStyle=d.Minute.PositionColor,this.Canvas.fillText(u,o,l)),this.Canvas.restore()}},this.DrawHorizontal=function(){for(var e=this.ChartBorder.GetHScreenBorder(),a=e.Top,r=e.Bottom,t=e.Left,n=e.Right,s=this.ChartBorder.Top,o=this.ChartBorder.Bottom,l=null,h=this.HorizontalInfo.length-1;h>=0;--h){var u=this.HorizontalInfo[h],f=this.GetYFromData(u.Value);if(!(f!=null&&Math.abs(f-l)<this.MinYDistance)){if(this.Canvas.strokeStyle=u.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(f),a),this.Canvas.lineTo(L(f),r),this.Canvas.stroke(),f>=n-2)this.Canvas.textBaseline="top",f=n;else if(f<=t+2){if(this.Canvas.textBaseline="bottom",f=t,f!=null&&Math.abs(f-l)<2*this.MinYDistance)continue}else this.Canvas.textBaseline="middle";if(u.Message[0]!=null&&s>10){u.Font!=null&&(this.Canvas.font=u.Font),this.Canvas.fillStyle=u.TextColor,this.Canvas.textAlign="right";var C=f,D=a;this.Canvas.save(),this.Canvas.translate(C,D),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(u.Message[0],-2,0),this.Canvas.restore()}if(u.Message[1]!=null&&o>10){u.Font!=null&&(this.Canvas.font=u.Font),this.Canvas.fillStyle=u.TextColor,this.Canvas.textAlign="left";var C=f,D=r;this.Canvas.save(),this.Canvas.translate(C,D),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(u.Message[1],2,0),this.Canvas.restore()}l=f}}},this.DrawInsideClientHorizontal=function(){for(var e=this.GetBorder(),a=e.Left,r=e.Right,t=e.BottomEx,n=e.TopEx,s=null,o=this.HorizontalInfo.length-1;o>=0;--o){var l=this.HorizontalInfo[o];if(!(!l||!l.Message[2]||!l.Message[3])){var h=this.GetYFromData(l.Value);if(!(h!=null&&s!=null&&Math.abs(h-s)<this.MinYDistance)){if(h>=r-2)this.Canvas.textBaseline="top",h=r;else if(h<=a+2){if(this.Canvas.textBaseline="bottom",h=a,h!=null&&Math.abs(h-s)<2*this.MinYDistance)continue}else this.Canvas.textBaseline="middle";if(l.Message[2]){l.Font!=null&&(this.Canvas.font=l.Font),this.Canvas.fillStyle=l.TextColor,this.Canvas.textAlign="left";var u=h,f=n;this.Canvas.save(),this.Canvas.translate(u,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(l.Message[2],2,0),this.Canvas.restore()}if(l.Message[3]){l.Font!=null&&(this.Canvas.font=l.Font),this.Canvas.fillStyle=l.TextColor,this.Canvas.textAlign="right";var u=h,f=t;this.Canvas.save(),this.Canvas.translate(u,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(l.Message[3],-2,0),this.Canvas.restore()}s=h}}}},this.DrawVertical=function(){var e=this.ChartBorder.GetHScreenBorder(),a=e.Left,r=e.Right,t=e.Bottom,n=null;for(var s in this.VerticalInfo){var o=this.GetXFromIndex(this.VerticalInfo[s].Value);if(o>t)break;if(!(n!=null&&Math.abs(o-n)<this.MinXDistance)){if(this.Canvas.strokeStyle=this.VerticalInfo[s].LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(a,L(o)),this.Canvas.lineTo(r,L(o)),this.Canvas.stroke(),this.VerticalInfo[s].Message[0]!=null){this.VerticalInfo[s].Font!=null&&(this.Canvas.font=this.VerticalInfo[s].Font),this.Canvas.fillStyle=this.VerticalInfo[s].TextColor;var l=this.Canvas.measureText(this.VerticalInfo[s].Message[0]).width;o<l/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top"):o+l/2>=this.ChartBorder.GetChartHeight()?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top"):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top");var h=a,u=o;this.Canvas.save(),this.Canvas.translate(h,u),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.VerticalInfo[s].Message[0],0,0),this.Canvas.restore()}n=o}}},this.DrawInsideHorizontal=function(){if(!this.IsMinSize&&!(this.IsShowYText[0]===!1&&this.IsShowYText[1]===!1)){this.DrawInsideClientHorizontal();var e=this.ChartBorder.GetHScreenBorder(),a=e.Left,r=e.RightEx,t=e.Top,n=e.Bottom,s=this.ChartBorder.Top,o=this.ChartBorder.Bottom;this.ChartBorder.TitleHeight;var l=B();if(s<10*l&&this.IsShowYText[0]===!0||o<10*l&&this.IsShowYText[1]===!0)for(var l=B(),h=null,u=null,f=this.HorizontalInfo.length-1;f>=0;--f){var C=this.HorizontalInfo[f],D=this.GetYFromData(C.Value);if(!(D!=null&&h!=null&&Math.abs(D-h)<this.MinYDistance)){if(C.Message[0]!=null&&s<10*l&&this.IsShowYText[0]===!0){C.Font!=null&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="left",D>=r-2?this.Canvas.textBaseline="top":D<=a+2?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,C.Message[0];var c=D,T=t;this.Canvas.save(),this.Canvas.translate(c,T),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(C.Message[0],2*l,0),this.Canvas.restore(),(u==null||u<c)&&(this.YInsideOffset=this.Canvas.measureText(C.Message[0]).width+4*B(),u=c)}if(C.Message[1]!=null&&o<10*l&&this.IsShowYText[1]===!0){C.Font!=null&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="right",D>=r-2?this.Canvas.textBaseline="top":D<=a+2?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle";var S=this.Canvas.measureText(C.Message[1]).width;r-S,this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,C.Message[1];var c=D,T=n;this.Canvas.save(),this.Canvas.translate(c,T),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(C.Message[1],-2*l,0),this.Canvas.restore()}h=D}}}},this.GetLeftExtendXFromIndex=function(e,a){var r=a.TotalCount-1,t=this.ChartBorder.GetHScreenBorder();if(t.DayBorder)return this.GetLeftExtendMultiDayXFromIndex(e,a,t);var n=t.Top,s=this.ChartBorder.LeftExtendWidth,o=n+s*e/r;return o},this.GetLeftExtendMultiDayXFromIndex=function(e,a,r){var t=r.DayBorder,n=t[a.Index],s=a.TotalCount-1,o=n.Top,l=n.TopEx,h=l-o,u=o+h*e/s;return u},this.GetLeftExtendMultiDayXData=function(e,a,r){for(var t=r.DayBorder,n=0;n<t.length;++n){var s=t[n];if(e>=s.Top&&e<=s.TopEx){if(!a[n])return null;var o=a[n].TotalCount-1,l=s.Top,h=s.TopEx,u=h-l,f=(e-l)*(o*1/u);return{DayIndex:parseInt(n),DataIndex:f}}}return null},this.GetLeftExtendXData=function(e,a){var r=this.ChartBorder.GetHScreenBorder();if(r.DayBorder)return this.GetLeftExtendMultiDayXData(e,a,r);var t=a.TotalCount-1;t<0&&(t=0);var n=r.Top,s=r.TopEx;if(e<=n)return 0;if(e>=s)return t;var o=s-n;return(e-n)*(t*1/o)},this.GetLeftExtendYFromData=function(e,a,r){if(!r||!r.Range)return this.GetYFromData(e,a);var t=r.Range,n=this.ChartBorder.GetHScreenBorder(),s=n.RightEx-n.LeftEx,o=s*(e-t.Min)/(t.Max-t.Min);return n.LeftEx+o},this.GetLeftExtendYData=function(e,a,r){if(!r||!r.Range)return this.GetYData(y,a);var t=r.Range,n=this.ChartBorder.GetHScreenBorder(),s=n.RightEx-n.LeftEx;return(e-n.LeftEx)/s*(t.Max-t.Min)+t.Min},this.GetRightExtendMultiDayXFromIndex=function(e,a,r){var t=r.DayBorder,n=t[a.Index],s=a.TotalCount-1,o=n.BottomEx,l=n.Bottom,h=l-o,u=o+h*e/s;return u},this.GetRightExtendXFromIndex=function(e,a){var r=a.TotalCount-1,t=this.ChartBorder.GetHScreenBorder();if(t.DayBorder)return this.GetRightExtendMultiDayXFromIndex(e,a,t);var n=t.BottomEx,s=this.ChartBorder.RightExtendWidth,o=n+s*e/r;return o},this.GetRightExtendMultiDayXData=function(e,a,r){for(var t=r.DayBorder,n=0;n<t.length;++n){var s=t[n];if(e>=s.BottomEx&&e<=s.Bottom){if(!a[n])return null;var o=a[n].TotalCount-1,l=s.BottomEx,h=s.Bottom,u=h-l,f=(e-l)*(o*1/u);return{DayIndex:parseInt(n),DataIndex:f}}}return null},this.GetRightExtendXData=function(e,a){var r=this.ChartBorder.GetHScreenBorder();if(r.DayBorder)return this.GetRightExtendMultiDayXData(e,a,r);var t=a.TotalCount-1;t<0&&(t=0);var n=r.BottomEx,s=r.Bottom;if(e<=n)return 0;if(e>=s)return t;var o=s-n;return(e-n)*(t*1/o)},this.GetRightExtendYFromData=function(e,a,r){return!r||!r.Range?this.GetYFromData(e,a):this.GetLeftExtendYFromData(e,a,r)},this.DrawNightDayBG=function(){if(this.DayCount==1&&this.HQChart&&this.HQChart.EnableNightDayBG){var e=this.HQChart.Symbol;if(e){var a=-1,r=this.GetEventCallback($.ON_CUSTOM_MINUTE_NIGHT_DAY_X_INDEX);if(!(!r||!r.Callback)){var t={Symbol:e,XIndex:a,MinuteTimeStringData:Wi};if(r.Callback(r,t,this),a=t.XIndex,!(a<0)){var n=this.ChartBorder.GetHScreenBorder(),s=this.GetXFromIndex(a),o={Left:n.Left,Top:n.Top,Right:n.RightEx,Bottom:s};if(o.Width=o.Right-o.Left,o.Height=o.Bottom-o.Top,this.Canvas.fillStyle=this.NightDayConfig.NightBGColor,this.Canvas.fillRect(o.Left,o.Top,o.Width,o.Height),this.Identify==0){this.Canvas.font=this.NightDayConfig.Font,this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left";for(var l=[{Title:"夜盘",Position:1,Config:this.NightDayConfig.Night},{Title:"日盘",Position:0,Config:this.NightDayConfig.Day}],h=this.Canvas.measureText("擎").width,u=0;u<l.length;++u){var f=l[u],C=St.GetText(f.Title,this.HQChart.LanguageID),D=this.Canvas.measureText(C).width,c={Height:D+f.Config.Margin.Left+f.Config.Margin.Right,Width:h+f.Config.Margin.Top+f.Config.Margin.Bottom,Left:n.Left};c.Right=c.Left+c.Width,f.Position===1?(c.Bottom=s-1,c.Top=c.Bottom-c.Height):(c.Top=s+1,c.Bottom=c.Top+c.Height),f.Config.BGColor&&(this.Canvas.fillStyle=f.Config.BGColor,this.Canvas.fillRect(c.Left,c.Top,c.Width,c.Height)),f.Config.BorderColor&&(this.Canvas.strokeStyle=f.Config.BorderColor,this.Canvas.strokeRect(L(c.Left),L(c.Top),b(c.Width),b(c.Height))),this.Canvas.fillStyle=f.Config.Color;var T=c.Left,S=c.Top;this.Canvas.save(),this.Canvas.translate(T,S),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(C,f.Config.Margin.Left,-f.Config.Margin.Bottom),this.Canvas.restore()}}}}}}}}function hh(){this.newMethod=hn,this.newMethod(),delete this.newMethod,this.ClassName="OverlayMinuteFrame",this.IsShow=!0,this.IsShareY=!1,this.IsCalculateYMaxMin=!0,this.IsShowMainFrame=0,this.Draw=function(){this.SplitXYCoordinate(),this.IsShow,this.SizeChange=!1,this.XYSplit=!1,this.XSplit=!1,this.YCustomSplit=!1},this.DrawToolbar=function(){},this.GetScaleTextWidth=function(){return{TextWidth:0}},this.SplitXYCoordinate=function(){if(this.XYSplit!=!1)if(this.IsShareY){this.HorizontalMax=this.MainFrame.HorizontalMax,this.HorizontalMin=this.MainFrame.HorizontalMin,this.HorizontalInfo=[];for(var e=0;e<this.MainFrame.HorizontalInfo.length;++e){var a=this.MainFrame.HorizontalInfo[e];this.HorizontalInfo.push(a)}}else this.YSplitOperator!=null&&this.YSplitOperator.Operator()}}function lh(){this.newMethod=Jh,this.newMethod(),delete this.newMethod,this.ClassName="OverlayMinuteHScreenFrame",this.IsShow=!0,this.Draw=function(){this.SplitXYCoordinate(),this.IsShow,this.SizeChange=!1,this.XYSplit=!1,this.XSplit=!1,this.YCustomSplit=!1},this.SplitXYCoordinate=function(){if(this.XYSplit!=!1)if(this.IsShareY){this.HorizontalMax=this.MainFrame.HorizontalMax,this.HorizontalMin=this.MainFrame.HorizontalMin,this.HorizontalInfo=[];for(var e in this.MainFrame.HorizontalInfo){var a=this.MainFrame.HorizontalInfo[e];this.HorizontalInfo.push(a)}}else this.YSplitOperator!=null&&this.YSplitOperator.Operator()}}function us(){this.newMethod=zh,this.newMethod(),delete this.newMethod,this.ClassName="KLineFrame",this.ToolbarID=Re(),this.ModifyIndex=d.KLineToolbar.ModifyIndex,this.ChangeIndex=d.KLineToolbar.ChangeIndex,this.CloseIndex=d.KLineToolbar.CloseIndex,this.OverlayIndex=d.KLineToolbar.OverlayIndex,this.MaxMinWindow=d.KLineToolbar.MaxMinWindow,this.TitleWindow=d.KLineToolbar.TitleWindow,this.ExportData=d.KLineToolbar.ExportData,this.SelBorderColor=d.SelFrameBorderColor,this.ToolbarRect=null,this.ReDrawToolbar=!1,this.LastCalculateStatus={Width:0,XPointCount:0},this.CustomHorizontalInfo=[],this.IsDrawTitleBG=!1,this.IsShowNameArrow=!1,this.CustomVerticalInfo=[],this.DrawCustomVerticalEvent,this.RightSpaceCount=0,this.Logarithmic=null,this.CustomToolbar=[],this.ToolbarType=0,this.DrawToolbar=function(){if(this.ToolbarButtonStyle!=1&&d.IsDOMFrameToolbar!==!0&&!(typeof yt.default>"u")&&!(!this.ChartBorder.UIElement||!this.ChartBorder.UIElement.parentNode)){var e=document.getElementById(this.ToolbarID);if(!(e&&this.SizeChange==!1&&this.ReDrawToolbar==!1)){if(e||(e=document.createElement("div"),e.className="klineframe-toolbar",e.id=this.ToolbarID,e.oncontextmenu=function(){return!1},e.setAttribute("identify",this.Identify.toString()),this.ChartBorder.UIElement.parentNode.appendChild(e)),!this.ModifyIndex&&!this.ChangeIndex&&!this.OverlayIndex&&!this.CloseIndex&&!v.IsNonEmptyArray(this.CustomToolbar)){e.style.display!="none"&&(e.style.display="none");return}var a=B(),r=parseInt(this.ChartBorder.UIElement.parentElement.style.width.replace("px",""));parseInt(this.ChartBorder.UIElement.parentElement.style.height.replace("px",""));var t=100,n=this.ChartBorder.GetTitleHeight(),s=r-this.ChartBorder.Right/a-t,o=this.ChartBorder.GetTop()/a;if(!(this.ToolbarRect&&this.ToolbarRect.Left==s&&this.ToolbarRect.Top==o&&this.ToolbarRect.Width==t&&this.ToolbarRect.Height==n/a)){this.ToolbarRect={Left:s,Top:o,Width:t,Height:n/a};var l="<span class='index_param icon iconfont icon-index_param' id='modifyindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='调整指标参数'></span>",h="<span class='index_change icon iconfont icon-change_index' id='changeindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='切换指标'></span>",u="<span class='index_overlay icon iconfont icon-overlay_index' id='overlayindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='叠加指标'></span>",f="<span class='index_close icon iconfont icon-close' id='closeindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='关闭指标窗口'></span>",C=l+h+u;if(this.Identify!==0&&this.CloseIndex&&(C+=f),v.IsNonEmptyArray(this.CustomToolbar))for(var D=0;D<this.CustomToolbar.length;++D){var c=this.CustomToolbar[D];C+=c.Html}if(e.style.left=s+"px",e.style.top=o+"px",e.style.width=t+"px",e.style.height=n/a+"px",e.innerHTML=C,this.ChartBorder.UIElement.JSChartContainer,this.Identify,this.ModifyIndex?typeof this.ModifyIndexEvent=="function"&&(0,yt.default)("#"+e.id+" .index_param").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},this.ModifyIndexEvent):(0,yt.default)("#"+e.id+" .index_param").hide(),this.ChangeIndex?typeof this.ChangeIndexEvent=="function"&&(0,yt.default)("#"+e.id+" .index_change").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,IsOverlay:!1},this.ChangeIndexEvent):(0,yt.default)("#"+e.id+" .index_change").hide(),this.OverlayIndex?(0,yt.default)("#"+e.id+" .index_overlay").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,IsOverlay:!0},this.ChangeIndexEvent):(0,yt.default)("#"+e.id+" .index_overlay").hide(),(0,yt.default)("#"+e.id+" .index_close").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},function(T){var S=T.data.Chart,I=T.data.Identify;S.RemoveIndexWindow(I)}),v.IsNonEmptyArray(this.CustomToolbar))for(var D=0;D<this.CustomToolbar.length;++D){var c=this.CustomToolbar[D];(0,yt.default)("#"+c.ID).click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,ID:c.ID},c.Click)}e.style.display="block"}}}},this.DrawToolbarV2=function(e,a){if(d.IsDOMFrameToolbar!==!0&&(this.Buttons=[],this.LeftButtonWidth=0,this.IsMinSize!=!0&&!(this.ChartBorder.TitleHeight<5))){var r=[];if(this.CloseIndex&&this.Identify!==0&&r.push({ID:Rt.CLOSE_INDEX_WINDOW,Style:this.CloseWindowButton}),this.MaxMinWindow&&this.Identify!=0&&r.push({ID:Rt.MAX_MIN_WINDOW,Style:this.MaxMinWindowButton}),this.TitleWindow&&this.Identify!=0&&r.push({ID:Rt.TITLE_WINDOW,Style:this.TitleWindowButton}),this.ExportData&&r.push({ID:Rt.EXPORT_DATA,Style:this.ExportDataButton}),this.OverlayIndex&&r.push({ID:Rt.OVERLAY_INDEX,Style:this.OverlayIndexButton}),this.ChangeIndex&&r.push({ID:Rt.CHANGE_INDEX,Style:this.ChangeIndexButton}),this.ModifyIndex&&r.push({ID:Rt.MODIFY_INDEX_PARAM,Style:this.ModifyIndexParamButton}),v.IsNonEmptyArray(this.CustomToolbar))for(var t=0;t<this.CustomToolbar.length;++t){var n=this.CustomToolbar[t];if(n.ID&&n.Style){var s={ID:n.ID,Style:n.Style,TooltipText:n.TooltipText,Data:n.Data};n.IsLeft===!0||r.push(s)}}if(this.GetEventCallback){var o=this.GetEventCallback($.ON_CUSTOM_RIGHT_TOOLBAR);if(o&&o.Callback){var l={PreventDefault:!1,DefaultButton:r,AryButton:null,FrameID:this.Identify};if(o.Callback(o,l,this),l.PreventDefault){this.DrawTitleButton(l.AryButton,e,a);return}}}this.DrawTitleButton(r,e,a)}},this.GetLeftToolbar=function(e){if(this.GetEventCallback){var a=this.GetEventCallback($.ON_CUSTOM_LEFT_TOOLBAR);if(a&&a.Callback){var r={PreventDefault:!1,AryButton:null,FrameID:this.Identify};if(e&&(e.Overlay&&(r.Title=e.Overlay.Title),e.OverlayID&&(r.OverlayID=e.OverlayID)),a.Callback(a,r,this),r.PreventDefault)return r.AryButton}}if(!v.IsNonEmptyArray(this.CustomToolbar))return null;for(var t=[],n=0;n<this.CustomToolbar.length;++n){var s=this.CustomToolbar[n];if(s.ID&&s.Style){var o={ID:s.ID,Style:s.Style,TooltipText:s.TooltipText,Data:s.Data};s.IsLeft===!0&&t.push(o)}}return t},this.DrawFrame=function(){this.IsMinSize||(this.SplitXYCoordinate(),this.SizeChange==!0&&(this.CalculateDataWidth(),this.Logarithmic&&this.SplitLogarithmicXYCoordinate()),this.BeforeDrawXYCallback&&this.BeforeDrawXYCallback(this),this.DrawTitleBG(),this.DrawCustomHorizontalArea(),this.DrawHorizontal(),this.DrawVertical()),(this.SizeChange==!0||this.ReDrawToolbar==!0)&&(this.DrawToolbar(),this.ReDrawToolbar=!1)},this.GetXFromIndex=function(e,a){if(a===!1)if(e>=0)for(var r=this.ChartBorder.GetLeft()+d.FrameLeftMargin+this.DistanceWidth/2+this.DataWidth/2,t=1;t<=e;++t)r+=this.DistanceWidth+this.DataWidth;else for(var r=this.ChartBorder.GetLeft()+d.FrameLeftMargin-(this.DistanceWidth/2+this.DataWidth+this.DistanceWidth),n=Math.abs(e),t=1;t<n;++t)r-=this.DistanceWidth+this.DataWidth;else{e<0&&(e=0),e>this.xPointCount-1&&(e=this.xPointCount-1);for(var r=this.ChartBorder.GetLeft()+d.FrameLeftMargin+this.DistanceWidth/2+this.DataWidth/2,t=1;t<=e;++t)r+=this.DistanceWidth+this.DataWidth}return r},this.GetXData=function(e,a){var r=this.DistanceWidth,t=this.DataWidth,n=this.ChartBorder.GetLeft()+d.FrameLeftMargin,s=1e4*50;if(a==!1)if(e<this.ChartBorder.GetLeft()){for(var o=-1,l=this.ChartBorder.GetLeft()-(r/2+t+r);o>-s&&!(l<=e);)l-=t+r,--o;return o}else{for(var o=0,l=n+r/2+t+r;o<s&&!(l>=e);)l+=t+r,++o;return o}else{if(e<=this.ChartBorder.GetLeft())return 0;if(e>=this.ChartBorder.GetRight())return this.XPointCount-1;for(var h=this.ChartBorder.GetRight()-d.FrameRightMargin,o=0,l=n+r/2+t+r;l<h&&o<s&&o+1<this.XPointCount&&!(l>=e);)l+=t+r,++o;return o}},this.CalculateDataWidth=function(){if(!(this.XPointCount<2)){var e=this.GetFrameWidth()-d.FrameMargin;if(this.ZoomIndex>=0&&this.LastCalculateStatus.Width==e&&this.LastCalculateStatus.XPointCount==this.XPointCount){var a=this.DistanceWidth/2+d.FrameLeftMargin+(this.DataWidth+this.DistanceWidth)*(this.XPointCount-1),r=(this.DataWidth+this.DistanceWidth)*this.XPointCount;if(this.DataWidth<2){if(r<=e)return}else if(a<=e)return}this.LastCalculateStatus.Width=e,this.LastCalculateStatus.XPointCount=this.XPointCount;for(var t=0;t<ue.length;++t)if((ue[t][0]+ue[t][1])*this.XPointCount<e){this.ZoomIndex=t,this.DataWidth=ue[t][0],this.DistanceWidth=ue[t][1],this.TrimKLineDataWidth(e),k.Chart.Log("[KLineFrame::CalculateDataWidth] ZOOM_SEED, DataWidth, DistanceWidth, XPointCount",ue[this.ZoomIndex],this.DataWidth,this.DistanceWidth,this.XPointCount);return}this.ZoomIndex=ue.length-1,this.DataWidth=e/this.XPointCount,this.DistanceWidth=0}},this.OnSize=function(e){for(var a=this.GetFrameWidth()-d.FrameMargin,r=0,t=this.DistanceWidth/2+d.FrameLeftMargin+(this.DataWidth+this.DistanceWidth);t<a;t+=this.DataWidth+this.DistanceWidth,++r);return e.CurCount=this.XPointCount,e.CalcCount=r,e.DataWidth=this.DataWidth,e.DistanceWidth=this.DistanceWidth,e.Changed=!1,this.LastCalculateStatus.Width=a,e.CurCount==e.CalcCount||(this.XPointCount=r,this.LastCalculateStatus.XPointCount=this.XPointCount,this.Data&&(this.Data.DataOffset+=e.CurCount-e.CalcCount,this.Data.DataOffset<0&&(this.Data.DataOffset=0),e.Changed=!0)),e},this.SetDataWidth=function(e){var a=ue.length-1;for(var r in ue){var t=ue[r];if(t[0]<=e){a=parseInt(r)-1;break}}this.ZoomIndex=a,this.DataWidth=ue[this.ZoomIndex][0],this.DistanceWidth=ue[this.ZoomIndex][1];for(var n=this.GetFrameWidth()-d.FrameMargin,s=0,o=this.DistanceWidth/2+d.FrameLeftMargin+(this.DataWidth+this.DistanceWidth);o<=n;o+=this.DataWidth+this.DistanceWidth,++s);this.XPointCount=s,this.LastCalculateStatus.XPointCount=this.XPointCount,this.LastCalculateStatus.Width=n;var l={XPointCount:this.XPointCount,DataWidth:this.DataWidth,DistanceWidth:this.DistanceWidth};return l},this.TrimKLineDataWidth=function(e){var a=ue[this.ZoomIndex][0],r=ue[this.ZoomIndex][1];if(a==1&&r==0){this.DataWidth=e/this.XPointCount;return}for(;;){if((this.DistanceWidth+this.DataWidth)*this.XPointCount+this.DistanceWidth>e){this.DistanceWidth-=.01;break}this.DistanceWidth+=.01}},this.IsOverlayMaxMin=function(e){if(!this.ChartKLine||!this.ChartKLine.Max||!this.ChartKLine.Min)return!1;var a=this.Canvas.measureText(e.Text.Value).width+4;e.Text.TextAlign==="right"&&(e.X-=a);var r=this.ChartKLine.Max,t=this.ChartKLine.Min,n=!1,s=!1,o=20;if(r.X>=e.X&&r.X<=e.X+a){var l=r.Y+o,h=r.Y-o;(l>=e.Y-o&&l<=e.Y+o||h>=e.Y-o&&h<=e.Y+o)&&(n=!0)}if(n==!0)return!0;if(t.X>=e.X&&t.X<=e.X+a){var l=t.Y+o,h=t.Y-o;(l>=e.Y-o&&l<=e.Y+o||h>=e.Y-o&&h<=e.Y+o)&&(s=!0)}return n||s},this.SplitXYCoordinate=function(){if(this.XYSplit==!1){this.XSplit&&this.XSplitOperator&&this.XSplitOperator.Operator(),this.YCustomSplit&&this.YSplitOperator&&this.YSplitOperator.CustomCoordinate&&this.YSplitOperator.CustomCoordinate();return}this.YSplitOperator!=null&&this.YSplitOperator.Operator(),this.XSplitOperator!=null&&this.XSplitOperator.Operator(),this.Logarithmic&&this.SplitLogarithmicXYCoordinate()},this.SplitLogarithmicXYCoordinate=function(){for(var e=this.Logarithmic.Up,a=this.Logarithmic.Down,r=0,t=0,n=Math.max(e.length,a.length),s=[],o=0;o<n;++o)s[o]=o*2;for(var o=0,l=s.length-1;o<e.length;++o,--l){var h=e[o];h.LogHeight=s[l],r+=h.LogHeight,++t}for(var o=0,l=s.length-1;o<a.length;++o,--l){var h=a[o];h.LogHeight=s[l],r+=h.LogHeight,++t}var u=2*B(),f=this.ChartBorder.GetTopEx(),C=this.ChartBorder.GetBottomEx(),D=C-f,c=(D-r*u)/t;if(c<0&&(c=0,u=D/r),this.CoordinateType==1){for(var T=f,o=a.length-1;o>=0;--o){var h=a[o];h.Height=c+u*h.LogHeight,h.Top=T,h.Bottom=h.Top+h.Height,T=h.Bottom}for(var S=C,o=e.length-1;o>=0;--o){var h=e[o];h.Height=c+u*h.LogHeight,h.Bottom=S,h.Top=S-h.Height,S=h.Top}}else{for(var T=f,o=e.length-1;o>=0;--o){var h=e[o];h.Height=c+u*h.LogHeight,h.Top=T,h.Bottom=h.Top+h.Height,T=h.Bottom}for(var S=C,o=a.length-1;o>=0;--o){var h=a[o];h.Height=c+u*h.LogHeight,h.Bottom=S,h.Top=S-h.Height,S=h.Top}}k.Chart.Log("[KLineFrame::SplitLogarithmicXYCoordinate]",this.Logarithmic)},this.GetYLogarithmicFromData=function(e,a){if(this.CoordinateType==1){if(e<=this.HorizontalMin)return this.ChartBorder.GetTopEx();if(e>=this.HorizontalMax)return this.ChartBorder.GetBottomEx();if(e>this.Logarithmic.OpenPrice){var r=this.Logarithmic.Up;for(var t in r){var n=r[t];if(e>=n.Start&&e<=n.End){var s=n.Bottom-n.Top,o=s*(e-n.Start)/(n.End-n.Start);return n.Top+o}}}else{var l=this.Logarithmic.Down;for(var t in l){var n=l[t];if(e>=n.Start&&e<=n.End){var s=n.Bottom-n.Top,o=s*(e-n.Start)/(n.End-n.Start);return n.Top+o}}}}else{if(e<=this.HorizontalMin)return this.ChartBorder.GetBottomEx();if(e>=this.HorizontalMax)return this.ChartBorder.GetTopEx();if(e>this.Logarithmic.OpenPrice){var r=this.Logarithmic.Up;for(var t in r){var n=r[t];if(e>=n.Start&&e<=n.End){var s=n.Bottom-n.Top,o=s*(e-n.Start)/(n.End-n.Start);return n.Bottom-o}}}else{var l=this.Logarithmic.Down;for(var t in l){var n=l[t];if(e>=n.Start&&e<=n.End){var s=n.Bottom-n.Top,o=s*(e-n.Start)/(n.End-n.Start);return n.Bottom-o}}}}},this.GetYLogarithmicData=function(e){if(this.CoordinateType==1){if(e<this.ChartBorder.GetTopEx())return this.HorizontalMin;if(e>this.ChartBorder.GetBottomEx())return this.HorizontalMax;var a=this.Logarithmic.Up;for(var r in a){var t=a[r];if(e>=t.Top&&e<=t.Bottom)return(e-t.Top)/t.Height*(t.End-t.Start)+t.Start}var n=this.Logarithmic.Down;for(var r in n){var t=n[r];if(e>=t.Top&&e<=t.Bottom)return(e-t.Top)/t.Height*(t.End-t.Start)+t.Start}}else{if(e<this.ChartBorder.GetTopEx())return this.HorizontalMax;if(e>this.ChartBorder.GetBottomEx())return this.HorizontalMin;var a=this.Logarithmic.Up;for(var r in a){var t=a[r];if(e>=t.Top&&e<=t.Bottom)return(t.Bottom-e)/t.Height*(t.End-t.Start)+t.Start}var n=this.Logarithmic.Down;for(var r in n){var t=n[r];if(e>=t.Top&&e<=t.Bottom)return(t.Bottom-e)/t.Height*(t.End-t.Start)+t.Start}}},this.CalculateCount=function(e){var a=ue[e][0],r=ue[e][1],t=this.GetFrameWidth()-d.FrameMargin-r/2;return parseInt(t/(a+r))},this.ZoomUp=function(e){if(this.ZoomIndex<=0||this.Data.DataOffset<0)return!1;var a=this.Data.Data.length,r=a+this.RightSpaceCount,t=0,n=this.Data.DataOffset+this.XPointCount-1,s=this.Data.DataOffset+e.Index;n>=a&&(t=n-(this.Data.Data.length-1),n=this.Data.Data.length-1,t>this.RightSpaceCount&&(t=this.RightSpaceCount));var o=this.CalculateCount(this.ZoomIndex-1);k.Chart.Log("[KLineFrame::ZoomUp] old status. XPointCount="+o+" ZoomIndex="+this.ZoomIndex+" DataCount= "+this.Data.Data.length+" rightSpaceCount="+t);var l=!1;if(--this.ZoomIndex,e.IsLockRight==!0){var h=this.Data.DataOffset+this.XPointCount;if(o>h)o=h,this.XPointCount=o,this.Data.DataOffset=0;else{var u=n-(o-t)+1;this.XPointCount=o,this.Data.DataOffset=u,this.Data.DataOffset<0&&(this.Data.DataOffset=0)}}else if(o>=r)this.Data.DataOffset=0,this.XPointCount=o,l=!0,k.Chart.Log("[KLineFrame::ZoomUp] Show all data. XPointCount="+o+" ZoomIndex="+this.ZoomIndex+" DataCount= "+a);else{var u=n-(o-t)+1;if(e.ZoomType==1){var f=this.XPointCount-o+1,C=parseInt(e.Index/this.XPointCount*f),D=this.Data.DataOffset+C;D<a&&(u=this.Data.DataOffset+C)}this.XPointCount=o,this.Data.DataOffset=u,this.Data.DataOffset<0&&(this.Data.DataOffset=0),k.Chart.Log("[KLineFrame::ZoomUp] calculate. XPointCount="+o+" ZoomIndex="+this.ZoomIndex+" DataCount= "+a+" DataOffset="+this.Data.DataOffset)}if(this.DataWidth=ue[this.ZoomIndex][0],this.DistanceWidth=ue[this.ZoomIndex][1],!l){var c=this.GetFrameWidth()-d.FrameMargin;this.TrimKLineDataWidth(c)}return this.LastCalculateStatus.XPointCount=this.XPointCount,e.Index=s-this.Data.DataOffset,!0},this.SetXShowCount=function(e){for(var a=-1,r=this.GetFrameWidth()-d.FrameMargin,t=0;t<ue.length;++t){var n=ue[t],s=n[0],o=n[1],r=this.GetFrameWidth()-d.FrameMargin-o/2,l=parseInt((r-o/2)/(s+o));if(l>=e){a=t,this.XPointCount=e,this.ZoomIndex=a,this.DataWidth=s,this.DistanceWidth=o,s<=1&&o==0&&(this.DataWidth=r/this.XPointCount),this.LastCalculateStatus.XPointCount=this.XPointCount,this.LastCalculateStatus.Width=r;return}}this.XPointCount=e,this.ZoomIndex=ue.length-1,this.DataWidth=r/this.XPointCount,this.DistanceWidth=0,this.LastCalculateStatus.XPointCount=this.XPointCount,this.LastCalculateStatus.Width=r},this.XCoordinateZoom=function(e){var a=this.XPointCount;if(e){if(this.ZoomIndex<=0||this.Data.DataOffset<0)return!1;var r=this.ZoomIndex-1,t=this.CalculateCount(r),n=this.Data.Data.length,s=a-t;if(s<=0)return!1;this.Data.DataOffset+=s,this.Data.DataOffset>n&&(this.Data.DataOffset=0)}else{if(this.ZoomIndex+1>=ue.length||this.Data.DataOffset<0)return!1;var r=this.ZoomIndex+1,t=this.CalculateCount(r),s=t-a;this.Data.DataOffset-=s,this.Data.DataOffset<0&&(this.Data.DataOffset=0)}this.XPointCount=t,this.ZoomIndex=r,this.DataWidth=ue[this.ZoomIndex][0],this.DistanceWidth=ue[this.ZoomIndex][1];var o=this.GetFrameWidth()-d.FrameMargin;return this.TrimKLineDataWidth(o),this.LastCalculateStatus.XPointCount=this.XPointCount,!0},this.ZoomDown=function(e,a){if(this.ZoomIndex+1>=ue.length||this.Data.DataOffset<0||this.Data.DataOffset<=0&&e.IsLockRight==!0)return!1;var r=this.Data.Data.length,t=r+this.RightSpaceCount,n=0,s=this.Data.DataOffset+this.XPointCount-1;s>=this.Data.Data.length&&(n=s-(this.Data.Data.length-1),s=this.Data.Data.length-1,n>this.RightSpaceCount&&(n=this.RightSpaceCount));var o=this.CalculateCount(this.ZoomIndex+1),l=this.Data.DataOffset+e.Index;if(k.Chart.Log("[KLineFrame::ZoomDown] old status. XPointCount="+o+" ZoomIndex="+this.ZoomIndex+" DataCount= "+this.Data.Data.length+" lastCursorIndex="+l+" rightSpaceCount="+n),++this.ZoomIndex,e.IsLockRight==!0){var h=this.Data.DataOffset+this.XPointCount;if(o>h)o=h,this.XPointCount=o,this.Data.DataOffset=0;else{var u=s-(o-n)+1;this.XPointCount=o,this.Data.DataOffset=u,this.Data.DataOffset<0&&(this.Data.DataOffset=0)}}else if(o>=t)this.XPointCount=o,this.Data.DataOffset=0,k.Chart.Log("[KLineFrame::ZoomDown] Show all data. XPointCount="+o+" ZoomIndex="+this.ZoomIndex+" DataCount= "+r),o-this.RightSpaceCount>r&&a&&a.ZoomDownloadDataCallback&&a.ZoomDownloadDataCallback({PageSize:o,DataCount:r,RightSpaceCount:this.RightSpaceCount,Count:o-r});else{var u=s-(o-n)+1;if(e.ZoomType==1){var f=o-this.XPointCount+1,C=parseInt(e.Index/this.XPointCount*f),u=this.Data.DataOffset-C;u+(o-this.RightSpaceCount)>=r&&(u=this.Data.DataOffset-f)}this.XPointCount=o,this.Data.DataOffset=u,this.Data.DataOffset<0&&(this.Data.DataOffset=0),k.Chart.Log("[KLineFrame::ZoomDown] calculate. XPointCount="+o+" ZoomIndex="+this.ZoomIndex+" DataCount= "+r+" DataOffset="+this.Data.DataOffset)}this.DataWidth=ue[this.ZoomIndex][0],this.DistanceWidth=ue[this.ZoomIndex][1];{var D=this.GetFrameWidth()-d.FrameMargin;this.TrimKLineDataWidth(D)}return this.LastCalculateStatus.XPointCount=this.XPointCount,e.Index=l-this.Data.DataOffset,!0},this.GetFrameWidth=function(){if(this.IsHScreen){var e=this.ChartBorder.GetHScreenBorder();return e.BottomEx-e.TopEx}else{var e=this.ChartBorder.GetBorder();return e.RightEx-e.LeftEx}},this.DrawCustomHorizontal=function(){if(!this.IsMinSize&&!this.ChartBorder.IsShowTitleOnly&&v.IsNonEmptyArray(this.CustomHorizontalInfo)){var e=this.CustomHorizontalInfo.slice();e.sort(function(n,s){return s.Value-n.Value});for(var a=new Dt.default,r=0;r<e.length;++r){var t=e[r];switch(t.Type){case 0:case 1:this.DrawCustomItem(t,a);break;case 2:case 3:case 4:case 10:this.DrawCustomItem(t,a);break}}}},this.DrawCustomHorizontalArea=function(){if(!this.IsMinSize&&!this.ChartBorder.IsShowTitleOnly&&v.IsNonEmptyArray(this.CustomHorizontalInfo))for(var e=0;e<this.CustomHorizontalInfo.length;++e){var a=this.CustomHorizontalInfo[e];a.Type==5&&this.DrawCustomAreaItem(a)}},this.DrawCustomVerticalItem=function(e){this.Canvas.save(),e.Data.Line.Type==1&&this.Canvas.setLineDash([5,5]),this.Canvas.strokeStyle=e.Data.Line.Color,this.Canvas.beginPath(),e.IsHScreen?(this.Canvas.moveTo(e.Top,L(e.X)),this.Canvas.lineTo(e.Bottom,L(e.X))):(this.Canvas.moveTo(L(e.X),e.Top),this.Canvas.lineTo(L(e.X),e.Bottom)),this.Canvas.stroke(),this.Canvas.restore()},this.DrawCustomVertical=function(){if(this.CustomVerticalInfo&&!(this.CustomVerticalInfo.length<=0)&&this.Data){var e=this.IsHScreen,a=this.ChartBorder.GetTopEx(),r=this.ChartBorder.GetBottomEx(),t=this.DataWidth,n=this.DistanceWidth,s=this.ChartBorder.GetLeft()+n/2+2;e&&(s=this.ChartBorder.GetTop()+n/2+2,a=this.ChartBorder.GetLeftEx(),r=this.ChartBorder.GetRightEx());for(var o=0,l=this.Data.DataOffset;l<this.Data.Data.length&&o<this.XPointCount;++l,++o,s+=t+n){var h=this.Data.Data[l];for(var u in this.CustomVerticalInfo){var f=this.CustomVerticalInfo[u];if(f.Type==0){if(v.IsNumber(f.Time)){if(h.Date!=f.Date||h.Time!=f.Time)continue}else if(h.Date!=f.Date)continue;var C=s,D=s+t,c=C+(D-C)/2,T={X:c,Top:a,Bottom:r,Data:f,IsHScreen:e};this.DrawCustomVerticalItem(T),this.DrawCustomVerticalEvent&&this.DrawCustomVerticalEvent.Callback(this.DrawCustomVerticalEvent,T,this);break}}}for(var l=1;o<this.XPointCount;++l,++o,s+=t+n)for(var u in this.CustomVerticalInfo){var f=this.CustomVerticalInfo[u];if(f.Type==1&&f.Space==l){var C=s,D=s+t,c=C+(D-C)/2,T={X:c,Top:a,Bottom:r,Data:f,IsHScreen:e};this.DrawCustomVerticalItem(T),this.DrawCustomVerticalEvent&&this.DrawCustomVerticalEvent.Callback(this.DrawCustomVerticalEvent,T,this);break}}}},this.DrawSelectedBorder=function(e){if(this.Identify!==0){var a=this.IsHScreen==!0?this.ChartBorder.GetHScreenBorder():this.ChartBorder.GetBorder(),r=L(a.Left),t=L(a.Top),n=L(a.Right),s=L(a.Bottom),o=s-t;if(this.Canvas.strokeStyle=this.SelBorderColor,e.Mode==1){var l=L(a.ChartWidth);this.Canvas.strokeRect(n,t,l-n-1,o)}else this.Canvas.strokeRect(r,t,n-r-1,o)}},this.GetVerticalXCache=function(){if(!v.IsNonEmptyArray(this.VerticalInfo))return null;for(var e=this.DataWidth,a=this.DistanceWidth,r=this.XPointCount,t=new Fe.default,n=0;n<this.VerticalInfo.length;++n){var s=this.VerticalInfo[n];t.add(s.Value)}if(this.IsHScreen)var o=this.ChartBorder.GetHScreenBorder(),l=o.TopEx+a/2+d.FrameLeftMargin;else var o=this.ChartBorder.GetBorder(),l=o.LeftEx+a/2+d.FrameLeftMargin;for(var h=new Dt.default,n=0;n<r;++n,l+=e+a){var u=l,f=l+e,C=u+(f-u)/2;t.has(n)&&h.set(n,C)}return h}}function Fd(){this.newMethod=us,this.newMethod(),delete this.newMethod,this.ClassName="OverlayKLineFrame",this.MainFrame=null,this.IsShareY=!1,this.IsShowMainFrame=0,this.IsCalculateYMaxMin=!0,this.RightOffset=50,this.PenBorder=d.OverlayFrame.BolderPen,this.IsShow=d.KLineToolbar.IsShowOverlayFrame,this.IsShowToolbar=d.KLineToolbar.IsShowOverlayToolbar,this.Title=null,this.TitleColor=d.OverlayFrame.TitleColor,this.TitleFont=d.OverlayFrame.TitleFont,this.IsShowTitle=!0,this.IsYDrawMainFrame=!1,this.BlankWidth=0,this.Style=0,this.YLineExtend=[{Width:2},null],this.Buttons=[],this.CloseButton=At(d.Buttons.CloseOverlayIndex),this.ModifyIndexParamButton=At(d.Buttons.ModifyIndexParam),this.DrawSelectedBorder=null,this.KLineFrame_ReloadResource=this.ReloadResource,this.ReloadResource=function(e){this.KLineFrame_ReloadResource(e),e||(this.CloseButton=At(d.Buttons.CloseOverlayIndex),this.ModifyIndexParamButton=At(d.Buttons.ModifyIndexParam),this.PenBorder=d.OverlayFrame.BolderPen,this.TitleColor=d.OverlayFrame.TitleColor,this.TitleFont=d.OverlayFrame.TitleFont)},this.Draw=function(){this.Buttons=[],!this.ChartBorder.IsShowTitleOnly&&(this.SplitXYCoordinate(),this.IsShow&&(this.DrawVertical(),this.DrawHorizontal(),this.DrawTitle()),this.SizeChange=!1,this.XYSplit=!1,this.XSplit=!1,this.YCustomSplit=!1)},this.GetXHorizontal=function(){var e=this.ChartBorder.GetBorder(),a=e.Right;return a+=this.RightOffset,this.Style==1||(a+=this.BlankWidth),a},this.GetHorizontalWidth=function(){var e=null;return this.YRightTextInfo&&v.IsNumber(this.TextWidthIndex)&&(e=this.YRightTextInfo.AryOverlayWidth[this.TextWidthIndex]),e},this.DrawTitle=function(){if(this.IsShowTitle&&this.Title){var e=this.ChartBorder.GetBorder(),a=this.ChartBorder.GetTopTitle(),r=e.Bottom,t=this.GetXHorizontal(),n=null,s=null;v.IsNonEmptyArray(this.YLineExtend)&&(s=this.YLineExtend[1],n=this.YLineExtend[0]),this.Style==1?(this.Canvas.textBaseline="bottom",s&&s.Width>0?t+=s.Width+1:t+=1):(this.Canvas.textBaseline="top",n&&n.Width>0?t-=n.Width:t-=2);var o=a+(r-a)/2;this.Canvas.fillStyle=this.TitleColor,this.Canvas.font=this.TitleFont,this.Canvas.textAlign="center",this.Canvas.save(),this.Canvas.translate(t,o),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.Title,0,0),this.Canvas.restore()}},this.GetScaleTextWidth=function(){if(!this.IsShow)return null;this.ChartBorder.GetBorder();var e=B();if(this.IsHScreen)var a=this.ChartBorder.Bottom,r=a>10*e&&this.IsShowYText[1]===!0&&this.YTextPosition[1]!=2;else var t=this.ChartBorder.Right,r=t>10&&this.IsShowYText[1]===!0&&this.YTextPosition[1]!=2;if(!r)return null;for(var n={Left:null,Right:0},s=0;s<this.HorizontalInfo.length;++s){var o=null,l=this.HorizontalInfo[s];l&&l.Message[1]!=null&&r&&(l.Font!=null&&(this.Canvas.font=l.Font),o=this.Canvas.measureText(l.Message[1]).width,this.YTextPadding&&v.IsNumber(this.YTextPadding[1])&&(o+=this.YTextPadding[1]),n.Right<o&&(n.Right=o))}if(v.IsNonEmptyArray(this.YLineExtend)){var h=this.YLineExtend[1];h&&h.Width>0&&(n.Right+=h.Width)}return{TextWidth:n}},this.SyncMainHorizontalInfo=function(){if(!this.MainFrame)return!1;this.MainFrame.YMaxMin&&(this.YMaxMin.Max=this.MainFrame.YMaxMin.Max,this.YMaxMin.Min=this.MainFrame.YMaxMin.Min),this.HorizontalMax=this.MainFrame.HorizontalMax,this.HorizontalMin=this.MainFrame.HorizontalMin,this.HorizontalInfo=[];for(var e=0;e<this.MainFrame.HorizontalInfo.length;++e){var a=this.MainFrame.HorizontalInfo[e];this.HorizontalInfo.push(a)}return this.CoordinateType=this.MainFrame.CoordinateType,!0},this.SplitXYCoordinate=function(){this.XYSplit!=!1&&(this.IsShareY?this.SyncMainHorizontalInfo():this.YSplitOperator!=null&&this.YSplitOperator.Operator())},this.DrawHorizontal=function(){var e=this.ChartBorder.GetBorder();e.Left;var a=e.Right,r=e.Bottom,t=this.ChartBorder.GetTopTitle(),n=this.ChartBorder.Right;a+=this.RightOffset;var s=this.GetXHorizontal();v.IsNumber(this.BlankWidth)&&(a+=this.BlankWidth);var o=null;v.IsNonEmptyArray(this.YTextExtend)&&(o=this.YTextExtend[1]);var l=null,h=null;v.IsNonEmptyArray(this.YLineExtend)&&(h=this.YLineExtend[1],l=this.YLineExtend[0]);for(var u=this.GetHorizontalWidth(),f=null,C=this.HorizontalInfo.length-1;C>=0;--C){var D=this.HorizontalInfo[C],c=this.GetYFromData(D.Value);if(!(c!=null&&Math.abs(c-f)<this.MinYDistance)){if(c>=r-2?this.Canvas.textBaseline="bottom":c<=t+2?this.Canvas.textBaseline="top":this.Canvas.textBaseline="middle",l&&l.Width>0&&(this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(s-l.Width,L(c)),this.Canvas.lineTo(s,L(c)),this.Canvas.stroke()),h&&h.Width>0&&(this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(s+h.Width,L(c)),this.Canvas.lineTo(s,L(c)),this.Canvas.stroke()),D.Message[1]!=null&&n>10){D.Font!=null&&(this.Canvas.font=D.Font);var T=D.Message[1];if(Array.isArray(D.Message[1])&&(T=D.Message[1][0]),o&&o.Align){var S=u;this.Canvas.textAlign="right";var I=e.Right+this.RightOffset+S-this.YTextPadding[1];this.Canvas.fillText(T,I,c)}else{var g=a+2;h&&h.Width>0&&(g+=h.Width),this.Canvas.fillStyle=D.TextColor,this.Canvas.textAlign="left",this.Canvas.fillText(T,g,c)}}f=c}}},this.DrawVertical=function(){var e=this.ChartBorder.GetBorder(),a=e.TopEx,r=e.BottomEx,t=this.GetXHorizontal();this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(L(t),L(a)),this.Canvas.lineTo(L(t),L(r)),this.Canvas.stroke()},this.DrawToolbar=function(e,a,r){if(this.Buttons=[],a!=!0&&!this.ChartBorder.IsShowTitleOnly&&!(this.ChartBorder.TitleHeight<5)&&this.IsShowToolbar){var t=[];if(t.push({ID:Rt.MODIFY_OVERLAY_INDEX_PARAM,Style:this.ModifyIndexParamButton}),t.push({ID:Rt.CLOSE_OVERLAY_INDEX,Style:this.CloseWindowButton}),this.GetEventCallback){var n=this.GetEventCallback($.ON_CUSTOM_OVERLAY_TOOLBAR);if(n&&n.Callback){var s={PreventDefault:!1,DefaultButton:t,AryButton:null,Guid:this.Guid};if(n.Callback(n,s,this),s.PreventDefault){this.DrawToolbarButton(s.AryButton,e,r);return}}}this.DrawToolbarButton(t,e,r)}},this.DrawToolbarButton=function(e,a,r){if(v.IsNonEmptyArray(e))for(var t=this.ChartBorder.GetBorder(),n=t.Top+this.ChartBorder.TitleHeight/2,s=this.GetHorizontalWidth(),o=t.Right+this.RightOffset+s-this.CloseButton.MerginLeft,l=e.length-1;l>=0;--l){var h=e[l],u=h.Style.Size,f=u+"px "+h.Style.Family,C={Left:o-u-h.Style.MerginLeft,Top:n-u/2,Right:o,Bottom:n+u/2,Width:u+h.Style.MerginLeft,Height:u},D=this.CloseButton.Color;a&&a.X>=C.Left&&a.X<C.Right&&a.Y>=C.Top&&a.Y<=C.Bottom&&(D=h.Style.MoveOnColor,r&&(r.MouseOnToolbar={Rect:C,Item:h,Frame:this,Point:{X:a.X,Y:a.Y}})),this.Canvas.fillStyle=D,this.Canvas.font=f,this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillText(h.Style.Text,o,n),this.Buttons.push({ID:h.ID,Rect:C}),o=C.Left}},this.DrawCustomItem=function(e,a){if(!(!this.IsShow&&!this.IsYDrawMainFrame)&&!(!e.Message[1]&&!e.Message[0])){if(e.Value>this.HorizontalMax||e.Value<this.HorizontalMin){this.SendDrawCountDownEvent({IsShow:!1});return}var r=this.GetBorder(),t=r.Left,n=r.Right+this.RightOffset;this.IsYDrawMainFrame&&(n=r.Right);var s=r.Bottom,o=r.Top,l=this.ChartBorder.Right,h=this.ChartBorder.Left;this.ChartBorder.TitleHeight,this.IsHScreen&&(h=this.ChartBorder.Top,l=this.ChartBorder.Bottom,o=r.Top,s=r.Bottom);var u=B(),f=18*u,C=f,D=this.GetYFromData(e.Value),c=0,T;if(e.ExtendData&&e.ExtendData.Custom){var S=e.ExtendData.Custom;v.IsNumber(S.Position)&&(c=S.Position),S.EmptyBGColor&&(T=S.EmptyBGColor)}if(e.Message[0])if(h<10||c==1){e.Font!=null&&(this.Canvas.font=e.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(e,!0,u),g=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;var F=e.LineColor,R=this.RGBToStruct(e.LineColor);R&&(F="rgba("+R.R+", "+R.G+", "+R.B+", "+d.FrameLatestPrice.BGAlpha+")");for(var A=D,P=0;P<I.Text.length;++P){var p=I.Text[P];if(this.IsHScreen){var w=o,H=A-C/2-1*u;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,C,p.Width),this.DrawHScreenText({X:A,Y:w},{Text:p.Text,Color:e.TextColor,XOffset:1*u,YOffset:2*u}),P==0&&this.DrawLine(w+p.Width,s,A,e.LineColor,e.LineType,e),A-=C+1*u}else if(p.Type!==1){var w=A-C/2-1*u,H=t+1*u;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,p.Width,C),this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(p.Text,H+1*u,A),P==0&&this.DrawLine(H+p.Width,n,A,e.LineColor,e.LineType,e),A+=C+1*u}}}else{e.Font!=null&&(this.Canvas.font=e.Font),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(e,!0,u),g=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;for(var A=D,P=0;P<I.Text.length;++P){var p=I.Text[P];if(this.IsHScreen){if(P==0)var w=o-p.Width;else var w=o-g;var H=A-C/2-1*u;this.Canvas.fillStyle=e.LineColor,this.Canvas.fillRect(H,w,C,p.Width),this.DrawHScreenText({X:A,Y:w},{Text:p.Text,Color:e.TextColor,XOffset:1*u,YOffset:2*u}),P==0&&this.DrawLine(w+p.Width,s,A,e.LineColor,e.LineType,e),A-=C+1*u}else{var w=A-C/2-1*u;if(P==0)var W=t-p.Width,H=t;else var W=t-g,H=t-(g-p.Width);T?(this.Canvas.fillStyle=T,this.Canvas.fillRect(W-1,w,p.Width+1,C),this.Canvas.strokeStyle=e.LineColor,this.Canvas.strokeRect(L(W-1),L(w),L(p.Width+1),L(C)),this.Canvas.fillStyle=e.LineColor,this.Canvas.fillText(p.Text,H-1*u,A)):(this.Canvas.fillStyle=e.LineColor,this.Canvas.fillRect(W,w,p.Width,C),this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(p.Text,H-1*u,A)),P==0&&this.DrawLine(t,n,A,e.LineColor,e.LineType,e),A+=C+1*u}}}else if(e.Message[1])if(l<10||c==1){e.Font!=null&&(this.Canvas.font=e.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(e,!1,u),g=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;var F=e.LineColor,R=this.RGBToStruct(e.LineColor);R&&(F="rgba("+R.R+", "+R.G+", "+R.B+", "+d.FrameLatestPrice.BGAlpha+")");for(var A=D,P=0;P<I.Text.length;++P){var p=I.Text[P];if(this.IsHScreen){var w=s-p.Width,H=A-C/2-1*u;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,C,g),this.DrawHScreenText({X:A,Y:w},{Text:p.Text,Color:e.TextColor,XOffset:1*u,YOffset:2*u}),P==0&&this.DrawLine(o,w,A,e.LineColor,e.LineType,e),A-=C+1*u}else if(p.Type===1){if(this.GetEventCallback){var w=A-C/2-1*u,ht={Top:w,Right:n,Height:null,IsShow:!0,BGColor:e.LineColor,TextColor:e.TextColor,PixelTatio:u,Position:"Right",IsInside:!0};this.SendDrawCountDownEvent(ht)&&v.IsPlusNumber(ht.Height)&&(A+=C+1*u)}}else{var w=A-C/2-1*u,H=n-p.Width;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,g,C),this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(p.Text,H+1*u,A),P==0&&this.DrawLine(t,H,A,e.LineColor,e.LineType,e),A+=C+1*u}}if((e.Type==3||e.Type==4)&&e.Title){var rt=this.Canvas.measureText(e.Title).width+2*u;if(this.IsHScreen){var w=s-p.Width-rt,H=D-C/2-1*u;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,C,rt),this.DrawHScreenText({X:D,Y:w},{Text:e.Title,Color:e.TextColor,XOffset:1*u,YOffset:2*u})}else{var w=D-C/2-1*u,H=n-g-rt-1*u;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,rt,C),this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(e.Title,H+1*u,D)}}}else{e.Font!=null&&(this.Canvas.font=e.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(e,!1,u),g=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;var nt=null;a&&a.has(3)&&(nt=a.get(3));for(var A=D,vt={},P=0;P<I.Text.length;++P){var p=I.Text[P];if(this.IsHScreen){var w=s,H=A-C/2-1*u;this.Canvas.fillStyle=e.LineColor,this.Canvas.fillRect(H,w,C,p.Width),this.DrawHScreenText({X:A,Y:w},{Text:p.Text,Color:e.TextColor,XOffset:1*u,YOffset:2*u}),P==0&&this.DrawLine(o,w,A,e.LineColor,e.LineType,e),A-=C+1*u}else if(p.Type===1){if(this.GetEventCallback){var w=A-C/2-1*u,ht={Top:w,Left:n,Right:this.ChartBorder.GetChartWidth(),Height:null,IsShow:!0,BGColor:e.LineColor,TextColor:e.TextColor,PixelTatio:u,Position:"Right",IsInside:!1};this.SendDrawCountDownEvent(ht)&&v.IsPlusNumber(ht.Height)&&(A+=C+1*u)}}else{var w=A-C/2-1*u;if(P==0){var H=n;vt.Left=H,nt&&w<nt.Rect.Bottom&&(A=nt.Rect.Bottom,w=A-C/2-1*u)}else var H=n+g-p.Width;T?(this.Canvas.fillStyle=T,this.Canvas.fillRect(H,w,p.Width+1,C),this.Canvas.strokeStyle=e.LineColor,this.Canvas.strokeRect(L(H),L(w),b(p.Width+1),b(C)),this.Canvas.fillStyle=e.LineColor,this.Canvas.fillText(p.Text,H+2*u,A)):(this.Canvas.fillStyle=e.LineColor,this.Canvas.fillRect(H,w,p.Width,C),this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(p.Text,H+1*u,A)),P==0&&this.DrawLine(t,n,D,e.LineColor,e.LineType,e),A+=C+1*u,vt.Bottom=A}}if(a&&v.IsNumber(vt.Left)&&v.IsNumber(vt.Bottom)&&a.set(3,{Rect:vt,Item:e}),(e.Type==3||e.Type==4)&&e.Title){var F=e.LineColor,R=this.RGBToStruct(e.LineColor);R&&(F="rgba("+R.R+", "+R.G+", "+R.B+", "+d.FrameLatestPrice.BGAlpha+")");var rt=this.Canvas.measureText(e.Title).width+2*u;if(this.IsHScreen){var w=s-rt,H=D-C/2-1*u;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,C,rt),this.DrawHScreenText({X:D,Y:w},{Text:e.Title,Color:e.TextColor,XOffset:1*u,YOffset:2*u})}else{var w=D-C/2-1*u,H=n-rt-1*u;this.Canvas.fillStyle=F,this.Canvas.fillRect(H,w,rt,C),this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(e.Title,H+1*u,D)}}}}}}function Zh(){this.newMethod=us,this.newMethod(),delete this.newMethod,this.ClassName="KLineHScreenFrame",this.IsHScreen=!0,this.DrawSelectedBorder=null,this.DrawTitleBG=function(){if(!(this.ChartBorder.TitleHeight<=0)){var e=this.ChartBorder.GetHScreenBorder(),a=L(e.RightTitle),r=L(e.Top),t=L(e.Bottom),n=this.ChartBorder.TitleHeight,s=t-r;this.Canvas.fillStyle=this.TitleBGColor,this.Canvas.fillRect(a,r,n,s)}},this.DrawToolbar=function(){},this.GetYFromData=function(e,a){var r=this.ChartBorder.GetHScreenBorder();if(a===!1){var t=(r.RightEx-r.LeftEx)*(e-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return r.LeftEx+t}else{if(e<=this.HorizontalMin)return r.LeftEx;if(e>=this.HorizontalMax)return r.RightEx;var t=(r.RightEx-r.LeftEx)*(e-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return r.LeftEx+t}},this.IsShowRightHorizontal=function(){var e=B(),a=this.ChartBorder.Bottom;if(a<=10*e||this.YTextPosition[1]==2||this.IsShowYText[1]===!1)return!1;if(this.GlobalOption&&this.GlobalOption.RightHorizontal){var r=this.GlobalOption.RightHorizontal;if(r.Show===!1)return!1}return!0},this.DrawHorizontal=function(){var e=this.ChartBorder.GetHScreenBorder(),a=e.Top,r=e.Bottom,t=this.ChartBorder.Top;this.ChartBorder.Bottom;var n=e.Left;e.Right;for(var s=null,o=B(),l=t>10*o&&this.IsShowYText[0]===!0&&this.YTextPosition[0]!=2,h=this.IsShowRightHorizontal(),u=this.HorizontalInfo.length-1;u>=0;--u){var f=this.HorizontalInfo[u],C=this.GetYFromData(f.Value);if(!(C!=null&&Math.abs(C-s)<this.MinYDistance)){if(C!=n&&(f.LineType==2?(this.Canvas.strokeStyle=f.LineColor,this.Canvas.setLineDash([5*o,5*o]),this.Canvas.beginPath(),this.Canvas.moveTo(L(C),a),this.Canvas.lineTo(L(C),r),this.Canvas.stroke(),this.Canvas.setLineDash([])):f.LineType>0&&(this.Canvas.strokeStyle=f.LineColor,d.FrameYLineDash?(this.Canvas.setLineDash(d.FrameYLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(L(C),a),this.Canvas.lineTo(L(C),r),this.Canvas.stroke(),this.Canvas.setLineDash([])):(this.Canvas.beginPath(),this.Canvas.moveTo(L(C),a),this.Canvas.lineTo(L(C),r),this.Canvas.stroke()))),f.Message[0]!=null&&l){f.Font!=null&&(this.Canvas.font=f.Font),this.Canvas.fillStyle=f.TextColor,this.Canvas.textAlign="right",this.Canvas.textBaseline="middle";var D=C,c=a;this.Canvas.save(),this.Canvas.translate(D,c),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(f.Message[0],-2,0),this.Canvas.restore()}if(f.Message[1]!=null&&h){f.Font!=null&&(this.Canvas.font=f.Font),this.Canvas.fillStyle=f.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var T;Array.isArray(f.Message[1])?T=f.Message[1][0]:T=f.Message[1];var D=C,c=r;this.Canvas.save(),this.Canvas.translate(D,c),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(T,2,0),this.Canvas.restore()}s=C}}},this.DrawInsideHorizontal=function(){if(!this.IsMinSize&&!(this.IsShowYText[0]===!1&&this.IsShowYText[1]===!1)){var e=this.ChartBorder.GetLeft(),a=this.ChartBorder.GetRightEx(),r=this.ChartBorder.GetTop(),t=this.ChartBorder.GetBottom(),n=this.ChartBorder.Top,s=this.ChartBorder.Bottom;this.ChartBorder.TitleHeight;var o=B(),l=(n<10*o||this.YTextPosition[0]==2)&&this.IsShowYText[0]===!0,h=(s<10*o||this.YTextPosition[1]==2)&&this.IsShowYText[1]===!0;if(l||h)for(var o=B(),u=null,f=this.HorizontalInfo.length-1;f>=0;--f){var C=this.HorizontalInfo[f],D=this.GetYFromData(C.Value);if(!(D!=null&&u!=null&&Math.abs(D-u)<this.MinYDistance)){if(C.Message[0]!=null&&l){C.Font!=null&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="left",D>=a-2?this.Canvas.textBaseline="top":D<=e+2?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,C.Message[0];var c=D,T=r;this.Canvas.save(),this.Canvas.translate(c,T),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(C.Message[0],-2,0),this.Canvas.restore()}if(C.Message[1]!=null&&h){if(C.Font!=null&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="right",D>=a-2?this.Canvas.textBaseline="top":D<=e+2?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",Array.isArray(C.Message[1]))var S=C.Message[1][0];else var S=C.Message[1];var I=this.Canvas.measureText(S).width;a-I,this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font;var c=D,T=t;this.Canvas.save(),this.Canvas.translate(c,T),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(S,-2,0),this.Canvas.restore()}u=D}}}},this.GetXFromIndex=function(e,a){if(a===!1){var r=this.ChartBorder.GetHScreenBorder();if(e>=0)for(var t=r.TopEx+d.FrameLeftMargin+this.DistanceWidth/2+this.DataWidth/2,n=1;n<=e;++n)t+=this.DistanceWidth+this.DataWidth;else for(var t=r.TopEx-(this.DistanceWidth/2+this.DataWidth+this.DistanceWidth),s=Math.abs(e),n=1;n<s;++n)t-=this.DistanceWidth+this.DataWidth}else{e<0&&(e=0),e>this.xPointCount-1&&(e=this.xPointCount-1);for(var r=this.ChartBorder.GetHScreenBorder(),t=r.TopEx+d.FrameLeftMargin+this.DistanceWidth/2+this.DataWidth/2,n=1;n<=e;++n)t+=this.DistanceWidth+this.DataWidth}return t},this.DrawVertical=function(){var e=null;this.GetVerticalXCache&&(e=this.GetVerticalXCache());for(var a=this.ChartBorder.GetHScreenBorder(),r=a.Left,t=a.RightTitle,n=a.Bottom,s=B(),o=null,l=0;l<this.VerticalInfo.length;++l){var h=this.VerticalInfo[l],u=null;if(e&&e.has(h.Value)?u=e.get(h.Value):u=this.GetXFromIndex(h.Value),u>=n)break;if(!(o!=null&&Math.abs(u-o)<80)){if(h.LineType==2?(this.Canvas.strokeStyle=this.VerticalInfo[l].LineColor,this.Canvas.setLineDash([5*s,5*s]),this.Canvas.beginPath(),this.Canvas.moveTo(r,L(u)),this.Canvas.lineTo(t,L(u)),this.Canvas.stroke(),this.Canvas.setLineDash([])):h.LineType>0&&(this.Canvas.strokeStyle=this.VerticalInfo[l].LineColor,d.FrameXLineDash?(this.Canvas.setLineDash(d.FrameXLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(r,L(u)),this.Canvas.lineTo(t,L(u)),this.Canvas.stroke(),this.Canvas.setLineDash([])):(this.Canvas.beginPath(),this.Canvas.moveTo(r,L(u)),this.Canvas.lineTo(t,L(u)),this.Canvas.stroke())),this.VerticalInfo[l].Message[0]!=null){this.VerticalInfo[l].Font!=null&&(this.Canvas.font=this.VerticalInfo[l].Font),this.Canvas.fillStyle=this.VerticalInfo[l].TextColor;var f=this.Canvas.measureText(this.VerticalInfo[l].Message[0]).width;u<f/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top"):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top");var C=r,D=u;this.Canvas.save(),this.Canvas.translate(C,D),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.VerticalInfo[l].Message[0],0,this.XBottomOffset),this.Canvas.restore()}o=u}}},this.GetYData=function(e,a){var r=this.ChartBorder.GetHScreenBorder();if(a===!1){var t=r.RightEx-r.LeftEx;return(e-r.LeftEx)/t*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin}else{if(e<r.LeftEx)return this.HorizontalMin;if(e>r.RightEx)return this.HorizontalMax;var t=r.RightEx-r.LeftEx;return(e-r.LeftEx)/t*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin}},this.GetXData=function(e,a){var r=this.ChartBorder.GetHScreenBorder(),t=r.TopEx+d.FrameLeftMargin,n=r.BottomEx,s=this.DistanceWidth,o=this.DataWidth,l=1e4*10;if(a==!1)if(e<t){for(var h=-1,u=t-(s/2+o+s);h>-l&&!(u<=e);)u-=o+s,--h;return h}else{for(var h=0,u=t+s/2+o+s;h<l&&!(u>=e);)u+=o+s,++h;return h}else{if(e<=r.TopEx)return 0;if(e>=r.BottomEx)return this.XPointCount-1;for(var h=0,u=t+s/2+o+s;u<n&&h<l&&h+1<this.XPointCount&&!(u>e);)u+=o+s,++h;return h}},this.DrawBottons=function(){}}function Md(){this.newMethod=Zh,this.newMethod(),delete this.newMethod,this.ClassName="OverlayKLineHScreenFrame",this.MainFrame=null,this.IsShareY=!1,this.IsCalculateYMaxMin=!0,this.RightOffset=50,this.PenBorder=d.OverlayFrame.BolderPen,this.IsShow=!0,this.Title=null,this.TitleColor=d.OverlayFrame.TitleColor,this.TitleFont=d.OverlayFrame.TitleFont,this.Draw=function(){this.SplitXYCoordinate(),this.IsShow&&(this.DrawVertical(),this.DrawHorizontal(),this.DrawTitle()),this.SizeChange=!1,this.XYSplit=!1,this.XSplit=!1,this.YCustomSplit=!1},this.DrawTitle=function(){},this.SplitXYCoordinate=function(){if(this.XYSplit!=!1)if(this.IsShareY){this.HorizontalMax=this.MainFrame.HorizontalMax,this.HorizontalMin=this.MainFrame.HorizontalMin,this.HorizontalInfo=[];for(var e in this.MainFrame.HorizontalInfo){var a=this.MainFrame.HorizontalInfo[e];this.HorizontalInfo.push(a)}}else this.YSplitOperator!=null&&this.YSplitOperator.Operator()},this.DrawHorizontal=function(){},this.DrawVertical=function(){},this.GetScaleTextWidth=function(){return{TextWidth:0}}}function yr(){this.Frame,this.Height,this.OverlayIndex=[]}function ln(){this.Frame,this.ChartPaint=[],this.Identify=Re(),this.Scprit,this.UpdateFrameMaxMin=function(){var e={Max:null,Min:null};if(this.Frame.IsShareY){this.Frame.XYSplit=!0;return}if(this.Frame.YSpecificMaxMin)e.Max=this.Frame.YSpecificMaxMin.Max,e.Min=this.Frame.YSpecificMaxMin.Min;else for(var a=0;a<this.ChartPaint.length;++a){var r=this.ChartPaint[a];if(r.IsShow!=!1){var t=r.GetMaxMin();t==null||t.Max==null||t.Min==null||(v.IsNumber(t.Max)&&(e.Max==null||e.Max<t.Max)&&(e.Max=t.Max),v.IsNumber(t.Min)&&(e.Min==null||e.Min>t.Min)&&(e.Min=t.Min))}}if((!v.IsNumber(this.Frame.YMaxMin.Max)||this.Frame.YMaxMin.Max!=e.Max)&&(this.Frame.YMaxMin.Max=e.Max,this.Frame.XYSplit=!0),(!v.IsNumber(this.Frame.YMaxMin.Min)||this.Frame.YMaxMin.Min!=e.Min)&&(this.Frame.YMaxMin.Min=e.Min,this.Frame.XYSplit=!0),this.Frame.XYSplit){var n=10,s=0;e.Max!=null&&(n=e.Max),e.Min!=null&&(s=e.Min),this.Frame.HorizontalMax=n,this.Frame.HorizontalMin=s}else this.Frame.XYSplit=!0}}function Qh(){this.SubFrame=new Array,this.SizeChange=!0,this.ChartBorder,this.Canvas,this.ScreenImageData,this.Data,this.Position,this.SizeChange=!0,this.MinSubFrameHeight=d.DragSubFrameBorder.MinFrameHeight,this.DragBorderHeight=d.DragSubFrameBorder.TopBorderHeight,this.AutoLeftBorder=null,this.AutoRightBorder=null,this.OverlayBlankWidth=30,this.AuotRightWidth,this.FixedRightWidth={Main:60,Overlay:80},this.ZoomWindowsInfo=null,this.ZoomStartWindowIndex=1,this.GetExtendChartByClassName,this.GetEventCallback,this.OnMoveFromeBorder=function(e,a){if(this.SubFrame.length<=0)return!1;for(var r=this.SubFrame[e],t=null,n=e+1;n<this.SubFrame.length;++n){var s=this.SubFrame[n];if(s.Height>0){t=s;break}}if(!r||!t)return!1;var o=r.Frame.ChartBorder.Bottom,l=t.Frame.ChartBorder.Top;r.Frame.ChartBorder.Bottom-=a,t.Frame.ChartBorder.Top+=a;var h=r.Frame.ChartBorder.GetHeightEx(),u=t.Frame.ChartBorder.GetHeightEx();return h<this.MinSubFrameHeight&&a<0||u<this.MinSubFrameHeight&&a>0?(r.Frame.ChartBorder.Bottom=o,t.Frame.ChartBorder.Top=l,!1):!0},this.ReDrawToolbar=function(){for(var e in this.SubFrame)this.SubFrame[e].Frame.ReDrawToolbar=!0},this.SetFrameBorderSizeChange=function(){var e=this.SubFrame[0];if(!(!e||!e.Frame)){var a=e.Frame.YSplitOperator;a&&a.CoordinateType==2&&(e.Frame.XYSplit=!0)}},this.CancelZoomUpDownFrameY=function(e){var a=e.Index;if(this.SubFrame.length<=0||!this.SubFrame[a])return!1;var r=this.SubFrame[a],t=r.Frame;if(e.IsOverlay){var n=r.OverlayIndex[e.OverlayIndex];if(!n)return!1;n.Frame.IsShareY||(t=n.Frame)}var s=t.YSplitOperator;if(s.FixedYMaxMin){s.FixedYMaxMin=null,s.EnableZoomUpDown=!1,t.XYSplit=!0;for(var o in r.OverlayIndex){var l=r.OverlayIndex[o];l.Frame.IsShareY&&(l.Frame.XYSplit=!0)}return k.Chart.Log("[HQTradeFrame::CancelZoomUpDownFrameY]"),!0}return!1},this.OnZoomUpDownFrameY=function(e,a){var r=e.Index;if(this.SubFrame.length<=0||!this.SubFrame[r])return!1;var t=this.SubFrame[r],n=t.Frame;if(e.IsOverlay){var s=t.OverlayIndex[e.OverlayIndex];if(!s)return!1;s.Frame.IsShareY||(n=s.Frame)}var o=n.ChartBorder.GetTopEx(),l=n.ChartBorder.GetBottomEx(),h=n.HorizontalMax,u=n.HorizontalMin,f=(h-u)*Math.abs(a)/(l-o),C=n.YSplitOperator,D={Max:h,Min:u};if(e.Position==1){var c=a>0?-f:f;D.Max+=c}else if(e.Position==2){var c=a>0?-f:f;D.Min+=c}else if(e.Position==0){var c=a>0?f:-f;D.Max+=c,D.Min-=c}else return!1;if(D.Max>D.Min){C.FixedYMaxMin=D,C.EnableZoomUpDown=!0,n.XYSplit=!0;for(var T=0;T<t.OverlayIndex.length;++T){var S=t.OverlayIndex[T];S.Frame.IsShareY&&(S.Frame.XYSplit=!0)}return k.Chart.Log("[HQTradeFrame::OnZoomUpDownFrameY] Max="+D.Max+", Min="+D.Min),!0}return!1},this.OnUpDonwFrameY=function(e,a){var r=e.Index;if(this.SubFrame.length<=0||!this.SubFrame[r])return!1;var t=this.SubFrame[r],n=t.Frame,s=n.ChartBorder.GetTopEx(),o=n.ChartBorder.GetBottomEx(),l=n.YSplitOperator;if(!l)return!1;var h=n.HorizontalMax,u=n.HorizontalMin,f=(h-u)*Math.abs(a)/(o-s),C=a>0?-f:f,D={Max:h,Min:u};D.Max-=C,D.Min-=C,l.FixedYMaxMin=D,l.EnableZoomUpDown=!0,n.XYSplit=!0;for(var c in t.OverlayIndex){var T=t.OverlayIndex[c];T.Frame.IsShareY&&(T.Frame.XYSplit=!0)}return k.Chart.Log("[HQTradeFrame::OnUpDonwFrameY] Max="+D.Max+", Min="+D.Min+", yMove="+a+", moveStep="+f),!0},this.ClearUpDonwFrameYData=function(e){if(!(this.SubFrame.length<=0))if(e){var a=e.Index;if(a<0||a>=this.SubFrame.length)return;var r=this.SubFrame[a];if(!r||!r.Frame||!r.Frame.YSplitOperator)return;var t=r.Frame.YSplitOperator;t.EnableZoomUpDown==!0&&(t.FixedYMaxMin=null)}else for(var n=0;n<this.SubFrame.length;++n){var r=this.SubFrame[n];if(!(!r||!r.Frame||!r.Frame.YSplitOperator)){var t=r.Frame.YSplitOperator;t.EnableZoomUpDown==!0&&(t.FixedYMaxMin=null)}}},this.ClearCoordinateText=function(e){for(var a=0;a<this.SubFrame.length;++a){var r=this.SubFrame[a];r.Frame&&r.Frame.ClearCoordinateText(e)}},this.RestoreIndexWindows=function(){if(!this.ZoomWindowsInfo)return!1;this.SubFrame[this.ZoomWindowsInfo.FrameID];for(var e=this.ZoomStartWindowIndex;e<this.ZoomWindowsInfo.Data.length;++e){var a=this.ZoomWindowsInfo.Data[e],r=this.SubFrame[e];r.Height=a.Height,r.Frame.IsMinSize=!1,r.Frame.ReDrawToolbar=!0,r.Frame.XSplitOperator.ShowText=a.ShowXText,r.Frame.XYSplit=!0;for(var t=0;t<r.OverlayIndex.length;++t){var n=r.OverlayIndex[t];n.Frame.IsMinSize=!1}}return this.ZoomWindowsInfo=null,!0},this.ZoomIndexWindow=function(e,a){var r=this.SubFrame[e];if(!r)return!1;if(r.Frame.ChartBorder.IsShowTitleOnly=!1,this.ZoomWindowsInfo)return this.RestoreIndexWindows();for(var t={FrameID:e,Data:[]},n=0;n<this.SubFrame.length;++n){var s=this.SubFrame[n];t.Data[n]={Height:s.Height,ShowXText:s.Frame.XSplitOperator.ShowText}}this.ZoomWindowsInfo=t;for(var o=0,n=this.ZoomStartWindowIndex;n<this.SubFrame.length;++n){var s=this.SubFrame[n],l=s.Frame;if(l.XYSplit=!0,o+=s.Height,n!=e){s.Height=0,l.IsMinSize=!0,l.HideToolbar(),l.XSplitOperator.ShowText=!1;for(var h=0;h<s.OverlayIndex.length;++h){var u=s.OverlayIndex[h];u.Frame.IsMinSize=!0}}}return r.Height=o,r.Frame.XSplitOperator.ShowText=!0,!0},this.SaveSubFrameHeightRate=function(){for(var e=this.ChartBorder.GetHeight(),a=0;a<this.SubFrame.length;++a){var r=this.SubFrame[a],t=r.Frame.ChartBorder.GetHeight(),n=t/e*100;r.Height=n}},this.ShowIndexTitleOnly=function(e,a){var r=this.SubFrame[e];if(!r&&!r.Frame)return!1;var t=r.Frame;if(!t.ChartBorder)return!1;var n=t.ChartBorder;return n.TitleHeight<10?!1:(this.RestoreIndexWindows(),n.IsShowTitleOnly?n.IsShowTitleOnly=!1:n.IsShowTitleOnly=!0,!0)},this.CalculateChartBorder=function(){if(!(this.SubFrame.length<=0)){for(var e=this.ChartBorder.GetTop(),a=this.ChartBorder.GetHeight(),r=0,t=0,n=0;n<this.SubFrame.length;++n){var s=this.SubFrame[n],o=s.Frame;o&&o.ChartBorder&&o.ChartBorder.IsShowTitleOnly&&s.Height>0?t+=o.ChartBorder.TitleHeight:r+=s.Height}a-=t;for(var n=0;n<this.SubFrame.length;++n){var s=this.SubFrame[n],o=s.Frame;if(s.Frame.ChartBorder.Top=e,s.Frame.ChartBorder.Left=this.ChartBorder.Left,s.Frame.ChartBorder.Right=this.ChartBorder.Right,s.Frame.ChartBorder.LeftExtendWidth=this.ChartBorder.LeftExtendWidth,s.Frame.ChartBorder.RightExtendWidth=this.ChartBorder.RightExtendWidth,o&&o.ChartBorder&&o.ChartBorder.IsShowTitleOnly&&s.Height>0){var l=s.Frame.ChartBorder.Top+o.ChartBorder.TitleHeight;s.Frame.ChartBorder.Bottom=this.ChartBorder.GetChartHeight()-l,e=l}else{var l=a*(s.Height/r)+e;s.Frame.ChartBorder.Bottom=this.ChartBorder.GetChartHeight()-l,e=l}}if(this.GetEventCallback){var h=this.GetEventCallback($.ON_SIZE_FRAME);if(h&&h.Callback){var u={SubFrame:this.SubFrame};h.Callback(h,u,this)}}}},this.SetExtendWidth=function(e){if(e){var a=null,r=null;v.IsNumber(e.Left)&&(a=e.Left,this.ChartBorder.LeftExtendWidth=a),v.IsNumber(e.Right)&&(r=e.Right,this.ChartBorder.RightExtendWidth=r);for(var t in this.SubFrame){var n=this.SubFrame[t];a!=null&&(n.Frame.ChartBorder.LeftExtendWidth=a),r!=null&&(n.Frame.ChartBorder.RightExtendWidth=r)}}},this.CalculateChartBorder2=function(){if(!(this.SubFrame.length<=0)){var e=this.ChartBorder.Top,a=this.ChartBorder.Bottom,r=this.ChartBorder.GetHeight(),t=0;for(var n in this.SubFrame){var s=this.SubFrame[n];t+=s.Height}var o=0;for(var n in this.SubFrame){var s=this.SubFrame[n];s.Frame.ChartBorder.Top=e,s.Frame.ChartBorder.Left=this.ChartBorder.Left,s.Frame.ChartBorder.Right=this.ChartBorder.Right,s.Frame.ChartBorder.X=this.ChartBorder.X,s.Frame.ChartBorder.Y=this.ChartBorder.Y,s.Frame.ChartBorder.Width=this.ChartBorder.Width,s.Frame.ChartBorder.Height=this.ChartBorder.Height;var l=r*(s.Height/t);o+=l,a=this.ChartBorder.Bottom+(r-o),s.Frame.ChartBorder.Bottom=a,e+=l}}},this.GetScaleTextWidth=function(){for(var e={Left:null,Right:null,OverlayRight:0},a=[],r=0;r<this.SubFrame.length;++r){var t=this.SubFrame[r];if(!(t.Height<=0)){var n=t.Frame;if(n&&n.XSplitOperator){n.HorizontalMax,n.HorizontalMin,n.YSplitOperator.Operator();var s=n.GetScaleTextWidth();if(s&&s.TextWidth){var o=s.TextWidth;v.IsNumber(o.Left)&&(e.Left==null||e.Left<o.Left)&&(e.Left=o.Left),v.IsNumber(o.Right)&&(e.Right==null||e.Right<o.Right)&&(e.Right=o.Right)}if(v.IsNonEmptyArray(t.OverlayIndex))for(var l=0,h=0;l<t.OverlayIndex.length;++l){var u=t.OverlayIndex[l];if(u.Frame){if(u.Frame.IsShareY){u.Frame.SyncMainHorizontalInfo&&u.Frame.SyncMainHorizontalInfo();var s=u.Frame.GetScaleTextWidth()}else{u.Frame.HorizontalMax,u.Frame.HorizontalMin,u.Frame.YSplitOperator.Operator();var s=u.Frame.GetScaleTextWidth()}if(u.RightWidth={Index:-1,Width:0},!(!s||!s.TextWidth)){var o=s.TextWidth;v.IsNumber(o.Right)&&(u.RightWidth.Index=h,u.RightWidth.Width=o.Right,a[h]||(a[h]=[]),a[h][r]=u.RightWidth,++h)}}}}}}for(var f=[],r=0;r<a.length;++r){for(var C=a[r],D=0,l=0;l<C.length;++l)if(C[l]){var t=C[l].Width;D<t&&(D=t)}D>0&&(D+=this.OverlayBlankWidth);for(var l=0;l<C.length;++l)C[l]&&(C[l].Width=D);f[r]=D}for(var r=0;r<f.length;++r){var s=f[r];v.IsNumber(s)&&(e.OverlayRight+=s)}return e.AryOverlayWidth=f,e},this.IsFrameXYSplit=function(){for(var e in this.SubFrame){var a=this.SubFrame[e];if(a.Frame.XYSplit)return!0;for(var r=0;r<a.OverlayIndex.length;++r){var t=a.OverlayIndex[r];if(t.Frame.XYSplit)return!0}}return!1},this.Draw=function(e){this.SizeChange===!0&&this.CalculateChartBorder();var a=!1;if(e&&e.IsEnableSplash===!0&&(a=!0),a==!1&&(this.AutoLeftBorder||this.AutoRightBorder)&&this.IsFrameXYSplit()){this.AutoRightOverlayWidth=[];var r=this.GetScaleTextWidth();if(v.IsNumber(r.Left)&&this.AutoLeftBorder){var t=0;v.IsNumber(this.AutoLeftBorder.Blank)&&(t=this.AutoLeftBorder.Blank);var n=r.Left+t;v.IsNumber(this.AutoLeftBorder.MinWidth)&&this.AutoLeftBorder.MinWidth>n&&(n=this.AutoLeftBorder.MinWidth),this.IsHScreen?this.ChartBorder.Top=n:this.ChartBorder.Left=n;for(var s=0;s<this.SubFrame.length;++s){var o=this.SubFrame[s];this.IsHScreen?o.Frame.ChartBorder.Top=n:o.Frame.ChartBorder.Left=n}}if(v.IsNumber(r.Right))if(this.AutoRightBorder){var l={},t=0;v.IsNumber(this.AutoRightBorder.Blank)&&(t=this.AutoRightBorder.Blank);var n=r.Right+t;if(v.IsNumber(this.AutoRightBorder.MinWidth)&&this.AutoRightBorder.MinWidth>n&&(n=this.AutoRightBorder.MinWidth),this.AuotRightWidth=n,l.MainTextWidth=n,v.IsNonEmptyArray(r.AryOverlayWidth)&&(l.AryOverlayWidth=r.AryOverlayWidth),v.IsPlusNumber(r.OverlayRight)&&(this.AuotRightWidth=n,n+=r.OverlayRight),this.GetExtendChartRightWidth){var h=this.GetExtendChartRightWidth();if(this.GetExtendChartByClassName){var u=this.GetExtendChartByClassName("StockChip");u&&u.Chart&&(u.Chart.Left=n)}n+=h}this.IsHScreen?(this.ChartBorder.Bottom!=n,this.ChartBorder.Bottom=n):(this.ChartBorder.Right!=n,this.ChartBorder.Right=n);for(var s=0;s<this.SubFrame.length;++s){var o=this.SubFrame[s];this.IsHScreen?o.Frame.ChartBorder.Bottom=n:o.Frame.ChartBorder.Right=n,o.Frame.ReDrawToolbar=!0,o.Frame.YRightTextInfo=l;for(var f=0;f<o.OverlayIndex.length;++f){var C=o.OverlayIndex[f];C.Frame.YRightTextInfo=l}}}else{var l={};if(l.MainTextWidth=this.FixedRightWidth.Main,r.OverlayRight==0)this.IsHScreen?l.MainTextWidth=this.ChartBorder.Bottom:l.MainTextWidth=this.ChartBorder.Right;else if(v.IsNonEmptyArray(r.AryOverlayWidth)){for(var s=0;s<r.AryOverlayWidth.length;++s)r.AryOverlayWidth[s]=this.FixedRightWidth.Overlay;l.AryOverlayWidth=r.AryOverlayWidth}for(var s=0;s<this.SubFrame.length;++s){var o=this.SubFrame[s];o.Frame.ReDrawToolbar=!0,o.Frame.YRightTextInfo=l;for(var f=0;f<o.OverlayIndex.length;++f){var C=o.OverlayIndex[f];C.Frame.YRightTextInfo=l}}}this.SetSizeChage(!0)}for(var s=0;s<this.SubFrame.length;++s){var o=this.SubFrame[s];if(!(o.Height<=0))if(o.Frame.Draw(),this.AutoRightBorder)for(var D=this.AuotRightWidth,f=0,c=0;f<o.OverlayIndex.length;++f){var C=o.OverlayIndex[f];C.Frame.DataWidth=o.Frame.DataWidth,C.Frame.DistanceWidth=o.Frame.DistanceWidth,C.Frame.XPointCount=o.Frame.XPointCount,C.Frame.RightOffset=D,C.Frame.BlankWidth=0,C.Frame.TextWidthIndex=c,v.IsNumber(this.OverlayBlankWidth)&&(C.Frame.BlankWidth=this.OverlayBlankWidth),C.Frame.Draw(),C.RightWidth&&(D+=C.RightWidth.Width),C.Frame.IsShow&&++c}else{var D=this.FixedRightWidth.Main;o.Frame.RightTextMaxWidth>D&&(D=o.Frame.RightTextMaxWidth);for(var f=0,c=0;f<o.OverlayIndex.length;++f){var C=o.OverlayIndex[f];C.Frame.DataWidth=o.Frame.DataWidth,C.Frame.DistanceWidth=o.Frame.DistanceWidth,C.Frame.XPointCount=o.Frame.XPointCount,C.Frame.RightOffset=D,C.Frame.BlankWidth=0,C.Frame.TextWidthIndex=c,v.IsNumber(this.OverlayBlankWidth)&&(C.Frame.BlankWidth=this.OverlayBlankWidth),C.Frame.Draw(),C.Frame.IsShow&&(D+=this.FixedRightWidth.Overlay,++c)}}}this.SizeChange=!1},this.DrawOveraly=function(e){for(var a=0;a<this.SubFrame.length;++a){var r=this.SubFrame[a];if(!(r.Height<=0))for(var t=0;t<r.OverlayIndex.length;++t)for(var n=r.OverlayIndex[t],s=0;s<n.ChartPaint.length;++s){var o=n.ChartPaint[s];o.IsShow&&(e?o.IsDrawFirst&&o.Draw():o.IsDrawFirst||o.Draw())}}},this.DrawOveralySelectedStatus=function(e){if(!(!e.MoveOn.Identify&&!e.Selected.Identify))for(var a in this.SubFrame){var r=this.SubFrame[a];for(var t in r.OverlayIndex){var n=r.OverlayIndex[t];for(var s in n.ChartPaint){var o=n.ChartPaint[s];o.IsShow&&o.Identify&&(o.Identify!=e.MoveOn.Identify&&o.Identify!=e.Selected.Identify||o.DrawSelectedStatus&&o.DrawSelectedStatus())}}}},this.PtInOveralyChart=function(e,a){var r=null;for(var t in this.SubFrame){var n=this.SubFrame[t];for(var s in n.OverlayIndex){var o=n.OverlayIndex[s];for(var l in o.ChartPaint){var h=o.ChartPaint[l];if(h.IsShow&&!h.IsHideScriptIndex()&&h.PtInChart&&(r=h.PtInChart(e,a),r))return r}}}return null},this.DrawPictureCoordinate=function(e,a){if(!e||!e.Frame||!v.IsNonEmptyArray(e.Point)||!e.GetXYCoordinate)return!1;var r=e.GetXYCoordinate();r&&r.IsShowYCoordinate===!1||e.Frame.DrawPictureYCoordinate(e,r,a);for(var t=0;t<this.SubFrame.length;++t){var n=this.SubFrame[t];if(!(!n||!n.Frame)&&n.Frame.XSplitOperator.ShowText){n.Frame.DrawPictureXCoordinate(e,r,a);break}}return!0},this.DrawLock=function(){for(var e in this.SubFrame){var a=this.SubFrame[e];a.Frame.DrawLock()}},this.DrawLogo=function(){for(var e=0;e<this.SubFrame.length;++e){var a=this.SubFrame[e];if(a.Frame.DrawLogo){a.Frame.DrawLogo();break}}},this.CalculateLock=function(){for(var e in this.SubFrame){var a=this.SubFrame[e];a.Frame.CalculateLock()}},this.DrawInsideHorizontal=function(){for(var e in this.SubFrame){var a=this.SubFrame[e];a.Height<=0||a.Frame.DrawInsideHorizontal&&a.Frame.DrawInsideHorizontal()}},this.DrawCustomHorizontal=function(){for(var e in this.SubFrame){var a=this.SubFrame[e];a.Frame.DrawCustomHorizontal&&a.Frame.DrawCustomHorizontal();for(var r=0;r<a.OverlayIndex.length;++r){var t=a.OverlayIndex[r];t.Frame&&t.Frame.DrawCustomHorizontal&&t.Frame.DrawCustomHorizontal()}}},this.DrawEx=function(e){for(var a in this.SubFrame){var r=this.SubFrame[a];(r.Frame.ClassName=="MinuteFrame"||r.Frame.ClassName=="MinuteHScreenFrame")&&a==1&&r.Frame.DrawVolTitle(e.Symbol)}},this.DrawCustomVertical=function(e){for(var a=0;a<this.SubFrame.length;++a){var r=this.SubFrame[a];r.Frame.DrawCustomVerticalEvent=e,r.Frame.DrawCustomVertical&&r.Frame.DrawCustomVertical()}},this.DrawToolbar=function(e){var a=null;e&&e.MoveOnPoint&&(a=e.MoveOnPoint);for(var r=0;r<this.SubFrame.length;++r){var t=this.SubFrame[r];if(!(t.Height<=0)){var n=t.Frame;if(n){n.ToolbarButtonStyle==1&&n.DrawToolbarV2&&n.DrawToolbarV2(a,e);for(var s=0;s<t.OverlayIndex.length;++s){var o=t.OverlayIndex[s],l=o.Frame;l.IsShow&&l.DrawToolbar&&l.DrawToolbar(a,n.IsMinSize,e)}}}}},this.SetSizeChage=function(e){this.SizeChange=e;for(var a in this.SubFrame){var r=this.SubFrame[a];r.Frame.SizeChange=e;for(var t in r.OverlayIndex){var n=r.OverlayIndex[t];n.Frame&&(n.Frame.SizeChange=e)}}this.ChartBorder.UIElement&&(this.Position={X:this.ChartBorder.UIElement.offsetLeft,Y:this.ChartBorder.UIElement.offsetTop,W:this.ChartBorder.UIElement.clientWidth,H:this.ChartBorder.UIElement.clientHeight})},this.SetBeforeDrawXYCallback=function(e){for(var a=0;a<this.SubFrame.length;++a){var r=this.SubFrame[a];r.Frame.BeforeDrawXYCallback=e}},this.Snapshot=function(){this.ScreenImageData=this.Canvas.getImageData(0,0,this.ChartBorder.GetChartWidth(),this.ChartBorder.GetChartHeight())},this.GetXData=function(e){return this.SubFrame[0].Frame.GetXData(e)},this.GetYData=function(e,a){for(var r,t=0;t<this.SubFrame.length;++t){var n=this.SubFrame[t],s=n.Frame.ChartBorder.GetLeft(),o=n.Frame.ChartBorder.GetTopEx(),l=n.Frame.ChartBorder.GetWidth(),h=n.Frame.ChartBorder.GetHeightEx();if(n.Frame.Canvas.beginPath(),n.Frame.Canvas.rect(s,o,l,h),n.Frame.Canvas.isPointInPath(s,e)){r=n.Frame,a&&(a.FrameID=t);break}}if(r!=null){r.RightFrame&&(a.RightYValue=r.RightFrame.GetYData(e));var u=r.GetYData(e);if(r.YSplitOperator.CoordinateType==1){var f=r.YSplitOperator.GetFirstOpenPrice();a.RightYValue=((u-f)/f*100).toFixed(2)+"%"}if(r.GetMainOverlayFrame){var C=r.GetMainOverlayFrame();if(C){if(C[0]){var D=C[0],c=D.GetYData(e);a.RightYValue=u,u=c}if(C[1]){var T=C[1],c=T.GetYData(e);a.RightYValue=c}}}return u}},this.PtInFrame=function(e,a){for(var r=0;r<this.SubFrame.length;++r){var t=this.SubFrame[r],u=t.Frame.ChartBorder.GetLeft(),n=t.Frame.ChartBorder.GetTop(),s=t.Frame.ChartBorder.GetWidth(),o=t.Frame.ChartBorder.GetHeight();if(t.Frame.Canvas.beginPath(),t.Frame.Canvas.rect(u,n,s,o),t.Frame.Canvas.isPointInPath(e,a))return r}var l=this.ChartBorder.GetBottom(),h=this.ChartBorder.GetChartHeight(),u=this.ChartBorder.GetLeft(),f=this.ChartBorder.GetRight();return e>=u&&e<=f&&a>l&&a<h?-3:-1},this.PtInChartFrame=function(e,a){for(var r=0;r<this.SubFrame.length;++r){var t=this.SubFrame[r],n=t.Frame.ChartBorder.GetLeft(),s=t.Frame.ChartBorder.GetTopEx(),o=t.Frame.ChartBorder.GetWidth(),l=t.Frame.ChartBorder.GetHeightEx();if(t.Frame.Canvas.beginPath(),t.Frame.Canvas.rect(n,s,o,l),t.Frame.Canvas.isPointInPath(e,a))return r}return-1},this.PtInHorizontalLabel=function(e,a){for(var r=0;r<this.SubFrame.length;++r){var t=this.SubFrame[r];if(!(t.Height<=0)){var n=t.Frame.PtInHorizontalLabel(e,a);if(n)return n.Frame=t.Frame,n.FrameID=r,n}}return null},this.PtInButtons=function(e,a){for(var r=0;r<this.SubFrame.length;++r){var t=this.SubFrame[r];if(!(t.Height<=0)){var n=t.Frame.PtInButtons(e,a);if(n)return n.Frame=t.Frame,n.FrameID=r,n;for(var s=0;s<t.OverlayIndex.length;++s){var o=t.OverlayIndex[s],l=o.Frame;if(!(!l||!l.PtInButtons)){var n=l.PtInButtons(e,a);if(n)return n.IndexID=o.Identify,n.FrameID=r,n.OverlayFrame=l,n.Frame=t.Frame,n}}}}return null},this.PtInFrameBottom=function(e,a){var r=this.ChartBorder.GetLeft(),t=this.ChartBorder.GetBottom(),n=this.ChartBorder.GetWidth(),s=this.ChartBorder.Bottom;return this.Canvas.beginPath(),this.Canvas.rect(r,t,n,s),!!this.Canvas.isPointInPath(e,a)},this.PtInFrameVertical=function(e,a){for(var r=0;r<this.SubFrame.length;++r){var t=this.SubFrame[r];if(!(t.Height<=0)&&t.Frame.PtInVertical&&t.Frame.PtInVertical(e,a))return{Frame:t.Frame}}return null},this.GetXFromIndex=function(e){return this.SubFrame[0].Frame.GetXFromIndex(e)},this.GetYFromData=function(e){return this.SubFrame[0].Frame.GetYFromData(e)},this.ZoomUp=function(e){var a=this.SubFrame[0].Frame.ZoomUp(e);return this.UpdateAllFrame(),a},this.ZoomDown=function(e,a){var r=this.SubFrame[0].Frame.ZoomDown(e,a);return this.UpdateAllFrame(),r},this.SetXShowCount=function(e){var a=this.SubFrame[0].Frame.SetXShowCount(e);return this.UpdateAllFrame(),a},this.GetXShowCount=function(){var e=-1;if(!v.IsNonEmptyArray(this.SubFrame))return e;var a=this.SubFrame[0];return a.Frame&&(e=a.Frame.XPointCount),e},this.XCoordinateZoom=function(e,a){var r=this.SubFrame[0].Frame.XCoordinateZoom(e,a);return this.UpdateAllFrame(),r},this.ResetXYSplit=function(){for(var e in this.SubFrame)this.SubFrame[e].Frame.XYSplit=!0},this.ResetXSplit=function(){for(var e in this.SubFrame)this.SubFrame[e].Frame.XSplit=!0},this.ResetYCustomSplit=function(e){if(v.IsNonEmptyArray(this.SubFrame))if(v.IsNumber(e)&&e>=0){var a=this.SubFrame[e];a.Frame&&(a.Frame.YCustomSplit=!0)}else for(var r=0;r<this.SubFrame.length;++r)this.SubFrame[r].Frame.YCustomSplit=!0},this.ClearYCoordinateMaxMin=function(e){if(v.IsNumber(e)){var a=this.SubFrame[e];if(!a||!a.Frame)return;var r=a.Frame;r.YMaxMin&&(r.YMaxMin.Max=null,r.YMaxMin.Min=null)}else for(var t=0;t<this.SubFrame.length;++t){var a=this.SubFrame[t],r=a.Frame;r.YMaxMin&&(r.YMaxMin.Max=null,r.YMaxMin.Min=null)}},this.SetLanguage=function(e){for(var a in this.SubFrame){var r=this.SubFrame[a];r&&r.Frame&&(r.Frame.YSplitOperator&&(r.Frame.YSplitOperator.LanguageID=e),r.Frame.XSplitOperator&&(r.Frame.XSplitOperator.LanguageID=e))}},this.GetCurrentPageSize=function(){if(this.SubFrame.length<=0)return null;var e=this.SubFrame[0];return!e||!e.Frame?null:e.Frame.XPointCount},this.OnSize=function(){var e={};return this.SubFrame[0].Frame.OnSize(e),this.UpdateAllFrame(),e},this.SetDataWidth=function(e){var a=this.SubFrame[0].Frame.SetDataWidth(e);return this.UpdateAllFrame(),a},this.UpdateAllFrame=function(){for(var e=this.SubFrame[0].Frame,a=0;a<this.SubFrame.length;++a){var r=this.SubFrame[a];a>0&&(r.Frame.XPointCount=e.XPointCount,r.Frame.ZoomIndex=e.ZoomIndex,r.Frame.DataWidth=e.DataWidth,r.Frame.DistanceWidth=e.DistanceWidth,r.Frame.LastCalculateStatus.Width=e.LastCalculateStatus.Width,r.Frame.LastCalculateStatus.XPointCount=e.LastCalculateStatus.XPointCount);for(var t in r.OverlayIndex){var n=this.SubFrame[a].OverlayIndex[t];n.Frame.XPointCount=e.XPointCount,n.Frame.ZoomIndex=e.ZoomIndex,n.Frame.DataWidth=e.DataWidth,n.Frame.DistanceWidth=e.DistanceWidth,n.Frame.LastCalculateStatus.Width=e.LastCalculateStatus.Width,n.Frame.LastCalculateStatus.XPointCount=e.LastCalculateStatus.XPointCount}}},this.PtInFrameBorder=function(e,a){for(var r=this.DragBorderHeight,t=0;t<this.SubFrame.length-1;++t){var n=this.SubFrame[t];if(!(n.Frame.Heigh<=0)){var s=n.Frame.ChartBorder.GetBottom(),o=n.Frame.ChartBorder.GetLeft(),l=n.Frame.ChartBorder.GetRight();if(n.Frame.Canvas.beginPath(),n.Frame.Canvas.rect(o,s-r/2,l-o,r),n.Frame.Canvas.isPointInPath(e,a))return{Index:t,Bottom:!0}}}return null},this.IsEnableDragY=function(e){if(!this.SubFrame)return!1;var a=this.SubFrame[e];if(!a||!a.Frame||!a.Frame.YSplitOperator)return!1;var r=a.Frame.YSplitOperator;return typeof r.IsEnableDragY!="function"?!1:r.IsEnableDragY()},this.IsEnableOverlayDragY=function(e,a){if(!this.SubFrame)return!1;var r=this.SubFrame[e],t=r.OverlayIndex[a];if(!t||!t.Frame)return!1;var n=t.Frame.YSplitOperator;return t.Frame.IsShareY&&(n=t.Frame.MainFrame.YSplitOperator),!n||typeof n.IsEnableDragY!="function"?!1:n.IsEnableDragY()},this.PtInFrameY=function(e,a){var r=0;if(this.GetExtendChartByClassName){var t=this.GetExtendChartByClassName("StockChip");t&&t.Chart&&(r=t.Chart.Width)}for(var n=0;n<this.SubFrame.length;++n){var s=this.SubFrame[n];if(!(s.Frame.Heigh<=0)){var o=s.Frame.ChartBorder.Right;o-=r;var l=s.Frame.ChartBorder.GetBorder(),h=l.Bottom,u=l.TopTitle;l.Left;var f=l.Right,C=30,D=h-u;if(D/3>C)var c=u+C,T=h-C;else var S=D/3,c=u+S,T=h-S;var I=0;if(a<c?I=1:a>T&&(I=2),o>=10){if(v.IsNonEmptyArray(s.OverlayIndex)){var g=s.OverlayIndex[0],E=g.Frame.RightOffset;if(s.Frame.Canvas.beginPath(),s.Frame.Canvas.rect(f,u,E,h-u),s.Frame.Canvas.isPointInPath(e,a))return{Index:n,Right:!0,Left:!1,Position:I,IsOverlay:!1};for(var F=f+E,R=0;R<s.OverlayIndex.length;++R){var g=s.OverlayIndex[R];if(!(!g.RightWidth||!v.IsNumber(g.RightWidth.Width))){var A=g.RightWidth.Width;if(s.Frame.Canvas.beginPath(),s.Frame.Canvas.rect(F,u,A,h-u),s.Frame.Canvas.isPointInPath(e,a))return{Index:n,Right:!0,Left:!1,Position:I,IsOverlay:!0,OverlayIndex:R};F+=A}}}else if(s.Frame.Canvas.beginPath(),s.Frame.Canvas.rect(f,u,o,h-u),s.Frame.Canvas.isPointInPath(e,a))return{Index:n,Right:!0,Left:!1,Position:I,IsOverlay:!1}}var P=s.Frame.ChartBorder.Left;if(P>=10&&(s.Frame.Canvas.beginPath(),s.Frame.Canvas.rect(0,u,P,h-u),s.Frame.Canvas.isPointInPath(e,a)))return{Index:n,Right:!1,Left:!0,Position:I,IsOverlay:!1}}}return null},this.SetDayCount=function(e){this.ChartBorder.MultiDayMinute.Count=e;for(var a=0;a<this.SubFrame.length;++a){var r=this.SubFrame[a];r.Frame&&(r.Frame.DayCount=e,r.Frame.ChartBorder.MultiDayMinute.Count=e)}},this.SetMultiDayMinuteWidth=function(e){if(e){v.IsNumber(e.Left)&&(this.ChartBorder.MultiDayMinute.Left=e.Left),v.IsNumber(e.Right)&&(this.ChartBorder.MultiDayMinute.Right=e.Right);for(var a=0;a<this.SubFrame.length;++a){var r=this.SubFrame[a];r.Frame&&(v.IsNumber(e.Left)&&(r.Frame.ChartBorder.MultiDayMinute.Left=e.Left),v.IsNumber(e.Right)&&(r.Frame.ChartBorder.MultiDayMinute.Right=e.Right))}}}}function yC(){this.newMethod=Qh,this.newMethod(),delete this.newMethod,this.IsHScreen=!0,this.CalculateChartBorder=function(){if(!(this.SubFrame.length<=0)){for(var e=this.ChartBorder.GetHScreenBorder(),a=this.ChartBorder.Right,r=e.Right,t=e.Right-e.Left,n=0,s=0,o=0;o<this.SubFrame.length;++o){var l=this.SubFrame[o],h=l.Frame;h&&h.ChartBorder&&h.ChartBorder.IsShowTitleOnly&&l.Height>0?s+=h.ChartBorder.TitleHeight:n+=l.Height}t-=s;for(var o=0;o<this.SubFrame.length;++o){var l=this.SubFrame[o],h=l.Frame;if(l.Frame.ChartBorder.Top=this.ChartBorder.Top,l.Frame.ChartBorder.Bottom=this.ChartBorder.Bottom,l.Frame.ChartBorder.LeftExtendWidth=this.ChartBorder.LeftExtendWidth,l.Frame.ChartBorder.RightExtendWidth=this.ChartBorder.RightExtendWidth,h&&h.ChartBorder&&h.ChartBorder.IsShowTitleOnly&&l.Height>0){var u=h.ChartBorder.TitleHeight;l.Frame.ChartBorder.Right=a,l.Frame.ChartBorder.Left=r-u,a+=u,r-=u}else{var u=t*(l.Height/n);l.Frame.ChartBorder.Right=a,l.Frame.ChartBorder.Left=r-u,a+=u,r-=u}}}},this.GetYData=function(e,a){for(var r,t=0;t<this.SubFrame.length;++t){var n=this.SubFrame[t],s=n.Frame.ChartBorder.GetLeftEx(),o=n.Frame.ChartBorder.GetTop(),l=n.Frame.ChartBorder.GetWidthEx(),h=n.Frame.ChartBorder.GetHeight();if(n.Frame.Canvas.beginPath(),n.Frame.Canvas.rect(s,o,l,h),n.Frame.Canvas.isPointInPath(e,o)){r=n.Frame,a&&(a.FrameID=t);break}}if(r!=null){var u=r.GetYData(e);if(r.GetMainOverlayFrame){var f=r.GetMainOverlayFrame();if(f){if(f[0]){var C=f[0],D=C.GetYData(e);a.RightYValue=u,u=D}if(f[1]){var c=f[1],D=c.GetYData(e);a.RightYValue=D}}}return u}}}function Ld(){this.newMethod=zh,this.newMethod(),delete this.newMethod,this.ScreenImageData,this.Position,this.ClassName="DepthChartFrame",this.VerticalRange={Max:88,Min:8,Center:null,MaxDiffer:null,Differ:null,Step:.05},this.AskPrice,this.BidPrice,this.MinZoom=.05,this.SetPriceList=function(e,a){this.AskPrice=e,this.BidPrice=a},this.DrawFrame=function(){this.SplitXYCoordinate(),this.DrawHorizontal(),this.DrawVertical()},this.GetXFromIndex=function(e){var a=this.ChartBorder.GetLeft();this.ChartBorder.GetRight();var r=this.ChartBorder.GetWidth(),t=r*(e-this.VerticalRange.Min)/(this.VerticalRange.Max-this.VerticalRange.Min);return a+t},this.GetXData=function(e){var a=this.ChartBorder.GetLeft();this.ChartBorder.GetRight();var r=this.ChartBorder.GetWidth();return(e-a)/r*(this.VerticalRange.Max-this.VerticalRange.Min)+this.VerticalRange.Min},this.GetXFromPrice=function(e){var a=!1,r=this.GetPrice(this.BidPrice,e);if(r==null&&(r=this.GetPrice(this.AskPrice,e),a=!0),r==null&&this.BidPrice&&Array.isArray(this.BidPrice)&&this.BidPrice.length>0){var t=this.BidPrice[0];e<t&&(a=!1,r=t)}if(r==null&&this.AskPrice&&Array.isArray(this.AskPrice)&&this.AskPrice.length>0){var n=this.AskPrice[this.AskPrice.length-1];e>n&&(a=!0,r=n)}if(r==null)return null;var s=this.GetXFromIndex(r);return{X:s,Price:r,IsAsk:a}},this.GetPrice=function(e,a){if(!e||!Array.isArray(e)||e.length<=0||a<e[0]||a>e[e.length-1])return null;var r=null;for(var t in e){var n=e[t];if(a==n)return n;if(a<n)return r;r=n}},this.SplitXYCoordinate=function(){this.XYSplit!=!1&&(this.YSplitOperator!=null&&this.YSplitOperator.Operator(),this.XSplitOperator!=null&&this.XSplitOperator.Operator())},this.Snapshot=function(){this.ScreenImageData=this.Canvas.getImageData(0,0,this.ChartBorder.GetChartWidth(),this.ChartBorder.GetChartHeight())},this.SetSizeChage=function(e){this.SizeChange=e,this.Position={X:this.ChartBorder.UIElement.offsetLeft,Y:this.ChartBorder.UIElement.offsetTop,W:this.ChartBorder.UIElement.clientWidth,H:this.ChartBorder.UIElement.clientHeight}},this.PtInFrame=function(e,a){var r=this.ChartBorder.GetLeft(),t=this.ChartBorder.GetTop(),n=this.ChartBorder.GetWidth(),s=this.ChartBorder.GetHeight();return this.Canvas.beginPath(),this.Canvas.rect(r,t,n,s),this.Canvas.isPointInPath(e,a)?0:-1},this.PtInFrameBorder=function(e,a){return null},this.ZoomUp=function(){var e=this.VerticalRange,a=e.Differ,r=e.MaxDiffer*this.MinZoom;if(a<r)return!1;var t=e.Differ*e.Step;return a-=t,e.Differ=a,e.Min=e.Center-e.Differ,e.Max=e.Center+e.Differ,!0},this.ZoomDown=function(){var e=this.VerticalRange,a=e.Differ;if(a==e.MaxDiffer)return!1;var r=e.Differ*e.Step;return a+=r,a>e.MaxDiffer&&(a=e.MaxDiffer),e.Differ=a,e.Min=e.Center-e.Differ,e.Max=e.Center+e.Differ,!0}}function Pt(){this.Date,this.YClose,this.Open,this.Close,this.High,this.Low,this.Vol,this.Amount,this.Time,this.FlowCapital=null,this.Position=null,this.IsVirtual=!1,this.IsNonTrade=!1,this.YFClose=null,this.FClose=null,this.Stop,this.Up,this.Down,this.Unchanged,this.ExtendData,this.BFactor,this.AFactor,this.RightSeed,this.OrderFlow,this.ColorData,this.HeatMap}Pt.Copy=function(e){var a=new Pt;return a.Date=e.Date,v.IsNumber(e.Time)&&(a.Time=e.Time),a.YClose=e.YClose,a.Open=e.Open,a.Close=e.Close,a.High=e.High,a.Low=e.Low,a.Vol=e.Vol,a.Amount=e.Amount,v.IsNumber(e.FlowCapital)&&(a.FlowCapital=e.FlowCapital),v.IsNumber(e.Position)&&(a.Position=e.Position),v.IsNumber(e.YFClose)&&(a.YFClose=e.YFClose),v.IsNumber(e.FClose)&&(a.FClose=e.FClose),v.IsNumber(e.Stop)&&(a.Stop=e.Stop),v.IsNumber(e.Up)&&(a.Up=e.Up),v.IsNumber(e.Down)&&(a.Down=e.Down),v.IsNumber(e.Unchanged)&&(a.Unchanged=e.Unchanged),v.IsNumber(e.BFactor)&&(a.BFactor=e.BFactor),v.IsNumber(e.AFactor)&&(a.AFactor=e.AFactor),v.IsBool(e.IsVirtual)&&(a.IsVirtual=e.IsVirtual),v.IsBool(e.IsNonTrade)&&(a.IsNonTrade=e.IsNonTrade),e.OrderFlow&&(a.OrderFlow=e.OrderFlow),e.ColorData&&(a.ColorData=e.ColorData),e.ExtendData&&(a.ExtendData=e.ExtendData),e.HeatMap&&(a.HeatMap=e.HeatMap),a};Pt.CopyTo=function(e,a){e.Date=a.Date,v.IsNumber(a.Time)&&(e.Time=a.Time),e.YClose=a.YClose,e.Open=a.Open,e.Close=a.Close,e.High=a.High,e.Low=a.Low,e.Vol=a.Vol,e.Amount=a.Amount,v.IsNumber(a.FlowCapital)&&(e.FlowCapital=a.FlowCapital),v.IsNumber(a.Position)&&(e.Position=a.Position),v.IsNumber(a.YFClose)&&(e.YFClose=a.YFClose),v.IsNumber(a.FClose)&&(e.FClose=a.FClose),v.IsNumber(a.Stop)&&(e.Stop=a.Stop),v.IsNumber(a.Up)&&(e.Up=a.Up),v.IsNumber(a.Down)&&(e.Down=a.Down),v.IsNumber(a.Unchanged)&&(e.Unchanged=a.Unchanged),v.IsNumber(a.BFactor)&&(e.BFactor=a.BFactor),v.IsNumber(a.AFactor)&&(e.AFactor=a.AFactor),v.IsBool(a.IsVirtual)&&(e.IsVirtual=a.IsVirtual),v.IsBool(a.IsNonTrade)&&(e.IsNonTrade=a.IsNonTrade),a.OrderFlow&&(e.OrderFlow=a.OrderFlow),a.ColorData&&(e.ColorData=a.ColorData),a.HeatMap&&(e.HeatMap=a.HeatMap),a.ExtendData&&(e.ExtendData=a.ExtendData)};Pt.CopyRight=function(e,a){var r=new Pt;return r.Date=e.Date,v.IsNumber(e.Time)&&(r.Time=e.Time),r.YClose=e.YClose*a,r.Open=e.Open*a,r.Close=e.Close*a,r.High=e.High*a,r.Low=e.Low*a,r.Vol=e.Vol,r.Amount=e.Amount,r.FlowCapital=e.FlowCapital,r.Position=e.Position,r.YFClose=e.YFClose,r.FClose=e.FClose,e.ColorData&&(r.ColorData=e.ColorData),e.ExtendData&&(r.ExtendData=e.ExtendData),r};function fs(){this.Close,this.Open,this.High,this.Low,this.Vol,this.Amount,this.DateTime,this.Increase,this.Risefall,this.AvPrice,this.Lead=null,this.Time,this.Date,this.Position=null,this.YClearing,this.YClose,this.ExtendData}function Lr(){this.Time,this.Date,this.Price,this.AvPrice,this.Vol=[],this.ColorID,this.YClose}function Rr(){this.Time,this.Date,this.Price,this.AvPrice,this.Vol=[],this.ColorID,this.YClose}function Wt(){this.Date,this.Time,this.Value}var ee={INVESTOR:1,ANNOUNCEMENT:2,PFORECAST:3,ANNOUNCEMENT_QUARTER_1:4,ANNOUNCEMENT_QUARTER_2:5,ANNOUNCEMENT_QUARTER_3:6,ANNOUNCEMENT_QUARTER_4:7,RESEARCH:8,BLOCKTRADING:9,TRADEDETAIL:10,ANNOUNCEMENT_EX_START:100,ANNOUNCEMENT_EX_END:200};function Xr(){this.ID,this.Date,this.Time,this.Title,this.InfoType,this.ExtendData}function Rd(){this.PeriodCallback=new Dt.default,this.GetPeriodCallback=function(e){return this.PeriodCallback.has(e)?this.PeriodCallback.get(e):null},this.AddPeriodCallback=function(e){if(!(!v.IsNumber(e.Period)||!e.Callback)){var a={Period:e.Period,Callback:e.Callback};this.PeriodCallback.set(e.Period,a)}},this.RemovePeriodCallback=function(e){this.PeriodCallback.has(e.ID)&&this.PeriodCallback.delete(e.ID)}}var $h=new Rd;function Y(){this.Data=new Array,this.DataOffset=0,this.Period=0,this.Right=0,this.Symbol,this.Data2=new Array,this.GetCloseMA=function(e){for(var a=new Array,r=0,t=this.Data.length;r<t;r++){if(r<e){a[r]=null;continue}for(var n=0,s=0;s<e;s++)n+=this.Data[r-s].Close;a[r]=n/e}return a},this.GetVolMA=function(e){for(var a=new Array,r=0,t=this.Data.length;r<t;r++){if(r<e){a[r]=null;continue}for(var n=0,s=0;s<e;s++)n+=this.Data[r-s].Vol;a[r]=n/e}return a},this.GetAmountMA=function(e){for(var a=new Array,r=0,t=this.Data.length;r<t;r++){if(r<e){a[r]=null;continue}for(var n=0,s=0;s<e;s++)n+=this.Data[r-s].Amount;a[r]=n/e}return a},this.GetClose=function(){var e=new Array;for(var a in this.Data)e[a]=this.Data[a].Close;return e},this.GetYClose=function(){var e=new Array;for(var a in this.Data)e[a]=this.Data[a].YClose;return e},this.GetHigh=function(){var e=new Array;for(var a in this.Data)e[a]=this.Data[a].High;return e},this.GetLow=function(){var e=new Array;for(var a in this.Data)e[a]=this.Data[a].Low;return e},this.GetOpen=function(){var e=new Array;for(var a in this.Data)e[a]=this.Data[a].Open;return e},this.GetVol=function(e){var a=1;v.IsNumber(e)&&(a=e);var r=new Array;for(var t in this.Data)r[t]=this.Data[t].Vol/a;return r},this.GetAmount=function(){var e=new Array;for(var a in this.Data)e[a]=this.Data[a].Amount;return e},this.GetPosition=function(){var e=new Array;for(var a in this.Data)e[a]=this.Data[a].Position;return e},this.GetSettlementPrice=function(){var e=new Array;for(var a in this.Data)e[a]=this.Data[a].FClose;return e},this.GetIsEqual=function(){var e=[];for(var a in this.Data){var r=this.Data[a];e[a]=r.Close==r.Open?1:0}return e},this.GetIsUp=function(){var e=[];for(var a in this.Data){var r=this.Data[a];e[a]=r.Close>r.Open?1:0}return e},this.GetIsDown=function(){var e=[];for(var a in this.Data){var r=this.Data[a];e[a]=r.Close<r.Open?1:0}return e},this.GetLead=function(){var e=new Array;for(var a in this.Data)e[a]=this.Data[a].Lead;return e},this.GetDate=function(){var e=new Array;for(var a in this.Data)e[a]=this.Data[a].Date;return e},this.GetTime=function(){var e=new Array;for(var a in this.Data)e[a]=this.Data[a].Time;return e},this.GetUp=function(){var e=[];for(var a in this.Data)e[a]=this.Data[a].Up;return e},this.GetDown=function(){var e=[];for(var a in this.Data)e[a]=this.Data[a].Down;return e},this.GetYear=function(){var e=new Array;for(var a in this.Data)e[a]=parseInt(this.Data[a].Date/1e4);return e},this.GetMonth=function(){var e=new Array;for(var a in this.Data)e[a]=parseInt(this.Data[a].Date%1e4/100);return e},this.GetAvPrice=function(){var e=new Array;for(var a in this.Data){var r=this.Data[a].AvPrice;v.IsNumber(r)?e[a]=r:e[a]=0}return e},this.GetDateRange=function(){if(!this.Data||this.Data.length<=0)return null;var e=this.Data[0],a=this.Data[this.Data.length-1],r={Start:{Date:e.Date},End:{Date:a.Date}};return v.IsNumber(e.Time)&&(r.Start.Time=e.Time),v.IsNumber(a.Time)&&(r.End.Time=a.Time),r},this.GetDateList=function(){if(!this.Data||this.Data.length<=0)return null;for(var e=[],a=new Fe.default,r=0;r<this.Data.length;++r){var t=this.Data[r];v.IsNumber(t.Date)&&(a.has(t.Date)||(a.add(t.Date),e.push(t.Date)))}return e},this.GetMinutePeriodData=function(e){var a=new Array,r=5;if(e==5)r=5;else if(e==6)r=15;else if(e==7)r=30;else if(e==8)r=60;else if(e==11)r=120;else if(e==12)r=240;else return e>Ii&&e<=Nr?(r=e-Ii,this.GetMinuteCustomPeriodData(r)):this.Data;for(var t=!1,n=null,s=null,o=0;o<this.Data.length;){t=!0;for(var l=0;l<r&&o<this.Data.length;++o){t&&(n=new Pt,a.push(n),t=!1);var h=this.Data[o];if(h==null){++l;continue}if(h.Time==925&&(s==null||s!=924)||h.Time==930&&(s==null||s!=929)||h.Time==1300&&(s==null||s!=1259)||++l,n.Date=h.Date,n.Time=h.Time,s=n.Time,!(h.Open==null||h.Close==null)&&(n.Open==null||n.Close==null?(n.Open=h.Open,n.High=h.High,n.Low=h.Low,n.YClose=h.YClose,n.Close=h.Close,n.Vol=h.Vol,n.Amount=h.Amount,n.FlowCapital=h.FlowCapital,n.Position=h.Position,n.YFClose=h.YFClose,n.FClose=h.FClose):(n.High<h.High&&(n.High=h.High),n.Low>h.Low&&(n.Low=h.Low),n.Close=h.Close,n.Vol+=h.Vol,h.Amount!=null&&(n.Amount+=h.Amount),n.Position=h.Position,n.FlowCapital=h.FlowCapital,n.FClose=h.FClose),o+1<this.Data.length)){var u=this.Data[o+1];if(u&&u.Date!=h.Date){++o;break}}}}return a},this.GetMinuteCustomPeriodData=function(e){for(var a=new Array,r=e,t=!1,n=null,s=0;s<this.Data.length;){t=!0;for(var o=0;o<r&&s<this.Data.length;++s,++o){t&&(n=new Pt,a.push(n),t=!1);var l=this.Data[s];l!=null&&(n.Date=l.Date,n.Time=l.Time,!(l.Open==null||l.Close==null)&&(n.Open==null||n.Close==null?(n.Open=l.Open,n.High=l.High,n.Low=l.Low,n.YClose=l.YClose,n.Close=l.Close,n.Vol=l.Vol,n.Amount=l.Amount,n.FlowCapital=l.FlowCapital,n.Position=l.Position,n.YFClose=l.YFClose,n.FClose=l.FClose):(n.High<l.High&&(n.High=l.High),n.Low>l.Low&&(n.Low=l.Low),n.Close=l.Close,n.Vol+=l.Vol,l.Amount!=null&&(n.Amount+=l.Amount),n.Position=l.Position,n.FlowCapital=l.FlowCapital,n.FClose=l.FClose)))}}return a},this.GetDayPeriodData=function(e){if(e>Or&&e<=Pn)return this.GetDayCustomPeriodData(e-Or);var a=U.IsBIT(this.Symbol),r=new Array,t=0,n=2,s=null;for(var o in this.Data){var l=!1,h=this.Data[o];switch(e){case 1:if(a)var u=Y.GetSunday(h.Date);else var u=Y.GetFirday(h.Date);u!=t&&(l=!0,t=u);break;case 21:if(a)var u=Y.GetSunday(h.Date);else var u=Y.GetFirday(h.Date);u!=t&&(++n,n>=2&&(l=!0,n=0),t=u);break;case 2:parseInt(h.Date/100)!=parseInt(t/100)&&(l=!0,t=h.Date);break;case 3:parseInt(h.Date/1e4)!=parseInt(t/1e4)&&(l=!0,t=h.Date);break;case 22:var f=Y.GetHalfYear(h.Date);f!=t&&(l=!0,t=f);break;case 9:var C=Y.GetQuarter(h.Date);C=parseInt(h.Date/1e4)*10+C;var D=Y.GetQuarter(t);D=parseInt(t/1e4)*10+D,C!=D&&(l=!0,t=h.Date);break}if(l){if(s=new Pt,s.Date=h.Date,r.push(s),h.Open==null||h.Close==null)continue;s.Open=h.Open,s.High=h.High,s.Low=h.Low,s.YClose=h.YClose,s.Close=h.Close,s.Vol=h.Vol,s.Amount=h.Amount,s.FlowCapital=h.FlowCapital,s.Position=h.Position,s.YFClose=h.YFClose,s.FClose=h.FClose}else{if(s==null||h.Open==null||h.Close==null)continue;s.Open==null||s.Close==null?(s.Open=h.Open,s.High=h.High,s.Low=h.Low,s.YClose=h.YClose,s.Close=h.Close,s.Vol=h.Vol,s.Amount=h.Amount,s.FlowCapital=h.FlowCapital,s.Position=h.Position,s.YFClose=h.YFClose,s.FClose=h.FClose):(s.High<h.High&&(s.High=h.High),s.Low>h.Low&&(s.Low=h.Low),s.Close=h.Close,s.Vol+=h.Vol,h.Amount!=null&&(s.Amount+=h.Amount),s.Position=h.Position,s.FlowCapital=h.FlowCapital,s.Date=h.Date,s.FClose=h.FClose)}}return r},this.GetDayCustomPeriodData=function(e){for(var a=[],r=e,t=!1,n=null,s=0;s<this.Data.length;){t=!0;for(var o=0;o<r&&s<this.Data.length;++s,++o){t&&(n=new Pt,a.push(n),t=!1);var l=this.Data[s];l!=null&&(n.Date=l.Date,!(l.Open==null||l.Close==null)&&(n.Open==null||n.Close==null?(n.Open=l.Open,n.High=l.High,n.Low=l.Low,n.YClose=l.YClose,n.Close=l.Close,n.Vol=l.Vol,n.Amount=l.Amount,n.FlowCapital=l.FlowCapital,n.Position=l.Position,n.YFClose=l.YFClose,n.FClose=l.FClose):(n.High<l.High&&(n.High=l.High),n.Low>l.Low&&(n.Low=l.Low),n.Close=l.Close,n.Vol+=l.Vol,l.Amount!=null&&(n.Amount+=l.Amount),n.Position=l.Position,n.FlowCapital=l.FlowCapital,n.FClose=l.FClose)))}}return a},this.GetPeriodData=function(e){var a=$h.GetPeriodCallback(e);if(a)return a.Callback(e,this.Data,this);if(U.IsBIT(this.Symbol)&&(e==5||e==6||e==7||e==8||e>Ii&&e<=Nr)){var r=5;return e==5?r=5:e==6?r=15:e==7?r=30:e==8?r=60:e==11?r=120:e==12?r=240:e>Ii&&e<=Nr&&(r=e-Ii),this.GetMinuteCustomPeriodData(r)}if(Y.IsDayPeriod(e,!1))return this.GetDayPeriodData(e);if(Y.IsMinutePeriod(e,!1))return this.GetMinutePeriodData(e)},this.GetRightData=function(e,a){var r=[];if(this.Data.length<=0)return r;if(a&&a.AlgorithmType==1){for(var t=0;t<this.Data.length;++t){var n=this.Data[t],s=e==1?n.BFactor:n.AFactor;r[t]=Pt.CopyRight(n,s)}return r}if(e==1){var o=this.Data.length-1,s=1,l=this.Data[o].YClose;for(r[o]=Pt.Copy(this.Data[o]),r[o].RightSeed=s,--o;o>=0&&l==this.Data[o].Close;--o){var h=Pt.Copy(this.Data[o]);h.RightSeed=s,r[o]=h,l=this.Data[o].YClose}for(;o>=0;--o){var u=this.Data[o].Close;l!=u&&u!=0&&(s*=l/u);var h=Pt.CopyRight(this.Data[o],s);h.RightSeed=s,r[o]=h,l=this.Data[o].YClose}}else if(e==2){var o=0,s=1,f=this.Data[o].Close;for(r[o]=Pt.Copy(this.Data[o]),r[o].RightSeed=s,++o;o<this.Data.length&&f==this.Data[o].YClose;++o){var h=Pt.Copy(this.Data[o]);h.RightSeed=s,r[o]=h,f=this.Data[o].Close}for(;o<this.Data.length;++o){f!=this.Data[o].YClose&&(s*=f/this.Data[o].YClose);var h=Pt.CopyRight(this.Data[o],s);h.RightSeed=s,r[o]=h,f=this.Data[o].Close}}return r},this.GetRightDate=this.GetRightData,this.GetOverlayData=function(e,a){for(var r=[],t=0,n=0;t<this.Data.length;){var s=this.Data[t].Date;if(n>=e.length){r[t]=new Pt,r[t].Date=s,++t;continue}var o=e[n].Date;o==s?(r[t]=new Pt,r[t].Date=e[n].Date,r[t].YClose=e[n].YClose,r[t].Open=e[n].Open,r[t].High=e[n].High,r[t].Low=e[n].Low,r[t].Close=e[n].Close,r[t].Vol=e[n].Vol,r[t].Amount=e[n].Amount,r[t].Stop=e[n].Stop,r[t].Up=e[n].Up,r[t].Down=e[n].Down,r[t].Unchanged=e[n].Unchanged,++n,++t):o<s?++n:(r[t]=new Pt,r[t].Date=s,++t)}return r},this.GetOverlayMinuteData=function(e,a){for(var r=[],t=0,n=0;t<this.Data.length;){var s=this.Data[t].Date,o=this.Data[t].Time;if(n>=e.length){r[t]=new Pt,r[t].Date=s,r[t].Time=o,++t;continue}var l=e[n].Date,h=e[n].Time;l==s&&h==o?(r[t]=new Pt,r[t].Date=e[n].Date,r[t].Time=e[n].Time,r[t].YClose=e[n].YClose,r[t].Open=e[n].Open,r[t].High=e[n].High,r[t].Low=e[n].Low,r[t].Close=e[n].Close,r[t].Vol=e[n].Vol,r[t].Amount=e[n].Amount,r[t].Stop=e[n].Stop,r[t].Up=e[n].Up,r[t].Down=e[n].Down,r[t].Unchanged=e[n].Unchanged,++n,++t):l<s||l==s&&h<o?++n:(r[t]=new Pt,r[t].Date=s,r[t].Time=o,++t)}return r},this.GetFittingData=function(e){for(var a=new Array,r=0,t=0;r<this.Data.length;){var n=this.Data[r].Date;if(t>=e.length){a[r]=null,++r;continue}var s=e[t].Date;if(s==n){var o=new Wt;o.Date=e[t].Date,o.Value=e[t].Value,a[r]=o,++t,++r}else s<n?++t:(a[r]=new Wt,a[r].Date=n,++r)}return a},this.GetFittingData2=function(e,a){for(var r=new Array,t=0,n=0;t<this.Data.length;){var s=this.Data[t].Date;if(n>=e.length){r[t]=new Wt,r[t].Date=s,r[t].Value=a,++t;continue}var o=e[n].Date;if(o==s){var l=new Wt;l.Date=e[n].Date,l.Value=e[n].Value,r[t]=l,++n,++t}else o<s?++n:(r[t]=new Wt,r[t].Date=s,r[t].Value=a,++t)}return r},this.GetDateIndex=function(e){for(var a=0,r=0;a<this.Data.length;){var t=this.Data[a].Date;if(r>=e.length)break;var n=e[r];n.Date==t?(n.Index=a,++r):n.Date<t?++r:++a}},this.GetDateTimeIndex=function(e){for(var a=0,r=0;a<this.Data.length;){var t=this.Data[a].Date,n=this.Data[a].Time;if(r>=e.length)break;var s=e[r];s.Date==t&&s.Time==n?(s.Index=a,++r):s.Date<t||s.Date==t&&s.Time<n?++r:++a}},this.GetMinuteFittingData=function(e){for(var a=[],r=0,t=0;r<this.Data.length;){var n=this.Data[r].Date,s=this.Data[r].Time;if(t>=e.length){a[r]=null,++r;continue}var o=e[t].Date,l=e[t].Time,h=e[t];if(o==n&&l==s){var u=new Wt;u.Date=h.Date,u.Time=h.Time,u.Value=h.Value,a[r]=u,++t,++r}else if(o<n||o==n&&l<s)++t;else{var u=new Wt;u.Date=n,u.Time=s,a[r]=u,++r}}return a},this.GetMinuteFittingDataV2=function(e){for(var a=[],r=null,t=0,n=0;t<this.Data.length;){var s=this.Data[t].Date,o=this.Data[t].Time;if(n>=e.length){a[t]=null,++t;continue}var l=e[n].Date,h=e[n].Time,u=e[n];if(l==s&&h==o){var f=new Wt;f.Date=u.Date,f.Time=u.Time,f.Value=u.Value,a[t]=f,r=u,++n,++t}else if(l<s||l==s&&h<o){var C=a.length-1;if(C>=0){var f=a[C];f&&(l<f.Date||l==f.Date&&h<f.Time)&&(f.Value=u.Value)}r=u,++n}else{var f=new Wt;f.Date=s,f.Time=o,r&&(f.Value=r.Value),a[t]=f,++t}}return a},this.GetFittingFinanceData=function(e){for(var a=[],r=0,t=0;r<this.Data.length;){var n=this.Data[r].Date;if(t<e.length){var s=e[t].Date;if(n<s){++r;continue}}if(t+1<e.length&&e[t].Date<n&&e[t+1].Date<=n){++t;continue}var o=new Wt;o.Date=n,t<e.length?(o.Value=e[t].Value,o.FinanceDate=e[t].Date):(o.Value=null,o.FinanceDate=null),a[r]=o,++r}return a},this.GetMinuteFittingFinanceData=function(e){var a=[];if(!Array.isArray(e)||e.length<=0)return a;var r=0,t=e[0];for(r=0;r<this.Data.length;++r){var n=this.Data[r].Date,s=this.Data[r].Time;if(n>t.Date||n==t.Date&&s>=t.Time)break}for(var o=0;r<this.Data.length;){var n=this.Data[r].Date,s=this.Data[r].Time;if(o+1<e.length&&(e[o].Date<n&&e[o+1].Date<=n||e[o].Date==n&&e[o].Time<s&&e[o+1].Time<=s)){++o;continue}var l=new Wt;l.Date=n,l.Time=s,o<e.length?(l.Value=e[o].Value,l.FinanceDate=e[o].Date,l.FinanceTime=e[o].Time):(l.Value=null,l.FinanceDate=null,l.FinanceTime=null),a[r]=l,++r}return a},this.GetFittingTradeData=function(e,a,r){for(var t=[],n=!1,s=0,o=0;s<this.Data.length;){var l=this.Data[s].Date;if(o<e.length&&e[o].Date>l){var h=new Wt;h.Date=l,h.Value=a,t[s]=h,++s;continue}if(o+1<e.length&&e[o].Date<l&&e[o+1].Date<=l){++o,n=!1;continue}var h=new Wt;if(h.Date=l,h.Value=a,h.FinanceDate=null,o<e.length){var u=e[o];this.Period==0&&r===!0?u.Date==h.Date&&(h.Value=u.Value,h.FinanceDate=u.Date,n=!0):n==!1&&(h.Value=u.Value,h.FinanceDate=u.Date,n=!0)}t[s]=h,++s}return t},this.GetMinuteFittingTradeData=function(e,a,r){for(var t=[],n=!1,s=0,o=0;s<this.Data.length;){var l=this.Data[s].Date,h=this.Data[s].Time;if(o<e.length&&(e[o].Date>l||e[o].Date==l&&e[o].Time>h)){var u=new Wt;u.Date=l,u.Time=h,u.Value=a,t[s]=u,++s;continue}if(o+1<e.length&&(e[o].Date<l&&e[o+1].Date<=l||e[o].Date==l&&e[o].Time<h&&e[o+1].Time<=h)){++o,n=!1;continue}var u=new Wt;if(u.Date=l,u.FinanceDate=null,u.Time=h,u.Value=a,o<e.length){var f=e[o];this.Period==4&&r===!0?f.Date==u.Date&&f.Time==u.Time&&(u.Value=f.Value,u.FinanceDate=f.Date,u.FinanceTime=f.Time,n=!0):n==!1&&(u.Value=f.Value,u.FinanceDate=f.Date,u.FinanceTime=f.Time,n=!0)}t[s]=u,++s}return t},this.GetFittingMarketValueData=function(e){for(var a=[],r=0,t=0;r<this.Data.length;){var n=this.Data[r].Date,s=this.Data[r].Close;if(t+1<e.length&&e[t].Date<n&&e[t+1].Date<=n){++t;continue}var o=new Wt;o.Date=n,o.Value=e[t].Value*s,o.FinanceDate=e[t].Date,a[r]=o,++r}return a},this.GetFittingMonthData=function(e){for(var a=new Array,r=null,t=0,n=0;t<this.Data.length;){var s=this.Data[t].Date;if(n>=e.length){a[t]=null,++t;continue}var o=e[n].Date;if(o==s){var l=new Wt;l.Date=e[n].Date,l.Value=e[n].Value,l.Text=e[n].Text,a[t]=l,++n,++t}else if(r!=null&&r<o&&s>o){var l=new Wt;l.Date=s,l.OverlayDate=e[n].Date,l.Value=e[n].Value,l.Text=e[n].Text,a[t]=l,++n,++t}else o<s?++n:(a[t]=new Wt,a[t].Date=s,++t);r=s}return a},this.GetValue=function(){var e=[];for(var a in this.Data)if(this.Data[a]&&this.Data[a].Value!=null){var r=this.Data[a].Value;isNaN(r)?r instanceof Array?e[a]=r:e[a]=null:e[a]=r}else e[a]=null;return e},this.GetObject=function(){var e=[];for(var a in this.Data)if(this.Data[a]&&this.Data[a].Value){var r=this.Data[a].Value;e[a]=r}else e[a]=null;return e},this.GetPeriodSingleData=function(e){var a=new Array,r=0,t=2,n=null;for(var s in this.Data){var o=!1,l=this.Data[s];if(!(l==null||l.Date==null)){switch(e){case 1:var h=Y.GetFirday(l.Date);h!=r&&(o=!0,r=h);break;case 21:var h=Y.GetFirday(l.Date);h!=r&&(++t,t>=2&&(o=!0,t=0),r=h);break;case 2:parseInt(l.Date/100)!=parseInt(r/100)&&(o=!0,r=l.Date);break;case 3:parseInt(l.Date/1e4)!=parseInt(r/1e4)&&(o=!0,r=l.Date);break;case 9:var u=Y.GetQuarter(l.Date);u=parseInt(l.Date/1e4)*10+u;var f=Y.GetQuarter(r);f=parseInt(r/1e4)*10+f,u!=f&&(o=!0,r=l.Date);break}if(o)n=new Wt,n.Date=l.Date,n.Value=l.Value,a.push(n);else{if(n==null||l.Value==null||isNaN(l.Value))continue;(n.Value==null||isNaN(n.Value))&&(n.Value=l.Value)}}}return a},this.GetMinuteAvPrice=function(){var e=new Array;for(var a in this.Data)e[a]=this.Data[a].AvPrice;return e},this.MergeMinuteData=function(e){if(!this.Data||this.Data.length<=0)return this.Data=e,!0;for(var a=this.Data[0],r=0,t=null,f=0;f<e.length;++f){var n=e[f];if(n.Date>a.Date){r=f,t=n;break}if(n.Date==a.Date&&n.Time>=a.Time){r=f,t=n;break}}if(t==null)return!1;for(var s=null,o=!1,f=this.Data.length-1;f>=0;--f){var l=this.Data[f].Date,h=this.Data[f].Time;if(t.Date>l||t.Date==l&&t.Time>=h){s=f,t.Date==l&&t.Time==h&&(o=!0);break}}if(s==null)return!1;var u=s,f=r;if(o==!0){var n=e[f];if(u-1>0){var C=this.Data[u-1];n.YClose||(n.YClose=C.Close),!v.IsNumber(n.FlowCapital)&&v.IsNumber(C.FlowCapital)&&(n.FlowCapital=C.FlowCapital)}var D=Pt.Copy(n);this.Data[u]=D,++u,++f}else++u;for(;f<e.length;){var n=e[f];if(u>=this.Data.length-1){if(u-1>0){var C=this.Data[u-1];n.YClose||(n.YClose=C.Close),!v.IsNumber(n.FlowCapital)&&v.IsNumber(C.FlowCapital)&&(n.FlowCapital=C.FlowCapital)}var D=Pt.Copy(n);this.Data[u]=D,++u,++f}else{var c=this.Data[u];c.Date==n.Date&&c.Time==n.Time?(Pt.CopyTo(c,n),++u,++f):++u}}return!0},this.ConverPeriod=function(e,a,r){for(var t=[],n=null,s=Y.IsMinutePeriod(a,!0),o=Y.IsMinutePeriod(r,!0),l=s&&o,h=s&&!o,u=!s&&!o,f=0,C=0;f<this.Data.length;++f){for(var D=this.Data[f];C<e.length;++C){var c=e[C];if(l){if(c.Date>D.Date||c.Date==D.Date&&c.Time>=D.Time){n=c;break}}else if((h||u)&&c.Date>=D.Date){n=c;break}}var T=null;n?(T=Pt.Copy(n),T.PDate=n.Date,T.PTime=n.Time):T=new Pt,T.Date=D.Date,(l||h)&&(T.Time=D.Time),t.push(T)}return k.Chart.Log("[ChartData::ConverPeriod] result",t),t},this.GetRef=function(e){for(var a=[],r=0;r<this.Data.length;++r){a[r]=null;var t=this.Data[r];if(r-e<0){var s=new Pt;s.Date=t.Date,s.Time=t.Time,a[r]=s;continue}var n=this.Data[r-e],s=Pt.Copy(n);s.Date=t.Date,s.Time=t.Time,a[r]=s}return a},this.FitKLineIndex=function(e,a,r,t){for(var n=this.Data.length,s=e.length,o=[Y.IsMinutePeriod(r,!0),Y.IsMinutePeriod(t,!0)],l=[Y.IsDayPeriod(r,!0),Y.IsDayPeriod(t,!0)],h=Y.GetKLineDataTime(this.Data[0]),u=[],f=s,C=0;C<s;++C){var D=Y.GetKLineDataTime(e[C]);if(l[0]&&l[1]||o[0]&&l[1]){if(D.Date>=h.Date){f=C;break}}else if(o[0]&&o[1]){if(D.Date>h.Date){f=C;break}if(D.Date==h.Date&&D.Time>=h.Time){f=C;break}}}for(var C=0,c=f;C<n;){var D=Y.GetKLineDataTime(this.Data[C]);if(c>=s){var T={Date:D.Date,Time:D.Time,Index:-1};u[C]=T,++C;continue}var S=Y.GetKLineDataTime(e[c]);if(l[0]&&l[1]||o[0]&&l[1])if(S.Date==D.Date){var T={Date:D.Date,Time:D.Time,Index:c,Data2:S.Date,Time2:S.Time};u[C]=T,++C}else if(c+1<s){var I=Y.GetKLineDataTime(e[c+1]);if(S.Date<=D.Date&&I.Date>D.Date){var T={Date:D.Date,Time:D.Time,Index:c+1,Data2:I.Date,Time2:I.Time};u[C]=T,++C}else if(I.Date<=D.Date)++c;else{var T={Date:D.Date,Time:D.Time,Index:-1};u[C]=T,++C}}else++c;else if(o[0]&&o[1])if(S.Date==D.Date&&S.Time==D.Time){var T={Date:D.Date,Time:D.Time,Index:c,Data2:S.Date,Time2:S.Time};u[C]=T,++C}else if(c+1<s){var I=Y.GetKLineDataTime(e[c+1]);if(S.Date<D.Date&&I.Date>D.Date||S.Date==D.Date&&S.Time<D.Time&&I.Date==D.Date&&I.Time>D.Time||S.Date==D.Date&&S.Time<D.Time&&I.Date>D.Date||S.Date<D.Date&&I.Date==D.Date&&I.Time>D.Time){var T={Date:D.Date,Time:D.Time,Index:c+1,Data2:I.Date,Time2:I.Time};u[C]=T,++C}else if(I.Date<D.Date||I.Date==D.Date&&I.Time<=D.Time)++c;else{var T={Date:D.Date,Time:D.Time,Index:-1};u[C]=T,++C}}else++c}var g=[];for(var C in a){var D=a[C];if(Array.isArray(D.Data)){var E=[];g[C]={Data:E,Name:D.Name};for(var c=0;c<u.length;++c){var F=u[c];E[c]=null,F&&F.Index>=0&&F.Index<D.Data.length&&(E[c]=D.Data[F.Index])}}else g[C]={Data:D.Data,Name:D.Name}}return g},this.FindDataIndexByDateTime=function(e){var a=0;for(var r in e)e[r].Index=-1;for(var r in this.Data){var t=this.Data[r];for(var n in e){var s=e[n];if(!(s.Index>=0)){if(v.IsNumber(s.Time)){if(s.Date==t.Date&&s.Time==t.Time){s.Index=parseInt(r),++a;break}}else if(s.Date==t.Date){s.Index=parseInt(r),++a;break}if(a>=e.length)break}}}},this.CloneData=function(e){var a=[];if(e=="HistoryData")for(var r in this.Data){var t=this.Data[r],n=Pt.Copy(t);a.push(n)}return a},this.GetAPIDataIndex=function(e,a){var r=[];if(e&&a){for(var t=this.Data.length,n=e.length,s=Y.GetKLineDataTime(this.Data[0]),o=n,o=n,l=0;l<n;++l){var h=e[l],u=a[l];if(h>s.Date||h==s.Date&&u>=s.Time){o=l;break}}for(var l=0,f=o;l<t;){var C=this.Data[l];if(f>=n){var D={KDate:C.Date,KTime:C.Time,KIndex:l,Index:-1};r[l]=D,++l;continue}var h=e[f],u=a[f];if(h==C.Date&&u==C.Time){var D={KDate:C.Date,KTime:C.Time,KIndex:l,Index:f,Data:h,Time:u};r[l]=D,++l}else if(f+1<n){var c=e[f+1],T=a[f+1];if(h<C.Date&&c>C.Date||h==C.Date&&u<C.Time&&c==C.Date&&T>C.Time||h==C.Date&&u<C.Time&&c>C.Date||h<C.Date&&c==C.Date&&T>C.Time){var D={KDate:C.Date,KTime:C.Time,KIndex:l,Index:f,Data:h,Time:u};r[l]=D,++l}else if(c<C.Date||c==C.Date&&T<=C.Time)++f;else{var D={KDate:C.Date,KTime:C.Time,KIndex:l,Index:-1};r[l]=D,++l}}else++f}}else if(e){for(var t=this.Data.length,n=e.length,s=Y.GetKLineDataTime(this.Data[0]),o=n,l=0;l<n;++l){var C=e[l];if(C>=s.Date){o=l;break}}for(var l=0,f=o;l<t;){var C=this.Data[l];if(f>=n){var D={KDate:C.Date,KIndex:l,Index:-1};r[l]=D,++l;continue}var S=e[f];if(S==C.Date){var D={KDate:C.Date,KIndex:l,Index:f,Data:S};r[l]=D,++l}else if(f+1<n){var I=e[f+1];if(S<=C.Date&&I>C.Date){var D={KDate:C.Date,KIndex:l,Index:f,Data:S};r[l]=D,++l}else if(I<=C.Date)++f;else{var D={KDate:C.Date,KIndex:l,Index:-1};r[l]=D,++l}}else++f}}return r},this.FixKData=function(e,a){return Y.IsDayPeriod(a,!0)?this.FixKData_Day(e):Y.IsMinutePeriod(a,!0)?this.FixKData_Minute(e):null},this.FixKData_Day=function(e){for(var a=[],r=e.length,t=0,n=0;t<this.Data.length;){var s=this.Data[t];if(n<r){var u=e[n];if(u.Date>s.Date){++t;continue}}if(n+1<r){var u=e[n],o=e[n+1];if(u.Date<s.Date&&o.Date<=s.Date){++n;continue}}var l=new Pt;l.Date=s.Date;var h=n<r?n:r-1,u=e[h];l.Close=u.Close,l.High=u.High,l.Low=u.Low,l.Open=u.Open,l.YClose=u.YClose,l.Amount=u.Amount,l.Vol=u.Vol,l.ExDate=u.Date,a[t]=l,++t}return a},this.FixKData_Minute=function(e){for(var a=[],r=e.length,t=0,n=0;t<this.Data.length;){var s=this.Data[t],o=Y.DateTimeToNumber(s);if(n<r){var D=e[n],l=Y.DateTimeToNumber(D);if(l>o){++t;continue}}if(n+1<r){var D=e[n],h=e[n+1],l=Y.DateTimeToNumber(D),u=Y.DateTimeToNumber(h);if(l<o&&u<=o){++n;continue}}var f=new Pt;f.Date=s.Date,f.Time=s.Time;var C=n<r?n:r-1,D=e[C];f.Close=D.Close,f.High=D.High,f.Low=D.Low,f.Open=D.Open,f.YClose=D.YClose,f.Amount=D.Amount,f.Vol=D.Vol,f.ExDate=D.Date,f.ExTime=D.Time,a[t]=f,++t}return a},this.GetDataRange=function(e,a){if(!v.IsNonEmptyArray(this.Data))return null;for(var r={},t=0;t<this.Data.length;++t){var n=this.Data[t];if(n.Date==e.Date&&(v.IsNumber(e.Time)?n.Time==e.Time&&(r.Start={Index:t,Date:n.Date,Time:n.Time}):r.Start={Index:t,Date:n.Date}),(n.Date=a.Date)&&(v.IsNumber(a.Time)?n.Time==a.Time&&(r.End={Index:t,Date:n.Date,Time:n.Time}):r.End={Index:t,Date:n.Date}),r.Start&&r.End)return r}return null},this.ExportArrayData=function(e,a){if(!v.IsNonEmptyArray(this.Data))return null;var r=0,t=this.Data.length-1;a&&a.Start&&a.End&&v.IsNumber(a.Start.Index)&&v.IsNumber(a.End.Index)&&(r=a.Start.Index,t=a.End.Index);for(var n=[],s=r;s<=t&&s<this.Data.length;++s)n[s]=this.Data[s];return n},this.ExportBoolData=function(e,a){if(!v.IsNonEmptyArray(this.Data))return null;var r=0,t=this.Data.length-1;a&&a.Start&&a.End&&v.IsNumber(a.Start.Index)&&v.IsNumber(a.End.Index)&&(r=a.Start.Index,t=a.End.Index);for(var n=[],s=r;s<=t&&s<this.Data.length;++s){var o=this.Data[s];n[s]=!1,v.IsPlusNumber(o)&&(n[s]=!0)}return n},this.ExportKLineData=function(e){if(!v.IsNonEmptyArray(this.Data))return null;var a=0,r=this.Data.length-1;e&&e.Start&&e.End&&v.IsNumber(e.Start.Index)&&v.IsNumber(e.End.Index)&&(a=e.Start.Index,r=e.End.Index);for(var t=[],n=[],s=[],o=[],l=[],h=[],u=[],f=[],C=a;C<=r&&C<this.Data.length;++C){var D=this.Data[C];t[C]=D.Date,n[C]=D.Open,s[C]=D.High,o[C]=D.Low,u[C]=D.Close,l[C]=D.Vol,h[C]=D.Amount,f[C]=D.Time}if(e&&e.IsOverlay){var c=[{Name:"Open",Data:n},{Name:"High",Data:s},{Name:"Low",Data:o},{Name:"Close",Data:u},{Name:"Vol",Data:l},{Name:"Amount",Data:h}];return c}var c=[{Name:"Date",Data:t}];return(Y.IsMinutePeriod(this.Period,!0)||Y.IsSecondPeriod(this.Period)||Y.IsMilliSecondPeriod(this.Period))&&c.push({Name:"Time",Data:f}),c.push({Name:"Open",Data:n},{Name:"High",Data:s},{Name:"Low",Data:o},{Name:"Close",Data:u},{Name:"Vol",Data:l},{Name:"Amount",Data:h}),c},this.ExportMinuteData=function(e){if(!v.IsNonEmptyArray(this.Data))return null;var a=[],r=[],t=[],n=[],s=[],o=[],l=[],h=[],u=[],f=[],C=0,D=this.Data.length-1;e&&e.Start&&e.End&&v.IsNumber(e.Start.Index)&&v.IsNumber(e.End.Index)&&(C=e.Start.Index,D=e.End.Index);for(var c=C;c<=D&&c<this.Data.length;++c){var T=this.Data[c];a[c]=T.Date,r[c]=T.Open,t[c]=T.High,n[c]=T.Low,l[c]=T.Close,s[c]=T.Vol,o[c]=T.Amount,h[c]=T.Time,f[c]=T.AvPrice,u[c]=T.Position}var S=[{Name:"Open",Data:r},{Name:"High",Data:t},{Name:"Low",Data:n},{Name:"Close",Data:l},{Name:"Vol",Data:s},{Name:"Amount",Data:o},{Name:"AvPrice",Data:f},{Name:"Position",Data:u}];return e&&e.IsOverlay||S.splice(0,0,{Name:"Date",Data:a},{Name:"Time",Data:h}),S}}Y.DateTimeToNumber=function(e){return e.Date*1e4+e.Time};Y.GetKLineDataTime=function(e){var a={Date:e.Date,Time:0};return v.IsNumber(e.Time)&&(a.Time=e.Time),a};Y.GetFirday=function(e){var a=new Date(parseInt(e/1e4),e/100%100-1,e%100),r=a.getDay();if(r==5)return e;var t=a.getTime();if(r<5){var n=864e5*(5-r);t+=n}else{var n=864e5*(r-5);t-=n}a.setTime(t);var s=a.getFullYear()*1e4+(a.getMonth()+1)*100+a.getDate();return a.getDay(),s};Y.GetSunday=function(e){var a=new Date(parseInt(e/1e4),e/100%100-1,e%100),r=a.getDay();if(r==0)return e;var t=a.getTime();if(r>0){var n=864e5*(7-r);t+=n}a.setTime(t);var s=a.getFullYear()*1e4+(a.getMonth()+1)*100+a.getDate();return a.getDay(),s};Y.GetQuarter=function(e){var a=parseInt(e%1e4/100);return a==1||a==2||a==3?1:a==4||a==5||a==6?2:a==7||a==8||a==9?3:a==10||a==11||a==12?4:0};Y.GetHalfYear=function(e){var a=parseInt(e/1e4),r=e%1e4;return r<=630?a*1e4+630:a*1e4+1231};var Or=4e4,Pn=49999;Y.IsDayPeriod=function(e,a){return e==1||e==2||e==3||e==9||e==21||e==22||e>Or&&e<=Pn||e==0&&a==!0};var Ii=2e4,Nr=29999;Y.IsMinutePeriod=function(e,a){return e==5||e==6||e==7||e==8||e==11||e==12||e>Ii&&e<=Nr||e==4&&a==!0};var un=3e4,qh=32e3;Y.IsSecondPeriod=function(e){return e>un&&e<=qh};var fn=5e4,jh=6e4;Y.IsMilliSecondPeriod=function(e){return e>fn&&e<=jh};Y.IsTickPeriod=function(e){return e==10};Y.GetPeriodName=function(e){var a=new Dt.default([[0,"日线"],[1,"周线"],[2,"月线"],[3,"年线"],[9,"季线"],[21,"双周"],[22,"半年"],[4,"1分"],[5,"5分"],[6,"15分"],[7,"30分"],[8,"60分"],[11,"2小时"],[12,"4小时"],[10,"分笔"]]);return a.has(e)?a.get(e):""};function ns(){this.ChartPaint,this.Data,this.Type=0}function Ia(e,a,r,t){this.X=e,this.Y=a,this.Width=r,this.Height=t,this.PtInRect=function(n,s){var o=this.X,l=this.X+this.Width,h=this.Y,u=this.Y+this.Height;return n>=o&&n<=l&&s>=h&&s<=u}}function Nd(){this.DataMap=new Dt.default([["ChartKLine",{Create:function(a){return new Pr}}],["ChartMinuteVolumBar",{Create:function(a){return new PC}}],["ChartMinutePriceLine",{Create:function(a){return new YC}}]]),this.Create=function(e,a){if(!this.DataMap.has(e))return k.Warn("[ChartPaintFactory::Create] can't find class="+e+"."),null;var r=this.DataMap.get(e);return r.Create(a)},this.Add=function(e,a){this.DataMap.set(e,{Create:a.Create})}}var Cs=new Nd;function Xt(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="IChartPainting",this.Data=new Y,this.Script,this.NotSupportMessage=null,this.MessageFont=d.Index.NotSupport.Font,this.MessageColor=d.Index.NotSupport.TextColor,this.IsDrawFirst=!1,this.IsShow=!0,this.IsVisible=!0,this.GetEventCallback,this.SelectedLineWidth=d.SelectedChart.LineWidth,this.SelectedLineColor=d.SelectedChart.LineColor,this.SelectedRadius=d.SelectedChart.Radius,this.SelectedPointMinSpace=d.SelectedChart.MinSpace,this.SelectedBGColor=d.SelectedChart.BGColor,this.DrawSelectedStatus,this.PtInChart,this.IsFullRangeMaxMin=!1,this.IsExcludeYValue=!1,this.Draw=function(){},this.GetBorder=function(){return this.ChartFrame.IsHScreen?this.ChartBorder.GetHScreenBorder():this.ChartBorder.GetBorder()},this.ClipClient=function(e){if(e==!0)var a=this.ChartBorder.GetLeftEx(),r=this.ChartBorder.GetRightEx(),t=this.ChartBorder.GetTop(),n=this.ChartBorder.GetBottom();else var a=this.ChartBorder.GetLeft(),r=this.ChartBorder.GetRight(),t=this.ChartBorder.GetTopEx(),n=this.ChartBorder.GetBottomEx();this.Canvas.beginPath(),this.Canvas.rect(a,t,r-a,n-t),this.Canvas.clip()},this.GetYFromData=function(e,a){return this.ChartFrame.GetYFromData(e,a)},this.IsMinuteFrame=function(){var e=this.ChartFrame.ClassName=="MinuteFrame"||this.ChartFrame.ClassName=="MinuteHScreenFrame"||this.ChartFrame.ClassName=="OverlayMinuteFrame"||this.ChartFrame.ClassName=="OverlayMinuteHScreenFrame";return e},this.DrawNotSupportmessage=function(){this.Canvas.font=this.MessageFont,this.Canvas.fillStyle=this.MessageColor;var e=this.ChartBorder.GetLeft(),a=this.ChartBorder.GetWidth(),r=this.ChartBorder.GetTopEx(),t=this.ChartBorder.GetHeightEx(),n=e+a/2,s=r+t/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.NotSupportMessage,n,s)},this.GetTooltipData=function(e,a,r){return!1},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset;this.ChartFrame.GlobalOption&&this.ChartFrame.GlobalOption.IsValueFullRange&&(a=0,e=this.Data.Data.length);var r={};if(r.Min=null,r.Max=null,!this.Data||!this.Data.Data)return r;for(var t=a,n=0;t<this.Data.Data.length&&n<e;++t,++n){var s=this.Data.Data[t];s==null||isNaN(s)||(r.Max==null&&(r.Max=s),r.Min==null&&(r.Min=s),r.Max<s&&(r.Max=s),r.Min>s&&(r.Min=s))}return r},this.GetDynamicFont=function(e,a,r,t,n,s){var o=B();if(r*=o,t*=o,r==t){var h=r.toFixed(0)+"px "+s;return h}var l=e+a;n&&(n.Type==0?n.Value>0&&(l=e*n.Value):n.Type==1?n.Value>0&&(l=(e+a)*n.Value):n.Type==2&&v.IsNumber(n.Value)&&(l=e+a+2*n.Value*o)),l<t?l=t:l>r&&(l=r);var h=l.toFixed(0)+"px "+s;return h},this.GetLockRect=function(){return this.ChartFrame.GetLockRect()},this.SetFillStyle=function(e,a,r,t,n){if(Array.isArray(e)){for(var s=this.Canvas.createLinearGradient(a,r,t,n),o=1/(e.length-1),l=0;l<e.length;++l){var h=l*o;s.addColorStop(h,e[l])}this.Canvas.fillStyle=s}else this.Canvas.fillStyle=e},this.GetDynamicIconSize=function(e,a,r,t,n){var s=B();if(r*=s,t*=s,r==t)return r;var o=e+a-2*s;return n&&(n.Type==0?n.Value>0&&(o=e*n.Value):n.Type==1?n.Value>0&&(o=(e+a)*n.Value):n.Type==2&&v.IsNumber(n.Value)&&(o=e+a+2*n.Value*s)),o<t?o=t:o>r&&(o=r),o},this.GetFontHeight=function(e){return Ea(this.Canvas,e,"擎")},this.DrawLinePoint=function(e){var a=this.ChartFrame.IsHScreen===!0;if(!a&&this.IsShow){var r=this.IsMinuteFrame(),t=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,s=this.ChartFrame.XPointCount;if(a)var o=this.ChartBorder.GetHScreenBorder(),l=o.BottomEx,h=o.TopEx+n/2+d.FrameLeftMargin;else var o=this.ChartBorder.GetBorder(),h=o.LeftEx+n/2+d.FrameLeftMargin,l=o.RightEx;var u=this.GetLockRect();u&&(a?l=u.Top:l=u.Left);var f=B();this.Canvas.save(),this.ClipClient(a),this.Canvas.lineWidth=this.SelectedLineWidth*f,this.Canvas.strokeStyle=this.SelectedLineColor,this.SelectedBGColor&&(this.Canvas.fillStyle=this.SelectedBGColor);var C=this.SelectedRadius,D=Math.ceil(this.SelectedPointMinSpace/(t+n));if(D<=0&&(D=1),r){var c=(o.Right-o.Left)/s;D=Math.ceil(this.SelectedPointMinSpace/c)}var T=0,S=null,I=null;e&&(e.KLineClose?T=1:e.MinuteVolBar?T=2:e.MinuteOverlayPrice?e.OverlayType==1?T=1:T=3:e.OverlayKLine?(T=4,S=this.GetFirstOpen()):e.StackedBar&&(T=5));for(var g=this.Data.DataOffset,E=0,F=0;g<this.Data.Data.length&&E<s;++g,++E,++F,h+=t+n){var R=null;if(T==1){var A=this.Data.Data[g];v.IsNumber(A.Close)&&(R=A.Close)}else if(T==2){var A=this.Data.Data[g];v.IsNumber(A.Vol)&&(R=A.Vol)}else if(T==3){var P=this.Data.Data[g],p=this.MainData.Data[g];if(!P||!v.IsNumber(P.Close)||!v.IsNumber(P.YClose)||!p||!v.IsNumber(p.Close)||!v.IsNumber(p.YClose))continue;var w=P.Close,R=w/P.YClose*p.YClose}else if(T==4){var H=this.Data.Data[g];I==null&&(I=H.Open),R=H.Close/I*S}else if(T==5){var W=this.Data.Data[g];if(!v.IsNonEmptyArray(W))continue;for(var ht=0,rt=0,F=0;F<W.length;++F){var nt=W[F];v.IsNumber(nt)&&nt!=0&&(nt>0?ht+=nt:nt<0&&(rt+=nt))}R=(ht+rt)/2}else R=this.Data.Data[g];if(R!=null&&!(F<D)){if(F=0,r)var vt=this.ChartFrame.GetXFromIndex(E);else{var Nt=h,Ft=h+t;if(Ft>l)break;var vt=Nt+(Ft-Nt)/2}var Bt=this.GetYFromData(R,!1);if(vt>l)break;this.Canvas.beginPath(),this.Canvas.arc(vt,Bt,C,0,360,!1),this.Canvas.closePath(),this.SelectedBGColor&&this.Canvas.fill(),this.Canvas.stroke()}}this.Canvas.restore()}},this.PtInLine=function(e,a,r){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){var t=this.ChartFrame.IsHScreen===!0;if(!t){var n=this.IsMinuteFrame(),s=this.ChartFrame.DataWidth,o=this.ChartFrame.DistanceWidth,l=this.ChartFrame.XPointCount;if(t)var h=this.ChartBorder.GetHScreenBorder(),u=h.BottomEx,f=h.TopEx+o/2+d.FrameLeftMargin;else var h=this.ChartBorder.GetBorder(),f=h.LeftEx+o/2+d.FrameLeftMargin,u=h.RightEx;var C=this.GetLockRect();if(C&&(t?u=C.Top:u=C.Left),e<f||e>u||a>h.BottomEx||a<h.TopEx)return null;var D={},c={},T=0;r&&(r.KLineClose?T=1:r.MinuteOverlayPrice&&(r.OverlayType==1?T=1:T=3));for(var S=this.Data.DataOffset,I=0;S<this.Data.Data.length&&I<l;++S,++I,f+=s+o){var g=null;if(T==1){var E=this.Data.Data[S];v.IsNumber(E.Close)&&(g=E.Close)}else if(T==3){var F=this.Data.Data[S],R=this.MainData.Data[S];if(!F||!v.IsNumber(F.Close)||!v.IsNumber(F.YClose)||!R||!v.IsNumber(R.Close)||!v.IsNumber(R.YClose))continue;var A=F.Close,g=A/F.YClose*R.YClose}else g=this.Data.Data[S];if(g!=null){if(n)var P=this.ChartFrame.GetXFromIndex(I);else{var p=f,w=f+s;if(w>u)break;var P=p+(w-p)/2}var H=this.GetYFromData(g,!1);if(P<e)D.X=P,D.Y=H;else if(P==e){D.X=c.X=P,D.Y=c.Y=H;break}else{c.X=P,c.Y=H;break}if(e>u)break}}if(!v.IsNumber(D.X)||!v.IsNumber(D.Y)||!v.IsNumber(c.X)||!v.IsNumber(c.Y))return null;if(e==D.X&&a==D.Y)return{Identify:this.Identify,Chart:this};if(e==c.X&&a==c.Y)return{Identify:this.Identify,Chart:this};var W=5;return this.Canvas.beginPath(),D.X==c.X?(this.Canvas.moveTo(D.X-W,D.Y),this.Canvas.lineTo(D.X+W,D.Y),this.Canvas.lineTo(c.X+W,c.Y),this.Canvas.lineTo(c.X-W,c.Y)):(this.Canvas.moveTo(D.X,D.Y+W),this.Canvas.lineTo(D.X,D.Y-W),this.Canvas.lineTo(c.X,c.Y-W),this.Canvas.lineTo(c.X,c.Y+W)),this.Canvas.closePath(),this.Canvas.isPointInPath(e,a)?{Identify:this.Identify,Chart:this}:null}}},this.PtInBar=function(e,a,r){if(!this.IsShow||this.ChartFrame.IsMinSize)return null;var t=this.ChartFrame.IsHScreen===!0;if(t)return null;var n=this.ChartFrame.DataWidth,s=this.ChartFrame.DistanceWidth,o=this.ChartBorder.GetBorder(),l=o.LeftEx+s/2+d.FrameLeftMargin,h=o.RightEx,u=this.ChartFrame.XPointCount,f=this.GetLockRect();if(f&&(h=f.Left),e<l||e>h||a>o.BottomEx||a<o.TopEx)return null;var C=this.IsMinuteFrame(),D=this.ChartFrame.GetYFromData(0),c=null,T=!1,S=!1;r&&(r.BarWidth>0&&(c=r.BarWidth),r.MinuteVolBar==!0?(T=!0,c=4):r.StackedBar==!0&&(S=!0));for(var I=this.Data.DataOffset,g=0;I<this.Data.Data.length&&g<u;++I,++g,l+=n+s){var E=this.Data.Data[I];if(E!=null){if(C)var F=this.ChartFrame.GetXFromIndex(g),R=F-c/2,A=R+c;else{var R=l,A=l+n;if(A>h)break}if(T){if(!v.IsNumber(E.Vol))continue;var P=this.ChartFrame.GetYFromData(E.Vol),p=P,w=D}else if(S){var H=0,W=0;if(!v.IsNonEmptyArray(E))continue;for(var ht=0;ht<E.length;++ht){var rt=E[ht];v.IsNumber(rt)&&rt!=0&&(rt>0?H+=rt:rt<0&&(W+=rt))}var p=this.ChartFrame.GetYFromData(H),w=this.ChartFrame.GetYFromData(W)}else var P=this.ChartFrame.GetYFromData(E),p=P,w=D;p>w&&(p=D,w=P);var nt=R,vt=A;if(c>0&&(nt=R+(A-R)/2-c/2,vt=nt+c),e>=nt&&e<=vt&&a>=p&&a<=w)return{Identify:this.Identify,Chart:this};if(A>e)break}}return null},this.PtInKBar=function(e,a,r){if(!this.IsShow||this.ChartFrame.IsMinSize)return null;var t=this.ChartFrame.IsHScreen===!0;if(t)return null;var n=this.ChartFrame.DataWidth,s=this.ChartFrame.DistanceWidth,o=this.ChartBorder.GetBorder(),l=o.LeftEx+s/2+d.FrameLeftMargin,h=o.RightEx,u=this.ChartFrame.XPointCount;if(t){var o=this.ChartBorder.GetHScreenBorder();l=o.TopEx+s/2+d.FrameLeftMargin,h=o.BottomEx}if(e<l||e>h||a>o.BottomEx||a<o.TopEx)return null;var f=null,C=0,D=null;r&&r.OverlayKLine&&(C=1,D=this.GetFirstOpen());for(var c=this.Data.DataOffset,T=0;c<this.Data.Data.length&&T<u;++c,++T,l+=n+s){var S=this.Data.Data[c];if(!(S.Open==null||S.High==null||S.Low==null||S.Close==null)){f==null&&(f=S.Open);var I=l,g=l+n;if(g>h)break;if(e>=I&&e<=g){if(C==1)var E=this.GetYFromData(S.Low/f*D,!1),F=this.GetYFromData(S.High/f*D,!1);else var E=this.GetYFromData(S.Low,!1),F=this.GetYFromData(S.High,!1);if(a<=E&&a>=F)return{Identify:this.Identify,Chart:this}}if(g>e)break}}},this.IsShowIndexTitleOnly=function(){return!!(this.ChartFrame&&this.ChartFrame.ChartBorder&&this.ChartFrame.ChartBorder.IsShowTitleOnly)},this.IsHideScriptIndex=function(){return!!(this.Script&&this.Script.IsShow==!1)},this.ExportArrayData=function(e,a){var r=this.Data.ExportArrayData(e,a);return[{Name:this.Name,Data:r}]},this.ExportBoolData=function(e,a){var r=this.Data.ExportBoolData(e,a);return[{Name:this.Name,Data:r}]},this.GetArrayItemData=function(e){if(!e||!v.IsNumber(e.Index)||!this.Data||!v.IsNonEmptyArray(this.Data.Data))return null;var a=e.Index;if(a<0||a>=this.Data.Data.length)return null;var r=this.Data.Data[a];return[{Value:r,Color:this.Color,Name:this.Name}]}}var ue=[[48,10],[44,10],[40,9],[36,9],[32,8],[28,8],[24,7],[20,7],[18,6],[16,6],[15,5],[13,5],[9,4],[7,4],[5,4],[3,3],[3,1],[2,1],[1,1],[1,0]];function Pr(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartKLine",this.Symbol,this.DrawType=0,this.CloseLineColor=d.CloseLineColor,this.CloseLineAreaColor=d.CloseLineAreaColor,this.CloseLineWidth=d.CloseLineWidth,this.UpColor=d.UpBarColor,this.DownColor=d.DownBarColor,this.UnchagneColor=d.UnchagneBarColor,this.ColorData,this.TradeData,this.TradeIcon=d.KLine.TradeIcon,this.TooltipRect=[],this.InfoTooltipRect=[],this.TradeIconTooltipRect=[],this.IsShowMaxMinPrice=!0,this.IsShowKTooltip=!0,this.TextFont=d.KLine.MaxMin.Font,this.TextColor=d.KLine.MaxMin.Color,this.InfoData,this.InfoPosition=0,this.PtMax,this.PtMin,this.TickSymbol="╳",this.TickFontName="arial",this.Period,this.ShowRange={},this.CustomKLine,this.DrawKRange={Start:null,End:null},this.IsThinAKBar=!0,this.OneLimitBarType=0,this.HighLowBarColor=d.HighLowBarColor,this.HighLowTextConfig={FontName:d.HighLowText.FontName,MaxSize:d.HighLowText.MaxSize,MinSize:d.HighLowText.MinSize,Color:d.HighLowText.Color,MaxText:d.HighLowText.MaxText},this.HLCAreaConfig={HighLineColor:d.HLCArea.HighLineColor,LowLineColor:d.HLCArea.LowLineColor,CloseLineColor:d.HLCArea.CloseLineColor,LineWidth:d.HLCArea.LineWidth,UpAreaColor:d.HLCArea.UpAreaColor,DownAreaColor:d.HLCArea.DownAreaColor},this.VirtualBarConfig={Color:d.VirtualKLine.Color,LineDash:d.VirtualKLine.LineDash},this.FFKChart,this.OrderFlow={UpColor:{BG:d.OrderFlow.UpColor.BG,Border:d.OrderFlow.UpColor.Border},DownColor:{BG:d.OrderFlow.DownColor.BG,Border:d.OrderFlow.DownColor.Border},UnchagneColor:{BG:d.OrderFlow.UnchagneColor.BG,Border:d.OrderFlow.UnchagneColor.Border},Text:{Color:d.OrderFlow.Text.Color,Family:d.OrderFlow.Text.Family,FontMaxSize:d.OrderFlow.Text.FontMaxSize,MaxValue:d.OrderFlow.Text.MaxValue},Line:{UpDownColor:d.OrderFlow.Line.UpDownColor,MiddleColor:d.OrderFlow.Line.MiddleColor},POCGBColor:d.OrderFlow.POCGBColor,ShowType:0,AskBarColor:d.OrderFlow.AskBarColor,BidBarColor:d.OrderFlow.BidBarColor,AlwaysShowOrderText:d.OrderFlow.AlwaysShowOrderText,IsShowAskText:!0,IsShowAskBar:!1,IsShowBidText:!0,IsShowBidBar:!1,IsShowPOCBG:!0},this.OrderFlow_Style2={BarWidth:d.OrderFlow_Style2.BarWidth,UpColor:d.OrderFlow_Style2.UpColor,DownColor:d.OrderFlow_Style2.DownColor,UnchagneColor:d.OrderFlow_Style2.UnchagneColor},this.OrderFlow_Style3={BarWidth:d.OrderFlow_Style3.BarWidth,UpColor:d.OrderFlow_Style3.UpColor,DownColor:d.OrderFlow_Style3.DownColor,UnchagneColor:d.OrderFlow_Style3.UnchagneColor},this.OrderFlow_Style4={UpColor:d.OrderFlow_Style4.UpColor,DownColor:d.OrderFlow_Style4.DownColor,UnchagneColor:d.OrderFlow_Style4.UnchagneColor,KBarType:1,VolBarSpace:d.OrderFlow_Style4.VolBarSpace,KBarWidth:d.OrderFlow_Style4.KBarWidth,LeftMargin:d.OrderFlow_Style4.LeftMargin,RightMargin:d.OrderFlow_Style4.RightMargin},this.OrderFlow_Style5={AskBarColor:d.OrderFlow_Style5.AskBarColor,BidBarColor:d.OrderFlow_Style5.BidBarColor,LeftMargin:d.OrderFlow_Style5.LeftMargin,RightMargin:d.OrderFlow_Style5.RightMargin},this.IsShowOrderText=!1,this.AryOrderFlowBorder=[],this.ChartHeatMap,this.PriceGap={Enable:!1,Count:1},this.PriceGapStyple={Line:{Color:d.PriceGapStyple.Line.Color},Text:{Color:d.PriceGapStyple.Text.Color,Font:d.PriceGapStyple.Text.Font}},this.AryPriceGapCache=[],this.ReloadResource=function(e){this.TextFont=d.KLine.MaxMin.Font,this.TextColor=d.KLine.MaxMin.Color,this.CloseLineColor=d.CloseLineColor,this.CloseLineAreaColor=d.CloseLineAreaColor,this.CloseLineWidth=d.CloseLineWidth,this.UpColor=d.UpBarColor,this.DownColor=d.DownBarColor,this.UnchagneColor=d.UnchagneBarColor,this.HighLowBarColor=d.HighLowBarColor,this.OrderFlow.UpColor={BG:d.OrderFlow.UpColor.BG,Border:d.OrderFlow.UpColor.Border},this.OrderFlow.DownColor={BG:d.OrderFlow.DownColor.BG,Border:d.OrderFlow.DownColor.Border},this.OrderFlow.UnchagneColor={BG:d.OrderFlow.UnchagneColor.BG,Border:d.OrderFlow.UnchagneColor.Border},this.OrderFlow.Text={Color:d.OrderFlow.Text.Color,Family:d.OrderFlow.Text.Family,FontMaxSize:d.OrderFlow.Text.FontMaxSize,MaxValue:d.OrderFlow.Text.MaxValue},this.OrderFlow.Line={UpDownColor:d.OrderFlow.Line.UpDownColor,MiddleColor:d.OrderFlow.Line.MiddleColor}},this.ClearCustomKLine=function(){this.CustomKLine=null},this.GetCustomKLine=function(e){if(!this.CustomKLine||!e)return null;var a=e.Date*1e6;if(v.IsNumber(e.Time)&&(a+=e.Time),!this.CustomKLine.has(a))return null;var r=this.CustomKLine.get(a);return r},this.DrawHeatMap=function(){this.ChartHeatMap&&(this.ChartHeatMap.Canvas=this.Canvas,this.ChartHeatMap.ChartBorder=this.ChartBorder,this.ChartHeatMap.ChartFrame=this.ChartFrame,this.ChartHeatMap.Data=this.Data,this.ChartHeatMap.Draw())},this.ClearHeatMap=function(){this.ChartHeatMap=null},this.CreateHeatMap=function(){this.ChartHeatMap=new Ad},this.DrawAKLine=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount;if(e)var n=this.ChartBorder.GetHScreenBorder(),s=n.TopEx+r/2+d.FrameLeftMargin,o=n.BottomEx;else var n=this.ChartBorder.GetBorder(),s=n.LeftEx+r/2+d.FrameLeftMargin,o=n.RightEx;var l=this.UpColor,h=this.DownColor,u=this.UnchagneColor,f={X:null,Y:null,Value:null,Align:"left"},C={X:null,Y:null,Value:null,Align:"left"};this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset;var D=null;this.GetEventCallback&&(D=this.GetEventCallback($.ON_CUSTOM_UNCHANGE_KLINE_COLOR));for(var c=null,T=this.Data.DataOffset,S=0;T<this.Data.Data.length&&S<t;++T,++S,s+=a+r,++this.ShowRange.DataCount){var I=this.Data.Data[T];if(this.ShowRange.End=T,!(I.Open==null||I.High==null||I.Low==null||I.Close==null)){var g=s,E=s+a;if(E>o)break;var F=g+(E-g)/2,R=this.GetYFromData(I.Low,!1),A=this.GetYFromData(I.High,!1),P=this.GetYFromData(I.Open,!1),p=this.GetYFromData(I.Close,!1);this.DrawKRange.End=T;var w={Data:I,Coordinate:{X:F,Low:R,High:A,Close:p,Open:P,Left:g,Right:E}};if((f.Value==null||f.Value<I.High)&&(f.X=F,f.Y=A,f.Value=I.High,f.Align=S<t/2?"left":"right"),(C.Value==null||C.Value>I.Low)&&(C.X=F,C.Y=R,C.Value=I.Low,C.Align=S<t/2?"left":"right"),u=this.UnchagneColor,I.Open<I.Close)this.Canvas.strokeStyle=this.UpColor;else if(I.Open>I.Close)this.Canvas.strokeStyle=this.DownColor;else{if(D&&D.Callback){var H={KItem:I,DataIndex:T,DefaultColor:u,BarColor:null};D.Callback(D,H,this),H.BarColor&&(u=H.BarColor)}this.Canvas.strokeStyle=u}if(this.ColorData&&(T<this.ColorData.length?l=h=u=this.ColorData[T]>0?this.UpColor:this.DownColor:l=h=u=this.DownColor),this.IsThinAKBar==!1&&a>=9){var W={YLow:R,YHigh:A,YOpen:P,YClose:p,X:F,Left:g,Right:E},ht={UpColor:l,DownColor:h,UnchangeColor:u};this.DrawAKBar(I,a,e,W,ht)}else this.Canvas.beginPath(),e?I.High==I.Low&&a<4?(this.Canvas.moveTo(A,L(F)),this.Canvas.lineTo(R-1,L(F))):(this.Canvas.moveTo(A,L(F)),this.Canvas.lineTo(R,L(F))):I.High==I.Low&&a<4?(this.Canvas.moveTo(L(F),A),this.Canvas.lineTo(L(F),R+1)):(this.Canvas.moveTo(L(F),A),this.Canvas.lineTo(L(F),R)),this.Canvas.stroke(),a>=4&&(this.Canvas.beginPath(),e?(this.Canvas.moveTo(L(P),g),this.Canvas.lineTo(L(P),F)):(this.Canvas.moveTo(g,L(P)),this.Canvas.lineTo(F,L(P))),this.Canvas.stroke(),this.Canvas.beginPath(),e?(this.Canvas.moveTo(L(p),E),this.Canvas.lineTo(L(p),F)):(this.Canvas.moveTo(E,L(p)),this.Canvas.lineTo(F,L(p))),this.Canvas.stroke());if(this.Data.DataType==0){var rt={Xleft:g,XRight:E,YMax:A,XCenter:F,YMin:R,DayData:I,Index:S};this.DrawInfo(rt)}if(this.PriceGap.Enable&&c){this.CheckPriceGap(w);var nt=this.IsPriceGap(w,c);nt>0&&this.AryPriceGapCache.push({Data:[c,w],Type:nt})}c=w}}this.PtMax=f,this.PtMin=C},this.DrawAKBar=function(e,a,r,t,n){var s=a/3,o=b(t.Left),l=[o,b(o+s),b(o+s*2),b(o+s*3)],h=t.YHigh,u=t.YLow,f=t.YOpen,C=t.YClose;if(e.Open<e.Close?(this.Canvas.strokeStyle=n.UpColor,this.Canvas.fillStyle=n.UpColor):e.Open>e.Close?(this.Canvas.strokeStyle=n.DownColor,this.Canvas.fillStyle=n.DownColor):(this.Canvas.strokeStyle=n.UnchangeColor,this.Canvas.fillStyle=n.UnchangeColor),r)if(e.High==e.Low){var D=h-s/2;this.Canvas.fillRect(D,l[1],s,l[2]-l[1])}else this.Canvas.fillRect(h,l[1],u-h,l[2]-l[1]);else if(e.High==e.Low){var D=h-s/2;this.Canvas.fillRect(l[1],D,l[2]-l[1],s)}else this.Canvas.fillRect(l[1],h,l[2]-l[1],u-h);var D=f-s/2;r?this.Canvas.fillRect(D,l[0],s,l[1]-l[0]):this.Canvas.fillRect(l[0],D,l[1]-l[0],s);var D=C-s/2;r?this.Canvas.fillRect(D,l[2],s,l[3]-l[2]):this.Canvas.fillRect(l[2],D,l[3]-l[2],s)},this.DrawCloseArea=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount;if(e)var n=this.ChartBorder.GetHScreenBorder(),s=n.TopEx+r/2+d.FrameLeftMargin,o=n.BottomEx,l=n.TopEx;else var n=this.ChartBorder.GetBorder(),s=n.LeftEx+r/2+d.FrameLeftMargin,o=n.RightEx,l=n.LeftEx;var h=!0,u=null;this.Canvas.beginPath(),this.Canvas.strokeStyle=this.CloseLineColor,v.IsNumber(this.CloseLineWidth)&&(this.Canvas.lineWidth=this.CloseLineWidth);var f=null;if(this.Data.DataOffset>0){var C=this.Data.Data[this.Data.DataOffset-1];if(C&&v.IsNumber(C.Close)){var D=l,c=this.GetYFromData(C.Close,!1);e?(this.Canvas.moveTo(c,D),u={X:c,Y:D}):(this.Canvas.moveTo(D,c),u={X:D,Y:c}),h=!1}}this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset;for(var T=null,S=this.Data.DataOffset,I=0;S<this.Data.Data.length&&I<t;++S,++I,s+=a+r,++this.ShowRange.DataCount){var C=this.Data.Data[S];if(this.ShowRange.End=S,!(C.Open==null||C.High==null||C.Low==null||C.Close==null)){var g=s,E=s+a;if(E>o)break;var D=g+(E-g)/2,c=this.GetYFromData(C.Close,!1);if(this.DrawKRange.End=S,h?(e?(this.Canvas.moveTo(c,D),u={X:c,Y:D}):(this.Canvas.moveTo(D,c),u={X:D,Y:c}),h=!1):e?this.Canvas.lineTo(c,D):this.Canvas.lineTo(D,c),S==this.Data.Data.length-1&&(f={X:D,Y:c,XLeft:g,XRight:E,KItem:C,ChartRight:o}),this.PriceGap.Enable){var F=this.GetYFromData(C.Low,!1),R=this.GetYFromData(C.High,!1),A=this.GetYFromData(C.Open,!1),P={Data:C,Coordinate:{X:D,Low:F,High:R,Close:c,Open:A,Left:g,Right:E}};if(T){this.CheckPriceGap(P);var p=this.IsPriceGap(P,T);p>0&&this.AryPriceGapCache.push({Data:[T,P],Type:p})}T=P}}}if(this.DrawLastPointEvent(f),!h){if(this.Canvas.stroke(),e?(this.Canvas.lineTo(n.Left,D),this.Canvas.lineTo(n.Left,u.Y)):(this.Canvas.lineTo(D,n.Bottom),this.Canvas.lineTo(u.X,n.Bottom)),this.Canvas.closePath(),Array.isArray(this.CloseLineAreaColor))if(e){var w=this.Canvas.createLinearGradient(this.ChartBorder.GetRightEx(),this.ChartBorder.GetTop(),this.ChartBorder.GetLeft(),this.ChartBorder.GetTop());w.addColorStop(0,this.CloseLineAreaColor[0]),w.addColorStop(1,this.CloseLineAreaColor[1]),this.Canvas.fillStyle=w}else{var H=this.Canvas.createLinearGradient(u.X,this.ChartBorder.GetTopEx(),u.X,this.ChartBorder.GetBottom());H.addColorStop(0,this.CloseLineAreaColor[0]),H.addColorStop(1,this.CloseLineAreaColor[1]),this.Canvas.fillStyle=H}else this.Canvas.fillStyle=this.CloseLineAreaColor;this.Canvas.fill()}},this.DrawCloseLine=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount;if(e)var n=this.ChartBorder.GetHScreenBorder(),s=n.TopEx+r/2+d.FrameLeftMargin,o=n.BottomEx;else var n=this.ChartBorder.GetBorder(),s=n.LeftEx+r/2+d.FrameLeftMargin,o=n.RightEx;var l=!0;this.Canvas.beginPath(),this.Canvas.strokeStyle=this.CloseLineColor,v.IsNumber(this.CloseLineWidth)&&(this.Canvas.lineWidth=this.CloseLineWidth),this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset;for(var h=null,u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<t;++u,++f,s+=a+r,++this.ShowRange.DataCount){var C=this.Data.Data[u];if(this.ShowRange.End=u,!(C.Open==null||C.High==null||C.Low==null||C.Close==null)){var D=s,c=s+a;if(c>o)break;var T=D+(c-D)/2,S=this.GetYFromData(C.Close,!1);if(this.DrawKRange.End=u,l?(e?this.Canvas.moveTo(S,T):this.Canvas.moveTo(T,S),l=!1):e?this.Canvas.lineTo(S,T):this.Canvas.lineTo(T,S),this.PriceGap.Enable){var I=this.GetYFromData(C.Low,!1),g=this.GetYFromData(C.High,!1),E=this.GetYFromData(C.Open,!1),F={Data:C,Coordinate:{X:T,Low:I,High:g,Close:S,Open:E,Left:D,Right:c}};if(h){this.CheckPriceGap(F);var R=this.IsPriceGap(F,h);R>0&&this.AryPriceGapCache.push({Data:[h,F],Type:R})}h=F}}}l==!1&&this.Canvas.stroke()},this.DrawKBar=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetBorder(),n=t.LeftEx+r/2+d.FrameLeftMargin,s=t.RightEx,o=this.ChartFrame.XPointCount;if(e){var t=this.ChartBorder.GetHScreenBorder();n=t.TopEx+r/2+d.FrameLeftMargin,s=t.BottomEx}var l={X:null,Y:null,Value:null,Align:"left"},h={X:null,Y:null,Value:null,Align:"left"},u=this.UpColor,f=this.DownColor,C=this.UnchagneColor;this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o;var D=null;this.DrawKRange.Start=this.Data.DataOffset;var c=null;this.GetEventCallback&&(c=this.GetEventCallback($.ON_CUSTOM_UNCHANGE_KLINE_COLOR));for(var T=null,S=this.Data.DataOffset,I=0;S<this.Data.Data.length&&I<o;++S,++I,n+=a+r,++this.ShowRange.DataCount){var g=this.Data.Data[S];if(this.ShowRange.End=S,!(g.Open==null||g.High==null||g.Low==null||g.Close==null)){var E=n,F=n+a;if(F>s)break;var R=E+(F-E)/2,A=this.GetYFromData(g.Low,!1),P=this.GetYFromData(g.High,!1),p=this.GetYFromData(g.Open,!1),w=this.GetYFromData(g.Close,!1),H=P,W={Data:g,Coordinate:{X:R,Low:A,High:P,Close:w,Open:p,Left:E,Right:F}};this.DrawKRange.End=S,(l.Value==null||l.Value<g.High)&&(l.X=R,l.Y=P,l.Value=g.High,l.Align=I<o/2?"left":"right"),(h.Value==null||h.Value>g.Low)&&(h.X=R,h.Y=A,h.Value=g.Low,h.Align=I<o/2?"left":"right"),this.ColorData&&(S<this.ColorData.length?u=f=C=this.ColorData[S]>0?this.UpColor:this.DownColor:u=f=C=this.DownColor);var ht=this.GetCustomKLine(g);if(g.IsNonTrade)this.DrawVirtualBar(g,a,R,H,E,F,A,P,p,w,e);else if(ht){var rt=ht.Color;rt||(g.Open<g.Close?rt=u:g.Open>g.Close?rt=f:rt=C);var nt=this.DrawType;v.IsNumber(ht.DrawType)&&(nt=ht.DrawType),this.DrawKBar_Custom(g,a,rt,nt,ht,R,H,E,F,A,P,p,w,t,e)}else if(this.DrawType==9&&g.ColorData)this.DrawColorKBar(g,g.ColorData,a,R,H,E,F,A,P,p,w,e);else if(g.Open<g.Close)this.DrawKBar_Up(g,a,u,this.DrawType,R,H,E,F,A,P,p,w,e);else if(g.Open>g.Close)this.DrawKBar_Down(g,a,f,this.DrawType,R,H,E,F,A,P,p,w,e);else{var rt=C;if(c&&c.Callback){var vt={KItem:g,DataIndex:S,DefaultColor:rt,BarColor:null};c.Callback(c,vt,this),vt.BarColor&&(rt=vt.BarColor)}this.DrawKBar_Unchagne(g,a,rt,this.DrawType,R,H,E,F,A,P,p,w,e)}if(this.IsShowKTooltip&&!e){var Nt=Math.min(p,w),Ft=Math.max(p,w);Math.abs(p-w)<5&&(Nt=Math.min(P,Nt-5),Ft=Math.max(A,Ft+5)),g.IsNonTrade&&(Nt=P,Ft=A);var Bt=new Ia(E,Nt,a,Ft-Nt);this.TooltipRect.push([S,Bt])}if(this.Data.DataType==0||this.Data.DataType==1){var Jt={Xleft:E,XRight:F,XCenter:R,YMax:P,YMin:A,DayData:g,Index:I};this.DrawInfo(Jt)}if(S==this.Data.Data.length-1&&(D={X:R,Y:w,XLeft:E,XRight:F,KItem:g,ChartRight:s}),this.PriceGap.Enable&&T){this.CheckPriceGap(W);var te=this.IsPriceGap(W,T);te>0&&this.AryPriceGapCache.push({Data:[T,W],Type:te})}T=W}}this.DrawLastPointEvent(D),this.PtMax=l,this.PtMin=h},this.DrawKBar_Up=function(e,a,r,t,n,s,o,l,h,u,f,C,D){var c=t==3||t==6;if(a>=4){if(c&&a%2!=0&&(a-=1),this.Canvas.strokeStyle=r,e.High>e.Close){if(this.Canvas.beginPath(),D)this.Canvas.moveTo(L(s),L(n)),this.Canvas.lineTo(L(t==3?Math.max(C,f):C),L(n));else if(c){var T=o+a/2;this.Canvas.moveTo(L(T),L(s)),this.Canvas.lineTo(L(T),L(Math.min(C,f)))}else this.Canvas.moveTo(L(n),L(s)),this.Canvas.lineTo(L(n),L(C));this.Canvas.stroke(),s=C}else s=C;if(this.Canvas.fillStyle=r,D?Math.abs(f-s)<1?this.Canvas.fillRect(b(s),b(o),1,b(a)):c?(this.Canvas.beginPath(),this.Canvas.rect(L(s),L(o),b(f-s),b(a)),this.Canvas.stroke()):this.Canvas.fillRect(b(s),b(o),b(f-s),b(a)):Math.abs(f-s)<1?this.Canvas.fillRect(b(o),b(s),b(a),1):c?(this.Canvas.beginPath(),this.Canvas.rect(L(o),L(s),b(a),b(f-s)),this.Canvas.stroke()):this.Canvas.fillRect(b(o),b(Math.min(s,f)),b(a),b(Math.abs(f-s))),e.Open>e.Low){if(this.Canvas.beginPath(),D)this.Canvas.moveTo(L(t==3?Math.min(C,f):s),L(n)),this.Canvas.lineTo(L(h),L(n));else if(c){var T=o+a/2;this.Canvas.moveTo(L(T),L(Math.max(C,f))),this.Canvas.lineTo(L(T),L(h))}else this.Canvas.moveTo(L(n),L(s)),this.Canvas.lineTo(L(n),L(h));this.Canvas.stroke()}}else this.Canvas.beginPath(),D?(this.Canvas.moveTo(u,L(n)),this.Canvas.lineTo(h,L(n))):(this.Canvas.moveTo(L(n),u),this.Canvas.lineTo(L(n),h)),this.Canvas.strokeStyle=r,this.Canvas.stroke()},this.DrawKBar_Down=function(e,a,r,t,n,s,o,l,h,u,f,C,D){var c=t==6;if(a>=4){if(c&&a%2!=0&&(a-=1),this.Canvas.strokeStyle=r,e.High>e.Close){if(this.Canvas.beginPath(),D)this.Canvas.moveTo(L(s),L(n)),this.Canvas.lineTo(L(f),L(n));else if(c){var T=o+a/2;this.Canvas.moveTo(L(T),L(s)),this.Canvas.lineTo(L(T),L(Math.min(C,f)))}else this.Canvas.moveTo(L(n),L(s)),this.Canvas.lineTo(L(n),L(f));this.Canvas.stroke(),s=f}else s=f;if(this.Canvas.fillStyle=r,D?Math.abs(C-s)<1?this.Canvas.fillRect(b(s),b(o),1,b(a)):this.Canvas.fillRect(b(s),b(o),b(C-s),b(a)):Math.abs(C-s)<1?this.Canvas.fillRect(b(o),b(s),b(a),1):c?(this.Canvas.beginPath(),this.Canvas.rect(L(o),L(Math.min(s,C)),b(a),b(Math.abs(C-s))),this.Canvas.stroke()):this.Canvas.fillRect(b(o),b(Math.min(s,C)),b(a),b(Math.abs(C-s))),e.Open>e.Low){if(this.Canvas.beginPath(),D)this.Canvas.moveTo(L(s),L(n)),this.Canvas.lineTo(L(h),L(n));else if(c){var T=o+a/2;this.Canvas.moveTo(L(T),L(Math.max(C,f))),this.Canvas.lineTo(L(T),L(h))}else this.Canvas.moveTo(L(n),L(s)),this.Canvas.lineTo(L(n),L(h));this.Canvas.stroke()}}else this.Canvas.beginPath(),D?(this.Canvas.moveTo(u,L(n)),this.Canvas.lineTo(h,L(n))):(this.Canvas.moveTo(L(n),u),this.Canvas.lineTo(L(n),h)),this.Canvas.strokeStyle=r,this.Canvas.stroke()},this.DrawKBar_Unchagne=function(e,a,r,t,n,s,o,l,h,u,f,C,D){if(this.OneLimitBarType===1&&this.IsOneLimitBar(e)&&(r=this.GetOneLimitBarColor(e)),a>=4){if(a%2!=0&&(a-=1),this.Canvas.strokeStyle=r,this.Canvas.beginPath(),e.High>e.Close){if(D)this.Canvas.moveTo(s,L(n)),this.Canvas.lineTo(f,L(n));else{var c=L(o+a/2);this.Canvas.moveTo(c,s),this.Canvas.lineTo(c,f)}s=f}else s=f;if(D?(this.Canvas.moveTo(L(s),L(o)),this.Canvas.lineTo(L(s),L(l))):(this.Canvas.moveTo(L(o),L(s)),this.Canvas.lineTo(L(o+a),L(s))),e.Open>e.Low)if(D)this.Canvas.moveTo(L(s),L(n)),this.Canvas.lineTo(L(h),L(n));else{var c=L(o+a/2);this.Canvas.moveTo(c,L(s)),this.Canvas.lineTo(c,L(h))}this.Canvas.stroke()}else this.Canvas.beginPath(),D?e.High==e.Low?(this.Canvas.moveTo(u,L(n)),this.Canvas.lineTo(h-1,L(n))):(this.Canvas.moveTo(u,L(n)),this.Canvas.lineTo(h,L(n))):e.High==e.Low?(this.Canvas.moveTo(L(n),u),this.Canvas.lineTo(L(n),h+1)):(this.Canvas.moveTo(L(n),u),this.Canvas.lineTo(L(n),h)),this.Canvas.strokeStyle=r,this.Canvas.stroke()},this.IsOneLimitBar=function(e){return e.Open==e.Close&&e.High==e.Low&&e.Open==e.High},this.GetOneLimitBarColor=function(e){return!e||!v.IsNumber(e.YClose)?this.UnchagneColor:e.Close>e.YClose?this.UpColor:e.Close<e.YClose?this.DownColor:this.UnchagneColor},this.DrawKBar_Custom=function(e,a,r,t,n,s,o,l,h,u,f,C,D,c,T){if(n.BGColor){this.Canvas.fillStyle=n.BGColor;var S=this.ChartFrame.DistanceWidth;if(T){var I=l-S/2,g=h+S/2,E=c.RightEx,F=c.LeftEx;this.Canvas.fillRect(b(F),b(I),b(E-F),b(g-I))}else{var R=l-S/2,A=h+S/2,P=c.TopEx,p=c.BottomEx;this.Canvas.fillRect(b(R),b(P),b(A-R),b(p-P))}}a>=4?(this.Canvas.strokeStyle=r,e.High>e.Close&&(this.Canvas.beginPath(),T?(this.Canvas.moveTo(L(o),L(s)),this.Canvas.lineTo(L(t==3?Math.max(D,C):D),L(s))):(this.Canvas.moveTo(L(s),L(o)),this.Canvas.lineTo(L(s),L(t==3?Math.min(D,C):D))),this.Canvas.stroke()),o=D,this.Canvas.fillStyle=r,T?Math.abs(C-o)<1?this.Canvas.fillRect(b(o),b(l),1,b(a)):t==3?(this.Canvas.beginPath(),this.Canvas.rect(L(o),L(l),b(C-o),b(a)),this.Canvas.stroke()):this.Canvas.fillRect(b(o),b(l),b(C-o),b(a)):Math.abs(C-o)<1?this.Canvas.fillRect(b(l),b(o),b(a),1):t==3?(this.Canvas.beginPath(),this.Canvas.rect(L(l),L(o),b(a),b(C-o)),this.Canvas.stroke()):this.Canvas.fillRect(b(l),b(Math.min(o,C)),b(a),b(Math.abs(C-o))),e.Open>e.Low&&(this.Canvas.beginPath(),T?(this.Canvas.moveTo(L(t==3?Math.min(D,C):o),L(s)),this.Canvas.lineTo(L(u),L(s))):(this.Canvas.moveTo(L(s),L(t==3?Math.max(D,C):o)),this.Canvas.lineTo(L(s),L(u))),this.Canvas.stroke())):(this.Canvas.beginPath(),T?(this.Canvas.moveTo(f,L(s)),this.Canvas.lineTo(u,L(s))):(this.Canvas.moveTo(L(s),f),this.Canvas.lineTo(L(s),u)),this.Canvas.strokeStyle=r,this.Canvas.stroke())},this.DrawColorKBar=function(e,a,r,t,n,s,o,l,h,u,f,C){Math.abs(f-u)<1?this.DrawColorKBar_Line(e,a,r,t,n,s,o,l,h,u,f,C):a.Border||a.Type===0?this.DrawColorKBar_Border(e,a,r,t,n,s,o,l,h,u,f,C):this.DrawColorKBar_NoBorder(e,a,r,t,n,s,o,l,h,u,f,C)},this.DrawColorKBar_Border=function(e,a,r,t,n,s,o,l,h,u,f,C){if(r>=4){r%2!=0&&(r-=1);var D=Math.max(e.Close,e.Open),c=Math.min(e.Close,e.Open);if(C)var T=Math.max(f,u),S=Math.min(f,u);else var T=Math.min(f,u),S=Math.max(f,u);var I=Math.abs(f-u);if(e.High>D&&a.Line){if(this.Canvas.strokeStyle=a.Line.Color,this.Canvas.beginPath(),C)this.Canvas.moveTo(L(h),L(t)),this.Canvas.lineTo(L(T),L(t));else{var g=s+r/2;this.Canvas.moveTo(L(g),L(h)),this.Canvas.lineTo(L(g),L(T))}this.Canvas.stroke()}if(c>e.Low&&a.Line){if(this.Canvas.strokeStyle=a.Line.Color,this.Canvas.beginPath(),C)this.Canvas.moveTo(L(S),L(t)),this.Canvas.lineTo(L(l),L(t));else{var g=s+r/2;this.Canvas.moveTo(L(g),L(S)),this.Canvas.lineTo(L(g),L(l))}this.Canvas.stroke()}if(C){var E=new Path2D;E.rect(L(S),L(s),b(I),b(r))}else{var E=new Path2D;E.rect(L(s),L(T),b(r),b(I))}a.Type==0?(a.BarColor&&(this.Canvas.strokeStyle=a.BarColor,this.Canvas.stroke(E)),a.Border&&(this.Canvas.strokeStyle=a.Border.Color,this.Canvas.stroke(E))):a.Type==1&&(a.BarColor&&(this.Canvas.fillStyle=a.BarColor,this.Canvas.fill(E)),a.Border&&(this.Canvas.strokeStyle=a.Border.Color,this.Canvas.stroke(E)))}else this.DrawColorKBar_MinBar(e,a,r,t,n,s,o,l,h,u,f,C)},this.DrawColorKBar_NoBorder=function(e,a,r,t,n,s,o,l,h,u,f,C){if(r>=4){var D=Math.max(e.Close,e.Open),c=Math.min(e.Close,e.Open);if(C)var T=Math.max(f,u),S=Math.min(f,u);else var T=Math.min(f,u),S=Math.max(f,u);var I=Math.abs(f-u);if(e.High>D&&a.Line){if(this.Canvas.strokeStyle=a.Line.Color,this.Canvas.beginPath(),C)this.Canvas.moveTo(L(h),L(t)),this.Canvas.lineTo(L(T),L(t));else{var g=s+r/2;this.Canvas.moveTo(L(g),L(h)),this.Canvas.lineTo(L(g),L(T))}this.Canvas.stroke()}if(c>e.Low&&a.Line){if(this.Canvas.strokeStyle=a.Line.Color,this.Canvas.beginPath(),C)this.Canvas.moveTo(L(S),L(t)),this.Canvas.lineTo(L(l),L(t));else{var g=s+r/2;this.Canvas.moveTo(L(g),L(S)),this.Canvas.lineTo(L(g),L(l))}this.Canvas.stroke()}if(C){var E=new Path2D;E.rect(b(S),b(s),b(I),b(r))}else{var E=new Path2D;E.rect(b(s),b(T),b(r),b(I))}a.Type==1&&a.BarColor&&(this.Canvas.fillStyle=a.BarColor,this.Canvas.fill(E))}else this.DrawColorKBar_MinBar(e,a,r,t,n,s,o,l,h,u,f,C)},this.DrawColorKBar_MinBar=function(e,a,r,t,n,s,o,l,h,u,f,C){a.Line&&(this.Canvas.strokeStyle=a.Line.Color,this.Canvas.beginPath(),C?(this.Canvas.moveTo(L(h),L(t)),this.Canvas.lineTo(L(l),L(t))):(this.Canvas.moveTo(L(t),L(h)),this.Canvas.lineTo(L(t),L(l))),this.Canvas.stroke())},this.DrawColorKBar_Line=function(e,a,r,t,n,s,o,l,h,u,f,C){if(r>=4){a.Line&&(this.Canvas.strokeStyle=a.Line.Color,this.Canvas.beginPath(),C?(this.Canvas.moveTo(L(h),L(t)),this.Canvas.lineTo(L(l),L(t))):(this.Canvas.moveTo(L(t),L(h)),this.Canvas.lineTo(L(t),L(l))),this.Canvas.stroke());var D;(a.Type==0||a.Type==1)&&(a.Border?D=a.Border.Color:a.BarColor&&(D=a.BarColor)),D&&(this.Canvas.strokeStyle=D,this.Canvas.beginPath(),C?(this.Canvas.moveTo(L(u),L(s)),this.Canvas.lineTo(L(u),L(o))):(this.Canvas.moveTo(L(s),L(u)),this.Canvas.lineTo(L(o),L(u))),this.Canvas.stroke())}else a.Line&&(this.Canvas.strokeStyle=a.Line.Color,this.Canvas.beginPath(),C?(this.Canvas.moveTo(L(h),L(t)),this.Canvas.lineTo(L(l),L(t))):(this.Canvas.moveTo(L(t),L(h)),this.Canvas.lineTo(L(t),L(l))),this.Canvas.stroke())},this.DrawVirtualBar=function(e,a,r,t,n,s,o,l,h,u,f){var C=Math.min(l,o),D=Math.max(l,o);this.Canvas.strokeStyle=this.VirtualBarConfig.Color,this.Canvas.setLineDash(this.VirtualBarConfig.LineDash),f?a>=4?this.Canvas.strokeRect(L(C),L(n),b(D-C),b(a)):(this.Canvas.beginPath(),this.Canvas.moveTo(C,L(r)),this.Canvas.lineTo(D,L(r)),this.Canvas.stroke()):a>=4?this.Canvas.strokeRect(L(n),L(C),b(a),b(D-C)):(this.Canvas.beginPath(),this.Canvas.moveTo(L(r),C),this.Canvas.lineTo(L(r),D),this.Canvas.stroke()),this.Canvas.setLineDash([])},this.DrawRenkoCandle=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount;if(e)var n=this.ChartBorder.GetHScreenBorder(),s=n.TopEx+r/2+d.FrameLeftMargin,o=n.BottomEx;else var n=this.ChartBorder.GetBorder(),s=n.LeftEx+r/2+d.FrameLeftMargin,o=n.RightEx;var l={X:null,Y:null,Value:null,Align:"left"},h={X:null,Y:null,Value:null,Align:"left"};this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset;for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<t;++u,++f,s+=a+r,++this.ShowRange.DataCount){var C=this.Data.Data[u];if(this.ShowRange.End=u,!(C.Open==null||C.High==null||C.Low==null||C.Close==null)){var D=s,c=s+a;if(c>o)break;var T=D+(c-D)/2,S=this.GetYFromData(C.Low,!1),I=this.GetYFromData(C.High,!1);this.DrawKRange.End=u,(l.Value==null||l.Value<C.High)&&(l.X=T,l.Y=I,l.Value=C.High,l.Align=f<t/2?"left":"right"),(h.Value==null||h.Value>C.Low)&&(h.X=T,h.Y=S,h.Value=C.Low,h.Align=f<t/2?"left":"right"),C.YClose<C.Close?(this.Canvas.strokeStyle=this.UpColor,this.Canvas.fillStyle=this.UpColor):C.YClose>C.Close&&(this.Canvas.strokeStyle=this.DownColor,this.Canvas.fillStyle=this.DownColor),a>=4?e?this.Canvas.fillRect(b(S),b(D),b(Math.abs(S-I)),b(a)):this.Canvas.fillRect(b(D),b(I),b(a),b(Math.abs(S-I))):(this.Canvas.beginPath(),e?(this.Canvas.moveTo(I,L(T)),this.Canvas.lineTo(S,L(T))):(this.Canvas.moveTo(L(T),I),this.Canvas.lineTo(L(T),S)),this.Canvas.stroke())}}this.PtMax=l,this.PtMin=h},this.DrawLineBreak=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount,n=r/2;if(e)var s=this.ChartBorder.GetHScreenBorder(),o=s.TopEx+r/2+d.FrameLeftMargin-n,l=s.BottomEx;else var s=this.ChartBorder.GetBorder(),o=s.LeftEx+r/2+d.FrameLeftMargin-n,l=s.RightEx;var h={X:null,Y:null,Value:null,Align:"left"},u={X:null,Y:null,Value:null,Align:"left"};this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset;for(var f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<t;++f,++C,o+=a+r,++this.ShowRange.DataCount){var D=this.Data.Data[f];if(this.ShowRange.End=f,!(D.Open==null||D.High==null||D.Low==null||D.Close==null)){var c=o,T=o+a+r;if(T>l)break;var S=c+(T-c)/2,I=this.GetYFromData(D.Low,!1),g=this.GetYFromData(D.High,!1);this.DrawKRange.End=f,(h.Value==null||h.Value<D.High)&&(h.X=S,h.Y=g,h.Value=D.High,h.Align=C<t/2?"left":"right"),(u.Value==null||u.Value>D.Low)&&(u.X=S,u.Y=I,u.Value=D.Low,u.Align=C<t/2?"left":"right"),D.YClose<D.Close?(this.Canvas.strokeStyle=this.UpColor,this.Canvas.fillStyle=this.UpColor):D.YClose>D.Close&&(this.Canvas.strokeStyle=this.DownColor,this.Canvas.fillStyle=this.DownColor),a>=4?e?this.Canvas.fillRect(b(I),b(c),b(Math.abs(I-g)),b(a+r)):this.Canvas.fillRect(b(c),b(g),b(a+r),b(Math.abs(I-g))):(this.Canvas.beginPath(),e?(this.Canvas.moveTo(g,L(S)),this.Canvas.lineTo(I,L(S))):(this.Canvas.moveTo(L(S),g),this.Canvas.lineTo(L(S),I)),this.Canvas.stroke())}}this.PtMax=h,this.PtMin=u},this.DrawKagi=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount;if(e)var n=this.ChartBorder.GetHScreenBorder(),s=n.TopEx+r/2+d.FrameLeftMargin,o=n.BottomEx,l=n.TopEx+d.FrameLeftMargin;else var n=this.ChartBorder.GetBorder(),s=n.LeftEx+r/2+d.FrameLeftMargin,o=n.RightEx,l=n.Left+d.FrameLeftMargin;var h={X:null,Y:null,Value:null,Align:"left"},u={X:null,Y:null,Value:null,Align:"left"};this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset;var f=2*B();this.Canvas.lineWidth=f;var C={Item:null,X:l,Y:null},D=this.Data.DataOffset-1;if(D>=0&&D<this.Data.Data.length){var c=this.Data.Data[D];C.Item=c,c.Direction==1?C.Y=this.GetYFromData(c.High,!1):c.Direction==2&&(C.Y=this.GetYFromData(c.Low,!1))}for(var T=this.Data.DataOffset,S=0;T<this.Data.Data.length&&S<t;++T,++S,s+=a+r,++this.ShowRange.DataCount){var I=this.Data.Data[T];if(this.ShowRange.End=T,!(I.Open==null||I.High==null||I.Low==null||I.Close==null)){var l=s,g=s+a;if(g>o)break;var E=l+(g-l)/2,F=this.GetYFromData(I.Low,!1),R=this.GetYFromData(I.High,!1);this.DrawKRange.End=T,(h.Value==null||h.Value<I.High)&&(h.X=E,h.Y=R,h.Value=I.High,h.Align=S<t/2?"left":"right"),(u.Value==null||u.Value>I.Low)&&(u.X=E,u.Y=F,u.Value=I.Low,u.Align=S<t/2?"left":"right");var A=$t(f,E);if(C.Item){this.Canvas.beginPath();var P=$t(f,C.Y);this.Canvas.moveTo(C.X,P),this.Canvas.lineTo(A,P);var p=null;if(C.Item.Direction==1?p=C.Item.Low:C.Item.Direction==2&&(p=C.Item.High),I.Direction==1)if(I.High<p)this.Canvas.lineTo(A,R),this.Canvas.strokeStyle=this.DownColor,this.Canvas.stroke();else{var w=this.GetYFromData(p,!1);this.Canvas.lineTo(A,w),this.Canvas.strokeStyle=this.DownColor,this.Canvas.stroke(),this.Canvas.beginPath(),this.Canvas.moveTo(A,w),this.Canvas.lineTo(A,R),this.Canvas.strokeStyle=this.UpColor,this.Canvas.stroke()}else if(I.Direction==2)if(I.Low>p)this.Canvas.lineTo(A,F),this.Canvas.strokeStyle=this.DownColor,this.Canvas.stroke();else{var w=this.GetYFromData(p,!1);this.Canvas.lineTo(A,w),this.Canvas.strokeStyle=this.DownColor,this.Canvas.stroke(),this.Canvas.beginPath(),this.Canvas.moveTo(A,w),this.Canvas.lineTo(A,F),this.Canvas.strokeStyle=this.UpColor,this.Canvas.stroke()}}else this.Canvas.beginPath(),I.Direction==1?(this.Canvas.moveTo(A,F),this.Canvas.lineTo(A,R)):I.Direction==2&&(this.Canvas.moveTo(A,R),this.Canvas.lineTo(A,F)),this.Canvas.stroke();C.Item=I,C.X=E,I.Direction==1?C.Y=R:I.Direction==2&&(C.Y=F)}}this.PtMax=h,this.PtMin=u},this.DrawTrade=function(){if(this.TradeData){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetLeft()+r/2+2,n=this.ChartBorder.GetRight(),s=this.ChartFrame.XPointCount;e&&(t=this.ChartBorder.GetTop()+r/2+2,n=this.ChartBorder.GetBottom());var o=this.TradeData.Sell,l=this.TradeData.Buy,h=a;h>10&&(h=10);for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<s;++u,++f,t+=a+r){var C=this.Data.Data[u];if(!(C.Open==null||C.High==null||C.Low==null||C.Close==null)){var D=!1,c=!1;if(o&&u<o.length&&(c=o[u]>0),l&&u<l.length&&(D=l[u]>0),!(!c&&!D)){var T=t,S=t+a;if(S>n)break;var I=T+(S-T)/2,g=this.GetYFromData(C.Low,!1),E=this.GetYFromData(C.High,!1);this.GetYFromData(C.Open,!1),this.GetYFromData(C.Close,!1),D&&(this.Canvas.fillStyle=this.UpColor,this.Canvas.strokeStyle=this.UnchagneColor,this.Canvas.beginPath(),e?(this.Canvas.moveTo(g-1,I),this.Canvas.lineTo(g-h-1,I-h/2),this.Canvas.lineTo(g-h-1,I+h/2)):(this.Canvas.moveTo(I,g+1),this.Canvas.lineTo(I-h/2,g+h+1),this.Canvas.lineTo(I+h/2,g+h+1)),this.Canvas.closePath(),this.Canvas.fill(),this.Canvas.stroke()),c&&(this.Canvas.fillStyle=this.DownColor,this.Canvas.strokeStyle=this.UnchagneColor,this.Canvas.beginPath(),e?(this.Canvas.moveTo(E+1,I),this.Canvas.lineTo(E+h+1,I-h/2),this.Canvas.lineTo(E+h+1,I+h/2)):(this.Canvas.moveTo(I,E-1),this.Canvas.lineTo(I-h/2,E-h-1),this.Canvas.lineTo(I+h/2,E-h-1)),this.Canvas.closePath(),this.Canvas.fill(),this.Canvas.stroke())}}}}},this.DrawTick=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetLeft()+r/2+2;e&&(t=this.ChartBorder.GetTop()+r/2+2);var n=this.ChartBorder.GetRight();e&&(n=this.ChartBorder.GetBottom());var s=this.ChartFrame.XPointCount,o=parseInt(a);o<=1?o=2:o>=18&&(o=18);var l=B(),h=o*l;this.Canvas.beginPath(),this.Canvas.font=o*l+"px "+this.TickFontName,this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=s,this.DrawKRange.Start=this.Data.DataOffset;for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<s;++u,++f,t+=a+r){var C=this.Data.Data[u];if(this.ShowRange.End=u,!(C.Open==null||C.High==null||C.Low==null||C.Close==null)){var D=t,c=t+a;if(c>n)break;var T=D+(c-D)/2,S=this.ChartFrame.GetYFromData(C.Close,!1);if(this.DrawKRange.End=u,C.Flag===0?this.Canvas.fillStyle=this.UpColor:C.Flag==1?this.Canvas.fillStyle=this.DownColor:this.Canvas.fillStyle=this.UnchagneColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",e?this.Canvas.fillText(this.TickSymbol,S,T):this.Canvas.fillText(this.TickSymbol,T,S),this.IsShowKTooltip&&!e){var I=new Ia(T-h/2,S-h/2,h,h);this.TooltipRect.push([u,I])}}}},this.DrawHLCArea=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount;if(e)var n=this.ChartBorder.GetHScreenBorder(),s=n.TopEx+r/2+d.FrameLeftMargin,o=n.BottomEx,l=n.TopEx;else var n=this.ChartBorder.GetBorder(),s=n.LeftEx+r/2+d.FrameLeftMargin,o=n.RightEx,l=n.LeftEx;var h=new Path2D,u=new Path2D,f=new Path2D,C=new Path2D,D=new Path2D,c=[],T=!0;if(this.Data.DataOffset>0){var S=this.Data.Data[this.Data.DataOffset-1];if(S&&v.IsNumber(S.Close)&&v.IsNumber(S.High)&&v.IsNumber(S.Low)){var I=l,g=this.GetYFromData(S.Close,!1),E=this.GetYFromData(S.High,!1),F=this.GetYFromData(S.Low,!1);e?(f.moveTo(g,I),u.moveTo(E,I),h.moveTo(F,I),C.moveTo(E,I),D.moveTo(F,I),c.push({X:g,Y:I})):(f.moveTo(I,g),u.moveTo(I,E),h.moveTo(I,F),C.moveTo(I,E),D.moveTo(I,F),c.push({X:I,Y:g})),T=!1}}this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset;for(var R=this.Data.DataOffset,A=0;R<this.Data.Data.length&&A<t;++R,++A,s+=a+r,++this.ShowRange.DataCount){var S=this.Data.Data[R];if(this.ShowRange.End=R,!(!S||!v.IsNumber(S.Close)||!v.IsNumber(S.High)||!v.IsNumber(S.Low))){var P=s,p=s+a;if(p>o)break;var I=P+(p-P)/2,g=this.GetYFromData(S.Close,!1),E=this.GetYFromData(S.High,!1),F=this.GetYFromData(S.Low,!1);this.DrawKRange.End=R,T?(e?(f.moveTo(g,I),u.moveTo(E,I),h.moveTo(F,I),C.moveTo(E,I),D.moveTo(F,I)):(f.moveTo(I,g),u.moveTo(I,E),h.moveTo(I,F),C.moveTo(I,E),D.moveTo(I,F)),T=!1):e?(f.lineTo(g,I),u.lineTo(E,I),h.lineTo(F,I),C.lineTo(E,I),D.lineTo(F,I)):(f.lineTo(I,g),u.lineTo(I,E),h.lineTo(I,F),C.lineTo(I,E),D.lineTo(I,F)),e?c.push({X:g,Y:I}):c.push({X:I,Y:g})}}if(!T){for(var R=c.length-1;R>=0;--R){var w=c[R];C.lineTo(w.X,w.Y),D.lineTo(w.X,w.Y)}C.closePath(),D.closePath(),this.Canvas.fillStyle=this.HLCAreaConfig.UpAreaColor,this.Canvas.fill(C),this.Canvas.fillStyle=this.HLCAreaConfig.DownAreaColor,this.Canvas.fill(D),v.IsNumber(this.HLCAreaConfig.LineWidth)&&(this.Canvas.lineWidth=this.HLCAreaConfig.LineWidth),this.Canvas.strokeStyle=this.HLCAreaConfig.CloseLineColor,this.Canvas.stroke(f),this.Canvas.strokeStyle=this.HLCAreaConfig.HighLineColor,this.Canvas.stroke(u),this.Canvas.strokeStyle=this.HLCAreaConfig.LowLineColor,this.Canvas.stroke(h)}},this.ClipTickClient=function(e){var a=this.GetBorder();if(e==!0)var r=this.ChartBorder.GetLeftEx(),t=this.ChartBorder.GetRightEx(),n=this.ChartBorder.GetTop(),s=this.ChartBorder.GetBottom();else var r=a.Left,t=a.Right,n=a.TopTitle,s=a.Bottom;this.Canvas.beginPath(),this.Canvas.rect(r,n,t-r,s-n),this.Canvas.clip()},this.ClipWindow=function(e){if(e==!0)var a=this.ChartBorder.GetLeft(),r=this.ChartBorder.GetRightEx(),t=this.ChartBorder.GetTop(),n=this.ChartBorder.GetBottom();else var a=this.ChartBorder.GetLeft(),r=this.ChartBorder.GetRight(),t=this.ChartBorder.GetTopEx(),n=this.ChartBorder.GetBottom();this.Canvas.beginPath(),this.Canvas.rect(a,t,r-a,n-t),this.Canvas.clip()},this.ClipClient=function(e){if(e==!0)var a=this.ChartBorder.GetLeftEx(),r=this.ChartBorder.GetRightEx(),t=this.ChartBorder.GetTop(),n=this.ChartBorder.GetBottom();else{var a=this.ChartBorder.GetLeft(),r=this.ChartBorder.GetRight(),t=this.ChartBorder.GetTopEx(),n=this.ChartBorder.GetBottomEx();this.ChartBorder.BottomSpace>0&&(n+=1),this.DrawType==13&&(t=this.ChartBorder.GetTopTitle(),n=this.ChartBorder.GetBottom())}this.Canvas.beginPath(),this.Canvas.rect(a,t,r-a,n-t),this.Canvas.clip()},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()&&(this.IsShowOrderText=!1,this.TooltipRect=[],this.InfoTooltipRect=[],this.TradeIconTooltipRect=[],this.PtMax={X:null,Y:null,Value:null,Align:"left"},this.PtMin={X:null,Y:null,Value:null,Align:"left"},this.DrawKRange={Start:null,End:null},this.AryPriceGapCache=[],this.ChartFrame.ChartKLine={Max:null,Min:null},this.DrawHeatMap(),!!this.IsShow&&!(this.ChartFrame.IsMinSize&&this.Name=="Self Kline"))){if(Y.IsTickPeriod(this.Period)){this.Canvas.save(),this.DrawType==1?(this.ClipClient(this.ChartFrame.IsHScreen),this.DrawCloseLine()):this.DrawType==4?(this.ClipClient(this.ChartFrame.IsHScreen),this.DrawCloseArea()):(this.ClipTickClient(this.ChartFrame.IsHScreen),this.DrawTick()),this.Canvas.restore();return}if(this.Canvas.save(),this.ClipClient(this.ChartFrame.IsHScreen),this.DrawType==1){this.DrawCloseLine(),this.Canvas.restore(),this.PriceGap.Enable&&this.DrawPriceGap();return}else this.DrawType==2?this.DrawAKLine():this.DrawType==4?this.DrawCloseArea():this.DrawType==5?this.DrawOrderFlow():this.DrawType==7?this.DrawOrderFlow_Style2():this.DrawType==8?this.DrawOrderFlow_Style3():this.DrawType==9?this.DrawKBar():this.DrawType==10?this.DrawRenkoCandle():this.DrawType==12?this.DrawLineBreak():this.DrawType==13?this.DrawHighLow():this.DrawType==14?this.FFKChart&&this.FFKChart.Draw&&this.FFKChart.Draw(this):this.DrawType==15?this.DrawHLCArea():this.DrawType==16?this.DrawKagi():this.DrawType==17?this.DrawOrderFlow_Style4():this.DrawType==18?this.DrawOrderFlow_Style5():this.DrawKBar();this.TradeIcon?this.DrawTradeIcon():this.DrawTrade(),this.Canvas.restore(),this.PriceGap.Enable&&this.DrawPriceGap(),this.IsShowMaxMinPrice&&(this.ChartFrame.IsHScreen===!0?this.HScreenDrawMaxMinPrice(this.PtMax,this.PtMin):this.DrawMaxMinPrice(this.PtMax,this.PtMin)),this.DrawType==14&&this.FFKChart&&this.FFKChart.DrawMaxMinPrice&&this.FFKChart.DrawMaxMinPrice()}},this.OnFormatHighLowTitle=function(e,a){if(!e||!a||!v.IsNumber(e.Value)||!v.IsNumber(a.Value))return null;var r=jt(this.Symbol),t={High:e.Value.toFixed(r),Low:a.Value.toFixed(r)};if(!this.GetEventCallback)return t;var n=this.GetEventCallback($.ON_FORMAT_KLINE_HIGH_LOW_TITLE);if(!n||!n.Callback)return t;var s={Max:e,Min:a,Symbol:this.Symbol,Title:{High:t.High,Low:t.Low},Decimal:r,PreventDefault:!1};return n.Callback(n,s,this),s.PreventDefault?s.Title:t},this.DrawMaxMinPrice=function(e,a){if(!(e.X==null||e.Y==null||e.Value==null)&&!(a.X==null||a.Y==null||a.Value==null)){var r=this.OnFormatHighLowTitle(e,a);if(r){var t=d.KLine.MaxMin.LeftArrow,n=d.KLine.MaxMin.RightArrow,s=d.KLine.MaxMin.HighYOffset,o=d.KLine.MaxMin.LowYOffset;jt(this.Symbol),this.Canvas.font=this.TextFont;var l=this.ChartBorder.GetTopEx(),h=this.ChartBorder.GetBottomEx(),u=e,C=r.High,D=this.TextColor;if(this.ChartFrame.CoordinateType==1){e.Y<a.Y&&(u=a),this.Canvas.textBaseline="top";var C=r.Low;r.LowColor&&(D=r.LowColor)}else e.Y>a.Y&&(u=a),this.Canvas.textBaseline="bottom",r.HighColor&&(D=r.HighColor);this.Canvas.fillStyle=D,this.Canvas.textAlign=u.Align;var c=(u.Align=="left",u.X);v.IsNumber(s)&&(u.Y+=s),u.Align=="left"?C=t+C:C=C+n,u.Y>l-2&&(this.Canvas.fillText(C,c,u.Y),this.ChartFrame.ChartKLine.Max={X:c,Y:u.Y,Text:{BaseLine:"bottom"}});var f=a,C=r.Low,D=this.TextColor;if(this.ChartFrame.CoordinateType==1){a.Y>e.Y&&(f=e),this.Canvas.textBaseline="bottom";var C=r.High;r.HighColor&&(D=r.HighColor)}else e.Y>a.Y&&(u=a),this.Canvas.textBaseline="top",r.LowColor&&(D=r.LowColor);this.Canvas.fillStyle=D,this.Canvas.textAlign=f.Align;var c=(f.Align=="left",f.X);v.IsNumber(o)&&(f.Y+=o),f.Align=="left"?C=t+C:C=C+n,f.Y<h+1&&(this.Canvas.fillText(C,c,f.Y),this.ChartFrame.ChartKLine.Min={X:c,Y:f.Y,Text:{BaseLine:"top"}})}}},this.HScreenDrawMaxMinPrice=function(e,a){if(!(e.X==null||e.Y==null||e.Value==null)&&!(a.X==null||a.Y==null||a.Value==null)){var r=this.OnFormatHighLowTitle(e,a);if(r){var t=d.KLine.MaxMin.LeftArrow,n=d.KLine.MaxMin.RightArrow,s=d.KLine.MaxMin.HighYOffset,o=d.KLine.MaxMin.LowYOffset,l=e.Y,h=e.X;v.IsNumber(s)&&(l+=s),this.Canvas.save(),this.Canvas.translate(l,h),this.Canvas.rotate(90*Math.PI/180);var u=r.High;this.Canvas.font=this.TextFont,r.HighColor?this.Canvas.fillStyle=r.HighColor:this.Canvas.fillStyle=this.TextColor,this.Canvas.textAlign=e.Align,this.Canvas.textBaseline="bottom",e.Align=="left"?u=t+u:u=u+n,this.Canvas.fillText(u,0,0),this.Canvas.restore();var l=a.Y,h=a.X;v.IsNumber(o)&&(l+=o),this.Canvas.save(),this.Canvas.translate(l,h),this.Canvas.rotate(90*Math.PI/180);var u=r.Low;this.Canvas.font=this.TextFont,r.LowColor?this.Canvas.fillStyle=r.LowColor:this.Canvas.fillStyle=this.TextColor,this.Canvas.textAlign=a.Align,this.Canvas.textBaseline="top",a.Align=="left"?u=t+u:u=u+n,this.Canvas.fillText(u,0,0),this.Canvas.restore()}}},this.DrawInfo=function(e){if(!(!this.InfoData||this.InfoData.size<=0)){var a=this.ChartFrame.IsHScreen===!0,r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartBorder.GetBottom(),s=this.ChartBorder.GetTop(),o=""+e.DayData.Date;if(this.Data.DataType==1&&(o=e.DayData.Date+"-"+e.DayData.Time),!!this.InfoData.has(o)){var l=this.InfoData.get(o);if(!(!l||l.Data.length<=0)){this.Canvas.restore(),this.Canvas.save(),this.ClipWindow(a);var h=B(),u=r+t,f=18*h,C=!0;u<=15&&(C=!1),u<f&&(u=f);var D="",c=new Dt.default,T=e.YMax+1*h,S=e.YMin+1*h+u,I=!0,g=0;for(var E in l.Data){var F=l.Data[E],R=c.get(F.InfoType);if(R)R.Data.push(F);else{var A=_a.GetIconFont(F.InfoType);if(this.Canvas.fillStyle=A.Color,this.Canvas.font=u+"px "+A.Family,a){this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.fillText(A.HScreenText,T,e.XCenter,u);var P=new Ia(e.XCenter-u/2,T-u,u,u),p={Data:new Array(F),Rect:P,Type:F.InfoType,TextRect:{X:T,Y:e.XCenter}};c.set(F.InfoType,p),T+=u}else if(this.Canvas.textBaseline="bottom",this.Canvas.textAlign="center",this.InfoPosition===1){var w=n+g;this.Canvas.fillText(A.Text,e.XCenter,w,u);var P=new Ia(e.XCenter-u/2,w-u,u,u),p={Data:new Array(F),Rect:P,Type:F.InfoType,TextRect:{X:e.XCenter,Y:w}};c.set(F.InfoType,p),g-=u}else if(I){this.Canvas.fillText(A.Text,e.XCenter,T,u);var P=new Ia(e.XCenter-u/2,T-u,u,u),p={Data:new Array(F),Rect:P,Type:F.InfoType,TextRect:{X:e.XCenter,Y:T}};c.set(F.InfoType,p),T-=u,T-u<s&&(I=!1)}else{this.Canvas.fillText(A.Text,e.XCenter,S,u);var P=new Ia(e.XCenter-u/2,S-u,u,u),p={Data:new Array(F),Rect:P,Type:F.InfoType,TextRect:{X:e.XCenter,Y:S}};c.set(F.InfoType,p),S+=u}}}var H;d.KLine.NumIcon&&(a?H=d.KLine.NumIcon.HScreenText:H=d.KLine.NumIcon.Text);var W=!0,ht=!1,rt=void 0;try{for(var nt=(0,ye.default)(c),vt;!(W=(vt=nt.next()).done);W=!0){var e=vt.value,Nt=e[1];if(Nt.Data.length>=2&&H&&C){var Ft=Nt.Data.length;Ft>=H.length&&(Ft=0),this.Canvas.fillStyle=d.KLine.NumIcon.Color;var D=H[Ft];this.Canvas.fillText(D,Nt.TextRect.X,Nt.TextRect.Y,u)}a||this.InfoTooltipRect.push(Nt)}}catch(Bt){ht=!0,rt=Bt}finally{try{!W&&nt.return&&nt.return()}finally{if(ht)throw rt}}this.Canvas.restore(),this.Canvas.save(),this.ClipClient(a)}}}},this.DrawTradeIcon=function(){if(this.TradeData){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetLeft()+r/2+2,n=this.ChartBorder.GetRight(),s=this.ChartFrame.XPointCount;e&&(t=this.ChartBorder.GetTop()+r/2+2,n=this.ChartBorder.GetBottom());var o=this.TradeData.Sell,l=this.TradeData.Buy,h=a+r,u=B(),f=24*u,C=12*u;h<C?h=C:h>f&&(h=f),this.Canvas.font=h+"px "+this.TradeIcon.Family;for(var D=this.Data.DataOffset,c=0;D<this.Data.Data.length&&c<s;++D,++c,t+=a+r){var T=this.Data.Data[D];if(!(T.Open==null||T.High==null||T.Low==null||T.Close==null)){var S=!1,I=!1;if(o&&D<o.length&&(I=o[D]>0),l&&D<l.length&&(S=l[D]>0),!(!I&&!S)){var g=t,E=t+a;if(E>n)break;var F=g+(E-g)/2,R=this.GetYFromData(T.Low,!1),A=this.GetYFromData(T.High,!1);if(this.GetYFromData(T.Open,!1),this.GetYFromData(T.Close,!1),S)if(this.Canvas.fillStyle=this.TradeIcon.Buy.Color,e)this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.TradeIcon.Buy.HScreenText,R,F);else{this.Canvas.textAlign="center",this.Canvas.textBaseline="top",this.Canvas.fillText(this.TradeIcon.Buy.Text,F,R);var P=new Ia(F-h/2,R,h,h),p={Data:{Type:1,KData:T,Name:this.TradeData.Name,Param:this.TradeData.Param},Rect:P,TextRect:{X:F,Y:R}};this.TradeIconTooltipRect.push(p)}if(I)if(this.Canvas.fillStyle=this.TradeIcon.Sell.Color,e)this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.TradeIcon.Sell.HScreenText,A,F);else{this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.Canvas.fillText(this.TradeIcon.Sell.Text,F,A);var P=new Ia(F-h/2,A-h,h,h),p={Data:{Type:2,KData:T,Name:this.TradeData.Name,Param:this.TradeData.Param},Rect:P,TextRect:{X:F,Y:A}};this.TradeIconTooltipRect.push(p)}}}}}},this.GetTooltipData=function(e,a,r){if(!this.IsShow)return!1;for(var t in this.TradeIconTooltipRect){var n=this.TradeIconTooltipRect[t];if(n.Rect){var s=n.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(s.X,s.Y,s.Width,s.Height),this.Canvas.isPointInPath(e,a))return k.Chart.Log("[ChartKLine::GetTooltipData] trade icon ",n),r.Data=n,r.ChartPaint=this,r.Type=2,!0}}for(var t in this.InfoTooltipRect){var n=this.InfoTooltipRect[t];if(n.Rect){var s=n.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(s.X,s.Y,s.Width,s.Height),this.Canvas.isPointInPath(e,a))return r.Data=n,r.ChartPaint=this,r.Type=1,!0}}for(var t in this.TooltipRect){var s=this.TooltipRect[t][1];if(this.Canvas.beginPath(),this.Canvas.rect(s.X,s.Y,s.Width,s.Height),this.Canvas.isPointInPath(e,a)){var o=this.TooltipRect[t][0];return r.Data=this.Data.Data[o],r.ChartPaint=this,r.Type=0,!0}}return!1},this.GetMaxMin=function(){if(this.DrawType==14&&this.FFKChart&&this.FFKChart.GetMaxMin)return this.FFKChart.GetMaxMin(this);var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset;this.ChartFrame.GlobalOption&&this.ChartFrame.GlobalOption.IsValueFullRange&&(a=0,e=this.Data.Data.length);var r={Max:null,Min:null};if(this.DrawType==1||this.DrawType==4)for(var t=a,n=0;t<this.Data.Data.length&&n<e;++t,++n){var s=this.Data.Data[t];v.IsNumber(s.Close)&&(r.Max==null&&(r.Max=s.Close),r.Min==null&&(r.Min=s.Close),r.Max<s.Close&&(r.Max=s.Close),r.Min>s.Close&&(r.Min=s.Close))}else for(var t=a,n=0;t<this.Data.Data.length&&n<e;++t,++n){var s=this.Data.Data[t];if(!(s.Open==null||s.High==null||s.Low==null||s.Close==null))if(this.DrawType==5&&s.OrderFlow&&v.IsNumber(s.OrderFlow.PriceOffset)){var o=s.High,l=s.Low;if(v.IsNonEmptyArray(s.OrderFlow.High))for(var h=0;h<s.OrderFlow.High.length;++h){var u=s.OrderFlow.High[h];o<u.Price&&(o=u.Price)}if(v.IsNonEmptyArray(s.OrderFlow.Low))for(var h=0;h<s.OrderFlow.Low.length;++h){var u=s.OrderFlow.Low[h];l>u.Price&&(l=u.Price)}o+=s.OrderFlow.PriceOffset,l-=s.OrderFlow.PriceOffset,r.Max==null&&(r.Max=o),r.Min==null&&(r.Min=l),r.Max<o&&(r.Max=o),r.Min>l&&(r.Min=l)}else r.Max==null&&(r.Max=s.High),r.Min==null&&(r.Min=s.Low),r.Max<s.High&&(r.Max=s.High),r.Min>s.Low&&(r.Min=s.Low)}return r},this.GetAllPrice=function(){for(var e=this.ChartFrame.XPointCount,a=new Fe.default,r=this.Data.DataOffset,t=0;r<this.Data.Data.length&&t<e;++r,++t){var n=this.Data.Data[r];if(!(n.Open==null||n.High==null||n.Low==null||n.Close==null)){var s=n.Close;a.add(s)}}var o=[],l=!0,h=!1,u=void 0;try{for(var f=(0,ye.default)(a),C;!(l=(C=f.next()).done);l=!0){var D=C.value;o.push(D)}}catch(c){h=!0,u=c}finally{try{!l&&f.return&&f.return()}finally{if(h)throw u}}return o.sort(function(c,T){return c-T}),o},this.DrawLastPointEvent=function(e){if(this.GetEventCallback){var a=this.GetEventCallback($.ON_DRAW_KLINE_LAST_POINT);if(a){var r={Data:this.ChartFrame.DataWidth,Distance:this.ChartFrame.DistanceWidth};if(e)var t={LastPoint:{X:e.X,Y:e.Y,XLeft:e.XLeft,XRight:e.XRight},KItem:e.KItem,DrawType:this.DrawType,KWidth:r,ChartRight:e.ChartRight};else var t={LastPoint:null,KItem:null,KWidth:r};a.Callback(a,t,this)}}},this.DrawOrderFlow=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetBorder(),n=t.LeftEx+r/2+d.FrameLeftMargin,s=t.RightEx,o=this.ChartFrame.XPointCount;if(e){var t=this.ChartBorder.GetHScreenBorder();n=t.TopEx+r/2+d.FrameLeftMargin,s=t.BottomEx}this.UpColor,this.DownColor,this.UnchagneColor,this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.DrawKRange.Start=this.Data.DataOffset,this.DrawOrderFlowHBar();for(var l=this.Data.DataOffset,h=0;l<this.Data.Data.length&&h<o;++l,++h,n+=a+r,++this.ShowRange.DataCount){var u=this.Data.Data[l];if(this.ShowRange.End=l,!(u.Open==null||u.High==null||u.Low==null||u.Close==null)){var f=n,C=n+a;if(C>s)break;var D=f+(C-f)/2,c=this.GetYFromData(u.Low,!1),T=this.GetYFromData(u.High,!1),S=this.GetYFromData(u.Open,!1),I=this.GetYFromData(u.Close,!1);this.DrawKRange.End=l;var g={Low:c,High:T,Open:S,Close:I},E={Left:f,Center:D,Right:C,DataWidth:a};if(this.DrawOrderFlowBar(u.OrderFlow,u,E,g,e),this.IsShowKTooltip&&!e){var F=Math.min(S,I),R=Math.max(S,I);Math.abs(S-I)<5&&(F=Math.min(T,F-5),R=Math.max(c,R+5));var A=new Ia(f,F,a,R-F);this.TooltipRect.push([l,A])}if(this.Data.DataType==0){var P={Xleft:f,XRight:C,XCenter:D,YMax:T,YMin:c,DayData:u,Index:h};this.DrawInfo(P)}l==this.Data.Data.length-1}}},this.DrawOrderFlowBar=function(e,a,r,t,n){var s=Math.min(t.Open,t.Close),o=Math.max(t.Open,t.Close),l=Math.abs(t.Open-t.Close),h=0;e&&v.IsNumber(e.PriceOffset)&&(h=this.GetPriceYOffset(e.PriceOffset));var H=this.GetDynamicOrderFlowFont(h,r.DataWidth/2);this.IsShowOrderText=h>5&&r.DataWidth>10,this.OrderFlow.AlwaysShowOrderText&&(this.IsShowOrderText=!0);var u;a.Open<a.Close?u=this.OrderFlow.UpColor:a.Open>a.Close?u=this.OrderFlow.DownColor:u=this.OrderFlow.UnchagneColor;var f=r.DataWidth<4;f?(this.Canvas.strokeStyle=u.Border,this.Canvas.beginPath(),this.Canvas.moveTo(L(r.Center),s-h/2),this.Canvas.lineTo(L(r.Center),o+h/2),this.Canvas.stroke()):(this.Canvas.fillStyle=u.BG,this.Canvas.fillRect(b(r.Left),b(s-h/2),b(r.DataWidth),b(l+h))),this.Canvas.textBaseline="middle",this.Canvas.textAlign="center",this.Canvas.font=H;var C=r.DataWidth/2,D=C/2;if(e&&v.IsNonEmptyArray(e.Order)){var c=0,T=0,S=null;if(this.OrderFlow.IsShowAskBar||this.OrderFlow.IsShowBidBar||this.OrderFlow.IsShowPOCBG)for(var I=0,g=0,E=0;E<e.Order.length;++E){var F=e.Order[E];g=0,F.Ask&&v.IsNumber(F.Ask.Value)&&(c+=F.Ask.Value,g+=F.Ask.Value),F.Bid&&v.IsNumber(F.Bid.Value)&&(T+=F.Bid.Value,g+=F.Bid.Value),I<g&&(I=g,S=E)}for(var E=0;E<e.Order.length;++E){var F=e.Order[E],R=this.GetYFromData(F.Price,!1),p={Left:r.Left,Right:r.Center,Bottom:R+h/2,Top:R-h/2};if(p.Width=p.Right-p.Left,p.Height=p.Bottom-p.Top,F.Ask.BG&&(this.Canvas.fillStyle=F.Ask.BG,this.Canvas.fillRect(b(p.Left),b(p.Top),b(p.Width),b(p.Height))),this.OrderFlow.IsShowPOCBG&&S==E&&(this.Canvas.fillStyle=this.OrderFlow.POCGBColor,this.Canvas.fillRect(b(p.Left),b(p.Top),b(p.Width),b(p.Height))),this.OrderFlow.IsShowAskBar&&v.IsNumber(F.Ask.Value)&&c>0){var A=p.Width*(F.Ask.Value/c);A<1&&(A=1),this.Canvas.fillStyle=this.OrderFlow.AskBarColor,this.Canvas.fillRect(b(p.Right),b(p.Top),b(-A),b(p.Height))}var w=null;if(v.IsString(F.Ask.Text)?w=F.Ask.Text:v.IsNumber(F.Ask.Value)&&(w=F.Ask.Value.toString()),w&&this.IsShowOrderText&&this.OrderFlow.IsShowAskText)if(F.Ask.Color?this.Canvas.fillStyle=F.Ask.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color,F.Ask.Font){var P=this.GetDynamicOrderFlowFont(h,r.DataWidth/2,F.Ask.Font);this.Canvas.font=P,this.Canvas.fillText(w,r.Left+D,R),this.Canvas.font=H}else this.Canvas.fillText(w,r.Left+D,R);var p={Left:r.Center,Right:r.Right,Bottom:R+h/2,Top:R-h/2};if(p.Width=p.Right-p.Left,p.Height=p.Bottom-p.Top,F.Bid.BG&&(this.Canvas.fillStyle=F.Bid.BG,this.Canvas.fillRect(b(p.Left),b(p.Top),b(p.Width),b(p.Height))),this.OrderFlow.IsShowPOCBG&&S==E&&(this.Canvas.fillStyle=this.OrderFlow.POCGBColor,this.Canvas.fillRect(b(p.Left),b(p.Top),b(p.Width),b(p.Height))),this.OrderFlow.IsShowBidBar&&v.IsNumber(F.Bid.Value)&&T>0){var A=p.Width*(F.Bid.Value/T);A<1&&(A=1),this.Canvas.fillStyle=this.OrderFlow.BidBarColor,this.Canvas.fillRect(b(p.Left),b(p.Top),b(A),b(p.Height))}var w=null;if(v.IsString(F.Bid.Text)?w=F.Bid.Text:v.IsNumber(F.Bid.Value)&&(w=F.Bid.Value.toString()),w&&this.IsShowOrderText&&this.OrderFlow.IsShowBidText)if(F.Bid.Color?this.Canvas.fillStyle=F.Bid.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color,F.Bid.Font){var P=this.GetDynamicOrderFlowFont(h,r.DataWidth/2,F.Bid.Font);this.Canvas.font=P,this.Canvas.fillText(w,r.Center+D,R),this.Canvas.font=H}else this.Canvas.fillText(w,r.Center+D,R)}}(t.High<s||t.Low>o)&&(this.Canvas.strokeStyle=this.OrderFlow.Line.UpDownColor,t.High<s&&(this.Canvas.beginPath(),this.Canvas.moveTo(L(r.Center),t.High-h/2),this.Canvas.lineTo(L(r.Center),s-h/2),this.Canvas.stroke()),t.Low>o&&(this.Canvas.beginPath(),this.Canvas.moveTo(L(r.Center),t.Low+h/2),this.Canvas.lineTo(L(r.Center),o+h/2),this.Canvas.stroke())),!f&&Math.abs(t.Open-t.Close)>1&&(this.Canvas.strokeStyle=this.OrderFlow.Line.MiddleColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(r.Center),s-h/2),this.Canvas.lineTo(L(r.Center),o+h/2),this.Canvas.stroke()),f||(this.Canvas.beginPath(),this.Canvas.strokeStyle=u.Border,this.Canvas.rect(L(r.Left),L(s-h/2),b(r.DataWidth),b(l+h)),this.Canvas.stroke());var H=this.GetDynamicOrderFlowFont(h,r.DataWidth);if(e&&v.IsNonEmptyArray(e.High)&&this.IsShowOrderText)for(var E=0;E<e.High.length;++E){var F=e.High[E],w;if(v.IsString(F.Text)?w=F.Text:v.IsNumber(F.Value)&&(w=F.Value.toString()),!!w){F.Color?this.Canvas.fillStyle=F.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color;var R=this.GetYFromData(F.Price,!1);if(F.Font){var P=this.GetDynamicOrderFlowFont(h,r.DataWidth,F.Font);this.Canvas.font=P,this.Canvas.fillText(w,r.Center,R),this.Canvas.font=H}else this.Canvas.fillText(w,r.Center,R)}}if(e&&v.IsNonEmptyArray(e.Low)&&this.IsShowOrderText)for(var E=0;E<e.Low.length;++E){var F=e.Low[E],w;if(v.IsString(F.Text)?w=F.Text:v.IsNumber(F.Value)&&(w=F.Value.toString()),!!w){F.Color?this.Canvas.fillStyle=F.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color;var R=this.GetYFromData(F.Price,!1);if(F.Font){var P=this.GetDynamicOrderFlowFont(h,r.DataWidth,F.Font);this.Canvas.font=P,this.Canvas.fillText(w,r.Center,R),this.Canvas.font=H}else this.Canvas.fillText(w,r.Center,R)}}},this.GetPriceYOffset=function(e){var a=this.ChartFrame,r=a.ChartBorder.GetHeightEx()*e/(a.HorizontalMax-a.HorizontalMin);return r},this.GetDynamicOrderFlowFont=function(e,a,r){var t=parseInt(e)-2;e<5&&(t=parseInt(e)),t>this.OrderFlow.Text.FontMaxSize?t=this.OrderFlow.Text.FontMaxSize:t<=0&&(t=1);for(var n=this.FormatFontString(t,this.OrderFlow.Text.Family,r),s=t;s>0;s-=2){var n=this.FormatFontString(s,this.OrderFlow.Text.Family,r);this.Canvas.font=n;var o=this.Canvas.measureText(this.OrderFlow.Text.MaxValue).width+2;if(o<a)break}return n},this.FormatFontString=function(e,a,r){var t;return r?r.Weight&&(t=r.Weight+" "+e+"px "+a):t=e+"px "+a,t},this.DrawOrderFlowHBar=function(){for(var e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,r=this.ChartFrame.XPointCount,t=this.ChartFrame.HorizontalMax,n=this.ChartFrame.HorizontalMin,s=this.Data.DataOffset,o=this.Data.DataOffset+r,l=0;l<this.Data.Data.length;++l){var h=this.Data.Data[l];if(!(!h||!h.OrderFlow)&&v.IsNonEmptyArray(h.OrderFlow.Order))for(var u=0;u<h.OrderFlow.Order.length;++u){var f=h.OrderFlow.Order[u];if(f.HBar&&v.IsNumber(f.HBar.Width)&&v.IsNumber(f.Price)&&!(f.Price>t||f.Price<n)){var C=Math.ceil(l+f.HBar.Width),D=Math.min(l,C),c=Math.max(l,C);c<s||D>o||this.DrawOrderFlowHBarItem(l,h.OrderFlow,f,e,a)}}}},this.DrawOrderFlowHBarItem=function(e,a,r,t,n){var s=this.ShowRange.Start;this.ShowRange.Start+this.ShowRange.ShowCount;var o=this.GetYFromData(r.Price,!1),l=parseInt(e+r.HBar.Width),h=e-s,u=l-s;if(h<0&&(h=0),u<0&&(u=0),h<=u){this.ChartBorder.GetRight(),this.ChartFrame.XPointCount;var f=s,C=this.GetPriceYOffset(a.PriceOffset),D=this.ChartFrame.GetXFromIndex(h)-t/2;if(r.HBar.Type==1)for(var c=0,T=e+1;c<r.HBar.Width&&T<this.Data.Data.length;++c,++T){var S=this.Data.Data[T];if(S.Close<r.Price){u=T-1-f;break}}else if(r.HBar.Type==2)for(var c=0,T=e+1;c<r.HBar.Width&&T<this.Data.Data.length;++c,++T){var S=this.Data.Data[T];if(S.Close>r.Price){u=T-1-f;break}}if(u<0)return;var I=this.ChartFrame.GetXFromIndex(u)+t/2,g=o-C/2,E=C+.5;v.IsNumber(r.HBar.Height)&&(E=r.HBar.Height*C+.1);var F=r.HBar.Width-parseInt(r.HBar.Width);F>1e-6&&(I+=(t+n)*F),this.Canvas.fillStyle=r.HBar.Color,this.Canvas.fillRect(b(D),b(g),b(I-D),b(E))}},this.PtInChart=function(e,a){return this.DrawType==1||this.DrawType==4?this.PtInLine(e,a,{KLineClose:!0}):this.PtInKBar(e,a)},this.DrawSelectedStatus=function(){this.DrawLinePoint({KLineClose:!0})},this.DrawOrderFlow_Style2=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetBorder(),n=t.LeftEx+r/2+d.FrameLeftMargin,s=t.RightEx,o=this.ChartFrame.XPointCount;if(this.AryOrderFlowBorder=[],e){var t=this.ChartBorder.GetHScreenBorder();n=t.TopEx+r/2+d.FrameLeftMargin,s=t.BottomEx}var l=this.OrderFlow_Style2.UpColor,h=this.OrderFlow_Style2.DownColor,u=this.OrderFlow_Style2.UnchagneColor,f=b(this.OrderFlow_Style2.BarWidth),C=a-f;C/7<f&&(f=C/7),f<=1&&(f=2),this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.DrawKRange.Start=this.Data.DataOffset,this.DrawOrderFlowHBar();for(var D=this.Data.DataOffset,c=0;D<this.Data.Data.length&&c<o;++D,++c,n+=a+r,++this.ShowRange.DataCount){var T=this.Data.Data[D];if(this.ShowRange.End=D,!(T.Open==null||T.High==null||T.Low==null||T.Close==null)){var S=n,I=n+a;if(I>s)break;var g=S+(I-S)/2,E=this.GetYFromData(T.Low,!1),F=this.GetYFromData(T.High,!1),R=this.GetYFromData(T.Open,!1),A=this.GetYFromData(T.Close,!1);this.DrawKRange.End=D;var P=Math.min(R,A),p=Math.max(R,A),w=b(S),H=w+f;T.Open<T.Close?this.Canvas.fillStyle=l:T.Open>T.Close?this.Canvas.fillStyle=h:this.Canvas.fillStyle=u;var W=0;T.OrderFlow&&v.IsNumber(T.OrderFlow.PriceOffset)&&(W=this.GetPriceYOffset(T.OrderFlow.PriceOffset)),this.Canvas.fillRect(w,b(P-W/2),f,b(p-P+W));var ht={Low:E,High:F,Open:R,Close:A},rt={Left:H,Center:g,Right:I,DataWidth:I-H};rt.Center=rt.Left+rt.DataWidth/2,this.DrawOrderFlowBar_Style2(T.OrderFlow,T,rt,ht,e)}}if(a-f>5)for(var D=0;D<this.AryOrderFlowBorder.length;++D){var nt=this.AryOrderFlowBorder[D];if(!(!nt||!nt.Rect||!nt.Color)){var vt=nt.Rect;this.Canvas.strokeStyle=nt.Color,this.Canvas.beginPath(),this.Canvas.rect(L(vt.Left),L(vt.Top),b(vt.Width),b(vt.Height)),this.Canvas.stroke()}}this.AryOrderFlowBorder=[]},this.DrawOrderFlow_Style3=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetBorder(),n=t.LeftEx+r/2+d.FrameLeftMargin,s=t.RightEx,o=this.ChartFrame.XPointCount;if(this.AryOrderFlowBorder=[],e){var t=this.ChartBorder.GetHScreenBorder();n=t.TopEx+r/2+d.FrameLeftMargin,s=t.BottomEx}var l=this.OrderFlow_Style3.UpColor,h=this.OrderFlow_Style3.DownColor,u=this.OrderFlow_Style3.UnchagneColor,f=b(this.OrderFlow_Style3.BarWidth);a/4<f&&(f=a/4),f<=1&&(f=2),this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.DrawKRange.Start=this.Data.DataOffset,this.DrawOrderFlowHBar();for(var C=this.Data.DataOffset,D=0;C<this.Data.Data.length&&D<o;++C,++D,n+=a+r,++this.ShowRange.DataCount){var c=this.Data.Data[C];if(this.ShowRange.End=C,!(c.Open==null||c.High==null||c.Low==null||c.Close==null)){var T=n,S=n+a;if(S>s)break;var I=this.GetYFromData(c.Low,!1),g=this.GetYFromData(c.High,!1),E=this.GetYFromData(c.Open,!1),F=this.GetYFromData(c.Close,!1);this.DrawKRange.End=C;var R=Math.min(E,F),A=Math.max(E,F),P=b(T),p=P+f;c.Open<c.Close?this.Canvas.fillStyle=l:c.Open>c.Close?this.Canvas.fillStyle=h:this.Canvas.fillStyle=u;var w=0;c.OrderFlow&&v.IsNumber(c.OrderFlow.PriceOffset)&&(w=this.GetPriceYOffset(c.OrderFlow.PriceOffset)),this.Canvas.fillRect(P,b(R-w/2),f,b(A-R+w));var H={Low:I,High:g,Open:E,Close:F},W={Left:p,Right:S,DataWidth:S-p};this.DrawOrderFlowBar_Style3(c.OrderFlow,c,W,H,e)}}if(a-f>5)for(var C=0;C<this.AryOrderFlowBorder.length;++C){var ht=this.AryOrderFlowBorder[C];if(!(!ht||!ht.Rect||!ht.Color)){var rt=ht.Rect;this.Canvas.strokeStyle=ht.Color,this.Canvas.beginPath(),this.Canvas.rect(L(rt.Left),L(rt.Top),b(rt.Width),b(rt.Height)),this.Canvas.stroke()}}this.AryOrderFlowBorder=[]},this.DrawOrderFlowBar_Style2=function(e,a,r,t,n){Math.min(t.Open,t.Close),Math.max(t.Open,t.Close),Math.abs(t.Open-t.Close);var s=0;e&&v.IsNumber(e.PriceOffset)&&(s=this.GetPriceYOffset(e.PriceOffset));var o=this.GetDynamicOrderFlowFont(s,r.DataWidth/2);this.IsShowOrderText=s>5&&r.DataWidth>10,this.OrderFlow.AlwaysShowOrderText&&(this.IsShowOrderText=!0),this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.font=o,r.DataWidth/2;var l=2;if(e&&v.IsNonEmptyArray(e.Order))for(var h=0;h<e.Order.length;++h){var u=e.Order[h],f=this.GetYFromData(u.Price,!1),c={Left:r.Left,Right:r.Center,Bottom:f+s/2,Top:f-s/2};if(c.Width=c.Right-c.Left,c.Height=c.Bottom-c.Top,u.Ask.BG&&(this.Canvas.fillStyle=u.Ask.BG,this.Canvas.fillRect(b(c.Left),b(c.Top),b(c.Width),b(c.Height))),u.Ask.BorderColor){var C={Rect:c,Color:u.Ask.BorderColor};this.AryOrderFlowBorder.push(C)}var T=null;if(v.IsString(u.Ask.Text)?T=u.Ask.Text:v.IsNumber(u.Ask.Value)&&(T=u.Ask.Value.toString()),T&&this.IsShowOrderText)if(u.Ask.Color?this.Canvas.fillStyle=u.Ask.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color,u.Ask.Font){var D=this.GetDynamicOrderFlowFont(s,r.DataWidth/2,u.Ask.Font);this.Canvas.font=D,this.Canvas.fillText(T,r.Left+l,f),this.Canvas.font=o}else this.Canvas.fillText(T,r.Left+l,f);var c={Left:r.Center,Right:r.Right,Bottom:f+s/2,Top:f-s/2};if(c.Width=c.Right-c.Left,c.Height=c.Bottom-c.Top,u.Bid.BG&&(this.Canvas.fillStyle=u.Bid.BG,this.Canvas.fillRect(b(c.Left),b(c.Top),b(c.Width),b(c.Height))),u.Bid.BorderColor){var C={Rect:c,Color:u.Bid.BorderColor};this.AryOrderFlowBorder.push(C)}var T=null;if(v.IsString(u.Bid.Text)?T=u.Bid.Text:v.IsNumber(u.Bid.Value)&&(T=u.Bid.Value.toString()),T&&this.IsShowOrderText)if(u.Bid.Color?this.Canvas.fillStyle=u.Bid.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color,u.Bid.Font){var D=this.GetDynamicOrderFlowFont(s,r.DataWidth/2,u.Bid.Font);this.Canvas.font=D,this.Canvas.fillText(T,r.Center+l,f),this.Canvas.font=o}else this.Canvas.fillText(T,r.Center+l,f)}},this.DrawOrderFlowBar_Style3=function(e,a,r,t,n){Math.min(t.Open,t.Close),Math.max(t.Open,t.Close),Math.abs(t.Open-t.Close);var s=r.DataWidth-4,o=0;e&&v.IsNumber(e.PriceOffset)&&(o=this.GetPriceYOffset(e.PriceOffset));var l=this.GetDynamicOrderFlowFont(o,s);this.IsShowOrderText=o>5&&r.DataWidth>10,this.OrderFlow.AlwaysShowOrderText&&(this.IsShowOrderText=!0),this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.font=l;var h=2;if(e&&v.IsNonEmptyArray(e.Order))for(var u=0;u<e.Order.length;++u){var f=e.Order[u],C=this.GetYFromData(f.Price,!1),D={Left:r.Left,Right:r.Right,Bottom:C+o/2,Top:C-o/2};if(D.Width=D.Right-D.Left,D.Height=D.Bottom-D.Top,f.Item.BG&&(this.Canvas.fillStyle=f.Item.BG,this.Canvas.fillRect(b(D.Left),b(D.Top),b(D.Width),b(D.Height))),f.Item.BorderColor){var c={Rect:D,Color:f.Item.BorderColor};this.AryOrderFlowBorder.push(c)}var T=null;if(v.IsString(f.Item.Text)?T=f.Item.Text:v.IsNumber(f.Item.Value)&&(T=f.Item.Value.toString()),T&&this.IsShowOrderText)if(f.Item.Color?this.Canvas.fillStyle=f.Item.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color,f.Item.Font){var S=this.GetDynamicOrderFlowFont(o,s,f.Item.Font);this.Canvas.font=S,this.Canvas.fillText(T,r.Left+h,C),this.Canvas.font=l}else this.Canvas.fillText(T,r.Left+h,C)}},this.DrawOrderFlow_Style4=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetBorder(),n=t.LeftEx+r/2+d.FrameLeftMargin,s=t.RightEx,o=this.ChartFrame.XPointCount;if(this.AryOrderFlowBorder=[],e){var t=this.ChartBorder.GetHScreenBorder();n=t.TopEx+r/2+d.FrameLeftMargin,s=t.BottomEx}var l=this.OrderFlow_Style4.UpColor,h=this.OrderFlow_Style4.DownColor,u=this.OrderFlow_Style4.UnchagneColor;this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.DrawKRange.Start=this.Data.DataOffset,this.DrawOrderFlowHBar();var f=this.OrderFlow_Style4.KBarWidth;a+r<f*3&&(f=1);for(var C=this.Data.DataOffset,D=0;C<this.Data.Data.length&&D<o;++C,++D,n+=a+r,++this.ShowRange.DataCount){var c=this.Data.Data[C];if(this.ShowRange.End=C,!(c.Open==null||c.High==null||c.Low==null||c.Close==null)){var T=n,S=n+a;if(S>s)break;var I=T+(S-T)/2,g=this.GetYFromData(c.Low,!1),E=this.GetYFromData(c.High,!1),F=this.GetYFromData(c.Open,!1),R=this.GetYFromData(c.Close,!1);this.DrawKRange.End=C;var A=T+this.OrderFlow_Style4.LeftMargin,P=S+r-this.OrderFlow_Style4.RightMargin;if(this.OrderFlow_Style4.KBarType==1){var p=Math.min(F,R),w=Math.max(F,R),H=b(T)+this.OrderFlow_Style4.LeftMargin,W=A+f;c.Open<c.Close?this.Canvas.fillStyle=l:c.Open>c.Close?this.Canvas.fillStyle=h:this.Canvas.fillStyle=u;var ht=0;c.OrderFlow&&v.IsNumber(c.OrderFlow.PriceOffset)&&(ht=this.GetPriceYOffset(c.OrderFlow.PriceOffset)),this.Canvas.fillRect(H,b(p-ht/2),f,b(w-p+ht)),A=W+1}var rt={Low:g,High:E,Open:F,Close:R},nt={Left:A,Center:I,Right:P,DataWidth:P-A};nt.Center=nt.Left+nt.DataWidth/2,this.DrawOrderFlowBar_Style4(c.OrderFlow,c,nt,rt,e)}}},this.DrawOrderFlowBar_Style4=function(e,a,r,t,n){Math.min(t.Open,t.Close),Math.max(t.Open,t.Close),Math.abs(t.Open-t.Close);var s=0;e&&v.IsNumber(e.PriceOffset)&&(s=this.GetPriceYOffset(e.PriceOffset));var o=this.GetDynamicOrderFlowFont(s,r.DataWidth/2);this.IsShowOrderText=s>5&&r.DataWidth>10,this.OrderFlow.AlwaysShowOrderText&&(this.IsShowOrderText=!0),this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.font=o;var l=this.OrderFlow_Style4.VolBarSpace;if(s<=4&&(l=0),e&&v.IsNonEmptyArray(e.Order)){if(e.Summary||(e.Summary={}),!e.Summary.VolMaxMin){for(var h={Max:null,Min:null},u=0;u<e.Order.length;++u){var f=e.Order.length[u];(h.Max==null||h.Max<f.Vol.Value)&&(h.Max=f.Vol.Value),(h.Min==null||h.Min>f.Vol.Value)&&(h.Min=f.Vol.Value)}e.Summary.VolMaxMin=h}for(var C=null,D=e.Summary.VolMaxMin.Max,c=e.Summary.VolMaxMin.Min,u=0;u<e.Order.length;++u){var f=e.Order[u],T=this.GetYFromData(f.Price,!1);if(f.Vol)if(v.IsNonEmptyArray(f.AryVol)){for(var S=r.Right-r.Left,I=r.Left,g=I,E=0,F={Bottom:T+s/2,Top:T-s/2},R=0;R<f.AryVol.length;++R){var A=f.AryVol[R];if(v.IsNumber(A.Value)){E+=A.Value,g=S*(E-c)/(D-c)+r.Left;var P={Left:I,Right:g,Bottom:T+s/2,Top:T-s/2};C&&f.Price>C.Price&&(P.Bottom=C.Rect.Top-l),P.Width=P.Right-P.Left,P.Height=P.Bottom-P.Top,F={Left:b(P.Left),Top:b(P.Top),Width:b(P.Width),Height:b(P.Height)},F.Bottom=F.Top+F.Height,F.Right=F.Left+F.Width,F.Width<1&&(F.Width=1),A.BG&&(this.Canvas.fillStyle=A.BG,this.Canvas.fillRect(F.Left,F.Top,F.Width,F.Height)),I=F.Right}}if(F.Left=r.Left,F.Width=F.Right-F.Left,f.Vol.Text&&this.IsShowOrderText)if(this.Canvas.fillStyle=f.Vol.Color,f.Vol.Font){var p=this.GetDynamicOrderFlowFont(s,S/2,f.Vol.Font);this.Canvas.font=p,this.Canvas.fillText(text,r.Center+textXOffset,T),this.Canvas.font=o}else this.Canvas.fillText(f.Vol.Text,F.Left+2,T);C={Price:f.Price,Rect:F}}else if(v.IsNumber(f.Vol.Value)){var S=r.Right-r.Left,w=S*(f.Vol.Value-c)/(D-c),H={Left:r.Left,Right:r.Right,Bottom:T+s/2,Top:T-s/2};H.Right=H.Left+w,C&&f.Price>C.Price&&(H.Bottom=C.Rect.Top-l),H.Width=H.Right-H.Left,H.Height=H.Bottom-H.Top;var F={Left:b(H.Left),Top:b(H.Top),Width:b(H.Width),Height:b(H.Height)};if(F.Bottom=F.Top+F.Height,F.Right=F.Left+F.Width,F.Width<1&&(F.Width=1),f.Vol.BG&&(this.Canvas.fillStyle=f.Vol.BG,this.Canvas.fillRect(F.Left,F.Top,F.Width,F.Height)),f.Vol.BorderColor&&(this.Canvas.strokeStyle=f.Vol.BorderColor,this.Canvas.strokeRect(L(F.Left),L(F.Top),F.Width,F.Height)),f.Vol.Text&&this.IsShowOrderText)if(this.Canvas.fillStyle=f.Vol.Color,f.Vol.Font){var p=this.GetDynamicOrderFlowFont(s,S/2,f.Vol.Font);this.Canvas.font=p,this.Canvas.fillText(text,r.Center+textXOffset,T),this.Canvas.font=o}else this.Canvas.fillText(f.Vol.Text,F.Left+2,T);C={Price:f.Price,Rect:F}}else continue}}},this.DrawOrderFlow_Style5=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetBorder(),n=t.LeftEx+r/2+d.FrameLeftMargin,s=t.RightEx,o=this.ChartFrame.XPointCount;if(this.AryOrderFlowBorder=[],e){var t=this.ChartBorder.GetHScreenBorder();n=t.TopEx+r/2+d.FrameLeftMargin,s=t.BottomEx}var l=this.OrderFlow_Style2.UpColor,h=this.OrderFlow_Style2.DownColor,u=this.OrderFlow_Style2.UnchagneColor,f=b(this.OrderFlow_Style2.BarWidth),C=a-f;C/7<f&&(f=C/7),f<=1&&(f=2),this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.DrawKRange.Start=this.Data.DataOffset,this.DrawOrderFlowHBar();for(var D=this.Data.DataOffset,c=0;D<this.Data.Data.length&&c<o;++D,++c,n+=a+r,++this.ShowRange.DataCount){var T=this.Data.Data[D];if(this.ShowRange.End=D,!(T.Open==null||T.High==null||T.Low==null||T.Close==null)){var S=n,I=n+a;if(I>s)break;var g=S+(I-S)/2,E=this.GetYFromData(T.Low,!1),F=this.GetYFromData(T.High,!1),R=this.GetYFromData(T.Open,!1),A=this.GetYFromData(T.Close,!1);this.DrawKRange.End=D;var P=Math.min(R,A),p=Math.max(R,A),w=b(S),H=w+f;T.Open<T.Close?this.Canvas.fillStyle=l:T.Open>T.Close?this.Canvas.fillStyle=h:this.Canvas.fillStyle=u;var W=0;T.OrderFlow&&v.IsNumber(T.OrderFlow.PriceOffset)&&(W=this.GetPriceYOffset(T.OrderFlow.PriceOffset)),this.Canvas.fillRect(w,b(P-W/2),f,b(p-P+W));var ht={Low:E,High:F,Open:R,Close:A},rt={Left:H,Center:g,Right:I,DataWidth:I-H};rt.Center=rt.Left+rt.DataWidth/2,this.DrawOrderFlowBar_Style5(T.OrderFlow,T,rt,ht,e)}}},this.DrawOrderFlowBar_Style5=function(e,a,r,t,n){Math.min(t.Open,t.Close),Math.max(t.Open,t.Close),Math.abs(t.Open-t.Close);var s=0;e&&v.IsNumber(e.PriceOffset)&&(s=this.GetPriceYOffset(e.PriceOffset));var o=this.GetDynamicOrderFlowFont(s,r.DataWidth/2);if(this.IsShowOrderText=s>5&&r.DataWidth>10,this.OrderFlow.AlwaysShowOrderText&&(this.IsShowOrderText=!0),this.Canvas.textBaseline="middle",this.Canvas.font=o,r.DataWidth/2,e&&v.IsNonEmptyArray(e.Order))for(var l=e.MaxValue,h=0;h<e.Order.length;++h){var u=e.Order[h],f=this.GetYFromData(u.Price,!1),g={Left:r.Left,Right:r.Center,Bottom:f+s/2,Top:f-s/2};if(g.Width=g.Right-g.Left,g.Height=g.Bottom-g.Top,v.IsNumber(u.Ask.Value)){var C=this.OrderFlow_Style5.AskBarColor;u.Ask.BG&&(C=u.Ask.BG),this.Canvas.fillStyle=C;var D=g.Width*u.Ask.Value/l;this.Canvas.fillRect(b(g.Right),b(g.Top),b(-D),b(g.Height));var c=null;if(v.IsString(u.Ask.Text)?c=u.Ask.Text:c=u.Ask.Value.toString(),c&&this.IsShowOrderText){var T=this.OrderFlow.Text.Color;u.Ask.Color&&(T=u.Ask.Color),this.Canvas.fillStyle=T,this.Canvas.textAlign="right";var S=g.Right-this.OrderFlow_Style5.LeftMargin;if(u.Ask.Font){var I=this.GetDynamicOrderFlowFont(s,r.DataWidth/2,u.Ask.Font);this.Canvas.font=I,this.Canvas.fillText(c,S,f),this.Canvas.font=o}else this.Canvas.fillText(c,S,f)}}var g={Left:r.Center,Right:r.Right,Bottom:f+s/2,Top:f-s/2};if(g.Width=g.Right-g.Left,g.Height=g.Bottom-g.Top,v.IsNumber(u.Bid.Value)){var C=this.OrderFlow_Style5.BidBarColor;u.Bid.BG&&(C=u.Bid.BG),this.Canvas.fillStyle=C;var D=g.Width*u.Bid.Value/l;this.Canvas.fillRect(b(g.Left),b(g.Top),b(D),b(g.Height));var c=null;if(v.IsString(u.Bid.Text)?c=u.Bid.Text:c=u.Bid.Value.toString(),c&&this.IsShowOrderText){var T=this.OrderFlow.Text.Color;u.Bid.Color&&(T=u.Bid.Color),this.Canvas.fillStyle=T,this.Canvas.textAlign="left";var S=g.Left+this.OrderFlow_Style5.RightMargin;if(u.Bid.Font){var I=this.GetDynamicOrderFlowFont(s,r.DataWidth/2,u.Bid.Font);this.Canvas.font=I,this.Canvas.fillText(c,S,f),this.Canvas.font=o}else this.Canvas.fillText(c,S,f)}}}},this.DrawHighLow=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount;if(e)var n=this.ChartBorder.GetHScreenBorder(),s=n.TopEx+r/2+d.FrameLeftMargin,o=n.BottomEx;else var n=this.ChartBorder.GetBorder(),s=n.LeftEx+r/2+d.FrameLeftMargin,o=n.RightEx;this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset,this.Canvas.fillStyle=this.HighLowBarColor,this.Canvas.strokeStyle=this.HighLowBarColor;var l=jt(this.Symbol),h=this.GetHighLowTextFont(a,r),u=!1;h&&(u=!0,this.Canvas.font=h);for(var f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<t;++f,++C,s+=a+r,++this.ShowRange.DataCount){var D=this.Data.Data[f];if(this.ShowRange.End=f,!(D.Open==null||D.High==null)){var c=s,T=s+a;if(T>o)break;var S=c+(T-c)/2,I=this.GetYFromData(D.Low,!1),g=this.GetYFromData(D.High,!1);this.DrawKRange.End=f;var E=I,F=g-I;if(Math.abs(F)<1&&(F=1),a>=4)e?this.Canvas.fillRect(b(E),b(c),b(F),b(a)):(this.Canvas.fillRect(b(c),b(E),b(a),b(F)),u&&this.DrawHighLowText(g,I,S,D,l));else{var S=c+(T-c)/2;this.Canvas.beginPath(),e?(this.Canvas.moveTo(L(I),L(S)),this.Canvas.lineTo(L(g),L(S))):(this.Canvas.moveTo(L(S),L(I)),this.Canvas.lineTo(L(S),L(g))),this.Canvas.stroke()}if(this.IsShowKTooltip&&!e){var R=Math.min(I,g),A=Math.max(I,g);Math.abs(R-A)<5&&(R=Math.min(g,R-5),A=Math.max(I,A+5));var P=new Ia(c,R,a,A-R);this.TooltipRect.push([f,P])}}}},this.DrawHighLowText=function(e,a,r,t,n){this.Canvas.textAlign="center";var s=t.High.toFixed(n);this.Canvas.textBaseline="bottom",this.Canvas.fillText(s,r,e-2);var s=t.Low.toFixed(n);this.Canvas.textBaseline="top",this.Canvas.fillText(s,r,a+3)},this.GetHighLowTextFont=function(e,a){for(var r=e+a,t=this.HighLowTextConfig.MaxText,n=Math.min(this.HighLowTextConfig.MaxSize,this.HighLowTextConfig.MinSize),s=Math.max(this.HighLowTextConfig.MaxSize,this.HighLowTextConfig.MinSize),o=s;o>=n;--o){var l=o*B()+"px "+this.HighLowTextConfig.FontName;this.Canvas.font=l;var h=this.Canvas.measureText(t).width;if(h<=r)return l}return null},this.DrawPriceGap=function(){if(v.IsNonEmptyArray(this.AryPriceGapCache)&&!(this.PriceGap.Count<=0)){var e=this.AryPriceGapCache.length-this.PriceGap.Count;e<0&&(e=0);var a=this.ChartFrame.IsHScreen===!0,r=null;a?r=this.ChartBorder.GetHScreenBorder():r=this.ChartBorder.GetBorder(),this.Canvas.font=this.PriceGapStyple.Text.Font,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";for(var t=this.Canvas.measureText("擎").width,n=jt(this.Symbol),s=e;s<this.AryPriceGapCache.length;++s){var o=this.AryPriceGapCache[s],l=o.Data[0],h=o.Data[1],u=null,f=null,C=null;if(o.Type==1)a?(u={Left:l.Coordinate.High,Right:h.Coordinate.Low,Top:l.Coordinate.X,Bottom:r.Bottom},u.Width=u.Right-u.Left,u.Height=u.Bottom-u.Top,f={Left:l.Coordinate.High-t-2,Top:l.Coordinate.Right+2,Height:t},f.Bottom=f.Top+f.Height):(u={Left:l.Coordinate.X,Right:r.Right,Top:h.Coordinate.Low,Bottom:l.Coordinate.High},u.Width=u.Right-u.Left,u.Height=u.Bottom-u.Top,f={Left:l.Coordinate.Right+2,Top:u.Bottom+2,Right:u.Right,Height:t},f.Bottom=f.Top+f.Height),C=l.Data.High.toFixed(n)+"-"+h.Data.Low.toFixed(n);else if(o.Type==2)a?(u={Left:l.Coordinate.Low,Right:h.Coordinate.High,Top:l.Coordinate.X,Bottom:r.Bottom},u.Width=u.Right-u.Left,u.Height=u.Bottom-u.Top,f={Left:l.Coordinate.Low+2,Top:l.Coordinate.Right+2,Height:t},f.Bottom=f.Top+f.Height):(u={Left:l.Coordinate.X,Right:r.Right,Top:l.Coordinate.Low,Bottom:h.Coordinate.High},u.Width=u.Right-u.Left,u.Height=u.Bottom-u.Top,f={Left:l.Coordinate.Right+2,Bottom:u.Top,Right:u.Right,Height:t},f.Top=f.Bottom-f.Height),C=l.Data.Low.toFixed(n)+"-"+h.Data.High.toFixed(n);else continue;if(!u)return;if(this.Canvas.fillStyle=this.PriceGapStyple.Line.Color,this.Canvas.fillRect(u.Left,u.Top,u.Width,u.Height),f){var D=this.Canvas.measureText(C).width;f.Width=D,f.Right=f.Left+f.Width,this.Canvas.fillStyle=this.PriceGapStyple.Text.Color,a?(this.Canvas.save(),this.Canvas.translate(f.Left,f.Top),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(C,0,0),this.Canvas.restore()):(f.Right>u.Right&&(f.Right=u.Right,f.Left=f.Right-f.Width),this.Canvas.fillStyle=this.PriceGapStyple.Text.Color,this.Canvas.fillText(C,f.Left,f.Bottom))}}}},this.IsPriceGap=function(e,a){return!a||!e?0:a.Data.Low>e.Data.High?2:a.Data.High<e.Data.Low?1:-1},this.CheckPriceGap=function(e){for(var a=e.Data,r=0;r<this.AryPriceGapCache.length;++r){var t=this.AryPriceGapCache[r],n=t.Data[0],s=t.Data[1];if(t.Type==1){if(a.Low<=n.Data.High){this.AryPriceGapCache.splice(r,1),--r;continue}a.Low<s.Data.Low&&(t.Data[1]=e)}else if(t.Type==2){if(a.High>=n.Data.Low){this.AryPriceGapCache.splice(r,1),--r;continue}a.High>s.Data.High&&(t.Data[1]=e)}}}}function uh(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartColorKline",this.Symbol,this.Color="rgb(0,255,44)",this.IsEmptyBar=!1,this.DrawType=0,this.KLineColor,this.DrawName,this.Draw=function(){if(this.IsShow)if(this.DrawName=="DRAWCOLORKLINE")this.DrawColorBar();else{if(!this.KLineColor)return;this.DrawBar()}},this.DrawUpBarItem=function(e,a,r,t){var n=this.ChartFrame.IsHScreen===!0,s=a,o=a+r,l=s+(o-s)/2,h=this.ChartFrame.GetYFromData(e.Low),u=this.ChartFrame.GetYFromData(e.High),f=this.ChartFrame.GetYFromData(e.Open),C=this.ChartFrame.GetYFromData(e.Close),D=u;r>=4?(e.High>e.Close&&(this.Canvas.beginPath(),n?(this.Canvas.moveTo(L(D),L(l)),this.Canvas.lineTo(L(this.DrawType==3?Math.max(C,f):C),L(l))):(this.Canvas.moveTo(L(l),L(D)),this.Canvas.lineTo(L(l),L(this.DrawType==3?Math.min(C,f):C))),this.Canvas.stroke()),D=C,n?Math.abs(f-D)<1?this.Canvas.fillRect(b(D),b(s),1,b(r)):this.DrawType==3?(this.Canvas.beginPath(),this.Canvas.rect(L(D),L(s),b(f-D),b(r)),this.Canvas.stroke()):this.Canvas.fillRect(b(D),b(s),b(f-D),b(r)):Math.abs(f-D)<1?this.Canvas.fillRect(b(s),b(D),b(r),1):this.DrawType==3?(this.Canvas.beginPath(),this.Canvas.rect(L(s),L(D),b(r),b(f-D)),this.Canvas.stroke()):this.Canvas.fillRect(b(s),b(Math.min(D,f)),b(r),b(Math.abs(f-D))),e.Open>e.Low&&(this.Canvas.beginPath(),n?(this.Canvas.moveTo(L(this.DrawType==3?Math.min(C,f):D),L(l)),this.Canvas.lineTo(L(h),L(l))):(this.Canvas.moveTo(L(l),L(this.DrawType==3?Math.max(C,f):D)),this.Canvas.lineTo(L(l),L(h))),this.Canvas.stroke())):(this.Canvas.beginPath(),n?(this.Canvas.moveTo(u,L(l)),this.Canvas.lineTo(h,L(l))):(this.Canvas.moveTo(L(l),u),this.Canvas.lineTo(L(l),h)),this.Canvas.stroke())},this.DrawDownBarItem=function(e,a,r,t){var n=this.ChartFrame.IsHScreen===!0,s=a,o=a+r,l=s+(o-s)/2,h=this.ChartFrame.GetYFromData(e.Low),u=this.ChartFrame.GetYFromData(e.High),f=this.ChartFrame.GetYFromData(e.Open),C=this.ChartFrame.GetYFromData(e.Close),D=u;r>=4?(e.High>e.Close&&(this.Canvas.beginPath(),n?(this.Canvas.moveTo(L(D),L(l)),this.Canvas.lineTo(L(f),L(l))):(this.Canvas.moveTo(L(l),L(D)),this.Canvas.lineTo(L(l),L(f))),this.Canvas.stroke()),D=f,n?Math.abs(C-D)<1?this.Canvas.fillRect(b(D),b(s),1,b(r)):this.Canvas.fillRect(b(D),b(s),b(C-D),b(r)):Math.abs(C-D)<1?this.Canvas.fillRect(b(s),b(D),b(r),1):this.Canvas.fillRect(b(s),b(Math.min(D,C)),b(r),b(Math.abs(C-D))),e.Open>e.Low&&(this.Canvas.beginPath(),n?(this.Canvas.moveTo(L(D),L(l)),this.Canvas.lineTo(L(h),L(l))):(this.Canvas.moveTo(L(l),L(D)),this.Canvas.lineTo(L(l),L(h))),this.Canvas.stroke())):(this.Canvas.beginPath(),n?(this.Canvas.moveTo(u,L(l)),this.Canvas.lineTo(h,L(l))):(this.Canvas.moveTo(L(l),u),this.Canvas.lineTo(L(l),h)),this.Canvas.stroke())},this.DrawUnChangeBarItem=function(e,a,r,t){var n=this.ChartFrame.IsHScreen===!0,s=a,o=a+r,l=s+(o-s)/2,h=this.ChartFrame.GetYFromData(e.Low),u=this.ChartFrame.GetYFromData(e.High),f=this.ChartFrame.GetYFromData(e.Open);this.ChartFrame.GetYFromData(e.Close);var C=u;r>=4?(this.Canvas.beginPath(),e.High>e.Close&&(n?(this.Canvas.moveTo(C,L(l)),this.Canvas.lineTo(f,L(l))):(this.Canvas.moveTo(L(l),C),this.Canvas.lineTo(L(l),f))),C=f,n?(this.Canvas.moveTo(L(C),L(s)),this.Canvas.lineTo(L(C),L(o))):(this.Canvas.moveTo(L(s),L(C)),this.Canvas.lineTo(L(o),L(C))),e.Open>e.Low&&(n?(this.Canvas.moveTo(L(C),L(l)),this.Canvas.lineTo(L(h),L(l))):(this.Canvas.moveTo(L(l),L(C)),this.Canvas.lineTo(L(l),L(h)))),this.Canvas.stroke()):(this.Canvas.beginPath(),n?(this.Canvas.moveTo(u,L(l)),this.Canvas.lineTo(h,L(l))):(this.Canvas.moveTo(L(l),u),this.Canvas.lineTo(L(l),h)),this.Canvas.stroke())},this.DrawBar=function(){var e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,r=this.ChartBorder.GetLeft()+a/2+2,t=this.ChartBorder.GetRight(),n=this.ChartFrame.XPointCount;this.IsHScreen&&(r=this.ChartBorder.GetTop()+a/2+2,t=this.ChartBorder.GetBottom());for(var s=this.Data.DataOffset,o=0;s<this.Data.Data.length&&o<n;++s,++o,r+=e+a){var l=this.Data.Data[s];if(!(l.Open==null||l.High==null||l.Low==null||l.Close==null)&&this.KLineColor.has(s)){var h=this.KLineColor.get(s),u=r+e;if(u>t)break;h.Color?(this.Canvas.strokeStyle=h.Color,this.Canvas.fillStyle=h.Color):(this.Canvas.strokeStyle=this.Color,this.Canvas.fillStyle=this.Color),l.Open<l.Close?this.DrawUpBarItem(l,r,e,h):l.Open>l.Close?this.DrawDownBarItem(l,r,e,h):this.DrawUnChangeBarItem(l,r,e,h)}}},this.DrawColorBar=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetBorder(),n=t.LeftEx+r/2+d.FrameLeftMargin,s=t.RightEx,o=this.ChartFrame.XPointCount;if(e){var t=this.ChartBorder.GetHScreenBorder();n=t.TopEx+r/2+d.FrameLeftMargin,s=t.BottomEx}for(var l=this.Data.DataOffset,h=0;l<this.Data.Data.length&&h<o;++l,++h,n+=a+r){var u=this.Data.Data[l];if(u&&!(!v.IsNumber(u.Open)||!v.IsNumber(u.High)||!v.IsNumber(u.Low)||!v.IsNumber(u.Close))){var f=n,C=n+a;if(C>s)break;var D=f+(C-f)/2,c=this.GetYFromData(u.Low,!1),T=this.GetYFromData(u.High,!1),S=this.GetYFromData(u.Open,!1),I=this.GetYFromData(u.Close,!1),g=T;u.Open==u.Close?this.DrawKBar_Unchagne(u,a,this.Color,this.IsEmptyBar,D,g,f,C,c,T,S,I,e):this.DrawKBar_Custom(u,a,this.Color,this.IsEmptyBar,D,g,f,C,c,T,S,I,e)}}},this.DrawKBar_Unchagne=function(e,a,r,t,n,s,o,l,h,u,f,C,D){if(a>=4){if(a%2!=0&&(a-=1),this.Canvas.strokeStyle=r,this.Canvas.beginPath(),e.High>e.Close){if(D)this.Canvas.moveTo(s,L(n)),this.Canvas.lineTo(f,L(n));else{var c=L(o+a/2);this.Canvas.moveTo(c,s),this.Canvas.lineTo(c,f)}s=f}else s=f;if(D?(this.Canvas.moveTo(L(s),L(o)),this.Canvas.lineTo(L(s),L(l))):(this.Canvas.moveTo(L(o),L(s)),this.Canvas.lineTo(L(o+a),L(s))),e.Open>e.Low)if(D)this.Canvas.moveTo(L(s),L(n)),this.Canvas.lineTo(L(h),L(n));else{var c=L(o+a/2);this.Canvas.moveTo(c,L(s)),this.Canvas.lineTo(c,L(h))}this.Canvas.stroke()}else this.Canvas.beginPath(),D?(this.Canvas.moveTo(u,L(n)),this.Canvas.lineTo(h,L(n))):(this.Canvas.moveTo(L(n),u),this.Canvas.lineTo(L(n),h)),this.Canvas.strokeStyle=r,this.Canvas.stroke()},this.DrawKBar_Custom=function(e,a,r,t,n,s,o,l,h,u,f,C,D){if(t&&a%2!=0&&(a-=1),a>=4){if(this.Canvas.strokeStyle=r,e.High>e.Close){if(this.Canvas.beginPath(),D)this.Canvas.moveTo(L(s),L(n)),this.Canvas.lineTo(L(t?Math.max(C,f):C),L(n));else if(t){var c=o+a/2;this.Canvas.moveTo(L(c),L(s)),this.Canvas.lineTo(L(c),L(Math.min(C,f)))}else this.Canvas.moveTo(L(n),L(s)),this.Canvas.lineTo(L(n),L(C));this.Canvas.stroke(),s=C}else s=C;if(this.Canvas.fillStyle=r,D?Math.abs(f-s)<1?this.Canvas.fillRect(b(s),b(o),1,b(a)):t?(this.Canvas.beginPath(),this.Canvas.rect(L(s),L(o),b(f-s),b(a)),this.Canvas.stroke()):this.Canvas.fillRect(b(s),b(o),b(f-s),b(a)):Math.abs(f-s)<1?this.Canvas.fillRect(b(o),b(s),b(a),1):t?(this.Canvas.beginPath(),this.Canvas.rect(L(o),L(s),b(a),b(f-s)),this.Canvas.stroke()):this.Canvas.fillRect(b(o),b(Math.min(s,f)),b(a),b(Math.abs(f-s))),e.Open>e.Low){if(this.Canvas.beginPath(),D)this.Canvas.moveTo(L(t?Math.min(C,f):s),L(n)),this.Canvas.lineTo(L(h),L(n));else if(t){var c=o+a/2;this.Canvas.moveTo(L(c),L(Math.max(C,f))),this.Canvas.lineTo(L(c),L(h))}else this.Canvas.moveTo(L(n),L(s)),this.Canvas.lineTo(L(n),L(h));this.Canvas.stroke()}}else this.Canvas.beginPath(),D?(this.Canvas.moveTo(u,L(n)),this.Canvas.lineTo(h,L(n))):(this.Canvas.moveTo(L(n),u),this.Canvas.lineTo(L(n),h)),this.Canvas.strokeStyle=r,this.Canvas.stroke()},this.GetMaxMin=function(){var e={Max:null,Min:null};if(this.DrawName=="DRAWCOLORKLINE")for(var a=this.ChartFrame.XPointCount,r=this.Data.DataOffset,t=0;r<this.Data.Data.length&&t<a;++r,++t){var n=this.Data.Data[r];n&&(n.Open==null||n.High==null||n.Low==null||n.Close==null||(e.Max==null&&(e.Max=n.High),e.Min==null&&(e.Min=n.Low),e.Max<n.High&&(e.Max=n.High),e.Min>n.Low&&(e.Min=n.Low)))}return e}}function Ad(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartHeatMap",this.Draw=function(){if(this.IsShow&&!this.ChartFrame.IsMinSize){this.ChartFrame.IsHScreen;for(var e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,r=this.ChartBorder.GetBorder(),t=r.LeftEx+d.FrameLeftMargin,n=r.RightEx,s=this.ChartFrame.XPointCount,o=this.Data.DataOffset,l=0;o<this.Data.Data.length&&l<s;++o,++l,t+=e+a){var h=this.Data.Data[o];if(h.HeatMap){var u=t,f=t+e;if(f>n)break;this.DrawHeatMap(u,f+a,h.HeatMap)}}}},this.DrawHeatMap=function(e,a,r){if(v.IsNonEmptyArray(r.Order)){var t=this.ChartFrame.HorizontalMax,n=this.ChartFrame.HorizontalMin,s=0;v.IsNumber(r.PriceOffset)&&(s=this.GetPriceYOffset(r.PriceOffset));for(var o=0;o<r.Order.length;++o){var l=r.Order[o];if(v.IsNumber(l.Price)&&l.Color&&!(l.Price>t||l.Price<n)){var h=this.GetYFromData(l.Price,!1),u={Left:e,Right:a,Bottom:h+s/2,Top:h-s/2};u.Width=u.Right-u.Left,u.Height=u.Bottom-u.Top,this.Canvas.fillStyle=l.Color,this.Canvas.fillRect(u.Left,u.Top,u.Width,u.Height)}}}},this.GetPriceYOffset=function(e){var a=this.ChartFrame,r=a.ChartBorder.GetHeightEx()*e/(a.HorizontalMax-a.HorizontalMin);return r}}var Le={STATUS_NONE_ID:0,STATUS_REQUESTDATA_ID:1,STATUS_RECVDATA_ID:2,STATUS_FINISHED_ID:3};function OC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartOverlayKLine",this.Color="rgb(65,105,225)",this.MainData,this.SourceData,this.Title,this.DrawType=0,this.CustomDrawType=null,this.Status=Le.STATUS_NONE_ID,this.IsDelete=!1,this.CloseLineWidth=d.CloseLineWidth,this.ShowRange={},this.DrawKRange={Start:null,End:null},this.YInfoType=4,this.SetOption=function(e){e&&(v.IsNumber(e.DrawType)&&(this.CustomDrawType=e.DrawType),v.IsNumber(e.YInfoType)&&(this.YInfoType=e.YInfoType))},this.DrawKBar=function(e){var a=this.ChartFrame.IsHScreen===!0,r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartBorder.GetLeft()+t/2+2;a&&(n=this.ChartBorder.GetTop()+t/2+2);var s=this.ChartBorder.GetRight();a&&(s=this.ChartBorder.GetBottom());var o=this.ChartFrame.XPointCount,l=this.DrawType;this.CustomDrawType!=null&&(l=this.CustomDrawType);var h=!0,u=null;this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.ShowRange.FirstOpen=e,this.DrawKRange.Start=this.Data.DataOffset;for(var f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<o;++f,++C,n+=r+t,++this.ShowRange.DataCount){var D=this.Data.Data[f];if(!(!D||D.Open==null||D.High==null||D.Low==null||D.Close==null)){u==null&&(u=D.Open,this.ShowRange.FirstOverlayOpen=D.Open),h&&(this.Canvas.strokeStyle=this.Color,this.Canvas.fillStyle=this.Color,this.Canvas.beginPath(),h=!1);var c=n,T=n+r;if(T>s)break;var S=c+(T-c)/2,I=this.GetYFromData(D.Low/u*e,!1),g=this.GetYFromData(D.High/u*e,!1),E=this.GetYFromData(D.Open/u*e,!1),F=this.GetYFromData(D.Close/u*e,!1),R=g;this.DrawKRange.End=f,D.Open<D.Close?r>=4?(D.High>D.Close&&(a?(this.Canvas.moveTo(L(R),L(S)),this.Canvas.lineTo(L(this.DrawType==3?Math.max(F,E):F),L(S))):(this.Canvas.moveTo(L(S),L(R)),this.Canvas.lineTo(L(S),L(this.DrawType==3?Math.min(F,E):F)))),R=F,a?Math.abs(E-R)<1?this.Canvas.fillRect(b(R),b(c),1,b(r)):l==3?this.Canvas.rect(L(R),L(c),b(E-R),b(r)):this.Canvas.fillRect(b(R),b(c),b(E-R),b(r)):Math.abs(E-R)<1?this.Canvas.fillRect(b(c),b(R),b(r),1):l==3?this.Canvas.rect(L(c),L(R),b(r),b(E-R)):this.Canvas.fillRect(b(c),b(R),b(r),b(E-R)),D.Open>D.Low&&(a?(this.Canvas.moveTo(L(this.DrawType==3?Math.min(F,E):R),L(S)),this.Canvas.lineTo(L(I),L(S))):(this.Canvas.moveTo(L(S),L(this.DrawType==3?Math.max(F,E):R)),this.Canvas.lineTo(L(S),L(I))))):a?(this.Canvas.moveTo(g,L(S)),this.Canvas.lineTo(I,L(S))):(this.Canvas.moveTo(L(S),g),this.Canvas.lineTo(L(S),I)):D.Open>D.Close?r>=4?(D.High>D.Close&&(a?(this.Canvas.moveTo(L(R),L(S)),this.Canvas.lineTo(L(E),L(S))):(this.Canvas.moveTo(L(S),L(R)),this.Canvas.lineTo(L(S),L(E)))),R=E,a?Math.abs(F-R)<1?this.Canvas.fillRect(b(R),b(c),1,b(r)):this.Canvas.fillRect(b(R),b(c),b(F-R),b(r)):Math.abs(F-R)<1?this.Canvas.fillRect(b(c),b(R),b(r),1):this.Canvas.fillRect(b(c),b(R),b(r),b(F-R)),D.Open>D.Low&&(a?(this.Canvas.moveTo(L(R),L(S)),this.Canvas.lineTo(L(I),L(S))):(this.Canvas.moveTo(L(S),L(R)),this.Canvas.lineTo(L(S),L(I))))):a?(this.Canvas.moveTo(g,L(S)),this.Canvas.lineTo(I,L(S))):(this.Canvas.moveTo(L(S),g),this.Canvas.lineTo(L(S),I)):r>=4?(D.High>D.Close&&(a?(this.Canvas.moveTo(R,L(S)),this.Canvas.lineTo(E,L(S))):(this.Canvas.moveTo(L(S),R),this.Canvas.lineTo(L(S),E))),R=E,a?(this.Canvas.moveTo(L(R),L(c)),this.Canvas.lineTo(L(R),L(T))):(this.Canvas.moveTo(L(c),L(R)),this.Canvas.lineTo(L(T),L(R))),D.Open>D.Low&&(a?(this.Canvas.moveTo(L(R),L(S)),this.Canvas.lineTo(L(I),L(S))):(this.Canvas.moveTo(L(S),L(R)),this.Canvas.lineTo(L(S),L(I))))):a?D.High==D.Low?(this.Canvas.moveTo(g,L(S)),this.Canvas.lineTo(I-1,L(S))):(this.Canvas.moveTo(g,L(S)),this.Canvas.lineTo(I,L(S))):D.High==D.Low?(this.Canvas.moveTo(L(S),g),this.Canvas.lineTo(L(S),I+1)):(this.Canvas.moveTo(L(S),g),this.Canvas.lineTo(L(S),I));{var A=Math.min(I,g,E,F),P=Math.max(I,g,E,F),p=new Ia(c,A,r,P-A);this.TooltipRect.push([f,p])}}}h==!1&&this.Canvas.stroke()},this.DrawAKLine=function(e){var a=this.ChartFrame.IsHScreen===!0,r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartBorder.GetLeft()+t/2+2;a&&(n=this.ChartBorder.GetTop()+t/2+2);var s=this.ChartBorder.GetRight();a&&(s=this.ChartBorder.GetBottom());var o=this.ChartFrame.XPointCount,l=null;this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.ShowRange.FirstOpen=e,this.DrawKRange.Start=this.Data.DataOffset,this.Canvas.strokeStyle=this.Color;for(var h=this.Data.DataOffset,u=0;h<this.Data.Data.length&&u<o;++h,++u,n+=r+t,++this.ShowRange.DataCount){var f=this.Data.Data[h];if(!(f.Open==null||f.High==null||f.Low==null||f.Close==null)){l==null&&(l=f.Open,this.ShowRange.FirstOverlayOpen=f.Open);var C=n,D=n+r;if(D>s)break;var c=C+(D-C)/2,T=this.GetYFromData(f.Low/l*e,!1),S=this.GetYFromData(f.High/l*e,!1),I=this.GetYFromData(f.Open/l*e,!1),g=this.GetYFromData(f.Close/l*e,!1);this.DrawKRange.End=h,this.Canvas.beginPath(),a?(this.Canvas.moveTo(S,L(c)),this.Canvas.lineTo(T,L(c))):(this.Canvas.moveTo(L(c),S),this.Canvas.lineTo(L(c),T)),this.Canvas.stroke(),r>=4&&(this.Canvas.beginPath(),a?(this.Canvas.moveTo(L(I),C),this.Canvas.lineTo(L(I),c)):(this.Canvas.moveTo(C,L(I)),this.Canvas.lineTo(c,L(I))),this.Canvas.stroke(),this.Canvas.beginPath(),a?(this.Canvas.moveTo(L(g),D),this.Canvas.lineTo(L(g),c)):(this.Canvas.moveTo(D,L(g)),this.Canvas.lineTo(c,L(g))),this.Canvas.stroke())}}},this.DrawCloseLine=function(e){var a=this.ChartFrame.IsHScreen===!0,r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartBorder.GetLeft()+t/2+2;a&&(n=this.ChartBorder.GetTop()+t/2+2);var s=this.ChartBorder.GetRight();a&&(s=this.ChartBorder.GetBottom());var o=this.ChartFrame.XPointCount,l=null,h=!0;this.Canvas.strokeStyle=this.Color,v.IsNumber(this.CloseLineWidth)&&(this.Canvas.lineWidth=this.CloseLineWidth),this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.ShowRange.FirstOpen=e,this.DrawKRange.Start=this.Data.DataOffset,this.Canvas.beginPath();for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<o;++u,++f,n+=r+t,++this.ShowRange.DataCount){var C=this.Data.Data[u];if(!(C.Open==null||C.High==null||C.Low==null||C.Close==null)){l==null&&(l=C.Open,this.ShowRange.FirstOverlayOpen=C.Open);var D=n,c=n+r;if(c>s)break;var T=D+(c-D)/2,S=this.GetYFromData(C.Close/l*e,!1);this.DrawKRange.End=u,h?(a?this.Canvas.moveTo(S,T):this.Canvas.moveTo(T,S),h=!1):a?this.Canvas.lineTo(S,T):this.Canvas.lineTo(T,S)}}h==!1&&this.Canvas.stroke()},this.GetFirstOpen=function(){if(!this.MainData||!this.Data)return null;for(var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,r=0;a<this.MainData.Data.length&&r<e;++a,++r){var t=this.MainData.Data[a];if(!(t.Open==null||t.High==null||t.Low==null||t.Close==null))return t.Open}return null},this.Draw=function(){if(this.TooltipRect=[],this.InfoTooltipRect=[],this.DrawKRange={Start:null,End:null},!(!this.MainData||!this.Data)){this.ChartFrame.XPointCount;var e=this.GetFirstOpen();if(e!=null){var a=this.DrawType;this.CustomDrawType!=null&&(a=this.CustomDrawType),this.Canvas.save(),this.ClipClient(this.ChartFrame.IsHScreen),a==1?this.DrawCloseLine(e):a==2?this.DrawAKLine(e):this.DrawKBar(e),this.Canvas.restore()}}},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a={};if(a.Max=null,a.Min=null,!this.MainData||!this.Data)return a;for(var r=null,t=this.Data.DataOffset,n=0;t<this.MainData.Data.length&&n<e;++t,++n){var s=this.MainData.Data[t];if(!(s.Open==null||s.High==null||s.Low==null||s.Close==null)){r=s.Close;break}}if(r==null)return a;for(var o=null,l,h,t=this.Data.DataOffset,n=0;t<this.Data.Data.length&&n<e;++t,++n){var s=this.Data.Data[t];!s||s.Open==null||s.High==null||s.Low==null||s.Close==null||(o==null&&(o=s.Open),l=s.High/o*r,h=s.Low/o*r,a.Max==null&&(a.Max=l),a.Min==null&&(a.Min=h),a.Max<l&&(a.Max=l),a.Min>h&&(a.Min=h))}return a},this.GetTooltipData=function(e,a,r){for(var t in this.TooltipRect){var n=this.TooltipRect[t][1];if(this.Canvas.beginPath(),this.Canvas.rect(n.X,n.Y,n.Width,n.Height),this.Canvas.isPointInPath(e,a)){var s=this.TooltipRect[t][0];return r.Data=this.Data.Data[s],r.ChartPaint=this,!0}}return!1},this.PtInChart=function(e,a){var r=this.DrawType;return v.IsNumber(this.CustomDrawType)&&(r=this.CustomDrawType),r==1||r==4?null:this.PtInKBar(e,a,{OverlayKLine:!0})},this.DrawSelectedStatus=function(){this.DrawLinePoint({OverlayKLine:!0})}}function yd(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartKlineTable",this.Data,this.RowName,this.IsShowRowName=!1,this.BGColor,this.RowCount=5,this.RowHeight=10,this.TextFontConfig=At(d.ChartKLineTable.TextFont),this.ItemMergin=At(d.ChartKLineTable.ItemMergin),this.TextFont,this.TextColor="rgb(0,0,0)",this.NameColor="rgb(0,0,0)",this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){var e=this.ChartFrame.IsHScreen===!0;if(!e&&!(this.RowCount<=0)){var a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount,n=this.ChartFrame.GetBorder(),s=n.Bottom-n.TopTitle;this.RowHeight=s/this.RowCount;var o=n.LeftEx+d.FrameLeftMargin,l=n.RightEx,h=n.TopTitle,u=n.Bottom;if(this.BGColor){this.Canvas.fillStyle=this.BGColor;var f=n.LeftEx,C=n.RightEx-n.LeftEx,s=u-h;this.Canvas.fillRect(f,h,C,s)}var D=this.RowHeight,c=a+r;D-this.ItemMergin.Top-this.ItemMergin.Bottom>0&&(D=D-this.ItemMergin.Left-this.ItemMergin.Right),c-this.ItemMergin.Left-this.ItemMergin.Right>0&&(c=c-this.ItemMergin.Left-this.ItemMergin.Right);var T=this.GetDynamicTextFont(D,c);this.TextFont=T,this.Canvas.font=this.TextFont;for(var S=this.Data.DataOffset,I=0;S<this.Data.Data.length&&I<t;++S,++I,o+=a+r){var g=this.Data.Data[S];if(g){var f=o,E=o+a+r;if(E>l)break;var F=f+(E-f)/2;if(F>l)break;I==0&&this.IsShowRowName?this.DrawRowName(h,u,f,E):this.DrawRow(g,h,u,f,E)}}}}}},this.DrawRowName=function(e,a,r,t){if(v.IsNonEmptyArray(this.RowName))for(var n=r,s=e,o=t-r,l=0;l<this.RowName.length;++l){var h=this.RowName[l],u={Left:n,Top:s,Right:t,Height:this.RowHeight,Width:o};u.Bottom=u.Top+this.RowHeight,h.Name&&u.Width>10&&(this.Canvas.fillStyle=h.Color?h.Color:this.TextColor,this.Canvas.textBaseline="middle",h.TextAlign=="right"?(this.Canvas.textAlign="right",this.Canvas.fillText(h.Name,u.Right-2,u.Top+this.RowHeight/2,o-4)):h.TextAlign=="center"?(this.Canvas.textAlign="center",this.Canvas.fillText(h.Name,u.Left+u.Width/2,u.Top+this.RowHeight/2,o-4)):(this.Canvas.textAlign="left",this.Canvas.fillText(h.Name,u.Left+2,u.Top+this.RowHeight/2,o-4))),s+=this.RowHeight}},this.DrawRow=function(e,a,r,t,n){for(var s=t,o=a,l=n-t,h=0;h<e.length;++h){var u=e[h],f={Left:s,Top:o,Right:n,Height:this.RowHeight,Width:l};f.Bottom=f.Top+this.RowHeight,u.BGColor&&(this.Canvas.fillStyle=u.BGColor,this.Canvas.fillRect(f.Left,f.Top,f.Width,f.Height)),u.Color&&f.Width>10&&(this.Canvas.fillStyle=u.Color,this.Canvas.textBaseline="middle",u.TextAlign=="right"?(this.Canvas.textAlign="right",this.Canvas.fillText(u.Text,f.Right-2,f.Top+this.RowHeight/2,l-4)):u.TextAlign=="center"?(this.Canvas.textAlign="center",this.Canvas.fillText(u.Text,f.Left+f.Width/2,f.Top+this.RowHeight/2,l-4)):(this.Canvas.textAlign="left",this.Canvas.fillText(u.Text,f.Left+2,f.Top+this.RowHeight/2,l-4))),o+=this.RowHeight}},this.GetDynamicTextFont=function(e,a,r){var t=parseInt(e)-2;e<5&&(t=parseInt(e)),t>this.TextFontConfig.FontMaxSize?t=this.TextFontConfig.FontMaxSize:t<=0&&(t=1);var n=this.FormatFontString(t,this.TextFontConfig.Family,r);return n},this.FormatFontString=function(e,a,r){var t;return r?r.Weight&&(t=r.Weight+" "+e+"px "+a):t=e+"px "+a,t},this.GetMaxMin=function(){return{Min:0,Max:this.RowCount}}}function PC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinuteVolumBar",this.UpColor=d.UpBarColor,this.DownColor=d.DownBarColor,this.UnchangeColor=d.UnchagneBarColor,this.BarColorType=1,this.CustomColor=d.Minute.VolBarColor,this.YClose,this.Symbol,this.BeforeOpenData,this.AfterCloseData,this.BeforeVolColor=d.Minute.Before.VolColor,this.ShareAfterVol=0,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.PtInChart=function(e,a){var r={MinuteVolBar:!0};return this.PtInBar(e,a,r)},this.DrawSelectedStatus=function(){return this.DrawLinePoint({MinuteVolBar:!0})},this.GetVolUnit=function(){var e=this.Symbol?this.Symbol.toUpperCase():null,a=U.GetVolUnit(e);return a},this.Draw=function(){var e=this.ChartFrame.IsHScreen===!0;if(e)var a=this.ChartBorder.GetHScreenBorder(),r=a.BottomEx;else var a=this.ChartBorder.GetBorder(),r=a.RightEx;this.DrawBeforeOpen(),this.DrawMultiDayBeforeOpen();var t=this.ChartFrame.XPointCount,n=this.ChartFrame.GetYFromData(0),s=this.YClose,o=this.Data,l=U.IsShowMinuteColorVolBar(this.Symbol);l&&(this.Canvas.strokeStyle=this.CustomColor);for(var h=this.GetVolUnit(),u=o.DataOffset,f=0;u<o.Data.length&&f<t;++u,++f){var C=o.Data[u],D=null;if(C){var c=null;if(D=C.Vol/h,c=C.Close,!!D){var T=this.ChartFrame.GetYFromData(D),S=this.ChartFrame.GetXFromIndex(f);if(S>r)break;l||(this.Canvas.strokeStyle=this.GetMinuteBarColor(c,s)),this.Canvas.beginPath(),e?(this.Canvas.moveTo(T,L(S)),this.Canvas.lineTo(n,L(S))):(this.Canvas.moveTo(L(S),T),this.Canvas.lineTo(L(S),n)),this.Canvas.stroke(),c&&(s=c)}}}this.DrawAfterClose(),this.DrawMultiDayAfterClose()},this.GetMinuteBarColor=function(e,a){return this.BarColorType==1?e>a?this.UpColor:e<a?this.DownColor:this.UnchangeColor:e>=a?this.UpColor:this.DownColor},this.DrawBeforeOpen=function(){this.ChartBorder.LeftExtendWidth<10||this.BeforeOpenData&&this.DrawCallAuction(-1,this.BeforeOpenData,!0)},this.DrawAfterClose=function(){this.ChartBorder.RightExtendWidth<10||this.AfterCloseData&&this.DrawCallAuction(-1,this.AfterCloseData,!1)},this.DrawMultiDayBeforeOpen=function(){if(!(this.ChartBorder.MultiDayMinute.Count<=1||this.ChartBorder.MultiDayMinute.Left<=0)&&this.MultiDayBeforeOpenData){var e=0,a=this.MultiDayBeforeOpenData.length;this.DayOffset&&(v.IsNumber(this.DayOffset.Offset)&&(e=this.DayOffset.Offset),v.IsNumber(this.DayOffset.ShowDayCount)&&(a=this.DayOffset.ShowDayCount));for(var r=e,t=0;r<this.MultiDayBeforeOpenData.length&&t<a;++r,++t){var n=this.MultiDayBeforeOpenData[r];this.DrawCallAuction(t,n,!0)}}},this.DrawMultiDayAfterClose=function(){if(!(this.ChartBorder.MultiDayMinute.Count<=1||this.ChartBorder.MultiDayMinute.Right<=0)&&this.MultiDayAfterCloseData){var e=0,a=this.MultiDayAfterCloseData.length;this.DayOffset&&(v.IsNumber(this.DayOffset.Offset)&&(e=this.DayOffset.Offset),v.IsNumber(this.DayOffset.ShowDayCount)&&(a=this.DayOffset.ShowDayCount));for(var r=e,t=0;r<this.MultiDayAfterCloseData.length&&t<a;++r,++t){var n=this.MultiDayAfterCloseData[r];this.DrawCallAuction(t,n,!1)}}},this.DrawCallAuction=function(e,a,r){if(a){a.Index=e;var t=this.GetBorder(),n=this.ChartFrame.IsHScreen===!0,s=this.YClose,o=this.ChartFrame.GetYFromData(0),l=this.GetVolUnit();if(a.Ver==1)for(var h in a.Data){var u=a.Data[h];if(!(!u||!v.IsNumber(u.Vol[0]))){if(r)var f=this.ChartFrame.GetLeftExtendXFromIndex(h,a),C=this.ChartFrame.GetLeftExtendYFromData(u.Vol[0]/l);else var f=this.ChartFrame.GetRightExtendXFromIndex(h,a),C=this.ChartFrame.GetRightExtendYFromData(u.Vol[0]/l);this.Canvas.strokeStyle=u.Price>=s?this.UpColor:this.DownColor,this.Canvas.beginPath(),n?(this.Canvas.moveTo(C,L(f)),this.Canvas.lineTo(o,L(f))):(this.Canvas.moveTo(L(f),C),this.Canvas.lineTo(L(f),o)),this.Canvas.stroke(),u.Price&&(s=u.Price)}}else if(a.Ver==2||a.Ver==3){var D={Max:a.VolMax,Min:a.VolMin};for(var h in a.Data){var u=a.Data[h];if(u){if(v.IsPlusNumber(u.Vol[0])){if(r)var f=this.ChartFrame.GetLeftExtendXFromIndex(h,a),C=this.ChartFrame.GetLeftExtendYFromData(u.Vol[0]/l,!1,{Range:D});else{var f=this.ChartFrame.GetRightExtendXFromIndex(h,a);if(this.ShareAfterVol==1)var C=this.ChartFrame.GetYFromData(u.Vol[0]/l);else var C=this.ChartFrame.GetRightExtendYFromData(u.Vol[0]/l,!1,{Range:D})}this.Canvas.strokeStyle=this.GetBarColor(u.ColorID),this.Canvas.beginPath(),n?(this.Canvas.moveTo(C,L(f)),this.Canvas.lineTo(o,L(f))):(this.Canvas.moveTo(L(f),C),this.Canvas.lineTo(L(f),o)),this.Canvas.stroke()}if(v.IsPlusNumber(u.Vol[1])){if(r)var f=this.ChartFrame.GetLeftExtendXFromIndex(h,a),C=this.ChartFrame.GetLeftExtendYFromData(u.Vol[1]/l,!1,{Range:D});else{var f=this.ChartFrame.GetRightExtendXFromIndex(h,a);if(this.ShareAfterVol==1)var C=this.ChartFrame.GetYFromData(u.Vol[1]/l);else var C=this.ChartFrame.GetRightExtendYFromData(u.Vol[1]/l,!1,{Range:D})}this.Canvas.strokeStyle=this.GetBarColor(u.ColorID),this.Canvas.beginPath(),n?(C-=o,C=t.RightEx-C,this.Canvas.moveTo(C,L(f)),this.Canvas.lineTo(t.RightEx,L(f))):(C-=o,C=t.TopEx-C,this.Canvas.moveTo(L(f),C),this.Canvas.lineTo(L(f),t.TopEx)),this.Canvas.stroke()}}}}}},this.GetBarColor=function(e){switch(e){case 0:return this.UnchangeColor;case 1:return this.UpColor;case 2:return this.DownColor}if(this.BeforeVolColor&&Array.isArray(this.BeforeVolColor)){var a=e-3;if(a>=0&&a<this.BeforeVolColor.length)return this.BeforeVolColor[a]}return this.UnchangeColor},this.GetMaxMin=function(){var e=this.GetVolUnit(),a=this.ChartFrame.XPointCount,r=this.Data.DataOffset;this.ChartFrame.GlobalOption&&this.ChartFrame.GlobalOption.IsValueFullRange===!0&&(a=this.Data.Data.length,r=0);var t={};t.Min=0,t.Max=null;for(var n=r,s=0;n<this.Data.Data.length&&s<a;++n,++s){var o=this.Data.Data[n];if(!(!o||!o.Vol)){var l=o.Vol/e;(t.Max==null||t.Max<l)&&(t.Max=l)}}return this.ShareAfterVol==1&&(this.GetAfterCloseMaxMin(t),this.GetMultiDayAfterCloseMaxMin(t)),t},this.GetAfterCloseMaxMin=function(e){if(!(this.ChartBorder.RightExtendWidth<10)&&this.AfterCloseData){var a=this.AfterCloseData;(e.Max==null||e.Max<a.VolMax)&&(e.Max=a.VolMax)}},this.GetMultiDayAfterCloseMaxMin=function(e){if(!(this.ChartBorder.MultiDayMinute.Count<=1||this.ChartBorder.MultiDayMinute.Right<=0)&&this.MultiDayAfterCloseData)for(var a=0;a<this.MultiDayAfterCloseData.length;++a){var r=this.MultiDayAfterCloseData[a];(r.Ver==2||r.Ver==3)&&(e.Max==null||e.Max<r.VolMax)&&(e.Max=r.VolMax)}}}function Od(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartErrorMessage",this.Draw=function(){this.IsShow&&this.NotSupportMessage&&this.DrawNotSupportmessage()}}function va(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartLine",this.Color="rgb(255,193,37)",this.LineWidth,this.DrawType=0,this.IsDotLine=!1,this.LineDash=d.DOTLINE.LineDash,this.BreakPoint,this.DrawSelectedStatus=this.DrawLinePoint,this.PtInChart=this.PtInLine,this.ExportData=this.ExportArrayData,this.GetItemData=this.GetArrayItemData,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data))switch(this.DrawType){case 0:return this.DrawLine();case 1:return this.DrawStraightLine();case 2:return this.DrawSectionLine()}}},this.DrawLine=function(){var e=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth;var a=this.ChartBorder.GetRight();e&&(a=this.ChartBorder.GetBottom());var r=this.ChartFrame.XPointCount;this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*B()),this.IsDotLine&&this.Canvas.setLineDash(this.LineDash);for(var t=!0,n=0,s=this.Data.DataOffset,o=0;s<this.Data.Data.length&&o<r;++s,++o){var l=this.Data.Data[s];if(l!=null){var h=this.ChartFrame.GetXFromIndex(o),u=this.GetYFromData(l);if(h>a)break;t?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),e?this.Canvas.moveTo(u,h):this.Canvas.moveTo(h,u),t=!1):e?this.Canvas.lineTo(u,h):this.Canvas.lineTo(h,u),++n}}n>0&&this.Canvas.stroke(),this.Canvas.restore()},this.DrawStraightLine=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.IsMinuteFrame(),r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartFrame.XPointCount;if(e)var s=this.ChartBorder.GetHScreenBorder(),o=s.BottomEx,l=s.TopEx+t/2+d.FrameLeftMargin;else var s=this.ChartBorder.GetBorder(),l=s.LeftEx+t/2+d.FrameLeftMargin,o=s.RightEx;var h=this.GetLockRect();h&&(e?o=h.Top:o=h.Left),this.Canvas.save(),this.ClipClient(e),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*B()),this.Canvas.strokeStyle=this.Color,this.IsDotLine&&this.Canvas.setLineDash(this.LineDash);for(var u=!0,f=null,C=0,D=this.Data.DataOffset,c=0;D<this.Data.Data.length&&c<n;++D,++c,l+=r+t){var T=this.Data.Data[D];if(T==null){C>0&&this.Canvas.stroke(),u=!0,C=0,f=null;continue}if(a)var S=this.ChartFrame.GetXFromIndex(c);else{var I=l,g=l+r;if(g>o)break;var S=I+(g-I)/2}var E=this.GetYFromData(T,!1);if(S>o)break;u?(this.Canvas.beginPath(),e?this.Canvas.moveTo(E,S):this.Canvas.moveTo(S,E),u=!1,f={X:S,Y:E}):e?this.Canvas.lineTo(E,S):this.Canvas.lineTo(S,E),++C}C>0&&(C==1&&f&&(e?this.Canvas.lineTo(f.Y,f.X+1*B()):this.Canvas.lineTo(f.X+1*B(),f.Y)),this.Canvas.stroke()),this.Canvas.restore()},this.DrawSectionLine=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.IsMinuteFrame(),r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartFrame.XPointCount;if(e)var s=this.ChartBorder.GetHScreenBorder(),o=s.BottomEx,l=s.TopEx+t/2+d.FrameLeftMargin;else var s=this.ChartBorder.GetBorder(),l=s.LeftEx+t/2+d.FrameLeftMargin,o=s.RightEx;var h=this.GetLockRect();h&&(e?o=h.Top:o=h.Left),this.Canvas.save(),this.ClipClient(e),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*B()),this.Canvas.strokeStyle=this.Color,this.IsDotLine&&this.Canvas.setLineDash(this.LineDash);for(var u=!0,f=null,C=0,D=this.Data.DataOffset,c=0;D<this.Data.Data.length&&c<n;++D,++c,l+=r+t){var T=this.Data.Data[D];if(T==null){C>0&&this.Canvas.stroke(),u=!0,C=0,f=null;continue}if(a)var S=this.ChartFrame.GetXFromIndex(c);else{var I=l,g=l+r;if(g>o)break;var S=I+(g-I)/2}var E=this.GetYFromData(T,!1);if(S>o)break;this.BreakPoint&&this.BreakPoint.has(D)&&(C>0&&this.Canvas.stroke(),u=!0,C=0,f=null),u?(this.Canvas.beginPath(),e?this.Canvas.moveTo(E,S):this.Canvas.moveTo(S,E),u=!1,f={X:S,Y:E}):e?this.Canvas.lineTo(E,S):this.Canvas.lineTo(S,E),++C}C>0&&(C==1&&f&&(e?this.Canvas.lineTo(f.Y,f.X+1*B()):this.Canvas.lineTo(f.X+1*B(),f.Y)),this.Canvas.stroke()),this.Canvas.restore()}}function Pd(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartArea",this.Color="rgb(255,193,37)",this.AreaColor,this.LineWidth,this.LineDash,this.AreaDirection=0,this.DrawSelectedStatus=this.DrawLinePoint,this.PtInChart=this.PtInLine,this.ExportData=this.ExportArrayData,this.GetItemData=this.GetArrayItemData,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}!this.Data||!this.Data.Data||this.DrawArea()}},this.DrawArea=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.IsMinuteFrame(),r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartFrame.XPointCount;if(e)var s=this.ChartBorder.GetHScreenBorder(),o=s.BottomEx,l=s.TopEx+t/2+d.FrameLeftMargin;else var s=this.ChartBorder.GetBorder(),l=s.LeftEx+t/2+d.FrameLeftMargin,o=s.RightEx;var h=this.GetLockRect();h&&(e?o=h.Top:o=h.Left),this.Canvas.save(),this.ClipClient(e),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*B()),this.Canvas.strokeStyle=this.Color,this.AreaColor?this.Canvas.fillStyle=this.AreaColor:this.Canvas.fillStyle=gt.ColorToRGBA(this.Color,.6),v.IsNonEmptyArray(this.LineDash)&&this.Canvas.setLineDash(this.LineDas);for(var u=!0,f=null,C=null,D=0,c=this.Data.DataOffset,T=0;c<this.Data.Data.length&&T<n;++c,++T,l+=r+t){var S=this.Data.Data[c];if(!v.IsNumber(S)){D>0&&this.Canvas.stroke(),f&&C&&(e?(this.AreaDirection==1?(this.Canvas.lineTo(s.RightEx,C.X),this.Canvas.lineTo(s.RightEx,f.X)):(this.Canvas.lineTo(s.LeftEx,C.X),this.Canvas.lineTo(s.LeftEx,f.X)),this.Canvas.closePath(),this.Canvas.fill()):(this.AreaDirection==1?(this.Canvas.lineTo(C.X,s.TopEx),this.Canvas.lineTo(f.X,s.TopEx)):(this.Canvas.lineTo(C.X,s.BottomEx),this.Canvas.lineTo(f.X,s.BottomEx)),this.Canvas.closePath(),this.Canvas.fill())),u=!0,D=0,f=null,C=null;continue}if(a)var I=this.ChartFrame.GetXFromIndex(T);else{var g=l,E=l+r;if(E>o)break;var I=g+(E-g)/2}var F=this.GetYFromData(S,!1);if(I>o)break;u?(this.Canvas.beginPath(),e?this.Canvas.moveTo(F,I):this.Canvas.moveTo(I,F),u=!1,f={X:I,Y:F}):(e?this.Canvas.lineTo(F,I):this.Canvas.lineTo(I,F),C={X:I,Y:F}),++D}D>0&&(D==1&&f&&(e?this.Canvas.lineTo(f.Y,f.X+1*B()):this.Canvas.lineTo(f.X+1*B(),f.Y)),this.Canvas.stroke(),f&&C&&(e?(this.AreaDirection==1?(this.Canvas.lineTo(s.RightEx,C.X),this.Canvas.lineTo(s.RightEx,f.X)):(this.Canvas.lineTo(s.LeftEx,C.X),this.Canvas.lineTo(s.LeftEx,f.X)),this.Canvas.closePath(),this.Canvas.fill()):(this.AreaDirection==1?(this.Canvas.lineTo(C.X,s.TopEx),this.Canvas.lineTo(f.X,s.TopEx)):(this.Canvas.lineTo(C.X,s.BottomEx),this.Canvas.lineTo(f.X,s.BottomEx)),this.Canvas.closePath(),this.Canvas.fill()))),this.Canvas.restore()}}function Bd(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartScatterPlot",this.Color="rgb(255,193,37)",this.Radius=3,this.TooltipData=[],this.Draw=function(){if(this.TooltipData=[],!(!this.IsShow||this.ChartFrame.IsMinSize)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}!this.Data||!this.Data.Data||this.DrawScatterPlot()}},this.DrawScatterPlot=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.IsMinuteFrame(),r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartFrame.XPointCount;if(e)var s=this.ChartBorder.GetHScreenBorder(),o=s.BottomEx,l=s.TopEx+t/2+d.FrameLeftMargin;else var s=this.ChartBorder.GetBorder(),l=s.LeftEx+t/2+d.FrameLeftMargin,o=s.RightEx;var h=this.GetLockRect();h&&(e?o=h.Top:o=h.Left),this.Canvas.save(),this.ClipClient(e);for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<n;++u,++f,l+=r+t){var C=this.Data.Data[u];if(C){if(a)var D=this.ChartFrame.GetXFromIndex(f);else{var c=l,T=l+r;if(T>o)break;var D=c+(T-c)/2}if(D>o)break;if(Array.isArray(C))for(var f=0;f<C.length;++f)this.DrawItem(C[f],D);else this.DrawItem(C,D)}}this.Canvas.restore()},this.DrawItem=function(e,a){if(e&&v.IsNumber(e.Value)){var r=this.GetYFromData(e.Value,!1),t=this.Radius;if(e.Radius&&(t=e.Radius),!!v.IsNumber(t)){this.Canvas.beginPath(),this.Canvas.arc(a,r,t,0,2*Math.PI);var n=this.Color;e.Color&&(n=e.Color),n&&(this.Canvas.fillStyle=n,this.Canvas.fill()),e.ColorBorder&&(this.Canvas.strokeStyle=e.ColorBorder,this.Canvas.stroke());var s={X:a,Y:r,Radius:t,Data:e};this.TooltipData.push(s)}}},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset;this.ChartFrame.GlobalOption&&this.ChartFrame.GlobalOption.IsValueFullRange&&(a=0,e=this.Data.Data.length);var r={};if(r.Min=null,r.Max=null,!this.Data||!this.Data.Data)return r;for(var t=a,n=0;t<this.Data.Data.length&&n<e;++t,++n){var s=this.Data.Data[t];if(s)if(Array.isArray(s))for(var o=0;o<s.length;++o){var l=s[o];v.IsNumber(l.Value)&&(r.Max==null&&(r.Max=l.Value),r.Min==null&&(r.Min=l.Value),r.Max<l.Value&&(r.Max=l.Value),r.Min>l.Value&&(r.Min=l.Value))}else{if(!v.IsNumber(s.Value))continue;r.Max==null&&(r.Max=s.Value),r.Min==null&&(r.Min=s.Value),r.Max<s.Value&&(r.Max=s.Value),r.Min>s.Value&&(r.Min=s.Value)}}return r},this.GetTooltipData=function(e,a,r){if(!this.IsShow||!v.IsNonEmptyArray(this.TooltipData))return!1;for(var t=this.TooltipData.length-1;t>=0;--t){var n=this.TooltipData[t];if(this.Canvas.beginPath(),this.Canvas.arc(n.X,n.Y,n.Radius,0,2*Math.PI),this.Canvas.isPointInPath(e,a))return k.Chart.Log("[ChartScatterPlot::GetTooltipData] point",n),r.Data=n,r.ChartPaint=this,r.Type=6,!0}}}function BC(){this.newMethod=va,this.newMethod(),delete this.newMethod,this.ClassName="ChartSubLine",this.Color="rgb(255,193,37)",this.LineWidth,this.DrawType=0,this.IsDotLine=!1,this.SubFrame={Max:null,Min:null},this.Draw=function(){if(this.IsShow&&!(!this.Data||!this.Data.Data))switch(this.CalculateDataMaxMin(),this.DrawType){case 0:return this.DrawLine();case 1:return this.DrawStraightLine()}},this.GetYFromData=function(e){var a=this.ChartFrame.IsHScreen===!0;if(a){if(e<=this.SubFrame.Min)return this.ChartBorder.GetLeftEx();if(e>=this.SubFrame.Max)return this.ChartBorder.GetRightEx();var r=this.ChartBorder.GetWidthEx()*(e-this.SubFrame.Min)/(this.SubFrame.Max-this.SubFrame.Min);return this.ChartBorder.GetLeftEx()+r}else{if(e<=this.SubFrame.Min)return this.ChartBorder.GetBottomEx();if(e>=this.SubFrame.Max)return this.ChartBorder.GetTopEx();var t=this.ChartBorder.GetHeightEx()*(e-this.SubFrame.Min)/(this.SubFrame.Max-this.SubFrame.Min);return this.ChartBorder.GetBottomEx()-t}},this.CalculateDataMaxMin=function(){this.SubFrame={Max:null,Min:null};var e=this.ChartFrame.IsHScreen===!0,a=this.ChartBorder.GetRight();e&&(a=this.ChartBorder.GetBottom());for(var r=this.ChartFrame.XPointCount,t=this.Data.DataOffset,n=0;t<this.Data.Data.length&&n<r;++t,++n){var s=this.Data.Data[t];if(s!=null){var o=this.ChartFrame.GetXFromIndex(n);if(o>a)break;(this.SubFrame.Min==null||this.SubFrame.Min>s)&&(this.SubFrame.Min=s),(this.SubFrame.Max==null||this.SubFrame.Max<s)&&(this.SubFrame.Max=s)}}},this.GetMaxMin=function(){var e={Min:null,Max:null};return e}}function bd(){this.newMethod=va,this.newMethod(),delete this.newMethod,this.MainData=new Y,this.Draw=function(){if(!(!this.Data||!this.Data.Data)&&!(!this.MainData||!this.MainData.Data))switch(this.DrawType){case 0:return this.DrawLine();case 1:return this.DrawStraightLine()}},this.GetFirstVaildIndex=function(){for(var e=this.Data.DataOffset,a=e,r=0;a<this.MainData.Data.length&&a<this.Data.Data.length;++a,++r){var t=this.MainData.Data[a],n=this.Data.Data[a];if(v.IsNumber(t)&&v.IsNumber(n))return{Index:r,DataOffset:a,OverlayValue:n,MainValue:t}}return null},this.DrawStraightLine=function(){var e=this.GetFirstVaildIndex();if(e){var a=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth;var r=this.ChartBorder.GetRight();a&&(r=this.ChartBorder.GetBottom());var t=this.ChartFrame.XPointCount,n=this.GetLockRect();n&&(a?r=n.Top:r=n.Left),this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*B()),this.Canvas.strokeStyle=this.Color,this.IsDotLine&&this.Canvas.setLineDash([3,5]);for(var s=!0,o=0,l=0,h=e.DataOffset,u=e.Index;h<this.Data.Data.length&&u<t;++h,++u){var f=this.Data.Data[h];if(f==null){o>0&&this.Canvas.stroke(),s=!0,o=0;continue}var C=this.ChartFrame.GetXFromIndex(u),D=f-e.OverlayValue;e.OverlayValue!=0?l=1+D/Math.abs(e.OverlayValue):l=1+D;var c=e.MainValue*l,T=this.GetYFromData(c);if(C>r)break;s?(this.Canvas.beginPath(),a?this.Canvas.moveTo(T,C):this.Canvas.moveTo(C,T),s=!1):a?this.Canvas.lineTo(T,C):this.Canvas.lineTo(C,T),++o}o>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a={};a.Min=null,a.Max=null;var r=this.GetFirstVaildIndex();if(!r)return a;for(var t=r.DataOffset,n=r.Index;t<this.Data.Data.length&&n<e;++t,++n){var s=this.Data.Data[t];if(v.IsNumber(s)){var o=s-r.OverlayValue;r.OverlayValue!=0?rate=1+o/Math.abs(r.OverlayValue):rate=1+o;var l=r.MainValue*rate;a.Max==null&&(a.Max=l),a.Min==null&&(a.Min=l),a.Max<l&&(a.Max=l),a.Min>l&&(a.Min=l)}}return a}}function wd(){this.newMethod=va,this.newMethod(),delete this.newMethod,this.ClassName="ChartSingleLine",this.MaxMin=null,this.Draw=function(){if(this.MaxMin=null,!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()&&!(!this.Data||!this.Data.Data)&&(this.MaxMin=this.GetCurrentMaxMin(),!!this.MaxMin&&!(!v.IsNumber(this.MaxMin.Max)||!v.IsNumber(this.MaxMin.Min))))switch(this.DrawType){default:return this.DrawStraightLine()}},this.GetCurrentMaxMin=function(){for(var e=this.ChartFrame.XPointCount,a={Max:null,Min:null},r=this.Data.DataOffset,t=0;r<this.Data.Data.length&&t<e;++r,++t){var n=this.Data.Data[r];v.IsNumber(n)&&(a.Max==null&&(a.Max=n),a.Min==null&&(a.Min=n),a.Max<n&&(a.Max=n),a.Min>n&&(a.Min=n))}return a},this.GetMaxMin=function(){return{Max:null,Min:null}},this.GetYFromData=function(e){var a=this.ChartFrame.IsHScreen===!0;if(a){if(e<=this.MaxMin.Min)return this.ChartBorder.GetLeftEx();if(e>=this.MaxMin.Max)return this.ChartBorder.GetRightEx();var r=this.ChartBorder.GetWidthEx()*(e-this.MaxMin.Min)/(this.MaxMin.Max-this.MaxMin.Min);return this.ChartBorder.GetLeftEx()+r}else{if(e<=this.MaxMin.Min)return this.ChartBorder.GetBottomEx();if(e>=this.MaxMin.Max)return this.ChartBorder.GetTopEx();var t=this.ChartBorder.GetHeightEx()*(e-this.MaxMin.Min)/(this.MaxMin.Max-this.MaxMin.Min);return this.ChartBorder.GetBottomEx()-t}}}function bC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartPartLine",this.LineWidth,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}!this.Data||!this.Data.Data||this.DrawLine()}},this.DrawLine=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth;if(e)var t=this.ChartBorder.GetHScreenBorder(),n=t.BottomEx,s=t.TopEx+r/2+d.FrameLeftMargin;else var t=this.ChartBorder.GetBorder(),s=t.LeftEx+r/2+d.FrameLeftMargin,n=t.RightEx;var o=this.ChartFrame.XPointCount,l=this.IsMinuteFrame();this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*B());for(var h=0,u,f={X:null,Y:null},C=!1,D=this.Data.DataOffset,c=0;D<this.Data.Data.length&&c<o;++D,++c,s+=a+r){var T=this.Data.Data[D];if(T==null||T.Value==null){f.X=null,f.Y=null,C=!0;continue}if(l)var S=this.ChartFrame.GetXFromIndex(c);else{var I=s,g=s+a;if(g>n)break;var S=I+(g-I)/2}var E=T.Value,F=T.RGB,R=this.ChartFrame.GetYFromData(E);if(S>n)break;F!=u||C==!0?(u&&h>0&&this.Canvas.stroke(),h=0,u=F,this.Canvas.strokeStyle=F,this.Canvas.beginPath(),f.X!=null&&f.Y!=null?(e?this.Canvas.moveTo(f.Y,f.X):this.Canvas.moveTo(f.X,f.Y),e?this.Canvas.lineTo(R,S):this.Canvas.lineTo(S,R),++h):e?this.Canvas.moveTo(R,S):this.Canvas.moveTo(S,R)):(e?this.Canvas.lineTo(R,S):this.Canvas.lineTo(S,R),++h),f.X=S,f.Y=R,C=!1}h>0&&this.Canvas.stroke(),this.Canvas.restore()},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a={};a.Min=null,a.Max=null;for(var r=this.Data.DataOffset,t=0;r<this.Data.Data.length&&t<e;++r,++t){var n=this.Data.Data[r];!n||!n.Value||((a.Max==null||a.Max<n.Value)&&(a.Max=n.Value),(a.Min==null||a.Min>n.Value)&&(a.Min=n.Value))}return a},this.ExportData=function(e,a){var r=[],t=[];if(v.IsNonEmptyArray(this.Data.Data)){var n=0,s=this.Data.length-1;a&&a.Start&&a.End&&v.IsNumber(a.Start.Index)&&v.IsNumber(a.End.Index)&&(n=a.Start.Index,s=a.End.Index);for(var o=n;o<=s&&o<this.Data.Data.length;++o){var l=this.Data.Data[o];r[o]=null,t[o]=null,l&&v.IsNumber(l.Value)&&(r[o]=l.Value,t[o]=l.RGB)}}return[{Name:this.Name+"-Value",Data:r},{Name:this.Name+"-Color",Data:t}]}}function fh(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartStepLine",this.LineWidth=1,this.DotLine,this.IsHScreen,this.IsDotLine=!1,this.PtInChart=function(e,a){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){var r=this.ChartFrame.IsHScreen===!0;if(!r){var t=this.IsMinuteFrame(),n=this.ChartFrame.DataWidth,s=this.ChartFrame.DistanceWidth,o=this.ChartFrame.XPointCount,l=this.GetLockRect();if(r){var h=this.ChartBorder.GetHScreenBorder(),u=h.BottomEx,f=h.TopEx+s/2+d.FrameLeftMargin;l&&(u=l.Top)}else{var h=this.ChartBorder.GetBorder(),f=h.LeftEx+s/2+d.FrameLeftMargin,u=h.RightEx;l&&(u=l.Left)}if(e<f||e>u||a>h.BottomEx||a<h.TopEx)return null;for(var C={},D={},c=this.Data.DataOffset;c>=0;--c){var T=this.Data.Data[c];if(v.IsNumber(T)){var S=this.GetYFromData(T,!1),I=null;t?I=this.ChartFrame.GetXFromIndex(0):I=f,C.Y=S,C.X=I}}for(var c=this.Data.DataOffset,g=0;c<this.Data.Data.length&&g<o;++c,++g,f+=n+s){var T=this.Data.Data[c];if(v.IsNumber(T)){if(t)var E=this.ChartFrame.GetXFromIndex(g);else{var F=f,R=f+n;if(R>u)break;var E=F+(R-F)/2}var A=this.GetYFromData(T,!1);if(E<e)C.X=E,C.Y=A;else if(E==e){C.X=D.X=E,C.Y=D.Y=A;break}else{D.X=E,D.Y=A;break}if(e>u)break}}return!v.IsNumber(C.X)||!v.IsNumber(C.Y)||!v.IsNumber(D.X)||!v.IsNumber(D.Y)?null:e==C.X||a==C.Y?{Identify:this.Identify,Chart:this}:e==D.X||a==D.Y?{Identify:this.Identify,Chart:this}:e>=C.X&&e<=D.X&&a>=C.Y-3&&a<=C.Y+3?{Identify:this.Identify,Chart:this}:e>=D.X-3&&e<=D.X+3&&a>=Math.min(C.Y,D.Y)&&a<Math.max(C.Y,D.Y)?{Identify:this.Identify,Chart:this}:null}}},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}!this.Data||!this.Data.Data||(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.Canvas.save(),this.ClipClient(this.IsHScreen),this.DrawLine(),this.Canvas.restore())}},this.DrawLine=function(){var e=this.IsMinuteFrame(),a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount,n=this.GetLockRect();if(this.IsHScreen){var s=this.ChartBorder.GetHScreenBorder(),o=s.BottomEx,l=s.TopEx+r/2+d.FrameLeftMargin;n&&(o=n.Top)}else{var s=this.ChartBorder.GetBorder(),l=s.LeftEx+r/2+d.FrameLeftMargin,o=s.RightEx;n&&(o=n.Left)}this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*B()),this.IsDotLine&&this.Canvas.setLineDash(d.DOTLINE.LineDash),this.DotLine&&this.Canvas.setLineDash(this.DotLine),this.Canvas.strokeStyle=this.Color;for(var h=!0,u=0,f={X:null,Y:null},C=this.Data.DataOffset;C>=0;--C){var D=this.Data.Data[C];if(v.IsNumber(D)){var c=this.GetYFromData(D,!1),T=null;e?T=this.ChartFrame.GetXFromIndex(0):T=l,this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(c,T):this.Canvas.moveTo(T,c),h=!1,f.Y=c,f.X=T}}for(var C=this.Data.DataOffset,S=0;C<this.Data.Data.length&&S<t;++C,++S,l+=a+r){if(e)var T=this.ChartFrame.GetXFromIndex(S);else{var I=l,g=l+a;if(g>o)break;var T=I+(g-I)/2}if(T>o)break;var D=this.Data.Data[C];if(v.IsNumber(D)){var c=this.GetYFromData(D,!1);h?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(c,T):this.Canvas.moveTo(T,c),h=!1,f.X=T,f.Y=c):(this.IsHScreen?(this.Canvas.lineTo(f.Y,T),this.Canvas.lineTo(c,T)):(this.Canvas.lineTo(T,f.Y),this.Canvas.lineTo(T,c)),f.X=T,f.Y=c),++u}}u>0&&this.Canvas.stroke()},this.DrawSelectedStatus=function(){this.DrawLinePoint()}}function Gd(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartSlopeLine",this.Color="rgb(255,193,37)",this.IsDotLine=!1,this.LineWidth,this.Option,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){this.Canvas.save(),this.Canvas.strokeStyle=this.Color,this.IsDotLine&&this.Canvas.setLineDash(d.DOTLINE.LineDash);var e=this.ChartBorder.GetLeft(),a=this.ChartBorder.GetTopEx(),r=this.ChartBorder.GetRight(),t=this.ChartBorder.GetBottom(),n=this.ChartBorder.GetRight(),s=this.ChartFrame.XPointCount;this.Canvas.beginPath(),this.Canvas.rect(e,a,r-e,t-a),this.Canvas.clip();for(var o=this.Data.DataOffset,l=0;o<this.Data.Data.length&&l<s;++o,++l){var h=this.Data.Data[o];if(v.IsNumber(h)){var u=this.Option[o];if(u){var f=this.ChartFrame.GetXFromIndex(l),C=this.ChartFrame.GetYFromData(h),D=u.Length*d.DRAWSL.PixelWidth;if(f>n)break;var c=Math.sqrt(D*D/(1+u.Slope*u.Slope)),T=c*u.Slope;this.Canvas.beginPath(),u.Direct==2?(this.Canvas.moveTo(f-c,C+T),this.Canvas.lineTo(f+c,C-T)):u.Direct==1?(this.Canvas.moveTo(f,C),this.Canvas.lineTo(f-c,C+T)):(this.Canvas.moveTo(f,C),this.Canvas.lineTo(f+c,C-T)),this.Canvas.stroke()}}}this.Canvas.restore()}}}}function wC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartPointDot",this.Color="rgb(255,193,37)",this.Radius=1,this.EnableUpDownColor=!1,this.HistoryData,this.ExportData=this.ExportArrayData,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){var e=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth;var a=this.ChartBorder.GetRight();e===!0&&(a=this.ChartBorder.GetBottom());var r=this.ChartFrame.XPointCount;this.Canvas.save(),this.ClipClient(e),this.Canvas.fillStyle=this.Color;for(var t,n=this.Data.DataOffset,s=0;n<this.Data.Data.length&&s<r;++n,++s){var o=this.Data.Data[n];if(o!=null){var l=this.ChartFrame.GetXFromIndex(s),h=this.ChartFrame.GetYFromData(o,!1);if(l>a)break;if(this.EnableUpDownColor){var u=this.HistoryData.Data[n];u.Close>o?t="rgb(255,61,61)":t="rgb(0,199,65)",this.Canvas.fillStyle=t}this.Canvas.beginPath(),e?this.Canvas.arc(h,l,this.Radius,0,Math.PI*2,!0):this.Canvas.arc(l,h,this.Radius,0,Math.PI*2,!0),this.Canvas.closePath(),this.Canvas.fill()}}this.Canvas.restore()}}}}function tl(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.Color="rgb(255,193,37)",this.LineWidth,this.ClassName="ChartStick",this.ExportData=this.ExportArrayData,this.DrawLine=function(){if(!(!this.Data||!this.Data.Data)){var e=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth;var a=this.ChartBorder.GetRight();e===!0&&(a=this.ChartBorder.GetBottom());var r=this.ChartFrame.XPointCount;this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*B());for(var t=!0,n=0,s=this.Data.DataOffset,o=0;s<this.Data.Data.length&&o<r;++s,++o){var l=this.Data.Data[s];if(l!=null){var h=this.ChartFrame.GetXFromIndex(o),u=this.ChartFrame.GetYFromData(l);if(h>a)break;t?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),e?this.Canvas.moveTo(u,h):this.Canvas.moveTo(h,u),t=!1):e?this.Canvas.lineTo(u,h):this.Canvas.lineTo(h,u),++n}}n>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.DrawStick=function(){if(!(!this.Data||!this.Data.Data)){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartBorder.GetRight();e&&(a=this.ChartBorder.GetBottom());var r=this.ChartFrame.XPointCount,t=this.ChartBorder.GetBottom(),n=this.ChartBorder.GetLeft();this.Canvas.save(),this.Canvas.strokeStyle=this.Color,this.LineWidth&&(this.Canvas.lineWidth=this.LineWidth*B());for(var s=this.Canvas.lineWidth,o=this.Data.DataOffset,l=0;o<this.Data.Data.length&&l<r;++o,++l){var h=this.Data.Data[o];if(h!=null){var u=this.ChartFrame.GetXFromIndex(l),f=this.ChartFrame.GetYFromData(h);if(u>a)break;if(this.Canvas.beginPath(),e)this.Canvas.moveTo(n,u),this.Canvas.lineTo(f,u),this.Canvas.stroke();else{var C=$t(s,u);this.Canvas.moveTo(C,f),this.Canvas.lineTo(C,t)}this.Canvas.stroke()}}this.Canvas.restore()}},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}!this.Data||!this.Data.Data||this.DrawStick()}}}function GC(){this.newMethod=tl,this.newMethod(),delete this.newMethod,this.ClassName="ChartLineStick",this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}this.DrawStick(),this.DrawLine()}}}function el(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.UpColor=d.UpBarColor,this.DownColor=d.DownBarColor,this.HistoryData,this.KLineDrawType=0,this.ClassName="ChartVolStick",this.BarWidth,this.BarType,this.BarColorType=0,this.PtInChart=this.PtInBar,this.DrawSelectedStatus=this.DrawLinePoint,this.ExportData=this.ExportArrayData,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.ChartFrame.IsHScreen===!0){this.HScreenDraw();return}var e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,r=this.ChartBorder.GetBorder(),t=r.LeftEx+a/2+d.FrameLeftMargin,n=r.RightEx,s=this.ChartFrame.XPointCount,o=this.GetLockRect();o&&(n=o.Left);var l=this.IsMinuteFrame(),h=this.ChartFrame.GetYFromData(0);if(this.Canvas.save(),e>=4&&this.BarWidth!==1){h=b(h);for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<s;++u,++f,t+=e+a){var C=this.Data.Data[u],D=this.HistoryData.Data[u];if(!(C==null||D==null)&&C!=0){var c=t,T=t+e;if(T>n)break;var S=this.ChartFrame.GetYFromData(C),I=this.GetBarColor(D,C),g=I.IsUp,E=b(Math.abs(h-S)>=1?h-S:1);S=h-E;var F=this.IsSolidBar(g);F?(this.Canvas.fillStyle=I.Color,this.Canvas.fillRect(b(c),S,b(e),E)):(this.Canvas.strokeStyle=I.Color,this.Canvas.beginPath(),this.Canvas.rect(L(c),L(S),b(e),E),this.Canvas.stroke())}}}else{var R=null,I=null;this.Canvas.linewidth=1*B();for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<s;++u,++f,t+=e+a){var C=this.Data.Data[u],D=this.HistoryData.Data[u];if(!(C==null||D==null)){var S=this.ChartFrame.GetYFromData(C);if(l)var A=this.ChartFrame.GetXFromIndex(f);else var c=t,T=t+e,A=c+(T-c)/2;if(A>n)break;l?I=this.GetMinuteBarColor(D,R):I=this.GetBarColor(D,C),this.Canvas.strokeStyle=I.Color,this.Canvas.beginPath(),this.Canvas.moveTo(L(A),S),this.Canvas.lineTo(L(A),h),this.Canvas.stroke(),R=D}}}this.Canvas.restore()}},this.HScreenDraw=function(){var e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,r=this.ChartBorder.GetHScreenBorder(),t=r.TopEx+a/2+d.FrameLeftMargin,n=r.BottomEx,s=this.ChartFrame.XPointCount,o=this.GetLockRect();o&&(n=o.Top);var l=this.IsMinuteFrame(),h=this.ChartFrame.GetYFromData(0);if(e>=4){h=b(h);for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<s;++u,++f,t+=e+a){var C=this.Data.Data[u],D=this.HistoryData.Data[u];if(!(C==null||D==null)){var c=t,T=t+e;if(T>n)break;var S=this.ChartFrame.GetYFromData(C),I=this.GetBarColor(D,C),g=I.IsUp,E=b(S-h),F=this.IsSolidBar(g);F?(this.Canvas.fillStyle=I.Color,this.Canvas.fillRect(h,b(c),E,b(e))):(this.Canvas.strokeStyle=I.Color,this.Canvas.beginPath(),this.Canvas.rect(L(h),L(c),E,b(e)),this.Canvas.stroke())}}}else for(var R=null,I=null,u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<s;++u,++f,t+=e+a){var C=this.Data.Data[u],D=this.HistoryData.Data[u];if(!(C==null||D==null)){var S=this.ChartFrame.GetYFromData(C);if(l)var A=this.ChartFrame.GetXFromIndex(f);else var c=t,T=t+e,A=c+(T-c)/2;if(A>n)break;l?I=this.GetMinuteBarColor(D,R):I=this.GetBarColor(D,C);var g=I.IsUp;this.Canvas.strokeStyle=I.Color,this.Canvas.beginPath(),this.Canvas.moveTo(S,L(A)),this.Canvas.lineTo(h,L(A)),this.Canvas.stroke(),R=D}}},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset;this.ChartFrame.GlobalOption&&this.ChartFrame.GlobalOption.IsValueFullRange&&(a=0,e=this.Data.Data.length);for(var r={Min:null,Max:null},t=a,n=0;t<this.Data.Data.length&&n<e;++t,++n){var s=this.Data.Data[t];(!v.IsNumber(r.Max)||r.Max<s)&&(r.Max=s),(!v.IsNumber(r.Min)||r.Min>s)&&(r.Min=s)}return r.Max>0&&r.Min>0?r.Min=0:r.Max<0&&r.Min<0&&(r.Max=0),r},this.GetBarColor=function(e,a){return this.BarColorType===1?a>=0?{Color:this.UpColor,IsUp:!0}:{Color:this.DownColor,IsUp:!1}:e.Close>=e.Open?{Color:this.UpColor,IsUp:!0}:{Color:this.DownColor,IsUp:!1}},this.IsSolidBar=function(e){var a=!0;return this.BarType===0||this.BarType===1||this.BarType===2?this.BarType===0?a=!1:this.BarType===2&&(a=e):(this.KLineDrawType==6||e&&(this.KLineDrawType==1||this.KLineDrawType==2||this.KLineDrawType==3))&&(a=!1),a},this.GetMinuteBarColor=function(e,a){var r=e.YClose;return a&&(r=a.Close),e.Close>=r?{Color:this.UpColor,IsUp:!0}:{Color:this.DownColor,IsUp:!1}},this.GetItemData=function(e){if(!e||!v.IsNumber(e.Index)||!this.HistoryData||!v.IsNonEmptyArray(this.HistoryData.Data)||!this.Data||!v.IsNonEmptyArray(this.Data.Data))return null;var a=e.Index;if(a<0||a>=this.Data.Data.length||a>=this.HistoryData.Data.length)return null;var r=this.Data.Data[a],t=this.HistoryData.Data[a];return[{Value:r,Color:this.GetBarColor(t).Color,Name:this.Name}]}}function _C(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartVericaltLine",this.LineWidth=2,this.LineCap,this.Draw=function(){if(!this.ChartFrame.IsMinSize){var e=this.ChartFrame.IsHScreen==!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.GetBorder(),n=this.ChartFrame.XPointCount;if(e)var s=t.RightEx,o=t.LeftEx,l=t.TopEx+r/2+d.FrameLeftMargin;else var s=t.TopEx,o=t.BottomEx,l=t.LeftEx+r/2+d.FrameLeftMargin;this.Canvas.save(),this.Canvas.strokeStyle=this.Color,this.LineType&&this.Canvas.setLineDash(this.LineType),this.LineCap&&(this.Canvas.lineCap=this.LineCap),this.Canvas.beginPath();var h=this.Canvas.lineWidth;this.LineWidth>0&&(h=this.LineWidth*B(),this.Canvas.lineWidth=h);for(var u=0,f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<n;++f,++C,l+=a+r){var D=this.Data.Data[f];if(D){var c=l+a/2;c=$t(h,c),e?(this.Canvas.moveTo(s,c),this.Canvas.lineTo(o,c)):(this.Canvas.moveTo(c,s),this.Canvas.lineTo(c,o)),++u}}u>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.GetMaxMin=function(){return{Min:null,Max:null}}}function HC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartHorizontalLine",this.LineWidth=2,this.LineCap,this.ExtendType=0,this.Draw=function(){if(!this.ChartFrame.IsMinSize){var e=this.ChartFrame.IsHScreen==!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.GetBorder(),n=this.ChartFrame.XPointCount;if(e)var s=t.TopEx,o=t.BottomEx,l=t.TopEx+r/2+d.FrameLeftMargin;else var s=t.LeftEx,o=t.RightEx,l=t.LeftEx+r/2+d.FrameLeftMargin;this.Canvas.save(),this.Canvas.strokeStyle=this.Color,this.LineType&&this.Canvas.setLineDash(this.LineType),this.LineCap&&(this.Canvas.lineCap=this.LineCap),this.Canvas.beginPath();var h=this.Canvas.lineWidth;this.LineWidth>0&&(h=this.LineWidth*B(),this.Canvas.lineWidth=h);for(var u=0,f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<n;++f,++C,l+=a+r){var D=this.Data.Data[f];if(D&&v.IsNumber(D)){var c=this.ChartFrame.GetYFromData(D);c=$t(h,c);var T=l+a/2;T=$t(h,T),this.ExtendType==3?e?(this.Canvas.moveTo(c,s),this.Canvas.lineTo(c,o)):(this.Canvas.moveTo(s,c),this.Canvas.lineTo(o,c)):this.ExtendType==1?e?(this.Canvas.moveTo(c,s),this.Canvas.lineTo(c,T)):(this.Canvas.moveTo(s,c),this.Canvas.lineTo(T,c)):e?(this.Canvas.moveTo(c,T),this.Canvas.lineTo(c,o)):(this.Canvas.moveTo(T,c),this.Canvas.lineTo(o,c)),++u}}u>0&&this.Canvas.stroke(),this.Canvas.restore()}}}function _d(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartLineMultiData",this.Color="rgb(255,193,37)",this.PointColor,this.PointRadius,this.LineWidth,this.Draw=function(){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){var e=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth;var a=this.ChartBorder.GetRight();e&&(a=this.ChartBorder.GetBottom());var r=this.ChartFrame.XPointCount;this.Canvas.save(),v.IsPlusNumber(this.LineWidth)&&(this.Canvas.lineWidth=this.LineWidth*B());for(var t=!0,n=0,s=[],o,l=this.Data.DataOffset,h=0;l<this.Data.Data.length&&h<r;++l,++h){var u=this.Data.Data[l];if(u){var f=this.ChartFrame.GetXFromIndex(h);if(f>a)break;Array.isArray(u)?o=u:o=[u];for(var C=0;C<o.length;++C){var D=o[C];if(D){var c=D.Value,T=this.ChartFrame.GetYFromData(c);t?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),e?this.Canvas.moveTo(T,f):this.Canvas.moveTo(f,T),t=!1,D.Type===1&&s.push({X:f,Y:T})):(e?this.Canvas.lineTo(T,f):this.Canvas.lineTo(f,T),D.Type===1&&s.push({X:f,Y:T})),++n}}}}n>0&&this.Canvas.stroke(),this.DrawPoint(s),this.Canvas.restore()}},this.DrawPoint=function(e){if(this.PointColor&&v.IsPlusNumber(this.PointRadius))for(var a=this.PointRadius*B(),r=0;r<e.length;++r){var t=e[r];this.Canvas.beginPath(),this.Canvas.arc(t.X,t.Y,a,0,360,!1),this.Canvas.fillStyle=this.PointColor,this.Canvas.fill(),this.Canvas.closePath()}},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a={};if(a.Min=null,a.Max=null,!this.Data||!this.Data.Data)return a;for(var r=this.Data.DataOffset,t=0;r<this.Data.Data.length&&t<e;++r,++t){var n=this.Data.Data[r];if(n){var s;Array.isArray(n)?s=n:s=[n];for(var t=0;t<s.length;++t){var o=s[t].Value;v.IsNumber(o)&&(a.Max==null&&(a.Max=o),a.Min==null&&(a.Min=o),a.Max<o&&(a.Max=o),a.Min>o&&(a.Min=o))}}}return a}}function VC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartStickLine",this.Color="rgb(255,193,37)",this.BarType=0,this.LineDotted=[3,3],this.Width=0,this.SetEmptyBar=function(){if(this.BarType!=1&&this.BarType!=-1)return!1;this.Canvas.lineWidth=B(),this.Canvas.strokeStyle=this.Color;var e=d.EmptyBarBGColor;return e&&(this.Canvas.fillStyle=e),this.BarType==-1&&this.Canvas.setLineDash(this.LineDotted),!0},this.IsEmptyBar=function(){return this.BarType==1||this.BarType==-1},this.CalculateBarHeight=function(e,a){var r=Math.abs(e-a);return r<=0&&(r=1),r},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetRight();this.ChartFrame.ZoomIndex,e&&(t=this.ChartBorder.GetBottom());var n=this.ChartFrame.XPointCount,s=this.ChartBorder.GetLeft()+r/2+d.FrameLeftMargin;e&&(s=this.ChartBorder.GetTop()+r/2+d.FrameLeftMargin);var o=this.IsMinuteFrame();this.Canvas.save();var l=!1,h=!1,u=d.EmptyBarBGColor;if(o)this.Width>1?this.Canvas.lineWidth=2*B():this.Canvas.lineWidth=B(),this.Canvas.strokeStyle=this.Color;else if(this.Width==0)this.SetEmptyBar(),this.Canvas.lineWidth=B(),this.Canvas.strokeStyle=this.Color;else if(this.Width==3||this.Width==50)a>=4?(h=!0,this.SetEmptyBar(),this.IsEmptyBar()||(this.Canvas.fillStyle=this.Color),this.Canvas.strokeStyle=this.Color):(this.Canvas.lineWidth=B(),this.Canvas.strokeStyle=this.Color);else if(this.Width==101){var f=a+r+1*B();this.Canvas.lineWidth=f,this.Canvas.strokeStyle=this.Color}else if(this.Width<=3){var C=2*B(),D=a*(this.Width/3);D<C&&(D=C),this.SetEmptyBar(),this.IsEmptyBar()||(this.Canvas.fillStyle=this.Color),l=!0}else{var D=this.Width*B()+a;this.SetEmptyBar(),this.IsEmptyBar()||(this.Canvas.fillStyle=this.Color),l=!0}for(var c=this.Data.DataOffset,T=0;c<this.Data.Data.length&&T<n;++c,++T,s+=a+r){var S=this.Data.Data[c];if(S!=null){var I=S.Value,g=S.Value2;if(g==null&&(g=0),o)var E=this.ChartFrame.GetXFromIndex(T);else var F=s,R=s+a,E=F+(R-F)/2;var A=this.ChartFrame.GetYFromData(I),P=this.ChartFrame.GetYFromData(g);if(E>t)break;if(l)if(e){var F=E-D/2,p=D;this.IsEmptyBar()?(this.Canvas.beginPath(),this.Canvas.rect(L(Math.min(A,P)),L(F),b(Math.abs(A-P)),b(p)),this.Canvas.stroke()):this.Canvas.fillRect(b(Math.min(A,P)),b(F),b(Math.abs(A-P)),b(p))}else{var F=E-D/2,p=D;F+p>t&&(p=t-F),this.IsEmptyBar()?(u&&this.Canvas.fillRect(b(F),b(Math.min(A,P)),b(p),b(Math.abs(A-P))),this.Canvas.beginPath(),this.Canvas.rect(L(F),L(Math.min(A,P)),b(p),b(Math.abs(A-P))),this.Canvas.stroke()):this.Canvas.fillRect(b(F),b(Math.min(A,P)),b(p),b(this.CalculateBarHeight(A,P)))}else if(h)this.IsEmptyBar()?e?(this.Canvas.beginPath(),this.Canvas.rect(L(Math.min(A,P)),L(s),b(Math.abs(A-P)),b(a)),this.Canvas.stroke()):(u&&this.Canvas.fillRect(b(s),b(Math.min(A,P)),b(a),b(Math.abs(A-P))),this.Canvas.beginPath(),this.Canvas.rect(L(s),L(Math.min(A,P)),b(a),b(Math.abs(A-P))),this.Canvas.stroke()):e?this.Canvas.fillRect(b(Math.min(A,P)),b(s),b(Math.abs(A-P)),b(a)):this.Canvas.fillRect(b(s),b(Math.min(A,P)),b(a),b(this.CalculateBarHeight(A,P)));else if(e)this.Canvas.beginPath(),this.Canvas.moveTo(A,L(E)),this.Canvas.lineTo(P,L(E)),this.Canvas.stroke();else{var w=parseInt(E.toString())+.5;this.Canvas.beginPath(),this.Canvas.moveTo(w,A),Math.abs(A-P)>0?this.Canvas.lineTo(w,P):this.Canvas.lineTo(w,A+1),this.Canvas.stroke()}}}this.Canvas.restore()}}},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a={};if(a.Min=null,a.Max=null,!this.Data||!this.Data.Data)return a;for(var r=this.Data.DataOffset,t=0;r<this.Data.Data.length&&t<e;++r,++t){var n=this.Data.Data[r];if(n!=null){var s=n.Value2;if(s==null&&(s=0),!(n==null||isNaN(n.Value)||isNaN(s))){var o=Math.max(n.Value,s),l=Math.min(n.Value,s);a.Max==null&&(a.Max=o),a.Min==null&&(a.Min=l),a.Max<o&&(a.Max=o),a.Min>l&&(a.Min=l)}}}return a}}function gi(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartSingleText",this.Color="rgb(255,193,37)",this.TextFont="14px 微软雅黑",this.Text,this.TextAlign="left",this.TextBG,this.Direction=0,this.FixedFontSize=-1,this.YOffset=0,this.Position,this.ShowOffset={X:0,Y:0},this.IconFont,this.IconSize={Max:d.DRAWICON.Icon.MaxSize,Min:d.DRAWICON.Icon.MinSize,Zoom:{Type:d.DRAWICON.Icon.Zoom.Type,Value:d.DRAWICON.Icon.Zoom.Value},YOffset:d.DRAWICON.Icon.YOffset},this.TextSize={Max:d.DRAWICON.Text.MaxSize,Min:d.DRAWICON.Text.MinSize,Zoom:{Type:d.DRAWICON.Text.Zoom.Type,Value:d.DRAWICON.Text.Zoom.Value},FontName:d.DRAWICON.Text.FontName,YOffset:d.DRAWICON.Text.YOffset},this.Font={DRAWTEXT_FIX:d.DRAWTEXT_FIX.Font,DRAWNUMBER_FIX:d.DRAWNUMBER_FIX.Font},this.ExportData=this.ExportBoolData,this.ReloadResource=function(e){this.Name=="DRAWTEXT"?this.TextSize={Max:d.DRAWTEXT.MaxSize,Min:d.DRAWTEXT.MinSize,Zoom:{Type:d.DRAWTEXT.Zoom.Type,Value:d.DRAWTEXT.Zoom.Value},FontName:d.DRAWTEXT.FontName,YOffset:d.DRAWTEXT.YOffset}:this.Name=="DRAWNUMBER"?this.TextSize={Max:d.DRAWNUMBER.MaxSize,Min:d.DRAWNUMBER.MinSize,Zoom:{Type:d.DRAWNUMBER.Zoom.Type,Value:d.DRAWNUMBER.Zoom.Value},FontName:d.DRAWNUMBER.FontName,YOffset:d.DRAWNUMBER.YOffset}:this.Name=="DRAWTEXT_FIX"?this.Font.DRAWTEXT_FIX=d.DRAWTEXT_FIX.Font:this.Name=="DRAWNUMBER_FIX"&&(this.Font.DRAWNUMBER_FIX=d.DRAWNUMBER_FIX.Font)},this.SuperGetMaxMin=this.GetMaxMin,this.GetMaxMin=function(){return this.Name=="DRAWTEXT_FIX"||this.Name=="DRAWNUMBER_FIX"?{Min:null,Max:null}:this.Name=="DRAWTEXTREL"||this.Name=="DRAWTEXTABS"?{Min:null,Max:null}:this.SuperGetMaxMin()},this.DrawRectText=function(){if(this.DrawData){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.GetBorder();if(this.Name=="DRAWTEXTREL")if(e)var r=a.RightTitle-a.LeftEx,t=a.BottomEx-a.TopEx,n=this.DrawData.Point.X/1e3*t+a.TopEx,s=a.RightTitle-this.DrawData.Point.Y/1e3*t;else var t=a.RightEx-a.LeftEx,r=a.BottomEx-a.TopTitle,n=this.DrawData.Point.X/1e3*t+a.LeftEx,s=this.DrawData.Point.Y/1e3*r+a.TopTitle;else if(this.Name=="DRAWTEXTABS")if(e)var n=this.DrawData.Point.X+a.TopEx,s=a.RightTitle-this.DrawData.Point.Y;else var n=this.DrawData.Point.X+a.LeftEx,s=this.DrawData.Point.Y+a.TopTitle;else return;this.Direction==1?this.Canvas.textBaseline="bottom":this.Direction==2?this.Canvas.textBaseline="top":this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.font=this.TextFont,this.Canvas.fillStyle=this.Color,this.DrawText(this.DrawData.Text,n,s,e)}},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(this.Name=="DRAWTEXTREL"||this.Name=="DRAWTEXTABS"){this.DrawRectText();return}if(this.Position){this.DrawPosition();return}if(!(!this.Data||!this.Data.Data)){var e=this.ChartFrame.IsHScreen===!0,a=this.IsMinuteFrame(),r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartBorder.GetLeft()+t/2+d.FrameLeftMargin,s=this.ChartBorder.GetRight(),o=this.ChartBorder.GetTopEx(),l=this.ChartBorder.GetBottomEx();this.Canvas.save(),this.ClipClient(this.ChartFrame.IsHScreen),e&&(s=this.ChartBorder.GetBottom(),o=this.ChartBorder.GetRightEx(),l=this.ChartBorder.GetLeftEx(),n=this.ChartBorder.GetTop()+t/2+d.FrameLeftMargin);var h=this.ChartFrame.XPointCount,u=Array.isArray(this.Text),f=B(),C={Text:{},Font:{}};if(this.Direction==1?(this.Canvas.textBaseline="bottom",C.Text={Baseline:"bottom"}):this.Direction==2?(this.Canvas.textBaseline="top",C.Text={Baseline:"top"}):(this.Canvas.textBaseline="middle",C.Text={Baseline:"middle"}),this.IconFont){if(this.Color=this.IconFont.Color,this.Text=this.IconFont.Text,this.FixedFontSize>0)var D=this.FixedFontSize;else var D=this.GetDynamicIconSize(r,t,this.IconSize.Max,this.IconSize.Min,this.IconSize.Zoom);this.Canvas.font=D+"px "+this.IconFont.Family}else this.FixedFontSize>0?this.TextFont=this.FixedFontSize+"px "+this.TextSize.FontName:this.TextFont=this.GetDynamicFont(r,t,this.TextSize.Max,this.TextSize.Min,this.TextSize.Zoom,this.TextSize.FontName),this.Canvas.font=this.TextFont;C.Font={Height:this.GetFontHeight()};for(var c=this.Data.DataOffset,T=0;c<this.Data.Data.length&&T<h;++c,++T,n+=r+t){var S=this.Data.Data[c];if(S!=null){if(a)var I=this.ChartFrame.GetXFromIndex(T);else{var g=n,E=n+r;if(E>s)break;var I=g+(E-g)/2}var F=this.ChartFrame.GetYFromData(S,!1);if(I>s)break;if(F+=this.ShowOffset.Y,I+=this.ShowOffset.X,this.Canvas.textAlign=this.TextAlign,this.Canvas.fillStyle=this.Color,C.Text.Color=this.Color,C.Text.Align=this.TextAlign,C.X=I,C.Y=F,this.YOffset>0&&this.Direction>0){var R=F;this.Canvas.setLineDash([5,10]),this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),e?(this.Direction==1?(F=o-this.YOffset*f,R+=5*f):(F=l+this.YOffset*f,R-=5*f),this.Canvas.moveTo(L(R),L(I)),this.Canvas.lineTo(L(F),L(I))):(this.Direction==1?(F=o+this.YOffset*f,R+=5*f):(F=l-this.YOffset*f,R-=5*f),this.Canvas.moveTo(L(I),L(R)),this.Canvas.lineTo(L(I),L(F))),this.Canvas.stroke(),this.Canvas.setLineDash([])}if(u){var A=this.Text[c];if(!A)continue;this.Name=="DRAWNUMBER"&&(this.Direction==1?F-=d.DRAWABOVE.YOffset*f:this.Direction==2&&(F+=this.TextSize.YOffset*f)),this.Name=="DRAWTEXT"?this.DrawTextV2(A,C,e):this.DrawText(A,I,F,e)}else this.Name=="DRAWICON"?this.Direction==1?F-=d.DRAWABOVE.YOffset*f:this.Direction==2&&(this.IconFont?F+=this.IconSize.YOffset*f:F+=this.TextSize.YOffset*f):this.Name=="DRAWTEXT"&&(this.Direction==1?F-=d.DRAWABOVE.YOffset*f:this.Direction==2&&(F+=this.TextSize.YOffset*f)),this.Name=="DRAWTEXT"?this.DrawTextV2(this.Text,C,e):this.DrawText(this.Text,I,F,e)}}this.Canvas.restore()}}},this.DrawPosition=function(){if(this.Text){var e=this.ChartFrame.IsHScreen===!0;if(e)var a=this.ChartBorder.GetRightEx()-this.ChartBorder.GetWidthEx()*this.Position.Y,r=this.ChartBorder.GetTop()+this.ChartBorder.GetHeight()*this.Position.X;else var r=this.ChartBorder.GetLeft()+this.ChartBorder.GetWidth()*this.Position.X,a=this.ChartBorder.GetTopEx()+this.ChartBorder.GetHeightEx()*this.Position.Y;if(this.Canvas.fillStyle=this.Color,this.Name=="DRAWTEXT_FIX"?this.Canvas.font=this.Font.DRAWTEXT_FIX:this.Name=="DRAWNUMBER_FIX"&&(this.Canvas.font=this.Font.DRAWNUMBER_FIX),this.Position.Type==0?this.Canvas.textAlign="left":this.Position.Type==1?this.Canvas.textAlign="right":this.Canvas.textAlign="center",this.Direction==1?this.Canvas.textBaseline="bottom":this.Direction==2?this.Canvas.textBaseline="top":this.Canvas.textBaseline="middle",Array.isArray(this.Text)){if(!this.Data||!this.Data.Data)return;for(var t=this.ChartFrame.XPointCount,n=this.Data.DataOffset,s=0;n<this.Data.Data.length&&s<t;++n,++s){var o=this.Text[n];if(o){this.DrawText(o,r,a,e);break}}}else this.DrawText(this.Text,r,a,e)}},this.DrawText=function(e,a,r,t){t?(this.Canvas.save(),this.Canvas.translate(r,a),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(e,0,0),this.Canvas.restore()):this.Canvas.fillText(e,a,r)},this.DrawTextV2=function(e,a,r){var t=this.Canvas.measureText(e).width;if(r){var n=a.Y,s=a.X;if(a.Text.Align=="right"?s=s-t:a.Text.Align=="center"&&(s=s-t/2),a.Text.Baseline=="top"?n-=a.Font.Height:a.Text.Baseline=="middle"&&(n-=a.Font.Height/2),this.TextBG&&(this.TextBG.Color||this.TextBG.Border)){var o=this.TextBG.Margin,l=n-o[0],h=s-o[2],u=t+o[2]+o[3],f=a.Font.Height+o[0]+o[1];this.TextBG.Color&&(this.Canvas.fillStyle=this.TextBG.Color,this.Canvas.fillRect(l,h,f,u)),this.TextBG.Border&&(this.Canvas.strokeStyle=this.TextBG.Border,this.Canvas.strokeRect(L(l),L(h),b(f),b(u)))}this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.fillStyle=a.Text.Color,this.Canvas.save(),this.Canvas.translate(n,s),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(e,0,0),this.Canvas.restore()}else{var n=a.X,s=a.Y;if(a.Text.Align=="right"?n=n-t:a.Text.Align=="center"&&(n=n-t/2),a.Text.Baseline=="top"?s+=a.Font.Height:a.Text.Baseline=="middle"&&(s+=a.Font.Height/2),this.TextBG&&(this.TextBG.Color||this.TextBG.Border)){var o=this.TextBG.Margin,l=n-o[2],h=s-a.Font.Height-o[1],u=t+o[2]+o[3],f=a.Font.Height+o[0]+o[1];this.TextBG.Color&&(this.Canvas.fillStyle=this.TextBG.Color,this.Canvas.fillRect(l,h,u,f)),this.TextBG.Border&&(this.Canvas.strokeStyle=this.TextBG.Border,this.Canvas.strokeRect(L(l),L(h),b(u),b(f)))}this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.fillStyle=a.Text.Color,this.Canvas.fillText(e,n,s)}}}function Hd(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartTradeIcon",this.TextAlign="center",this.TextBaseline="middle",this.SVG={Family:"iconfont",Size:12},this.AryIcon,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()&&!(!this.Data||!this.Data.Data)&&v.IsNonEmptyArray(this.AryIcon)){var e=this.ChartFrame.IsHScreen===!0;this.Canvas.font=this.SVG.Size+"px "+this.SVG.Family,this.Canvas.textAlign=this.TextAlign,this.Canvas.textBaseline="middle";var a=0;this.TradeType=="BUY"||this.TradeType=="BUYSHORT"?(this.Canvas.textBaseline="top",a+=e?-2:2):(this.TradeType=="SELL"||this.TradeType=="SELLSHORT")&&(this.Canvas.textBaseline="bottom",a=e?2:-2);var r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartBorder.GetRight(),s=this.ChartFrame.XPointCount,o=this.ChartFrame.GetBorder(),l=o.LeftEx+t/2+d.FrameLeftMargin;e&&(n=this.ChartBorder.GetBottom(),l=this.ChartBorder.GetTop()+t/2+d.FrameLeftMargin);for(var h=this.Data.DataOffset,u=0;h<this.Data.Data.length&&u<s;++h,++u,l+=r+t){var f=this.Data.Data[h];if(v.IsNumber(f)&&!(f<=0)){var C=this.AryIcon[h];if(!(!v.IsNumber(C.Value)||!C.Icon)){var D=l,c=l+r;if(c>n)break;var T=D+(c-D)/2,S=this.GetYFromData(C.Value,!1);this.Canvas.fillStyle=C.Color,r>2&&(T=L(T)),this.DrawTradeIcon(C.Icon,T,S+a,e)}}}}},this.DrawTradeIcon=function(e,a,r,t){t?(this.Canvas.save(),this.Canvas.translate(r,a),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(e,0,0),this.Canvas.restore()):this.Canvas.fillText(e,a,r)},this.GetMaxMin=function(){var e={Max:null,Min:null};if(!this.Data||!this.Data.Data||!v.IsNonEmptyArray(this.AryIcon))return e;var a=this.ChartFrame.XPointCount,r=this.Data.DataOffset;this.ChartFrame.GlobalOption&&this.ChartFrame.GlobalOption.IsValueFullRange&&(r=0,a=this.Data.Data.length);for(var t=r,n=0;t<this.Data.Data.length&&n<a;++t,++n){var s=this.Data.Data[t];if(v.IsNumber(s)&&!(s<=0)){var o=this.AryIcon[t];!v.IsNumber(o.Value)||!o.Icon||((e.Max==null||e.Max<o.Value)&&(e.Max=o.Value),(e.Min==null||e.Min>o.Value)&&(e.Min=o.Value))}}return e}}function al(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawText",this.Color="rgb(255,193,37)",this.TextFont="14px 微软雅黑",this.TextBaseline="middle",this.TextAlign="left",this.Text,this.TextBG,this.FixedFontSize=-1,this.YOffset=0,this.FixedPosition=-1,this.VerticalLine,this.ShowOffset={X:0,Y:0},this.ExportData=this.ExportBoolData,this.TextSize={Max:d.DRAWICON.Text.MaxSize,Min:d.DRAWICON.Text.MinSize,Zoom:{Type:d.DRAWICON.Text.Zoom.Type,Value:d.DRAWICON.Text.Zoom.Value},FontName:d.DRAWICON.Text.FontName,YOffset:d.DRAWICON.Text.YOffset},this.ReloadResource=function(e){this.TextSize={Max:d.DRAWTEXT.MaxSize,Min:d.DRAWTEXT.MinSize,Zoom:{Type:d.DRAWTEXT.Zoom.Type,Value:d.DRAWTEXT.Zoom.Value},FontName:d.DRAWTEXT.FontName,YOffset:d.DRAWTEXT.YOffset}},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){var e=this.ChartFrame.IsHScreen===!0,a=this.IsMinuteFrame(),r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartBorder.GetLeft()+t/2+d.FrameLeftMargin,s=this.ChartBorder.GetRight(),o=this.ChartBorder.GetTopEx(),l=this.ChartBorder.GetBottomEx();this.Canvas.save(),this.ClipClient(e),e&&(s=this.ChartBorder.GetBottom(),o=this.ChartBorder.GetRightEx(),l=this.ChartBorder.GetLeftEx(),n=this.ChartBorder.GetTop()+t/2+d.FrameLeftMargin);var h=this.ChartFrame.XPointCount,u=Array.isArray(this.Text),f={Text:{Color:this.Color,Align:this.TextAlign,Baseline:this.TextBaseline},Font:{}};this.FixedFontSize>0?this.TextFont=this.FixedFontSize+"px "+this.TextSize.FontName:this.TextFont=this.GetDynamicFont(r,t,this.TextSize.Max,this.TextSize.Min,this.TextSize.Zoom,this.TextSize.FontName),this.Canvas.font=this.TextFont,f.Font={Height:this.GetFontHeight()};for(var C=this.Data.DataOffset,D=0;C<this.Data.Data.length&&D<h;++C,++D,n+=r+t){var c=this.Data.Data[C];if(c!=null){if(a)var T=this.ChartFrame.GetXFromIndex(D);else{var S=n,I=n+r;if(I>s)break;var T=S+(I-S)/2}var g;if(this.FixedPosition===1?g=o:this.FixedPosition===2?g=l:g=this.ChartFrame.GetYFromData(c,!1),T>s)break;if(g+=this.ShowOffset.Y,T+=this.ShowOffset.X,f.X=T,f.Y=g,u){var E=this.Text[C];if(!E)continue;this.DrawText(E,f,e)}else this.DrawText(this.Text,f,e);this.DrawVerticalLine(C,f,e)}}this.Canvas.restore()}}},this.DrawText=function(e,a,r){var t=this.Canvas.measureText(e).width;if(r){var n=a.Y,s=a.X;if(a.Text.Align=="right"?s=s-t:a.Text.Align=="center"&&(s=s-t/2),a.Text.Baseline=="top"?n-=a.Font.Height:a.Text.Baseline=="middle"&&(n-=a.Font.Height/2),this.TextBG&&(this.TextBG.Color||this.TextBG.Border)){var o=this.TextBG.Margin,l=n-o[0],h=s-o[2],u=t+o[2]+o[3],f=a.Font.Height+o[0]+o[1];this.TextBG.Color&&(this.Canvas.fillStyle=this.TextBG.Color,this.Canvas.fillRect(l,h,f,u)),this.TextBG.Border&&(this.Canvas.strokeStyle=this.TextBG.Border,this.Canvas.strokeRect(L(l),L(h),b(f),b(u))),a.Rect={Bottom:l,Top:l+f}}else{var l=n,f=a.Font.Height;a.Rect={Bottom:l,Top:l+f}}this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.fillStyle=a.Text.Color,this.Canvas.save(),this.Canvas.translate(n,s),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(e,0,0),this.Canvas.restore()}else{var n=a.X,s=a.Y;if(a.Text.Align=="right"?n=n-t:a.Text.Align=="center"&&(n=n-t/2),a.Text.Baseline=="top"?s+=a.Font.Height:a.Text.Baseline=="middle"&&(s+=a.Font.Height/2),this.TextBG&&(this.TextBG.Color||this.TextBG.Border)){var o=this.TextBG.Margin,l=n-o[2],h=s-a.Font.Height-o[1],u=t+o[2]+o[3],f=a.Font.Height+o[0]+o[1];this.TextBG.Color&&(this.Canvas.fillStyle=this.TextBG.Color,this.Canvas.fillRect(l,h,u,f)),this.TextBG.Border&&(this.Canvas.strokeStyle=this.TextBG.Border,this.Canvas.strokeRect(L(l),L(h),b(u),b(f))),a.Rect={Top:h,Bottom:h+f}}else{var h=s-a.Font.Height,f=a.Font.Height;a.Rect={Top:h,Bottom:h+f}}this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.fillStyle=a.Text.Color,this.Canvas.fillText(e,n,s)}},this.DrawVerticalLine=function(e,a,r){if(this.VerticalLine){var t=this.VerticalLine.Data[e];if(t&&v.IsNumber(t.High)&&v.IsNumber(t.Low)){var n=this.ChartFrame.GetYFromData(t.High),s=this.ChartFrame.GetYFromData(t.Low),o,l;if(r)if(a.Rect.Bottom>n)o=a.Rect.Bottom-1,l=n+1;else if(a.Rect.Top<s)o=a.Rect.Top-1,l=s-1;else return;else if(a.Rect.Bottom<n)o=a.Rect.Bottom+1,l=n-1;else if(a.Rect.Top>s)o=a.Rect.Top-1,l=s+1;else return;this.Canvas.save();var h=B(),u=a.X;this.VerticalLine.LineType==1&&(this.VerticalLine.LineDotted?this.Canvas.setLineDash(this.VerticalLine.LineDotted):this.Canvas.setLineDash([5,10])),v.IsPlusNumber(this.VerticalLine.LineWidth)&&(this.Canvas.lineWidth=this.VerticalLine.LineWidth*h),this.Canvas.strokeStyle=this.VerticalLine.Color,this.Canvas.beginPath(),r?(this.Canvas.moveTo(L(o),L(u)),this.Canvas.lineTo(L(l),L(u))):(this.Canvas.moveTo(L(u),L(o)),this.Canvas.lineTo(L(u),L(l))),this.Canvas.stroke(),this.Canvas.restore()}}}}function Vd(){this.newMethod=al,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawNumber",this.ReloadResource=function(e){this.TextSize={Max:d.DRAWNUMBER.MaxSize,Min:d.DRAWNUMBER.MinSize,Zoom:{Type:d.DRAWNUMBER.Zoom.Type,Value:d.DRAWNUMBER.Zoom.Value},FontName:d.DRAWNUMBER.FontName,YOffset:d.DRAWNUMBER.YOffset}}}function Yd(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawLastBarText",this.LastBarItem=null,this.TextSize={Max:d.DRAWICON.Text.MaxSize,Min:d.DRAWICON.Text.MinSize,Zoom:{Type:d.DRAWICON.Text.Zoom.Type,Value:d.DRAWICON.Text.Zoom.Value},FontName:d.DRAWICON.Text.FontName,YOffset:d.DRAWICON.Text.YOffset},this.IconSize={Max:d.DRAWICON.Icon.MaxSize,Min:d.DRAWICON.Icon.MinSize,Zoom:{Type:d.DRAWICON.Icon.Zoom.Type,Value:d.DRAWICON.Icon.Zoom.Value},YOffset:d.DRAWICON.Icon.YOffset},this.ReloadResource=function(e){this.TextSize={Max:d.DRAWTEXT.MaxSize,Min:d.DRAWTEXT.MinSize,Zoom:{Type:d.DRAWTEXT.Zoom.Type,Value:d.DRAWTEXT.Zoom.Value},FontName:d.DRAWTEXT.FontName},this.IconSize={Max:d.DRAWICON.Icon.MaxSize,Min:d.DRAWICON.Icon.MinSize,Zoom:{Type:d.DRAWICON.Icon.Zoom.Type,Value:d.DRAWICON.Icon.Zoom.Value}}},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()&&this.LastBarItem&&!(!this.Data||!v.IsNonEmptyArray(this.Data.Data))){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,r=a+e;if(!(r<this.Data.Data.length)){var t=this.Data.Data.length-1-a,n=this.ChartFrame.GetXFromIndex(t),s=this.LastBarItem;s.Value=="Top"?y=top:s.Value=="Bottom"?y=bottom:y=this.ChartFrame.GetYFromData(s.Value,!1),v.IsNumber(s.YOffset)&&(y+=s.YOffset),v.IsNumber(s.XOffset)&&(n+=s.XOffset),this.Canvas.save(),this.ClipClient(this.IsHScreen),s.Text?this.DrawLastText(s,n,y):s.Icon&&this.DrawLastIcon(s,n,y),this.Canvas.restore()}}},this.DrawLastText=function(e,a,r){var t=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,s=this.GetDynamicFont(t,n,this.TextSize.Max,this.TextSize.Min,this.TextSize.Zoom,this.TextSize.FontName),o="bottom";e.TextBaseline&&(o=e.TextBaseline);var l="center";e.TextAlign&&(l=e.TextAlign),this.Canvas.font=s,this.Canvas.textBaseline=o,this.Canvas.textAlign=l,this.Canvas.fillStyle=e.Color,this.IsHScreen?(this.Canvas.save(),this.Canvas.translate(r,a),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(e.Text,0,0),this.Canvas.restore()):this.Canvas.fillText(e.Text,a,r)},this.DrawLastIcon=function(e,a,r){var t=e.Icon,n=this.ChartFrame.DataWidth,s=this.ChartFrame.DistanceWidth,o=this.GetDynamicIconSize(n,s,this.IconSize.Max,this.IconSize.Min,this.IconSize.Zoom),l=o+"px "+t.Family,h="bottom";e.TextBaseline&&(h=e.TextBaseline);var u="center";e.TextAlign&&(u=e.TextAlign),this.Canvas.font=l,this.Canvas.textBaseline=h,this.Canvas.textAlign=u,this.Canvas.fillStyle=e.Color,this.IsHScreen?(this.Canvas.save(),this.Canvas.translate(r,a),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(t.Symbol,0,0),this.Canvas.restore()):this.Canvas.fillText(t.Symbol,a,r)},this.GetMaxMin=function(){var e={Min:null,Max:null};if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return e;var a=this.ChartFrame.XPointCount,r=this.Data.DataOffset,t=r+a;return t<this.Data.Data.length||!this.LastBarItem||v.IsNumber(this.LastBarItem.Value)&&(e.Max=e.Min=this.LastBarItem.Value),e}}function YC(){this.newMethod=va,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinutePriceLine",this.YClose,this.IsDrawArea=!0,this.AreaColor="rgba(0,191,255,0.1)",this.IsShowLead=!1,this.LeadData,this.UpColor=d.UpBarColor,this.DownColor=d.DownBarColor,this.BeforeOpenData,this.BeforeLineColor=d.Minute.Before.LineColor,this.BeforeAvPriceColor=d.Minute.Before.AvPriceColor,this.BeforePoint=At(d.Minute.Before.Point),this.AfterCloseData,this.AfterLineColor=d.Minute.After.LineColor,this.AfterAvPriceColor=d.Minute.After.AvPriceColor,this.AfterPoint=At(d.Minute.After.Point),this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.ColorLineData,this.Source,this.PtInChart=this.PtInLine,this.DrawSelectedStatus=this.DrawLinePoint,this.PtInChart=this.PtInLine,this.DrawSelectedStatus=this.DrawLinePoint,this.DayOffset,this.LastPoint={},this.FFMChart,this.DrawType=0,this.UpdateLastPoint=function(e,a,r,t){v.IsNumber(this.LastPoint.DateTime)&&this.LastPoint.DateTime>e||(this.LastPoint.DateTime=e,this.LastPoint.X=a,this.LastPoint.Y=r,this.LastPoint.Data=t,this.LastPoint.Value=t.Value)},this.Draw=function(){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(this.LastPoint={},!!this.IsShow){if(this.DrawType==14){this.FFMChart&&this.FFMChart.Draw&&this.FFMChart.Draw(this);return}var e=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight(),e===!0&&this.ChartBorder.GetBottom();var a=this.ChartFrame.XPointCount,r=this.ChartFrame.MinuteCount,t=this.ChartBorder.GetBottom(),n=this.ChartBorder.GetLeft(),s=this.Data;if(this.DrawBeforeOpen(),this.DrawMultiDayBeforeOpen(),this.IsShowLead&&this.DrawLead(),!!s){var o=!0,l={},h=0,u=0;this.Canvas.save(),v.IsPlusNumber(this.LineWidth>0)&&(this.Canvas.lineWidth=this.LineWidth);for(var f=s.DataOffset,C=0;f<s.Data.length&&C<a;++f,++C){var D=null;if(D=s.Data[f],++u,D!=null){var c=this.ChartFrame.GetXFromIndex(C),T=this.ChartFrame.GetYFromData(D);if(o?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),e?this.Canvas.moveTo(T,c):this.Canvas.moveTo(c,T),o=!1,l={X:c,Y:T}):e?this.Canvas.lineTo(T,c):this.Canvas.lineTo(c,T),this.Source){var S=this.Source.Data[f],I=S.Date*1e6+S.Time*100;this.UpdateLastPoint(I,c,T,{Value:D,Index:f,Date:S.Date,Time:S.Time,Type:0,Explain:"盘中"})}++h,u>=r&&(o=!0,this.Canvas.stroke(),this.IsDrawArea&&(e?(this.Canvas.lineTo(n,c),this.Canvas.lineTo(n,l.X),this.SetFillStyle(this.AreaColor,this.ChartBorder.GetRightEx(),t,this.ChartBorder.GetLeftEx(),t)):(this.Canvas.lineTo(c,t),this.Canvas.lineTo(l.X,t),this.SetFillStyle(this.AreaColor,n,this.ChartBorder.GetTopEx(),n,t)),this.Canvas.fill()),u=0,h=0)}}if(h>0&&(h==1?(this.Canvas.beginPath(),e?this.Canvas.arc(l.Y,l.X,1,0,360,!1):this.Canvas.arc(l.X,l.Y,1,0,360,!1),this.Canvas.closePath(),this.Canvas.fillStyle=this.Color,this.Canvas.fill()):(this.Canvas.stroke(),this.IsDrawArea&&(e?(this.Canvas.lineTo(n,c),this.Canvas.lineTo(n,l.X),this.SetFillStyle(this.AreaColor,this.ChartBorder.GetRightEx(),t,this.ChartBorder.GetLeftEx(),t)):(this.Canvas.lineTo(c,t),this.Canvas.lineTo(l.X,t),this.SetFillStyle(this.AreaColor,n,this.ChartBorder.GetTopEx(),n,t)),this.Canvas.fill()))),this.Canvas.restore(),this.DrawColorLine(),this.DrawAfterClose(),this.DrawMultiDayAfterClose(),this.GetEventCallback){var g=this.GetEventCallback($.ON_DRAW_MINUTE_LAST_POINT);if(g){var E=B(),s={InterLastPoint:{X:this.LastPoint.X,Y:this.LastPoint.Y},LastPoint:{X:this.LastPoint.X/E,Y:this.LastPoint.Y/E},Price:this.LastPoint.Price,Data:this.LastPoint.Data,PixelRatio:E};g.Callback(g,s,this)}}}}},this.DrawLead=function(){if(this.LeadData){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.XPointCount,r=this.ChartFrame.MinuteCount;this.ChartBorder.GetBottomEx();var t=this.ChartBorder.GetTopEx();if(e===!0&&(t=this.ChartBorder.GetRightEx()),!(a>r)){for(var n=[],s=null,o=null,l=this.ChartFrame.GetYFromData(this.YClose),h=(l-t)/3,u=this.LeadData,f=u.DataOffset,C=0;f<u.Data.length&&C<a;++f,++C){var D=u.Data[f];if(v.IsNumber(D)&&D!=0){var c=this.ChartFrame.GetXFromIndex(C);(s==null||s<D)&&(s=D),(o==null||o>D)&&(o=D),n.push({X:c,Value:D})}}if(!(n.length<=0)){var T=Math.max(Math.abs(s),Math.abs(o));for(var f in n){var S=n[f];S.Value>0?this.Canvas.strokeStyle=this.UpColor:this.Canvas.strokeStyle=this.DownColor;var I=l-S.Value*h/T,c=L(S.X);this.Canvas.beginPath(),e===!0?(this.Canvas.moveTo(l,c),this.Canvas.lineTo(I,c)):(this.Canvas.moveTo(c,l),this.Canvas.lineTo(c,I)),this.Canvas.stroke()}}}}},this.DrawBeforeOpen=function(){this.ChartBorder.LeftExtendWidth<10||this.BeforeOpenData&&this.DrawCallAuction(-1,this.BeforeOpenData,!0)},this.DrawAfterClose=function(){this.ChartBorder.RightExtendWidth<10||this.AfterCloseData&&this.DrawCallAuction(-1,this.AfterCloseData,!1)},this.DrawMultiDayBeforeOpen=function(){if(!(this.ChartBorder.MultiDayMinute.Count<=1||this.ChartBorder.MultiDayMinute.Left<=0)&&this.MultiDayBeforeOpenData){var e=0,a=this.MultiDayBeforeOpenData.length;this.DayOffset&&(v.IsNumber(this.DayOffset.Offset)&&(e=this.DayOffset.Offset),v.IsNumber(this.DayOffset.ShowDayCount)&&(a=this.DayOffset.ShowDayCount));for(var r=e,t=0;r<this.MultiDayBeforeOpenData.length&&t<a;++r,++t){var n=this.MultiDayBeforeOpenData[r];this.DrawCallAuction(t,n,!0)}}},this.DrawMultiDayAfterClose=function(){if(!(this.ChartBorder.MultiDayMinute.Count<=1||this.ChartBorder.MultiDayMinute.Right<=0)&&this.MultiDayAfterCloseData){var e=0,a=this.MultiDayAfterCloseData.length;this.DayOffset&&(v.IsNumber(this.DayOffset.Offset)&&(e=this.DayOffset.Offset),v.IsNumber(this.DayOffset.ShowDayCount)&&(a=this.DayOffset.ShowDayCount));for(var r=e,t=0;r<this.MultiDayAfterCloseData.length&&t<a;++r,++t){var n=this.MultiDayAfterCloseData[r];this.DrawCallAuction(t,n,!1)}}},this.DrawCallAuction=function(e,a,r){if(a){a.Index=e;var t=this.ChartFrame.IsHScreen===!0,h=!0,u=0;if(a.TotalCount,a.Ver==3){for(var n=0;n<a.Data.length;++n){var s=a.Data[n];if(!(!s||!v.IsNumber(s.AvPrice))){if(r)var o=this.ChartFrame.GetLeftExtendXFromIndex(n,a),l=this.ChartFrame.GetLeftExtendYFromData(s.AvPrice);else var o=this.ChartFrame.GetRightExtendXFromIndex(n,a),l=this.ChartFrame.GetRightExtendYFromData(s.AvPrice);h?(this.Canvas.strokeStyle=this.BeforeAvPriceColor,this.Canvas.beginPath(),t?this.Canvas.moveTo(l,o):this.Canvas.moveTo(o,l),h=!1):t?this.Canvas.lineTo(l,o):this.Canvas.lineTo(o,l),++u}}u>0&&this.Canvas.stroke()}for(var h=!0,u=0,f=[],n=0;n<a.Data.length;++n){var s=a.Data[n];if(!s||!v.IsNumber(s.Price)){if(n==0&&r&&v.IsNumber(this.YClose)){var o=this.ChartFrame.GetLeftExtendXFromIndex(n,a),l=this.ChartFrame.GetLeftExtendYFromData(this.YClose);this.Canvas.strokeStyle=this.BeforeLineColor,this.Canvas.beginPath(),t?this.Canvas.moveTo(l,o):this.Canvas.moveTo(o,l),h=!1}continue}if(r)var o=this.ChartFrame.GetLeftExtendXFromIndex(n,a),l=this.ChartFrame.GetLeftExtendYFromData(s.Price);else var o=this.ChartFrame.GetRightExtendXFromIndex(n,a),l=this.ChartFrame.GetRightExtendYFromData(s.Price);h?(this.Canvas.strokeStyle=r?this.BeforeLineColor:this.AfterLineColor,this.Canvas.beginPath(),t?this.Canvas.moveTo(l,o):this.Canvas.moveTo(o,l),h=!1,f.push({X:o,Y:l})):(t?this.Canvas.lineTo(l,o):this.Canvas.lineTo(o,l),f.push({X:o,Y:l}));var C=s.Date*1e6+s.Time;this.UpdateLastPoint(C,o,l,{Value:s.Price,Index:n,Date:s.Date,Time:s.Time,Type:r?1:2,Explain:r?"盘前":"盘后"}),++u}if(u>0&&this.Canvas.stroke(),a.Ver==2&&this.BeforePoint.Radius>0){this.Canvas.fillStyle=r?this.BeforePoint.Color:this.AfterPoint.Color;for(var n in f){var s=f[n];this.Canvas.beginPath(),t?this.Canvas.arc(s.Y,s.X,this.BeforePoint.Radius,0,2*Math.PI):this.Canvas.arc(s.X,s.Y,this.BeforePoint.Radius,0,2*Math.PI),this.Canvas.fill()}}}},this.FindColorLineItem=function(e){if(!e||!this.ColorLineData)return null;for(var a in this.ColorLineData){var r=this.ColorLineData[a];if(r.Date==e.Date&&e.Time>=r.Start&&e.Time<=r.End)return r}return null},this.DrawColorLine=function(){if(!(!this.ColorLineData||!this.Source||!this.Data)){var e=this.ChartFrame.IsHScreen===!0;this.ChartBorder.GetBorder();var a=this.ChartFrame.XPointCount;this.ChartFrame.MinuteCount;var r=this.Data,t=!0,n=0,s=null;this.Canvas.save();for(var o=r.DataOffset,l=0;o<r.Data.length&&l<a;++o,++l){var h=null;h=r.Data[o];var u=this.Source.Data[o];if(!(!h||!u)){var f=this.FindColorLineItem(u);if(!f){n>0&&(this.Canvas.stroke(),t=!0);continue}s&&s!=f.Color&&(this.Canvas.stroke(),t=!0);var C=this.ChartFrame.GetXFromIndex(l),D=this.ChartFrame.GetYFromData(h);t?(this.Canvas.strokeStyle=f.Color,v.IsNumber(f.LineWidth)&&(this.Canvas.lineWidth=f.LineWidth),this.Canvas.beginPath(),e?this.Canvas.moveTo(D,C):this.Canvas.moveTo(C,D),t=!1,s=f.Color):e?this.Canvas.lineTo(D,C):this.Canvas.lineTo(C,D),++n}}n>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.GetMaxMin=function(){if(this.DrawType==14&&this.FFMChart&&this.FFMChart.GetMaxMin)return this.FFMChart.GetMaxMin(this);var e=this.ChartFrame.XPointCount,a={};if(this.YClose==null||!this.IsShow)return a;if(a.Min=this.YClose,a.Max=this.YClose,this.ChartBorder.LeftExtendWidth>10&&this.BeforeOpenData)for(var r in this.BeforeOpenData.Data){var t=this.BeforeOpenData.Data[r];t&&(v.IsNumber(t.Price)&&(a.Max==null&&(a.Max=t.Price),a.Min==null&&(a.Min=t.Price),a.Max<t.Price&&(a.Max=t.Price),a.Min>t.Price&&(a.Min=t.Price)),this.BeforeOpenData.Ver==3&&v.IsNumber(t.AvPrice)&&(a.Max==null&&(a.Max=t.AvPrice),a.Min==null&&(a.Min=t.AvPrice),a.Max<t.AvPrice&&(a.Max=t.AvPrice),a.Min>t.AvPrice&&(a.Min=t.AvPrice)))}for(var n=this.Data,r=n.DataOffset,s=0;r<n.Data.length&&s<e;++r,++s){var o=null;o=n.Data[r],o!=null&&(a.Max==null&&(a.Max=o),a.Min==null&&(a.Min=o),a.Max<o&&(a.Max=o),a.Min>o&&(a.Min=o))}if(a.Max==this.YClose&&a.Min==this.YClose)return a.Max=this.YClose+this.YClose*.1,a.Min=this.YClose-this.YClose*.1,a;var l=Math.max(Math.abs(this.YClose-a.Max),Math.abs(this.YClose-a.Min));return a.Max=this.YClose+l,a.Min=this.YClose-l,a},this.GetTooltipData=function(e,a,r){var t=this.ChartFrame.IsHScreen===!0;if(t||!this.IsShow||!this.Data||!v.IsNonEmptyArray(this.Data.Data))return!1;var n=this.ChartBorder.PtInClient(e,a,this.Canvas,t);if(n!=1)return!1;var s=this.Data,o=this.ChartFrame.GetXData(e),l=Math.ceil(o),h=Math.floor(o);if(l>=s.Data.length||h>=s.Data.length)return!1;var u=5;if(l==h)s.Data[h];else{var f=s.Data[h],C=s.Data[l],D={X:this.ChartFrame.GetXFromIndex(h),Y:this.ChartFrame.GetYFromData(f)},c={X:this.ChartFrame.GetXFromIndex(l),Y:this.ChartFrame.GetYFromData(C)};if(this.Canvas.beginPath(),this.Canvas.moveTo(D.X,D.Y+u),this.Canvas.lineTo(D.X,D.Y-u),this.Canvas.lineTo(c.X,c.Y-u),this.Canvas.lineTo(c.X,c.Y+u),this.Canvas.closePath(),this.Canvas.isPointInPath(e,a))return r.Data={Index:o,Start:{Index:h,Item:s.Data[h]},End:{Index:l,Value:s.Data[l]}},r.ChartPaint=this,r.Type=5,!0}return!1}}function rn(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.Color="rgb(65,105,225)",this.MainData,this.SourceData,this.ClassName="ChartOverlayMinutePriceLine",this.Title,this.Symbol,this.Status=Le.STATUS_NONE_ID,this.OverlayType=0,this.IsCalcuateMaxMin=!0,this.SetOption=function(e){e&&(v.IsNumber(e.OverlayType)&&(this.OverlayType=e.OverlayType),v.IsBool(e.IsCalcuateMaxMin)&&(this.IsCalcuateMaxMin=e.IsCalcuateMaxMin))},this.PtInChart=function(e,a){var r={MinuteOverlayPrice:!0,OverlayType:this.OverlayType};return this.PtInLine(e,a,r)},this.DrawSelectedStatus=function(){var e={MinuteOverlayPrice:!0,OverlayType:this.OverlayType};this.DrawLinePoint(e)},this.Draw=function(){if(this.Data&&v.IsNonEmptyArray(this.Data.Data)){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}var e=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight(),e===!0&&this.ChartBorder.GetBottom();var a=this.ChartFrame.XPointCount,r=this.ChartFrame.MinuteCount;this.Canvas.save(),this.ClipClient(e);for(var t=!0,n=0,s=0,o=0,l=null,h=null,u=0,f=this.Data.DataOffset+s,C=0;f<this.Data.Data.length&&C<a;++f,++C){var D=this.Data.Data[f];if(D&&v.IsNumber(D.Close)){if(t){l=D.YClose;var c=this.MainData.Data[f];h=c.YClose}var T=D.Close;o=T,this.OverlayType==0&&(o=T/l*h);var S=this.ChartFrame.GetXFromIndex(C),I=this.ChartFrame.GetYFromData(o,!1);t?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),e?this.Canvas.moveTo(I,S):this.Canvas.moveTo(S,I),t=!1):e?this.Canvas.lineTo(I,S):this.Canvas.lineTo(S,I),++n}++u,u>=r&&(t=!0,u=0,n>0&&this.Canvas.stroke(),n=0)}n>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a={Min:null,Max:null};if(!this.IsCalcuateMaxMin)return a;for(var r=this.ChartFrame.MinuteCount,t=null,n=null,s=!0,o=0,l=this.Data.DataOffset,h=0;l<this.Data.Data.length&&h<e;++l,++h){var u=this.Data.Data[l];if(!u||!v.IsNumber(u.Close)){++o;continue}if(s){t=u.YClose;var f=this.MainData.Data[l];n=f.YClose,s=!1}var C=u.Close;this.OverlayType==0&&(C=C/t*n),a.Max==null&&(a.Max=C),a.Min==null&&(a.Min=C),a.Max<C&&(a.Max=C),a.Min>C&&(a.Min=C),++o,o>=r&&(s=!0,o=0)}return a},this.GetTooltipData=function(e,a,r){var t=this.ChartFrame.IsHScreen===!0;if(t||!this.IsShow||!this.Data||!v.IsNonEmptyArray(this.Data.Data)||!v.IsNumber(this.YClose)||!v.IsNumber(this.MainYClose))return!1;var n=this.ChartBorder.PtInClient(e,a,this.Canvas,t);if(n!=1)return!1;var s=this.Data,o=this.ChartFrame.GetXData(e),l=Math.ceil(o),h=Math.floor(o);if(l>=s.Data.length||h>=s.Data.length)return!1;var u=5;if(l==h)s.Data[h];else{var f=s.Data[h].Close;f=f/this.YClose*this.MainYClose;var C=s.Data[l].Close;C=C/this.YClose*this.MainYClose;var D={X:this.ChartFrame.GetXFromIndex(h),Y:this.ChartFrame.GetYFromData(f)},c={X:this.ChartFrame.GetXFromIndex(l),Y:this.ChartFrame.GetYFromData(C)};if(this.Canvas.beginPath(),this.Canvas.moveTo(D.X,D.Y+u),this.Canvas.lineTo(D.X,D.Y-u),this.Canvas.lineTo(c.X,c.Y-u),this.Canvas.lineTo(c.X,c.Y+u),this.Canvas.closePath(),this.Canvas.isPointInPath(e,a))return r.Data={Index:o,Start:{Index:h,Item:s.Data[h]},End:{Index:l,Value:s.Data[l]}},r.ChartPaint=this,r.Type=6,!0}return!1}}function cf(){this.newMethod=va,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinutePositionLine",this.Draw=function(){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(this.IsShow){var e=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight(),e===!0&&this.ChartBorder.GetBottom();var a=this.ChartFrame.XPointCount,r=this.ChartFrame.MinuteCount;this.ChartBorder.GetBottomEx(),this.ChartBorder.GetLeftEx();var t=this.Data;if(t){var n=!0,s={},o=0,l=0;this.Canvas.save(),v.IsPlusNumber(this.LineWidth>0)&&(this.Canvas.lineWidth=this.LineWidth),this.IsDotLine&&this.Canvas.setLineDash(d.DOTLINE.LineDash);for(var h=t.DataOffset,u=0;h<t.Data.length&&u<a;++h,++u){var f=null;if(f=t.Data[h],++l,f!=null){var C=this.ChartFrame.GetXFromIndex(u),D=this.ChartFrame.GetYFromData(f);n?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),e?this.Canvas.moveTo(D,C):this.Canvas.moveTo(C,D),n=!1,s={X:C,Y:D}):e?this.Canvas.lineTo(D,C):this.Canvas.lineTo(C,D),++o,l>=r&&(n=!0,this.Canvas.stroke(),l=0,o=0)}}o>0&&(o==1?(this.Canvas.beginPath(),e?this.Canvas.arc(s.Y,s.X,1,0,360,!1):this.Canvas.arc(s.X,s.Y,1,0,360,!1),this.Canvas.closePath(),this.Canvas.fillStyle=this.Color,this.Canvas.fill()):this.Canvas.stroke()),this.Canvas.restore()}}}}function Xd(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinuteInfo",this.Data=new Dt.default,this.SourceData,this.ChartMinutePrice,this.YClose,this.HQChartBorder,this.TextColor=d.MinuteInfo.TextColor,this.Font=d.MinuteInfo.Font,this.PointColor=d.MinuteInfo.PointColor,this.PointRadius=d.MinuteInfo.PointRadius,this.LineColor=d.MinuteInfo.LineColor,this.TextBGColor=d.MinuteInfo.TextBGColor,this.PixelTatio=B(),this.TextHeight=20,this.TextRectCache=[],this.InfoDrawCache=[],this.FrameBottom,this.FrameTop,this.FrameLeft,this.FrameRight,this.YOffset=5,this.IsHScreen=!1,this.IsDrawFull=!1,this.TooltipRect=[],this.SetOption=function(e){e.TextColor&&(this.TextColor=e.TextColor),e.TextBGColor&&(this.TextBGColor=e.TextBGColor),e.Font&&(this.Font=e.Font),e.PointColor&&(this.PointColor=e.PointColor),e.LineColor&&(this.LineColor=e.LineColor),e.TextHeight>0&&(this.TextHeight=e.TextHeight),e.IsDrawFull==!0&&(this.IsDrawFull=!0)},this.Draw=function(){if(this.TooltipRect=[],!!this.ChartMinutePrice&&!(!this.Data||this.Data.size<=0)){this.TextRectCache=[],this.InfoDrawCache=[],this.PixelTatio=B(),this.YOffset=5*this.PixelTatio,this.IsHScreen=this.ChartFrame.IsHScreen===!0;var e=this.ChartFrame.XPointCount;this.ChartFrame.MinuteCount,this.FrameBottom=this.ChartBorder.GetBottom(),this.IsDrawFull&&this.HQChartBorder&&(this.FrameBottom=this.HQChartBorder.GetBottom()),this.FrameTop=this.ChartBorder.GetTop(),this.FrameLeft=this.ChartBorder.GetLeft(),this.FrameRight=this.ChartBorder.GetRight(),this.IsHScreen&&(this.FrameRight=this.ChartBorder.GetBottom(),this.FrameLeft=this.ChartBorder.GetTop(),this.FrameBottom=this.ChartBorder.GetLeft(),this.FrameTop=this.ChartBorder.GetRight()),this.YClose=this.ChartMinutePrice.YClose;for(var a=this.ChartMinutePrice.Source,r=a.DataOffset,t=0;r<a.Data.length&&t<e;++r,++t){var n=a.Data[r];if(n){var s=n.DateTime;this.Data.has(s)&&(this.IsHScreen?this.CalcuateInfoHScreenPosition(this.Data.get(s),t,n):this.CalcuateInfoPosition(this.Data.get(s),t,n))}}for(var r in this.InfoDrawCache){var n=this.InfoDrawCache[r];this.DrawInfoLines(n)}for(var r in this.InfoDrawCache){var n=this.InfoDrawCache[r];if(this.DrawInfoText(n),!this.IsHScreen){var o=n.Border,l=new Ia(o.X,o.Y,o.Width,o.Height),h={Data:{Item:n},Rect:l};this.TooltipRect.push(h)}}this.TextRectCache=[],this.InfoDrawCache=[]}},this.CalcuateInfoPosition=function(e,a,r){if(!(!e||!e.Data||e.Data.length<=0)){var t=e.Data[0];this.Canvas.font=this.Font;var n=this.Canvas.measureText(t.Title).width+4*this.PixelTatio,s=this.TextHeight*this.PixelTatio,o=this.ChartFrame.GetXFromIndex(a),l;v.IsNumber(t.Price)?l=this.ChartFrame.GetYFromData(t.Price):l=this.ChartFrame.GetYFromData(r.Close),o=L(o);var h=o<this.FrameLeft+Math.abs(this.FrameLeft-this.FrameRight)/2,u=[2,4,6,8,3,5,7],f=s+u[a%u.length]*this.PixelTatio,C={Y:[{Value:l+(s+this.YOffset),Offset:f},{Value:l-(2*s+this.YOffset),Offset:-f}]};r.Close<this.YClose&&(C.Y=C.Y.reverse());var D={X:o,Y:null,Width:n,Height:s};h||(D.X-=D.Width),this.FixTextRect(D,C);var c={Border:D,Start:{X:o,Y:l},IsLeft:h,Title:t.Title,Date:t.Date,Time:t.Time};t.Content&&(c.Content=t.Content),t.Link&&(c.Link=t.Link),t.Color&&(c.Color=t.Color),t.BGColor&&(c.BGColor=t.BGColor),this.InfoDrawCache.push(c),this.TextRectCache.push(D)}},this.CalcuateInfoHScreenPosition=function(e,a,r){if(!(!e||!e.Data||e.Data.length<=0)){var t=e.Data[0];this.Canvas.font=this.Font;var n=this.Canvas.measureText(t.Title).width+4*this.PixelTatio,s=this.TextHeight*this.PixelTatio,o=this.ChartFrame.GetXFromIndex(a),l;v.IsNumber(t.Price)?l=this.ChartFrame.GetYFromData(t.Price):l=this.ChartFrame.GetYFromData(r.Close),o=L(o);var h=o<this.FrameLeft+Math.abs(this.FrameLeft-this.FrameRight)/2,u=[2,4,6,8,3,5,7],f=s+u[a%u.length]*this.PixelTatio,C={X:[{Value:l+(s+this.YOffset),Offset:f},{Value:l-(2*s+this.YOffset),Offset:-f}]};r.Close>this.YClose&&(C.X=C.X.reverse());var D={X:null,Y:o,Width:s,Height:n};h||(D.Y-=D.Height),this.FixHScreenTextRect(D,C);var c={Border:D,Start:{X:l,Y:o},IsLeft:h,Title:t.Title};t.Content&&(c.Content=t.Content),t.Link&&(c.Link=t.Link),t.Color&&(c.Color=t.Color),t.BGColor&&(c.BGColor=t.BGColor),this.InfoDrawCache.push(c),this.TextRectCache.push(D)}},this.DrawInfoLines=function(e){var a=e.Border,r=e.IsLeft;this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(e.Start.X),e.Start.Y),r?this.Canvas.lineTo(L(e.Start.X),a.Y):this.IsHScreen?this.Canvas.lineTo(a.X,a.Y+a.Height):this.Canvas.lineTo(L(e.Start.X),a.Y),this.Canvas.stroke(),this.Canvas.fillStyle=this.PointColor,this.Canvas.beginPath(),this.Canvas.arc(e.Start.X,e.Start.Y,this.PointRadius,0,2*Math.PI),this.Canvas.closePath(),this.Canvas.fill()},this.DrawInfoText=function(e){var a=e.Border,r=a.X,t=a.Y;e.BGColor?this.Canvas.fillStyle=e.BGColor:this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(r,t,a.Width,a.Height),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.rect(r,t,a.Width,a.Height),this.Canvas.stroke(),this.IsHScreen&&(this.Canvas.save(),this.Canvas.translate(a.X,a.Y),this.Canvas.rotate(90*Math.PI/180),r=0,t=0),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",e.Color?this.Canvas.fillStyle=e.Color:this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.IsHScreen?this.Canvas.fillText(e.Title,r+2*this.PixelTatio,t-a.Width/2):this.Canvas.fillText(e.Title,r+2*this.PixelTatio,t+a.Height/2),this.IsHScreen&&this.Canvas.restore()},this.FixTextRect=function(e,a){for(var r in a.Y){var t=a.Y[r];e.Y=t.Value;for(var n,s=0;s<10;++s){var o=!1;for(var l in this.TextRectCache){var h=this.TextRectCache[l];if(this.IsOverlap(h,e)){o=!0;break}}if(o==!1)return;if(n=e.Y,n+=t.Offset,n+e.Height>this.FrameBottom||n<this.FrameTop)break;e.Y=n}}},this.FixHScreenTextRect=function(e,a){for(var r in a.X){var t=a.X[r];e.X=t.Value;for(var n,s=0;s<10;++s){var o=!1;for(var l in this.TextRectCache){var h=this.TextRectCache[l];if(this.IsOverlap(h,e)){o=!0;break}}if(o==!1)return;if(n=e.X,n+=t.Offset,n+e.Width<this.FrameBottom||n>this.FrameTop)break;e.X=n}}},this.IsOverlap=function(e,a){return e.X+e.Width>a.X&&a.X+a.Width>e.X&&e.Y+e.Height>a.Y&&a.Y+a.Height>e.Y},this.GetMaxMin=function(){var e={Min:null,Max:null};return e},this.GetTooltipData=function(e,a,r){for(var t in this.TooltipRect){var n=this.TooltipRect[t];if(n.Rect){var s=n.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(s.X,s.Y,s.Width,s.Height),this.Canvas.isPointInPath(e,a))return r.Data=n,r.ChartPaint=this,r.Type=3,!0}}return!1}}function il(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMACD",this.UpColor=d.UpBarColor,this.DownColor=d.DownBarColor,this.LineWidth=1,this.DrawSelectedStatus=this.DrawLinePoint,this.ExportData=this.ExportArrayData,this.PtInChart=function(e,a){var r=this.ChartFrame.DataWidth,t=this.LineWidth*B();return this.barWidth==50?t=null:t>r&&(t=r),t<4&&(t=4),this.PtInBar(e,a,{BarWidth:t})},this.DrawBars=function(e,a){var r=this.IsMinuteFrame(),t=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,s=this.ChartFrame.XPointCount,o=this.ChartFrame.IsHScreen===!0;if(o){var l=this.ChartBorder.GetHScreenBorder(),h=l.TopEx+n/2+d.FrameLeftMargin,u=l.BottomEx,f=this.GetLockRect();f&&(u=f.Top)}else{var l=this.ChartBorder.GetBorder(),h=l.LeftEx+n/2+d.FrameLeftMargin,u=l.RightEx,f=this.GetLockRect();f&&(u=f.Left)}a?this.Canvas.strokeStyle=this.UpColor:this.Canvas.strokeStyle=this.DownColor;var C=this.ChartFrame.GetYFromData(0);this.Canvas.beginPath();for(var D=0,c=this.Data.DataOffset,T=0;c<this.Data.Data.length&&T<s;++c,++T,h+=t+n){var S=this.Data.Data[c];if(S!=null){if(a){if(S<0)continue}else if(S>=0)continue;if(r)var I=this.ChartFrame.GetXFromIndex(T);else{var g=h,E=h+t;if(E>u)break;var I=g+(E-g)/2}if(I>u)break;var F=this.ChartFrame.GetYFromData(S),R=$t(e,I);o?(this.Canvas.moveTo(C,L(I)),this.Canvas.lineTo(F,L(I))):(this.Canvas.moveTo(R,C),this.Canvas.lineTo(R,F)),++D}}D>0&&this.Canvas.stroke()},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}var e=this.ChartFrame.DataWidth,a=this.LineWidth*B();(this.LineWidth==50||a>e)&&(a=e);var r=this.Canvas.lineWidth;this.Canvas.lineWidth=a,this.DrawBars(a,!0),this.DrawBars(a,!1),this.Canvas.lineWidth=r}},this.GetItemData=function(e){if(!e||!v.IsNumber(e.Index)||!this.Data||!v.IsNonEmptyArray(this.Data.Data))return null;var a=e.Index;if(a<0||a>=this.Data.Data.length)return null;var r=this.Data.Data[a];return[{Value:r,Color:r>0?this.UpColor:this.DownColor,Name:this.Name}]}}function kd(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartClipColorStick",this.UpColor=d.UpBarColor,this.DownColor=d.DownBarColor,this.LineWidth=1,this.Style=0,this.DownDiffColor=d.DownBarColor,this.UpDiffColor=d.UpBarColor,this.TextLabelConfig={Font:12*B()+"px 微软雅黑",TextMargin:{Left:2,Right:2,Bottom:2,Top:2},TextColor:"rgb(230,230,230)",UpColor:"rgb(137,16,19)",DownColor:"rgb(44,104,57)",UnchangeColor:"rgb(111,112,115)",BorderColor:"rgb(0,0,0)",LabelWidth:0,TextHeight:0,MaxTextWidth:0},this.BaseLineColor,this.BaseValue=0,this.Super_GetMaxMin=this.GetMaxMin,this.ValueRange,this.IsShowText=!1,this.SetOption=function(e){e&&(e.UpColor&&(this.UpColor=e.UpColor),e.DownColor&&(this.DownColor=e.DownColor),e.DownDiffColor&&(this.DownDiffColor=e.DownDiffColor),e.UpDiffColor&&(this.UpDiffColor=e.UpDiffColor),e.BaseLineColor&&(this.BaseLineColor=e.BaseLineColor),v.IsNumber(e.BaseValue)&&(this.BaseValue=e.BaseValue),v.IsNumber(e.Style)&&(this.Style=e.Style),e.ValueRange&&(this.ValueRange=e.ValueRange))},this.Draw=function(){if(this.IsShowText=!1,this.TextLabelConfig.LabelWidth=0,this.TextLabelConfig.TextHeight=0,this.TextLabelConfig.MaxTextWidth=0,!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}var e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,r=this.ChartFrame.XPointCount,t=this.ChartFrame.IsHScreen===!0,n=this.LineWidth*B();if((this.LineWidth==50||n>e)&&(n=e),!t){var s=e+a,o=this.IsMinuteFrame();if(o){var l=this.ChartBorder.GetBorder();s=(l.Right-l.Left)/(r-1)}this.Canvas.font=this.TextLabelConfig.Font,this.TextLabelConfig.MaxTextWidth=this.Canvas.measureText("-888").width,this.TextLabelConfig.LabelWidth=this.TextLabelConfig.MaxTextWidth+this.TextLabelConfig.TextMargin.Left+this.TextLabelConfig.TextMargin.Right,this.IsShowText=s>this.TextLabelConfig.LabelWidth,this.TextLabelConfig.TextHeight=this.Canvas.measureText("擎").width}this.Canvas.save(),v.IsNumber(this.BaseValue)&&this.BaseValue!=0?(this.DrawBaseLine(),this.BaseValue>0?this.DrawBars(n,!0,!0):this.DrawBars(n,!1,!0)):(this.DrawBars(n,!0,!0),this.DrawBars(n,!1)),this.Canvas.restore()}},this.DrawBars=function(e,a,r){var t=this.IsMinuteFrame(),n=this.ChartFrame.DataWidth,s=this.ChartFrame.DistanceWidth,o=this.ChartFrame.XPointCount,l=this.ChartFrame.IsHScreen===!0;if(l){var h=this.ChartBorder.GetHScreenBorder(),u=h.TopEx+s/2+d.FrameLeftMargin,f=h.BottomEx,C=this.GetLockRect();C&&(f=C.Top)}else{var h=this.ChartBorder.GetBorder(),u=h.LeftEx+s/2+d.FrameLeftMargin,f=h.RightEx,C=this.GetLockRect();C&&(f=C.Left)}var D=this.ChartFrame.GetYFromData(this.BaseValue),c=[],T=[],S=[],I=null,g=this.Data.DataOffset;g-1>0&&(I=this.Data.Data[g-1]);for(var E=g,F=0;E<this.Data.Data.length&&F<o;++E,++F,u+=n+s){var R=this.Data.Data[E];if(R!=null){if(t)var A=this.ChartFrame.GetXFromIndex(F);else{var P=u,p=u+n;if(p>f)break;var A=P+(p-P)/2}if(A>f)break;var w={X:A,Value:R};if(v.IsNumber(I)&&(w.DiffValue=R-I),S.push(w),I=R,a){if(R<0)continue}else if(R>=0)continue;var H=!1,W=null;if(this.BaseValue>0?R<this.BaseValue&&(H=!0,this.Style==1?W=this.BaseValue+(this.BaseValue-R):W=this.BaseValue-(this.BaseValue-R)):this.BaseValue<0&&R>this.BaseValue&&(H=!0,this.Style==1?W=this.BaseValue-(R-this.BaseValue):W=this.BaseValue+(R-this.BaseValue)),H){var ht=this.ChartFrame.GetYFromData(W);T.push({X:A,Y:ht})}else{var ht=this.ChartFrame.GetYFromData(R);c.push({X:A,Y:ht})}}}this.Canvas.lineWidth=e,a?this.Canvas.strokeStyle=this.UpColor:this.Canvas.strokeStyle=this.DownColor,this.DrawStick(c,e,D),this.BaseValue>0?(this.Canvas.strokeStyle=this.UpDiffColor,this.DrawStick(T,e,D)):this.BaseValue<0&&(this.Canvas.strokeStyle=this.DownDiffColor,this.DrawStick(T,e,D)),this.IsShowText&&r&&this.DrawStickText(S)},this.DrawStick=function(e,a,r){if(v.IsNonEmptyArray(e)){var t=this.ChartFrame.IsHScreen===!0,n=0;this.Canvas.beginPath();for(var s=0;s<e.length;++s){var o=e[s],l=o.Y,h=$t(a,o.X);t?(this.Canvas.moveTo(r,L(x)),this.Canvas.lineTo(l,L(x))):(this.Canvas.moveTo(h,r),this.Canvas.lineTo(h,l)),++n}n>0&&this.Canvas.stroke()}},this.DrawBaseLine=function(){if(!(!v.IsNumber(this.BaseValue)||this.BaseValue==0)&&this.BaseLineColor){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.GetBorder(),r=this.ChartFrame.GetYFromData(this.BaseValue);if(this.Canvas.strokeStyle=this.BaseLineColor,this.Canvas.lineWidth=1*B(),!e){var t=L(r);this.Canvas.beginPath(),this.Canvas.moveTo(a.Left,t),this.Canvas.lineTo(a.Right,t),this.Canvas.stroke()}}},this.DrawStickText=function(e){var a=this.TextLabelConfig;this.Canvas.font=a.Font;for(var r=this.ChartBorder.GetBorder(),t=a.TextHeight*2+a.TextMargin.Bottom+a.TextMargin.Top,n=0;n<e.length;++n){var s=e[n],u=s.Value,o=s.X,l=o-a.LabelWidth/2,f={Left:l,Width:a.LabelWidth,Top:r.BottomEx+1,Height:t};if(f.Right=f.Left+f.Width,f.Bottom=f.Top+f.Height,v.IsNumber(u)){var h=a.UnchangeColor;u>0?h=a.UpColor:u<0&&(h=a.DownColor),this.DrawTextLabel(u,h,a.BorderColor,a.TextColor,f,a.TextHeight,a.MaxTextWidth,a.TextMargin)}var u=s.DiffValue,f={Left:l,Width:a.LabelWidth,Bottom:r.TopEx-1,Height:t};if(f.Right=f.Left+f.Width,f.Top=f.Bottom-f.Height,v.IsNumber(u)){var h=a.UnchangeColor;u>0?h=a.UpColor:u<0&&(h=a.DownColor),this.DrawTextLabel(u,h,a.BorderColor,a.TextColor,f,a.TextHeight,a.MaxTextWidth,a.TextMargin)}}},this.DrawTextLabel=function(e,a,r,t,n,s,o,l){a&&(this.Canvas.fillStyle=a,this.Canvas.fillRect(n.Left,n.Top,n.Width,n.Height)),r?(this.Canvas.lineWidth=2,this.Canvas.strokeStyle=r,this.Canvas.strokeRect(n.Left,n.Top,n.Width,n.Height)):(this.Canvas.lineWidth=1,this.Canvas.strokeStyle="rgb(0,0,0)",this.Canvas.strokeRect(n.Left,n.Top,n.Width,n.Height));var h=[null,null],u="";if(e<0&&(e=Math.abs(e),u="-"),e>999){var f=parseInt(e/1e3),C=parseInt(e%1e3);h[0]=""+u+f,h[1]=""+C,C<10?h[1]="00"+C:C<100&&(h[1]="0"+C)}else h[1]=""+u+e.toFixed(0);this.Canvas.textAlign="right",this.Canvas.textBaseline="top";var D=n.Right-(n.Right-n.Left-o)/2;this.Canvas.fillStyle=t;for(var c=l.Top+n.Top,T=0;T<h.length;++T){var S=h[T];S&&this.Canvas.fillText(S,D,c),c+=s}},this.GetMaxMin=function(){if(!v.IsNumber(this.BaseValue)||this.BaseValue==0)return this.Super_GetMaxMin();if(this.ValueRange){var r={Min:this.ValueRange.Min,Max:this.ValueRange.Max};return r}var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset;this.ChartFrame.GlobalOption&&this.ChartFrame.GlobalOption.IsValueFullRange&&(a=0,e=this.Data.Data.length);var r={Min:null,Max:null},t=null;if(!this.Data||!this.Data.Data)return r;this.BaseValue>0?r.Min=this.BaseValue:r.Max=this.BaseValue;for(var n=a,s=0;n<this.Data.Data.length&&s<e;++n,++s){var o=this.Data.Data[n];if(!(o==null||isNaN(o))){if(this.BaseValue>0){if(o<0)continue;if(o<this.BaseValue){var l=this.BaseValue-o;(t==null||t<l)&&(t=l);continue}}else{if(o>0)continue;if(o>this.BaseValue){var l=o-this.BaseValue;(t==null||t<l)&&(t=l);continue}}r.Max==null&&(r.Max=o),r.Min==null&&(r.Min=o),r.Max<o&&(r.Max=o),r.Min>o&&(r.Min=o)}}if(this.BaseValue>0)if(this.Style==1){if(v.IsNumber(t)){var o=this.BaseValue+t;(v.IsNumber(r.Max)||r.Max<o)&&(r.Max=o)}}else v.IsNumber(t)&&v.IsNumber(r.Min)&&(r.Min-=t);else if(this.Style==1){if(v.IsNumber(t)){var o=this.BaseValue-t;(v.IsNumber(r.Min)||r.Min>o)&&(r.Min=o)}}else v.IsNumber(t)&&v.IsNumber(r.Max)&&(r.Max+=t);return r}}function XC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.ClassName="ChartBand",this.FirstColor=d.Index.LineColor[0],this.SecondColor=d.Index.LineColor[1],this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}for(var e=this.IsMinuteFrame(),a=this.ChartFrame.IsHScreen,r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartFrame.XPointCount,s=this.ChartBorder.GetLeft()+t/2+2,o=0,l=0,h=0,u=[],f=[],C=this.Data.DataOffset,D=0;C<this.Data.Data.length&&D<n;++C,++D,s+=r+t){for(u=[],f=[];C<this.Data.Data.length&&D<n;++C,++D,s+=r+t){var c=this.Data.Data[C];if(c==null||c.Value==null||c.Value2==null)break;if(e)o=this.ChartFrame.GetXFromIndex(D);else{var T=s,S=s+r;o=T+(S-T)/2}l=this.ChartFrame.GetYFromData(c.Value),h=this.ChartFrame.GetYFromData(c.Value2),a?(u.push({x:l,y:o}),f.push({x:h,y:o})):(u.push({x:o,y:l}),f.push({x:o,y:h}))}u.length>1&&f.length>1&&this.DrawBand(u,f)}}},this.ClipTop=function(e){var a=this.ChartFrame.IsHScreen;this.Canvas.beginPath();for(var r=0;r<e.length;++r)r==0?this.Canvas.moveTo(e[r].x,e[r].y):this.Canvas.lineTo(e[r].x,e[r].y);var t=e[0],n=e[e.length-1];if(a){var s=this.ChartBorder.GetRightEx();this.Canvas.lineTo(s,n.y),this.Canvas.lineTo(s,t.y)}else{var o=this.ChartBorder.GetTopEx();this.Canvas.lineTo(n.x,o),this.Canvas.lineTo(t.x,o)}this.Canvas.closePath(),this.Canvas.clip()},this.ClipBottom=function(e){var a=this.ChartFrame.IsHScreen;this.Canvas.beginPath();for(var r=0;r<e.length;++r)r==0?this.Canvas.moveTo(e[r].x,e[r].y):this.Canvas.lineTo(e[r].x,e[r].y);var t=e[0],n=e[e.length-1];if(a){var s=this.ChartBorder.GetLeftEx();this.Canvas.lineTo(s,n.y),this.Canvas.lineTo(s,t.y)}else{var o=this.ChartBorder.GetBottomEx();this.Canvas.lineTo(n.x,o),this.Canvas.lineTo(t.x,o)}this.Canvas.closePath(),this.Canvas.clip()},this.DrawArea=function(e,a,r){this.Canvas.beginPath();for(var t=0;t<e.length;++t)t==0?this.Canvas.moveTo(e[t].x,e[t].y):this.Canvas.lineTo(e[t].x,e[t].y);for(var t=a.length-1;t>=0;--t)this.Canvas.lineTo(a[t].x,a[t].y);this.Canvas.closePath(),this.Canvas.fillStyle=r,this.Canvas.fill()},this.DrawBand=function(e,a){this.FirstColor&&(this.Canvas.save(),this.ClipTop(e),this.DrawArea(e,a,this.FirstColor),this.Canvas.restore()),this.SecondColor&&(this.Canvas.save(),this.ClipBottom(e),this.DrawArea(e,a,this.SecondColor),this.Canvas.restore())},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a={};a.Min=null,a.Max=null;for(var r=this.Data.DataOffset,t=0;r<this.Data.Data.length&&t<e;++r,++t){var n=this.Data.Data[r];if(!(n==null||n.Value==null||n.Value2==null)){var s=n.Value>n.Value2?n.Value:n.Value2,o=n.Value<n.Value2?n.Value:n.Value2;(a.Max==null||a.Max<s)&&(a.Max=s),(a.Min==null||a.Min>o)&&(a.Min=o)}}return a}}function kC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.ClassName="ChartLineArea",this.Color="rgb(56,67,99)",this.IsHScreen=!1,this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){for(var e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,r=this.ChartFrame.XPointCount,t=this.ChartBorder.GetLeft()+a/2+d.FrameLeftMargin,n=0,s=0,o=0,l=[],h=this.Data.DataOffset,u=0;h<this.Data.Data.length&&u<r;++h,++u,t+=e+a){var f=this.Data.Data[h];l[h]=null,!(f==null||f.Value==null||f.Value2==null)&&(n=this.ChartFrame.GetXFromIndex(u),s=this.ChartFrame.GetYFromData(f.Value),o=this.ChartFrame.GetYFromData(f.Value2),this.IsHScreen?l[h]={Line:{X:s,Y:n},Line2:{X:o,Y:n}}:l[h]={Line:{X:n,Y:s},Line2:{X:n,Y:o}})}this.Canvas.fillStyle=this.Color;var C=!0,D=0,c=[];for(var h in l){var T=l[h];if(!T){if(D>0){for(var u=c.length-1;u>=0;--u){var S=c[u];this.Canvas.lineTo(S.Line2.X,S.Line2.Y)}this.Canvas.closePath(),this.Canvas.fill()}C=!0,D=0,c=[];continue}C?(this.Canvas.beginPath(),this.Canvas.moveTo(T.Line.X,T.Line.Y),C=!1):this.Canvas.lineTo(T.Line.X,T.Line.Y),c.push(T),++D}if(D>0){for(var u=c.length-1;u>=0;--u){var S=c[u];this.Canvas.lineTo(S.Line2.X,S.Line2.Y)}this.Canvas.closePath(),this.Canvas.fill()}}}},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a={};a.Min=null,a.Max=null;for(var r=this.Data.DataOffset,t=0;r<this.Data.Data.length&&t<e;++r,++t){var n=this.Data.Data[r];if(!(!n||n.Value==null||n.Value2==null)){var s=n.Value>n.Value2?n.Value:n.Value2,o=n.Value<n.Value2?n.Value:n.Value2;(a.Max==null||a.Max<s)&&(a.Max=s),(a.Min==null||a.Min>o)&&(a.Min=o)}}return a}}function WC(){this.newMethod=kC,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.IsHScreen=!1,this.ClassName="ChartFillRGN",this.DrawRGB=function(e){var a=!0,r=0,t=[],n=null;for(var s in e){var o=e[s];if(!o||n&&o.Color!=n){if(r>0){for(var l=t.length-1;l>=0;--l){var h=t[l];this.Canvas.lineTo(h.Line2.X,h.Line2.Y)}this.Canvas.closePath(),this.Canvas.fillStyle=n,this.Canvas.fill()}a=!0,r=0,t=[],n=null}o&&(a?(this.Canvas.beginPath(),this.Canvas.moveTo(o.Line.X,o.Line.Y),a=!1,n=o.Color):this.Canvas.lineTo(o.Line.X,o.Line.Y),t.push(o),++r)}if(r>0){for(var l=t.length-1;l>=0;--l){var h=t[l];this.Canvas.lineTo(h.Line2.X,h.Line2.Y)}this.Canvas.closePath(),this.Canvas.fillStyle=n,this.Canvas.fill()}},this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){for(var e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,r=this.ChartFrame.XPointCount,t=this.ChartBorder.GetLeft()+a/2+d.FrameLeftMargin,n=0,s=0,o=0,l=[],h=this.Data.DataOffset,u=0;h<this.Data.Data.length&&u<r;++h,++u,t+=e+a){var f=this.Data.Data[h];l[h]=null,!(f==null||f.Value==null||f.Value2==null||!f.Color)&&(n=this.ChartFrame.GetXFromIndex(u),s=this.ChartFrame.GetYFromData(f.Value),o=this.ChartFrame.GetYFromData(f.Value2),this.IsHScreen?l[h]={Line:{X:s,Y:n},Line2:{X:o,Y:n},Color:f.Color}:l[h]={Line:{X:n,Y:s},Line2:{X:n,Y:o},Color:f.Color})}this.DrawRGB(l)}}}}function Wd(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!1,this.ClassName="ChartFLOATRGN",this.Color="rgb(56,67,99)",this.IsHScreen=!1,this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){for(var e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,r=this.ChartFrame.XPointCount,t=this.ChartBorder.GetLeft()+a/2+d.FrameLeftMargin,n=0,s=0,o=0,l=[],h=this.Data.DataOffset,u=0;h<this.Data.Data.length&&u<r;++h,++u,t+=e+a){var f=this.Data.Data[h];l[h]=null,!(!f||!v.IsNumber(f.Value)||!v.IsNumber(f.Value2)||!f.Color)&&(n=this.ChartFrame.GetXFromIndex(u),s=this.ChartFrame.GetYFromData(f.Value),this.IsHScreen?l[h]={Line:{X:s,Y:n},Line2:{X:s+f.Value2*B(),Y:n},Color:f.Color}:l[h]={Line:{X:n,Y:s},Line2:{X:n,Y:s-f.Value2*B()},Color:f.Color})}var C=null;for(var h in l){var f=l[h];if(C&&f)if(this.IsHScreen){var D=f.Line.Y-C.Line.Y;n=C.Line.Y+D/2,s=C.Line.X+(f.Line.X-C.Line.X)/2,o=C.Line2.X+(f.Line2.X-C.Line2.X)/2,C.RightLine={X:s,Y:n},C.RightLine2={X:o,Y:n},f.LeftLine={X:s,Y:n},f.LeftLine2={X:o,Y:n}}else{var D=f.Line.X-C.Line.X;n=C.Line.X+D/2,s=C.Line.Y+(f.Line.Y-C.Line.Y)/2,o=C.Line2.Y+(f.Line2.Y-C.Line2.Y)/2,C.RightLine={X:n,Y:s},C.RightLine2={X:n,Y:o},f.LeftLine={X:n,Y:s},f.LeftLine2={X:n,Y:o}}C=f}this.DrawRGB(l)}}},this.DrawRGB=function(e){var a=!0,r=0,t=[],n=null;if(this.IsHScreen)var s=this.ChartBorder.GetLeftEx(),o=this.ChartBorder.GetRightEx(),l=this.ChartBorder.GetTop(),h=this.ChartBorder.GetBottom();else var s=this.ChartBorder.GetLeft(),o=this.ChartBorder.GetRight(),l=this.ChartBorder.GetTopEx(),h=this.ChartBorder.GetBottomEx();this.Canvas.save(),this.Canvas.beginPath(),this.Canvas.rect(s,l,o-s,h-l),this.Canvas.clip();for(var u in e){var f=e[u];if(!f||n&&f.Color!=n){if(r>0){var C=t[t.length-1],D=t[0];C.RightLine&&(this.Canvas.lineTo(C.RightLine.X,C.RightLine.Y),this.Canvas.lineTo(C.RightLine2.X,C.RightLine2.Y));for(var c=t.length-1;c>=0;--c){var T=t[c];this.Canvas.lineTo(T.Line2.X,T.Line2.Y)}D.LeftLine2&&this.Canvas.lineTo(D.LeftLine2.X,D.LeftLine2.Y),this.Canvas.closePath(),this.Canvas.fillStyle=n,this.Canvas.fill()}a=!0,r=0,t=[],n=null}f&&(a?(this.Canvas.beginPath(),f.LeftLine?(this.Canvas.moveTo(f.LeftLine.X,f.LeftLine.Y),this.Canvas.lineTo(f.Line.X,f.Line.Y)):this.Canvas.moveTo(f.Line.X,f.Line.Y),a=!1,n=f.Color):this.Canvas.lineTo(f.Line.X,f.Line.Y),t.push(f),++r)}if(r>0){var C=t[t.length-1],D=t[0];C.RightLine&&(this.Canvas.lineTo(C.RightLine.X,C.RightLine.Y),this.Canvas.lineTo(C.RightLine2.X,C.RightLine2.Y));for(var c=t.length-1;c>=0;--c){var T=t[c];this.Canvas.lineTo(T.Line2.X,T.Line2.Y)}D.LeftLine2&&this.Canvas.lineTo(D.LeftLine2.X,D.LeftLine2.Y),this.Canvas.closePath(),this.Canvas.fillStyle=n,this.Canvas.fill()}this.Canvas.restore()},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a={};a.Min=null,a.Max=null;for(var r=this.Data.DataOffset,t=0;r<this.Data.Data.length&&t<e;++r,++t){var n=this.Data.Data[r];if(!(!n||!v.IsNumber(n.Value))){var s=n.Value;(a.Max==null||a.Max<s)&&(a.Max=s),(a.Min==null||a.Min>s)&&(a.Min=s)}}return a}}function Ud(){this.newMethod=WC,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.IsHScreen=!1,this.ClassName="ChartFillBGRGN",this.DrawVerticalRGN=function(){for(var e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,r=this.ChartFrame.XPointCount,t=this.ChartBorder.GetLeft()+a/2+d.FrameLeftMargin,n=this.ChartBorder.GetTopEx(),s=this.ChartBorder.GetBottomEx(),o=n,l=s,h=[],u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<r;++u,++f,t+=e+a){var C=this.Data.Data[u];h[u]=null,!(!C||!C.Color)&&(x=this.ChartFrame.GetXFromIndex(f),this.IsHScreen?h[u]={Line:{X:o,Y:x},Line2:{X:l,Y:x},Color:C.Color}:h[u]={Line:{X:x,Y:o},Line2:{X:x,Y:l},Color:C.Color})}this.DrawRGB(h)},this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){if(this.Name=="FILLVERTICALRGN"){this.DrawVerticalRGN();return}var e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,r=this.ChartFrame.XPointCount,t=this.ChartBorder.GetLeft()+a/2+d.FrameLeftMargin,n=this.ChartBorder.GetTopEx(),s=this.ChartBorder.GetBottomEx(),o=0,l=0,h=n;this.Name=="FILLBOTTOMRGN"&&(h=s);for(var u=[],f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<r;++f,++C,t+=e+a){var D=this.Data.Data[f];u[f]=null,!(D==null||D.Value==null||!D.Color)&&(o=this.ChartFrame.GetXFromIndex(C),l=this.ChartFrame.GetYFromData(D.Value),this.IsHScreen?u[f]={Line:{X:l,Y:o},Line2:{X:h,Y:o},Color:D.Color}:u[f]={Line:{X:o,Y:l},Line2:{X:o,Y:h},Color:D.Color})}this.DrawRGB(u)}}},this.DrawRGB=function(e){var a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=(r+a)/2,n=!0,s=0,o=[],l=null;for(var h in e){var u=e[h];if(!u||l&&u.Color!=l){if(s>0){for(var f=o.length-1;f>=0;--f){var C=o[f];this.Canvas.lineTo(C.Line2.X+t,C.Line2.Y),this.Canvas.lineTo(C.Line2.X-t,C.Line2.Y)}this.Canvas.closePath(),this.Canvas.fillStyle=l,this.Canvas.fill()}n=!0,s=0,o=[],l=null}u&&(n?(this.Canvas.beginPath(),this.Canvas.moveTo(u.Line.X-t,u.Line.Y),this.Canvas.lineTo(u.Line.X+t,u.Line.Y),n=!1,l=u.Color):(this.Canvas.lineTo(u.Line.X-t,u.Line.Y),this.Canvas.lineTo(u.Line.X+t,u.Line.Y)),o.push(u),++s)}if(s>0){for(var f=o.length-1;f>=0;--f){var C=o[f];this.Canvas.lineTo(C.Line2.X+t,C.Line2.Y),this.Canvas.lineTo(C.Line2.X-t,C.Line2.Y)}this.Canvas.closePath(),this.Canvas.fillStyle=l,this.Canvas.fill()}},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a={};a.Min=null,a.Max=null;for(var r=this.Data.DataOffset,t=0;r<this.Data.Data.length&&t<e;++r,++t){var n=this.Data.Data[r];if(!(!n||n.Value==null)){var n=n.Value;(a.Max==null||a.Max<n)&&(a.Max=n),(a.Min==null||a.Min>n)&&(a.Min=n)}}return a}}function UC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.ClassName="ChartChannel",this.IsHScreen=!1,this.PointCount=0,this.DataWidth=0,this.DistanceWidth=0,this.ChartRight=0,this.LineColor="RGB(255,0,0)",this.LineDotted=[3,3],this.AreaColor="RGB(255,222,173)",this.LineWidth=1,this.CalculateData=function(){for(var e=[],a=[],r=this.Data.DataOffset,t=0;r<this.Data.Data.length&&t<this.PointCount;++r,++t){var n=this.Data.Data[r];if(!n||!v.IsNumber(n.Value)||!v.IsNumber(n.Value2)){a.length>0&&(e.push(a),a=[]);continue}var s=this.ChartFrame.GetXFromIndex(t);if(s>this.ChartRight)break;var o=this.ChartFrame.GetYFromData(n.Value),l=this.ChartFrame.GetYFromData(n.Value2);a.push({X:s,Y:o,Y2:l})}return a.length>0&&e.push(a),e},this.DrawArea=function(e){if(!(e.length<=0)){this.Canvas.beginPath();var a=e[0];this.IsHScreen?this.Canvas.moveTo(a.Y,a.X):this.Canvas.moveTo(a.X,a.Y);for(var r=1;r<e.length;++r){var t=e[r];this.IsHScreen?this.Canvas.lineTo(t.Y,t.X):this.Canvas.lineTo(t.X,t.Y)}for(var r=e.length-1;r>=0;--r){var t=e[r];this.IsHScreen?this.Canvas.lineTo(t.Y2,t.X):this.Canvas.lineTo(t.X,t.Y2)}this.Canvas.closePath(),this.Canvas.fillStyle=this.AreaColor,this.Canvas.fill()}},this.DrawLine=function(e){this.Canvas.strokeStyle=this.LineColor;for(var a=0;a<2;++a){for(var r=!0,t=0,n=0;n<e.length;++n){var s=e[n];r?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(a===0?s.Y:s.Y2,s.X):this.Canvas.moveTo(s.X,a===0?s.Y:s.Y2),r=!1):this.IsHScreen?this.Canvas.lineTo(a===0?s.Y:s.Y2,s.X):this.Canvas.lineTo(s.X,a===0?s.Y:s.Y2),++t}t>0&&this.Canvas.stroke()}},this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.PointCount=this.ChartFrame.XPointCount,this.DataWidth=this.ChartFrame.DataWidth,this.DistanceWidth=this.ChartFrame.DistanceWidth,this.IsHScreen?this.ChartRight=this.ChartBorder.GetBottom():this.ChartRight=this.ChartBorder.GetRight();var e=this.CalculateData();if(!(!e||e.length<=0)){this.Canvas.save(),this.Canvas.lineWidth=this.LineWidth*B(),this.Canvas.setLineDash(this.LineDotted);for(var a=0;a<e.length;++a){var r=e[a];this.DrawArea(r),this.DrawLine(r)}this.Canvas.restore()}}},this.GetMaxMin=function(){for(var e=this.ChartFrame.XPointCount,a={Min:null,Max:null},r=this.Data.DataOffset,t=0;r<this.Data.Data.length&&t<e;++r,++t){var n=this.Data.Data[r];if(!(n==null||n.Value==null||n.Value2==null)){var s=n.Value>n.Value2?n.Value:n.Value2,o=n.Value<n.Value2?n.Value:n.Value2;(a.Max==null||a.Max<s)&&(a.Max=s),(a.Min==null||a.Min>o)&&(a.Min=o)}}return a}}function KC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartBackground",this.Color=null,this.ColorAngle=0,this.IsDrawFirst=!0,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&this.Color&&!(this.Color.length<=0)){if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.Color.length==2){if(this.IsHScreen)if(this.ColorAngle==0)var e={X:this.ChartBorder.GetRight(),Y:this.ChartBorder.GetTopEx()},a={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()};else var e={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()},a={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetBottomEx()};else if(this.ColorAngle==0)var e={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()},a={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetBottomEx()};else var e={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()},a={X:this.ChartBorder.GetRight(),Y:this.ChartBorder.GetTopEx()};var r=this.Canvas.createLinearGradient(e.X,e.Y,a.X,a.Y);r.addColorStop(0,this.Color[0]),r.addColorStop(1,this.Color[1]),this.Canvas.fillStyle=r}else if(this.Color.length==1)this.Canvas.fillStyle=this.Color[0];else return;if(this.Name=="DRAWGBK2"||this.Name=="KLINE_BG"){this.DrawRegion();return}if(this.IsHScreen)var t=this.ChartBorder.GetLeftEx(),n=this.ChartBorder.GetTop(),s=this.ChartBorder.GetWidthEx(),o=this.ChartBorder.GetHeight();else var t=this.ChartBorder.GetLeft(),n=this.ChartBorder.GetTopEx(),s=this.ChartBorder.GetWidth(),o=this.ChartBorder.GetHeightEx();this.Canvas.fillRect(t,n,s,o)}},this.DrawRegion=function(){var e=this.ChartFrame.XPointCount,a=this.ChartBorder.GetLeft()+t/2+d.FrameLeftMargin,r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartBorder.GetTopEx(),s=this.ChartBorder.GetBottomEx();this.IsHScreen&&(n=this.ChartBorder.GetRightEx(),s=this.ChartBorder.GetLeftEx());for(var o=[],l=this.Data.DataOffset,h=0;l<this.Data.Data.length&&h<e;++l,++h,a+=r+t){var u=this.Data.Data[l];if(o[l]=null,!(!v.IsNumber(u)||u<=0)){var f=this.ChartFrame.GetXFromIndex(h);this.ChartFrame.GetYFromData(u.Value),this.IsHScreen?o[l]={Line:{X:s,Y:f},Line2:{X:n,Y:f}}:o[l]={Line:{X:f,Y:n},Line2:{X:f,Y:s}}}}this.DrawBG(o)},this.DrawBG=function(e){var a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=(r+a)/2,n=!0,s=0,o=[],l=null;for(var h in e){var u=e[h];if(!u||l&&u.Color!=l){if(s>0){for(var f=o.length-1;f>=0;--f){var C=o[f];this.IsHScreen?(this.Canvas.lineTo(C.Line2.X,C.Line2.Y+t),this.Canvas.lineTo(C.Line2.X,C.Line2.Y-t)):(this.Canvas.lineTo(C.Line2.X+t,C.Line2.Y),this.Canvas.lineTo(C.Line2.X-t,C.Line2.Y))}this.Canvas.closePath(),this.Canvas.fill()}n=!0,s=0,o=[],l=null}u&&(n?(this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(u.Line.X,u.Line.Y-t),this.Canvas.lineTo(u.Line.X,u.Line.Y+t)):(this.Canvas.moveTo(u.Line.X-t,u.Line.Y),this.Canvas.lineTo(u.Line.X+t,u.Line.Y)),n=!1,l=u.Color):this.IsHScreen?(this.Canvas.lineTo(u.Line.X,u.Line.Y-t),this.Canvas.lineTo(u.Line.X,u.Line.Y+t)):(this.Canvas.lineTo(u.Line.X-t,u.Line.Y),this.Canvas.lineTo(u.Line.X+t,u.Line.Y)),o.push(u),++s)}if(s>0){for(var f=o.length-1;f>=0;--f){var C=o[f];this.IsHScreen?(this.Canvas.lineTo(C.Line2.X,C.Line2.Y+t),this.Canvas.lineTo(C.Line2.X,C.Line2.Y-t)):(this.Canvas.lineTo(C.Line2.X+t,C.Line2.Y),this.Canvas.lineTo(C.Line2.X-t,C.Line2.Y))}this.Canvas.closePath(),this.Canvas.fill()}},this.GetMaxMin=function(){return{Min:null,Max:null}}}function Kd(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartBackgroundDiv",this.AryColor,this.ColorType=0,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&v.IsNonEmptyArray(this.AryColor)&&!(!this.Data||!this.Data.Data)){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount,n,s,o,l,h;e?(n=this.ChartBorder.GetHScreenBorder(),s=n.TopEx+r/2+d.FrameLeftMargin,o=n.BottomEx,l=n.LeftEx,h=n.RightEx):(n=this.ChartBorder.GetBorder(),s=n.LeftEx+r/2+d.FrameLeftMargin,o=n.RightEx,l=n.TopEx,h=n.BottomEx);for(var u=null,f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<t;++f,++C,s+=a+r){var D=this.Data.Data[f],c=s,T=s+a;if(T>o)break;if(!D)u&&this.DrawDiv(u,e),u=null;else{var S=l,I=h;if(v.IsNonEmptyArray(D.AryValue)){var g=this.ChartFrame.GetYFromData(D.AryValue[0]),E=this.ChartFrame.GetYFromData(D.AryValue[1]);S=Math.min(g,E),I=Math.max(g,E)}e?u?(u.Bottom=T,u.Left>S&&(u.Left=S),u.Right<I&&(u.Right=I)):u={Left:S,Right:I,Top:c,Bottom:T}:u?(u.Right=T,u.Top>S&&(u.Top=S),u.Bottom<I&&(u.Bottom=I)):u={Left:c,Right:T,Top:S,Bottom:I}}}}},this.DrawDiv=function(e,a){if(this.ColorType==2)this.Canvas.strokeStyle=this.AryColor[0],this.Canvas.strokeRect(L(e.Left),L(e.Top),b(e.Right-e.Left),b(e.Bottom-e.Top));else if(this.ColorType==3)this.Canvas.fillStyle=this.AryColor[1],this.Canvas.fillRect(b(e.Left),b(e.Top),b(e.Right-e.Left),b(e.Bottom-e.Top)),this.Canvas.strokeStyle=this.AryColor[0],this.Canvas.strokeRect(L(e.Left),L(e.Top),b(e.Right-e.Left),b(e.Bottom-e.Top));else if(this.ColorType==0||this.ColorType==1){var r=null;a?this.ColorType==0?r=this.Canvas.createLinearGradient(e.Left,e.Top,e.Right,e.Top):r=this.Canvas.createLinearGradient(e.Left,e.Top,e.Left,e.Bottom):this.ColorType==0?r=this.Canvas.createLinearGradient(e.Left,e.Top,e.Left,e.Bottom):r=this.Canvas.createLinearGradient(e.Left,e.Top,e.Right,e.Top),r.addColorStop(.5,this.AryColor[0]),r.addColorStop(1,this.AryColor[1]),this.Canvas.fillStyle=r,this.Canvas.fillRect(b(e.Left),b(e.Top),b(e.Right-e.Left),b(e.Bottom-e.Top))}else return}}function zd(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartRectangle",this.Color=[],this.Rect,this.BorderColor=d.FrameBorderPen,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Color||!this.Rect)&&!(this.Color.length<=0)){this.Canvas.strokeStyle=this.BorderColor;var e=!1;if(this.Color.length==2)this.Canvas.fillStyle=this.Color[0],e=!0;else if(this.Color.length==1)this.Color[0]&&(this.Canvas.fillStyle=this.Color[0],e=!0);else return;var a=this.ChartBorder.GetWidth(),r=this.ChartBorder.GetHeightEx(),t=this.Rect.Left/1e3*a,n=this.Rect.Top/1e3*r,s=this.Rect.Right/1e3*a,o=this.Rect.Bottom/1e3*r;t=this.ChartBorder.GetLeft()+t,n=this.ChartBorder.GetTopEx()+n,s=this.ChartBorder.GetLeft()+s,o=this.ChartBorder.GetTopEx()+o;var l=Math.abs(t-s),h=Math.abs(n-o);e&&this.Canvas.fillRect(t,n,l,h),this.Canvas.beginPath(),this.Canvas.rect(L(t),L(n),b(l),b(h)),this.Canvas.stroke()}}}function zC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartTextLine",this.Text,this.Line,this.Price,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Text||!this.Line||!v.IsNumber(this.Price))){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var e=this.ChartBorder.GetLeft(),a=this.ChartBorder.GetRight(),r=this.ChartBorder.GetBottomEx(),t=this.ChartBorder.GetTopEx(),n=this.ChartFrame.GetYFromData(this.Price),s=0;if(this.Text.Title){var o=e+2*B(),l=n;this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var h=8*B();n-h<t?(this.Canvas.textBaseline="top",l=t):n+h>r&&(this.Canvas.textBaseline="bottom",l=r),this.Canvas.fillStyle=this.Text.Color,this.Canvas.font=this.Text.Font,this.Canvas.fillText(this.Text.Title,o,l),s=this.Canvas.measureText(this.Text.Title).width+4*B()}if(this.Line.Type>0){this.Line.Type==2&&(this.Canvas.save(),this.Canvas.setLineDash([3,5]));var o=e+s;this.Canvas.strokeStyle=this.Line.Color,this.Canvas.beginPath(),this.Canvas.moveTo(o,L(n)),this.Canvas.lineTo(a,L(n)),this.Canvas.stroke(),this.Line.Type==2&&this.Canvas.restore()}}},this.GetMaxMin=function(){var e={Min:null,Max:null};return v.IsNumber(this.Price)&&(e.Min=this.Price,e.Max=this.Price),e}}function JC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiBar",this.Bars=[],this.IsHScreen=!1,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()&&!(!this.Data||this.Data.length<=0)){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,r=this.ChartFrame.DataWidth,t=B(),n=[];for(var s in this.Bars){var o=this.Bars[s],l={Point:[],Color:o.Color,Width:r,Type:0};o.Type>0&&(l.Type=o.Type),o.Width>0?(l.Width=o.Width*t,l.Width>r&&(l.Width=r)):l.Width<4&&(l.Width=1*t);for(var h in o.Point){var u=o.Point[h];if(v.IsNumber(u.Index)){var f=u.Index-a;if(f>=0&&f<e){var C=this.ChartFrame.GetXFromIndex(f),D=this.ChartFrame.GetYFromData(u.Value),c=this.ChartFrame.GetYFromData(u.Value2);l.Point.push({X:C,Y:D,Y2:c})}}}l.Point.length>0&&n.push(l)}for(var s in n){var o=n[s];o.Width>=4?o.Type==1?this.DrawHollowBar(o):this.DrawFillBar(o):this.DrawLineBar(o)}}},this.DrawLineBar=function(e){this.Canvas.strokeStyle=e.Color;var a=this.Canvas.lineWidth;this.Canvas.lineWidth=e.Width;for(var r in e.Point){var t=e.Point[r];this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(L(t.Y),L(t.X)),this.Canvas.lineTo(L(t.Y2),L(t.X))):(this.Canvas.moveTo(L(t.X),L(t.Y)),this.Canvas.lineTo(L(t.X),L(t.Y2))),this.Canvas.stroke()}this.Canvas.lineWidth=a},this.DrawFillBar=function(e){this.Canvas.fillStyle=e.Color;for(var a in e.Point){var r=e.Point[a],t=r.X-e.Width/2,n=Math.min(r.Y,r.Y2),s=e.Width,o=Math.abs(r.Y-r.Y2);this.IsHScreen?this.Canvas.fillRect(b(n),b(t),b(o),b(s)):this.Canvas.fillRect(b(t),b(n),b(s),b(o))}},this.DrawHollowBar=function(e){this.Canvas.strokeStyle=e.Color;var a=1;for(var r in e.Point){var t=e.Point[r],n=t.X-e.Width/2,s=Math.min(t.Y,t.Y2),o=e.Width,l=Math.abs(t.Y-t.Y2);this.Canvas.beginPath(),this.IsHScreen?this.Canvas.rect(L(s),L(n),b(l),b(o)):this.Canvas.rect(L(n),L(s),b(o),b(l)),this.Canvas.stroke()}this.Canvas.lineWidth=a},this.GetMaxMin=function(){var e={Min:null,Max:null},a=this.ChartFrame.XPointCount,r=this.Data.DataOffset,t=r+a;for(var n in this.Bars){var s=this.Bars[n];for(var o in s.Point){var l=s.Point[o];if(l.Index>=r&&l.Index<t){var h=Math.min(l.Value,l.Value2),u=Math.max(l.Value,l.Value2);(e.Max==null||e.Max<u)&&(e.Max=u),(e.Min==null||e.Min>h)&&(e.Min=h)}}}return e}}function ZC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiLine",this.Lines=[],this.LineDash,this.LineWidth=1,this.IsHScreen=!1,this.ArrawAngle=35,this.ArrawLength=10,this.ArrawLineWidth=5,this.Arrow={Start:!1,End:!1},this.IsFullRangeMaxMin=!1,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()&&!(!this.Data||this.Data.length<=0)&&v.IsNonEmptyArray(this.Lines)){this.IsHScreen=this.ChartFrame.IsHScreen===!0;for(var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,r=[],t=[],n=0;n<this.Lines.length;++n){var s=this.Lines[n],o={Point:[],Color:s.Color,AryCircle:null},l={Start:[],End:[]};s.BGColor&&(o.BGColor=s.BGColor),v.IsNonEmptyArray(s.Circle)&&(o.AryCircle=s.Circle);var h=!1;if(v.IsBool(s.IsExtendLine)&&(h=s.IsExtendLine),h){for(var u=null,f=!0,C=0;C<s.Point.length;++C){var D=s.Point[C];if(v.IsNumber(D.Index)){var c=D.Index-a;if(c>0&&c<e){if(f){if(u){var T=u.Index-a,S=this.ChartFrame.GetXFromIndex(T,!1),I=this.ChartFrame.GetYFromData(u.Value,!1),g={X:S,Y:I,End:!1};o.Point.push(g)}f=!1}var S=this.ChartFrame.GetXFromIndex(c,!1),I=this.ChartFrame.GetYFromData(D.Value,!1),g={X:S,Y:I,End:!1};o.Point.push(g)}else if(o.Point.length>0){var S=this.ChartFrame.GetXFromIndex(c,!1),I=this.ChartFrame.GetYFromData(D.Value,!1),g={X:S,Y:I,End:!0};o.Point.push(g),f=!0,u=null}u=D}}o.Point.length>=2&&(r.push(o),t.push(l))}else{for(var C=0;C<s.Point.length;++C){var D=s.Point[C];if(v.IsNumber(D.Index)){var c=D.Index-a;if(c>=0&&c<e){var S=this.ChartFrame.GetXFromIndex(c),I=this.ChartFrame.GetYFromData(D.Value,!1),g={X:S,Y:I,End:!1};o.Point.push(g),(C==0||C==1)&&l.Start.push(g),(C==s.Point.length-1||C==s.Point.length-2)&&l.End.push(g)}else o.Point.length>0&&(o.Point[o.Point.length-1].End=!0)}}o.Point.length>=2&&(r.push(o),t.push(l))}}var E=B();this.Canvas.save(),this.ClipClient(this.IsHScreen);for(var n=0;n<r.length;++n){this.LineDash&&this.Canvas.setLineDash(this.LineDash),v.IsPlusNumber(this.LineWidth)?this.Canvas.lineWidth=this.LineWidth*E:this.Canvas.lineWidth=1*E;var F=r[n];this.DrawLine(F,t[n]),F.AryCircle&&this.DrawCircle(F)}this.Canvas.restore()}},this.DrawCircle=function(e){for(var a=B(),r=0;r<e.Point.length;++r)for(var t=e.Point[r],n=0;n<e.AryCircle.length;++n){var s=e.AryCircle[n],o=0;v.IsNumber(s.Type)&&(o=s.Type),this.Canvas.beginPath(),this.Canvas.arc(t.X,t.Y,s.Radius,0,2*Math.PI),o==1?(v.IsPlusNumber(s.LineWidth)&&(this.Canvas.lineWidth=s.LineWidth*a),this.Canvas.strokeStyle=s.Color,this.Canvas.stroke()):(this.Canvas.fillStyle=s.Color,this.Canvas.fill())}},this.DrawLine=function(e,a){if(e.BGColor){this.Canvas.fillStyle=e.BGColor;for(var r=0;r<e.Point.length;++r){var t=e.Point[r];r==0?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(t.Y,t.X):this.Canvas.moveTo(t.X,t.Y)):this.IsHScreen?this.Canvas.lineTo(t.Y,t.X):this.Canvas.lineTo(t.X,t.Y)}this.Canvas.closePath(),this.Canvas.fill()}this.Canvas.strokeStyle=e.Color;for(var n=0,r=0;r<e.Point.length;++r){var t=e.Point[r];n==0?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(t.Y,t.X):this.Canvas.moveTo(t.X,t.Y),++n):(this.IsHScreen?this.Canvas.lineTo(t.Y,t.X):this.Canvas.lineTo(t.X,t.Y),++n),t.End==!0&&(n>0&&this.Canvas.stroke(),n=0)}n>0&&this.Canvas.stroke(),a.End.length==2&&this.Arrow.End==!0&&this.DrawArrow(a.End[0],a.End[1]),a.Start.length==2&&this.Arrow.Start==!0&&this.DrawArrow(a.Start[1],a.Start[0])},this.DrawArrow=function(e,a){var r=this.ArrawAngle,t=this.ArrawLength,n=Math.atan2(e.Y-a.Y,e.X-a.X)*180/Math.PI,s=(n+r)*Math.PI/180,o=(n-r)*Math.PI/180,l=t*Math.cos(s),h=t*Math.sin(s),u=t*Math.cos(o),f=t*Math.sin(o);this.Canvas.beginPath();var C=a.X+l,D=a.Y+h;this.Canvas.moveTo(C,D),this.Canvas.lineTo(a.X,a.Y),C=a.X+u,D=a.Y+f,this.Canvas.lineTo(C,D),this.Canvas.setLineDash([]),this.Canvas.lineWidth=this.ArrawLineWidth*B(),this.Canvas.stroke()},this.GetMaxMin=function(){if(this.IsFullRangeMaxMin)return this.GetFullRangeMaxMin();var e={Min:null,Max:null},a=this.ChartFrame.XPointCount,r=this.Data.DataOffset,t=r+a;for(var n in this.Lines){var s=this.Lines[n];for(var o in s.Point){var l=s.Point[o];l.Index>=r&&l.Index<t&&((e.Max==null||e.Max<l.Value)&&(e.Max=l.Value),(e.Min==null||e.Min>l.Value)&&(e.Min=l.Value))}}return e},this.GetFullRangeMaxMin=function(){var e={Min:null,Max:null};if(!v.IsNonEmptyArray(this.Lines))return e;for(var a=0;a<this.Lines.length;++a){var r=this.Lines[a];if(v.IsNonEmptyArray(r.Point))for(var t=0;t<r.Point.length;++t){var n=r.Point[t];(e.Max==null||e.Max<n.Value)&&(e.Max=n.Value),(e.Min==null||e.Min>n.Value)&&(e.Min=n.Value)}}return e}}function QC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiPoint",this.PointGroup=[],this.IsHScreen=!1,this.LineWidth=1,this.PointRadius=5,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Data||this.Data.length<=0)&&v.IsNonEmptyArray(this.PointGroup)){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,r=B();this.Canvas.save(),this.ClipClient(this.IsHScreen);for(var t=0;t<this.PointGroup.length;++t){var n=this.PointGroup[t],s=n.Color,o=n.BGColor,l=this.LineWidth,h=this.PointRadius;v.IsNumber(n.LineWidth)&&(l=n.LineWidth),v.IsNumber(n.PointRadius)&&(h=n.PointRadius);for(var u=new Path2D,f=0,C=0;C<n.Point.length;++C){var D=n.Point[C];if(v.IsNumber(D.Index)){var c=D.Index-a;if(c>=0&&c<e){var T=this.ChartFrame.GetXFromIndex(c),S=this.ChartFrame.GetYFromData(D.Value,!1),I=new Path2D;this.IsHScreen?I.arc(S,T,h*r,0,360,!1):I.arc(T,S,h*r,0,360,!1),u.addPath(I),++f}}}f>0&&(o||s)&&(this.Canvas.lineWidth=l*r,this.Canvas.fillStyle=o,this.Canvas.strokeStyle=s,o&&this.Canvas.fill(u),s&&this.Canvas.stroke(u))}this.Canvas.restore()}},this.GetMaxMin=function(){for(var e={Min:null,Max:null},a=this.ChartFrame.XPointCount,r=this.Data.DataOffset,t=r+a,n=0;n<this.PointGroup.length;++n){var s=this.PointGroup[n];if(v.IsNonEmptyArray(s.Point))for(var o=0;o<s.Point.length;++o){var l=s.Point[o];l.Index>=r&&l.Index<t&&((e.Max==null||e.Max<l.Value)&&(e.Max=l.Value),(e.Min==null||e.Min>l.Value)&&(e.Min=l.Value))}}return e}}function $C(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiText",this.Texts=[],this.Font=d.DefaultTextFont,this.Color=d.DefaultTextColor,this.IsHScreen=!1,this.BuildKey=function(e){if(v.IsNumber(e.Time))var a=e.Date+"-"+e.Time;else var a=""+e.Date;return a},this.GetShowTextData=function(){for(var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,r=new Dt.default,t=0;t<this.Texts.length;++t){var n=this.Texts[t];if(n.Text&&v.IsNumber(n.Index)){var s=n.Index-a;if(s>=0&&s<e){var o=this.BuildKey(n);if(r.has(o)){var l=r.get(o);l.Data.push(n)}else{var l={Data:[n]};r.set(o,l)}}}}return r},this.DrawAllText=function(e){var a=this.ChartFrame.IsHScreen===!0;this.IsMinuteFrame();var r=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,n=this.ChartFrame.XPointCount;if(a)var s=this.ChartBorder.GetHScreenBorder(),o=s.BottomEx,l=s.TopEx,h=s.TopEx+t/2+d.FrameLeftMargin,u=this.ChartBorder.GetTop(),f=this.ChartBorder.GetBottom(),C=s.RightEx,D=s.LeftEx;else var s=this.ChartBorder.GetBorder(),h=s.LeftEx+t/2+d.FrameLeftMargin,o=s.RightEx,l=s.LeftEx,u=this.ChartBorder.GetLeft(),f=this.ChartBorder.GetRight(),C=s.TopEx,D=s.BottomEx;for(var c=this.Data.DataOffset,T=0;c<this.Data.Data.length&&T<n;++c,++T,h+=r+t){var S=this.Data.Data[c];if(S){var I=this.BuildKey(S);if(e.has(I)){var u=h,f=h+r;if(f>o)break;for(var g=u+(f-u)/2,E=e.get(I),F=0;F<E.Data.length;++F){var R=E.Data[F],A=C;R.Value=="TOP"?A=C:R.Value=="BOTTOM"?A=D:A=this.ChartFrame.GetYFromData(R.Value,!1),R.Color?this.Canvas.fillStyle=R.Color:this.Canvas.fillStyle=this.Color,R.Font?this.Canvas.font=R.Font:this.Canvas.font=this.Font;var P=this.Canvas.measureText(R.Text).width;if(this.Canvas.textAlign="center",g+P/2>=o?(this.Canvas.textAlign="right",g=o):g-P/2<l&&(this.Canvas.textAlign="left",g=l),R.Baseline==1?this.Canvas.textBaseline="top":R.Baseline==2?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",this.IsHScreen?(this.Canvas.save(),this.Canvas.translate(A,g),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(R.Text,0,0),this.Canvas.restore()):(v.IsNumber(R.YMove)&&(A+=R.YMove),this.Canvas.fillText(R.Text,g,A)),R.Line){var S=this.Data.Data[R.Index],p=R.Line.KData=="H"?S.High:S.Low,w=this.ChartFrame.GetYFromData(p,!1),H=A;Array.isArray(R.Line.Offset)&&R.Line.Offset.length==2&&(H>w?(H-=R.Line.Offset[1],w+=R.Line.Offset[0]):H<w&&(H+=R.Line.Offset[1],w-=R.Line.Offset[0])),this.Canvas.save(),R.Line.Dash&&this.Canvas.setLineDash(R.Line.Dash),R.Line.Width>0&&(this.Canvas.lineWidth=R.Line.Width),this.Canvas.strokeStyle=R.Line.Color,this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(H,L(g)),this.Canvas.lineTo(w,L(g))):(this.Canvas.moveTo(L(g),H),this.Canvas.lineTo(L(g),w)),this.Canvas.stroke(),this.Canvas.restore()}}}}}},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()&&!(!this.Data||this.Data.length<=0)&&this.Texts){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var e=this.GetShowTextData();e.size<=0||(this.Canvas.save(),this.ClipClient(this.IsHScreen),this.DrawAllText(e),this.Canvas.restore())}},this.GetMaxMin=function(){var e={Min:null,Max:null};if(!this.Texts)return e;var a=this.ChartFrame.XPointCount,r=this.Data.DataOffset,t=r+a;for(var n in this.Texts){var s=this.Texts[n];v.IsNumber(s.Value)&&s.Index>=r&&s.Index<t&&((e.Max==null||e.Max<s.Value)&&(e.Max=s.Value),(e.Min==null||e.Min>s.Value)&&(e.Min=s.Value))}return e}}function qC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiSVGIconV2",this.AryIcon,this.IconSize={Max:d.DRAWICON.Icon.MaxSize,Min:d.DRAWICON.Icon.MinSize,Zoom:{Type:d.DRAWICON.Icon.Zoom.Type,Value:d.DRAWICON.Icon.Zoom.Value}},this.Family,this.Color=d.DefaultTextColor,this.IsHScreen=!1,this.IconRect=[],this.MapCache=null,this.BuildKey=function(e){return v.IsNumber(e.Time)?e.Date+"-"+e.Time:e.Date},this.BuildCacheData=function(){var e=new Dt.default;if(this.MapCache=e,!!v.IsNonEmptyArray(this.AryIcon))for(var a=0;a<this.AryIcon.length;++a){var r=this.AryIcon[a],t=this.BuildKey(r);if(e.has(t)){var n=e.get(t);n.Data.push(r)}else e.set(t,{Data:[r]})}},this.ClipClient=function(e){if(e==!0)var a=this.ChartBorder.GetLeft(),r=this.ChartBorder.GetRight(),t=this.ChartBorder.GetTop(),n=this.ChartBorder.GetBottom();else var a=this.ChartBorder.GetLeft(),r=this.ChartBorder.GetRight(),t=this.ChartBorder.GetTop(),n=this.ChartBorder.GetBottom();this.Canvas.beginPath(),this.Canvas.rect(a,t,r-a,n-t),this.Canvas.clip()},this.Draw=function(){if(this.IconRect=[],!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()&&!(!this.Data||!v.IsNonEmptyArray(this.Data.Data))&&this.Family&&!(!this.MapCache||this.MapCache.size<=0)){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var e=this.ChartFrame.XPointCount,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.IsMinuteFrame(),n=this.GetBorder();if(this.IsHScreen)var s=n.TopEx+r/2+d.FrameLeftMargin,o=n.BottomEx,l=n.TopEx;else var s=n.LeftEx+r/2+d.FrameLeftMargin,o=n.RightEx,l=n.LeftEx;this.Canvas.save(),this.ClipClient(this.ChartFrame.IsHScreen);var h=this.GetDynamicIconSize(a,r,this.IconSize.Max,this.IconSize.Min,this.IconSize.Zoom);this.Canvas.font=h+"px "+this.Family;for(var u={Left:l,Right:o,FontSize:h,DataWidth:a,DistanceWidth:r},f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<e;++f,++C,s+=a+r){var D=this.Data.Data[f],c=this.BuildKey(D);if(this.MapCache.has(c)){var T=this.MapCache.get(c);if(t)var S=this.ChartFrame.GetXFromIndex(C);else{var I=s,g=s+a;if(g>o)break;var S=I+(g-I)/2}this.DrawItem(T,D,S,u)}}this.Canvas.restore()}},this.GetKValue=function(e,a){switch(a){case"HIGH":case"H":return e.High;case"L":case"LOW":return e.Low;case"C":case"CLOSE":return e.Close;case"O":case"OPEN":return KItem.Open;default:return null}},this.DrawItem=function(e,a,r,t){if(v.IsNonEmptyArray(e.Data)){var n=t.FontSize;t.Left,t.Right,t.DataWidth;for(var s=0;s<e.Data.length;++s){var o=e.Data[s],l=o.Value;if(v.IsString(o.Value)&&(l=this.GetKValue(a,o.Value)),!!v.IsNumber(l)){var h=this.ChartFrame.GetYFromData(o.Value,!1);o.Color?this.Canvas.fillStyle=o.Color:this.Canvas.fillStyle=this.Color,this.Canvas.measureText(o.Symbol).width,this.Canvas.textAlign="center";var u=new Ia(r-n/2,h-n/2,n,n);if(o.Baseline==1?(this.Canvas.textBaseline="top",u.Y=h):o.Baseline==2?(this.Canvas.textBaseline="bottom",u.Y=h-n):(this.Canvas.textBaseline="middle",u.Y=h-n/2),this.IsHScreen?(this.Canvas.save(),this.Canvas.translate(h,r),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(o.Symbol,0,0),this.Canvas.restore()):(v.IsNumber(o.YMove)&&(h+=o.YMove,u.Y+=o.YMove),this.Canvas.fillText(o.Symbol,r,h),o.Text?this.IconRect.push({Rect:u,Item:o,KItem:a}):v.IsNonEmptyArray(o.AryText)&&this.IconRect.push({Rect:u,Item:o,KItem:a})),o.Line){var f=o.Line.KData=="H"?a.High:a.Low,C=this.ChartFrame.GetYFromData(f,!1),D=h;Array.isArray(o.Line.Offset)&&o.Line.Offset.length==2&&(D>C?(D-=o.Line.Offset[1],C+=o.Line.Offset[0]):D<C&&(D+=o.Line.Offset[1],C-=o.Line.Offset[0])),this.Canvas.save(),o.Line.Dash&&this.Canvas.setLineDash(o.Line.Dash),o.Line.Width>0&&(this.Canvas.lineWidth=o.Line.Width),this.Canvas.strokeStyle=o.Line.Color,this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(D,L(r)),this.Canvas.lineTo(C,L(r))):(this.Canvas.moveTo(L(r),D),this.Canvas.lineTo(L(r),C)),this.Canvas.stroke(),this.Canvas.restore()}}}}},this.GetTooltipData=function(e,a,r){if(!v.IsNonEmptyArray(this.IconRect))return!1;for(var t=0;t<this.IconRect.length;++t){var n=this.IconRect[t];if(n.Rect){var s=n.Rect;if(s&&s.PtInRect(e,a))return k.Chart.Log("[ChartMultiSVGIconV2::GetTooltipData] icon ",n),r.Data=n,r.ChartPaint=this,r.Type=4,!0}}return!1},this.GetMaxMin=function(){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var e={Min:null,Max:null};if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return e;if(!(!this.MapCache||this.MapCache.size<=0)){for(var a=this.ChartFrame.XPointCount,r=this.Data.DataOffset,t=0,n=0;r<this.Data.Data.length&&t<a;++r,++t){var s=this.Data.Data[r],o=this.BuildKey(s);if(this.MapCache.has(o)){var l=this.MapCache.get(o);if(v.IsNonEmptyArray(l.Data))for(n=0;n<l.Data.length;++n){var h=l.Data[n],u=h.Value;v.IsString(h.Value)&&(u=this.GetKValue(s,h.Value)),v.IsNumber(u)&&((e.Max==null||e.Max<u)&&(e.Max=u),(e.Min==null||e.Min>u)&&(e.Min=u))}}}return e}}}function jC(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiHtmlDom",this.Texts=[],this.IsHScreen=!1,this.DrawCallback,this.DrawItem=[],this.EnableDraw=!0,this.HQChart,this.IsDestroy=!1,this.Draw=function(){this.EnableDraw&&(this.IsDestroy||(this.DrawItem=[],this.DrawCallback&&this.DrawCallback(1,{Self:this}),this.DrawDom(),this.DrawCallback&&this.DrawCallback(2,{Self:this,DrawItem:this.DrawItem})))},this.OnDestroy=function(){this.IsDestroy=!0,this.DrawCallback&&this.DrawCallback(4,{Self:this})},this.DrawDom=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Data||this.Data.length<=0)){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,r=this.ChartBorder.GetTopEx(),t=this.ChartBorder.GetBottomEx(),n=B();if(this.HQChart)var s=this.HQChart.UIElement.getBoundingClientRect().left,o=this.HQChart.UIElement.getBoundingClientRect().top;else var s=null,o=null;for(var l in this.Texts){var h=this.Texts[l];if(h.Text&&v.IsNumber(h.Index)){var u=this.IsMinuteFrame(),f=h.Index-a,C=this.Data.Data[h.Index],D={KData:C,Item:h,IsShow:!1,Self:this};if(f>=0&&f<e){var c=this.ChartFrame.GetXFromIndex(f);if(h.Value=="Top")var T=r;else if(h.Value=="Bottom")var T=t;else var T=this.ChartFrame.GetYFromData(h.Value);D.X=c/n,D.Y=T/n,D.UIElement={Left:s,Top:o},D.IsShow=!0}if(this.DrawItem.push(D),this.DrawCallback&&this.DrawCallback(3,D),h.Line){if(u)var S=this.Data.Data[h.Index];else var C=this.Data.Data[h.Index],S=h.Line.KData=="H"?C.High:C.Low;var I=this.ChartFrame.GetYFromData(S),g=T;Array.isArray(h.Line.Offset)&&h.Line.Offset.length==2&&(g>I?(g-=h.Line.Offset[1],I+=h.Line.Offset[0]):g<I&&(g+=h.Line.Offset[1],I-=h.Line.Offset[0])),this.Canvas.save(),h.Line.Dash&&this.Canvas.setLineDash(h.Line.Dash);var E=B(),F=1*E;h.Line.Width>0&&(F=h.Line.Width*E),this.Canvas.lineWidth=F,this.Canvas.strokeStyle=h.Line.Color,this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(g,L(c)),this.Canvas.lineTo(I,L(c))):(this.Canvas.moveTo($t(F,c),g),this.Canvas.lineTo($t(F,c),I)),this.Canvas.stroke(),this.Canvas.restore()}}}}},this.GetMaxMin=function(){var e={Min:null,Max:null},a=this.ChartFrame.XPointCount,r=this.Data.DataOffset,t=r+a;for(var n in this.Texts){var s=this.Texts[n];v.IsNumber(s.Index)&&s.Index>=r&&s.Index<t&&((e.Max==null||e.Max<s.Value)&&(e.Max=s.Value),(e.Min==null||e.Min>s.Value)&&(e.Min=s.Value))}return e}}function Cn(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawSVG",this.Family,this.TextFont,this.Texts=[],this.IsHScreen=!1,this.IsDestroy=!1,this.EnableTooltip=!0,this.TooltipRect=[],this.ExcludeArea=null,this.AutoPosition=null,this.AryDrawRect=[],this.AutoYOffset=0,this.Draw=function(){this.TooltipRect=[],this.AryDrawRect=[],this.AutoYOffset=0,!(!this.IsShow||this.ChartFrame.IsMinSize||!this.IsVisible)&&(this.IsShowIndexTitleOnly()||this.IsHideScriptIndex()||this.DrawSVG())},this.DrawDetail=function(e,a,r){if(v.IsNonEmptyArray(a.Content)){var t=2,n=2,s=2,o={Left:e.Right,Right:e.Right,Bottom:e.Bottom},l=0;v.IsNumber(a.ItemSpace)&&(s=a.ItemSpace),v.IsNumber(a.YOffset)&&(o.Bottom+=a.YOffset),v.IsNumber(a.XOffset)&&(o.Left+=a.XOffset),v.IsNumber(a.LeftMargin)&&(t=a.LeftMargin),v.IsNumber(a.RightMargin)&&(n=a.RightMargin),v.IsNumber(a.RightBorder)&&(l=a.RightBorder),a.Font?this.Canvas.font=a.Font:this.Canvas.font=this.TextFont,this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left";var h=this.Canvas.measureText("擎").width+2;o.Height=h+5;for(var u=o.Bottom-(o.Height-h)/2,f=o.Left+t,C=[],D=0;D<a.Content.length;++D){C.length>0&&(f+=s);var c=a.Content[D];if(c.Text){var T=this.Canvas.measureText(c.Text).width+2;C.push({X:f,Y:u,Width:T,Data:c}),f+=T,o.Right=f}}o.Right+=n,o.Width=o.Right-o.Left,o.Top=o.Bottom-o.Height;var S=this.ChartBorder.GetChartWidth()-1;if(l==1&&(S=this.ChartBorder.GetRight()),o.Right>S){o.Right=e.Left,v.IsNumber(a.XOffset)&&(o.Right-=a.XOffset),o.Left=o.Right-o.Width;for(var f=o.Left+t,D=0;D<C.length;++D){D>0&&(f+=s);var c=C[D];c.X=f,f+=c.Width}}a.BGColor&&(this.Canvas.fillStyle=a.BGColor,this.Canvas.fillRect(o.Left,o.Top,o.Width,o.Height)),a.BorderColor&&(this.Canvas.strokeStyle=a.BorderColor,this.Canvas.strokeRect(L(o.Left),L(o.Top),b(o.Width),b(o.Height)));for(var D=0;D<C.length;++D){var c=C[D];this.Canvas.fillStyle=c.Data.Color,this.Canvas.fillText(c.Data.Text,c.X,c.Y)}this.AryDrawRect.push({Left:o.Left,Top:o.Top,Right:o.Right,Bottom:o.Bottom,Type:"Detail",Data:r})}},this.GetDetailPosition=function(e,a){if(!v.IsNonEmptyArray(a.Content))return null;var r=2,t=2,n=2,s={Left:e.Right,Right:e.Right,Bottom:e.Bottom},o=0;v.IsNumber(a.ItemSpace)&&(n=a.ItemSpace),v.IsNumber(a.YOffset)&&(s.Bottom+=a.YOffset),v.IsNumber(a.XOffset)&&(s.Left+=a.XOffset),v.IsNumber(a.LeftMargin)&&(r=a.LeftMargin),v.IsNumber(a.RightMargin)&&(t=a.RightMargin),v.IsNumber(a.RightBorder)&&(o=a.RightBorder),a.Font?this.Canvas.font=a.Font:this.Canvas.font=this.TextFont;var l=this.Canvas.measureText("擎").width+2;s.Height=l+5,s.Bottom-(s.Height-l)/2;for(var h=s.Left+r,u=!0,f=0;f<a.Content.length;++f){u||(h+=n);var C=a.Content[f];if(C.Text){var D=this.Canvas.measureText(C.Text).width+2;h+=D,s.Right=h,u=!1}}s.Right+=t,s.Width=s.Right-s.Left,s.Top=s.Bottom-s.Height;var c=this.ChartBorder.GetChartWidth()-1;return o==1&&(c=this.ChartBorder.GetRight()),s.Right>c&&(s.Right=e.Left,v.IsNumber(a.XOffset)&&(s.Right-=a.XOffset),s.Left=s.Right-s.Width),s},this.CalculateShowPosition=function(e,a){var r=a.X,t=a.Y,n=e.SVG;v.IsNumber(n.YOffset)&&(t+=n.YOffset);var s=n.Size+"px "+this.Family;this.Canvas.font=s;var o=n.Size/2,l={Left:r-o,Right:r+o,Top:t-n.Size,Bottom:t,Height:n.Size,Width:n.Size};n.VAlign===0?(l.Top=t,l.Bottom=l.Top+n.Size):n.VAlign===1&&(l.Top=t-n.Size/2,l.Bottom=l.Top+n.Size),l.Top<0&&(l.Top=0,l.Bottom=n.Size,t=l.Bottom);var h=null;e.Detail&&(h=this.GetDetailPosition(l,e.Detail));var u=0,f=-5;v.IsNumber(this.AutoPosition.MoveYStep)&&(f=-Math.abs(this.AutoPosition.MoveYStep));for(var C=0;C<20;++C){if(l&&!h){if(!this.IsRectOverlap(l))break}else if(l&&h&&!this.IsRectOverlap(l)&&!this.IsRectOverlap(h))break;if(u+=f,Math.abs(u)>=this.AutoPosition.MaxYOffset)break;l.Top+=f,l.Bottom+=f,h&&(h.Top+=f,h.Bottom+=f)}a.X=r,a.Y=t+u},this.IsRectOverlap=function(e){for(var a=0;a<this.AryDrawRect.length;++a){var r=this.AryDrawRect[a];if((e.Left>=r.Left&&e.Left<=r.Right||e.Right>=r.Left&&e.Right<=r.Right)&&(e.Top>=r.Top&&e.Top<=r.Bottom||e.Bottom>=r.Top&&e.Bottom<=r.Bottom))return!0}return!1},this.DrawSVG=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Data||!v.IsNonEmptyArray(this.Data.Data))&&v.IsNonEmptyArray(this.Texts)&&this.Family){this.IsHScreen=this.ChartFrame.IsHScreen===!0;for(var e=this.ChartFrame.XPointCount,a=this.Data.DataOffset,r=this.ChartBorder.GetTopEx(),t=this.ChartBorder.GetBottomEx(),n=B(),s=0,o=0,l=0;l<this.Texts.length;++l){var h=this.Texts[l];if(!(!h.SVG||!h.SVG.Symbol)&&v.IsNumber(h.Index)){this.IsMinuteFrame();var u=h.Index-a,f=this.Data.Data[h.Index];if(!(u<0||u>=e)){s=this.ChartFrame.GetXFromIndex(u),h.Value=="Top"?o=r:h.Value=="Bottom"?o=t:o=this.ChartFrame.GetYFromData(h.Value,!1),v.IsNumber(h.YOffset)&&(o+=h.YOffset);var C=h.SVG;if(v.IsNumber(C.YOffset)&&(o+=C.YOffset),this.AutoPosition){var D={X:s,Y:o};this.CalculateShowPosition(h,D),s=D.X,o=D.Y}var c=C.Size+"px "+this.Family;this.Canvas.font=c;var T=C.Size/2,S="bottom",I={Left:s-T,Right:s+T,Top:o-C.Size,Bottom:o,Height:C.Size,Width:C.Size};if(C.VAlign===0?(S="top",I.Top=o,I.Bottom=I.Top+C.Size):C.VAlign===1&&(S="middle",I.Top=o-C.Size/2,I.Bottom=I.Top+C.Size),I.Top<0&&(I.Top=0,I.Bottom=C.Size,o=I.Bottom),this.Canvas.textBaseline=S,this.Canvas.textAlign="center",this.Canvas.fillStyle=C.Color,this.Canvas.fillText(C.Symbol,s,o),this.AryDrawRect.push({Left:I.Left,Top:I.Top,Right:I.Right,Bottom:I.Bottom,Type:"SVG",Data:h}),this.EnableTooltip&&this.TooltipRect.push({Rect:I,Index:l}),h.Text&&h.Text.Content&&this.TextFont){var g=h.Text;this.Canvas.font=this.TextFont,this.Canvas.fillStyle=g.Color;var E=o;v.IsNumber(g.YOffset)&&(E+=g.YOffset),this.Canvas.fillText(g.Content,s,E)}if(h.Detail&&this.DrawDetail(I,h.Detail,h),h.Line){var F=h.Line,R=null,A=null,f=this.Data.Data[h.Index];if(F.Value=="Bottom")A=t;else if(F.Value=="Top")A=r;else{switch(F.Value){case"C":R=f.Close;break;case"H":R=f.High;break;case"L":R=f.Low;break}if(!v.IsNumber(R))continue;A=this.ChartFrame.GetYFromData(R)}if(A>=I.Top&&A<=I.Bottom)continue;var E;A<I.Top?(E=I.Top,v.IsNumber(F.SVGBlank)&&(E-=F.SVGBlank)):(E=I.Bottom,v.IsNumber(F.SVGBlank)&&(E+=F.SVGBlank)),F.Dash&&this.Canvas.setLineDash(F.Dash);var P=1*n;F.Width>0&&(P=F.Width*n),this.Canvas.lineWidth=P,this.Canvas.strokeStyle=F.Color,this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(E,L(s)),this.Canvas.lineTo(A,L(s))):(this.Canvas.moveTo($t(P,s),E),this.Canvas.lineTo($t(P,s),A)),this.Canvas.stroke(),this.Canvas.setLineDash([])}}}}}},this.GetMaxMin=function(){var e={Min:null,Max:null},a=this.ChartFrame.XPointCount,r=this.Data.DataOffset,t=r+a;if(!v.IsNonEmptyArray(this.Texts))return e;for(var n=0;n<this.Texts.length;++n){var s=this.Texts[n];if(v.IsNumber(s.Index)&&s.Index>=r&&s.Index<t){if(!v.IsNumber(s.Value))continue;(e.Max==null||e.Max<s.Value)&&(e.Max=s.Value),(e.Min==null||e.Min>s.Value)&&(e.Min=s.Value)}}return e},this.GetTooltipData=function(e,a,r){if(!this.IsShow)return!1;for(var t=0;t<this.TooltipRect.length;++t){var n=this.TooltipRect[t];if(n.Rect){var s=n.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(s.Left,s.Top,s.Width,s.Height),this.Canvas.isPointInPath(e,a)){var o=this.Texts[n.Index];return k.Chart.Log("[ChartDrawSVG::GetTooltipData] svg icon.",n),r.Data={Rect:n.Rect,Item:o,Index:n.Index},r.ChartPaint=this,r.Type=7,o.Tooltip&&o.Tooltip.Ver==2&&(r.Type=8),!0}}}return!1}}function Jd(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartOX",this.Font,this.Family=d.ChartOX.Family,this.Color=[d.ChartOX.Up.Color,d.ChartOX.Down.Color],this.Text=[d.ChartOX.Up.Text,d.ChartOX.Down.Text],this.IsHScreen=!1,this.SquareSize=10,this.OXData=null,this.SquareLineColor=d.ChartOX.SquareLineColor,this.TooltipData=[],this.CalcualteSquare=function(){if(this.IsHScreen)var e=this.ChartBorder.GetHScreenBorder(),a=e.LeftEx,r=e.RightEx;else var e=this.ChartBorder.GetBorder(),a=e.TopEx,r=e.BottomEx;this.SquareSize=(r-a)/(this.OXData.Max-this.OXData.Min)*this.OXData.BlockSize;var t=parseInt(this.SquareSize);this.Font=t+"px "+this.Family},this.DrawSquares=function(){if(this.Canvas.beginPath(),this.Canvas.strokeStyle=this.SquareLineColor,this.IsHScreen)var e=this.ChartBorder.GetHScreenBorder(),a=e.Top,r=e.Bottom;else var e=this.ChartBorder.GetBorder(),a=e.Left,r=e.Right,t=e.TopEx,n=e.BottomEx;for(var s=this.OXData.StartPrice;s<this.OXData.Max;s+=this.OXData.BlockSize){var o=this.ChartFrame.GetYFromData(s);this.IsHScreen?(this.Canvas.moveTo(L(o),e.Top),this.Canvas.lineTo(L(o),e.Bottom)):(this.Canvas.moveTo(a,L(o)),this.Canvas.lineTo(r,L(o)))}for(var s=this.OXData.StartPrice;s>this.OXData.Min;s-=this.OXData.BlockSize){var o=this.ChartFrame.GetYFromData(s);this.IsHScreen?(this.Canvas.moveTo(L(o),e.Top),this.Canvas.lineTo(L(o),e.Bottom)):(this.Canvas.moveTo(a,L(o)),this.Canvas.lineTo(r,L(o)))}for(var l=a+d.FrameLeftMargin,h=l;h<r;h+=this.SquareSize)this.IsHScreen?(this.Canvas.moveTo(e.LeftEx,L(h)),this.Canvas.lineTo(e.RightEx,L(h))):(this.Canvas.moveTo(L(h),t),this.Canvas.lineTo(L(h),n));this.Canvas.stroke()},this.Draw=function(){if(this.TooltipData=[],!this.ChartFrame.IsMinSize){if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.OXData||!this.OXData.Data))if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.CalcualteSquare(),this.DrawSquares(),this.IsHScreen){var e=this.ChartBorder.GetTop(),a=this.ChartBorder.GetBottom(),r=e+d.FrameLeftMargin;this.Canvas.textBaseline="middle",this.Canvas.textAlign="center",this.Canvas.font=this.Font;for(var t=0;t<this.OXData.Data.length&&!(r>a);++t,r+=this.SquareSize){var n=this.OXData.Data[t];this.Canvas.fillStyle=this.Color[n.Type];var s=this.Text[n.Type];if(v.IsNonEmptyArray(n.Data))for(var o=0;o<n.Data.length;++o){var l=n.Data[o],h=this.ChartFrame.GetYFromData(l+this.OXData.BlockSize/2);this.Canvas.fillText(s,h,r+this.SquareSize/2)}}}else{var e=this.ChartBorder.GetLeft(),a=this.ChartBorder.GetRight(),r=e+d.FrameLeftMargin;this.Canvas.textBaseline="middle",this.Canvas.textAlign="center",this.Canvas.font=this.Font;for(var t=0;t<this.OXData.Data.length&&!(r>a);++t,r+=this.SquareSize){var n=this.OXData.Data[t];this.Canvas.fillStyle=this.Color[n.Type];var s=this.Text[n.Type],u={X:r,Width:this.SquareSize},f=null,C=null;if(v.IsNonEmptyArray(n.Data)){for(var o=0;o<n.Data.length;++o){var l=n.Data[o],h=this.ChartFrame.GetYFromData(l+this.OXData.BlockSize/2);this.Canvas.fillText(s,r+this.SquareSize/2,h),(f==null||f<l)&&(f=l),(C==null||C>l)&&(C=l)}u.Y=this.ChartFrame.GetYFromData(f+this.OXData.BlockSize),u.Height=this.ChartFrame.GetYFromData(C)-u.Y;var D={Data:n,Rect:u};this.TooltipData.push(D)}}}}},this.GetTooltipData=function(e,a,r){for(var t in this.TooltipData){var n=this.TooltipData[t];if(n.Rect){var s=n.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(s.X,s.Y,s.Width,s.Height),this.Canvas.isPointInPath(e,a))return k.Chart.Log("[ChartOX::GetTooltipData] item ",n),r.Data=n,r.ChartPaint=this,r.Type=5,!0}}return!1},this.GetMaxMin=function(){var e={Min:null,Max:null};return this.OXData&&(v.IsNumber(this.OXData.Max)&&(e.Max=this.OXData.Max),v.IsNumber(this.OXData.Min)&&(e.Min=this.OXData.Min)),e}}function Zd(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartVolProfileVisibleRange",this.IsDrawFirst=!0,this.IsShowText=!0,this.VolType=0,this.BarPosition=1,this.BarWidthRate=.3,this.VolFont,this.HQChart,this.IsDestroy=!1,this.Data=null,this.MaxVol,this.MaxVolPrice,this.VolLineColor=d.ChartVolProfileVisibleRange.VolLineColor,this.VolLineFont=d.ChartVolProfileVisibleRange.VolLineFont,this.VolLineTextColor=d.ChartVolProfileVisibleRange.VolLineTextColor,this.VAHLineColor=d.ChartVolProfileVisibleRange.VAHLineColor,this.VAHTextColor=d.ChartVolProfileVisibleRange.VAHTextColor,this.VALLineColor=d.ChartVolProfileVisibleRange.VALLineColor,this.VALTextColor=d.ChartVolProfileVisibleRange.VALTextColor,this.VAFont=d.ChartVolProfileVisibleRange.VAFont,this.TextConfig=(0,ae.default)({Color:d.ChartVolProfileVisibleRange.Text.Color,Family:d.ChartVolProfileVisibleRange.Text.Family,FontMaxSize:d.ChartVolProfileVisibleRange.Text.FontMaxSize,FontMinSize:d.ChartVolProfileVisibleRange.Text.FontMinSize},"Color",d.ChartVolProfileVisibleRange.Text.Color),this.BarColor=[d.ChartVolProfileVisibleRange.UpVolColor,d.ChartVolProfileVisibleRange.DownVolColor,d.ChartVolProfileVisibleRange.AreaUpColor,d.ChartVolProfileVisibleRange.AreaDonwColor],this.MaxVolLine,this.OnDestroy=function(){this.IsDestroy=!0},this.SetOption=function(e){e&&(v.IsBool(e.IsShowText)&&(this.IsShowText=e.IsShowText),v.IsNumber(e.VolType)&&(this.IsShowText=e.VolType),v.IsNumber(e.BarPosition)&&(this.BarPosition=e.BarPosition),v.IsNumber(e.BarWidthRate)&&(this.IsShowText=e.BarWidthRate))},this.PtInChart=function(e,a){return this.MaxVolLine&&e>=this.MaxVolLine.Start.X&&e<=this.MaxVolLine.End.X&&a>=this.MaxVolLine.Start.Y-5&&a<this.MaxVolLine.Start.Y+5?{Identify:this.Identify,Chart:this}:null},this.SetSelectedStatus=function(e){e==0?this.IsDrawFirst=!0:this.IsDrawFirst=!1},this.DrawSelectedStatus=function(){var e=this.SelectedRadius,a=B();if(this.Canvas.save(),this.MaxVolLine){this.Canvas.lineWidth=this.SelectedLineWidth*a,this.Canvas.strokeStyle=this.SelectedLineColor,this.SelectedBGColor&&(this.Canvas.fillStyle=this.SelectedBGColor);for(var r=(this.MaxVolLine.End.X-this.MaxVolLine.Start.X)/6,t=[],n=this.MaxVolLine.Start.X+r;n<this.MaxVolLine.End.X;n+=r)t.push({X:n,Y:this.MaxVolLine.Start.Y});for(var s=0;s<t.length;++s){var o=t[s];this.Canvas.beginPath(),this.Canvas.arc(o.X,o.Y,e,0,360,!1),this.Canvas.closePath(),this.SelectedBGColor&&this.Canvas.fill(),this.Canvas.stroke()}}this.Canvas.restore()},this.Draw=function(){if(this.VolFont=null,this.MaxVolLine=null,this.IsHScreen=this.ChartFrame.IsHScreen===!0,!this.ChartFrame.IsMinSize){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}!this.Data||!this.Data.Data||(this.Canvas.save(),this.DrawVolBar(),this.Canvas.restore())}},this.DrawPriceLine=function(){var e=this.ChartBorder.GetLeft(),a=this.ChartBorder.GetRight(),r=B(),t=[],n=this.MaxVolPrice;v.IsNumber(this.Data.MaxVolPrice)&&(n=this.Data.MaxVolPrice),n>=this.ChartFrame.HorizontalMin&&n<=this.ChartFrame.HorizontalMax&&t.push({Price:n,Font:this.VolLineFont,LineColor:this.VolLineColor,LineWidth:2,TextColor:this.VolLineTextColor,Type:1}),v.IsNumber(this.Data.VAHPrice)&&this.Data.VAHPrice>=this.ChartFrame.HorizontalMin&&this.Data.VAHPrice<=this.ChartFrame.HorizontalMax&&t.push({Price:this.Data.VAHPrice,Font:this.VAFont,LineColor:this.VAHLineColor,LineWidth:2,TextColor:this.VAHTextColor,Type:2}),v.IsNumber(this.Data.VALPrice)&&this.Data.VALPrice>=this.ChartFrame.HorizontalMin&&this.Data.VALPrice<=this.ChartFrame.HorizontalMax&&t.push({Price:this.Data.VALPrice,Font:this.VAFont,LineColor:this.VALLineColor,LineWidth:2,TextColor:this.VALTextColor,Type:3});for(var s=0;s<t.length;++s){var o=t[s],l=$t(o.LineWidth,this.ChartFrame.GetYFromData(o.Price,!1));if(this.Canvas.lineWidth=o.LineWidth,this.Canvas.strokeStyle=o.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(e,l),this.Canvas.lineTo(a,l),this.Canvas.stroke(),o.Type==1&&(this.MaxVolLine={Start:{X:e,Y:l},End:{X:a,Y:l}}),this.ChartBorder.Right>10){var h=jt(this.HQChart.Symbol),u=o.Price.toFixed(h);this.Canvas.font=o.Font,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var f=this.GetFontHeight(),C=this.Canvas.measureText(u).width+2*r;this.Canvas.fillStyle=o.LineColor,this.Canvas.fillRect(a,l-f/2,C,f),this.Canvas.fillStyle=o.TextColor,this.Canvas.fillText(u,a+1*r,l)}}},this.DrawVolBar=function(){var e=this.GetPriceYOffset(this.Data.PriceOffset),a=this.ChartBorder.GetLeft(),r=this.ChartBorder.GetRight();this.ChartFrame.GetYFromData(this.Data.MaxPrice)-e/2,this.ChartFrame.GetYFromData(this.Data.MinPrice)+e/2;var t=r-a,n=t*this.BarWidthRate;this.IsShowText&&(this.VolFont=this.GetDynamicVolTextFont(e,n),this.VolFont&&(this.Canvas.font=this.VolFont));for(var s=0,o=0;s<this.Data.Data.length;++s){var l=this.Data.Data[s];l.Price<this.ChartFrame.HorizontalMin||l.Price>this.ChartFrame.HorizontalMax||this.DrawVolBarItem(l,a,r,n,e)}this.DrawPriceLine()},this.DrawVolBarItem=function(e,a,r,t,n){var s=a,o=r,l=this.ChartFrame.GetYFromData(e.Price)-n/2,h=n-1;if(h<1&&(h=1),this.VolType==1){if(!e.TotalVol||!v.IsNumber(e.TotalVol.Value))return;var u=e.TotalVol.Value*t/this.MaxVol,f;if(v.IsNumber(e.TotalVol.ColorID)?f=this.BarColor[e.TotalVol.ColorID]:e.TotalVol.Color&&(f=e.TotalVol.Color),this.Canvas.fillStyle=f,this.BarPosition==1?this.Canvas.fillRect(o,b(l),-u,b(h)):this.Canvas.fillRect(s,b(l),u,b(h)),this.IsShowText&&this.VolFont){var C=v.FormatVolString(e.TotalVol.Value,this.HQChart.LanguageID);this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextConfig.Color,this.BarPosition==1?(this.Canvas.textAlign="right",this.Canvas.fillText(C,r-5,l+n/2)):(this.Canvas.textAlign="left",this.Canvas.fillText(C,a+5,l+n/2))}}else{for(var C="",D=0;D<e.Vol.length;++D){var c=e.Vol[D];if(v.IsNumber(c.Value)){var f;if(v.IsNumber(c.ColorID)?f=this.BarColor[c.ColorID]:c.Color&&(f=c.Color),!!f){var u=c.Value*t/this.MaxVol;this.Canvas.fillStyle=f,this.BarPosition==1?(this.Canvas.fillRect(o,b(l),-u,b(h)),o-=u):(this.Canvas.fillRect(s,b(l),u,b(h)),s+=u);var T=v.FormatVolString(c.Value,this.HQChart.LanguageID);C.length>0&&(C+="x"),C+=T}}}this.IsShowText&&this.VolFont&&(this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextConfig.Color,this.BarPosition==1?(this.Canvas.textAlign="right",this.Canvas.fillText(C,r-5,l+n/2)):(this.Canvas.textAlign="left",this.Canvas.fillText(C,a+5,l+n/2)))}},this.GetPriceYOffset=function(e){var a=this.ChartFrame,r=a.ChartBorder.GetHeightEx()*e/(a.HorizontalMax-a.HorizontalMin);return r},this.GetDynamicVolTextFont=function(e,a,r){var t=parseInt(e)-2;if(e<5&&(t=parseInt(e)),t>this.TextConfig.FontMaxSize?t=this.TextConfig.FontMaxSize:t<=0&&(t=1),t<this.TextConfig.FontMinSize)return null;var n=this.FormatFontString(t,this.TextConfig.Family,r);return n},this.FormatFontString=function(e,a,r){var t;return r?r.Weight&&(t=r.Weight+" "+e+"px "+a):t=e+"px "+a,t},this.GetMaxMin=function(){var e={Min:null,Max:null};return e}}function tD(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartStackedBar",this.Data,this.BarName=[],this.BarColor=["rgb(255,165,0)","rgb(95,158,160)"],this.LineWidth=1,this.BarType=0,this.IsHScreen,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Data||!v.IsNonEmptyArray(this.Data.Data))){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var e=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,r=this.ChartFrame.XPointCount;if(this.IsHScreen)var t=this.ChartBorder.GetHScreenBorder(),n=t.TopEx+a/2+d.FrameLeftMargin,s=t.BottomEx,o=t.RightEx,l=t.LeftEx;else{var t=this.ChartFrame.GetBorder(),n=t.LeftEx+a/2+d.FrameLeftMargin,s=t.RightEx,o=t.TopEx,l=t.BottomEx,h=this.GetLockRect();h&&(s=h.Left)}var u=this.IsMinuteFrame();if(this.Canvas.save(),this.BarType!=1){this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*B());var f=this.Canvas.lineWidth}for(var C=this.ChartFrame.GetYFromData(0),D=this.Data.DataOffset,c=0;D<this.Data.Data.length&&c<r;++D,++c,n+=e+a){var T=this.Data.Data[D];if(v.IsNonEmptyArray(T)){if(u)var S=this.ChartFrame.GetXFromIndex(c);else{var I=n,g=n+e;if(g>s)break;var S=I+(g-I)/2}if(S>s)break;this.BarType==1?e>=4?this.DrawKBarItem(T,S,I,g,o,l,C,e):this.DrawBarItem(T,S,o,l,C,f):this.DrawBarItem(T,S,o,l,C,f)}}this.Canvas.restore()}},this.DrawKBarItem=function(e,a,r,t,n,s,o,l){for(var h=0,u=o,f=0,C=o,D=0;D<e.length;++D){var c=e[D];if(v.IsNumber(c)&&c!=0){if(this.Canvas.fillStyle=this.BarColor[D],c>0){h+=c;var T=this.ChartFrame.GetYFromData(h),S={Left:r,Top:T,Width:l,Height:u-T};u=T}else{f+=c;var T=this.ChartFrame.GetYFromData(f),S={Left:r,Top:T,Width:l,Height:C-T};C=T}this.IsHScreen?this.Canvas.fillRect(S.Top,S.Left,S.Height,S.Width):this.Canvas.fillRect(S.Left,S.Top,S.Width,S.Height)}}},this.DrawBarItem=function(e,o,r,t,n,s){for(var o=$t(s,o),l=0,h=n,u=0,f=n,C=0;C<e.length;++C){var D=e[C];if(v.IsNumber(D)&&D!=0){var c={};if(D>0){l+=D;var T=this.ChartFrame.GetYFromData(l),c={X:o,Y:h,X2:o,Y2:T};h=T}else{u+=D;var T=this.ChartFrame.GetYFromData(u),c={X:o,Y:f,X2:o,Y2:T};f=T}this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(c.Y,c.X),this.Canvas.lineTo(c.Y2,c.X2)):(this.Canvas.moveTo(c.X,c.Y),this.Canvas.lineTo(c.X2,c.Y2)),this.Canvas.strokeStyle=this.BarColor[C],this.Canvas.stroke()}}},this.GetMaxMin=function(){var e=this.ChartFrame.XPointCount,a={};if(a.Min=null,a.Max=null,!this.Data||!this.Data.Data)return a;for(var r=this.Data.DataOffset,t=0;r<this.Data.Data.length&&t<e;++r,++t){var n=this.Data.Data[r];if(!(!n||!v.IsNonEmptyArray(n))){for(var s=0,o=0,l=0;l<n.length;++l){var h=n[l];v.IsNumber(h)&&h!=0&&(h>0?s+=h:h<0&&(o+=h))}a.Max==null&&(a.Max=s,a.Min=o),a.Max<s&&(a.Max=s),a.Min>o&&(a.Min=o)}}return a},this.PtInChart=function(e,a){var r={StackedBar:!0};return this.BarType==0&&(r.BarWidth=4),this.PtInBar(e,a,r)},this.DrawSelectedStatus=function(){this.DrawLinePoint({StackedBar:!0})}}function Vo(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartLock",this.WidthDiv=.2,this.LockCount=20,this.BGColor=d.LockBGColor,this.TextColor=d.LockTextColor,this.Font=d.DefaultTextFont,this.Title="🔒开通权限",this.LockRect=null,this.LockID,this.Callback,this.IndexName,this.MinWidth=null,this.Draw=function(e){if(this.LockRect=null,this.NotSupportMessage){this.DrawNotSupportmessage();return}if(this.ChartFrame.IsHScreen===!0){this.HScreenDraw(e);return}var a=this.ChartBorder.GetRight(),r=0;if(this.ChartFrame.Data!=null){var t=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth;a=this.ChartBorder.GetLeft()+n/2+2;for(var s=this.ChartBorder.GetRight(),o=this.ChartFrame.XPointCount,l=this.ChartFrame.Data.DataOffset,h=0;l<this.ChartFrame.Data.Data.length&&h<o;++l,++h,a+=t+n){var u=this.ChartFrame.Data.Data[l];if(!(u.Open==null||u.High==null||u.Low==null||u.Close==null)){var f=a+t;if(f>s)break}}r=(t+n)*this.LockCount}r==0&&(r=(a-this.ChartBorder.GetLeft())*this.WidthDiv);var C=a-r;C<this.ChartBorder.GetLeft()&&(C=this.ChartBorder.GetLeft());var D=this.ChartBorder.GetBottom()-this.ChartBorder.GetTop(),c=this.ChartBorder.GetRight()-C;if(this.MinWidth>10&&c<this.MinWidth&&(c=this.MinWidth,C=this.ChartBorder.GetRight()-c,C<this.ChartBorder.GetLeft()&&(C=this.ChartBorder.GetLeft())),e){this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(C,this.ChartBorder.GetTop(),c,D);var T=C+c/2,S=this.ChartBorder.GetTop()+D/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.Title,T,S)}this.LockRect={Left:C,Top:this.ChartBorder.GetTop(),Width:c,Heigh:D}},this.HScreenDraw=function(e){var a=this.ChartBorder.GetBottom(),r=0;if(this.ChartFrame.Data!=null){var t=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth;a=this.ChartBorder.GetTop()+n/2+2;for(var s=this.ChartBorder.GetBottom(),o=this.ChartFrame.XPointCount,l=this.ChartFrame.Data.DataOffset,h=0;l<this.ChartFrame.Data.Data.length&&h<o;++l,++h,a+=t+n){var u=this.ChartFrame.Data.Data[l];if(!(u.Open==null||u.High==null||u.Low==null||u.Close==null)){var f=a+t;if(f>s)break}}r=(t+n)*this.LockCount}r==0&&(r=(a-this.ChartBorder.GetTop())*this.WidthDiv);var C=a-r;C<this.ChartBorder.GetTop()&&(C=this.ChartBorder.GetTop());var D=this.ChartBorder.GetRight()-this.ChartBorder.GetLeft(),c=this.ChartBorder.GetBottom()-C;this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(this.ChartBorder.GetLeft(),C,D,c);var T=this.ChartBorder.GetLeft()+D/2,S=C+c/2;this.Canvas.save(),this.Canvas.translate(T,S),this.Canvas.rotate(90*Math.PI/180),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.Title,0,0),this.Canvas.restore(),this.LockRect={Left:this.ChartBorder.GetLeft(),Top:C,Width:D,Heigh:c}},this.GetTooltipData=function(e,a,r){return this.LockRect==null?!1:(this.Canvas.beginPath(),this.Canvas.rect(this.LockRect.Left,this.LockRect.Top,this.LockRect.Width,this.LockRect.Heigh),this.Canvas.isPointInPath(e,a)?(r.Data={ID:this.LockID,Callback:this.Callback,IndexName:this.IndexName},r.ChartPaint=this,!0):!1)}}function Qd(){this.newMethod=gi,this.newMethod(),delete this.newMethod,this.ClassName="ChartBuySell",this.TextFont=d.KLineTrain.Font,this.LastDataIcon=d.KLineTrain.LastDataIcon,this.BuyIcon=d.KLineTrain.BuyIcon,this.SellIcon=d.KLineTrain.SellIcon,this.BuySellData=new Dt.default,this.IconFont=d.KLineTrain.IconFont,this.LastDataDrawType=0,this.LastDataIndex=-1,this.AddTradeItem=function(e){if(this.BuySellData.has(e.Key)){var a=this.BuySellData.get(e.Key);a.Data.push(e)}else this.BuySellData.set(e.Key,{Data:[e]})},this.ClearTradeData=function(){this.BuySellData=new Dt.default},this.Draw=function(){if(!(!this.Data||!this.Data.Data)){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.DataWidth,r=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetRight();e===!0&&(t=this.ChartBorder.GetBottom());var n=this.ChartFrame.XPointCount;if(this.IconFont){var s=B(),o=a+r,l=18*s;o<l&&(o=l),this.Canvas.font=o+"px "+this.IconFont.Family}else this.Canvas.font=this.TextFont;for(var h=this.Data.DataOffset,u=0;h<this.Data.Data.length&&u<n;++h,++u){var f=this.Data.Data[h];if(f!=null){var C=this.ChartFrame.GetXFromIndex(u);if(C>t)break;var D=!1;if(this.LastDataDrawType==1?h==this.LastDataIndex&&(D=!0):h==this.Data.Data.length-1&&(D=!0),D){var C=this.ChartFrame.GetXFromIndex(u),S=this.ChartFrame.GetYFromData(f.High);this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.IconFont?(this.Canvas.fillStyle=this.IconFont.Last.Color,this.DrawText(this.IconFont.Last.Text,C,S,e)):(this.Canvas.fillStyle=this.LastDataIcon.Color,this.Canvas.font=this.TextFont,this.DrawText(this.LastDataIcon.Text,C,S,e))}var c=h;if(this.BuySellData.has(c)){var T=this.BuySellData.get(c),S=this.ChartFrame.GetYFromData(f.High),I=this.ChartFrame.GetYFromData(f.Low),g=[!1,!1];for(var E in T.Data){if(g[0]==!0&&g[1]==!0)break;var F=T.Data[E];F.Op==0&&g[0]==!1?(this.Canvas.textAlign="center",this.Canvas.textBaseline="top",this.IconFont?(this.Canvas.fillStyle=this.IconFont.Buy.Color,this.DrawText(this.IconFont.Buy.Text,C,I,e)):(this.Canvas.fillStyle=this.BuyIcon.Color,this.DrawText(this.BuyIcon.Text,C,I,e)),g[0]=!0):F.Op==1&&g[1]==!1&&(this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.IconFont?(this.Canvas.fillStyle=this.IconFont.Sell.Color,this.DrawText(this.IconFont.Sell.Text,C,S,e)):(this.Canvas.fillStyle=this.SellIcon.Color,this.DrawText(this.SellIcon.Text,C,S,e)),g[1]=!0)}}}}}}}function $d(){this.newMethod=Xt,this.newMethod(),delete this.newMethod,this.ClassName="ChartOrderbookDepth",this.Data=null,this.AskColor={Line:d.DepthChart.AskColor.Line,Area:d.DepthChart.AskColor.Area},this.BidColor={Line:d.DepthChart.BidColor.Line,Area:d.DepthChart.BidColor.Area},this.LineWidth=d.DepthChart.LineWidth,this.Draw=function(){if(this.Data){var e=this.Canvas.lineWidth;this.Canvas.lineWidth=this.LineWidth*B(),this.DrawArea(this.Data.Bids,this.BidColor.Line,this.BidColor.Area,!0),this.DrawArea(this.Data.Asks,this.AskColor.Line,this.AskColor.Area,!1),this.Canvas.lineWidth=e}},this.DrawArea=function(e,a,r,t){var n=this.ChartFrame.VerticalRange,s=[];for(var o in e){var l=e[o];if(t){if(l.Price<n.Min)break}else if(l.Price>n.Max)break;var h=this.ChartFrame.GetXFromIndex(l.Price),u=this.ChartFrame.GetYFromData(l.Vol);s.push({X:h,Y:u})}if(!(s.length<=1)){var f=this.ChartBorder.GetLeft(),C=this.ChartBorder.GetBottom(),D=this.ChartBorder.GetRight();this.Canvas.beginPath(),this.Canvas.moveTo(s[0].X,C);for(var o in s){var l=s[o];this.Canvas.lineTo(l.X,l.Y)}this.Canvas.lineTo(t?f:D,s[s.length-1].Y),this.Canvas.lineTo(t?f:D,C),this.Canvas.lineTo(s[0].X,C),this.Canvas.closePath(),this.Canvas.fillStyle=r,this.Canvas.fill(),this.Canvas.beginPath(),this.Canvas.moveTo(s[0].X,C);for(var o in s){var l=s[o];this.Canvas.lineTo(l.X,l.Y)}this.Canvas.lineTo(t?f:D,s[s.length-1].Y),this.Canvas.strokeStyle=a,this.Canvas.stroke()}},this.GetMaxMin=function(){var e={Min:null,Max:null,XMin:null,XMax:null},a=this.ChartFrame.VerticalRange;for(var r in this.Data.Asks){var t=this.Data.Asks[r];if(t.Price>a.Max)break;(e.XMin==null||e.XMin>t.Price)&&(e.XMin=t.Price),(e.XMax==null||e.XMax<t.Price)&&(e.XMax=t.Price),(e.Min==null||e.Min>t.Vol)&&(e.Min=t.Vol),(e.Max==null||e.Max<t.Vol)&&(e.Max=t.Vol)}for(var r in this.Data.Bids){var t=this.Data.Bids[r];if(t.Price<a.Min)break;(e.XMin==null||e.XMin>t.Price)&&(e.XMin=t.Price),(e.XMax==null||e.XMax<t.Price)&&(e.XMax=t.Price),(e.Min==null||e.Min>t.Vol)&&(e.Min=t.Vol),(e.Max==null||e.Max<t.Vol)&&(e.Max=t.Vol)}return e}}function qd(){this.DataMap=new Dt.default([["FrameSplitPaint",{Create:function(){return new rD}}],["RectSelectPaint",{Create:function(){return new eI}}],["RectDragPaint",{Create:function(){return new aI}}],["DragMovePaint",{Create:function(){return new oI}}],["SessionBreaksPaint",{Create:function(){return new hI}}],["FrameButtomToolbarPaint",{Create:function(){return new lI}}]]),this.SetCallbackDraw=new Fe.default,this.Create=function(e){if(!this.DataMap.has(e))return null;var a=this.DataMap.get(e);return a.Create()},this.Add=function(e,a){this.DataMap.set(e,{Create:a.Create})},this.AddCallbackDrawClassName=function(e){e&&this.SetCallbackDraw.add(e)},this.IsCallbackDraw=function(e){return this.SetCallbackDraw.has(e)}}var Br=new qd;function oa(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.Data,this.IsDynamic=!1,this.IsAnimation=!1,this.ClassName="IExtendChartPainting",this.SizeChange=!0,this.IsEraseBG=!1,this.DrawAfterTitle=!1,this.DrawAfterPicture=!1,this.IsCallbackDraw=!1,this.ID=Re(),this.Left=5,this.Right=5,this.Top=5,this.Bottom=5,this.Draw=function(){},this.SetOption=function(e){},this.GetFontHeight=function(e){return Ea(this.Canvas,e,"擎")}}function rl(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.IsDynamic=!0,this.IsEraseBG=!0,this.DrawAfterTitle=!0,this.ClassName="KLineTooltipPaint",this.BorderColor=d.TooltipPaint.BorderColor,this.BGColor=d.TooltipPaint.BGColor,this.TitleColor=d.TooltipPaint.TitleColor,this.DateTimeColor=d.TooltipPaint.DateTimeColor,this.VolColor=d.TooltipPaint.VolColor,this.AmountColor=d.TooltipPaint.AmountColor,this.LatestPoint,this.ShowPosition=0,this.Left=1*B(),this.Top=5*B(),this.Width=50,this.Height=100,this.LineHeight=15*B(),this.LineSpace=2,this.Mergin={Left:2,Top:3,Bottom:5,Right:5},this.ExtendLineWidth=2,this.Font=[d.TooltipPaint.TitleFont],this.HQChart,this.KLineTitlePaint,this.IsHScreen=!1,this.LanguageID=xe.LANGUAGE_CHINESE_ID,this.ReloadResource=function(e){this.BorderColor=d.TooltipPaint.BorderColor,this.BGColor=d.TooltipPaint.BGColor,this.TitleColor=d.TooltipPaint.TitleColor,this.DateTimeColor=d.TooltipPaint.DateTimeColor,this.VolColor=d.TooltipPaint.VolColor,this.AmountColor=d.TooltipPaint.AmountColor},this.GetLeft=function(){return this.IsHScreen?this.ChartBorder.GetRightEx()-this.Height-this.Top:this.ShowPosition==0?this.ChartBorder.GetLeft()+this.Left:this.ChartBorder.GetRight()-this.Width-this.Left},this.GetTop=function(){return this.IsHScreen?this.ShowPosition==0?this.ChartBorder.GetTop()+this.Left:this.ChartBorder.GetBottom()-this.Width-this.Left:this.ChartBorder.GetTopEx()+this.Top},this.IsEnableDraw=function(){if(!this.HQChart||!this.HQChart.TitlePaint||!this.HQChart.TitlePaint[0])return!1;if(this.HQChart.DragMode==Ve.CLICK_TOUCH_MODE_ID){if(this.HQChart.TouchStatus.CorssCursorShow==!1)return!1}else if(this.HQChart.EnableClickModel){if(this.HQChart.ClickModel.IsShowCorssCursor===!1)return!1}else if(this.HQChart.VerticalDrag){if(this.HQChart.VerticalDrag.IsDrag)return!1}else if(!this.HQChart.IsOnTouch)return!1;return!this.HQChart.CurrentChartDrawPicture},this.Draw=function(){if(this.IsEnableDraw()){this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.KLineTitlePaint=this.HQChart.TitlePaint[0];var e=this.KLineTitlePaint.GetCurrentKLineData();if(e){var a=this.GetFormatTitle({Data:e});!a||!v.IsNonEmptyArray(a.AryText)||(this.CalculateTooltipSize(a),this.CalculateShowPosition(),this.DrawBG(),this.DrawTooltipData(a),this.DrawBorder())}}},this.CalculateTooltipSize=function(e){this.Canvas.font=this.Font[0],this.LineHeight=this.Canvas.measureText("擎").width;for(var a=B(),r=0,t=0,n=0,s=0,o=0;o<e.AryText.length;++o){var l=e.AryText[o];r>0&&(r+=this.LineSpace);var h=0;if(l.Title){var u=this.Canvas.measureText(l.Title).width+2;t<u&&(t=u),h+=u}if(l.Text){var u=this.Canvas.measureText(l.Text).width+2;n<u&&(n=u),h+=u}s<h&&(s=h),r+=this.LineHeight}return this.Height=r+(this.Mergin.Top+this.Mergin.Bottom)*a,this.Width=s+(this.Mergin.Left+this.Mergin.Right+this.ExtendLineWidth)*a,{Height:this.Height,Width:this.Width,MaxTitleWidth:t,MaxTextWidth:n}},this.CalculateShowPosition=function(){if(this.ShowPosition=0,!!this.LatestPoint)if(this.IsHScreen){var e=this.ChartBorder.GetTop(),a=this.ChartBorder.GetHeight(),r=e+a/2;this.LatestPoint.Y<r&&(this.ShowPosition=1)}else{var t=this.ChartBorder.GetLeft(),n=this.ChartBorder.GetWidth(),s=t+n/2;this.LatestPoint.X<s&&(this.ShowPosition=1)}},this.GetFormatTitle=function(e){if(!(!e||!e.Data)){var a=e.Data,r;this.HQChart.Symbol&&(r=this.HQChart.Symbol.toUpperCase());var t=jt(this.HQChart.Symbol),n=U.GetVolUnit(r),s=[],o={AryText:s},l,h,u;l=v.FormatDateString(a.Date),s.push({Text:l,Color:this.DateTimeColor});var f=this.HQChart.Period;if(Y.IsMinutePeriod(f,!0)&&v.IsNumber(a.Time)?(l=v.FormatTimeString(a.Time),s.push({Text:l,Color:this.DateTimeColor})):Y.IsSecondPeriod(f)&&v.IsNumber(a.Time)?(l=v.FormatTimeString(a.Time,"HH:MM:SS"),s.push({Text:l,Color:this.DateTimeColor})):Y.IsMilliSecondPeriod(f)&&v.IsNumber(a.Time)&&(l=v.FormatTimeString(a.Time,"HH:MM:SS.fff"),s.push({Text:l,Color:this.DateTimeColor})),v.IsNumber(a.Open)&&(h=St.GetText("Tooltip-Open",this.LanguageID),u=this.KLineTitlePaint.GetColor(a.Open,a.YClose),l=a.Open.toFixed(t),s.push({Title:h,TitleColor:this.TitleColor,Text:l,Color:u})),v.IsNumber(a.High)&&(h=St.GetText("Tooltip-High",this.LanguageID),u=this.KLineTitlePaint.GetColor(a.High,a.YClose),l=a.High.toFixed(t),s.push({Title:h,TitleColor:this.TitleColor,Text:l,Color:u})),v.IsNumber(a.Low)&&(h=St.GetText("Tooltip-Low",this.LanguageID),u=this.KLineTitlePaint.GetColor(a.Low,a.YClose),l=a.Low.toFixed(t),s.push({Title:h,TitleColor:this.TitleColor,Text:l,Color:u})),v.IsNumber(a.Close)&&(h=St.GetText("Tooltip-Close",this.LanguageID),u=this.KLineTitlePaint.GetColor(a.Close,a.YClose),l=a.Close.toFixed(t),s.push({Title:h,TitleColor:this.TitleColor,Text:l,Color:u})),h=St.GetText("Tooltip-Increase",this.LanguageID),v.IsNumber(a.YFClose)&&U.IsChinaFutures(r)){var C=(a.Close-a.YFClose)/a.YFClose*100;u=this.KLineTitlePaint.GetColor(C,0),l=C.toFixed(2)+"%"}else if(v.IsNumber(a.YClose)){var C=(a.Close-a.YClose)/a.YClose*100;u=this.KLineTitlePaint.GetColor(C,0),l=C.toFixed(2)+"%"}else l="--.--",u=this.KLineTitlePaint.GetColor(0,0);if(s.push({Title:h,TitleColor:this.TitleColor,Text:l,Color:u}),v.IsNumber(a.Vol)){h=St.GetText("Tooltip-Vol",this.LanguageID);var D=a.Vol;r&&U.IsSHSZ(r)&&(D/=100),l=v.FromatIntegerString(D/n,2,this.LanguageID),s.push({Title:h,TitleColor:this.TitleColor,Text:l,Color:this.VolColor})}if(v.IsNumber(a.Amount)){h=St.GetText("Tooltip-Amount",this.LanguageID);var l=v.FormatValueString(a.Amount,2,this.LanguageID);s.push({Title:h,TitleColor:this.TitleColor,Text:l,Color:this.AmountColor})}if(U.IsSHSZStockA(this.HQChart.Symbol)&&a.FlowCapital>0){h=St.GetText("Tooltip-Exchange",this.LanguageID);var C=a.Vol/a.FlowCapital*100,l=C.toFixed(2)+"%";s.push({Title:h,TitleColor:this.TitleColor,Text:l,Color:this.TitleColor})}if(U.IsFutures(r)&&v.IsNumber(a.Position)){h=St.GetText("Tooltip-Position",this.LanguageID);var l=v.FromatIntegerString(a.Position,2,this.LanguageID);s.push({Title:h,TitleColor:this.TitleColor,Text:l,Color:this.TitleColor})}return o}},this.DrawTooltipData=function(e){if(!(!e||!v.IsNonEmptyArray(e.AryText))){var a=B(),r=this.GetLeft()+2*a,t=this.GetTop()+3*a;if(this.IsHScreen){this.Canvas.save();var n=this.GetLeft()+this.Height,s=this.GetTop();this.Canvas.translate(n,s),this.Canvas.rotate(90*Math.PI/180),r=2*a,t=3*a}this.Canvas.textBaseline="top";var o=r+this.Width-this.Mergin.Right*a;r+=this.Mergin.Left*a,t+=this.Mergin.Top*a;for(var l=0;l<e.AryText.length;++l){var h=e.AryText[l];h.Title&&(this.Canvas.textAlign="left",this.Canvas.fillStyle=h.TitleColor,this.Canvas.fillText(h.Title,r,t)),h.Text&&(this.Canvas.textAlign="right",this.Canvas.fillStyle=h.Color,this.Canvas.fillText(h.Text,o,t)),t+=this.LineHeight+this.LineSpace}this.IsHScreen&&this.Canvas.restore()}},this.DrawBorder=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.GetLeft(),r=this.GetTop();this.Canvas.strokeStyle=this.BorderColor,e?this.Canvas.strokeRect(L(a),L(r),this.Height,this.Width):this.Canvas.strokeRect(L(a),L(r),b(this.Width),b(this.Height))},this.DrawBG=function(){var e=this.ChartFrame.IsHScreen===!0,a=this.GetLeft(),r=this.GetTop();this.Canvas.fillStyle=this.BGColor,e?this.Canvas.fillRect(a,r,this.Height,this.Width):this.Canvas.fillRect(a,r,this.Width,this.Height)},this.SetOption=function(e){e&&(e.LineHeight>0&&(this.LineHeight=e.LineHeight*B()),e.BGColor&&(this.BGColor=e.BGColor),e.LanguageID>0&&(this.LanguageID=e.LanguageID),v.IsNumber(e.LineSpace)&&(this.LineSpace=e.LineSpace),v.IsNumber(e.ExtendLineWidth)&&(this.ExtendLineWidth=e.ExtendLineWidth),wa(this.Mergin,e.Mergin))}}function eD(){this.newMethod=rl,this.newMethod(),delete this.newMethod,this.ClassName="MinuteTooltipPaint",this.Left=1*B(),this.Top=1*B(),this.YClose,this.IsShowAveragePrice=!0,this.TitlePaint,this.GetTop=function(){if(this.IsHScreen){var e=this.ChartBorder.GetHScreenBorder();return this.ShowPosition==0?e.TopEx+this.Left:e.BottomEx-this.Width-this.Left}else{var e=this.ChartBorder.GetBorder();return e.Top+this.Top}},this.GetLeft=function(){if(this.IsHScreen){var e=this.ChartBorder.GetHScreenBorder();return e.Right-this.Height-this.Top}else{var e=this.ChartBorder.GetBorder();return this.ShowPosition==0?e.LeftEx+this.Left:e.RightEx-this.Width-this.Left}},this.Draw=function(){if(this.IsEnableDraw()&&(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.TitlePaint=this.HQChart.TitlePaint[0],!!this.TitlePaint)){var e,a=this.TitlePaint.PointInfo;if(a&&(a.ClientPos==2||a.ClientPos==3||a.ClientPos>=200&&a.ClientPos<=299||a.ClientPos>=300&&a.ClientPos<=399)){var r=this.TitlePaint.GetCurrentAuctionData();if(!r)return;e={Type:1,Data:r}}else{var t=this.TitlePaint.GetCurrentKLineData();if(!t)return;e={Type:0,Data:t}}var n=this.GetFormatTitle(e);!n||!v.IsNonEmptyArray(n.AryText)||(this.CalculateTooltipSize(n),this.CalculateShowPosition(),this.DrawBG(),this.DrawTooltipData(n),this.DrawBorder())}},this.GetFormatTitle=function(e){if(!(!e||!e.Data)){var a,r,t,n;if(e.Type==0)a=e.Data,r=a.Close,t=a.Vol,n=a.Amount;else if(e.Type==1){if(a=e.Data.Data,!a)return;r=a.Price}var s;this.HQChart.Symbol&&(s=this.HQChart.Symbol.toUpperCase());var o=U.IsFutures(s),l=jt(this.HQChart.Symbol),h=U.GetVolUnit(s);this.YClose=this.TitlePaint.YClose,this.YClose=a.YClose,o&&v.IsNumber(a.YClearing)&&(this.YClose=a.YClearing);var u=[],f={AryText:u},C,D,c;v.IsNumber(a.Date)&&(C=v.FormatDateString(a.Date),u.push({Text:C,Color:this.DateTimeColor})),v.IsNumber(a.Time)&&(C=v.FormatTimeString(a.Time),u.push({Text:C,Color:this.DateTimeColor})),v.IsNumber(r)&&(D=St.GetText("Tooltip-Price",this.LanguageID),c=this.TitlePaint.GetColor(r,this.YClose),C=r.toFixed(l),u.push({Title:D,TitleColor:this.TitleColor,Text:C,Color:c}));var T=!0;if((U.IsForeignExchange(s)||U.IsET(s)&&!U.IsETShowAvPrice(s)||U.IsShowAvPrice&&!U.IsShowAvPrice(s))&&(T=!1),T&&v.IsNumber(a.AvPrice)&&this.IsShowAveragePrice){D=St.GetText("Tooltip-AvPrice",this.LanguageID);var c=this.TitlePaint.GetColor(a.AvPrice,this.YClose);C=a.AvPrice.toFixed(l),u.push({Title:D,TitleColor:this.TitleColor,Text:C,Color:c})}if(v.IsNumber(r)&&v.IsNumber(this.YClose)){if(D=St.GetText("Tooltip-Increase",this.LanguageID),this.YClose===0)C="--.--",c=this.TitleColor;else{var S=(r-this.YClose)/this.YClose*100;c=this.TitlePaint.GetColor(S,0),C=S.toFixed(2)+"%"}u.push({Title:D,TitleColor:this.TitleColor,Text:C,Color:c})}if(v.IsNumber(t)){D=St.GetText("Tooltip-Vol",this.LanguageID);var C=v.FromatIntegerString(t/h,2,this.LanguageID);u.push({Title:D,TitleColor:this.TitleColor,Text:C,Color:this.VolColor})}if(v.IsNumber(n)){D=St.GetText("Tooltip-Amount",this.LanguageID);var C=v.FormatValueString(n,2,this.LanguageID);u.push({Title:D,TitleColor:this.TitleColor,Text:C,Color:this.AmountColor})}if(v.IsNumber(a.Position)){D=St.GetText("Tooltip-Position",this.LanguageID);var C=v.FormatValueString(a.Position,2,this.LanguageID);u.push({Title:D,TitleColor:this.TitleColor,Text:C,Color:this.TitleColor})}return f}}}function jd(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.IsDynamic=!0,this.IsEraseBG=!0,this.DrawAfterTitle=!0,this.ClassName="MinuteLeftTooltipPaint",this.BorderColor=d.PCTooltipPaint.BorderColor,this.BGColor=d.PCTooltipPaint.BGColor,this.TitleColor=d.PCTooltipPaint.TitleColor,this.DateTimeColor=d.PCTooltipPaint.DateTimeColor,this.VolColor=d.PCTooltipPaint.VolColor,this.AmountColor=d.PCTooltipPaint.AmountColor,this.PositionColor=d.PCTooltipPaint.PositionColor,this.LanguageID=xe.LANGUAGE_CHINESE_ID,this.TitlePaint,this.UpColor=d.UpTextColor,this.DownColor=d.DownTextColor,this.UnchagneColor=d.UnchagneTextColor,this.YClose,this.Mergin={Left:2,Top:3,Bottom:2,Right:2},this.LineHeight=15,this.FixedWidth,this.Font=d.PCTooltipPaint.TitleFont,this.HQChart,this.SetOption=function(e){e.BGColor&&(this.BGColor=e.BGColor),e.LanguageID>0&&(this.LanguageID=e.LanguageID),v.IsNumber(e.FixedWidth)&&(this.FixedWidth=e.FixedWidth)},this.ReloadResource=function(e){this.BorderColor=d.PCTooltipPaint.BorderColor,this.BGColor=d.PCTooltipPaint.BGColor,this.TitleColor=d.PCTooltipPaint.TitleColor,this.DateTimeColor=d.PCTooltipPaint.DateTimeColor,this.VolColor=d.PCTooltipPaint.VolColor,this.AmountColor=d.PCTooltipPaint.AmountColor,this.UpColor=d.UpTextColor,this.DownColor=d.DownTextColor,this.UnchagneColor=d.UnchagneTextColor,this.Font=d.PCTooltipPaint.TitleFont},this.IsEnableDraw=function(){if(!this.HQChart||!this.HQChart.TitlePaint||!this.HQChart.TitlePaint[0])return!1;var e=this.HQChart.LastPoint;return!e||this.HQChart.ChartCorssCursor&&!this.HQChart.ChartCorssCursor.IsShowCorss?!1:this.HQChart.IsMouseOnClient(e.X,e.Y)},this.Draw=function(){if(this.IsEnableDraw()&&(this.TitlePaint=this.HQChart.TitlePaint[0],!!this.TitlePaint)){var e=this.TitlePaint.PointInfo,a;if(e&&(e.ClientPos==2||e.ClientPos==3||e.ClientPos>=200&&e.ClientPos<=299||e.ClientPos>=300&&e.ClientPos<=399)){var r=this.TitlePaint.GetCurrentAuctionData();if(!r)return;a={Type:1,Data:r}}else{var t=this.TitlePaint.GetCurrentKLineData();if(!t)return;a={Type:0,Data:t}}this.YClose=this.TitlePaint.YClose;var n=this.GetForamtTitle(a);if(v.IsNonEmptyArray(n)){this.Canvas.font=this.Font,this.Canvas.textBaseline="top",this.LineHeight=Ea(this.Canvas,null,"擎");var s=this.ChartBorder.GetBorder(),o=this.LineHeight*n.length*2,l={Left:1,Top:1,Right:s.Left};l.Bottom=l.Top+o,l.Width=l.Right-l.Left,l.Height=l.Bottom-l.Top,l.Height+=this.Mergin.Top+this.Mergin.Bottom,l.Bottom=l.Top+l.Height,v.IsNumber(this.FixedWidth)&&(l.Width=this.FixedWidth),this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(l.Left,l.Top,l.Width,l.Height),this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(L(l.Left),L(l.Top),b(l.Width),b(l.Height));var h=l.Left+l.Width-this.Mergin.Right,u=this.Mergin.Left+l.Left,f=this.Mergin.Top+l.Top,C={Left:u,Top:f,Right:h};C.Width=C.Right-C.Left;for(var D=0;D<n.length;++D){var c=n[D];this.DrawText(c,C)}}}},this.DrawText=function(e,a){this.Canvas.fillStyle=e.TitleColor,this.Canvas.textAlign="left",this.Canvas.fillText(e.Title,a.Left,a.Top),a.Top+=this.LineHeight,a.Bottom=a.Top+this.LineHeight,this.Canvas.textAlign="right",this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(e.Text,a.Right,a.Top),a.Top+=this.LineHeight,a.Bottom=a.Top+this.LineHeight},this.GetForamtTitle=function(e){if(!e||!e.Data)return null;var a=[],r=!1,t;this.HQChart.Symbol&&(t=this.HQChart.Symbol.toUpperCase());var n=jt(t);t&&(r=U.IsFutures(t));var s=U.GetVolUnit(t);if(e.Type==0){var o=e.Data;if(!o)return;this.YClose=o.YClose,r&&v.IsNumber(o.YClearing)&&(this.YClose=o.YClearing);var l=this.FormatDate(o.Date);l&&a.push(l);var l=this.ForamtTime(o.Time,"HH:MM","PCTooltip-Time");l&&a.push(l);var l=this.ForamtPrice(o.Close,n,"PCTooltip-Price");l&&a.push(l);var l=this.ForamtPrice(o.AvPrice,n,"PCTooltip-AvPrice");l&&a.push(l);var l=this.ForamtIncrease(o.Close,"PCTooltip-Increase");l&&a.push(l);var l=this.FormatVol(o.Vol/s,"PCTooltip-Vol");if(l&&a.push(l),v.IsNumber(o.Amount)){var l={Title:St.GetText("PCTooltip-Amount",this.LanguageID),TitleColor:this.TitleColor,Text:v.FromatIntegerString(o.Amount,2,this.LanguageID),TextColor:this.AmountColor};a.push(l)}if(r&&v.IsNumber(o.Position)){var l=this.FormatPosition(o.Position,"PCTooltip-Position");l&&a.push(l)}}else if(e.Type==1){var o=e.Data.Data;if(!o)return;this.YClose=o.YClose,r&&v.IsNumber(o.YClearing)&&(this.YClose=o.YClearing);var l=this.FormatDate(o.Date);l&&a.push(l);var h="HH:MM:SS";o.Ver===1&&(h="HH:MM");var l=this.ForamtTime(o.Time,h,"PCTooltip-Time");l&&a.push(l);var l=this.ForamtPrice(o.Price,n,"PCTooltip-AC-Price");l&&a.push(l);var l=this.ForamtIncrease(o.Price,"PCTooltip-AC-Increase");if(l&&a.push(l),v.IsNonEmptyArray(o.Vol)){var l=this.FormatVol(o.Vol[0]/s,"PCTooltip-AC-Vol");l&&a.push(l);var l=this.FormatVol(o.Vol[1]/s,"PCTooltip-AC-NotMatchVol");l&&a.push(l)}}return a},this.GetColor=function(e,a){return e>a?this.UpColor:e<a?this.DownColor:this.UnchagneColor},this.FormatDate=function(e){if(!v.IsNumber(e))return null;var a={Title:St.GetText("PCTooltip-Date",this.LanguageID),TitleColor:this.TitleColor,Text:v.FormatDateString(e,"MM-DD",this.LanguageID),TextColor:this.DateTimeColor};return a},this.ForamtTime=function(e,a,r){if(!v.IsNumber(e))return null;var t={Title:St.GetText(r,this.LanguageID),TitleColor:this.TitleColor,Text:v.FormatTimeString(e,a,this.LanguageID),TextColor:this.DateTimeColor};return t},this.ForamtPrice=function(e,a,r){if(!v.IsNumber(e))return null;var t={Title:St.GetText(r,this.LanguageID),TitleColor:this.TitleColor,Text:e.toFixed(a),TextColor:this.GetColor(e,this.YClose)};return t},this.ForamtIncrease=function(e,a){if(!v.IsNumber(e)||e==0)return null;var r=(e-this.YClose)/this.YClose*100,t={Title:St.GetText(a,this.LanguageID),TitleColor:this.TitleColor,Text:r.toFixed(2)+"%",TextColor:this.GetColor(r,0)};return this.YClose===0&&(t.Text="--.--",t.TextColor=this.TitleColor),t},this.FormatVol=function(e,a){if(!v.IsNumber(e))return null;var r={Title:St.GetText(a,this.LanguageID),TitleColor:this.TitleColor,Text:v.FromatIntegerString(e,2,this.LanguageID),TextColor:this.VolColor};return r},this.FormatPosition=function(e,a){if(!v.IsNumber(e))return null;var r={Title:St.GetText(a,this.LanguageID),TitleColor:this.TitleColor,Text:e.toFixed(0),TextColor:this.PositionColor};return r}}function tI(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.Left=80,this.Right=1,this.Top=1,this.Bottom=1,this.BorderColor=d.FrameBorderPen,this.Symbol,this.Name,this.TitleFont=["14px 微软雅黑"],this.Draw=function(){var e=this.ChartBorder.GetRight()+this.Left,a=this.ChartBorder.GetChartWidth()-this.Right,r=this.Top+18,t=e+(a-e)/2;this.Symbol&&this.Name&&(this.Canvas.font=this.TitleFont[0],this.Canvas.textAlign="right",this.Canvas.textBaseline="bottom",this.Canvas.fillText(this.Symbol,t-2,r),this.Canvas.textAlign="left",this.Canvas.fillText(this.Name,t+2,r)),this.Canvas.strokeStyle=this.BorderColor,this.Canvas.moveTo(e,r),this.Canvas.lineTo(a,r),this.Canvas.stroke(),r+=30,this.DrawBorder()},this.DrawBorder=function(){var e=this.ChartBorder.GetRight()+this.Left,a=this.ChartBorder.GetChartWidth()-this.Right,r=this.Top,t=this.ChartBorder.GetChartHeight()-this.Bottom;this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(e,r,a-e,t-r)}}function aD(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.Name="筹码分布",this.ClassName="StockChip",this.HQChart,this.PenBorder=d.FrameBorderPen,this.ColorProfit="rgb(255,0,0)",this.ColorNoProfit="rgb(90,141,248)",this.ColorAveragePrice="rgb(0,139,0)",this.ColorBG="rgb(190,190,190)",this.PixelRatio=B(),this.ShowType=0,this.IsDynamic=!0,this.ClientRect={},this.Font=d.StockChip.Font,this.InfoColor=d.StockChip.InfoColor,this.DayInfoColor=d.StockChip.DayInfoColor,this.LineHeight=16,this.Left=50*this.PixelRatio,this.IsShowX=!1,this.ShowXCount=3,this.Width=150*this.PixelRatio,this.CalculateType=0,this.PriceZoom=100,this.NotSupportMessage="不支持筹码图",this.Buttons=[],this.DefaultButton=At(d.StockChip.DefaultButton),this.LongButton=At(d.StockChip.LongButton),this.RecentButton=At(d.StockChip.RecentButton),this.ButtonTooltip=At(d.Buttons.Tooltip),this.DAY_COLOR=[["rgb(255,0,0)","rgb(255,128,128)","rgb(255,0,128)","rgb(255,100,0)","rgb(192,128,0)","rgb(255,192,0)"],["rgb(120,80,225)","rgb(160,160,225)","rgb(80,80,255)","rgb(120,120,255)","rgb(32,64,192)","rgb(0,64,128)"]],this.SetOption=function(e){e&&(e.ShowType>0&&(this.ShowType=e.ShowType),e.IsShowX&&(this.IsShowX=e.IsShowX),e.ShowXCount>0&&(this.ShowXCount=e.ShowXCount),e.Width>100&&(this.Width=e.Width*B()),e.CalculateType>0&&(this.CalculateType=e.CalculateType),v.IsNumber(e.PriceZoom)&&(this.PriceZoom=e.PriceZoom))},this.ReloadResource=function(e){this.PenBorder=d.FrameBorderPen,this.Font=d.StockChip.Font,this.InfoColor=d.StockChip.InfoColor,this.DayInfoColor=d.StockChip.DayInfoColor,this.DefaultButton=At(d.StockChip.DefaultButton),this.LongButton=At(d.StockChip.LongButton),this.RecentButton=At(d.StockChip.RecentButton),this.ButtonTooltip=At(d.Buttons.Tooltip)},this.Draw=function(){this.PixelRatio=B();var e=L(this.ChartBorder.GetRight()+this.Left),a=L(this.ChartBorder.GetTop()),r=L(e+this.Width-1*this.PixelRatio),t=L(this.ChartBorder.GetBottom()),n=r-e,s=t-a;if(this.ClientRect={Left:e,Top:a,Width:n,Height:s},Y.IsTickPeriod(this.HQChart.Period)){this.Canvas.font=this.Font,this.Canvas.fillStyle=this.InfoColor;var o=e+n/2,l=a+s/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.NotSupportMessage,o,l),this.DrawBorder();return}this.CalculateChip()?(this.DrawFrame(),this.DrawAllChip(),(this.ShowType==1||this.ShowType==2)&&this.DrawDayChip(),this.CalculateCast(),this.DrawChipInfo()):k.Chart.Log("[StockChip::Draw] no data"),this.DrawBorder(),this.SizeChange=!1},this.DrawChipInfo=function(){var e=this.ClientRect.Top+this.ClientRect.Height-1,a=this.ClientRect.Left+2,o=this.ClientRect.Left+this.ClientRect.Width;this.Canvas.font=this.Font,this.Canvas.fillStyle=this.InfoColor,this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left";var r=this.LineHeight*B(),t="70%成本价 --.--";v.IsNonEmptyArray(this.Data.Cast)&&(t="70%成本价"+this.Data.Cast[1].MinPrice.toFixed(2)+"-"+this.Data.Cast[1].MaxPrice.toFixed(2)+"集中"+this.Data.Cast[1].Rate.toFixed(2)+"%"),this.Canvas.fillText(t,a,e),e-=r,t="90%成本价 --.--",v.IsNonEmptyArray(this.Data.Cast)&&(t="90%成本价"+this.Data.Cast[0].MinPrice.toFixed(2)+"-"+this.Data.Cast[0].MaxPrice.toFixed(2)+"集中"+this.Data.Cast[0].Rate.toFixed(2)+"%"),this.Canvas.fillText(t,a,e),e-=r,t="平均成本："+this.Data.ChipInfo.AveragePrice.toFixed(2)+"元",this.Canvas.fillText(t,a,e),e-=r,t=+this.Data.YPrice.toFixed(2)+"处获利盘："+this.Data.ChipInfo.YProfitRate.toFixed(2)+"%",this.Canvas.fillText(t,a,e),e-=r,t="获利比例：",this.Canvas.fillText(t,a,e);var l=this.Canvas.measureText(t).width+2,n=a+l,s=o-5-n;if(this.Canvas.strokeStyle=this.ColorNoProfit,this.Canvas.strokeRect(n,e-r,s,r),this.Canvas.strokeStyle=this.ColorProfit,this.Canvas.strokeRect(n,e-r,s*(this.Data.ChipInfo.ProfitRate/100),r),t=this.Data.ChipInfo.ProfitRate.toFixed(2)+"%",this.Canvas.textAlign="center",this.Canvas.fillText(t,n+s/2,e),e-=r,this.Canvas.textAlign="left",t="成本分布,日期："+v.FormatDateString(this.Data.SelectData.Date),this.Data.SelectData.Time&&(t+=" "+v.FormatTimeString(this.Data.SelectData.Time)),this.Canvas.fillText(t,a,e),e-=r,!(this.ShowType!=1&&this.ShowType!=2)){var o=this.ClientRect.Left+this.ClientRect.Width-1;this.Canvas.textAlign="right";var l=50;this.Data.DayChip.sort(function(C,D){return D.Day-C.Day});for(var h in this.Data.DayChip){var u=this.Data.DayChip[h],f=0;this.Data.ChipInfo&&this.Data.ChipInfo.Vol>0&&(f=u.Vol/this.Data.ChipInfo.Vol*100),t=u.Day+"周期"+(this.ShowType==1?"前":"内")+"成本"+(v.IsNumber(f)?f.toFixed(2)+"%":"--.--%"),h==0&&(l=this.Canvas.measureText(t).width+8),this.Canvas.fillStyle=u.Color,this.Canvas.fillRect(o-l,e-r,l,r),this.Canvas.fillStyle=this.DayInfoColor,this.Canvas.fillText(t,o,e),e-=r}}},this.DrawDayChip=function(){var e=this.HQChart.Frame.SubFrame[0].Frame;for(var a in this.Data.DayChip){var r=[],t=this.Data.DayChip[a].Chip;if(t){for(var n=0,s=0;s<t.length;++s){var o=t[s];if(o){n+=o;var l=(s+this.Data.MinPrice)/100,h=e.GetYFromData(l),u=o/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;r.push({X:u,Y:h})}}this.Data.DayChip[a].Vol=n,this.DrawArea(r,this.Data.DayChip[a].Color)}}},this.DrawToolbar=function(e,a){this.Buttons=[],this.ClientRect.Left;for(var r=this.ClientRect.Left+this.ClientRect.Width,t=this.ClientRect.Top+this.ChartBorder.TitleHeight/2,n=[{ID:Rt.CHIP_RECENT,Style:this.RecentButton,ShowType:2},{ID:Rt.CHIP_LONG,Style:this.LongButton,ShowType:1},{ID:Rt.CHIP_DEFULT,Style:this.DefaultButton,ShowType:0}],s=0;s<n.length;++s){var o=n[s],l=o.Style.Size,h=r-l-o.Style.MerginLeft,u=l+"px "+o.Style.Family,f={Left:h,Top:t-l/2,Right:h+l+o.Style.MerginLeft,Bottom:t+l/2,Width:l+o.Style.MerginLeft,Height:l},C=o.Style.Color,D={ID:o.ID,Rect:f};this.ShowType==o.ShowType?(C=o.Style.SelectedColor,a&&e&&e.X>=f.Left&&e.X<f.Right&&e.Y>=f.Top&&e.Y<=f.Bottom&&(a.MouseOnToolbar={Rect:f,Item:D,Frame:this,Point:{X:e.X,Y:e.Y}})):e&&e.X>=f.Left&&e.X<f.Right&&e.Y>=f.Top&&e.Y<=f.Bottom&&(C=o.Style.MoveOnColor,a&&(a.MouseOnToolbar={Rect:f,Item:D,Frame:this,Point:{X:e.X,Y:e.Y}})),this.Canvas.fillStyle=C,this.Canvas.font=u,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(o.Style.Text,h,t),this.Buttons.push(D),r=h}},this.DrawToolbarTooltip=function(e){if(e){this.ClientRect.Left;var a=this.ClientRect.Left+this.ClientRect.Width,r="Toolbar-"+e.Item.ID;if(text=St.GetText(r,0),!!text){var t=e.Rect,n=t.Left+t.Width/2;this.Canvas.font=this.ButtonTooltip.Font,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var s=this.Canvas.measureText(text).width+8,o=this.GetFontHeight(),l=o+8,h=n-s/2,u=t.Top-l;u<0&&(u=t.Bottom+1),h+s>a&&(h=a-s-2),this.Canvas.fillStyle=this.ButtonTooltip.ColorBG,this.Canvas.fillRect(h,u,s,l),this.Canvas.fillStyle=this.ButtonTooltip.Color,this.Canvas.fillText(text,h+4,u+l/2)}}},this.PtInButtons=function(e,a){for(var r=0;r<this.Buttons.length;++r){var t=this.Buttons[r];if(t.Rect){var n=t.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(n.Left,n.Top,n.Width,n.Height),this.Canvas.isPointInPath(e,a))return{ID:t.ID,Rect:n}}}return null},this.DrawAllChip=function(){for(var e=this.HQChart.Frame.SubFrame[0].Frame,a=this.Data.SelectData.Close,r=[],t=[],n=0,s=0,o=0,l=0,h=this.Data.YPrice,u=e.HorizontalMax,f=e.HorizontalMin,C=1,D=0;D<this.Data.AllChip.length;++D){var c=this.Data.AllChip[D];if(c){var T=(D+this.Data.MinPrice)/this.PriceZoom;n+=c,s+=T*c,T<h&&(l+=c),T<a&&(o+=c),T<=u&&T>=f&&C<c&&(C=c)}}this.Data.MaxVol=C;for(var D=0;D<this.Data.AllChip.length;++D){var c=this.Data.AllChip[D];if(c){var T=(D+this.Data.MinPrice)/this.PriceZoom;if(!(T>u||T<f)){var S=e.GetYFromData(T),I=c/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;T<a?r.push({X:I,Y:S}):t.push({X:I,Y:S})}}}if(this.Data.ChipInfo={Vol:n,AveragePrice:s/n,ProfitVol:o,ProfitRate:n>0?o/n*100:0,YProfitRate:n>0?l/n*100:0},this.ShowType==0){this.DrawLines(r,this.ColorProfit),this.DrawLines(t,this.ColorNoProfit);var g=this.Data.ChipInfo.AveragePrice;g>0&&g<=u&&g>=f&&(g=g.toFixed(2),this.DrawAveragePriceLine(r,t,e.GetYFromData(g),this.ColorAveragePrice))}else this.DrawLines(r,this.ColorBG),this.DrawLines(t,this.ColorBG)},this.CalculateCast=function(){if(!(!this.Data.ChipInfo||!this.Data.ChipInfo.Vol)){var e=[{Start:.05,End:.95,MaxPrice:0,MinPrice:0,Rate:0},{Start:.15,End:.85,MaxPrice:0,MinPrice:0,Rate:0}];this.Data.ChipInfo.AveragePrice;for(var a=this.Data.ChipInfo.ProfitVol,r=0,t=0,n=0;t<this.Data.AllChip.length&&n!=4;++t){var s=this.Data.AllChip[t];if(!(s<=0)){var o=(t+this.Data.MinPrice)/this.PriceZoom;r+=s;var l=r/a;for(var h in e){var u=e[h];u.MinPrice<=0&&l>u.Start&&(u.MinPrice=o,++n),u.MaxPrice<=0&&l>u.End&&(u.MaxPrice=o,++n)}}}for(var t in e){var f=e[t],C=f.MaxPrice+f.MinPrice;C&&(f.Rate=Math.abs(f.MaxPrice-f.MinPrice)/C*100)}this.Data.Cast=e}},this.DrawArea=function(e,a){if(!(e.length<=0)){this.Canvas.fillStyle=a,this.Canvas.beginPath(),this.Canvas.moveTo(this.ClientRect.Left,e[0].Y);for(var r in e){var t=e[r];this.Canvas.lineTo(t.X,t.Y)}this.Canvas.lineTo(this.ClientRect.Left,e[e.length-1].Y),this.Canvas.fill()}},this.DrawLines=function(e,a){if(!(e.length<=0)){this.Canvas.strokeStyle=a,this.Canvas.beginPath();for(var r in e){var t=e[r];this.Canvas.moveTo(this.ClientRect.Left,t.Y),this.Canvas.lineTo(t.X,t.Y)}this.Canvas.stroke()}},this.DrawAveragePriceLine=function(e,a,r,t){for(var n in e){var s=e[n];if(s.Y==r){this.Canvas.strokeStyle=t,this.Canvas.beginPath(),this.Canvas.moveTo(this.ClientRect.Left,s.Y),this.Canvas.lineTo(s.X,s.Y),this.Canvas.stroke();return}}for(var n in a){var s=a[n];if(s.Y==r){this.Canvas.strokeStyle=t,this.Canvas.beginPath(),this.Canvas.moveTo(this.ClientRect.Left,s.Y),this.Canvas.lineTo(s.X,s.Y),this.Canvas.stroke();return}}},this.DrawBorder=function(){this.Canvas.strokeStyle=this.PenBorder,this.Canvas.strokeRect(this.ClientRect.Left,this.ClientRect.Top,this.ClientRect.Width,this.ClientRect.Height)},this.EvenlyDistribute=function(e,a){var r=a.Low,t=a.High,n=a.MaxPrice,s=a.MinPrice,o=1;if(t-r!=0){for(var l=a.Vol/(t-r),h=r;h<=t&&h<=n;++h){var u=h-s;e[u]+=l,o<e[u]&&(o=e[u])}a.MaxVol=o}},this.TriangleDistribute=function(e,a){var r=a.Low,t=a.High;a.MaxPrice;for(var n=a.MinPrice,s=1,o=45,l=3.1415926535,h=(t-r)/2+r,u=0,f=[],C=r+1,D=1;C<=h;++C,++D){var c=Math.tan(o*l/180)*D;u+=c,f.push({Index:C-n,Value:c})}for(var C=t-1,D=1;C>h;--C,++D){var c=Math.tan(o*l/180)*D;u+=c,f.push({Index:C-n,Value:c})}if(u>0){for(var C=0;C<f.length;++C){var T=f[C];e[T.Index]+=T.Value*a.Vol/u,s<e[T.Index]&&(s=e[T.Index])}a.MaxVol=s}},this.CalculateDistribute=function(e,a){this.CalculateType==1?this.TriangleDistribute(e,a):this.EvenlyDistribute(e,a)},this.SendCalculateChipEvent=function(){var e=this.HQChart.GetEventCallback($.ON_CALCULATE_CHIP_DATA);if(!e)return null;var a=this.HQChart.ChartPaint[0].Data,r=a.DataOffset+parseInt(this.HQChart.CursorIndex),t={Symbol:this.HQChart.Symbol,Period:this.HQChart.Period,KData:a,CurrentIndex:r,Y:this.HQChart.LastPoint.Y,HQChart:this.HQChart,ShowType:this.ShowType,CalculateType:this.CalculateType,PreventDefault:!1,Result:null};return e.Callback(e,t,this),t},this.CalculateChip=function(){if(!this.HQChart||!this.HQChart.FlowCapitalReady)return!1;var e=this.HQChart.Symbol;if(!e)return!1;var a=this.SendCalculateChipEvent();if(a&&a.PreventDefault)return a.Result;if(U.IsSHSZIndex(e))return!1;var r=this.HQChart.ChartPaint[0].Data,t=r.DataOffset+parseInt(this.HQChart.CursorIndex);t>=r.Data.length&&(t=r.Data.length-1);var n=r.Data[t],s=n.Close,o=this.HQChart.LastPoint.Y;o&&(s=this.HQChart.Frame.SubFrame[0].Frame.GetYData(o));for(var l=1,h=[],u=1,f,C,D,c=t;c>=0;--c){var T=r.Data[c],S=1;T.FlowCapital>0&&(S=T.Vol/T.FlowCapital),c==t?f=T.Vol*S:f=T.Vol*u;var I={Vol:f,High:T.High,Low:T.Low};h.push(I),u*=1-S*l,(!C||C<T.High)&&(C=T.High),(!D||D>T.Low)&&(D=T.Low)}if(!C||!D)return!0;var g=this.PriceZoom;C=parseInt(C*g),D=parseInt(D*g);for(var E=C-D,F=new Array,R=0;R<=E;++R)F.push(0);var A=[],P;if(this.ShowType==2){var A=[{Day:100,Color:this.DAY_COLOR[1][5]},{Day:60,Color:this.DAY_COLOR[1][4]},{Day:30,Color:this.DAY_COLOR[1][3]},{Day:20,Color:this.DAY_COLOR[1][2]},{Day:10,Color:this.DAY_COLOR[1][1]},{Day:5,Color:this.DAY_COLOR[1][0]}];for(var p in h){var T=h[p],w=parseInt(T.High*g),H=parseInt(T.Low*g),W=T.Vol;if(w-H>0&&(W=T.Vol/(w-H)),!(W<=1e-9)){for(var ht=0;ht<A.length;++ht)if(p==A[ht].Day){A[ht].Chip=F.slice(0);break}P={Low:H,High:w,Vol:T.Vol,MaxPrice:C,MinPrice:D},this.CalculateDistribute(F,P)}}}else if(this.ShowType==1)for(var A=[{Day:5,Color:this.DAY_COLOR[0][0]},{Day:10,Color:this.DAY_COLOR[0][1]},{Day:20,Color:this.DAY_COLOR[0][2]},{Day:30,Color:this.DAY_COLOR[0][3]},{Day:60,Color:this.DAY_COLOR[0][4]},{Day:100,Color:this.DAY_COLOR[0][5]}],rt=h.length-1;rt>=0;--rt){var T=h[rt],w=parseInt(T.High*g),H=parseInt(T.Low*g),W=T.Vol;if(w-H>0&&(W=T.Vol/(w-H)),!(W<=1e-9)){for(var ht=0;ht<A.length;++ht)if(rt==A[ht].Day){A[ht].Chip=F.slice(0);break}P={Low:H,High:w,Vol:T.Vol,MaxPrice:C,MinPrice:D},this.CalculateDistribute(F,P)}}else for(var nt in h){var T=h[nt],w=parseInt(T.High*g),H=parseInt(T.Low*g),W=T.Vol;w-H>0&&(W=T.Vol/(w-H)),!(W<=1e-9)&&(P={Low:H,High:w,Vol:T.Vol,MaxPrice:C,MinPrice:D},this.CalculateDistribute(F,P))}return P?(this.Data={AllChip:F,MaxVol:P.MaxVol,MaxPrice:C,MinPrice:D,SelectData:n,DayChip:A,YPrice:s},!0):!1},this.DrawFrame=function(){if(this.IsShowX!=!1&&!(this.Data.MaxVol<=0)){var e=this.HQChart.Frame.SubFrame.length!==1,a=this.HQChart.Frame.SubFrame[0].Frame,r=a.ChartBorder,t=L(r.GetBottomEx()+1);e||(t=this.ClientRect.Top+this.ClientRect.Height);var n=this.ClientRect.Left,s=n+this.ClientRect.Width;this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),e&&(this.Canvas.moveTo(n,t),this.Canvas.lineTo(s,t));var o=this.ShowXCount,l=this.Data.MaxVol,h=Math.floor(l/o);this.Canvas.font=this.Font,this.Canvas.textBaseline="top",this.Canvas.fillStyle=this.InfoColor;for(var u=1;u<=o;++u){var f=h*u,C=f/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;if(C=L(C),u==o){this.Canvas.textAlign="right";var D=v.FormatValueString(l,1);this.Canvas.fillText(D,C,t+2)}else{this.Canvas.moveTo(C,this.ClientRect.Top),this.Canvas.lineTo(C,t),this.Canvas.textAlign="center";var D=v.FormatValueString(f,1),c=this.Canvas.measureText(D).width;this.Canvas.fillText(D,Math.floor(C-c*.25),t+2)}}this.Canvas.stroke()}}}function iD(){this.newMethod=aD,this.newMethod(),delete this.newMethod,this.Name="筹码分布手机版",this.ClassName="StockChipPhone",this.ShowType=0,this.DrawToolbar=function(e,a){},this.Draw=function(){if(this.IsHScreen=this.ChartFrame.IsHScreen==!0,this.PixelRatio=B(),this.IsHScreen){var e=this.ChartBorder.GetHScreenBorder(),a=L(e.Left),r=L(e.Right),t=L(e.Bottom+this.Left),n=L(e.ChartHeight-2*this.PixelRatio);this.ClientRect={Left:a,Top:t,Right:r,Bottom:n},this.ClientRect.Width=this.ClientRect.Right-this.ClientRect.Left,this.ClientRect.Height=this.ClientRect.Bottom-this.ClientRect.Top}else{var a=L(this.ChartBorder.GetRight()+this.Left),t=L(this.ChartBorder.GetTop()),r=L(a+this.Width-1*this.PixelRatio),n=L(this.ChartBorder.GetBottom());this.ClientRect={Left:a,Top:t,Right:r,Bottom:n},this.ClientRect.Width=this.ClientRect.Right-this.ClientRect.Left,this.ClientRect.Height=this.ClientRect.Bottom-this.ClientRect.Top}Y.IsTickPeriod(this.HQChart.Period)||this.CalculateChip()&&(this.DrawAllChip(),(this.ShowType==1||this.ShowType==2)&&this.DrawDayChip(),this.CalculateCast(),this.IsHScreen?this.DrawHScreenChipInfo():this.DrawChipInfo()),this.DrawBorder(),this.SizeChange=!1},this.DrawAllChip=function(){for(var e=this.HQChart.Frame.SubFrame[0].Frame,a=this.Data.SelectData.Close,r=[],t=[],n=0,s=0,o=0,l=0,h=this.Data.YPrice,u=e.HorizontalMax,f=e.HorizontalMin,C=1,D=0;D<this.Data.AllChip.length;++D){var c=this.Data.AllChip[D];if(c){var T=(D+this.Data.MinPrice)/this.PriceZoom;n+=c,s+=T*c,T<h&&(l+=c),T<a&&(o+=c),T<=u&&T>=f&&C<c&&(C=c)}}this.Data.MaxVol=C;for(var D=0;D<this.Data.AllChip.length;++D){var c=this.Data.AllChip[D];if(c){var T=(D+this.Data.MinPrice)/this.PriceZoom;if(!(T>u||T<f)){if(this.IsHScreen)var S=e.GetYFromData(T,!1),I=c/this.Data.MaxVol*this.ClientRect.Height+this.ClientRect.Top;else var S=e.GetYFromData(T,!1),I=c/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;T<a?r.push({X:I,Y:S}):t.push({X:I,Y:S})}}}if(this.Data.ChipInfo={Vol:n,AveragePrice:s/n,ProfitVol:o,ProfitRate:n>0?o/n*100:0,YProfitRate:n>0?l/n*100:0},this.ShowType==0){this.DrawLines(r,this.ColorProfit),this.DrawLines(t,this.ColorNoProfit);var g=this.Data.ChipInfo.AveragePrice;g>0&&g<=u&&g>=f&&(g=g.toFixed(2),this.DrawAveragePriceLine(r,t,e.GetYFromData(g),this.ColorAveragePrice))}else this.DrawLines(r,this.ColorBG),this.DrawLines(t,this.ColorBG)},this.DrawLines=function(e,a){if(v.IsNonEmptyArray(e)){this.Canvas.strokeStyle=a,this.Canvas.beginPath();for(var r=0;r<e.length;++r){var t=e[r];this.IsHScreen?(this.Canvas.moveTo(t.Y,this.ClientRect.Top),this.Canvas.lineTo(t.Y,t.X)):(this.Canvas.moveTo(this.ClientRect.Left,t.Y),this.Canvas.lineTo(t.X,t.Y))}this.Canvas.stroke()}},this.DrawAveragePriceLine=function(e,a,r,t){for(var n=0;n<e.length;++n){var s=e[n];if(s.Y==r){this.Canvas.strokeStyle=t,this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(s.Y,this.ClientRect.Top),this.Canvas.lineTo(s.Y,s.X)):(this.Canvas.moveTo(this.ClientRect.Left,s.Y),this.Canvas.lineTo(s.X,s.Y)),this.Canvas.stroke();return}}for(var n=0;n<a.length;++n){var s=a[n];if(s.Y==r){this.Canvas.strokeStyle=t,this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(s.Y,this.ClientRect.Top),this.Canvas.lineTo(s.Y,s.X)):(this.Canvas.moveTo(this.ClientRect.Left,s.Y),this.Canvas.lineTo(s.X,s.Y)),this.Canvas.stroke();return}}},this.GetChipInfoTitle=function(){var e=[];if(Y.IsDayPeriod(this.HQChart.Period,!0)){var a={Title:"日期:",Text:v.FormatDateString(this.Data.SelectData.Date)};e.push(a)}else if(Y.IsMinutePeriod(this.HQChart.Period,!0)){var a={Title:v.FormatDateString(this.Data.SelectData.Date)+" "+v.FormatTimeString(this.Data.SelectData.Time,"HH:MM")};e.push(a)}var a={Title:"集中度:",Text:"--.--%"};v.IsNonEmptyArray(this.Data.Cast)&&(a.Text=this.Data.Cast[0].Rate.toFixed(2)+"%"),e.push(a);var a={Title:"90%成本:",Text:"--.--"};v.IsNonEmptyArray(this.Data.Cast)&&(a.Text=this.Data.Cast[0].MinPrice.toFixed(2)+"-"+this.Data.Cast[0].MaxPrice.toFixed(2)),e.push(a);var a={Title:"平均成本：:",Text:"--.--"};if(this.Data.ChipInfo&&v.IsNumber(this.Data.ChipInfo.AveragePrice)&&(a.Text=""+this.Data.ChipInfo.AveragePrice.toFixed(2)),v.IsNumber(this.Data.YPrice)&&v.IsNumber(this.Data.ChipInfo.YProfitRate)){var a={Title:this.Data.YPrice.toFixed(2)+"获利:",Text:this.Data.ChipInfo.YProfitRate.toFixed(2)+"%"};e.push(a)}if(this.IsHScreen){var a={Title:"获利比例:",Text:this.Data.ChipInfo.ProfitRate.toFixed(2)+"%"};e.push(a)}else{var a={Title:"获利比例:",Type:1};e.push(a)}return e},this.DrawHScreenChipInfo=function(){var e=this.GetChipInfoTitle();if(v.IsNonEmptyArray(e)){this.Canvas.font=this.Font,this.Canvas.fillStyle=this.InfoColor,this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left";var a=this.ClientRect.Top+2*this.PixelRatio,r=this.ClientRect.Left+2*this.PixelRatio;this.ClientRect.Bottom;var t=this.LineHeight*B();this.Canvas.save(),this.Canvas.translate(r,a),this.Canvas.rotate(90*Math.PI/180);for(var n=0,s=0,o=0;o<e.length;++o){var l=e[o];n=0;var h=l.TitleColor;l.TitleColor&&(h=l.TitleColor),this.Canvas.fillStyle=h,this.Canvas.fillText(l.Title,n,s);var u=this.Canvas.measureText(l.Title).width+4*this.PixelRatio,n=u;if(l.Text){var h=l.TitleColor;l.TextColor&&(h=l.TextColor),this.Canvas.fillStyle=h,this.Canvas.fillText(l.Text,n,s)}s-=t}this.Canvas.restore()}},this.DrawChipInfo=function(){var e=this.GetChipInfoTitle();if(v.IsNonEmptyArray(e)){var a=this.ClientRect.Top+this.ClientRect.Height-1,r=this.ClientRect.Left+2,t=this.ClientRect.Left+this.ClientRect.Width;this.Canvas.font=this.Font,this.Canvas.fillStyle=this.InfoColor,this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left";for(var n=this.LineHeight*B(),s=a,o=0;o<e.length;++o){var l=e[o],h=l.TitleColor;l.TitleColor&&(h=l.TitleColor),this.Canvas.fillStyle=h,this.Canvas.fillText(l.Title,r,s);var u=this.Canvas.measureText(l.Title).width+4,f=r+u;if(l.Text){var h=l.TitleColor;l.TextColor&&(h=l.TextColor),this.Canvas.fillStyle=h,this.Canvas.fillText(l.Text,f,s)}if(l.Type==1){var C=r+u+2,D=t-5-C;this.Canvas.strokeStyle=this.ColorNoProfit,this.Canvas.strokeRect(C,s-n,D,n),this.Canvas.strokeStyle=this.ColorProfit,this.Canvas.strokeRect(C,s-n,D*(this.Data.ChipInfo.ProfitRate/100),n);var c=this.Data.ChipInfo.ProfitRate.toFixed(2)+"%";this.Canvas.textAlign="center",this.Canvas.fillText(c,C+D/2,s)}s-=n}}},this.DrawDayChip=function(){if(v.IsNonEmptyArray(this.Data.DayChip))for(var e=this.HQChart.Frame.SubFrame[0].Frame,a=0;a<this.Data.DayChip.length;++a){var r=[],t=this.Data.DayChip[a].Chip;if(t){for(var n=0,s=0;s<t.length;++s){var o=t[s];if(o){n+=o;var l=(s+this.Data.MinPrice)/100;if(this.IsHScreen)var h=e.GetYFromData(l),u=o/this.Data.MaxVol*this.ClientRect.Height+this.ClientRect.Top;else var h=e.GetYFromData(l),u=o/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;r.push({X:u,Y:h})}}this.Data.DayChip[a].Vol=n,this.DrawArea(r,this.Data.DayChip[a].Color)}}},this.DrawArea=function(e,a){if(v.IsNonEmptyArray(e)){if(this.Canvas.fillStyle=a,this.Canvas.beginPath(),this.IsHScreen){this.Canvas.moveTo(e[0].Y,this.ClientRect.Top);for(var r=0;r<e.length;++r){var t=e[r];this.Canvas.lineTo(t.Y,t.X)}this.Canvas.lineTo(e[e.length-1].Y,this.ClientRect.Top)}else{this.Canvas.moveTo(this.ClientRect.Left,e[0].Y);for(var r=0;r<e.length;++r){var t=e[r];this.Canvas.lineTo(t.X,t.Y)}this.Canvas.lineTo(this.ClientRect.Left,e[e.length-1].Y)}this.Canvas.fill()}}}function rD(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.ClassName="FrameSplitPaint",this.LineColor="rgb(255,0,0)",this.TextColor="rgb(255,0,0)",this.LineWidth=2,this.Font="bold "+18*B()+"px 微软雅黑",this.TextTopOffset=10*B(),this.SetOption=function(e){e&&(e.LineColor&&(this.LineColor=e.LineColor),e.TextColor&&(this.TextColor=e.TextColor),e.Font&&(this.Font=e.Font),v.IsNumber(e.LineWidth)&&(this.LineWidth=e.LineWidth),v.IsNumber(e.TextTopOffset)&&(this.TextTopOffset=e.TextTopOffset))},this.Draw=function(){if(this.HQChart&&!(this.HQChart.Period!=0&&this.HQChart.Period!=1)&&this.HQChart.ChartPaint[0]){var e=this.HQChart.ChartPaint[0].Data;if(e&&(this.Data=e,!(!this.ChartFrame||!this.ChartFrame.SubFrame))){var a=this.ChartFrame.SubFrame[0].Frame;if(a){var r=a.IsHScreen===!0,t=a.DataWidth,n=a.DistanceWidth,s=a.XPointCount,o=this.LineWidth*B();if(r)var l=this.ChartBorder.GetHScreenBorder(),h=l.TopEx+n/2+d.FrameLeftMargin,u=l.BottomEx;else var l=this.ChartBorder.GetBorder(),h=l.LeftEx+n/2+d.FrameLeftMargin,u=l.RightEx,f=l.ChartHeight-l.TopTitle-5*B();this.Canvas.save(),this.Canvas.lineWidth=o,this.Canvas.font=this.Font,this.Canvas.textAlign="center",this.Canvas.textBaseline="top";for(var C={Left:l.LeftEx,Top:$t(o,l.TopTitle),Height:f,LineWidth:o},D=this.Data.DataOffset,c=0;D<this.Data.Data.length&&c<s;++D,++c,h+=t+n){var T=this.Data.Data[D];if(T){var S=this.GetQuarter(T.Date);if(S){var I=h,g=h+t;if(g>u)break;var E=I+(g-I)/2;if(!C.DateInfo)C.DateInfo=S,C.Right=E;else{var F=C.DateInfo;F.Year!=S.Year||F.Quarter!=S.Quarter?(C.Right=E,this.DrawQuarter(C),C.Left=E,C.Right=null,C.DateInfo=S):C.Right=E}}}}this.DrawQuarter(C),this.Canvas.restore()}}}},this.DrawQuarter=function(e){if(!(!v.IsNumber(e.Left)||!v.IsNumber(e.Right))){var a=$t(e.LineWidth,e.Left),r=$t(e.LineWidth,e.Right),t=r-a;this.Canvas.strokeStyle=this.LineColor,this.Canvas.strokeRect(a,e.Top,t,e.Height);var n=e.DateInfo,s=n.Year%100;if(s<10)var o="0"+s;else var o=s.toString();var l=o+"年"+n.Quarter+"季度",h=this.Canvas.measureText(l).width;if(h<t+5){var u=a+t/2,f=e.Top+this.TextTopOffset;this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(l,u,f)}}},this.GetQuarter=function(e){if(!v.IsNumber(e))return null;var a=parseInt(e/1e4),r=parseInt(e%1e4/100);switch(r){case 1:case 2:case 3:var t=1;break;case 4:case 5:case 6:var t=2;break;case 7:case 8:case 9:var t=3;break;case 10:case 11:case 12:var t=4;break;default:return null}return{Year:a,Month:r,Quarter:t}}}function eI(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.ClassName="RectSelectPaint",this.LineColor=d.RectSelect.LineColor,this.LineWidth=d.RectSelect.LineWidth,this.LineDotted=d.RectSelect.LineDotted,this.AreaColor=d.RectSelect.AreaColor,this.SubAreaColor=d.RectSelect.SubAreaColor,this.MarkConfig={Family:d.RectSelect.Mark.Family,Text:d.RectSelect.Mark.Text,Color:d.RectSelect.Mark.Color,Size:d.RectSelect.Mark.Size,IsShow:!1,Position:{Index:d.RectSelect.Mark.Position.Index,Top:d.RectSelect.Mark.Position.Top}},this.FirstPoint,this.SecondPoint,this.CenterPoint,this.PreventClose=!1,this.SpaceReselected=!1,this.SubClient={FirstPoint:null,SecondPoint:null,Start:null,End:null},this.StartDate,this.EndDate,this.CenterDate,this.HQChart,this.DragRect,this.ShowRangeText={Enable:!1,Position:0,Font:d.RectSelect.RangeTextFont,Color:d.RectSelect.RangeTextColor,BGColor:d.RectSelect.RangeTextBGColor,SubPosition:0,SubFont:d.RectSelect.RangeTextSubFont,SubColor:d.RectSelect.RangeTextSubColor,SubBGColor:d.RectSelect.RangeTextSubBGColor},this.BorderCache,this.IsOnlyOnePoint=!1,this.IsFullFrame=!1,this.SetOption=function(e){if(e){if(e.LineColor&&(this.LineColor=e.LineColor),e.AreaColor&&(this.AreaColor=e.AreaColor),v.IsBool(e.SpaceReselected)&&(this.SpaceReselected=e.SpaceReselected),e.ShowRangeText){var a=e.ShowRangeText;v.IsBool(a.Enable)&&(this.ShowRangeText.Enable=a.Enable),v.IsNumber(a.Position)&&(this.ShowRangeText.Position=a.Position),v.IsNumber(a.SubPosition)&&(this.ShowRangeText.SubPosition=a.SubPosition)}if(e.Mark){var a=e.Mark;v.IsBool(a.IsShow)&&(this.MarkConfig.IsShow=a.IsShow),a.Position&&(v.IsNumber(a.Position.Index)&&(this.MarkConfig.Position.Index=a.Position.Index),a.Position.Top&&(this.MarkConfig.Position.Top=a.Position.Top))}}},this.ReloadResource=function(e){this.LineColor=d.RectSelect.LineColor,this.LineWidth=d.RectSelect.LineWidth,this.LineDotted=d.RectSelect.LineDotted,this.AreaColor=d.RectSelect.AreaColor,this.ShowRangeText.Font=d.RectSelect.RangeTextFont,this.ShowRangeText.Color=d.RectSelect.RangeTextColor,this.ShowRangeText.BGColor=d.RectSelect.RangeTextBGColor},this.IsMinuteChart=function(){var e=this.HQChart.ClassName,a=e=="MinuteChartContainer"||e=="MinuteChartHScreenContainer";return a},this.GetKData=function(){if(!this.HQChart)return null;var e=this.IsMinuteChart(),a=null;if(e){if(!this.HQChart.SourceData)return null;a=this.HQChart.SourceData}else if(!this.HQChart.ChartPaint[0]||(a=this.HQChart.ChartPaint[0].Data,!a))return null;return a},this.GetPointCount=function(){var e=0;return this.FirstPoint&&++e,this.SecondPoint&&++e,e},this.DateToNumber=function(e,a){if(a)return v.IsNumber(e.Date)?e.Date*1e4+e.Time:e.Time;var r=this.HQChart.Period;return Y.IsDayPeriod(r,!0)?e.Date:Y.IsMinutePeriod(r,!0)?e.Date*1e4+e.Time:Y.IsSecondPeriod(r)||Y.IsTickPeriod(r)?e.Date*1e6+e.Time:Y.IsMilliSecondPeriod(r)?e.Date*1e9+e.Time:null},this.GetSelectRectDataByOnePoint=function(){if(!this.FirstPoint)return null;var e=this.GetKData();if(!e)return null;for(var a=this.IsMinuteChart(),r=this.DateToNumber(this.FirstPoint,a),t={Start:null,End:null,Data:e},n=0;n<e.Data.length;++n){var s=e.Data[n];if(s){var o=this.DateToNumber(s,a);if(r==o)return t.Start=n,t.End=n,t}}return null},this.GetSelectRectData=function(){if(this.IsOnlyOnePoint)return this.GetSelectRectDataByOnePoint();if(!this.FirstPoint||!this.SecondPoint)return null;var e=this.GetKData();if(!e)return null;for(var a=this.IsMinuteChart(),r=this.DateToNumber(this.FirstPoint,a),t=this.DateToNumber(this.SecondPoint,a),n={Start:null,End:null,Data:e},s=0;s<e.Data.length;++s){var o=e.Data[s];if(o){var l=this.DateToNumber(o,a);if(r==l&&(n.Start=s),t==l&&(n.End=s),v.IsNumber(n.Start)&&v.IsNumber(n.End)){if(n.Start>n.End){var h=n.Start;n.Start=n.End,n.End=h}return n}}}return null},this.SortPoint=function(){var e=this.IsMinuteChart();if(this.CenterData=null,this.FirstPoint&&!this.SecondPoint)this.StartDate={Date:this.DateToNumber(this.FirstPoint,e),Index:0};else if(this.FirstPoint&&this.SecondPoint){var a=this.DateToNumber(this.FirstPoint,e),r=this.DateToNumber(this.SecondPoint,e);if(a<r?(this.StartDate={Date:a,Index:0},this.EndDate={Date:r,Index:1}):(this.StartDate={Date:r,Index:1},this.EndDate={Date:a,Index:0}),this.CenterPoint){var t=this.DateToNumber(this.CenterPoint,e);this.CenterDate={Date:t,Index:2}}if(this.SubClient.FirstPoint&&this.SubClient.SecondPoint){var a=this.DateToNumber(this.SubClient.FirstPoint,e),r=this.DateToNumber(this.SubClient.SecondPoint,e);a<r?(this.SubClient.Start={Date:a,Index:3},this.SubClient.End={Date:r,Index:4}):(this.SubClient.Start={Date:r,Index:4},this.SubClient.End={Date:a,Index:3}),this.SubClient.End.Date<=this.StartDate.Date||this.SubClient.Start.Date>=this.EndDate.Date?(this.SubClient.Start=null,this.SubClient.End=null):(this.SubClient.Start.Date<this.StartDate.Date&&(this.SubClient.Start.Date=this.StartDate.Date),this.SubClient.End.Date>this.EndDate.Date&&(this.SubClient.End.Date=this.EndDate.Date))}}},this.GetCenterPoint=function(){if(!this.FirstPoint||!this.SecondPoint||!v.IsNumber(this.FirstPoint.DataIndex)||!v.IsNumber(this.SecondPoint.DataIndex))return null;var e=this.FirstPoint.DataIndex-this.SecondPoint.DataIndex;if(Math.abs(e)<3)return null;var a=parseInt(this.FirstPoint.DataIndex+(this.SecondPoint.DataIndex-this.FirstPoint.DataIndex)/2);if(a<0)return null;var r=this.GetKData();if(!r||!r.Data)return null;var t=r.Data[a];return t?{Date:t.Date,Time:t.Time,DataIndex:a}:null},this.MovePoint=function(e){if(!this.FirstPoint||!this.SecondPoint)return!1;var a=this.GetKData();if(!a||!a.Data)return!1;var n=this.FirstPoint.DataIndex+e,s=a.Data[n];if(!s)return!1;var r={Date:s.Date,Time:s.Time,DataIndex:n},n=this.SecondPoint.DataIndex+e,s=a.Data[n];if(!s)return!1;var t={Date:s.Date,Time:s.Time,DataIndex:n},n=this.CenterPoint.DataIndex+e,s=a.Data[n];if(!s)return!1;var o={Date:s.Date,Time:s.Time,DataIndex:n};return this.FirstPoint=r,this.SecondPoint=t,this.CenterPoint=o,!0},this.MoveSubRect=function(e,a){if(!this.FirstPoint||!this.SecondPoint||!this.SubClient||!this.SubClient.FirstPoint||!this.SubClient.SecondPoint)return!1;var r=this.GetKData();if(!r||!r.Data)return!1;var t=Math.min(this.FirstPoint.DataIndex,this.SecondPoint.DataIndex),n=Math.max(this.FirstPoint.DataIndex,this.SecondPoint.DataIndex),s=this.SubClient.FirstPoint,o=this.SubClient.SecondPoint;if(this.SubClient.FirstPoint.DataIndex>this.SubClient.SecondPoint.DataIndex)var s=this.SubClient.SecondPoint,o=this.SubClient.FirstPoint;var l=s.DataIndex,h=o.DataIndex;if(a){if(l<=t)return!1;l-=e,h-=e}else{if(o.DataIndex>=n)return!1;l+=e,h+=e}var u=!1;if(l!=s.DataIndex){s.DataIndex=l;var f=r.Data[l];s.Date=f.Date,s.Time=f.Time,u=!0}if(h!=s.DataIndex){o.DataIndex=h;var f=r.Data[h];o.Date=f.Date,o.Time=f.Time,u=!0}return u},this.SetPoint=function(e,a){var r=null;if(a&&v.IsNumber(a.DataIndex)&&(r=a.DataIndex),a&&v.IsNumber(a.Index))switch(a.Index){case 0:return this.FirstPoint={Date:e.Date,Time:e.Time,DataIndex:r},this.CenterPoint=this.GetCenterPoint(),!0;case 1:return this.SecondPoint={Date:e.Date,Time:e.Time,DataIndex:r},this.CenterPoint=this.GetCenterPoint(),!0;case 2:var t=r-this.CenterPoint.DataIndex;return Math.abs(t)>0?this.MovePoint(t):!1;case 3:return this.SubClient.FirstPoint={Date:e.Date,Time:e.Time,DataIndex:r},!0;case 4:return this.SubClient.SecondPoint={Date:e.Date,Time:e.Time,DataIndex:r},!0;default:return!1}else return this.IsOnlyOnePoint?(this.FirstPoint={Date:e.Date,Time:e.Time,DataIndex:r},!0):this.FirstPoint?this.SecondPoint?!1:(this.SecondPoint={Date:e.Date,Time:e.Time,DataIndex:r},this.CenterPoint=this.GetCenterPoint(),!0):(this.FirstPoint={Date:e.Date,Time:e.Time,DataIndex:r},!0)},this.ClearPoint=function(){if(this.PreventClose)return!1;var e=!1;return this.FirstPoint&&(this.FirstPoint=null,e=!0),this.SecondPoint&&(this.SecondPoint=null,e=!0),this.SubClient.FirstPoint=null,this.SubClient.SecondPoint=null,e},this.Draw=function(){if(this.BorderCache=null,this.StartDate=null,this.EndDate=null,this.CenterDate=null,this.DragRect=[],this.SubClient.Start=null,this.SubClient.End=null,!(!this.FirstPoint&&!this.SecondPoint)){this.SortPoint();var e=this.GetKData();if(e&&(this.Data=e,!(!this.ChartFrame||!this.ChartFrame.SubFrame))){var a=this.ChartFrame.SubFrame[0].Frame;if(a){var r=a.IsHScreen===!0,t=a.DataWidth,n=a.DistanceWidth,s=a.XPointCount;if(r){var o=a.GetBorder(),l=o.TopEx+n/2+d.FrameLeftMargin;o.BottomEx,this.BorderCache=o}else{var o=a.GetBorder();this.IsFullFrame&&(o=this.ChartFrame.ChartBorder.GetBorder());var l=o.LeftEx+n/2+d.FrameLeftMargin;o.RightEx,o.ChartHeight-o.TopTitle-5*B();var h=o.TopEx,u=o.BottomEx;this.BorderCache=o}this.Canvas.save(),Y.IsDayPeriod(this.HQChart.Period,!0);for(var f=this.IsMinuteChart(),C=null,D=null,c=null,T=null,S=[],I=this.Data.DataOffset,g=0;I<this.Data.Data.length&&g<s;++I,++g,l+=t+n){var E=this.Data.Data[I];if(E){var F=l,R=l+t;if(f)var A=a.GetXFromIndex(g);else var A=F+(R-F)/2;var P=this.DateToNumber(E,f);if(this.StartDate&&P==this.StartDate.Date&&(C={XIndex:I,X:A,Top:h,Bottom:u,PointIndex:this.StartDate.Index,Type:0,Item:E},S.push(C)),this.EndDate&&P==this.EndDate.Date&&(D={XIndex:I,X:A,Top:h,Bottom:u,PointIndex:this.EndDate.Index,Type:1,Item:E},S.push(D)),this.CenterDate&&P==this.CenterDate.Date){var p={XIndex:I,X:A,Top:h,Bottom:u,PointIndex:this.CenterDate.Index,Type:2,Item:E};S.push(p)}if(this.SubClient&&this.SubClient.Start&&this.SubClient.End&&(P==this.SubClient.Start.Date&&(this.SubClient.Start.Point={Date:P,X:A,Top:h,Bottom:u,KItem:E}),P==this.SubClient.End.Date&&(this.SubClient.End.Point={Date:P,X:A,Top:h,Bottom:u,kItem:E})),c?(T.Date=P,T.X=A):(c={Date:P,X:A,Top:h,Bottom:u},T={Date:P,X:A,Top:h,Bottom:u}),C&&D)break}}if(this.DrawLines(S),this.DrawArea(C,D,c,T,this.AreaColor),this.DrawMark(C,D),this.SubClient&&this.SubClient.Start&&this.SubClient.End&&(this.DrawArea(this.SubClient.Start.Point,this.SubClient.End.Point,c,T,this.SubAreaColor,4),this.SubClient.Start.Point)){var E=this.SubClient.Start.Point,w={X:E.X,Top:E.Top,Bottom:E.Bottom,PointIndex:E.DataIndex,Type:3,Item:E.KItem};S.push(w)}this.DrawRangeText(S),this.Canvas.restore()}}}},this.DrawRangeText=function(e){if(this.ShowRangeText&&this.ShowRangeText.Enable!=!1)for(var a=this.BorderCache,r=this.IsMinuteChart(),t=this.HQChart.Period,n,s,o,l=0;l<e.length;++l){var h=e[l];if(h.Type===0||h.Type==1||h.Type==3){if(r){var u=v.FormatDateString(h.Item.Date,"YYYY-MM-DD"),f=v.FormatTimeString(h.Item.Time,"HH:MM");o=u+" "+f}else{var u=v.FormatDateString(h.Item.Date,"YYYY-MM-DD"),f=null;Y.IsMinutePeriod(t,!0)?f=v.FormatTimeString(h.Item.Time,"HH:MM"):(Y.IsSecondPeriod(t)||Y.IsTickPeriod(t))&&(f=v.FormatTimeString(h.Item.Time,"HH:MM:SS")),f?o=u+" "+f:o=u}if(h.Type==3){var C=this.ShowRangeText.SubPosition,D=this.ShowRangeText.SubBGColor,c=this.ShowRangeText.SubColor;this.Canvas.font=this.ShowRangeText.SubFont;var T=this.GetFontHeight()}else{var C=this.ShowRangeText.Position,D=this.ShowRangeText.BGColor,c=this.ShowRangeText.Color;this.Canvas.font=this.ShowRangeText.Font;var T=this.GetFontHeight()}var S=this.Canvas.measureText(o).width+4,I={Height:T,Width:S};h.Type==0||h.Type==3?S>h.X?(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",n=h.X+2,I.X=h.X):(this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",n=h.X-2,I.X=h.X-S):h.Type==1&&(S>a.Right-h.X?(this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",n=h.X-2,I.X=h.X-S):(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",n=h.X+2,I.X=h.X)),C==1?(s=h.Top+(h.Bottom-h.Top)/2,h.Type==3&&(s+=T),I.Y=s-T/2):C==2?(s=h.Bottom,I.Y=s-T/2):(s=h.Top,I.Y=s-T/2),D&&(this.Canvas.fillStyle=D,this.Canvas.fillRect(L(I.X),L(I.Y),b(I.Width),b(I.Height))),c&&(this.Canvas.fillStyle=c,this.Canvas.fillText(o,n,s,S))}}},this.DrawLines=function(e){if(v.IsNonEmptyArray(e)){var a=this.LineWidth*B();this.Canvas.strokeStyle=this.LineColor,this.Canvas.lineWidth=a;for(var r=0;r<e.length;++r){var t=e[r],n=$t(a,t.X);t.Type==0||t.Type==1?(this.LineDotted&&this.Canvas.setLineDash(this.LineDotted),this.Canvas.beginPath(),this.Canvas.moveTo(n,t.Top),this.Canvas.lineTo(n,t.Bottom),this.Canvas.stroke(),this.LineDotted&&this.Canvas.setLineDash([])):(this.Canvas.beginPath(),this.Canvas.moveTo(n,t.Top),this.Canvas.lineTo(n,t.Bottom),this.Canvas.stroke());var s=new Ia(n-3,t.Top,10,t.Bottom-t.Top);this.DragRect[r]={Rect:s,PointIndex:t.PointIndex,Type:t.Type}}}},this.PtInPaint=function(e,a){if(!v.IsNonEmptyArray(this.DragRect))return null;for(var r=0;r<this.DragRect.length;++r){var t=this.DragRect[r],n=t.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(n.X,n.Y,n.Width,n.Height),this.Canvas.isPointInPath(e,a))return(0,ae.default)({Index:r,PointIndex:t.PointIndex,Type:t.Type,Self:this},"Type",t.Type)}return null},this.DrawArea=function(e,a,r,t,n,s){if(!(!r||!t||!this.StartDate||!this.EndDate)){var o;if(e&&a?o=[e,a]:!e&&a?o=[r,a]:e&&!a?o=[e,t]:r.Date>this.StartDate.Date&&t.Date<this.EndDate.Date&&(o=[r,t]),o&&o.length==2){var l=o[0],h=o[1],u=L(l.X),f=L(h.X),C=f-u,D=l.Bottom-l.Top;this.Canvas.fillStyle=n,this.Canvas.fillRect(u,l.Top,C,D);var c={X:u,Y:l.Top,Right:f,Bottom:l.Top+D,Width:C,Height:D};v.IsNumber(s)&&this.DragRect.push({Rect:c,Type:s})}}},this.DrawMark=function(e,a){if(!(!e||!a)&&!(!this.ChartFrame||!this.ChartFrame.SubFrame)){var r=this.ChartFrame.SubFrame[0].Frame;if(r&&this.MarkConfig){var t=this.MarkConfig;if(t.IsShow){var n=t.Size+"px "+t.Family;this.Canvas.font=n;var s=null;switch(t.Position.Top){case"TopEx":s=r.ChartBorder.GetTopEx();break;case"Top":s=r.ChartBorder.GetTop();break;case"TopTitle":s=r.ChartBorder.GetTopTitle();break;default:return}var o=e.X,l=s;this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.Canvas.fillStyle=t.Color,this.Canvas.fillText(t.Text,o,l)}}}}}function aI(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.ClassName="RectDragPaint",this.LineColor=d.RectDrag.LineColor,this.LineWidth=d.RectDrag.LineWidth,this.BGColor=d.RectDrag.BGColor,this.ShowMode=0,this.Enable=!1,this.FirstPoint,this.SecondPoint,this.IsClearCanvas=!0,this.SetOption=function(e){e&&(e.LineColor&&(this.LineColor=e.LineColor),e.BGColor&&(this.BGColor=e.BGColor),v.IsNumber(e.ShowMode)&&(this.ShowMode=e.ShowMode))},this.ReloadResource=function(e){this.LineColor=d.RectDrag.LineColor,this.LineWidth=d.RectDrag.LineWidth,this.BGColor=d.RectDrag.BGColor},this.ClearPoint=function(){this.FirstPoint=null,this.SecondPoint=null,this.IsClearCanvas||this.Draw()},this.SetFirstPoint=function(e,a){this.FirstPoint={X:e,Y:a}},this.SetSecondPoint=function(e,a){this.SecondPoint={X:e,Y:a}},this.DrawSelectedBorderMode=function(e){this.Canvas.strokeStyle=this.LineColor,this.Canvas.strokeRect(L(e.Left),L(e.Top),b(e.Width),b(e.Height))},this.DrawUnselectedMaskMode=function(e,a){if(this.BGColor){this.Canvas.save();var r=new Path2D;r.rect(a.Left,a.Top,a.Width,e.Top-a.Top);var t=new Path2D;t.rect(a.Left,e.Top,e.Left-a.Left,e.Height),r.addPath(t);var n=new Path2D;n.rect(e.Right,e.Top,a.Right-e.Right,e.Height),r.addPath(n);var s=new Path2D;s.rect(a.Left,e.Bottom,a.Width,a.Bottom-e.Bottom),r.addPath(s),this.Canvas.clip(r),this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(a.Left,a.Top,a.Width,a.Height),this.Canvas.restore()}this.Canvas.strokeStyle=this.LineColor,this.Canvas.strokeRect(L(e.Left),L(e.Top),b(e.Width),b(e.Height))},this.DrawFullselectedMode=function(e,a){if(this.BGColor){this.Canvas.save();var r=new Path2D;r.rect(a.Left,a.Top,e.Left-a.Left,a.Height);var t=new Path2D;t.rect(e.Right,a.Top,a.Right-e.Right,a.Height),r.addPath(t),this.Canvas.clip(r),this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(a.Left,a.Top,a.Width,a.Height),this.Canvas.restore()}this.Canvas.strokeStyle=this.LineColor,this.Canvas.strokeRect(L(e.Left),L(a.Top),b(e.Width),b(a.Height))},this.Draw=function(){if(this.Enable&&this.HQChart){var e=this.HQChart.GetExtraCanvas(Ht.RectDragCanvasKey);if(e&&(this.Canvas=e.Canvas,this.HQChart.ClearCanvas(this.Canvas),this.IsClearCanvas=!0,!(!this.FirstPoint&&!this.SecondPoint))){var a=this.ChartBorder.GetTop(),r=this.ChartBorder.GetBottom(),t=this.ChartBorder.GetLeft(),n=this.ChartBorder.GetRight(),s={Left:t,Top:a,Right:n,Bottom:r};s.Width=s.Right-s.Left,s.Height=s.Bottom-s.Top;var o={Left:Math.min(this.FirstPoint.X,this.SecondPoint.X),Right:Math.max(this.FirstPoint.X,this.SecondPoint.X),Top:Math.min(this.FirstPoint.Y,this.SecondPoint.Y),Bottom:Math.max(this.FirstPoint.Y,this.SecondPoint.Y)};switch(o.Top<a?o.Top=a:o.Top>r&&(o.Top=r),o.Bottom<a?o.Bottom=a:o.Bottom>r&&(o.Bottom=r),o.Left<t?o.Left=t:o.Left>n&&(o.Left=n),o.Right<t?o.Right=t:o.Right>n&&(o.Right=n),o.Width=o.Right-o.Left,o.Height=o.Bottom-o.Top,this.ShowMode){case 1:this.DrawUnselectedMaskMode(o,s);break;case 2:this.DrawFullselectedMode(o,s);break;default:this.DrawSelectedBorderMode(o);break}this.IsClearCanvas=!1}}}}function iI(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.ClassName="DepthMapPaint",this.LineColor=d.DepthMapPaint.LineColor,this.AreaColor=At(d.DepthMapPaint.AreaColor),this.TextColor=d.DepthMapPaint.TextColor,this.TextBGColor=d.DepthMapPaint.TextBGColor,this.FrameID=0,this.ID=Re(),this.IsDynamic=!1,this.IsCallbackDraw=!0,this.YRange,this.WidthRate=.8,this.IsShow=!0,this.SetOption=function(e){e.FrameID>0&&(this.FrameID=e.FrameID),v.IsObjectExist(e.ID)&&(this.ID=e.ID),e.IsShowCorssCursor&&(this.IsShowCorssCursor=e.IsShowCorssCursor),v.IsNumber(e.WidthRate)&&(this.WidthRate=e.WidthRate)},this.Draw=function(){if(this.Data&&v.IsNonEmptyArray(this.Data)&&!(!this.ChartFrame||!this.ChartFrame.SubFrame||this.ChartFrame.SubFrame.length<=this.FrameID)){var e=this.ChartFrame.IsHScreen===!0,a=this.ChartFrame.SubFrame[this.FrameID].Frame,r=a.ChartBorder,t=r.GetHeightEx(),n=r.GetRight(),s=r.GetTopEx(),o=r.GetBottomEx(),l=this.ChartBorder.Right*this.WidthRate;if(e){n=r.GetBottom(),s=r.GetRight(),o=r.GetLeft();var l=this.Width;l>this.ChartBorder.Bottom&&(l=this.ChartBorder.Bottom)}var h={Left:n,Top:s,Right:n+l,Bottom:o,Height:t,Width:l};this.YRange={Max:null,Min:0};for(var u=0;u<this.Data.length;++u){var f=this.Data[u];this.CalculateYRange(f,this.YRange)}for(var u=0;u<this.Data.length;++u){var f=this.Data[u];f.Height>0&&f.Height<=1?h.Height=t*f.Height:h.Height=t,f.Type==1?(h.Top=s,h.Bottom=s+h.Height,this.DrawUpArea(f,h)):f.Type==2?(h.Bottom=o,h.Top=h.Bottom-h.Height,this.DrawDownArea(f,h)):(h.Top=s,h.Bottom=o,this.DrawDefaultArea(f,h))}}},this.CalculateYRange=function(e,a){for(var r in e.Data){var t=e.Data[r];(a.Max==null||a.Max<t.Y)&&(a.Max=t.Y),(a.Min==null||a.Min>t.Y)&&(a.Min=t.Y)}},this.GetXFromData=function(e,a,r){var t=a.Width*(e-r.Min)/(r.Max-r.Min);return a.Left+t},this.GetYFromData=function(e,a,r,t){if(t){var n=a.Height*(e-r.Min)/(r.Max-r.Min);return a.Bottom-n}else{var n=a.Height*(e-r.Min)/(r.Max-r.Min);return a.Top+n}},this.DrawDefaultArea=function(e,a){for(var r=this.ChartFrame.SubFrame[this.FrameID].Frame,t=e.Range&&e.Range.Y?e.Range.Y:this.YRange,n=[],s=0;s<e.Data.length;++s){var o=e.Data[s],l=this.GetXFromData(o.Y,a,t);if(!(o.X>r.HorizontalMax||o.X<r.HorizontalMin)){var h=r.GetYFromData(o.X);n.push({X:l,Y:h})}}var u=e.LineColor?e.LineColor:this.LineColor,f=e.AreaColor?e.AreaColor:this.AreaColor;n.length>0&&(e.DrawType==1?this.DrawHLine(n,u,a):this.DrawLine(n,u,f,a))},this.DrawUpArea=function(e,a){var r=[];for(var t in e.Data){var n=e.Data[t],s=this.GetXFromData(n.Y,a,e.Range.Y),o=this.GetYFromData(n.X,a,e.Range.X,e.IsASC);r.push({X:s,Y:o})}var l=e.LineColor?e.LineColor:this.LineColor,h=e.AreaColor?e.AreaColor:this.AreaColor;r.length>0&&this.DrawLine(r,l,h,a)},this.DrawDownArea=function(e,a){var r=[];for(var t in e.Data){var n=e.Data[t],s=this.GetXFromData(n.Y,a,e.Range.Y),o=this.GetYFromData(n.X,a,e.Range.X,e.IsASC);r.push({X:s,Y:o})}var l=e.LineColor?e.LineColor:this.LineColor,h=e.AreaColor?e.AreaColor:this.AreaColor;r.length>0&&this.DrawLine(r,l,h,a)},this.DrawHLine=function(e,a,r){var t=this.ChartFrame.IsHScreen===!0;this.Canvas.strokeStyle=a,this.Canvas.beginPath();for(var n=0,s=0;s<e.length;++s){var o=e[s];t||(this.Canvas.moveTo(r.Left,o.Y),this.Canvas.lineTo(o.X,o.Y)),++n}n>0&&this.Canvas.stroke()},this.DrawLine=function(e,a,r,t){var n=this.ChartFrame.IsHScreen===!0,s=!0,o=0;this.Canvas.strokeStyle=a;for(var l in e){var h=e[l];s?(this.Canvas.beginPath(),n?this.Canvas.moveTo(h.Y,h.X):this.Canvas.moveTo(h.X,h.Y),s=!1):n?this.Canvas.lineTo(h.Y,h.X):this.Canvas.lineTo(h.X,h.Y),++o}o>0&&this.Canvas.stroke();var u=e[0],f=e[e.length-1];if(n?(this.Canvas.lineTo(f.Y,t.Left),this.Canvas.lineTo(u.Y,t.Left)):(this.Canvas.lineTo(t.Left,f.Y),this.Canvas.lineTo(t.Left,u.Y)),this.Canvas.closePath(),Array.isArray(r))if(n){var C=this.Canvas.createLinearGradient(this.ChartBorder.GetRightEx(),this.ChartBorder.GetTop(),this.ChartBorder.GetLeft(),this.ChartBorder.GetTop());C.addColorStop(0,r[0]),C.addColorStop(1,r[1]),this.Canvas.fillStyle=C}else{for(var D=this.Canvas.createLinearGradient(t.Right,t.Top,t.Left,t.Top),c=1/r.length,l=0;l<r.length;++l)D.addColorStop(l*c,r[l]);this.Canvas.fillStyle=D}else this.Canvas.fillStyle=r;this.Canvas.fill()},this.GetYValueByXValue=function(e,a){for(var r=[],t=0,n=nD[a],s=0;s<this.Data.length;++s){var o=this.Data[s];if(!(o.Type!=0||!o.Data||o.Data.length<0||o.IsShowCorssCursor==!1)){for(var l=!1,h=0;h<o.Data.length;++h){var u=o.Data[h];if(t=parseInt(u.X*n),t==e){l=!0;var f={X:u.X,Y:u.Y,TextColor:o.TextColor?o.TextColor:this.TextColor,TextBGColor:o.TextBGColor?o.TextBGColor:this.TextBGColor};u.YText&&(f.YText=u.YText),r.push(f);break}}if(!l){var C=o.Data[0],D=o.Data[o.Data.length-1];e>C.X*n&&e<D.X*n&&r.push({X:null,Y:null,TextColor:o.TextColor?o.TextColor:this.TextColor,TextBGColor:o.TextBGColor?o.TextBGColor:this.TextBGColor})}}}return r}}function rI(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.ClassName="KLineYAxisBGPaint",this.SplitData=[],this.Font=d.KLineYAxisBGPaint.Font,this.FrameID=0,this.ID=Re(),this.IsDynamic=!1,this.IsCallbackDraw=!0,this.IsShow=!0,this.BGWidth=50,this.LineColor=d.KLineYAxisBGPaint.LineColor,this.DiffValutTextColor=d.KLineYAxisBGPaint.DiffValutTextColor,this.DiffValueBGColor=d.KLineYAxisBGPaint.DiffValueBGColor,this.KLineFrame,this.KLineData,this.Range={Max:null,Min:null},this.SetOption=function(e){e&&v.IsNonEmptyArray(e.SplitData)&&(this.SplitData=e.SplitData)},this.Draw=function(){if(this.IsShow&&!(!this.ChartFrame||!this.ChartFrame.SubFrame||this.ChartFrame.SubFrame.length<=this.FrameID)){var e=this.HQChart.ChartPaint[0];if(e){var a=this.ChartFrame.IsHScreen===!0;if(!a){this.KLineFrame=this.ChartFrame.SubFrame[this.FrameID].Frame;var r=this.KLineFrame.ChartBorder,t=this.KLineFrame.DataWidth,n=this.KLineFrame.DistanceWidth,s=this.KLineFrame.XPointCount,o=r.GetBorder(),l=o.LeftEx+n/2+d.FrameLeftMargin,h=o.RightEx;this.KLineData=e.Data;for(var u=null,f=null,C=this.KLineData.DataOffset,D=0;C<this.KLineData.Data.length&&D<s;++C,++D,l+=t+n){var c=this.KLineData.Data[C];if(!(c.Open==null||c.High==null||c.Low==null||c.Close==null)){var T=l+t;if(T>h)break;(u==null||u<c.High)&&(u=c.High),(f==null||f>c.Low)&&(f=c.Low)}}!v.IsNumber(u)||!v.IsNumber(f)||(this.Range.Max=u,this.Range.Min=f,this.DrawBackground())}}}},this.DrawBackground=function(){var e=this.Range.Min,a=this.KLineFrame.ChartBorder.GetBorder(),r=this.KLineFrame.GetYFromData(e,!1),t=a.Right,n=t+this.BGWidth;this.Canvas.font=this.Font,this.Canvas.textBaseline="top",this.Canvas.textAlign="left";for(var s=0;s<this.SplitData.length;++s){var o=this.SplitData[s];if(o.Value+e>this.KLineFrame.HorizontalMax)break;var l=this.KLineFrame.GetYFromData(e+o.Value,!1);this.Canvas.fillStyle=o.Color,this.Canvas.fillRect(b(t),b(l),b(n-t),b(r-l)),o.Text&&o.TextColor&&(this.Canvas.fillStyle=o.TextColor,this.Canvas.fillText(o.Text,n+1,l)),r=l}var h=this.Range.Max-this.Range.Min,u=jt(this.HQChart.Symbol),f=h.toFixed(u),C=this.KLineFrame.GetYFromData(this.Range.Max,!1);this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(t),L(C)),this.Canvas.lineTo(L(n),L(C)),this.Canvas.stroke();var D=this.Canvas.measureText(f).width+4,c=this.Canvas.measureText("擎").width+2,T={Left:n+1,Top:C-c,Width:D,Height:c};this.DiffValueBGColor&&(this.Canvas.fillStyle=this.DiffValueBGColor,this.Canvas.fillRect(T.Left,T.Top,T.Width,T.Height)),this.Canvas.textBaseline="bottom",this.Canvas.fillStyle=this.DiffValutTextColor,this.Canvas.fillText(f,T.Left+1,C)}}function sI(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.ClassName="BackgroundPaint",this.IsDynamic=!1,this.IsCallbackDraw=!0,this.FrameID=0,this.Data,this.ID=Re(),this.ChartSubFrame,this.ChartBorder,this.KData,this.Period,this.XPointCount=0,this.SetOption=function(e){e.FrameID>0&&(this.FrameID=e.FrameID),v.IsObjectExist(e.ID)&&(this.ID=e.ID)},this.Draw=function(){if(!(!this.Data||!this.HQChart)&&!(!this.ChartFrame||!this.ChartFrame.SubFrame||this.ChartFrame.SubFrame.length<=this.FrameID)){var e=this.HQChart.ChartPaint[0];if(!(!e||!e.Data)&&(this.ChartSubFrame=this.ChartFrame.SubFrame[this.FrameID].Frame,this.ChartBorder=this.ChartSubFrame.ChartBorder,this.KData=e.Data,this.Period=this.HQChart.Period,!(!this.KData||this.KData.Data.length<=0))){var a=this.ChartSubFrame.IsHScreen===!0;this.XPointCount=this.ChartSubFrame.XPointCount;var r=this.ChartSubFrame.XPointCount,t=this.KData.Data[this.KData.DataOffset],n=this.KData.DataOffset+r-1;n>=this.KData.Data.length&&(n=this.KData.Data.length-1);var s=this.KData.Data[n],o=this.GetShowData(t,s);if(!(!o||o.length<=0)){var l=this.BuildKLineMap(),h=this.ChartBorder.GetBottomEx(),u=this.ChartBorder.GetTopEx(),f=this.ChartBorder.GetHeightEx();a&&(u=this.ChartBorder.GetRightEx(),h=this.ChartBorder.GetLeftEx(),f=this.ChartBorder.GetWidthEx());for(var C in o){var D=o[C],c=this.GetBGCoordinate(D,l);if(c){if(Array.isArray(D.Color)){var T;a?T=this.Canvas.createLinearGradient(h,c.Left,u,c.Left):T=this.Canvas.createLinearGradient(c.Left,u,c.Left,h);var S=1/D.Color.length;for(var C in D.Color)T.addColorStop(C*S,D.Color[C]);this.Canvas.fillStyle=T}else this.Canvas.fillStyle=D.Color;a?this.Canvas.fillRect(b(h),b(c.Left),b(f),b(c.Width)):this.Canvas.fillRect(b(c.Left),b(u),b(c.Width),b(f))}}}}}},this.GetShowData=function(e,a){if(!v.IsNonEmptyArray(this.Data))return null;for(var r=[],t=0;t<this.Data.length;++t){var n=this.Data[t],s={};n.Start.Date>=e.Date&&n.Start.Date<=a.Date&&(s.Start=n.Start),n.End.Date>=e.Date&&n.End.Date<=a.Date&&(s.End=n.End),n.Start.Date<e.Date&&n.End.Date>a.Date&&(s.Start=e,s.End=a),(s.Start||s.End)&&(s.Color=n.Color,r.push(s))}return r},this.BuildKLineMap=function(){var e=this.ChartSubFrame.IsHScreen===!0,a=this.ChartSubFrame.DataWidth,r=this.ChartSubFrame.DistanceWidth,t=this.ChartBorder.GetLeft()+r/2+d.FrameLeftMargin;e&&(t=this.ChartBorder.GetTop()+r/2+d.FrameLeftMargin);var n=this.ChartBorder.GetRight();e&&(n=this.ChartBorder.GetBottom());for(var s={Data:new Dt.default,Start:null,End:null},o=this.KData.DataOffset,l=0;o<this.KData.Data.length&&l<this.XPointCount;++o,++l,t+=a+r){var h=this.KData.Data[o],u=t,f=t+a;if(f>n)break;var C=u+(f-u)/2;l==0&&(s.XLeft=u),s.XRight=f;var D={Index:o,ShowIndex:l,X:C,Right:f,Left:u,Date:h.Date};if(Y.IsMinutePeriod(this.Period,!0)){var c="Date:"+h.Date+" Time:"+h.Time;D.Time=h.Time}else var c="Date:"+h.Date;s.Data.set(c,D),l==0&&(s.Start=D),s.End=D}return s},this.GetBGCoordinate=function(e,a){var r=null,t=null,n=Y.IsMinutePeriod(this.Period,!0),s=!1;if(n?e.Start&&e.End&&e.Start.Date==e.End.Date&&e.Start.Time==e.End.Time&&(s=!0):e.Start&&e.End&&e.Start.Date==e.End.Date&&(s=!0),s){if(n)var o="Date:"+e.Start.Date+" Time:"+e.Start.Time;else var o="Date:"+e.Start.Date;if(!a.Data.has(o))return null;var l=a.Data.get(o);return r=l.Left,t=l.Right,{Left:r,Right:t,Width:t-r}}if(e.Start){if(n)var o="Date:"+e.Start.Date+" Time:"+e.Start.Time;else var o="Date:"+e.Start.Date;if(a.Data.has(o)){var l=a.Data.get(o);r=l.Left}else if(n)if(e.Start.Date<a.Start.Date||e.Start.Date==a.Start.Date&&e.Start.Time<=a.Start.Time)r=a.Start.Left;else{var h=!0,u=!1,f=void 0;try{for(var C=(0,ye.default)(a.Data),D;!(h=(D=C.next()).done);h=!0){var c=D.value,T=c[1];if(T.Date>e.Start.Date||T.Date==e.Start.Date&&T.Time>e.Start.Time){r=T.Left;break}}}catch(Ft){u=!0,f=Ft}finally{try{!h&&C.return&&C.return()}finally{if(u)throw f}}}else if(e.Start.Date<=a.Start.Date)r=a.Start.Left;else{var S=!0,I=!1,g=void 0;try{for(var E=(0,ye.default)(a.Data),F;!(S=(F=E.next()).done);S=!0){var c=F.value,T=c[1];if(T.Date>e.Start.Date){r=T.Left;break}}}catch(Ft){I=!0,g=Ft}finally{try{!S&&E.return&&E.return()}finally{if(I)throw g}}}}else r=a.XLeft;if(e.End){if(n)var o="Date:"+e.End.Date+" Time:"+e.End.Time;else var o="Date:"+e.End.Date;if(a.Data.has(o)){var l=a.Data.get(o);t=l.Right}else if(n){if(e.End.Date<a.Start.Date||e.End.Date==a.Start.Date&&e.End.Time<a.Start.Time)return null;if(e.End.Date<a.End.Date||e.End.Date==a.End.Date&&e.End.Time>=a.End.Time)t=a.End.Right;else{var R=null,A=!0,P=!1,p=void 0;try{for(var w=(0,ye.default)(a.Data),H;!(A=(H=w.next()).done);A=!0){var c=H.value,T=c[1];if(T.Date>e.End.Date||T.Date==e.End.Date&&T.Time>e.End.Time){t=R;break}R=T.Right}}catch(Ft){P=!0,p=Ft}finally{try{!A&&w.return&&w.return()}finally{if(P)throw p}}}}else{if(e.End.Date<a.Start.Date)return null;if(e.End.Date<=a.End.Date)t=a.End.Right;else{var R=null,W=!0,ht=!1,rt=void 0;try{for(var nt=(0,ye.default)(a.Data),vt;!(W=(vt=nt.next()).done);W=!0){var c=vt.value,T=c[1];if(T.Date>e.End.Date){t=R;break}R=T.Right}}catch(Bt){ht=!0,rt=Bt}finally{try{!W&&nt.return&&nt.return()}finally{if(ht)throw rt}}}}}else t=a.XRight;return r==null||t==null?null:{Left:r,Right:t,Width:t-r}}}function nI(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.ClassName="MinuteBackgroundPaint",this.IsDynamic=!0,this.IsCallbackDraw=!1,this.HQChart,this.Data,this.Font=d.DefaultTextFont,this.TextColor=d.DefaultTextColor,this.MerginTop=20,this.ID=Re(),this.FrameID=0,this.SetOption=function(e){e&&(e.Font&&(this.Font=e.Font),v.IsObjectExist(e.ID)&&(this.ID=e.ID),e.FrameID>0&&(this.FrameID=e.FrameID),e.MerginTop>0&&(this.MerginTop=e.MerginTop))},this.Draw=function(){if(!(!this.Data||!this.HQChart)&&!(!this.ChartFrame||!this.ChartFrame.SubFrame||this.ChartFrame.SubFrame.length<=this.FrameID)){var e=this.ChartFrame.SubFrame[this.FrameID];if(!(!e||!e.Frame)){var a=e.Frame,r=this.HQChart.SourceData;if(r){for(var t=a.XPointCount,n=0,s=null,o=new Dt.default,l=r.DataOffset,h=0;l<r.Data.length&&h<t;++l,++h){var u=r.Data[l];u&&u.Date!=n&&(n=u.Date,s?(s.Right=this.ChartFrame.GetXFromIndex(h-1),o.set(s.Date,s),s={Left:this.ChartFrame.GetXFromIndex(h),Date:u.Date}):s={Left:this.ChartFrame.GetXFromIndex(h),Date:u.Date})}s&&!s.Right&&(s.Right=this.ChartFrame.GetXFromIndex(t-1),o.set(s.Date,s)),this.Canvas.textAlign="center",this.Canvas.textBaseline="top";for(var f=a.ChartBorder.GetTopEx()+this.MerginTop,l=0;l<this.Data.length;++l){var u=this.Data[l];if(o.has(u.Date)){var s=o.get(u.Date),C=s.Left+(s.Right-s.Left)/2;u.Font?this.Canvas.font=u.Font:this.Canvas.font=this.Font,u.TextColor?this.Canvas.fillStyle=u.TextColor:this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(u.Text,C,f)}}}}}}}var Ye={MAIN_KLINE:1,OVERLAY_KLINE:2,MAIN_INDEX:3,OVERLAY_INDEX:4,OVERLAY_MINUTE:5,MAIN_MINUTE:6,MAIN_AVERAGE_MINUTE:7,MAIN_MINUTE_VOL:8};function oI(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.ClassName="DragMovePaint",this.DrawAfterTitle=!0,this.IsDynamic=!0,this.Info,this.IsShow=!1,this.Point,this.TextColor=d.DragMovePaint.TextColor,this.Font=d.DragMovePaint.Font,this.ReloadResource=function(e){this.TextColor=d.DragMovePaint.TextColor,this.Font=d.DragMovePaint.Font},this.Clear=function(){this.Info=null,this.IsShow=!1,this.Point=null},this.Draw=function(){if(!(!this.Info||!this.IsShow||!this.Point)){var e,a=this.Info.FrameID+1;this.Info.Type==Ye.MAIN_KLINE?e="K线:"+this.Info.Name+", 窗口:"+a:this.Info.Type==Ye.OVERLAY_KLINE?e="叠加K线:"+this.Info.Name+", 窗口:"+a:this.Info.Type==Ye.MAIN_INDEX?e="指标:"+this.Info.IndexName+", 窗口:"+a:this.Info.Type==Ye.OVERLAY_INDEX?e="叠加指标:"+this.Info.IndexName+", 窗口:"+a:this.Info.Type==Ye.OVERLAY_MINUTE?e="走势图, 叠加价格线:"+this.Info.Name+", 窗口:"+a:this.Info.Type==Ye.MAIN_MINUTE?e="走势图, 价格线:"+this.Info.Name+", 窗口:"+a:this.Info.Type==Ye.MAIN_AVERAGE_MINUTE?e="走势图, 均线:"+this.Info.Name+", 窗口:"+a:this.Info.Type==Ye.MAIN_MINUTE_VOL&&(e="走势图, 成交量:"+this.Info.Name+", 窗口:"+a),e&&(this.Canvas.font=this.Font,this.Canvas.fillStyle=this.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.fillText(e,this.Point.X,this.Point.Y))}}}function hI(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.ClassName="SessionBreaksPaint",this.IsDynamic=!1,this.IsCallbackDraw=!0,this.FrameID=0,this.KDataFeature,this.Data,this.ChartFrame,this.BGColor=d.SessionBreaksPaint.BGColor.slice(),this.SplitLine={Color:d.SessionBreaksPaint.SplitLine.Color,Width:d.SessionBreaksPaint.SplitLine.Width,Dash:d.SessionBreaksPaint.SplitLine.Dash},this.MapPeriod=new Dt.default([[0,{SplitType:1}],[1,{SplitType:1}],[2,{SplitType:2}],[21,{SplitType:2}],[4,{SplitType:3}],[5,{SplitType:3}],[6,{SplitType:3}],[7,{SplitType:3}],[8,{SplitType:3}]]),this.SetOption=function(e){e.FrameID>0&&(this.FrameID=e.FrameID)},this.Draw=function(){if(this.HQChart){var e=this.HQChart.ChartOperator_Temp_GetHistroyData();if(e&&v.IsNonEmptyArray(e.Data)&&(this.IsKDataChange(e)&&this.BuildCacheData(e),!!v.IsNonEmptyArray(this.Data))){var a=this.HQChart.Frame.SubFrame[0].Frame,r=this.ChartFrame.IsHScreen===!0,t=a.DataWidth,n=a.DistanceWidth,s=a.XPointCount;if(r)var o=this.ChartBorder.GetHScreenBorder(),l=o.BottomEx,h=o.TopEx+n/2+d.FrameLeftMargin;else var o=this.ChartBorder.GetBorder(),h=o.LeftEx+n/2+d.FrameLeftMargin,l=o.RightEx;for(var u=null,f=[],C=null,D=e.DataOffset,c=0;D<e.Data.length&&c<s;++D,++c,h+=t+n){var T=this.Data[D];if(T){var S=h,I=h+t;if(I>l)break;var g=S-n/2,E=I+n/2,F=T.ID;if(v.IsNumber(F))if(u==null){if(C={Start:{X:g},End:{X:E},ColorIndex:F,Count:1,IsStart:!1,IsEnd:!1},u=F,D-1>=0){var R=this.Data[D-1];R&&R.ID!=F&&(C.IsStart=!0)}}else u!=F?(C.End.X=g,C.IsEnd=!0,f.push(C),C={Start:{X:g},End:{X:E},ColorIndex:F,Count:1,IsStart:!0,IsEnd:!1},u=F):(C.End.X=E,++C.Count)}}C&&C.Count>=2&&f.push(C),this.Canvas.save(),this.DrawBG(f),this.Canvas.restore()}}},this.DrawBG=function(e){if(v.IsNonEmptyArray(e)){var a=this.ChartFrame.IsHScreen===!0;if(a)var r=this.ChartBorder.GetHScreenBorder(),t=r.RightEx,n=r.Left,s=n-t;else var r=this.ChartBorder.GetBorder(),t=r.TopEx,n=r.BottomEx,s=n-t;var o=!1;this.SplitLine.Color&&(o=!0);for(var l=0,h=0;h<e.length;++h){var u=e[h],f=u.Start.X,C=u.End.X,D=u.ColorIndex%this.BGColor.length,c=this.BGColor[D];c&&(this.Canvas.fillStyle=c,a?this.Canvas.fillRect(L(t),L(f),b(s),b(C-f)):this.Canvas.fillRect(L(f),L(t),b(C-f),b(s))),o&&u.IsStart&&(l==0&&this.Canvas.beginPath(),a?(this.Canvas.moveTo(t,L(f)),this.Canvas.lineTo(n,L(f))):(this.Canvas.moveTo(L(f),t),this.Canvas.lineTo(L(f),n)),++l)}o&&l>=1&&(this.SplitLine.Width>=1&&(this.Canvas.linewidth=this.SplitLine.Width),this.SplitLine.Dash&&this.Canvas.setLineDash(this.SplitLine.Dash),this.SplitLine.Color&&(this.Canvas.strokeStyle=this.SplitLine.Color),this.Canvas.stroke())}},this.IsKDataChange=function(e){return!this.KDataFeature||this.KDataFeature.Symbol!=this.HQChart.Symbol||this.KDataFeature.Period!=this.HQChart.Period||this.KDataFeature.DataCount!=e.Data.length},this.BuildCacheData=function(e){var a=this.HQChart.Period;if(!this.MapPeriod.has(a)){this.Data=[],this.KDataFeature={Symbol:this.HQChart.Symbol,Period:a,DataCount:e.Data.length};return}var r=this.MapPeriod.get(a).SplitType,t=0,n=-1;this.Data=[];for(var s=0;s<e.Data.length;++s){var o=e.Data[s];switch(r){case 1:parseInt(o.Date/100)!=parseInt(t/100)&&(t=o.Date,++n),this.Data.push({ID:n,Date:o.Date});break;case 2:parseInt(o.Date/1e4)!=parseInt(t/1e4)&&(t=o.Date,++n),this.Data.push({ID:n,Date:o.Date});break;case 3:o.Date!=t&&(t=o.Date,++n),this.Data.push({ID:n,Date:o.Date});break}}this.KDataFeature={Symbol:this.HQChart.Symbol,Period:a,DataCount:e.Data.length}}}function lI(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.ClassName="FrameButtomToolbarPaint",this.FrameID=-1,this.FrameGuid=null,this.IsDynamic=!0,this.DrawAfterTitle=!0,this.AryButton=[],this.SelectedID=null,this.AryRectButton=[],this.BGColor=d.FrameButtomToolbar.BGColor,this.BorderColor=d.FrameButtomToolbar.BorderColor,this.ButtonConfig=At(d.FrameButtomToolbar.Button),this.ReloadResource=function(e){this.BGColor=d.FrameButtomToolbar.BGColor,this.BorderColor=d.FrameButtomToolbar.BorderColor,this.ButtonConfig=At(d.FrameButtomToolbar.Button)},this.SetOption=function(e){e&&(v.IsNumber(e.FrameID)&&(this.FrameID=e.FrameID),e.FrameGuid&&(this.FrameGuid=e.FrameGuid),v.IsNonEmptyArray(e.AryButton)&&(this.AryButton=e.AryButton.slice()),e.SelectedID&&(this.SelectedID=e.SelectedID))},this.SetSelectedID=function(e){this.SelectedID=e},this.Draw=function(e,a){this.AryRectButton=[];var r=this.GetFrame();if(r&&!r.IsHScreen&&!r.IsMinSize&&!r.ChartBorder.IsShowTitleOnly){var t=r.ChartBorder.GetBorder(),n={Left:t.Left+1,Right:t.Right-1,Top:t.BottomEx+1,Bottom:t.Bottom-1};if(n.Width=n.Right-n.Left,n.Height=n.Bottom-n.Top,!(n.Height<10)){this.BGColor&&(this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(n.Left,n.Top,n.Width,n.Height));var s=this.GetTitleFont(n.Height-this.ButtonConfig.Mergin.Top-this.ButtonConfig.Mergin.Bottom),o=this.GetSVGFont(n.Height-this.ButtonConfig.Mergin.Top-this.ButtonConfig.Mergin.Bottom);this.Canvas.textBaseline="middle",this.Canvas.textAlign="center",this.Canvas.font=s;for(var l=n.Left,h=0;h<this.AryButton.length;++h){var u=this.AryButton[h];if(!u.Title&&!(u.SVGButton&&u.SVGButton.Symbol))return;var f=0;u.Title&&(f=this.Canvas.measureText(u.Title).width+2);var C=0;u.SVGButton&&u.SVGButton.Symbol&&(C=this.ButtonConfig.SVG.Size,f>0&&(C+=this.ButtonConfig.SVG.MerginLeft));var D=f+C+this.ButtonConfig.Mergin.Left+this.ButtonConfig.Mergin.Right,c={Left:l,Top:n.Top,Bottom:n.Bottom,Height:n.Height,Width:D};c.Right=c.Left+c.Width;var T=this.ButtonConfig.BGColor.Default,S=this.ButtonConfig.TitleColor.Default;if(e&&e.X>=c.Left&&e.X<c.Right&&e.Y>=c.Top&&e.Y<=c.Bottom&&(T=this.ButtonConfig.BGColor.MoveOn,S=this.ButtonConfig.TitleColor.MoveOn,a&&(a.MouseOnToolbar={Rect:c,Item:u,Frame:r,Point:{X:e.X,Y:e.Y},ID:"TitleButton"})),this.SelectedID&&this.SelectedID==u.ID&&(T=this.ButtonConfig.BGColor.Selected,S=this.ButtonConfig.TitleColor.Selected),T&&(this.Canvas.fillStyle=T,this.Canvas.fillRect(c.Left,c.Top,c.Width,c.Height)),this.ButtonConfig.BorderColor&&(this.Canvas.strokeStyle=this.ButtonConfig.BorderColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(c.Right),c.Top),this.Canvas.lineTo(L(c.Right),c.Bottom),this.Canvas.stroke()),u.Title){this.Canvas.fillStyle=S;var I=c.Left+(c.Width-C)/2,g=c.Top+this.ButtonConfig.Mergin.Top+(c.Height-this.ButtonConfig.Mergin.Top-this.ButtonConfig.Mergin.Bottom)/2;this.Canvas.fillText(u.Title,I,g)}var E=null;if(u.SVGButton&&u.SVGButton.Symbol){this.Canvas.font=o,this.Canvas.fillStyle=S;var I=c.Right-this.ButtonConfig.SVG.Size/2-this.ButtonConfig.Mergin.Right;this.Canvas.fillText(u.SVGButton.Symbol,I,g),this.Canvas.font=s,E={Left:c.Right-this.ButtonConfig.Mergin.Right-this.ButtonConfig.SVG.Size,Top:c.Top,Width:this.ButtonConfig.SVG.Size,Height:this.ButtonConfig.SVG.Size},E.Right=E.Left+E.Width,E.Bottom=E.Top+E.Height}if(f>0&&C>0){var F={Left:c.Left,Top:c.Top,Bottom:c.Bottom};F.Right=F.Left+f+this.ButtonConfig.Mergin.Left+this.ButtonConfig.SVG.MerginLeft/2;var R={Rect:F,ID:u.ID,Data:u,RectCell:c,ButtonType:0};this.AryRectButton.push(R);var E={Left:F.Right,Right:c.Right,Top:c.Top,Bottom:c.Bottom},R={Rect:E,ID:u.ID,Data:u,RectCell:c,ButtonType:1};this.AryRectButton.push(R)}else{var R={Rect:c,ID:u.ID,Data:u,RectCell:c};f>0?R.ButtonType=0:C>0&&(R.ButtonType=1),this.AryRectButton.push(R)}l+=D+1}this.BorderColor&&(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),this.Canvas.moveTo(t.Left,L(t.BottomEx)),this.Canvas.lineTo(t.Right,L(t.BottomEx)),this.Canvas.stroke())}}},this.GetFrame=function(){if(!this.ChartFrame)return null;if(this.FrameID>=0){var e=this.ChartFrame.SubFrame[this.FrameID];return!e||!e.Frame?null:e.Frame}return null},this.GetTitleFont=function(e){var a=this.ButtonConfig.Font,r=e*B();v.IsPlusNumber(a.Size)&&(r=a.Size);var t=r+"px "+a.Family;return t},this.GetSVGFont=function(e){var a=this.ButtonConfig.SVG,r=e*B();v.IsPlusNumber(a.Size)&&(r=a.Size);var t=r+"px "+a.Family;return t},this.PtInButtons=function(e,a){for(var r=0;r<this.AryRectButton.length;++r){var t=this.AryRectButton[r],n=t.Rect;if(e>n.Left&&e<n.Right&&a>n.Top&&a<n.Bottom){var s=this.GetFrame(),o={ID:t.Data.ID,Rect:n,FrameID:this.FrameID,Frame:s,Data:t.Data,ButtonType:t.ButtonType,RectCell:t.RectCell};return o}}return null}}function uI(){this.PlayList=[],this.Cache=[],this.MinLineHeight=40*B(),this.Height,this.Step=1,this.GetPlayList=function(e){for(var a=e.Canves,r=e.Right,t=e.Left,n=r-t,s=e.IsMoveStep,o=[],l=0,h=0;h<this.PlayList.length;++h){var u=this.PlayList[h],f=this.MinLineHeight;u.Height>this.MinLineHeight&&(f=u.Height);for(var C=!0,D=!1,c=0;c<u.Data.length;++c){var T=u.Data[c],S={X:T.X,Y:l,Text:T.Text,Color:T.Color,Height:f,Font:T.Font,Info:T.Info};o.push(S),s&&(c==u.Data.length-1&&this.Cache.length>0?(C=!1,T.TextWidth||(T.Font&&T.Font.Name?a.font=T.Font.Name:a.font=e.Font,T.TextWidth=a.measureText(S.Text+"擎擎").width),T.X>=T.TextWidth&&(C=!0)):c==0&&(D=!1,T.TextWidth||(T.Font&&T.Font.Name?a.font=T.Font.Name:a.font=e.Font,T.TextWidth=a.measureText(S.Text+"擎擎").width),T.X>n+T.TextWidth&&(D=!0)),T.X+=this.Step)}if(s&&C&&this.Cache.length>0){var I=this.Cache.shift(),g={X:0,Text:I.Text,Color:I.Color,Font:I.Font,Info:I.Info};u.Data.push(g)}if(s&&D&&u.Data.length>0){var E=u.Data.shift();this.OnItemPlayEnd(e.HQChart,E)}l+=f}return o},this.CacluatePlayLine=function(e){this.Height=e;var a=parseInt(e/this.MinLineHeight);if(this.PlayList.length<a)for(var r=a-this.PlayList.length,t=0;t<r;++t)this.PlayList.push({Data:[]});else if(this.PlayList.length>a)for(var n=this.PlayList.length-a,t=0;t<n;++t)for(var s=this.PlayList.pop(),o=0;o<s.Data.length;++o){var l=s.Data[o],h={Text:l.Text,Color:l.Color,Font:l.Font,Info:l.Info};this.Cache.unshift(h)}k.Chart.Log("[BarrageList::CacluatePlayLine] LineCount="+this.PlayList.length+" Height="+this.Height)},this.AddBarrage=function(e){for(var a in e){var r=e[a];this.Cache.push(r)}},this.OnItemPlayEnd=function(e,a){if(e.mapEvent.has($.BARRAGE_PLAY_END)){var r=e.mapEvent.get($.BARRAGE_PLAY_END);r.Callback&&r.Callback(r,a,this)}},this.Count=function(){return this.Cache.length}}function fI(){this.newMethod=oa,this.newMethod(),delete this.newMethod,this.ClassName="BarragePaint",this.IsAnimation=!0,this.IsEraseBG=!0,this.HQChart,this.Font=d.Barrage.Font,this.TextColor=d.Barrage.Color,this.FontHeight=d.Barrage.Height,this.BarrageList=new uI,this.IsMoveStep=!1,this.SetOption=function(e){e&&(e.Step>0&&(this.BarrageList.Step=e.Step),e.MinLineHeight&&(this.Barrage.MinLineHeight=e.MinLineHeight))},this.DrawHScreen=function(){var e=this.ChartBorder.GetWidth(),a=this.ChartBorder.GetTop(),r=this.ChartBorder.GetBottom(),t=this.ChartBorder.GetRightEx();this.ChartBorder.GetChartWidth(),e!=this.BarrageList.Height&&this.BarrageList.CacluatePlayLine(e),this.Canvas.textBaseline="middle",this.Canvas.textAlign="left";var n=this.BarrageList.GetPlayList({Canves:this.Canvas,Right:r,Left:a,Font:this.Font,IsMoveStep:this.IsMoveStep,HQChart:this.HQChart});if(this.IsMoveStep=!1,!!n){this.Canvas.save(),this.Canvas.translate(this.ChartBorder.GetChartHeight(),0),this.Canvas.rotate(90*Math.PI/180);for(var s=0;s<n.length;++s){var o=n[s];o.Color?this.Canvas.fillStyle=o.Color:this.Canvas.fillStyle=this.TextColor,o.Font?this.Canvas.font=o.Font.Name:this.Canvas.font=this.Font;var l=this.FontHeight;o.Font&&o.Font.Height>0&&(l=o.Font.Height);var h=o.Y+parseInt((o.Height-l)/2);this.Canvas.fillText(o.Text,r-o.X,t+h)}this.Canvas.restore()}},this.Draw=function(){if(this.ChartFrame.IsHScreen){this.DrawHScreen();return}var e=this.ChartBorder.GetLeft(),a=this.ChartBorder.GetRight(),r=this.ChartBorder.GetTopEx(),t=this.ChartBorder.GetHeight();t!=this.BarrageList.Height&&this.BarrageList.CacluatePlayLine(t),this.Canvas.textBaseline="middle",this.Canvas.textAlign="left";var n=this.BarrageList.GetPlayList({Canves:this.Canvas,Right:a,Left:e,Font:this.Font,IsMoveStep:this.IsMoveStep,HQChart:this.HQChart});if(this.IsMoveStep=!1,!!n)for(var s=0;s<n.length;++s){var o=n[s];o.Color?this.Canvas.fillStyle=o.Color:this.Canvas.fillStyle=this.TextColor,o.Font?this.Canvas.font=o.Font.Name:this.Canvas.font=this.Font;var l=this.FontHeight;o.Font&&o.Font.Height>0&&(l=o.Font.Height);var h=o.Y+parseInt((o.Height-l)/2);this.Canvas.fillText(o.Text,a-o.X,r+h)}}}var Ka={LATEST_VALUE_ID:0,FIXED_VALUE_ID:1,PAGE_LAST_PRICE_ID:2,PAGE_DATA_INCREASE:3,PAGE_LAST_INDEX_VALUE_ID:4,PAGE_LAST_OVERLAY_INDEX_VALUE_ID:5};function v(){this.ChartBorder,this.Frame,this.FrameSplitData,this.SplitCount=5,this.StringFormat=0,this.IsShowLeftText=!0,this.IsShowRightText=!0,this.LanguageID=xe.LANGUAGE_CHINESE_ID,this.GetEventCallback,this.GetKLineChartCallback,this.IntegerCoordinateSplit=function(e){var a=this.FrameSplitData.Find(e.Interval);if(!a)return!1;if(e.Interval==a.FixInterval)return!0;var r=e.Max,t=e.Min,n=e.Max/a.FixInterval,s=e.Min/a.FixInterval;v.IsFloat(n)&&(r=parseInt((n+.5).toFixed(0))*a.FixInterval),v.IsFloat(s)&&(t=parseInt((s-.5).toFixed(0))*a.FixInterval),e.Min==0&&(t=0),t<0&&e.Min>0&&(t=0);for(var o=0,l=t;l-r<1e-8;l+=a.FixInterval)++o;return e.Interval=a.FixInterval,e.Max=r,e.Min=t,e.Count=o,!0},this.Filter=function(e,a,r){if(this.SplitCount<=0||e.length<=0||e.length<=this.SplitCount)return e;var t=parseInt(e.length/this.SplitCount);t<=1&&(t=2);var n=[];if(r==1)for(var s=0;s<e.length;s+=t)n.push(e[s]);else for(var s=0;s<e.length;s+=t)s+t>=e.length&&s!=e.length-1?n.push(e[e.length-1]):n.push(e[s]);if(this.SplitCount==2&&n.length>2)for(var s=1;s<n.length-1;++s){var o=n[s];o.Message[0]=null,o.Message[1]=null}if(a){for(var l=!1,s=0;s<n.length;++s){var o=n[s];if(Math.abs(o.Value)<1e-8){l=!0;break}}if(l==!1){var h=new Ut;h.Value=0,h.Message[0]=null,h.Message[1]=null,n.push(h)}}return n},this.RemoveZero=function(e){for(var a=[!0,!0,!0,!0],r=0;r<e.length;++r){var t=e[r],n=t.Message[0];this.IsDecimalZeroEnd(n)||(a[0]=!1);var n=t.Message[1];this.IsDecimalZeroEnd(n)||(a[1]=!1);var n=t.Message[2];this.IsDecimalZeroEnd(n)||(a[2]=!1);var n=t.Message[3];this.IsDecimalZeroEnd(n)||(a[3]=!1)}if(!(a[0]==!1&&a[1]==!1&&a[2]==!1&&a[3]==!1))for(var r=0;r<e.length;++r){var t=e[r];if(a[0]){var n=t.Message[0];n!=null&&(typeof n=="number"&&(n=n.toString()),t.Message[0]=n.replace(/[.][0]+/g,""))}if(a[1]){var n=t.Message[1];n!=null&&(typeof n=="number"&&(n=n.toString()),t.Message[1]=n.replace(/[.][0]+/g,""))}if(a[2]){var n=t.Message[2];n!=null&&(typeof n=="number"&&(n=n.toString()),t.Message[2]=n.replace(/[.][0]+/g,""))}if(a[3]){var n=t.Message[3];n!=null&&(typeof n=="number"&&(n=n.toString()),t.Message[3]=n.replace(/[.][0]+/g,""))}}},this.IsDecimalZeroEnd=function(e){if(e==null||(typeof e=="number"&&(e=e.toString()),e=="0"))return!0;var a=e.search(/[.]/);if(a<0)return!1;for(var r=a+1;r<e.length;++r){var t=e.charAt(r);if(t>="1"&&t<="9")return!1}return!0},this.GetKLinePageInfo=function(){if(!this.GetKLineChartCallback)return null;var e=this.GetKLineChartCallback();if(!e||!e.Data||!(e.Data.DataOffset>=0)||!v.IsNonEmptyArray(e.Data.Data))return null;var a=e.Data.Data,r=e.Data.DataOffset,t=e.Data.DataOffset+e.ChartFrame.XPointCount-1;t>=a.length&&(t=a.length-1);var n={Start:{Item:a[r],Index:r},End:{Item:a[t],Index:t},IsLast:t==a.length-1};return n},this.CustomLatestIndexDataCoordinate=function(e){var a=this.GetKLinePageInfo();if(a&&this.HQChart){var r=null;this.GetEventCallback&&(r=this.GetEventCallback($.ON_FORMAT_INDEX_Y_LABEL));var t=a.End.Index,n=2;v.IsNumber(this.FloatPrecision)&&(n=this.FloatPrecision);for(var s=0,o=0;s<this.HQChart.ChartPaint.length;++s){var l=this.HQChart.ChartPaint[s];if(l.ChartFrame&&l.GetItemData&&(l.ChartFrame.Identify==this.Frame.Identify||l.ChartFrame==this.Frame)){var h=l.GetItemData({Index:t});if(!v.IsNonEmptyArray(h))continue;for(o=0;o<h.length;++o){var u=h[o],f=new Ut;f.Type=1,f.TextColor=d.FrameLatestPrice.TextColor,f.LineColor=u.Color,f.LineType=-1,f.IsLast=a.IsLast,v.IsNumber(e.LineType)&&(f.LineType=e.LineType),f.Value=u.Value;var C=v.FormatValueString(u.Value,n,this.LanguageID);if(e.Position=="left"?f.Message[0]=C:f.Message[1]=C,!a.IsLast){var D={};a.IsLast||(D.EmptyBGColor=d.FrameLatestPrice.EmptyBGColor),f.ExtendData={Custom:D}}if(r){var c={PreventDefault:!1,Label:f,Data:u,IndexName:l.IndexName,FrameID:this.Frame.Identify};if(r.Callback(r,c,this),c.PreventDefault)continue}this.Frame.CustomHorizontalInfo.push(f)}}}}},this.CustomLatestOverlayIndexDataCoordinate=function(e){var a=this.GetKLinePageInfo();if(a&&this.OverlayIndex&&v.IsNonEmptyArray(this.OverlayIndex.ChartPaint)){var r=null;this.GetEventCallback&&(r=this.GetEventCallback($.ON_FORMAT_OVERLAY_INDEX_Y_LABEL));var t=a.End.Index,n=2;v.IsNumber(this.FloatPrecision)&&(n=this.FloatPrecision);for(var s=0,o=0;s<this.OverlayIndex.ChartPaint.length;++s){var l=this.OverlayIndex.ChartPaint[s];if(l.ChartFrame&&l.GetItemData){var h=l.GetItemData({Index:t});if(v.IsNonEmptyArray(h))for(o=0;o<h.length;++o){var u=h[o],f=new Ut;f.Type=1,f.TextColor=d.FrameLatestPrice.TextColor,f.LineColor=u.Color,f.LineType=-1,f.IsLast=a.IsLast,v.IsNumber(e.LineType)&&(f.LineType=e.LineType),f.Value=u.Value;var C=v.FormatValueString(u.Value,n,this.LanguageID);if(e.Position=="left"?f.Message[0]=C:f.Message[1]=C,!a.IsLast){var D={};a.IsLast||(D.EmptyBGColor=d.FrameLatestPrice.EmptyBGColor),f.ExtendData={Custom:D}}if(r){var c={PreventDefault:!1,Label:f,Data:u,IndexName:l.IndexName,OverlayIdentify:this.OverlayIndex.Identify};if(r.Callback(r,c,this),c.PreventDefault)continue}this.Frame.CustomHorizontalInfo.push(f)}}}}},this.InvokeCustomYCoordinateCallback=function(){if(!this.GetEventCallback)return null;var e=this.GetEventCallback($.ON_CREATE_CUSTOM_Y_COORDINATE);if(!e||!e.Callback)return null;var a={ID:this.Frame.Identify,Frame:this.Frame,PreventDefault:!1,Custom:this.Custom};return this.OverlayIdentify&&(a.OverlayIdentify=this.OverlayIdentify),e.Callback(e,a,this),a},this.Reset=function(){},this.SetOption=function(e){},this.ReservedHeight=function(e){if(this.Frame&&!this.Frame.IsHScreen){var a=this.Frame.HorizontalReserved;if(a){var r=0;if(v.IsPlusNumber(a.Top)&&(r+=a.Top),v.IsPlusNumber(a.Bottom)&&(r+=a.Bottom),!(r<=0)){var t=this.Frame.GetBorder(),n=t.TopEx,s=t.BottomEx,o=s-n;if(!(o<r)){var l=e.Max,h=e.Min;v.IsPlusNumber(a.Top)&&(n-=a.Top),v.IsPlusNumber(a.Bottom)&&(s+=a.Bottom);var u=(l-h)/(s-n);if(v.IsPlusNumber(a.Top)){var f=u*a.Top;l+=f}if(v.IsPlusNumber(a.Bottom)){var C=u*a.Bottom;h-=C}e.Max=l,e.Min=h,this.Frame.HorizontalMax=e.Max,this.Frame.HorizontalMin=e.Min}}}}}}v.FormatValueThousandsString=function(e,a){if(e==null||isNaN(e)){if(a>0){for(var r="-.",t=0;t<a;++t)r+="-";return r}return"--"}var n="",s=e.toFixed(a);if(a>0){for(var o=s.split(".")[1],l=s.split(".")[0];l.length>3;)n=","+l.slice(-3)+n,l=l.slice(0,l.length-3);l&&(n=l+n+"."+o)}else{for(;s.length>3;)n=","+s.slice(-3)+n,s=s.slice(0,s.length-3);s&&(n=s+n)}return n};v.FormatValueString=function(e,a,r){return v.FormatValueStringV2(e,a,a,r)};v.FormatValueStringV2=function(e,a,r,t){if(e==null||isNaN(e)){if(a>0){for(var n="-.",s=0;s<a;++s)n+="-";return n}return"--"}if(e<1e-11&&e>-1e-11)return"0";var o=Math.abs(e);return t===xe.LANGUAGE_ENGLISH_ID?o<1e4?e.toFixed(a):o<1e6?(e/1e3).toFixed(r)+"K":o<1e9?(e/1e6).toFixed(r)+"M":o<1e12?(e/1e9).toFixed(r)+"B":(e/1e12).toFixed(r)+"T":t===xe.LANGUAGE_TRADITIONAL_CHINESE_ID?o<1e4?e.toFixed(a):o<1e8?(e/1e4).toFixed(r)+"萬":o<1e12?(e/1e8).toFixed(r)+"億":(e/1e12).toFixed(r)+"萬億":o<1e4?e.toFixed(a):o<1e6||o<1e8?(e/1e4).toFixed(r)+"万":o<1e12?(e/1e8).toFixed(r)+"亿":(e/1e12).toFixed(r)+"万亿"};v.FormatVolString=function(e,a){var r=Math.abs(e);return r<1e5?e.toFixed(0):r<1e7?(e/1e4).toFixed(1)+"万":r<1e8?(e/1e4).toFixed(0)+"万":r<1e9?(e/1e8).toFixed(2)+"亿":r<1e12?(e/1e8).toFixed(1)+"亿":(e/1e12).toFixed(1)+"万亿"};v.FromatIntegerString=function(e,a,r){return e<1e4&&v.IsInteger(e)&&(a=0),v.FormatValueString(e,a,r)};v.NumberToString=function(e){return e<10?"0"+e.toString():e.toString()};v.MillisecondToString=function(e){return e<10?"00"+e.toString():e<100?"0"+e.toString():e.toString()};v.FormatDateString=function(e,a,r){var t=parseInt(e/1e4),n=parseInt(e/100)%100,s=e%100;switch(a){case"MM-DD":return v.NumberToString(n)+"-"+v.NumberToString(s);case"MM/DD":return v.NumberToString(n)+"/"+v.NumberToString(s);case"MM/DD/W":var o=new Date(t,n-1,s),l=St.GetText(Dn[o.getDay()],r);return v.NumberToString(n)+"/"+v.NumberToString(s)+"/"+l;case"YYYY-MM":return t+"-"+v.NumberToString(n);case"YYYY/MM/DD":return t.toString()+"/"+v.NumberToString(n)+"/"+v.NumberToString(s);case"YYYY/MM/DD/W":{var o=new Date(t,n-1,s),l=St.GetText(Dn[o.getDay()],r);return t.toString()+"/"+v.NumberToString(n)+"/"+v.NumberToString(s)+"/"+l.toString()}case"DD/MM/YYYY":return v.NumberToString(s)+"/"+v.NumberToString(n)+"/"+t.toString();default:return t.toString()+"-"+v.NumberToString(n)+"-"+v.NumberToString(s)}};v.FormatTimeString=function(e,a){if(a=="HH:MM:SS"){var r=parseInt(e/1e4),t=parseInt(e%1e4/100),n=e%100;return v.NumberToString(r)+":"+v.NumberToString(t)+":"+v.NumberToString(n)}else if(a=="hh:mm"){var r=parseInt(e/1e4),t=parseInt(e%1e4/100),n=e%100;return v.NumberToString(r)+":"+v.NumberToString(t)}else if(a=="HH:MM"){var r=parseInt(e/100),t=e%100;return v.NumberToString(r)+":"+v.NumberToString(t)}else if(a=="HH:MM:SS.fff"){var s=e%1e3,o=parseInt(e/1e3),r=parseInt(o/1e4),t=parseInt(o%1e4/100),n=o%100;return v.NumberToString(r)+":"+v.NumberToString(t)+":"+v.NumberToString(n)+"."+v.MillisecondToString(s)}else if(e<1e4){var r=parseInt(e/100),t=e%100;return v.NumberToString(r)+":"+v.NumberToString(t)}else{var r=parseInt(e/1e4),t=parseInt(e%1e4/100),n=e%100;return v.NumberToString(r)+":"+v.NumberToString(t)+":"+v.NumberToString(n)}};v.FormatReportDateString=function(e){var a=parseInt(e/1e4),r=parseInt(e/100)%100,t;switch(r){case 3:t="一季度报";break;case 6:t="半年报";break;case 9:t="三季度报";break;case 12:t="年报";break}return a.toString()+t};v.FormatDateTimeString=function(e,a,r){var t=e.split(" ");if(t.length<2)return"";var n="";if(a){var s=parseInt(t[0]),o=parseInt(s/1e4),l=parseInt(s%1e4/100),h=s%100,u=o.toString()+"-"+(l<10?"0"+l.toString():l.toString())+"-"+(h<10?"0"+h.toString():h.toString());n+=u}if(r){var f=parseInt(t[1]);if(f<1e4){var C=f%100,D=parseInt(f/100),u=v.NumberToString(D)+":"+v.NumberToString(C);n.length>0&&(n+=" "),n+=u}else{var D=parseInt(f/1e4),C=parseInt(f%1e4/100),c=f%100,u=v.NumberToString(D)+":"+v.NumberToString(C)+":"+v.NumberToString(c);n.length>0&&(n+=" "),n+=u}}return n};v.FormatValueColor=function(e,a){return e!=null&&a==null?e==0?"PriceNull":e>0?"PriceUp":"PriceDown":e==null||a==null||e==a?"PriceNull":e>a?"PriceUp":"PriceDown"};v.IsNumber=function(e){return e==null||isNaN(e)?!1:typeof e=="number"};v.IsNumberV2=function(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];if(!a||a.length==0)return!1;var t=!0,n=!1,s=void 0;try{for(var o=(0,ye.default)(a),l;!(t=(l=o.next()).done);t=!0){var h=l.value;if(h==null||isNaN(h)||typeof h!="number")return!1}}catch(u){n=!0,s=u}finally{try{!t&&o.return&&o.return()}finally{if(n)throw s}}return!0};v.IsPlusNumber=function(e){return e==null||isNaN(e)?!1:e>0};v.IsInteger=function(e){return typeof e=="number"&&e%1===0};v.IsObjectExist=function(e){return!(e===void 0||e==null)};v.IsBool=function(e){return e===!0||e===!1};v.IsString=function(e){var a=typeof e>"u"?"undefined":(0,or.default)(e);return a=="string"};v.IsNonEmptyArray=function(e){return!e||!Array.isArray(e)?!1:e.length>0};v.IsFloat=function(e){return e===void 0||e==null||isNaN(e)?!1:e!=parseInt(e)};v.IsVaild=function(e){return!(isNaN(e)||e==null||e===void 0)};v.IsUndefined=function(e){return e===void 0};v.IsObject=function(e){return e instanceof Object};v.RemoveZero=function(e){for(;e.length>0;){var a=e.length-1,r=e[a];if(r=="0")e=e.substr(0,a);else if(r=="."){e=e.substr(0,a);break}else break}return e};v.RemoveMarketSuffix=function(e){if(!e)return e;var a=e.lastIndexOf(".");return a>0?e.substring(0,a):e};function Ds(){this.newMethod=v,this.newMethod(),delete this.newMethod,this.CoordinateType=0,this.Symbol,this.Data,this.FrameSplitData2,this.FloatPrecision=null,this.Period,this.KLineChart,this.Custom=[],this.SplitType=0,this.DefaultSplitType=0,this.DefaultYMaxMin,this.FixedYMaxMin,this.EnableZoomUpDown=!1,this.LastMaxMin,this.PercentageTextFormat=0,this.IsEnableDragY=function(){return this.CoordinateType==0||this.CoordinateType==1},this.Operator=function(){var e={};if(e.Max=this.Frame.HorizontalMax,e.Min=this.Frame.HorizontalMin,e.Count=this.SplitCount,this.Frame.YMaxMin){var a=this.Frame.YMaxMin;v.IsNumber(a.Max)&&v.IsNumber(a.Min)&&(e.Max=a.Max,e.Min=a.Min)}e.Max==e.Min&&(e.Max+=e.Max*.01,e.Min-=e.Min*.01);var r=this.FixedYMaxMin&&v.IsNumber(this.FixedYMaxMin.Max)&&v.IsNumber(this.FixedYMaxMin.Min);if(r)e.Max=this.FixedYMaxMin.Max,e.Min=this.FixedYMaxMin.Min;else if(this.DefaultYMaxMin){var t=this.DefaultYMaxMin;v.IsNumber(t.Max)&&(e.Min>t.Max?e.Min=t.Max:e.Max<t.Max&&(e.Max=t.Max)),v.IsNumber(t.Min)&&(e.Max<t.Min?e.Max=t.Min:e.Min>t.Min&&(e.Min=t.Min))}e.Interval=(e.Max-e.Min)/(e.Count-1);var n=B(),s=this.Frame.ChartBorder.GetChartWidth(),o=s<450*n,l=jt(this.Symbol);o&&U.IsSHSZIndex(this.Symbol)&&(l=0),this.FloatPrecision!=null&&(l=this.FloatPrecision),k.Chart.Log("[FrameSplitKLinePriceY::Operator] Max="+e.Max+" Min="+e.Min+" Count="+e.Count+" isPhoneModel="+o+" defaultfloatPrecision="+l+" "),this.Frame.Logarithmic=null,this.Frame.MultiTextFormat=0;var h=!0;if(e.IsFixedMaxMin=r,e.IsFilter=h,Y.IsTickPeriod(this.Period))this.SplitTickData(e,l),h=e.IsFilter;else if(Ds.SplitCustom)Ds.SplitCustom(this,e,l),h=!1;else switch(this.CoordinateType){case 1:this.SplitPercentage(e,l,r)?(this.Frame.MultiTextFormat=this.PercentageTextFormat,h=!1):this.SplitDefault(e,l,r);break;case 3:this.SplitIncrease(e,l)?h=!1:this.SplitDefault(e,l);break;case 4:this.SplitAverage(e,l),h=!1;break;case 5:this.SplitGoldenSection(e,l),h=!1;break;case 2:this.SplitLogarithmic(e,l)?h=!1:this.SplitDefault(e,l);break;default:this.SplitType==1?(this.SplitFixed(e,l),h=!1):this.SplitType==2?(this.SplitFixedV2(e,l),h=!1):this.SplitDefault(e,l,r);break}if(this.CustomCoordinate(l),h&&(this.Frame.HorizontalInfo=this.Filter(this.Frame.HorizontalInfo,!1)),this.Frame.HorizontalMax=e.Max,this.Frame.HorizontalMin=e.Min,this.EnableZoomUpDown==!0&&!this.FixedYMaxMin&&(this.FixedYMaxMin={Max:e.Max,Min:e.Min}),this.ReservedHeight(e),k.Chart.Log("[FrameSplitKLinePriceY::Operator] fixed . Max="+e.Max+" Min="+e.Min+" Count="+e.Count),this.GetEventCallback){var u=this.GetEventCallback($.ON_SPLIT_YCOORDINATE);if(u&&u.Callback){var f={ID:this.Frame.Identify,Frame:this.Frame};u.Callback(u,f,this)}}},this.SplitTickData=function(e,a){switch(this.CoordinateType){case 1:this.SplitPercentage(e,a,e.IsFixedMaxMin)?(this.Frame.MultiTextFormat=this.PercentageTextFormat,e.IsFilter=!1):this.SplitDefault(e,a,e.IsFixedMaxMin);break;default:this.SplitType==3?this.SplitTickPrice(e,a):this.SplitDefault(e,a,e.IsFixedMaxMin)}},this.SplitTickPrice=function(e,a){var r=this.KLineChart.GetAllPrice();this.Frame.HorizontalInfo=[];for(var t in r){var n=r[t];this.Frame.HorizontalInfo[t]=new Ut,this.Frame.HorizontalInfo[t].Value=n,this.IsShowLeftText&&(this.Frame.HorizontalInfo[t].Message[0]=n.toFixed(a)),this.IsShowRightText&&(this.Frame.HorizontalInfo[t].Message[1]=n.toFixed(a))}},this.SplitPercentage=function(e,a,r){var t=this.GetFirstOpenPrice();if(!v.IsNumber(t))return!1;e.Max=(e.Max-t)/t,e.Min=(e.Min-t)/t,e.Interval=(e.Max-e.Min)/(e.Count-1),r||this.IntegerCoordinateSplit2(e);var n=(1+e.Min)*t,s=(1+e.Max)*t,o;if(d.Frame&&d.Frame.PercentageText){var l=d.Frame.PercentageText;o={PriceColor:l.PriceColor,PercentageColor:l.PercentageColor,SplitColor:l.SplitColor,Font:l.Font}}for(var h=[],u=0;u<=e.Max;u+=e.Interval){var f=(u+1)*t,l=new Ut;if(l.Value=f,this.IsShowLeftText&&(l.Message[0]=f.toFixed(a)),this.IsShowRightText){var C=f.toFixed(a),D=(u*100).toFixed(2);D=v.RemoveZero(D),D+="%",l.Message[1]=[D,C],l.ExtendData=o}h.push(l)}for(var u=-e.Interval;u>=e.Min;u-=e.Interval){var f=(u+1)*t;if(!(f<n||f>s)){var l=new Ut;if(l.Value=f,this.IsShowLeftText&&(l.Message[0]=f.toFixed(a)),this.IsShowRightText){var C=f.toFixed(a),D=(u*100).toFixed(2);D=v.RemoveZero(D),D+="%",l.Message[1]=[D,C],l.ExtendData=o}h.push(l)}}return h.sort(function(c,T){return c.Value-T.Value}),this.Frame.HorizontalInfo=h,e.Min=n,e.Max=s,!0},this.SplitIncrease=function(e,a){var r=this.GetLast2ndClose();if(!v.IsNumber(r))return!1;this.IntegerCoordinateSplit(e),this.Frame.HorizontalInfo=[];for(var t=d.FrameSplitIncrease.Increase,n=[],s=r;s<e.Max;s=s*(1+t)){var o=new Ut;o.Value=s;var l=s.toFixed(a);this.IsShowLeftText&&(o.Message[0]=l),this.IsShowRightText&&(o.Message[1]=l),n.push(o)}for(var s=r*.9;s>e.Min;s=s*(1-t)){var o=new Ut;o.Value=s;var l=s.toFixed(a);this.IsShowLeftText&&(o.Message[0]=l),this.IsShowRightText&&(o.Message[1]=l),n.push(o)}return this.Frame.HorizontalInfo=n,!0},this.SplitAverage=function(e,a){var r=e.Max,t=e.Min;this.Frame.HorizontalInfo=[];for(var n=d.FrameSplitAverage.Count,s=(r-t)/n,o=0;o<=n;++o){var l=new Ut;l.Value=t+s*o;var h=l.Value.toFixed(a);this.IsShowLeftText&&(l.Message[0]=h),this.IsShowRightText&&(l.Message[1]=h),this.Frame.HorizontalInfo[o]=l}},this.SplitGoldenSection=function(e,a){var r=e.Max,t=e.Min;this.Frame.HorizontalInfo=[];var n=[],s=d.FrameGoldenSection.Golden;for(var o in s){var l=(r-t)*s[o]+t;item=new Ut,item.Value=l;var h=l.toFixed(a);this.IsShowLeftText&&(item.Message[0]=h),this.IsShowRightText&&(item.Message[1]=h),n.push(item)}this.Frame.HorizontalInfo=n},this.SplitLogarithmic=function(e,a){var r=d.FrameLogarithmic.MinInterval,t=this.GetFirstOpenPrice();if(!v.IsNumber(t))return!1;for(var n=this.ChartBorder.GetHeightEx(),s=[.01,.02,.04,.08,.1,.2],o=s[s.length-1],c=0;c<s.length;++c){var l=s[c],h=t*l*(n/(e.Max-e.Min));if(h>r){o=l;break}}var u=[],D=t,c=o;do{var S={Start:D};D=t*(1+c),S.End=D,u.push(S),c+=o}while(D<e.Max);var f=D,C=[],D=t,c=o;do{var S={End:D};D=t*(1-c),S.Start=D,C.push(S),c+=o}while(D>e.Min);var T=D;e.Max=f,e.Min=T,k.Chart.Log("[FrameSplitKLinePriceY::SplitLogarithmic] up, down",u,C),this.Frame.HorizontalInfo=[];var S=new Ut;S.Value=t,S.Font=d.FrameLogarithmic.OpenPriceFont;var I=S.Value.toFixed(a);this.IsShowLeftText&&(S.Message[0]=I),this.IsShowRightText&&(S.Message[1]=I),this.Frame.HorizontalInfo.push(S);for(var c in u){var S=new Ut;S.Value=u[c].End;var I=S.Value.toFixed(a);this.IsShowLeftText&&(S.Message[0]=I),this.IsShowRightText&&(S.Message[1]=I),this.Frame.HorizontalInfo.push(S)}for(var c in C){var S=new Ut;S.Value=C[c].End;var I=S.Value.toFixed(a);this.IsShowLeftText&&(S.Message[0]=I),this.IsShowRightText&&(S.Message[1]=I),this.Frame.HorizontalInfo.splice(0,0,S)}return this.Frame.Logarithmic={Up:u,Down:C,OpenPrice:t},!0},this.SplitDefault=function(e,a,r){r||this.IntegerCoordinateSplit(e),this.Frame.HorizontalInfo=[];for(var t=0,n=e.Min;t<e.Count;++t,n+=e.Interval)this.Frame.HorizontalInfo[t]=new Ut,this.Frame.HorizontalInfo[t].Value=n,this.IsShowLeftText&&(this.Frame.HorizontalInfo[t].Message[0]=n.toFixed(a)),this.IsShowRightText&&(this.Frame.HorizontalInfo[t].Message[1]=n.toFixed(a))},this.SplitFixed=function(e,a){this.Frame.HorizontalInfo=[];for(var r=0,t=e.Min;r<e.Count;++r,t+=e.Interval)this.Frame.HorizontalInfo[r]=new Ut,this.Frame.HorizontalInfo[r].Value=t,this.IsShowLeftText&&(this.Frame.HorizontalInfo[r].Message[0]=t.toFixed(a)),this.IsShowRightText&&(this.Frame.HorizontalInfo[r].Message[1]=t.toFixed(a))},this.SplitFixedV2=function(e,a){this.Frame.HorizontalInfo=[];for(var r=0,t=e.Min;r<e.Count;++r,t+=e.Interval)this.Frame.HorizontalInfo[r]=new Ut,this.Frame.HorizontalInfo[r].Value=t,this.IsShowLeftText&&(this.Frame.HorizontalInfo[r].Message[0]=t.toFixed(a)),this.IsShowRightText&&(this.Frame.HorizontalInfo[r].Message[1]=t.toFixed(a));e.IsFixedMaxMin||(a==0?(e.Max+=1,e.Min-=1):a==1?(e.Max+=.1,e.Min-=.1):a==2&&(e.Max+=.01,e.Min-=.01))},this.CustomCoordinate=function(e){if(!v.IsNumber(e)){var a=B(),r=this.Frame.ChartBorder.GetChartWidth(),t=r<450*a;e=jt(this.Symbol),t&&U.IsSHSZIndex(this.Symbol)&&(e=0),this.FloatPrecision!=null&&(e=this.FloatPrecision)}this.Frame.CustomHorizontalInfo=[];var n=this.InvokeCustomYCoordinateCallback();if(!(n&&n.PreventDefault==!0)){for(var s,o,l=0;l<this.Custom.length;++l){var h=this.Custom[l];if(h.Type==Ka.LATEST_VALUE_ID||h.Type==Ka.PAGE_DATA_INCREASE||h.Type==Ka.PAGE_LAST_PRICE_ID){var u=e;v.IsNumber(h.FloatPrecision)&&h.FloatPrecision>=0&&(u=h.FloatPrecision);var f=this.GetLatestPrice(u,h);f&&(h.Type==Ka.LATEST_VALUE_ID?s=f:h.Type==Ka.PAGE_LAST_PRICE_ID?o=f:this.Frame.CustomHorizontalInfo.push(f))}else h.Type==Ka.FIXED_VALUE_ID?this.CustomFixedCoordinate(h):h.Type==Ka.PAGE_LAST_INDEX_VALUE_ID&&this.CustomLatestIndexDataCoordinate(h)}(s||o)&&(s&&o&&o.IsLast===!0?this.Frame.CustomHorizontalInfo.unshift(s):(s&&this.Frame.CustomHorizontalInfo.unshift(s),o&&this.Frame.CustomHorizontalInfo.push(o)))}},this.GetLatestPrice=function(e,a){if(!this.Data||!this.Data.Data||this.Data.Data.length<=0)return null;var r=this.Data.Data[this.Data.Data.length-1],t=!0;if(a.Type==2){var n=this.GetKLinePageInfo();n&&(r=n.End.Item,t=n.IsLast)}var s=new Ut;s.Type=0,a&&v.IsNumber(a.Type)&&(s.Type=a.Type),s.Value=r.Close,s.TextColor=d.FrameLatestPrice.TextColor,s.LineType=2;var o=r.Close.toFixed(e);if(r.Close>r.Open?s.LineColor=d.FrameLatestPrice.UpBarColor:r.Close<r.Open?s.LineColor=d.FrameLatestPrice.DownBarColor:s.LineColor=d.FrameLatestPrice.UnchagneBarColor,a.Type==3){var n=this.GetKLinePageInfo();if(n&&v.IsNumber(n.Start.Item.YClose)){var l=(n.End.Item.Close-n.Start.Item.YClose)/n.Start.Item.YClose*100,o=l.toFixed(2)+"%";l>0?s.LineColor=d.FrameLatestPrice.UpBarColor:l<0?s.LineColor=d.FrameLatestPrice.DownBarColor:s.LineColor=d.FrameLatestPrice.UnchagneBarColor,s.Value=n.End.Item.Close,t=n.IsLast}}if(a.DateTime=="HH:MM"&&Y.IsMinutePeriod(this.Period,!0)){var h=v.FormatTimeString(r.Time,a.DateTime),u=[{Text:o},{Text:h}];a.Position=="left"?s.Message[0]=u:s.Message[1]=u}else if(v.IsBool(a.CountDown)){var u=[{Text:o},{Type:1}];a.Position=="left"?s.Message[0]=u:s.Message[1]=u}else a.Position=="left"?s.Message[0]=o:s.Message[1]=o;if(v.IsNumber(a.LineType)&&(s.LineType=a.LineType),v.IsPlusNumber(a.LineWidth)&&(s.LineWidth=a.LineWidth),a.LineDash&&(s.LineDash=a.LineDash),a.IsShowLine==!1&&(s.LineType=-1),s.IsLast=t,!t||a.PositionEx===1){var f={};t||(f.EmptyBGColor=d.FrameLatestPrice.EmptyBGColor),a.PositionEx===1&&(f.Position=1),s.ExtendData={Custom:f}}return s},this.GetFirstOpenPrice=function(){if(!this.Data)return null;for(var e=this.Frame.XPointCount,a=this.Data.DataOffset,r=0;a<this.Data.Data.length&&r<e;++a,++r){var t=this.Data.Data[a];if(!(t.Open==null||t.High==null||t.Low==null||t.Close==null))return Y.IsTickPeriod(this.Period)?t.YClose:t.Open}return null},this.GetLast2ndClose=function(){if(!this.Data||this.Data.Data.length<=0)return null;var e=this.Frame.XPointCount,a=this.Data.DataOffset+e-1;a>=this.Data.Data.length&&(a=this.Data.Data.length-1);for(var r=null,t=a,n=0;t>=0&&t<this.Data.Data.length;--t){var s=this.Data.Data[t];if(!(s.Open==null||s.High==null||s.Low==null||s.Close==null)&&(n==0?r=s.Open:n==1&&(r=s.Close),++n,n>=2))break}return r},this.CustomFixedCoordinate=function(e){for(var a=jt(this.Symbol),r=0;r<e.Data.length;++r){var t=e.Data[r],n=new Ut;n.Type=1,n.TextColor=t.TextColor,n.LineColor=t.Color,n.LineType=2,v.IsNumber(e.LineType)&&(n.LineType=e.LineType),v.IsPlusNumber(e.LineWidth)&&(n.LineWidth=e.LineWidth),e.LineDash&&(n.LineDash=e.LineDash),e.IsShowLine==!1&&(n.LineType=-1),n.Value=t.Value;var s;t.Text?s=t.Text:s=n.Value.toFixed(a),e.Position=="left"?n.Message[0]=s:n.Message[1]=s,e.PositionEx===1&&(n.ExtendData={Custom:{Position:1}}),v.IsNonEmptyArray(t.ExtendLine)&&(n.ExtendLine=t.ExtendLine.slice()),this.Frame.CustomHorizontalInfo.push(n)}},this.IntegerCoordinateSplit2=function(e){var a=this.FrameSplitData2.Find(e.Interval);if(!a)return!1;if(e.Interval==a.FixInterval)return!0;var r=parseInt((e.Max/a.FixInterval+.5).toFixed(0))*a.FixInterval,t=parseInt((e.Min/a.FixInterval-.5).toFixed(0))*a.FixInterval;e.Min==0&&(t=0),t<0&&e.Min>0&&(t=0);for(var n=0,s=t;s-r<1e-8;s+=a.FixInterval)++n;return e.Interval=a.FixInterval,e.Max=r,e.Min=t,e.Count=n,!0}}function Za(){this.newMethod=v,this.newMethod(),delete this.newMethod,this.SplitCount=3,this.FloatPrecision=2,this.FLOATPRECISION_RANGE=[1,.1,.01,.001,1e-4],this.SplitType=0,this.FilterType=0,this.DefaultSplitType=0,this.Custom=[],this.DefaultYMaxMin,this.EnableRemoveZero=d.Frame.EnableRemoveZero,this.LineType=null,this.IgnoreYValue=null,this.FixedYMaxMin,this.EnableZoomUpDown=!1,this.IsBeforeData=!1,this.BeforeOpenData,this.IsAfterData=!1,this.AfterCloseData,this.ShareAfterVol=0,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.OverlayIdentify,this.HQChart,this.OverlayIndex,this.IsEnableDragY=function(){return!0},this.Reset=function(){this.EnableRemoveZero=d.Frame.EnableRemoveZero,this.StringFormat=d.Frame.StringFormat},this.SetOption=function(e){e&&(v.IsNumber(e.FloatPrecision)&&(this.FloatPrecision=e.FloatPrecision),v.IsNumber(e.StringFormat)&&(this.StringFormat=e.StringFormat),v.IsBool(e.EnableRemoveZero)&&(this.EnableRemoveZero=e.EnableRemoveZero))},this.GetFloatPrecision=function(e,a){if(e>this.FLOATPRECISION_RANGE[0])return a;if(a<0)return 2;for(;a<this.FLOATPRECISION_RANGE.length&&!(e>this.FLOATPRECISION_RANGE[a]);++a);return a},this.Operator=function(){var e={};if(e.Max=this.Frame.HorizontalMax,e.Min=this.Frame.HorizontalMin,this.Frame.YMaxMin){var a=this.Frame.YMaxMin;v.IsNumber(a.Max)&&v.IsNumber(a.Min)&&(e.Max=a.Max,e.Min=a.Min)}e.Max==e.Min&&(e.Max==0?(e.Max=1,e.Min=-1):(e.Max+=e.Max*.01,e.Min-=e.Min*.01));var r=!1;if(this.FixedYMaxMin&&v.IsNumber(this.FixedYMaxMin.Max)&&v.IsNumber(this.FixedYMaxMin.Min)&&(r=!0),r)e.Max=this.FixedYMaxMin.Max,e.Min=this.FixedYMaxMin.Min;else if(this.DefaultYMaxMin){var t=this.DefaultYMaxMin;v.IsNumber(t.Max)&&(e.Min>t.Max?e.Min=t.Max:e.Max<t.Max&&(e.Max=t.Max)),v.IsNumber(t.Min)&&(e.Max<t.Min?e.Max=t.Min:e.Min>t.Min&&(e.Min=t.Min))}if(this.Frame.YSpecificMaxMin?(e.Count=this.Frame.YSpecificMaxMin.Count,e.Interval=(e.Max-e.Min)/(e.Count-1)):this.SplitType==1||r?(e.Count=this.SplitCount,e.Interval=(e.Max-e.Min)/(e.Count-1)):this.SplitType==2?(e.Max=100,e.Min=0,e.Count=this.SplitCount,e.Interval=(e.Max-e.Min)/(e.Count-1)):(e.Count=this.SplitCount,e.Interval=(e.Max-e.Min)/(e.Count-1),this.IntegerCoordinateSplit(e)),this.Frame.HorizontalMax=e.Max,this.Frame.HorizontalMin=e.Min,this.Frame.HorizontalInfo=[],this.Frame.YSplitScale)for(var n in this.Frame.YSplitScale){var s=this.Frame.YSplitScale[n],o=new Ut;o.Value=s,v.IsNumber(this.LineType)&&(o.LineType=this.LineType);var l=Math.abs(s);if(l<1e-10)o.Message[1]=0;else if(l<this.FLOATPRECISION_RANGE[this.FLOATPRECISION_RANGE.length-1])o.Message[1]=s.toExponential(2).toString();else{var h=this.GetFloatPrecision(l,this.FloatPrecision);o.Message[1]=v.FormatValueString(s,h,this.LanguageID)}o.Message[0]=o.Message[1],this.IsShowLeftText==!1&&(this.Frame.HorizontalInfo[n].Message[0]=null),this.IsShowRightText==!1&&(this.Frame.HorizontalInfo[n].Message[1]=null),this.Frame.HorizontalInfo.push(o)}else for(var n=0,s=e.Min;n<e.Count;++n,s+=e.Interval){var o=new Ut;this.Frame.HorizontalInfo[n]=o,o.Value=s,v.IsNumber(this.LineType)&&(o.LineType=this.LineType);var u=this.FormatValueString(s);this.Frame.HorizontalInfo[n].Message[0]=this.Frame.HorizontalInfo[n].Message[1]=u,this.IsShowLeftText==!1&&(this.Frame.HorizontalInfo[n].Message[0]=null),this.IsShowRightText==!1&&(this.Frame.HorizontalInfo[n].Message[1]=null)}if(this.FilterIgnoreYValue(),this.CustomCoordinate(),this.SplitType!=1&&(this.Frame.HorizontalInfo=this.Filter(this.Frame.HorizontalInfo,e.Max>0&&e.Min<0,this.FilterType)),this.RightFrameSplitY(),this.MainOverlayFrameSplitY(),this.CallAcutionSplitY(this.SplitCount,e),this.EnableRemoveZero&&this.RemoveZero(this.Frame.HorizontalInfo),this.DynamicMessageText(),this.Frame.HorizontalMax=e.Max,this.Frame.HorizontalMin=e.Min,this.EnableZoomUpDown==!0&&!this.FixedYMaxMin&&(this.FixedYMaxMin={Max:e.Max,Min:e.Min}),this.ReservedHeight(e),this.GetEventCallback){var f=this.GetEventCallback($.ON_SPLIT_YCOORDINATE);if(f&&f.Callback){var C={ID:this.Frame.Identify,Frame:this.Frame};this.OverlayIdentify&&(C.OverlayIdentify=this.OverlayIdentify),f.Callback(f,C,this)}}},this.FormatValueString=function(e){var a;if(this.StringFormat==1){var r=this.FloatPrecision;v.IsNumber(e)&&Math.abs(e)>1e3&&(r=0),a=v.FormatValueString(e,r,this.LanguageID)}else if(this.StringFormat==2)a=""+e.toFixed(this.FloatPrecision);else{var t=Math.abs(e);if(t<1e-10)a=0;else if(t<this.FLOATPRECISION_RANGE[this.FLOATPRECISION_RANGE.length-1])a=e.toExponential(2).toString();else{var r=this.GetFloatPrecision(t,this.FloatPrecision);a=v.FormatValueString(e,r,this.LanguageID)}}return a},this.FilterIgnoreYValue=function(){if(!(!this.IgnoreYValue||this.IgnoreYValue.length<=0)){var e=new Fe.default(this.IgnoreYValue);this.Frame.HorizontalInfo=this.Frame.HorizontalInfo.filter(function(a){return!e.has(a.Value)})}},this.DynamicMessageText=function(){if(this.SplitType==2)for(var e=0;e<this.Frame.HorizontalInfo.length;++e){var a=this.Frame.HorizontalInfo[e];a.Message[0]&&(a.Message[0]+="%"),a.Message[1]&&(a.Message[1]+="%")}},this.CallAcutionSplitY=function(e,a){if(this.Frame.Identify!=1)return null;var r=this.GetCallAcutionSplitY(e,a);if(r){for(var t=0;t<this.Frame.HorizontalInfo.length;++t){var n=this.Frame.HorizontalInfo[t];r.IsBeforeData&&(n.Message[2]=n.Message[0],n.Message[0]=null),r.IsAfterData&&(this.ShareAfterVol==0||this.ShareAfterVol==2)&&(n.Message[3]=n.Message[1],n.Message[1]=null)}for(var t=0;t<r.HorizontalInfo.length;++t){var n=r.HorizontalInfo[t];this.Frame.HorizontalInfo.push(n)}}},this.GetCallAcutionSplitY=function(e,a){if(this.Frame.Identify!=1)return null;var r=this.IsBeforeData==!0&&this.BeforeOpenData&&(this.BeforeOpenData.Ver==2||this.BeforeOpenData.Ver==3),t=this.IsAfterData==!0&&this.AfterCloseData&&(this.AfterCloseData.Ver==2||this.AfterCloseData.Ver==3);if(r||t){var n=(a.Max-a.Min)/(e-1);if(r)var D=(this.BeforeOpenData.VolMax-this.BeforeOpenData.VolMin)/(e-1);if(t)var S=(this.AfterCloseData.VolMax-this.AfterCloseData.VolMin)/(e-1);for(var s=[],o=0;o<e;++o){var l=new Ut,h=n*o;if(l.Value=h,l.LineType=8,r){var u=D*o;l.Message[0]=this.FormatValueString(u)}if(t&&(this.ShareAfterVol==0||this.ShareAfterVol==2)){var f=S*o;l.Message[1]=this.FormatValueString(f)}s.push(l)}return{HorizontalInfo:s,IsBeforeData:r,IsAfterData:t}}var C=!1,D=null;if(this.MultiDayBeforeOpenData&&v.IsNonEmptyArray(this.MultiDayBeforeOpenData)){C=!0;var c=this.MultiDayBeforeOpenData[0];if(c.Ver==2||c.Ver==3)var D=(c.VolMax-c.VolMin)/(e-1)}var T=!1,S=null;if(this.MultiDayAfterCloseData&&v.IsNonEmptyArray(this.MultiDayAfterCloseData)){T=!0;var c=this.MultiDayAfterCloseData[0];if(c.Ver==2||c.Ver==3)var S=(c.VolMax-c.VolMin)/(e-1)}if(C||T){for(var n=(a.Max-a.Min)/(e-1),s=[],o=0;o<e;++o){var l=new Ut,h=n*o;l.Value=h,l.LineType=9;var I=!1;if(D!=null){var u=D*o;l.Message[0]=this.FormatValueString(u),I=!0}if(S!=null&&(this.ShareAfterVol==0||this.ShareAfterVol==2)){var f=S*o;l.Message[1]=this.FormatValueString(f),I=!0}I&&s.push(l)}if(v.IsNonEmptyArray(s))return{HorizontalInfo:s,IsBeforeData:C,IsAfterData:T}}return null},this.RightFrameSplitY=function(){if(this.Frame.RightFrame){var e=this.Frame.RightFrame;e.YSplitOperator&&e.YSplitOperator.Operator();for(var a=0;a<this.Frame.HorizontalInfo.length;++a){var r=this.Frame.HorizontalInfo[a],t=this.Frame.GetYFromData(r.Value),n=e.GetYData(t);r.Message[1]=v.FormatValueString(n,this.FloatPrecision,this.LanguageID)}}},this.MainOverlayFrameSplitY=function(){if(this.Frame.GetMainOverlayFrame){var e=this.Frame.GetMainOverlayFrame();if(e){if(e[1]){var a=e[1],r=a.YSplitOperator;r&&r.Operator();for(var t=0;t<this.Frame.HorizontalInfo.length;++t){var n=this.Frame.HorizontalInfo[t],s=this.Frame.GetYFromData(n.Value),o=a.GetYData(s);r&&r.FormatValueString?n.Message[1]=r.FormatValueString(o):n.Message[1]=this.FormatValueString(o)}}if(e[0]){var l=e[0],r=l.YSplitOperator;r&&r.Operator();for(var t=0;t<this.Frame.HorizontalInfo.length;++t){var n=this.Frame.HorizontalInfo[t],s=this.Frame.GetYFromData(n.Value),o=l.GetYData(s);r&&r.FormatValueString?n.Message[0]=r.FormatValueString(o):n.Message[0]=this.FormatValueString(o)}}}}},this.CustomCoordinate=function(){this.Frame.CustomHorizontalInfo=[];var e=this.InvokeCustomYCoordinateCallback();if(!(e&&e.PreventDefault==!0)&&v.IsNonEmptyArray(this.Custom))for(var a=0;a<this.Custom.length;++a){var r=this.Custom[a];r.Type==Ka.PAGE_LAST_INDEX_VALUE_ID?this.CustomLatestIndexDataCoordinate(r):r.Type==Ka.FIXED_VALUE_ID?this.CustomFixedCoordinate(r):r.Type==Ka.PAGE_LAST_OVERLAY_INDEX_VALUE_ID&&this.CustomLatestOverlayIndexDataCoordinate(r)}},this.CustomFixedCoordinate=function(e){if(v.IsNonEmptyArray(e.Data))for(var a=2,r=0;r<e.Data.length;++r){var t=e.Data[r],n=new Ut;n.Type=1,n.TextColor=t.TextColor,n.LineColor=t.Color,n.LineType=2,v.IsNumber(e.LineType)&&(n.LineType=e.LineType),e.IsShowLine==!1&&(n.LineType=-1),n.Value=t.Value;var s;t.Text?s=t.Text:s=n.Value.toFixed(a),e.Position=="left"?n.Message[0]=s:n.Message[1]=s,this.Frame.CustomHorizontalInfo.push(n)}}}function br(){this.newMethod=v,this.newMethod(),delete this.newMethod,this.ShowText=!0,this.Period,this.Symbol,this.MinTextDistance=50*B(),this.MinBarDistance=5,this.SplitDateTime=function(){this.Frame.VerticalInfo=[];for(var e=this.Frame.DistanceWidth+this.Frame.DataWidth,a=this.Frame.Data.DataOffset,r=this.Frame.XPointCount,t=0,n=0,s=0,o=a;s<r&&o<this.Frame.Data.Data.length;++s,++o){t+=e,++n;var l=null;if(s==0){var h=v.FormatDateString(this.Frame.Data.Data[o].Date,"MM-DD");l={Value:o-a,Text:h}}else if(t>this.MinTextDistance&&n>=this.MinBarDistance){var u=v.FormatTimeString(this.Frame.Data.Data[o].Time);l={Value:o-a,Text:u}}if(l){var f=new Ut;f.Value=l.Value,this.ShowText&&(f.Message[0]=l.Text),f.Value==0&&(f.LineType=-1),this.Frame.VerticalInfo.push(f),t=0,n=0,s==0&&(t=-(this.MinTextDistance/2))}}},this.SplitSecond=function(){this.Frame.VerticalInfo=[];for(var e=this.Frame.DistanceWidth+this.Frame.DataWidth,a=this.Frame.Data.DataOffset,r=this.Frame.XPointCount,t=0,n=0,s=0,o=a;s<r&&o<this.Frame.Data.Data.length;++s,++o){t+=e,++n;var l=null;if(s==0){var h=v.FormatDateString(this.Frame.Data.Data[o].Date,"MM-DD");l={Value:o-a,Text:h}}else if(t>this.MinTextDistance&&n>=this.MinBarDistance){var u=v.FormatTimeString(this.Frame.Data.Data[o].Time,"HH:MM:SS");l={Value:o-a,Text:u}}if(l){var f=new Ut;f.Value=l.Value,this.ShowText&&(f.Message[0]=l.Text),this.Frame.VerticalInfo.push(f),t=0,n=0,s==0&&(t=-(this.MinTextDistance/2))}}},this.SplitMilliSecond=function(){this.Frame.VerticalInfo=[];for(var e=this.Frame.DistanceWidth+this.Frame.DataWidth,a=this.Frame.Data.DataOffset,r=this.Frame.XPointCount,t=0,n=0,s=0,o=a;s<r&&o<this.Frame.Data.Data.length;++s,++o){t+=e,++n;var l=null;if(s==0){var h=v.FormatDateString(this.Frame.Data.Data[o].Date,"HH:MM:SS.fff");l={Value:o-a,Text:h}}else if(t>this.MinTextDistance&&n>=this.MinBarDistance){var u=v.FormatTimeString(this.Frame.Data.Data[o].Time,"HH:MM:SS.fff");l={Value:o-a,Text:u}}if(l){var f=new Ut;f.Value=l.Value,this.ShowText&&(f.Message[0]=l.Text),this.Frame.VerticalInfo.push(f),t=0,n=0,s==0&&(t=-(this.MinTextDistance/2))}}},this.SplitDate=function(){this.Frame.VerticalInfo=[];for(var e=this.Frame.Data.DataOffset,a=this.Frame.XPointCount,r=null,t=null,n=12,s=0,o=0,l=e,h=n;o<a&&l<this.Frame.Data.Data.length;++o,++l){var u=parseInt(this.Frame.Data.Data[l].Date/1e4),f=parseInt(this.Frame.Data.Data[l].Date/100)%100;if(t!=f&&++s,h<n||r!=null&&r==u&&t!=null&&t==f){t=f,++h;continue}var C=new Ut;C.Value=l-e;var D;r==null||r!=u?D=u.toString():(t==null||t!=f)&&(D=f.toString()+"月",D=St.GetText(D,this.LanguageID)),r=u,t=f,this.ShowText&&(C.Message[0]=D),C.Value==0&&(C.LineType=-1),this.Frame.VerticalInfo.push(C),h=0}this.Period==0&&s<=2&&this.SplitShortDate()},this.SplitShortDate=function(){this.Frame.VerticalInfo=[];for(var e=this.Frame.Data.DataOffset,a=this.Frame.XPointCount,r=12,t=!0,n=0,s=e,o=r;n<a&&s<this.Frame.Data.Data.length;++n,++s){var l=parseInt(this.Frame.Data.Data[s].Date/1e4);if(o<r){++o;continue}var h=new Ut;h.Value=s-e;var u;t?(u=l.toString(),t=!1):u=v.FormatDateString(this.Frame.Data.Data[s].Date,"MM-DD"),this.ShowText&&(h.Message[0]=u),h.Value==0&&(h.LineType=-1),this.Frame.VerticalInfo.push(h),o=0}if(this.Frame.VerticalInfo.length==1){var f=this.Frame.VerticalInfo[0],s=f.Value+e,C=this.Frame.Data.Data[s],u=v.FormatDateString(C.Date,"YYYY-MM");this.ShowText&&(f.Message[0]=u)}},this.Operator=function(){if(this.Frame.Data!=null&&(br.SplitCustom?br.SplitCustom(this):Y.IsMinutePeriod(this.Period,!0)?this.SplitDateTime():Y.IsSecondPeriod(this.Period)?this.SplitSecond():Y.IsTickPeriod(this.Period)?this.SplitSecond():Y.IsMilliSecondPeriod(this.Period)?this.SplitMilliSecond():this.SplitDate(),this.GetEventCallback)){var e=this.GetEventCallback($.ON_SPLIT_XCOORDINATE);if(e&&e.Callback){var a={ID:this.Frame.Identify,Frame:this.Frame};e.Callback(e,a,this)}}},this.CreateCoordinateInfo=function(){return new Ut}}function sD(){this.newMethod=v,this.newMethod(),delete this.newMethod,this.High=null,this.Low=null,this.YClose,this.Data,this.SourceData,this.OverlayChartPaint,this.SplitCount=7,this.Symbol,this.SplitType=0,this.DefaultSplitType=0,this.LimitPrice,this.Custom,this.RightTextFormat=0,this.BeforeOpenData,this.IsBeforeData=!1,this.AfterCloseData,this.IsAfterData=!1,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.DayOffset,this.AverageData,this.DayCount=1,this.GlobalOption,this.HQChart,this.IsEnableDragY=function(){return!1},this.Operator=function(){if(this.Frame.HorizontalInfo=[],this.Frame.CustomHorizontalInfo=[],!!this.Data){var e=this.GetMaxMin();if(this.Symbol&&U.IsUSA(this.Symbol.toUpperCase())?this.USASplit(e):this.SplitType==2?this.USASplit(e):this.DefaultSplit(e),this.CustomCoordinate(),this.ReservedHeight({Max:this.Frame.HorizontalMax,Min:this.Frame.HorizontalMin}),this.GetEventCallback){var a=this.GetEventCallback($.ON_SPLIT_YCOORDINATE);if(a&&a.Callback){var r={ID:this.Frame.Identify,Frame:this.Frame};a.Callback(a,r,this)}}}},this.CustomCoordinate=function(){this.Frame.CustomHorizontalInfo=[];var e=this.InvokeCustomYCoordinateCallback();if(!(e&&e.PreventDefault==!0)&&this.Custom){var a=jt(this.Symbol);for(var r in this.Custom){var t=this.Custom[r];if(t.Type==1)this.CustomFixedCoordinate(t);else if(t.Type==0){var n=this.GetLatestPrice(a,t);n&&this.Frame.CustomHorizontalInfo.push(n)}}}},this.GetLatestPrice=function(e,a){if(!this.Data||!this.Data.Data||this.Data.Data.length<=0)return null;var r=this.Data.Data[this.Data.Data.length-1];if(!v.IsNumber(r)||!v.IsNumber(this.YClose))return null;var t=new Ut;t.Type=0,t.Value=r,t.TextColor=d.FrameLatestPrice.TextColor,t.LineType=2;var n=r.toFixed(e);if(a.DateTime=="HH:MM"){var s=this.Frame.Data.Data[this.Frame.Data.Data.length-1],o=v.FormatTimeString(s.Time,a.DateTime),l=[{Text:n},{Text:o}];a.Position=="left"?t.Message[0]=l:t.Message[1]=l}else a.Position=="left"?t.Message[0]=n:t.Message[1]=n;return r>this.YClose?t.LineColor=d.FrameLatestPrice.UpBarColor:r<this.YClose?t.LineColor=d.FrameLatestPrice.DownBarColor:t.LineColor=d.FrameLatestPrice.UnchagneBarColor,v.IsNumber(a.LineType)&&(t.LineType=a.LineType),v.IsPlusNumber(a.LineWidth)&&(t.LineWidth=a.LineWidth),a.LineDash&&(t.LineDash=a.LineDash),a.IsShowLine==!1&&(t.LineType=-1),a.PositionEx===1&&(t.ExtendData={Custom:{Position:1}}),t},this.CustomFixedCoordinate=function(e){for(var a=jt(this.Symbol),r=0;r<e.Data.length;++r){var t=e.Data[r],n=new Ut;if(n.Type=1,n.TextColor=t.TextColor,n.LineColor=t.Color,n.LineType=2,v.IsNumber(e.LineType)&&(n.LineType=e.LineType),v.IsPlusNumber(e.LineWidth)&&(n.LineWidth=e.LineWidth),e.LineDash&&(n.LineDash=e.LineDash),e.IsShowLine==!1&&(n.LineType=-1),e.PositionEx===1&&(n.ExtendData={Custom:{Position:1}}),v.IsNumber(t.Increase)){if(!v.IsNumber(this.YClose))continue;n.Value=this.YClose*(1+t.Increase)}else n.Value=t.Value;var s;t.Text?s=t.Text:s=n.Value.toFixed(a),e.Position=="left"?n.Message[0]=s:n.Message[1]=s,this.Frame.CustomHorizontalInfo.push(n)}},this.GetCallAuctionMaxMin=function(e,a){for(var r in e.Data){var t=e.Data[r];t&&(v.IsNumber(t.Price)&&(a.Max==null&&(a.Max=t.Price),a.Min==null&&(a.Min=t.Price),a.Max<t.Price&&(a.Max=t.Price),a.Min>t.Price&&(a.Min=t.Price)),e.Ver==3&&v.IsNumber(t.AvPrice)&&(a.Max==null&&(a.Max=t.AvPrice),a.Min==null&&(a.Min=t.AvPrice),a.Max<t.AvPrice&&(a.Max=t.AvPrice),a.Min>t.AvPrice&&(a.Min=t.AvPrice)))}},this.GetMultiDayBeforeOpenData=function(){if(!this.MultiDayBeforeOpenData||!v.IsNonEmptyArray(this.MultiDayBeforeOpenData))return null;if(!this.DayOffset)return this.MultiDayBeforeOpenData;if(!v.IsNumber(this.DayOffset.Offset)||!v.IsNumber(this.DayOffset.ShowDayCount))return null;if(this.GlobalOption&&this.GlobalOption.IsValueFullRange===!0)return this.MultiDayBeforeOpenData;var e=this.DayOffset.ShowDayCount,a=this.DayOffset.Offset,r=this.MultiDayBeforeOpenData.slice(a,a+e);return r},this.GetMultiDayAfterCloseData=function(){if(!this.MultiDayAfterCloseData||!v.IsNonEmptyArray(this.MultiDayAfterCloseData))return null;if(!this.DayOffset)return this.MultiDayAfterCloseData;if(!v.IsNumber(this.DayOffset.Offset)||!v.IsNumber(this.DayOffset.ShowDayCount))return null;if(this.GlobalOption&&this.GlobalOption.IsValueFullRange===!0)return this.MultiDayAfterCloseData;var e=this.DayOffset.ShowDayCount,a=this.DayOffset.Offset,r=this.MultiDayAfterCloseData.slice(a,a+e);return r},this.GetMaxMin=function(){var e=this.YClose,a=this.YClose,r=this.Data,t=!1;if(this.SourceData&&(r=this.SourceData,t=!0),this.DayCount>1){var n=this.DayOffset.DataOffset,s=this.DayOffset.ShowDataCount;this.GlobalOption&&this.GlobalOption.IsValueFullRange===!0&&(n=0,s=r.Data.length);for(var o=n,l=0;o<r.Data.length&&l<s;++o,++l){var h=null;if(t){var u=r.Data[o];u.Before?h=u.Before.Close:h=u.Close}else h=r.Data[o];h!=null&&(e<h&&(e=h),a>h&&(a=h))}if(this.AverageData)for(var o=n,l=0;o<this.AverageData.Data.length&&l<s;++o,++l)this.AverageData.Data[o]!=null&&(e<this.AverageData.Data[o]&&(e=this.AverageData.Data[o]),a>this.AverageData.Data[o]&&(a=this.AverageData.Data[o]))}else{for(var o=0;o<r.Data.length;++o){var h=null;if(t){var u=r.Data[o];u.Before?h=u.Before.Close:h=u.Close}else h=r.Data[o];h!=null&&(e<h&&(e=h),a>h&&(a=h))}if(this.AverageData)for(var o=0;o<this.AverageData.Data.length;++o)this.AverageData.Data[o]!=null&&(e<this.AverageData.Data[o]&&(e=this.AverageData.Data[o]),a>this.AverageData.Data[o]&&(a=this.AverageData.Data[o]))}for(var o in this.OverlayChartPaint){var u=this.OverlayChartPaint[o],f=u.GetMaxMin();f.Max&&f.Max>e&&(e=f.Max),f.Min&&f.Min<a&&(a=f.Min)}this.SplitType==1&&this.LimitPrice&&(e<this.LimitPrice.Max&&(e=this.LimitPrice.Max),a>this.LimitPrice.Min&&(a=this.LimitPrice.Min)),v.IsNumber(this.High)&&v.IsNumber(this.Low)&&(e<this.High&&(e=this.High),a>this.Low&&(a=this.Low));var f={Max:null,Min:null};this.IsAfterData&&this.AfterCloseData&&this.GetCallAuctionMaxMin(this.AfterCloseData,f),this.IsBeforeData&&this.BeforeOpenData&&this.GetCallAuctionMaxMin(this.BeforeOpenData,f);var C=this.GetMultiDayBeforeOpenData();if(C&&this.ChartBorder.MultiDayMinute.Count>1&&this.ChartBorder.MultiDayMinute.Left>0)for(var o=0;o<C.length;++o){var D=C[o];this.GetCallAuctionMaxMin(D,f)}var c=this.GetMultiDayAfterCloseData();if(c&&this.ChartBorder.MultiDayMinute.Count>1&&this.ChartBorder.MultiDayMinute.Right>0)for(var o=0;o<c.length;++o){var D=c[o];this.GetCallAuctionMaxMin(D,f)}v.IsNumber(f.Max)&&e<f.Max&&(e=f.Max),v.IsNumber(f.Min)&&a>f.Min&&(a=f.Min);var T=this.GetOverlayMaxMin();return T&&(v.IsNumber(T.Max)&&T.Max>e&&(e=T.Max),v.IsNumber(T.Min)&&T.Min<a&&(a=T.Min)),{Max:e,Min:a}},this.GetOverlayMaxMin=function(){if(!this.HQChart||!this.HQChart.Frame||!this.HQChart.Frame.SubFrame)return null;var e=this.HQChart.Frame.SubFrame[0];if(!e||!v.IsNonEmptyArray(e.OverlayIndex))return null;for(var a={Max:null,Min:null},r=0;r<e.OverlayIndex.length;++r){var t=e.OverlayIndex[r];if(!(!t||!t.Frame)){var n=t.Frame;if(n.IsShareY==!0&&n.IsCalculateYMaxMin!==!1)for(var s=0;s<t.ChartPaint.length;++s){var o=t.ChartPaint[s];if(o.IsShow!=!1){var l=o.GetMaxMin();l==null||l.Max==null||l.Min==null||((a.Max==null||a.Max<l.Max)&&(a.Max=l.Max),(a.Min==null||a.Min>l.Min)&&(a.Min=l.Min))}}}}return a},this.USASplit=function(e){var a=e.Max,r=e.Min;if(a==r)a=a+a*.1,r=r-r*.1;else{var t=B(),n=this.Frame.ChartBorder.GetHeight(),s=5*t*(a-r)/n;a+=s,r-=s,r<0&&(r=e.Min)}var o=this.SplitCount,l=(a-r)/(o-1),h=[1,.1,.01,.001,1e-4],u=jt(this.Symbol);l<h[u]&&(l=h[u],a=r+l*o);for(var f=0;f<o;++f){var C=r+l*f;if(!(this.YClose&&C==this.YClose)){var D=new Ut;D.Value=C;var c=C.toFixed(u);if(this.IsShowLeftText&&(D.Message[0]=c),this.YClose&&this.YClose!=0){var T=(C/this.YClose-1)*100;T>0?D.TextColor=d.UpTextColor:T<0&&(D.TextColor=d.DownTextColor),this.IsShowRightText&&(this.RightTextFormat==1?D.Message[1]=c:D.Message[1]=v.FormatValueString(T,2)+"%")}this.Frame.HorizontalInfo.push(D)}}if(this.YClose>r&&this.YClose<a){var D=new Ut;D.Value=this.YClose,D.LineType=2,d.FrameDotSplitPen&&(D.LineColor=d.FrameDotSplitPen);var c=this.YClose.toFixed(u);this.IsShowLeftText&&(D.Message[0]=c),this.IsShowRightText&&(this.RightTextFormat==1?D.Message[1]=c:D.Message[1]="0.00%"),this.Frame.HorizontalInfo.push(D)}this.Frame.HorizontalInfo.sort(function(S,I){return S.Value-I.Value}),this.Frame.HorizontalMax=a,this.Frame.HorizontalMin=r},this.DefaultSplit=function(e){var a=e.Max,r=e.Min;if(this.YClose==a&&this.YClose==r)a=this.YClose+this.YClose*.1,r=this.YClose-this.YClose*.1;else{var t=Math.max(Math.abs(this.YClose-a),Math.abs(this.YClose-r));a=this.YClose+t,r=this.YClose-t,r<0&&(r=e.Min)}var n=B(),s=this.Frame.ChartBorder.GetChartWidth(),o=s<450*n;k.Chart.Log("[FrameSplitMinutePriceY]max="+a+" min="+r+" isPhoneModel="+o);var l=this.SplitCount,h=(a-r)/(l-1),u=[1,.1,.01,.001,1e-4],f=jt(this.Symbol);o&&U.IsSHSZIndex(this.Symbol)&&(f=0),h<u[f]&&(h=u[f],a=this.YClose+h*(l-1)/2,r=this.YClose-h*(l-1)/2);for(var C=0;C<l;++C){var D=r+h*C,c=new Ut;this.Frame.HorizontalInfo[C]=c,c.Value=D;var T=D.toFixed(f);if(this.IsShowLeftText&&(c.Message[0]=T),v.IsNumber(this.YClose)&&this.YClose!=0){var S=(D/this.YClose-1)*100;S>0?c.TextColor=d.UpTextColor:S<0&&(c.TextColor=d.DownTextColor),this.IsShowRightText&&(this.RightTextFormat==1?c.Message[1]=T:c.Message[1]=v.FormatValueString(S,2)+"%"),Math.abs(D-this.YClose)<1e-11&&(c.LineType=2,c.TextColor=d.UnchagneTextColor,d.FrameDotSplitPen&&(c.LineColor=d.FrameDotSplitPen))}}this.Frame.HorizontalMax=a,this.Frame.HorizontalMin=r}}function Ch(){this.newMethod=v,this.newMethod(),delete this.newMethod,this.ShowText=!0,this.Symbol=null,this.DayCount=1,this.DateFormat=0,this.Operator=function(){this.Frame.VerticalInfo=[],this.Frame.XPointCount;var e=this.Frame.ChartBorder.GetWidth(),a=this.Frame.IsHScreen===!0;a&&(e=this.Frame.ChartBorder.GetHeight()),e=e/B();var r=vl,t=r.GetCoordinateData(this.Symbol,e),n=t.Count,s=t.MiddleCount>0?t.MiddleCount:parseInt(n/2),o=t.Data;if(this.Frame.XPointCount=n*this.DayCount,this.Frame.MinuteCount=n,this.Frame.VerticalInfo=[],this.Frame.GlobalOption){var l=this.Frame.GlobalOption;v.IsNumber(l.XDateFormat)&&(this.DateFormat=l.XDateFormat)}if(this.DayCount<=1){this.DayOffset.DataOffset=0,this.DayOffset.ShowDataCount=n,this.DayOffset.PageInfo=null;for(var h=0;h<o.length;++h){var u=new Ut,l=o[h];d.Minute.FrameSplitTextColor&&(u.TextColor=d.Minute.FrameSplitTextColor),u.Value=l[0],this.ShowText&&(u.Message[0]=l[3]),l[4]&&(u.LineColor=l[4]),l[5]&&(u.TextBGColor=l[5]),this.Frame.VerticalInfo[h]=u}}else{var f=0,C=this.DayData.length;this.DayOffset&&(v.IsNumber(this.DayOffset.Offset)&&(f=this.DayOffset.Offset),v.IsNumber(this.DayOffset.ShowDayCount)&&(C=this.DayOffset.ShowDayCount)),this.DayOffset.DataOffset=f*n,this.DayOffset.ShowDataCount=this.DayOffset.ShowDayCount*n,this.DayOffset.PageInfo={Day:[]};for(var h=this.DayData.length-1-f,D=0;h>=0&&D<C;--h,++D){var u=new Ut;u.Value=D*n+s,u.LineType=-1,this.ShowText&&(u.Message[0]=this.FormatDate(this.DayData[h].Date),u.BG={Index:{Start:D*n+1,End:(D+1)*n-1},Date:this.DayData[h].Date}),this.Frame.VerticalInfo.push(u);var u=new Ut;u.Value=(D+1)*n,this.Frame.VerticalInfo.push(u),this.DayOffset.PageInfo.Day.push({Date:this.DayData[h].Date,Index:h})}}if(this.GetEventCallback){var c=this.GetEventCallback($.ON_SPLIT_XCOORDINATE);if(c&&c.Callback){var T={ID:this.Frame.Identify,Frame:this.Frame};c.Callback(c,T,this)}}},this.FormatDate=function(e){switch(this.DateFormat){case 1:return v.FormatDateString(e,"MM/DD");case 2:return v.FormatDateString(e,"MM/DD/W");default:return v.FormatDateString(e,"MM-DD")}}}function CI(){this.newMethod=v,this.newMethod(),delete this.newMethod,this.ShowText=!0,this.SplitCount=3,this.Symbol,this.LineType=3,this.Operator=function(){var e=this.Frame.VerticalRange;if(e){this.Frame.VerticalInfo=[];var a=2;this.Symbol&&(a=jt(this.Symbol));var r=e.Max,t=e.Min;if(e.Bid)for(var n=(e.Bid.Max-t)/this.SplitCount,s=0;s<this.SplitCount;++s){var o=new Ut;o.Value=t+n*s,!(o.Value<=0)&&(v.IsNumber(this.LineType)&&(o.LineType=this.LineType),this.ShowText&&(o.Message[0]=o.Value.toFixed(a)),this.Frame.VerticalInfo.push(o))}var o=new Ut;if(o.Value=e.Center,this.Frame.VerticalInfo.push(o),e.Ask)for(var n=(r-e.Ask.Min)/this.SplitCount,s=1;s<=this.SplitCount;++s){var o=new Ut;o.Value=e.Ask.Min+n*s,v.IsNumber(this.LineType)&&(o.LineType=this.LineType),this.ShowText&&(o.Message[0]=o.Value.toFixed(a)),this.Frame.VerticalInfo.push(o)}if(this.GetEventCallback){var l=this.GetEventCallback($.ON_SPLIT_XCOORDINATE);if(l&&l.Callback){var h={ID:this.Frame.Identify,Frame:this.Frame};l.Callback(l,h,this)}}}}}function Dh(){this.Frame,this.Value,this.Point,this.ClientPos,this.BeforOpeneData,this.AfterCloseData,this.X,this.Item,this.DataIndex,this.DayIndex,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.DayOffset,this.Operator=function(){return this.Item=null,this.DataIndex=null,this.DayIndex=null,this.ClientPos==2?this.GetBeforeOpenXIndex():this.ClientPos==3?this.GetAfterCloseXIndex():this.ClientPos>=200&&this.ClientPos<=299?this.GetMultiDayBeforeOpenXIndex():this.ClientPos>=300&&this.ClientPos<=399?this.GetMultiDayAfterCloseXIndex():!1},this.GetBeforeOpenXIndex=function(){if(!v.IsNumber(this.Value)||!this.BeforeOpenData||!this.BeforeOpenData.Data)return!1;var e=this.Frame.GetLeftExtendXData(this.Value,this.BeforeOpenData);if(e=parseInt(e.toFixed(0)),e>=0&&e<this.BeforeOpenData.Data.length){var a=this.BeforeOpenData.Data[e];if(v.IsNumber(a.Price))return this.Item=a,this.X=this.Value,this.DataIndex=e,!0}e<0?e=0:e>=this.BeforeOpenData.Data.length&&(e=this.BeforeOpenData.Data.length-1);for(var r=-1,t=e;t>=0;--t){var a=this.BeforeOpenData.Data[t];if(v.IsNumber(a.Price)){r=t;break}}if(r<0)for(var t=e+1;t<this.BeforeOpenData.Data.length;++t){var a=this.BeforeOpenData.Data[t];if(v.IsNumber(a.Price)){r=t;break}}return r<0?!1:(this.Item=a,this.DataIndex=r,this.X=this.Frame.GetLeftExtendXFromIndex(r,this.BeforeOpenData),!0)},this.GetMultiDayBeforeOpenData=function(){if(!this.MultiDayBeforeOpenData||!v.IsNonEmptyArray(this.MultiDayBeforeOpenData)||(this.DayOffset||this.MultiDayBeforeOpenData,!v.IsNumber(this.DayOffset.Offset)||!v.IsNumber(this.DayOffset.ShowDayCount)))return null;var e=this.DayOffset.ShowDayCount,a=this.DayOffset.Offset,r=this.MultiDayBeforeOpenData.slice(a,a+e);return r},this.GetMultiDayBeforeOpenXIndex=function(){var e=this.GetMultiDayBeforeOpenData();if(!e||!v.IsNonEmptyArray(e))return!1;var n=this.ClientPos-200;if(n<0||n>=e.length)return!1;var a=e[n],r=this.Frame.GetLeftExtendXData(this.Value,e);if(!r||!v.IsNumber(r.DataIndex))return!1;var t=parseInt(r.DataIndex.toFixed(0)),n=r.DayIndex;if(t>=0&&t<a.Data.length){var s=a.Data[t];if(v.IsNumber(s.Price))return this.Item=s,this.X=this.Value,this.DataIndex=t,this.DayIndex=n,!0}t<0?t=0:t>=a.Data.length&&(t=a.Data.length-1);for(var o=-1,l=t;l>=0;--l){var s=a.Data[l];if(s&&v.IsNumber(s.Price)){o=l;break}}return o<0?!1:(this.Item=s,this.DataIndex=o,this.DayIndex=n,this.X=this.Frame.GetLeftExtendXFromIndex(o,a),!0)},this.GetAfterCloseXIndex=function(){if(!v.IsNumber(this.Value)||!this.AfterCloseData||!this.AfterCloseData.Data)return!1;var e=this.Frame.GetRightExtendXData(this.Value,this.AfterCloseData);if(e=parseInt(e.toFixed(0)),e>=0&&e<this.AfterCloseData.Data.length){var a=this.AfterCloseData.Data[e];if(v.IsNumber(a.Price))return this.Item=a,this.X=this.Value,this.DataIndex=e,!0}e<0?e=0:e>=this.AfterCloseData.Data.length&&(e=this.AfterCloseData.Data.length-1);for(var r=-1,t=e;t>=0;--t){var a=this.AfterCloseData.Data[t];if(v.IsNumber(a.Price)){r=t;break}}if(r<0)for(var t=e+1;t<this.AfterCloseData.Data.length;++t){var a=this.AfterCloseData.Data[t];if(v.IsNumber(a.Price)){r=t;break}}return r<0?!1:(this.Item=a,this.DataIndex=r,this.X=this.Frame.GetRightExtendXFromIndex(r,this.AfterCloseData),!0)},this.GetMultiDayAfterCloseData=function(){if(!this.MultiDayAfterCloseData||!v.IsNonEmptyArray(this.MultiDayAfterCloseData)||(this.DayOffset||this.MultiDayAfterCloseData,!v.IsNumber(this.DayOffset.Offset)||!v.IsNumber(this.DayOffset.ShowDayCount)))return null;var e=this.DayOffset.ShowDayCount,a=this.DayOffset.Offset,r=this.MultiDayAfterCloseData.slice(a,a+e);return r},this.GetMultiDayAfterCloseXIndex=function(){var e=this.GetMultiDayAfterCloseData();if(!(!e||!v.IsNonEmptyArray(e))){var n=this.ClientPos-300;if(!(n<0||n>=e.length)){var a=e[n],r=this.Frame.GetRightExtendXData(this.Value,e);if(r){var t=parseInt(r.DataIndex.toFixed(0)),n=r.DayIndex;if(t>=0&&t<a.Data.length){var s=a.Data[t];if(v.IsNumber(s.Price))return this.Item=s,this.X=this.Value,this.DataIndex=t,this.DayIndex=n,!0}t<0?t=0:t>=a.Data.length&&(t=a.Data.length-1);for(var o=-1,l=t;l>=0;--l){var s=a.Data[l];if(s&&v.IsNumber(s.Price)){o=l;break}}return o<0?!1:(this.Item=s,this.DataIndex=o,this.DayIndex=n,this.X=this.Frame.GetRightExtendXFromIndex(o,a),!0)}}}}}function Bn(){this.ClassName="ChartCorssCursor",this.Frame,this.Canvas,this.HPenColor=d.CorssCursorHPenColor,this.HPenType=0,this.VPenColor=d.CorssCursorVPenColor,this.VPenType=0,this.VLineType=0,this.Font=d.CorssCursorTextFont,this.TextColor=d.CorssCursorTextColor,this.TextBGColor=d.CorssCursorBGColor,this.BorderColor=d.CorssCursorBorderColor,this.XRangeBGColor=d.CorssCursorXRangeBGColor,this.TextHeight=20,this.LastPoint,this.LastValue,this.CursorIndex,this.IsOnlyDrawKLine=!1,this.IsOnlyDrawMinute=!1,this.IsFixXLastTime=!1,this.IsDrawXRangeBG=!1,this.EnableNewIndex=!1,this.CorssCursorIndex,this.PointX,this.PointY,this.StringFormatX,this.StringFormatY,this.ShowTextMode={Left:1,Right:1,Bottom:1},this.TextFormat={Right:0},this.IsShowCorss=!0,this.IsShow=!0,this.IsShowClose=!1,this.ClientPos=-1,this.CallAcutionXOperator,this.EnableKeyboard=!1,this.OnChangeStatusCallback,this.RightButton={Enable:!1,Rect:null,BGColor:d.CorssCursor.RightButton.BGColor,PenColor:d.CorssCursor.RightButton.PenColor,Icon:d.CorssCursor.RightButton.Icon},this.RightMargin={Left:2,Right:2,Top:4,Bottom:3},wa(this.RightMargin,d.CorssCursor.RightMargin),this.Close=null,this.Status=0,this.ReloadResource=function(e){this.Font=d.CorssCursorTextFont,this.HPenColor=d.CorssCursorHPenColor,this.VPenColor=d.CorssCursorVPenColor,this.TextColor=d.CorssCursorTextColor,this.TextBGColor=d.CorssCursorBGColor,this.BorderColor=d.CorssCursorBorderColor,this.XRangeBGColor=d.CorssCursorXRangeBGColor},this.GetCloseYPoint=function(e){if(!this.StringFormatX.Data)return null;var a=this.StringFormatX.Data;if(!a.Data||a.Data.length<=0)return null;var r=a.DataOffset+e;if(r>=a.Data.length&&(r=a.Data.length-1),r<0)return null;var t=a.Data[r];if(!t)return null;this.Close=t.Close;var n=this.Frame.GetYFromData(this.Close);return n},this.GetMinuteCloseYPoint=function(e){if(this.EnableNewIndex&&this.CorssCursorIndex){if(!this.StringFormatX||!this.StringFormatX.GetMinuteCloseYPoint)return null;var a=this.StringFormatX.GetMinuteCloseYPoint(this.CorssCursorIndex);return a?(this.Close=a.Price,a.Y):null}else{if(!v.IsNumber(e)||(e=parseInt(e),!this.StringFormatX.Data))return null;var r=this.StringFormatX.Data;if(!r.Data||r.Data.length<=0)return null;var t=r.DataOffset+e;if(t>=r.Data.length&&(t=r.Data.length-1),t<0)return null;var n=r.Data[t];if(!v.IsNumber(e))return null;this.Close=n;var s=this.Frame.GetYFromData(this.Close);return s}},this.GetDateTimeRange=function(e,a){if(!v.IsNumber(e))return null;e=parseInt(e);var r=this.StringFormatX.Data;if(!r.Data||r.Data.length<=0)return null;var t=r.DataOffset+e;if(t>=r.Data.length||t<0||!this.Frame||!this.Frame.SubFrame[0]||!this.Frame.SubFrame[0].Frame)return null;var n=this.Frame.SubFrame[0].Frame,s=n.DataWidth,o=n.DistanceWidth,l=n.XPointCount,h=r.Data[t];if(!h)return null;for(var u=h.Date*1e6,f=parseInt(h.Time/100)*100,C=u+f,D=u+f+59,c=t,T=t;T<r.Data.length;++T){var S=r.Data[T],I=S.Date*1e6+S.Time;if(I>D||T-r.DataOffset>=l)break;c=T}for(var g=t,T=t;T>=0&&T>=r.DataOffset;--T){var S=r.Data[T],I=S.Date*1e6+S.Time;if(I<C)break;g=T}var E={StartIndex:g,EndIndex:c};return E.XStart=this.Frame.GetXFromIndex(g-r.DataOffset),E.XEnd=this.Frame.GetXFromIndex(c-r.DataOffset),E.XStart-=(o+s)/2,E.XEnd+=(o+s)/2,E},this.FixMinuteLastTimeXPoint=function(e){if(!v.IsNumber(e)||(e=parseInt(e),!this.StringFormatX.Data))return null;var a=this.StringFormatX.Data;if(!a.Data||a.Data.length<=0)return null;var r=a.DataOffset+e;if(r<a.Data.length)return null;r=a.Data.length-1,r-=a.DataOffset;var t=this.Frame.GetXFromIndex(r);return{X:t,Index:r}},this.PtInClient=function(e,a){if(this.Canvas.beginPath(),this.Frame.IsHScreen===!0){var r=this.Frame.ChartBorder.GetHScreenBorder();this.Canvas.rect(r.Left,r.TopEx,r.Right-r.Left,r.BottomEx-r.TopEx)}else{var r=this.Frame.ChartBorder.GetBorder();this.Canvas.rect(r.LeftEx,r.Top,r.RightEx-r.LeftEx,r.Bottom-r.Top)}return this.Canvas.isPointInPath(e,a)?1:this.Frame.ChartBorder.LeftExtendWidth>10&&(this.Canvas.beginPath(),this.Frame.IsHScreen===!0?this.Canvas.rect(r.Left,r.Top,r.Right-r.Left,r.TopEx-r.Top):this.Canvas.rect(r.Left,r.Top,r.LeftEx-r.Left,r.Bottom-r.Top),this.Canvas.isPointInPath(e,a))?2:this.Frame.ChartBorder.RightExtendWidth>10&&(this.Canvas.beginPath(),this.Frame.IsHScreen===!0?this.Canvas.rect(r.Left,r.BottomEx,r.Right-r.Left,r.Bottom-r.BottomEx):this.Canvas.rect(r.RightEx,r.Top,r.Right-r.RightEx,r.Bottom-r.Top),this.Canvas.isPointInPath(e,a))?3:-1},this.GetFontHeight=function(e){return Ea(this.Canvas,e,"擎")},this.Draw=function(){if(this.Status=0,this.RightButton.Rect=null,this.LastValue=null,!!this.LastPoint){this.Close=null;var e=this.LastPoint.X,a=this.LastPoint.Y,r=this.PtInClient(e,a);if(this.PointY=null,this.PointY==null,this.ClientPos=r,!(r<=0)){if(this.Frame.IsHScreen===!0){this.HScreenDraw();return}var t=this.Frame.ChartBorder.GetBorder(),n=t.Left,s=t.Right,o=t.TopTitle,l=t.Bottom,h=this.Frame.ChartBorder.Right,u=t.ChartWidth;if(this.IsOnlyDrawKLine){if(e=this.Frame.GetXFromIndex(this.CursorIndex),this.IsShowClose){var f=this.GetCloseYPoint(this.CursorIndex);f!=null&&(a=f)}}else if(this.IsOnlyDrawMinute){var f=this.GetMinuteCloseYPoint(this.CursorIndex);f!=null&&(a=f)}if(this.CallAcutionXOperator&&(this.CallAcutionXOperator.Value=e,this.CallAcutionXOperator.Point={X:e,Y:a},this.CallAcutionXOperator.ClientPos=r,this.CallAcutionXOperator.Operator()&&(e=this.CallAcutionXOperator.X)),this.IsFixXLastTime){var C=this.FixMinuteLastTimeXPoint(this.CursorIndex);C&&(e=C.X,this.CursorIndex=C.Index)}if(this.PointY=[[n,a],[s,a]],this.PointX=[[e,o],[e,l]],this.IsShowCorss){var D=null;this.IsDrawXRangeBG&&(D=this.GetDateTimeRange(this.CursorIndex));var c=B();if((this.HPenType==1||this.HPenType==0)&&(this.Canvas.strokeStyle=this.HPenColor,this.HPenType==0&&this.Canvas.setLineDash([3*c,2*c]),this.Canvas.beginPath(),this.Canvas.moveTo(n,L(a)),this.Canvas.lineTo(s,L(a)),this.Canvas.stroke(),this.HPenType==0&&this.Canvas.setLineDash([])),this.Canvas.save(),this.Canvas.strokeStyle=this.VPenColor,this.VPenType==0)this.Canvas.setLineDash([3*c,2*c]);else if(this.VPenType==2){var T=this.Frame.SubFrame[0].Frame.DataWidth;T>2*c&&(this.Canvas.lineWidth=T)}if(this.Canvas.beginPath(),this.VLineType==1)D&&(this.Canvas.fillStyle=this.XRangeBGColor,this.Canvas.fillRect(D.XStart,t.Top,D.XEnd-D.XStart,t.Bottom-t.Top)),this.Canvas.moveTo(L(e),t.Top),this.Canvas.lineTo(L(e),t.Bottom);else if(this.Frame.SubFrame.length>0)for(var S in this.Frame.SubFrame){var I=this.Frame.SubFrame[S].Frame,g=I.ChartBorder.GetBorder();o=g.TopTitle,l=g.Bottom,D&&(this.Canvas.fillStyle=this.XRangeBGColor,this.Canvas.fillRect(D.XStart,o,D.XEnd-D.XStart,l-o)),this.Canvas.moveTo(L(e),o),this.Canvas.lineTo(L(e),l)}else this.Canvas.moveTo(L(e),o),this.Canvas.lineTo(L(e),l);this.Canvas.stroke(),this.Canvas.restore()}this.Frame.GetXData(e);var E={},F=this.Frame.GetYData(a,E);(this.IsOnlyDrawMinute||this.IsShowClose)&&this.Close!=null&&(F=this.Close),this.LastValue={Y:{Value:F,Extend:E}},this.StringFormatX.Value=this.CursorIndex,this.StringFormatX.Point={X:e,Y:a},this.StringFormatX.ClientPos=r,this.StringFormatY.Value=F,this.StringFormatY.RValue=E.RightYValue,this.StringFormatY.FrameID=E.FrameID,this.StringFormatY.Point={X:e,Y:a},this.StringFormatY.ClientPos=r,this.Canvas.font=this.Font;var R=this.GetFontHeight();if(R>this.TextHeight&&(this.TextHeight=R),(this.ShowTextMode.Left==1&&this.Frame.ChartBorder.Left>=30||this.ShowTextMode.Left==2||this.ShowTextMode.Right==1&&this.Frame.ChartBorder.Right>=30||this.ShowTextMode.Right==2)&&this.StringFormatY.Operator()){var A=this.StringFormatY.Text;this.Canvas.font=this.Font;var P=this.Canvas.measureText(A).width+4,p={Width:P,Height:this.TextHeight,Text:[]},w={Y:a,YValue:F,FrameID:E.FrameID};this.Frame.ChartBorder.Left>=30&&this.ShowTextMode.Left==1?n<P?(this.DrawTextBGRect(L(2),L(a-this.TextHeight/2),b(P),b(this.TextHeight)),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(A,2+2,a,P)):(this.DrawTextBGRect(n-2,a-this.TextHeight/2,-P,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(A,n-4,a,P)):this.ShowTextMode.Left==2&&(this.DrawTextBGRect(n,a-this.TextHeight/2,P,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(A,n+2,a,P));var H={ShowType:0,Font:this.Font,Color:this.TextColor,Text:[{Text:A,Margin:this.RightMargin}]},W=a-this.TextHeight/2;if(this.StringFormatY.PercentageText&&this.TextFormat.Right==0&&(A=this.StringFormatY.PercentageText+"%",H.Text[0].Text=A),this.StringFormatY.RText&&(A=this.StringFormatY.RText,H.Text[0].Text=A),this.StringFormatY.RComplexText&&v.IsNonEmptyArray(this.StringFormatY.RComplexText.Text)&&(H=this.StringFormatY.RComplexText,H.Font||(H.Font=this.Font),H.Color||(H.Color=this.TextColor)),this.CalculateComplexTextSize(H,p),this.Frame.ChartBorder.Right>=30&&this.ShowTextMode.Right==1){var ht=!1,rt=null;if(E.FrameID>=0){var I=this.Frame.SubFrame[E.FrameID];if(ht=I.OverlayIndex.length>0,rt=null,ht)for(var S=0;S<=I.OverlayIndex.length;++S){var nt=I.OverlayIndex[S];if(!(!nt||!nt.Frame)&&nt.Frame.IsShow!==!1&&nt.Frame.GetXHorizontal){var vt=nt.Frame.GetXHorizontal();rt=vt-s;break}}}if(ht&&p.Width>rt&&rt>0){var Nt=s+rt;Nt>u&&(Nt=u);var Ft=Nt-2-p.Width;this.DrawTextBGRect(Ft,W,p.Width,p.Height),this.DrawComplexTextV2(Ft,W,H,p),this.RightButton.Enable&&this.DrawRightButton(W,Ft,this.TextHeight,this.TextHeight,w)}else if(h<p.Width){var Ft=u-2-p.Width;this.DrawTextBGRect(Ft,W,p.Width,p.Height),this.DrawComplexTextV2(Ft,W,H,p),this.RightButton.Enable&&this.DrawRightButton(W,u-2-p.Width,this.TextHeight,this.TextHeight,w)}else{var Ft=s+2;this.DrawTextBGRect(Ft,W,p.Width,p.Height),this.DrawComplexTextV2(Ft,W,H,p),this.RightButton.Enable&&this.DrawRightButton(W,s+2,this.TextHeight,this.TextHeight,w)}}else if(this.ShowTextMode.Right==2){this.Canvas.fillStyle=this.TextBGColor;var Bt=s-p.Width;this.DrawTextBGRect(Bt,W,p.Width,p.Height),this.DrawComplexTextV2(Bt,W,H,p),this.RightButton.Enable&&this.DrawRightButton(W,Bt,this.TextHeight,this.TextHeight,w)}}if((this.ShowTextMode.Bottom==1||this.ShowTextMode.Bottom==2||this.ShowTextMode.Bottom==8)&&this.StringFormatX.Operator()){var A=this.StringFormatX.Text;this.Canvas.font=this.Font,this.Canvas.fillStyle=this.TextBGColor;var P=this.Canvas.measureText(A).width+4,Jt=l+2+this.TextHeight/2,W=l+2,te=!0;if(this.ShowTextMode.Bottom==2)Jt=l-this.TextHeight/2-2,W=l-this.TextHeight-2;else if(this.ShowTextMode.Bottom==8){var Me=this.GetEventCallback($.ON_CUSTOM_CORSSCURSOR_POSITION);if(Me&&Me.Callback){var we={YCenter:Jt,YTop:W,Height:this.TextHeight,IsShowText:te};Me.Callback(Me,we,this),Jt=we.YCenter,W=we.YTop,te=we.IsShowText}}te&&(e-P/2<3?(this.DrawTextBGRect(e-1,W,P,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(A,e+1,Jt,P)):e+P/2>=s?(this.DrawTextBGRect(s-P,W,P,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(A,s-2,Jt,P)):(this.DrawTextBGRect(e-P/2,W,P,this.TextHeight),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(A,e,Jt,P)))}if(E.FrameID>=0){var I=this.Frame.SubFrame[E.FrameID],vt=s;this.Canvas.font=this.Font;for(var S=0;S<I.OverlayIndex.length;++S){var nt=I.OverlayIndex[S];if(nt.Frame.IsShow!==!1&&nt.Frame.GetXHorizontal){vt=nt.Frame.GetXHorizontal();var F=nt.Frame.GetYData(a),A=v.FormatValueString(F,2),P=this.Canvas.measureText(A).width+4;this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(vt+1,a-this.TextHeight/2,P,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(A,vt+4,a,P)}}}this.Status=1}}},this.DrawComplexTextV2=function(e,a,r,t){this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var n=0;if(r.ShowType==1&&(n=r.ShowType),n==1)for(var s=e,o=a,l=0;l<r.Text.length;++l){var h=r.Text[l],u=t.Text[l];h.Font?this.Canvas.font=h.Font:this.Canvas.font=r.Font,h.Color?this.Canvas.fillStyle=h.Color:this.Canvas.fillStyle=r.Color;var f=o+u.Height,C=s;if(h.Margin){var D=h.Margin;v.IsNumber(D.Bottom)&&(f-=D.Bottom),v.IsNumber(D.Left)&&(C+=D.Left)}this.Canvas.fillText(h.Text,C,f,u.Width),o+=u.Height}else for(var c=e,T=a+t.Height,l=0;l<r.Text.length;++l){var h=r.Text[l],u=t.Text[l];h.Font?this.Canvas.font=h.Font:this.Canvas.font=r.Font,h.Color?this.Canvas.fillStyle=h.Color:this.Canvas.fillStyle=r.Color;var f=T,C=c;if(h.Margin){var D=h.Margin;v.IsNumber(D.Bottom)&&(f-=D.Bottom),v.IsNumber(D.Left)&&(C+=D.Left)}this.Canvas.fillText(h.Text,C,f,u.Width),c+=u.Width}},this.CalculateComplexTextSize=function(e,a){if(!(!e||!v.IsNonEmptyArray(e.Text))){var r=0;if(e.ShowType==1&&(r=e.ShowType),r==1){for(var t=0,n=0,s=0;s<e.Text.length;++s){var o=e.Text[s];o.Font?this.Canvas.font=o.Font:this.Canvas.font=e.Font;var l=this.Canvas.measureText(o.Text).width,h=this.Canvas.measureText("擎").width;if(o.Margin){var u=o.Margin;v.IsNumber(u.Left)&&(l+=u.Left),v.IsNumber(u.Right)&&(l+=u.Right),v.IsNumber(u.Top)&&(h+=u.Top),v.IsNumber(u.Bottom)&&(h+=u.Bottom)}a.Text[s]={Width:l,Height:h},t<l&&(t=l),n+=h}a.Width=t,a.Height=n}else{for(var t=0,n=0,s=0;s<e.Text.length;++s){var o=e.Text[s];o.Font?this.Canvas.font=o.Font:this.Canvas.font=e.Font;var l=this.Canvas.measureText(o.Text).width,h=this.Canvas.measureText("擎").width;if(o.Margin){var u=o.Margin;v.IsNumber(u.Left)&&(l+=u.Left),v.IsNumber(u.Right)&&(l+=u.Right),v.IsNumber(u.Top)&&(h+=u.Top),v.IsNumber(u.Bottom)&&(h+=u.Bottom)}a.Text[s]={Width:l,Height:h},t+=l,n<h&&(n=h)}a.Width=t,a.Height=n}}},this.DrawRightButton=function(e,a,r,t,n){this.Canvas.fillStyle=this.RightButton.BGColor;var s={Left:a-r,Top:e,Width:r,Height:t};s.Right=s.Left+s.Width,s.Bottom=s.Top+s.Height,this.RightButton.Rect=s,this.RightButton.Data=n,this.Canvas.fillRect(L(s.Left+1),L(s.Top),b(s.Width),b(s.Height));var o=B(),l=3,h=s.Top+l+(s.Height-l*2)/2,u=s.Left+l+(s.Width-l*2)/2;if(this.RightButton.Icon){var f=this.RightButton.Icon;this.Canvas.font=f.Size*o+"px "+f.Family,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=f.Color,this.Canvas.fillText("",u,h)}else{this.Canvas.strokeStyle=this.RightButton.PenColor;var C=rtButtom.Left+l,D=rtButtom.Top+l;this.Canvas.save(),this.Canvas.linewidth=1*o,this.Canvas.beginPath(),this.Canvas.moveTo(L(C),L(h)),this.Canvas.lineTo(L(C+s.Width-l*2),L(h)),this.Canvas.moveTo(L(u),L(D)),this.Canvas.lineTo(L(u),L(D+s.Height-l*2)),this.Canvas.stroke(),this.Canvas.restore()}},this.PtInButton=function(e,a){if(!this.RightButton.Enable||!this.RightButton.Rect)return null;var r=this.RightButton.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(r.Left,r.Top,r.Width,r.Height),this.Canvas.isPointInPath(e,a))return{Data:this.RightButton.Data,Rect:r}},this.DrawTextBGRect=function(e,a,r,t){this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(L(e),L(a),b(r),b(t)),this.BorderColor&&(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(L(e),L(a),b(r),b(t)))},this.HScreenDraw=function(){var e=this.LastPoint.X,a=this.LastPoint.Y;if(this.IsOnlyDrawKLine){if(a=this.Frame.GetXFromIndex(this.CursorIndex),this.IsShowClose){var r=this.GetCloseYPoint(this.CursorIndex);r!=null&&(e=r)}}else if(this.IsOnlyDrawMinute){var r=this.GetMinuteCloseYPoint(this.CursorIndex);r!=null&&(e=r)}var t=this.Frame.ChartBorder.GetHScreenBorder(),n=t.Left,s=t.Right,o=t.Top,l=t.Bottom,h=this.Frame.ChartBorder.Bottom;if(this.CallAcutionXOperator&&(this.CallAcutionXOperator.Value=a,this.CallAcutionXOperator.Point={X:e,Y:a},this.CallAcutionXOperator.ClientPos=this.ClientPos,this.CallAcutionXOperator.Operator()&&(a=this.CallAcutionXOperator.X)),this.PointY=[[n,a],[s,a]],this.PointX=[[e,o],[e,l]],this.IsShowCorss){var u=B();if(this.Canvas.save(),this.Canvas.strokeStyle=this.HPenColor,this.HPenType==0&&this.Canvas.setLineDash([3*u,2*u]),this.Canvas.beginPath(),this.Canvas.moveTo(L(e),o),this.Canvas.lineTo(L(e),l),this.Canvas.stroke(),this.Canvas.restore(),this.Canvas.save(),this.Canvas.strokeStyle=this.VPenColor,this.VPenType==0)this.Canvas.setLineDash([3*u,2*u]);else if(this.VPenType==2){var f=this.Frame.SubFrame[0].Frame.DataWidth;f>2*u&&(this.Canvas.lineWidth=f)}if(this.Canvas.beginPath(),this.VLineType==1)this.Canvas.moveTo(n,L(a)),this.Canvas.lineTo(s,L(a));else if(this.Frame.SubFrame.length>0)for(var C in this.Frame.SubFrame){var D=this.Frame.SubFrame[C].Frame,c=D.ChartBorder.GetHScreenBorder();this.Canvas.moveTo(c.Left,L(a)),this.Canvas.lineTo(c.RightEx,L(a))}else this.Canvas.moveTo(n,L(a)),this.Canvas.lineTo(s,L(a));this.Canvas.stroke(),this.Canvas.restore()}var T=this.Frame.GetXData(a),S={},I=this.Frame.GetYData(e,S);this.StringFormatX.Value=T,this.StringFormatX.Point={X:e,Y:a},this.StringFormatX.ClientPos=this.ClientPos,this.StringFormatY.Value=I,this.StringFormatY.FrameID=S.FrameID,this.StringFormatY.RValue=S.RightYValue,this.StringFormatY.Point={X:e,Y:a},this.StringFormatY.ClientPos=this.ClientPos,this.Canvas.font=this.Font;var g=this.GetFontHeight();if(g>this.TextHeight&&(this.TextHeight=g),(this.ShowTextMode.Left==1&&this.Frame.ChartBorder.Top>=30||this.ShowTextMode.Left==2||this.ShowTextMode.Right==1&&this.Frame.ChartBorder.Bottom>=30||this.ShowTextMode.Right==2)&&this.StringFormatY.Operator()){var E=this.StringFormatY.Text;this.Canvas.font=this.Font;var F=this.Canvas.measureText(E).width+4;if(this.Frame.ChartBorder.Top>=30&&this.ShowTextMode.Left==1){var R=e,A=o;this.Canvas.save(),this.Canvas.translate(R,A),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,o>=F?(this.Canvas.fillRect(0,-(this.TextHeight/2),-F,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(E,-2,0,F)):(this.Canvas.fillRect(F-o,-(this.TextHeight/2),-F,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(E,F-o-2,0,F)),this.Canvas.restore()}else if(this.ShowTextMode.Left==2){var R=e,A=o;this.Canvas.save(),this.Canvas.translate(R,A),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(0,-(this.TextHeight/2),F,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(E,2,0,F),this.Canvas.restore()}if(this.StringFormatY.RText){E=this.StringFormatY.RText;var F=this.Canvas.measureText(E).width+4}if(this.Frame.ChartBorder.Bottom>=30&&this.ShowTextMode.Right==1){var R=e,A=l;if(this.Canvas.save(),this.Canvas.translate(R,A),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,h>F?(this.Canvas.fillRect(0,-(this.TextHeight/2),F,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(E,2,0,F)):(this.Canvas.fillRect(h-F,-(this.TextHeight/2),F,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(E,h-F+2,0,F)),this.StringFormatY.RExtendText&&this.StringFormatY.RExtendText.length>0){var P=0;for(var C in this.StringFormatY.RExtendText){var p=this.StringFormatY.RExtendText[C],w="--.--";p.YText?w=p.YText:v.IsNumber(p.Y)&&(w=p.Y.toFixed(0));var H=this.Canvas.measureText(w).width+4;if(this.Canvas.fillStyle=p.TextBGColor,h>H)this.Canvas.fillRect(0,P+this.TextHeight/2,H,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=p.TextColor,this.Canvas.fillText(w,2,P+this.TextHeight,H);else{var W=h-H;this.Canvas.fillRect(W,P+this.TextHeight/2,H,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=p.TextColor,this.Canvas.fillText(w,W+2,P+this.TextHeight,H)}P+=this.TextHeight}}this.Canvas.restore()}else if(this.ShowTextMode.Right==2){var R=e,A=l;this.Canvas.save(),this.Canvas.translate(R,A),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(0,-(this.TextHeight/2),-F,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(E,-2,0,F),this.Canvas.restore()}}if((this.ShowTextMode.Bottom===1||this.ShowTextMode.Bottom==8)&&this.StringFormatX.Operator()){var E=this.StringFormatX.Text;this.Canvas.font=this.Font,this.Canvas.fillStyle=this.TextBGColor;var F=this.Canvas.measureText(E).width+4,R=n,ht=!0;if(this.ShowTextMode.Bottom==8){var rt=this.GetEventCallback($.ON_CUSTOM_CORSSCURSOR_POSITION);if(rt&&rt.Callback){var nt={XText:R,Height:this.TextHeight,IsShowText:ht};rt.Callback(rt,nt,this),R=nt.XText,ht=nt.IsShowText}}if(ht)if(a-F/2<3){var A=a;this.Canvas.save(),this.Canvas.translate(R,A),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillRect(0,0,F,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(E,2,this.TextHeight/2,F),this.Canvas.restore()}else if(a+F/2>=l){var A=a;this.Canvas.save(),this.Canvas.translate(R,A),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillRect(-F,0,F,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(E,-2,this.TextHeight/2,F),this.Canvas.restore()}else{var A=a;this.Canvas.save(),this.Canvas.translate(R,A),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillRect(-F/2,0,F,this.TextHeight),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(E,0,this.TextHeight/2,F),this.Canvas.restore()}}this.Status=1},this.OnKeyDown=function(e){if(this.EnableKeyboard){var a=e.KeyID;if(a==27){if(!this.IsShowCorss)return;this.IsShowCorss=!1,e.Draw=!0,this.OnChangeStatusCallback&&this.OnChangeStatusCallback({Type:1,IsShowCorss:this.IsShowCorss},this)}else if(a==37||a==39){if(this.IsShowCorss)return;this.IsShowCorss=!0,e.Draw=!0,this.OnChangeStatusCallback&&this.OnChangeStatusCallback({Type:1,IsShowCorss:this.IsShowCorss},this)}}}}function DI(){this.Frame,this.HQChart,this.Canvas,this.Data,this.Symbol,this.HPenType=0,this.VPenType=0,this.LineDash=d.DepthCorss.LineDash,this.IsShowTooltip=!0,this.AskColor=d.DepthCorss.AskColor.Line,this.BidColor=d.DepthCorss.BidColor.Line,this.LineWidth=d.DepthCorss.LineWidth,this.ClassName="DepthChartCorssCursor",this.Tooltip={Border:{Top:d.DepthCorss.Tooltip.Border.Top,Left:d.DepthCorss.Tooltip.Border.Left,Right:d.DepthCorss.Tooltip.Border.Right,Bottom:d.DepthCorss.Tooltip.Border.Bottom,ItemSpace:d.DepthCorss.Tooltip.Border.ItemSpace},Font:d.DepthCorss.Tooltip.Font,TextColor:d.DepthCorss.Tooltip.TextColor,BGColor:d.DepthCorss.Tooltip.BGColor},this.Font=d.CorssCursorTextFont,this.TextColor=d.CorssCursorTextColor,this.TextBGColor=d.CorssCursorBGColor,this.TextHeight=20,this.LastPoint,this.PointX,this.PointY,this.StringFormatX,this.StringFormatY,this.IsShowCorss=!0,this.IsShow=!0,this.GetVol=function(e,a){if(!this.Data)return null;var r=a?this.Data.Asks:this.Data.Bids;if(!r||!Array.isArray(r)||r.length<=0)return null;for(var t in r){var n=r[t];if(n.Price==e)return n.Vol}return null},this.Draw=function(){if(this.Status=0,!!this.LastPoint&&this.Data&&this.IsShow){var e=this.LastPoint.X,a=this.LastPoint.Y,r=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),r=this.Canvas.isPointInPath(e,a),this.PointY=null,this.PointY==null,!!r&&this.Frame.IsHScreen!==!0){var t=this.Frame.ChartBorder.GetLeft(),n=this.Frame.ChartBorder.GetRight(),s=this.Frame.ChartBorder.GetTopTitle(),o=this.Frame.ChartBorder.GetBottom();this.Frame.ChartBorder.Right,this.Frame.ChartBorder.GetChartWidth();var l=this.Frame.GetXData(e),h=this.Frame.GetXFromPrice(l);if(h){var u=this.GetVol(h.Price,h.IsAsk);if(a=this.Frame.GetYFromData(u),h.Vol=u,h.Y=a,this.PointY=[[t,a],[n,a]],this.PointX=[[e,s],[e,o]],this.IsShowCorss){h.IsAsk?this.Canvas.strokeStyle=this.AskColor:this.Canvas.strokeStyle=this.BidColor;var f=this.Canvas.lineWidth,C=B();this.Canvas.lineWidth=this.LineWidth*C;var D=this.Canvas.lineWidth;if(this.HPenType==1||this.HPenType==0){this.HPenType==0&&this.Canvas.setLineDash(this.LineDash);var c=$t(D,a);this.Canvas.beginPath(),this.Canvas.moveTo(t,c),this.Canvas.lineTo(n,c),this.Canvas.stroke(),this.HPenType==0&&this.Canvas.setLineDash([])}this.VPenType==0&&this.Canvas.setLineDash(this.LineDash);var T=$t(D,h.X);this.Canvas.beginPath(),this.Canvas.moveTo(T,s),this.Canvas.lineTo(T,o),this.Canvas.stroke(),this.VPenType==0&&this.Canvas.setLineDash([]),this.Canvas.lineWidth=f}if(this.HQChart){var S=this.HQChart.GetEventCallback($.ON_DRAW_DEPTH_TOOLTIP);S&&S.Callback(S,h,this)}if(this.IsShowTooltip){var I=this.GetFormatTooltip(h);this.DrawTooltip(I,h)}}}}},this.GetFormatTooltip=function(e){var a=[],r=2;this.Symbol&&(r=jt(this.Symbol));var t={Title:St.GetText("Depth-Price",this.HQChart.LanguageID),TitleColor:this.Tooltip.TextColor,Text:e.Price.toFixed(r),Color:this.Tooltip.TextColor};a.push(t);var t={Title:St.GetText("Depth-Sum",this.HQChart.LanguageID),TitleColor:this.Tooltip.TextColor,Text:e.Vol.toFixed(4),Color:this.Tooltip.TextColor};return a.push(t),a},this.DrawTooltip=function(e,a){if(v.IsNonEmptyArray(e)){this.Canvas.font=this.Tooltip.Font;for(var r=0,t=0,n=0,s=0;s<e.length;++s){var o=e[s];if(o){var l=!1;if(o.Title){var h=this.Canvas.measureText(o.Title).width;r<h&&(r=h),++t,l=!0}if(o.Text){var h=this.Canvas.measureText(o.Text).width;r<h&&(r=h),++t,l=!0}l&&++n}}if(!(r<=0||t<=0)){this.Tooltip.LineHeight=this.Canvas.measureText("擎").width+2;var u=B(),f=this.Tooltip.Border;this.Tooltip.Width=r+(f.Left+f.Right)*u,this.Tooltip.Height=this.Tooltip.LineHeight*t+(f.Top+f.Bottom)*u+f.ItemSpace*u*(n-1);var C=this.Frame.ChartBorder.GetRight(),D=this.Frame.ChartBorder.GetTop(),c=a.X,T=a.Y-this.Tooltip.Height;c+this.Tooltip.Width>=C&&(c=a.X-this.Tooltip.Width),T<D&&(T=a.Y),this.Canvas.fillStyle=this.Tooltip.BGColor,this.Canvas.fillRect(c,T,this.Tooltip.Width,this.Tooltip.Height),this.Canvas.textBaseline="top",this.Canvas.textAlign="left";for(var S=f.Left*u+c,I=f.Top*u+T,s=0;s<e.length;++s){var o=e[s],l=!1;o.Title&&(o.TitleColor?this.Canvas.fillStyle=o.TitleColor:this.Canvas.fillStyle=this.Tooltip.TextColor,this.Canvas.fillText(o.Title,S,I),I+=this.Tooltip.LineHeight,l=!0),o.Text&&(o.Color?this.Canvas.fillStyle=o.Color:this.Canvas.fillStyle=this.Tooltip.TextColor,this.Canvas.fillText(o.Text,S,I),I+=this.Tooltip.LineHeight,l=!0),l&&(I+=f.ItemSpace*u)}}}},this.PtInButton=function(e,a){return null}}function Li(){this.Frame,this.Canvas,this.Font=d.SplashScreen.Font,this.TextColor=d.SplashScreen.TextColor,this.IsEnableSplash=!1,this.SplashTitle="数据加载中",this.HQChart,this.Position=0,this.EnableSplash=function(e){if(this.IsEnableSplash=e,this.HQChart){var a=this.HQChart.GetEventCallback($.ON_ENABLE_SPLASH_DRAW);if(a){var r={Enable:e};a.Callback(a,r,this)}}},this.SetTitle=function(e){this.SplashTitle=e},this.Draw=function(){if(this.IsEnableSplash){if(this.Frame.IsHScreen===!0){this.HScreenDraw();return}var e=null,a=null;if(this.Position==1&&this.HQChart.Frame&&this.HQChart.Frame.SubFrame&&this.HQChart.Frame.SubFrame[0]){var r=this.HQChart.Frame.SubFrame[0].Frame;r&&(e=(r.ChartBorder.GetLeft()+r.ChartBorder.GetRight())/2,a=(r.ChartBorder.GetTop()+r.ChartBorder.GetBottom())/2)}if(!v.IsNumber(e)||!v.IsNumber(a))var e=(this.Frame.ChartBorder.GetLeft()+this.Frame.ChartBorder.GetRight())/2,a=(this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.GetBottom())/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.SplashTitle,e,a)}},this.HScreenDraw=function(){var e=(this.Frame.ChartBorder.GetLeft()+this.Frame.ChartBorder.GetRight())/2,a=(this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.GetBottom())/2;this.Canvas.save(),this.Canvas.translate(e,a),this.Canvas.rotate(90*Math.PI/180),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.SplashTitle,0,0),this.Canvas.restore()}}function Ya(){this.Data,this.Value,this.Text,this.Operator=function(){return!1},this.GetMultiDayBeforeOpenData=function(){if(!this.MultiDayBeforeOpenData||!v.IsNonEmptyArray(this.MultiDayBeforeOpenData)||(this.DayOffset||this.MultiDayBeforeOpenData,!v.IsNumber(this.DayOffset.Offset)||!v.IsNumber(this.DayOffset.ShowDayCount)))return null;var e=this.DayOffset.ShowDayCount,a=this.DayOffset.Offset,r=this.MultiDayBeforeOpenData.slice(a,a+e);return r},this.GetMultiDayAfterCloseData=function(){if(!this.MultiDayAfterCloseData||!v.IsNonEmptyArray(this.MultiDayAfterCloseData)||(this.DayOffset||this.MultiDayAfterCloseData,!v.IsNumber(this.DayOffset.Offset)||!v.IsNumber(this.DayOffset.ShowDayCount)))return null;var e=this.DayOffset.ShowDayCount,a=this.DayOffset.Offset,r=this.MultiDayAfterCloseData.slice(a,a+e);return r}}var nD=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10];function oD(){this.newMethod=Ya,this.newMethod(),delete this.newMethod,this.Symbol,this.FrameID,this.Frame,this.LanguageID=xe.LANGUAGE_CHINESE_ID,this.YClose,this.PercentageText,this.RValue,this.RText,this.RComplexText,this.Point,this.ClientPos=-1,this.ExtendChartPaint,this.RExtendText=[],this.BeforeOpenData,this.AfterCloseData,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.ShareAfterVol=0,this.PriceFormatType=0,this.DataFormatType=0,this.GetEventCallback,this.GetBeforeOpen=function(){if(!this.Frame)return!1;var e=this.Frame.SubFrame[this.FrameID];if(!e||!e.Frame||!this.BeforeOpenData)return!1;var a={Max:this.BeforeOpenData.VolMax,Min:this.BeforeOpenData.VolMin},r=this.Frame.IsHScreen?this.Point.X:this.Point.Y,t=e.Frame.GetLeftExtendYData(r,!1,{Range:a}),n=2;v.IsNumber(t)&&(this.RText=this.Text=v.FormatValueString(t,n,this.LanguageID))},this.GetAfterClose=function(){if(!this.Frame)return!1;var e=this.Frame.SubFrame[this.FrameID];if(!e||!e.Frame||!this.AfterCloseData)return!1;var a={Max:this.AfterCloseData.VolMax,Min:this.AfterCloseData.VolMin},r=this.Frame.IsHScreen?this.Point.X:this.Point.Y,t=e.Frame.GetRightExtendYData(r,!1,{Range:a}),n=2;v.IsNumber(t)&&(this.RText=this.Text=v.FormatValueString(t,n,this.LanguageID))},this.GetMultiDayBeforeOpen=function(){if(!this.Frame)return!1;var e=this.Frame.SubFrame[this.FrameID];if(!e||!e.Frame)return!1;var a=this.GetMultiDayBeforeOpenData();if(!(!a||!v.IsNonEmptyArray(a))){var r=this.ClientPos-200;if(r<0||r>=a.length)return!1;var t=a[r],n={Max:t.VolMax,Min:t.VolMin},s=this.Frame.IsHScreen?this.Point.X:this.Point.Y,o=e.Frame.GetLeftExtendYData(s,!1,{Range:n}),l=2;v.IsNumber(o)&&(this.RText=this.Text=v.FormatValueString(o,l,this.LanguageID))}},this.GetMultiDayAfterClose=function(){if(!this.Frame)return!1;var e=this.Frame.SubFrame[this.FrameID];if(!e||!e.Frame)return!1;var a=this.GetMultiDayAfterCloseData();if(!(!a||!v.IsNonEmptyArray(a))){var r=this.ClientPos-300;if(r<0||r>=a.length)return!1;var t=a[r],n={Max:t.VolMax,Min:t.VolMin},s=this.Frame.IsHScreen?this.Point.X:this.Point.Y,o=e.Frame.GetRightExtendYData(s,!1,{Range:n}),l=2;v.IsNumber(o)&&(this.RText=this.Text=v.FormatValueString(o,l,this.LanguageID))}},this.Operator=function(){if(this.RText=null,this.RComplexText=null,this.RExtendText=[],v.IsString(this.RValue)&&(this.RText=this.RValue),!this.Value)return!1;this.PercentageText=null;var e=2;if(this.FrameID==0){var e=jt(this.Symbol);this.PriceFormatType==1?this.Text=v.FormatValueThousandsString(this.Value,e):this.Text=this.Value.toFixed(e),this.YClose>0&&(this.PercentageText=((this.Value-this.YClose)*100/this.YClose).toFixed(2)),this.GetExtendPaintData(e)}else this.FrameID==1?(this.DataFormatType==1?(this.Text=v.FormatValueThousandsString(this.Value,e),v.IsNumber(this.RValue)&&(this.RText=v.FormatValueString(this.RValue,e,this.LanguageID))):(this.Text=v.FormatValueString(this.Value,e,this.LanguageID),v.IsNumber(this.RValue)&&(this.RText=v.FormatValueString(this.RValue,e,this.LanguageID))),this.ClientPos==2?this.GetBeforeOpen():this.ClientPos==3?(this.ShareAfterVol==0||this.ShareAfterVol==2)&&this.GetAfterClose():this.ClientPos>=200&&this.ClientPos<=299?this.GetMultiDayBeforeOpen():this.ClientPos>=300&&this.ClientPos<=399&&(this.ShareAfterVol==0||this.ShareAfterVol==2)&&this.GetMultiDayAfterClose()):(this.DataFormatType==1?this.Text=v.FormatValueThousandsString(this.Value,e):this.Text=v.FormatValueString(this.Value,e,this.LanguageID),v.IsNumber(this.RValue)&&(this.RText=v.FormatValueString(this.RValue,e,this.LanguageID)));if(this.GetEventCallback){var a=this.GetEventCallback($.ON_FORMAT_CORSSCURSOR_Y_TEXT);if(a){var r={Value:this.Value,FrameID:this.FrameID,PreventDefault:!1};if(a.Callback(a,r,this),r.PreventDefault==!0)return!1}}return!0},this.GetExtendPaintData=function(e){var a=parseInt(this.Value*nD[e]);for(var r in this.ExtendChartPaint){var t=this.ExtendChartPaint[r];if(t.ClassName=="DepthMapPaint"&&t.FrameID==this.FrameID){var n=t.GetYValueByXValue(a,e);for(var s in n)this.RExtendText.push(n[s])}}}}function hD(){this.newMethod=Ya,this.newMethod(),delete this.newMethod,this.DateFormatType=0,this.LanguageID=0,this.Operator=function(){if(!v.IsNumber(this.Value)||!this.Data)return!1;var e=this.Value;if(e=parseInt(e.toFixed(0)),this.Data.DataOffset+e>=this.Data.Data.length)return!1;var a=this.Data.Data[this.Data.DataOffset+e],r="YYYY-MM-DD";if(this.DateFormatType==1?r="YYYY/MM/DD":this.DateFormatType==2?r="YYYY/MM/DD/W":this.DateFormatType==3&&(r="DD/MM/YYYY"),this.Text=v.FormatDateString(a.Date,r,this.LanguageID),Y.IsMinutePeriod(this.Data.Period,!0)){var t=v.FormatTimeString(a.Time);this.Text=this.Text+"  "+t}else if(Y.IsSecondPeriod(this.Data.Period)){var t=v.FormatTimeString(a.Time,"HH:MM:SS");this.Text=this.Text+"  "+t}else if(Y.IsMilliSecondPeriod(this.Data.Period)){var t=v.FormatTimeString(a.Time,"HH:MM:SS.fff");this.Text=this.Text+"  "+t}else if(Y.IsTickPeriod(this.Data.Period)){var t=v.FormatTimeString(a.Time);this.Text=this.Text+"  "+t}if(this.GetEventCallback){var n=this.GetEventCallback($.ON_FORMAT_CORSSCURSOR_X_TEXT);if(n){var s={Item:a,Period:this.Data.Period,Date:a.Date,Time:a.Time,Index:this.Data.DataOffset+e,PreventDefault:!1};if(n.Callback(n,s,this),s.PreventDefault==!0)return!1}}return!0}}function lD(){this.newMethod=Ya,this.newMethod(),delete this.newMethod,this.ClassName="HQMinuteTimeStringFormat",this.Frame,this.Symbol,this.Point,this.ClientPos=-1,this.BeforeOpenData,this.AfterCloseData,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.GetEventCallback,this.GetBeforeOpen=function(){if(!this.BeforeOpenData||!this.BeforeOpenData.Data)return!1;var e=this.Frame.IsHScreen==!0?this.Point.Y:this.Point.X,a=this.Frame.GetLeftExtendXData(e,this.BeforeOpenData);if(a=parseInt(a.toFixed(0)),a>=this.BeforeOpenData.Data.length)return!1;var r=this.BeforeOpenData.Data[a];return this.Text=this.FormatCallAcutionDateTime(r,this.BeforeOpenData),!0},this.GetAfterClose=function(){if(!this.AfterCloseData||!this.AfterCloseData.Data)return!1;var e=this.Frame.IsHScreen==!0?this.Point.Y:this.Point.X,a=this.Frame.GetRightExtendXData(e,this.AfterCloseData);if(a=parseInt(a.toFixed(0)),a>=this.AfterCloseData.Data.length)return!1;var r=this.AfterCloseData.Data[a];return this.Text=this.FormatCallAcutionDateTime(r,this.AfterCloseData),!0},this.GetMultiDayBeforeOpen=function(){var e=this.GetMultiDayBeforeOpenData();if(!e||this.Frame.ChartBorder.MultiDayMinute.Count<=1||this.Frame.ChartBorder.MultiDayMinute.Left<=0)return!1;var a=this.Frame.IsHScreen==!0?this.Point.Y:this.Point.X,r=this.Frame.GetLeftExtendXData(a,e);if(!r||r.DayIndex>=e.length)return!1;var t=e[r.DayIndex];if(r.DataIndex=parseInt(r.DataIndex.toFixed(0)),r.DataIndex>=t.Data.length||r.DataIndex<0)return!1;var n=t.Data[r.DataIndex];return this.Text=this.FormatCallAcutionDateTime(n,t),!0},this.GetMultiDayAfterClose=function(){var e=this.GetMultiDayAfterCloseData();if(!e||this.Frame.ChartBorder.MultiDayMinute.Count<=1||this.Frame.ChartBorder.MultiDayMinute.Right<=0)return!1;var a=this.Frame.IsHScreen==!0?this.Point.Y:this.Point.X,r=this.Frame.GetRightExtendXData(a,e);if(!r||r.DayIndex>=e.length)return!1;var t=e[r.DayIndex];if(r.DataIndex=parseInt(r.DataIndex.toFixed(0)),r.DataIndex>=t.Data.length)return!1;var n=t.Data[r.DataIndex];return this.Text=this.FormatCallAcutionDateTime(n,t),!0},this.FormatCallAcutionDateTime=function(e,a){var r=e.Time;return a.Ver==1?v.FormatTimeString(r,"HH:MM"):v.FormatTimeString(r,"HH:MM:SS")},this.Operator=function(){if(this.ClientPos==2)return this.GetBeforeOpen();if(this.ClientPos==3)return this.GetAfterClose();if(this.ClientPos>=200&&this.ClientPos<=299)return this.GetMultiDayBeforeOpen();if(this.ClientPos>=300&&this.ClientPos<=399)return this.GetMultiDayAfterClose();if(!v.IsNumber(this.Value))return!1;var e=Math.abs(this.Value);e=parseInt(e.toFixed(0));var a=e;this.Frame&&this.Frame.MinuteCount&&(a=e%this.Frame.MinuteCount);var r=Wi,t=r.GetTimeData(this.Symbol);if(!t)return!1;a<0?a=0:a>t.length&&(a=t.length-1),this.Frame&&e>=this.Frame.XPointCount&&(a=t.length-1);var n=t[a];if(this.Text=v.FormatTimeString(n),this.GetEventCallback){var s=this.GetEventCallback($.ON_FORMAT_CORSSCURSOR_X_TEXT);if(s){var o={Time:n,Index:a,PreventDefault:!1};if(s.Callback(s,o,this),o.PreventDefault==!0)return!1}}return!0},this.GetMinuteCloseYPoint=function(e){var a=e.Type;if(a==1||a==2||a==3){if(a==1){if(!this.Data||this.Data.Data.length<=0)return null;var r=e.DataIndex;(r<0||r>=this.Data.Data.length)&&(r=this.Data.Data.length-1);var t=this.Data.Data[r],n=this.Frame.GetYFromData(t);return{Price:t,Y:n}}else if(a==2){if(!this.BeforeOpenData||!this.BeforeOpenData.Data)return!1;if(e.DataIndex<0||e.DataIndex>=this.BeforeOpenData.Data.length)return null;var s=this.BeforeOpenData.Data[e.DataIndex],t=s.Price,n=this.Frame.GetYFromData(t);return{Price:t,Y:n}}else if(a==3){if(!this.AfterCloseData||!this.AfterCloseData.Data)return!1;if(e.DataIndex<0||e.DataIndex>=this.AfterCloseData.Data.length)return null;var s=this.AfterCloseData.Data[e.DataIndex],t=s.Price,n=this.Frame.GetYFromData(t);return{Price:t,Y:n}}}else if(a==10||a==20||a==30){if(a==10){if(!this.Data||this.Data.Data.length<=0)return null;var r=this.Frame.MinuteCount*e.DayIndex+e.DataIndex;(r<0||r>=this.Data.Data.length)&&(r=this.Data.Data.length-1);var t=this.Data.Data[r],n=this.Frame.GetYFromData(t);return{Price:t,Y:n}}else if(a==20){var o=this.GetMultiDayBeforeOpenData();if(!o||e.DayIndex<0||e.DayIndex>=o.length)return null;var l=o[e.DayIndex];if(e.DataIndex<0||e.DataIndex>=l.Data.length)return null;var s=l.Data[e.DataIndex],t=s.Price,n=this.Frame.GetYFromData(t);return{Price:t,Y:n}}else if(a==30){var h=this.GetMultiDayAfterCloseData();if(!h||e.DayIndex<0||e.DayIndex>=h.length)return null;var l=h[e.DayIndex];if(e.DataIndex<0||e.DataIndex>=l.Data.length)return null;var s=l.Data[e.DataIndex],t=s.Price,n=this.Frame.GetYFromData(t);return{Price:t,Y:n}}}return null}}var Dn=["日","一","二","三","四","五","六"];function vI(){this.newMethod=Ya,this.newMethod(),delete this.newMethod,this.ClassName="HistoryDataStringFormat",this.Symbol,this.UpColor=d.UpTextColor,this.DownColor=d.DownTextColor,this.UnchagneColor=d.UnchagneTextColor,this.VolColor=d.Title.VolColor,this.AmountColor=d.Title.AmountColor,this.TurnoverRateColor=d.Title.TurnoverRateColor,this.PositionColor=d.Title.PositionColor,this.LanguageID=xe.LANGUAGE_CHINESE_ID,this.LineCount=0,this.LineHeight=d.PCTooltip.LineHeight,this.Width=157,this.Height=this.LineHeight*5,this.Operator=function(){var e=this.Value.Data;if(!e)return!1;this.Width=157,this.LanguageID==xe.LANGUAGE_ENGLISH_ID&&(this.Width=180);var a=this.GetFormatTitle(e);if(!a)return!1;var r=this.GenerateTitleHtml(a);return r?(this.Text=r.Html,this.Height=r.LineCount*this.LineHeight,!0):!1},this.GenerateTitleHtml=function(e){var a=0,r="",t;if(e.Name&&(t="<span style='color:rgb(0,0,0);font:微软雅黑;font-size:12px;text-align:center;display: block;'>"+e.Name+"</span>",r+=t,++a),e.Title)if(Array.isArray(e.Title))for(var n=0;n<e.Title.length;++n){var s=e.Title[n];t="<span class='tooltip-title'>"+s+"</span>",r+=t,++a}else t="<span class='tooltip-title'>"+e.Title+"</span>",r+=t,++a;if(v.IsNonEmptyArray(e.AryText))for(var n=0;n<e.AryText.length;++n){var s=e.AryText[n];n>0&&(r+="<br/>");var t="<span class='tooltip-con'>"+s.Title+"</span><span class='tooltip-num' style='color:"+s.Color+";'>"+s.Text+"</span>";r+=t,++a}return{Html:r,LineCount:a}},this.GetFormatTitle=function(e){if(!e)return null;var a=this.Symbol.toUpperCase(),r=jt(this.Symbol),t=new Date(parseInt(e.Date/1e4),e.Date/100%100-1,e.Date%100),n=v.FormatDateString(e.Date),s=n,o,l=Y.IsTickPeriod(this.Value.ChartPaint.Data.Period);Y.IsDayPeriod(this.Value.ChartPaint.Data.Period,!0)?(o=St.GetText(Dn[t.getDay()],this.LanguageID),s=n+"&nbsp&nbsp"+o):Y.IsMinutePeriod(this.Value.ChartPaint.Data.Period,!0)?(o=v.FormatTimeString(e.Time),s=n+"&nbsp&nbsp"+o):Y.IsSecondPeriod(this.Value.ChartPaint.Data.Period)||l?(o=v.FormatTimeString(e.Time,"HH:MM:SS"),s=n+"&nbsp&nbsp"+o):Y.IsMilliSecondPeriod(this.Value.ChartPaint.Data.Period)&&(o=v.FormatTimeString(e.Time,"HH:MM:SS.fff"),s=[n+"&nbsp&nbsp"+St.GetText(Dn[t.getDay()],this.LanguageID),o]);var h={AryText:null,Title:s,Name:null};if(l){var u=[{Title:St.GetText("DivTooltip-Price",this.LanguageID),Text:v.IsNumber(e.Open)?e.Open.toFixed(r):"--",Color:this.GetColor(e.Open,e.YClose)}];if(v.IsNumber(e.YClose)){var f=(e.Close-e.YClose)/e.YClose*100,C={Title:St.GetText("DivTooltip-Increase",this.LanguageID),Text:f.toFixed(2)+"%",Color:this.GetColor(f,0)};u.push(C)}h.AryText=u}else if(!e.IsNonTrade){var D=e.Vol;a&&U.IsSHSZ(a)&&(D/=100);var c=null;this.GetEventCallback&&(c=this.GetEventCallback($.ON_CUSTOM_UNCHANGE_KLINE_TITLE_COLOR));var u=[{Title:St.GetText("DivTooltip-Open",this.LanguageID),Text:v.IsNumber(e.Open)?e.Open.toFixed(r):"--",Color:this.GetPriceColor("DivTooltip-Open",e.Open,e.YClose,e,c)},{Title:St.GetText("DivTooltip-High",this.LanguageID),Text:v.IsNumber(e.High)?e.High.toFixed(r):"--",Color:this.GetPriceColor("DivTooltip-High",e.High,e.YClose,e,c)},{Title:St.GetText("DivTooltip-Low",this.LanguageID),Text:v.IsNumber(e.Low)?e.Low.toFixed(r):"--",Color:this.GetPriceColor("DivTooltip-Low",e.Low,e.YClose,e,c)},{Title:St.GetText("DivTooltip-Close",this.LanguageID),Text:v.IsNumber(e.Close)?e.Close.toFixed(r):"--",Color:this.GetPriceColor("DivTooltip-Close",e.Close,e.YClose,e,c)},{Title:St.GetText("DivTooltip-Vol",this.LanguageID),Text:v.IsNumber(D)?v.FormatValueString(D,2,this.LanguageID):"--",Color:this.VolColor},{Title:St.GetText("DivTooltip-Amount",this.LanguageID),Text:v.IsNumber(e.Amount)?v.FormatValueString(e.Amount,2,this.LanguageID):"--",Color:this.AmountColor}];if(v.IsNumber(e.YClose)){var f=(e.Close-e.YClose)/e.YClose*100,C={Title:St.GetText("DivTooltip-Increase",this.LanguageID),Text:f.toFixed(2)+"%",Color:this.GetColor(f,0)};u.push(C)}if(U.IsSHSZStockA(this.Symbol)&&e.FlowCapital>0){var o=e.Vol/e.FlowCapital*100,C={Title:St.GetText("DivTooltip-Exchange",this.LanguageID),Text:o.toFixed(2)+"%",Color:this.TurnoverRateColor};u.push(C)}if(U.IsFutures(a)&&v.IsNumber(e.Position))var C={Title:St.GetText("DivTooltip-Position",this.LanguageID),Text:""+e.Position,Color:this.PositionColor};this.Value.ChartPaint.Name=="Overlay-KLine"&&(h.Name=this.Value.ChartPaint.Title),h.AryText=u}return h},this.GetColor=function(e,a){return e>a?this.UpColor:e<a?this.DownColor:this.UnchagneColor},this.GetPriceColor=function(e,a,r,t,n){var s=this.GetColor(a,r);if(a==r&&n&&n.Callback){var o={Item:t,TitleName:e,DefaultColor:s,TitleColor:null,ClassName:this.ClassName};n.Callback(n,o),o.TitleColor&&(s=o.TitleColor)}return s}}function cI(){this.newMethod=Ya,this.newMethod(),delete this.newMethod,this.UpColor=d.UpTextColor,this.DownColor=d.DownTextColor,this.UnchagneColor=d.UnchagneTextColor,this.Width=500,this.Operator=function(){if(!this.Value)return!1;var e=this.Value.Data.Data,a=this.Value.Data.Type,r="";for(var t in e){var n=e[t],s="";switch(a){case ee.BLOCKTRADING:s=this.BlockTradingFormat(n);break;case ee.TRADEDETAIL:s=this.TradeDetailFormat(n);break;case ee.RESEARCH:s=this.ResearchFormat(n);break;case ee.PFORECAST:s=this.PerformanceForecastFormat(n);break;default:s=this.DefaultFormat(n);break}r+=s}var o="<div class='title-length'>"+r+"</div>";if(e.length>8){var l="<div class='total-list'>共"+e.length+"条</div>";o+=l}return this.Text=o,!0},this.DefaultFormat=function(e){var a=v.FormatDateString(e.Date);if(v.IsNumber(e.Time)){var r=v.FormatTimeString(e.Time);a+=" "+r}var t="<span>"+a+"&nbsp;&nbsp;&nbsp;"+e.Title+"</span>";return t},this.BlockTradingFormat=function(e){var a=e.ExtendData,r=v.FormatDateString(e.Date),t="<span><i class='date-tipbox'>"+r+"</i>&nbsp;&nbsp;<i class='tipBoxTitle'>成交价:&nbsp;"+a.Price.toFixed(2)+"</i><i class='tipBoxTitle'>收盘价:&nbsp;"+a.ClosePrice.toFixed(2)+"</i><br/><i class='rate-discount tipBoxTitle'>溢折价率:&nbsp;<strong style='color:"+this.GetColor(a.Premium.toFixed(2))+"'>"+a.Premium.toFixed(2)+"%</strong></i><i class='tipBoxTitle'>成交量(万股):&nbsp;"+a.Vol.toFixed(2)+"</i></span>";return t},this.TradeDetailFormat=function(e){var a=e.ExtendData.Detail,r=v.FormatDateString(e.Date),t=[];for(var n in a)t+="<i>"+a[n].TypeExplain+"</i><br/>";var s="<span><i class='trade-time'>"+r+"&nbsp;&nbsp;&nbsp;上榜原因:&nbsp;&nbsp;</i><i class='reason-list'>"+t+"</i><br/><i class='trade-detall'>一周后涨幅:&nbsp;<strong style='color:"+this.GetColor(e.ExtendData.FWeek.Week1.toFixed(2))+"'>"+e.ExtendData.FWeek.Week1.toFixed(2)+"%</strong>&nbsp;&nbsp;&nbsp;四周后涨幅:&nbsp;<strong style='color:"+this.GetColor(e.ExtendData.FWeek.Week4.toFixed(2))+";'>"+e.ExtendData.FWeek.Week4.toFixed(2)+"%</strong></i></span>";return s},this.ResearchFormat=function(e){var a=e.ExtendData.Level,r="";if(a.length==0)r="<i>一般调研</i>";else{for(var t in a)a[t]==0?r+="<i style='color:#00a0e9'>证券代表&nbsp;&nbsp;&nbsp;</i>":a[t]==1?r+="<i>董秘&nbsp;&nbsp;&nbsp;</i>":a[t]==2?r+="<i style='color:#00a0e9'>总经理&nbsp;&nbsp;&nbsp;</i>":a[t]==3&&(r+="<i style='color:#00a0e9'>董事长&nbsp;&nbsp;&nbsp;</i>");r="接待:&nbsp;&nbsp;&nbsp;"+r}var n="";e.ExtendData.Type&&e.ExtendData.Type!="其他"&&(n="&nbsp;&nbsp;&nbsp;<i>"+e.ExtendData.Type+"</i>",a.length==0&&(r=""));var s=v.FormatDateString(e.Date),o="<span>"+s+"&nbsp;&nbsp;&nbsp;"+n+r+"</span>";return o},this.PerformanceForecastFormat=function(e){var a=e.ExtendData.ReportDate,r=parseInt(a/1e4),t=a%1e4,n;t==1231?n="年报":t==331?n="一季度报":t==630?n="半年度报":t==930&&(n="三季度报");var s="";e.ExtendData.FWeek&&(e.ExtendData.FWeek.Week1!=null&&(s+="一周后涨幅:<i class='increase' style='color:"+this.GetColor(e.ExtendData.FWeek.Week1.toFixed(2))+"'>"+e.ExtendData.FWeek.Week1.toFixed(2)+"%</i>"),e.ExtendData.FWeek.Week4!=null&&(s+="&nbsp;四周后涨幅:<i class='increase' style='color:"+this.GetColor(e.ExtendData.FWeek.Week4.toFixed(2))+"'>"+e.ExtendData.FWeek.Week4.toFixed(2)+"%</i>"),s.length>0&&(s="<br/>&nbsp;&nbsp;<i class='prorecast-week'>"+s+"</i>"));var o=v.FormatDateString(e.Date),l="<span>"+o+"&nbsp;&nbsp;"+r+n+e.Title+"&nbsp;"+s+"</span>";return l},this.GetColor=function(e){return e>0?this.UpColor:e<0?this.DownColor:this.UnchagneColor}}function TI(){this.newMethod=Ya,this.newMethod(),delete this.newMethod,this.Width=120,this.Operator=function(){var e=this.Value.Data;if(!e)return!1;var a=e.Data,r="<span class='tooltip-index-name'>"+a.Name+a.Param+":</span>",t;return a.Type==1?t="<span class='tooltip-index-buy'>买入</span>":t="<span class='tooltip-index-sell'>卖出</span>",this.Text=r+t,!0}}function SI(){this.newMethod=Ya,this.newMethod(),delete this.newMethod,this.Width=200,this.Operator=function(){var e=this.Value.Data;if(!e)return!1;var a=e.Data.Item,r=v.FormatTimeString(a.Time),t="<span class='tooltip-minuteinfo-time'>"+r+" </span>",n="<span class='tooltip-minuteinfo-content'>"+a.Title+"</span>";return a.Content&&(n="<span class='tooltip-minuteinfo-content'>"+a.Content+"</span>"),this.Text=t+n,!0}}function dI(){this.newMethod=Ya,this.newMethod(),delete this.newMethod,this.Width=200,this.Operator=function(){if(!this.Value||!this.Value.Data)return!1;var e=this.Value.Data;return!e.Item||!e.Item.Text?!1:(this.Text=e.Item.Text,!0)}}function II(){this.newMethod=Ya,this.newMethod(),delete this.newMethod,this.Width=200,this.Operator=function(){if(!this.Value||!this.Value.Data)return!1;var e=this.Value.Data;return!e.Item||!e.Item.Tooltip||!e.Item.Tooltip.Text?!1:(this.Text=e.Item.Tooltip.Text,!0)}}function mI(){this.newMethod=Ya,this.newMethod(),delete this.newMethod,this.Width=200,this.Period=0,this.Operator=function(){var e=this.Value.Data;if(!e||!e.Data)return!1;if(Y.IsDayPeriod(this.Period,!0)){var a=v.FormatDateString(e.Data.Start.Date),r=v.FormatDateString(e.Data.End.Date);if(a==r)return this.Text="<span class='tooltip-minuteinfo-content'>"+a+"</span>",!0;var t="<span class='tooltip-minuteinfo-content'>起始时间:"+a+"</span>",n="<span class='tooltip-minuteinfo-content'>结束时间:"+r+"</span>";return this.Text=t+"<br>"+n,!0}else if(Y.IsMinutePeriod(this.Period,!0)){var a=v.FormatDateString(e.Data.Start.Date),s=v.FormatTimeString(e.Data.Start.Time,"HH:MM"),r=v.FormatDateString(e.Data.End.Date),o=v.FormatTimeString(e.Data.End.Time,"HH:MM"),t="<span class='tooltip-minuteinfo-content'>起始时间:"+a+" "+s+"</span>",n="<span class='tooltip-minuteinfo-content'>结束时间:"+r+" "+o+"</span>";return this.Text=t+"<br>"+n,!0}return!1}}function gI(){this.newMethod=Ya,this.newMethod(),delete this.newMethod,this.Width=200,this.Operator=function(){var e=this.Value.Data;if(!e||!e.Data||!v.IsNonEmptyArray(e.Data.Tooltip))return!1;this.Text="";for(var a=0;a<e.Data.Tooltip.length;++a){var r=e.Data.Tooltip[a],t="<span class='tooltip-minuteinfo-content'>"+r+"</span>";this.Text+=t+"<br>"}return!0}}function pI(){this.DataMap=new Dt.default([["KLineTradeDataStringFormat",{Create:function(){return new TI}}],["MinuteInfoDataStringFormat",{Create:function(){return new SI}}],["HistoryDataStringFormat",{Create:function(){return new vI}}],["KLineInfoDataStringFormat",{Create:function(){return new cI}}],["IconDataStringFormat",{Create:function(){return new dI}}],["ChartOXDataStringFormat",{Create:function(){return new mI}}],["ScatterPlotDataStringFormat",{Create:function(){return new gI}}],["ChartDrawSVGDataStringFormat",{Create:function(){return new II}}],["CorssCursor_XStringFormat",{Create:function(){return new hD}}],["CorssCursor_YStringFormat",{Create:function(){return new oD}}],["CorssCursor_Minute_XStringFormat",{Create:function(){return new lD}}]]),this.Create=function(e){if(!this.DataMap.has(e))return null;var a=this.DataMap.get(e);return a.Create()}}var Je=new pI;function sl(){this.Frame,this.Data=new Array,this.Canvas,this.IsDynamic=!1,this.Position=0,this.CursorIndex,this.LastPoint,this.Font=d.TitleFont,this.Title,this.TitleColor=d.DefaultTextColor,this.ClassName="IChartTitlePainting",this.DrawStatus,this.GetEventCallback,this.GlobalOption,this.ReloadResource=function(){this.Font=d.TitleFont,this.TitleColor=d.DefaultTextColor}}var EI=["不复权","前复权","后复权"];function uD(){this.newMethod=sl,this.newMethod(),delete this.newMethod,this.ClassName="DynamicKLineTitlePainting",this.IsDynamic=!0,this.IsShow=!0,this.Period,this.UpColor=d.UpTextColor,this.DownColor=d.DownTextColor,this.UnchagneColor=d.UnchagneTextColor,this.VolColor=d.Title.VolColor,this.AmountColor=d.Title.AmountColor,this.DateTimeColor=d.Title.DateTimeColor,this.NameColor=d.Title.NameColor,this.SettingColor=d.Title.SettingColor,this.TurnoverRateColor=d.Title.TurnoverRateColor,this.PositionColor=d.Title.PositionColor,this.Symbol,this.Name,this.SpaceWidth=2*B(),this.OverlayChartPaint,this.IsShowName=!0,this.IsShowSettingInfo=!0,this.IsShowDateTime=!0,this.LanguageID=xe.LANGUAGE_CHINESE_ID,this.ShowPositionConfig={Margin:{Bottom:2,Left:2}},this.OnDrawEvent,this.OnMouseMoveEvent,this.HQChart,this.ReloadResource=function(){this.Font=d.TitleFont,this.TitleColor=d.DefaultTextColor,this.UpColor=d.UpTextColor,this.DownColor=d.DownTextColor,this.UnchagneColor=d.UnchagneTextColor,this.VolColor=d.Title.VolColor,this.AmountColor=d.Title.AmountColor,this.DateTimeColor=d.Title.DateTimeColor,this.NameColor=d.Title.NameColor,this.SettingColor=d.Title.SettingColor,this.TurnoverRateColor=d.Title.TurnoverRateColor,this.PositionColor=d.Title.PositionColor},this.GetCurrentKLineData=function(){if(this.CursorIndex==null||!this.Data||this.Data.length<=0)return null;var e=this.CursorIndex;e=parseInt(e.toFixed(0));var a=this.Data.DataOffset+e;if(a>=this.Data.Data.length&&(a=this.Data.Data.length-1),a<0)return null;var r=this.Data.Data[a];return r},this.GetFormatTitle=function(e){if(!(!e||!e.Data)){var a=jt(this.Symbol),r=this.Symbol.toUpperCase(),t=e.Data,n=[],s={AryText:n};if(this.IsShowName&&n.push({Text:this.Name,Color:this.NameColor}),this.IsShowSettingInfo){var o="";this.Data.Period>Ii&&this.Data.Period<=Nr?o=this.Data.Period-Ii+St.GetText("自定义分钟",this.LanguageID):this.Data.Period>Or&&this.Data.Period<=Pn?o=this.Data.Period-Or+St.GetText("自定义日线",this.LanguageID):this.Data.Period>un&&this.Data.Period<=qh?o=this.Data.Period-un+St.GetText("自定义秒",this.LanguageID):this.Data.Period>fn&&this.Data.Period<=jh?o=this.Data.Period-fn+St.GetText("自定义毫秒",this.LanguageID):o=St.GetText(Y.GetPeriodName(this.Data.Period),this.LanguageID);var l=St.GetText(EI[this.Data.Right],this.LanguageID),h="("+o+" "+l+")";U.IsEnableRight(this.Data.Period,this.Symbol,this.HQChart.RightFormula)||(h="("+o+")"),n.push({Text:h,Color:this.SettingColor})}var h=this.GetKLineCalculateTitle();if(h&&n.push({Text:h,Color:this.NameColor}),this.IsShowDateTime){var h=v.FormatDateString(t.Date);n.push({Text:h,Color:this.DateTimeColor})}var u=Y.IsTickPeriod(this.Period);if(Y.IsMinutePeriod(this.Period,!0)&&v.IsNumber(t.Time)){var h=v.FormatTimeString(t.Time);n.push({Text:h,Color:this.DateTimeColor})}else if(Y.IsSecondPeriod(this.Period)&&v.IsNumber(t.Time)){var h=v.FormatTimeString(t.Time,"HH:MM:SS");n.push({Text:h,Color:this.DateTimeColor})}else if(Y.IsMilliSecondPeriod(this.Period)&&v.IsNumber(t.Time)){var h=v.FormatTimeString(t.Time,"HH:MM:SS.fff");n.push({Text:h,Color:this.DateTimeColor})}else if(u){var h=v.FormatTimeString(t.Time,"HH:MM:SS");n.push({Text:h,Color:this.DateTimeColor})}if(u){var f=this.GetColor(t.Open,t.YClose),h=St.GetText("KTitle-Price",this.LanguageID)+t.Open.toFixed(a);if(n.push({Text:h,Color:f}),v.IsNumber(t.YClose)&&t.YClose!=0){var C=(t.Close-t.YClose)/t.YClose*100,f=this.GetColor(C,0),h=St.GetText("KTitle-Increase",this.LanguageID)+C.toFixed(2)+"%";n.push({Text:h,Color:f})}return s}if(t.IsNonTrade)return s;var D=null;if(this.GetEventCallback&&(D=this.GetEventCallback($.ON_CUSTOM_UNCHANGE_KLINE_TITLE_COLOR)),v.IsNumber(t.Open)){var f=this.GetColor(t.Open,t.YClose),h=St.GetText("KTitle-Open",this.LanguageID)+t.Open.toFixed(a);if(t.Open==t.YClose&&D){var c={Item:t,TitleName:"KTitle-Open",DefaultColor:f,TitleColor:null};this.OnUnchangeTitleColor(D,c)&&(f=c.TitleColor)}n.push({Text:h,Color:f})}if(v.IsNumber(t.High)){var f=this.GetColor(t.High,t.YClose),h=St.GetText("KTitle-High",this.LanguageID)+t.High.toFixed(a);if(t.High==t.YClose&&D){var c={Item:t,TitleName:"KTitle-High",DefaultColor:f,TitleColor:null};this.OnUnchangeTitleColor(D,c)&&(f=c.TitleColor)}n.push({Text:h,Color:f})}if(v.IsNumber(t.Low)){var f=this.GetColor(t.Low,t.YClose),h=St.GetText("KTitle-Low",this.LanguageID)+t.Low.toFixed(a);if(t.Low==t.YClose&&D){var c={Item:t,TitleName:"KTitle-Low",DefaultColor:f,TitleColor:null};this.OnUnchangeTitleColor(D,c)&&(f=c.TitleColor)}n.push({Text:h,Color:f})}if(v.IsNumber(t.Close)){var f=this.GetColor(t.Close,t.YClose),h=St.GetText("KTitle-Close",this.LanguageID)+t.Close.toFixed(a);if(t.Close==t.YClose&&D){var c={Item:t,TitleName:"KTitle-Close",DefaultColor:f,TitleColor:null};this.OnUnchangeTitleColor(D,c)&&(f=c.TitleColor)}n.push({Text:h,Color:f})}if(t.YFClose>0&&U.IsChinaFutures(r)){var C=(t.Close-t.YFClose)/t.YFClose*100,f=this.GetColor(C,0),h=St.GetText("KTitle-Increase",this.LanguageID)+C.toFixed(2)+"%";n.push({Text:h,Color:f})}else if(t.YClose>0){var C=(t.Close-t.YClose)/t.YClose*100,f=this.GetColor(C,0),h=St.GetText("KTitle-Increase",this.LanguageID)+C.toFixed(2)+"%";n.push({Text:h,Color:f})}if(v.IsNumber(t.Vol)){var T=U.GetVolUnit(r),S=t.Vol/T,h=St.GetText("KTitle-Vol",this.LanguageID)+v.FromatIntegerString(S,2,this.LanguageID);n.push({Text:h,Color:this.VolColor})}if(v.IsNumber(t.Amount)){var h=St.GetText("KTitle-Amount",this.LanguageID)+v.FormatValueString(t.Amount,2,this.LanguageID);n.push({Text:h,Color:this.AmountColor})}if(U.IsSHSZStockA(this.Symbol)&&t.FlowCapital>0){var C=t.Vol/t.FlowCapital*100,h=St.GetText("KTitle-Exchange",this.LanguageID)+v.FormatValueString(C,2,this.LanguageID)+"%";n.push({Text:h,Color:this.TurnoverRateColor})}if(U.IsFutures(r)&&v.IsNumber(t.Position)){var h=St.GetText("KTitle-Position",this.LanguageID)+t.Position;n.push({Text:h,Color:this.PositionColor})}if(v.IsNonEmptyArray(this.OverlayChartPaint))for(var I=0;I<this.OverlayChartPaint.length;++I){var t=this.OverlayChartPaint[I];if(!(!t.Symbol||!t.Title)){var g=t.Color,h="["+t.Title+"]";n.push({Text:h,Color:g})}}return s}},this.GetLeft=function(e){if(e){var a=this.Frame.ChartBorder.GetTop();if(this.ShowPositionConfig){var r=this.ShowPositionConfig;r.Type===1&&(a=0),r.Margin&&v.IsNumber(r.Margin.Left)&&(a+=r.Margin.Left)}return a}else{var a=this.Frame.ChartBorder.Left;if(this.ShowPositionConfig){var r=this.ShowPositionConfig;r.Type===1&&(a=0),r.Margin&&v.IsNumber(r.Margin.Left)&&(a+=r.Margin.Left)}return a}},this.GetRight=function(e){if(e){var a=this.Frame.ChartBorder.GetHeight();if(this.ShowPositionConfig){var r=this.ShowPositionConfig;r.Type===1&&(a=this.Frame.ChartBorder.GetChartHeight()),r.Margin&&v.IsNumber(r.Margin.Right)&&(a-=r.Margin.Right)}return a}else{var a=this.Frame.ChartBorder.GetRight();if(this.ShowPositionConfig){var r=this.ShowPositionConfig;r.Type===1&&(a=this.Frame.ChartBorder.GetChartWidth()),r.Margin&&v.IsNumber(r.Margin.Right)&&(a-=r.Margin.Right)}return a}},this.GetBottom=function(e){if(e){var a=this.Frame.ChartBorder.GetRight();if(this.ShowPositionConfig){var r=this.ShowPositionConfig;r.Margin&&v.IsNumber(r.Margin.Bottom)&&(a+=r.Margin.Bottom)}return a}else{var a=this.Frame.ChartBorder.GetTop();if(this.ShowPositionConfig){var r=this.ShowPositionConfig;r.Margin&&v.IsNumber(r.Margin.Bottom)&&(a-=r.Margin.Bottom)}return a}},this.DrawItem=function(e){var a=this.Frame.IsHScreen===!0,r=this.GetLeft(a),t=this.GetRight(a),n=this.GetBottom(a),s=B();if(a){if(this.Frame.ChartBorder.Right<5*s)return;var o=n,l=r;this.Canvas.translate(o,l),this.Canvas.rotate(90*Math.PI/180),r=n=0}else if(this.Frame.ChartBorder.Top<5*s)return;this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.font=this.Font;var h={Left:r,MaxRight:t,Bottom:n,IsHScreen:a},u=this.GetFormatTitle({Data:e});if(u&&v.IsNonEmptyArray(u.AryText))for(var f=0;f<u.AryText.length;++f){var e=u.AryText[f];if(!this.DrawText(e.Text,e.Color,h))break}},this.Draw=function(){if(this.IsShow){if(this.CursorIndex==null||!this.Data||this.Data.length<=0){this.OnDrawEventCallback(null);return}this.Canvas.font=this.Font,this.SpaceWidth=this.Canvas.measureText("0").width;var e=this.CursorIndex;e=parseInt(e.toFixed(0));var a=this.Data.DataOffset+e;if(a>=this.Data.Data.length&&(a=this.Data.Data.length-1),a<0){this.OnDrawEventCallback(null);return}this.IsShowLastData()&&(a=this.Data.Data.length-1);var r=this.Data.Data[a];this.OnDrawEventCallback(r),this.Canvas.save(),this.DrawItem(r),this.Canvas.restore()}},this.OnDrawEventCallback=function(e){var a=this.OnDrawEvent&&this.OnDrawEvent.Callback,r=this.OnMouseMoveEvent&&this.OnMouseMoveEvent.Callback;if(!(!a&&!r)){var t={Draw:e,Name:this.ClassName};if(this.Data&&this.Data.Data){var n=Math.abs(this.CursorIndex);n=parseInt(n.toFixed(0));var s=this.Data.DataOffset+n,o=this.Data.Data.length;t.DataIndex=s,t.DataCount=o}if(v.IsNonEmptyArray(this.OverlayChartPaint)){t.OverlayStock=[];for(var l=0;l<this.OverlayChartPaint.length;++l){var h=this.OverlayChartPaint[l];!h.Symbol||!h.Title||t.OverlayStock.push({Symbol:h.Symbol,Name:h.Title,Data:h.Data,Color:h.Color})}}a&&this.OnDrawEvent.Callback(this.OnDrawEvent,t,this),r&&this.OnMouseMoveEvent.Callback(this.OnMouseMoveEvent,t,this)}},this.GetColor=function(e,a){return e>a?this.UpColor:e<a?this.DownColor:this.UnchagneColor},this.OnUnchangeTitleColor=function(e,a){return!e||!e.Callback?!1:(a.ClassName=this.ClassName,e.Callback(e,a,this),!!(a&&a.TitleColor))},this.DrawText=function(e,a,r){if(!e)return!0;var t=this.Frame.IsHScreen===!0,n=this.Frame.ChartBorder.GetRight();t&&(n=this.Frame.ChartBorder.GetHeight()),v.IsNumber(r.MaxRight)&&(n=r.MaxRight),this.Canvas.fillStyle=a;var s=this.Canvas.measureText(e).width;return r.Left+s>n?!1:(this.IsShow&&this.Canvas.fillText(e,r.Left,r.Bottom,s),r.Left+=s+this.SpaceWidth,!0)},this.GetKLineCalculateTitle=function(){if(!this.HQChart)return null;var e=this.HQChart.GetKLineCalulate();return!e||!e.GetTitle?null:e.GetTitle()},this.IsShowLastData=function(){var e=!1;if(this.DrawStatus&&this.DrawStatus.IsTitleShowLatestData){var a=this.DrawStatus;(!v.IsNumber(a.FrameID)||a.FrameID<0||a.CorssCursorTouchEnd&&a.IsOnTouch==!1)&&(e=!0)}return e}}function xI(){this.newMethod=uD,this.newMethod(),delete this.newMethod,this.ClassName="DynamicMinuteTitlePainting",this.SpaceWidth=1*B(),this.YClose,this.IsShowDate=!1,this.IsShowTime=!0,this.IsShowName=!0,this.IsShowAveragePrice=!0,this.OverlayChartPaint,this.LanguageID=xe.LANGUAGE_CHINESE_ID,this.LastShowData,this.OnDrawEvent,this.PointInfo=null,this.IsAlwaysShowLastData=!1,this.ShowLastDataFormat=0,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.TimeFormat,this.CallAuctionShowTitle=new Fe.default(["MTitle-AC-Price","MTitle-AC-Vol","MTitle-AC-NotMatchVol","MTitle-AC-Increase","MTitle-AC-AvPrice"]),this.GetCurrentKLineData=function(){if(this.LastShowData)return this.LastShowData;if(this.CursorIndex==null||!this.Data||this.Data.length<=0)return null;var e=Math.abs(this.CursorIndex);e=parseInt(e.toFixed(0));var a=this.Data.DataOffset+e;if(a>=this.Data.Data.length&&(a=this.Data.Data.length-1),a<0)return null;var r=this.Data.Data[a];return r},this.GetCurrentAuctionData=function(){var e=this.Frame.IsHScreen===!0,a={ClientPos:this.PointInfo.ClientPos,X:this.PointInfo.Point.X,Y:this.PointInfo.Point.Y};if(this.PointInfo.ClientPos==2){if(!this.BeforeOpenData||!this.CallAcutionXOperator||(this.CallAcutionXOperator.Value=e?this.PointInfo.Point.Y:this.PointInfo.Point.X,this.CallAcutionXOperator.Point={X:this.PointInfo.Point.X,Y:this.PointInfo.Point.Y},this.CallAcutionXOperator.ClientPos=this.PointInfo.ClientPos,!this.CallAcutionXOperator.Operator()))return a;var r={Explain:"BeforeOpen",Data:null,DataIndex:null,DataTotalCount:this.BeforeOpenData.TotalCount};return r.DataIndex=this.CallAcutionXOperator.DataIndex,r.Data=this.CallAcutionXOperator.Item,r.Ver=this.BeforeOpenData.Ver,r}else if(this.PointInfo.ClientPos==3){if(!this.AfterCloseData||!this.CallAcutionXOperator||(this.CallAcutionXOperator.Value=e?this.PointInfo.Point.Y:this.PointInfo.Point.X,this.CallAcutionXOperator.Point={X:this.PointInfo.Point.X,Y:this.PointInfo.Point.Y},this.CallAcutionXOperator.ClientPos=this.PointInfo.ClientPos,!this.CallAcutionXOperator.Operator()))return a;var r={Explain:"AfterClose",Data:null,DataIndex:null,DataTotalCount:this.AfterCloseData.TotalCount};return r.DataIndex=this.CallAcutionXOperator.DataIndex,r.Data=this.CallAcutionXOperator.Item,r.Ver=this.AfterCloseData.Ver,r}else if(this.PointInfo.ClientPos>=200&&this.PointInfo.ClientPos<=299){if(!this.MultiDayBeforeOpenData||!v.IsNonEmptyArray(this.MultiDayBeforeOpenData))return a;var t=this.Frame.IsHScreen==!0?this.PointInfo.Point.Y:this.PointInfo.Point.X;if(this.CallAcutionXOperator.Value=t,this.CallAcutionXOperator.Point={X:this.PointInfo.Point.X,Y:this.PointInfo.Point.Y},this.CallAcutionXOperator.ClientPos=this.PointInfo.ClientPos,!this.CallAcutionXOperator.Operator())return a;var n=this.MultiDayBeforeOpenData[this.CallAcutionXOperator.DayIndex],r={Explain:"MultiDayBeforeOpen",Data:null,DataIndex:null};return r.DataIndex=this.CallAcutionXOperator.DataIndex,r.DayIndex=this.CallAcutionXOperator.DayIndex,r.Data=this.CallAcutionXOperator.Item,r.Ver=n.Ver,r}else if(this.PointInfo.ClientPos>=300&&this.PointInfo.ClientPos<=399){if(!this.MultiDayAfterCloseData||!v.IsNonEmptyArray(this.MultiDayAfterCloseData))return a;var t=this.Frame.IsHScreen==!0?this.PointInfo.Point.Y:this.PointInfo.Point.X;if(this.CallAcutionXOperator.Value=t,this.CallAcutionXOperator.Point={X:this.PointInfo.Point.X,Y:this.PointInfo.Point.Y},this.CallAcutionXOperator.ClientPos=this.PointInfo.ClientPos,!this.CallAcutionXOperator.Operator())return a;var n=this.MultiDayAfterCloseData[this.CallAcutionXOperator.DayIndex],r={Explain:"MultiDayAfterClose",Data:null,DataIndex:null};return r.DataIndex=this.CallAcutionXOperator.DataIndex,r.DayIndex=this.CallAcutionXOperator.DayIndex,r.Data=this.CallAcutionXOperator.Item,r.Ver=n.Ver,r}return a},this.GetLatestKLineData=function(e){var a=null,r=1,t;if(v.IsNonEmptyArray(this.MultiDayBeforeOpenData)){var n=this.MultiDayBeforeOpenData[this.MultiDayBeforeOpenData.length-1];n&&v.IsNonEmptyArray(n.Data)&&(r=n.Ver,a=n.Data[n.Data.length-1],t="MultiDayBeforeOpen")}else this.BeforeOpenData&&v.IsNonEmptyArray(this.BeforeOpenData.Data)&&(a=this.BeforeOpenData.Data[this.BeforeOpenData.Data.length-1],r=this.BeforeOpenData.Ver,t="BeforeOpen");var s=null,o=1,l;if(v.IsNonEmptyArray(this.MultiDayAfterCloseData)){var n=this.MultiDayAfterCloseData[this.MultiDayAfterCloseData.length-1];n&&v.IsNonEmptyArray(n.Data)&&(o=n.Ver,s=n.Data[n.Data.length-1],l="MultiDayAfterClose",n.Data.length==n.TotalCount&&(s=null))}else this.AfterOpenData&&v.IsNonEmptyArray(this.AfterOpenData.Data)&&(s=this.AfterOpenData.Data[this.AfterOpenData.Data.length-1],o=this.AfterOpenData.Ver,l="AfterClose");var h=null;if(this.Data&&v.IsNonEmptyArray(this.Data.Data)){var u=this.Data.Data.length;h=this.Data.Data[u-1]}return!a&&!s&&!h?null:e?h?a&&h&&(a.Date>h.Date||a.Date==h.Date&&a.Time>h.Time&&r==1||a.Date==h.Date&&parseInt(a.Time>h.Time)&&r==2)?{Type:2,Data:a,Ver:r,Explain:t}:s&&h&&s.Date>=h.Date?{Type:1,Data:s,Ver:o,Explain:l}:{Type:0,Data:h}:{Type:1,Data:a,Ver:r,Explain:t}:{Type:0,Data:h}},this.GetFormatTitle=function(e){if(!(!e||!e.Data)){var E=this.Symbol.toUpperCase(),a=jt(this.Symbol),r=U.IsFutures(E),t=U.GetVolUnit(E),n=e.Data,s=e.IsLastOne,o=[];if(this.IsShowName&&o.push({Text:this.Name,Color:this.NameColor}),this.IsShowDate||this.IsShowTime){var l=!1;if(s&&this.ShowLastDataFormat==1&&this.Data&&this.Data.UpdateTime&&v.IsNumber(this.Data.UpdateTime.Date)&&v.IsNumber(this.Data.UpdateTime.Time)){var h=v.FormatTimeString(this.Data.UpdateTime.Time,"HH:MM:SS");o.push({Text:h,Color:this.DateTimeColor}),l=!0}if(!l)if(this.TimeFormat){var u=null,f=null,h=null;this.IsShowDate&&(u=v.FormatDateString("YYYY-MM-DD",n.Date)),this.IsShowTime&&(f=v.FormatTimeString(n.Time,this.TimeFormat)),u&&f?h=u+" "+f:u?h=u:f&&(h=f),h&&o.push({Text:h,Color:this.DateTimeColor})}else{var h=v.FormatDateTimeString(n.DateTime,this.IsShowDate,this.IsShowTime);o.push({Text:h,Color:this.DateTimeColor})}}var C=n.Close,D=n.Increase,c=n.Vol,T=n.Amount,S=n.YClose;if(v.IsNumber(S)||(S=this.YClose),r&&v.IsNumber(n.YClearing)&&(S=n.YClearing),v.IsNumber(C)){var I=this.GetColor(C,S),h=St.GetText("MTitle-Close",this.LanguageID)+C.toFixed(a);o.push({Text:h,Color:I})}if(v.IsNumber(D)){var I=this.GetColor(D,0),h=St.GetText("MTitle-Increase",this.LanguageID)+D.toFixed(2)+"%";o.push({Text:h,Color:I})}var g=!0,E=this.Symbol.toUpperCase();if((U.IsET(E)&&!U.IsETShowAvPrice(E)||U.IsShowAvPrice&&!U.IsShowAvPrice(E))&&(g=!1),v.IsNumber(n.AvPrice)&&g&&this.IsShowAveragePrice){var I=this.GetColor(n.AvPrice,S),h=St.GetText("MTitle-AvPrice",this.LanguageID)+n.AvPrice.toFixed(a);o.push({Text:h,Color:I})}if(v.IsNumber(c)){var h=St.GetText("MTitle-Vol",this.LanguageID)+v.FromatIntegerString(c/t,2,this.LanguageID);o.push({Text:h,Color:this.VolColor})}if(v.IsNumber(T)){var h=St.GetText("MTitle-Amount",this.LanguageID)+v.FormatValueString(T,2,this.LanguageID);o.push({Text:h,Color:this.AmountColor})}if(v.IsNumber(n.Position)){var h=St.GetText("MTitle-Position",this.LanguageID)+v.FromatIntegerString(n.Position,2,this.LanguageID);o.push({Text:h,Color:this.VolColor})}if(s&&this.ShowLastDataFormat==0&&this.Data&&this.Data.UpdateTime&&v.IsNumber(this.Data.UpdateTime.Date)&&v.IsNumber(this.Data.UpdateTime.Time)){var h=St.GetText("MTitle-UpdateTime",this.LanguageID)+v.FormatTimeString(this.Data.UpdateTime.Time,"HH:MM:SS");o.push({Text:h,Color:this.DateTimeColor})}if(v.IsNonEmptyArray(this.OverlayChartPaint))for(var F=0;F<this.OverlayChartPaint.length;++F){var n=this.OverlayChartPaint[F];if(!(!n.Symbol||!n.Title)){var R=n.Color,h="["+n.Title+"]";o.push({Text:h,Color:R})}}return{AryText:o}}},this.DrawItem=function(e,a){if(e){var r=B(),t=this.Frame.IsHScreen===!0;this.Frame.GetBorder();var n=this.GetLeft(t),s=this.GetRight(t),o=this.GetBottom(t);if(t){if(this.Frame.ChartBorder.Right<5*r)return;var l=o,h=n;this.Canvas.translate(l,h),this.Canvas.rotate(90*Math.PI/180),n=o=0}else if(this.Frame.ChartBorder.Top<5*r)return;this.Canvas.font=this.Font,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var u={Left:n,MaxRight:s,Bottom:o,IsHScreen:t},f=this.GetFormatTitle({Data:e,IsLastOne:a});if(f&&v.IsNonEmptyArray(f.AryText))for(var C=0;C<f.AryText.length;++C){var e=f.AryText[C];if(!this.DrawText(e.Text,e.Color,u))break}}},this.FormatCallAuctionTitle=function(e){var a=[],r=jt(this.Symbol),t=this.Symbol.toUpperCase(),n=U.GetVolUnit(t);if(this.IsShowName&&a.push({Text:this.Name,Color:this.NameColor}),e&&e.Data){var s=e.Data,o,l,h;h=v.FormatDateString(s.Date);var u=s.YClose;if(e.Ver==1?l=v.FormatTimeString(s.Time,"HH:MM"):l=v.FormatTimeString(s.Time,"HH:MM:SS"),e.Explain=="MultiDayBeforeOpen"||e.Explain=="MultiDayAfterClose"?o=h+" "+l:o=l,a.push({Text:o,Color:this.DateTimeColor}),v.IsNumber(s.Price)&&this.CallAuctionShowTitle.has("MTitle-AC-Price")){var f=this.GetColor(s.Price,u),C="MTitle-AC-Price";e.Ver==1&&(C="MTitle-Close");var o=St.GetText(C,this.LanguageID)+s.Price.toFixed(r);a.push({Text:o,Color:f})}if(v.IsPlusNumber(u)&&v.IsNumber(s.Price)&&this.CallAuctionShowTitle.has("MTitle-AC-Increase")){var D=(s.Price-u)/u*100,f=this.GetColor(D,0),C="MTitle-AC-Increase";e.Ver==1&&(C="MTitle-Increase");var o=St.GetText(C,this.LanguageID)+D.toFixed(2)+"%";a.push({Text:o,Color:f})}if(v.IsNumber(s.AvPrice)&&this.CallAuctionShowTitle.has("MTitle-AC-AvPrice")){var f=this.GetColor(s.AvPrice,u),o=St.GetText("MTitle-AC-AvPrice",this.LanguageID)+s.AvPrice.toFixed(r);a.push({Text:o,Color:f})}if(v.IsNumber(s.Vol[0])&&this.CallAuctionShowTitle.has("MTitle-AC-Vol")){var C="MTitle-AC-Vol";e.Ver==1&&(C="MTitle-Vol");var o=St.GetText(C,this.LanguageID)+v.FromatIntegerString(s.Vol[0]/n,2);a.push({Text:o,Color:this.VolColor})}if(v.IsNumber(s.Vol[1])&&this.CallAuctionShowTitle.has("MTitle-AC-NotMatchVol")){var o=St.GetText("MTitle-AC-NotMatchVol",this.LanguageID)+v.FromatIntegerString(s.Vol[1]/n,2);a.push({Text:o,Color:this.VolColor})}if(s.ExtendData&&v.IsNonEmptyArray(s.ExtendData.Amount)){var c=s.ExtendData.Amount;if(v.IsNumber(c[0])&&this.CallAuctionShowTitle.has("MTitle-AC-Amount")){var o=St.GetText("MTitle-AC-Amount",this.LanguageID)+v.FromatIntegerString(c[0],2);a.push({Text:o,Color:this.AmountColor})}if(v.IsNumber(c[1])&&this.CallAuctionShowTitle.has("MTitle-AC-NotMatchAmount")){var o=St.GetText("MTitle-AC-NotMatchAmount",this.LanguageID)+v.FromatIntegerString(c[1],2);a.push({Text:o,Color:this.AmountColor})}}}return{AryText:a}},this.DrawCallAuction=function(){var e=this.Frame.IsHScreen===!0;this.Frame.GetBorder();var a=B(),r=this.GetLeft(e),t=this.GetRight(e),n=this.GetBottom(e),s=!0;if(e){if(this.Frame.ChartBorder.Right<5*a)return;var o=n,l=r;this.Canvas.translate(o,l),this.Canvas.rotate(90*Math.PI/180),r=n=0}else this.Frame.ChartBorder.Top<5*a&&(s=!1);this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.font=this.Font;var h={Left:r,Bottom:n,MaxRight:t,IsHScreen:e},u=this.GetCurrentAuctionData(),f=this.FormatCallAuctionTitle(u);if(s&&f&&v.IsNonEmptyArray(f.AryText))for(var C=0;C<f.AryText.length;++C){var D=f.AryText[C];if(!this.DrawText(D.Text,D.Color,h))break}this.OnDrawCallAuctionEventCallback(u)},this.OnDrawCallAuctionEventCallback=function(e){if(this.OnDrawEvent&&this.OnDrawEvent.Callback){var a={Draw:e,Name:this.ClassName};this.OnDrawEvent.Callback(this.OnDrawEvent,a,this)}if(this.OnMouseMoveEvent&&this.OnMouseMoveEvent.Callback){var a={Draw:e,Name:this.ClassName};this.OnMouseMoveEvent.Callback(this.OnDrawEvent,a,this)}},this.DrawNone=function(){this.OnDrawEventCallback(null),this.IsAlwaysShowLastData&&(this.Canvas.save(),this.DrawLastDataItem(),this.Canvas.restore())},this.Draw=function(){if(this.LastShowData=null,this.GlobalOption=this.Frame.GlobalOption,!this.IsShow){var e=this.OnDrawEvent&&this.OnDrawEvent.Callback||this.OnMouseMoveEvent&&this.OnMouseMoveEvent.Callback;if(!e)return}if(this.PointInfo&&(this.PointInfo.ClientPos==2||this.PointInfo.ClientPos==3||this.PointInfo.ClientPos>=200&&this.PointInfo.ClientPos<=299||this.PointInfo.ClientPos>=300&&this.PointInfo.ClientPos<=399)){this.Canvas.save(),this.DrawCallAuction(),this.Canvas.restore();return}if(!this.Data||!this.Data.Data||this.Data.Data.length<=0){this.DrawNone();return}if(this.CursorIndex==null&&!(this.GlobalOption&&this.GlobalOption.IsDisplayLatest)){this.DrawNone();return}this.Canvas.font=this.Font,this.SpaceWidth=this.Canvas.measureText("0").width;var a=!1;if(this.DrawStatus&&this.DrawStatus.IsTitleShowLatestData){var r=this.DrawStatus;(!v.IsNumber(r.FrameID)||r.FrameID<0||r.CorssCursorTouchEnd&&r.IsOnTouch==!1)&&(a=!0)}else this.GlobalOption&&this.GlobalOption.IsDisplayLatest&&(a=!0);var t=!1;if(a){var n=null,s=this.GetLatestKLineData(!0);s&&s.Type==0&&(n=s.Data),t=!0}else{var o=this.CursorIndex;o=parseInt(o.toFixed(0));var l=o+this.Data.DataOffset;l>=this.Data.Data.length&&(l=this.Data.Data.length-1);var n=this.Data.Data[l];l==this.Data.Data.length-1&&(t=!0)}this.LastShowData=n,this.Canvas.save(),this.OnDrawEventCallback(n),this.IsAlwaysShowLastData?this.DrawLastDataItem():this.DrawItem(n,t),this.Canvas.restore()},this.DrawCallAuctionItem=function(e,a){if(e){var r=e.Data,t=this.Frame.IsHScreen===!0,n=B();this.Frame.GetBorder();var s=this.GetLeft(t),o=this.GetRight(t),l=this.GetBottom(t),h=!0;if(t){if(this.Frame.ChartBorder.Right<5*n)return;var u=l,f=s;this.Canvas.translate(u,f),this.Canvas.rotate(90*Math.PI/180),s=l=0}else this.Frame.ChartBorder.Top<5*n&&(h=!1);this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.font=this.Font;var C={Left:s,Bottom:l,MaxRight:o,IsHScreen:t},D=this.FormatCallAuctionTitle(e);if(h&&D&&v.IsNonEmptyArray(D.AryText))for(var c=0;c<D.AryText.length;++c){var r=D.AryText[c];if(!this.DrawText(r.Text,r.Color,C))break}}},this.DrawLastDataItem=function(){var e=this.GetLatestKLineData(!0);e&&(e.Type==0?this.DrawItem(e.Data,!0):(e.Type==1||e.Type==2)&&this.DrawCallAuctionItem(e,!0))}}var is={DEFAULT:1,ORIGINAL:2,INTEGER:3,THOUSANDS:21};function re(e,a,r){this.Data=e,this.Name=a,this.Color=r,this.DataType,this.ChartClassName,this.StringFormat=is.DEFAULT,this.FloatPrecision=2,this.IsShow=!0,this.Callback,this.ExtendData}function Qa(){this.newMethod=sl,this.newMethod(),delete this.newMethod,this.ClassName="DynamicChartTitlePainting",this.IsDynamic=!0,this.Data=[],this.Explain,this.ColorIndex,this.IsShowColorIndexTitle=!0,this.IsShowUpDownArrow=!0,this.TitleArrowType=0,this.IsShowIndexName=!0,this.IsShowIndexTitle=!0,this.IsShowNameArrow=!1,this.NameArrowConfig=At(d.IndexTitle.NameArrow),this.TradeIndex,this.IsShowTradeIndexTitle=!0,this.OverlayIndex=new Dt.default,this.IsShowOverlayIndexName=!0,this.OverlayIndexType={Position:0,LineSpace:5,BGColor:d.OverlayIndexTitleBGColor},this.LanguageID=xe.LANGUAGE_CHINESE_ID,this.TitleRect,this.IsDrawTitleBG=!1,this.BGColor=d.IndexTitleBGColor,this.BGBorderColor=d.IndexTitleBorderColor,this.BGBorderMoveOnColor=d.IndexTitleBorderMoveOnColor,this.BorderRoundRadius=2,this.NameButtonStyle=d.IndexTitleBorderStyle,this.OnDrawEvent,this.ParamSpace=2,this.TitleSpace=2,this.TitleColor=d.IndexTitleColor,this.SelectedColor=d.IndexTitleSelectedColor,this.IsKLineFrame=!1,this.IsMinuteFrame=!1,this.Identify,this.SelectedChart,this.ArgumentsText,this.MerginLeft=d.IndexTitleMerginLeft,this.Buttons=[],this.UpDownArrowConfig={UpColor:d.IndexTitle.UpDownArrow.UpColor,DownColor:d.IndexTitle.UpDownArrow.DownColor,UnchangeColor:d.IndexTitle.UpDownArrow.UnchangeColor},this.DynamicTitle={OutName:null,OutValue:null},this.OverlayDynamicTitle=new Dt.default,this.IsShowMainIndexTitle=!0,this.MainTitlePaint=null,this.ReloadResource=function(){this.Font=d.TitleFont,this.TitleColor=d.DefaultTextColor,this.OverlayIndexType.BGColor=d.OverlayIndexTitleBGColor},this.SetDynamicTitleData=function(e,a,r){r.OutName?r.OutName.clear():r.OutName=new Dt.default,r.OutValue?r.OutValue.clear():r.OutValue=new Dt.default;var t=new Dt.default;for(var n in a){var s=a[n];t.set("{"+s.Name+"}",s)}for(var n in e){var s=e[n];if(s.DynamicName){var o=s.DynamicName.match(/{\w*}/i);if(!o||o.length<=0)r.OutName.set(s.Name,s.DynamicName);else{for(var l=s.DynamicName,h=!0,u=0;u<o.length;++u){var f=o[u];if(t.has(f)){var C=t.get(f).Value;l=l.replace(f,C.toString())}else{h=!1;break}}h&&r.OutName.set(s.Name,l)}}s.DynamicValue&&r.OutValue.set(s.Name,s.DynamicValue)}},this.SetDynamicTitle=function(e,a,r){if(v.IsString(r)){var t=null;this.OverlayDynamicTitle.has(r)?t=this.OverlayDynamicTitle.get(r):(t={OutName:null,OutValue:null},this.OverlayDynamicTitle.set(r,t)),this.SetDynamicTitleData(e,a,t)}else this.SetDynamicTitleData(e,a,this.DynamicTitle)},this.GetDynamicOutName=function(e,a){if(v.IsString(a)){if(!this.OverlayDynamicTitle.has(a))return null;var r=this.OverlayDynamicTitle.get(a),t=r.OutName}else var t=this.DynamicTitle.OutName;return!t||t.size<=0||!t.has(e)?null:t.get(e)},this.GetDynamicOutValue=function(e,a){var r=this.DynamicTitle.OutValue;if(!r||r.size<=0||!r.has(e))return null;var t=r.get(e);return t=t.replace("{Value}",a),t},this.IsClickTitle=function(e,a){return this.TitleRect?e>this.TitleRect.Left&&e<this.TitleRect.Left+this.TitleRect.Width&&a>this.TitleRect.Top&&a<this.TitleRect.Top+this.TitleRect.Height:!1},this.FormatValue=function(e,a){if(a.StringFormat==is.DEFAULT)return v.FormatValueString(e,a.FloatPrecision,this.LanguageID);if(a.StringFormat==is.THOUSANDS)return v.FormatValueThousandsString(e,a.FloatPrecision);if(a.StringFormat==is.ORIGINAL)return e.toFixed(a.FloatPrecision).toString();if(a.StringFormat==is.INTEGER)return v.FromatIntegerString(e,a.FloatPrecision,this.LanguageID)},this.FormatMultiReport=function(e,a){var r="";for(var t in e){var n=e[t],s=n.Quarter,o=n.Year,l=n.Value;switch(r.length>0&&(r+=","),r+=o.toString(),s){case 1:r+="一季报 ";break;case 2:r+="半年报 ";break;case 3:r+="三季报 ";break;case 4:r+="年报 ";break}r+=this.FormatValue(l,a)}return r},this.FromatMultiDataLine=function(e,a){var r="";if(Array.isArray(e))for(var t=0;t<e.length;++t){var n=e[t];if(n.Type!=0&&v.IsNumber(n.Value)){var s=this.FormatValue(n.Value,a);r.length>0&&(r+=","),r+=s}}else e.Type!=0&&v.IsNumber(e.Value)&&(r=this.FormatValue(e.Value,a));return r.length<=0?null:r},this.FromatStackedBarTitle=function(e,a){if(!v.IsNonEmptyArray(e)||!v.IsNonEmptyArray(a.Color))return null;for(var r=[],t=0;t<e.length;++t){var n=e[t];if(v.IsNumber(n)){var s={Text:n.toFixed(2)};a.Name&&a.Name[t]&&(s.Name=a.Name[t]),s.Color=a.Color[t],r.push(s)}}return r.length<=0?null:r},this.ForamtMultiLineTitle=function(e,a){if(!v.IsNonEmptyArray(a.Lines))return null;for(var r=[],t=0;t<a.Lines.length;++t)for(var n=a.Lines[t],s=0;s<n.Point.length;++s){var o=n.Point[s];if(o.Index==e){var o={Text:o.Value.toFixed(2)};r.length==0&&(o.Name=a.Name),o.Color=n.Color,r.push(o);break}}return v.IsNonEmptyArray(r)?r:null},this.ForamtMultiPointTitle=function(e,a){if(!v.IsNonEmptyArray(a.PointGroup))return null;for(var r=[],t=0;t<a.PointGroup.length;++t)for(var n=a.PointGroup[t],s=0;s<n.Point.length;++s){var o=n.Point[s];if(o.Index==e){var o={Text:o.Value.toFixed(2)};r.length==0&&(o.Name=a.Name),o.Color=n.BGColor,r.push(o);break}}return v.IsNonEmptyArray(r)?r:null},this.FormatVPVRTitle=function(e,a){var r=a.Chart,t=[];if(r.VolType==0){var n={Text:" Up/Down ",Color:this.TitleColor};t.push(n)}else{var n={Text:" Total ",Color:this.TitleColor};t.push(n)}if(!v.IsNumber(e.Y))return t;var s=this.Frame.ChartBorder.GetTopEx(),o=this.Frame.ChartBorder.GetBottomEx();if(e.Y<s||e.Y>o)return t;for(var l=this.Frame.GetYData(e.Y),h=null,u=0;u<a.Data.Data.length;++u){var n=a.Data.Data[u];if(l>=n.Price-a.Data.PriceOffset/2&&l<n.Price+a.Data.PriceOffset/2){h=n;break}}if(!h)return null;if(r.VolType==0){for(var f=0,u=0;u<h.Vol.length;++u){var C=h.Vol[u];if(v.IsNumber(C.Value)){var n={Text:v.FormatVolString(C.Value,this.LanguageID)};f+=C.Value,v.IsNumber(C.ColorID)?n.Color=r.BarColor[C.ColorID]:C.Color&&(n.Color=C.Color),t.push(n)}}var n={Text:v.FormatVolString(f,this.LanguageID),Color:this.TitleColor};t.push(n)}else if(h.TotalVol&&v.IsNumber(h.TotalVol.Value)){var n={Text:v.FormatVolString(h.TotalVol.Value,this.LanguageID)};v.IsNumber(h.TotalVol.ColorID)?n.Color=r.BarColor[h.TotalVol.ColorID]:h.TotalVol.Color&&(n.Color=h.TotalVol.Color),t.push(n)}return t},this.IsShowLastData=function(){var e=!1;if(this.DrawStatus&&this.DrawStatus.IsTitleShowLatestData){var a=this.DrawStatus;(!v.IsNumber(a.FrameID)||a.FrameID<0||a.CorssCursorTouchEnd&&a.IsOnTouch==!1)&&(e=!0)}else this.GlobalOption&&this.GlobalOption.IsDisplayLatest&&(e=!0);return e},this.OnDrawTitleEvent=function(){var e=this.GetEventCallback($.ON_INDEXTITLE_DRAW);if(e){var a={Index:null,Data:this.Data,Title:this.Title,Script:this.Script,FrameID:this.Frame.Identify,OverlayIndex:this.OverlayIndex,IsShowTitleOnly:!1};if(this.ArgumentsText&&(a.ArgumentsText=this.ArgumentsText),this.Frame&&this.Frame.ChartBorder&&(a.IsShowTitleOnly=this.Frame.ChartBorder.IsShowTitleOnly),v.IsNumber(this.CursorIndex)){var r=Math.abs(this.CursorIndex);r=parseInt(r.toFixed(0)),a.Index=r}var t=B(),n=this.Frame.GetBorder();a.Left=n.LeftEx/t,a.Top=n.Top/t,a.Right=n.RightEx/t,e.Callback(e,a,this)}},this.IsSelectedChart=function(e){return!e||!this.SelectedChart||!this.SelectedChart.Selected?!1:this.SelectedChart.Selected.Identify==e},this.Draw=function(e,a){if(this.Buttons=[],!this.Frame.IsMinSize&&(this.IsKLineFrame=this.Frame.IsKLineFrame(!1),this.IsMinuteFrame=this.Frame.IsMinuteFrame(!1),this.IsDrawTitleBG=this.Frame.IsDrawTitleBG,this.IsShowNameArrow=this.Frame.IsShowNameArrow,this.IsShowUpDownArrow=this.Frame.IsShowTitleArrow,this.TitleArrowType=this.Frame.TitleArrowType,this.IsShowIndexName=this.Frame.IsShowIndexName,this.IsShowOverlayIndexName=this.Frame.IsShowOverlayIndexName,this.OverlayIndexType.Position=this.Frame.OverlayIndexType.Position,this.OverlayIndexType.LineSpace=this.Frame.OverlayIndexType.LineSpace,this.ParamSpace=this.Frame.IndexParamSpace,this.TitleSpace=this.Frame.IndexTitleSpace,this.TitleRect=null,this.GlobalOption=this.Frame.GlobalOption,this.OnDrawTitleEvent(),this.Frame.IsShowIndexTitle!=!1&&d.IsDOMFrameTitle!==!0&&this.Data&&!(this.Frame.ChartBorder.TitleHeight<5)&&!(this.CursorIndex==null&&!(this.GlobalOption&&this.GlobalOption.IsDisplayLatest)))){if(this.Frame.IsHScreen===!0){this.Canvas.save(),this.HScreenDraw(),this.Canvas.restore();return}var r=this.Frame.ChartBorder.GetLeft()+this.MerginLeft,t=this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.TitleHeight/2,n=this.Frame.ChartBorder.GetRight(),s={Width:0,YCenter:t};this.DrawToolbar(s,e,a),r+=s.Width,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font;var o=B();if(this.Title&&this.IsShowIndexName&&this.IsShowMainIndexTitle)if(this.IsDrawTitleBG){var l={Left:r,YCenter:t,Width:0};this.DrawNameButton(l,e,a),this.Buttons.push({ID:Rt.INDEX_NAME_BUTTON,Rect:l,FrameID:this.Frame.Identify,Type:2}),this.IsSelectedChart(this.Identify)&&this.DrawSelectedLine(r,t,h),this.TitleRect=l,r+=l.Width+3*o,r+=this.TitleSpace}else{var h=this.Canvas.measureText(this.Title).width+2;this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(this.Title,r,t,h),this.IsSelectedChart(this.Identify)&&this.DrawSelectedLine(r,t,h),r+=h,r+=this.TitleSpace}if(this.ArgumentsText&&this.IsShowIndexName&&this.IsShowMainIndexTitle){var h=this.Canvas.measureText(this.ArgumentsText).width+2;this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(this.ArgumentsText,r,t,h),r+=h,r+=this.TitleSpace}var u=this.IsShowLastData(),f=this.Frame.GetLockRect();if(f){var C=Math.abs(this.CursorIndex);this.IsKLineFrame&&(C=this.CursorIndex);var D=this.Frame.GetXFromIndex(C.toFixed(0));if(D>=f.Left||u)return}var c={Left:r,Right:r};if(this.IsMinuteFrame&&this.PointInfo&&(this.PointInfo.ClientPos==2||this.PointInfo.ClientPos==3||this.PointInfo.ClientPos>=200&&this.PointInfo.ClientPos<=299||this.PointInfo.ClientPos>=300&&this.PointInfo.ClientPos<=399)){var T={PreventDefault:!1};this.DrawMainCallAuction({Left:r,Right:n,Bottom:t},c,T),T.PreventDefault===!1&&this.DrawMainIndexTitle({Left:r,Right:n,Bottom:t},u,c)}else this.DrawMainIndexTitle({Left:r,Right:n,Bottom:t},u,c);if(r=c.Left,this.Explain){this.Canvas.fillStyle=this.TitleColor;var S="说明:"+this.Explain,h=this.Canvas.measureText(S).width+2;r+h<n&&(this.Canvas.fillText(S,r,t,h),r+=h)}if(this.ColorIndex&&this.IsShowColorIndexTitle){this.Canvas.fillStyle=d.Title.ColorIndexColor;var I=this.ColorIndex.Name+this.ColorIndex.Param,h=this.Canvas.measureText(I).width+2;this.Canvas.fillText(I,r,t,h),r+=h}if(this.TradeIndex&&this.IsShowTradeIndexTitle){this.Canvas.fillStyle=d.Title.TradeIndexColor;var I=this.TradeIndex.Name+this.TradeIndex.Param,h=this.Canvas.measureText(I).width+2;this.Canvas.fillText(I,r,t,h),r+=h}if(this.OverlayIndexType.Position==1)this.Frame.ChartBorder.IsShowTitleOnly||this.DrawOverlayIndexSingleLine(e,a);else{var g=10*B();this.IsShowMainIndexTitle||(g=0),this.DrawOverlayIndex(r+g)}}},this.GetTitleItem=function(e,a,r){if(!e||!e.Data||!e.Data.Data||Array.isArray(e.Data.Data)&&e.Data.Data.length<=0||e.IsShow===!1||e.IsVisible===!1)return null;var t=null,n=null,s=null,o=null;if(e.DataType=="StraightLine")s=e.Data.Data[0],t=this.FormatValue(s,e);else{if(e.ChartClassName=="ChartVolProfileVisibleRange")return n=this.FormatVPVRTitle(this.LastPoint,e),n?{Text:null,ArrayText:n}:null;if(a)var l=e.Data.Data.length-1;else{var h=Math.abs(this.CursorIndex);h=parseInt(h.toFixed(0)),this.IsKLineFrame&&(h=this.CursorIndex);var l=e.Data.DataOffset+h;if(l>=e.Data.Data.length&&(l=e.Data.Data.length-1),l<0)return null}if(e.DataType=="ChartMultiLine")return n=this.ForamtMultiLineTitle(l,e),n?{Text:null,ArrayText:n}:null;if(e.DataType=="ChartMultiPoint")return n=this.ForamtMultiPointTitle(l,e),n?{Text:null,ArrayText:n}:null;if(s=e.Data.Data[l],s==null&&e.ChartClassName=="ChartStepLine"){if(o=this.GetPreVaildItem(e.Data.Data,l),!o)return null;if(preText=this.FormatValue(o.Item,e),e.Name){var u=this.GetDynamicOutValue(e.Name,preText);u&&(preText=u)}return t="--("+preText+")",{Text:t,ArrayText:n}}if(s==null)return null;if(e.DataType=="HistoryData-Vol")s=s.Vol,t=this.FormatValue(s,e);else if(e.DataType=="MultiReport")t=this.FormatMultiReport(s,e);else if(e.DataType=="MULTI_POINT_LINE"){if(t=this.FromatMultiDataLine(s,e),!t)return null}else{if(e.DataType=="ChartStackedBar")return n=this.FromatStackedBarTitle(s,e),n?{Text:null,ArrayText:n}:null;if(Ei.Has(e.DataType)){var f=Ei.Get(e.DataType);if(f&&f.FormatTitleCallback)return f.FormatTitleCallback(s,e,l)}else{if(this.GetEventCallback){var C=this.GetEventCallback($.ON_FORMAT_INDEX_OUT_TEXT);if(C){var D={Item:e,Index:r,Data:this.Data,FrameID:this.Frame.Identify,DataIndex:l,Value:s,Out:null};if(C.Callback(C,D,this),D.Out)return D.Out}}if(e.DataType=="ChartBand")return null;var c=null;if(this.IsShowUpDownArrow){var T=null;l-1>=0&&(T=e.Data.Data[l-1]),v.IsNumber(T)&&(T>s?c={Text:"↓",TextColor:this.UpDownArrowConfig.DownColor}:T<s?c={Text:"↑",TextColor:this.UpDownArrowConfig.UpColor}:c={Text:"→",TextColor:this.UpDownArrowConfig.UnchangeColor},this.TitleArrowType==1&&(c.TextColor=e.Color))}if(t=this.FormatValue(s,e),e.Name){var u=this.GetDynamicOutValue(e.Name,t);u&&(t=u)}if(c){var S={Name:null,Text:t,Color:e.Color,TextEx:[c]};if(e.Name){var I=e.Name,g=this.GetDynamicOutName(e.Name);g&&(I=g),S.Name=I}n=[S],t=null}}}}return{Text:t,ArrayText:n}},this.DrawMainIndexTitle=function(e,a,r){if(this.IsShowMainIndexTitle){for(var t=e.Left,n=e.Right,s=e.Bottom,o=0;o<this.Data.length;++o){var l=this.Data[o],h=this.GetTitleItem(l,a,o);if(h){var u=h.Text,f=h.ArrayText;if(f)for(var C,D=0;D<f.length;++D){var c=f[D];c.Name?C=c.Name+":"+c.Text:C=c.Text;var T=this.ParamSpace*B(),S=this.Canvas.measureText(C).width,I=S;if(v.IsNonEmptyArray(c.TextEx))for(var g=t,E=0;E<c.TextEx.length;++E){var F=c.TextEx[E],R=this.Canvas.measureText(F.Text).width+2;F.Width=R,F.Left=g,I+=R,g+=R}if(t+I+T>n)break;if(c.BG){var A=this.Canvas.measureText("擎").width+2,P={Left:t,Top:s-A/2,Width:I,Height:A};if(this.Canvas.fillStyle=c.BG,this.Canvas.fillRect(P.Left,P.Top-1,P.Width,P.Height),this.Canvas.fillStyle=c.Color,this.Canvas.fillText(C,P.Left+1,s,S),t+=S,v.IsNonEmptyArray(c.TextEx))for(var E=0;E<c.TextEx.length;++E){var F=c.TextEx[E];this.Canvas.fillStyle=F.TextColor,this.Canvas.fillText(F.Text,t,s,F.Width),t+=F.Width}t+=T}else{if(this.Canvas.fillStyle=c.Color,this.Canvas.fillText(C,t,s,S),t+=S,v.IsNonEmptyArray(c.TextEx))for(var E=0;E<c.TextEx.length;++E){var F=c.TextEx[E];this.Canvas.fillStyle=F.TextColor,this.Canvas.fillText(F.Text,t,s,F.Width),t+=F.Width}t+=T}}else{this.Canvas.fillStyle=l.Color;var C=u;if(l.Name){var p=this.GetDynamicOutName(l.Name);p?C=p+":"+u:C=l.Name+":"+u}var T=this.ParamSpace*B(),I=this.Canvas.measureText(C).width+T;if(t+I>n)break;this.Canvas.fillText(C,t,s,I),t+=I}}}r.Left=t}},this.DrawMainCallAuction=function(e,a,r){if(this.IsShowMainIndexTitle&&this.MainTitlePaint){var t=this.MainTitlePaint.GetCurrentAuctionData();if(!(!t||!t.Data)&&this.GetEventCallback){var n=this.GetEventCallback($.ON_FORMAT_CALL_AUCTION_INDEX_TITLE);if(n){var s={AuctionData:t,Data:this.Data,FrameID:this.Frame.Identify,Out:null,PreventDefault:!1};if(n.Callback(n,s,this),r.PreventDefault=s.PreventDefault,!!v.IsNonEmptyArray(s.Out)){for(var o=e.Left,l=e.Right,h=e.Bottom,u=B(),f=s.Out,C=0;C<f.length;++C){var D=f[C];if(D.Text){var c=this.Canvas.measureText(D.Text).width+2;if(o+c>l)break;if(D.BGColor){var T=this.Canvas.measureText("擎").width+2,S={Left:o,Top:h-T/2,Width:c,Height:T};this.Canvas.fillStyle=D.BGColor,this.Canvas.fillRect(S.Left,S.Top-1,S.Width,S.Height),o+=1}this.Canvas.fillStyle=D.Color,this.Canvas.fillText(D.Text,o,h,c),o+=c,v.IsPlusNumber(D.Space)&&(o+=D.Space*u)}}a.Left=o}}}}},this.GetCallAuctionTitleItem=function(e,a,r){if(e.IsShow===!1||e.IsVisible===!1||!e||!e.Data||!e.Data.Data)return null;if(Ei.Has(e.DataType)){var t=Ei.Get(e.DataType);if(t&&t.FormatTitleCallback)return t.FormatTitleCallback(value,e,dataIndex)}},this.GetPreVaildItem=function(e,a){for(var r=a;r>=0;--r){var t=e[r];if(t)return{Item:t,Index:r}}return null},this.DrawSelectedLine=function(e,a,r){this.Canvas.save();var t=this.GetFontHeight();this.Canvas.strokeStyle=this.SelectedColor;var n=4,s=$t(n,a+t/2);this.Canvas.lineWidth=n,this.Canvas.beginPath(),this.Canvas.moveTo(e,s),this.Canvas.lineTo(e+r,s),this.Canvas.stroke(),this.Canvas.restore()},this.DrawOverlayIndexSingleLine=function(e,a){var r=B(),t=this.Frame.GetBorder();if(this.Frame.IsHScreen===!0)var n=1,s=2*r,o=this.Frame.ChartBorder.GetHeight(),l=this.Frame.ChartBorder.GetWidthEx();else{var s=t.TopTitle+2*r;this.IsShowMainIndexTitle||(s=this.Frame.ChartBorder.GetTop()+2*r);var n=this.Frame.ChartBorder.GetLeft()+this.MerginLeft,o=t.Right,l=t.Bottom}var h=this.OverlayIndexType.LineSpace*r,u=n,f=s,C=Ea(this.Canvas,this.Font,"擎");f=s+C/2;var D=!0,c=!1,T=void 0;try{for(var S=(0,ye.default)(this.OverlayIndex),I;!(D=(I=S.next()).done);D=!0){p=I.value;var g=p[1],E=p[0],F={Width:0,YCenter:f,ID:E};if(this.DrawOverlayToolbar(g,F,e,a),!!g.IsShowIndexTitle&&g.Frame.IsShowIndexTitle){if(u=n+F.Width,this.Canvas.font=this.Font,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",g.Title&&this.IsShowOverlayIndexName){var R=this.Canvas.measureText(g.Title).width+2;if(u+R<o){if(this.OverlayIndexType.BGColor){this.Canvas.fillStyle=this.OverlayIndexType.BGColor;var A={Left:u,Top:f-C/2,Width:R,Height:C+h};this.Canvas.fillRect(A.Left,A.Top,A.Width,A.Height)}this.IsSelectedChart(E)&&this.DrawSelectedLine(u,f,R,g.Title),this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(g.Title,u,f,R)}u+=R}for(var P=0;P<g.Data.length;++P){var p=g.Data[P];if(!(!p||!p.Data||!p.Data.Data||!p.Name)&&p.IsVisible!==!1&&!(p.Data.Data.length<=0)){var w=null,H=null,W=null;if(p.DataType=="StraightLine")w=p.Data.Data[0],H=this.FormatValue(w,p);else{var ht=Math.abs(this.CursorIndex-.5);ht=parseInt(ht.toFixed(0)),this.IsKLineFrame&&(ht=this.CursorIndex);var rt=p.Data.DataOffset+ht;if(rt>=p.Data.Data.length&&(rt=p.Data.Data.length-1),rt<0||(w=p.Data.Data[rt],w==null))continue;if(p.DataType=="HistoryData-Vol")w=w.Vol,H=this.FormatValue(w,p);else if(p.DataType=="MultiReport")H=this.FormatMultiReport(w,p);else if(p.DataType=="ChartStackedBar"){if(W=this.FromatStackedBarTitle(w,p),!W)continue}else H=this.FormatValue(w,p)}if(W)for(var nt,vt=0;vt<W.length;++vt){var Nt=W[vt];Nt.Name?nt=Nt.Name+":"+Nt.Text:nt=Nt.Text;var R=this.Canvas.measureText(nt).width+2;if(u+R>o)break;if(this.OverlayIndexType.BGColor){this.Canvas.fillStyle=this.OverlayIndexType.BGColor;var A={Left:u,Top:f-C/2,Width:R,Height:C+h};this.Canvas.fillRect(A.Left,A.Top,A.Width,A.Height)}this.Canvas.fillStyle=Nt.Color,this.Canvas.fillText(nt,u,f,R),u+=R}else{var nt=H;if(p.Name){var Ft=this.GetDynamicOutName(p.Name,E);Ft?nt=Ft+":"+H:nt=p.Name+":"+H}var R=this.Canvas.measureText(nt).width+2;if(u+R>o)break;if(this.OverlayIndexType.BGColor){this.Canvas.fillStyle=this.OverlayIndexType.BGColor;var A={Left:u,Top:f-C/2,Width:R,Height:C+h};this.Canvas.fillRect(A.Left,A.Top,A.Width,A.Height)}this.Canvas.fillStyle=p.Color,this.Canvas.fillText(nt,u,f,R),u+=R}}}if(f+=C+h,f+C+h>=l)break}}}catch(Bt){c=!0,T=Bt}finally{try{!D&&S.return&&S.return()}finally{if(c)throw T}}},this.DrawOverlayIndex=function(e){var a=this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.TitleHeight/2,r=this.Frame.ChartBorder.GetRight();if(this.Frame.IsHScreen===!0&&(a=-this.Frame.ChartBorder.TitleHeight/2,r=this.Frame.ChartBorder.GetHeight()),!(e>r)){var t=5*B(),n=e,s=0,o=!0,l=!1,h=void 0;try{for(var u=(0,ye.default)(this.OverlayIndex),f;!(o=(f=u.next()).done);o=!0){S=f.value,s>0&&(e+=t);var C=S[1],D=S[0];if(C.Title&&this.IsShowOverlayIndexName){this.Canvas.fillStyle=this.TitleColor;var c=this.Canvas.measureText(C.Title).width+2;if(n=e,e+=c,e>r)break;this.Canvas.fillText(C.Title,n,a,c),this.IsSelectedChart(D)&&this.DrawSelectedLine(n,a,c)}for(var T in C.Data){var S=C.Data[T];if(!(!S||!S.Data||!S.Data.Data||!S.Name)&&!(S.Data.Data.length<=0)){var I=null,g=null;if(S.DataType=="StraightLine")I=S.Data.Data[0],g=this.FormatValue(I,S);else{var E=Math.abs(this.CursorIndex-.5);E=parseInt(E.toFixed(0)),this.IsKLineFrame&&(E=this.CursorIndex);var F=S.Data.DataOffset+E;if(F>=S.Data.Data.length&&(F=S.Data.Data.length-1),F<0||(I=S.Data.Data[F],I==null))continue;S.DataType=="HistoryData-Vol"?(I=I.Vol,g=this.FormatValue(I,S)):S.DataType=="MultiReport"?g=this.FormatMultiReport(I,S):g=this.FormatValue(I,S)}this.Canvas.fillStyle=S.Color;var R=S.Name+":"+g,c=this.Canvas.measureText(R).width+2;if(n=e,e+=c,e>r)break;this.Canvas.fillText(R,n,a,c)}}if(e>r)break;++s}}catch(A){l=!0,h=A}finally{try{!o&&u.return&&u.return()}finally{if(l)throw h}}}},this.HScreenDraw=function(){var e=this.Frame.ChartBorder.GetHScreenBorder(),a=this.Frame.ChartBorder.GetRightTitle(),r=e.TopEx;this.Canvas.translate(a,r),this.Canvas.rotate(90*Math.PI/180);var t=1,n=-this.Frame.ChartBorder.TitleHeight/2,s=this.Frame.ChartBorder.GetHeight();this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font;var o=B();if(this.Title&&this.IsShowIndexName){var l=this.Canvas.measureText(this.Title).width+2;if(this.IsDrawTitleBG){var h=this.Title,l=this.Canvas.measureText(h).width,u=0;this.IsShowNameArrow&&this.NameArrowConfig&&(u=this.Canvas.measureText(this.NameArrowConfig.Symbol).width,v.IsNumber(this.NameArrowConfig.Space)&&(u+=this.NameArrowConfig.Space));var f=this.Canvas.measureText("擎").width+4*o,C=l+u+4*o;this.TitleRect={Top:e.Top,Left:this.Frame.ChartBorder.GetRightTitle()+this.Frame.ChartBorder.TitleHeight/2-f/2,Width:f,Height:C},this.Canvas.fillStyle=this.BGColor;var D={Left:t,Top:n-f/2,Width:C,Height:f};this.Canvas.fillRect(D.Left,D.Top,D.Width,D.Height),this.BGBorderColor&&(this.Canvas.strokeStyle=this.BGBorderColor,this.Canvas.strokeRect(L(D.Left),L(D.Top),b(D.Width),b(D.Height)));var a=t+2*o;this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(h,a,n),a+=l,this.IsShowNameArrow&&this.NameArrowConfig&&(v.IsNumber(this.NameArrowConfig.Space)&&(a+=this.NameArrowConfig.Space),this.Canvas.fillStyle=this.NameArrowConfig.Color,this.Canvas.fillText(this.NameArrowConfig.Symbol,a,n)),t+=C+2*o,t+=this.TitleSpace}else this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(this.Title,t,n),t+=l,t+=this.TitleSpace}if(this.ArgumentsText&&this.IsShowIndexName){var l=this.Canvas.measureText(this.ArgumentsText).width+2;this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(this.ArgumentsText,t,n,l),t+=l,t+=this.TitleSpace}var c=this.IsShowLastData(),T=this.Frame.GetLockRect();if(T){var S=Math.abs(this.CursorIndex-.5);this.IsKLineFrame&&(S=this.CursorIndex);var I=this.Frame.GetXFromIndex(S.toFixed(0));if(I>=T.Top||c)return}for(var g in this.Data){var E=this.Data[g],F=this.GetTitleItem(E,c);if(F){var R=F.Text,A=F.ArrayText;if(A)for(var P,p=0;p<A.length;++p){var w=A[p];w.Name?P=w.Name+":"+w.Text:P=w.Text;var H=this.ParamSpace*B(),l=this.Canvas.measureText(P).width+H;if(t+l>s)break;this.Canvas.fillStyle=w.Color,this.Canvas.fillText(P,t,n,l),t+=l}else{this.Canvas.fillStyle=E.Color;var P=R;if(E.Name){var W=this.GetDynamicOutName(E.Name);W?P=W+":"+R:P=E.Name+":"+R}var H=this.ParamSpace*B(),l=this.Canvas.measureText(P).width+H;if(t+l>s)break;this.Canvas.fillText(P,t,n,l),t+=l}}}if(this.Explain){this.Canvas.fillStyle=this.TitleColor;var P="说明:"+this.Explain,l=this.Canvas.measureText(P).width+2;t+l<s&&(this.Canvas.fillText(P,t,n,l),t+=l)}this.OverlayIndexType.Position==1?this.Frame.ChartBorder.IsShowTitleOnly||this.DrawOverlayIndexSingleLine():this.DrawOverlayIndex(t+5*B())},this.OnDrawEventCallback=function(e){if(!(!this.OnDrawEvent||!this.OnDrawEvent.Callback)){var a={Draw:e,Name:"DynamicChartTitlePainting"};this.OnDrawEvent.Callback(this.OnDrawEvent,a,this)}},this.GetFontHeight=function(e){return Ea(this.Canvas,e,"擎")},this.DrawNameButton=function(e,a,r){var t=B(),n=this.Title,s=this.Canvas.measureText(n).width,o=0;this.IsShowNameArrow&&this.NameArrowConfig&&(o=this.Canvas.measureText(this.NameArrowConfig.Symbol).width,v.IsNumber(this.NameArrowConfig.Space)&&(o+=this.NameArrowConfig.Space));var l=this.Canvas.measureText("擎").width+4*t,h=this.BorderRoundRadius*t,u=s+o+4*t+h*2;e.Top=e.YCenter-l/2-1,e.Width=u,e.Height=l,e.Right=e.Left+e.Width,e.Bottom=e.Top+e.Height;var f=this.BGBorderColor;if(a&&a.X>=e.Left&&a.X<e.Right&&a.Y>=e.Top&&a.Y<=e.Bottom&&(this.BGBorderMoveOnColor&&(f=this.BGBorderMoveOnColor),r)){var C={ID:Rt.INDEX_NAME_BUTTON};r.MouseOnToolbar={ID:"IndexNameButton",Rect:e,Item:C,Frame:this.Frame,Point:{X:a.X,Y:a.Y}}}this.Canvas.roundRect&&this.NameButtonStyle==1?(this.Canvas.beginPath(),this.Canvas.roundRect(L(e.Left),L(e.Top),b(e.Width),b(e.Height),[h]),this.Canvas.closePath(),this.Canvas.fillStyle=this.BGColor,this.Canvas.fill(),f&&(this.Canvas.strokeStyle=f,this.Canvas.stroke())):(this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(e.Left,e.Top,e.Width,e.Height),f&&(this.Canvas.strokeStyle=f,this.Canvas.strokeRect(L(e.Left),L(e.Top),b(e.Width),b(e.Height),[h])));var D=e.Left+h+2*t;this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(n,D,e.YCenter),D+=s,this.IsShowNameArrow&&this.NameArrowConfig&&(v.IsNumber(this.NameArrowConfig.Space)&&(D+=this.NameArrowConfig.Space),this.Canvas.fillStyle=this.NameArrowConfig.Color,this.Canvas.fillText(this.NameArrowConfig.Symbol,D,e.YCenter))},this.DrawButton=function(e,a,r,t){var n=e.Style.Size;v.IsNumber(e.Style.YMoveOffset)&&(a.YCenter+=e.Style.YMoveOffset);var s=n+"px "+e.Style.Family;a.Top=a.YCenter-n/2,a.Width=n+e.Style.MerginLeft,a.Height=n,a.Bottom=a.Top+a.Height,a.Right=a.Left+a.Width;var o=e.Style.Color;return r&&r.X>=a.Left&&r.X<a.Right&&r.Y>=a.Top&&r.Y<=a.Bottom&&(o=e.Style.MoveOnColor,t&&(t.MouseOnToolbar={ID:"TitleButton",Rect:a,Item:e,Frame:this.Frame,Point:{X:r.X,Y:r.Y}})),this.Canvas.fillStyle=o,this.Canvas.font=s,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(e.Style.Text,a.Left,a.YCenter),!0},this.DrawToolbar=function(e,a,r){if(e.Width=0,!(!this.Frame||!this.Frame.GetLeftToolbar)){var t=this.Frame.GetLeftToolbar();if(v.IsNonEmptyArray(t)&&this.Frame.IsHScreen!==!0){var n=this.Frame.GetBorder();n.Right-3;for(var s=n.Left+3,o=e.YCenter,l=0;l<t.length;++l){var h=t[l],u={Left:s,YCenter:o};this.DrawButton(h,u,a,r),this.Buttons.push({ID:h.ID,Rect:u,FrameID:this.Frame.Identify,Type:0,Data:h.Data}),s=u.Right,e.Width+=u.Width}e.Width>0&&(e.Width+=3)}}},this.DrawOverlayToolbar=function(e,a,r,t){if(a.Width=0,!(!e||!e.Frame||!e.Frame.GetLeftToolbar)){var n=e.Frame,s=n.GetLeftToolbar({Overlay:e,OverlayID:a.ID});if(v.IsNonEmptyArray(s)&&this.Frame.IsHScreen!==!0){var o=n.GetBorder();o.Right-3;for(var l=o.Left+3,h=a.YCenter,u=0;u<s.length;++u){var f=s[u],C={Left:l,YCenter:h};this.DrawButton(f,C,r,t),this.Buttons.push({ID:f.ID,Rect:C,FrameID:this.Frame.Identify,Type:1,OverlayID:a.ID,Title:e.Title,Data:f.Data}),l=C.Right,a.Width+=C.Width}a.Width>0&&(a.Width+=3)}}},this.PtInButtons=function(e,a){for(var r=0;r<this.Buttons.length;++r){var t=this.Buttons[r];if(t.Rect){var n=t.Rect;if(e>n.Left&&e<n.Right&&a>n.Top&&a<n.Bottom){var s={ID:t.ID,Rect:n,FrameID:t.FrameID,Type:t.Type,Data:t.Data};return t.Type==1&&(s.Title=t.Title,s.OverlayID=t.OverlayID),s}}}return null}}function gt(){this.Frame,this.Canvas,this.Point=new Array,this.Value=new Array,this.LinePoint=[],this.PointCount=2,this.Status=0,this.PointStatus=0,this.MovePointIndex=null,this.ClassName="IChartDrawPicture",this.FinishedCallback,this.Guid=Re(),this.Symbol,this.Period,this.Right,this.IsSelected=!1,this.Option,this.EnableMove=!0,this.EnableSave=!0,this.EnableCtrlMove=!1,this.OnlyMoveXIndex=!1,this.IsSupportMagnet=!1,this.EnableMoveCheck=!0,this.IsDrawFirst=!1,this.IsShowYCoordinate=!1,this.IsShow=!0,this.LineColor=d.DrawPicture.LineColor[0],this.LineWidth=2,this.BackupLineWidth=null,this.AreaColor="rgba(25,25,25,0.4)",this.PointColor=d.DrawPicture.PointColor[0],this.MoveOnPointColor=d.DrawPicture.PointColor[1],this.PointBGColor=d.DrawPicture.PointColor[2],this.PointRadius=5,this.SquareSize=8,this.PointType=d.DrawPicture.PointType,this.IsShowPoint=d.DrawPicture.IsShowPoint,this.LimitFrameID,this.SetLastPoint=null,this.Update=null,this.GetActiveDrawPicture=null,this.GetYCoordinatePoint=null,this.Draw=function(){},this.SetOption=function(e){e&&(e.LineColor&&(this.LineColor=e.LineColor),e.LineWidth>0&&(this.LineWidth=e.LineWidth),e.AreaColor&&(this.AreaColor=e.AreaColor),e.PointColor&&(this.PointColor=e.PointColor),e.MoveOnPointColor&&(this.MoveOnPointColor=e.MoveOnPointColor),e.PointRadius&&(this.PointRadius=e.PointRadius),v.IsNumber(e.SquareSize)&&(this.SquareSize=e.SquareSize),v.IsBool(e.IsShowPoint)&&(this.IsShowPoint=e.IsShowPoint),v.IsNumber(e.LimitFrameID)&&(this.LimitFrameID=e.LimitFrameID),v.IsBool(e.EnableCtrlMove)&&(this.EnableCtrlMove=e.EnableCtrlMove),v.IsBool(e.IsShowYCoordinate)&&(this.IsShowYCoordinate=e.IsShowYCoordinate))},this.ReloadResource=function(e){e||(this.PointColor=d.DrawPicture.PointColor[0],this.MoveOnPointColor=d.DrawPicture.PointColor[1],this.PointBGColor=d.DrawPicture.PointColor[2])},this.SetLineWidth=function(){this.BackupLineWidth=null,this.LineWidth>0&&(this.BackupLineWidth=this.Canvas.lineWidth,this.Canvas.lineWidth=this.LineWidth*B())},this.GetFontHeight=function(e){return Ea(this.Canvas,e,"擎")},this.RestoreLineWidth=function(){this.BackupLineWidth!=null&&(this.Canvas.lineWidth=this.BackupLineWidth)},this.PointMagnetKLine=function(){if(!this.IsSupportMagnet||!this.Frame||this.Frame.ClassName=="MinuteFrame"||this.Frame.Class=="MinuteHScreenFrame"||this.Frame.Identify!=0)return!1;var e=-1;if(this.Status==2?e=1:this.Status==1?e=0:v.IsNumber(this.MovePointIndex)&&(e=this.MovePointIndex),e<0)return!1;if(this.Option&&this.Option.Magnet&&this.Option.Magnet.Enable){var a={IsFixedX:!1,Magnet:{Enable:!0,PointIndex:e,Distance:this.Option.Magnet.Distance,Type:this.Option.Magnet.Type}};return this.AdjustPoint(this.Point,a)}return!1},this.PointToValue=function(){return this.Frame?this.Frame.ClassName=="MinuteFrame"||this.Frame.Class=="MinuteHScreenFrame"?this.PointToValue_Minute():this.PointToValue_KLine():!1},this.PointToKLine=function(e){if(!this.Frame)return null;var a=this.Frame.Data;if(!a)return null;var r=[],t=this.Frame.IsHScreen;if(t)for(var n in e){var s=e[n],o=parseInt(this.Frame.GetXData(s.Y))+a.DataOffset,l=this.Frame.GetYData(s.X),h={XValue:o,YValue:l},u=a.Data[o];h.DateTime={Date:u.Date},v.IsNumber(u.Time)&&(h.DateTime.Time=u.Time),r[n]=h}else for(var n in e){var s=e[n],f=parseInt(this.Frame.GetXData(s.X,!1)),o=f+a.DataOffset;o<0?o=0:o>=a.Data.length&&(o=a.Data.length-1,f=o-a.DataOffset);var l=this.Frame.GetYData(s.Y,!1),h={XValue:o,YValue:l,XIndex:f},u=a.Data[o];h.DateTime={Date:u.Date},v.IsNumber(u.Time)&&(h.DateTime.Time=u.Time),r[n]=h}return r},this.PointToValue_KLine=function(){if(!this.Frame)return!1;var e=this.Frame.Data;if(!e)return!1;var a=this.Frame.IsHScreen;if(a)for(var r=0;r<this.Point.length;++r){var t=this.Point[r],n=parseInt(this.Frame.GetXData(t.Y,!1))+e.DataOffset,s=this.Frame.GetYData(t.X,!1),o={XValue:n,YValue:s},l=e.Data[n];o.DateTime={Date:l.Date},v.IsNumber(l.Time)&&(o.DateTime.Time=l.Time),this.Value[r]=o}else for(var r=0;r<this.Point.length;++r){var t=this.Point[r],n=parseInt(this.Frame.GetXData(t.X,!1))+e.DataOffset;n<0?n=0:n>=e.Data.length&&(n=e.Data.length-1);var s=this.Frame.GetYData(t.Y,!1),o={XValue:n,YValue:s},l=e.Data[n];o.DateTime={Date:l.Date},v.IsNumber(l.Time)&&(o.DateTime.Time=l.Time),this.Value[r]=o}return!0},this.PointToValue_Minute=function(){if(!this.Frame)return!1;var e=this.Frame.Data;if(!e)return!1;var a=this.Frame.IsHScreen;if(a)for(var r=0;r<this.Point.length;++r){var t=this.Point[r],n=parseInt(this.Frame.GetXData(t.Y,!1)),s=this.Frame.GetYData(t.X,!1),o={XValue:n,YValue:s},l=e.Data[n];o.DateTime={Date:l.Date,Time:l.Time},this.Value[r]=o}else for(var h=Wi.GetTimeData(this.Symbol),r=0;r<this.Point.length;++r){var t=this.Point[r],n=parseInt(this.Frame.GetXData(t.X,!1)),s=this.Frame.GetYData(t.Y,!1);if(n>=e.Data.length){var u=n%h.length,f=e.Data.length-1,o={XValue:n,YValue:s},l=e.Data[f],C=h[u];o.DateTime={Date:l.Date,Time:C},this.Value[r]=o}else{var o={XValue:n,YValue:s},l=e.Data[n];o.DateTime={Date:l.Date,Time:l.Time},this.Value[r]=o}}return!0},this.IsPointIn=function(e,a,r){return!1},this.ValueToPoint=function(){if(!this.Frame)return!1;var e=this.Frame.Data;if(!e)return!1;var a=this.Frame.IsHScreen;this.Point=[];for(var r=0;r<this.Value.length;++r){var t=this.Value[r],n=new ft;a?(n.Y=this.Frame.GetXFromIndex(t.XValue-e.DataOffset,!1),n.X=this.Frame.GetYFromData(t.YValue,!1)):(n.X=this.Frame.GetXFromIndex(t.XValue-e.DataOffset,!1),n.Y=this.Frame.GetYFromData(t.YValue,!1)),this.Point[r]=n}},this.UpdateXValue=function(){if(!this.Frame)return!1;var e=this.Frame.Data;if(!e)return!1;for(var a=[],r=0;r<this.Value.length;++r){var t=this.Value[r];if(!t.DateTime)break;var n={Date:t.DateTime.Date};v.IsNumber(t.DateTime.Time)&&(n.Time=t.DateTime.Time),a[r]=n}e.FindDataIndexByDateTime(a);for(var r=0;r<a.length;++r){var s=a[r],o=this.Value[r];s.Index>=0&&(o.XValue=s.Index)}},this.ResetXValue=function(){for(var e=0;e<this.Value.length;++e){var a=this.Value[e];a.XValue=null}return!0},this.Move=function(e,a){if(this.Status!=20||!this.Frame)return!1;var r=this.Frame.Data;if(!r||this.MovePointIndex==null)return!1;var t=parseInt(this.MovePointIndex);if(t===100){if(this.IsMoveOutOfBounds(this.Point,e,a))return!1;for(var n in this.Point)this.Point[n].X+=e,this.Point[n].Y+=a}else if(t===0||t===1||t===2||t===3||t===4||t===5)t<this.Point.length&&(this.Point[t].X+=e,this.Point[t].Y+=a);else return!1},this.IsMoveOutOfBounds=function(e,a,r){if(!this.EnableMoveCheck||!this.Frame||this.Frame.ClassName=="MinuteFrame"||this.Frame.Class=="MinuteHScreenFrame")return!1;var t=this.Frame.Data;if(!t||!v.IsNonEmptyArray(t.Data)||!v.IsNonEmptyArray(e))return!1;var n=this.Frame.IsHScreen;if(n)return!1;var s=t.DataOffset,o=0-s,l=t.Data.length-s;if(a>0)for(var h=this.Frame.GetXFromIndex(l-1,!1),u=0;u<e.length;++u){var f=e[u];if(f.X+a>h)return!0}else if(a<0)for(var C=this.Frame.GetXFromIndex(o,!1),u=0;u<e.length;++u){var f=e[u];if(f.X+a<C)return!0}return!1},this.ClipFrame=function(){if(this.Frame.IsHScreen)var e=this.Frame.ChartBorder.GetLeftEx(),a=this.Frame.ChartBorder.GetTop(),r=this.Frame.ChartBorder.GetWidthEx(),t=this.Frame.ChartBorder.GetHeight();else var e=this.Frame.ChartBorder.GetLeft(),a=this.Frame.ChartBorder.GetTopEx(),r=this.Frame.ChartBorder.GetWidth(),t=this.Frame.ChartBorder.GetHeightEx();this.Canvas.save(),this.Canvas.beginPath(),this.Canvas.rect(e,a,r,t),this.Canvas.clip()},this.CalculateDrawPoint=function(e){if(this.Status<2||!this.Point.length||!this.Frame)return null;var a=[];if(this.Status==10){var r=this.Frame.Data;if(!r)return null;for(var t=this.Frame.XPointCount,n=0,s=this.Frame.IsHScreen,o=0;o<this.Value.length;++o){var l=this.Value[o];if(!v.IsNumber(l.XValue))return null;var h=l.XValue-r.DataOffset;(h<0||h>=t)&&++n;var u=new ft;s?(u.Y=this.Frame.GetXFromIndex(l.XValue-r.DataOffset,!1),u.X=this.Frame.GetYFromData(l.YValue,!1)):(u.X=this.Frame.GetXFromIndex(l.XValue-r.DataOffset,!1),u.Y=this.Frame.GetYFromData(l.YValue,!1)),a.push(u)}if(e&&e.IsCheckX===!0&&n==this.Value.length)return null}else{for(var o=0;o<this.Point.length;++o){var l=this.Point[o];a.push({X:l.X,Y:l.Y})}if(this.OnlyMoveXIndex){var e={IsFixedX:this.OnlyMoveXIndex};if(k.Chart.Log("[IChartDrawPicture::CalculateDrawPoint] Status="+this.Status+" MovePointIndex="+this.MovePointIndex+" Identify="+this.Frame.Identify),this.Option&&this.Option.Magnet&&this.Option.Magnet.Enable&&this.IsSupportMagnet&&this.Frame.Identify==0){var f=-1;this.Status==2&&(f=1),v.IsNumber(this.MovePointIndex)&&(f=this.MovePointIndex),f>=0&&(e.Magnet={Enable:!0,PointIndex:f,Distance:this.Option.Magnet.Distance,Type:this.Option.Magnet.Type})}this.AdjustPoint(a,e)}}return a},this.AdjustPoint=function(e,a){return!this.Frame||this.Frame.ClassName=="MinuteFrame"||this.Frame.Class=="MinuteHScreenFrame"?!1:this.AdjustPoint_KLine(e,a)},this.AdjustPoint_KLine=function(e,a){if(!a||!this.Frame)return!1;var r=this.Frame.Data;if(!r)return!1;var t=this.Frame.IsHScreen;if(t)for(var n=0;n<e.length;++n)var s=e[n],o=parseInt(this.Frame.GetXData(s.Y))+r.DataOffset;else for(var n=0;n<e.length;++n){var s=e[n],l=parseInt(this.Frame.GetXData(s.X,!1)),o=l+r.DataOffset;if(o<0?o=0:o>=r.Data.length&&(o=r.Data.length-1),a.IsFixedX&&(l=o-r.DataOffset,s.X=this.Frame.GetXFromIndex(l,!1)),a.Magnet&&a.Magnet.Enable&&n==a.Magnet.PointIndex){for(var h=r.Data[o],u=[h.Open,h.High,h.Low,h.Close],f=null,C=null,D=0;D<u.length;++D){var c=this.Frame.GetYFromData(u[D]),T=Math.abs(s.Y-c);(!v.IsNumber(f)||f>T)&&(f=T,C=c)}a.Magnet.Type==1?v.IsNumber(C)&&(s.Y=C):f<a.Magnet.Distance&&v.IsNumber(C)&&(s.Y=C)}}},this.IsYValueInFrame=function(e){return!(!this.Frame||e>this.Frame.HorizontalMax||e<this.Frame.HorizontalMin)},this.DrawPoint=function(e){if(v.IsNonEmptyArray(e)){var a=this.PointColor,r=!1;if(!this.IsShowPoint){if(this.GetActiveDrawPicture){var t=this.GetActiveDrawPicture();if(t.Move.Guid!=this.Guid&&t.Select.Guid!=this.Guid&&t.MoveOn.Guid!=this.Guid)return;t.Select.Guid!=this.Guid&&t.MoveOn.Guid==this.Guid&&(r=!0,a=this.MoveOnPointColor)}}this.ClipFrame();var n=B();this.Canvas.fillStyle=a,this.PointType==2&&(this.Canvas.fillStyle=this.PointBGColor,this.Canvas.strokeStyle=this.PointColor,r?this.Canvas.lineWidth=1*n:this.Canvas.lineWidth=2*n);for(var s=0;s<e.length;++s){var o=e[s];if(this.PointType==1){var l=this.SquareSize*n,h=o.X-l/2,u=o.Y-l/2;this.Canvas.fillRect(h,u,l,l)}else if(this.PointType==2){var f=new Path2D;f.arc(o.X,o.Y,this.PointRadius*n,0,360,!1),this.Canvas.fill(f),this.Canvas.stroke(f)}else this.Canvas.beginPath(),this.Canvas.arc(o.X,o.Y,this.PointRadius*n,0,360,!1),this.Canvas.fill(),this.Canvas.closePath()}this.Canvas.restore()}},this.DrawArrow=function(e,a){var r=35,t=10,n=Math.atan2(e.Y-a.Y,e.X-a.X)*180/Math.PI,s=(n+r)*Math.PI/180,o=(n-r)*Math.PI/180,l=t*Math.cos(s),h=t*Math.sin(s),u=t*Math.cos(o),f=t*Math.sin(o);this.Canvas.beginPath();var C=a.X+l,D=a.Y+h;this.Canvas.moveTo(C,D),this.Canvas.lineTo(a.X,a.Y),C=a.X+u,D=a.Y+f,this.Canvas.lineTo(C,D),this.Canvas.stroke()},this.CalculateExtendLinePoint=function(e,a){var r={};this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetRight();var t=this.Frame.ChartBorder.GetTopEx(),n=this.Frame.ChartBorder.GetBottom(),s=a.X-e.X,o=a.Y-e.Y;if(s>0){var h=n-e.Y,u=s*h/o,l=new ft;l.X=e.X+u,l.Y=n,r.End=l;var h=a.Y-t,u=s*h/o,f=new ft;f.Y=t,f.X=a.X-u,r.Start=f}else{var h=n-e.Y,u=Math.abs(s)*h/o,l=new ft;l.X=e.X-u,l.Y=n,r.End=l;var h=a.Y-t,u=Math.abs(s)*h/o,f=new ft;f.Y=t,f.X=a.X+u,r.Start=f}return r},this.CalculateExtendLineEndPoint=function(e){var a=this.Frame.ChartBorder.GetLeft(),r=this.Frame.ChartBorder.GetRight(),t=this.Frame.ChartBorder.GetBottomEx(),n=this.Frame.ChartBorder.GetTopEx(),s=e[1].X-e[0].X,o=e[1].Y-e[0].Y;if(s>0){var l=r-e[0].X,h=l*o/s,u=h+e[0].Y;if(u>=n&&u<=t){var f=new ft;return f.X=r,f.Y=u,f}if(o>0){var C=t-e[0].Y,D=s*C/o,c=D+e[0].X,T=new ft;return T.X=c,T.Y=t,T}else if(o==0){var T=new ft;return T.X=r,T.Y=e[0].Y,T}else{var C=n-e[0].Y,D=s*C/o,c=D+e[0].X,T=new ft;return T.X=c,T.Y=n,T}}else{var l=e[0].X-a,h=l*o/Math.abs(s),u=h+e[0].Y;if(u>=n&&u<=t){var f=new ft;return f.X=a,f.Y=u,f}if(o>0){var C=t-e[0].Y,D=s*C/o,c=D+e[0].X,T=new ft;return T.X=c,T.Y=t,T}else if(o==0){var T=new ft;return T.X=a,T.Y=e[0].Y,T}else{var C=n-e[0].Y,D=s*C/o,c=D+e[0].X,T=new ft;return T.X=c,T.Y=n,T}}},this.IsPointInXYValue=function(e,a,r){if(!this.Frame)return-1;var t=this.Frame.Data;if(!t||!this.Value)return-1;var n=5;r&&v.IsNumber(r.Zoom)?n+=r.Zoom:this.Option&&v.IsNumber(this.Option.Zoom)&&(n+=this.Option.Zoom);var s=this.Frame.IsHScreen;n*=B();for(var o=0;o<this.Value.length;++o){var l=this.Value[o],h=new ft;if(s?(h.Y=this.Frame.GetXFromIndex(l.XValue-t.DataOffset),h.X=this.Frame.GetYFromData(l.YValue)):(h.X=this.Frame.GetXFromIndex(l.XValue-t.DataOffset),h.Y=this.Frame.GetYFromData(l.YValue)),this.Canvas.beginPath(),this.Canvas.arc(h.X,h.Y,n,0,360),this.Canvas.isPointInPath(e,a))return o}return-1},this.IsPointInLine=function(e,a,r){if(!this.LinePoint)return-1;var t=5;r&&v.IsNumber(r.Zoom)?t+=r.Zoom:this.Option&&v.IsNumber(this.Option.Zoom)&&(t+=this.Option.Zoom);var n=B();t*=n;for(var s=0;s<this.LinePoint.length;++s){var o=this.LinePoint[s],l=o.Start,h=o.End;if(this.Canvas.beginPath(),l.X==h.X?(this.Canvas.moveTo(l.X-t,l.Y),this.Canvas.lineTo(l.X+t,l.Y),this.Canvas.lineTo(h.X+t,h.Y),this.Canvas.lineTo(h.X-t,h.Y)):(this.Canvas.moveTo(l.X,l.Y+t),this.Canvas.lineTo(l.X,l.Y-t),this.Canvas.lineTo(h.X,h.Y-t),this.Canvas.lineTo(h.X,h.Y+t)),this.Canvas.closePath(),this.Canvas.isPointInPath(e,a))return s}return-1},this.IsPointIn_XYValue_Line=function(e,a,r){if(this.Status!=10)return-1;var t=this.IsPointInXYValue(e,a,r);return t>=0?t:(t=this.IsPointInLine(e,a,r),t>=0?100:-1)},this.DrawLine=function(e,a,r){r&&this.Canvas.setLineDash([5,10]),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(e.X,e.Y),this.Canvas.lineTo(a.X,a.Y),this.Canvas.stroke(),r&&this.Canvas.setLineDash([])},this.CreateLineData=function(e,a){var r={Start:new ft,End:new ft};return r.Start.Y=e.Y,r.Start.X=e.X,r.End.Y=a.Y,r.End.X=a.X,r},this.ExportStorageData=function(){for(var e={ClassName:this.ClassName,Symbol:this.Symbol,Guid:this.Guid,Period:this.Period,Value:[],FrameID:this.Frame.Identify,LineColor:this.LineColor,AreaColor:this.AreaColor,LineWidth:this.LineWidth,Right:this.Right,EnableSave:this.EnableSave,IsShowYCoordinate:this.IsShowYCoordinate},a=0;a<this.Value.length;++a){var r=this.Value[a];e.Value.push({XValue:r.XValue,YValue:r.YValue,DateTime:r.DateTime})}return this.Text&&(e.Text=this.Text),this.FontOption&&(e.FontOption=this.FontOption),e},this.ExportBaseData=function(){var e={ClassName:this.ClassName,Guid:this.Guid,FrameID:this.Frame.Identify,Symbol:this.Symbol,Period:this.Period,Right:this.Right,LineColor:this.LineColor,LineWidth:this.LineWidth,EnableSave:this.EnableSave,IsShowYCoordinate:this.IsShowYCoordinate};return this.AreaColor&&(e.AreaColor=this.AreaColor),this.Text&&(e.Text=this.Text),this.FontOption&&(e.FontOption={},this.SetFont(e.FontOption,this.FontOption)),e},this.IsFrameMinSize=function(){return this.Frame&&this.Frame.IsMinSize},this.PointRange=function(e){if(!v.IsNonEmptyArray(e))return null;if(e.length==1){var a={Points:[{X:e[0].X,Y:e[0].Y}]};return a}else{for(var r=e[0].X,t=r,n=e[0].Y,s=n,o=[{X:e[0].X,Y:e[0].Y}],l=1;l<e.length;++l)r<e[l].X&&(r=e[l].X),t>e[l].X&&(t=e[l].X),n<e[l].Y&&(n=e[l].Y),s>e[l].Y&&(s=e[l].Y),o.push({X:e[l].X,Y:e[l].Y});var a={X:{Max:{X:r},Min:{X:t}},Y:{Max:{Y:n},Min:{Y:s}},Points:o};return a}},this.GetXYCoordinate_default=function(){if(this.IsFrameMinSize()||!this.IsShow)return null;var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});return this.PointRange(e)},this.GetXYCoordinate=function(){return null},this.CopyData_default=function(){if(!this.Frame)return null;var e=this.ExportStorageData();if(!e)return null;var a=0;if(!(this.Frame.ClassName=="MinuteFrame"||this.Frame.Class=="MinuteHScreenFrame")){var r=this.Frame.Data;if(!r)return null;a=r.DataOffset}for(var t=this.Frame.ChartBorder.GetHeight(),n=this.Frame.ChartBorder.GetBottomEx()-this.Point[0].Y,s=0;s<e.Value.length;++s){var o=e.Value[s],l=this.Point[s];if(o.XIndex=o.XValue-a+1,s==0)o.XOffset=0,o.YOffset=0;else{var h=e.Value[s-1],u=this.Point[s-1];o.XOffset=o.XValue-h.XValue,o.YOffset=l.Y-u.Y}}return e.DataOffset=a,e.YFristScale=n/t,e.Height=t,e},this.SetFont=function(e,a){a&&e&&(a.Family&&(e.Family=a.Family),a.Weight&&(e.Weight=a.Weight),a.Style&&(e.Style=a.Style),v.IsNumber(a.Size)&&(e.Size=a.Size))},this.GetFontString=function(e){var a=16*B()+"px 微软雅黑";if(!e||!e.Family||!v.IsPlusNumber(e.Size))return a;var r="";return e.Color&&(r+=e.Color+" "),e.Style&&(r+=e.Style+" "),e.Weight&&(r+=e.Weight+" "),r+=e.Size*B()+"px ",r+=e.Family,r},this.GetMultiLineText=function(e,a,r,t){r&&(this.Canvas.font=r);var n=this.Canvas.measureText(e).width;if(n<=a)return{AryText:[{Text:e}]};for(var s=this.Canvas.measureText("擎").width,o=parseInt(a/s),l=0,h=[];l<e.length-1;){var u=o,f=l+u;f>=e.length&&(f=e.length-1,u=f-l);var C=e.slice(l,l+u),n=this.Canvas.measureText(C).width;if(n>a){for(var D=u;D>=0;--D)if(C=e.slice(l,l+D),n=this.Canvas.measureText(C).width,n<a){h.push({Text:C}),l+=D;break}}else if(n<a){for(var c=!1,D=u;D+l<=e.length;++D)if(C=e.slice(l,l+D),n=this.Canvas.measureText(C).width,n>a){C=e.slice(l,l+D-1),h.push({Text:C}),l+=D-1,c=!0;break}c||(h.push({Text:C}),l=e.length-1)}else h.push({Text:C}),l+=u}return{AryText:h}},this.CloneArrayText=function(e){if(!v.IsNonEmptyArray(e))return[];for(var a=[],r=0;r<e.length;++r){var t=e[r];t&&a.push({Text:t.Text})}return a},this.CalculateAngle=function(e,a,r,t){var n=Math.abs(e-r),s=Math.abs(a-t),o=Math.sqrt(Math.pow(n,2)+Math.pow(s,2)),l=n/o,h=Math.acos(l),u=180/(Math.PI/h);return r==e&&t<a?90:r==e&&t>a?270:r>e&&t==a?0:r<e&&t==a?180:r>e&&t>a?360-u:r<e&&t>a?180+u:r<e&&t<a?180-u:u},this.CalculateLabelSize=function(e){var a=e.Config;this.Canvas.font=a.Font,this.Canvas.textAlign="left",this.Canvas.textBaseline="top";for(var r=this.Canvas.measureText("擎").width+2,t=0,n=a.Mergin.Top+a.Mergin.Bottom,s=0;s<e.AryText.length;++s){s>0&&(n+=a.LineSpace);var o=e.AryText[s];o.NameWidth=0,o.TextWidth=0,o.Name&&(o.NameWidth=this.Canvas.measureText(o.Name).width+2),o.Text&&(o.TextWidth=this.Canvas.measureText(o.Text).width+2);var l=o.NameWidth+o.TextWidth;t<l&&(t=l),n+=r}var h=t+a.Mergin.Left+a.Mergin.Right;e.Width=h,e.Height=n,e.LineHeight=r},this.DrawDefaultLabel=function(e,a){var r=e.Config;r.BGColor&&(this.Canvas.fillStyle=r.BGColor,this.Canvas.fillRect(b(a.Left),b(a.Top),b(a.Width),b(a.Height)));for(var t=a.Left+r.Mergin.Left,n=a.Top+r.Mergin.Top,s=0;s<e.AryText.length;++s){var o=e.AryText[s];if(s>0&&(n+=r.LineSpace),o.Name&&(this.Canvas.fillStyle=o.NameColor,this.Canvas.fillText(o.Name,t,n)),o.Text){var l=t+o.NameWidth;r.TextAlign==1&&(l=a.Right-r.Mergin.Right-o.TextWidth),this.Canvas.fillStyle=o.TextColor,this.Canvas.fillText(o.Text,l,n)}n+=e.LineHeight}}}gt.ColorToRGBA=function(e,a){var r=/^(rgb|RGB)/;if(r.test(e)){for(var t="#",n=e.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),s=0;s<n.length;s++){var o=Number(n[s]).toString(16);o==="0"&&(o+=o),t+=o}e=t}return"rgba("+parseInt("0x"+e.slice(1,3))+","+parseInt("0x"+e.slice(3,5))+","+parseInt("0x"+e.slice(5,7))+","+a+")"};gt.RGBToHex=function(e){var a=e.indexOf(",")>-1?",":" ";e=e.substr(4).split(")")[0].split(a);var r=(+e[0]).toString(16),t=(+e[1]).toString(16),n=(+e[2]).toString(16);return r.length==1&&(r="0"+r),t.length==1&&(t="0"+t),n.length==1&&(n="0"+n),"#"+r+t+n};gt.HexToRGB=function(e){e=e.toLowerCase();var a=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;if(e&&a.test(e)){if(e.length===4){for(var r="#",t=1;t<4;t+=1)r+=e.slice(t,t+1).concat(e.slice(t,t+1));e=r}for(var n=[],t=1;t<7;t+=2)n.push(parseInt("0x"+e.slice(t,t+2)));return"rgb("+n.join(",")+")"}return null};gt.ArrayDrawPricture=[{Name:"线段",ClassName:"ChartDrawPictureLine",Create:function(){return new fD}},{Name:"射线",ClassName:"ChartDrawPictureHaflLine",Create:function(){return new NI}},{Name:"箭头",ClassName:"ChartDrawArrowLine",Create:function(){return new LI}},{Name:"水平线",ClassName:"ChartDrawPictureHorizontalLine",Create:function(){return new AI}},{Name:"水平射线",ClassName:"ChartDrawPictureHorizontalRay",Create:function(){return new yI}},{Name:"趋势线",ClassName:"ChartDrawPictureTrendLine",Create:function(){return new PI}},{Name:"矩形",ClassName:"ChartDrawPictureRect",Create:function(){return new BI}},{Name:"圆弧线",ClassName:"ChartDrawPictureArc",Create:function(){return new bI}},{Name:"M头W底",ClassName:"ChartDrawPictureWaveMW",Create:function(){return new CD}},{Name:"头肩型",ClassName:"ChartDrawHeadShouldersBT",Create:function(){return new wI}},{Name:"平行线",ClassName:"ChartDrawPictureParallelLines",Create:function(){return new nl}},{Name:"平行通道",ClassName:"ChartDrawPictureParallelChannel",Create:function(){return new VI}},{Name:"价格通道线",ClassName:"ChartDrawPicturePriceChannel",Create:function(){return new HI}},{Name:"文本",ClassName:"ChartDrawPictureText",Create:function(){return new YI}},{Name:"江恩角度线",ClassName:"ChartDrawPictureGannFan",Create:function(){return new hl}},{Name:"江恩角度线2",ClassName:"ChartDrawPictureGannFan",Create:function(){return new XI}},{Name:"阻速线",ClassName:"ChartDrawPictureResistanceLine",Create:function(){return new vD}},{Name:"阻速线2",ClassName:"ChartDrawPictureResistanceLineV2",Create:function(){return new kI}},{Name:"黄金分割",ClassName:"ChartDrawPictureGoldenSection",Create:function(){return new ll}},{Name:"百分比线",ClassName:"ChartDrawPicturePercentage",Create:function(){return new WI}},{Name:"波段线",ClassName:"ChartDrawPictureWaveBand",Create:function(){return new UI}},{Name:"三角形",ClassName:"ChartDrawPictureTriangle",Create:function(){return new KI}},{Name:"对称角度",ClassName:"ChartDrawPictureSymmetryAngle",Create:function(){return new zI}},{Name:"圆",ClassName:"ChartDrawPictureCircle",Create:function(){return new JI}},{Name:"平行四边形",ClassName:"ChartDrawPictureQuadrangle",Create:function(){return new ZI}},{Name:"斐波那契周期线",ClassName:"ChartDrawPictureFibonacci",Create:function(){return new QI}},{Name:"线形回归线",ClassName:"ChartDrawLinearRegression",Create:function(){return new Yo}},{Name:"线形回归带",ClassName:"ChartDrawLinearRegression",Create:function(){return new Yo({IsShowMaxMinLine:!0})}},{Name:"延长线形回归带",ClassName:"ChartDrawLinearRegression",Create:function(){return new Yo({IsShowMaxMinLine:!0,IsShowExtendLine:!0})}},{Name:"尺子",ClassName:"ChartDrawRuler",Create:function(){return new $I}},{Name:"标价线",ClassName:"ChartDrawPriceLine",Create:function(){return new qI}},{Name:"标价线2",ClassName:"ChartDrawPriceLineV2",Create:function(){return new jI}},{Name:"垂直线",ClassName:"ChartDrawVerticalLine",Create:function(){return new tm}},{Name:"十字线",ClassName:"ChartDrawCrosshair",Create:function(){return new em}},{Name:"波浪尺",ClassName:"ChartDrawWaveRuler",Create:function(){return new im}},{Name:"AB波浪尺",ClassName:"ChartDrawWaveRuler2Point",Create:function(){return new rm}},{Name:"箱型线",ClassName:"ChartDrawBox",Create:function(){return new sm}},{Name:"2点画图例子",ClassName:"ChartDrawTwoPointDemo",Create:function(){return new ul}},{Name:"3点画图例子",ClassName:"ChartDrawThreePointDemo",Create:function(){return new cD}},{Name:"水平线段",ClassName:"ChartDrawHLineSegment",Create:function(){return new nm}},{Name:"平行射线",ClassName:"ChartDrawParallelRaysLines",Create:function(){return new _I}},{ClassName:"ChartDrawPictureIconFont",Create:function(){return new ol}},{Name:"涂鸦线段",ClassName:"ChartDrawGraffitiLine",Create:function(){return new MI}},{Name:"固定范围成交量分布图",ClassName:"ChartDrawVolProfile",Create:function(){return new om}},{Name:"DisjointChannel",ClassName:"ChartDrawDisjontChannel",Create:function(){return new GI}},{Name:"FlatTop",ClassName:"ChartDrawFlatTop",Create:function(){return new DD}},{Name:"水平线2",ClassName:"ChartDrawHLine",Create:function(){return new OI}},{Name:"MonitorLine",ClassName:"ChartDrawMonitorLine",Create:function(){return new am}},{Name:"Note",ClassName:"ChartDrawNote",Create:function(){return new hm}},{Name:"AnchoredText",ClassName:"ChartDrawAnchoredText",Create:function(){return new lm}},{Name:"PriceLabel",ClassName:"ChartDrawPriceLabel",Create:function(){return new um}},{Name:"PriceNote",ClassName:"ChartDrawPriceNote",Create:function(){return new fm}},{Name:"FibWedge",ClassName:"ChartDrawFibWedge",Create:function(){return new Cm}},{Name:"FibRetracement",ClassName:"ChartFibRetracement",Create:function(){return new Dm}},{Name:"FibSpeedResistanceFan",ClassName:"ChartFibSpeedResistanceFan",Create:function(){return new vm}},{Name:"PriceRange",ClassName:"ChartPriceRange",Create:function(){return new cm}},{Name:"DateRange",ClassName:"ChartDateRange",Create:function(){return new Tm}},{Name:"DatePriceRange",ClassName:"ChartDatePriceRange",Create:function(){return new Sm}},{Name:"InfoLine",ClassName:"ChartInfoLine",Create:function(){return new dm}},{Name:"TrendAngle",ClassName:"ChartTrendAngle",Create:function(){return new FI}},{Name:"ArrowMarker",ClassName:"ChartArrowMarker",Create:function(){return new RI}},{Name:"BarsPattern",ClassName:"ChartBarsPattern",Create:function(){return new Im}}];gt.MapIonFont=new Dt.default([["icon-arrow_up",{Text:"",Color:"#318757",Family:"iconfont"}],["icon-arrow_down",{Text:"",Color:"#db563e",Family:"iconfont"}],["icon-arrow_right",{Text:"",Color:"#318757",Family:"iconfont"}],["icon-arrow_left",{Text:"",Color:"#318757",Family:"iconfont"}]]);gt.GetDrawPictureByName=function(e){for(var a in gt.ArrayDrawPricture){var r=gt.ArrayDrawPricture[a];if(r.Name==e)return r}return null};gt.GetDrawPictureByClassName=function(e){for(var a in gt.ArrayDrawPricture){var r=gt.ArrayDrawPricture[a];if(r.ClassName==e)return r}return null};gt.RegisterDrawPicture=function(e){if(!e.Name||!e.ClassName||!e.Create)return!1;var a={Name:e.Name,ClassName:e.ClassName,Create:e.Create};return gt.ArrayDrawPricture.push(a),k.Chart.Log("[IChartDrawPicture.RegisterDrawPicture] registered new draw picture class. item=",a),!0};gt.RegisterIonFont=function(e){if(!e.Name||!e.Text||!e.Family)return!1;var a=gt.MapIonFont.has(e.Name);return gt.MapIonFont.set(e.Name,e),k.Chart.Log("[IChartDrawPicture.RegisterIonFont] registered new icon font, obj=, isOverwirte=",e,a),!0};gt.CreateChartDrawPicture=function(e){var a=gt.GetDrawPictureByClassName(e.ClassName);if(!a)return null;var r=a.Create();return e.Period>=0&&(r.Period=e.Period),e.Right>=0&&(r.Right=e.Right),e.Guid&&(r.Guid=e.Guid),e.Symbol&&(r.Symbol=e.Symbol),e.Value&&(r.Value=e.Value),e.Text&&(r.Text=e.Text),e.LineColor&&(r.LineColor=e.LineColor),e.AreaColor&&(r.AreaColor=e.AreaColor),e.FontOption&&(r.FontOption=e.FontOption),e.Label&&(r.Label=e.Label),e.LineWidth>0&&(r.LineWidth=e.LineWidth),e.EnableMove===!1&&(r.EnableMove=e.EnableMove),v.IsBool(e.EnableSave)&&(r.EnableSave=e.EnableSave),v.IsNumber(e.ChannelWidth)&&(r.ChannelWidth=e.ChannelWidth),v.IsBool(e.IsShowYCoordinate)&&(r.IsShowYCoordinate=e.IsShowYCoordinate),r.SetOption&&r.SetOption(e),r};function fD(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.IsShowYCoordinate=!1,this.CopyData=this.CopyData_default,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!1});if(e&&e.length==2){this.ClipFrame();var a=e[0],r=e[1];this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(a.X,a.Y),this.Canvas.lineTo(r.X,r.Y),this.Canvas.stroke(),this.RestoreLineWidth();var t={Start:a,End:r};this.LinePoint.push(t),this.DrawPoint(e),this.Canvas.restore()}}},this.GetYCoordinatePoint=function(){if(this.IsFrameMinSize()||!this.IsShow||this.Status<2||!this.Point.length||!this.Frame||this.Status!=10)return null;for(var e=[],a=0;a<this.Value.length;++a){var r=this.Value[a],t=this.Frame.GetYFromData(r.YValue,!1);e.push({Y:t,YValue:r.YValue,Item:r,Color:this.PointColor})}return e}}function FI(){this.newMethod=fD,this.newMethod(),delete this.newMethod,this.ClassName="ChartTrendAngle",this.AngleLineLength=100,this.AngleLineDash=[3,3],this.Font=12*B()+"px 微软雅黑",this.Super_SetOption=this.SetOption,this.SetOption=function(e){this.Super_SetOption&&this.Super_SetOption(e),e&&(v.IsNumber(e.AngleLineLength)&&(this.AngleLineLength=e.AngleLineLength),e.Font&&(this.Font=e.Font),e.AngleLineDash&&(this.AngleLineDash=e.AngleLineDash))},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!1});if(e&&e.length==2){this.ClipFrame();var a=e[0],r=e[1];this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(a.X,a.Y),this.Canvas.lineTo(r.X,r.Y),this.Canvas.stroke(),this.RestoreLineWidth(),this.DrawAngle(a,r);var t={Start:a,End:r};this.LinePoint.push(t),this.DrawPoint(e),this.Canvas.restore()}}},this.DrawAngle=function(e,a){var r=B(),t=this.CalculateAngle(e.X,e.Y,a.X,a.Y),n=this.AngleLineLength*r,s={X:e.X+n,Y:e.Y};if(this.AngleLineDash&&this.Canvas.setLineDash(this.AngleLineDash),this.Canvas.lineWidth=1*B(),this.Canvas.beginPath(),this.Canvas.moveTo(L(e.X),L(e.Y)),this.Canvas.lineTo(L(s.X),L(s.Y)),this.Canvas.stroke(),this.Canvas.beginPath(),t<=180){this.Canvas.arc(e.X,L(e.Y),n,0,Math.PI/180*(360-t),!0);var o=t.toFixed(0)+"°"}else{this.Canvas.arc(e.X,L(e.Y),n,0,Math.PI/180*(360-t),!1);var o=(t-360).toFixed(0)+"°"}this.Canvas.stroke(),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font,this.Canvas.fillStyle=this.LineColor,this.AngleLineDash&&this.Canvas.setLineDash([]),this.Canvas.fillText(o,s.X+5,s.Y)}}function MI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawGraffitiLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=null,this.PointCount=2,this.EnableMoveCheck=!1,this.PointToValue=function(){if(!this.Frame)return!1;var e=this.Frame.IsHScreen;if(e)for(var a=0;a<this.Point.length;++a){var r=this.Point[a],t=this.Frame.GetYData(r.X),n={XValue:r.Y,YValue:t};this.Value[a]=n}else for(var a=0;a<this.Point.length;++a){var r=this.Point[a],t=this.Frame.GetYData(r.Y),n={XValue:r.X,YValue:t};this.Value[a]=n}return!0},this.ValueToPoint=function(){if(!this.Frame)return!1;var e=this.Frame.IsHScreen;this.Point=[];for(var a in this.Value){var r=this.Value[a],t=new ft;e?(t.Y=r.XValue,t.X=this.Frame.GetYFromData(r.YValue)):(t.X=r.XValue,t.Y=this.Frame.GetYFromData(r.YValue,!1)),this.Point[a]=t}},this.UpdateXValue=function(){},this.CalculateDrawPoint=function(e){if(this.Status<2||!this.Point.length||!this.Frame)return null;var a=[];if(this.Status==10){var r=this.Frame.IsHScreen;for(var t in this.Value){var n=this.Value[t],s=new ft;r?(s.Y=n.XValue,s.X=this.Frame.GetYFromData(n.YValue,!1)):(s.X=n.XValue,s.Y=this.Frame.GetYFromData(n.YValue,!1)),a.push(s)}}else a=this.Point;return a},this.IsPointInXYValue=function(e,a,r){if(!this.Frame||!this.Value)return-1;var t=5;r&&v.IsNumber(r.Zoom)?t+=r.Zoom:this.Option&&v.IsNumber(this.Option.Zoom)&&(t+=this.Option.Zoom);var n=this.Frame.IsHScreen;t*=B();for(var s=0;s<this.Value.length;++s){var o=this.Value[s],l=new ft;if(n?(l.Y=o.XValue,l.X==this.Frame.GetYFromData(o.YValue)):(l.X=o.XValue,l.Y=this.Frame.GetYFromData(o.YValue)),this.Canvas.beginPath(),this.Canvas.arc(l.X,l.Y,t,0,360),this.Canvas.isPointInPath(e,a))return s}return-1},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e&&e.length==2){this.ClipFrame();var a=e[0],r=e[1];this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(a.X,a.Y),this.Canvas.lineTo(r.X,r.Y),this.Canvas.stroke(),this.RestoreLineWidth();var t={Start:a,End:r};this.LinePoint.push(t),this.DrawPoint(e),this.Canvas.restore()}}}}function LI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawArrowLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.ArrawLineWidth=5,this.ArrawLength=15,this.ArrawAngle=35,this.GetXYCoordinate=this.GetXYCoordinate_default,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e&&e.length==2){this.ClipFrame();var a=e[0],r=e[1],t=this.ArrawAngle,n=this.ArrawLength,s=Math.atan2(a.Y-r.Y,a.X-r.X)*180/Math.PI,o=(s+t)*Math.PI/180,l=(s-t)*Math.PI/180,h=n*Math.cos(o),u=n*Math.sin(o),f=n*Math.cos(l),C=n*Math.sin(l);this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(a.X,a.Y),this.Canvas.lineTo(r.X,r.Y),this.Canvas.stroke(),this.Canvas.beginPath();var D=r.X+h,c=r.Y+u;this.Canvas.moveTo(D,c),this.Canvas.lineTo(r.X,r.Y),D=r.X+f,c=r.Y+C,this.Canvas.lineTo(D,c),this.Canvas.lineWidth=this.ArrawLineWidth*B(),this.Canvas.stroke(),this.RestoreLineWidth();var T={Start:a,End:r};this.LinePoint.push(T),this.DrawPoint([e[0]]),this.Canvas.restore()}}}}function RI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartArrowMarker",this.IsPointIn=this.IsPointIn_XYValue_Line,this.InsideLineConfig={Angle:25,MaxWidth:70,WidthRate:.3},this.InsideWidth=70,this.OutLineConfig={Angle:35,MaxWidth:100,WidthRate:.4},this.OutWidth=100,this.GetXYCoordinate=this.GetXYCoordinate_default,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.Super_SetOption=this.SetOption,this.SetOption=function(e){this.Super_SetOption(e),e.AreaColor?this.AreaColor=e.AreaColor:this.AreaColor=gt.ColorToRGBA(this.LineColor,.6)},this.CalculatePoint=function(o,a,r,t){var n=o,s=t,o=Math.atan2(a.Y-r.Y,a.X-r.X)*180/Math.PI,l=(o+n)*Math.PI/180,h=(o-n)*Math.PI/180,u=s*Math.cos(l),f=s*Math.sin(l),C=s*Math.cos(h),D=s*Math.sin(h);return{Top:{X:u+r.X,Y:f+r.Y},Bottom:{X:C+r.X,Y:D+r.Y}}},this.CalculateLineWidth=function(e,a){var r=e.X-a.X,t=e.Y-a.Y,n=Math.sqrt(r*r+t*t);this.InsideWidth=n*this.InsideLineConfig.WidthRate,this.OutWidth=n*this.OutLineConfig.WidthRate,this.InsideWidth>this.InsideLineConfig.MaxWidth&&(this.InsideWidth=this.InsideLineConfig.MaxWidth),this.OutWidth>this.OutLineConfig.MaxWidth&&(this.OutWidth=this.OutLineConfig.MaxWidth)},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e&&e.length==2){this.ClipFrame();var a=e[0],r=e[1];this.CalculateLineWidth(a,r);var t=this.CalculatePoint(this.OutLineConfig.Angle,a,r,this.OutWidth),n=this.CalculatePoint(this.InsideLineConfig.Angle,a,r,this.InsideWidth);this.Canvas.beginPath(),this.Canvas.moveTo(a.X,a.Y),this.Canvas.lineTo(n.Top.X,n.Top.Y),this.Canvas.lineTo(t.Top.X,t.Top.Y),this.Canvas.lineTo(r.X,r.Y),this.Canvas.lineTo(t.Bottom.X,t.Bottom.Y),this.Canvas.lineTo(n.Bottom.X,n.Bottom.Y),this.Canvas.lineTo(a.X,a.Y),this.Canvas.strokeStyle=this.LineColor,this.Canvas.stroke(),this.Canvas.closePath(),this.Canvas.fillStyle=this.AreaColor,this.Canvas.fill();var s={Start:a,End:r};this.LinePoint.push(s),this.DrawPoint([a,r]),this.Canvas.restore()}}}}function NI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureHaflLine",this.GetXYCoordinate=this.GetXYCoordinate_default,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.FullLine,this.IsPointIn=function(e,a,r){var t=this.IsPointIn_XYValue_Line(e,a,r);if(t>=0||!this.FullLine)return t;var n=this.FullLine.Start,s=this.FullLine.End,o=B(),l=5*o;return this.Canvas.beginPath(),n.X==s.X?(this.Canvas.moveTo(n.X-l,n.Y),this.Canvas.lineTo(n.X+l,n.Y),this.Canvas.lineTo(s.X+l,s.Y),this.Canvas.lineTo(s.X-l,s.Y)):(this.Canvas.moveTo(n.X,n.Y+l),this.Canvas.lineTo(n.X,n.Y-l),this.Canvas.lineTo(s.X,s.Y-l),this.Canvas.lineTo(s.X,s.Y+l)),this.Canvas.closePath(),this.Canvas.isPointInPath(e,a)?100:t},this.Draw=function(){if(this.LinePoint=[],this.FullLine=null,!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!1});if(!(!e||e.length!=2)){var a=e[0],r=e[1];this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),this.Canvas.moveTo(e[0].X,e[0].Y),this.Canvas.lineTo(e[1].X,e[1].Y);var t=this.CalculateExtendLineEndPoint(e);this.Canvas.lineTo(t.X,t.Y),this.Canvas.stroke(),this.RestoreLineWidth();var n={Start:a,End:r};this.LinePoint.push(n),this.DrawPoint(e),this.Canvas.restore(),this.FullLine={Start:e[0],End:t}}}}}function AI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureHorizontalLine",this.PointCount=1,this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsDrawFirst=!0,this.LineWidth=1,this.Super_SetOption=this.SetOption,this.Super_ExportStorageData=this.ExportStorageData,this.LabelConfig={Left:{IsShow:!0,Margin:{Left:5,Top:4,Bottom:2,Right:5}},Right:{IsShow:!0,Margin:{Left:5,Top:4,Bottom:2,Right:5}},Font:12*B()+"px 微软雅黑",TextColor:"rgb(255,255,255)"},this.InsideLabelConfig={Position:0,Font:14*B()+"px 微软雅黑",Margin:{Left:5,Top:4,Bottom:2,Right:5},TextColor:"rgb(255,255,255)",BGAlpha:.8},this.LabelTitle,this.SetOption=function(e){if(this.Super_SetOption&&this.Super_SetOption(e),e){if(e.LabelTitle&&(this.LabelTitle=e.LabelTitle),e.Label){var a=e.Label;if(a.Left){var r=a.Left;v.IsBool(r.IsShow)&&(this.LabelConfig.Left.IsShow=r.IsShow)}if(a.Right){var r=a.Right;v.IsBool(r.IsShow)&&(this.LabelConfig.Right.IsShow=r.IsShow)}a.Font&&(this.LabelConfig.Font=a.Font),a.TextColor&&(this.LabelConfig.FoTextColornt=a.TextColor)}if(e.InsideLabel){var a=e.InsideLabel;a.Font&&(this.InsideLabelConfig.Font=a.Font),a.TextColor&&(this.InsideLabelConfig.TextColor=a.TextColor),v.IsNumber(a.Position)&&(this.InsideLabelConfig.Position=a.Position),v.IsNumber(a.BGAlpha)&&(this.InsideLabelConfig.BGAlpha=a.BGAlpha)}}},this.ExportStorageData=function(){var e;return this.Super_ExportStorageData&&(e=this.Super_ExportStorageData(),this.LabelTitle&&(e.LabelTitle=this.LabelTitle)),e},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint();if(!(!e||e.length!=1)&&this.Frame&&this.Value.length==1){if(!this.IsYValueInFrame(this.Value[0].YValue))return null;var a=this.Frame.IsHScreen,r=this.Frame.ChartBorder.GetLeft(),t=this.Frame.ChartBorder.GetRight();if(a&&(r=this.Frame.ChartBorder.GetTop(),t=this.Frame.ChartBorder.GetBottom()),this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),a)this.Canvas.moveTo(e[0].X,r),this.Canvas.lineTo(e[0].X,t);else{var n=$t(this.LineWidth,e[0].Y);this.Canvas.moveTo(r,n),this.Canvas.lineTo(t,n)}this.Canvas.stroke(),this.RestoreLineWidth();var s={Start:new ft,End:new ft};a?(s.Start.X=e[0].X,s.Start.Y=r,s.End.X=e[0].X,s.End.Y=t):(s.Start.X=r,s.Start.Y=e[0].Y,s.End.X=t,s.End.Y=e[0].Y),this.LinePoint.push(s),this.DrawPoint(e),this.DrawInsideLabel(e[0]),this.Canvas.restore(),this.DrawValueLabel(e[0])}}},this.DrawValueLabel=function(e){if(e&&!this.Frame.IsHScreen){var a=e.Y,r=this.Frame.GetYData(a),t=r.toFixed(2),n=this.Frame.GetBorder(),s=this.LabelConfig;this.Canvas.font=s.Font;var o=this.Canvas.measureText("擎").width,l=this.Canvas.measureText(t).width;if(s.Left.IsShow&&this.Frame.ChartBorder.Left>5){var h=s.Left.Margin,u={Right:n.Left-1,Height:o+h.Top+h.Bottom,Width:l+h.Left+h.Right};u.Top=a-o/2-h.Top,u.Bottom=u.Top+u.Height,u.Left=u.Right-u.Width,this.Canvas.fillStyle=this.LineColor,this.Canvas.fillRect(u.Left,u.Top,u.Width,u.Height),this.Canvas.textAlign="left",this.Canvas.textBaseline="top";var f=u.Left+h.Left,C=u.Top+h.Top;this.Canvas.fillStyle=s.TextColor,this.Canvas.fillText(t,f,C)}if(s.Right.IsShow&&this.Frame.ChartBorder.Right>5){var h=s.Right.Margin,u={Left:n.Right+1,Height:o+h.Top+h.Bottom,Width:l+h.Left+h.Right};u.Top=a-o/2-h.Top,u.Bottom=u.Top+u.Height,u.Right=u.Left+u.Width,this.Canvas.fillStyle=this.LineColor,this.Canvas.fillRect(u.Left,u.Top,u.Width,u.Height),this.Canvas.textAlign="left",this.Canvas.textBaseline="top";var f=u.Left+h.Left,C=u.Top+h.Top;this.Canvas.fillStyle=s.TextColor,this.Canvas.fillText(t,f,C)}}},this.DrawInsideLabel=function(e){if(e){var a=this.Frame.IsHScreen,r=this.InsideLabelConfig;if(!(r.Position!=0&&r.Position!=1)){var t=r.Margin;this.Canvas.fillStyle=this.LineColor,this.Canvas.font=r.Font;var n=this.Canvas.measureText("擎").width,s=this.Frame.GetBorder();if(a){var o=this.Frame.GetYData(e.X),l=o.toFixed(2);this.LabelTitle&&(l=this.LabelTitle+l);var h=this.Canvas.measureText(l).width,u=null;if(r.Position==0){var u={Top:s.Top+1,Width:n+t.Top+t.Bottom,Height:h+t.Left+t.Right,Left:e.X};u.Bottom=u.Top+u.Height,u.Right=u.Left+u.Width}else if(r.Position==1){var u={Bottom:s.Bottom-1,Width:n+t.Top+t.Bottom,Height:h+t.Left+t.Right,Left:e.X};u.Top=u.Bottom-u.Height,u.Right=u.Left+u.Width}var f=this.LineColor;r.BGAlpha<1&&(f=gt.ColorToRGBA(this.LineColor,r.BGAlpha)),this.Canvas.fillStyle=f,this.Canvas.fillRect(u.Left,u.Top,u.Width,u.Height);var C=u.Right-t.Top,D=u.Top+t.Left;this.Canvas.translate(C,D),this.Canvas.rotate(90*Math.PI/180),this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(l,0,0)}else{var o=this.Frame.GetYData(e.Y),l=o.toFixed(2);this.LabelTitle&&(l=this.LabelTitle+l);var h=this.Canvas.measureText(l).width,u=null;if(r.Position==0){var u={Left:s.Left+1,Height:n+t.Top+t.Bottom,Width:h+t.Left+t.Right,Bottom:e.Y};u.Top=u.Bottom-u.Height,u.Right=u.Left+u.Width}else if(r.Position==1){var u={Right:s.Right-1,Height:n+t.Top+t.Bottom,Width:h+t.Left+t.Right,Bottom:e.Y};u.Top=u.Bottom-u.Height,u.Left=u.Right-u.Width}var f=this.LineColor;r.BGAlpha<1&&(f=gt.ColorToRGBA(this.LineColor,r.BGAlpha)),this.Canvas.fillStyle=f,this.Canvas.fillRect(u.Left,u.Top,u.Width,u.Height);var C=u.Left+t.Left,D=u.Top+t.Top;this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(l,C,D)}}}}}function yI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureHorizontalRay",this.PointCount=1,this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsDrawFirst=!0,this.LineWidth=1,this.Super_SetOption=this.SetOption,this.Super_ExportStorageData=this.ExportStorageData,this.LabelConfig={Right:{IsShow:!0,Margin:{Left:5,Top:4,Bottom:2,Right:5}},Font:12*B()+"px 微软雅黑",TextColor:"rgb(255,255,255)"},this.SetOption=function(e){if(this.Super_SetOption&&this.Super_SetOption(e),e&&(e.LabelTitle&&(this.LabelTitle=e.LabelTitle),e.Label)){var a=e.Label;if(a.Right){var r=a.Right;v.IsBool(r.IsShow)&&(this.LabelConfig.Right.IsShow=r.IsShow)}a.Font&&(this.LabelConfig.Font=a.Font),a.TextColor&&(this.LabelConfig.FoTextColornt=a.TextColor)}},this.ExportStorageData=function(){var e;return this.Super_ExportStorageData&&(e=this.Super_ExportStorageData()),e},this.GetXYCoordinate=function(){if(this.IsFrameMinSize())return null;var e=this.CalculateDrawPoint(),a=this.PointRange(e);return a&&(a.IsShowYCoordinate=!1),a},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint();if(!(!e||e.length!=1)&&this.Frame&&this.Value.length==1){if(!this.IsYValueInFrame(this.Value[0].YValue))return null;var a=this.Frame.IsHScreen;this.Frame.ChartBorder.GetLeft();var r=this.Frame.ChartBorder.GetRight();if(a&&(this.Frame.ChartBorder.GetTop(),r=this.Frame.ChartBorder.GetBottom()),this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),a)this.Canvas.moveTo(e[0].X,e[0].Y),this.Canvas.lineTo(e[0].X,r);else{var t=$t(this.LineWidth,e[0].Y);this.Canvas.moveTo(e[0].X,t),this.Canvas.lineTo(r,t)}this.Canvas.stroke(),this.RestoreLineWidth();var n={Start:new ft,End:new ft};a?(n.Start.X=e[0].X,n.Start.Y=e[0].Y,n.End.X=e[0].X,n.End.Y=r):(n.Start.X=e[0].X,n.Start.Y=e[0].Y,n.End.X=r,n.End.Y=e[0].Y),this.LinePoint.push(n),this.DrawPoint(e),this.Canvas.restore(),this.DrawValueLabel(e[0])}}},this.DrawValueLabel=function(e){if(e&&!this.Frame.IsHScreen){var a=e.Y,r=this.Frame.GetYData(a),t=r.toFixed(2),n=this.Frame.GetBorder(),s=this.LabelConfig;this.Canvas.font=s.Font;var o=this.Canvas.measureText("擎").width,l=this.Canvas.measureText(t).width;if(s.Right.IsShow&&this.Frame.ChartBorder.Right>5){var h=s.Right.Margin,u={Left:n.Right+1,Height:o+h.Top+h.Bottom,Width:l+h.Left+h.Right};u.Top=a-o/2-h.Top,u.Bottom=u.Top+u.Height,u.Right=u.Left+u.Width,this.Canvas.fillStyle=this.LineColor,this.Canvas.fillRect(u.Left,u.Top,u.Width,u.Height),this.Canvas.textAlign="left",this.Canvas.textBaseline="top";var f=u.Left+h.Left,C=u.Top+h.Top;this.Canvas.fillStyle=s.TextColor,this.Canvas.fillText(t,f,C)}}}}function OI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.Super_SetOption=this.SetOption,this.Super_ExportStorageData=this.ExportStorageData,this.LineWidth=1,this.Precision=2,this.ValueTextColor="rgb(250,250,250)",this.IsShowCorssCursor=!0,this.GetLabelCallback,this.PointCount=1,this.ClassName="ChartDrawHLine",this.Font=14*B()+"px 微软雅黑",this.TextFont=12*B()+"px 微软雅黑",this.RightSpaceWidth=50,this.ButtonPosition=0,this.ButtonBGColor="rgb(190,190,190)",this.ButtonSpace=3,this.TextMargin={Left:0,Right:0,Top:0,Bottom:0,YOffset:4*B()},this.AlwaysShowLab=!1,this.Button={CloseIcon:{Text:"",Color:"rgb(255,255,255)",Family:"iconfont",Size:16,ID:Rt.DRAW_PICTURE_DELETE,TooltipText:null,Margin:{Left:2,Right:2}},SettingIcon:{Text:"",Color:"rgb(255,255,255)",Family:"iconfont",Size:16,ID:Rt.DRAW_PICTURE_SETTING,TooltipText:null,Margin:{Left:2,Right:2}}},this.CustomButton=[],this.AryShowButton=[],this.AryButton=[],this.ExtendData,this.ShowPriceTextConfig={IsShow:[!1,!1,!0],Font:[12*B()+"px 微软雅黑",12*B()+"px 微软雅黑"]},this.LableInfo,this.ColseButtonSize=0,this.SettingButtonSize=0,this.ButtonBGWidth=0,this.VerticalButtonInfo={Width:0,Height:0},this.IsPointIn=this.IsPointIn_XYValue_Line,this.SetOption=function(e){if(this.Super_SetOption&&this.Super_SetOption(e),e){if(e.GetLabelCallback&&(this.GetLabelCallback=e.GetLabelCallback),v.IsNumber(e.Precision)&&(this.Precision=e.Precision),e.Font&&(this.Font=e.Font),e.ValueTextColor&&(this.ValueTextColor=e.ValueTextColor),e.ButtonBGColor&&(this.ButtonBGColor=e.ButtonBGColor),v.IsNumber(e.ButtonPosition)&&(this.ButtonPosition=e.ButtonPosition),v.IsNumber(e.RightSpaceWidth)&&(this.RightSpaceWidth=e.RightSpaceWidth),v.IsBool(e.AlwaysShowLab)&&(this.AlwaysShowLab=e.AlwaysShowLab),e.Button){var a=e.Button;a.CloseIcon?(this.Button.CloseIcon=At(a.CloseIcon),this.Button.CloseIcon.ID||(this.Button.CloseIcon.ID=Rt.DRAW_PICTURE_DELETE)):a.CloseIcon===null&&(this.Button.CloseIcon=null),a.SettingIcon?(this.Button.SettingIcon=At(a.SettingIcon),this.Button.SettingIcon.ID||(this.Button.SettingIcon.ID=Rt.DRAW_PICTURE_SETTING)):a.SettingIcon===null&&(this.Button.SettingIcon=null)}if(e.ExtendData&&(this.ExtendData=e.ExtendData),v.IsNonEmptyArray(e.IsShowPriceText))for(var r=0;r<e.IsShowPriceText.length&&r<3;++r){var t=e.IsShowPriceText[r];v.IsBool(t)&&(this.ShowPriceTextConfig.IsShow[r]=t)}if(e.TextMargin){var a=e.TextMargin;v.IsNumber(a.Left)&&(this.TextMargin.Left=a.Left),v.IsNumber(a.Right)&&(this.TextMargin.Right=a.Right),v.IsNumber(a.Top)&&(this.TextMargin.Top=a.Top),v.IsNumber(a.Bottom)&&(this.TextMargin.Bottom=a.Bottom),v.IsNumber(a.YOffset)&&(this.TextMargin.YOffset=a.YOffset)}}},this.ExportStorageData=function(){var e;return this.Super_ExportStorageData&&(e=this.Super_ExportStorageData(),this.Label&&(e.Label=this.Label)),e},this.IsDrawMain=function(){if(!this.GetActiveDrawPicture)return!0;var e=this.GetActiveDrawPicture();return e.Select.Guid!=this.Guid},this.MainDraw=function(){this.Draw()},this.GetShowButton=function(){var e=[],a=this.Button.SettingIcon;if(a&&a.Text&&e.push({Data:a,Width:null}),a=this.Button.CloseIcon,a&&a.Text&&e.push({Data:a,Width:null}),v.IsNonEmptyArray(this.CustomButton))for(var r=0;r<this.CustomButton.length;++r)a=this.CustomButton[r],a&&a.Text&&e.push({Data:a,Width:null});return e},this.Draw=function(e,a){if(this.AryShowButton=[],this.LinePoint=[],this.AryButton=[],this.ColseButtonSize=0,this.SettingButtonSize=0,this.ButtonBGWidth=0,this.LableInfo=null,this.VerticalButtonInfo.Width=0,this.VerticalButtonInfo.Height=0,!this.IsFrameMinSize()&&this.IsShow){var r=this.CalculateDrawPoint();if(!(!r||r.length!=1)&&this.Frame&&this.Value.length==1){var t=this.IsYValueInFrame(this.Value[0].YValue);if(!(!this.AlwaysShowLab&&!t)){var n=this.Frame.IsHScreen,s=this.Frame.ChartBorder.GetLeft(),o=this.Frame.ChartBorder.GetRight();n&&(s=this.Frame.ChartBorder.GetTop(),o=this.Frame.ChartBorder.GetBottom()),this.ClipFrame(),t&&(this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),n?(this.Canvas.moveTo(r[0].X,s),this.Canvas.lineTo(r[0].X,o)):(this.Canvas.moveTo(s,L(r[0].Y)),this.Canvas.lineTo(o,L(r[0].Y))),this.Canvas.stroke(),this.RestoreLineWidth());var l={Start:new ft,End:new ft};if(n?(l.Start.X=r[0].X,l.Start.Y=s,l.End.X=r[0].X,l.End.Y=o):(l.Start.X=s,l.Start.Y=r[0].Y,l.End.X=o,l.End.Y=r[0].Y),this.LinePoint.push(l),t){var h=this.Frame.GetYData(r[0].Y,!1),u=h.toFixed(this.Precision);this.ShowPriceTextConfig.IsShow[0]&&this.DrawPriceText(u,l.Start,l.End,0),this.ShowPriceTextConfig.IsShow[1]&&this.DrawPriceText(u,l.Start,l.End,1)}if(this.GetLabelCallback&&(this.LableInfo=this.GetLabelCallback(this)),this.AryShowButton=this.GetShowButton(),t&&this.DrawInternalLabel(r[0].Y),t){var f=s+(o-s)/2,C={X:f,Y:r[0].Y};this.DrawPoint([C])}if(this.Canvas.restore(),this.ShowPriceTextConfig.IsShow[2]&&(this.CalculateButtonSize(),this.DrawRightLabel(r[0].Y),t&&this.DrawCustomHLine(r[0].Y)),e&&a)for(var D=0;D<this.AryButton.length;++D){var c=this.AryButton[D],T=c.Rect;if(e.X>=T.Left&&e.X<T.Right&&e.Y>=T.Top&&e.Y<=T.Bottom){a.MouseOnToolbar={Rect:T,Item:c,Frame:this.Frame,Point:{X:e.X,Y:e.Y}};break}}}}}},this.CalculateLabSize=function(e){this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.font=this.TextFont;var a=this.Canvas.measureText("擎").width+2,t=0,n=0,s=0,r=0;v.IsNumber(e.LineSpace)&&(r=e.LineSpace);for(var t=0,n=0,s=0,o=0,l=0;l<e.AryText.length;++l){var h=e.AryText[l];h.NameWidth=0,h.TextWidth=0,h.Name&&(h.NameWidth=this.Canvas.measureText(h.Name).width+2),h.Text&&(h.TextWidth=this.Canvas.measureText(h.Text).width+2),t<h.NameWidth&&(t=h.NameWidth),n<h.TextWidth&&(n=h.TextWidth);var u=h.NameWidth+h.TextWidth;o<u&&(o=u),++s}var f={Width:o,Height:s*a+(s-1)*r,NameWidth:t,TextWidth:n,LineHeight:a};if(e.LabelMargin){var h=e.LabelMargin;v.IsNumber(h.Left)&&(f.Width+=h.Left),v.IsNumber(h.Right)&&(f.Width+=h.Right),v.IsNumber(h.Top)&&(f.Height+=h.Top),v.IsNumber(h.Bottom)&&(f.Height+=h.Bottom)}return f},this.DrawInternalLabel=function(e){if(!(!this.LableInfo||!v.IsNonEmptyArray(this.LableInfo.AryText))&&this.LableInfo.Position!=2){var a=this.Frame.GetBorder();a.Left;var r=a.Right,t=this.CalculateLabSize(this.LableInfo),n=r-t.Width,s=n+t.Width,o=e-t.Height-1;o<=a.TopEx&&(o=e+1);var l={Left:n,Right:s,Top:o,Width:t.Width,Height:t.Height};l.Bottom=l.Top+l.Height,this.DrawLabel(this.LableInfo,t,l)}},this.DrawLabel=function(e,a,r){e.BGColor&&(this.Canvas.fillStyle=e.BGColor,this.Canvas.fillRect(b(r.Left),b(r.Top),b(r.Width),b(r.Height)));var t=e.LabelMargin,n=0;v.IsNumber(e.LineSpace)&&(n=e.LineSpace);var s=r.Top,o=r.Left,l=r.Right;t&&(v.IsNumber(t.Left)&&(o+=t.Left),v.IsNumber(t.Right)&&(l-=t.Right),v.IsNumber(t.Top)&&(s+=t.Top)),this.Canvas.font=this.TextFont,this.Canvas.textBaseline="top";for(var h=0;h<e.AryText.length;++h){h>0&&(s+=n);var u=e.AryText[h];u.Name&&(this.Canvas.textAlign="left",this.Canvas.fillStyle=u.NameColor,this.Canvas.fillText(u.Name,o,s)),u.Text&&(this.Canvas.textAlign="right",this.Canvas.fillStyle=u.TextColor,this.Canvas.fillText(u.Text,l,s)),s+=a.LineHeight}},this.DrawRightLabel=function(e){var a={};if(!this.LableInfo||!v.IsNonEmptyArray(this.LableInfo.AryText)||this.LableInfo.Position!=2){this.DrawValueText(e,a);return}var r=this.CalculateValueText(e),t=this.CalculateLabSize(this.LableInfo),n=this.Frame.GetBorder(),s=e-r.Height/2,o=r.Height+t.Height,l=s+o,h={};l>n.Bottom&&(l=n.Bottom,s=l-o,h.Top=s),this.DrawValueText(e,a,h);var u=a.Right-t.Width;u<a.Left&&(u=a.Left);var f=u+t.Width,C=a.Bottom,D={Left:u,Right:f,Top:C,Width:t.Width,Height:t.Height};D.Bottom=D.Top+D.Height,this.DrawLabel(this.LableInfo,t,D),this.DrawVerticalButton(D)},this.DrawCustomHLine=function(e){if(this.LableInfo&&v.IsNonEmptyArray(this.LableInfo.AryLine)){for(var a=this.Frame.ChartBorder.GetLeft(),r=this.Frame.ChartBorder.GetRight(),t=B(),n=e,s=e,o=0;o<this.LableInfo.AryLine.length;++o){var l=this.LableInfo.AryLine[o];if(v.IsNumber(l.Value)&&!(l.Width<0)){var h=this.Frame.GetYFromData(l.Value),u=L(h),f=r;v.IsPlusNumber(l.Width)&&(l.Width<1?f=a+l.Width*(r-a):f=a+l.Width*t),l.Color?this.Canvas.strokeStyle=l.Color:this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(a,u),this.Canvas.lineTo(f,u),this.Canvas.stroke(),n<u&&(n=u),s>u&&(s=u)}}if(n!=s&&this.LableInfo.VLine){var l=this.LableInfo.VLine,C=a+20*t;v.IsNumber(l.XOffset)&&(C=a+l.XOffset*t),C=L(C),l.Color?this.Canvas.strokeStyle=l.Color:this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(C,n),this.Canvas.lineTo(C,s),this.Canvas.stroke()}}},this.DrawValueText=function(e,a,r){this.Frame.ChartBorder.GetLeft();var t=this.Frame.ChartBorder.GetRight(),n=this.Frame.ChartBorder.GetTopEx(),s=this.Frame.ChartBorder.GetBottomEx(),o=B(),l=this.LabelInfo;l&&v.IsNumber(l.TopOffset)&&(n-=l.TopOffset),l&&v.IsNumber(l.BottomOffset)&&(s+=l.BottomOffset);var h=this.Frame.GetYData(e,!1),u=h.toFixed(this.Precision);l&&l.PriceSuffixText&&(u+=l.PriceSuffixText);var f=!0;e<n?(e=n,f=!1):e>s&&(e=s,f=!1),this.RightSpaceWidth>0&&(f||this.Canvas.setLineDash([2*o,3*o]),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t,L(e)),this.Canvas.lineTo(t+this.RightSpaceWidth,L(e)),this.Canvas.stroke(),f||this.Canvas.setLineDash([])),this.Canvas.fillStyle=this.LineColor,this.Canvas.font=this.Font;var C=this.Canvas.measureText(u).width,D=this.GetFontHeight(),c={Left:t+this.RightSpaceWidth,YCenter:e,Width:C,Height:D};c.Height+=this.TextMargin.Top+this.TextMargin.Bottom,c.Width+=this.TextMargin.Left+this.TextMargin.Right,c.Right=c.Left+c.Width,c.Top=c.YCenter-c.Height/2,c.Bottom=c.Top+c.Height,r&&v.IsNumber(r.Top)&&(c.Top=r.Top,c.Bottom=c.Top+c.Height);var T=c.Left+this.TextMargin.Left,S=c.Top+this.TextMargin.Top+this.TextMargin.YOffset;this.ButtonPosition==1?this.Canvas.fillRect(b(c.Left),b(c.Top),b(c.Width+this.ButtonBGWidth),b(c.Height)):this.Canvas.fillRect(b(c.Left),b(c.Top),b(c.Width),b(c.Height)),this.Canvas.fillStyle=this.ValueTextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.fillText(u,T,S),a.Left=c.Left,a.Top=c.Top,a.Bottom=c.Bottom,a.Right=c.Right,this.DrawButton(c.Top,c.Right,D,a)},this.CalculateValueText=function(e){var a=this.Frame.GetYData(e,!1),r=a.toFixed(this.Precision);this.LableInfo&&this.LableInfo.PriceSuffixText&&(r+=this.LableInfo.PriceSuffixText),this.Canvas.font=this.Font;var t=this.Canvas.measureText(r).width,n=this.GetFontHeight(),s={Width:t,Height:n};return s.Height+=this.TextMargin.Top+this.TextMargin.Bottom,s.Width+=this.TextMargin.Left+this.TextMargin.Right,s},this.DrawPriceText=function(e,a,r,t){if(!(t!=1&&t!=0)){var n=this.ShowPriceTextConfig.Font[t];this.Canvas.fillStyle=this.LineColor,this.Canvas.font=n;var s=this.Canvas.measureText(e).width,o=this.GetFontHeight(),l=null;if(t==1){var l={Left:a.X,Top:a.Y-o/2,Width:s+4,Height:o};l.Right=l.Left+l.Width,l.Bottom=l.Top+l.Height}else if(t==0){var l={Right:r.X,Top:r.Y-o/2,Width:s+4,Height:o};l.Left=l.Right-l.Width,l.Bottom=l.Top+l.Height}this.Canvas.fillRect(b(l.Left),b(l.Top),b(l.Width+this.ButtonBGWidth),b(l.Height)),this.Canvas.fillStyle=this.ValueTextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(e,l.Left+2,a.Y)}},this.CalculateButtonSize=function(){var e=B();if(v.IsNonEmptyArray(this.AryShowButton)){for(var a=0,r=0;r<this.AryShowButton.length;++r){var t=this.AryShowButton[r],n=t.Data,s=n.Size*e+"px "+n.Family;if(this.Canvas.font=s,t.Width=this.Canvas.measureText(n.Text).width+2,t.Height=t.Width,n.Margin){var o=n.Margin;v.IsNumber(o.Left)&&(t.Width+=o.Left),v.IsNumber(o.Right)&&(t.Width+=o.Right),v.IsNumber(o.Top)&&(t.Height+=o.Top),v.IsNumber(o.Bottom)&&(t.Height+=o.Bottom)}this.VerticalButtonInfo.Width<t.Width&&(this.VerticalButtonInfo.Width=t.Width),this.VerticalButtonInfo.Height+=t.Height,a+=t.Width}this.ButtonBGWidth=a}},this.DrawVerticalButton=function(e){if(this.ButtonPosition==3&&v.IsNonEmptyArray(this.AryShowButton)&&!(this.VerticalButtonInfo.Height<=0)){var a={Left:e.Right,Top:e.Top,Width:this.VerticalButtonInfo.Width,Height:this.VerticalButtonInfo.Height};a.Right=a.Left+a.Width,a.Bottom=a.Top+a.Height,this.Canvas.fillStyle=this.ButtonBGColor,this.Canvas.fillRect(b(a.Left),b(a.Top),b(a.Width),b(a.Height));for(var r=B(),t=e.Top,n=0;n<this.AryShowButton.length;++n){var s=this.AryShowButton[n],o=s.Data,l={Left:a.Left,Top:t,Width:this.VerticalButtonInfo.Width,Height:s.Height};l.Right=l.Left+l.Width,l.Bottom=l.Top+l.Height;var h=l.Top+l.Height/2,u=l.Left+l.Width/2,f=o.Size*r+"px "+o.Family;this.Canvas.font=f,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=o.Color,this.Canvas.fillText(o.Text,u,h),this.AryButton.push({Rect:l,ID:o.ID,TooltipText:o.TooltipText,Data:o.Data}),t=l.Bottom}}},this.DrawButton=function(e,a,r,t){if(v.IsNonEmptyArray(this.AryShowButton)&&this.ButtonPosition!=3){if(this.ButtonPosition==1){e-=r;var n=this.Frame.ChartBorder.GetChartWidth();this.Frame.ChartBorder.GetRight()+this.RightSpaceWidth,a+this.ButtonBGWidth>n&&(a=n-this.ButtonBGWidth),t.Left>a&&(a=t.Left)}else this.ButtonPosition==2&&(e-=r,a=t.Left);this.Canvas.fillStyle=this.LineColor;var s=a,o={Left:a,Top:e,Width:this.ButtonBGWidth,Height:r};o.Right=o.Left+o.Width,o.Bottom=o.Top+o.Height,this.Canvas.fillStyle=this.ButtonBGColor,this.Canvas.fillRect(b(o.Left),b(o.Top),b(o.Width),b(o.Height));for(var l=B(),h=0;h<this.AryShowButton.length;++h){var u=this.AryShowButton[h],f=u.Data,C={Left:s,Top:e,Width:u.Width,Height:r};C.Right=C.Left+C.Width,C.Bottom=C.Top+C.Height;var D=C.Top+C.Height/2,c=C.Left+C.Width/2,T=f.Size*l+"px "+f.Family;this.Canvas.font=T,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=f.Color,this.Canvas.fillText(f.Text,c,D),this.AryButton.push({Rect:C,ID:f.ID,TooltipText:f.TooltipText,Data:f.Data}),s=C.Right}}},this.PtInButtons=function(e,a){for(var r=0;r<this.AryButton.length;++r){var t=this.AryButton[r];if(t.Rect){var n=t.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(n.Left,n.Top,n.Width,n.Height),this.Canvas.isPointInPath(e,a))return{ID:t.ID,Rect:n,Data:t.Data}}}return null}}function PI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureTrendLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!1});if(!(!e||e.length!=2)){var a=e[0],r=e[1],t=this.CalculateExtendLinePoint(a,r);this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),this.Canvas.moveTo(t.Start.X,t.Start.Y),this.Canvas.lineTo(t.End.X,t.End.Y),this.Canvas.stroke(),this.RestoreLineWidth();var n={Start:a,End:r};this.LinePoint.push(n),this.DrawPoint(e),this.Canvas.restore()}}}}function BI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureRect",this.GetXYCoordinate=this.GetXYCoordinate_default,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.Draw=function(){if(!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});!e||e.length!=2||(this.AreaColor=gt.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),this.Canvas.rect(e[0].X,e[0].Y,e[1].X-e[0].X,e[1].Y-e[0].Y),this.Canvas.stroke(),this.RestoreLineWidth(),this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.fillRect(e[0].X,e[0].Y,e[1].X-e[0].X,e[1].Y-e[0].Y),this.Canvas.restore(),this.DrawPoint(e))}},this.IsPointIn=function(e,a,r){if(this.IsFrameMinSize()||!this.Frame||this.Status!=10)return-1;var t=this.Frame.Data;if(!t)return-1;var n=this.IsPointInXYValue(e,a,r);if(n>=0)return n;var s=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!s||s.length!=2)return-1;var o=[{X:s[0].X,Y:s[0].Y},{X:s[1].X,Y:s[0].Y}];return this.IsPointInLine(o,e,a,r)||(o=[{X:s[1].X,Y:s[0].Y},{X:s[1].X,Y:s[1].Y}],this.IsPointInLine2(o,e,a,r))||(o=[{X:s[1].X,Y:s[1].Y},{X:s[0].X,Y:s[1].Y}],this.IsPointInLine(o,e,a,r))||(o=[{X:s[0].X,Y:s[1].Y},{X:s[0].X,Y:s[0].Y}],this.IsPointInLine2(o,e,a,r))?100:-1},this.IsPointInLine=function(e,a,r,t){var n=5;t&&v.IsNumber(t.Zoom)?n+=t.Zoom:this.Option&&v.IsNumber(this.Option.Zoom)&&(n+=this.Option.Zoom);var s=B();if(n*=s,this.Canvas.beginPath(),this.Canvas.moveTo(e[0].X,e[0].Y+n),this.Canvas.lineTo(e[0].X,e[0].Y-n),this.Canvas.lineTo(e[1].X,e[1].Y-n),this.Canvas.lineTo(e[1].X,e[1].Y+n),this.Canvas.closePath(),this.Canvas.isPointInPath(a,r))return!0},this.IsPointInLine2=function(e,a,r,t){var n=5;t&&v.IsNumber(t.Zoom)?n+=t.Zoom:this.Option&&v.IsNumber(this.Option.Zoom)&&(n+=this.Option.Zoom);var s=B();if(n*=s,this.Canvas.beginPath(),this.Canvas.moveTo(e[0].X-n,e[0].Y),this.Canvas.lineTo(e[0].X+n,e[0].Y),this.Canvas.lineTo(e[1].X+n,e[1].Y),this.Canvas.lineTo(e[1].X-n,e[1].Y),this.Canvas.closePath(),this.Canvas.isPointInPath(a,r))return!0}}function bI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureArc",this.Draw=function(){if(!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint();if(!(!e||e.length!=2)){if(this.ClipFrame(),this.SetLineWidth(),e[0].X<e[1].X&&e[0].Y>e[1].Y){var a=e[1].X-e[0].X,r=e[0].Y-e[1].Y,t=a>r?1/a:1/r,n=e[0].X,s=e[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(e[0].X,e[0].Y);for(var o=1.5*Math.PI;o<2*Math.PI;o+=t)this.Canvas.lineTo(n+a*Math.cos(o),s+r*Math.sin(o)*-1);for(var l=0;l<=.5*Math.PI;l+=t)this.Canvas.lineTo(n+a*Math.cos(l),s+r*Math.sin(l)*-1)}else if(e[0].X>e[1].X&&e[0].Y>e[1].Y){var a=e[0].X-e[1].X,r=e[0].Y-e[1].Y,t=a>r?1/a:1/r,n=e[1].X,s=e[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(e[0].X,e[0].Y);for(var o=0;o<=Math.PI;o+=t)this.Canvas.lineTo(n+a*Math.cos(o),s+r*Math.sin(o)*-1)}else if(e[0].X>e[1].X&&e[0].Y<e[1].Y){var a=e[0].X-e[1].X,r=e[1].Y-e[0].Y,t=a>r?1/a:1/r,n=e[0].X,s=e[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(e[0].X,e[0].Y);for(var o=.5*Math.PI;o<=1.5*Math.PI;o+=t)this.Canvas.lineTo(n+a*Math.cos(o),s+r*Math.sin(o)*-1)}else if(e[0].X<e[1].X&&e[0].Y<e[1].Y){var a=e[1].X-e[0].X,r=e[1].Y-e[0].Y,t=a>r?1/a:1/r,n=e[1].X,s=e[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(e[0].X,e[0].Y);for(var o=Math.PI;o<=2*Math.PI;o+=t)this.Canvas.lineTo(n+a*Math.cos(o),s+r*Math.sin(o)*-1)}this.Canvas.strokeStyle=this.LineColor,this.Canvas.stroke(),this.RestoreLineWidth(),this.Canvas.restore(),this.DrawPoint(e)}}},this.IsPointIn=function(e,a,r){if(this.IsFrameMinSize()||!this.Frame||this.Status!=10)return-1;var t=this.Frame.Data;if(!t)return-1;var n=this.IsPointInXYValue(e,a,r);if(n>=0)return n;var s=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!s||s.length!=2)return-1;var o=[{X:s[0].X,Y:s[0].Y},{X:s[1].X,Y:s[1].Y}];return this.IsPointInArc(o,e,a)?100:-1},this.IsPointInArc=function(e,a,r){if(e.length!=2)return!1;if(e[0].X<e[1].X&&e[0].Y>e[1].Y){var t=e[1].X-e[0].X,n=e[0].Y-e[1].Y,s=t>n?1/t:1/n,o=t*.8,l=n*.8,h=o>l?1/o:1/l,u=e[0].X,f=e[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(e[0].X,e[0].Y);for(var C=1.5*Math.PI;C<2*Math.PI;C+=s)this.Canvas.lineTo(u+t*Math.cos(C),f+n*Math.sin(C)*-1);for(var D=0;D<=.5*Math.PI;D+=s)this.Canvas.lineTo(u+t*Math.cos(D),f+n*Math.sin(D)*-1);for(var c=.5*Math.PI;c>=0;c-=h)this.Canvas.lineTo(u+o*Math.cos(c),f+l*Math.sin(D)*-1);for(var T=2*Math.PI;T>=1.5*Math.PI;T-=h)this.Canvas.lineTo(u+o*Math.cos(T),f+l*Math.sin(T)*-1);this.Canvas.closePath()}else if(e[0].X>e[1].X&&e[0].Y>e[1].Y){var t=e[0].X-e[1].X,n=e[0].Y-e[1].Y,s=t>n?1/t:1/n,o=t*.8,l=n*.8,h=o>l?1/o:1/l,u=e[1].X,f=e[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(e[0].X,e[0].Y);for(var C=0;C<=Math.PI;C+=s)this.Canvas.lineTo(u+t*Math.cos(C),f+n*Math.sin(C)*-1);for(var D=Math.PI;D>=0;D-=h)this.Canvas.lineTo(u+o*Math.cos(D),f+l*Math.sin(D)*-1);this.Canvas.closePath()}else if(e[0].X>e[1].X&&e[0].Y<e[1].Y){var t=e[0].X-e[1].X,n=e[1].Y-e[0].Y,s=t>n?1/t:1/n,o=t*.8,l=n*.8,h=o>l?1/o:1/l,u=e[0].X,f=e[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(e[0].X,e[0].Y);for(var C=.5*Math.PI;C<=1.5*Math.PI;C+=s)this.Canvas.lineTo(u+t*Math.cos(C),f+n*Math.sin(C)*-1);for(var D=1.5*Math.PI;D>=.5*Math.PI;D-=h)this.Canvas.lineTo(u+o*Math.cos(D),f+l*Math.sin(D)*-1);this.Canvas.closePath()}else if(e[0].X<e[1].X&&e[0].Y<e[1].Y){var t=e[1].X-e[0].X,n=e[1].Y-e[0].Y,s=t>n?1/t:1/n,o=t*.8,l=n*.8,h=o>l?1/o:1/l,u=e[1].X,f=e[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(e[0].X,e[0].Y);for(var C=Math.PI;C<=2*Math.PI;C+=s)this.Canvas.lineTo(u+t*Math.cos(C),f+n*Math.sin(C)*-1);for(var D=2*Math.PI;D>=Math.PI;D-=h)this.Canvas.lineTo(u+o*Math.cos(D),f+l*Math.sin(D)*-1);this.Canvas.closePath()}return!!this.Canvas.isPointInPath(a,r)}}function CD(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureWaveMW",this.PointCount=5,this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.IsHScreen=!1,this.Draw=function(){if(this.LinePoint=[],!!this.Frame&&!this.IsFrameMinSize()&&this.IsShow){this.IsHScreen=this.Frame.IsHScreen;var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e){this.AreaColor=gt.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.CalculateLines(e),this.SetLineWidth();for(var a in this.LinePoint){var r=this.LinePoint[a];this.DrawLine(r.Start,r.End)}this.RestoreLineWidth(),this.DrawPoint(e),this.Canvas.restore()}}},this.CalculateLines=function(e){if(this.Frame&&!(e.length<2)){if(this.Status==2){var a={Start:new ft,End:new ft};a.Start.Y=e[0].Y,a.Start.X=e[0].X,a.End.Y=e[1].Y,a.End.X=e[1].X,this.LinePoint.push(a);var r=e[1].X-e[0].X,t=e[1].Y-e[0].Y;a={Start:new ft,End:new ft},this.IsHScreen?(a.Start.Y=e[1].Y,a.Start.X=e[1].X,a.End.Y=e[1].Y+t,a.End.X=e[0].X):(a.Start.Y=e[1].Y,a.Start.X=e[1].X,a.End.Y=e[0].Y,a.End.X=e[1].X+r),this.LinePoint.push(a);var n=a.End,s=new ft;s.X=n.X,s.Y=n.Y,this.Point[2]=s,a={Start:new ft,End:new ft},this.IsHScreen?(a.Start.Y=n.Y,a.Start.X=n.X,a.End.Y=n.Y+t,a.End.X=e[1].X):(a.Start.Y=n.Y,a.Start.X=n.X,a.End.Y=e[1].Y,a.End.X=n.X+r),this.LinePoint.push(a);var n=a.End,s=new ft;s.X=n.X,s.Y=n.Y,this.Point[3]=s,a={Start:new ft,End:new ft},this.IsHScreen?(a.Start.Y=n.Y,a.Start.X=n.X,a.End.Y=n.Y+t,a.End.X=e[0].X):(a.Start.Y=n.Y,a.Start.X=n.X,a.End.Y=e[0].Y,a.End.X=n.X+r),this.LinePoint.push(a);var n=a.End,s=new ft;s.X=n.X,s.Y=n.Y,this.Point[4]=s,this.PointCount=this.Point.length}else if(e.length==5){var a={Start:new ft,End:new ft};a.Start.Y=e[0].Y,a.Start.X=e[0].X,a.End.Y=e[1].Y,a.End.X=e[1].X,this.LinePoint.push(a);var a={Start:new ft,End:new ft};a.Start.Y=e[1].Y,a.Start.X=e[1].X,a.End.Y=e[2].Y,a.End.X=e[2].X,this.LinePoint.push(a);var a={Start:new ft,End:new ft};a.Start.Y=e[2].Y,a.Start.X=e[2].X,a.End.Y=e[3].Y,a.End.X=e[3].X,this.LinePoint.push(a);var a={Start:new ft,End:new ft};a.Start.Y=e[3].Y,a.Start.X=e[3].X,a.End.Y=e[4].Y,a.End.X=e[4].X,this.LinePoint.push(a)}}}}function wI(){this.newMethod=CD,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawHeadShouldersBT",this.CalculateLines_Backup=this.CalculateLines,this.CalculateLines=function(e){if(this.Frame&&!(e.length<2))if(this.Status==2){var a={Start:new ft,End:new ft};a.Start.Y=e[0].Y,a.Start.X=e[0].X,a.End.Y=e[1].Y,a.End.X=e[1].X,this.LinePoint.push(a);var r=e[1].X-e[0].X,t=e[1].Y-e[0].Y;a={Start:new ft,End:new ft},this.IsHScreen?(a.Start.Y=e[1].Y,a.Start.X=e[1].X,a.End.Y=e[1].Y+t,a.End.X=e[0].X-r):(a.Start.Y=e[1].Y,a.Start.X=e[1].X,a.End.Y=e[0].Y-t,a.End.X=e[1].X+r),this.LinePoint.push(a);var n=a.End,s=new ft;s.X=n.X,s.Y=n.Y,this.Point[2]=s,a={Start:new ft,End:new ft},this.IsHScreen?(a.Start.Y=n.Y,a.Start.X=n.X,a.End.Y=n.Y+t,a.End.X=e[1].X):(a.Start.Y=n.Y,a.Start.X=n.X,a.End.Y=e[1].Y,a.End.X=n.X+r),this.LinePoint.push(a);var n=a.End,s=new ft;s.X=n.X,s.Y=n.Y,this.Point[3]=s,a={Start:new ft,End:new ft},this.IsHScreen?(a.Start.Y=n.Y,a.Start.X=n.X,a.End.Y=n.Y+t,a.End.X=e[0].X):(a.Start.Y=n.Y,a.Start.X=n.X,a.End.Y=e[0].Y,a.End.X=n.X+r),this.LinePoint.push(a);var n=a.End,s=new ft;s.X=n.X,s.Y=n.Y,this.Point[4]=s,this.PointCount=this.Point.length}else return this.CalculateLines_Backup(e)}}function nl(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureParallelLines",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.PointCount=3,this.LastPoint,this.CenterLine={LineDash:[2*B(),3*B()],Line:null,IsShow:!1},this.Super_SetOption=this.SetOption,this.Super_ExportStorageData=this.ExportStorageData,this.SetOption=function(e){if(this.Super_SetOption&&this.Super_SetOption(e),e&&e.CenterLine){var a=e.CenterLine;v.IsNonEmptyArray(a.LineDash)&&(this.CenterLine.LineDash=a.LineDash.slice(0)),v.IsBool(a.IsShow)&&(this.CenterLine.IsShow=a.IsShow)}},this.ExportStorageData=function(){var e;return this.Super_ExportStorageData&&(e=this.Super_ExportStorageData(),this.CenterLine&&(e.CenterLine={IsShow:this.CenterLine.IsShow,LineDash:this.CenterLine.LineDash.slice(0)})),e},this.Draw=function(){if(this.LinePoint=[],this.CenterLine.Line=null,!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!1});if(e){this.AreaColor=gt.ColorToRGBA(this.LineColor,.3);var a=e.slice(0);this.CalculateLines(a),this.ClipFrame(),this.DrawArea();for(var r in this.LinePoint){var t=this.LinePoint[r];this.DrawLine(t.Start,t.End)}if(this.CenterLine.IsShow&&this.CenterLine.Line){var t=this.CenterLine.Line;this.Canvas.setLineDash(this.CenterLine.LineDash),this.DrawLine(t.Start,t.End),this.Canvas.setLineDash([])}this.DrawPoint(a),this.Canvas.restore()}}},this.SetLastPoint=function(e){this.LastPoint={X:e.X,Y:e.Y}},this.DrawArea=function(){this.LinePoint.length==2&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[1].Start.X,this.LinePoint[1].Start.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(e){if(this.PointStatus==2&&this.LastPoint){var a=new ft;a.X=this.LastPoint.X,a.Y=this.LastPoint.Y,e[2]=a}if(e.length==2){var r=this.CalculateExtendLinePoint(e[0],e[1]);this.LinePoint.push(r)}else if(e.length==3){var r=this.CalculateExtendLinePoint(e[0],e[1]);this.LinePoint.push(r);var t=e[2].X-e[1].X,n=e[2].Y-e[1].Y,s=new ft,o=new ft;s.X=e[0].X+t,s.Y=e[0].Y+n,o.X=e[1].X+t,o.Y=e[1].Y+n,r=this.CalculateExtendLinePoint(s,o),this.LinePoint.push(r);var s=new ft,o=new ft;s.X=e[0].X+t/2,s.Y=e[0].Y+n/2,o.X=e[1].X+t/2,o.Y=e[1].Y+n/2,r=this.CalculateExtendLinePoint(s,o),this.CenterLine.Line=r}}}function DD(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawFlatTop",this.IsPointIn=this.IsPointIn_XYValue_Line,this.PointCount=3,this.LastPoint,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e){this.AreaColor=gt.ColorToRGBA(this.LineColor,.3);var a=e.slice(0);this.CalculateLines(a),this.ClipFrame();for(var r=0;r<this.LinePoint.length;++r){var t=this.LinePoint[r];this.DrawLine(t.Start,t.End)}this.DrawArea(),this.DrawPoint(a),this.Canvas.restore()}}},this.SetLastPoint=function(e){this.LastPoint={X:e.X,Y:e.Y}},this.DrawArea=function(){this.LinePoint.length==2&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[1].Start.X,this.LinePoint[1].Start.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(e){if(this.PointStatus==2&&this.LastPoint){var a=e[1],r=new ft;r.X=a.X,r.Y=this.LastPoint.Y,e[2]=r}if(e.length==2)this.LinePoint.push({Start:e[0],End:e[1]});else if(e.length==3){this.LinePoint.push({Start:e[0],End:e[1]});var t=e[2];t.X=e[1].X;var n={X:e[0].X,Y:t.Y},s={X:e[1].X,Y:t.Y};this.LinePoint.push({Start:n,End:s})}}}function GI(){this.newMethod=DD,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawDisjontChannel",this.IsPointIn=this.IsPointIn_XYValue_Line,this.PointCount=3,this.LastPoint}function _I(){this.newMethod=nl,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawParallelRaysLines",this.DrawArea=function(){},this.CalculateLines=function(e){if(this.PointStatus==2&&this.LastPoint){var a=new ft;a.X=this.LastPoint.X,a.Y=this.LastPoint.Y,e[2]=a}if(e.length==2){var r=this.CalculateExtendLineEndPoint([e[0],e[1]]);this.LinePoint.push({Start:e[0],End:r})}else if(e.length==3){var r=this.CalculateExtendLineEndPoint([e[0],e[1]]);this.LinePoint.push({Start:e[0],End:r});var t=e[2].X-e[1].X,n=e[2].Y-e[1].Y,s=new ft,o=new ft;s.X=e[0].X+t,s.Y=e[0].Y+n,o.X=e[1].X+t,o.Y=e[1].Y+n,r=this.CalculateExtendLineEndPoint([s,o]),this.LinePoint.push({Start:e[2],End:r})}}}function HI(){this.newMethod=nl,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPicturePriceChannel",this.CalculateLines=function(e){if(this.PointStatus==2&&this.LastPoint){var a=new ft;a.X=this.LastPoint.X,a.Y=this.LastPoint.Y,e[2]=a}if(e.length==2){var r=this.CalculateExtendLinePoint(e[0],e[1]);this.LinePoint.push(r)}else if(e.length==3){var r=this.CalculateExtendLinePoint(e[0],e[1]);this.LinePoint.push(r);var t=e[2].X-e[1].X,n=e[2].Y-e[1].Y,s=new ft,o=new ft;s.X=e[0].X+t,s.Y=e[0].Y+n,o.X=e[1].X+t,o.Y=e[1].Y+n,r=this.CalculateExtendLinePoint(s,o),this.LinePoint.push(r);var s=new ft,o=new ft;s.X=e[0].X-t,s.Y=e[0].Y-n,o.X=e[1].X-t,o.Y=e[1].Y-n,r=this.CalculateExtendLinePoint(s,o),this.LinePoint.push(r)}},this.DrawArea=function(){this.LinePoint.length==3&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[1].Start.X,this.LinePoint[1].Start.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[2].End.X,this.LinePoint[2].End.Y),this.Canvas.lineTo(this.LinePoint[2].Start.X,this.LinePoint[2].Start.Y),this.Canvas.closePath(),this.Canvas.fill())}}function VI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureParallelChannel",this.ChannelWidth=50,this.AreaColor="rgba(25,25,25,0.4)",this.LinePoint=[],this.CenterLine={LineDash:[2*B(),3*B()],Line:null,IsShow:!1},this.Super_SetOption=this.SetOption,this.ExportStorageData=function(){var e=this.ExportBaseData();e.ChannelWidth=this.ChannelWidth,e.Value=[];for(var a=0;a<this.Value.length&&a<2;++a){var r=this.Value[a];e.Value.push({XValue:r.XValue,YValue:r.YValue,DateTime:r.DateTime})}return this.CenterLine&&(e.CenterLine={IsShow:this.CenterLine.IsShow,LineDash:this.CenterLine.LineDash.slice(0)}),e},this.SetOption=function(e){if(this.Super_SetOption&&this.Super_SetOption(e),e&&(v.IsNumber(e.ChannelWidth)&&(this.ChannelWidth=e.ChannelWidth),e.CenterLine)){var a=e.CenterLine;v.IsNonEmptyArray(a.LineDash)&&(this.CenterLine.LineDash=a.LineDash.slice(0)),v.IsBool(a.IsShow)&&(this.CenterLine.IsShow=a.IsShow)}},this.CalculateDrawPoint=function(){if(this.Status<2||!this.Point.length||!this.Frame)return null;var e=this.Frame.Data;if(!e)return null;var a=[];if(this.Status==10)for(var r=0;r<2;++r){var t=this.Value[r],n=new ft;n.X=this.Frame.GetXFromIndex(t.XValue-e.DataOffset,!1),n.Y=this.Frame.GetYFromData(t.YValue,!1),a.push(n)}else for(var r=0;r<this.Point.length;++r){var t=this.Point[r],n=new ft;n.X=t.X,n.Y=t.Y,a.push(n)}if(a.length>=2){var s={Start:new ft,End:new ft};if(s.Start.X=a[0].X,s.Start.Y=a[0].Y,s.End.X=a[1].X,s.End.Y=a[1].Y,this.LinePoint.push(s),a.length==3||this.Status==10){var o=s.End.X-s.Start.X,l=s.End.Y-s.Start.Y,h=Math.atan(Math.abs(o/l)),u=this.ChannelWidth/Math.sin(h);s={Start:new ft,End:new ft},s.Start.X=a[0].X,s.Start.Y=a[0].Y-u,s.End.X=a[1].X,s.End.Y=a[1].Y-u,this.LinePoint.push(s);var f=new ft;f.X=s.Start.X+(s.End.X-s.Start.X)/2,f.Y=s.Start.Y+(s.End.Y-s.Start.Y)/2,a[2]=f,this.Point[2]=f;var C=parseInt(this.Frame.GetXData(f.X))+e.DataOffset,D=this.Frame.GetYData(f.Y);this.Value[2]={XValue:C,YValue:D},this.PointCount=this.Point.length,s={Start:new ft,End:new ft},s.Start.X=a[0].X,s.Start.Y=a[0].Y-u/2,s.End.X=a[1].X,s.End.Y=a[1].Y-u/2,this.CenterLine.Line=s}}return a},this.DrawArea=function(e,a,r,t){this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(e.X,e.Y),this.Canvas.lineTo(a.X,a.Y),this.Canvas.lineTo(r.X,r.Y),this.Canvas.lineTo(t.X,t.Y),this.Canvas.closePath(),this.Canvas.fill()},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint();if(e){this.AreaColor=gt.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.LinePoint.length==2&&this.DrawArea(this.LinePoint[0].Start,this.LinePoint[0].End,this.LinePoint[1].End,this.LinePoint[1].Start);for(var a=0;a<this.LinePoint.length;++a){var r=this.LinePoint[a];this.DrawLine(r.Start,r.End)}if(this.CenterLine.IsShow&&this.CenterLine.Line){var r=this.CenterLine.Line;this.Canvas.setLineDash(this.CenterLine.LineDash),this.DrawLine(r.Start,r.End),this.Canvas.setLineDash([])}this.Canvas.restore(),this.DrawPoint(e)}}},this.Move=function(e,a){if(this.Status!=20||!this.Frame)return!1;var r=this.Frame.Data;if(!r)return!1;if(this.MovePointIndex==100)for(var t=0;t<this.Point.length;++t)this.Point[t].X+=e,this.Point[t].Y+=a;else if(this.MovePointIndex==0||this.MovePointIndex==1)this.MovePointIndex<this.Point.length&&(this.Point[this.MovePointIndex].X+=e,this.Point[this.MovePointIndex].Y+=a);else if(this.MovePointIndex==2){this.Point[this.MovePointIndex].X+=e,this.Point[this.MovePointIndex].Y+=a;var n=this.Point[1].X-this.Point[0].X,s=this.Point[1].Y-this.Point[0].Y,o=Math.atan(Math.abs(n/s)),l=this.ChannelWidth/Math.sin(o)-a;this.ChannelWidth=Math.sin(o)*l}},this.IsPointIn=function(e,a){if(!this.Frame||this.Status!=10)return-1;var r=this.Frame.Data;if(!r)return-1;for(var t=0;t<this.Value.length;++t){var n=this.Value[t],s=new ft;if(t<2)s.X=this.Frame.GetXFromIndex(n.XValue-r.DataOffset),s.Y=this.Frame.GetYFromData(n.YValue);else{if(t>=this.Point.length)continue;s.X=this.Point[t].X,s.Y=this.Point[t].Y}if(this.Canvas.beginPath(),this.Canvas.arc(s.X,s.Y,5,0,360),this.Canvas.isPointInPath(e,a))return t}for(var t in this.LinePoint){var n=this.LinePoint[t],o=n.Start,l=n.End;if(this.Canvas.beginPath(),this.Canvas.moveTo(o.X,o.Y+5),this.Canvas.lineTo(o.X,o.Y-5),this.Canvas.lineTo(l.X,l.Y-5),this.Canvas.lineTo(l.X,l.Y+5),this.Canvas.closePath(),this.Canvas.isPointInPath(e,a))return 100}return-1}}function YI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureText",this.Text="文本",this.PointCount=1,this.FontOption={Family:"微软雅黑",Size:20,Weight:null,Style:null},this.TextRect=null,this.IsInitialized=!1,this.SettingMenu,this.HQChart,this.SetOption=function(e){e&&(e.LineColor&&(this.LineColor=e.LineColor),e.Text&&(this.Text=e.Text),e.FontOption&&(this.FontOption=e.FontOption))},this.Draw=function(e){if(this.TextRect=null,!this.IsFrameMinSize()&&this.IsShow){var a=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!(!a||a.length!=1)){this.ClipFrame(),this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.Canvas.font=this.GetTextFont(),this.Canvas.fillText(this.Text,a[0].X,a[0].Y);var r=this.Canvas.measureText(this.Text).width,t=this.FontOption.Size*B();this.TextRect={},this.TextRect.Left=a[0].X-r/2,this.TextRect.Top=a[0].Y-t,this.TextRect.Width=r,this.TextRect.Height=t,this.Canvas.restore(),this.IsInitialized===!1&&(this.SetTextOption(),this.IsInitialized=!0)}}},this.GetTextFont=function(){var e=16*B()+"px 微软雅黑";if(!this.FontOption||!this.FontOption.Family||this.FontOption.Size<=0)return e;var a="";return this.FontOption.Color&&(a+=this.FontOption.Color+" "),this.FontOption.Style&&(a+=this.FontOption.Style+" "),this.FontOption.Weight&&(a+=this.FontOption.Weight+" "),this.FontOption.Size>=0&&(a+=this.FontOption.Size*B()+"px "),a+=this.FontOption.Family,a},this.SetTextOption=function(){k.Chart.Log("[ChartDrawPictureText::SetTextOption]"),this.SettingMenu||(this.SettingMenu=new Dl(this.Frame.ChartBorder.UIElement.parentNode)),this.SettingMenu.ChartPicture=this,this.SettingMenu.HQChart=this.HQChart,this.SettingMenu.Position={Left:this.TextRect.Left+this.TextRect.Width,Top:this.TextRect.Top},this.SettingMenu.DoModal()},this.IsPointIn=function(e,a){if(!this.Frame||this.Status!=10)return-1;var r=this.Frame.Data;return!r||!this.TextRect?-1:(this.Canvas.beginPath(),this.Canvas.rect(this.TextRect.Left,this.TextRect.Top,this.TextRect.Width,this.TextRect.Height),this.Canvas.isPointInPath(e,a)?100:-1)}}function ol(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureIconFont",this.PointCount=1,this.Text="",this.FontOption={Family:"iconfont",Size:24},this.TextRect=null,this.SettingMenu,this.Angle=0,this.SetOption=function(e){e&&(e.LineColor&&(this.LineColor=e.LineColor),e.FontOption&&e.FontOption.Size>0&&(this.FontOption.Size=e.FontOption.Size),v.IsNumber(e.Angle)&&(this.Angle=e.Angle))},this.Draw=function(){if(this.TextRect=null,!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!(!e||e.length!=1)){var a=this.GetTextFont();if(a){this.ClipFrame();var r=this.Frame.IsHScreen,t=B();this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.font=a,r?(this.Canvas.translate(e[0].X,e[0].Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.Text,0,0)):this.Angle!=0?(this.Canvas.translate(e[0].X,e[0].Y),this.Canvas.rotate(this.Angle*(Math.PI/180)),this.Canvas.fillText(this.Text,0,0)):this.Canvas.fillText(this.Text,e[0].X,e[0].Y);var n=this.Canvas.measureText(this.Text).width;this.TextRect={},this.TextRect.Left=e[0].X-n/2,this.TextRect.Top=e[0].Y-this.FontOption.Size*t,this.TextRect.Width=n,this.TextRect.Height=this.FontOption.Size*t,this.Canvas.restore()}}}},this.GetTextFont=function(){if(!this.FontOption||!this.FontOption.Family||this.FontOption.Size<=0)return null;var e="";return this.FontOption.Size>=0&&(e+=this.FontOption.Size*B()+"px "),e+=this.FontOption.Family,e},this.IsPointIn=function(e,a){if(!this.Frame||this.Status!=10)return-1;var r=this.Frame.Data;if(!r||!this.TextRect)return-1;var t=0;return this.Option&&this.Option.Zoom>=1&&(t=this.Option.Zoom*B()),this.Canvas.beginPath(),this.Canvas.rect(this.TextRect.Left-t,this.TextRect.Top-t,this.TextRect.Width+t*2,this.TextRect.Height+t*2),this.Canvas.isPointInPath(e,a)?100:-1}}function hl(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureGannFan",this.IsPointIn=this.IsPointIn_XYValue_Line,this.LinePoint=[],this.Font=16*B()+"px 微软雅黑",this.LineDash=[5,10],this.EnableDottedLine=!1,this.EnableArea=!0,this.IsShowTitle=!0,this.Super_SetOption=this.SetOption,this.SetOption=function(e){this.Super_SetOption&&this.Super_SetOption(e),e&&(e.Font&&(this.Font=e.Font),Array.isArray(e.LineDash)&&(this.LineDash=e.LineDash),v.IsBool(e.EnableDottedLine)&&(this.EnableDottedLine=e.EnableDottedLine),v.IsBool(e.EnableArea)&&(this.EnableArea=e.EnableArea),v.IsBool(e.IsShowTitle)&&(this.IsShowTitle=e.IsShowTitle))},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e&&e.length==2){this.AreaColor=gt.ColorToRGBA(this.LineColor,.3),this.ClipFrame();var a=this.GetQuadrant(e[0],e[1]);if(this.SetLineWidth(),a===1||a===2||a===3||a===4){this.CalculateLines(e[0],e[1],a),this.EnableArea&&this.DrawArea();for(var r=0;r<this.LinePoint.length;++r){var t=this.LinePoint[r];this.DrawLine(t.Start,t.End,t.IsDottedLine)}if(this.IsShowTitle)for(var r=0;r<this.LinePoint.length;++r){var t=this.LinePoint[r];t.Text&&t.PtEnd&&this.DrawTitle(t.PtEnd,t.Text)}}else this.DrawLine(e[0],e[1],!1);this.RestoreLineWidth(),this.Canvas.restore(),this.DrawPoint(e)}}},this.GetQuadrant=function(e,a){return e.X<a.X&&e.Y>a.Y?1:e.X>a.X&&e.Y>a.Y?2:e.X<a.X&&e.Y<a.Y?4:3},this.DrawLine=function(e,a,r){r&&this.Canvas.setLineDash(this.LineDash),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(e.X,e.Y),this.Canvas.lineTo(a.X,a.Y),this.Canvas.stroke(),r&&this.Canvas.setLineDash([])},this.DrawTitle=function(e,a){this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.font=this.Font,this.Canvas.fillText(a,e.X,e.Y)},this.DrawArea=function(){var e=null,a=null;for(var r in this.LinePoint){var t=this.LinePoint[r];t.Text=="1:8"?e=this.LinePoint[r]:t.Text=="8:1"&&(a=this.LinePoint[r])}!e||!a||(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(e.End.X,e.End.Y),this.Canvas.lineTo(e.Start.X,e.Start.Y),this.Canvas.lineTo(a.End.X,a.End.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(e,a,r){if(!this.Frame)return!1;this.Frame.ChartBorder.GetTopEx(),this.Frame.ChartBorder.GetRight(),this.Frame.ChartBorder.GetBottom();var t=[.5,1/3,.25,.125,2/3],n=["1:2","1:3","1:4","1:8","2:3"],s=["2:1","3:1","4:1","8:1","3:2"],o=new ft,l=new ft;o.X=e.X,o.Y=e.Y,l.X=a.X,l.Y=a.Y;var h=Math.abs(e.X-a.X),u=Math.abs(e.Y-a.Y);if(r===1){var f=this.CalculateExtendLinePoint(e,a),C={Start:o,End:f.Start,IsDottedLine:!1,PtEnd:l,Text:"1:1"};this.LinePoint.push(C);for(var D=0;D<t.length;++D){if(h>5){C={Start:o,End:null,IsDottedLine:this.EnableDottedLine,PtEnd:new ft,Text:n[D]},C.PtEnd.Y=a.Y,C.PtEnd.X=e.X+h*t[D];var f=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=f.Start,this.LinePoint.push(C)}if(u>5){C={Start:o,End:null,IsDottedLine:this.EnableDottedLine,PtEnd:new ft,Text:s[D]},C.PtEnd.Y=e.Y-u*t[D],C.PtEnd.X=a.X;var f=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=f.Start,this.LinePoint.push(C)}}}else if(r==2){var f=this.CalculateExtendLinePoint(e,a),C={Start:o,End:f.Start,IsDottedLine:!1,PtEnd:l,Text:"1:1"};this.LinePoint.push(C);for(var D=0;D<t.length;++D){if(h>5){C={Start:o,End:null,IsDottedLine:this.EnableDottedLine,PtEnd:new ft,Text:n[D]},C.PtEnd.Y=a.Y,C.PtEnd.X=e.X-h*t[D];var f=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=f.Start,this.LinePoint.push(C)}if(u>5){C={Start:o,End:null,IsDottedLine:this.EnableDottedLine,PtEnd:new ft,Text:s[D]},C.PtEnd.Y=e.Y-u*t[D],C.PtEnd.X=a.X;var f=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=f.Start,this.LinePoint.push(C)}}}else if(r==3){var f=this.CalculateExtendLinePoint(e,a),C={Start:o,End:f.End,IsDottedLine:!1,PtEnd:l,Text:"1:1"};this.LinePoint.push(C);for(var D=0;D<t.length;++D){if(h>5){C={Start:o,End:null,IsDottedLine:this.EnableDottedLine,PtEnd:new ft,Text:n[D]},C.PtEnd.Y=a.Y,C.PtEnd.X=e.X-h*t[D];var f=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=f.End,this.LinePoint.push(C)}if(u>5){C={Start:o,End:null,IsDottedLine:this.EnableDottedLine,PtEnd:new ft,Text:s[D]},C.PtEnd.Y=e.Y+u*t[D],C.PtEnd.X=a.X;var f=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=f.End,this.LinePoint.push(C)}}}else if(r==4){var f=this.CalculateExtendLinePoint(e,a),C={Start:o,End:f.End,IsDottedLine:!1,PtEnd:l,Text:"1:1"};this.LinePoint.push(C);for(var D=0;D<t.length;++D){if(h>5){C={Start:o,End:null,IsDottedLine:this.EnableDottedLine,PtEnd:new ft,Text:n[D]},C.PtEnd.Y=a.Y,C.PtEnd.X=e.X+h*t[D];var f=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=f.End,this.LinePoint.push(C)}if(u>5){C={Start:o,End:null,IsDottedLine:this.EnableDottedLine,PtEnd:new ft,Text:s[D]},C.PtEnd.Y=e.Y+u*t[D],C.PtEnd.X=a.X;var f=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=f.End,this.LinePoint.push(C)}}}else return!1;return!0}}function XI(){this.newMethod=hl,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureGannFanV2",this.EnableDottedLine=!0,this.LineDash=[4,8],this.EnableArea=!1,this.Super_CalculateLines=this.CalculateLines,this.CalculateLines=function(e,a,r){if(!this.Super_CalculateLines(e,a,r))return!1;var t=this.Frame.ChartBorder.GetBorder();if(r==1){var n={Start:e,End:{X:t.Right,Y:e.Y},IsDottedLine:!1,PtEnd:null,Text:null};this.LinePoint.push(n);var n={Start:e,End:{X:e.X,Y:t.TopEx},IsDottedLine:!1,PtEnd:null,Text:null};this.LinePoint.push(n)}else if(r==2){var n={Start:e,End:{X:e.X,Y:t.TopEx},IsDottedLine:!1,PtEnd:null,Text:null};this.LinePoint.push(n);var n={Start:e,End:{X:t.Left,Y:e.Y},IsDottedLine:!1,PtEnd:null,Text:null};this.LinePoint.push(n)}else if(r==3){var n={Start:e,End:{X:t.Left,Y:e.Y},IsDottedLine:!1,PtEnd:null,Text:null};this.LinePoint.push(n);var n={Start:e,End:{X:e.X,Y:t.BottomEx},IsDottedLine:!1,PtEnd:null,Text:null};this.LinePoint.push(n)}else if(r==4){var n={Start:e,End:{X:e.X,Y:t.BottomEx},IsDottedLine:!1,PtEnd:null,Text:null};this.LinePoint.push(n);var n={Start:e,End:{X:t.Right,Y:e.Y},IsDottedLine:!1,PtEnd:null,Text:null};this.LinePoint.push(n)}}}function vD(){this.newMethod=hl,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureResistanceLine",this.CalculateLines=function(e,a,r){if(!this.Frame)return!1;this.Frame.ChartBorder.GetTopEx(),this.Frame.ChartBorder.GetRight(),this.Frame.ChartBorder.GetBottom();var t=[1/3,2/3],n=["3:1","3:2"],s=new ft,o=new ft;s.X=e.X,s.Y=e.Y,o.X=a.X,o.Y=a.Y,Math.abs(e.X-a.X);var l=Math.abs(e.Y-a.Y);if(r===1){var h=this.CalculateExtendLinePoint(e,a),u={Start:s,End:h.Start,IsDottedLine:!1,PtEnd:o,Text:"1:1"};this.LinePoint.push(u);for(var f=0;f<t.length;++f)if(l>5){u={Start:s,End:null,IsDottedLine:this.EnableDottedLine,PtEnd:new ft,Text:n[f]},u.PtEnd.Y=e.Y-l*t[f],u.PtEnd.X=a.X;var h=this.CalculateExtendLinePoint(u.Start,u.PtEnd);u.End=h.Start,this.LinePoint.push(u)}}else if(r==2){var h=this.CalculateExtendLinePoint(e,a),u={Start:s,End:h.Start,IsDottedLine:!1,PtEnd:o,Text:"1:1"};this.LinePoint.push(u);for(var f=0;f<t.length;++f)if(l>5){u={Start:s,End:null,IsDottedLine:this.EnableDottedLine,PtEnd:new ft,Text:n[f]},u.PtEnd.Y=e.Y-l*t[f],u.PtEnd.X=a.X;var h=this.CalculateExtendLinePoint(u.Start,u.PtEnd);u.End=h.Start,this.LinePoint.push(u)}}else if(r==3){var h=this.CalculateExtendLinePoint(e,a),u={Start:s,End:h.End,IsDottedLine:!1,PtEnd:o,Text:"1:1"};this.LinePoint.push(u);for(var f=0;f<t.length;++f)if(l>5){u={Start:s,End:null,IsDottedLine:this.EnableDottedLine,PtEnd:new ft,Text:n[f]},u.PtEnd.Y=e.Y+l*t[f],u.PtEnd.X=a.X;var h=this.CalculateExtendLinePoint(u.Start,u.PtEnd);u.End=h.End,this.LinePoint.push(u)}}else if(r==4){var h=this.CalculateExtendLinePoint(e,a),u={Start:s,End:h.End,IsDottedLine:!1,PtEnd:o,Text:"1:1"};this.LinePoint.push(u);for(var f=0;f<t.length;++f)if(l>5){u={Start:s,End:null,IsDottedLine:this.EnableDottedLine,PtEnd:new ft,Text:n[f]},u.PtEnd.Y=e.Y+l*t[f],u.PtEnd.X=a.X;var h=this.CalculateExtendLinePoint(u.Start,u.PtEnd);u.End=h.End,this.LinePoint.push(u)}}else return!1;return!0},this.DrawArea=function(){var e=null,a=null;for(var r in this.LinePoint){var t=this.LinePoint[r];t.Text=="1:1"?e=this.LinePoint[r]:t.Text=="3:1"&&(a=this.LinePoint[r])}!e||!a||(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(e.End.X,e.End.Y),this.Canvas.lineTo(e.Start.X,e.Start.Y),this.Canvas.lineTo(a.End.X,a.End.Y),this.Canvas.closePath(),this.Canvas.fill())}}function kI(){this.newMethod=vD,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureResistanceLineV2",this.EnableDottedLine=!0,this.LineDash=[4,8],this.EnableArea=!1,this.IsShowTitle=!1}function ll(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureGoldenSection",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Font=14*B()+"px 微软雅黑",this.GetSectionData=function(){var e=[0,.236,.382,.5,.618,.8,1,1.236,1.382,1.5,1.618,1.8,2];return e},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint();if(e&&e.length==2){this.AreaColor=gt.ColorToRGBA(this.LineColor,.3),this.CalculateLines(e[0],e[1]),this.ClipFrame(),this.SetLineWidth();for(var a in this.LinePoint){var r=this.LinePoint[a];this.DrawLine(r.Start,r.End,r.IsDottedLine)}this.RestoreLineWidth();for(var a in this.LinePoint){var r=this.LinePoint[a];r.Text&&this.DrawTitle(r.Start,r.Text)}this.DrawPoint(e),this.Canvas.restore()}}},this.CalculateHSCreenLines=function(e,a){for(var r=this.GetSectionData(),t=this.Frame.ChartBorder.GetTop(),n=this.Frame.ChartBorder.GetBottom(),s=e.X-a.X,o=0;o<r.length;++o){var l=s*r[o],h={Start:new ft,End:new ft};h.Start.X=e.X-l,h.Start.Y=t,h.End.X=e.X-l,h.End.Y=n;var u="";o==0?u="Base ":u=(r[o]*100).toFixed(2)+"% ";var f=this.Frame.GetYData(h.Start.X);u+=f.toFixed(2),h.Text=u,this.LinePoint.push(h)}},this.CalculateLines=function(e,a){if(this.Frame.IsHScreen){this.CalculateHSCreenLines(e,a);return}for(var r=this.GetSectionData(),t=this.Frame.ChartBorder.GetLeft(),n=this.Frame.ChartBorder.GetRight(),s=e.Y-a.Y,o=0;o<r.length;++o){var l=s*r[o],h={Start:new ft,End:new ft};h.Start.Y=e.Y-l,h.Start.X=t,h.End.Y=e.Y-l,h.End.X=n;var u="";o==0?u="Base ":u=(r[o]*100).toFixed(2)+"% ";var f=this.Frame.GetYData(h.Start.Y);u+=f.toFixed(2),h.Text=u,this.LinePoint.push(h)}},this.DrawLine=function(e,a){this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(e.X,e.Y),this.Canvas.lineTo(a.X,a.Y),this.Canvas.stroke()},this.DrawTitle=function(e,a){this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.font=this.Font,this.Frame.IsHScreen?(this.Canvas.save(),this.Canvas.translate(e.X,e.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(a,0,0),this.Canvas.restore()):this.Canvas.fillText(a,e.X,e.Y)}}function WI(){this.newMethod=ll,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPicturePercentage",this.GetSectionData=function(){var e=[0,.25,.333,.5,1];return e}}function UI(){this.newMethod=ll,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureWaveBand",this.GetSectionData=function(){var e=[0,.125,.25,.375,.5,.625,.75,.875,1];return e}}function KI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureTriangle",this.PointCount=3,this.Font=16*B()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.LastPoint,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e){var a=e.slice(0);this.AreaColor=gt.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.CalculateLines(a);for(var r in this.LinePoint){var t=this.LinePoint[r];this.DrawLine(t.Start,t.End)}this.DrawArea(a),this.DrawPoint(a),this.DrawTitle(a),this.Canvas.restore()}}},this.DrawArea=function(e){e.length==3&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(e[0].X,e[0].Y),this.Canvas.lineTo(e[1].X,e[1].Y),this.Canvas.lineTo(e[2].X,e[2].Y),this.Canvas.lineTo(e[0].X,e[0].Y),this.Canvas.closePath(),this.Canvas.fill())},this.DrawTitle=function(e){this.Status==10},this.SetLastPoint=function(e){this.LastPoint={X:e.X,Y:e.Y}},this.CalculateLines=function(e){if(this.PointStatus==2&&this.LastPoint){var a=new ft;a.X=this.LastPoint.X,a.Y=this.LastPoint.Y,e[2]=a}if(e.length===2){var r={Start:new ft,End:new ft};r.Start.Y=e[0].Y,r.Start.X=e[0].X,r.End.Y=e[1].Y,r.End.X=e[1].X,this.LinePoint.push(r)}else if(e.length===3){var r={Start:new ft,End:new ft};r.Start.Y=e[0].Y,r.Start.X=e[0].X,r.End.Y=e[1].Y,r.End.X=e[1].X,this.LinePoint.push(r),r={Start:new ft,End:new ft},r.Start.Y=e[1].Y,r.Start.X=e[1].X,r.End.Y=e[2].Y,r.End.X=e[2].X,this.LinePoint.push(r),r={Start:new ft,End:new ft},r.Start.Y=e[2].Y,r.Start.X=e[2].X,r.End.Y=e[0].Y,r.End.X=e[0].X,this.LinePoint.push(r)}}}function zI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureSymmetryAngle",this.PointCount=2,this.Font=16*B()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e){this.AreaColor=gt.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.CalculateLines(e);for(var a in this.LinePoint){var r=this.LinePoint[a];this.DrawLine(r.Start,r.End)}this.DrawArea(),this.DrawPoint(e),this.DrawTitle(e),this.Canvas.restore()}}},this.CalculateLines=function(e){if(e.length==2&&this.Frame){var a={Start:new ft,End:new ft};a.Start.Y=e[0].Y,a.Start.X=e[0].X,a.End.Y=e[1].Y,a.End.X=e[1].X,this.LinePoint.push(a),a={Start:new ft,End:new ft},a.Start.Y=e[0].Y,a.Start.X=e[0].X,a.End.Y=e[1].Y,a.End.X=e[0].X,this.LinePoint.push(a);var r=e[0].X-e[1].X;a={Start:new ft,End:new ft},a.Start.Y=e[0].Y,a.Start.X=e[0].X,a.End.Y=e[1].Y,a.End.X=e[0].X+r,this.LinePoint.push(a)}},this.DrawArea=function(){this.LinePoint.length==3&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[2].End.X,this.LinePoint[2].End.Y),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.closePath(),this.Canvas.fill())},this.DrawTitle=function(e){this.Status==10}}function JI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureCircle",this.PointCount=2,this.CircleData,this.GetXYCoordinate=this.GetXYCoordinate_default,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!(!e||e.length!=2)){this.AreaColor=gt.ColorToRGBA(this.LineColor,.3),this.ClipFrame();var a=e[0].X-e[1].X,r=e[0].Y-e[1].Y,t=Math.sqrt(a*a+r*r);this.Canvas.fillStyle=this.AreaColor,this.Canvas.strokeStyle=this.LineColor,this.DrawLine(e[0],e[1]),this.Canvas.beginPath(),this.Canvas.arc(e[0].X,e[0].Y,t,0,2*Math.PI),this.Canvas.stroke(),this.Canvas.fill(),this.CircleData={X:e[0].X,Y:e[0].Y,R:t},this.DrawPoint(e),this.Canvas.restore()}}},this.IsPointIn=function(e,a,r){if(this.IsFrameMinSize()||this.Status!=10)return-1;var t=this.IsPointInXYValue(e,a,r);if(t>=0)return t;if(this.CircleData&&this.CircleData.R>8){var n=this.CircleData.X-e,s=this.CircleData.Y-a,o=Math.sqrt(n*n+s*s);if(o<this.CircleData.R&&o>this.CircleData.R-8)return 100}return-1}}function ZI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureQuadrangle",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.PointCount=3,this.LastPoint,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e){this.AreaColor=gt.ColorToRGBA(this.LineColor,.3);var a=e.slice(0);this.CalculateLines(a),this.ClipFrame();for(var r in this.LinePoint){var t=this.LinePoint[r];this.DrawLine(t.Start,t.End)}this.DrawArea(),this.DrawPoint(a),this.Canvas.restore()}}},this.SetLastPoint=function(e){this.LastPoint={X:e.X,Y:e.Y}},this.DrawArea=function(){this.LinePoint.length==4&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[2].End.X,this.LinePoint[2].End.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(e){if(this.PointStatus==2&&this.LastPoint){var a=new ft;a.X=this.LastPoint.X,a.Y=this.LastPoint.Y,e[2]=a}if(e.length==2){var r=this.CreateLineData(e[0],e[1]);this.LinePoint.push(r)}else if(e.length==3){var r=this.CreateLineData(e[0],e[1]);this.LinePoint.push(r);var r=this.CreateLineData(e[1],e[2]);this.LinePoint.push(r);var t=e[2].X-e[1].X,n=e[2].Y-e[1].Y,s=new ft;s.X=e[0].X+t,s.Y=e[0].Y+n;var r=this.CreateLineData(e[2],s);this.LinePoint.push(r);var r=this.CreateLineData(s,e[0]);this.LinePoint.push(r)}}}function QI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureFibonacci",this.PointCount=1,this.Font=14*B()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint();if(e&&(this.CalculateLines(),!(this.LinePoint.length<=0))){this.ClipFrame(),this.SetLineWidth();for(var a in this.LinePoint){var r=this.LinePoint[a];this.DrawLine(r.Start,r.End),this.DrawTitle(r.Start,r.Title)}this.RestoreLineWidth(),this.DrawPoint(e),this.Canvas.restore()}}},this.DrawTitle=function(e,a){this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.font=this.Font,this.Frame.IsHScreen?(this.Canvas.save(),this.Canvas.translate(e.X,e.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(a,2,10),this.Canvas.restore()):this.Canvas.fillText(a,e.X+2,e.Y+10)},this.CalculateHSCreenLines=function(){var e=this.Frame.Data;if(e){var a=null;if(this.Status==10){if(this.Value.length!=1)return;a=this.Value[0].XValue}else{if(this.Point.length!=1)return;a=parseInt(this.Frame.GetXData(this.Point[0].Y))+e.DataOffset}for(var r=this.Frame.ChartBorder.GetRightEx(),t=this.Frame.ChartBorder.GetLeftEx(),n=this.Frame.XPointCount,s=[1,2,3,5,8,13,21,34,55,89,144,233],o=0;o<s.length;++o){var l=a+s[o],h=l-e.DataOffset;if(!(h<0||h>=n)){var u=this.Frame.GetXFromIndex(l-e.DataOffset,!1),f={Start:new ft,End:new ft,Title:s[o]};f.Start.X=r,f.Start.Y=u,f.End.X=t,f.End.Y=u,this.LinePoint.push(f)}}}},this.CalculateLines=function(){if(!(this.Status<2)&&this.Frame){var e=this.Frame.Data;if(e){if(this.Frame.IsHScreen){this.CalculateHSCreenLines();return}var a=null;if(this.Status==10){if(this.Value.length!=1)return;a=this.Value[0].XValue}else{if(this.Point.length!=1)return;a=parseInt(this.Frame.GetXData(this.Point[0].X))+e.DataOffset}for(var r=this.Frame.ChartBorder.GetTopEx(),t=this.Frame.ChartBorder.GetBottom(),n=this.Frame.XPointCount,s=[1,2,3,5,8,13,21,34,55,89,144,233],o=0;o<s.length;++o){var l=a+s[o],h=l-e.DataOffset;if(!(h<0||h>=n)){var u=this.Frame.GetXFromIndex(l-e.DataOffset,!1),f={Start:new ft,End:new ft,Title:s[o]};f.Start.Y=r,f.Start.X=u,f.End.Y=t,f.End.X=u,this.LinePoint.push(f)}}}}}}function Yo(e){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawLinearRegression",this.PointCount=2,this.IsPointIn=this.IsPointIn_XYValue_Line,this.ChartBorder,this.Lines=[],this.IsShowMaxMinLine=!1,this.IsShowExtendLine=!1,this.ExtendLineDash=[5,5],this.MaxPoint,this.MinPoint,e&&(e.IsShowMaxMinLine==!0&&(this.IsShowMaxMinLine=!0),e.IsShowExtendLine==!0&&(this.IsShowExtendLine=!0)),this.ImportStorageData=function(a){a.IsShowMaxMinLine==!0&&(this.IsShowMaxMinLine=!0),a.IsShowExtendLine==!0&&(this.IsShowExtendLine=!0),a.Lines&&(this.Lines=a.Lines),a.MaxPoint&&a.MinPoint&&(this.MaxPoint=a.MaxPoint,this.MinPoint=a.MinPoint)},this.Super_ExportStorageData=this.ExportStorageData,this.ExportStorageData=function(){var a;return this.Super_ExportStorageData&&(a=this.Super_ExportStorageData(),a.IsShowMaxMinLine=this.IsShowMaxMinLine,a.IsShowExtendLine=this.IsShowExtendLine,a.Lines=this.Lines,this.IsShowMaxMinLine&&(a.MaxPoint=this.MaxPoint,a.MinPoint=this.MinPoint)),a},this.PointToValue_Backup=this.PointToValue,this.PointToValue=function(){this.Point[0]={X:this.Lines[0].X,Y:this.Lines[0].Y},this.Point[1]={X:this.Lines[this.Lines.length-1].X,Y:this.Lines[this.Lines.length-1].Y},this.PointToValue_Backup()},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var a=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!a||a.length!=2){this.Status==10&&(this.ClipFrame(),this.ChartBorder=this.Frame.ChartBorder,this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.DrawLinearLines(),this.RestoreLineWidth(),this.Canvas.restore());return}this.ClipFrame(),this.ChartBorder=this.Frame.ChartBorder,this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor;var r=a[0],t=a[1];if(this.Status==10)this.DrawLinearLines();else{var n=this.ChartBorder.GetTopEx(),s=this.ChartBorder.GetBottomEx(),o=this.PointToKLine([r,t]),l=this.Calculate(o);this.Lines=l.Points,this.MaxPoint=l.Max,this.MinPoint=l.Min,this.DrawLinearLines(),this.Canvas.beginPath(),this.Canvas.moveTo(r.X,n),this.Canvas.lineTo(r.X,s),this.Canvas.moveTo(t.X,n),this.Canvas.lineTo(t.X,s),this.Canvas.stroke()}this.RestoreLineWidth();var h={Start:r,End:t};this.LinePoint.push(h),this.DrawPoint(a),this.Canvas.restore()}},this.Calculate=function(a){var r=a[0],t=a[1];r.XValue>t.XValue&&(r=a[1],t=a[0]);var n=t.XValue-r.XValue+1,s=this.Frame.Data.Data,D=t.XValue,o=0,l=0,h=0,u=0,f,C,D,c,T,S;for(c=0,T=n;c<n&&c<=D;++c,--T)o+=T,l+=s[D-c].Close;for(o/=n,l/=n,c=0,T=n;c<n&&c<=D;++c,--T)h+=(T-o)*(s[D-c].Close-l),u+=(T-o)*(T-o);C=h/u,f=l-o*C;var I=[],g=null,E=null;for(c=0,S=n;c<n&&c<=D;++c,--S){var F=t.XIndex-c,R=t.XValue-c,T=this.Frame.GetXFromIndex(F),A=C*S+f,P=this.Frame.GetYFromData(A,!1),p={X:T,Y:P,XValue:R,YValue:A};I.push(p),(g==null||g.High<s[R].High)&&(g={X:T,Y:P,XValue:R,YValue:A,High:s[R].High}),(E==null||E.Low>s[R].Low)&&(E={X:T,Y:P,XValue:R,YValue:A,Low:s[R].Low})}return{Points:I,Slope:C,Const:f,Max:g,Min:E}},this.DrawLinearLines=function(){if(!this.Frame)return null;var a=this.Frame.Data;if(!a)return null;var r=this.Frame.XPointCount,t=a.DataOffset,n=this.Frame.IsHScreen,s=[];for(var o in this.Lines){var l=this.Lines[o],h=l.XValue-t;if(!(h<0||h>=r)){var u={};n||(u.X=this.Frame.GetXFromIndex(h,!1),u.Y=this.Frame.GetYFromData(l.YValue,!1),u.YValue=l.YValue),s.push(u)}}if(s.length>1){for(var o in s){var l=s[o];o==0?(this.Canvas.beginPath(),this.Canvas.moveTo(l.X,l.Y)):(this.Canvas.lineTo(l.X,l.Y),o==s.length-1&&this.Canvas.stroke())}this.DrawExtendLine(s)}if(this.IsShowMaxMinLine&&s.length>1&&this.MaxPoint&&this.MinPoint){var f=this.MaxPoint.High-this.MaxPoint.YValue;for(var o in s){var l=s[o];l.Y=this.Frame.GetYFromData(l.YValue+f,!1),o==0?(this.Canvas.beginPath(),this.Canvas.moveTo(l.X,l.Y)):(this.Canvas.lineTo(l.X,l.Y),o==s.length-1&&this.Canvas.stroke())}this.DrawExtendLine(s);var C=this.MinPoint.Low-this.MinPoint.YValue;for(var o in s){var l=s[o];l.Y=this.Frame.GetYFromData(l.YValue+C,!1),o==0?(this.Canvas.beginPath(),this.Canvas.moveTo(l.X,l.Y)):(this.Canvas.lineTo(l.X,l.Y),o==s.length-1&&this.Canvas.stroke())}this.DrawExtendLine(s)}},this.DrawExtendLine=function(a){if(this.IsShowExtendLine){var r=a[0],t=a[a.length-1],n;t.X>r.X?n=[r,t]:n=[t,r];var s=this.CalculateExtendLineEndPoint(n);this.Canvas.beginPath(),this.Canvas.moveTo(t.X,t.Y),this.Canvas.lineTo(s.X,s.Y),this.Canvas.setLineDash(this.ExtendLineDash),this.Canvas.stroke(),this.Canvas.setLineDash([])}}}function $I(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawRuler",this.PointCount=2,this.Font=16*B()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.TitleColor=d.ChartDrawRuler.TitleColor,this.IsHScreen=!1,this.Draw=function(){this.LinePoint=[];var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e&&e.length==2){this.IsHScreen=this.Frame.IsHScreen,this.ClipFrame();var a=e[0],r=e[1],t=this.PointToKLine([a,r]),n=this.Calculate(t),s=v.IsNumber(n.Increase)?n.Increase.toFixed(2)+"%":"--",o=v.IsNumber(n.Risefall)?n.Risefall.toFixed(2):"--",l="间距:"+n.Count+" 涨跌:"+o+" 涨幅:"+s;this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(a.X,a.Y),this.Canvas.lineTo(r.X,r.Y),this.Canvas.stroke(),this.RestoreLineWidth();var h={Start:a,End:r};this.LinePoint.push(h),this.DrawPoint(e),this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.font=this.Font,this.TitleColor?this.Canvas.fillStyle=this.TitleColor:v.IsNumber(n.Increase)?n.Increase>0?this.Canvas.fillStyle=d.UpTextColor:n.Increase<0?this.Canvas.fillStyle=d.DownTextColor:this.Canvas.fillStyle=d.UnchagneTextColor:this.Canvas.fillStyle=d.UnchagneTextColor;var u=3*B(),f=a.X,C=a.Y;this.IsHScreen?(this.Canvas.translate(f+u,C+u),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(l,0,0)):this.Canvas.fillText(l,f+u,C-u),this.Canvas.restore()}},this.Calculate=function(e){var a=e[0],r=e[1];a.XValue>r.XValue&&(a=e[1],r=e[0]);for(var t=this.Frame.Data.Data,n,s,o,l,h,u=0,f=a.XValue;f<=r.XValue;++f,++u){var C=t[f];u==0?(l=C.YClose,n=C.Open,h=C.Close,o=C.Low,s=C.High):(h=C.Close,o>C.Low&&(o=C.Low),s<C.High&&(s=C.High))}if(!v.IsPlusNumber(l)){var D=a.XValue-1;D>=0&&D<t.length&&(l=t[D].Close)}var c={YClose:l,Open:n,High:s,Low:o,Close:h,Count:u};return v.IsPlusNumber(l)&&(c.Increase=(h-l)/l*100,c.Risefall=h-l),c}}function qI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPriceLine",this.Font=16*B()+"px 微软雅黑",this.PointCount=1,this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsHScreen=!1,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!0});if(e&&e.length==1){this.IsHScreen=this.Frame.IsHScreen;var a=e[0],r=this.Frame.ChartBorder;if(this.IsHScreen){var t=r.GetLeftEx(),n=r.GetRightEx();if(a.X<t||a.X>n)return;var s=r.GetBottom(),o={X:a.X,Y:s},l=this.Frame.GetYData(a.X,!1)}else{var s=r.GetBottomEx(),h=r.GetTopEx();if(a.Y<h||a.Y>s)return;var n=r.GetRight(),o={X:n,Y:a.Y},l=this.Frame.GetYData(a.Y,!1)}this.ClipFrame(),this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(a.X,a.Y),this.Canvas.lineTo(o.X,o.Y),this.Canvas.stroke(),this.RestoreLineWidth();var u={Start:a,End:o};this.LinePoint.push(u),this.DrawPoint(e),this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.fillStyle=this.LineColor,this.Canvas.font=this.Font;var f=2*B(),C=a.X,D=a.Y;this.IsHScreen?(this.Canvas.translate(C+f,D+f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(l.toFixed(2),0,0)):this.Canvas.fillText(l.toFixed(2),C+f,D-f),this.Canvas.restore()}}}}function jI(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPriceLineV2",this.Font=12*B()+"px 微软雅黑",this.PointCount=1,this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsHScreen=!1,this.LineWidth=1,this.IsDrawFirst=!0,this.TextColor="rgb(255,255,255)",this.Title,this.TextPosition=[null,0],this.Super_SetOption=this.SetOption,this.SetOption=function(e){this.Super_SetOption&&this.Super_SetOption(e),e&&(e.TextColor&&(this.TextColor=e.TextColor),e.Title&&(this.Title=e.Title),v.IsNonEmptyArray(e.TextPosition)&&(this.TextPosition=e.TextPosition.slice()))},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!0});if(e&&e.length==1&&this.IsYValueInFrame(this.Value[0].YValue)){this.IsHScreen=this.Frame.IsHScreen;var a=this.Frame.ChartBorder,r=this.Frame.GetBorder();if(this.IsHScreen){var t=r.LeftEx,n=r.RightEx,s=r.Bottom,o=r.Top,l={X:e[0].X,Y:o};if(l.X<t||l.X>n)return;var h={X:e[0].X,Y:s},u=this.Frame.GetYData(l.X,!1)}else{var s=r.BottomEx,o=r.TopTitle,t=r.Left,n=r.Right,l={X:t,Y:e[0].Y};if(l.Y<o||l.Y>s)return;var h={X:n,Y:e[0].Y},u=this.Frame.GetYData(l.Y,!1)}this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(l.X),L(l.Y)),this.Canvas.lineTo(L(h.X),L(h.Y)),this.Canvas.stroke(),this.RestoreLineWidth();var f={Start:l,End:h};this.LinePoint.push(f);var C=B();this.Canvas.font=this.Font;var D=2*C,c=h.X,T=h.Y;this.Canvas.textBaseline="middle",this.Canvas.textAlign="left";var S=this.GetFontHeight(),I=u.toFixed(2),g=this.Canvas.measureText(I).width+2*D,E=null;if(this.IsHScreen){var F=this.TextPosition[1],R=!1;if(F==0?R=a.Bottom<=10:F==1?R=!0:F==2&&(R=!1),R){T=T-g;var A={Left:c-S/2,Top:T,Width:S,Height:g}}else var A={Left:c-S/2,Top:T,Width:S,Height:g};if(this.Canvas.fillStyle=this.LineColor,this.Canvas.fillRect(A.Left,A.Top,A.Width,A.Height),this.Canvas.save(),this.Canvas.translate(c,T+1*C),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(I,0,0),this.Canvas.restore(),this.Title){var g=this.Canvas.measureText(this.Title).width+2*C;if(R)var P={Left:A.Left,Top:A.Top-g-1*C,Width:S,Height:g};else var P={Left:A.Left,Top:s-g-1*C,Width:S,Height:g};this.Canvas.fillStyle=this.LineColor,this.Canvas.fillRect(P.Left,P.Top,P.Width,P.Height),this.Canvas.save(),this.Canvas.translate(c,P.Top+1*C),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(this.Title,0,0),this.Canvas.restore()}E={X:l.X,Y:l.Y+(h.Y-l.Y)/2}}else{var F=this.TextPosition[1],R=!1;if(F==0?R=a.Right<=10:F==1?R=!0:F==2&&(R=!1),R)var A={Left:c-g,Top:T-S/2-1*C,Width:g,Height:S};else{var A={Left:c,Top:T-S/2-1*C,Width:g,Height:S};A.Left+A.Width>r.ChartWidth&&(A.Left=r.ChartWidth-A.Width-2*C)}if(this.Canvas.fillStyle=this.LineColor,this.Canvas.fillRect(A.Left,A.Top,A.Width,A.Height),this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(I,A.Left+D,T),this.Title){var g=this.Canvas.measureText(this.Title).width+2*C;if(R)var P={Left:A.Left-g,Top:A.Top,Width:g,Height:S};else{var P={Left:n-g-1*C,Top:A.Top,Width:g,Height:S};A.Left!=n&&(P.Left=A.Left-g-1*C)}this.Canvas.fillStyle=this.LineColor,this.Canvas.fillRect(P.Left,P.Top,P.Width,P.Height),this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(this.Title,P.Left+1*C,T)}E={X:l.X+(h.X-l.X)/2,Y:l.Y}}E&&this.DrawPoint([E])}}},this.DrawPrice=function(){}}function tm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawVerticalLine",this.PointCount=1,this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsHScreen=!1,this.GetXYCoordinate=this.GetXYCoordinate_default,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow&&!(!this.Frame||!this.Frame.Data)){var e=this.Frame.Data,a=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(a&&a.length==1){this.IsHScreen=this.Frame.IsHScreen;var r=a[0],t=this.Frame.ChartBorder;if(this.IsHScreen){var n=Math.round(this.Frame.GetXData(r.Y,!1))+e.DataOffset;n<0?n=0:n>=e.Data.length&&(n=e.Data.length-1);var s=this.Frame.GetXFromIndex(n-e.DataOffset,!1);s=$t(this.LineWidth,s);var o=t.GetLeftEx(),l=t.GetRightEx(),h={X:o,Y:s},u={X:l,Y:s}}else{var n=Math.round(this.Frame.GetXData(r.X,!1))+e.DataOffset;n<0?n=0:n>=e.Data.length&&(n=e.Data.length-1);var f=this.Frame.GetXFromIndex(n-e.DataOffset,!1);f=$t(this.LineWidth,f);var C=t.GetTopEx(),D=t.GetBottomEx(),h={X:f,Y:C},u={X:f,Y:D}}this.ClipFrame(),this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(h.X,h.Y),this.Canvas.lineTo(u.X,u.Y),this.Canvas.stroke(),this.RestoreLineWidth();var c={Start:h,End:u};this.LinePoint.push(c),this.Status==10&&this.DrawPoint(a),this.Canvas.restore()}}}}function em(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawCrosshair",this.PointCount=1,this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsHScreen=!1,this.GetXYCoordinate=this.GetXYCoordinate_default,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow&&!(!this.Frame||!this.Frame.Data)){var e=this.Frame.Data,a=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!1});if(a&&a.length==1){this.IsHScreen=this.Frame.IsHScreen;var r=a[0];this.Frame.ChartBorder;var t=this.Frame.GetBorder();if(this.IsHScreen){var n=Math.round(this.Frame.GetXData(r.Y,!1))+e.DataOffset;n<0?n=0:n>=e.Data.length&&(n=e.Data.length-1);var s=this.Frame.GetXFromIndex(n-e.DataOffset,!1);s=$t(this.LineWidth,s);var o=$t(this.LineWidth,r.X),l=t.LeftEx,h=t.RightEx,u=t.Top,f=t.Bottom,C={X:l,Y:s},D={X:h,Y:s},c={X:o,Y:u},T={X:o,Y:f}}else{var n=Math.round(this.Frame.GetXData(r.X,!1))+e.DataOffset;n<0?n=0:n>=e.Data.length&&(n=e.Data.length-1);var o=this.Frame.GetXFromIndex(n-e.DataOffset,!1);o=$t(this.LineWidth,o);var s=$t(this.LineWidth,r.Y),u=t.TopEx,f=t.BottomEx,l=t.Left,h=t.Right,C={X:o,Y:u},D={X:o,Y:f},c={X:l,Y:s},T={X:h,Y:s}}this.ClipFrame(),this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(C.X,C.Y),this.Canvas.lineTo(D.X,D.Y),this.Canvas.moveTo(c.X,c.Y),this.Canvas.lineTo(T.X,T.Y),this.Canvas.stroke(),this.RestoreLineWidth();var S={Start:C,End:D},I={Start:c,End:T};this.LinePoint.push(S),this.LinePoint.push(I),this.Status==10&&this.DrawPoint(a),this.Canvas.restore()}}}}function am(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawMonitorLine",this.PointCount=1,this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsHScreen=!1,this.GetXYCoordinate=this.GetXYCoordinate_default,this.FormatLabelTextCallback=null,this.LineColor="rgb(255,215,0)",this.LabelConfig={Font:12*B()+"px 微软雅黑",BGColor:"rgb(30,144,255)",LineColor:"rgba(255,215,0,0.8)",LineDash:[3,5],Mergin:{Left:5,Right:5,Top:5,Bottom:4},LineSpace:5,TextAlign:1},this.PointToValue_Backup=this.PointToValue,this.PointToValue=function(){if(!this.PointToValue_Backup())return!1;if(this.Frame.IsKLineFrame(!1)&&this.Frame.Identify===0){var e=this.Value[0].XValue,a=this.Frame.Data,r=a.Data[e];this.Value[0].YValue=r.Close}return!0},this.SetOption=function(e){if(e.LineColor&&(this.LineColor=e.LineColor),e.Label){var a=e.Label,r=this.LabelConfig;a.Font&&(r.Font=a.Font),a.BGColor&&(r.BGColor=a.BGColor),a.LineColor&&(r.LineColor=a.LineColor),a.LineDash&&(r.LineDash=a.LineDash),v.IsNumber(a.LineSpace)&&(r.LineSpace=a.LineSpace),v.IsNumber(a.TextAlign)&&(r.TextAlign=a.TextAlign),a.Mergin&&wa(r.Mergin,a.Mergin)}e.FormatLabelTextCallback&&(this.FormatLabelTextCallback=e.FormatLabelTextCallback)},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow&&!(!this.Frame||!this.Frame.Data)){var e=this.Frame.Data;v.IsNonEmptyArray(e.Data)&&this.Point.length==1&&this.Value.length==1&&(this.IsHScreen=this.Frame.IsHScreen,!this.IsHScreen&&(this.Status==20?this.DrawMoveLine():this.Status==10&&this.DrawMonitorLine(e)))}},this.DrawMoveLine=function(){var e=this.Frame.ChartBorder.GetBorder(),a=this.Point[0],r=L(a.X);this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(r,e.TopEx),this.Canvas.lineTo(r,e.BottomEx),this.Canvas.stroke(),this.Canvas.restore()},this.DrawMonitorLine=function(e){var a=this.Frame.IsMinuteFrame(),r=this.Frame.DataWidth,t=this.Frame.DistanceWidth,n=this.Frame.XPointCount;if(!this.IsHScreen)var s=this.Frame.ChartBorder.GetBorder(),o=s.LeftEx+t/2+d.FrameLeftMargin,l=s.RightEx;var h=this.Value[0];this.ClipFrame();for(var u=null,f=e.DataOffset,C=0;f<e.Data.length&&C<n;++f,++C,o+=r+t){if(e.Data[f],a)var D=this.Frame.GetXFromIndex(C);else{var c=o,T=o+r;if(T>l)break;var D=c+(T-c)/2}if(f==h.XValue){this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(D,s.TopEx),this.Canvas.lineTo(D,s.BottomEx),this.Canvas.stroke();var S={Start:{X:D,Y:s.TopEx},End:{X:D,Y:s.BottomEx}};this.LinePoint.push(S)}else f==e.Data.length-1&&(this.LabelConfig.LineDash&&this.Canvas.setLineDash(this.LabelConfig.LineDash),this.Canvas.strokeStyle=this.LabelConfig.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(D,s.TopEx),this.Canvas.lineTo(D,s.BottomEx),this.Canvas.stroke(),this.LabelConfig.LineDash&&this.Canvas.setLineDash([]),u={Left:T,Data:e,StartIndex:h.XValue,AryText:[]})}this.Canvas.restore(),u&&this.DrawLabel(u)},this.DrawLabel=function(e){if(this.FormatLabelTextCallback&&(e.Config=this.LabelConfig,this.FormatLabelTextCallback(e),!!v.IsNonEmptyArray(e.AryText)&&v.IsNumber(e.YValue))){this.CalculateLabelSize(e);var a=this.Frame.GetYFromData(e.YValue,!1),r={Left:e.Left+1,Top:a,Width:e.Width,Height:e.Height};r.Right=r.Left+r.Width,r.Bottom=r.Top+r.Height,this.DrawDefaultLabel(e,r)}}}function im(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawWaveRuler",this.PointCount=3,this.Font=16*B()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.LastPoint,this.LinePoint,this.ScaleRuler=d.ChartDrawWaveRuler.ScaleRuler,this.RulerWidth=d.ChartDrawWaveRuler.RulerWidth,this.RulerLineWidth=d.ChartDrawWaveRuler.RulerLineWidth,this.MaxScaleRuler=d.ChartDrawWaveRuler.MaxScaleRuler,this.Font=d.ChartDrawWaveRuler.MaxScaleRuler,this.IsHScreen=!1,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e){this.IsHScreen=this.Frame.IsHScreen,this.CalculateLines(e),this.ClipFrame(),this.SetLineWidth();for(var a in this.LinePoint){var r=this.LinePoint[a];this.DrawLine(r.Start,r.End)}e.length==3&&this.DrawWaveRuler(e),this.RestoreLineWidth(),this.DrawPoint(e),this.Canvas.restore()}}},this.SetLastPoint=function(e){this.LastPoint={X:e.X,Y:e.Y}},this.CalculateLines=function(e){if(this.PointStatus==2&&this.LastPoint){var a=new ft;a.X=this.LastPoint.X,a.Y=this.LastPoint.Y,e[2]=a}if(e.length==2){var r={Start:{X:e[0].X,Y:e[0].Y},End:{X:e[1].X,Y:e[1].Y}};this.LinePoint.push(r)}else if(e.length==3){var r={Start:{X:e[0].X,Y:e[0].Y},End:{X:e[1].X,Y:e[1].Y}};this.LinePoint.push(r),r={Start:{X:e[1].X,Y:e[1].Y},End:{X:e[2].X,Y:e[2].Y}},this.LinePoint.push(r)}},this.DrawWaveRuler=function(e){var a=e[1],r=e[0],t=e[2],n=this.RulerLineWidth*B();this.Canvas.lineWidth=n,this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.fillStyle=this.LineColor,this.Canvas.font=this.Font;var s=this.RulerWidth*B();if(this.IsHScreen){var o=r.X-a.X,l={X:t.X-this.MaxScaleRuler*o,Y:t.Y};this.DrawLine(t,l),this.LinePoint.push({Start:t,End:l});var h=t.Y-s/2,u=t.Y+s/2}else{var o=r.Y-a.Y,l={X:$t(n,t.X),Y:t.Y-this.MaxScaleRuler*o};this.DrawLine({X:$t(n,t.X),Y:t.Y},l),this.LinePoint.push({Start:t,End:l});var f=t.X-s/2,C=t.X+s/2}var D=4*B();for(var c in this.ScaleRuler){var T=this.ScaleRuler[c];if(this.IsHScreen){var f=t.X-T.Value*o,S=this.Frame.GetYData(f,!1);this.DrawLine({X:f,Y:h},{X:f,Y:u});var I=S.toFixed(2)+"  "+(T.Text?T.Text:T.Value.toFixed(3));this.Canvas.save(),this.Canvas.translate(f,t.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(I,D,0),this.Canvas.restore()}else{var h=t.Y-T.Value*o,S=this.Frame.GetYData(h,!1);this.DrawLine({X:f,Y:$t(n,h)},{X:C,Y:$t(n,h)});var I=S.toFixed(2)+"  "+(T.Text?T.Text:T.Value.toFixed(3));this.Canvas.fillText(I,C+D,h)}}}}function rm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawWaveRuler2Point",this.PointCount=2,this.Font=14*B()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.PointRate=[510,517,511.4],this.LinePoint,this.CPoint,this.ScaleRuler=d.ChartDrawWaveRuler2Point.ScaleRuler,this.RulerWidth=d.ChartDrawWaveRuler2Point.RulerWidth,this.RulerLineWidth=d.ChartDrawWaveRuler2Point.RulerLineWidth,this.MaxScaleRuler=d.ChartDrawWaveRuler2Point.MaxScaleRuler,this.Font=d.ChartDrawWaveRuler2Point.MaxScaleRuler,this.IsHScreen=!1,this.Super_SetOption=this.SetOption,this.SetOption=function(e){this.Super_SetOption&&this.Super_SetOption(e),e&&e.PointRate&&(this.PointRate=e.PointRate)},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e){this.IsHScreen=this.Frame.IsHScreen,this.CalculateLines(e),this.ClipFrame(),this.SetLineWidth();for(var a in this.LinePoint){var r=this.LinePoint[a];this.DrawLine(r.Start,r.End)}var t=[e[0],e[1],this.CPoint];this.DrawWaveRuler(t),this.RestoreLineWidth(),this.DrawPoint(e),this.Canvas.restore()}}},this.CalculateLines=function(e){var a={Start:{X:e[0].X,Y:e[0].Y},End:{X:e[1].X,Y:e[1].Y}};this.LinePoint.push(a);var r=e[0].Y,t=e[1].Y,n=this.PointRate[1]-this.PointRate[0],s=this.PointRate[2]-this.PointRate[0],o=r-(r-t)*s/n;this.CPoint={X:e[1].X,Y:o}},this.DrawWaveRuler=function(e){var a=e[1],r=e[0],t=e[2],n=this.RulerLineWidth*B();this.Canvas.lineWidth=n,this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.fillStyle=this.LineColor,this.Canvas.font=this.Font;var s=this.RulerWidth*B();if(this.IsHScreen){var o=r.X-a.X,l={X:t.X-this.MaxScaleRuler*o,Y:t.Y};this.DrawLine(t,l),this.LinePoint.push({Start:t,End:l});var h=t.Y-s/2,u=t.Y+s/2}else{var o=r.Y-a.Y,l={X:$t(n,t.X),Y:t.Y-this.MaxScaleRuler*o};this.DrawLine({X:$t(n,t.X),Y:t.Y},l),this.LinePoint.push({Start:t,End:l});var f=t.X,C=t.X+s}var D=4*B();for(var c in this.ScaleRuler){var T=this.ScaleRuler[c];if(this.IsHScreen){var f=t.X-T.Value*o,S=this.Frame.GetYData(f,!1);this.DrawLine({X:f,Y:h},{X:f,Y:u});var I=S.toFixed(2)+"  "+(T.Text?T.Text:T.Value.toFixed(3));this.Canvas.save(),this.Canvas.translate(f,t.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(I,D,0),this.Canvas.restore()}else{var h=t.Y-T.Value*o,S=this.Frame.GetYData(h,!1);this.DrawLine({X:f,Y:$t(n,h)},{X:C,Y:$t(n,h)});var I=S.toFixed(2)+"  "+(T.Text?T.Text:T.Value.toFixed(3));this.Canvas.fillText(I,C+D,h)}}}}function sm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawBox",this.PointCount=2,this.Font=16*B()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsHScreen=!1,this.AvPriceLineDash=[5*B(),5*B()],this.KLineBorder,this.PointToValue_Backup=this.PointToValue,this.PointToValue=function(){this.Point[0]={X:this.KLineBorder.Left,Y:this.KLineBorder.Top},this.Point[1]={X:this.KLineBorder.Right,Y:this.KLineBorder.Bottom},this.PointToValue_Backup()},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e&&e.length==2){this.IsHScreen=this.Frame.IsHScreen,this.ClipFrame();var a=e[0],r=e[1],t=this.PointToKLine([a,r]);k.Chart.Log("[ChartDrawBox::Draw] kPoint",t);var n=this.Calculate(t);k.Chart.Log("[ChartDrawBox::Draw] kDataInfo",n);var s=this.GetKLineBorder(e,n);this.KLineBorder=s,this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.strokeRect(b(s.Left),b(s.Top),b(s.Right-s.Left),b(s.Bottom-s.Top));var o;if(n.Amount>0&&n.Vol>0){var l=n.Amount/n.Vol;if(o="均价"+l.toFixed(2),this.Canvas.beginPath(),this.IsHScreen){var h=this.Frame.GetYFromData(l,!1);this.Canvas.moveTo($t(this.Canvas.lineWidth,h),s.Top),this.Canvas.lineTo($t(this.Canvas.lineWidth,h),s.Bottom)}else{var u=this.Frame.GetYFromData(l,!1);this.Canvas.moveTo(s.Left,$t(this.Canvas.lineWidth,u)),this.Canvas.lineTo(s.Right,$t(this.Canvas.lineWidth,u))}this.Canvas.setLineDash(this.AvPriceLineDash),this.Canvas.stroke(),this.Canvas.setLineDash([])}this.RestoreLineWidth(),this.DrawPoint(e),this.Canvas.textBaseline="top",this.Canvas.textAlign="left",this.Canvas.font=this.Font,this.Canvas.fillStyle=this.LineColor;var f=2*B(),C="K线数"+n.Count;this.IsHScreen?this.DrawText(C,s.Right,s.Top,f,f):this.DrawText(C,s.Left,s.Top,f,f),o&&(this.IsHScreen?this.DrawText(o,h,s.Top,f,f):this.DrawText(o,s.Left,u,f,f));var D=v.IsNumber(n.YClose)?n.YClose:n.Open,c=(n.Close-D)/D*100;C=c.toFixed(2)+"%",this.IsHScreen?this.DrawText(C,s.Right,s.Bottom,f,f):this.DrawText(C,s.Right,s.Top,f,f),c=n.Close-D,C=""+c.toFixed(2),this.Canvas.textBaseline="bottom",this.IsHScreen?this.DrawText(C,s.Left,s.Bottom,f,0):this.DrawText(C,s.Right,s.Bottom,f,0),this.Canvas.restore()}}},this.Calculate=function(e){var a=e[0],r=e[1];a.XValue>r.XValue&&(a=e[1],r=e[0]);for(var t=this.Frame.Data.Data,n,s,o,l,h,u=0,f=0,C=0,D=a.XValue;D<=r.XValue;++D,++C){var c=t[D];C==0?(l=c.YClose,n=c.Open,h=c.Close,o=c.Low,s=c.High):(h=c.Close,o>c.Low&&(o=c.Low),s<c.High&&(s=c.High)),u+=c.Vol,f+=c.Amount}var T={YClose:l,Open:n,High:s,Low:o,Close:h,Count:C,Vol:u,Amount:f};return T},this.GetKLineBorder=function(e,a){var r=e[0],t=e[1],n=this.Frame.Data;if(this.IsHScreen){var s=Math.round(this.Frame.GetXData(r.Y,!1))+n.DataOffset;s<0?s=0:s>=n.Data.length&&(s=n.Data.length-1);var o=this.Frame.GetXFromIndex(s-n.DataOffset,!1);s=Math.round(this.Frame.GetXData(t.Y,!1))+n.DataOffset,s<0?s=0:s>=n.Data.length&&(s=n.Data.length-1);var l=this.Frame.GetXFromIndex(s-n.DataOffset,!1),h=this.Frame.GetYFromData(a.High,!1),u=this.Frame.GetYFromData(a.Low,!1),f={Left:u,Top:o,Right:h,Bottom:l};return this.LinePoint.push({Start:{X:u,Y:o},End:{X:l,Y:o}}),this.LinePoint.push({Start:{X:u,Y:l},End:{X:l,Y:l}}),this.LinePoint.push({Start:{X:u,Y:o},End:{X:u,Y:l}}),this.LinePoint.push({Start:{X:h,Y:o},End:{X:h,Y:l}}),f}else{var s=Math.round(this.Frame.GetXData(r.X,!1))+n.DataOffset;s<0?s=0:s>=n.Data.length&&(s=n.Data.length-1);var C=this.Frame.GetXFromIndex(s-n.DataOffset,!1);s=Math.round(this.Frame.GetXData(t.X,!1))+n.DataOffset,s<0?s=0:s>=n.Data.length&&(s=n.Data.length-1);var D=this.Frame.GetXFromIndex(s-n.DataOffset,!1),c=this.Frame.GetYFromData(a.High,!1),T=this.Frame.GetYFromData(a.Low,!1),f={Left:C,Top:c,Right:D,Bottom:T};return this.LinePoint.push({Start:{X:C,Y:c},End:{X:D,Y:c}}),this.LinePoint.push({Start:{X:C,Y:T},End:{X:D,Y:T}}),this.LinePoint.push({Start:{X:C,Y:c},End:{X:C,Y:T}}),this.LinePoint.push({Start:{X:D,Y:c},End:{X:D,Y:T}}),f}},this.DrawText=function(e,a,r,t,n){this.IsHScreen?(this.Canvas.save(),this.Canvas.translate(a,r),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(e,t,n),this.Canvas.restore()):this.Canvas.fillText(e,a+t,r+n)}}function ul(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawTwoPointDemo",this.PointCount=2,this.Font=16*B()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsHScreen=!1,this.PointInfo=[],this.PointToValue_Backup=this.PointToValue,this.PointToValue=function(){this.OnFinish(),this.PointToValue_Backup()},this.OnFinish=function(){for(var e in this.PointInfo){var a=this.PointInfo[e];!a||!a.Point||!v.IsNumber(a.Point.Y2)||(this.Point[e].Y=this.PointInfo[e].Point.Y2)}},this.Draw=function(){if(this.LinePoint=[],this.PointInfo=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e){if(this.IsHScreen=this.Frame.IsHScreen,this.ClipFrame(),this.SetLineWidth(),e[0],e[1],this.CalculatePointInfo(e),this.Status==10)this.DrawEx();else for(var a=1;a<e.length;++a)this.DrawLine(e[a-1],e[a]);this.RestoreLineWidth(),this.DrawPoint(e),this.Canvas.restore()}}},this.CalculatePointInfo=function(e){if(!(!this.Frame||!this.Frame.Data)){var a=this.PointToKLine(e);if(this.PointCount==3&&this.PointStatus==2&&this.LastPoint){var r=new ft;r.X=this.LastPoint.X,r.Y=this.LastPoint.Y,e[2]=r}var t=this.Frame.Data;for(var n in a){var s=a[n],r=e[n],o=t.Data[s.XValue],l={KItem:o,Data:s,Point:{X:r.X,Y:r.Y}};this.PointInfo.push(l)}this.CalculateYPoint(),k.Chart.Log("[ChartDrawTwoPointDemo::CalculateLines] kPoint",this.PointInfo)}},this.CalculateYPoint=function(){var e=this.PointInfo[0],a=this.Frame.GetYFromData(e.KItem.Low,!1);e.Point.Y2=a;var r=this.PointInfo[1],t=this.Frame.GetYFromData(r.KItem.High,!1);r.Point.Y2=t},this.DrawEx=function(){var e=this.PointInfo[0],a=this.PointInfo[1],r=this.Frame.ChartBorder;r.GetRight();var t={X:e.Point.X,Y:e.Point.Y2},n={X:a.Point.X,Y:a.Point.Y2};this.DrawLine(t,n),this.LinePoint.push({Start:t,End:n}),this.Canvas.setLineDash([5,5]);var s=a.KItem.YClose*.09+a.KItem.High,o=this.Frame.GetYFromData(s,!1);this.DrawLine({X:this.ToFixedPoint(n.X),Y:n.Y},{X:this.ToFixedPoint(n.X),Y:o}),this.Canvas.textAlign="right",this.Canvas.textBaseline="center",this.Canvas.fillStyle="rgb(33,45,100)";for(var l=3;l>0;--l){var h=a.KItem.YClose*(.03*l)+a.KItem.High,o=this.Frame.GetYFromData(h,!1);o=this.ToFixedPoint(o),this.DrawLine({X:n.X,Y:o},{X:n.X+100,Y:o}),this.Canvas.fillText(h.toFixed(2),n.X-5,o)}this.Canvas.setLineDash([])},this.ToFixedPoint=function(e,a){return v.IsNumber(a)||(a=this.LineWidth),$t(a,e)}}function cD(){this.newMethod=ul,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawThreePointDemo",this.PointCount=3,this.SetLastPoint=function(e){this.LastPoint={X:e.X,Y:e.Y}},this.CalculateYPoint=function(){var e;for(var a in this.PointInfo){var r=this.PointInfo[a];a==0||a==2?e=this.Frame.GetYFromData(r.KItem.Low,!1):e=this.Frame.GetYFromData(r.KItem.High,!1),r.Point.Y2=e}},this.DrawEx=function(){var e=this.PointInfo[0],a=this.PointInfo[1],r=this.PointInfo[2],t=this.Frame.ChartBorder;t.GetRight(),t.GetLeft();var n={X:e.Point.X,Y:e.Point.Y2},s={X:a.Point.X,Y:a.Point.Y2},o={X:r.Point.X,Y:r.Point.Y2};this.DrawLine(n,s),this.DrawLine(s,o),this.LinePoint.push({Start:n,End:s}),this.LinePoint.push({Start:s,End:o}),this.Canvas.setLineDash([5,5]);var l=r.KItem.YClose*.09+r.KItem.High,h=this.Frame.GetYFromData(l,!1);this.DrawLine({X:this.ToFixedPoint(o.X),Y:o.Y},{X:this.ToFixedPoint(o.X),Y:h}),this.Canvas.textAlign="right",this.Canvas.textBaseline="center",this.Canvas.fillStyle="rgb(33,45,100)";for(var u=3;u>0;--u){var f=r.KItem.YClose*(.03*u)+r.KItem.High,h=this.Frame.GetYFromData(f,!1);h=this.ToFixedPoint(h),this.DrawLine({X:o.X,Y:h},{X:o.X+100,Y:h}),this.Canvas.fillText(f.toFixed(2),o.X-5,h)}this.Canvas.setLineDash([])}}function nm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawHLineSegment",this.PointCount=2,this.IsPointIn=this.IsPointIn_XYValue_Line,this.ChartBorder,this.PointToValue_Backup=this.PointToValue,this.PointToValue=function(){this.Frame.IsHScreen?this.Point[1].X=this.Point[0].X:this.Point[1].Y=this.Point[0].Y,this.PointToValue_Backup()},this.GetXYCoordinate=function(){if(this.IsFrameMinSize())return null;var e=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!0});return this.PointRange(e)},this.Draw=function(){if(this.Frame&&(this.IsHScreen=this.Frame.IsHScreen,this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow)){var e=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!0});if(!(!e||e.length!=2)){this.ClipFrame(),this.ChartBorder=this.Frame.ChartBorder,this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor;var a=e[0],r=e[1];this.Status==10?this.DrawLine(a,r,!1):this.DrawVerticalLine(a,r),this.RestoreLineWidth();var t={Start:a,End:r};this.LinePoint.push(t),this.DrawPoint(e),this.Canvas.restore()}}},this.DrawVerticalLine=function(e,a){var r=this.Frame.Data;if(this.IsHScreen){var t=this.ChartBorder.GetLeft(),n=this.ChartBorder.GetRight(),s=Math.round(this.Frame.GetXData(e.Y,!1))+r.DataOffset;s<0?s=0:s>=r.Data.length&&(s=r.Data.length-1);var o=this.Frame.GetXFromIndex(s-r.DataOffset,!1);s=Math.round(this.Frame.GetXData(a.Y,!1))+r.DataOffset,s<0?s=0:s>=r.Data.length&&(s=r.Data.length-1);var l=this.Frame.GetXFromIndex(s-r.DataOffset,!1);this.Canvas.beginPath(),this.Canvas.moveTo(t,o),this.Canvas.lineTo(n,o),this.Canvas.moveTo(t,l),this.Canvas.lineTo(n,l),this.Canvas.stroke(),this.Canvas.beginPath(),this.Canvas.moveTo(e.X,o),this.Canvas.lineTo(e.X,l),this.Canvas.stroke()}else{var h=this.ChartBorder.GetTopEx(),u=this.ChartBorder.GetBottomEx(),s=Math.round(this.Frame.GetXData(e.X,!1))+r.DataOffset;s<0?s=0:s>=r.Data.length&&(s=r.Data.length-1);var f=this.Frame.GetXFromIndex(s-r.DataOffset,!1);s=Math.round(this.Frame.GetXData(a.X,!1))+r.DataOffset,s<0?s=0:s>=r.Data.length&&(s=r.Data.length-1);var C=this.Frame.GetXFromIndex(s-r.DataOffset,!1);this.Canvas.beginPath(),this.Canvas.moveTo(f,h),this.Canvas.lineTo(f,u),this.Canvas.moveTo(C,h),this.Canvas.lineTo(C,u),this.Canvas.stroke(),this.Canvas.beginPath(),this.Canvas.moveTo(f,e.Y),this.Canvas.lineTo(C,e.Y),this.Canvas.stroke()}}}function om(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawVolProfile",this.PointCount=2,this.IsPointIn=this.IsPointIn_XYValue_Line,this.ChartBorder,this.GetXYCoordinate=this.GetXYCoordinate_default,this.IsShowText=!0,this.VolType=0,this.BarPosition=0,this.VolFont,this.VAVol=60,this.BarWidthRate=.3,this.Data,this.MaxVol,this.MaxVolPrice,this.DataStatus=0,this.BGColor=d.ChartDrawVolProfile.BGColor,this.BorderColor=d.ChartDrawVolProfile.BorderColor,this.VolLineColor=d.ChartDrawVolProfile.VolLineColor,this.TextConfig=(0,ae.default)({Color:d.ChartDrawVolProfile.Text.Color,Family:d.ChartDrawVolProfile.Text.Family,FontMaxSize:d.ChartDrawVolProfile.Text.FontMaxSize,FontMinSize:d.ChartDrawVolProfile.Text.FontMinSize},"Color",d.ChartDrawVolProfile.Text.Color),this.BarColor=[d.ChartDrawVolProfile.UpVolColor,d.ChartDrawVolProfile.DownVolColor,d.ChartDrawVolProfile.AreaUpColor,d.ChartDrawVolProfile.AreaDonwColor],this.Super_SetOption=this.SetOption,this.SetOption=function(e){this.Super_SetOption&&this.Super_SetOption(e),e&&(e.BGColor&&(this.BGColor=e.BGColor),e.BorderColor&&(this.BGColor=e.BorderColor),e.VolLineColor&&(this.BGColor=e.VolLineColor),e.UpVolColor&&(this.BarColor[0]=e.UpVolColor),e.DownVolColor&&(this.BarColor[1]=e.DownVolColor),e.AreaUpColor&&(this.BarColor[2]=e.AreaUpColor),e.AreaDonwColor&&(this.BarColor[3]=e.AreaDonwColor),v.IsNumber(e.BarWidthRate)&&(this.BarWidthRate=e.BarWidthRate),v.IsBool(e.IsShowText)&&(this.IsShowText=e.IsShowText),v.IsNumber(e.VolType)&&(this.VolType=e.VolType),v.IsNumber(e.BarPosition)&&(this.BarPosition=e.BarPosition),v.IsNumber(e.VAVol)&&(this.VAVol=e.VAVol))},this.OnFinish=function(){this.RequestVolumeProfileData()},this.OnMoveFinish=function(){this.RequestVolumeProfileData()},this.IsDrawMain=function(){if(!this.GetActiveDrawPicture)return!0;var e=this.GetActiveDrawPicture();return e.Select.Guid!=this.Guid},this.RequestVolumeProfileData=function(){var e=this.Value[0],a=this.Value[1];e.XValue>a.XValue&&(e=this.Value[1],a=this.Value[0]);var r={Start:{Date:e.DateTime.Date,DataIndex:e.XValue},End:{Date:a.DateTime.Date,DataIndex:a.XValue},Chart:this};v.IsNumber(e.DateTime.Time)&&(r.Start.Time=e.DateTime.Time),v.IsNumber(a.DateTime.Time)&&(r.End.Time=a.DateTime.Time),r.ValueAreaVol=this.VAVol,this.DataStatus=0,this.HQChart&&this.HQChart.RequestVolumeProfileData&&this.HQChart.RequestVolumeProfileData(r)},this.OnRecvVolumeProfileData=function(e){if(!(!e||!v.IsNonEmptyArray(e.Data))){for(var a=0,r=0,t=null,n=0,s=0;n<e.Data.length;++n){var o=e.Data[n];for(r=0,s=0;s<o.Vol.length;++s){var l=o.Vol[s];v.IsNumber(l.Value)&&(r+=l.Value)}a<r&&(a=r,t=o.Price)}if(this.MaxVolPrice=t,this.MaxVol=a,!(this.MaxVolPrice<=0||this.MaxVol<=0)&&!(!v.IsNumber(e.MaxPrice)||!v.IsNumber(e.MinPrice))){var h=this.Frame.GetYFromData(e.MaxPrice,!1),u=this.Frame.GetYFromData(e.MinPrice,!1);this.Point[0].Y=h,this.Point[1].Y=u,this.PointToValue(),this.Data=e,this.DataStatus=1}}},this.Draw=function(){if(this.VolFont=null,this.IsDrawMain()||this.MainDraw(),!this.IsFrameMinSize()){this.Frame&&(this.ChartBorder=this.Frame.ChartBorder);var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!(!e||e.length!=2)){this.ClipFrame(),this.SetLineWidth();var a=e[0],r=e[1];this.Status==10?this.DataStatus==0&&this.DrawLineBorder(a,r):this.DrawLineBorder(a,r),this.RestoreLineWidth(),this.DrawPoint(e),this.Canvas.restore()}}},this.MainDraw=function(){this.LinePoint=[],!this.IsFrameMinSize()&&this.DataStatus==1&&this.Status==10&&(this.ClipFrame(),this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0}),this.DrawVolBar(),this.Canvas.restore())},this.DrawLineBorder=function(e,a){this.Canvas.strokeStyle=this.LineColor;var r=this.ChartBorder.GetTopEx(),t=this.ChartBorder.GetBottomEx();this.Canvas.beginPath(),this.Canvas.moveTo(e.X,e.Y),this.Canvas.lineTo(a.X,a.Y),this.Canvas.moveTo(e.X,r),this.Canvas.lineTo(e.X,t),this.Canvas.moveTo(a.X,r),this.Canvas.lineTo(a.X,t),this.Canvas.stroke()},this.DrawVolBar=function(){var e=this.Value[0],a=this.Value[1];e.XValue>a.XValue&&(e=this.Value[1],a=this.Value[0]);var r=this.GetKDataOffset(),t=this.GetPriceYOffset(this.Data.PriceOffset),n=this.Frame.GetXFromIndex(e.XValue-r,!1),s=this.Frame.GetXFromIndex(a.XValue-r,!1),o=this.Frame.GetYFromData(this.Data.MaxPrice)-t/2,l=this.Frame.GetYFromData(this.Data.MinPrice)+t/2,h=s-n,u=l-o,f=h*this.BarWidthRate;if(this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(n,o,h,u),this.MaxVolPrice>=this.Frame.HorizontalMin&&this.MaxVolPrice<=this.Frame.HorizontalMax){var C=2,D=$t(C,this.Frame.GetYFromData(this.MaxVolPrice,!1));this.Canvas.lineWidth=C,this.Canvas.strokeStyle=this.VolLineColor,this.Canvas.beginPath(),this.Canvas.moveTo(n,D),this.Canvas.lineTo(s,D),this.Canvas.stroke();var c={Start:{X:n,Y:D},End:{X:s,Y:D}};this.LinePoint.push(c)}this.IsShowText&&(this.VolFont=this.GetDynamicVolTextFont(t,f),this.VolFont&&(this.Canvas.font=this.VolFont));for(var T=0;T<this.Data.Data.length;++T){var S=this.Data.Data[T];S.Price<this.Frame.HorizontalMin||S.Price>this.Frame.HorizontalMax||this.DrawVolBarItem(S,n,s,f,t)}},this.DrawVolBarItem=function(e,a,r,t,n){var s=a,o=r,l=this.Frame.GetYFromData(e.Price)-n/2,h=n-1;if(h<1&&(h=1),this.VolType==1){if(!e.TotalVol||!v.IsNumber(e.TotalVol.Value))return;var u=e.TotalVol.Value*t/this.MaxVol,f;if(v.IsNumber(e.TotalVol.ColorID)?f=this.BarColor[e.TotalVol.ColorID]:e.TotalVol.Color&&(f=e.TotalVol.Color),this.Canvas.fillStyle=f,this.BarPosition==1?this.Canvas.fillRect(o,b(l),-u,b(h)):this.Canvas.fillRect(s,b(l),u,b(h)),this.IsShowText&&this.VolFont){var C=v.FormatVolString(e.TotalVol.Value,this.HQChart.LanguageID);this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextConfig.Color,this.BarPosition==1?(this.Canvas.textAlign="right",this.Canvas.fillText(C,r-5,l+n/2)):(this.Canvas.textAlign="left",this.Canvas.fillText(C,a+5,l+n/2))}}else{for(var C="",D=0;D<e.Vol.length;++D){var c=e.Vol[D];if(v.IsNumber(c.Value)){var f;if(v.IsNumber(c.ColorID)?f=this.BarColor[c.ColorID]:c.Color&&(f=c.Color),!!f){var u=c.Value*t/this.MaxVol;this.Canvas.fillStyle=f,this.BarPosition==1?(this.Canvas.fillRect(o,b(l),-u,b(h)),o-=u):(this.Canvas.fillRect(s,b(l),u,b(h)),s+=u);var T=v.FormatVolString(c.Value,this.HQChart.LanguageID);C.length>0&&(C+="x"),C+=T}}}this.IsShowText&&this.VolFont&&(this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextConfig.Color,this.BarPosition==1?(this.Canvas.textAlign="right",this.Canvas.fillText(C,r-5,l+n/2)):(this.Canvas.textAlign="left",this.Canvas.fillText(C,a+5,l+n/2)))}},this.GetKDataOffset=function(){var e=this.HQChart.ChartPaint[0].Data;return e.DataOffset},this.GetPriceYOffset=function(e){var a=this.Frame,r=a.ChartBorder.GetHeightEx()*e/(a.HorizontalMax-a.HorizontalMin);return r},this.GetDynamicVolTextFont=function(e,a,r){var t=parseInt(e)-2;if(e<5&&(t=parseInt(e)),t>this.TextConfig.FontMaxSize?t=this.TextConfig.FontMaxSize:t<=0&&(t=1),t<this.TextConfig.FontMinSize)return null;var n=this.FormatFontString(t,this.TextConfig.Family,r);return n},this.FormatFontString=function(e,a,r){var t;return r?r.Weight&&(t=r.Weight+" "+e+"px "+a):t=e+"px "+a,t}}function hm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawNote",this.PointCount=1,this.Text=d.ChartDrawNote.Text,this.FontOption={Family:d.ChartDrawNote.FontOption.Family,Size:d.ChartDrawNote.FontOption.Size},this.AryNoteText=[{Text:"输入内容 ......"}],this.NoteFontOption={Family:d.ChartDrawNote.NoteFontOption.Family,Size:d.ChartDrawNote.NoteFontOption.Size,Weight:d.ChartDrawNote.NoteFontOption.Weight,Style:d.ChartDrawNote.NoteFontOption.Style},this.NoteWidth=d.ChartDrawNote.NoteWidth,this.NoteMargin={Left:d.ChartDrawNote.NoteMargin.Left,Top:d.ChartDrawNote.NoteMargin.Top,Bottom:d.ChartDrawNote.NoteMargin.Bottom,Right:d.ChartDrawNote.NoteMargin.Right},this.NoteBGColor=d.ChartDrawNote.NoteBGColor,this.NoteTextColor=d.ChartDrawNote.NoteTextColor,this.NoteBorderColor=d.ChartDrawNote.NoteBorderColor,this.LineSpace=d.ChartDrawNote.LineSpace,this.ArrowSize=d.ChartDrawNote.ArrowSize,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!1,this.PtButtom,this.PtTop,this.TextRect=null,this.PtCenter,this.SetOption_Backup=this.SetOption,this.SetOption=function(e){if(this.SetOption_Backup(e),!!e){if(e.Text&&(this.Text=e.Text),e.FontOption&&this.SetFont(this.FontOption,e.FontOption),e.NoteFontOption&&this.SetFont(this.NoteFontOption,e.NoteFontOption),v.IsNumber(e.NoteWidth)&&(this.NoteWidth=e.NoteWidth),e.NoteMargin){var a=e.NoteMargin;v.IsNumber(a.Left)&&(this.NoteMargin.Left=a.Left),v.IsNumber(a.Top)&&(this.NoteMargin.Top=a.Top),v.IsNumber(a.Bottom)&&(this.NoteMargin.Bottom=a.Bottom),v.IsNumber(a.Right)&&(this.NoteMargin.Right=a.Right)}e.NoteBGColor&&(this.NoteBGColor=e.NoteBGColor),e.NoteTextColor&&(this.NoteTextColor=e.NoteTextColor),e.NoteBorderColor&&(this.NoteBorderColor=e.NoteBorderColor),v.IsNumber(e.LineSpace)&&(this.LineSpace=e.LineSpace),v.IsNumber(e.ArrowSize)&&(this.ArrowSize=e.ArrowSize),v.IsNonEmptyArray(e.AryNoteText)&&(this.AryNoteText=this.CloneArrayText(e.AryNoteText))}},this.ExportStorageData=function(){var e=this.ExportBaseData();if(e.Value=[],this.Value&&this.Value[0]){var a=this.Value[0];e.Value.push({XValue:a.XValue,YValue:a.YValue,DateTime:a.DateTime})}return e.NoteFont=this.NoteFont,e.NoteWidth=this.NoteWidth,e.NoteBGColor=this.NoteBGColor,e.NoteTextColor=this.NoteTextColor,e.NoteBorderColor=this.NoteBorderColor,e.LineSpace=this.LineSpace,e.ArrowSize=this.ArrowSize,e.NoteMargin={Left:this.NoteMargin.Left,Top:this.NoteMargin.Right,Bottom:this.NoteMargin.Bottom,Right:this.NoteMargin.Right},e.AryNoteText=this.CloneArrayText(this.AryNoteText),e},this.ImportStorageData=function(e){if(e.NoteFont&&(this.NoteFont=e.NoteFont),v.IsNumber(e.NoteWidth)&&(this.NoteWidth=e.NoteWidth),e.NoteMargin){var a=e.NoteMargin;v.IsNumber(a.Left)&&(this.NoteMargin.Left=a.Left),v.IsNumber(a.Top)&&(this.NoteMargin.Top=a.Top),v.IsNumber(a.Bottom)&&(this.NoteMargin.Bottom=a.Bottom),v.IsNumber(a.Right)&&(this.NoteMargin.Right=a.Right)}e.NoteBGColor&&(this.NoteBGColor=e.NoteBGColor),e.NoteTextColor&&(this.NoteTextColor=e.NoteTextColor),this.NoteBorderColor=e.NoteBorderColor,v.IsNumber(e.LineSpace)&&(this.LineSpace=e.LineSpace),v.IsNumber(e.ArrowSize)&&(this.ArrowSize=e.ArrowSize),this.AryNoteText=this.CloneArrayText(e.AryNoteText)},this.Draw=function(){if(this.PtButtom=null,this.PtTop=null,this.TextRect=null,this.PtCenter=null,!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!(!e||e.length!=1)){var a=this.GetTextFont();if(a){this.ClipFrame();var r=this.Frame.IsHScreen,t=B();if(this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.font=a,r){this.Canvas.translate(e[0].X,e[0].Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.Text,0,0),this.PtButtom={X:e[0].X,Y:e[0].Y+this.FontOption.Size*t/2+2},this.PtTop={X:e[0].X,Y:e[0].Y-this.FontOption.Size*t/2-2},this.PtCenter=e[0];var n={X:e[0].X-this.FontOption.Size*t/2-2,Y:e[0].Y}}else{this.Canvas.fillText(this.Text,e[0].X,e[0].Y),this.PtButtom={X:e[0].X,Y:e[0].Y+this.FontOption.Size*t/2+2},this.PtTop={X:e[0].X,Y:e[0].Y-this.FontOption.Size*t/2-2};var n={X:this.PtButtom.X,Y:this.PtButtom.Y}}var s=this.Canvas.measureText(this.Text).width;this.TextRect={},this.TextRect.Left=e[0].X-s/2,this.TextRect.Top=e[0].Y-this.FontOption.Size*t/2,this.TextRect.Width=s,this.TextRect.Height=this.FontOption.Size*t,this.IsShowNoteText()&&this.DrawText(),this.Canvas.restore(),this.DrawPoint([n])}}}},this.DrawText=function(){this.Canvas.font=this.GetFontString(this.NoteFontOption);var e=0,a=this.Canvas.measureText("擎").width,r=this.Frame.GetBorder(),t=B(),n=this.Frame.IsHScreen,s=this.NoteWidth,o=[];if(v.IsNonEmptyArray(this.AryNoteText))for(var l=0;l<this.AryNoteText.length;++l){var h=this.AryNoteText[l];if(h)if(e>0&&(e+=this.LineSpace),h.Text){var u=this.GetMultiLineText(h.Text,s);if(u&&v.IsNonEmptyArray(u.AryText))for(var f=0;f<u.AryText.length;++f){f>0&&(e+=this.LineSpace);var C=u.AryText[f];o.push(C),e+=a}}else o.push({Text:""}),e+=a}else e=a;var D={Width:s+this.NoteMargin.Left+this.NoteMargin.Right,Height:e+this.NoteMargin.Top+this.NoteMargin.Bottom,ArrowType:0};n?(D.Left=this.PtTop.X-D.Width/2-this.PtCenter.X,D.Top=this.PtTop.Y-D.Height-this.ArrowSize-this.PtCenter.Y,D.Right=D.Left+D.Width,D.Bottom=D.Top+D.Height,D.Arrow={X:this.PtTop.X-this.PtCenter.X,Y:this.PtTop.Y-this.PtCenter.Y},this.PtCenter.X+e+this.FontOption.Size*t/2+2+this.ArrowSize>r.RightEx&&(D.Top=this.PtButtom.Y+this.ArrowSize+this.PointRadius*t-this.PtCenter.Y,D.Bottom=D.Top+D.Height,D.Arrow.X=this.PtButtom.X-this.PtCenter.X,D.Arrow.Y=this.PtButtom.Y-this.PtCenter.Y,D.ArrowType=1)):(D.Left=this.PtTop.X-D.Width/2,D.Top=this.PtTop.Y-D.Height-this.ArrowSize,D.Right=D.Left+D.Width,D.Bottom=D.Top+D.Height,D.Arrow={X:this.PtTop.X,Y:this.PtTop.Y},D.Left<r.Left?(D.Left=r.Left,D.Right=D.Left+D.Width):D.Right>r.Right&&(D.Right=r.Right,D.Left=D.Right-D.Width),D.Top<r.TopEx&&(D.Top=this.PtButtom.Y+this.ArrowSize+this.PointRadius*t,D.Bottom=D.Top+D.Height,D.Arrow.X=this.PtButtom.X,D.Arrow.Y=this.PtButtom.Y,D.ArrowType=1)),this.DrawNoteBG(D),this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.fillStyle=this.NoteTextColor;for(var c=D.Left+this.NoteMargin.Left,T=D.Top+this.NoteMargin.Top,l=0;l<o.length;++l){var h=o[l];h&&(h.Text&&this.Canvas.fillText(h.Text,c,T),T+=a,T+=this.LineSpace)}},this.DrawNoteBG=function(e){if(this.Canvas.fillStyle=this.NoteBGColor,e.ArrowType==0||e.ArrowType==1){var a=new Path2D;if(e.ArrowType==0){a.moveTo(e.Left,e.Bottom),a.lineTo(e.Left,e.Top),a.lineTo(e.Right,e.Top),a.lineTo(e.Right,e.Bottom);var r=e.Arrow.X+this.ArrowSize*.6;a.lineTo(r,e.Bottom),a.lineTo(e.Arrow.X,e.Arrow.Y);var r=e.Arrow.X-this.ArrowSize*.6;a.lineTo(r,e.Bottom)}else{a.moveTo(e.Left,e.Top),a.lineTo(e.Left,e.Bottom),a.lineTo(e.Right,e.Bottom),a.lineTo(e.Right,e.Top);var r=e.Arrow.X+this.ArrowSize*.6;a.lineTo(r,e.Top),a.lineTo(e.Arrow.X,e.Arrow.Y);var r=e.Arrow.X-this.ArrowSize*.6;a.lineTo(r,e.Top)}a.closePath(),this.Canvas.fill(a),this.NoteBorderColor&&(this.Canvas.strokeStyle=this.NoteBorderColor,this.Canvas.stroke(a))}else this.Canvas.fillRect(e.Left,e.Top,e.Width,e.Height)},this.IsShowNoteText=function(){if(this.GetActiveDrawPicture){var e=this.GetActiveDrawPicture();return!(e.Move.Guid!=this.Guid&&e.Select.Guid!=this.Guid&&e.MoveOn.Guid!=this.Guid)}return!1},this.GetTextFont=function(){if(!this.FontOption||!this.FontOption.Family||this.FontOption.Size<=0)return null;var e="";return this.FontOption.Size>=0&&(e+=this.FontOption.Size*B()+"px "),e+=this.FontOption.Family,e},this.IsPointIn=function(e,a){if(!this.Frame||this.Status!=10)return-1;var r=this.Frame.Data;if(!r||!this.TextRect)return-1;var t=0;this.Option&&this.Option.Zoom>=1&&(t=this.Option.Zoom*B());var n={Left:this.TextRect.Left-t,Top:this.TextRect.Top-t,Width:this.TextRect.Width+t*2,Height:this.TextRect.Height+t*2};return n.Right=n.Left+n.Width,n.Bottom=n.Top+n.Height,e>n.Left&&e<n.Right&&a>n.Top&&a<n.Bottom?100:-1},this.GetCursorType=function(e){return e==100?"pointer":null}}function lm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawAnchoredText",this.PointCount=1,this.AryText=[{Text:"输入内容"}],this.TextColor=d.ChartDrawAnchoredText.TextColor,this.FontOption={Family:d.ChartDrawAnchoredText.FontOption.Family,Size:d.ChartDrawAnchoredText.FontOption.Size,Weight:d.ChartDrawAnchoredText.FontOption.Weight,Style:d.ChartDrawAnchoredText.FontOption.Style},this.TextMaxWidth=d.ChartDrawAnchoredText.TextMaxWidth,this.LineSpace=d.ChartDrawAnchoredText.LineSpace,this.BGColor=d.ChartDrawAnchoredText.BGColor,this.BorderColor=d.ChartDrawAnchoredText.BorderColor,this.TextMargin={Left:d.ChartDrawAnchoredText.TextMargin.Left,Top:d.ChartDrawAnchoredText.TextMargin.Top,Bottom:d.ChartDrawAnchoredText.TextMargin.Bottom,Right:d.ChartDrawAnchoredText.TextMargin.Right},this.TextRect,this.SetOption=function(e){e&&(e.TextColor&&(this.TextColor=e.TextColor),e.Text&&(this.Text=e.Text),e.FontOption&&this.SetFont(this.FontOption,e.FontOption),v.IsNumber(e.TextMaxWidth)&&(this.TextMaxWidth=e.TextMaxWidth),v.IsNonEmptyArray(e.AryText)&&(this.AryText=this.CloneArrayText(e.AryText)))},this.ExportStorageData=function(){var e=this.ExportBaseData(),a=this.Value[0];return e.Value=[{XValue:a.XValue,YValue:a.YValue}],e.FontOption={},this.SetFont(e.FontOption,this.FontOption),e.BGColor=this.BGColor,e.TextColor=this.TextColor,e.BorderColor=this.BorderColor,e.LineSpace=this.LineSpace,e.TextMaxWidth=this.TextMaxWidth,e.TextMargin={Left:this.TextMargin.Left,Top:this.TextMargin.Right,Bottom:this.TextMargin.Bottom,Right:this.TextMargin.Right},e.AryText=this.CloneArrayText(this.AryText),e},this.ImportStorageData=function(e){if(e.TextMargin){var a=e.TextMargin;v.IsNumber(a.Left)&&(this.TextMargin.Left=a.Left),v.IsNumber(a.Top)&&(this.TextMargin.Top=a.Top),v.IsNumber(a.Bottom)&&(this.TextMargin.Bottom=a.Bottom),v.IsNumber(a.Right)&&(this.TextMargin.Right=a.Right)}e.TextColor&&(this.TextColor=e.TextColor),this.BGColor=e.BGColor,this.BorderColor=e.BorderColor,this.TextMaxWidth=e.TextMaxWidth,v.IsNumber(e.LineSpace)&&(this.LineSpace=e.LineSpace),this.AryText=this.CloneArrayText(e.AryText)},this.Draw=function(){if(this.TextRect=null,!(this.Status<2)&&!(this.Point.length!=1||!this.Frame)&&!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint();!e||e.length!=1||(this.ClipFrame(),this.DrawMultiLineText(e[0]),this.Canvas.restore())}},this.ValueToPoint=function(){if(!this.Frame)return!1;var e=this.Value[0],a=this.XYValueToPoint(e.XValue,e.YValue);this.Point=[a]},this.PointToValue=function(){if(!this.Frame)return!1;var e=this.Frame.GetBorder(),a=this.Frame.IsHScreen;if(a){var r=e.LeftEx,t=e.Top,n=e.RightEx-r,s=e.Bottom-t,o=this.Point[0],l=(o.X-r)/n,h=(o.Y-t)/s;this.Value[0]={XValue:h,YValue:l}}else{var r=e.Left,t=e.TopEx,n=e.Right-r,s=e.BottomEx-t,o=this.Point[0],h=(o.X-r)/n,l=(o.Y-t)/s;this.Value[0]={XValue:h,YValue:l}}},this.XYValueToPoint=function(e,a){if(!this.Frame)return null;var r=this.Frame.IsHScreen,t=this.Frame.GetBorder();if(r){var n=t.LeftEx,s=t.Top,o=t.RightEx-n,l=t.Bottom-s,h=a*o+n,u=e*l+s;return{X:h,Y:u}}else{var n=t.Left,s=t.TopEx,o=t.Right-n,l=t.BottomEx-s,h=e*o+n,u=a*l+s;return{X:h,Y:u}}},this.CalculateDrawPoint=function(e){if(this.Status<2||this.Point.length!=1||!this.Frame)return null;var a=[];if(this.Status==10){var r=this.Value[0],t=this.XYValueToPoint(r.XValue,r.YValue);a.push(t)}else a=this.Point;return a},this.DrawMultiLineText=function(e){if(v.IsNonEmptyArray(this.AryText)){var a=0;this.Canvas.font=this.GetFontString(this.FontOption);var r=this.Canvas.measureText("擎").width;this.Frame.GetBorder();var t=this.Frame.IsHScreen,n={X:e.X,Y:e.Y};t&&(this.Canvas.translate(n.X,n.Y),this.Canvas.rotate(90*Math.PI/180),n.X=0,n.Y=0);for(var s=[],o=0,l=0;l<this.AryText.length;++l){var h=this.AryText[l];if(h)if(a>0&&(a+=this.LineSpace),this.TextMaxWidth>50&&h.Text){var u=this.GetMultiLineText(h.Text,this.TextMaxWidth);if(u&&v.IsNonEmptyArray(u.AryText))for(var f=0;f<u.AryText.length;++f){f>0&&(a+=this.LineSpace);var C=u.AryText[f];s.push(C),a+=r}}else{if(h.Text){var D=this.Canvas.measureText(h.Text).width+2;o<D&&(o=D)}s.push({Text:h.Text}),a+=r}}this.TextMaxWidth>50&&(o=this.TextMaxWidth);var c={Left:n.X,Bottom:n.Y,Height:a+this.TextMargin.Top+this.TextMargin.Bottom,Width:o+this.TextMargin.Left+this.TextMargin.Right};c.Top=c.Bottom-c.Height,c.Right=c.Left+c.Width,this.DrawBG(c),this.Canvas.fillStyle=this.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="top";for(var T=c.Left+this.TextMargin.Left,S=c.Top+this.TextMargin.Top,l=0;l<s.length;++l){var h=s[l];h&&(h.Text&&this.Canvas.fillText(h.Text,T,S),S+=r,S+=this.LineSpace)}t&&(c.Left=e.X,c.Top=e.Y,c.Width=a+this.TextMargin.Top+this.TextMargin.Bottom,c.Height=o+this.TextMargin.Left+this.TextMargin.Right,c.Right=c.Left+c.Width,c.Bottom=c.Top+c.Height),this.TextRect=c;var I={X:c.Left+c.Width/2,Y:c.Bottom};this.DrawPoint([I])}},this.DrawBG=function(e){if(!(!this.BGColor&&!this.BorderColor)){var a=new Path2D;a.rect(e.Left,e.Top,e.Width,e.Height),this.BGColor&&(this.Canvas.fillStyle=this.BGColor,this.Canvas.fill(a)),this.BorderColor&&(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.stroke(a))}},this.IsPointIn=function(e,a){if(!this.Frame||this.Status!=10||!this.TextRect)return-1;var r=this.TextRect;return e>r.Left&&e<r.Right&&a>r.Top&&a<r.Bottom?100:-1},this.GetCursorType=function(e){return e==100?"pointer":null}}function um(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPriceLabel",this.PointCount=1,this.OnlyMoveXIndex=!0,this.TextColor=d.ChartDrawPriceLabel.TextColor,this.FontOption={Family:d.ChartDrawPriceLabel.FontOption.Family,Size:d.ChartDrawPriceLabel.FontOption.Size,Weight:d.ChartDrawPriceLabel.FontOption.Weight,Style:d.ChartDrawPriceLabel.FontOption.Style},this.BGColor=d.ChartDrawPriceLabel.BGColor,this.BorderColor=d.ChartDrawPriceLabel.BorderColor,this.LabelOffset={X:10,Y:20},this.TextMargin={Left:d.ChartDrawPriceLabel.TextMargin.Left,Top:d.ChartDrawPriceLabel.TextMargin.Top,Bottom:d.ChartDrawPriceLabel.TextMargin.Bottom,Right:d.ChartDrawPriceLabel.TextMargin.Right},this.TextRect,this.SetOption=function(e){if(e&&(e.TextColor&&(this.TextColor=e.TextColor),e.BGColor&&(this.BGColor=e.BGColor),e.BorderColor&&(this.BorderColor=e.BorderColor),e.FontOption&&this.SetFont(this.FontOption,e.FontOption),e.LabelOffset)){var a=e.LabelOffset;v.IsNumber(a.X)&&(this.LabelOffset.X=a.X),v.IsNumber(a.Y)&&(this.LabelOffset.Y=a.Y)}},this.ExportStorageData=function(){var e=this.ExportBaseData(),a=this.Value[0];return e.Value=[{XValue:a.XValue,YValue:a.YValue}],e.BGColor=this.BGColor,e.TextColor=this.TextColor,e.BorderColor=this.BorderColor,e.TextMargin={Left:this.TextMargin.Left,Top:this.TextMargin.Right,Bottom:this.TextMargin.Bottom,Right:this.TextMargin.Right},e},this.ImportStorageData=function(e){if(e.TextMargin){var a=e.TextMargin;v.IsNumber(a.Left)&&(this.TextMargin.Left=a.Left),v.IsNumber(a.Top)&&(this.TextMargin.Top=a.Top),v.IsNumber(a.Bottom)&&(this.TextMargin.Bottom=a.Bottom),v.IsNumber(a.Right)&&(this.TextMargin.Right=a.Right)}e.TextColor&&(this.TextColor=e.TextColor),this.BGColor=e.BGColor,this.BorderColor=e.BorderColor},this.Draw=function(){if(this.TextRect=null,!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!(!e||e.length!=1)){var a=e[0];this.ClipFrame(),this.DrawPriceLabel(a),this.Canvas.restore(),this.DrawPoint([a])}}},this.DrawPriceLabel=function(e){var a=this.GetFontString(this.FontOption);if(a){var r=this.Frame.IsHScreen,t,n,s=0;r?(this.Canvas.translate(e.X,e.Y),this.Canvas.rotate(90*Math.PI/180),t={X:0,Y:0},n=this.Frame.GetYData(e.X,!1),s=1):(t={X:e.X,Y:e.Y},n=this.Frame.GetYData(e.Y,!1));var o=2;this.Symbol&&this.Frame.Identify==0&&(o=jt(this.Symbol));var l=n.toFixed(o);this.Canvas.font=a;var h=t.X+this.LabelOffset.X,u=t.Y-this.LabelOffset.Y,f=this.Canvas.measureText("擎").width,C=this.Canvas.measureText(l).width,D={Left:h,Bottom:u,Width:C+this.TextMargin.Left+this.TextMargin.Right,Height:f+this.TextMargin.Top+this.TextMargin.Bottom};D.Top=D.Bottom-D.Height,D.Right=D.Left+D.Width,this.DrawBG(D,t);var c=D.Left+D.Width/2,T=D.Top+D.Height/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(l,c,T+s),r?(this.TextRect={Left:e.X+this.LabelOffset.Y,Top:e.Y+this.LabelOffset.X,Width:f+this.TextMargin.Top+this.TextMargin.Bottom,Height:C+this.TextMargin.Left+this.TextMargin.Right},this.TextRect.Right=this.TextRect.Left+this.TextRect.Width,this.TextRect.Bottom=this.TextRect.Top+this.TextRect.Height):this.TextRect=D}},this.DrawBG=function(e,a){var r=B(),t=new Path2D;t.moveTo(e.Left,e.Bottom),t.lineTo(e.Left,e.Top),t.lineTo(e.Right,e.Top),t.lineTo(e.Right,e.Bottom);var n=e.Left+15*r;t.lineTo(n,e.Bottom),t.lineTo(a.X,a.Y),n=e.Left+5*r,t.lineTo(n,e.Bottom),t.closePath(),this.BGColor&&(this.Canvas.fillStyle=this.BGColor,this.Canvas.fill(t)),this.BorderColor&&(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.stroke(t)),this.BGColor&&(this.Canvas.beginPath(),this.Canvas.arc(a.X,a.Y,2*r,0,360,!1),this.Canvas.fillStyle=this.BGColor,this.Canvas.fill())},this.IsPointIn=function(e,a){if(!this.Frame||this.Status!=10||!this.TextRect)return-1;var r=this.TextRect;return e>r.Left&&e<r.Right&&a>r.Top&&a<r.Bottom?100:-1},this.GetCursorType=function(e){return e==100?"pointer":null}}function fm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPriceNote",this.PointCount=2,this.GetXYCoordinate=this.GetXYCoordinate_default,this.IsPointIn=this.IsPointIn_XYValue_Line,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.FontOption={Family:d.ChartDrawPriceNote.FontOption.Family,Size:d.ChartDrawPriceNote.FontOption.Size,Weight:d.ChartDrawPriceNote.FontOption.Weight,Style:d.ChartDrawPriceNote.FontOption.Style},this.TextMargin={Left:d.ChartDrawPriceNote.TextMargin.Left,Top:d.ChartDrawPriceNote.TextMargin.Top,Bottom:d.ChartDrawPriceNote.TextMargin.Bottom,Right:d.ChartDrawPriceNote.TextMargin.Right},this.BGColor=d.ChartDrawPriceNote.BGColor,this.BorderColor=d.ChartDrawPriceNote.BorderColor,this.TextColor=d.ChartDrawPriceNote.TextColor,this.BorderRoundRadius=3,this.TextRect,this.SetOption=function(e){e&&(e.TextColor&&(this.TextColor=e.TextColor),e.BGColor&&(this.BGColor=e.BGColor),e.BorderColor&&(this.BorderColor=e.BorderColor),e.FontOption&&this.SetFont(this.FontOption,e.FontOption))},this.ExportStorageData=function(){var e=this.ExportBaseData();e.Value=[];for(var a=0;a<this.Value.length;++a){var r=this.Value[a];e.Value.push({XValue:r.XValue,YValue:r.YValue})}return e.BGColor=this.BGColor,e.TextColor=this.TextColor,e.BorderColor=this.BorderColor,e.TextMargin={Left:this.TextMargin.Left,Top:this.TextMargin.Right,Bottom:this.TextMargin.Bottom,Right:this.TextMargin.Right},e},this.ImportStorageData=function(e){if(e.TextMargin){var a=e.TextMargin;v.IsNumber(a.Left)&&(this.TextMargin.Left=a.Left),v.IsNumber(a.Top)&&(this.TextMargin.Top=a.Top),v.IsNumber(a.Bottom)&&(this.TextMargin.Bottom=a.Bottom),v.IsNumber(a.Right)&&(this.TextMargin.Right=a.Right)}e.TextColor&&(this.TextColor=e.TextColor),this.BGColor=e.BGColor,this.BorderColor=e.BorderColor},this.Draw=function(){if(this.LinePoint=[],this.TextRect=null,!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(e&&e.length==2){this.ClipFrame();var a=e[0],r=e[1];this.LineWidth=1,this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(a.X,a.Y),this.Canvas.lineTo(r.X,r.Y),this.Canvas.stroke(),this.RestoreLineWidth(),this.DrawPriceLabel(a,r);var t={Start:a,End:r};this.LinePoint.push(t),this.DrawPoint(e),this.Canvas.restore()}}},this.DrawPriceLabel=function(e,a){var r=this.GetFontString(this.FontOption);if(r){var t=2;this.Symbol&&this.Frame.Identify==0&&(t=jt(this.Symbol));var n=B(),s={X:a.X,Y:a.Y},o=this.Frame.GetYData(e.Y,!1),l=o.toFixed(t),h=this.Canvas.measureText("擎").width,u=this.Canvas.measureText(l).width,f=this.CalculateAngle(e.X,e.Y,a.X,a.Y);if(f>=0&&f<=45||f>=315&&f<=360){var C=s.X,D=s.Y,c={Left:C,Bottom:D,Width:u+this.TextMargin.Left+this.TextMargin.Right,Height:h+this.TextMargin.Top+this.TextMargin.Bottom};c.Bottom=D+c.Height/2,c.Top=c.Bottom-c.Height,c.Right=c.Left+c.Width}else if(f>45&&f<=135){var C=s.X,D=s.Y,c={Left:C,Bottom:D,Width:u+this.TextMargin.Left+this.TextMargin.Right,Height:h+this.TextMargin.Top+this.TextMargin.Bottom};c.Left=C-c.Width/2,c.Top=c.Bottom-c.Height,c.Right=c.Left+c.Width}else if(f>=135&&f<=225){var C=s.X,D=s.Y,c={Width:u+this.TextMargin.Left+this.TextMargin.Right,Height:h+this.TextMargin.Top+this.TextMargin.Bottom};c.Bottom=D+c.Height/2,c.Top=c.Bottom-c.Height,c.Right=C,c.Left=c.Right-c.Width}else if(f>=225&&f<=315){var C=s.X,T=s.Y,c={Width:u+this.TextMargin.Left+this.TextMargin.Right,Height:h+this.TextMargin.Top+this.TextMargin.Bottom};c.Top=T,c.Bottom=c.Top+c.Height,c.Left=C-c.Width/2,c.Right=c.Left-c.Width}else return;this.DrawBG(c),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor;var S=c.Left+this.TextMargin.Left,I=c.Top+c.Height/2,g=0;this.Canvas.fillText(l,S,I+g),this.BGColor&&(this.Canvas.beginPath(),this.Canvas.arc(e.X,e.Y,2*n,0,360,!1),this.Canvas.fillStyle=this.BGColor,this.Canvas.fill()),this.TextRect=c}},this.DrawBG=function(e){if(e){var a=B(),r=this.BorderRoundRadius*a,t=new Path2D;t.roundRect(L(e.Left),L(e.Top),b(e.Width),b(e.Height),[r]),this.BGColor&&(this.Canvas.fillStyle=this.BGColor,this.Canvas.fill(t)),this.BorderColor&&(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.stroke(t))}},this.IsPointIn=function(e,a){if(!this.Frame||this.Status!=10||!this.TextRect)return-1;var r=this.TextRect;return e>r.Left&&e<r.Right&&a>r.Top&&a<r.Bottom?1:this.IsPointIn_XYValue_Line(e,a)}}function Cm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawFibWedge",this.PointCount=3,this.Font=12*B()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.PointToValue_Default=this.PointToValue,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.LastPoint,this.AreaConfig={AryData:[{Value:.236,Color:"rgb(242,52,69)",Enable:!0},{Value:.382,Color:"rgb(255,152,0)",Enable:!0},{Value:.5,Color:"rgb(76,175,80)",Enable:!0},{Value:.618,Color:"rgb(8,153,129)",Enable:!0},{Value:.786,Color:"rgb(0,188,212)",Enable:!0},{Value:1,Color:"rgb(120,123,134)",Enable:!0},{Value:1.618,Color:"rgb(41,98,255)",Enable:!1},{Value:2.618,Color:"rgb(242,54,69)",Enable:!1}],Opacity:.3},this.TextAngle,this.Radius,this.CalculateHypotenuse=function(e,a){var r=e.X-a.X,t=e.Y-a.Y,n=Math.sqrt(r*r+t*t);return n},this.MagnetXY=function(e){var a={IsFixedX:this.OnlyMoveXIndex};if(this.Option&&this.Option.Magnet&&this.Option.Magnet.Enable&&this.IsSupportMagnet&&this.Frame.Identify==0){var r=-1;this.Status==2&&(r=1),v.IsNumber(this.MovePointIndex)&&(r=this.MovePointIndex),r>=0&&(a.Magnet={Enable:!0,PointIndex:r,Distance:this.Option.Magnet.Distance,Type:this.Option.Magnet.Type})}this.AdjustPoint(e,a)},this.CalculateAllPoint=function(e,a,r){var t=[];t.push({X:e.X,Y:e.Y}),t.push({X:a.X,Y:a.Y}),this.MagnetXY(t),t.push({X:r.X,Y:r.Y});var n=this.CalculateHypotenuse(t[0],t[1]),s=t[0].X-t[2].X,o=t[0].Y-t[2].Y,l=Math.sqrt(s*s+o*o),h=s*n/l,u=o*n/l;return t[2].X=t[0].X-h,t[2].Y=t[0].Y-u,t},this.ValueToPoint_V2=function(e){if(!v.IsNonEmptyArray(e)||!this.Frame)return null;var a=this.Frame.Data;if(!a)return null;for(var r=this.Frame.IsHScreen,t=[],n=0;n<e.length;++n){var s=e[n],o=new ft;r?(o.Y=this.Frame.GetXFromIndex(s.XValue-a.DataOffset,!1),o.X=this.Frame.GetYFromData(s.YValue,!1)):(o.X=this.Frame.GetXFromIndex(s.XValue-a.DataOffset,!1),o.Y=this.Frame.GetYFromData(s.YValue,!1)),t[n]=o}return t},this.CalculateDrawPoint=function(e){if(this.Status<2||!this.Point.length||!this.Frame)return null;var a=[];if(this.Status==2)if(this.PointStatus==2&&this.LastPoint)a=this.CalculateAllPoint(this.Point[0],this.Point[1],this.LastPoint);else{for(var r=0;r<this.Point.length&&r<2;++r){var t=this.Point[r];a.push({X:t.X,Y:t.Y})}this.MagnetXY(a)}else if(this.Status==10){var n=this.Frame.Data;if(!n)return null;this.Frame.XPointCount;for(var s=this.Frame.IsHScreen,r=0;r<this.Value.length;++r){var t=this.Value[r];t.XValue-n.DataOffset;var o=new ft;s?(o.Y=this.Frame.GetXFromIndex(t.XValue-n.DataOffset,!1),o.X=this.Frame.GetYFromData(t.YValue,!1)):(o.X=this.Frame.GetXFromIndex(t.XValue-n.DataOffset,!1),o.Y=this.Frame.GetYFromData(t.YValue,!1)),a.push(o)}}else this.Status==20&&(a=this.CalculateAllPoint(this.Point[0],this.Point[1],this.Point[2]));return a},this.Draw=function(){if(this.LinePoint=[],this.TextAngle=null,this.Radius=null,!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!1});if(v.IsNonEmptyArray(e)){var a=e.slice(0);this.CalculateLines(a),this.ClipFrame(),this.DrawArea(a),this.DrawLines(this.LinePoint),this.DrawPoint(a),this.DrawTitle(a),this.Canvas.restore()}}},this.DrawArea=function(e){if(e.length==3&&!(!this.AreaConfig||!v.IsNonEmptyArray(this.AreaConfig.AryData))){var a=e[0],r=this.CalculateHypotenuse(a,e[1]),t=this.CalculateAngle(a.X,a.Y,e[1].X,e[1].Y),n=this.CalculateAngle(a.X,a.Y,e[2].X,e[2].Y),s=t-n;if(s<0&&(s+=360),s>180){var o=t;t=n,n=o}var l=t-(t-n)/2;t-n<0&&(l-=180);for(var h=null,u=0;u<this.AreaConfig.AryData.length;++u){var f=this.AreaConfig.AryData[u];if(f.Enable){var C=r*f.Value,D=f.Color,c=gt.ColorToRGBA(D,this.AreaConfig.Opacity),T=new Path2D;v.IsNumber(h)?(T.arc(a.X,a.Y,h,Math.PI/180*(360-t),Math.PI/180*(360-n)),T.arc(a.X,a.Y,C,Math.PI/180*(360-n),Math.PI/180*(360-t),!0)):(T.moveTo(a.X,a.Y),T.arc(a.X,a.Y,C,Math.PI/180*(360-t),Math.PI/180*(360-n))),this.Canvas.fillStyle=c,this.Canvas.fill(T),h=C}}for(var u=0;u<this.AreaConfig.AryData.length;++u){var f=this.AreaConfig.AryData[u];if(f.Enable){var C=r*f.Value,D=f.Color,T=new Path2D;T.arc(a.X,a.Y,C,Math.PI/180*(360-t),Math.PI/180*(360-n)),this.Canvas.strokeStyle=D,this.Canvas.stroke(T)}}this.Radius=r,this.TextAngle=l}},this.DrawTitle=function(e){if(e.length==3&&!(!this.AreaConfig||!v.IsNonEmptyArray(this.AreaConfig.AryData))){var a=e[0],r=Math.PI/180*(360-this.TextAngle);this.Canvas.font=this.Font;for(var t=0;t<this.AreaConfig.AryData.length;++t){var n=this.AreaConfig.AryData[t];if(n.Enable){var s=this.Radius*n.Value,o=n.Color,l=""+n.Value,h=Math.sin(r)*s+a.Y,u=Math.cos(r)*s+a.X;this.Canvas.fillStyle=o,this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.fillText(l,u+2,h+2)}}}},this.SetLastPoint=function(e){this.LastPoint={X:e.X,Y:e.Y}},this.DrawLines=function(e){if(v.IsNonEmptyArray(e))for(var a=0;a<e.length;++a){var r=e[a];this.DrawLine(r.Start,r.End)}},this.CalculateLines=function(e){if(e.length===2){var a={Start:new ft,End:new ft};a.Start.Y=e[0].Y,a.Start.X=e[0].X,a.End.Y=e[1].Y,a.End.X=e[1].X,this.LinePoint.push(a)}else if(e.length===3){var a={Start:new ft,End:new ft};a.Start.Y=e[0].Y,a.Start.X=e[0].X,a.End.Y=e[1].Y,a.End.X=e[1].X,this.LinePoint.push(a),a={Start:new ft,End:new ft},a.Start.Y=e[0].Y,a.Start.X=e[0].X,a.End.Y=e[2].Y,a.End.X=e[2].X,this.LinePoint.push(a)}},this.IsPointIn=function(e,a,r){if(this.Status!=10)return-1;var t=this.IsPointInXYValue(e,a,this.AryPoint,r);return t>=0?t:(t=this.IsPointInLine(e,a,r),t>=0?100:-1)},this.IsPointInDots=function(e,a,r,t){if(!v.IsNonEmptyArray(r)||!this.Frame)return-1;var n=this.Frame.Data;if(!n||!this.Value)return-1;var s=5;t&&v.IsNumber(t.Zoom)?s+=t.Zoom:this.Option&&v.IsNumber(this.Option.Zoom)&&(s+=this.Option.Zoom),this.Frame.IsHScreen,s*=B();for(var o=0;o<r.length;++o){var l=r[o],h=new Path2D;if(h.arc(l.X,l.Y,s,0,360),this.Canvas.isPointInPath(h,e,a))return o}return-1},this.GetCursorType=function(e){return e==2?"ns-resize":null},this.PointToValue=function(){if(!this.Frame)return!1;var e=this.Point[2],a={X:e.X,Y:e.Y};if(!this.PointToValue_Default())return!1;var u=[this.Value[0],this.Value[1]],r=this.ValueToPoint_V2(u),t=this.CalculateHypotenuse(r[0],r[1]),n=r[0].X-a.X,s=r[0].Y-a.Y,o=Math.sqrt(n*n+s*s),l=n*t/o,h=s*t/o;this.Point[2].X=r[0].X-l,this.Point[2].Y=r[0].Y-h;var u=this.PointToValue_V2([this.Point[2]],{Type:1});return u?(this.Value[2]=u[0],!0):!1},this.PointToValue_V2=function(e,a){return this.Frame?this.Frame.ClassName=="MinuteFrame"||this.Frame.Class=="MinuteHScreenFrame"?this.PointToValue_Minute_V2(e,a):this.PointToValue_KLine_V2(e,a):null},this.PointToValue_KLine_V2=function(e,a){if(!v.IsNonEmptyArray(e)||!this.Frame)return null;var r=this.Frame.Data;if(!r)return null;var t=[],n=this.Frame.IsHScreen;if(n)for(var s=0;s<e.length;++s){var o=e[s],l=this.Frame.GetXData(o.Y,!1)+r.DataOffset,h=this.Frame.GetYData(o.X,!1),u={XValue:l,YValue:h,Type:1};t[s]=u}else for(var s=0;s<e.length;++s){var o=e[s],l=this.Frame.GetXData(o.X,!1)+r.DataOffset,h=this.Frame.GetYData(o.Y,!1),u={XValue:l,YValue:h,Type:1};t[s]=u}return t}}function Dm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartFibRetracement",this.PointCount=2,this.Font=12*B()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.PointToValue_Default=this.PointToValue,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.LineDash=[6,3],this.LineWidth=1,this.EnableBGColor=!0,this.ExtendLine={Left:!1,Right:!1},this.AreaConfig={AryData:[{Value:0,Color:"rgb(128,128,128)",Enable:!0},{Value:.236,Color:"rgb(242,52,69)",Enable:!0},{Value:.382,Color:"rgb(255,152,0)",Enable:!0},{Value:.5,Color:"rgb(76,175,80)",Enable:!0},{Value:.618,Color:"rgb(8,153,129)",Enable:!0},{Value:.786,Color:"rgb(0,188,212)",Enable:!0},{Value:1,Color:"rgb(120,123,134)",Enable:!0},{Value:1.618,Color:"rgb(41,98,255)",Enable:!0},{Value:2.618,Color:"rgb(242,54,69)",Enable:!1}],Opacity:.3},this.SetOption=function(e){if(e){if(e.Font&&(this.Font=e.Font),e.LineWidth&&(this.LineWidth=e.LineWidth),e.LineDash&&(this.LineDash=e.LineDash),v.IsBool(e.EnableBGColor)&&(this.EnableBGColor=e.EnableBGColor),e.ExtendLine){var a=e.ExtendLine;v.IsBool(a.Left)&&(this.ExtendLine.Left=a.Left),v.IsBool(a.Right)&&(this.ExtendLine.Left=a.Right)}e.AreaConfig&&(this.AreaConfig=e.AreaConfig)}},this.ExportStorageData=function(){var e=this.ExportBaseData();e.Value=[];for(var a=0;a<this.Value.length&&a<this.PointCount;++a){var r=this.Value[a];e.Value.push({XValue:r.XValue,YValue:r.YValue})}return e.Font=this.Font,e.EnableBGColor=this.EnableBGColor,e.LineDash=this.LineDash,e.ExtendLine={Left:this.ExtendLine.Left,Right:this.ExtendLine.Right},e.AreaConfig=At(this.AreaConfig),e},this.ImportStorageData=function(e){e.Font&&(this.Font=e.Font),e.LineDash&&(this.LineDash=e.LineDash),v.IsBool(e.EnableBGColor)&&(this.EnableBGColor=e.EnableBGColor),e.ExtendLine&&(this.ExtendLine=e.ExtendLine),e.AreaConfig&&(this.AreaConfig=e.AreaConfig)},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=!0;(this.ExtendLine.Left||this.ExtendLine.Right)&&(e=!1);var a=this.CalculateDrawPoint({IsCheckX:e,IsCheckY:e});if(a&&a.length==2){this.ClipFrame();var r=a[0],t=a[1];this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.setLineDash(this.LineDash),this.Canvas.beginPath(),this.Canvas.moveTo(r.X,r.Y),this.Canvas.lineTo(t.X,t.Y),this.Canvas.stroke(),this.Canvas.setLineDash([]),this.DrawBlock(r,t),this.RestoreLineWidth();var n={Start:r,End:t};this.LinePoint.push(n),this.DrawPoint(a),this.Canvas.restore()}}},this.GetArrayAreaConfig=function(){for(var e=[],a=0;a<this.AreaConfig.AryData.length;++a){var r=this.AreaConfig.AryData[a];r.Enable&&e.push(r)}return e.sort(function(t,n){return n.Value-t.Value}),e},this.DrawBlock=function(e,a){var r=Math.min(e.Y,a.Y),t=Math.max(e.Y,a.Y),n=Math.min(e.X,a.X),s=Math.max(e.X,a.X),o=t-r;this.ExtendLine.Right&&(s=this.Frame.ChartBorder.GetRight()),this.ExtendLine.Left&&(n=this.Frame.ChartBorder.GetLeft());var l=this.GetArrayAreaConfig(),h=null,u=null;this.Canvas.font=this.Font,this.ExtendLine.Left?this.Canvas.textAlign="left":this.Canvas.textAlign="right",this.Canvas.textBaseline="bottom";for(var f=0;f<l.length;++f){var C=l[f],D=t-o*C.Value;if(yValue=this.Frame.GetYData(D,!1),D=L(D),this.EnableBGColor&&v.IsNumber(h)){var c={Left:n,Right:s,Top:h,Bottom:D};c.Width=c.Right-c.Left,c.Height=c.Bottom-c.Top,this.Canvas.fillStyle=u,this.Canvas.fillRect(c.Left,c.Top,c.Width,c.Height)}this.Canvas.strokeStyle=C.Color,this.Canvas.beginPath(),this.Canvas.moveTo(n,D),this.Canvas.lineTo(s,D),this.Canvas.stroke();var T={Start:{X:n,Y:D},End:{X:s,Y:D}};this.LinePoint.push(T);var S=C.Value+" ("+yValue.toFixed(2)+")";this.Canvas.fillStyle=C.Color,this.ExtendLine.Left?this.Canvas.fillText(S,n+2,D-2):this.Canvas.fillText(S,n-2,D-2),h=D,u=gt.ColorToRGBA(C.Color,this.AreaConfig.Opacity)}}}function vm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartFibSpeedResistanceFan",this.PointCount=2,this.Font=12*B()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.PointToValue_Default=this.PointToValue,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.LineWidth=1,this.EnableBGColor=!0,this.AreaConfig={AryYData:[{Value:0,Color:"rgb(128,128,128)",Enable:!0},{Value:.25,Color:"rgb(242,52,69)",Enable:!0},{Value:.382,Color:"rgb(255,152,0)",Enable:!0},{Value:.5,Color:"rgb(76,175,80)",Enable:!0},{Value:.618,Color:"rgb(8,153,129)",Enable:!0},{Value:.75,Color:"rgb(0,188,212)",Enable:!0},{Value:1,Color:"rgb(120,123,134)",Enable:!0}],AryXData:[{Value:0,Color:"rgb(128,128,128)",Enable:!0},{Value:.25,Color:"rgb(242,52,69)",Enable:!0},{Value:.382,Color:"rgb(255,152,0)",Enable:!0},{Value:.5,Color:"rgb(76,175,80)",Enable:!0},{Value:.618,Color:"rgb(8,153,129)",Enable:!0},{Value:.75,Color:"rgb(0,188,212)",Enable:!0},{Value:1,Color:"rgb(120,123,134)",Enable:!0}],Opacity:.3},this.SetOption=function(e){e&&(e.Font&&(this.Font=e.Font),e.LineWidth&&(this.LineWidth=e.LineWidth),v.IsBool(e.EnableBGColor)&&(this.EnableBGColor=e.EnableBGColor),e.AreaConfig&&(this.AreaConfig=e.AreaConfig))},this.ExportStorageData=function(){var e=this.ExportBaseData();e.Value=[];for(var a=0;a<this.Value.length&&a<this.PointCount;++a){var r=this.Value[a];e.Value.push({XValue:r.XValue,YValue:r.YValue})}return e.Font=this.Font,e.EnableBGColor=this.EnableBGColor,e.AreaConfig=At(this.AreaConfig),e},this.ImportStorageData=function(e){e.Font&&(this.Font=e.Font),v.IsBool(e.EnableBGColor)&&(this.EnableBGColor=e.EnableBGColor),e.AreaConfig&&(this.AreaConfig=e.AreaConfig)},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=!1,a=this.CalculateDrawPoint({IsCheckX:e,IsCheckY:e});if(a&&a.length==2){this.ClipFrame();var r=a[0],t=a[1];this.SetLineWidth(),this.DrawBlock(t,r),this.RestoreLineWidth(),this.DrawPoint(a),this.Canvas.restore()}}},this.GetQuadrant=function(e,a){return e.X<a.X&&e.Y>a.Y?1:e.X>a.X&&e.Y>a.Y?2:e.X<a.X&&e.Y<a.Y?4:3},this.DrawBlock=function(e,a){var r=a,t=a.X-e.X,n=a.Y-e.Y,s=this.GetQuadrant(r,e),o=this.GetArrayAreaConfig(this.AreaConfig.AryYData),R=null,l=null;this.Canvas.font=this.Font;var h=this.Frame.GetBorder(),u={X:h.Left,Y:h.TopEx},f={X:h.Right,Y:h.TopEx},C={X:h.Left,Y:h.BottomEx},D={X:h.Right,Y:h.BottomEx},c=4;s==1||s==4?(this.Canvas.textAlign="right",c=-4):(this.Canvas.textAlign="left",c=4),this.Canvas.textBaseline="middle";for(var T=0;T<o.length;++T){var S=o[T],I=S.Value*n+e.Y,g=this.CalculateExtendLineEndPoint([r,{X:e.X,Y:I}]);R&&(this.Canvas.beginPath(),this.Canvas.moveTo(r.X,r.Y),this.Canvas.lineTo(R.X,R.Y),s==1?R.X>=f.X&&g.X<f.X&&this.Canvas.lineTo(f.X,f.Y):s==2?R.X<=u.X&&g.X>u.X&&this.Canvas.lineTo(u.X,u.Y):s==3?R.X<=C.X&&g.X>C.X&&this.Canvas.lineTo(C.X,C.Y):s==4&&R.X>=D.X&&g.X<D.X&&this.Canvas.lineTo(D.X,D.Y),this.Canvas.lineTo(g.X,g.Y),this.Canvas.closePath(),this.Canvas.fillStyle=l,this.Canvas.fill()),this.Canvas.strokeStyle=S.Color,this.Canvas.beginPath(),this.Canvas.moveTo(r.X,r.Y),this.Canvas.lineTo(g.X,g.Y),this.Canvas.stroke(),this.LinePoint.push({Start:r,End:g}),S.Value!=1&&(this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(r.X,I),this.Canvas.lineTo(e.X,I),this.Canvas.stroke()),R=g,l=gt.ColorToRGBA(S.Color,this.AreaConfig.Opacity);var E=""+S.Value;this.Canvas.fillStyle=S.Color,this.Canvas.fillText(E,r.X+c,I)}var F=this.GetArrayAreaConfig(this.AreaConfig.AryXData),R=null;this.Canvas.textAlign="center",s==3||s==4?(this.Canvas.textBaseline="bottom",c=-5):(this.Canvas.textBaseline="top",c=5);for(var T=0;T<F.length;++T){var S=F[T],A=S.Value*t+e.X,g=this.CalculateExtendLineEndPoint([r,{X:A,Y:e.Y}]);R&&(this.Canvas.beginPath(),this.Canvas.moveTo(r.X,r.Y),this.Canvas.lineTo(R.X,R.Y),s==1?R.X<f.X&&g.X>=f.X&&this.Canvas.lineTo(f.X,f.Y):s==2?R.X>u.X&&g.X<=u.X&&this.Canvas.lineTo(u.X,u.Y):s==3?R.X>C.X&&g.X<=C.X&&this.Canvas.lineTo(C.X,C.Y):s==4&&R.X<D.X&&g.X>=D.X&&this.Canvas.lineTo(D.X,D.Y),this.Canvas.lineTo(g.X,g.Y),this.Canvas.closePath(),this.Canvas.fillStyle=l,this.Canvas.fill()),this.Canvas.strokeStyle=S.Color,this.Canvas.beginPath(),this.Canvas.moveTo(r.X,r.Y),this.Canvas.lineTo(g.X,g.Y),this.Canvas.stroke(),this.LinePoint.push({Start:r,End:g}),S.Value!=1&&(this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(A,r.Y),this.Canvas.lineTo(A,e.Y),this.Canvas.stroke()),R=g,l=gt.ColorToRGBA(S.Color,this.AreaConfig.Opacity);var E=""+S.Value;this.Canvas.fillStyle=S.Color,this.Canvas.fillText(E,A,r.Y+c)}},this.GetArrayAreaConfig=function(e){for(var a=[],r=0;r<e.length;++r){var t=e[r];t.Enable&&a.push(t)}return a.sort(function(n,s){return s.Value-n.Value}),a}}function cm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartPriceRange",this.PointCount=2,this.Font=12*B()+"px 微软雅黑",this.TextColor=this.LineColor,this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.PointToValue_Default=this.PointToValue,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.LineWidth=1,this.EnableBGColor=!0,this.BGColor=gt.ColorToRGBA(this.LineColor,.15),this.ExtendLine={Left:!1,Right:!1},this.Label={TextColor:"rgb(0,0,0)",BGColor:"rgb(211,211,211)",EnableBGColor:!0,LeftMargin:5,RightMargin:5},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=!0;(this.ExtendLine.Left||this.ExtendLine.Right)&&(e=!1);var a=this.CalculateDrawPoint({IsCheckX:e,IsCheckY:e});if(a&&a.length==2){this.ClipFrame();var r=a[0],t=a[1];this.SetLineWidth(),this.DrawRange(r,t),this.RestoreLineWidth(),this.DrawPoint(a),this.Canvas.restore()}}},this.DrawRange=function(e,a){var r=Math.min(e.Y,a.Y),t=Math.max(e.Y,a.Y),n=Math.min(e.X,a.X),s=Math.max(e.X,a.X),o=e.X+(a.X-e.X)/2;if(this.ExtendLine.Right&&(s=this.Frame.ChartBorder.GetRight()),this.ExtendLine.Left&&(n=this.Frame.ChartBorder.GetLeft()),this.EnableBGColor){var l={Left:n,Top:r,Right:s,Bottom:t};l.Width=l.Right-l.Left,l.Height=l.Bottom-l.Top,this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(l.Left,l.Top,l.Width,l.Height)}this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(n,L(r)),this.Canvas.lineTo(s,L(r)),this.Canvas.moveTo(n,L(t)),this.Canvas.lineTo(s,L(t)),this.Canvas.moveTo(L(o),L(r)),this.Canvas.lineTo(L(o),L(t)),this.Canvas.stroke(),this.LinePoint.push({Start:{X:n,Y:r},End:{X:s,Y:r}}),this.LinePoint.push({Start:{X:n,Y:t},End:{X:s,Y:t}}),this.LinePoint.push({Start:{X:o,Y:r},End:{X:o,Y:t}}),this.DrawArrow({X:L(o),Y:e.Y},{X:L(o),Y:a.Y});var h=this.Frame.ChartBorder.GetBottomEx(),u=this.Frame.ChartBorder.GetTopEx(),f=this.Frame.GetYData(e.Y,!1),C=this.Frame.GetYData(a.Y,!1),D=C-f,c=D/f*100,T=D.toFixed(2)+" ("+c.toFixed(2)+"%)";this.Canvas.font=this.Font;var S=this.GetFontHeight(),I=this.Canvas.measureText(T).width+4+(this.Label.LeftMargin+this.Label.RightMargin),g={Left:o-I/2,Width:I,Height:S+2};if(D>0?g.Top=a.Y-g.Height-4:g.Top=a.Y+4,g.Bottom=g.Top+g.Height,D>0?g.Top<=u&&(g.Top=u,g.Bottom=g.Top+g.Height):g.Bottom>=h&&(g.Bottom=h,g.Top=g.Bottom-g.Height),this.Label.EnableBGColor){var E=new Path2D;E.roundRect(L(g.Left),L(g.Top),b(g.Width),b(g.Height),[3]),this.Canvas.fillStyle=this.Label.BGColor,this.Canvas.fill(E)}this.Canvas.fillStyle=this.Label.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.fillText(T,g.Left+2+this.Label.LeftMargin,g.Bottom-2)}}function Tm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDateRange",this.PointCount=2,this.Font=12*B()+"px 微软雅黑",this.TextColor=this.LineColor,this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.PointToValue_Default=this.PointToValue,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.LineWidth=1,this.EnableBGColor=!0,this.BGColor=gt.ColorToRGBA(this.LineColor,.15),this.ExtendLine={Top:!1,Bottom:!1},this.Label={TextColor:"rgb(0,0,0)",BGColor:"rgb(211,211,211)",EnableBGColor:!0,LeftMargin:5,RightMargin:5},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=!0,a=this.CalculateDrawPoint({IsCheckX:e,IsCheckY:e});if(a&&a.length==2){this.ClipFrame();var r=a[0],t=a[1];this.SetLineWidth(),this.DrawRange(r,t),this.RestoreLineWidth(),this.DrawPoint(a),this.Canvas.restore()}}},this.DrawRange=function(e,a){var r=Math.min(e.Y,a.Y),t=Math.max(e.Y,a.Y),n=Math.min(e.X,a.X),s=Math.max(e.X,a.X),o=e.Y+(a.Y-e.Y)/2,l=e.X+(a.X-e.X)/2;if(this.ExtendLine.Top&&(r=this.Frame.ChartBorder.GetTopEx()),this.ExtendLine.Bottom&&(t=this.Frame.ChartBorder.GetBottomEx()),this.EnableBGColor){var h={Left:n,Top:r,Right:s,Bottom:t};h.Width=h.Right-h.Left,h.Height=h.Bottom-h.Top,this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(h.Left,h.Top,h.Width,h.Height)}this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(n),r),this.Canvas.lineTo(L(n),t),this.Canvas.moveTo(L(s),r),this.Canvas.lineTo(L(s),t),this.Canvas.moveTo(L(n),L(o)),this.Canvas.lineTo(L(s),L(o)),this.Canvas.stroke(),this.LinePoint.push({Start:{X:n,Y:r},End:{X:n,Y:t}}),this.LinePoint.push({Start:{X:s,Y:r},End:{X:s,Y:t}}),this.LinePoint.push({Start:{X:n,Y:o},End:{X:s,Y:o}}),this.DrawArrow({X:e.X,Y:L(o)},{X:a.X,Y:L(o)});var u=this.Frame.ChartBorder.GetBottomEx(),f=this.Frame.ChartBorder.GetTopEx(),C=this.Frame.GetXData(e.X,!1),D=this.Frame.GetXData(a.X,!1),c=this.Frame.GetYData(e.Y,!1),T=this.Frame.GetYData(a.Y,!1),S=T-c,I=D-C+1,g=I+" bars";this.Canvas.font=this.Font;var E=this.GetFontHeight(),F=this.Canvas.measureText(g).width+4+(this.Label.LeftMargin+this.Label.RightMargin),R={Left:l-F/2,Top:a.Y+4,Width:F,Height:E+2};if(S>0?R.Top=a.Y-R.Height-4:R.Top=a.Y+4,R.Bottom=R.Top+R.Height,S>0?R.Top<=f&&(R.Top=f,R.Bottom=R.Top+R.Height):R.Bottom>=u&&(R.Bottom=u,R.Top=R.Bottom-R.Height),this.Label.EnableBGColor){var A=new Path2D;A.roundRect(L(R.Left),L(R.Top),b(R.Width),b(R.Height),[3]),this.Canvas.fillStyle=this.Label.BGColor,this.Canvas.fill(A)}this.Canvas.fillStyle=this.Label.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.fillText(g,R.Left+2+this.Label.LeftMargin,R.Bottom-2)}}function Sm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDatePriceRange",this.PointCount=2,this.Font=12*B()+"px 微软雅黑",this.TextColor=this.LineColor,this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.PointToValue_Default=this.PointToValue,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.LineWidth=1,this.EnableBGColor=!0,this.BGColor=gt.ColorToRGBA(this.LineColor,.15),this.ExtendLine={Top:!1,Bottom:!1},this.Label={TextColor:"rgb(0,0,0)",BGColor:"rgb(211,211,211)",EnableBGColor:!0,LeftMargin:5,RightMargin:5},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=!0,a=this.CalculateDrawPoint({IsCheckX:e,IsCheckY:e});if(a&&a.length==2){this.ClipFrame();var r=a[0],t=a[1];this.SetLineWidth(),this.DrawRange(r,t),this.RestoreLineWidth(),this.DrawPoint(a),this.Canvas.restore()}}},this.DrawRange=function(e,a){var r=Math.min(e.Y,a.Y),t=Math.max(e.Y,a.Y),n=Math.min(e.X,a.X),s=Math.max(e.X,a.X),o=e.Y+(a.Y-e.Y)/2,l=e.X+(a.X-e.X)/2;if(this.ExtendLine.Top&&(r=this.Frame.ChartBorder.GetTopEx()),this.ExtendLine.Bottom&&(t=this.Frame.ChartBorder.GetBottomEx()),this.EnableBGColor){var h={Left:n,Top:r,Right:s,Bottom:t};h.Width=h.Right-h.Left,h.Height=h.Bottom-h.Top,this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(h.Left,h.Top,h.Width,h.Height)}this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(n),r),this.Canvas.lineTo(L(n),t),this.Canvas.moveTo(L(s),r),this.Canvas.lineTo(L(s),t),this.Canvas.moveTo(L(n),L(o)),this.Canvas.lineTo(L(s),L(o)),this.Canvas.moveTo(L(l),L(r)),this.Canvas.lineTo(L(l),L(t)),this.Canvas.stroke(),this.LinePoint.push({Start:{X:n,Y:r},End:{X:n,Y:t}}),this.LinePoint.push({Start:{X:s,Y:r},End:{X:s,Y:t}}),this.LinePoint.push({Start:{X:n,Y:o},End:{X:s,Y:o}}),this.DrawArrow({X:e.X,Y:L(o)},{X:a.X,Y:L(o)}),this.DrawArrow({X:L(l),Y:e.Y},{X:L(l),Y:a.Y});var u=this.Frame.ChartBorder.GetBottomEx(),f=this.Frame.ChartBorder.GetTopEx(),C=this.Frame.GetXData(e.X,!1),D=this.Frame.GetXData(a.X,!1),c=D-C+1,T=this.Frame.GetYData(e.Y,!1),S=this.Frame.GetYData(a.Y,!1),I=S-T,g=I/T*100,E=[I.toFixed(2)+" ("+g.toFixed(2)+"%)",c+" bars"];this.Canvas.font=this.Font;for(var F=this.GetFontHeight(),R=0,A=0;A<E.length;++A){var P=E[A],p=this.Canvas.measureText(P).width;R<p&&(R=p)}R+=this.Label.LeftMargin+this.Label.RightMargin;var w={Left:l-R/2,Top:a.Y+4,Width:R,Height:E.length*F+2};if(I>0?w.Top=a.Y-w.Height-4:w.Top=a.Y+4,w.Bottom=w.Top+w.Height,I>0?w.Top<=f&&(w.Top=f,w.Bottom=w.Top+w.Height):w.Bottom>=u&&(w.Bottom=u,w.Top=w.Bottom-w.Height),this.Label.EnableBGColor){var H=new Path2D;H.roundRect(L(w.Left),L(w.Top),b(w.Width),b(w.Height),[3]),this.Canvas.fillStyle=this.Label.BGColor,this.Canvas.fill(H)}this.Canvas.fillStyle=this.Label.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";for(var W=w.Bottom-2,A=0;A<E.length;++A){var P=E[A];this.Canvas.fillText(P,w.Left+2+this.Label.LeftMargin,W),W-=F}}}function dm(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartInfoLine",this.PointCount=2,this.Font=12*B()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.IsShowYCoordinate=!1,this.CopyData=this.CopyData_default,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.LabelConfig={Font:12*B()+"px 微软雅黑",BGColor:"rgba(135, 206 ,250,0.95)",Mergin:{Left:10,Right:10,Top:10,Bottom:8},LineSpace:5,TextAlign:1},this.FormatLabelTextCallback=null,this.SetOption=function(e){if(e.LineColor&&(this.LineColor=e.LineColor),e.PointColor&&(this.PointColor=e.PointColor),e.Label){var a=e.Label,r=this.LabelConfig;a.Font&&(r.Font=a.Font),a.BGColor&&(r.BGColor=a.BGColor),v.IsNumber(a.LineSpace)&&(r.LineSpace=a.LineSpace),v.IsNumber(a.TextAlign)&&(r.TextAlign=a.TextAlign),a.Mergin&&wa(r.Mergin,a.Mergin)}e.FormatLabelTextCallback&&(this.FormatLabelTextCallback=e.FormatLabelTextCallback)},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&this.IsShow){var e=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!1});if(e&&e.length==2){this.ClipFrame();var a=e[0],r=e[1];this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(a.X,a.Y),this.Canvas.lineTo(r.X,r.Y),this.Canvas.stroke(),this.RestoreLineWidth();var t={Start:a,End:r};this.LinePoint.push(t),this.DrawPoint(e);var n={};n.Config=this.LabelConfig,n.PtStart=a,n.PtEnd=r,this.Canvas.restore(),this.DrawLabel(n)}}},this.DrawLabel=function(e){if(this.FormatLabelTextCallback&&(e.AryPoint=this.Point,this.Status!=10?e.AryValue=this.PointToKLine(this.Point):e.AryValue=this.Value,e.Data=this.Frame.Data,this.FormatLabelTextCallback(e),!!v.IsNonEmptyArray(e.AryText))){this.CalculateLabelSize(e);var a=e.PtStart,r=e.PtEnd;a.X>r.X&&(a=e.PtEnd,r=e.PtStart),e.Config;var t=e.PtStart.X+(e.PtEnd.X-e.PtStart.X)/2,n=e.PtStart.Y+(e.PtEnd.Y-e.PtStart.Y)/2;if(a.Y<r.Y){var s={Left:t,Bottom:n,Width:e.Width,Height:e.Height};s.Right=s.Left+s.Width,s.Top=s.Bottom-s.Height}else{var s={Left:t,Top:n,Width:e.Width,Height:e.Height};s.Right=s.Left+s.Width,s.Bottom=s.Top+s.Height}this.DrawDefaultLabel(e,s)}}}function Im(){this.newMethod=gt,this.newMethod(),delete this.newMethod,this.ClassName="ChartBarsPattern",this.PointCount=2,this.KData=null,this.Draw=function(){}}function TD(){this.DrawData=new Dt.default,this.StorageKey,this.GetEventCallback,this.Load=function(e){if(e){this.StorageKey=e;var a=localStorage[this.StorageKey];if(k.Chart.Log("[ChartDrawStorage::Load] Load to localStorage, key="+this.StorageKey+", cache="+a),!!a&&typeof a=="string"){var r=JSON.parse(a);for(var t in r){var n=r[t],s=new Dt.default;for(var o in n.Value){var l=n.Value[o];s.set(l.Key,l.Value)}this.DrawData.set(n.Key,s)}}}},this.Save=function(){if(this.StorageKey){var e=[],a=!0,r=!1,t=void 0;try{for(var n=(0,ye.default)(this.DrawData),s;!(a=(s=n.next()).done);a=!0){var o=s.value,l=o[0],h=o[1],u={Key:l,Value:[]},f=!0,C=!1,D=void 0;try{for(var c=(0,ye.default)(h),T;!(f=(T=c.next()).done);f=!0){var S=T.value;S[1]&&S[1].EnableSave===!1||u.Value.push({Key:S[0],Value:S[1]})}}catch(g){C=!0,D=g}finally{try{!f&&c.return&&c.return()}finally{if(C)throw D}}v.IsNonEmptyArray(u.Value)&&e.push(u)}}catch(g){r=!0,t=g}finally{try{!a&&n.return&&n.return()}finally{if(r)throw t}}k.Chart.Log("[ChartDrawStorage::Save] save to localStorage, key="+this.StorageKey);var I=(0,Aa.default)(e);localStorage[this.StorageKey]=I}},this.GetItemKey=function(e){var a=e.Symbol+"-"+e.Period;return a},this.SaveDrawData=function(e){var a=this.GetItemKey(e),r=e.ExportStorageData();if(r){if(this.DrawData.has(a))k.Chart.Log("[ChartDrawStorage::SaveDrawData] Upate: key, drawPicture, data",a,e,r),this.DrawData.get(a).set(r.Guid,r);else{k.Chart.Log("[ChartDrawStorage::SaveDrawData] Insert: key, drawPicture, data",a,e,r);var t=new Dt.default;t.set(r.Guid,r),this.DrawData.set(a,t)}k.Chart.Log("[ChartDrawStorage::SaveDrawData] All draw data： ",this.DrawData),this.Save()}},this.DeleteDrawData=function(e){var a=this.GetItemKey(e);if(this.DrawData.has(a)){var r=this.DrawData.get(a);r.has(e.Guid)&&(r.delete(e.Guid),this.Save())}},this.Clear=function(){this.DrawData=new Dt.default,this.Save()},this.GetDrawData=function(e){var a=[],r=this.GetItemKey(e);if(!this.DrawData.has(r))return a;var t=this.DrawData.get(r),n=!0,s=!1,o=void 0;try{for(var l=(0,ye.default)(t),h;!(n=(h=l.next()).done);n=!0){var u=h.value;a.push(u[1])}}catch(f){s=!0,o=f}finally{try{!n&&l.return&&l.return()}finally{if(s)throw o}}return a}}function SD(){this.Data=[[1e-6,2e-6,1e-6,1e-7],[2e-6,4e-6,2e-6,2e-7],[4e-6,5e-6,4e-6,1e-7],[5e-6,1e-5,5e-6,5e-7],[1e-5,2e-5,1e-5,1e-6],[2e-5,4e-5,2e-5,2e-6],[4e-5,5e-5,4e-5,1e-6],[5e-5,1e-4,5e-5,5e-6],[1e-4,2e-4,1e-4,1e-5],[2e-4,4e-4,2e-4,2e-5],[4e-4,5e-4,4e-4,1e-5],[5e-4,.001,5e-4,5e-5],[.001,.002,.001,1e-4],[.002,.004,.002,2e-4],[.004,.005,.004,1e-4],[.005,.01,.005,5e-4],[.01,.02,.01,.001],[.02,.04,.02,.002],[.04,.05,.04,.001],[.05,.1,.05,.005],[.1,.2,.1,.01],[.2,.4,.2,.02],[.4,.5,.4,.01],[.5,1,.5,.05],[1,2,.5,.05],[2,4,.5,.05],[4,5,.5,.05],[5,10,.5,.05],[10,20,10,2],[20,40,20,5],[40,50,40,2],[50,100,50,10],[100,200,100,10],[200,400,200,20],[400,500,400,10],[500,1e3,500,50],[1e3,2e3,1e3,50],[2e3,4e3,2e3,50],[4e3,5e3,4e3,50],[5e3,1e4,5e3,100],[1e4,2e4,1e4,1e3],[2e4,4e4,1e4,1e3],[4e4,5e4,1e4,1e3],[5e4,1e5,1e4,1e3],[1e5,2e5,1e5,1e4],[2e5,4e5,1e5,1e4],[4e5,5e5,1e5,1e4],[5e5,1e6,1e5,1e4],[1e6,2e6,1e6,1e5],[2e6,4e6,1e6,1e5],[4e6,5e6,1e6,1e5],[5e6,1e7,1e6,1e5],[1e7,2e7,1e7,1e6],[2e7,4e7,1e7,1e6],[4e7,5e7,1e7,1e6],[5e7,1e8,1e7,1e6],[1e8,2e8,1e8,1e7],[2e8,4e8,1e8,1e7],[4e8,5e8,1e8,1e7],[5e8,1e9,1e8,1e7],[1e9,2e9,1e9,1e8],[2e9,4e9,1e9,1e8],[4e9,5e9,1e9,1e8],[5e9,1e10,1e9,1e8]],this.Find=function(e){for(var a in this.Data){var r=this.Data[a];if(e>r[0]&&e<=r[1]){var t={};return t.FixInterval=r[2],t.Increase=r[3],t}}return null}}function mm(){this.newMethod=SD,this.newMethod(),delete this.newMethod,this.Data=[[1e-6,2e-6,1e-6,1e-7],[2e-6,4e-6,2e-6,2e-7],[4e-6,5e-6,4e-6,1e-7],[5e-6,1e-5,5e-6,5e-7],[1e-5,2e-5,1e-5,1e-6],[2e-5,4e-5,2e-5,2e-6],[4e-5,5e-5,4e-5,1e-6],[5e-5,1e-4,5e-5,5e-6],[1e-4,2e-4,1e-4,1e-5],[2e-4,4e-4,2e-4,2e-5],[4e-4,5e-4,4e-4,1e-5],[5e-4,.001,5e-4,5e-5],[.001,.002,.001,1e-4],[.002,.004,.002,1e-4],[.004,.005,.004,1e-4],[.005,.01,.005,5e-4],[.01,.02,.01,.001],[.02,.04,.02,.001],[.04,.05,.04,.001],[.05,.1,.05,.001],[.1,.2,.1,.01],[.2,.4,.2,.01],[.4,.5,.2,.01],[.5,.8,.2,.01],[.8,1,.5,.01],[1,2,.5,.05],[2,4,.5,.05],[4,5,.5,.05],[5,10,.5,.05],[10,12,10,2],[20,40,20,5],[40,50,40,2],[50,100,50,10],[100,200,100,10],[200,400,200,20],[400,500,400,10],[500,1e3,500,50],[1e3,2e3,1e3,50],[2e3,4e3,2e3,50],[4e3,5e3,4e3,50],[5e3,1e4,5e3,100],[1e4,2e4,1e4,1e3],[2e4,4e4,2e4,2e3],[4e4,5e4,4e4,1e3],[5e4,1e5,5e4,5e3],[1e5,2e5,1e5,1e4],[2e5,4e5,2e5,2e4],[4e5,5e5,4e5,1e4],[5e5,1e6,5e5,5e4],[1e6,2e6,1e6,1e5],[2e6,4e6,2e6,2e5],[4e6,5e6,4e6,1e5],[5e6,1e7,5e6,5e5],[1e7,2e7,1e7,1e6],[2e7,4e7,2e7,2e6],[4e7,5e7,4e7,1e6],[5e7,1e8,5e7,5e6],[1e8,2e8,1e8,1e7],[2e8,4e8,2e8,2e7],[4e8,5e8,4e8,1e7],[5e8,1e9,5e8,5e7],[1e9,2e9,1e9,1e8],[2e9,4e9,2e9,2e8],[4e9,5e9,4e9,1e8],[5e9,1e10,5e9,5e8]]}function dD(){this.IsDOMFrameTitle=!1,this.IsDOMFrameToolbar=!1,this.KLineToolbar={ModifyIndex:!0,ChangeIndex:!0,CloseIndex:!0,OverlayIndex:!1,MaxMinWindow:!0,TitleWindow:!0,ExportData:!1,IsShowOverlayToolbar:!0,IsShowOverlayFrame:!0},this.MinuteToolbar={ModifyIndex:!0,ChangeIndex:!0,CloseIndex:!0,OverlayIndex:!0,MaxMinWindow:!0,TitleWindow:!0,ExportData:!1},this.TooltipBGColor="rgb(255, 255, 255)",this.TooltipAlpha=.92,this.PopMinuteChart={BGColor:"rgba(250,250,250,0.95)",BorderColor:"rgb(0,0,0)",TitleColor:"rgb(250,250,250)",TitleBGColor:"rgb(200, 66, 69)"},this.SelectRectBGColor="rgba(1,130,212,0.06)",this.UpBarColor="rgb(238,21,21)",this.DownBarColor="rgb(25,158,0)",this.UnchagneBarColor="rgb(0,0,0)",this.EmptyBarBGColor="rgb(255,255,255)",this.HighLowBarColor="rgb(41,98,255)",this.HighLowText={FontName:"arial",MaxSize:30,MinSize:4,Color:"rgb(41,98,255)",MaxText:"9999.9"},this.SplashScreen={BGColor:"rgba(112,128,144,0.5)",Title:"下载数据中......",TextColor:"rgb(43,54,69)",Font:14*B()+"px 微软雅黑"},this.HLCArea={HighLineColor:"rgb(242,54,69)",LowLineColor:"rgb(8,153,129)",CloseLineColor:"rgb(224,227,227)",LineWidth:2*B(),UpAreaColor:"rgba(253,214,218, 0.5)",DownAreaColor:"rgba(205,235,230, 0.5)"},this.Minute={},this.Minute.VolBarColor=null,this.Minute.VolTitleColor="rgb(105,105,105)",this.Minute.PriceColor="rgb(50,171,205)",this.Minute.PriceLineWidth=1*B(),this.Minute.AreaPriceColor="rgba(50,171,205,0.1)",this.Minute.AvPriceColor="rgb(238,127,9)",this.Minute.PositionColor="rgb(218,165,32)",this.Minute.FrameSplitTextColor=null,this.Minute.Before={BGColor:"rgba(240,240,240,0.7)",LineColor:"rgb(50,171,205)",VolColor:["rgb(192,192,0)"],AvPriceColor:"rgb(190,190,190)",Point:{Color:"rgb(65,105,225)",Radius:2*B()},CloseIcon:{Family:"iconfont",Text:"",Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Size:12*B()}},this.Minute.After={BGColor:"rgba(240,240,240,0.7)",LineColor:"rgb(50,171,205)",VolColor:["rgb(192,192,0)"],AvPriceColor:"rgb(190,190,190)",Point:{Color:"rgb(65,105,225)",Radius:2*B()}},this.Minute.NightDay={NightBGColor:"rgba(0,0,0,0.2)",Font:12*B()+"px 微软雅黑",Day:{Color:"rgb(0,0,0)",BGColor:"rgb(179,179,179)",BorderColor:"rgb(179,179,179)",Margin:{Left:5,Top:2,Bottom:2,Right:5}},Night:{Color:"rgb(0,0,0)",BGColor:"rgb(179,179,179)",BorderColor:"rgb(179,179,179)",Margin:{Left:5,Top:2,Bottom:2,Right:5}}},this.DefaultTextColor="rgb(43,54,69)",this.DefaultTextFont=14*B()+"px 微软雅黑",this.TitleFont=13*B()+"px 微软雅黑",this.IndexTitleBGColor="rgb(250,250,250)",this.IndexTitleBorderColor="rgb(180,180,180)",this.IndexTitleBorderMoveOnColor="rgb(0,0,0)",this.IndexTitleBorderStyle=1,this.IndexTitleColor="rgb(43,54,69)",this.IndexTitleSelectedColor="rgb(65,105,225)",this.OverlayIndexTitleBGColor="rgba(255,255,255,0.7)",this.IndexTitleMerginLeft=1,this.IndexTitle={UpDownArrow:{UpColor:"rgb(238,21,21)",DownColor:"rgb(25,158,0)",UnchangeColor:"rgb(0,0,0)"},ArrowType:0,EnableIndexArrow:!0,NameArrow:{Color:"rgb(43,54,69)",Space:2,Symbol:"▼"}},this.Title={TradeIndexColor:"rgb(105,105,105)",ColorIndexColor:"rgb(112,128,144)",VolColor:"rgb(43,54,69)",AmountColor:"rgb(43,54,69)",DateTimeColor:"rgb(43,54,69)",SettingColor:"rgb(43,54,69)",NameColor:"rgb(43,54,69)",TurnoverRateColor:"rgb(43,54,69)",PositionColor:"rgb(43,54,69)"},this.UpTextColor="rgb(238,21,21)",this.DownTextColor="rgb(25,158,0)",this.UnchagneTextColor="rgb(0,0,0)",this.CloseLineColor="rgb(0,191,255)",this.CloseLineAreaColor=["rgba(0,191,255,0.8)","rgba(0,191,255,0.2)"],this.CloseLineWidth=2,this.FrameBorderPen="rgb(225,236,242)",this.MultiDayBorderPen="rgb(225,236,242)",this.FrameSplitPen="rgb(225,236,242)",this.FrameDotSplitPen="rgb(105,105,105)",this.FrameYLineDash=null,this.FrameXLineDash=null,this.FrameSplitTextColor="rgb(117,125,129)",this.FrameSplitTextFont=14*B()+"px 微软雅黑",this.FrameTitleBGColor="rgb(246,251,253)",this.SelFrameBorderColor="rgb(130, 130, 130)",this.Frame={XBottomOffset:2*B(),YTopOffset:2*B(),YTextPadding:[2,2],EnableRemoveZero:!0,StringFormat:0},this.ToolbarButtonStyle=0,this.FrameLogo={TextColor:"rgb(178,34,34)",Font:"bold "+16*B()+"px 微软雅黑",Text:"*仅学习使用*",BGColor:"rgba(230,230,230, 0.5)"},this.Frame.PercentageText={PriceColor:"rgb(117,125,129)",PercentageColor:"rgb(117,125,129)",SplitColor:"rgb(117,125,129)",Font:14*B()+"px 微软雅黑"},this.FrameLogarithmic={OpenPriceFont:"bold "+14*B()+"px 微软雅黑",MinInterval:45*B()},this.FrameSplitIncrease={Increase:.1},this.FrameSplitAverage={Count:4},this.FrameGoldenSection={Golden:[0,.191,.382,.5,.618,.809,1]},this.FrameLatestPrice={TextColor:"rgb(255,255,255)",UpBarColor:"rgb(238,21,21)",DownBarColor:"rgb(25,158,0)",UnchagneBarColor:"rgb(0,0,0)",BGAlpha:.6,EmptyBGColor:"rgb(255,255,255)",OverlayTextColor:"rgb(255,255,255)"},this.FrameMargin=4,this.FrameLeftMargin=2,this.FrameRightMargin=2,this.DragSubFrameBorder={TopBorderHeight:6*B(),MinFrameHeight:50*B()},this.OverlayFrame={BolderPen:"rgb(190,190,190)",TitleColor:"rgb(105,105,105)",TitleFont:11*B()+"px arial"},this.CorssCursorBGColor="rgb(43,54,69)",this.CorssCursorTextColor="rgb(255,255,255)",this.CorssCursorTextFont=14*B()+"px 微软雅黑",this.CorssCursorHPenColor="rgb(130,130,130)",this.CorssCursorVPenColor="rgb(130,130,130)",this.CorssCursorXRangeBGColor="rgba(100,149,237,0.3)",this.CorssCursor={RightButton:{BGColor:"rgb(43,54,69)",PenColor:"rgb(255,255,255)",Icon:{Text:"",Color:"rgb(255,255,255)",Family:"iconfont",Size:18}},RightMargin:{Left:2,Right:2,Top:5,Bottom:3}},this.LockBGColor="rgb(220, 220, 220)",this.LockTextColor="rgb(210, 34, 34)",this.Domain="http://127.0.0.1:8080",this.CacheDomain="http://127.0.0.1:8087",this.PyIndexDomain="http://127.0.0.1:8088",this.KLine={MaxMin:{Font:12*B()+"px 微软雅黑",Color:"rgb(43,54,69)",RightArrow:"→",LeftArrow:"←",HighYOffset:0,LowYOffset:0},Info:{Investor:{ApiUrl:"/API/NewsInteract",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#1c65db"}},Announcement:{ApiUrl:"/API/ReportList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f5a521"},IconFont2:{Family:"iconfont",Text:"",HScreenText:"",Color:"#ed7520"}},Pforecast:{ApiUrl:"/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#986cad"}},Research:{ApiUrl:"/API/InvestorRelationsList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#19b1b7"}},BlockTrading:{ApiUrl:"/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f39f7c"}},TradeDetail:{ApiUrl:"/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#b22626"}},IconLibrary:{Family:"iconfont",Icon:[{Text:"",HScreenText:"",Color:"#f39f7c"},{Text:"",HScreenText:"",Color:"#19b1b7"},{Text:"",HScreenText:"",Color:"#b22626"},{Text:"",HScreenText:"",Color:"#ed7520"}]}},NumIcon:{Color:"rgb(251,80,80)",Family:"iconfont",Text:["","","","","","","","","","","","","","","","","","","","",""]},TradeIcon:{Family:"iconfont",Buy:{Color:"rgb(255,15,4)",Text:"",HScreenText:""},Sell:{Color:"rgb(64,122,22)",Text:"",HScreenText:""}}},this.VirtualKLine={Color:"rgb(100,100,100)",LineDash:[2,2]},this.PriceGapStyple={Line:{Color:"rgb(186,186,186)"},Text:{Color:"rgb(105,105,105)",Font:12*B()+"px 微软雅黑"}},this.OrderFlow={UpColor:{BG:"rgb(223,191,180)",Border:"rgb(196,84,86)"},DownColor:{BG:"rgb(176,212,184)",Border:"rgb(66,94,74)"},UnchagneColor:{BG:"rgb(216,221,177)",Border:"rgb(209,172,129)"},Text:{Color:"rgb(92,96,89)",Family:"Arial",FontMaxSize:18,MaxValue:"8888"},Line:{UpDownColor:"rgb(0,0,0)",MiddleColor:"rgb(211,211,211)"},AlwaysShowOrderText:!0,POCGBColor:"rgba(178,34,34,0.8)",AskBarColor:"rgb(14,209,69)",BidBarColor:"rgb(236,28,36)"},this.OrderFlow_Style2={BarWidth:10,UpColor:"rgb(241,55,63)",DownColor:"rgb(75,105,150)",UnchagneColor:"rgb(79,79,79)"},this.OrderFlow_Style3={BarWidth:20,UpColor:"rgb(241,55,63)",DownColor:"rgb(75,105,150)",UnchagneColor:"rgb(79,79,79)"},this.OrderFlow_Style4={KBarWidth:5,UpColor:"rgb(241,55,63)",DownColor:"rgb(75,105,150)",UnchagneColor:"rgb(79,79,79)",VolBarSpace:1,LeftMargin:1,RightMargin:1},this.OrderFlow_Style5={AskBarColor:"rgb(176,22,22)",BidBarColor:"rgb(98,126,176)",LeftMargin:3,RightMargin:2},this.Index={},this.Index.LineColor=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],this.OverlaySymbol={Random:0},this.OverlaySymbol.Color=["rgb(38,198,218)","rgb(103,58,183)","rgb(0,191,165)","rgb(130,177,255)"],this.Index.StockHistoryDayApiUrl="http://127.0.0.1:8080/API/StockHistoryDay",this.Index.MarketLongShortApiUrl="http://127.0.0.1:8080/API/FactorTiming",this.Index.MarketAttentionApiUrl="http://127.0.0.1:8080/API/MarketAttention",this.Index.MarketHeatApiUrl="http://127.0.0.1:8080/API/MarketHeat",this.Index.CustomIndexHeatApiUrl="http://127.0.0.1:8080/API/QuadrantCalculate",this.Index.NotSupport={Font:14*B()+"px 微软雅黑",TextColor:"rgb(52,52,52)"},this.Buttons={CloseOverlayIndex:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:12*B(),MerginLeft:3},CloseWindow:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*B(),MerginLeft:4},ChangeIndex:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*B(),MerginLeft:4},OverlayIndex:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*B(),MerginLeft:4},ModifyIndexParam:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*B(),MerginLeft:4},MaxMinWindow:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*B(),MerginLeft:4},TitleWindow:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*B(),MerginLeft:4},ExportData:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*B(),MerginLeft:4},Tooltip:{Font:13*B()+"px 微软雅黑",Color:"rgb(71,71,71)",ColorBG:"rgb(255,255,255)",ColorBorder:"rgb(0,0,0)",BorderRadius:2,Mergin:{Left:4,Right:4,Top:2,Bottom:3}}},this.DrawPicture={LineColor:["rgb(41,98,255)"],PointColor:["rgb(41,98,255)","rgb(89,135,255)","rgb(255,255,255)"],XYCoordinate:{BGColor:"rgba(203,216,255,0.5)",TextBGColor:"rgb(52,101,255)",TextColor:"rgb(255,255,255)",Font:14*B()+"px 微软雅黑"},PointType:2,IsShowPoint:!1},this.ChartOX={Family:"iconfont",Up:{Color:"rgb(178,34,34)",Text:""},Down:{Color:"rgb(0,206,209)",Text:""},SquareLineColor:"rgb(119,136,153)"},this.KLineTrain={Font:"bold 14px arial",LastDataIcon:{Color:"rgb(0,0,205)",Text:"⬇"},BuyIcon:{Color:"rgb(0,205,102 )",Text:"B"},SellIcon:{Color:"rgb(255,127,36 )",Text:"S"},IconFont:{Family:"iconfont",Buy:{Text:"",HScreenText:"",Color:"rgb(255,140,0)"},Sell:{Text:"",HScreenText:"",Color:"rgb(6,79,18)"},Last:{Text:"",HScreenText:"",Color:"rgb(55,0,255)"}}},this.ChartKLineTable={TextFont:{Family:"Arial",FontMaxSize:25},ItemMergin:{Left:5,Right:5,Top:4,Bottom:2}},this.TooltipPaint={BGColor:"rgba(250,250,250,0.8)",BorderColor:"rgb(120,120,120)",TitleColor:"rgb(79, 79, 79)",TitleFont:13*B()+"px 微软雅黑",DateTimeColor:"rgb(105 105 105)",VolColor:"rgb(255, 185, 15)",AmountColor:"rgb(79, 79, 79)"},this.PCTooltipPaint={BGColor:"rgba(250,250,250)",BorderColor:"rgb(120,120,120)",TitleColor:"rgb(60,60,60)",TitleFont:12*B()+"px 微软雅黑",DateTimeColor:"rgb(60,60,60)",VolColor:"rgb(60,60,60)",AmountColor:"rgb(60,60,60)",PositionColor:"rgb(60,60,60)"},this.PCTooltip={LineHeight:25},this.DialogTooltip={BGColor:"rgb(250,250,250)",BorderColor:"rgb(20,20,20)",TitleColor:"rgb(250,250,250)",TitleBGColor:"rgb(200, 66, 69)",VolColor:"rgb(255, 185, 15)",AmountColor:"rgb(79, 79, 79)",DateTimeColor:"rgb(60,60,60)",TurnoverRateColor:"rgb(43,54,69)",PositionColor:"rgb(255,0,255)",TextColor:"rgb(0,0,0)",ValueColor:"rgb(0,0,0)"},this.FloatTooltip={BGColor:"rgb(250,250,250)",BorderColor:"rgb(20,20,20)",VolColor:"rgb(255, 185, 15)",AmountColor:"rgb(79, 79, 79)",DateTimeColor:"rgb(60,60,60)",TurnoverRateColor:"rgb(43,54,69)",PositionColor:"rgb(255,0,255)",TextColor:"rgb(0,0,0)",ValueColor:"rgb(0,0,0)"},this.DialogSelectRect={BGColor:"rgb(250,250,250)",BorderColor:"rgb(20,20,20)",TitleColor:"rgb(0,0,0)",TextColor:"rgb(0,0,0)",ValueColor:"rgb(0,0,0)",VolColor:"rgb(255, 185, 15)",AmountColor:"rgb(79, 79, 79)",TurnoverRateColor:"rgb(43,54,69)",PositionColor:"rgb(255,0,255)"},this.DialogPopKeyboard={BGColor:"rgb(250,250,250)",BorderColor:"rgb(20,20,20)",TitleColor:"rgb(0,0,0)",TitleBGColor:"rgb(200, 66, 69)",Input:{BGColor:"rgb(250,250,250)",TextColor:"rgb(0,0,0)"}},this.DialogSearchIndex={BGColor:"rgb(250,250,250)",BorderColor:"rgb(20,20,20)",TitleColor:"rgb(250,250,250)",TitleBGColor:"rgb(200, 66, 69)",IndexNameColor:"rgb(0,0,0)",GroupNameColor:"rgb(0,0,0)",InputTextColor:"rgb(0,0,0)"},this.DialogModifyIndexParam={BGColor:"rgb(250,250,250)",BorderColor:"rgb(20,20,20)",TitleColor:"rgb(250,250,250)",TitleBGColor:"rgb(200, 66, 69)",ParamNameColor:"rgb(0,0,0)",InputTextColor:"rgb(0,0,0)"},this.Barrage={Font:16*B()+"px 微软雅黑",Height:20,Color:"RGB(109,109,109)"},this.MinuteInfo={TextColor:"rgb(84,143,255)",Font:14*B()+"px 微软雅黑",PointColor:"rgb(38,113,254)",LineColor:"rgb(120,167,255)",TextBGColor:"rgba(255,255,255,0.8)",PointRadius:4*B()},this.ChartDrawRuler={TitleColor:null},this.ChartDrawWaveRuler={RulerWidth:10,RulerLineWidth:1,MaxScaleRuler:2,Font:14*B()+"px 微软雅黑",ScaleRuler:[{Value:0,Text:"0.0%"},{Value:.382,Text:"38.2%"},{Value:.618,Text:"61.8%"},{Value:1,Text:"100%"},{Value:1.618,Text:"161.8%"},{Value:2,Text:"200%"}]},this.ChartDrawWaveRuler2Point={RulerWidth:20,RulerLineWidth:1,MaxScaleRuler:2,Font:14*B()+"px 微软雅黑",ScaleRuler:[{Value:0,Text:"base"},{Value:.618,Text:"61.8%"},{Value:1,Text:"100%"},{Value:1.618,Text:"161.8%"}]},this.ChartDrawVolProfile={BGColor:"rgba(244,250,254,0.8)",BorderColor:"rgba(255,255,255)",VolLineColor:"rgb(232,5,9)",UpVolColor:"rgba(103,179,238, 0.24)",DownVolColor:"rgba(237,208,105,0.24)",AreaUpColor:"rgb(103,179,238,0.7)",AreaDonwColor:"rgba(237,208,105,0.7)",Text:{Color:"rgb(0,0,0)",Family:"Arial",FontMaxSize:18,FontMinSize:6}},this.ChartVolProfileVisibleRange={VolLineColor:"rgb(232,5,9)",VolLineFont:14*B()+"px 微软雅黑",VolLineTextColor:"rgb(255,255,255)",UpVolColor:"rgba(103,179,238, 0.24)",DownVolColor:"rgba(237,208,105,0.24)",AreaUpColor:"rgb(103,179,238,0.7)",AreaDonwColor:"rgba(237,208,105,0.7)",Text:{Color:"rgb(0,0,0)",Family:"Arial",FontMaxSize:18,FontMinSize:6},VAHLineColor:"rgb(0,0,255)",VAHTextColor:"rgb(255,255,255)",VALLineColor:"rgb(0,0,255)",VALTextColor:"rgb(255,255,255)",VAFont:14*B()+"px 微软雅黑"},this.ChartDrawNote={Text:"",FontOption:{Family:"iconfont",Size:32},NoteFontOption:{Family:"微软雅黑",Size:12,Weight:null,Style:null},NoteWidth:200,NoteMargin:{Left:5,Top:5,Bottom:5,Right:5},NoteBGColor:"rgba(104,114,255,0.7)",NoteTextColor:"rgb(240,240,240)",NoteBorderColor:"rgb(220,220,220)",LineSpace:3,ArrowSize:10},this.ChartDrawAnchoredText={TextMargin:{Left:5,Top:5,Bottom:5,Right:5},BGColor:"rgba(104,114,255,0.7)",BorderColor:"rgb(220,220,220)",TextColor:"rgb(0,0,0)",FontOption:{Family:"微软雅黑",Size:12,Weight:null,Style:null},LineSpace:2,TextMaxWidth:-1},this.ChartDrawPriceLabel={TextMargin:{Left:10,Top:5,Bottom:5,Right:10},BGColor:"rgba(104,114,255,0.7)",BorderColor:"rgb(220,220,220)",TextColor:"rgb(0,0,0)",FontOption:{Family:"微软雅黑",Size:14,Weight:null,Style:null}},this.ChartDrawPriceNote={TextMargin:{Left:10,Top:5,Bottom:5,Right:10},BGColor:"rgba(104,114,255,0.7)",BorderColor:"rgb(220,220,220)",TextColor:"rgb(0,0,0)",FontOption:{Family:"微软雅黑",Size:14,Weight:null,Style:null}},this.DRAWICON={Icon:{MaxSize:24,MinSize:12,YOffset:0,Zoom:{Type:1,Value:1}},Text:{MaxSize:50,MinSize:12,YOffset:0,Zoom:{Type:1,Value:1},FontName:"Arial"}},this.DRAWTEXT={MaxSize:30,MinSize:20,YOffset:0,Zoom:{Type:1,Value:1},FontName:"微软雅黑"},this.DRAWNUMBER={MaxSize:30,MinSize:20,YOffset:0,Zoom:{Type:1,Value:1},FontName:"微软雅黑"},this.DRAWABOVE={YOffset:0},this.DRAWTEXT_FIX={Font:14*B()+"px 微软雅黑"},this.DRAWNUMBER_FIX={Font:14*B()+"px 微软雅黑"},this.DOTLINE={LineDash:[3,5]},this.DRAWSL={PixelWidth:15},this.CIRCLEDOT={Radius:1.3*B()},this.TIPICON={Family:"iconfont",TextFont:B()+"px 微软雅黑",Size:10*B(),Color:"rgb(255,165,0)"},this.POINTDOT={Radius:2*B()},this.DepthMapPaint={LineColor:"rgba(255,185,15)",AreaColor:["rgba(255,185,15,0.8)","rgba(255,185,15,0.4)"],TextColor:"rgba(255,255,255)",TextBGColor:"rgb(43,54,69)"},this.KLineYAxisBGPaint={Font:12*B()+"px 微软雅黑",LineColor:"rgb(117,125,129)",DiffValutTextColor:"rgb(117,125,129)",DiffValueBGColor:"rgb(251,140,1)"},this.StockChip={InfoColor:"rgb(0,0,0)",DayInfoColor:"rgb(255,255,255)",Font:12*B()+"px 微软雅黑",DefaultButton:{Color:"rgb(128,128,128)",MoveOnColor:"rgb(30,144,255)",SelectedColor:"rgb(255,0,0)",Family:"iconfont",Text:"",Size:13*B(),MerginLeft:4},LongButton:{Color:"rgb(128,128,128)",MoveOnColor:"rgb(30,144,255)",SelectedColor:"rgb(255,128,0)",Family:"iconfont",Text:"",Size:13*B(),MerginLeft:4},RecentButton:{Color:"rgb(128,128,128)",MoveOnColor:"rgb(30,144,255)",SelectedColor:"rgb(0,0,204)",Family:"iconfont",Text:"",Size:13*B(),MerginLeft:4}},this.DepthChart={BidColor:{Line:"rgb(82,176,123)",Area:"rgba(82,176,123,0.8)"},AskColor:{Line:"rgb(207,76,89)",Area:"rgba(207,76,89, 0.8)"},LineWidth:4},this.DepthCorss={BidColor:{Line:"rgb(82,176,123)"},AskColor:{Line:"rgb(207,76,89)"},LineWidth:2,LineDash:[3,3],Tooltip:{BGColor:"rgba(236,240,245, 0.8)",TextColor:"rgb(130,140,151)",Border:{Top:5,Left:20,Right:20,Bottom:5,ItemSpace:5},Font:14*B()+"px 微软雅黑"}},this.RectSelect={LineColor:"rgb(64,64,64)",LineWidth:1*B(),LineDotted:[3,3],AreaColor:"rgba(234,234,234,0.5)",SubAreaColor:"rgba(105,105,105,0.5)",RangeTextColor:"rgb(248,248,255)",RangeTextFont:14*B()+"px 微软雅黑",RangeTextBGColor:"rgb(43,54,69)",RangeTextSubColor:"rgb(255,255,255)",RangeTextSubFont:12*B()+"px 微软雅黑",RangeTextSubBGColor:"rgb(54,54,54)",Mark:{Family:"iconfont",Text:"",Color:"rgb(250,0,0)",Size:15*B(),Position:{Index:0,Top:"TopEx"}}},this.SelectedChart={LineWidth:1,LineColor:"rgb(55,100,100)",Radius:4,MinSpace:200,BGColor:"rgb(255,255,255)"},this.RectDrag={LineColor:"rgb(0,0,0)",LineWidth:1*B(),BGColor:"rgba(128,128,128,0.2)"},this.DragMovePaint={TextColor:"rgb(0,0,0)",Font:14*B()+"px 微软雅黑"},this.SessionBreaksPaint={BGColor:[null,"rgb(245,246,246)"],SplitLine:{Color:"rgb(73,133,231)",Width:1*B(),Dash:[5*B(),5*B()]}},this.DealList={BorderColor:"rgb(192,192,192)",Header:{Color:"RGB(60,60,60)",Mergin:{Left:5,Right:5,Top:4,Bottom:2},Font:{Size:12,Name:"微软雅黑"}},Row:{Mergin:{Top:2,Bottom:2},Font:{Size:15,Name:"微软雅黑"},BarMergin:{Top:2,Left:3,Right:3,Bottom:2}},FieldColor:{Vol:"rgb(90,90,90)",Time:"rgb(60,60,60)",Deal:"rgb(90,90,90)",Index:"rgb(60,60,60)",BarTitle:"rgb(60,60,60)",Text:"rgb(60,60,60)",Bar:["rgb(255,0,0)","rgb(34,139,34)","rgb(119,136,153)","rgb(75,0,130)","rgb(65,105,225)","rgb(255,215,0)","rgb(255,0,255)","rgb(128,128,0)"]},UpTextColor:"rgb(238,21,21)",DownTextColor:"rgb(25,158,0)",UnchagneTextColor:"rgb(0,0,0)"},this.Report={BorderColor:"rgb(192,192,192)",SelectedColor:"rgb(180,240,240)",Header:{Color:"rgb(60,60,60)",SortColor:"rgb(255,0,0)",Mergin:{Left:5,Right:5,Top:4,Bottom:4},Font:{Size:12,Name:"微软雅黑"}},SortIcon:{Size:12,Family:"iconfont",Arrow:[null,"",""],Color:[null,"rgb(255,0,0)","rgb(255,0,0)"],Margin:{Left:0,Bottom:6}},Item:{Mergin:{Top:2,Bottom:4,Left:5,Right:5},Font:{Size:15,Name:"微软雅黑"},BarMergin:{Top:2,Left:3,Right:3,Bottom:2},NameFont:{Size:14,Name:"微软雅黑"},SymbolFont:{Size:12,Name:"微软雅黑"}},FixedItem:{Font:{Size:15,Name:"微软雅黑"}},LimitBorder:{Color:"rgb(180,180,180)",Mergin:{Top:1,Bottom:1,Left:0,Right:0}},NameSymbolV2:{Name:{Size:14,Name:"微软雅黑",Color:"rgb(60,60,60)"},Symbol:{Size:10,Name:"微软雅黑",Color:"rgb(105 105 105)"}},LimitColor:{UpColor:"rgb(255,0,0)",DownColor:"rgb(0,128,0)",TextColor:"rgb(250,250,250)"},FieldColor:{Index:"rgb(60,60,60)",Symbol:"rgb(60,60,60)",Name:"rgb(60,60,60)",Vol:"rgb(90,90,90)",Amount:"rgb(90,90,90)",Text:"rgb(60,60,60)"},UpTextColor:"rgb(238,21,21)",DownTextColor:"rgb(25,158,0)",UnchagneTextColor:"rgb(90,90,90)",CloseLine:{CloseColor:"rgb(30,144,255)",YCloseColor:"rgba(105,105,105,0.5)",AreaColor:"rgba(0,191,255,0.2)"},KLine:{UpColor:"rgb(255,0,0)",DownColor:"rgb(0,128,0)",UnchagneColor:"rgb(90,90,90)",DataWidth:16,DistanceWidth:3},Tab:{Font:{Size:12,Name:"微软雅黑"},ScrollBarWidth:100,ButtonColor:"rgb(252,252,252)",BarColor:"rgb(180,180,180)",BorderColor:"rgb(180,180,180)",Mergin:{Left:5,Right:5,Top:4,Bottom:2},TabTitleColor:"rgb(60,60,60)",TabSelectedTitleColor:"rgb(255,255,255)",TabSelectedBGColor:"rgb(234,85,4)",TabMoveOnTitleColor:"rgb(234,85,4)",TabBGColor:"rgb(220,220,220)"},PageInfo:{Font:{Size:15,Name:"微软雅黑"},TextColor:"rgb(0,0,0)",BGColor:"rgba(180,180,180,0.5)",Mergin:{Left:5,Right:5,Top:4,Bottom:2}},DragRow:{Color:"rgba(190,190,190,0.8)",TextColor:"rgba(0,0, 0, 0.8)",MoveRowColor:"rgb(240,128,128)",SrcRowColor:"rgb(180,240,240)"},VScrollbar:{ScrollBarHeight:60,ButtonColor:"rgba(252,252,252,0.8)",BarColor:"rgba(168,168,168,0.9)",BorderColor:"rgba(180,180,180,0.9)",BGColor:"rgba(234,239,248,0.9)",BarWidth:{Size:12}},CheckBox:{Family:"iconfont",Size:15,Checked:{Color:"rgb(69,147,238)",Symbol:"",DisableColor:"rgb(230,230,230)",MouseOnColor:"rgb(69,147,238)"},Unchecked:{Color:"rgb(120,120,120)",Symbol:"",DisableColor:"rgb(230,230,230)",MouseOnColor:"rgb(69,147,238)"},Margin:{Left:5,Right:5,Bottom:2,Top:4}},Link:{Font:12*B()+"px 微软雅黑",TextColor:"rgb(30,144,255)",Disable:{TextColor:"rgb(211,211,211)"},MouseOn:{TextColor:"rgb(30,144,255)"}},ProgressBar:{BGColor:"rgb(229,231,238)",BarColor:"rgb(26,125,255)",Margin:{Left:2,Right:2,Bottom:2,Top:2},BarMargin:{Left:2,Right:2,Bottom:2,Top:2},TextColor:"rgb(0,0,0)",Font:12*B()+"px 微软雅黑",TextMargin:{Left:40,Right:2,Bottom:2,Top:2},Disable:{BGColor:"rgb(229,231,238)",BarColor:"rgb(131,131,131)",TextColor:"rgb(159,161,159)"}},Button:{BGColor:"rgb(61,134,180)",TextColor:"rgb(255,255,255)",BorderColor:"rgb(200,200,200)",Disable:{BGColor:"rgb(105,105,105)",TextColor:"rgb(169,169,169)"},MouseOn:{BGColor:"rgb(57,125,169)",TextColor:"rgb(230,230,230)"},Margin:{Left:5,Right:5,Bottom:2,Top:2},TextMargin:{Bottom:2},Font:12*B()+"px 微软雅黑"}},this.TReport={BorderColor:"rgb(192,192,192)",SelectedColor:"rgb(3,89,245)",Header:{Color:"rgb(60,60,60)",SortColor:"rgb(255,0,0)",Mergin:{Left:5,Right:5,Top:4,Bottom:2},Font:{Size:14,Name:"微软雅黑"}},Item:{Mergin:{Top:2,Bottom:0,Left:5,Right:5},Font:{Size:15,Name:"微软雅黑"},BarMergin:{Top:2,Left:3,Right:3,Bottom:2},NameFont:{Size:14,Name:"微软雅黑"},SymbolFont:{Size:12,Name:"微软雅黑"}},FixedItem:{Font:{Size:15,Name:"微软雅黑"}},CenterItem:{TextColor:"rgb(60,60,83)",BaseTextColor:"rgb(60,60,83)",BGColor:"rgb(180,180,180)"},FieldColor:{Index:"rgb(60,60,60)",Symbol:"rgb(60,60,60)",Name:"rgb(60,60,60)",Vol:"rgb(90,90,90)",Position:"rgb(90,90,90)",Amount:"rgb(90,90,90)",Text:"rgb(60,60,60)"},UpTextColor:"rgb(238,21,21)",DownTextColor:"rgb(25,158,0)",UnchangeTextColor:"rgb(90,90,90)",UpBGColor:"rgb(255,220,220)",DownBGColor:"rgb(190,220,190)",MarkBorder:{MaxPositionColor:"rgb(192,192,192)"}},this.Keyboard={BorderColor:"rgb(192,192,192)",SelectedColor:"rgb(180,240,240)",TextColor:"rgb(0,0,0)",Item:{Mergin:{Top:2,Bottom:0,Left:1,Right:1},Font:{Size:15,Name:"微软雅黑"},BarMergin:{Top:2,Left:0,Right:0,Bottom:2},NameFont:{Size:14,Name:"微软雅黑"},SymbolFont:{Size:12,Name:"微软雅黑"}},VScrollbar:{ScrollBarHeight:50,ButtonColor:"rgba(252,252,252,0.8)",BarColor:"rgba(168,168,168,0.9)",BorderColor:"rgba(180,180,180,0.9)",BGColor:"rgba(234,239,248,0.9)",BarWidth:{Size:8}}},this.ScrollBar={BorderColor:"rgb(192,192,192)",XSplitTextFont:12*B()+"px 微软雅黑",XSplitTextColor:"rgb(0,0,0)",XSplitLineColor:"rgba(0,0,0,0.8)",BGChart:{Color:"rgb(135,206,250)",LineWidth:1,AreaColor:"rgba(135,206,250,0.5)"},Slider:{DateFont:14*B()+"px 微软雅黑",DateColor:"rgb(0,0,0)",BarColor:"rgb(207,207,207)",BarAreaColor:"rgba(232,232,232,0.65)",BarWidth:10,BarPadding:15,MinCenterWidth:15}},this.FrameButtomToolbar={BGColor:"rgb(235,235,235)",BorderColor:"rgb(204,204,204)",Button:{Font:{Family:"微软雅黑",Size:12*B()},TitleColor:{Selected:"rgb(255,255,255)",Default:"rgb(125,125,125)",MoveOn:"rgb(234,85,4)"},BGColor:{Selected:"rgb(234,85,4)",Default:"rgb(235,235,235)",MoveOn:"rgb(242,242,242)"},BorderColor:"rgb(204,204,204)",Mergin:{Left:5*B(),Right:5*B(),Top:4*B(),Bottom:2*B()},SVG:{Family:"iconfont",Size:12*B(),MerginLeft:4*B()}}},this.SetStyle=function(e){var a=function(I,g){I&&(I.Color&&(g.Color=I.Color),I.MoveOnColor&&(g.MoveOnColor=I.MoveOnColor),I.SelectedColor&&(g.SelectedColor=I.SelectedColor),I.Family&&(g.Family=I.Family),I.Text&&(g.Text=I.Text),v.IsNumber(I.Size)&&(g.Size=I.Size),v.IsNumber(I.MerginLeft)&&(g.MerginLeft=I.MerginLeft))};if(e.TooltipBGColor&&(this.TooltipBGColor=e.TooltipBGColor),e.TooltipAlpha&&(this.TooltipAlpha=e.TooltipAlpha),e.SelectRectBGColor&&(this.SelectRectBGColor=e.SelectRectBGColor),e.UpBarColor&&(this.UpBarColor=e.UpBarColor),e.DownBarColor&&(this.DownBarColor=e.DownBarColor),e.UnchagneBarColor&&(this.UnchagneBarColor=e.UnchagneBarColor),e.EmptyBarBGColor&&(this.EmptyBarBGColor=e.EmptyBarBGColor),e.HighLowBarColor&&(this.HighLowBarColor=e.HighLowBarColor),e.HighLowText){var r=this.HighLowText,t=e.HighLowText;t.FontName&&(r.FontName=t.FontName),t.Color&&(r.Color=t.Color),t.MaxText&&(r.MaxText=t.MaxText),v.IsPlusNumber(t.MaxSize)&&(r.MaxSize=t.MaxSize),v.IsPlusNumber(t.MinSize)&&(r.MinSize=t.MinSize)}if(e.SplashScreen){var t=e.SplashScreen;t.BGColor&&(this.SplashScreen.BGColor=t.BGColor),t.Title&&(this.SplashScreen.Title=t.Title),t.TextColor&&(this.SplashScreen.TextColor=t.TextColor),t.Font&&(this.SplashScreen.Font=t.Font)}if(e.HLCArea){var t=e.HLCArea;t.HighLineColor&&(this.HLCArea.HighLineColor=t.HighLineColor),t.LowLineColor&&(this.HLCArea.LowLineColor=t.LowLineColor),t.CloseLineColor&&(this.HLCArea.CloseLineColor=t.CloseLineColor),t.UpAreaColor&&(this.HLCArea.UpAreaColor=t.UpAreaColor),t.DownAreaColor&&(this.HLCArea.DownAreaColor=t.DownAreaColor),v.IsNumber(t.LineWidth)&&(this.HLCArea.LineWidth=t.LineWidth)}if(e.Minute){if(e.Minute.VolBarColor&&(this.Minute.VolBarColor=e.Minute.VolBarColor),e.Minute.VolTitleColor&&(this.Minute.VolTitleColor=e.Minute.VolTitleColor),e.Minute.PriceColor&&(this.Minute.PriceColor=e.Minute.PriceColor),v.IsNumber(e.Minute.PriceLineWidth)&&(this.Minute.PriceLineWidth=e.Minute.PriceLineWidth),e.Minute.AvPriceColor&&(this.Minute.AvPriceColor=e.Minute.AvPriceColor),e.Minute.AreaPriceColor&&(this.Minute.AreaPriceColor=e.Minute.AreaPriceColor),e.Minute.PositionColor&&(this.Minute.PositionColor=e.Minute.PositionColor),e.Minute.FrameSplitTextColor&&(this.Minute.FrameSplitTextColor=e.Minute.FrameSplitTextColor),e.Minute.Before){var t=e.Minute.Before;t.BGColor&&(this.Minute.Before.BGColor=t.BGColor),t.LineColor&&(this.Minute.Before.LineColor=t.LineColor),t.VolColor&&(this.Minute.Before.VolColor=t.VolColor),t.AvPriceColor&&(this.Minute.Before.AvPriceColor=t.AvPriceColor),t.CloseIcon&&a(t.CloseIcon,this.Minute.Before.CloseIcon),t.Point&&(t.Point.Color&&(this.Minute.Before.Point.Color=t.Point.Color),t.Point.Radius&&(this.Minute.Before.Point.Radius=t.Point.Radius))}if(e.Minute.After){var t=e.Minute.After;t.BGColor&&(this.Minute.After.BGColor=t.BGColor),t.LineColor&&(this.Minute.After.LineColor=t.LineColor),t.VolColor&&(this.Minute.After.VolColor=t.VolColor),t.AvPriceColor&&(this.Minute.After.AvPriceColor=t.AvPriceColor),t.Point&&(t.Point.Color&&(this.Minute.After.Point.Color=t.Point.Color),t.Point.Radius&&(this.Minute.After.Point.Radius=t.Point.Radius))}if(e.Minute.NightDay){var t=e.Minute.NightDay;if(t.NightBGColor&&(this.Minute.NightDay.NightBGColor=t.NightBGColor),t.Font&&(this.Minute.NightDay.Font=t.Font),t.Day){var n=t.Day;n.Color&&(this.Minute.NightDay.Day.Color=n.Color),n.BGColor&&(this.Minute.NightDay.Day.BGColor=n.BGColor),n.BorderColor&&(this.Minute.NightDay.Day.BorderColor=n.BorderColor),wa(this.Minute.NightDay.Day.Margin,n.Margin)}if(t.Night){var n=t.Night;n.Color&&(this.Minute.NightDay.Night.Color=n.Color),n.BGColor&&(this.Minute.NightDay.Night.BGColor=n.BGColor),n.BorderColor&&(this.Minute.NightDay.Night.BorderColor=n.BorderColor),wa(this.Minute.NightDay.Night.Margin,n.Margin)}}}if(e.PopMinuteChart){var t=e.PopMinuteChart;t.BGColor&&(this.PopMinuteChart.BGColor=t.BGColor),t.BorderColor&&(this.PopMinuteChart.BorderColor=t.BorderColor),t.TitleColor&&(this.DialogSearchIndex.TitleColor=t.TitleColor),t.TitleBGColor&&(this.DialogSearchIndex.TitleBGColor=t.TitleBGColor)}if(e.DefaultTextColor&&(this.DefaultTextColor=e.DefaultTextColor),e.DefaultTextFont&&(this.DefaultTextFont=e.DefaultTextFont),e.TitleFont&&(this.TitleFont=e.TitleFont),e.IndexTitleBGColor&&(this.IndexTitleBGColor=e.IndexTitleBGColor),e.IndexTitleBorderColor&&(this.IndexTitleBorderColor=e.IndexTitleBorderColor),e.IndexTitleBorderMoveOnColor&&(this.IndexTitleBorderMoveOnColor=e.IndexTitleBorderMoveOnColor),v.IsNumber(e.IndexTitleBorderStyle)&&(this.IndexTitleBorderStyle=e.IndexTitleBorderStyle),e.IndexTitleColor&&(this.IndexTitleColor=e.IndexTitleColor),e.IndexTitleSelectedColor&&(this.IndexTitleSelectedColor=e.IndexTitleSelectedColor),e.OverlayIndexTitleBGColor&&(this.OverlayIndexTitleBGColor=e.OverlayIndexTitleBGColor),e.UpTextColor&&(this.UpTextColor=e.UpTextColor),e.DownTextColor&&(this.DownTextColor=e.DownTextColor),e.UnchagneTextColor&&(this.UnchagneTextColor=e.UnchagneTextColor),e.CloseLineColor&&(this.CloseLineColor=e.CloseLineColor),e.CloseLineAreaColor&&(this.CloseLineAreaColor=e.CloseLineAreaColor),e.CloseLineWidth&&(this.CloseLineWidth=e.CloseLineWidth),e.FrameBorderPen&&(this.FrameBorderPen=e.FrameBorderPen),e.MultiDayBorderPen&&(this.MultiDayBorderPen=e.MultiDayBorderPen),e.FrameSplitPen&&(this.FrameSplitPen=e.FrameSplitPen),e.FrameDotSplitPen&&(this.FrameDotSplitPen=e.FrameDotSplitPen),e.FrameSplitTextColor&&(this.FrameSplitTextColor=e.FrameSplitTextColor),e.FrameSplitTextFont&&(this.FrameSplitTextFont=e.FrameSplitTextFont),e.FrameTitleBGColor&&(this.FrameTitleBGColor=e.FrameTitleBGColor),e.SelFrameBorderColor&&(this.SelFrameBorderColor=e.SelFrameBorderColor),v.IsNumber(e.IndexTitleMerginLeft)&&(this.IndexTitleMerginLeft=e.IndexTitleMerginLeft),e.IndexTitle){var t=e.IndexTitle;if(t.UpDownArrow){var n=t.UpDownArrow;n.UpColor&&(this.IndexTitle.UpDownArrow.UpColor=n.UpColor),n.DownColor&&(this.IndexTitle.UpDownArrow.DownColor=n.DownColor),n.UnchangeColor&&(this.IndexTitle.UpDownArrow.UnchangeColor=n.UnchangeColor)}if(v.IsNumber(t.ArrowType)&&(this.IndexTitle.ArrowType=t.ArrowType),v.IsBool(t.EnableIndexArrow)&&(this.IndexTitle.EnableIndexArrow=t.EnableIndexArrow),t.NameArrow){var n=t.NameArrow;n.Color&&(this.IndexTitle.NameArrow.Color=n.Color),n.Symbol&&(this.IndexTitle.NameArrow.Symbol=n.Symbol),v.IsNumber(n.Space)&&(this.IndexTitle.NameArrow.Space=n.Space)}}if(e.Frame&&(e.Frame.XBottomOffset&&(this.Frame.XBottomOffset=e.Frame.XBottomOffset),e.Frame.YTopOffset&&(this.Frame.YTopOffset=e.Frame.YTopOffset),e.Frame.PercentageText)){var t=e.Frame.PercentageText;t.PriceColor&&(this.Frame.PercentageText.PriceColor=t.PriceColor),t.PercentageColor&&(this.Frame.PercentageText.PercentageColor=t.PercentageColor),t.SplitColor&&(this.Frame.PercentageText.SplitColor=t.SplitColor),t.Font&&(this.Frame.PercentageText.Font=t.Font)}if(v.IsNumber(e.ToolbarButtonStyle)&&(this.ToolbarButtonStyle=e.ToolbarButtonStyle),v.IsBool(e.IsDOMFrameTitle)&&(this.IsDOMFrameTitle=e.IsDOMFrameTitle),e.FrameLatestPrice){var t=e.FrameLatestPrice;e.FrameLatestPrice.TextColor&&(this.FrameLatestPrice.TextColor=e.FrameLatestPrice.TextColor),e.FrameLatestPrice.UpBarColor&&(this.FrameLatestPrice.UpBarColor=e.FrameLatestPrice.UpBarColor),e.FrameLatestPrice.DownBarColor&&(this.FrameLatestPrice.DownBarColor=e.FrameLatestPrice.DownBarColor),e.FrameLatestPrice.UnchagneBarColor&&(this.FrameLatestPrice.UnchagneBarColor=e.FrameLatestPrice.UnchagneBarColor),e.FrameLatestPrice.BGAlpha&&(this.FrameLatestPrice.BGAlpha=e.FrameLatestPrice.BGAlpha),e.FrameLatestPrice.OverlayTextColor&&(this.FrameLatestPrice.OverlayTextColor=e.FrameLatestPrice.OverlayTextColor),t.EmptyBGColor&&(this.FrameLatestPrice.EmptyBGColor=t.EmptyBGColor)}if(e.OverlayFrame){var t=e.OverlayFrame;e.OverlayFrame.BolderPen&&(this.OverlayFrame.BolderPen=e.OverlayFrame.BolderPen),e.OverlayFrame.TitleColor&&(this.OverlayFrame.TitleColor=e.OverlayFrame.TitleColor),e.OverlayFrame.TitleFont&&(this.OverlayFrame.TitleFont=e.OverlayFrame.TitleFont)}if(e.CorssCursorBGColor&&(this.CorssCursorBGColor=e.CorssCursorBGColor),e.CorssCursorTextColor&&(this.CorssCursorTextColor=e.CorssCursorTextColor),e.CorssCursorTextFont&&(this.CorssCursorTextFont=e.CorssCursorTextFont),e.CorssCursorVPenColor&&(this.CorssCursorVPenColor=e.CorssCursorVPenColor),e.CorssCursorHPenColor&&(this.CorssCursorHPenColor=e.CorssCursorHPenColor),e.CorssCursorBorderColor&&(this.CorssCursorBorderColor=e.CorssCursorBorderColor),e.CorssCursorXRangeBGColor&&(this.CorssCursorXRangeBGColor=e.CorssCursorXRangeBGColor),e.CorssCursor&&e.CorssCursor.RightButton){var t=e.CorssCursor.RightButton;t.BGColor&&(this.CorssCursor.RightButton.BGColor=t.BGColor),t.PenColor&&(this.CorssCursor.RightButton.PenColor=t.PenColor),t.Icon&&(this.CorssCursor.RightButton.Icon=t.Icon)}if(e.KLine&&(this.KLine=e.KLine),e.VirtualKLine){var t=e.VirtualKLine;t.Color&&(this.VirtualKLine.Color=t.Color),t.LineDash&&(this.VirtualKLine.LineDash=t.LineDash)}if(e.PriceGapStyple){var t=e.PriceGapStyple;t.Line&&t.Line.Color&&(this.PriceGapStyple.Line.Color=t.Line.Color),t.Text&&(t.Text.Color&&(this.PriceGapStyple.Text.Color=t.Text.Color),t.Text.Font&&(this.PriceGapStyple.Text.Font=t.Text.Font))}if(e.Index&&(e.Index.LineColor&&(this.Index.LineColor=e.Index.LineColor),e.Index.NotSupport&&(this.Index.NotSupport=e.Index.NotSupport)),e.ColorArray&&(this.ColorArray=e.ColorArray),e.DrawPicture){var t=e.DrawPicture;t.LineColor&&(this.DrawPicture.LineColor=t.LineColor),t.PointColor&&(this.DrawPicture.PointColor=t.PointColor),t.XYCoordinate&&(this.DrawPicture.XYCoordinate=t.XYCoordinate),v.IsNumber(t.PointType)&&(this.DrawPicture.PointType=t.PointType),v.IsBool(t.IsShowPoint)&&(this.DrawPicture.IsShowPoint=t.IsShowPoint)}if(e.TooltipPaint&&(e.TooltipPaint.BGColor&&(this.TooltipPaint.BGColor=e.TooltipPaint.BGColor),e.TooltipPaint.BorderColor&&(this.TooltipPaint.BorderColor=e.TooltipPaint.BorderColor),e.TooltipPaint.TitleColor&&(this.TooltipPaint.TitleColor=e.TooltipPaint.TitleColor),e.TooltipPaint.TitleFont&&(this.TooltipPaint.TitleFont=e.TooltipPaint.TitleFont),e.TooltipPaint.DateTimeColor&&(this.TooltipPaint.DateTimeColor=e.TooltipPaint.DateTimeColor),e.TooltipPaint.VolColor&&(this.TooltipPaint.VolColor=e.TooltipPaint.VolColor),e.TooltipPaint.AmountColor&&(this.TooltipPaint.AmountColor=e.TooltipPaint.AmountColor)),e.PCTooltipPaint){var t=e.PCTooltipPaint;t.BGColor&&(this.PCTooltipPaint.BGColor=t.BGColor),t.BorderColor&&(this.PCTooltipPaint.BorderColor=t.BorderColor),t.TitleColor&&(this.PCTooltipPaint.TitleColor=t.TitleColor),t.TitleFont&&(this.PCTooltipPaint.TitleFont=t.TitleFont),t.DateTimeColor&&(this.PCTooltipPaint.DateTimeColor=t.DateTimeColor),t.VolColor&&(this.PCTooltipPaint.VolColor=t.VolColor),t.AmountColor&&(this.PCTooltipPaint.AmountColor=t.AmountColor),t.PositionColor&&(this.PCTooltipPaint.PositionColor=t.PositionColor)}if(e.DialogTooltip){var t=e.DialogTooltip;t.BGColor&&(this.DialogTooltip.BGColor=t.BGColor),t.BorderColor&&(this.DialogTooltip.BorderColor=t.BorderColor),t.TitleColor&&(this.DialogTooltip.TitleColor=t.TitleColor),t.TitleBGColor&&(this.DialogTooltip.TitleBGColor=t.TitleBGColor),t.DateTimeColor&&(this.DialogTooltip.DateTimeColor=t.DateTimeColor),t.VolColor&&(this.DialogTooltip.VolColor=t.VolColor),t.AmountColor&&(this.DialogTooltip.AmountColor=t.AmountColor),t.TurnoverRateColor&&(this.DialogTooltip.TurnoverRateColor=t.TurnoverRateColor),t.PositionColor&&(this.DialogTooltip.PositionColor=t.PositionColor),t.TextColor&&(this.DialogTooltip.TextColor=t.TextColor),t.ValueColor&&(this.DialogTooltip.ValueColor=t.ValueColor)}if(e.FloatTooltip){var t=e.FloatTooltip;t.BGColor&&(this.FloatTooltip.BGColor=t.BGColor),t.BorderColor&&(this.FloatTooltip.BorderColor=t.BorderColor),t.DateTimeColor&&(this.FloatTooltip.DateTimeColor=t.DateTimeColor),t.VolColor&&(this.FloatTooltip.VolColor=t.VolColor),t.AmountColor&&(this.FloatTooltip.AmountColor=t.AmountColor),t.TurnoverRateColor&&(this.FloatTooltip.TurnoverRateColor=t.TurnoverRateColor),t.PositionColor&&(this.FloatTooltip.PositionColor=t.PositionColor),t.TextColor&&(this.FloatTooltip.TextColor=t.TextColor),t.ValueColor&&(this.FloatTooltip.ValueColor=t.ValueColor)}if(e.DialogSelectRect){var t=e.DialogSelectRect;t.BGColor&&(this.DialogSelectRect.BGColor=t.BGColor),t.BorderColor&&(this.DialogSelectRect.BorderColor=t.BorderColor),t.TitleColor&&(this.DialogSelectRect.TitleColor=t.TitleColor),t.TextColor&&(this.DialogSelectRect.TextColor=t.TextColor),t.ValueColor&&(this.DialogSelectRect.ValueColor=t.ValueColor),t.VolColor&&(this.DialogSelectRect.VolColor=t.VolColor),t.AmountColor&&(this.DialogSelectRect.AmountColor=t.AmountColor),t.TurnoverRateColor&&(this.DialogSelectRect.TurnoverRateColor=t.TurnoverRateColor),t.PositionColor&&(this.DialogSelectRect.PositionColor=t.PositionColor)}if(e.DialogPopKeyboard){var t=e.DialogPopKeyboard;if(t.BGColor&&(this.DialogPopKeyboard.BGColor=t.BGColor),t.BorderColor&&(this.DialogPopKeyboard.BorderColor=t.BorderColor),t.TitleColor&&(this.DialogPopKeyboard.TitleColor=t.TitleColor),t.TitleBGColor&&(this.DialogTooltip.TitleBGColor=t.TitleBGColor),t.Input){var n=t.Input;n.BGColor&&(this.DialogPopKeyboard.Input.BGColor=n.BGColor),n.TextColor&&(this.DialogPopKeyboard.Input.TextColor=n.TextColor)}}if(e.DialogSearchIndex){var t=e.DialogSearchIndex;t.BGColor&&(this.DialogSearchIndex.BGColor=t.BGColor),t.BorderColor&&(this.DialogSearchIndex.BorderColor=t.BorderColor),t.TitleColor&&(this.DialogSearchIndex.TitleColor=t.TitleColor),t.TitleBGColor&&(this.DialogSearchIndex.TitleBGColor=t.TitleBGColor),t.IndexNameColor&&(this.DialogSearchIndex.IndexNameColor=t.IndexNameColor),t.GroupNameColor&&(this.DialogSearchIndex.GroupNameColor=t.GroupNameColor),t.InputTextColor&&(this.DialogSearchIndex.InputTextColor=t.InputTextColor)}if(e.MinuteInfo){var t=e.MinuteInfo;e.MinuteInfo.TextColor&&(this.MinuteInfo.TextColor=e.MinuteInfo.TextColor),e.MinuteInfo.Font&&(this.MinuteInfo.Font=e.MinuteInfo.Font),e.MinuteInfo.PointColor&&(this.MinuteInfo.PointColor=e.MinuteInfo.PointColor),e.MinuteInfo.LineColor&&(this.MinuteInfo.LineColor=e.MinuteInfo.LineColor),e.MinuteInfo.TextBGColor&&(this.MinuteInfo.TextBGColor=e.MinuteInfo.TextBGColor),v.IsNumber(t.PointRadius)&&(this.MinuteInfo.PointRadius=t.PointRadius)}if(e.Title&&(e.Title.TradeIndexColor&&(this.Title.TradeIndexColor=e.Title.TradeIndexColor),e.Title.ColorIndexColor&&(this.Title.ColorIndexColor=e.Title.ColorIndexColor),e.Title.VolColor&&(this.Title.VolColor=e.Title.VolColor),e.Title.AmountColor&&(this.Title.AmountColor=e.Title.AmountColor),e.Title.DateTimeColor&&(this.Title.DateTimeColor=e.Title.DateTimeColor),e.Title.NameColor&&(this.Title.NameColor=e.Title.NameColor),e.Title.SettingColor&&(this.Title.SettingColor=e.Title.SettingColor),e.Title.TurnoverRateColor&&(this.Title.TurnoverRateColor=e.Title.TurnoverRateColor),e.Title.PositionColor&&(this.Title.PositionColor=e.Title.PositionColor)),e.DRAWICON){if(e.DRAWICON.Icon){var t=e.DRAWICON.Icon;v.IsPlusNumber(t.MaxSize)&&(this.DRAWICON.Icon.MaxSize=t.MaxSize),v.IsPlusNumber(t.MinSize)&&(this.DRAWICON.Icon.MinSize=t.MinSize),t.Zoom&&(this.DRAWICON.Icon.Zoom=t.Zoom),v.IsNumber(t.YOffset)&&(this.DRAWICON.Icon.YOffset=t.YOffset)}if(e.DRAWICON.Text){var t=e.DRAWICON.Text;v.IsPlusNumber(t.MaxSize)&&(this.DRAWICON.Text.MaxSize=t.MaxSize),v.IsPlusNumber(t.MinSize)&&(this.DRAWICON.Text.MinSize=t.MinSize),t.Zoom&&(this.DRAWICON.Text.Zoom=t.Zoom),t.FontName&&(this.DRAWICON.Text.FontName=t.FontName),v.IsNumber(t.YOffset)&&(this.DRAWICON.Text.YOffset=t.YOffset)}}if(e.DRAWTEXT){var t=e.DRAWTEXT;v.IsPlusNumber(t.MaxSize)&&(this.DRAWICON.MaxSize=t.MaxSize),v.IsPlusNumber(t.MinSize)&&(this.DRAWICON.MinSize=t.MinSize),t.Zoom&&(this.DRAWTEXT.Zoom=t.Zoom),t.FontName&&(this.DRAWTEXT.FontName=t.FontName),v.IsNumber(t.YOffset)&&(this.DRAWTEXT.YOffset=t.YOffset)}if(e.DRAWTEXT_FIX){var t=e.DRAWTEXT_FIX;t.Font&&(this.DRAWTEXT_FIX.Font=t.Font)}if(e.DRAWNUMBER_FIX){var t=e.DRAWNUMBER_FIX;t.Font&&(this.DRAWNUMBER_FIX.Font=t.Font)}if(e.DRAWNUMBER){var t=e.DRAWNUMBER;v.IsPlusNumber(t.MaxSize)&&(this.DRAWNUMBER.MaxSize=t.MaxSize),v.IsPlusNumber(t.MinSize)&&(this.DRAWNUMBER.MinSize=t.MinSize),t.Zoom&&(this.DRAWNUMBER.Zoom=t.Zoom),t.FontName&&(this.DRAWNUMBER.FontName=t.FontName),v.IsNumber(t.YOffset)&&(this.DRAWNUMBER.YOffset=t.YOffset)}if(e.DRAWABOVE){var t=e.DRAWABOVE;v.IsNumber(t.YOffset)&&(this.DRAWABOVE.YOffset=t.YOffset)}if(e.DOTLINE&&(this.DOTLINE=e.DOTLINE),e.DRAWSL&&(this.DOTLINE=e.DRAWSL),e.DragSubFrameBorder&&(this.DragSubFrameBorder=e.DragSubFrameBorder),e.DepthMapPaint){var t=e.DepthMapPaint;t.LineColor&&(this.DepthMapPaint.LineColor=t.LineColor),t.AreaColor&&(this.DepthMapPaint.AreaColor=t.AreaColor),t.TextColor&&(this.DepthMapPaint.TextColor=t.TextColor),t.TextBGColor&&(this.DepthMapPaint.TextBGColor=t.TextBGColor)}if(e.KLineYAxisBGPaint){var t=e.KLineYAxisBGPaint;t.Font&&(this.KLineYAxisBGPaint.Font=t.Font),t.LineColor&&(this.KLineYAxisBGPaint.LineColor=t.LineColor),t.DiffValutTextColor&&(this.KLineYAxisBGPaint.DiffValutTextColor=t.DiffValutTextColor),t.DiffValueBGColor&&(this.KLineYAxisBGPaint.DiffValueBGColor=t.DiffValueBGColor)}if(e.StockChip){var t=e.StockChip;t.InfoColor&&(this.StockChip.InfoColor=t.InfoColor),t.DayInfoColor&&(this.StockChip.DayInfoColor=t.DayInfoColor),t.Font&&(this.StockChip.Font=t.Font),t.DefaultButton&&a(t.DefaultButton,this.StockChip.DefaultButton),t.LongButton&&a(t.LongButton,this.StockChip.LongButton),t.RecentButton&&a(t.RecentButton,this.StockChip.RecentButton)}if(e.DepthChart){var t=e.DepthChart;t.BidColor&&(t.BidColor.Line&&(this.DepthChart.BidColor.Line=t.BidColor.Line),t.BidColor.Area&&(this.DepthChart.BidColor.Area=t.BidColor.Area)),t.AskColor&&(t.AskColor.Line&&(this.DepthChart.AskColor.Line=t.AskColor.Line),t.AskColor.Area&&(this.DepthChart.AskColor.Area=t.AskColor.Area)),t.LineWidth&&(this.DepthChart.LineWidth=t.LineWidth)}if(e.DepthCorss){var t=e.DepthCorss;if(t.BidColor&&t.BidColor.Line&&(this.DepthCorss.BidColor.Line=t.BidColor.Line),t.AskColor&&t.AskColor.Line&&(this.DepthCorss.AskColor.Line=t.AskColor.Line),t.LineWidth&&(this.DepthCorss.LineWidth=t.LineWidth),t.LineDash&&(this.DepthCorss.LineDash=t.LineDash),t.Tooltip){var s=t.Tooltip;s.BGColor&&(this.DepthCorss.Tooltip.BGColor=s.BGColor),s.TextColor&&(this.DepthCorss.Tooltip.TextColor=s.TextColor),s.Font&&(this.DepthCorss.Tooltip.Font=s.Font),s.LineHeight&&(this.DepthCorss.Tooltip.LineHeight=s.LineHeight);var o=s.Border;v.IsNumber(o.Top)&&(this.DepthCorss.Tooltip.Border.Top=o.Top),v.IsNumber(o.Bottom)&&(this.DepthCorss.Tooltip.Border.Bottom=o.Bottom),v.IsNumber(o.Left)&&(this.DepthCorss.Tooltip.Border.Left=o.Left),v.IsNumber(o.Right)&&(this.DepthCorss.Tooltip.Border.Right=o.Right),v.IsNumber(o.ItemSpace)&&(this.DepthCorss.Tooltip.Border.ItemSpace=o.ItemSpace)}}if(e.CIRCLEDOT){var t=e.CIRCLEDOT;v.IsNumber(t.Radius)&&(this.CIRCLEDOT.Radius=t.Radius)}if(e.POINTDOT){var t=e.POINTDOT;v.IsNumber(t.Radius)&&(this.POINTDOT.Radius=t.Radius)}if(e.RectSelect){var t=e.RectSelect;if(t.LineColor&&(this.RectSelect.LineColor=t.LineColor),t.LineWidth>0&&(this.RectSelect.LineWidth=t.LineWidth),t.LineDotted&&(this.RectSelect.LineDotted=t.LineDotted),t.AreaColor&&(this.RectSelect.AreaColor=t.AreaColor),t.SubAreaColor&&(this.RectSelect.SubAreaColor=t.SubAreaColor),t.RangeTextColor&&(this.RectSelect.RangeTextColor=t.RangeTextColor),t.RangeTextFont&&(this.RectSelect.RangeTextFont=t.RangeTextFont),t.RangeTextBGColor&&(this.RectSelect.RangeTextBGColor=t.RangeTextBGColor),t.RangeTextSubColor&&(this.RectSelect.RangeTextSubColor=t.RangeTextSubColor),t.RangeTextSubFont&&(this.RectSelect.RangeTextSubFont=t.RangeTextSubFont),t.RangeTextSubBGColor&&(this.RectSelect.RangeTextSubBGColor=t.RangeTextSubBGColor),t.Mark){var n=t.Mark;n.Family&&(this.RectSelect.Mark.Family=n.Family),n.Text&&(this.RectSelect.Mark.Text=n.Text),n.Color&&(this.RectSelect.Mark.Color=n.Color),v.IsNumber(n.Size)&&(this.RectSelect.Mark.Size=n.Size),n.Position&&(n.Position.Top&&(this.RectSelect.Mark.Position.Top=n.Position.Top),v.IsNumber(n.Position.Index)&&(this.RectSelect.Mark.Position.Index=n.Position.Index))}}if(e.RectDrag){var t=e.RectDrag,r=this.RectDrag;t.LineColor&&(r.LineColor=t.LineColor),v.IsPlusNumber(t.LineWidth)&&(r.LineWidth=t.LineWidth),t.BGColor&&(r.BGColor=t.BGColor)}if(e.OrderFlow&&(t=e.OrderFlow,t.UpColor&&(this.OrderFlow.UpColor=t.UpColor),t.DownColor&&(this.OrderFlow.DownColor=t.DownColor),t.UnchagneColor&&(this.OrderFlow.UnchagneColor=t.UnchagneColor),t.Text&&(this.OrderFlow.Text=t.Text),t.Line&&(this.OrderFlow.Line=t.Line)),e.OrderFlow_Style2&&(t=e.OrderFlow_Style2,t.UpColor&&(this.OrderFlow_Style2.UpColor=t.UpColor),t.DownColor&&(this.OrderFlow_Style2.DownColor=t.DownColor),t.UnchagneColor&&(this.OrderFlow_Style2.UnchagneColor=t.UnchagneColor),v.IsNumber(t.BarWidth)&&(this.OrderFlow_Style2.BarWidth=t.BarWidth)),e.ChartOX){var t=e.ChartOX;t.Family&&(this.ChartOX.Family=t.Family),t.Up&&(this.ChartOX.Up=t.Up),t.Down&&(this.ChartOX.Down=t.Down),t.SquareLineColor&&(this.ChartOX.SquareLineColor=t.SquareLineColor)}if(e.DealList){var t=e.DealList;if(t.BorderColor&&(this.DealList.BorderColor=t.BorderColor),t.UpTextColor&&(this.DealList.UpTextColor=t.UpTextColor),t.DownTextColor&&(this.DealList.DownTextColor=t.DownTextColor),t.UnchagneTextColor&&(this.DealList.UnchagneTextColor=t.UnchagneTextColor),t.CloseLineColor&&(this.DealList.CloseLineColor=t.CloseLineColor),t.Header){var l=t.Header;if(l.Color&&(this.DealList.Header.Color=l.Color),l.Mergin){var h=l.Mergin;v.IsNumber(h.Left)&&(this.DealList.Header.Mergin.Left=h.Left),v.IsNumber(h.Right)&&(this.DealList.Header.Mergin.Left=h.Right),v.IsNumber(h.Top)&&(this.DealList.Header.Mergin.Top=h.Top),v.IsNumber(h.Bottom)&&(this.DealList.Header.Mergin.Bottom=h.Bottom)}if(l.Font){var u=l.Font;u.Name&&(this.DealList.Header.Font.Name=u.Name),v.IsNumber(u.Size)&&(this.DealList.Header.Font.Size=u.Size)}}if(t.Row){var f=t.Row;if(f.Mergin){var h=f.Mergin;v.IsNumber(h.Top)&&(this.DealList.Row.Mergin.Top=h.Top),v.IsNumber(h.Bottom)&&(this.DealList.Row.Mergin.Bottom=h.Bottom)}if(f.Font){var u=f.Font;u.Name&&(this.DealList.Row.Font.Name=u.Name),v.IsNumber(u.Size)&&(this.DealList.Row.Font.Size=u.Size)}if(f.BarMergin){var h=f.BarMergin;v.IsNumber(h.Left)&&(this.DealList.Row.BarMergin.Left=h.Left),v.IsNumber(h.Top)&&(this.DealList.Row.BarMergin.Top=h.Top),v.IsNumber(h.Right)&&(this.DealList.Row.BarMergin.Right=h.Right),v.IsNumber(h.Bottom)&&(this.DealList.Row.BarMergin.Bottom=h.Bottom)}}if(t.FieldColor){var C=t.FieldColor;if(C.Vol&&(this.DealList.FieldColor.Vol=C.Vol),C.Time&&(this.DealList.FieldColor.Time=C.Time),C.Deal&&(this.DealList.FieldColor.Deal=C.Deal),C.Index&&(this.DealList.FieldColor.Index=C.Index),C.BarTitle&&(this.DealList.FieldColor.BarTitle=C.BarTitle),C.Text&&(this.DealList.FieldColor.Text=C.Text),v.IsNonEmptyArray(C.Bar))for(var D=0;D<C.Bar.length;++D)this.DealList.FieldColor.Bar[D]=C.Bar[D]}}if(e.Report&&this.SetReportStyle(e.Report),e.TReport&&this.SetTReportStyle(e.TReport),e.SelectedChart){var t=e.SelectedChart;v.IsNumber(t.LineWidth)&&(this.SelectedChart.LineWidth=t.LineWidth),v.IsNumber(t.Radius)&&(this.SelectedChart.Radius=t.Radius),v.IsNumber(t.MinSpace)&&(this.SelectedChart.MinSpace=t.MinSpace),t.LineColor&&(this.SelectedChart.LineColor=t.LineColor),t.LineColor&&(this.SelectedChart.BGColor=t.BGColor)}if(e.DragMovePaint){var t=e.DragMovePaint;t.TextColor&&(this.DragMovePaint.TextColor=t.TextColor),t.Font&&(this.DragMovePaint.Font=t.Font)}if(e.SessionBreaksPaint){var t=e.SessionBreaksPaint;if(v.IsNonEmptyArray(t.BGColor)&&(this.SessionBreaksPaint.BGColor=t.BGColor.slice()),t.SplitLine){var n=t.SplitLine;n.Color&&(this.SessionBreaksPaint.SplitLine.Color=n.Color),v.IsNumber(n.Width)&&(this.SessionBreaksPaint.SplitLine.Width=n.Width),this.SessionBreaksPaint.SplitLine.Dash=n.Dash}}if(v.IsNumber(e.ToolbarButtonStyle)&&(this.ToolbarButtonStyle=e.ToolbarButtonStyle),e.Buttons){var c=e.Buttons;if(a(c.CloseOverlayIndex,this.Buttons.CloseOverlayIndex),a(c.CloseWindow,this.Buttons.CloseWindow),a(c.ChangeIndex,this.Buttons.ChangeIndex),a(c.OverlayIndex,this.Buttons.OverlayIndex),a(c.ModifyIndexParam,this.Buttons.ModifyIndexParam),a(c.MaxMinWindow,this.Buttons.MaxMinWindow),a(c.TitleWindow,this.Buttons.TitleWindow),a(c.ExportData,this.Buttons.ExportData),c.Tooltip){var t=c.Tooltip,T=this.Buttons.Tooltip;t.Font&&(T.Font=t.Font),t.Color&&(T.Color=t.Color),t.ColorBG&&(T.ColorBG=t.ColorBG),t.ColorBorder&&(T.ColorBorder=t.ColorBorder),t.BorderRadius&&(T.BorderRadius=t.BorderRadius),t.Margin&&(v.IsNumber(t.Margin.Left)&&(T.Margin.Left=t.Margin.Left),v.IsNumber(t.Margin.Top)&&(T.Margin.Top=t.Margin.Top),v.IsNumber(t.Margin.Bottom)&&(T.Margin.Bottom=t.Margin.Bottom),v.IsNumber(t.Margin.Right)&&(T.Margin.Right=t.Margin.Right))}}if(e.ChartDrawVolProfile){var t=e.ChartDrawVolProfile;t.UpVolColor&&(this.ChartDrawVolProfile.UpVolColor=t.UpVolColor),t.DownVolColor&&(this.ChartDrawVolProfile.DownVolColor=t.DownVolColor),t.AreaUpColor&&(this.ChartDrawVolProfile.AreaUpColor=t.AreaUpColor),t.AreaDonwColor&&(this.ChartDrawVolProfile.AreaDonwColor=t.AreaDonwColor),t.BGColor&&(this.ChartDrawVolProfile.BGColor=t.BGColor),t.BorderColor&&(this.ChartDrawVolProfile.BorderColor=t.BorderColor),t.VolLineColor&&(this.ChartDrawVolProfile.VolLineColor=t.VolLineColor),t.Text&&(t.Text.Color&&(this.ChartDrawVolProfile.Text.Color=t.Text.Color),t.Text.Family&&(this.ChartDrawVolProfile.Text.Family=t.Text.Family),v.IsNumber(t.Text.FontMaxSize)&&(this.ChartDrawVolProfile.Text.FontMaxSize=t.Text.FontMaxSize),v.IsNumber(t.Text.FontMinSize)&&(this.ChartDrawVolProfile.Text.FontMinSize=t.Text.FontMinSize))}if(e.DisableLogo===!0&&this.FrameLogo&&(this.FrameLogo.Text=null),e.ScrollBar){var t=e.ScrollBar;if(t.BorderColor&&(this.ScrollBar.BorderColor=t.BorderColor),t.XSplitTextFont&&(this.ScrollBar.XSplitTextFont=t.XSplitTextFont),t.XSplitTextColor&&(this.ScrollBar.XSplitTextColor=t.XSplitTextColor),t.XSplitLineColor&&(this.ScrollBar.XSplitLineColor=t.XSplitLineColor),t.Slider){var n=t.Slider;n.DateFont&&(this.ScrollBar.Slider.DateFont=n.DateFont),n.DateColor&&(this.ScrollBar.Slider.DateColor=n.DateColor),n.BarColor&&(this.ScrollBar.Slider.BarColor=n.BarColor),n.BarAreaColor&&(this.ScrollBar.Slider.BarAreaColor=n.BarAreaColor),v.IsNumber(n.BarWidth)&&(this.ScrollBar.Slider.BarWidth=n.BarWidth),v.IsNumber(n.BarPadding)&&(this.ScrollBar.Slider.BarPadding=n.BarPadding),v.IsNumber(n.MinCenterWidth)&&(this.ScrollBar.Slider.MinCenterWidth=n.MinCenterWidth)}if(t.BGChart){var n=t.BGChart;n.Color&&(this.ScrollBar.BGChart.Color=n.Color),n.AreaColor&&(this.ScrollBar.BGChart.AreaColor=n.AreaColor),v.IsPlusNumber(n.LineWidth)&&(this.ScrollBar.BGChart.LineWidth=n.LineWidth)}}e.FrameButtomToolbar&&this.SetFrameButtomToolbar(e.FrameButtomToolbar),e.Keyboard&&this.SetKeyboardStyle(e.Keyboard)},this.SetKeyboardStyle=function(e){var a=e,r=this.Keyboard;if(a.BorderColor&&(r.BorderColor=a.BorderColor),a.SelectedColor&&(r.SelectedColor=a.SelectedColor),a.TextColor&&(r.TextColor=a.TextColor),a.Item){var t=a.Item;if(t.Mergin){var n=t.Mergin;v.IsNumber(n.Left)&&(r.Item.Mergin.Left=n.Left),v.IsNumber(n.Right)&&(r.Item.Mergin.Right=n.Right),v.IsNumber(n.Top)&&(r.Item.Mergin.Top=n.Top),v.IsNumber(n.Bottom)&&(r.Item.Mergin.Bottom=n.Bottom)}if(t.Font){var s=t.Font;s.Name&&(r.Item.Font.Name=s.Name),v.IsNumber(s.Size)&&(r.Item.Font.Size=s.Size)}if(t.BarMergin){var n=t.BarMergin;v.IsNumber(n.Left)&&(r.Item.BarMergin.Left=n.Left),v.IsNumber(n.Top)&&(r.Item.BarMergin.Top=n.Top),v.IsNumber(n.Right)&&(r.Item.BarMergin.Right=n.Right),v.IsNumber(n.Bottom)&&(r.Item.BarMergin.Bottom=n.Bottom)}if(t.NameFont){var s=t.NameFont;s.Name&&(r.Item.NameFont.Name=s.Name),v.IsNumber(s.Size)&&(r.Item.NameFont.Size=s.Size)}if(t.SymbolFont){var s=t.SymbolFont;s.Name&&(r.Item.SymbolFont.Name=s.Name),v.IsNumber(s.Size)&&(r.Item.SymbolFont.Size=s.Size)}}if(a.VScrollbar){var o=a.VScrollbar;if(v.IsNumber(o.ScrollBarHeight)&&(r.VScrollbar.ScrollBarHeight=o.ScrollBarHeight),o.ButtonColor&&(r.VScrollbar.ButtonColor=o.ButtonColor),o.BarColor&&(r.VScrollbar.BarColor=o.BarColor),o.BorderColor&&(r.VScrollbar.BorderColor=o.BorderColor),o.BGColor&&(r.VScrollbar.BGColor=o.BGColor),o.BarWidth){var l=o.BarWidth;v.IsNumber(l.Size)&&(r.VScrollbar.BarWidth.Size=l.Size)}}},this.SetReportStyle=function(e){var a=e,r=this.Report;if(a.BorderColor&&(this.Report.BorderColor=a.BorderColor),a.UpTextColor&&(this.Report.UpTextColor=a.UpTextColor),a.DownTextColor&&(this.Report.DownTextColor=a.DownTextColor),a.UnchagneTextColor&&(this.Report.UnchagneTextColor=a.UnchagneTextColor),a.BorderColor&&(this.Report.SelectedColor=a.SelectedColor),a.CloseLine){var t=a.CloseLine;t.CloseColor&&(this.Report.CloseLine.CloseColor=t.CloseColor),t.YCloseColor&&(this.Report.CloseLine.YCloseColor=t.YCloseColor),t.AreaColor&&(this.Report.CloseLine.AreaColor=t.AreaColor)}if(a.KLine){var n=a.KLine;n.UpColor&&(this.Report.KLine.UpColor=n.UpColor),n.DownColor&&(this.Report.KLine.DownColor=n.DownColor),n.UnchagneColor&&(this.Report.KLine.UnchagneColor=n.UnchagneColor),v.IsNumber(n.DataWidth)&&(this.Report.KLine.DataWidth=n.DataWidth),v.IsNumber(n.DistanceWidth)&&(this.Report.KLine.DistanceWidth=n.DistanceWidth)}if(a.Header){var s=a.Header;if(s.Color&&(this.Report.Header.Color=s.Color),s.Mergin){var o=s.Mergin;v.IsNumber(o.Left)&&(this.Report.Header.Mergin.Left=o.Left),v.IsNumber(o.Right)&&(this.Report.Header.Mergin.Left=o.Right),v.IsNumber(o.Top)&&(this.Report.Header.Mergin.Top=o.Top),v.IsNumber(o.Bottom)&&(this.Report.Header.Mergin.Bottom=o.Bottom)}if(s.Font){var l=s.Font;l.Name&&(this.Report.Header.Font.Name=l.Name),v.IsNumber(l.Size)&&(this.Report.Header.Font.Size=l.Size)}}if(a.Item){var h=a.Item;if(h.Mergin){var o=h.Mergin;v.IsNumber(o.Left)&&(this.Report.Item.Mergin.Left=o.Left),v.IsNumber(o.Right)&&(this.Report.Item.Mergin.Right=o.Right),v.IsNumber(o.Top)&&(this.Report.Item.Mergin.Top=o.Top),v.IsNumber(o.Bottom)&&(this.Report.Item.Mergin.Bottom=o.Bottom)}if(h.Font){var l=h.Font;l.Name&&(this.Report.Item.Font.Name=l.Name),v.IsNumber(l.Size)&&(this.Report.Item.Font.Size=l.Size)}if(h.BarMergin){var o=h.BarMergin;v.IsNumber(o.Left)&&(this.Report.Item.BarMergin.Left=o.Left),v.IsNumber(o.Top)&&(this.Report.Item.BarMergin.Top=o.Top),v.IsNumber(o.Right)&&(this.Report.Item.BarMergin.Right=o.Right),v.IsNumber(o.Bottom)&&(this.Report.Item.BarMergin.Bottom=o.Bottom)}if(h.NameFont){var l=h.NameFont;l.Name&&(this.Report.Item.NameFont.Name=l.Name),v.IsNumber(l.Size)&&(this.Report.Item.NameFont.Size=l.Size)}if(h.SymbolFont){var l=h.SymbolFont;l.Name&&(this.Report.Item.SymbolFont.Name=l.Name),v.IsNumber(l.Size)&&(this.Report.Item.SymbolFont.Size=l.Size)}}if(a.FixedItem){var h=a.FixedItem;if(h.Font){var l=h.Font;l.Name&&(this.Report.FixedItem.Font.Name=l.Name),v.IsNumber(l.Size)&&(this.Report.FixedItem.Font.Size=l.Size)}}if(a.LimitBorder){var u=a.LimitBorder;if(u.Color&&(this.Report.LimitBorder.Color=u.Color),u.Mergin){var o=u.Mergin;v.IsNumber(o.Left)&&(this.Report.LimitBorder.Mergin.Left=o.Left),v.IsNumber(o.Top)&&(this.Report.LimitBorder.Mergin.Top=o.Top),v.IsNumber(o.Right)&&(this.Report.LimitBorder.Mergin.Right=o.Right),v.IsNumber(o.Bottom)&&(this.Report.LimitBorder.Mergin.Bottom=o.Bottom)}}if(a.LimitColor){var u=a.LimitColor;u.UpColor&&(this.Report.LimitColor.UpColor=u.UpColor),u.DownColor&&(this.Report.LimitColor.DownColor=u.DownColor),u.TextColor&&(this.Report.LimitColor.UpColor=u.TextColor)}if(a.FieldColor){var f=a.FieldColor;if(f.Name&&(this.Report.FieldColor.Name=f.Name),f.Symbol&&(this.Report.FieldColor.Symbol=f.Symbol),f.Vol&&(this.Report.FieldColor.Vol=f.Vol),f.Amount&&(this.Report.FieldColor.Amount=f.Amount),f.Index&&(this.Report.FieldColor.Index=f.Index),f.BarTitle&&(this.Report.FieldColor.BarTitle=f.BarTitle),f.Text&&(this.Report.FieldColor.Text=f.Text),v.IsNonEmptyArray(f.Bar))for(var C=0;C<f.Bar.length;++C)this.Report.FieldColor.Bar[C]=f.Bar[C]}if(a.NameSymbolV2){var D=a.NameSymbolV2;if(D.Name){var c=D.Name;v.IsNumber(c.Size)&&(this.Report.NameSymbolV2.Name.Size=c.Size),c.Name&&(this.Report.NameSymbolV2.Name.Name=c.Name),c.Color&&(this.Report.NameSymbolV2.Name.Color=c.Color)}if(D.Symbol){var c=D.Symbol;v.IsNumber(c.Size)&&(this.Report.NameSymbolV2.Symbol.Size=c.Size),c.Name&&(this.Report.NameSymbolV2.Symbol.Name=c.Name),c.Color&&(this.Report.NameSymbolV2.Symbol.Color=c.Color)}}if(a.Tab){var T=a.Tab;if(T.Font){var l=T.Font;l.Name&&(this.Report.Tab.Font.Name=l.Name),v.IsNumber(l.Size)&&(this.Report.Tab.Font.Size=l.Size)}v.IsNumber(T.ScrollBarWidth)&&(this.Report.Tab.ScrollBarWidth=T.ScrollBarWidth),T.ButtonColor&&(this.Report.Tab.ButtonColor=T.ButtonColor),T.BarColor&&(this.Report.Tab.BarColor=T.BarColor),T.BorderColor&&(this.Report.Tab.BorderColor=T.BorderColor),T.TabTitleColor&&(this.Report.Tab.TabTitleColor=T.TabTitleColor),T.TabSelectedTitleColor&&(this.Report.Tab.TabSelectedTitleColor=T.TabSelectedTitleColor),T.TabSelectedBGColor&&(this.Report.Tab.TabSelectedBGColor=T.TabSelectedBGColor),T.TabMoveOnTitleColor&&(this.Report.Tab.TabMoveOnTitleColor=T.TabMoveOnTitleColor),T.TabBGColor&&(this.Report.Tab.TabBGColor=T.TabBGColor)}if(a.PageInfo){var S=a.PageInfo;if(S.Font){var l=S.Font;l.Name&&(this.Report.PageInfo.Font.Name=l.Name),v.IsNumber(l.Size)&&(this.Report.PageInfo.Font.Size=l.Size)}if(S.TextColor&&(this.Report.PageInfo.TextColor=S.TextColor),S.BGColor&&(this.Report.PageInfo.BGColor=S.BGColor),S.Mergin){var o=S.Mergin;v.IsNumber(o.Left)&&(this.Report.PageInfo.Mergin.Left=o.Left),v.IsNumber(o.Top)&&(this.Report.PageInfo.Mergin.Top=o.Top),v.IsNumber(o.Right)&&(this.Report.PageInfo.Mergin.Right=o.Right),v.IsNumber(o.Bottom)&&(this.Report.PageInfo.Mergin.Bottom=o.Bottom)}}if(a.DragRow){var I=a.DragRow;I.Color&&(this.Report.DragRow.Color=I.Color),I.TextColor&&(this.Report.DragRow.TextColor=I.TextColor),I.MoveRowColor&&(this.Report.DragRow.MoveRowColor=I.MoveRowColor),I.SrcRowColor&&(this.Report.DragRow.SrcRowColor=I.SrcRowColor)}if(a.VScrollbar){var c=a.VScrollbar;v.IsNumber(c.ScrollBarHeight)&&(r.VScrollbar.ScrollBarHeight=c.ScrollBarHeight),c.ButtonColor&&(r.VScrollbar.ButtonColor=c.ButtonColor),c.BarColor&&(r.VScrollbar.BarColor=c.BarColor),c.BorderColor&&(r.VScrollbar.BorderColor=c.BorderColor),c.BGColor&&(r.VScrollbar.BGColor=c.BGColor)}if(a.CheckBox){var c=a.CheckBox;if(c.Family&&(r.CheckBox.Family=c.Family),v.IsNumber(c.Size)&&(r.CheckBox.Size=c.Size),c.Checked){var g=c.Checked;g.Color&&(r.CheckBox.Checked.Color=g.Color),g.Symbol&&(r.CheckBox.Checked.Symbol=g.Symbol),g.DisableColor&&(r.CheckBox.Checked.DisableColor=g.DisableColor)}if(c.Unchecked){var g=c.Unchecked;g.Color&&(r.CheckBox.Unchecked.Color=g.Color),g.Symbol&&(r.CheckBox.Unchecked.Symbol=g.Symbol),g.DisableColor&&(r.CheckBox.Unchecked.DisableColor=g.DisableColor)}wa(r.CheckBox.Margin,c.Margin)}if(a.Link){var c=a.Link;c.Font&&(r.Link.Font=c.Font),c.TextColor&&(r.Link.TextColor=c.TextColor),c.Disable&&c.Disable.TextColor&&(r.Link.Disable.TextColor=c.Disable.TextColor),c.MouseOn&&c.MouseOn.TextColor&&(r.Link.MouseOn.TextColor=c.MouseOn.TextColor)}if(a.ProgressBar){var c=a.ProgressBar;c.BGColor&&(r.ProgressBar.BGColor=c.BGColor),c.BarColor&&(r.ProgressBar.BarColor=c.BarColor),c.TextColor&&(r.ProgressBar.TextColor=c.TextColor),c.Font&&(r.ProgressBar.Font=c.Font),c.Disable&&(c.Disable.BGColor&&(r.ProgressBar.Disable.BGColor=c.Disable.BGColor),c.Disable.BarColor&&(r.ProgressBar.Disable.BarColor=c.Disable.BarColor),c.Disable.TextColor&&(r.ProgressBar.Disable.TextColor=c.Disable.TextColor)),wa(r.ProgressBar.Margin,c.Margin),wa(r.ProgressBar.BarMargin,c.BarMargin),wa(r.ProgressBar.TextMargin,c.TextMargin)}if(a.Buttom){var c=a.Buttom;c.BGColor&&(r.Buttom.BGColor=c.BGColor),c.TextColor&&(r.Buttom.TextColor=c.TextColor),c.BorderColor&&(r.Buttom.BorderColor=c.BorderColor),c.Font&&(r.Buttom.Font=c.Font),c.Disable&&(c.Disable.BGColor&&(r.Buttom.Disable.BGColor=c.Disable.BGColor),c.Disable.TextColor&&(r.Buttom.Disable.TextColor=c.Disable.TextColor)),c.MouseOn&&(c.MouseOn.BGColor&&(r.Buttom.MouseOn.BGColor=c.MouseOn.BGColor),c.MouseOn.TextColor&&(r.Buttom.MouseOn.TextColor=c.MouseOn.TextColor)),wa(r.Buttom.Margin,c.Margin),wa(r.Buttom.TextMargin,c.TextMargin)}},this.SetTReportStyle=function(e){var a=e,r=this.TReport;if(a.BorderColor&&(r.BorderColor=a.BorderColor),a.UpTextColor&&(r.UpTextColor=a.UpTextColor),a.DownTextColor&&(r.DownTextColor=a.DownTextColor),a.UnchangeTextColor&&(r.UnchangeTextColor=a.UnchangeTextColor),a.BorderColor&&(r.SelectedColor=a.SelectedColor),a.UpBGColor&&(r.UpBGColor=a.UpBGColor),a.DownBGColor&&(r.DownBGColor=a.DownBGColor),a.Header){var t=a.Header;if(t.Color&&(r.Header.Color=t.Color),t.SortColor&&(r.Header.SortColor=t.SortColor),t.Mergin){var n=t.Mergin;v.IsNumber(n.Left)&&(r.Header.Mergin.Left=n.Left),v.IsNumber(n.Right)&&(r.Header.Mergin.Left=n.Right),v.IsNumber(n.Top)&&(r.Header.Mergin.Top=n.Top),v.IsNumber(n.Bottom)&&(r.Header.Mergin.Bottom=n.Bottom)}if(t.Font){var s=t.Font;s.Name&&(r.Header.Font.Name=s.Name),v.IsNumber(s.Size)&&(r.Header.Font.Size=s.Size)}}if(a.CenterItem){var o=a.CenterItem;o.TextColor&&(r.CenterItem.TextColor=o.TextColor),o.BaseTextColor&&(r.CenterItem.BaseTextColor=o.BaseTextColor),o.BGColor&&(r.CenterItem.BGColor=o.BGColor)}if(a.Item){var l=a.Item;if(l.Mergin){var n=l.Mergin;v.IsNumber(n.Left)&&(r.Item.Mergin.Left=n.Left),v.IsNumber(n.Right)&&(r.Item.Mergin.Right=n.Right),v.IsNumber(n.Top)&&(r.Item.Mergin.Top=n.Top),v.IsNumber(n.Bottom)&&(r.Item.Mergin.Bottom=n.Bottom)}if(l.Font){var s=l.Font;s.Name&&(r.Item.Font.Name=s.Name),v.IsNumber(s.Size)&&(r.Item.Font.Size=s.Size)}if(l.NameFont){var s=l.NameFont;s.Name&&(r.Item.NameFont.Name=s.Name),v.IsNumber(s.Size)&&(r.Item.NameFont.Size=s.Size)}if(l.SymbolFont){var s=l.SymbolFont;s.Name&&(r.Item.SymbolFont.Name=s.Name),v.IsNumber(s.Size)&&(r.Item.SymbolFont.Size=s.Size)}}if(a.FieldColor){var h=a.FieldColor;h.Name&&(r.FieldColor.Name=h.Name),h.Symbol&&(r.FieldColor.Symbol=h.Symbol),h.Vol&&(r.FieldColor.Vol=h.Vol),h.Amount&&(r.FieldColor.Amount=h.Amount),h.Index&&(r.FieldColor.Index=h.Index),h.Text&&(r.FieldColor.Text=h.Text),h.Position&&(r.FieldColor.Position=h.Position)}if(a.MarkBorder){var u=a.MarkBorder;u.MaxPositionColor&&(r.MarkBorder.MaxPositionColor=u.MaxPositionColor)}if(a.FixedItem){var u=a.FixedItem;if(u.Font){var s=u.Font;s.Name&&(r.FixedItem.Font.Name=s.Name),v.IsNumber(s.Size)&&(r.FixedItem.Font.Size=s.Size)}}},this.SetFrameButtomToolbar=function(e){var a=this.FrameButtomToolbar;if(e.BGColor&&(a.BGColor=e.BGColor),e.BorderColor&&(a.BorderColor=e.BorderColor),e.Button){var r=e.Button;if(r.BorderColor&&(a.Button.BorderColor=r.BorderColor),r.Font){var t=r.Font,n=this.FrameButtomToolbar.Button.Font;t.Family&&(n.Family=t.Family),v.IsNumber(t.Size)&&(n.Size=t.Size)}if(r.TitleColor){var t=r.TitleColor,n=this.FrameButtomToolbar.Button.TitleColor;t.Selected&&(n.Selected=t.Selected),t.Default&&(n.Default=t.Default),t.MoveOn&&(n.MoveOn=t.MoveOn)}if(r.BGColor){var t=r.BGColor,n=this.FrameButtomToolbar.Button.BGColor;t.Selected&&(n.Selected=t.Selected),t.Default&&(n.Default=t.Default),t.MoveOn&&(n.MoveOn=t.MoveOn)}if(r.Mergin){var t=r.Mergin,n=this.FrameButtomToolbar.Button.Mergin;v.IsNumber(t.Left)&&(n.Left=t.Left),v.IsNumber(t.Right)&&(n.Left=t.Right),v.IsNumber(t.Top)&&(n.Top=t.Top),v.IsNumber(t.Bottom)&&(n.Bottom=t.Bottom)}if(r.SVG){var t=r.SVG,n=this.FrameButtomToolbar.Button.SVG;v.IsNumber(t.Size)&&(n.Size=t.Size),v.IsNumber(t.MerginLeft)&&(n.MerginLeft=t.MerginLeft),t.Family&&(n.Family=t.Family)}}}}var d=new dD,xe={LANGUAGE_CHINESE_ID:0,LANGUAGE_ENGLISH_ID:1,LANGUAGE_TRADITIONAL_CHINESE_ID:2};function gm(){this.TextResource=new Dt.default([["Tooltip-Open",{CN:"开:",EN:"O:",TC:"開"}],["Tooltip-High",{CN:"高:",EN:"H:",TC:"高"}],["Tooltip-Low",{CN:"低:",EN:"L:",TC:"低"}],["Tooltip-Close",{CN:"收:",EN:"C:",TC:"收"}],["Tooltip-Increase",{CN:"幅:",EN:"I:",TC:"幅"}],["Tooltip-Vol",{CN:"量:",EN:"V:",TC:"量"}],["Tooltip-Amount",{CN:"额:",EN:"A:",TC:"額"}],["Tooltip-AvPrice",{CN:"均:",EN:"AP:",TC:"均"}],["Tooltip-Price",{CN:"价:",EN:"P:",TC:"價"}],["Tooltip-Exchange",{CN:"换:",EN:"E:",TC:"換"}],["Tooltip-Position",{CN:"持:",EN:"P:",TC:"持"}],["DivTooltip-Open",{CN:"开盘:",EN:"Open:",TC:"開盤"}],["DivTooltip-High",{CN:"最高:",EN:"High:",TC:"最高"}],["DivTooltip-Low",{CN:"最低:",EN:"Low:",TC:"最低"}],["DivTooltip-Close",{CN:"收盘:",EN:"Close:",TC:"收盤"}],["DivTooltip-Increase",{CN:"涨幅:",EN:"Increase:",TC:"漲幅"}],["DivTooltip-Vol",{CN:"数量:",EN:"Volume:",TC:"數量"}],["DivTooltip-Amount",{CN:"金额:",EN:"Amount:",TC:"金額"}],["DivTooltip-Exchange",{CN:"换手:",EN:"Exchange:",TC:"換手"}],["DivTooltip-Position",{CN:"持仓:",EN:"Position:",TC:"持倉"}],["DivTooltip-Price",{CN:"价格:",EN:"Price:",TC:"價格"}],["DialogTooltip-Date",{CN:"日期",EN:"Date",TC:"日期"}],["DialogTooltip-Time",{CN:"时间",EN:"Time",TC:"時間"}],["DialogTooltip-Open",{CN:"开盘价",EN:"Open",TC:"開盤價"}],["DialogTooltip-High",{CN:"最高价",EN:"High",TC:"最高價"}],["DialogTooltip-Low",{CN:"最低价",EN:"Low",TC:"最低價"}],["DialogTooltip-Close",{CN:"收盘价",EN:"Close",TC:"收盤價"}],["DialogTooltip-Increase",{CN:"涨幅",EN:"Increase",TC:"漲幅"}],["DialogTooltip-Risefall",{CN:"涨跌",EN:"Risefall",TC:"漲跌"}],["DialogTooltip-Vol",{CN:"成交量",EN:"Volume",TC:"數量"}],["DialogTooltip-Amount",{CN:"成交额",EN:"Amount",TC:"金額"}],["DialogTooltip-Exchange",{CN:"换手率",EN:"Exchange",TC:"換手"}],["DialogTooltip-Position",{CN:"持仓量",EN:"Position",TC:"持倉"}],["DialogTooltip-Price",{CN:"价格",EN:"Price",TC:"價格"}],["DialogTooltip-AvPrice",{CN:"均价",EN:"AVPrice:",TC:"均價"}],["DialogTooltip-FClose",{CN:"结算价",EN:"Settlement",TC:"結算價"}],["DialogTooltip-Amplitude",{CN:"振幅",EN:"amplitude",TC:"振幅"}],["DialogTooltip-AC-Price",{CN:"匹配价",EN:"Price",TC:"匹配價"}],["DialogTooltip-AC-AvPrice",{CN:"匹配均价",EN:"AVPrice",TC:"匹配均價"}],["DialogTooltip-AC-Increase",{CN:"竞价涨幅",EN:"Increase",TC:"競價漲幅"}],["DialogTooltip-AC-Vol",{CN:"匹配量",EN:"Vol",TC:"匹配量"}],["DialogTooltip-Value",{CN:"数值",EN:"Value",TC:"数值"}],["FloatTooltip-Date",{CN:"日期",EN:"Date",TC:"日期"}],["FloatTooltip-Time",{CN:"时间",EN:"Time",TC:"時間"}],["FloatTooltip-Open",{CN:"开盘价",EN:"Open",TC:"開盤價"}],["FloatTooltip-High",{CN:"最高价",EN:"High",TC:"最高價"}],["FloatTooltip-Low",{CN:"最低价",EN:"Low",TC:"最低價"}],["FloatTooltip-Close",{CN:"收盘价",EN:"Close",TC:"收盤價"}],["FloatTooltip-YClose",{CN:"昨收价",EN:"YClose",TC:"昨收價"}],["FloatTooltip-Increase",{CN:"涨幅",EN:"Increase",TC:"漲幅"}],["FloatTooltip-Risefall",{CN:"涨跌",EN:"Risefall",TC:"漲跌"}],["FloatTooltip-Vol",{CN:"成交量",EN:"Volume",TC:"數量"}],["FloatTooltip-Amount",{CN:"成交额",EN:"Amount",TC:"金額"}],["FloatTooltip-Exchange",{CN:"换手率",EN:"Exchange",TC:"換手"}],["FloatTooltip-Position",{CN:"持仓量",EN:"Position",TC:"持倉"}],["FloatTooltip-Price",{CN:"价格",EN:"Price",TC:"價格"}],["FloatTooltip-AvPrice",{CN:"均价",EN:"AVPrice:",TC:"均價"}],["FloatTooltip-FClose",{CN:"结算价",EN:"Settlement",TC:"結算價"}],["FloatTooltip-YSettlePrice",{CN:"昨结算",EN:"YSettlement",TC:"昨結算"}],["FloatTooltip-Amplitude",{CN:"振幅",EN:"amplitude",TC:"振幅"}],["DialogSelectRect-StartPrice",{CN:"起始价:",EN:"Start Price:",TC:"起始價"}],["DialogSelectRect-EndPrice",{CN:"最终价:",EN:"End Price:",TC:"最终價"}],["DialogSelectRect-High",{CN:"最高价:",EN:"High:",TC:"最高價"}],["DialogSelectRect-Low",{CN:"最低价:",EN:"Low:",TC:"最低價"}],["DialogSelectRect-Increase",{CN:"区间涨幅:",EN:"Increase",TC:"漲幅"}],["DialogSelectRect-Amplitude",{CN:"区间振幅:",EN:"amplitude",TC:"振幅"}],["DialogSelectRect-Vol",{CN:"成交量:",EN:"Volume",TC:"數量"}],["DialogSelectRect-Amount",{CN:"成交额:",EN:"Amount",TC:"金額"}],["DialogSelectRect-Up",{CN:"阳线:",EN:"Up",TC:"阳线"}],["DialogSelectRect-Down",{CN:"阴线:",EN:"Down",TC:"阴线"}],["DialogSelectRect-Unchanged",{CN:"平线:",EN:"Unchanged",TC:"平线"}],["DialogSelectRect-DataCount",{CN:"数据个数:",EN:"Data Count:",TC:"数据个数"}],["PCTooltip-Date",{CN:"日期",EN:"Date",TC:"日期"}],["PCTooltip-Time",{CN:"时间",EN:"Time",TC:"時間"}],["PCTooltip-Price",{CN:"价格",EN:"Price:",TC:"價格"}],["PCTooltip-AvPrice",{CN:"均价",EN:"AVPrice:",TC:"均價"}],["PCTooltip-Increase",{CN:"涨幅",EN:"Increase:",TC:"漲幅"}],["PCTooltip-Vol",{CN:"成交量",EN:"Volume:",TC:"成交量"}],["PCTooltip-Amount",{CN:"成交额",EN:"Amount:",TC:"成交額"}],["PCTooltip-Position",{CN:"持仓量",EN:"Position:",TC:"持倉"}],["PCTooltip-AC-Price",{CN:"匹配价:",EN:"Price:",TC:"匹配價"}],["PCTooltip-AC-Increase",{CN:"竞价涨幅:",EN:"Increase:",TC:"競價漲幅"}],["PCTooltip-AC-Vol",{CN:"匹配量:",EN:"V:",TC:"匹配量"}],["PCTooltip-AC-NotMatchVol",{CN:"未匹配量:",EN:"NV:",TC:"未匹配量"}],["KTitle-Open",{CN:"开:",EN:"O:",TC:"開"}],["KTitle-High",{CN:"高:",EN:"H:",TC:"高"}],["KTitle-Low",{CN:"低:",EN:"L:",TC:"低"}],["KTitle-Close",{CN:"收:",EN:"C:",TC:"收"}],["KTitle-Increase",{CN:"幅:",EN:"I:",TC:"幅"}],["KTitle-Vol",{CN:"量:",EN:"V:",TC:"量"}],["KTitle-Amount",{CN:"额:",EN:"A:",TC:"額"}],["KTitle-Exchange",{CN:"换:",EN:"E:",TC:"換"}],["KTitle-Position",{CN:"持:",EN:"P:",TC:"持"}],["KTitle-Price",{CN:"价:",EN:"Price:",TC:"價"}],["MTitle-AC-Price",{CN:"匹配价:",EN:"C:",TC:"匹配價"}],["MTitle-AC-AvPrice",{CN:"匹配均价:",EN:"C:",TC:"匹配均價"}],["MTitle-AC-Increase",{CN:"竞价涨幅:",EN:"I:",TC:"競價漲幅"}],["MTitle-AC-Vol",{CN:"匹配量:",EN:"V:",TC:"匹配量"}],["MTitle-AC-NotMatchVol",{CN:"未匹配量:",EN:"NV:",TC:"未匹配量"}],["MTitle-AC-Amount",{CN:"匹配量金额:",EN:"A:",TC:"匹配量金额"}],["MTitle-AC-NotMatchAmount",{CN:"未匹配量金额:",EN:"NA:",TC:"未匹配量金额"}],["MTitle-Close",{CN:"价:",EN:"C:",TC:"價"}],["MTitle-AvPrice",{CN:"均:",EN:"AC:",TC:"均"}],["MTitle-Increase",{CN:"幅:",EN:"I:",TC:"幅"}],["MTitle-Vol",{CN:"量:",EN:"V:",TC:"量"}],["MTitle-Amount",{CN:"额:",EN:"A:",TC:"額"}],["MTitle-Position",{CN:"持:",EN:"P:",TC:"持"}],["MTitle-UpdateTime",{CN:"更新:",EN:"Update:",TC:"更新:"}],["日线",{CN:"日线",EN:"1D",TC:"日綫"}],["周线",{CN:"周线",EN:"1W",TC:"周綫"}],["双周",{CN:"双周",EN:"2W",TC:"雙周"}],["月线",{CN:"月线",EN:"1M",TC:"月綫"}],["半年",{CN:"半年",EN:"HY",TC:"半年"}],["年线",{CN:"年线",EN:"1Y",TC:"年綫"}],["1分",{CN:"1分",EN:"1Min",TC:"1分"}],["5分",{CN:"5分",EN:"5Min",TC:"5分"}],["15分",{CN:"15分",EN:"15Min",TC:"15分"}],["30分",{CN:"30分",EN:"30Min",TC:"30分"}],["60分",{CN:"60分",EN:"60Min",TC:"60分"}],["季线",{CN:"季线",EN:"1Q",TC:"季綫"}],["分笔",{CN:"分笔",EN:"Tick",TC:"分筆"}],["2小时",{CN:"2小时",EN:"2H",TC:"2小時"}],["4小时",{CN:"4小时",EN:"4H",TC:"4小時"}],["不复权",{CN:"不复权",EN:"No Right",TC:"不復權"}],["前复权",{CN:"前复权",EN:"Pro Right",TC:"前復權"}],["后复权",{CN:"后复权",EN:"Post Right",TC:"后復權"}],["日",{CN:"日",EN:"Sun.",TC:"日"}],["一",{CN:"一",EN:"Mon.",TC:"壹"}],["二",{CN:"二",EN:"Tues.",TC:"貳"}],["三",{CN:"三",EN:"Wed.",TC:"叁"}],["四",{CN:"四",EN:"Thur.",TC:"肆"}],["五",{CN:"五",EN:"Fri.",TC:"伍"}],["六",{CN:"六",EN:"Sat.",TC:"陸"}],["1月",{CN:"1月",EN:"Jan",TC:"1月"}],["2月",{CN:"2月",EN:"Feb",TC:"2月"}],["3月",{CN:"3月",EN:"Mar",TC:"3月"}],["4月",{CN:"4月",EN:"Apr",TC:"4月"}],["5月",{CN:"5月",EN:"May",TC:"5月"}],["6月",{CN:"6月",EN:"Jun",TC:"6月"}],["7月",{CN:"7月",EN:"Jul",TC:"7月"}],["8月",{CN:"8月",EN:"Aug",TC:"8月"}],["9月",{CN:"9月",EN:"Sept",TC:"9月"}],["10月",{CN:"10月",EN:"Oct",TC:"10月"}],["11月",{CN:"11月",EN:"Nov",TC:"11月"}],["12月",{CN:"12月",EN:"Dec",TC:"12月"}],["自定义分钟",{CN:"分",EN:"Min",TC:"分"}],["自定义日线",{CN:"日",EN:"D",TC:"日"}],["自定义秒",{CN:"秒",EN:"S",TC:"秒"}],["自定义毫秒",{CN:"毫秒",EN:"MS",TC:"毫秒"}],["MVol-Vol",{CN:"成交量",EN:"Volume",TC:"成交量"}],["MVol-Position",{CN:"持仓量",EN:"Position",TC:"持倉量"}],["Depth-Price",{CN:"委托价",EN:"Price",TC:"委托價"}],["Depth-Sum",{CN:"累计",EN:"Sum",TC:"累計"}],["Toolbar-"+Rt.MODIFY_INDEX_PARAM,{CN:"调整指标参数",EN:"Change indicator parameters",TC:"调整指标参数"}],["Toolbar-"+Rt.CHANGE_INDEX,{CN:"选择指标",EN:"Change indicator",TC:"切换指标"}],["Toolbar-"+Rt.CLOSE_INDEX_WINDOW,{CN:"关闭窗口",EN:"Delete window",TC:"关闭指标窗口"}],["Toolbar-"+Rt.OVERLAY_INDEX,{CN:"叠加指标",EN:"Overlay indicator",TC:"叠加指标"}],["Toolbar-"+Rt.MODIFY_OVERLAY_INDEX_PARAM,{CN:"调整叠加指标参数",EN:"Change overlay indicator parameters",TC:"调整叠加指标参数"}],["Toolbar-"+Rt.MAX_MIN_WINDOW,{CN:"最大化",EN:"Maximize",TC:"最大化"}],["Toolbar-"+Rt.TITLE_WINDOW,{CN:"折叠窗口",EN:"Collapse window",TC:"折叠窗口"}],["Toolbar-"+Rt.EXPORT_DATA,{CN:"数据导出",EN:"Export data",TC:"数据导出"}],["Toolbar-"+Rt.CLOSE_BEFOREOPEN_ID,{CN:"关闭集合竞价",EN:"Close call auction",TC:"关闭集合竞价"}],["Toolbar-"+Rt.CLOSE_OVERLAY_INDEX,{CN:"关闭叠加指标",EN:"Delte overlay indicator",TC:"关闭叠加指标"}],["Toolbar-"+Rt.CHIP_RECENT,{CN:"近期成本分布",EN:"Recent chip",TC:"近期成本分布"}],["Toolbar-"+Rt.CHIP_LONG,{CN:"远期成本分布",EN:"Long chip",TC:"远期成本分布"}],["Toolbar-"+Rt.CHIP_DEFULT,{CN:"默认筹码分布",EN:"Default chip",TC:"默认筹码分布"}],["Toolbar-"+Rt.DRAW_PICTURE_DELETE,{CN:"删除",EN:"Delete",TC:"删除"}],["Toolbar-"+Rt.DRAW_PICTURE_SETTING,{CN:"设置",EN:"Setting",TC:"设置"}],["日盘",{CN:"日盘",EN:"Day",TC:"日盤"}],["夜盘",{CN:"夜盘",EN:"Night",TC:"夜盤"}]]),this.GetText=function(e,a){var r=this.TextResource.get(e);if(!r)return"";switch(a){case xe.LANGUAGE_CHINESE_ID:return r.CN;case xe.LANGUAGE_ENGLISH_ID:return r.EN;case xe.LANGUAGE_TRADITIONAL_CHINESE_ID:return r.TC;default:return r.CN}},this.SetTextResource=function(e,a){this.TextResource.set(e,a)},this.GetLanguageID=function(e){var a=null;switch(e){case"EN":a=xe.LANGUAGE_ENGLISH_ID;break;case"CN":a=xe.LANGUAGE_CHINESE_ID;break;case"TC":a=xe.LANGUAGE_TRADITIONAL_CHINESE_ID;break}return a},this.GetLanguageName=function(e){switch(e){case xe.LANGUAGE_ENGLISH_ID:return"EN";case xe.LANGUAGE_CHINESE_ID:return"CN";case xe.LANGUAGE_TRADITIONAL_CHINESE_ID:return"TC";default:return null}}}var St=new gm;function $a(){}$a.Get=function(e){var a=new Dt.default([["CJL",{IsMainIndex:!1,Create:function(){return new ym}}],["OX",{IsMainIndex:!1,Create:function(){return new Nm}}],["可视范围成交量分布图",{IsMainIndex:!0,Create:function(t){return new Am(t)}}]]);return a.get(e)};function pm(){this.DataMap=new Dt.default([["RenkoCalculate",{Create:function(){return new mD}}],["HeikinAshiCalculate",{Create:function(){return new xm}}],["LineBreakCalcuate",{Create:function(){return new Fm}}],["KagiCalculate",{Create:function(){return new Em}}]]),this.Create=function(e){if(!this.DataMap.has(e))return null;var a=this.DataMap.get(e);return a.Create()}}var ID=new pm;function mD(){this.BrickSize=.05,this.SourceData,this.LastData,this.ATR={Count:14,BrickSize:.05},this.BrickSizeType=1,this.Symbol,this.FloatPrecision=2,this.ClassName="RenkoCalculate",this.SetOption=function(e){if(e&&(v.IsNumber(e.BrickSize)&&(this.BrickSize=e.BrickSize),v.IsNumber(e.BrickSizeType)&&(this.BrickSizeType=e.BrickSizeType),e.ATR)){var a=e.ATR;v.IsNumber(a.Count)&&(this.ATR.Count=a.Count)}},this.CalculateByClose=function(e){var a=new Y;if(a.Data=[],a.Right=e.Right,a.Period=e.Period,a.DataType=e.DataType,a.Symbol=e.symbol,!v.IsNonEmptyArray(e.Data))return a;var r=this.BrickSize;this.BrickSizeType==1&&(r=this.ATR.BrickSize);var t=e.Data[0];this.LastData=Pt.Copy(t);for(var n=1;n<e.Data.length;){var t=e.Data[n],s=t.Close-this.LastData.Close,o=t.Close-this.LastData.Open;if(Math.abs(s)>=r&&Math.abs(o)>=r){var l=0;if(s>0||o>0){var h=this.LastData.Close,u=Math.max(this.LastData.Close,this.LastData.Open),f=u+r,C=f,D=u;l=t.Vol}else{var h=this.LastData.Close,u=Math.min(this.LastData.Close,this.LastData.Open),f=u-r,C=u,D=f;l=t.Vol}var c=new Pt;c.Date=t.Date,c.Time=t.Time,c.YClose=h,c.Open=u,c.High=C,c.Low=D,c.Close=f,c.Vol=this.LastData.Vol+l,a.Data.push(c),this.LastData.YClose=c.YClose,this.LastData.Open=c.Open,this.LastData.High=c.High,this.LastData.Low=c.Low,this.LastData.Close=c.Close,this.LastData.Date=c.Date,this.LastData.Time=c.Time,this.LastData.Vol=0}else this.LastData.Vol+=t.Vol,++n}return a},this.RecvHistoryData=function(e,a){return this.Symbol=a.Symbol,this.SourceData=e,this.FloatPrecision=jt(this.Symbol),this.BrickSizeType==1&&this.CalculateATR(),this.CalculateByClose(e)},this.Clear=function(){this.SourceData=null,this.LastData=null,this.Symbol=null},this.GetTitle=function(){if(this.BrickSizeType==1)var e="Renko [ATR("+this.ATR.Count+"), "+this.ATR.BrickSize+"]";else var e="Renko [Traditional, "+this.BrickSize+"]";return e},this.CalculateATR=function(){if(v.IsNonEmptyArray(this.SourceData.Data)){for(var e=this.SourceData.Data,a=e.length,r=[],t=a-1,n=0;t>=0&&n<this.ATR.Count;--t,++n){var s=e[t],h=Math.max(s.High-s.Low,s.High-s.Close,s.Close-s.Low);r.push(h)}for(var o=0,t=0;t<r.length;++t)o+=r[t];var l=o/r.length,h=l.toFixed(this.FloatPrecision);this.ATR.BrickSize=parseFloat(h)}}}function Em(){this.newMethod=mD,this.newMethod(),delete this.newMethod,this.ClassName="KagiCalculate",this.BrickSizeType=0,this.BrickSize=.5,this.RecvHistoryData=function(e,a){return this.Symbol=a.Symbol,this.SourceData=e,this.FloatPrecision=jt(this.Symbol),this.BrickSizeType==1&&this.CalculateATR(),this.CalculateByClose(e)},this.CalculateByClose=function(e){var a=new Y;if(a.Data=[],a.Right=e.Right,a.Period=e.Period,a.DataType=e.DataType,a.Symbol=e.symbol,!v.IsNonEmptyArray(e.Data))return a;var r=this.BrickSize;this.BrickSizeType==1&&(r=this.ATR.BrickSize);var t=e.Data[0],n=Pt.Copy(t);n.High=n.Low=t.Close,n.StartItem=t,n.Direction=0;for(var s=1;s<e.Data.length;++s){var t=e.Data[s];if(t.Close>n.Close){n.Direction=1,n.Close=t.Close,n.EndItem=t,n.High=t.Close;break}else if(t.Close<n.Close){n.Direction=2,n.Close=t.Close,n.EndItem=t,n.Low=t.Close;break}}var o=null;for(++s;s<e.Data.length;++s){var t=e.Data[s];if(n.Direction==1){if(t.Close>=n.High)n.Close=t.Close,n.High=t.Close,n.EndItem=t,o=null;else if(o?(o.Close=t.Close,o.Low>t.Close&&(o.Low=t.Close)):(o=Pt.Copy(t),o.High=o.Low=t.Close),Math.abs(o.Low-n.High)>r){a.Data.push(n);var l=Pt.Copy(t);l.High=n.High,l.Low=t.Close,l.Direction=2,l.StartItem=t,n=l,o=null}}else if(n.Direction==2){if(t.Close<=n.Low)n.Close=t.Close,n.Low=t.Close,n.EndItem=t;else if(o?(o.Close=t.Close,o.High<t.Close&&(o.High=t.Close)):(o=Pt.Copy(t),o.High=o.Low=t.Close),Math.abs(o.High-n.Low)>r){a.Data.push(n);var l=Pt.Copy(t);l.High=t.Close,l.Low=n.Low,l.Direction=1,l.StartItem=t,n=l,o=null}}}return a},this.GetTitle=function(){if(this.BrickSizeType==1)var e="Kagi [ATR("+this.ATR.Count+"), "+this.ATR.BrickSize+"]";else var e="Kagi [Traditional]";return e}}function xm(){this.SourceData,this.Symbol,this.FloatPrecision=2,this.ClassName="HeikinAshiCalculate",this.Clear=function(){this.SourceData=null,this.LastData=null,this.Symbol=null},this.RecvHistoryData=function(e,a){return this.Symbol=a.Symbol,this.SourceData=e,this.FloatPrecision=jt(this.Symbol),this.Calculate(e)},this.GetTitle=function(){return"Heikin Ashi"},this.Calculate=function(e){var a=new Y;if(a.Data=[],a.Right=e.Right,a.Period=e.Period,a.DataType=e.DataType,a.Symbol=e.symbol,!v.IsNonEmptyArray(e.Data))return a;for(var r=null,t=null,n=0;n<e.Data.length;++n){var s=e.Data[n],o=Pt.Copy(s);r?(o.Close=(s.Close+s.Open+s.High+s.Low)/4,o.Open=(r.Close+r.Open)/2,o.YClose=t,o.High=Math.max(o.Close,o.Open,s.High),o.Low=Math.min(o.Close,o.Open,s.Low),t=o.Close):(o.Open=(s.Close+s.Open)/2,o.Close=(s.Close+s.Open+s.High+s.Low)/4,t=o.Close),r=s,a.Data.push(o)}return a}}function Fm(){this.SourceData,this.Symbol,this.FloatPrecision=2,this.LineCount=3,this.ClassName="LineBreakCalcuate",this.Clear=function(){this.SourceData=null,this.LastData=null,this.Symbol=null},this.GetTitle=function(){return"Line Break ["+this.LineCount+"]"},this.RecvHistoryData=function(e,a){return this.Symbol=a.Symbol,this.SourceData=e,this.FloatPrecision=jt(this.Symbol),this.CalculateByClose(e)},this.CalculatePreviousKLine=function(e){for(var a=0;a<e.Data.length;++a){var r=e.Data[a];a==0?(e.High=r.High,e.Low=r.Low):(e.High<r.High&&(e.High=r.High),e.Low<r.Low&&(e.Low=r.Low)),e.Date=r.Date,e.Time=r.Time,e.Vol+=r.Vol,e.Amount+=r.Amount}},this.CalculateByClose=function(e){var a=new Y;if(a.Data=[],a.Right=e.Right,a.Period=e.Period,a.DataType=e.DataType,a.Symbol=e.symbol,!v.IsNonEmptyArray(e.Data))return a;for(var r=0,t={High:null,Low:null,Date:null,Time:null,Direction:0};r<e.Data.length&&r<this.LineCount;++r){var n=e.Data[r];s==0?(t.High=n.High,t.Low=n.Low):(t.High<n.High&&(t.High=n.High),t.Low>n.Low&&(t.Low=n.Low)),t.Date=n.Date,t.Time=n.Time,t.Vol+=n.Vol,t.Amount+=n.Amount}for(var s=r;s<e.Data.length;++s){var n=e.Data[s];if(n.Close>t.High){var o=new Pt;o.YClose=t.Low,o.Open=t.High,o.Close=n.Close,o.Low=Math.min(o.Open,o.Close),o.High=Math.max(o.Open,o.Close),o.Date=n.Date,o.Time=n.Time,o.Vol=n.Vol,o.Amount=n.Amount,o.Direction=1,a.Data.push(o),t=o}else if(n.Close<t.Low){var o=new Pt;o.YClose=t.High,o.Open=t.Low,o.Close=n.Close,o.Low=Math.min(o.Open,o.Close),o.High=Math.max(o.Open,o.Close),o.Date=n.Date,o.Time=n.Time,o.Vol=n.Vol,o.Amount=n.Amount,o.Direction=2,a.Data.push(o),t=o}else t&&(t.Direction==1||t.Direction==2,t.Vol+=n.Vol,t.Amount+=n.Amount)}return a}}function de(e,a,r){this.newMethod=Kh,this.newMethod(e,a,r),delete this.newMethod,this.ClassName="KLineChartContainer",this.WindowIndex=new Array,this.ColorIndex,this.TradeIndex,this.Symbol,this.Name,this.Period=0,this.IsApiPeriod=!1,this.Right=0,this.RightFormula=0,this.SourceData,this.MaxRequestDataCount=3e3,this.MaxRequestMinuteDayCount=5,this.PageSize=200,this.KLineDrawType=0,this.ScriptErrorCallback,this.FlowCapitalReady=!1,this.EnableFlowCapital={},this.EnableZoomUpDown=null,this.ChartDrawStorage=new TD,this.ChartDrawStorageCache=null,this.RightSpaceCount=0,this.SourceDataLimit=new Dt.default,this.CtrlMoveStep=5,this.CustomShow=null,this.ZoomType=0,this.IsZoomLockRight=!1,this.KLineSize=null,this.Page={Day:{Enable:!1,Index:0,Finish:!1},Minute:{Enable:!1,Index:0,Finish:!1}},this.DragDownload={Day:{Enable:!1,IsEnd:!1,Status:0},Minute:{Enable:!1,IsEnd:!1,Status:0},Tick:{Enable:!1,IsEnd:!1,Status:0}},this.ZoomDownload={Day:{Enable:!1,IsEnd:!1,Status:0},Minute:{Enable:!1,IsEnd:!1,Status:0},Tick:{Enable:!1,IsEnd:!1,Status:0}},this.IsAutoUpdate=!1,this.AutoUpdateFrequency=3e4,this.AutoUpdateTimer,this.KLineApiUrl=d.Domain+"/API/KLine2",this.MinuteKLineApiUrl=d.Domain+"/API/KLine3",this.DragMinuteKLineApiUrl=d.Domain+"/API/KLine4",this.DragKLineApiUrl=d.Domain+"/API/KLine5",this.ZoomMinuteKLineApiUrl=d.Domain+"/API/KLine4",this.ZoomKLineApiUrl=d.Domain+"/API/KLine5",this.RealtimeApiUrl=d.Domain+"/API/Stock",this.KLineMatchUrl=d.Domain+"/API/KLineMatch",this.StockHistoryDayApiUrl=d.Domain+"/API/StockHistoryDay",this.TickApiUrl=d.Domain+"/API/StockDetail",this.PopMinuteChart=null,this.BeforeBindMainData=null,this.AfterBindMainData=null,this.KLineCalculate=null,this.KLineCalcOption=new Dt.default,this.ScrollBar=null,this.IsAutoSyncDataOffset=!0,this.GetKLineCalulate=function(){var t=this.GetKLineDrawType(),n;if(t==10)n="RenkoCalculate";else if(t==11)n="HeikinAshiCalculate";else if(t==12)n="LineBreakCalcuate";else if(t==16)n="KagiCalculate";else return null;if((!this.KLineCalculate||this.KLineCalculate.ClassName!=n)&&(this.KLineCalculate=ID.Create(n),this.KLineCalculate.SetOption&&this.KLineCalcOption.has(n))){var s=this.KLineCalcOption.get(n);this.KLineCalculate.SetOption(s)}return this.KLineCalculate},this.SetKLineCalcOption=function(t,n){this.KLineCalcOption.set(t,n),this.KLineCalculate&&this.KLineCalculate.ClassName==t&&this.KLineCalculate.SetOption&&this.KLineCalculate.SetOption(n)},this.ClearKLineCaluate=function(){this.KLineCalculate&&this.KLineCalculate.Clear&&this.KLineCalculate.Clear()},this.ResetDragDownload=function(){this.DragDownload.Day.Status=0,this.DragDownload.Day.IsEnd=!1,this.DragDownload.Minute.Status=0,this.DragDownload.Minute.IsEnd=!1,this.DragDownload.Tick.Status=0,this.DragDownload.Tick.IsEnd=!1},this.ResetZoomDownload=function(){this.ZoomDownload.Day.Status=0,this.ZoomDownload.Day.IsEnd=!1,this.ZoomDownload.Minute.Status=0,this.ZoomDownload.Minute.IsEnd=!1,this.ZoomDownload.Tick.Status=0,this.ZoomDownload.Tick.IsEnd=!1},this.ResetPage=function(){this.Page.Day.Finish=!1,this.Page.Day.Index=0,this.Page.Minute.Finish=!1,this.Page.Minute.Index=0},this.AddCustomKLine=function(t,n){var s=this.ChartPaint[0];if(s&&t){if(s.CustomKLine||(s.CustomKLine=new Dt.default),Array.isArray(t))for(var o=0;o<t.length;++o){var l=t[o];s.CustomKLine.set(l.Key,l.Data)}else t&&s.CustomKLine.set(t.Key,t.Data);n&&n.Draw==!0&&this.Draw()}},this.ClearCustomKLine=function(t){var n=this.ChartPaint[0];n&&(n.ClearCustomKLine(),t&&t.Draw==!0&&this.Draw())},this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::StopAutoUpdate"),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.SandTableOperator=function(t){switch(t.ID){case 1:this.StopAutoUpdate(),t.Data&&this.ManualUpdateKData(t);break;case 2:this.ManualUpdateKData(t);break;case 3:t.IsAutoUpdate&&(this.IsAutoUpdate=t.IsAutoUpdate),this.ChangeSymbol(this.Symbol);break}},this.ManualUpdateKData=function(t){var n=t.Data,s=n.length,o=new Y;o.Data=n,o.Period=this.Period,o.Right=this.Right,o.Symbol=this.Symbol,this.UpdateMainData(o,s),this.BindInstructionIndexData(o);for(var l=0;l<this.Frame.SubFrame.length;++l)this.BindIndexData(l,o);if(v.IsNumber(t.DataOffset)&&t.DataOffset>=0){var h=null;this.Frame.Data?h=this.Frame.Data:h=this.Frame.SubFrame[0].Frame.Data,h&&(h.DataOffset=t.DataOffset)}this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendManualKLineUpdateEvent(o)},this.GetKDataInfo=function(){if(!this.ChartPaint[0])return null;var t=this.ChartPaint[0],n={};return t.Data&&t.Data.Data&&(n.Data=t.Data.CloneData("HistoryData")),n.ShowRange=t.ShowRange,n.Period=this.Period,n.RightSpaceCount=this.RightSpaceCount,n},this.ChartOperator=function(t){var n=t.ID;if(n===ve.OP_SCROLL_LEFT||n===ve.OP_SCROLL_RIGHT){var s=n===ve.OP_SCROLL_LEFT,o=1;t.Step>0&&(o=t.Step);var l=this.GetMoveOneStepWidth();this.DataMove(o*l,s)?(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()):n===ve.OP_SCROLL_RIGHT&&this.DragDownloadData&&this.DragDownloadData()}else if(n===ve.OP_ZOOM_IN||n===ve.OP_ZOOM_OUT){var h={};if(h.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),n===ve.OP_ZOOM_IN){if(!this.Frame.ZoomUp(h))return}else if(!this.Frame.ZoomDown(h))return;this.CursorIndex=h.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXSplit(),this.Draw()}else if(n===ve.OP_GOTO_HOME){var u=this.ChartOperator_Temp_GetHistroyData();if(!u)return;var f=this.Frame.SubFrame[0].Frame.XPointCount;f-=this.RightSpaceCount;var C=u.Data.length-f;u.DataOffset=C,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,k.Chart.Log("[KLineChartContainer::ChartOperator] OP_GOTO_HOME, dataOffset="+u.DataOffset+" CursorIndex="+this.CursorIndex+" PageSize="+f),this.ChartOperator_Temp_Update()}else if(n===ve.OP_GOTO_END){var u=this.ChartOperator_Temp_GetHistroyData();if(!u)return;u.DataOffset=0,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,k.Chart.Log("[KLineChartContainer::ChartOperator] OP_GOTO_END "),this.ChartOperator_Temp_Update()}else if(n==ve.OP_LEFT_ZOOM_IN||n==ve.OP_LEFT_ZOOM_OUT){var u=this.ChartOperator_Temp_GetHistroyData();if(!u)return;var D=u.Data.length,f=this.Frame.SubFrame[0].Frame.XPointCount,c=u.DataOffset;if(n==ve.OP_LEFT_ZOOM_IN){if(v.IsNumber(t.Step)){if(f>=D)return;var o=t.Step;if(o>c&&(o=c),f+o>D&&(o=D-f),o<=0)return;f+=o,u.DataOffset-=o}}else if(n==ve.OP_LEFT_ZOOM_OUT){var T=this.GetMaxMinPageSize(),S=T.Min;if(v.IsNumber(t.Step)){if(f<S)return;var o=t.Step;if(f-o<S&&(o=f-S),o<=0)return;f-=o,u.DataOffset+=o}}for(var I in this.Frame.SubFrame){var g=this.Frame.SubFrame[I].Frame;g.XPointCount=f}u.DataOffset<0&&(u.DataOffset=0),this.ChartOperator_Temp_Update()}else if(n==ve.OP_RIGHT_ZOOM_IN||n==ve.OP_RIGHT_ZOOM_OUT){var u=this.ChartOperator_Temp_GetHistroyData();if(!u)return;var D=u.Data.length,f=this.Frame.SubFrame[0].Frame.XPointCount,c=u.DataOffset;if(n==ve.OP_RIGHT_ZOOM_IN){if(v.IsNumber(t.Step)){if(f>=D)return;var E=c+f,F=D-E;if(F<=0)return;var o=t.Step;if(o>F&&(o=F),o<=0)return;f+=o}}else if(n==ve.OP_RIGHT_ZOOM_OUT){var T=this.GetMaxMinPageSize(),S=T.Min;if(v.IsNumber(t.Step)){if(f<S)return;var o=t.Step;if(o>f&&(o=f),f-o<S&&(o=f-S),o<=0)return;f-=o}}for(var I in this.Frame.SubFrame){var g=this.Frame.SubFrame[I].Frame;g.XPointCount=f}u.DataOffset<0&&(u.DataOffset=0),this.ChartOperator_Temp_Update()}else if(n==ve.OP_SET_SELECTRECT){if(!this.ChartPaint[0]||!this.ChartPaint[0].Data)return!1;var u=this.ChartOperator_Temp_GetHistroyData();if(!v.IsNonEmptyArray(u.Data))return!1;var R=this.GetRectSelectPaint();if(!R||!Y.IsDayPeriod(this.Period,!0))return!1;for(var A,P,p,w,I=0;I<u.Data.length;++I){var g=u.Data[I];if(g.Date==t.Start.Date&&(A={KItem:g,DataIndex:I}),g.Date==t.End.Date&&(P={KItem:g,DataIndex:I}),t.SubClient&&t.SubClient.Start&&g.Date==t.SubClient.Start.Date&&(p={KItem:g,DataIndex:I}),t.SubClient&&t.SubClient.End&&g.Date==t.SubClient.End.Date&&(w={KItem:g,DataIndex:I}),A&&P)break}if(!A||!P)return k.Chart.Warn("[KLineChartContainer::ChartOperator][OP_SET_SELECTRECT] can't find date. firstPoint, secondPoint, obj",A,P,t),!1;R.SetPoint(A.KItem,{Index:0,DataIndex:A.DataIndex}),R.SetPoint(P.KItem,{Index:1,DataIndex:P.DataIndex}),p&&w&&(R.SetPoint(p.KItem,{Index:3,DataIndex:p.DataIndex}),R.SetPoint(w.KItem,{Index:4,DataIndex:w.DataIndex})),v.IsBool(t.PreventClose)&&(R.PreventClose=t.PreventClose);var H=!1,W=this.ChartPaint[0].DrawKRange;if(W&&(W.Start>=A.DataIndex&&W.Start>=P.DataIndex||W.End<=A.DataIndex&&W.End<=P.DataIndex)){var ht=A.DataIndex,D=u.Data.length,f=this.ChartPaint[0].ShowRange.ShowCount;ht+f>D&&(ht=D-f),ht<0&&(ht=0),u.DataOffset=ht,H=!0}return H?this.ChartOperator_Temp_Update():this.Draw(),!0}else if(n==ve.OP_SET_SUB_SELECTRECT){if(!this.ChartPaint[0]||!this.ChartPaint[0].Data)return!1;var u=this.ChartOperator_Temp_GetHistroyData();if(!v.IsNonEmptyArray(u.Data))return!1;var R=this.GetRectSelectPaint();if(!R||!Y.IsDayPeriod(this.Period,!0))return!1;for(var A,P,p,w,I=0;I<u.Data.length;++I){var g=u.Data[I];if(g.Date==t.Start.Date&&(A={KItem:g,DataIndex:I}),g.Date==t.End.Date&&(P={KItem:g,DataIndex:I}),A&&P)break}return!A||!P?(k.Chart.Warn("[KLineChartContainer::ChartOperator][OP_SET_SUB_SELECTRECT] can't find date. firstPoint, secondPoint, obj",A,P,t),!1):(R.SetPoint(A.KItem,{Index:3,DataIndex:A.DataIndex}),R.SetPoint(P.KItem,{Index:4,DataIndex:P.DataIndex}),this.Draw(),!0)}else if(n==ve.OP_SCROOLBAR_SLIDER_CHANGED){var u=this.ChartOperator_Temp_GetHistroyData();if(!u)return;if(t.Type==0)u.DataOffset=t.Start.Index,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,this.ChartOperator_Temp_Update();else if(t.Type==1||t.Type==2){t.Start.Index;var f=t.End.Index-t.Start.Index+1,rt=u.Data[t.Start.Index];u.Data[t.End.Index],this.Frame.SetXShowCount(f),u.DataOffset=t.Start.Index,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,this.ChartOperator_Temp_Update()}}else if(n==ve.OP_GOTO){if(!v.IsNumber(t.Date))return;var u=this.ChartOperator_Temp_GetHistroyData();if(!u)return;var C=this.ChartOperator_GetIndex_ByDateTime(u,t,this.Period,0);if(C===null){k.Chart.Log("[KLineChartContainer::ChartOperator] OP_GOTO can't find date="+t.Date+" time="+t.Time);return}var nt=this.Frame.SubFrame[0].Frame.XPointCount,vt=nt;t.PageSize>0&&(vt=t.PageSize),vt!=nt&&this.Frame.SetXShowCount(vt),u.DataOffset=C,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,this.ChartOperator_Temp_Update()}else if(n==ve.OP_GOTO_BY_DATAINDEX){if(!v.IsNumber(t.DataIndex))return;var u=this.ChartOperator_Temp_GetHistroyData();if(!u)return;if(t.DataIndex<0||t.DataIndex>=u.Data.length){k.Chart.Log("[KLineChartContainer::ChartOperator] OP_GOTO_BY_DATAINDEX obj.DataIndex="+t.DataIndex+" error.}");return}var nt=this.Frame.SubFrame[0].Frame.XPointCount,vt=nt;t.PageSize>0&&(vt=t.PageSize),vt!=nt&&this.Frame.SetXShowCount(vt),u.DataOffset=t.DataIndex,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,this.ChartOperator_Temp_Update()}else if(n==ve.OP_CORSSCURSOR_GOTO){if(!v.IsNumber(t.Date))return;var Nt=v.IsNumber(t.Time),Ft=this.GetChartStatus();if(!Ft)return;var u=this.ChartOperator_Temp_GetHistroyData();if(!u)return;for(var rt=u.DataOffset,Bt=-1,I=rt,Jt=0;I<u.Data.length&&Jt<Ft.KLine.PageSize;++I,++Jt){var g=u.Data[I];if(Nt){if(g.Date==t.Date&&g.Time==t.Time){Bt=Jt;break}}else if(g.Date==t.Date){Bt=Jt;break}}if(Bt<0)return;if(!this.Frame||!this.Frame.SubFrame[0]||!this.Frame.SubFrame[0].Frame)return!1;var te=this.Frame.SubFrame[0].Frame,Me=te.GetXFromIndex(Bt),we=te.GetYFromData(g.Close),Oa={X:Me,Y:we,IsInClient:this.IsMouseOnClient(Me,we)};this.LastMouseStatus.OnMouseMove=Oa,this.LastMouseStatus.MoveOnPoint={X:Me,Y:we};var It=this.GetEventCallback($.ON_MOUSE_MOVE),bt=this.TitlePaint[0];It&&bt&&(bt.OnMouseMoveEvent=It);var xt=B(),qt={};qt.clientX=Me/xt+this.UIElement.getBoundingClientRect().left,qt.clientY=we/xt+this.UIElement.getBoundingClientRect().top,this.MoveOnPoint={X:Me,Y:we},this.OnMouseMove(Me,we,qt),this.LastMouseStatus.MoveOnPoint=null,bt&&(bt.OnMouseMoveEvent=null)}},this.ChartOperator_Temp_GetHistroyData=function(){var t=null;return this.Frame.Data?t=this.Frame.SubFrame[0].Frame.Data:t=this.Frame.Data,t||null},this.ChartOperator_Temp_Update=function(){this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.ResetFrameXSplit(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex()},this.ChartOperator_GetIndex_ByDateTime=function(t,n,s,o){if(!t||!v.IsNonEmptyArray(t.Data)||!v.IsPlusNumber(n.Date)||n.Date<19810101)return null;if(Y.IsDayPeriod(s,!0)){for(var l=0;l<t.Data.length;++l){var h=t.Data[l];if(o==1){if(h.Date==n.Date)return l}else if(h.Date>=n.Date)return l}return null}if(Y.IsMinutePeriod(s,!0)||Y.IsMilliSecondPeriod(s)){var u=null;v.IsNumber(n.Time)&&(u=n.Time);for(var l=0;l<t.Data.length;++l){var h=t.Data[l];if(o==1){if(u==null)return null;if(h.Date==n.Date&&h.Time==u)return l}else if(u==null){if(h.Date>=n.Date)return l}else if(h.Date>n.Date||h.Date==n.Date&&h.Time>=u)return l}return null}return null},this.OnWheel=function(t){var n=this;if(k.Chart.Log("[KLineChartContainer::OnWheel]",t),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var s=B(),o=(t.clientX-this.UIElement.getBoundingClientRect().left)*s,l=(t.clientY-this.UIElement.getBoundingClientRect().top)*s,h=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),h=this.Canvas.isPointInPath(o,l),v.IsNumber(t.deltaY)){var u=t.deltaY*s;if(Math.abs(u)<90)return}var f=t.wheelDelta;v.IsObjectExist(t.wheelDelta)||(f=t.deltaY*-.01);var C=!0;if(this.EnableZoomUpDown&&this.EnableZoomUpDown.Wheel===!1&&(C=!1),this.SourceData&&this.SourceData.Data){if(h&&f<0&&C){var D={ZoomType:this.ZoomType,IsLockRight:this.IsZoomLockRight};D.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),t.ctrlKey&&(D.ZoomType=1),this.Frame.ZoomDown(D,{ZoomDownloadDataCallback:function(T){n.ZoomDownloadData(T)}})&&(this.CursorIndex=D.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXSplit(),this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0||this.Draw(),this.OnKLinePageChange("wheel"))}else if(h&&f>0&&C){var D={ZoomType:this.ZoomType,IsLockRight:this.IsZoomLockRight};D.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),t.ctrlKey&&(D.ZoomType=1),this.Frame.ZoomUp(D)&&(k.Chart.Log("[KLineChartContainer::OnWheel] cursorIndex ",D),this.CursorIndex=D.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.ResetFrameXSplit(),this.Draw(),this.OnKLinePageChange("wheel"))}}!h&&!this.OnWheel_ZoomUpDownFrameY(t,o,l)||(t.preventDefault?t.preventDefault():t.returnValue=!1)}},this.OnWheel_ZoomUpDownFrameY=function(t,n,s){if(!this.EnableYDrag.Wheel)return!1;var o=this.TryYDrag(n,s);if(!o||!(o.Left&&!o.IsOverlay||o.Right))return!1;var l=t.wheelDelta;v.IsObjectExist(t.wheelDelta)||(l=t.deltaY*-.01);var h=this.EnableYDrag.WheelYMove;return l>0&&(h*=-1),o.Position=0,this.Frame.OnZoomUpDownFrameY(o,h)?(this.Frame.SetSizeChage(!0),this.Draw(),!0):!1},this.Create=function(t,n){var s=this;this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new Bn,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=Je.Create("CorssCursor_XStringFormat"),this.ChartCorssCursor.StringFormatX.GetEventCallback=function(C){return s.GetEventCallback(C)},this.ChartCorssCursor.StringFormatX.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY=Je.Create("CorssCursor_YStringFormat"),this.ChartCorssCursor.StringFormatY.GetEventCallback=function(C){return s.GetEventCallback(C)},this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY.ExtendChartPaint=this.ExtendChartPaint,this.ChartCorssCursor.GetEventCallback=function(C){return s.GetEventCallback(C)},this.ChartCorssCursor.OnChangeStatusCallback=function(C,D){s.OnChangeCorssCursorStatus(C,D)},this.ChartSplashPaint=new Li,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.HQChart=this,this.Frame=new Qh,this.Frame.ChartBorder=new ra,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.Frame.GetExtendChartRightWidth=function(){return s.GetExtendChartRightWidth()},this.Frame.GetExtendChartByClassName=function(C){return s.GetExtendChartByClassName(C)},this.Frame.GetEventCallback=function(C){return s.GetEventCallback(C)},this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(t),this.CreateMainKLine(),this.CreateExtendChart("RectSelectPaint",n?n.SelectRect:null),this.EnableIndexChartDrag&&this.CreateExtendChart("DragMovePaint"),this.CreateDragSelectRect(n?n.DragSelectRect:null);for(var o in this.Frame.SubFrame){var l=new Qa;l.Frame=this.Frame.SubFrame[o].Frame,l.Canvas=this.Canvas,l.LanguageID=this.LanguageID,l.GetEventCallback=function(C){return s.GetEventCallback(C)},l.SelectedChart=this.SelectedChart,this.TitlePaint.push(l)}this.ChartCorssCursor.StringFormatX.Frame=this.Frame.SubFrame[0].Frame,this.ChartCorssCursor.StringFormatY.Frame=this.Frame;var h=!0,u=!0;if(n&&n.Listener){var f=n.Listener;f.KeyDown===!1&&(h=!1,k.Chart.Log("[KLineChartContainer::Create] not register keydown event.")),f.Wheel===!1&&(u=!1,k.Chart.Log("[KLineChartContainer::Create] not register wheel event."))}h&&this.UIElement.addEventListener("keydown",function(C){s.OnKeyDown(C)},!0),u&&this.UIElement.addEventListener("wheel",function(C){s.OnWheel(C)},!0),this.InitalPopMinuteChart(n)},this.InitalPopMinuteChart=function(t){if(!t)return!1;if(t.PopMinuteChart&&t.PopMinuteChart.Enable){var n=t.PopMinuteChart;return this.PopMinuteChart=new Sn,this.PopMinuteChart.Inital(this,n),!0}else if(t.KLine&&t.KLine.KLineDoubleClick===!0)return this.PopMinuteChart=new Sn,this.PopMinuteChart.Inital(this),!0;return!1},this.DestroyPopMinuteChart=function(){this.PopMinuteChart&&(this.PopMinuteChart.Destroy(),this.PopMinuteChart=null)},this.ShowMinuteChartDialog=function(t,n,s){if(this.PopMinuteChart&&!(!t.Tooltip||!t.Chart)){var o=B(),l=this.UIElement.getBoundingClientRect(),h=Da();n+=l.left+h.Left,s+=l.top+h.Top;var u=t.Tooltip.Data.Date,f=t.Chart.Symbol;this.PopMinuteChart.Show({Date:u,Symbol:f,Data:t.Tooltip.Data},n/o,s/o)}},this.OnCustomKeyDown=function(t,n){return t==37&&n.ctrlKey?(this.MoveCorssCursorLeft(this.CtrlMoveStep),!0):t==39&&n.ctrlKey?(this.MoveCorssCursorRight(this.CtrlMoveStep),!0):!1},this.MoveCorssCursorLeft=function(t){var n=null;if(this.Frame.Data?n=this.Frame.Data:n=this.Frame.SubFrame[0].Frame.Data,!!n){if(n.DataOffset<=0&&this.CursorIndex<=0){this.DragDownloadData&&this.DragDownloadData();return}if(this.CursorIndex-t<0){n.DataOffset-=t,n.DataOffset<0&&(n.DataOffset=0,this.CursorIndex=0),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("keydown");return}this.CursorIndex-=t,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo(),this.ShowTooltipByKeyDown()}},this.MoveCorssCursorRight=function(t){var n=null;if(this.Frame.Data?n=this.Frame.Data:n=this.Frame.SubFrame[0].Frame.Data,!!n){var s=0;if(this.Frame.XPointCount?s=this.Frame.XPointCount:s=this.Frame.SubFrame[0].Frame.XPointCount,!(this.CursorIndex+n.DataOffset+1>=n.Data.length)){var o=!1;if(this.CursorIndex+t+n.DataOffset+1>n.Data.length&&(t=n.Data.length-1-n.DataOffset-this.CursorIndex,o=!0),this.CursorIndex+t>=s){var l=this.CursorIndex+t-(s-1);n.DataOffset+=l,o&&(this.CursorIndex=s-1),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("keydown");return}this.CursorIndex+=t,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo(),this.ShowTooltipByKeyDown()}}},this.GetKLineChart=function(){return this.ChartPaint[0]?this.ChartPaint[0]:null},this.CreateChildWindow=function(t){for(var n=this,s=this.GetEventCallback($.ON_CREATE_FRAME),o=0;o<t;++o){var l=new ra;l.UIElement=this.UIElement;var h=on.Create("KLineFrame",{ID:o});if(h.Canvas=this.Canvas,h.GetExtraCanvas=function(c){return n.GetExtraCanvas(c)},h.ChartBorder=l,h.Identify=o,h.RightSpaceCount=this.RightSpaceCount,h.GetEventCallback=function(c){return n.GetEventCallback(c)},h.GlobalOption=this.GlobalOption,h.HorizontalMax=20,h.HorizontalMin=10,o==0){h.YSplitOperator=new Ds,h.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price"),h.YSplitOperator.FrameSplitData2=this.FrameSplitData.get("double"),h.YSplitOperator.GetEventCallback=function(c){return n.GetEventCallback(c)},h.YSplitOperator.GetKLineChartCallback=function(){return n.GetKLineChart()},h.YSplitOperator.HQChart=this;var u=B();l.BottomSpace=15*u,l.TopSpace=15*u,h.GetEventCallback=function(c){return n.GetEventCallback(c)}}else h.YSplitOperator=new Za,h.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),h.YSplitOperator.LanguageID=this.LanguageID,h.YSplitOperator.GetEventCallback=function(c){return n.GetEventCallback(c)},h.YSplitOperator.GetKLineChartCallback=function(){return n.GetKLineChart()},h.YSplitOperator.HQChart=this;h.YSplitOperator.Frame=h,h.YSplitOperator.ChartBorder=l,h.XSplitOperator=new br,h.XSplitOperator.Frame=h,h.XSplitOperator.ChartBorder=l,h.XSplitOperator.LanguageID=this.LanguageID,h.XSplitOperator.GetEventCallback=function(c){return n.GetEventCallback(c)},o!=t-1&&(h.XSplitOperator.ShowText=!1);for(var f=h.HorizontalMin;f<=h.HorizontalMax;f+=1)h.HorizontalInfo[f]=new Ut,h.HorizontalInfo[f].Value=f,!(o==0&&f==h.HorizontalMin)&&(h.HorizontalInfo[f].Message[1]=f.toString(),h.HorizontalInfo[f].Font="14px 微软雅黑");var C=new yr;if(h.FrameData.SubFrameItem=C,C.Frame=h,o==0?C.Height=20:C.Height=10,this.Frame.SubFrame[o]=C,s&&s.Callback){var D={SubFrame:this.Frame.SubFrame[o],WindowIndex:o};s.Callback(s,D,this)}}},this.CreateSubFrameItem=function(t){var n=this,s=new ra;s.UIElement=this.UIElement;var o="KLineFrame";this.ClassName=="KLineChartHScreenContainer"&&(o="KLineHScreenFrame");var l=on.Create(o,{ID:t});l.Canvas=this.Canvas,l.GetExtraCanvas=function(c){return n.GetExtraCanvas(c)},l.ChartBorder=s,l.Identify=t,l.GetEventCallback=function(c){return n.GetEventCallback(c)},l.GlobalOption=this.GlobalOption,l.HorizontalMax=20,l.HorizontalMin=10,l.YSplitOperator=new Za,l.YSplitOperator.LanguageID=this.LanguageID,l.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),l.YSplitOperator.Frame=l,l.YSplitOperator.ChartBorder=s,l.XSplitOperator=new br,l.XSplitOperator.Frame=l,l.XSplitOperator.ChartBorder=s,l.XSplitOperator.ShowText=!1,l.XSplitOperator.GetEventCallback=function(c){return n.GetEventCallback(c)},l.YSplitOperator.GetEventCallback=function(c){return n.GetEventCallback(c)},l.YSplitOperator.GetKLineChartCallback=function(){return n.GetKLineChart()},l.YSplitOperator.HQChart=this,l.XSplitOperator.Symbol=this.Symbol,l.XSplitOperator.Period=this.Period;var h=this.Frame.SubFrame[0].Frame.XPointCount;l.XPointCount=h,l.Data=this.ChartPaint[0].Data;for(var u=l.HorizontalMin;u<=l.HorizontalMax;u+=1)l.HorizontalInfo[u]=new Ut,l.HorizontalInfo[u].Value=u,l.HorizontalInfo[u].Message[1]=u.toString(),l.HorizontalInfo[u].Font="14px 微软雅黑";var f=new yr;l.FrameData.SubFrameItem=f,f.Frame=l,f.Height=10;var C=this.GetEventCallback($.ON_CREATE_FRAME);if(C&&C.Callback){var D={SubFrame:f,WindowIndex:t};C.Callback(C,D,this)}return f},this.CreateMainKLine=function(){var t=this,n=Cs.Create("ChartKLine");n.Canvas=this.Canvas,n.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,n.ChartFrame=this.Frame.SubFrame[0].Frame,n.Name="Main-KLine",n.DrawType=this.KLineDrawType,n.Identify="Main-KLine",n.GetEventCallback=function(s){return t.GetEventCallback(s)},this.ChartPaint[0]=n,this.TitlePaint[0]=new uD,this.TitlePaint[0].Frame=this.Frame.SubFrame[0].Frame,this.TitlePaint[0].Canvas=this.Canvas,this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.TitlePaint[0].LanguageID=this.LanguageID,this.TitlePaint[0].HQChart=this,this.TitlePaint[0].GetEventCallback=function(s){return t.GetEventCallback(s)}},this.BindMainData=function(t,n,s){var o=!1;if(s&&s.IsShowAll===!0&&(o=!0),this.ChartPaint[0].Data=t,this.ChartPaint[0].Symbol=this.Symbol,this.KLineSize)if(!v.IsNumber(this.KLineSize.DataWidth))n=this.Frame.SubFrame[0].Frame.XPointCount-this.RightSpaceCount;else{var l=this.Frame.SetDataWidth(this.KLineSize.DataWidth);n=l.XPointCount-this.RightSpaceCount,this.KLineSize.DataWidth=null}for(var h=0;h<this.Frame.SubFrame.length;++h){var u=this.Frame.SubFrame[h].Frame;o?u.XPointCount=t.Data.length+this.RightSpaceCount:u.XPointCount=n+this.RightSpaceCount,u.Data=this.ChartPaint[0].Data,u.XSplitOperator.Symbol=this.Symbol,u.XSplitOperator.Period=this.Period}this.TitlePaint[0].Data=this.ChartPaint[0].Data,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=this.Name,this.TitlePaint[0].Period=this.Period,this.ChartCorssCursor.StringFormatX.Data=this.ChartPaint[0].Data,this.Frame.Data=this.ChartPaint[0].Data;for(var h=0;h<this.OverlayChartPaint.length;++h){var u=this.OverlayChartPaint[h];u.MainData=this.ChartPaint[0].Data}if(o){var f=0;this.CursorIndex=0}else{var f=t.Data.length-n;f<0&&(f=0),this.ChartPaint[0].Data.DataOffset=f,this.CursorIndex=n,this.CursorIndex+f>=t.Data.length&&(this.CursorIndex=t.Data.length-1-f),this.CursorIndex<0&&(this.CursorIndex=0)}this.ChartPaint[0].Period=this.Period,this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.CustomShow&&(this.SetCustomShow(this.CustomShow,t),this.CustomShow=null)},this.ShowAllKLine=function(){var t=this.ChartPaint[0];if(!t)return!1;var n=t.Data;if(!n||!v.IsNonEmptyArray(n.Data))return!1;for(var s=n.Data.length+this.RightSpaceCount,o=0;o<this.Frame.SubFrame.length;++o){var l=this.Frame.SubFrame[o].Frame;l.XPointCount=s}n.DataOffset=0,this.CursorIndex=0,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdatePointByCursorIndex(2),this.Draw()},this.UpdateMainData=function(t,n){var s=null;if(this.Frame.Data?this.Frame.SubFrame&&this.Frame.SubFrame[0]&&(s=this.Frame.SubFrame[0].Frame.Data):s=this.Frame.Data,!!s){var o=this.Frame.SubFrame[0].Frame.XPointCount,l=0;v.IsNumber(n)&&(n>0&&t.Data.length>n?(l=t.Data.length-n,k.Chart.Log("[KLineChartContainer::UpdateMainData]  [count="+n+"->"+t.Data.length+"], [newDataCount="+l+"], [Pagesize="+o+"]")):n==0&&t.Data.length>o&&(l=t.Data.length-o,k.Chart.Log("[KLineChartContainer::UpdateMainData] history data is empty. [count="+n+"->"+t.Data.length+"], [newDataCount="+l+"], [Pagesize="+o+"]"))),this.ChartPaint[0].Data=t,this.ChartPaint[0].Symbol=this.Symbol,t.Data.length>o&&(this.ChartPaint[0].Data.DataOffset=s.DataOffset+l);for(var h in this.Frame.SubFrame){var u=this.Frame.SubFrame[h].Frame;u.Data=this.ChartPaint[0].Data,h==0&&(u.YSplitOperator.Symbol=this.Symbol,u.YSplitOperator.Data=this.ChartPaint[0].Data,u.YSplitOperator.Period=this.Period)}this.TitlePaint[0].Data=this.ChartPaint[0].Data,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=this.Name,this.ChartCorssCursor.StringFormatX.Data=this.ChartPaint[0].Data,this.Frame.Data=this.ChartPaint[0].Data;for(var h in this.OverlayChartPaint){var u=this.OverlayChartPaint[h];u.MainData=this.ChartPaint[0].Data}this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol}},this.SetCustomShow=function(t,n){if(t.Callback){t.Callback(chart,n);return}var s=this.ChartOperator_GetIndex_ByDateTime(n,t,this.Period,0);if(s===null){k.Chart.Log("[KLineChartContainer::SetCustomShow] Can't find index by customShow=",t);return}if(v.IsPlusNumber(t.PageSize))for(var o=t.PageSize,l=0;l<this.Frame.SubFrame.length;++l){var h=this.Frame.SubFrame[l].Frame;h.XPointCount=o}this.ChartPaint[0].Data.DataOffset=s,this.CursorIndex=0},this.OnDragSelectRectMouseUp=function(t){var n=this.GetRectSelectPaint();if(n){var s=n.GetSelectRectData();if(s){var o=B(),l=this.ChartCorssCursor,h=l.LastPoint.X/o,u=l.LastPoint.Y/o,f=!0,C=this.GetEventCallback($.ON_DRAG_SELECT_RECT_MOUSEUP);if(C){var D={X:h,Y:u,SelectData:s,RectSelectPaint:n,IsShowMenu:!1};C.Callback(C,D,this),f=D.IsShowMenu}if(this.IsShowSelectRectDialog()){var D={Chart:this,X:h,Y:u,SelectData:s,RectSelectPaint:n};t.data=D,this.DrawSelectRectDialog(t)}else if(f){var D={Chart:this,X:h,Y:u,SelectData:s,RectSelectPaint:n};t.data=D,this.PopupSelectRectMenuV2(D,t)}}}},this.OnDragSubSelectRectMouseUp=function(t){var n=this.GetRectSelectPaint();if(n){var s=n.GetSelectRectData();if(s){var o=B(),l=this.ChartCorssCursor,h=l.LastPoint.X/o,u=l.LastPoint.Y/o,f=this.GetEventCallback($.ON_DRAG_SUB_SELECT_RECT_MOUSEUP);if(f){var C={Start:n.SubClient.FirstPoint,End:n.SubClient.SecondPoint},D={X:h,Y:u,SubSelectData:C,RectSelectPaint:n};f.Callback(f,D,this)}}}},this.ShowSelectData=function(t){this.HideSelectRect(),k.Chart.Log("[KLineChartContainer::ShowSelectData] selectData",t);var n=t.Start,s=t.End-t.Start+1;k.Chart.Log("[KLineChartContainer::ShowSelectData] DataOffset="+n+", ShowCount="+s);for(var o in this.Frame.SubFrame){var l=this.Frame.SubFrame[o].Frame;l.XPointCount=s}this.ChartPaint[0].Data.DataOffset=n,this.CursorIndex=0,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex()},this.OnMarkRectSelect=function(t){var n=this.ChartCorssCursor;if(!(!n||n.Status==0)&&v.IsNumber(n.CursorIndex)&&!(!this.ChartPaint[0]||!this.ChartPaint[0].Data)){var s=this.GetRectSelectPaint();if(s){var o=n.CursorIndex;k.Chart.Log("[KLineChartContainer::OnMarkRectSelect] dataIndex",o);var l=this.ChartPaint[0].Data;o=parseInt(o.toFixed(0));var h=o+l.DataOffset;h>=l.Data.length&&(h=l.Data.length-1);var u=l.Data[h];if(k.Chart.Log("[KLineChartContainer::OnMarkRectSelect] item",u),!!this.SetRectSelectData(u,h)){var f=s.GetPointCount(),C=B();if(f==1){var D=this.GetEventCallback($.ON_KEYDOWN_SELECT_RECT_FIRST);if(D&&D.Callback){var c={X:n.LastPoint.X/C,Y:n.LastPoint.Y/C,Item:u,Index:h,RectSelectPaint:s,e:t};D.Callback(D,c,this)}}else if(f==2){var T=s.GetSelectRectData(),D=this.GetEventCallback($.ON_KEYDOWN_SELECT_RECT),S=!0;if(D&&D.Callback){var c={X:n.LastPoint.X/C,Y:n.LastPoint.Y/C,SelectData:T,RectSelectPaint:s,IsShowMenu:!0,e:t};D.Callback(D,c,this),S=c.IsShowMenu}if(S){var c={Chart:this,X:n.LastPoint.X/C,Y:n.LastPoint.Y/C,SelectData:T,RectSelectPaint:s};t.data=c,this.PopupSelectRectMenuV2(c,t)}}this.Draw()}}}},this.CreateWindowIndex=function(t){this.WindowIndex[t].Create(this,t)},this.BindIndexData=function(t,n,s){if(this.WindowIndex[t]){var o=this.WindowIndex[t];if(typeof o.RequestData=="function"){o.RequestData(this,t,n,s);return}if(typeof o.ExecuteScript=="function"){if(s&&s.CheckRunCount&&o.IsExcessRunCount())return;o.ExecuteScript(this,t,n);return}o.BindData(this,t,n)}},this.BindOverlayIndexData=function(t,n,s,o){if(t.Script){if(typeof t.Script.RequestData=="function"){t.Script.RequestData(this,n,s);return}if(typeof t.Script.ExecuteScript=="function"){if(o&&(o.CheckRunCount&&t.Script.IsExcessRunCount()||v.IsBool(o.SyncExecute)&&t.Script.IsSync!=o.SyncExecute))return;t.Script.ExecuteScript(this,n,s);return}t.Script.BindData(this,n,s)}},this.BindInstructionIndexData=function(t){this.ColorIndex&&typeof this.ColorIndex.ExecuteScript=="function"&&this.ColorIndex.ExecuteScript(this,0,t),this.TradeIndex&&typeof this.TradeIndex.ExecuteScript=="function"&&this.TradeIndex.ExecuteScript(this,0,t)},this.GetChartPaint=function(t){var n=new Array;for(var s in this.ChartPaint)if(s!=0){var o=this.ChartPaint[s];o.ChartFrame==this.Frame.SubFrame[t].Frame&&n.push(o)}return n},this.AutoUpdateEvent=function(t,n){var s=t?$.RECV_START_AUTOUPDATE:$.RECV_STOP_AUTOUPDATE;if(this.mapEvent.has(s)){var o=this,l=this.mapEvent.get(s),h={Stock:{Symbol:this.Symbol,Name:this.Name,Right:this.Right,Period:this.Period},Explain:n};t&&(h.Callback=function(u){Y.IsDayPeriod(o.Period,!0)?o.RecvRealtimeData(u):(Y.IsMinutePeriod(o.Period,!0)||Y.IsSecondPeriod(o.Period)||Y.IsMilliSecondPeriod(o.Period))&&o.RecvMinuteRealtimeData(u)}),l.Callback(l,h,this)}},this.SendKLineUpdateEvent=function(t){var n=this.GetEventCallback($.RECV_KLINE_UPDATE_DATA);if(n&&n.Callback){var s={HistoryData:t,Stock:{Symbol:this.Symbol,Name:this.Name}};return n.Callback(n,s,this),!0}return!1},this.SendManualKLineUpdateEvent=function(t){var n=this.GetEventCallback($.RECV_KLINE_MANUAL_UPDATE_DATA);if(n&&n.Callback){var s={HistoryData:t,Stock:{Symbol:this.Symbol,Name:this.Name}};return n.Callback(n,s,this),!0}return!1},this.GetKLineDrawType=function(){return this.KLineDrawType},this.RequestHistoryData=function(){var t=this;if(this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.FlowCapitalReady=!1,this.ResetPage(),this.ResetDragDownload(),this.ResetZoomDownload(),this.Draw(),this.NetworkFilter){var n=this.GetKLineDrawType(),s={Name:"KLineChartContainer::RequestHistoryData",Explain:"日K数据",Request:{Url:t.KLineApiUrl,Type:"POST",Data:{symbol:t.Symbol,count:t.MaxRequestDataCount,field:["name","symbol","yclose","open","price","high","low","vol"],period:this.Period,right:this.Right,klineDrawType:n}},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(o){t.ChartSplashPaint.EnableSplash(!1),t.RecvHistoryData(o);var l=t.Page.Day;l.Enable==!0&&l.Finish==!1?t.RequestHistoryPageData():(t.AutoUpdateEvent(!0,"KLineChartContainer::RequestHistoryData"),t.AutoUpdate())}),s.PreventDefault==!0)return}Vt.HttpRequest({url:this.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(l){t.ChartSplashPaint.EnableSplash(!1),t.RecvHistoryData(l);var h=t.Page.Day;h.Enable==!0&&h.Finish==!1?t.RequestHistoryPageData():(t.AutoUpdateEvent(!0,"KLineChartContainer::RequestHistoryData"),t.AutoUpdate())}})},this.BindAllOverlayIndexData=function(t,n){if(!(!this.Frame||!this.Frame.SubFrame))for(var s=0;s<this.Frame.SubFrame.length;++s)for(var o=this.Frame.SubFrame[s],l=0;l<o.OverlayIndex.length;++l){var h=o.OverlayIndex[l];this.BindOverlayIndexData(h,s,t,n)}},this.RecvHistoryData=function(t){if(this.EnableVerifyRecvData&&t.symbol!=this.Symbol){k.Chart.Warn("[KLineChartContainer::RecvHistoryData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+t.symbol+"]");return}var n=de.JsonDataToHistoryData(t),s=new Y;s.Data=n,s.DataType=0,s.Symbol=t.symbol,this.SourceData=s,this.BeforeBindMainData&&this.BeforeBindMainData("RecvHistoryData");var o=new Y;if(o.Data=n,o.Right=this.Right,o.Period=this.Period,o.DataType=0,o.Symbol=t.symbol,o.Right>0&&!this.IsApiPeriod){var l=o.GetRightData(o.Right,{AlgorithmType:this.RightFormula});o.Data=l}if(Y.IsDayPeriod(o.Period,!1)&&!this.IsApiPeriod){var h=o.GetPeriodData(o.Period);o.Data=h}var u=this.GetKLineCalulate();if(u){var f=u.RecvHistoryData(o,{Symbol:this.Symbol,Function:"RecvHistoryData"});o=f,this.FlowCapitalReady=!0}this.Symbol=t.symbol,this.Name=t.name,this.BindMainData(o,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("RecvHistoryData"),this.Frame.SetSizeChage(!0);var C;this.Frame.SubFrame[0]&&(C=this.Frame.SubFrame[0].Frame),C&&C.YSplitOperator&&(C.YSplitOperator.Symbol=this.Symbol,C.YSplitOperator.Data=this.ChartPaint[0].Data,C.YSplitOperator.Period=this.Period);var D=this.Page.Day;(D.Enable==!1||D.Enable==!0&&D.Finish==!0)&&(this.ReqeustKLineInfoData({FunctionName:"RecvHistoryData"}),this.RequestFlowCapitalData(),this.RequestOverlayHistoryData(),this.CreateChartDrawPictureByStorage()),D.Enable&&(D.Index=1),this.BindInstructionIndexData(o);for(var c=0;c<this.Frame.SubFrame.length;++c)this.BindIndexData(c,o);if(this.BindAllOverlayIndexData(o,{SyncExecute:!0}),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdatePointByCursorIndex(2),this.Draw(),this.BindAllOverlayIndexData(o,{SyncExecute:!1}),this.mapEvent.has($.RECV_HISTROY_DATA)){var T=this.mapEvent.get($.RECV_HISTROY_DATA),t={HistoryData:o,Stock:{Symbol:this.Symbol,Name:this.Name}};T.Callback(T,t,this)}},this.RequestHistoryPageData=function(){var t=this;if(this.NetworkFilter){var n=this.SourceData.Data[0],s={Name:"KLineChartContainer::RequestHistoryPageData",Explain:"日K数据分页",Request:{Url:"none",Type:"POST",Data:{symbol:t.Symbol,index:t.Page.Day.Index,field:["name","symbol","yclose","open","price","high","low","vol"],firstDate:n.Date,first:{date:n.Date}}},Page:t.Page.Day,Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(o){t.RecvHistoryPageData(o);var l=t.Page.Day;l.Enable==!0&&l.Finish==!1?t.RequestHistoryPageData():t.AutoUpdate()}),s.PreventDefault==!0)return}setTimeout(function(){var o=t.Page.Day;o.Finish=!0;var l={data:[[20150218,12.54,12.5,12.74,11.95,12.27,117632441,1459671045],[20150219,12.27,12.1,12.23,11.9,12.23,95889423,1157078548],[20150220,12.23,12.17,12.17,11.9,12.05,67763439,815652761]],symbol:t.Symbol,name:t.Name};t.RecvHistoryPageData(l),o.Enable==!0&&o.Finish==!1?t.RequestHistoryPageData():t.AutoUpdate()},500)},this.RecvHistoryPageData=function(t){if(this.EnableVerifyRecvData&&t.symbol!=this.Symbol){k.Chart.Warn("[KLineChartContainer::RecvHistoryPageData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+t.symbol+"]");return}var n=de.JsonDataToHistoryData(t),s=this.GetHistoryDataCount();for(var o in n){var l=n[o];this.SourceData.Data.splice(o,0,l)}var h=new Y;if(h.Data=this.SourceData.Data,h.Period=this.Period,h.Right=this.Right,h.DataType=this.SourceData.DataType,h.Right>0&&h.Period<=3){var u=h.GetRightData(h.Right,{AlgorithmType:this.RightFormula});h.Data=u}if(Y.IsDayPeriod(h.Period,!1)||Y.IsMinutePeriod(h.Period,!1)){var f=h.GetPeriodData(h.Period);h.Data=f}this.UpdateMainData(h,s),this.BindInstructionIndexData(h);for(var o=0;o<this.Frame.SubFrame.length;++o)this.BindIndexData(o,h);var C=this.Page.Day;++C.Index,C.Enable==!0&&C.Finish==!0&&(this.RequestFlowCapitalData(),this.RequestOverlayHistoryData(),this.CreateChartDrawPictureByStorage()),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()},this.RequestHistoryMinuteData=function(){var t=this;if(this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.FlowCapitalReady=!1,this.ResetPage(),this.ResetDragDownload(),this.ResetZoomDownload(),this.Draw(),this.NetworkFilter){var n=this.GetKLineDrawType(),s={Name:"KLineChartContainer::ReqeustHistoryMinuteData",Explain:"1分钟K线数据",Request:{Url:t.MinuteKLineApiUrl,Type:"POST",Data:{symbol:t.Symbol,count:t.MaxRequestMinuteDayCount,field:["name","symbol","yclose","open","price","high","low","vol"],period:this.Period,right:this.Right,klineDrawType:n}},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(o){t.ChartSplashPaint.EnableSplash(!1),t.RecvMinuteHistoryData(o);var l=t.Page.Minute;l.Enable==!0&&l.Finish==!1?t.ReqeustHistoryMinutePageData():(t.AutoUpdateEvent(!0,"KLineChartContainer::ReqeustHistoryMinuteData"),t.AutoUpdate())}),s.PreventDefault==!0)return}Vt.HttpRequest({url:this.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(l){t.ChartSplashPaint.EnableSplash(!1),t.RecvMinuteHistoryData(l);var h=t.Page.Minute;h.Enable==!0&&h.Finish==!1?t.ReqeustHistoryMinutePageData():(t.AutoUpdateEvent(!0,"KLineChartContainer::ReqeustHistoryMinuteData"),t.AutoUpdate())}})},this.ReqeustHistoryMinuteData=this.RequestHistoryMinuteData,this.RecvMinuteHistoryData=function(t){if(this.EnableVerifyRecvData&&t.symbol!=this.Symbol){k.Chart.Warn("[KLineChartContainer::RecvMinuteHistoryData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+t.symbol+"]");return}var n=de.JsonDataToMinuteHistoryData(t),s=new Y;s.Data=n,s.DataType=1,s.Symbol=t.symbol,this.SourceData=s,this.BeforeBindMainData&&this.BeforeBindMainData("RecvMinuteHistoryData");var o=new Y;if(o.Data=n,o.Right=this.Right,o.Period=this.Period,o.DataType=1,o.Symbol=t.symbol,o.Right>0&&!this.IsApiPeriod&&this.RightFormula>=1){var l=o.GetRightData(o.Right,{AlgorithmType:this.RightFormula});o.Data=l}if(Y.IsMinutePeriod(o.Period,!1)&&!this.IsApiPeriod){var h=o.GetPeriodData(o.Period);o.Data=h}var u=this.GetKLineCalulate();if(u){var f=u.RecvHistoryData(o,{Symbol:this.Symbol,Function:"RecvMinuteHistoryData"});o=f,this.FlowCapitalReady=!0}this.Symbol=t.symbol,this.Name=t.name;var C=null;if(t&&t.ChartOperator){var D=t.ChartOperator;C={},D.IsShowAll===!0&&(C.IsShowAll=!0)}this.BindMainData(o,this.PageSize,C),this.AfterBindMainData&&this.AfterBindMainData("RecvMinuteHistoryData"),this.Frame.SetSizeChage(!0);var c;this.Frame.SubFrame[0]&&(c=this.Frame.SubFrame[0].Frame),c&&c.YSplitOperator&&(c.YSplitOperator.Symbol=this.Symbol,c.YSplitOperator.Data=this.ChartPaint[0].Data,c.YSplitOperator.Period=this.Period);for(var T in this.OverlayChartPaint){var D=this.OverlayChartPaint[T];D.Data=null}var S=this.Page.Minute;(S.Enable==!1||S.Enable==!0&&S.Finish==!0)&&(this.ReqeustKLineInfoData({FunctionName:"RecvMinuteHistoryData"}),this.RequestFlowCapitalData(),this.RequestOverlayHistoryMinuteData(),this.CreateChartDrawPictureByStorage()),S.Enable&&++S.Index,this.BindInstructionIndexData(o);for(var T=0;T<this.Frame.SubFrame.length;++T)this.BindIndexData(T,o);if(this.BindAllOverlayIndexData(o,{SyncExecute:!0}),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(2),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.BindAllOverlayIndexData(o,{SyncExecute:!1}),this.mapEvent.has($.RECV_HISTROY_DATA)){var I=this.mapEvent.get($.RECV_HISTROY_DATA),t={HistoryData:o,Stock:{Symbol:this.Symbol,Name:this.Name}};I.Callback(I,t,this)}},this.ReqeustHistoryMinutePageData=function(){var t=this;if(this.NetworkFilter){var n=this.SourceData.Data[0],s={Name:"KLineChartContainer::RecvHistoryMinutePageData",Explain:"1分钟K线数据分页",Request:{Url:"none",Type:"POST",Data:{symbol:t.Symbol,index:t.Page.Minute.Index,field:["name","symbol","yclose","open","price","high","low","vol"],firstDate:n.Date,first:{date:n.Date,time:n.Time}}},Page:t.Page.Minute,Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(o){t.RecvHistoryMinutePageData(o);var l=t.Page.Minute;l.Enable==!0&&l.Finish==!1?t.ReqeustHistoryMinutePageData():t.AutoUpdate()}),s.PreventDefault==!0)return}setTimeout(function(){var o=t.Page.Minute;o.Finish=!0;var l={data:[[20190906,14.58,14.71,14.71,14.71,14.71,1096425,16128411,925],[20190906,14.71,14.73,14.74,14.71,14.71,2154859,31731820,930],[20190906,14.71,14.71,14.71,14.68,14.69,1427516,20989208,931],[20190906,14.69,14.69,14.71,14.68,14.7,1680503,24694143,932],[20190906,14.7,14.69,14.7,14.65,14.65,1315900,19310964,933],[20190906,14.65,14.66,14.69,14.65,14.68,702955,10313842,934],[20190906,14.68,14.7,14.71,14.67,14.67,1735266,25495875,935],[20190906,14.67,14.68,14.7,14.67,14.67,739e3,10845398,936],[20190906,14.67,14.67,14.68,14.67,14.68,389800,5721266,937],[20190906,14.68,14.68,14.7,14.68,14.69,648477,9527859,938],[20190906,14.69,14.7,14.71,14.69,14.7,1128400,16589794,939],[20190906,14.7,14.7,14.71,14.69,14.71,714858,10509708,940],[20190906,14.71,14.71,14.71,14.69,14.69,401500,5900477,941],[20190906,14.69,14.69,14.71,14.69,14.69,1165684,17131034,942],[20190906,14.69,14.69,14.7,14.67,14.67,498516,7321024,943],[20190906,14.67,14.68,14.68,14.67,14.67,350126,5139012,944],[20190906,14.67,14.67,14.69,14.67,14.69,561600,8246789,945]]};t.RecvHistoryMinutePageData(l),o.Enable==!0&&o.Finish==!1?t.ReqeustHistoryMinutePageData():t.AutoUpdate()},500)},this.RecvHistoryMinutePageData=function(t){if(this.EnableVerifyRecvData&&t.symbol!=this.Symbol){k.Chart.Warn("[KLineChartContainer::RecvHistoryMinutePageData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+t.symbol+"]");return}var n=de.JsonDataToMinuteHistoryData(t),s=this.GetHistoryDataCount();for(var o in n){var l=n[o];this.SourceData.Data.splice(o,0,l)}var h=new Y;if(h.Data=this.SourceData.Data,h.Period=this.Period,h.Right=this.Right,h.DataType=this.SourceData.DataType,h.Right>0&&Y.IsDayPeriod(h.Period,!1)){var u=h.GetRightData(h.Right,{AlgorithmType:this.RightFormula});h.Data=u}if(Y.IsDayPeriod(h.Period,!1)||Y.IsMinutePeriod(h.Period,!1)){var f=h.GetPeriodData(h.Period);h.Data=f}this.UpdateMainData(h,s),this.BindInstructionIndexData(h);for(var o=0;o<this.Frame.SubFrame.length;++o)this.BindIndexData(o,h);var C=this.Page.Minute;(C.Enable==!1||C.Enable==!0&&C.Finish==!0)&&(this.RequestFlowCapitalData(),this.CreateChartDrawPictureByStorage()),C.Enable&&++C.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()},this.RequestRealtimeData=function(){var t=this,n=[t.Symbol];for(var s in this.OverlayChartPaint){var o=this.OverlayChartPaint[s];o.Symbol&&o.MainData&&o.Status==Le.STATUS_FINISHED_ID&&n.push(o.Symbol)}if(this.NetworkFilter){var l=this.GetKLineDrawType(),h=null,u=this.ChartOperator_Temp_GetHistroyData();u&&(h=u.GetDateRange());var f={Name:"KLineChartContainer::RequestRealtimeData",Explain:"当天最新日线数据",Request:{Url:t.RealtimeApiUrl,Data:{symbol:n,field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time"],period:this.Period,right:this.Right,klineDrawType:l,dateRange:h},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(f,function(C){t.RecvRealtimeData(C),t.AutoUpdate()}),f.PreventDefault==!0)return}Vt.HttpRequest({url:this.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time"],symbol:n,start:-1},type:"post",dataType:"json",async:!0,success:function(D){t.RecvRealtimeData(D),t.AutoUpdate()}})},this.RecvRealtimeData=function(t){if(this.IsOnTouch!=!0){var n=de.JsonDataToRealtimeData(t,this.Symbol);if(n){var s=this.SourceData.Data[this.SourceData.Data.length-1],o=this.GetHistoryDataCount();if(this.SourceData.Data.length==0){var l=new Pt;Pt.CopyTo(l,n),this.SourceData.Data.push(l)}else if(s.Date==n.Date)k.Chart.Log("[KLineChartContainer::RecvRealtimeData] update kline by realtime data",n),Pt.CopyTo(s,n);else if(s.Date<n.Date){k.Chart.Log("[KLineChartContainer::RecvRealtimeData] insert kline by realtime data",n);var l=new Pt;Pt.CopyTo(l,n),!v.IsNumber(l.YClose)&&this.SourceData.Data.length>0&&(l.YClose=this.SourceData.Data[this.SourceData.Data.length-1].YClose),this.SourceData.Data.push(l)}else{for(var h=!1,u=this.SourceData.Data,f=u.length-1;f>=0;--f){var C=u[f];if(C.Date==n.Date){Pt.CopyTo(C,n),h=!0;break}}if(!h)return}var D=new Y;if(D.Data=this.SourceData.Data,D.Period=this.Period,D.Right=this.Right,D.DataType=this.SourceData.DataType,D.Symbol=this.Symbol,D.Right>0&&Y.IsDayPeriod(D.Period,!0)&&U.IsSHSZStockA(this.Symbol)&&!this.IsApiPeriod){var c=D.GetRightData(D.Right,{AlgorithmType:this.RightFormula});D.Data=c}if(!this.IsApiPeriod&&(Y.IsDayPeriod(D.Period,!1)||Y.IsMinutePeriod(D.Period,!1))){var T=D.GetPeriodData(D.Period);D.Data=T}var S=this.GetKLineCalulate();if(S){var I=S.RecvHistoryData(D,{Symbol:this.Symbol,Function:"RecvRealtimeData"});D=I,this.FlowCapitalReady=!0}this.UpdateMainData(D,o),this.UpdateOverlayRealtimeData(t),this.BindInstructionIndexData(D);for(var f=0;f<this.Frame.SubFrame.length;++f)this.BindIndexData(f,D,{CheckRunCount:!0});if(this.BindAllOverlayIndexData(D,{CheckRunCount:!0,SyncExecute:!0}),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendKLineUpdateEvent(D),this.UpdateDOMTooltip(0,D),this.UpdateHQFloatTooltip(D),this.BindAllOverlayIndexData(D,{CheckRunCount:!0,SyncExecute:!1}),this.mapEvent.has($.ON_RECV_REALTIME_DATA)){var g=this.mapEvent.get($.ON_RECV_REALTIME_DATA),t={HistoryData:D,Stock:{Symbol:this.Symbol,Name:this.Name}};g.Callback(g,t,this)}}}},this.UpdateOverlayRealtimeData=function(t){if(v.IsNonEmptyArray(this.OverlayChartPaint))for(var n=0;n<this.OverlayChartPaint.length;++n){var s=this.OverlayChartPaint[n];if(s.Symbol&&s.MainData&&s.Status==Le.STATUS_FINISHED_ID){var o=de.JsonDataToRealtimeData(t,s.Symbol);if(o){var l=s.SourceData,h=l.Data[l.Data.length-1];if(h.Date==o.Date)k.Chart.Log("[KLineChartContainer::UpdateOverlayRealtimeData] update kline by minute data",o),h.Close=o.Close,h.High=o.High,h.Low=o.Low,h.Vol=o.Vol,h.Amount=o.Amount;else if(h.Date<o.Date){k.Chart.Log("[KLineChartContainer::UpdateOverlayRealtimeData] insert kline by minute data",o);var u=new Pt;u.YClose=o.YClose,u.Open=o.Open,u.Close=o.Close,u.High=o.High,u.Low=o.Low,u.Vol=o.Vol,u.Amount=o.Amount,u.Date=o.Date,l.Data.push(u)}else continue;var f=new Y;if(f.Data=l.Data,f.Period=this.Period,f.Right=this.Right,f.DataType=0,f.Right>0&&U.IsSHSZStockA(t.symbol)&&!this.IsApiPeriod){var C=f.GetRightData(f.Right,{AlgorithmType:this.RightFormula});f.Data=C}var D=this.SourceData.GetOverlayData(f.Data,this.IsApiPeriod);if(f.Data=D,Y.IsDayPeriod(f.Period,!1)&&!this.IsApiPeriod){var c=f.GetPeriodData(f.Period);f.Data=c}s.Data=f}}}},this.RequestMinuteRealtimeData=function(){var t=this,n=[t.Symbol];for(var s in this.OverlayChartPaint){var o=this.OverlayChartPaint[s];o.Symbol&&o.MainData&&o.Status==Le.STATUS_FINISHED_ID&&n.push(o.Symbol)}if(this.NetworkFilter){var l=this.GetKLineDrawType(),h=null,u=this.ChartOperator_Temp_GetHistroyData();u&&(h=u.GetDateRange());var f={Name:"KLineChartContainer::RequestMinuteRealtimeData",Explain:"当天1分钟K线数据",Request:{Url:t.RealtimeApiUrl,Data:{symbol:n,field:["name","symbol","price","yclose","minutecount","minute","date","time"],period:this.Period,right:this.Right,klineDrawType:l,dateRange:h},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(f,function(C){t.RecvMinuteRealtimeData(C),t.AutoUpdate()}),f.PreventDefault==!0)return}Vt.HttpRequest({url:this.RealtimeApiUrl,data:{field:["name","symbol","price","yclose","minutecount","minute","date","time"],symbol:n,start:-1},type:"post",dataType:"json",async:!0,success:function(D){t.RecvMinuteRealtimeData(D),t.AutoUpdate()}})},this.SetSourceDatatLimit=function(t){this.SourceDataLimit=new Dt.default;for(var n in t){var s=t[n];this.SourceDataLimit.set(s.Period,s.MaxCount),k.Chart.Log("[KLineChartContainer::SetSourceDatatLimit] Period="+s.Period+", MaxCount="+s.MaxCount)}},this.ReduceSourceData=function(){if(this.SourceDataLimit&&this.SourceDataLimit.has(this.Period)){var t=this.SourceDataLimit.get(this.Period),n=null;if(this.Frame.Data?this.Frame.SubFrame&&this.Frame.SubFrame[0]&&(n=this.Frame.SubFrame[0].Frame.Data):n=this.Frame.Data,!!n&&!(t<50)){for(var s=n.DataOffset,o=0;this.SourceData.Data.length>t;)this.SourceData.Data.shift(),--s,++o;o>0&&(s<0&&(s=0),n.DataOffset=s,k.Chart.Log("[KLineChartContainer::ReduceSourceData] remove data "+o+", dataOffset="+s))}}},this.RecvMinuteRealtimeDataV2=function(t){if(this.IsOnTouch!=!0){if(this.EnableVerifyRecvData&&t.symbol!=this.Symbol){k.Chart.Warn("[KLineChartContainer::RecvMinuteRealtimeDataV2] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+t.symbol+"]");return}var n=de.JsonDataToMinuteHistoryData(t);if(!(!n||n.length<=0)){this.IsApiPeriod&&this.ReduceSourceData();var s=this.GetHistoryDataCount();if(this.SourceData&&this.SourceData.MergeMinuteData(n)){k.Chart.Log("[KLineChartContainer::RecvMinuteRealtimeDataV2] update kline by 1 minute data ["+s+"->"+this.SourceData.Data.length+"], IsAutoSyncDataOffset="+this.IsAutoSyncDataOffset),this.IsAutoSyncDataOffset===!1&&(s=null);var o=new Y;if(o.Data=this.SourceData.Data,o.Period=this.Period,o.Right=this.Right,o.DataType=this.SourceData.DataType,o.Symbol=this.Symbol,o.Right>0&&!this.IsApiPeriod&&this.RightFormula>=1){var l=o.GetRightData(o.Right,{AlgorithmType:this.RightFormula});o.Data=l}if((Y.IsDayPeriod(o.Period,!1)||Y.IsMinutePeriod(o.Period,!1))&&!this.IsApiPeriod){var h=o.GetPeriodData(o.Period);o.Data=h}var u=this.GetKLineCalulate();if(u){var f=u.RecvHistoryData(o,{Symbol:this.Symbol,Function:"RecvMinuteRealtimeDataV2"});o=f,this.FlowCapitalReady=!0}this.UpdateMainData(o,s),this.UpdateOverlayMinuteRealtimeData(t),this.BindInstructionIndexData(o);for(var C=0;C<this.Frame.SubFrame.length;++C)this.BindIndexData(C,o);if(this.BindAllOverlayIndexData(o,{CheckRunCount:!0,SyncExecute:!0}),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendKLineUpdateEvent(o),this.UpdateDOMTooltip(0,o),this.UpdateHQFloatTooltip(o),this.BindAllOverlayIndexData(o,{CheckRunCount:!0,SyncExecute:!1}),this.mapEvent.has($.ON_RECV_REALTIME_DATA)){var D=this.mapEvent.get($.ON_RECV_REALTIME_DATA),t={HistoryData:o,Stock:{Symbol:this.Symbol,Name:this.Name}};D.Callback(D,t,this)}}}}},this.RecvMinuteRealtimeData=function(t){if(this.IsOnTouch!=!0){if(t.ver==2){this.RecvMinuteRealtimeDataV2(t);return}var n=de.JsonDataToMinuteRealtimeData(t,this.Symbol);if(n){this.IsApiPeriod&&this.ReduceSourceData();var s=this.GetHistoryDataCount(),o=this.SourceData.Data.length;if(this.SourceData.MergeMinuteData(n)){k.Chart.Log("[KLineChartContainer::RecvMinuteRealtimeData] update kline by 1 minute data ["+o+"->"+this.SourceData.Data.length+"]");var l=new Y;if(l.Data=this.SourceData.Data,l.Period=this.Period,l.Right=this.Right,l.DataType=this.SourceData.DataType,l.Symbol=this.Symbol,l.Right>0&&!this.IsApiPeriod&&this.RightFormula>=1){var h=l.GetRightData(l.Right,{AlgorithmType:this.RightFormula});l.Data=h}if((Y.IsDayPeriod(l.Period,!1)||Y.IsMinutePeriod(l.Period,!1))&&!this.IsApiPeriod){var u=l.GetPeriodData(l.Period);l.Data=u}var f=this.GetKLineCalulate();if(f){var C=f.RecvHistoryData(l,{Symbol:this.Symbol,Function:"RecvMinuteRealtimeData"});l=C,this.FlowCapitalReady=!0}this.UpdateMainData(l,s),this.UpdateOverlayMinuteRealtimeData(t),this.BindInstructionIndexData(l);for(var D=0;D<this.Frame.SubFrame.length;++D)this.BindIndexData(D,l);this.BindAllOverlayIndexData(l,{CheckRunCount:!0,SyncExecute:!0}),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendKLineUpdateEvent(l),this.BindAllOverlayIndexData(l,{CheckRunCount:!0,SyncExecute:!1})}}}},this.UpdateOverlayMinuteRealtimeData=function(t){for(var n in this.OverlayChartPaint){var s=this.OverlayChartPaint[n];if(s.Symbol&&s.MainData&&s.Status==Le.STATUS_FINISHED_ID){if(t.ver==2)var o=de.JsonDataToMinuteRealtimeDataV2(t,s.Symbol);else var o=de.JsonDataToMinuteRealtimeData(t,s.Symbol);if(o){var l=s.SourceData;if(!l.MergeMinuteData(o))return;var h=new Y;h.Data=l.Data,h.Period=this.Period,h.Right=this.Right,h.DataType=0;var u=this.SourceData.GetOverlayMinuteData(h.Data,this.IsApiPeriod);if(h.Data=u,Y.IsMinutePeriod(h.Period,!1)&&!this.IsApiPeriod){var f=h.GetPeriodData(h.Period);h.Data=f}s.Data=h}}}},this.GetHistoryDataCount=function(){var t=null;if(this.Frame.Data?this.Frame.SubFrame&&this.Frame.SubFrame[0]&&(t=this.Frame.SubFrame[0].Frame.Data):t=this.Frame.Data,!t)return-1;var n=t.Data.length;return n},this.GetRequestDataCount=function(){var t={MaxRequestDataCount:this.MaxRequestDataCount,MaxRequestMinuteDayCount:this.MaxRequestMinuteDayCount};if(!this.SourceData||!this.SourceData.Data||this.SourceData.Data.length<=0)return t;if(Y.IsDayPeriod(this.Period,!0)){var n=this.SourceData.Data.length;n>t.MaxRequestDataCount&&(t.MaxRequestDataCount=n)}else if(Y.IsMinutePeriod(this.Period,!0)){var s,n=0;for(var o in this.SourceData.Data){var l=this.SourceData.Data[o];l.Date!=s&&++n,s=l.Date}n>t.MaxRequestMinuteDayCount&&(t.MaxRequestMinuteDayCount=n)}return t},this.RequestTickData=function(){var t=this;this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),t.ChartSplashPaint.EnableSplash(!0),t.Draw();var n=d.CacheDomain+"/cache/dealday/today/"+t.Symbol+".json";if(this.NetworkFilter){var s={Name:"KLineChartContainer::RequestTickData",Explain:"当天分笔数据",Request:{Url:n,Data:{symbol:t.Symbol},Type:"GET"},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(o){t.ChartSplashPaint.EnableSplash(!1),t.RecvTickData(o),t.AutoUpdate()}),s.PreventDefault==!0)return}Vt.HttpRequest({url:n,data:{symbol:t.Symbol},type:"get",dataType:"json",async:!0,success:function(l){t.ChartSplashPaint.EnableSplash(!1),t.RecvTickData(l),t.AutoUpdate(1)},error:function(l,h){t.ChartSplashPaint.EnableSplash(!1),t.AutoUpdate()}})},this.RecvTickData=function(t){if(t.ver==2)var n=de.JsonDataToTickDataV2(t);else var n=de.JsonDataToTickData(t);var s=new Y;s.Data=n,s.DataType=2,this.SourceData=s,this.BeforeBindMainData&&this.BeforeBindMainData("RecvTickData");var o=new Y;o.Data=n,o.Right=this.Right,o.Period=this.Period,o.DataType=2,this.Symbol=t.symbol,this.Name=t.name,this.BindMainData(o,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("RecvTickData"),this.BindInstructionIndexData(o);for(var l,h=0;h<this.Frame.SubFrame.length;++h)h==0&&(l=this.Frame.SubFrame[h].Frame),this.BindIndexData(h,o);if(l&&l.YSplitOperator&&(l.YSplitOperator.Symbol=this.Symbol,l.YSplitOperator.Data=this.ChartPaint[0].Data,l.YSplitOperator.Period=this.Period,l.YSplitOperator.KLineChart=this.ChartPaint[0]),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex(),this.BindAllOverlayIndexData(o),this.mapEvent.has($.RECV_HISTROY_DATA)){var u=this.mapEvent.get($.RECV_HISTROY_DATA),t={HistoryData:o,Stock:{Symbol:this.Symbol,Name:this.Name}};u.Callback(u,t,this)}},this.RequestTickRealtimeData=function(){var t=this,n=0;if(this.SourceData&&this.SourceData.Data&&(n=this.SourceData.Data.length),this.NetworkFilter){var s={Name:"KLineChartContainer::RequestTickRealtimeData",Explain:"当天最新分笔数据",Request:{Url:t.TickApiUrl,Data:{symbol:t.Symbol,start:n,end:n+1e3},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(o){t.ChartSplashPaint.EnableSplash(!1),t.RecvTickRealtimeData(o),t.AutoUpdate()}),s.PreventDefault==!0)return}Vt.HttpRequest({url:t.TickApiUrl,data:{symbol:t.Symbol,start:n-10,end:n+1e3},type:"post",dataType:"json",async:!0,success:function(l){t.ChartSplashPaint.EnableSplash(!1),t.RecvTickRealtimeData(l),t.AutoUpdate()}})},this.RecvTickRealtimeData=function(t){if(t.ver==2)var n=de.JsonDataToTickDataV2(t);else var n=de.JsonDataToTickData(t);if(!(!n||n.length<=0)){var s=!1;t.redraw==!0&&(s=!0);var o=this.SourceData.Data,l=this.SourceData.Data.length,h=0;o.length>0&&(h=o[o.length-1].Time);var u=0;for(var f in n){var C=n[f];C.Time<=h||(o.push(C),++u)}if(!(u<=0&&s==!1)){var D=new Y;D.Data=o,D.Right=this.Right,D.Period=this.Period,D.DataType=2,this.Symbol=t.symbol,this.Name=t.name,this.UpdateMainData(D,l),this.BindInstructionIndexData(D);for(var f=0;f<this.Frame.SubFrame.length;++f)this.BindIndexData(f,D);this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex(),this.BindAllOverlayIndexData(D)}}},this.ClearIndexPaint=function(){if(this.Frame&&this.Frame.SubFrame)for(var t=0;t<this.Frame.SubFrame.length;++t){this.DeleteIndexPaint(t,!0);var n=this.Frame.SubFrame[t];if(v.IsNonEmptyArray(n.OverlayIndex))for(var s=0;s<n.OverlayIndex.length;++s){for(var o=n.OverlayIndex[s],l=0;l<o.ChartPaint.length;++l){var h=o.ChartPaint[l];h&&h.OnDestroy&&h.OnDestroy()}o.ChartPaint=[]}}for(var t=1;t<this.TitlePaint.length;++t){var n=this.TitlePaint[t];n.OverlayIndex=new Dt.default}},this.ChangePeriod=function(t,n){var s={Period:this.Period,Right:this.Right,KLineDrawType:this.KLineDrawType,Symbol:this.Symbol},o=!1,l=!1,h=null;if(n&&(n.KLine&&(v.IsNumber(n.KLine.DrawType)&&(o=!0),v.IsNumber(n.KLine.Right)&&(h=n.KLine.Right)),n.Reload==!0&&(l=!0)),this.Period==t&&l==!1){o&&this.ChangeKLineDrawType(n.KLine.DrawType);return}o&&this.ChangeKLineDrawType(n.KLine.DrawType,!1);var u=!0;if(this.SourceData){var u=!1;if(t>Or&&t<=Pn)this.SourceData.DataType!=0&&(u=!0);else if(t>Ii&&t<=Nr||t>un&&t<=qh||t>fn&&t<=jh)(this.SourceData.DataType!=1||Y.IsSecondPeriod(t)||Y.IsMilliSecondPeriod(t))&&(u=!0);else switch(t){case 0:case 1:case 2:case 3:case 9:case 21:this.SourceData.DataType!=0&&(u=!0);break;case 4:case 5:case 6:case 7:case 8:case 11:case 12:this.SourceData.DataType!=1&&(u=!0);break;case 10:this.SourceData.DataType!=2&&(u=!0);break}}this.Period=t,h!=null&&(this.Right=h),this.ReloadChartDrawPicture(),this.ClearRectSelect(!0),this.Frame.ClearUpDonwFrameYData(),this.ClearCustomKLine(),this.ClearKLineCaluate();var f=this.GetKLineDrawType();(f==10||f==11||f==12||f==16)&&(u=!0);var C=this.GetEventCallback($.ON_CHANGE_KLINE_PERIOD);if(C&&C.Callback){var D={IsApiPeriod:this.IsApiPeriod,Old:s,Now:{Period:this.Period,Right:this.Right,KLineDrawType:this.KLineDrawType,Symbol:this.Symbol},IsDataTypeChange:u};C.Callback(C,D,this),u=D.IsDataTypeChange}if(u==!1&&!this.IsApiPeriod){this.ClearIndexRunCount(),this.Update({UpdateCursorIndexType:2});return}this.ClearIndexPaint(),Y.IsDayPeriod(this.Period,!0)?(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangePeriod"),this.ResetScrollBar(),this.ResetOverlaySymbolStatus(),this.ClearIndexRunCount(),this.Frame.ClearYCoordinateMaxMin(),this.RequestHistoryData()):Y.IsMinutePeriod(this.Period,!0)||Y.IsSecondPeriod(this.Period)||Y.IsMilliSecondPeriod(this.Period)?(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangePeriod"),this.ResetScrollBar(),this.ResetOverlaySymbolStatus(),this.ClearIndexRunCount(),this.Frame.ClearYCoordinateMaxMin(),this.RequestHistoryMinuteData()):Y.IsTickPeriod(this.Period)&&(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangePeriod"),this.ResetScrollBar(),this.ClearIndexRunCount(),this.Frame.ClearYCoordinateMaxMin(),this.RequestTickData())},this.ChangeRight=function(t){if(U.IsEnableRight(this.Period,this.Symbol,this.RightFormula)){var n=this.Symbol.toUpperCase();if(!U.IsBIT(n)&&!(t<0||t>2)&&this.Right!=t){var s={Period:this.Period,Right:this.Right,KLineDrawType:this.KLineDrawType,Symbol:this.Symbol};this.Right=t;var o=this.GetEventCallback($.ON_CHANGE_KLINE_RIGHT);if(o&&o.Callback){var l={IsApiPeriod:this.IsApiPeriod,Old:s,Now:{Period:this.Period,Right:this.Right,KLineDrawType:this.KLineDrawType,Symbol:this.Symbol}};o.Callback(o,l,this)}if(this.IsApiPeriod)Y.IsDayPeriod(this.Period,!0)?(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeRight"),this.ClearIndexPaint(),this.ResetOverlaySymbolStatus(),this.ResetScrollBar(),this.RequestHistoryData()):(Y.IsMinutePeriod(this.Period,!0)||Y.IsSecondPeriod(this.Period)||Y.IsMilliSecondPeriod(this.Period))&&(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeRight"),this.ClearIndexPaint(),this.ResetOverlaySymbolStatus(),this.ResetScrollBar(),this.RequestHistoryMinuteData());else{this.Update();return}}}},this.SetFirstShowDate=function(t){if(!(!t||!t.Date)){var n={ID:ve.OP_GOTO,Date:t.Date};v.IsNumber(t.Time)&&(n.Time=t.Time),v.IsNumber(t.PageSize)&&(n.PageSize=t.PageSize),this.ChartOperator(n)}},this.DeleteIndexPaint=function(t,n){if(this.Frame.SubFrame[t]){var s=this.Frame.SubFrame[t].Frame;if(s){for(var o=[],l=0;l<this.ChartPaint.length;++l){var h=this.ChartPaint[l],u=h.ChartFrame.Guid==s.Guid||h.ChartFrame==s;l==0||!u?o.push(h):n===!0&&h&&h.OnDestroy&&h.OnDestroy()}s.YSpecificMaxMin=null,s.IsLocked=!1,s.YSplitScale=null,s.YSplitOperator.SplitType=s.YSplitOperator.DefaultSplitType,this.ChartPaint=o;var f=t+1;this.TitlePaint[f].Data=[],this.TitlePaint[f].Title=null}}},this.ShowKLine=function(t){this.ChartPaint.length<=0||!this.ChartPaint[0]||(this.ChartPaint[0].IsShow=t)},this.SetInstructionData=function(t,n){if(!(this.ChartPaint.length<=0||!this.ChartPaint[0])){var s=this.TitlePaint[1];t==2?(this.ChartPaint[0].ColorData=n.Data,s&&(s.ColorIndex={Name:n.Name,Param:n.Param})):t==1&&(this.ChartPaint[0].TradeData={Sell:n.Sell,Buy:n.Buy,Name:n.Name,Param:n.Param},s&&(s.TradeIndex={Name:n.Name,Param:n.Param}))}},this.ChangeInstructionIndex=function(t,n){var s=new Z,o=s.Get(t);o&&(o.InstructionType!=1&&o.InstructionType!=2||(n&&n.Args&&(o.Args=n.Args),o.ID=t,this.ChangeInstructionScriptIndex(o)))},this.ChangeInstructionScriptIndex=function(t){if(t.InstructionType==1)this.TradeIndex=new Ie(t.Name,t.Script,t.Args,t);else if(t.InstructionType==2)this.ColorIndex=new Ie(t.Name,t.Script,t.Args,t);else return;var n=this.ChartPaint[0].Data;this.BindInstructionIndexData(n),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.CancelInstructionIndex=function(){if(!(this.ChartPaint.length<=0||!this.ChartPaint[0])){this.ColorIndex=null,this.TradeIndex=null,this.ChartPaint[0].ColorData=null,this.ChartPaint[0].TradeData=null;var t=this.TitlePaint[1];t&&(t.TradeIndex=null,t.ColorIndex=null),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.SetFrameToolbar=function(t,n){if(!(!n||!this.Frame.SubFrame[t]||!this.Frame.SubFrame[t].Frame)){var s=this.Frame.SubFrame[t].Frame,o=!1;v.IsBool(n.Modify)&&(s.ModifyIndex=n.Modify,o=!0),v.IsBool(n.Change)&&(s.ChangeIndex=n.Change,o=!0),v.IsBool(n.Close)&&(s.CloseIndex=n.Close,o=!0),v.IsBool(n.Overlay)&&(s.OverlayIndex=n.Overlay,o=!0),o&&(s.SizeChange=!0,s.ToolbarRect=null,s.DrawToolbar())}},this.SetFrameAttribute=function(t,n){if(!(!window||!this.Frame.SubFrame[t]||!this.Frame.SubFrame[t].Frame)&&n){var s=this.Frame.SubFrame[t].Frame;v.IsUndefined(n.HorizontalReserved)||(s.HorizontalReserved=n.HorizontalReserved),v.IsNumber(n.TitleHeight)&&(s.ChartBorder.TitleHeight=n.TitleHeight)}},this.ResetFrameAttribute=function(t){if(!(!window||!this.Frame.SubFrame[t]||!this.Frame.SubFrame[t].Frame)){var n=this.Frame.SubFrame[t].Frame;n.HorizontalReserved=null}},this.ChangeScriptIndex=function(t,n,s){this.DeleteIndexPaint(t,!0),this.WindowIndex[t]=new Ie(n.Name,n.Script,n.Args,n),this.ResetFrameAttribute(t),this.Frame.ClearYCoordinateMaxMin(t),s&&s.Window&&(this.SetFrameToolbar(t,s.Window),this.SetFrameAttribute(t,s.Window)),this.OnChangeIndexEvent(t,{ID:n.ID,Name:n.Name,FunctionName:"ChangeScriptIndex"}),this.Frame.ClearUpDonwFrameYData({Index:t});var o=this.ChartPaint[0].Data;this.BindIndexData(t,o),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.OnKLinePageChange=function(t){if(this.ChartPaint[0]){for(var n=this.ChartPaint[0].Data,s=0;s<this.WindowIndex.length;++s){var o=this.WindowIndex[s];o&&o.IsUsePageData===!0&&this.BindIndexData(s,n,{Type:1})}for(var s=0;s<this.Frame.SubFrame.length;++s)for(var o=this.Frame.SubFrame[s],l=0;l<o.OverlayIndex.length;++l){var h=o.OverlayIndex[l];h&&h.Script&&h.Script.IsUsePageData==!0&&this.BindOverlayIndexData(h,s,n)}}},this.ChangeAPIIndex=function(t,n){this.DeleteIndexPaint(t,!0);var s=n.API;this.WindowIndex[t]=new ga(s.Name,s.Script,s.Args,n),this.ResetFrameAttribute(t),this.Frame.ClearYCoordinateMaxMin(t),this.OnChangeIndexEvent(t,{ID:n.ID,Name:n.Name,FunctionName:"ChangeAPIIndex"}),n&&n.Window&&(this.SetFrameToolbar(t,n.Window),this.SetFrameAttribute(t,n.Window)),this.Frame.ClearUpDonwFrameYData({Index:t});var o=this.ChartPaint[0].Data;this.BindIndexData(t,o),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.OnChangeIndexEvent=function(t,n){var s=this.GetEventCallback($.ON_CHANGE_INDEX);if(s&&s.Callback){var o={IndexInfo:n,WindowIndex:t};s.Callback(s,o,this)}},this.ChangeIndex=function(t,n,s){if(s&&s.API)return this.ChangeAPIIndex(t,s);var o=$a.Get(n);if(!o){var l=new Z,h=l.Get(n);return h?(h.IsMainIndex?t=0:t==0&&(t=1),Z.ModifyAttribute(h,s),this.ChangeScriptIndex(t,h,s)):void 0}o.IsMainIndex?t>0&&(t=0):t==0&&(t=1);var u=new Array;for(var f in this.ChartPaint){var C=this.ChartPaint[f];(f==0||C.ChartFrame!=this.Frame.SubFrame[t].Frame)&&u.push(C)}this.Frame.SubFrame[t].Frame.YSpecificMaxMin=null,this.Frame.SubFrame[t].Frame.IsLocked=!1,this.Frame.SubFrame[t].Frame.YSplitScale=null,this.ChartPaint=u;var D=t+1;this.TitlePaint[D].Data=[],this.TitlePaint[D].Title=null,this.WindowIndex[t]=o.Create(s),this.CreateWindowIndex(t);var c=this.ChartPaint[0].Data;this.BindIndexData(t,c),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangePyScriptIndex=function(t,n){this.DeleteIndexPaint(t),this.WindowIndex[t]=new fl(n.Name,n.Script,n.Args);var s=this.ChartPaint[0].Data;this.BindIndexData(t,s),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.AddOverlayIndex=function(t){var n=this.CreateOverlayWindowsIndex(t);if(n){var s=this.ChartPaint[0].Data;this.BindOverlayIndexData(n,t.WindowIndex,s),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.CreateOverlayWindowsIndex=function(t){var n=this,s=t.IndexName,o=t.WindowIndex,l=null,h=null,u=null;if(t.API)l=t.API;else if(t.Script)h={Script:t.Script,ID:t.indexName,Name:t.indexName},t.Name&&(h.Name=t.Name);else{var f=new Z;if(h=f.Get(s),!h&&(u=$a.Get(s),!u))return console.warn("[KLineChartContainer::CreateOverlayIndex] can not find index["+s+"]"),null}var C=this.Frame.SubFrame[o],D=new ln;t.Identify&&(D.Identify=t.Identify);var c=this.CreateOverlayFrame();if(c.Canvas=this.Canvas,c.MainFrame=C.Frame,c.ChartBorder=C.Frame.ChartBorder,c.GetEventCallback=function(F){return n.GetEventCallback(F)},t.ShowRightText===!0?c.IsShow=!0:t.ShowRightText===!1&&(c.IsShow=!1),v.IsBool(t.ShowToolbar)&&(c.IsShowToolbar=t.ShowToolbar),v.IsBool(t.IsShareY)&&(c.IsShareY=t.IsShareY),v.IsNumber(t.IsShowMainFrame)&&(c.IsShowMainFrame=t.IsShowMainFrame),v.IsBool(t.IsCalculateYMaxMin)&&(c.IsCalculateYMaxMin=t.IsCalculateYMaxMin),c.YSplitOperator=new Za,c.YSplitOperator.LanguageID=this.LanguageID,c.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),c.YSplitOperator.Frame=c,c.YSplitOperator.ChartBorder=c.ChartBorder,c.YSplitOperator.SplitCount=C.Frame.YSplitOperator.SplitCount,c.YSplitOperator.GetEventCallback=function(F){return n.GetEventCallback(F)},c.YSplitOperator.GetKLineChartCallback=function(){return n.GetKLineChart()},c.YSplitOperator.OverlayIndex=D,c.YSplitOperator.HQChart=this,c.YSplitOperator.OverlayIdentify=D.Identify,t.Frame){var T=t.Frame;T.Custom&&(c.YSplitOperator.Custom=T.Custom),v.IsBool(T.IsYDrawMainFrame)&&(c.IsYDrawMainFrame=T.IsYDrawMainFrame),v.IsBool(T.IsShowToolbar)&&(c.IsShowToolbar=T.IsShowToolbar)}if(D.Frame=c,l){var S=new ga(l.Name,l.Script,l.Args,t,!0);S.OverlayIndex={IsOverlay:!0,Identify:D.Identify,WindowIndex:o,Frame:D},D.Script=S}else if(h){Z.ModifyAttribute(h,t);var I=new cs(h.Name,h.Script,h.Args,h);I.OverlayIndex={IsOverlay:!0,Identify:D.Identify,WindowIndex:o,Frame:D},D.Script=I}else{var I=u.Create();I.OverlayIndex={IsOverlay:!0,Identify:D.Identify,WindowIndex:o,Frame:D},I.Create(this,o),D.Script=I}var g=this.GetEventCallback($.ON_CREATE_OVERLAY_FRAME);if(g&&g.Callback){var E={OverlayFrame:D,WindowIndex:o,SubFrame:C};g.Callback(g,E,this)}return C.OverlayIndex.push(D),D},this.DeleteOverlayWindowsIndex=function(t){this.DeleteOverlayIndex(t,null)&&(this.UpdateFrameMaxMin(),this.Frame.ResetXYSplit(!0),this.Draw())},this.ChangeKLineDrawType=function(t,n,s){if(!(this.KLineDrawType==t&&!s)){var o=this.KLineDrawType;this.KLineDrawType=t;var l=new Fe.default([5,7,8,10,11,12,17]);if(l.has(o)||l.has(t)){var h=this.ChartPaint[0];h&&(h.DrawType=this.KLineDrawType),this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeKLineDrawType"),Y.IsDayPeriod(this.Period,!0)?(this.ResetOverlaySymbolStatus(),this.RequestHistoryData()):(Y.IsMinutePeriod(this.Period,!0)||Y.IsSecondPeriod(this.Period)||Y.IsMilliSecondPeriod(this.Period))&&(this.ResetOverlaySymbolStatus(),this.RequestHistoryMinuteData());return}for(var u=0;u<this.ChartPaint.length;++u){var f=this.ChartPaint[u];u==0?(f.DrawType=this.KLineDrawType,s&&v.IsBool(s.IsThinAKBar)&&(f.IsThinAKBar=s.IsThinAKBar)):f.ClassName=="ChartVolStick"&&(f.KLineDrawType=this.KLineDrawType)}for(var u in this.OverlayChartPaint){var f=this.OverlayChartPaint[u];f.DrawType=this.KLineDrawType}n!=!1&&(this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw())}},this.ChangeCoordinateType=function(t){if(this.Frame&&v.IsNonEmptyArray(this.Frame.SubFrame)&&this.Frame.SubFrame[0]){var n=this.Frame.SubFrame[0].Frame;if(v.IsNumber(t)){var s=t;if(s==2)n.CoordinateType=1;else if(s==1)n.YSplitOperator.CoordinateType=s;else if(s==0)n.CoordinateType=0,n.YSplitOperator.CoordinateType=0;else if(s==3)n.Frame.YSplitOperator.CoordinateType=2;else return}else t.Type>=0&&t.Type<=5&&(n.YSplitOperator.CoordinateType=t.Type),t.IsReverse===!0?n.CoordinateType=1:t.IsReverse==!1&&(n.CoordinateType=0);n.YMaxMin.Max=null,n.YMaxMin.Min=null,this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.ChangeIndexWindowCount=function(t,n){var s=this;if(!(t<=0)&&this.Frame.SubFrame.length!=t){this.Frame.RestoreIndexWindows();var o=this.Frame.SubFrame.length;if(o>t){for(var l=this.GetEventCallback($.ON_DELETE_FRAME),h=o-1;h>=t;--h)if(this.DeleteIndexPaint(h),this.DeleteChartPaintExtend({WindowIndex:h}),this.Frame.SubFrame[h].Frame.ClearToolbar(),l&&l.Callback){var u={SubFrame:this.Frame.SubFrame[h],WindowIndex:h};l.Callback(l,u,this)}this.Frame.SubFrame.splice(t,o-t),this.WindowIndex.splice(t,o-t),this.TitlePaint.splice(t+1,o-t);for(var h=0;h<this.Frame.SubFrame.length;++h){var f=this.Frame.SubFrame[h].Frame;h==this.Frame.SubFrame.length-1?f.XSplitOperator.ShowText=!0:f.XSplitOperator.ShowText=!1}this.Frame.SetSizeChage(!0),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()}else{for(var C=B(),h=o;h<t;++h){var D=this.CreateSubFrameItem(h);D.Frame.ChartBorder.TitleHeight*=C,this.Frame.SubFrame[h]=D;var c=new Qa;c.Frame=this.Frame.SubFrame[h].Frame,c.Canvas=this.Canvas,c.LanguageID=this.LanguageID,c.GetEventCallback=function(P){return s.GetEventCallback(P)},c.SelectedChart=this.SelectedChart,this.TitlePaint[h+1]=c}for(var h=0;h<this.Frame.SubFrame.length;++h){var f=this.Frame.SubFrame[h].Frame;h==this.Frame.SubFrame.length-1?f.XSplitOperator.ShowText=!0:f.XSplitOperator.ShowText=!1}this.Frame.SetSizeChage(!0),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw();var T=[{Index:"RSI"},{Index:"MACD"},{Index:"VOL"},{Index:"UOS"},{Index:"CHO"},{Index:"BRAR"}];n&&n.Windows.length>0&&(T=n.Windows);for(var S=new Z,h=o;h<t;++h){var f=T[h%T.length],I=f.Index,g=S.Get(I),E=g.Args;f.Args&&(E=f.Args);var F={Name:g.Name,Script:g.Script,Args:E,ID:f.Index,KLineType:g.KLineType,YSpecificMaxMin:g.YSpecificMaxMin,YSplitScale:g.YSplitScale,FloatPrecision:g.FloatPrecision,Condition:g.Condition,OutName:g.OutName};this.WindowIndex[h]=new Ie(F.Name,F.Script,F.Args,F);var D=this.Frame.SubFrame[h];f.Modify!=null&&(this.Frame.SubFrame[h].Frame.ModifyIndex=f.Modify),f.Change!=null&&(this.Frame.SubFrame[h].Frame.ChangeIndex=f.Change),f.Close!=null&&(this.Frame.SubFrame[h].Frame.CloseIndex=f.Close),f.Overlay!=null&&(chart.Frame.SubFrame[h].Frame.OverlayIndex=f.Overlay),f.IsDrawTitleBG==!0&&(this.Frame.SubFrame[h].Frame.IsDrawTitleBG=f.IsDrawTitleBG),v.IsBool(f.IsShowNameArrow)&&(this.Frame.SubFrame[h].Frame.IsShowNameArrow=f.IsShowNameArrow),v.IsNumber(f.TitleHeight)?this.Frame.SubFrame[h].Frame.ChartBorder.TitleHeight=f.TitleHeight:f.TitleHeight=this.Frame.SubFrame[h].Frame.ChartBorder.TitleHeight,v.IsBool(f.IsShowTitleArrow)&&(D.Frame.IsShowTitleArrow=f.IsShowTitleArrow),v.IsNumber(f.TitleArrowType)&&(D.Frame.TitleArrowType=f.TitleArrowType),f.IsShowIndexName==!1&&(this.Frame.SubFrame[h].Frame.IsShowIndexName=!1),f.IsShowOverlayIndexName==!1&&(this.Frame.SubFrame[h].Frame.IsShowOverlayIndexName=!1),v.IsNumber(f.IndexParamSpace)&&(this.Frame.SubFrame[h].Frame.IndexParamSpace=f.IndexParamSpace),v.IsNumber(f.IndexTitleSpace)&&(this.Frame.SubFrame[h].Frame.IndexTitleSpace=f.IndexTitleSpace),f.IsShowXLine==!1&&(this.Frame.SubFrame[h].Frame.IsShowXLine=!1),f.IsShowYLine==!1&&(this.Frame.SubFrame[h].Frame.IsShowYLine=!1),v.IsBool(f.IsShowIndexTitle)&&(this.Frame.SubFrame[h].Frame.IsShowIndexTitle=f.IsShowIndexTitle),v.IsBool(f.IsShowLeftText)&&(D.Frame.IsShowYText[0]=f.IsShowLeftText,D.Frame.YSplitOperator.IsShowLeftText=f.IsShowLeftText),v.IsBool(f.IsShowRightText)&&(D.Frame.IsShowYText[1]=f.IsShowRightText,D.Frame.YSplitOperator.IsShowRightText=f.IsShowRightText),f.OverlayIndexType&&(v.IsNumber(f.OverlayIndexType.Position)&&(D.Frame.OverlayIndexType.Position=f.OverlayIndexType.Position),v.IsNumber(f.OverlayIndexType.LineSpace)&&(D.Frame.OverlayIndexType.LineSpace=f.OverlayIndexType.LineSpace));var R=this.ChartPaint[0].Data;this.BindIndexData(h,R)}}}},this.ChangeIndexTemplate=function(t){var n=this;if(t.Windows){var s=t.Windows.length;if(!(s<=0)){var o=this.Frame.SubFrame.length,l=null,h=null,u=null;t.Symbol&&(u=t.Symbol),t.KLine&&(v.IsNumber(t.KLine.Period)&&t.KLine.Period!=this.Period&&(l=t.KLine.Period),v.IsNumber(t.KLine.Right)&&t.KLine.Right!=this.Right&&(h=t.KLine.Right));for(var f=l!=null||h!=null||u!=null,C=0;C<o;++C){this.DeleteIndexPaint(C);var D=this.Frame.SubFrame[C];D.YSpecificMaxMin=null,D.IsLocked=!1,D.YSplitScale=null}if(o>s){for(var c=this.GetEventCallback($.ON_DELETE_FRAME),C=o-1;C>=s;--C)if(this.Frame.SubFrame[C].Frame.ClearToolbar(),c&&c.Callback){var T={SubFrame:this.Frame.SubFrame[C],WindowIndex:C};c.Callback(c,T,this)}this.Frame.SubFrame.splice(s,o-s),this.WindowIndex.splice(s,o-s),this.TitlePaint.splice(s+1,o-s)}else for(var C=o;C<s;++C){var S=this.CreateSubFrameItem(C);this.Frame.SubFrame[C]=S;var I=new Qa;I.Frame=this.Frame.SubFrame[C].Frame,I.Canvas=this.Canvas,I.LanguageID=this.LanguageID,I.GetEventCallback=function(Nt){return n.GetEventCallback(Nt)},I.SelectedChart=this.SelectedChart,this.TitlePaint[C+1]=I}for(var C=0;C<s;++C){var g=C,E=t.Windows[C],F=null;t.Frame&&t.Frame.length>C&&(F=t.Frame[C]);var R=g+1;this.TitlePaint[R].Data=[],this.TitlePaint[R].Title=null;var D=this.Frame.SubFrame[C];if(this.DeleteWindowsOverlayIndex(C),E.Script)this.WindowIndex[C]=new Ie(E.Name,E.Script,E.Args,E);else if(E.API){var A=E.API;this.WindowIndex[g]=new ga(A.Name,A.Script,A.Args,E)}else{var P=E.Index,p=$a.Get(P);if(p)this.WindowIndex[C]=p.Create(),this.CreateWindowIndex(g);else{var w=new Z,H=w.Get(P);H&&(Z.ModifyAttribute(H,E),this.WindowIndex[C]=new Ie(H.Name,H.Script,H.Args,H))}}this.SetSubFrameAttribute(D,E,F)}for(var C=0;C<this.Frame.SubFrame.length;++C){var E=this.Frame.SubFrame[C].Frame;C==this.Frame.SubFrame.length-1?E.XSplitOperator.ShowText=!0:E.XSplitOperator.ShowText=!1}var W=[];if(v.IsNonEmptyArray(t.OverlayIndex))for(var C=0;C<t.OverlayIndex.length;++C){var E=t.OverlayIndex[C];E.Index&&(E.IndexName=E.Index),E.Windows>=0&&(E.WindowIndex=E.Windows);var ht=this.CreateOverlayWindowsIndex(E);ht&&W.push({WindowsIndex:E.WindowIndex,Overlay:ht})}if(this.Frame.SetSizeChage(!0),f){u||(u=this.Symbol);var nt={KLine:{}};v.IsNumber(l)&&(nt.KLine.Period=l),v.IsNumber(h)&&(nt.KLine.Right=h),this.ChangeSymbol(u,nt)}else{for(var rt=this.ChartPaint[0].Data,C=0;C<s;++C)this.BindIndexData(C,rt);for(var C=0;C<W.length;++C){var E=W[C];this.BindOverlayIndexData(E.Overlay,E.WindowsIndex,rt)}this.UpdataDataoffset(),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()}}}},this.RemoveIndexWindow=function(t,n){if(k.Chart.Log("[KLineChartContainer::RemoveIndexWindow] remove id",t),t==0){n&&n.DeleteMainIndex&&(this.DeleteIndexPaint(t),this.WindowIndex[t]=null,this.Frame.SetSizeChage(!0),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw());return}if(this.Frame.SubFrame&&!(t>=this.Frame.SubFrame.length)){this.Frame.RestoreIndexWindows();var s=this.Frame.SubFrame[t].Frame;this.DeleteIndexPaint(t),this.DeleteChartPaintExtend({WindowIndex:t}),this.Frame.SubFrame[t].Frame.ClearToolbar();var o=this.GetEventCallback($.ON_DELETE_FRAME);if(o&&o.Callback){var l={SubFrame:this.Frame.SubFrame[t],WindowIndex:t};o.Callback(o,l,this)}this.Frame.SubFrame.splice(t,1),this.WindowIndex.splice(t,1),this.TitlePaint.splice(t+1,1);for(var h=0;h<this.Frame.SubFrame.length;++h){var u=this.Frame.SubFrame[h].Frame;h==this.Frame.SubFrame.length-1?u.XSplitOperator.ShowText=!0:u.XSplitOperator.ShowText=!1,u.Identify=h}if(this.ChartDrawPicture.length>0){var f=[];for(var h in this.ChartDrawPicture){var u=this.ChartDrawPicture[h];u.Frame!=s&&f.push(u)}this.ChartDrawPicture=f}this.Frame.SetSizeChage(!0),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()}},this.GetStockChipChart=function(t){if(t)return this.GetExtendChartByClassName(t);var n=this.GetExtendChartByClassName("StockChip");return n||(n=this.GetExtendChartByClassName("StockChipPhone"),n)},this.DeleteStockChipChart=function(){var t=this.GetStockChipChart();if(t){var n=t.Chart.Width;this.DeleteExtendChart(t),this.Frame.ChartBorder.Right-=n,t.Chart.ClassName=="StockChipPhone"&&(this.GlobalOption.RightHorizontal.Show=!0,this.Frame.ResetXYSplit()),this.SetSizeChange(!0),this.Draw()}},this.CreateStockChipPhone=function(t){var n=new iD;return n.Canvas=this.Canvas,n.ChartBorder=this.Frame.ChartBorder,n.ChartFrame=this.Frame,n.HQChart=this,n.Left=this.Frame.ChartBorder.Right,n.SetOption(t),this.ExtendChartPaint.push(n),this.Frame.ChartBorder.Right+=n.Width,this.GlobalOption.RightHorizontal.Show=!1,n},this.CreateExtendChart=function(t,n){var s;switch(t){case"筹码分布":case"StockChip":return s=new aD,s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,s.Left=this.Frame.ChartBorder.Right,s.SetOption(n),this.ExtendChartPaint.push(s),this.Frame.ChartBorder.Right+=s.Width,s;case"StockChipPhone":return this.CreateStockChipPhone(n);case"KLineTooltip":return n.Create&&typeof n.Create=="function"?s=n.Create():s=new rl,s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,n.LanguageID=this.LanguageID,s.SetOption(n),this.ExtendChartPaint.push(s),s;case"深度图":return s=new iI,s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,s.SetOption(n),this.ExtendChartPaint.push(s),s;case"K线Y轴背景图":return s=new rI,s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,s.SetOption(n),this.ExtendChartPaint.push(s),s;case"背景图":return s=new sI,s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,s.SetOption(n),this.ExtendChartPaint.push(s),s;case"FrameSplitPaint":return s=new rD,s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,s.SetOption(n),this.ExtendChartPaint.push(s),s;default:return s=Br.Create(t),s?(s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,s.SetOption(n),this.ExtendChartPaint.push(s),s):null}},this.OnTouchFinished=function(){if(this.DragMode==Ve.CLICK_TOUCH_MODE_ID){if(this.TouchStatus.CorssCursorShow==!0&&this.TouchDrawCount>0)return;this.TouchStatus.CorssCursorShow=!1,this.DrawDynamicInfo();return}if(this.EnableClickModel===!0){if(this.ClickModel.IsShowCorssCursor==!0&&this.TouchDrawCount>0)return;this.ClickModel.IsShowCorssCursor=!1,this.DrawDynamicInfo();return}if(this.CorssCursorTouchEnd===!0){this.TouchDrawCount>0&&this.DrawDynamicInfo();return}for(var t in this.ExtendChartPaint){var n=this.ExtendChartPaint[t];n.ClassName==="KLineTooltipPaint"&&this.DrawDynamicInfo()}},this.LockIndex=function(t){if(t&&t.IndexName)for(var n in this.WindowIndex){var s=this.WindowIndex[n];if(s||conintue,s.Name==t.IndexName){s.SetLock(t),this.Update();break}}},this.TryClickLock=function(t,n){for(var s=0;s<this.Frame.SubFrame.length;++s){var o=this.Frame.SubFrame[s];if(o.Frame.IsLocked&&o.Frame.LockPaint){var l=new ns;if(o.Frame.LockPaint.GetTooltipData(t,n,l))return l.HQChart=this,l.Data.Callback&&l.Data.Callback(l),!0}}return!1},this.TryClickIndexTitle=function(t,n){for(var s in this.TitlePaint){var o=this.TitlePaint[s];if(o.IsClickTitle&&o.IsClickTitle(t,n)){var l={Point:{X:t,Y:n},Title:o.Title,FrameID:o.Frame.Identify};k.Chart.Log("[KLineChartContainer::TryClickIndexTitle] click title ",l);var h=this.GetEventCallback($.ON_CLICK_INDEXTITLE);return h&&h.Callback&&h.Callback(h,l,this),!0}}return!1},this.SetSizeChange=function(t){this.Frame.SetSizeChage(t);for(var n in this.ExtendChartPaint){var s=this.ExtendChartPaint[n];s.SizeChange=t}},this.SetSizeChage=this.SetSizeChange,this.Update=function(t){if(this.SourceData){this.BeforeBindMainData&&this.BeforeBindMainData("Update");var n=new Y;if(n.Data=this.SourceData.Data,n.Period=this.Period,n.Right=this.Right,n.DataType=this.SourceData.DataType,n.Symbol=this.Symbol,n.Right>0&&Y.IsDayPeriod(n.Period,!0)){var s=n.GetRightData(n.Right,{AlgorithmType:this.RightFormula});n.Data=s}else if(n.Right>0&&Y.IsMinutePeriod(n.Period,!0)&&this.RightFormula>=1){var s=n.GetRightData(n.Right,{AlgorithmType:this.RightFormula});n.Data=s}if(Y.IsDayPeriod(n.Period,!1)||Y.IsMinutePeriod(n.Period,!1)){var o=n.GetPeriodData(n.Period);n.Data=o}this.BindMainData(n,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("Update");for(var l,h=0;h<this.Frame.SubFrame.length;++h)h==0&&(l=this.Frame.SubFrame[h].Frame),this.BindIndexData(h,n);l&&l.YSplitOperator&&(l.YSplitOperator.Symbol=this.Symbol,l.YSplitOperator.Data=this.ChartPaint[0].Data,l.YSplitOperator.Period=this.Period);for(var h in this.OverlayChartPaint){var u=this.OverlayChartPaint[h];if(u.SourceData)if(Y.IsMinutePeriod(this.Period,!0)){var n=new Y;n.Data=u.SourceData.Data,n.Period=this.Period,n.Right=this.Right;var f=this.SourceData.GetOverlayMinuteData(n.Data,this.IsApiPeriod);if(n.Data=f,Y.IsMinutePeriod(n.Period,!1)&&!this.IsApiPeriod){var o=n.GetPeriodData(n.Period);n.Data=o}u.Data=n}else{var n=new Y;if(n.Data=u.SourceData.Data,n.Period=this.Period,n.Right=this.Right,n.Right>0&&U.IsSHSZStockA(u.Symbol)){var s=n.GetRightData(n.Right,{AlgorithmType:this.RightFormula});n.Data=s}var f=this.SourceData.GetOverlayData(n.Data,this.IsApiPeriod);if(n.Data=f,Y.IsDayPeriod(n.Period,!1)&&!this.IsApiPeriod){var o=n.GetPeriodData(n.Period);n.Data=o}u.Data=n}}this.ReqeustKLineInfoData({FunctionName:"Update"}),this.CreateChartDrawPictureByStorage(),this.UpdataDataoffset(),t&&t.UpdateCursorIndexType>0?this.UpdatePointByCursorIndex(t.UpdateCursorIndexType):this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw();for(var h=0;h<this.Frame.SubFrame.length;++h){var u=this.Frame.SubFrame[h];for(var C in u.OverlayIndex){var D=u.OverlayIndex[C];this.BindOverlayIndexData(D,h,n)}}}},this.ChangeSymbol=function(t,n){if(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeSymbol"),this.ClearRectSelect(!0),this.ClearCustomKLine(),this.ClearKLineCaluate(),this.HideTooltip(),this.ResetScrollBar(),this.ClearIndexRunCount(),this.Frame.ClearYCoordinateMaxMin(),this.Symbol=t,!t){this.DrawEmpty();return}if(n&&n.KLine){var s=n.KLine;v.IsNumber(s.Right)&&(this.Right=s.Right),v.IsNumber(s.Period)&&(this.Period=s.Period)}if(U.IsSHSZIndex(t)&&(this.Right=0),this.ClearIndexPaint(),n){if(v.IsNonEmptyArray(n.Windows))for(var o=n.Windows,l=0;l<o.length&&!(l>=this.WindowIndex.length);++l){var s=o[l];if(s)if(s.Script)this.WindowIndex[l]=new Ie(s.Name,s.Script,s.Args,s);else if(s.API){var h=s.API;this.WindowIndex[l]=new ga(h.Name,h.Script,h.Args,s)}else{var u=s.Index,f=new Z,C=f.Get(u);C&&(Z.ModifyAttribute(C,s),C.ID=u,this.WindowIndex[l]=new Ie(C.Name,C.Script,C.Args,C))}}if(n.CustomShow&&v.IsPlusNumber(n.CustomShow.Date)){var s=n.CustomShow;this.CustomShow={Date:s.Date},v.IsNumber(s.Time)&&(this.CustomShow.Time=s.Time),v.IsPlusNumber(s.PageSize)&&(this.CustomShow.PageSize=s.PageSize)}}this.ReloadChartDrawPicture(),this.Frame.ClearUpDonwFrameYData(),Y.IsDayPeriod(this.Period,!0)?(this.ClearStockCache(),this.RequestHistoryData()):Y.IsMinutePeriod(this.Period,!0)||Y.IsSecondPeriod(this.Period)||Y.IsMilliSecondPeriod(this.Period)?(this.ClearStockCache(),this.RequestHistoryMinuteData()):Y.IsTickPeriod(this.Period)&&(this.ClearStockCache(),this.RequestTickData())},this.ReqeustKLineInfoData=function(t){if(t&&t.FunctionName=="RecvDragDayData")t.Update=!0;else{if(this.ChartPaint.length>0){var n=this.ChartPaint[0];n.InfoData=new Dt.default}t.Update=!1}if(v.IsNonEmptyArray(this.ChartInfo))for(var s=0;s<this.ChartInfo.length;++s)this.ChartInfo[s].RequestData(this,t)},this.SetKLineInfo=function(t,n){this.ChartInfo=[];for(var s in t){var o=_a.Get(t[s]);if(o){var l=o.Create();l.MaxRequestDataCount=this.MaxRequestDataCount,this.ChartInfo.push(l)}}n==!0&&this.ReqeustKLineInfoData({FunctionName:"SetKLineInfo"})},this.AddKLineInfo=function(t,n){var s=_a.GetClassInfo(t);if(!s){console.warn("[KLineChartContainer::AddKLineInfo] can't find infoname=",t);return}for(var o in this.ChartInfo){var h=this.ChartInfo[o];if(h.ClassName==s.ClassName)return}var l=_a.Get(t);if(l){var h=l.Create();h.MaxRequestDataCount=this.MaxRequestDataCount,this.ChartInfo.push(h),n==!0&&h.RequestData(this)}},this.DeleteKLineInfo=function(t){var n=_a.GetClassInfo(t);if(!n){console.warn("[KLineChartContainer::DeleteKLineInfo] can't find infoname=",t);return}for(var s in this.ChartInfo){var o=this.ChartInfo[s];if(o.ClassName==n.ClassName){this.ChartInfo.splice(s,1),this.UpdataChartInfo(),this.Draw();break}}},this.ClearKLineInfo=function(){if(!(!this.ChartInfo||this.ChartInfo.length<=0)){this.ChartInfo=[];var t=this.ChartPaint[0];t.InfoData=null,this.Draw()}},this.OverlaySymbol=function(t,n){for(var s in this.OverlayChartPaint){var o=this.OverlayChartPaint[s];if(o.Symbol===t)return console.warn("[KLineChartContainer::OverlaySymbol] overlay symbol="+t+" exist."),!1}var l=new OC;return l.Canvas=this.Canvas,l.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,l.ChartFrame=this.Frame.SubFrame[0].Frame,l.Name="Overlay-KLine",l.DrawType=this.KLineDrawType,l.Symbol=t,l.Identify="Overlay-KLine-"+t,n&&n.Color?l.Color=n.Color:l.Color=d.OverlaySymbol.Color[d.OverlaySymbol.Random%d.OverlaySymbol.Color.length],l.SetOption(n),++d.OverlaySymbol.Random,this.ChartPaint[0]&&this.ChartPaint[0].Data&&this.SourceData&&(l.MainData=this.ChartPaint[0].Data),this.OverlayChartPaint.push(l),Y.IsDayPeriod(this.Period,!0)?this.RequestOverlayHistoryData():Y.IsMinutePeriod(this.Period,!0)&&this.RequestOverlayHistoryMinuteData(),!0},this.RequestSingleOverlayHistoryData=function(t,n,s,o){var l=this;if(o.Status=Le.STATUS_REQUESTDATA_ID,this.NetworkFilter){var h={Name:"KLineChartContainer::RequestOverlayHistoryData",Explain:"叠加股票日K线数据",Request:{Url:l.KLineApiUrl,Data:{symbol:t,count:n.MaxRequestDataCount,first:{date:s},field:["name","symbol","yclose","open","price","high","vol","amount"]},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(h,function(u){o.Status=Le.STATUS_RECVDATA_ID,l.RecvOverlayHistoryData(u,o)}),h.PreventDefault==!0)return}},this.RequestOverlayHistoryData=function(){if(this.OverlayChartPaint.length&&!(!this.SourceData||!this.SourceData.Data))for(var t=this.GetRequestDataCount(),n=this.SourceData.Data[0].Date,s=0;s<this.OverlayChartPaint.length;++s){var o=this.OverlayChartPaint[s];if(o.MainData&&o.Status==Le.STATUS_NONE_ID){var l=o.Symbol;l&&this.RequestSingleOverlayHistoryData(l,t,n,o)}}},this.RecvOverlayHistoryData=function(t,n){if(!n.IsDelete){var s=de.JsonDataToHistoryData(t),o=new Y;o.Data=s,o.DataType=0;var l=new Y;if(l.Data=s,l.Period=this.Period,l.Right=this.Right,l.DataType=0,l.Right>0&&U.IsSHSZStockA(t.symbol)&&!this.IsApiPeriod){var h=l.GetRightData(l.Right,{AlgorithmType:this.RightFormula});l.Data=h}var u=this.SourceData.GetOverlayData(l.Data,this.IsApiPeriod);if(l.Data=u,Y.IsDayPeriod(l.Period,!1)&&!this.IsApiPeriod){var f=l.GetPeriodData(l.Period);l.Data=f}n.Data=l,n.SourceData=o,n.Title=t.name,n.Symbol=t.symbol,n.Status=Le.STATUS_FINISHED_ID,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=1,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.RequestSingleHistoryMinuteData=function(t,n,s,o,l){var h=this;if(l.Status=Le.STATUS_REQUESTDATA_ID,this.NetworkFilter){var u={Name:"KLineChartContainer::RequestOverlayHistoryMinuteData",Explain:"叠加股票分钟K线数据",Request:{Url:h.MinuteKLineApiUrl,Data:{symbol:t,count:n.MaxRequestMinuteDayCount,first:{date:s,time:o},field:["name","symbol","yclose","open","price","high","vol","amount"]},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(u,function(f){l.Status=Le.STATUS_RECVDATA_ID,h.RecvOveralyHistoryMinuteData(f,l)}),u.PreventDefault==!0)return}},this.RequestOverlayHistoryMinuteData=function(){if(this.OverlayChartPaint.length&&!(!this.SourceData||!this.SourceData.Data))for(var t=this.GetRequestDataCount(),n=this.SourceData.Data[0].Date,s=this.SourceData.Data[0].Time,o=0;o<this.OverlayChartPaint.length;++o){var l=this.OverlayChartPaint[o];if(l.MainData&&l.Status==Le.STATUS_NONE_ID){var h=l.Symbol;h&&this.RequestSingleHistoryMinuteData(h,t,n,s,l)}}},this.RecvOveralyHistoryMinuteData=function(t,n){if(this.EnableVerifyRecvData&&t.symbol!=n.Symbol){k.Chart.Warn("[MinuteChartContainer::RecvOveralyHistoryMinuteData] recv data symbol not match. paint["+n.Symbol+"] , Recv["+t.symbol+"]");return}var s=de.JsonDataToMinuteHistoryData(t);if(s){var o=new Y;o.Data=s,o.DataType=1;var l=new Y;l.Data=s,l.Period=this.Period,l.Right=this.Right,l.DataType=1;var h=this.SourceData.GetOverlayMinuteData(l.Data,this.IsApiPeriod);if(l.Data=h,Y.IsMinutePeriod(l.Period,!1)&&!this.IsApiPeriod){var u=l.GetPeriodData(l.Period);l.Data=u}n.Data=l,n.SourceData=o,n.Title=t.name,n.Symbol=t.symbol,n.Status=Le.STATUS_FINISHED_ID,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=1,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.ClearOverlaySymbol=function(){for(var t in this.OverlayChartPaint){var n=this.OverlayChartPaint[t];n.IsDelete=!0}this.OverlayChartPaint=[],this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=0,this.UpdateFrameMaxMin(),this.Draw()},this.DeleteOverlaySymbol=function(t){for(var n in this.OverlayChartPaint){var s=this.OverlayChartPaint[n];if(s.Symbol===t)return s.IsDelete=!0,this.OverlayChartPaint.splice(n,1),this.OverlayChartPaint.length<=0&&(this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=0),this.UpdateFrameMaxMin(),this.Draw(),!0}return console.warn("[KLineChartContainer::DeleteOverlaySymbol] overlay symbol="+t+" not exist."),!1},this.RequestFlowCapitalData=function(){if(this.Symbol&&this.FlowCapitalReady!=!0){var t=this.Symbol.toUpperCase(),n=!0;if((U.IsBIT(t)||U.IsFutures(t))&&(n=!1),this.EnableFlowCapital&&U.IsBIT(t)&&this.EnableFlowCapital.BIT==!0&&(n=!0),!n){k.Chart.Log("[KLineChartContainer::RequestFlowCapitalData] symbol="+this.Symbol+" not need download data."),this.FlowCapitalReady=!0;return}var s=this,o=["name","date","symbol","capital.a"];if(this.NetworkFilter){var l={Name:"KLineChartContainer::RequestFlowCapitalData",Explain:"流通股本数据",Request:{Url:s.StockHistoryDayApiUrl,Data:{symbol:[this.Symbol],orderfield:"date",field:o},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(l,function(h){s.RecvFlowCapitalData(h)}),l.PreventDefault==!0)return}Vt.HttpRequest({url:this.StockHistoryDayApiUrl,data:{field:o,symbol:[this.Symbol],orderfield:"date"},type:"post",dataType:"json",async:!0,success:function(u){s.RecvFlowCapitalData(u)}})}},this.RecvFlowCapitalData=function(t){if(!(!t.stock||t.stock.length!=1)){var n=t.stock[0];if(this.EnableVerifyRecvData&&n.symbol!=this.Symbol){k.Chart.Warn("[MinuteChartContainer::RecvFlowCapitalData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+n.symbol+"]");return}var s=new Array;for(var o in n.stockday){var l=n.stockday[o],h=new Wt;h.Date=l.date;var u=l.capital;u&&u.a>0&&(h.Value=u.a,s.push(h))}if(this.IsApiPeriod){var f=this.ChartPaint[0].Data,C=null;if(Y.IsMinutePeriod(this.Period,!0)?C=f.GetMinuteFittingFinanceData(s):Y.IsDayPeriod(this.Period,!0)&&(C=f.GetFittingFinanceData(s)),C&&f.Data&&C.length==f.Data.length)for(var D in f.Data){var l=f.Data[D];C[D]&&v.IsNumber(C[D].Value)&&(l.FlowCapital=C[D].Value)}}else if(Y.IsMinutePeriod(this.Period,!0)){for(var C=this.SourceData.GetMinuteFittingFinanceData(s),D=0;D<this.SourceData.Data.length;++D){var l=this.SourceData.Data[D];C[D]&&v.IsNumber(C[D].Value)&&(l.FlowCapital=C[D].Value)}var c=this.ChartPaint[0].Data,T=new Y;if(T.Data=this.SourceData.Data,c.Right>0&&this.RightFormula>=1){var S=T.GetRightData(c.Right,{AlgorithmType:this.RightFormula});T.Data=S}if(Y.IsMinutePeriod(c.Period,!1)){var I=T.GetPeriodData(c.Period);T.Data=I}c.Data=T.Data}else{var C=this.SourceData.GetFittingFinanceData(s);for(var g in this.SourceData.Data){var l=this.SourceData.Data[g];C[g]&&v.IsNumber(C[g].Value)&&(l.FlowCapital=C[g].Value)}var c=this.ChartPaint[0].Data,T=new Y;if(T.Data=this.SourceData.Data,c.Right>0){var S=T.GetRightData(c.Right,{AlgorithmType:this.RightFormula});T.Data=S}if(Y.IsDayPeriod(c.Period,!1)){var I=T.GetPeriodData(c.Period);T.Data=I}c.Data=T.Data}this.FlowCapitalReady=!0;var E=!1;for(var D in this.ExtendChartPaint){var l=this.ExtendChartPaint[D];if(l.ClassName=="StockChip"){E=!0;break}}E&&this.Draw()}},this.CreateChartDrawPicture=function(t,n,s){var o=null,l=gt.GetDrawPictureByName(t);if(l&&(o=l.Create(),(o.ClassName=="ChartDrawPictureText"||o.ClassName=="ChartDrawVolProfile")&&(o.HQChart=this)),!o&&gt.MapIonFont.has(t)){var h=gt.MapIonFont.get(t);o=new ol,o.FontOption.Family=h.Family,o.Text=h.Text,h.Color&&(o.LineColor=h.Color)}if(!o)return!1;o.Canvas=this.Canvas,o.Status=0,o.Symbol=this.Symbol,o.Period=this.Period,o.Right=this.Right,o.Option=this.ChartDrawOption,s&&(o.FinishedCallback=s),n&&o.SetOption(n);var u=this;return o.Update=function(){u.DrawDynamicInfo()},o.GetActiveDrawPicture=function(){return u.GetActiveDrawPicture()},this.CurrentChartDrawPicture=o,!0},this.AddChartDrawPicture=function(t){if(!t||t.FrameID<0||t.FrameID>=this.Frame.SubFrame.length)return null;var n=this,s=gt.GetDrawPictureByClassName(t.ClassName);if(!s)return null;var o=s.Create();return o.Canvas=this.Canvas,o.Status=10,o.Frame=this.Frame.SubFrame[t.FrameID].Frame,o.Symbol=this.Symbol,o.Period=this.Period,o.Right=this.Right,o.Option=this.ChartDrawOption,t.Value&&(o.Value=t.Value),t.Guid&&(o.Guid=t.Guid),o.ImportStorageData&&o.ImportStorageData(t),o.SetOption(t),t.EnableUpdateXValue&&o.UpdateXValue(),o.ValueToPoint(),o.GetActiveDrawPicture=function(){return n.GetActiveDrawPicture()},o.ClassName==="ChartDrawPictureText"&&(o.IsInitialized=!0),this.ChartDrawPicture.push(o),this.DrawDynamicInfo(),o},this.PasteChartDrawPicture=function(t,n,s){if(!t||!t.ClassName||n<0||n>=this.Frame.SubFrame.length)return null;var o=gt.GetDrawPictureByClassName(t.ClassName);if(!o)return null;var l=o.Create();if(!l)return null;var h=this;return l.Canvas=this.Canvas,l.Status=10,l.Frame=this.Frame.SubFrame[n].Frame,l.Symbol=this.Symbol,l.Period=this.Period,l.Right=this.Right,l.Option=this.ChartDrawOption,l.GetActiveDrawPicture=function(){return h.GetActiveDrawPicture()},l.SetOption&&l.SetOption(t),this.RandomDrawPictureValue(l,t),l.PointToValue(),l.ClassName==="ChartDrawPictureText"&&(l.IsInitialized=!0),this.ChartDrawPicture.push(l),this.ChartDrawStorage&&this.ChartDrawStorage.SaveDrawData(l),this.DrawDynamicInfo(),l},this.RandomDrawPictureValue=function(t,n){if(v.IsNonEmptyArray(n.Value)){var s=this.GetKLineChart();if(!s||!s.Data||!v.IsNumber(s.Data.DataOffset)||s.Data.DataOffset<0||!v.IsNonEmptyArray(s.Data.Data))return null;var o=s.Data.Data;s.Data.DataOffset;var l=s.Data.DataOffset+s.ChartFrame.XPointCount-1;l>=o.length&&(l=o.length-1);var h=t.Frame.ChartBorder.GetHeight();t.Frame.HorizontalMax,t.Frame.HorizontalMin;var u=t.Frame.ChartBorder.GetBottomEx()-h*n.YFristScale,f={Max:5,Min:2},C=Math.floor(Math.random()*(f.Max-f.Min+1))+f.Min,D=n.Value[0].XIndex+C;t.Value=[];for(var c=0;c<n.Value.length;++c){var T=n.Value[c];t.Value[c]={XValue:D+T.XOffset},t.Point[c]={Y:u+T.YOffset,X:t.Frame.GetXFromIndex(D+T.XOffset,!1)}}}},this.MoveChartDrawPicture=function(t,n,s,o){var l=this.CurrentChartDrawPicture;if(!l)return!1;var h=B();s&&(h=1);var u=t*h,f=n*h;return l.Move(u,f,o),!0},this.UpdateChartDrawXValue=function(){for(var t in this.ChartDrawPicture){var n=this.ChartDrawPicture[t];n.UpdateXValue()}},this.OnRightMenu=function(t,n,s){var o=B(),l=this.Frame.PtInFrame(t*o,n*o);this.PopupRightMenuV2({X:s.offsetX,Y:s.offsetY,FrameID:l},s);var h=this.GetEventCallback($.ON_CONTEXT_MENU);if(h){var u={X:t,Y:n,Event:s,FrameID:l};h.Callback(h,u,this)}},this.GetRightMenuData=function(t){var n=this.Frame.SubFrame.length,s=this.ChartPaint[0],o=s.DrawType,l=s.IsThinAKBar,h=s.PriceGap,u=s.InfoPosition,f=null,C=null,D=null;this.Frame.SubFrame[0]&&this.Frame.SubFrame[0].Frame&&(D=this.Frame.SubFrame[0].Frame),D&&(f=D.CoordinateType,D.YSplitOperator&&(C=D.YSplitOperator.CoordinateType));for(var c=[],T=0;T<this.ChartInfo.length;++T){var S=this.ChartInfo[T];S&&S.ClassName&&c.push(S.ClassName)}for(var I=[],T=0;T<this.OverlayChartPaint.length;++T){var S=this.OverlayChartPaint[T];S&&S.Symbol&&I.push(S.Symbol)}var g=!1,E=!1;this.GetExtendChartByClassName("SessionBreaksPaint")&&(g=!0),this.GetStockChipChart()&&(E=!0);var F={Name:"StockChip",ShowType:1,Width:230},R=!1;this.ChartCorssCursor&&(R=this.ChartCorssCursor.IsShowCorss);var A=!1;this.PopMinuteChart&&(A=!0);var P=[{Name:"分析周期",SubMenu:[{Name:"日线",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[0]},Checked:this.Period==0},{Name:"周线",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[1]},Checked:this.Period==1},{Name:"双周线",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[21]},Checked:this.Period==21},{Name:"月线",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[2]},Checked:this.Period==2},{Name:"季线",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[9]},Checked:this.Period==9},{Name:"半年",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[22]},Checked:this.Period==22},{Name:"年线",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[3]},Checked:this.Period==3},{Name:"1分",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[4]},Checked:this.Period==4},{Name:"5分",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[5]},Checked:this.Period==5},{Name:"15分",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[6]},Checked:this.Period==6},{Name:"30分",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[7]},Checked:this.Period==7},{Name:"60分",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[8]},Checked:this.Period==8},{Name:"2小时",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[11]},Checked:this.Period==11},{Name:"4小时",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[12]},Checked:this.Period==12},{Name:"分笔",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[10]},Checked:this.Period==10},{Name:"自定义周期:3分钟",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[20003]},Checked:this.Period==20003},{Name:"自定义周期:35分钟",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[20035]},Checked:this.Period==20035},{Name:"自定义周期:8日",Data:{ID:q.CMD_CHANGE_PERIOD_ID,Args:[40008]},Checked:this.Period==40008}]},{Name:"指标切换",SubMenu:[{Name:"均线",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"均线"]}},{Name:"BOLL",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"BOLL"]}},{Name:"MACD",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"MACD"]}},{Name:"MACD(粗)",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"MACD2"]}},{Name:"KDJ",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"KDJ"]}},{Name:"VOL",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"VOL"]}},{Name:"RSI",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"RSI"]}},{Name:"BRAR",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"BRAR"]}},{Name:"WR",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"WR"]}}]},{Name:"五彩K线",SubMenu:[{Name:"十字星",Data:{ID:q.CMD_CHANGE_COLOR_INDEX_ID,Args:["五彩K线-十字星"]}},{Name:"早晨之星",Data:{ID:q.CMD_CHANGE_COLOR_INDEX_ID,Args:["五彩K线-早晨之星"]}},{Name:"垂死十字",Data:{ID:q.CMD_CHANGE_COLOR_INDEX_ID,Args:["五彩K线-垂死十字"]}},{Name:"三只乌鸦",Data:{ID:q.CMD_CHANGE_COLOR_INDEX_ID,Args:["五彩K线-三只乌鸦"]}},{Name:"光脚阴线",Data:{ID:q.CMD_CHANGE_COLOR_INDEX_ID,Args:["五彩K线-光脚阴线"]}},{Name:"黄昏之星",Data:{ID:q.CMD_CHANGE_COLOR_INDEX_ID,Args:["五彩K线-黄昏之星"]}}]},{Name:"专家系统",SubMenu:[{Name:"BIAS",Data:{ID:q.CMD_CHANGE_TRADE_INDEX_ID,Args:["交易系统-BIAS"]}},{Name:"CCI",Data:{ID:q.CMD_CHANGE_TRADE_INDEX_ID,Args:["交易系统-CCI"]}},{Name:"DMI",Data:{ID:q.CMD_CHANGE_TRADE_INDEX_ID,Args:["交易系统-DMI"]}},{Name:"KD",Data:{ID:q.CMD_CHANGE_TRADE_INDEX_ID,Args:["交易系统-KD"]}},{Name:"BOLL",Data:{ID:q.CMD_CHANGE_TRADE_INDEX_ID,Args:["交易系统-BOLL"]}},{Name:"KDJ",Data:{ID:q.CMD_CHANGE_TRADE_INDEX_ID,Args:["交易系统-KDJ"]}}]},{Name:"信息地雷",SubMenu:[{Name:"公告",Data:{ID:q.CMD_CHANGE_KLINE_INFO_ID,Args:["公告",!c.includes("AnnouncementInfo")]},Checked:c.includes("AnnouncementInfo")},{Name:"业绩预告",Data:{ID:q.CMD_CHANGE_KLINE_INFO_ID,Args:["业绩预告",!c.includes("PforecastInfo")]},Checked:c.includes("PforecastInfo")},{Name:"调研",Data:{ID:q.CMD_CHANGE_KLINE_INFO_ID,Args:["调研",!c.includes("ResearchInfo")]},Checked:c.includes("ResearchInfo")},{Name:"大宗交易",Data:{ID:q.CMD_CHANGE_KLINE_INFO_ID,Args:["大宗交易",!c.includes("BlockTrading")]},Checked:c.includes("BlockTrading")},{Name:"龙虎榜",Data:{ID:q.CMD_CHANGE_KLINE_INFO_ID,Args:["龙虎榜",!c.includes("TradeDetail")]},Checked:c.includes("TradeDetail")},{Name:"互动易",Data:{ID:q.CMD_CHANGE_KLINE_INFO_ID,Args:["互动易",!c.includes("InvestorInfo")]},Checked:c.includes("InvestorInfo")},{Name:Ne.SEPARATOR_LINE_NAME},{Name:"显示位置",SubMenu:[{Name:"底部",Data:{ID:q.CMD_CHANGE_INFO_POSITION_ID,Args:[1]},Checked:u===1},{Name:"K线上",Data:{ID:q.CMD_CHANGE_INFO_POSITION_ID,Args:[0]},Checked:u===0}]}]},{Name:"缺口提示",SubMenu:[{Name:"显示1个缺口",Data:{ID:q.CMD_CHANGE_PRICE_GAP_ID,Args:[!0,1]},Checked:h.Enable==!0&&h.Count==1},{Name:"显示2个缺口",Data:{ID:q.CMD_CHANGE_PRICE_GAP_ID,Args:[!0,2]},Checked:h.Enable==!0&&h.Count==2},{Name:"显示3个缺口",Data:{ID:q.CMD_CHANGE_PRICE_GAP_ID,Args:[!0,3]},Checked:h.Enable==!0&&h.Count==3},{Name:"隐藏缺口",Data:{ID:q.CMD_CHANGE_PRICE_GAP_ID,Args:[!1]},Checked:h.Enable==!1}]},{Name:"叠加品种",SubMenu:[{Name:"上证指数",Data:{ID:q.CMD_OVERLAY_SYMBOL_ID,Args:["000001.sh",!I.includes("000001.sh")]},Checked:I.includes("000001.sh")},{Name:"深证成指",Data:{ID:q.CMD_OVERLAY_SYMBOL_ID,Args:["399001.sz",!I.includes("399001.sz")]},Checked:I.includes("399001.sz")},{Name:"中小板指",Data:{ID:q.CMD_OVERLAY_SYMBOL_ID,Args:["399005.sz",!I.includes("399005.sz")]},Checked:I.includes("399005.sz")},{Name:"创业板指",Data:{ID:q.CMD_OVERLAY_SYMBOL_ID,Args:["399006.sz",!I.includes("399006.sz")]},Checked:I.includes("399006.sz")},{Name:"沪深300",Data:{ID:q.CMD_OVERLAY_SYMBOL_ID,Args:["000300.sh",!I.includes("000300.sh")]},Checked:I.includes("000300.sh")}]},{Name:"主图线型",SubMenu:[{Name:"K线(空心阳线)",Data:{ID:q.CMD_CHANGE_KLINE_TYPE_ID,Args:[3]},Checked:o==3},{Name:"K线(实心阳线)",Data:{ID:q.CMD_CHANGE_KLINE_TYPE_ID,Args:[0]},Checked:o==0},{Name:"美国线",Data:{ID:q.CMD_CHANGE_KLINE_TYPE_ID,Args:[2,!0,{IsThinAKBar:!1}]},Checked:o==2&&!l},{Name:"美国线(细)",Data:{ID:q.CMD_CHANGE_KLINE_TYPE_ID,Args:[2,!0,{IsThinAKBar:!0}]},Checked:o==2&&l},{Name:"收盘线",Data:{ID:q.CMD_CHANGE_KLINE_TYPE_ID,Args:[1]},Checked:o==1},{Name:"收盘面积",Data:{ID:q.CMD_CHANGE_KLINE_TYPE_ID,Args:[4]},Checked:o==4},{Name:"K线(空心阳线阴线)",Data:{ID:q.CMD_CHANGE_KLINE_TYPE_ID,Args:[6]},Checked:o==6},{Name:"Heikin Ashi",Data:{ID:q.CMD_CHANGE_KLINE_TYPE_ID,Args:[11]},Checked:o==11},{Name:"Line Break",Data:{ID:q.CMD_CHANGE_KLINE_TYPE_ID,Args:[12]},Checked:o==12},{Name:"High-low",Data:{ID:q.CMD_CHANGE_KLINE_TYPE_ID,Args:[13]},Checked:o==13},{Name:"HLC Area",Data:{ID:q.CMD_CHANGE_KLINE_TYPE_ID,Args:[15]},Checked:o==15}]},{Name:"坐标类型",SubMenu:[{Name:"反转坐标",Data:{ID:q.CMD_CHANGE_COORDINATETYPE_ID,Args:[{IsReverse:f==0}]},Checked:f==1},{Name:Ne.SEPARATOR_LINE_NAME},{Name:"普通坐标",Data:{ID:q.CMD_CHANGE_COORDINATETYPE_ID,Args:[{Type:0}]},Checked:C==0},{Name:"百分比坐标",Data:{ID:q.CMD_CHANGE_COORDINATETYPE_ID,Args:[{Type:1}]},Checked:C==1},{Name:"对数坐标",Data:{ID:q.CMD_CHANGE_COORDINATETYPE_ID,Args:[{Type:2}]},Checked:C==2},{Name:"等比坐标",Data:{ID:q.CMD_CHANGE_COORDINATETYPE_ID,Args:[{Type:3}]},Checked:C==3},{Name:"等分坐标",Data:{ID:q.CMD_CHANGE_COORDINATETYPE_ID,Args:[{Type:4}]},Checked:C==4},{Name:"黄金分割",Data:{ID:q.CMD_CHANGE_COORDINATETYPE_ID,Args:[{Type:5}]},Checked:C==5}]},{Name:"指标窗口个数",SubMenu:[{Name:"1个窗口",Data:{ID:q.CMD_CHANGE_WINDOW_COUNT_ID,Args:[2]},Checked:n==2},{Name:"2个窗口",Data:{ID:q.CMD_CHANGE_WINDOW_COUNT_ID,Args:[3]},Checked:n==3},{Name:"3个窗口",Data:{ID:q.CMD_CHANGE_WINDOW_COUNT_ID,Args:[4]},Checked:n==4},{Name:"4个窗口",Data:{ID:q.CMD_CHANGE_WINDOW_COUNT_ID,Args:[5]},Checked:n==5},{Name:"5个窗口",Data:{ID:q.CMD_CHANGE_WINDOW_COUNT_ID,Args:[6]},Checked:n==6}]},{Name:"其他设置",SubMenu:[{Name:"禁止拖拽",Data:{ID:q.CMD_CHANGE_DRAG_MODE_ID,Args:[0]},Checked:this.DragMode==0},{Name:"启动拖拽",Data:{ID:q.CMD_CHANGE_DRAG_MODE_ID,Args:[1]},Checked:this.DragMode==1},{Name:"左键区间选择",Data:{ID:q.CMD_CHANGE_DRAG_MODE_ID,Args:[2]},Checked:this.DragMode==2},{Name:Ne.SEPARATOR_LINE_NAME},{Name:"背景分割",Data:{ID:q.CMD_CHANGE_BG_SPLIT_ID,Args:[!g]},Checked:g},{Name:"画图工具",Data:{ID:q.CMD_SHOW_DRAWTOOL_ID,Args:[]},Checked:this.IsShowDrawToolDialog()},{Name:"移动筹码图",Data:{ID:E?q.CMD_HIDE_STOCKCHIP_ID:q.CMD_SHOW_STOCKCHIP_ID,Args:[F.Name,F]},Checked:E},{Name:"十字光标线",Data:{ID:q.CMD_SHOW_CORSS_LINE_ID,Args:[!R]},Checked:R},{Name:"双击弹分时图",Data:{ID:q.CMD_ENABLE_POP_MINUTE_CHART_ID,Args:[!A]},Checked:A},{Name:Ne.SEPARATOR_LINE_NAME},{Name:"鼠标形状",SubMenu:[{Name:"默认",Data:{ID:q.CMD_CHANGE_DEFAULTCURSOR_ID,Args:["default"]},Checked:this.DefaultCursor=="default"},{Name:"十字线",Data:{ID:q.CMD_CHANGE_DEFAULTCURSOR_ID,Args:["crosshair"]},Checked:this.DefaultCursor=="crosshair"}]},{Name:"语言设置",SubMenu:[{Name:"中文",Data:{ID:q.CMD_CHANGE_LANGUAGE_ID,Args:["CN"]},Checked:this.LanguageID==xe.LANGUAGE_CHINESE_ID},{Name:"英语",Data:{ID:q.CMD_CHANGE_LANGUAGE_ID,Args:["EN"]},Checked:this.LanguageID==xe.LANGUAGE_ENGLISH_ID},{Name:"繁体",Data:{ID:q.CMD_CHANGE_LANGUAGE_ID,Args:["TC"]},Checked:this.LanguageID==xe.LANGUAGE_TRADITIONAL_CHINESE_ID}]},{Name:"区间选择样式",SubMenu:[{Name:"样式1(默认)",Data:{ID:q.CMD_CHANGE_DRAG_RECT_SHOW_MODE_ID,Args:[0]},Checked:this.ChartDragSelectRect.ShowMode==0},{Name:"样式2",Data:{ID:q.CMD_CHANGE_DRAG_RECT_SHOW_MODE_ID,Args:[1]},Checked:this.ChartDragSelectRect.ShowMode==1},{Name:"样式3",Data:{ID:q.CMD_CHANGE_DRAG_RECT_SHOW_MODE_ID,Args:[2]},Checked:this.ChartDragSelectRect.ShowMode==2}]},{Name:"K线浮动框",SubMenu:[{Name:"禁用",Data:{ID:q.CMD_DIALOG_TOOLTIP_ATTRIBUTE,Args:[{Enable:!1}]},Checked:!this.DialogTooltip},{Name:"样式1",Data:{ID:q.CMD_DIALOG_TOOLTIP_ATTRIBUTE,Args:[{Enable:!0,Style:0}]},Checked:this.DialogTooltip&&this.DialogTooltip.Style===0},{Name:"样式2",Data:{ID:q.CMD_DIALOG_TOOLTIP_ATTRIBUTE,Args:[{Enable:!0,Style:1}]},Checked:this.DialogTooltip&&this.DialogTooltip.Style===1}]},{Name:"K线提示框",SubMenu:[{Name:"启用",Data:{ID:q.CMD_KLINE_TOOLTIP_ATTRIBUTE,Args:[{Enable:!this.KLineTooltipConfig.Enable}]},Checked:this.KLineTooltipConfig.Enable},{Name:"键盘左右显示",Data:{ID:q.CMD_KLINE_TOOLTIP_ATTRIBUTE,Args:[{EnableKeyDown:!this.KLineTooltipConfig.EnableKeyDown}]},Checked:this.KLineTooltipConfig.EnableKeyDown}]}]}];if(!U.IsSHSZIndex(this.Symbol)&&!U.IsBIT(this.Symbol)){var p={Name:"复权处理",SubMenu:[{Name:"不复权",Data:{ID:q.CMD_CHANGE_RIGHT_ID,Args:[0]},Checked:this.Right==0},{Name:"前复权",Data:{ID:q.CMD_CHANGE_RIGHT_ID,Args:[1]},Checked:this.Right==1},{Name:"后复权",Data:{ID:q.CMD_CHANGE_RIGHT_ID,Args:[2]},Checked:this.Right==2}]};P.splice(1,0,p)}for(var T=0;T<P.length;++T){var S=P[T];if(S.Name=="五彩K线")this.ColorIndex&&(S.SubMenu.push({Name:Ne.SEPARATOR_LINE_NAME}),S.SubMenu.push({Name:"删除五彩K线",Data:{ID:q.CMD_DELETE_COLOR_INDEX_ID}}));else if(S.Name=="专家系统")this.TradeIndex&&(S.SubMenu.push({Name:Ne.SEPARATOR_LINE_NAME}),S.SubMenu.push({Name:"删除专家系统",Data:{ID:q.CMD_DELETE_TRADE_INDEX_ID}}));else if(S.Name=="叠加品种"){for(var w=0;w<S.SubMenu.length;++w)if(S.SubMenu[w].Checked){S.SubMenu.push({Name:Ne.SEPARATOR_LINE_NAME}),S.SubMenu.push({Name:"取消叠加",Data:{ID:q.CMD_DELETE_ALL_OVERLAY_SYMBOL_ID}});break}}else if(S.Name=="信息地雷"){for(var w=0;w<S.SubMenu.length;++w)if(S.SubMenu[w].Checked){S.SubMenu.push({Name:Ne.SEPARATOR_LINE_NAME}),S.SubMenu.push({Name:"删除所有",Data:{ID:q.CMD_DELETE_ALL_KLINE_INFO_ID}});break}}}return P},this.PopupSelectRectMenuV2=function(t,n){var s=this,o=[{Name:"区间统计",Data:{ID:q.CMD_SELECTED_SUMMARY_ID,Args:[n]}},{Name:"区间放大",Data:{ID:q.CMD_SELECTED_ZOOM_ID,Args:[t.SelectData]}}],l={Menu:o,Position:Ne.POSITION_ID.RIGHT_MENU_ID};l.ClickCallback=function(f){s.OnClickRightMenu(f)};var h=t.X,u=t.Y;this.PopupMenuByRClick(l,h,u)},this.ReloadChartDrawPicture=function(){if(this.ChartDrawPicture=[],this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.IsSelected=!1),this.SelectChartDrawPicture=null,this.CurrentChartDrawPicture=null,this.ChartDrawStorage){this.ChartDrawStorageCache=this.ChartDrawStorage.GetDrawData({Symbol:this.Symbol,Period:this.Period});var t=this.GetEventCallback($.ON_LOAD_DRAWPICTURE);if(t&&t.Callback){var n={Symbol:this.Symbol,Period:this.Period,DrawStorage:this.ChartDrawStorage,ChartDrawStorageCache:this.ChartDrawStorageCache};t.Callback(t,n,this)}}},this.CreateChartDrawPictureByStorage=function(){if(v.IsNonEmptyArray(this.ChartDrawStorageCache)){for(var t=0;t<this.ChartDrawStorageCache.length;++t){var n=this.ChartDrawStorageCache[t];if(!(n.FrameID<0||!this.Frame.SubFrame||this.Frame.SubFrame.length<n.FrameID)){var s=gt.CreateChartDrawPicture(n);if(s){s.Canvas=this.Canvas,s.Status=10,s.Frame=this.Frame.SubFrame[n.FrameID].Frame,s.Option=this.ChartDrawOption,s.ImportStorageData&&s.ImportStorageData(n),s.UpdateXValue(),s.ValueToPoint();var o=this;s.GetActiveDrawPicture=function(){return o.GetActiveDrawPicture()},s.ClassName==="ChartDrawPictureText"&&(s.IsInitialized=!0),this.ChartDrawPicture.push(s)}}}this.ChartDrawStorageCache=null}},this.UpdataChartInfo=function(){var t=null;if(this.Period==0){t=new Dt.default;for(var n in this.ChartInfo){var s=this.ChartInfo[n].Data;for(var o in s){var l=s[o];t.has(l.Date.toString())?t.get(l.Date.toString()).Data.push(l):t.set(l.Date.toString(),{Data:new Array(l)})}}}else if(Y.IsDayPeriod(this.Period,!1)){t=new Dt.default;var h=this.ChartPaint[0].Data;if(h&&h.Data&&h.Data.length>0){var u=h.Data[0],f=[];for(var n in this.ChartInfo){var C=this.ChartInfo[n];for(var o in C.Data){var l=C.Data[o];l.Date>=u.Date&&f.push(l)}}f.sort(function(I,g){return I.Date-g.Date});for(var n=0;n<h.Data.length;){var D=h.Data[n];if(f.length<=0)break;var C=f[0];if(D.Date<C.Date){++n;continue}t.has(D.Date.toString())?t.get(D.Date.toString()).Data.push(C):t.set(D.Date.toString(),{Data:new Array(C)}),f.shift()}}}else if(Y.IsMinutePeriod(this.Period,!0)){t=new Dt.default;var h=this.ChartPaint[0].Data;if(h&&h.Data&&h.Data.length>0){for(var c=h.Data[0],f=[],n=0,o=0;n<this.ChartInfo.length;++n){var C=this.ChartInfo[n];for(o=0;o<C.Data.length;++o){var l=C.Data[o];(l.Date>=c.Date||l.Date==c.Date&&l.Time>=c.Time)&&f.push(l)}}f.sort(function(E,F){return E.Date==F.Date?E.Time-F.Time:E.Date-F.Date});for(var n=0;n<h.Data.length;){var D=h.Data[n];if(f.length<=0)break;var C=f[0];if(D.Date<C.Date||D.Date==C.Date&&D.Time<C.Time){++n;continue}var T=D.Date+"-"+D.Time;t.has(T)?t.get(T).Data.push(C):t.set(T,{Data:new Array(C)}),f.shift()}}}var S=this.ChartPaint[0];S.InfoData=t},this.RecvWindowIndex=function(t,n){var s=this.WindowIndex[t];if(s&&typeof s.RecvSubscribeData=="function"){var o=this.ChartPaint[0].Data;s.RecvSubscribeData(n,this,t,o)}},this.UpdateWindowIndex=function(t){var n=new Y;if(n.Data=this.SourceData.Data,n.Period=this.Period,n.Right=this.Right,!this.IsApiPeriod){if(n.Right>0){var s=n.GetRightData(n.Right,{AlgorithmType:this.RightFormula});n.Data=s}if(Y.IsDayPeriod(n.Period,!1)||Y.IsMinutePeriod(n.Period,!1)){var o=n.GetPeriodData(n.Period);n.Data=o}}if(typeof this.WindowIndex[t].ExecuteScript=="function"){var l=this.ChartPaint[0].Data;this.WindowIndex[t].ExecuteScript(this,t,l)}else if(typeof this.WindowIndex[t].RequestData=="function"){var l=this.ChartPaint[0].Data;this.WindowIndex[t].RequestData(this,t,l,null)}else this.WindowIndex[t].BindData(this,t,n);this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.GetOverlayIndexByIdentify=function(t){for(var n=0;n<this.Frame.SubFrame.length;++n){var s=this.Frame.SubFrame[n];if(v.IsNonEmptyArray(s.OverlayIndex))for(var o=0;o<s.OverlayIndex.length;++o){var l=s.OverlayIndex[o];if(l.Identify===t)return{OverlayItem:l,WindowIndex:n}}}return null},this.RecvOverlayIndex=function(t,n){var s=this.GetOverlayIndexByIdentify(t);if(s==null){console.warn("[KLineChartContainer::RecvOverlayIndex] can't find overlay index. [identify="+t+"]");return}if(s.Script&&typeof s.RecvSubscribeData=="function"&&this.ChartPaint[0]){var o=this.ChartPaint[0].Data;o&&s.Script.RecvSubscribeData(n,this,s.WindowIndex,o)}},this.UpdateOverlayIndex=function(t){var n=this.GetOverlayIndexByIdentify(t);if(n==null){console.warn("[KLineChartContainer::UpdateOverlayIndex] can't find overlay index. [identify="+t+"]");return}if(this.ChartPaint[0]){var s=this.ChartPaint[0].Data;s&&this.BindOverlayIndexData(n.OverlayItem,n.WindowIndex,s)}},this.ChangeWindowIndexParam=function(t){this.WindowIndex[t].Index[0].Param+=1,this.WindowIndex[t].Index[1].Param+=1,this.UpdateWindowIndex(t)},this.OnDoubleClick=function(t,n,s){if(this.EnableYDrag&&(this.EnableYDrag.Left||this.EnableYDrag.Right)&&this.Frame&&this.Frame.PtInFrameY){var o=B(),t=(s.clientX-this.UIElement.getBoundingClientRect().left)*o,n=(s.clientY-this.UIElement.getBoundingClientRect().top)*o,l=this.Frame.PtInFrameY(t,n);l&&l.Index>=0&&this.CancelZoomUpDownFrameY(l)}var h;this.SelectedChart.EnableSelected&&(h=this.PtInChart(t,n));var u={SelectedChart:h};if(this.DBClickEvent(u,s),!h&&this.EnableZoomIndexWindow){var f=this.Frame.PtInFrame(t,n);if(k.Chart.Log("[KLineChartContainer::OnDoubleClick] frameId",f),f>=this.Frame.ZoomStartWindowIndex&&this.ZoomIndexWindow(f,{X:t,Y:n}))return this.Frame.SetSizeChage(!0),this.Draw(),!0}var C=new ns;if(!(!this.PtInChartPaintTooltip(t,n,C)&&!this.PtInOverlayIndexTooltip(t,n,C))&&C.Data){var D=null;if(this.mapEvent.has($.DBCLICK_KLINE)&&(D=this.mapEvent.get($.DBCLICK_KLINE)),D){this.ClickChartTimer!=null&&(clearTimeout(this.ClickChartTimer),this.ClickChartTimer=null);var c={Tooltip:C,Stock:{Symbol:this.Symbol,Name:this.Name},X:s.clientX,Y:s.clientY,PreventDefault:!1};if(D.Callback(D,c,this),c.PreventDefault)return}this.PopMinuteChart&&C.Type===0&&this.ShowMinuteChartDialog({Chart:this,Tooltip:C,e:s},t,n)}},this.CancelAutoUpdate=function(){typeof this.AutoUpdateTimer=="number"&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=void 0)},this.AutoUpdate=function(t){if(this.CancelAutoUpdate(),!!this.IsAutoUpdate&&this.Symbol){var n=this,s=U.GetMarketStatus(this.Symbol);if(s==0||s==3){this.AutoUpdateTimer=setTimeout(function(){n.AutoUpdate()},2e4);return}var o=this.AutoUpdateFrequency;s==1?this.AutoUpdateTimer=setTimeout(function(){n.AutoUpdate()},o):s==2&&(this.AutoUpdateTimer=setTimeout(function(){Y.IsDayPeriod(n.Period,!0)?n.RequestRealtimeData():Y.IsMinutePeriod(n.Period,!0)||Y.IsSecondPeriod(n.Period)||Y.IsMilliSecondPeriod(n.Period)?n.RequestMinuteRealtimeData():Y.IsTickPeriod(n.Period)&&n.RequestTickRealtimeData()},o))}},this.GetMaxMinPageSize=function(){var t={},n=this.Frame.ChartBorder.GetWidth(),s=ue[ue.length-1][0]+ue[ue.length-1][1];return t.Max=parseInt(n/s)-2,s=ue[0][0]+ue[0][1],t.Min=parseInt(n/s)-2,k.Chart.Log("[KLineChartContainer::GetMaxMinPageSize] Max="+t.Max+" Min="+t.Min),t},this.GetChartStatus=function(){var t=this.Frame.SubFrame[0].Frame;if(!t)return null;var n=t.Data;if(!n)return null;var s={KLine:{},Zoom:{}};return s.KLine.Count=n.Data.length,s.KLine.Offset=n.DataOffset,s.KLine.PageSize=t.XPointCount,s.Zoom.Index=t.ZoomIndex,s.Zoom.Max=ue.length,s},this.DragDownloadData=function(){var t=null;if(this.Frame.Data?t=this.Frame.SubFrame[0].Frame.Data:t=this.Frame.Data,!t)return!1;if(!(t.DataOffset>0)){if(Y.IsMinutePeriod(this.Period,!0)||Y.IsSecondPeriod(this.Period)){if(k.Chart.Log("[KLineChartContainer.DragDownloadData] Minute:[Enable="+this.DragDownload.Minute.Enable+", IsEnd="+this.DragDownload.Minute.IsEnd+", Status="+this.DragDownload.Minute.Status+", Period="+this.Period+"]"),!this.DragDownload.Minute.Enable||this.DragDownload.Minute.IsEnd||this.DragDownload.Minute.Status!=0)return;this.RequestDragMinuteData()}else if(Y.IsDayPeriod(this.Period,!0)){if(k.Chart.Log("[KLineChartContainer.DragDownloadData] Day:[Enable="+this.DragDownload.Minute.Enable+", IsEnd="+this.DragDownload.Minute.IsEnd+", Status="+this.DragDownload.Minute.Status+"]"),!this.DragDownload.Day.Enable||this.DragDownload.Day.IsEnd||this.DragDownload.Day.Status!=0)return;this.RequestDragDayData()}else if(Y.IsTickPeriod(this.Period)){if(k.Chart.Log("[KLineChartContainer.DragDownloadData] Tick:[Enable="+this.DragDownload.Tick.Enable+", IsEnd="+this.DragDownload.Tick.IsEnd+", Status="+this.DragDownload.Tick.Status+"]"),!this.DragDownload.Tick.Enable||this.DragDownload.Tick.IsEnd||this.DragDownload.Tick.Status!=0)return;this.RequestDragTickData()}}},this.ZoomDownloadData=function(t){var n=null;if(this.Frame.Data?n=this.Frame.SubFrame[0].Frame.Data:n=this.Frame.Data,!n)return!1;if(!(n.DataOffset>0)){if(Y.IsMinutePeriod(this.Period,!0)||Y.IsSecondPeriod(this.Period)){if(k.Chart.Log("[KLineChartContainer.ZoomDownloadData] Minute:[Enable="+this.ZoomDownload.Minute.Enable+", IsEnd="+this.ZoomDownload.Minute.IsEnd+", Status="+this.DragDownload.Minute.Status+", Period="+this.Period+"]"),!this.ZoomDownload.Minute.Enable||this.ZoomDownload.Minute.IsEnd||this.ZoomDownload.Minute.Status!=0)return;this.RequestZoomMinuteData(t)}else if(Y.IsDayPeriod(this.Period,!0)){if(k.Chart.Log("[KLineChartContainer.ZoomDownloadData] Day:[Enable="+this.ZoomDownload.Minute.Enable+", IsEnd="+this.ZoomDownload.Minute.IsEnd+", Status="+this.DragDownload.Minute.Status+"]"),!this.ZoomDownload.Day.Enable||this.ZoomDownload.Day.IsEnd||this.ZoomDownload.Day.Status!=0)return;this.RequestZoomDayData(t)}else if(Y.IsTickPeriod(this.Period)){if(k.Chart.Log("[KLineChartContainer.ZoomDownloadData] Tick:[Enable="+this.ZoomDownload.Tick.Enable+", IsEnd="+this.ZoomDownload.Tick.IsEnd+", Status="+this.DragDownload.Tick.Status+"]"),!this.ZoomDownload.Tick.Enable||this.ZoomDownload.Tick.IsEnd||this.ZoomDownload.Tick.Status!=0)return;this.RequestZoomTickData(t)}}},this.RequestDragTickData=function(){k.Chart.Log("[KLineChartContainer.RequestDragTickData] not finished.")},this.RequestPreviousMinuteData=function(t){var n=t.FuncName,s=t.FuncExplain,o=t.Download,l=t.Url,h=t.Count,u=this;this.AutoUpdateEvent(!1,n),this.CancelAutoUpdate(),o.Status=1;var f=null;v.IsNonEmptyArray(this.SourceData.Data)?f=this.SourceData.Data[0]:f={Date:null,Time:null};var C={field:["name","symbol","yclose","open","price","high","low","vol"],symbol:u.Symbol,enddate:f.Date,endtime:f.Time,count:h,first:{date:f.Date,time:f.Time}};if(v.IsNonEmptyArray(this.OverlayChartPaint)){C.overlay=[];for(var D=0;D<this.OverlayChartPaint.length;++D){var c=this.OverlayChartPaint[D];C.overlay.push({symbol:c.Symbol})}}if(this.NetworkFilter){var T={Name:n,Explain:s,Request:{Url:l,Type:"POST",Data:C,Period:this.Period,Right:this.Right},DragDownload:o,Option:t,Self:this,PreventDefault:!1,ZoomData:t.ZoomData};if(this.NetworkFilter(T,function(S){u.RecvPreviousMinuteData(S,t),o.Status=0,u.AutoUpdateEvent(!0,n),u.AutoUpdate()}),T.PreventDefault==!0)return}Vt.HttpRequest({url:l,data:C,type:"post",dataType:"json",async:!0,success:function(I){u.RecvPreviousMinuteData(I,t),o.Status=0,u.AutoUpdateEvent(!0,n),u.AutoUpdate()}})},this.RecvPreviousMinuteData=function(t,n){var s=n.Download,o=de.JsonDataToMinuteHistoryData(t);if(!o||o.length<=0){s.IsEnd=!0,k.Chart.Log("[KLineChartContainer.RecvPreviousMinuteData] "+this.Symbol+" data end. FuncName="+n.FuncName),this.Draw();return}var l=this.GetHistoryDataCount(),h=null;if(v.IsNonEmptyArray(this.SourceData.Data))for(var u=this.SourceData.Data[0],f=o.length-1;f>=0;--f){var C=o[f];if(u.Date>C.Date||u.Date==C.Date&&u.Time>C.Time){h=f;break}else if(u.Date==C.Date&&u.Time==C.Time){u.YClose=C.YClose,h=f-1;break}}else h=o.length-1;if(!(h==null&&h<0)){for(var f=0;f<o.length&&f<=h;++f){var C=o[f];this.SourceData.Data.splice(f,0,C)}var D=new Y;if(D.Data=this.SourceData.Data,D.Period=this.Period,D.Right=this.Right,D.DataType=this.SourceData.DataType,D.Symbol=this.Symbol,!this.IsApiPeriod){if(D.Right>0&&this.RightFormula>=1){var c=D.GetRightData(D.Right,{AlgorithmType:this.RightFormula});D.Data=c}if(Y.IsDayPeriod(D.Period,!1)||Y.IsMinutePeriod(D.Period,!1)){var T=D.GetPeriodData(D.Period);D.Data=T}}var S=this.GetKLineCalulate();if(S){var I=S.RecvHistoryData(D,{Symbol:this.Symbol,Function:n.RecvFuncName});D=I,this.FlowCapitalReady=!0}if(this.UpdateMainData(D,l),n)if(n.ZoomData){var g=n.ZoomData,E=g.PageSize-g.RightSpaceCount;D.DataOffset=D.Data.length-E,D.DataOffset<0&&(D.DataOffset=0)}else v.IsNumber(n.DataOffset)&&(D.DataOffset+=n.DataOffset,D.DataOffset<0&&(D.DataOffset=0));this.UpdateOverlayDragMinuteData(t),this.BindInstructionIndexData(D);for(var f=0;f<this.Frame.SubFrame.length;++f)this.BindIndexData(f,D);this.BindAllOverlayIndexData(D,{SyncExecute:!0}),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdateChartDrawXValue(),this.Draw(),this.BindAllOverlayIndexData(D,{SyncExecute:!1})}},this.RequestZoomMinuteData=function(t){var n={PageSize:t.PageSize,DataCount:t.DataCount,RightSpaceCount:t.RightSpaceCount},s={FuncName:"KLineChartContainer::RequestZoomMinuteData",FuncExplain:"缩放分钟|秒K线数据下载",RecvFuncName:"RecvZoomMinuteData",Download:this.ZoomDownload.Minute,Url:this.ZoomMinuteKLineApiUrl,Count:this.MaxRequestMinuteDayCount,XShowCount:this.Frame.GetXShowCount(),ZoomData:n};this.RequestPreviousMinuteData(s)},this.RequestDragMinuteData=function(){var t={FuncName:"KLineChartContainer::RequestDragMinuteData",FuncExplain:"拖拽分钟|秒K线数据下载",RecvFuncName:"RecvDragMinuteData",Download:this.DragDownload.Minute,Url:this.DragMinuteKLineApiUrl,Count:this.MaxRequestMinuteDayCount,XShowCount:this.Frame.GetXShowCount()};this.RequestPreviousMinuteData(t)},this.MergeOverlaySymbolMinuteData=function(t,T){if(t.Symbol,!v.IsNonEmptyArray(T))return!1;for(var s=null,o=0;o<T.length;++o){var l=T[o];if(l.symbol==t.Symbol){s=l;break}}if(!s)return!1;for(var h=de.JsonDataToMinuteHistoryData(s),u=t.SourceData,f=u.Data[0],C=null,o=h.length-1;o>=0;--o){var D=h[o];if(f.Date>D.Date){C=o;break}else if(f.Date==D.Date&&f.Time>D.Time){C=o;break}else if(f.Date==D.Date&&f.Time==D.Time){f.YClose=D.YClose,C=o-1;break}}if(C==null&&C<0)return!1;for(var o=0;o<h.length&&o<=C;++o){var D=h[o];u.Data.splice(o,0,D)}var c=new Y;c.Data=u.Data,c.Period=this.Period,c.Right=this.Right,c.DataType=0;var T=this.SourceData.GetOverlayMinuteData(c.Data,this.IsApiPeriod);if(c.Data=T,Y.IsMinutePeriod(c.Period,!1)&&!this.IsApiPeriod){var S=c.GetPeriodData(c.Period);c.Data=S}return t.Data=c,!0},this.UpdateOverlayDragMinuteData=function(t){if(v.IsNonEmptyArray(this.OverlayChartPaint))for(var n=t.overlay,s=0;s<this.OverlayChartPaint.length;++s){var o=this.OverlayChartPaint[s];if(o.Symbol){var l=!1;if(o.MainData&&o.Status==Le.STATUS_FINISHED_ID&&(l=this.MergeOverlaySymbolMinuteData(o,n)),!l&&o.Data&&v.IsNonEmptyArray(o.Data.Data)){var h=o.Data,u=this.SourceData.GetOverlayMinuteData(h.Data,this.IsApiPeriod);h.Data=u}}}},this.RequestPreviousDayData=function(t){var n=t.FuncName,s=t.FuncExplain,o=t.Download,l=t.Url,h=t.Count,u=this;this.AutoUpdateEvent(!1,n),this.CancelAutoUpdate(),o.Status=1;var f=null;v.IsNonEmptyArray(this.SourceData.Data)?f=this.SourceData.Data[0]:f={Date:null};var C={field:["name","symbol","yclose","open","price","high","low","vol"],symbol:u.Symbol,enddate:f.Date,count:h,first:{date:f.Date}};if(v.IsNonEmptyArray(this.OverlayChartPaint)){C.overlay=[];for(var D=0;D<this.OverlayChartPaint.length;++D){var c=this.OverlayChartPaint[D];C.overlay.push({symbol:c.Symbol})}}if(this.NetworkFilter){var T={Name:n,Explain:s,Request:{Url:l,Type:"POST",Data:C,Period:this.Period,Right:this.Right},DragDownload:o,Option:t,Self:this,PreventDefault:!1,ZoomData:t.ZoomData};if(this.NetworkFilter(T,function(S){u.RecvPreviousDayData(S,t),o.Status=0,u.AutoUpdateEvent(!0,n),u.AutoUpdate()}),T.PreventDefault==!0)return}Vt.HttpRequest({url:l,data:C,type:"post",dataType:"json",async:!0,success:function(I){u.RecvPreviousDayData(I,t),o.Status=0,u.AutoUpdateEvent(!0,n),u.AutoUpdate()}})},this.RecvPreviousDayData=function(t,n){var s=n.Download,o=de.JsonDataToHistoryData(t);if(!o||o.length<=0){s.IsEnd=!0,k.Chart.Log("[KLineChartContainer.RecvPreviousDayData] "+this.Symbol+" data end. FuncName="+n.FuncName);return}var l=this.GetHistoryDataCount(),h=null;if(v.IsNonEmptyArray(this.SourceData.Data))for(var u=this.SourceData.Data[0],f=o.length-1;f>=0;--f){var C=o[f];if(u.Date>C.Date){h=f;break}else if(u.Date==C.Date){u.YClose=C.YClose,h=f-1;break}}else{var u={Date:null};h=o.length-1}if(!(h==null&&h<0)){for(var f=0;f<o.length&&f<=h;++f){var C=o[f];this.SourceData.Data.splice(f,0,C)}var D=new Y;if(D.Data=this.SourceData.Data,D.Period=this.Period,D.Right=this.Right,D.DataType=this.SourceData.DataType,D.Symbol=this.Symbol,!this.IsApiPeriod){if(D.Right>0){var c=D.GetRightData(D.Right,{AlgorithmType:this.RightFormula});D.Data=c}if(Y.IsDayPeriod(D.Period,!1)||Y.IsMinutePeriod(D.Period,!1)){var T=D.GetPeriodData(D.Period);D.Data=T}}var S=this.GetKLineCalulate();if(S){var I=S.RecvHistoryData(D,{Symbol:this.Symbol,Function:n.RecvFuncName});D=I,this.FlowCapitalReady=!0}if(this.UpdateMainData(D,l),n)if(n.ZoomData){var g=n.ZoomData,E=g.PageSize-g.RightSpaceCount;D.DataOffset=D.Data.length-E,D.DataOffset<0&&(D.DataOffset=0)}else v.IsNumber(n.DataOffset)&&(D.DataOffset+=n.DataOffset,D.DataOffset<0&&(D.DataOffset=0));this.UpdateOverlayDragDayData(t),this.BindInstructionIndexData(D);for(var f=0;f<this.Frame.SubFrame.length;++f)this.BindIndexData(f,D);this.BindAllOverlayIndexData(D,{SyncExecute:!0}),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdateChartDrawXValue(),this.Draw(),this.ReqeustKLineInfoData({FunctionName:n.RecvFuncName,StartDate:u.Date}),this.BindAllOverlayIndexData(D,{SyncExecute:!1})}},this.RequestZoomDayData=function(t){var n=this.MaxRequestDataCount;t.Count>n&&(n=t.Count);var s={PageSize:t.PageSize,DataCount:t.DataCount,RightSpaceCount:t.RightSpaceCount},o={FuncName:"KLineChartContainer::RequestZoomDayData",FuncExplain:"缩放日K数据下载",RecvFuncName:"RecvZoomDayData",Download:this.ZoomDownload.Day,Url:this.ZoomKLineApiUrl,XShowCount:this.Frame.GetXShowCount(),Count:n,ZoomData:s};this.RequestPreviousDayData(o)},this.RequestDragDayData=function(){var t={FuncName:"KLineChartContainer::RequestDragDayData",FuncExplain:"拖拽日K数据下载",RecvFuncName:"RecvDragDayData",Download:this.DragDownload.Day,Url:this.DragKLineApiUrl,Count:this.MaxRequestDataCount,XShowCount:this.Frame.GetXShowCount()};this.RequestPreviousDayData(t)},this.MergeOverlaySymbolDayData=function(t,S){if(!t.Symbol||!v.IsNonEmptyArray(S))return!1;for(var s=null,o=0;o<S.length;++o){var l=S[o];if(l.symbol==t.Symbol){s=l;break}}if(!s)return!1;for(var h=de.JsonDataToHistoryData(s),u=t.SourceData,f=u.Data[0],C=null,o=h.length-1;o>=0;--o){var D=h[o];if(f.Date>D.Date){C=o;break}else if(f.Date==D.Date){f.YClose=D.YClose,C=o-1;break}}if(C==null&&C<0)return!1;for(var o=0;o<h.length&&o<=C;++o){var D=h[o];u.Data.splice(o,0,D)}var c=new Y;if(c.Data=u.Data,c.Period=this.Period,c.Right=this.Right,c.DataType=0,c.Right>0&&U.IsSHSZStockA(s.symbol)&&!this.IsApiPeriod){var T=c.GetRightData(c.Right,{AlgorithmType:this.RightFormula});c.Data=T}var S=this.SourceData.GetOverlayData(c.Data,this.IsApiPeriod);if(c.Data=S,Y.IsDayPeriod(c.Period,!1)&&!this.IsApiPeriod){var I=c.GetPeriodData(c.Period);c.Data=I}return t.Data=c,!0},this.UpdateOverlayDragDayData=function(t){if(v.IsNonEmptyArray(this.OverlayChartPaint))for(var n=t.overlay,s=0;s<this.OverlayChartPaint.length;++s){var o=this.OverlayChartPaint[s];if(o.Symbol){var l=!1;if(o.MainData&&o.Status==Le.STATUS_FINISHED_ID&&(l=this.MergeOverlaySymbolDayData(o,n)),!l&&o.Data&&v.IsNonEmptyArray(o.Data.Data)){var h=o.Data,u=this.SourceData.GetOverlayData(h.Data,this.IsApiPeriod);h.Data=u}}}},this.SetCustomVerical=function(t,n){if(this.Frame&&!(t>=this.Frame.SubFrame.length)){var s=this.Frame.SubFrame[t];s.Frame&&(s.Frame.CustomVerticalInfo=n)}},this.OnSize=function(){if(this.Frame&&this.Frame.OnSize){var t=this.Frame.OnSize();this.Frame.SetSizeChage(!0),t.Changed&&(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(2),this.UpdateFrameMaxMin()),this.Draw()}},this.ClickFrameButton=function(t,n){var s=this.GetEventCallback($.ON_CLICK_FRAME_TOOLBAR);if(s&&s.Callback){var o={Info:t,PreventDefault:!1};if(s.Callback(s,o,this),o.PreventDefault)return}if(t.ID==Rt.CLOSE_OVERLAY_INDEX){var l=t.IndexID;l&&this.DeleteOverlayWindowsIndex(l)}else if(t.ID==Rt.MODIFY_OVERLAY_INDEX_PARAM){var l=t.IndexID,h=t.Frame,u={e:n,WindowIndex:h.Identify,Type:2,Identify:l};this.ShowModifyIndexParamDialog(u)}else if(t.ID==Rt.CLOSE_INDEX_WINDOW){var h=t.Frame;this.RemoveIndexWindow(h.Identify)}else if(t.ID==Rt.CHANGE_INDEX){var h=t.Frame,u={e:n,WindowIndex:h.Identify,OpType:1};this.ShowChangeIndexDialog(u)}else if(t.ID==Rt.MODIFY_INDEX_PARAM){var h=t.Frame,u={e:n,WindowIndex:h.Identify,Type:1};this.ShowModifyIndexParamDialog(u)}else if(t.ID==Rt.OVERLAY_INDEX){var h=t.Frame,u={e:n,WindowIndex:h.Identify,OpType:2};this.ShowAddOverlayIndexDialog(u)}else if(t.ID==Rt.MAX_MIN_WINDOW){var l=t.IndexID,h=t.Frame,f=t.FrameID;f>=this.Frame.ZoomStartWindowIndex&&this.ZoomIndexWindow(f,null)&&(this.Frame.SetSizeChage(!0),this.Draw())}else if(t.ID==Rt.TITLE_WINDOW){var l=t.IndexID,h=t.Frame,f=t.FrameID;this.ShowIndexTitleOnly(f)&&(this.Frame.SetSizeChage(!0),this.Draw())}else if(t.ID==Rt.EXPORT_DATA){var o=this.ExportData({Type:"CSV"});if(!o)return;var C=Date.now(),D="hqchart_"+this.Symbol+"_"+C+".csv",c=document.createElement("a"),T=new Blob([o],{type:"text/csv"});c.href=URL.createObjectURL(T),document.body.appendChild(c),c.setAttribute("download",D),c.click(),document.body.removeChild(c)}},this.ClickTitleButton=function(t,n){var s=this.GetEventCallback($.ON_CLICK_TITLE_BUTTON);if(s&&s.Callback){var o={Info:t,PreventDefault:!1,e:n};if(s.Callback(s,o,this),o.PreventDefault)return}},this.ClickExtendChartButton=function(t,n){var s=this.GetEventCallback($.ON_CLICK_EXTENDCHART_BUTTON);if(s&&s.Callback){var o={Info:t,PreventDefault:!1,e:n};if(s.Callback(s,o,this),o.PreventDefault)return}t.ID==Rt.CHIP_DEFULT?(t.Chart.ShowType=0,this.Draw()):t.ID==Rt.CHIP_LONG?(t.Chart.ShowType=1,this.Draw()):t.ID==Rt.CHIP_RECENT&&(t.Chart.ShowType=2,this.Draw())},this.RequestVolumeProfileData=function(t){var n=this,s=t.Chart;if(this.NetworkFilter){var o={Name:"KLineChartContainer::RequestVolumeProfileData",Explain:"成交量分布图下载",Request:{Period:this.Period,Right:this.Right,Start:t.Start,End:t.End,Symbol:this.Symbol,ValueAreaVol:t.ValueAreaVol},Self:this,VolProfile:s,PreventDefault:!1};if(this.NetworkFilter(o,function(l){n.RecvVolumeProfileData(l,s)}),o.PreventDefault==!0)return}},this.RecvVolumeProfileData=function(t,n){n.OnRecvVolumeProfileData(t),this.Draw()},this.ExportMainData=function(t,n){var s=t.ExportKLineData(n);return s},this.UpdateScrollBar=function(){if(this.ScrollBar){var t=this.GetChartStatus();if(t){var n=this.ChartPaint[0].Data,s=t.KLine.Offset,o=s+t.KLine.PageSize-1,l={Start:s,End:o,Data:n,Draw:!0,RightSpaceCount:this.RightSpaceCount};if(this.Frame&&this.Frame.ChartBorder){var h=this.Frame.ChartBorder;l.Border={Left:h.Left,Right:h.Right}}this.ScrollBar.UpdateSlider(l)}}},this.ResetScrollBar=function(){this.ScrollBar&&this.ScrollBar.Reset({Draw:!0})},this.ChangePriceGap=function(t){if(t){var n=this.ChartPaint[0];n&&(v.IsNumber(t.Count)&&(n.PriceGap.Count=t.Count),v.IsBool(t.Enable)&&(n.PriceGap.Enable=t.Enable),this.Draw())}},this.DrawTooltipDialog=function(){this.DialogTooltip&&this.UpdateTooltipDialog()},this.UpdateTooltipDialog=function(){if(!this.DialogTooltip||!this.ChartCorssCursor)return!1;var t=0,n=null;if(this.ChartCorssCursor.ClientPos>=0){var s=this.ChartOperator_Temp_GetHistroyData();if(!s||!v.IsNonEmptyArray(s.Data))return!1;var o=s.DataOffset+this.ChartCorssCursor.CursorIndex;o>=s.Data.length&&(o=s.Data.length-1);var n=s.Data[o]}else{var s=this.ChartOperator_Temp_GetHistroyData();if(!s||!v.IsNonEmptyArray(s.Data))return!1;var n=s.Data[s.Data.length-1],l={Symbol:this.Symbol,Date:n.Date};if(v.IsNumber(n.Time)&&(l.Time=n.Time),!this.DialogTooltip.IsEqualDataID(l))return!1;t=1}var h={DataType:t,ClientPos:this.ChartCorssCursor.ClientPos,IsShowCorss:this.ChartCorssCursor.IsShowCorss,KItem:n,Symbol:this.Symbol,Name:this.Name,LastValue:this.ChartCorssCursor.LastValue};return this.DialogTooltip.Update(h),!0},this.DrawSelectRectDialog=function(t){this.DialogSelectRect&&this.UpdateSelectRectDialog(t)},this.UpdateSelectRectDialog=function(t){if(!this.DialogSelectRect)return!1;var n=t.data,s,o;if(n&&v.IsNumber(n.X)&&v.IsNumber(n.Y)){var l=this.UIElement.getBoundingClientRect(),h=Da();s=n.X,o=n.Y,s+=l.left+h.Left,o+=l.top+h.Top}var u={Symbol:this.Symbol,Name:this.Name,SelectData:n.SelectData,X:s,Y:o,e:t};this.DialogSelectRect.Update(u)},this.UpdateHQFloatTooltip=function(t){if(this.FloatTooltip&&this.FloatTooltip.IsShow()&&!(!t||!v.IsNonEmptyArray(t.Data))){var n=t.Data[t.Data.length-1];if(n){var s={Symbol:t.Symbol,Date:n.Date,Time:n.Time};if(this.FloatTooltip.IsEqualHQID(s)){var o={Data:n,Symbol:this.Symbol,Name:this.Name,DataType:2};this.FloatTooltip.Update(o)}}}}}de.JsonDataToHistoryData=function(e){var a=[];if(!e.data)return a;var r=null;e.symbol&&(r=e.symbol.toUpperCase()),r&&U.IsFutures(r);for(var t=e.data,n=0,s=1,o=2,l=3,h=4,u=5,f=6,C=7,D=8,c=9,T=10,S=11,I=12,g=13,E=14,F=15,R=qe.KLINE_ORDERFLOW,A=qe.KLINE_COLOR_DATA,P=qe.KLINE_HEATMAP,p=qe.KLINE_DAY_EXTENDDATA,w=0;w<t.length;++w){var H=new Pt,W=t[w];H.Date=W[n],H.Open=W[o],H.YClose=W[s],H.Close=W[u],H.High=W[l],H.Low=W[h],H.Vol=W[f],H.Amount=W[C],v.IsNumber(W[D])&&(H.Position=W[D]),v.IsNumber(W[c])&&(H.FClose=W[c]),v.IsNumber(W[T])&&(H.YFClose=W[T]),v.IsNumber(W[F])&&(H.FlowCapital=W[F]),v.IsNumber(W[S])&&(H.BFactor=W[S]),v.IsNumber(W[I])&&(H.AFactor=W[I]),v.IsBool(W[g])&&(H.IsVirtual=W[g]),v.IsBool(W[E])&&(H.IsNonTrade=W[E]),!(!v.IsNumber(H.Open)&&H.IsVirtual!==!0)&&(W[R]&&(H.OrderFlow=W[R]),W[A]&&(H.ColorData=W[A]),W[p]&&(H.ExtendData=W[p]),W[P]&&(H.HeatMap=W[P]),a.push(H))}return a};de.JsonDataToRealtimeData=function(e,a){if(!e.stock)return null;var r;for(var t in e.stock){var n=e.stock[t];if(n&&n.symbol==a){r=n;break}}if(!r)return null;var s=a.toUpperCase();U.IsSHSZ(s);var o=new Pt;return o.Date=r.date,o.Open=r.open,o.YClose=r.yclose,o.High=r.high,o.Low=r.low,o.Vol=r.vol,o.Amount=r.amount,o.Close=r.price,v.IsNumber(r.position)&&(o.Position=r.position),v.IsNumber(r.yclearing)&&(o.YFClose=r.yclearing),v.IsNumber(r.clearing)&&(o.FClose=r.clearing),v.IsNumber(r.bfactor)&&(o.BFactor=r.bfactor),v.IsNumber(r.afactor)&&(o.AFactor=r.afactor),r.colordata&&(o.ColorData=r.colordata),r.extendData&&(o.ExtendData=r.extendData),r.heatmapData&&(o.HeatMap=r.heatmapData),v.IsBool(r.isvirtual)&&(o.IsVirtual=r.isvirtual),v.IsBool(r.isnontrade)&&(o.IsNonTrade=r.isnontrade),v.IsNumber(r.flowCapital)&&(o.FlowCapital=r.flowCapital),o};de.JsonDataToMinuteRealtimeData=function(e,a){if(!e.stock)return null;var r;for(var t in e.stock){var n=e.stock[t];if(n&&n.symbol==a){r=n;break}}if(!r)return null;var s=a.toUpperCase();U.IsSHSZ(s);var o=U.IsFutures(s),l=new Array,h=r.yclose,u=r.date;o&&r.yclearing&&(h=r.yclearing);for(var t in r.minute){var f=r.minute[t],C=new Pt;C.Close=f.price,C.Open=f.open,C.High=f.high,C.Low=f.low,C.Vol=f.vol,C.Amount=f.amount,f.date>0?C.Date=f.date:C.Date=u,C.Time=f.time,C.YClose=h,v.IsNumber(f.position)&&(C.Position=f.position),v.IsNumber(C.Close)||(C.Close=h,C.Open=C.High=C.Low=C.Close),v.IsNumber(C.Open)||(C.Open=null),v.IsNumber(C.Close)||(C.Close=null),v.IsNumber(C.High)||(C.High=null),v.IsNumber(C.Low)||(C.Low=null),v.IsNumber(f.price)&&(h=f.price),l[t]=C}return l};de.JsonDataToMinuteRealtimeDataV2=function(e,a){if(!e||!e.overlay||!a)return null;for(var r=null,t=0;t<e.overlay.length;++t){var n=e.overlay[t];if(n.symbol==a){r=n;break}}if(!r)return null;var s=a.toUpperCase();U.IsSHSZ(s),U.IsFutures(s);for(var o=0,l=1,h=2,u=3,f=4,C=5,D=6,c=7,T=8,S=9,I=qe.KLINE_ORDERFLOW,g=null,E=[],t=0;t<r.data.length;++t){var n=new Pt,F=r.data[t];n.Date=F[o],n.Open=F[h],n.YClose=F[l],n.Close=F[C],n.High=F[u],n.Low=F[f],n.Vol=F[D],n.Amount=F[c],n.Time=F[T],v.IsNumber(F[S])&&(n.Position=F[S]),v.IsNumber(n.YClose)||v.IsNumber(g)&&(n.YClose=g),v.IsNumber(n.Close)&&(g=n.Close),F[I]&&(n.OrderFlow=F[I]),E.push(n)}return E};de.JsonDataToMinuteHistoryData=function(e){var a=null;e.symbol&&(a=e.symbol.toUpperCase()),a&&U.IsSHSZ(a),a&&U.IsFutures(a);for(var r=e.data,t=new Array,n=0,s=1,o=2,l=3,h=4,u=5,f=6,C=7,D=8,c=9,T=10,S=11,I=12,g=13,E=qe.KLINE_ORDERFLOW,F=qe.KLINE_COLOR_DATA,R=qe.KLINE_HEATMAP,A=qe.KLINE_MINUTE_EXTENDDATA,P=null,p=0;p<r.length;++p){var w=new Pt,H=r[p];w.Date=H[n],w.Open=H[o],w.YClose=H[s],w.Close=H[u],w.High=H[l],w.Low=H[h],w.Vol=H[f],w.Amount=H[C],w.Time=H[D],v.IsNumber(H[c])&&(w.Position=H[c]),v.IsNumber(H[T])&&(w.FClose=H[T]),v.IsNumber(H[S])&&(w.YFClose=H[S]),v.IsNumber(H[I])&&(w.BFactor=H[I]),v.IsNumber(H[g])&&(w.AFactor=H[g]),v.IsNumber(w.YClose)||v.IsNumber(P)&&(w.YClose=P),v.IsNumber(w.Close)&&(P=w.Close),H[E]&&(w.OrderFlow=H[E]),H[F]&&(w.ColorData=H[F]),H[A]&&(w.ExtendData=H[A]),H[R]&&(w.HeatMap=H[R]),t.push(w)}return t};de.JsonDataToTickData=function(e){var a=[];if(!e.detail)return a;var r=e.date,t=e.yclose;for(var n in e.detail){var s=new Pt,o=e.detail[n];o&&(s.Date=r,s.Time=o[0],s.Low=s.High=s.Close=s.Open=o[1],s.YClose=t,s.Vol=o[2],s.Amount=o[3],s.Flag=o[4],v.IsNumber(s.Open)&&a.push(s))}return a};de.JsonDataToTickDataV2=function(e){var a=[];if(!v.IsNonEmptyArray(e.data))return a;for(var r=0;r<e.data.length;++r){var t=new Pt,n=e.data[r];n&&(t.Date=n[0],t.Time=n[1],t.YClose=n[2],t.Low=t.High=t.Close=t.Open=n[3],a.push(t),n[4]&&(t.ExtendData=n[4]))}return a};function ce(e,a,r){this.newMethod=Kh,this.newMethod(e,a,r),delete this.newMethod,this.ClassName="MinuteChartContainer",this.WindowIndex=new Array,this.Symbol,this.AryDate,this.Name,this.SourceData,this.IndexBindData,this.IsAutoUpdate=!0,this.AutoUpdateFrequency=3e4,this.AutoUpdateTimer,this.TradeDate=0,this.DayCount=1,this.DayData,this.LimitPrice,this.IsShowBeforeData=!1,this.BeforeOpenData=null,this.IsBeforeData=!1,this.IsShowAfterData=!1,this.AfterCloseData=null,this.IsAfterData=!1,this.ShareAfterVol=0,this.ExtendWidth={Left:120,Right:120},this.IsShowLead=!0,this.IsShowMultiDayBeforeData=!1,this.MultiDayBeforeOpenData=null,this.IsShowMultiDayAfterData=!1,this.MultiDayAfterCloseData=null,this.MultiDayExtendWidth={Left:40,Right:20},this.ChartDrawStorage=new TD,this.ChartDrawStorageCache=null,this.MinuteApiUrl=d.Domain+"/API/Stock",this.HistoryMinuteApiUrl=d.Domain+"/API/StockMinuteData",this.ColorLineData,this.EnableSelectRect=!1,this.CorssCursorIndex={DayIndex:-1,DataIndex:-1,Point:{X:-1,Y:-1},Type:-1},this.EnableNewIndex=!1,this.DayOffset={Offset:0,ShowDayCount:-1,DataOffset:0,DayCount:1},this.PageInfo={Enable:!1,Offset:-8888,ShowDayCount:4},this.DataStatus={MultiDay:!1,LatestDay:!1,LatestDate:null},this.ZoomStepPixel=50,this.BaselineType=0,this.EnableNightDayBG=!1,this.SetCallCationDataBorder=function(t){if(t){var n={Left:t.Left?this.ExtendWidth.Left:0,Right:t.Right?this.ExtendWidth.Right:0};if(this.Frame.SetExtendWidth(n),t.MultiDay){var s=t.MultiDay,o={Left:s.Left?this.MultiDayExtendWidth.Left:0,Right:s.Right?this.MultiDayExtendWidth.Right:0};this.Frame.SetMultiDayMinuteWidth(o)}}},this.ReloadChartPaint=function(t){for(var n=0;n<this.ChartPaint.length;++n){var s=this.ChartPaint[n];s&&(s.ReloadResource&&s.ReloadResource(t),n==0?s.Name=="Minute-Line"&&(s.Color=d.Minute.PriceColor,s.AreaColor=d.Minute.AreaPriceColor):n==1?s.Name=="Minute-Average-Line"&&(s.Color=d.Minute.AvPriceColor):n==2&&s.Name=="Minute-Vol-Bar"&&(s.Color=d.Minute.VolBarColor))}},this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.ClickFrameButton=function(t,n){var s=this.GetEventCallback($.ON_CLICK_FRAME_TOOLBAR);if(s&&s.Callback){var o={Info:t,PreventDefault:!1};if(s.Callback(s,o,this),o.PreventDefault)return}if(t.ID==Rt.CLOSE_BEFOREOPEN_ID)this.ShowCallAuctionData({Left:!1,Right:!1,MultiDay:{Left:!1,Right:!1}});else if(t.ID==Rt.CLOSE_OVERLAY_INDEX){var l=t.IndexID;l&&this.DeleteOverlayWindowsIndex(l)}else if(t.ID==Rt.MODIFY_OVERLAY_INDEX_PARAM){var l=t.IndexID,h=t.Frame,u={e:n,WindowIndex:h.Identify,Type:2,Identify:l};this.ShowModifyIndexParamDialog(u)}else if(t.ID==Rt.CLOSE_INDEX_WINDOW){var h=t.Frame;this.RemoveIndexWindow(h.Identify)}else if(t.ID==Rt.CHANGE_INDEX){var h=t.Frame,u={e:n,WindowIndex:h.Identify,OpType:1};this.ShowChangeIndexDialog(u)}else if(t.ID==Rt.MODIFY_INDEX_PARAM){var h=t.Frame,u={e:n,WindowIndex:h.Identify,Type:1};this.ShowModifyIndexParamDialog(u)}else if(t.ID==Rt.OVERLAY_INDEX){var h=t.Frame,u={e:n,WindowIndex:h.Identify,OpType:2};this.ShowAddOverlayIndexDialog(u)}else if(t.ID==Rt.MAX_MIN_WINDOW){var l=t.IndexID,h=t.Frame,f=t.FrameID;f>=this.Frame.ZoomStartWindowIndex&&this.ZoomIndexWindow(f,null)&&(this.Frame.SetSizeChage(!0),this.Draw())}else if(t.ID==Rt.TITLE_WINDOW){var l=t.IndexID,h=t.Frame,f=t.FrameID;this.ShowIndexTitleOnly(f)&&(this.Frame.SetSizeChage(!0),this.Draw())}else if(t.ID==Rt.EXPORT_DATA){var o=this.ExportData({Type:"CSV"});if(!o)return;var C=Date.now(),D="hqchart_"+this.Symbol+"_"+C+".csv",c=document.createElement("a"),T=new Blob([o],{type:"text/csv"});c.href=URL.createObjectURL(T),document.body.appendChild(c),c.setAttribute("download",D),c.click(),document.body.removeChild(c)}},this.ChartOperator=function(t){var n=t.ID;if(n===ve.OP_SCROLL_LEFT||n===ve.OP_SCROLL_RIGHT){if(this.DayCount==1||!this.PageInfo.Enable||!this.DayData)return!1;var s=n===ve.OP_SCROLL_LEFT,o=1;if(t.Step>0&&(o=t.Step),!this.DayOffset)return!1;if(s){var l=this.DayOffset.Offset;if(l+=o,l+this.DayOffset.ShowDayCount>this.DayOffset.DayCount&&(l=this.DayOffset.DayCount-this.DayOffset.ShowDayCount),l==this.DayOffset.Offset)return!1;this.DayOffset.Offset=l}else{var l=this.DayOffset.Offset;if(l-=o,l<0&&(l=0),l==this.DayOffset.Offset)return!1;this.DayOffset.Offset=l}return this.UpdateHistoryMinuteUI(null),this.SendPageChangedEvent(),!0}else if(n==ve.OP_SCROLL_GOTO){if(this.DayCount==1||!this.PageInfo.Enable||!this.DayData)return!1;if(v.IsNumber(t.ShowDayCount)&&(this.PageInfo.ShowDayCount=t.ShowDayCount,this.DayOffset.ShowDayCount=t.ShowDayCount),v.IsNumber(t.Offset)){var l=t.Offset;if(this.DayOffset.ShowDayCount>0&&l+this.DayOffset.ShowDayCount>=this.DayOffset.DayCount&&(l=this.DayOffset.DayCount-this.DayOffset.ShowDayCount),l==this.DayOffset.Offset)return!1;this.DayOffset.Offset=l}return this.UpdateHistoryMinuteUI(null),this.SendPageChangedEvent(),!0}else if(n==ve.OP_CORSSCURSOR_GOTO){if(!this.SourceData||!this.Frame||!this.Frame.SubFrame[0]||!this.Frame.SubFrame[0].Frame)return!1;var h=this.Frame.SubFrame[0].Frame;if(!v.IsNonEmptyArray(this.SourceData.Data))return!1;if(v.IsNumber(t.Time)&&v.IsNumber(t.Date)){for(var u=-1,f=null,C=null,D=0;D<this.SourceData.Data.length;++D){var c=this.SourceData.Data[D];if(v.IsNumber(c.Close)&&(C=c.Close),c.Time==t.Time&&c.Date==t.Date){u=D,f=c.Close;break}}if(u<0&&this.DayCount==1&&!(v.IsNumber(t.Type)&&t.Type>0)){for(var T=Wi.GetTimeData(this.Symbol),D=0;D<T.length;++D)if(T[D]==t.Time){u=D,f=C;break}}if(u<0){if(t.Type==1){var I=-1,g=-1,E={X:I,Y:g,IsInClient:this.IsMouseOnClient(I,g)};this.LastMouseStatus.OnMouseMove=E,this.LastMouseStatus.MoveOnPoint={X:I,Y:g};var F=this.GetEventCallback($.ON_MOUSE_MOVE),R=this.TitlePaint[0];F&&R&&(R.OnMouseMoveEvent=F);var S={clientX:I,clientY:g};this.MoveOnPoint={X:I,Y:g},this.OnMouseMove(I,g,S),this.LastMouseStatus.MoveOnPoint=null,R&&(R.OnMouseMoveEvent=null)}return}}var I=h.GetXFromIndex(u),g=h.GetYFromData(f),E={X:I,Y:g,IsInClient:this.IsMouseOnClient(I,g)};this.LastMouseStatus.OnMouseMove=E,this.LastMouseStatus.MoveOnPoint={X:I,Y:g};var F=this.GetEventCallback($.ON_MOUSE_MOVE),R=this.TitlePaint[0];F&&R&&(R.OnMouseMoveEvent=F),this.MoveOnPoint={X:I,Y:g},this.OnMouseMove(I,g,{}),this.LastMouseStatus.MoveOnPoint=null,R&&(R.OnMouseMoveEvent=null)}},this.SendPageChangedEvent=function(){var t=this.GetEventCallback($.ON_MINUTE_PAGE_CHANGED);if(!(!t||!t.Callback)){var n={DayOffset:this.DayOffset,DayData:this.DayData};t.Callback(t,n,this)}},this.IsMouseOnClient=function(t,n){var s=this.Frame.IsHScreen?this.Frame.ChartBorder.GetHScreenBorder():this.Frame.ChartBorder.GetBorder(),o={Left:s.Left,Top:s.Top,Right:s.Right,Bottom:s.Bottom};return t>=o.Left&&t<=o.Right&&n>=o.Top&&n<=o.Bottom},this.OnDragMode_One=function(t,n){var s=this.MouseDrag,o=t.X,l=t.Y;if(this.RectSelectDrag&&this.RectSelectDrag.Index>=0){if(o<5)return;var h={X:n.clientX,Y:n.clientY,PointIndex:this.RectSelectDrag.Index,Name:"MoveRectSelectLine"};this.MoveRectSelectPoint(h)&&(s.LastMove.X=n.clientX,this.Draw())}else{if(o<5&&l<5||!this.EnableSelectRect)return;this.SetCursor({Cursor:"default"});var u=this.PointAbsoluteToRelative(s.Click.X,s.Click.Y),f=this.PointAbsoluteToRelative(n.clientX,n.clientY);this.ShowDragSelectRect(u,f),s.LastMove.X=n.clientX,s.LastMove.Y=n.clientY}},this.OnMinuteSelectRectMouseUp=function(t){var n=this.MouseDrag;n.LastMove.X=t.clientX,n.LastMove.Y=t.clientY;var s=new AC,o=B();if(s.XStart=(n.Click.X-e.getBoundingClientRect().left)*o,s.YStart=(n.Click.Y-e.getBoundingClientRect().top)*o,s.XEnd=(n.LastMove.X-e.getBoundingClientRect().left)*o,s.YEnd=(n.LastMove.Y-e.getBoundingClientRect().top)*o,s.JSChartContainer=this,s.Stock={Symbol:this.Symbol,Name:this.Name},this.EnableSelectRect&&!this.BorderDrag&&this.GetSelectRectData(s)){var l=this.GetEventCallback($.ON_SELECT_RECT),h=this.GetRectSelectPaint(),u=!0;if(l&&l.Callback){var f={X:n.LastMove.X-e.getBoundingClientRect().left,Y:n.LastMove.Y-e.getBoundingClientRect().top,SelectData:s,RectSelectPaint:h,e:t};l.Callback(l,f,this),u=!1}u&&this.DialogSelectRect?(t.data={Chart:this,X:n.LastMove.X-e.getBoundingClientRect().left,Y:n.LastMove.Y-e.getBoundingClientRect().top,SelectData:s,RectSelectPaint:h},this.HideSelectRect(),this.UpdateSelectRect(s.Start,s.End),this.DrawSelectRectDialog(t)):(this.HideSelectRect(),this.UpdateSelectRect(s.Start,s.End))}else this.TryClickPaintEvent($.ON_CLICKUP_CHART_PAINT,this.ClickDownPoint,t),this.ClickEvent(t)},this.OnDragSelectRectMouseUp=function(t){var n=this.GetRectSelectPaint();if(n){var s=n.GetSelectRectData();if(s){var o=B(),l=this.ChartCorssCursor,h=l.LastPoint.X/o,u=l.LastPoint.Y/o,f=!0,C=this.GetEventCallback($.ON_DRAG_SELECT_RECT_MOUSEUP);if(C){var D={X:h,Y:u,SelectData:s,RectSelectPaint:n,IsShowDialog:!1};C.Callback(C,D,this),f=D.IsShowDialog}if(f){var D={Chart:this,X:h,Y:u,SelectData:s,RectSelectPaint:n};t.data=D,this.UpdateSelectRectDialog(t)}}}},this.UpdateSelectRect=function(t,n){if(!(!this.SourceData||!this.SourceData.Data)){var s=this.GetRectSelectPaint();if(s){var o=this.SourceData;if(!(!o||!v.IsNonEmptyArray(o.Data))){var l=o.Data.length,h=o.Data[t];n>=l&&(n=l-1);var u=o.Data[n];!h||!u||(k.Chart.Log("[MinuteChartContainer::UpdateSelectRect]",h,u),s.SetPoint(h,{Index:0}),s.SetPoint(u,{Index:1}),this.Draw())}}}},this.MoveRectSelectPoint=function(t){var n=this.GetRectSelectPaint();if(!n||!this.SourceData||!this.SourceData.Data)return!1;var s=this.SourceData;if(!this.Frame.SubFrame[0])return!1;var o=this.Frame.SubFrame[0].Frame,l=B(),h=(t.X-e.getBoundingClientRect().left)*l,u=o.GetXData(h);u=parseInt(u.toFixed(0));var f=u+s.DataOffset;f>=s.Data.length&&(f=s.Data.length-1);var C=s.Data[f];if(k.Chart.Log("[MinuteChartContainer::MoveRectSelectPoint] point, item",t.PointIndex,C),!n.SetPoint(C,{Index:t.PointIndex}))return!1;var D=this.GetEventCallback($.ON_DRAG_SELECT_RECT);if(D){var c=n.GetSelectRectData(),T={X:t.X,Y:t.Y,SelectData:c,RectSelectPaint:n};D.Callback(D,T,this)}if(this.IsShowSelectRectDialog()){var c=n.GetSelectRectData(),T={X:t.X,Y:t.Y,SelectData:c,RectSelectPaint:n},S={data:T};this.DrawSelectRectDialog(S)}return!0},this.GetLastCursorIndex=function(t){if(t.DataType==1)for(var n=t.Data.length-1;n>=0;--n){var s=t.Data[n];if(!(!s||!s.DayItem||!s.DayItem.Data)){t.IndexData.DayIndex=0,t.IndexData.DataIndex=s.DayItem.Data.length-1,t.IndexData.Type=s.Type;return}}else if(t.DataType==2)for(var n=t.Data.length-1;n>=0;--n)for(var o=t.Data[n],l=o.length-1;l>=0;--l){var s=o[l];if(!(!s||!s.DayItem||!s.DayItem.Data)){t.IndexData.DayIndex=n,t.IndexData.DataIndex=s.DayItem.Data.length-1,t.IndexData.Type=s.Type;return}}},this.GetFirstCursorIndex=function(t){if(t.DataType==1)for(var n=0;n<t.Data.length;++n){var s=t.Data[n];if(!(!s||!s.DayItem||!s.DayItem.Data)){t.IndexData.DayIndex=0,t.IndexData.DataIndex=0,t.IndexData.Type=s.Type;return}}else if(t.DataType==2)for(var n=0;n<t.Data.length;++n)for(var o=t.Data[n],l=0;l<o.length;++l){var s=o[l];if(!(!s||!s.DayItem||!s.DayItem.Data)){t.IndexData.DayIndex=n,t.IndexData.DataIndex=0,t.IndexData.Type=s.Type;return}}},this.GetAfterCloseData=function(){var t=null;return this.AfterCloseData&&this.IsShowAfterData&&(t=this.AfterCloseData),t},this.GetBeforeOpenData=function(){var t=null;return this.BeforeOpenData&&this.IsShowBeforeData&&(t=this.BeforeOpenData),t},this.MoveCorssCursorIndex=function(t){if(!this.EnableNewIndex||!this.Frame.SubFrame[0]||!this.Frame.SubFrame[0].Frame)return!1;var n=this.Frame.SubFrame[0].Frame;if(this.CorssCursorIndex.Type==1||this.CorssCursorIndex.Type==2||this.CorssCursorIndex.Type==3||this.CorssCursorIndex.Type==-1){var s=[],o=this.GetBeforeOpenData();s.push({DayItem:o,Type:2});var o=null;this.SourceData&&(o=this.SourceData),s.push({DayItem:o,Type:1});var o=this.GetAfterCloseData();s.push({DayItem:o,Type:3});var l={DataType:1,Data:s,IndexData:this.CorssCursorIndex,Point:{X:null,Y:null}},h=1;if(t.IsMoveLeft){if(this.CorssCursorIndex.DayIndex<0&&this.CorssCursorIndex.DataIndex<0&&(this.GetLastCursorIndex(l),h=0),n.MoveXIndexLeft(h,l)){this.LastPoint.X=l.Point.X,this.LastPoint.Y=l.Point.Y,this.CorssCursorIndex.Type==1&&(this.CursorIndex=this.CorssCursorIndex.CursorIndex);var t={ParentFunction:"MoveCorssCursorIndex",Point:{X:l.Point.X,Y:l.Point.Y},IsPhone:!1,ClientPos:this.CorssCursorIndex.Type};this.DrawDynamicInfo(t)}}else if(this.CorssCursorIndex.DayIndex<0&&this.CorssCursorIndex.DataIndex<0&&(this.GetFirstCursorIndex(l),h=0),n.MoveXIndexRight(h,l)){this.LastPoint.X=l.Point.X,this.LastPoint.Y=l.Point.Y,this.CorssCursorIndex.Type==1&&(this.CursorIndex=this.CorssCursorIndex.CursorIndex);var t={ParentFunction:"MoveCorssCursorIndex",Point:{X:l.Point.X,Y:l.Point.Y},IsPhone:!1,ClientPos:this.CorssCursorIndex.Type};this.DrawDynamicInfo(t)}}else if(this.CorssCursorIndex.Type==10||this.CorssCursorIndex.Type==20||this.CorssCursorIndex.Type==30||this.CorssCursorIndex.Type==-2){var s=[],u=0,f=this.DayData.length;this.DayOffset&&(v.IsNumber(this.DayOffset.Offset)&&(u=this.DayOffset.Offset),v.IsNumber(this.DayOffset.ShowDayCount)&&(f=this.DayOffset.ShowDayCount));for(var C=u,D=0;C<this.DayData.length&&D<f;++C,++D){var c=[],o=null;this.MultiDayBeforeOpenData&&this.IsShowMultiDayBeforeData&&(o=this.MultiDayBeforeOpenData[C]),c.push({DayItem:o,Type:20});var o=null;this.DayData&&(o=this.DayData[this.DayData.length-1-C]),c.push({DayItem:o,Type:10});var o=null;this.MultiDayAfterCloseData&&this.IsShowMultiDayAfterData&&(o=this.MultiDayAfterCloseData[C]),c.push({DayItem:o,Type:30}),s.push(c)}var l={DataType:2,Data:s,IndexData:this.CorssCursorIndex,Point:{X:null,Y:null}},h=1;if(t.IsMoveLeft){if(this.CorssCursorIndex.DayIndex<0&&this.CorssCursorIndex.DataIndex<0&&(this.GetLastCursorIndex(l),h=0),n.MoveXIndexLeft(h,l)){this.LastPoint.X=l.Point.X,this.LastPoint.Y=l.Point.Y,this.CorssCursorIndex.Type==10&&(this.CursorIndex=this.CorssCursorIndex.CursorIndex);var t={ParentFunction:"MoveCorssCursorIndex",Point:{X:l.Point.X,Y:l.Point.Y},IsPhone:!1,ClientPos:null};this.CorssCursorIndex.Type==10?t.ClientPos=1:this.CorssCursorIndex.Type==20?t.ClientPos=this.CorssCursorIndex.DayIndex+200:this.CorssCursorIndex.Type==30&&(t.ClientPos=this.CorssCursorIndex.DayIndex+300),this.DrawDynamicInfo(t)}}else if(this.CorssCursorIndex.DayIndex<0&&this.CorssCursorIndex.DataIndex<0&&(this.GetFirstCursorIndex(l),h=0),n.MoveXIndexRight(h,l)){this.LastPoint.X=l.Point.X,this.LastPoint.Y=l.Point.Y,this.CorssCursorIndex.Type==10&&(this.CursorIndex=this.CorssCursorIndex.CursorIndex);var t={ParentFunction:"MoveCorssCursorIndex",Point:{X:l.Point.X,Y:l.Point.Y},IsPhone:!1,ClientPos:null};this.CorssCursorIndex.Type==10?t.ClientPos=1:this.CorssCursorIndex.Type==20?t.ClientPos=this.CorssCursorIndex.DayIndex+200:this.CorssCursorIndex.Type==30&&(t.ClientPos=this.CorssCursorIndex.DayIndex+300),this.DrawDynamicInfo(t)}}},this.SetCorssCursorIndex=function(t){if(this.EnableNewIndex&&(k.Chart.Log("[MinuteChartContainer::SetCorssCursorIndex] option ",t),t.ParentFunction=="OnMouseMove")){this.CorssCursorIndex.Point.X=t.Point.X,this.CorssCursorIndex.Point.Y=t.Point.Y;var n=this.PtInClient_V2(t.Point.X,t.Point.Y);if(k.Chart.Log("[MinuteChartContainer::SetCorssCursorIndex] clientPos ",n),n<=0){this.CorssCursorIndex={DayIndex:-1,DataIndex:-1,Point:{X:-1,Y:-1},Type:n};return}if(!this.Frame.SubFrame[0]||!this.Frame.SubFrame[0].Frame){this.CorssCursorIndex={DayIndex:-1,DataIndex:-1,Point:{X:-1,Y:-1},Type:-1};return}var s=this.Frame.SubFrame[0].Frame;if(n==1||n==2||n==3){if(this.CorssCursorIndex.DayIndex=0,this.CorssCursorIndex.Type=n,n==2)s.GetLeftExtendXValidData(t.Point.X,{Data:this.BeforeOpenData,IndexData:this.CorssCursorIndex});else if(n==3)s.GetRightExtendXValidData(t.Point.X,{Data:this.AfterCloseData,IndexData:this.CorssCursorIndex});else if(n==1){var o=s.GetXData(t.Point.X);this.CorssCursorIndex.DataIndex=parseInt(o.toFixed(0))}}else if(n>=100&&n<=199){this.CorssCursorIndex.DayIndex=n-100,this.CorssCursorIndex.Type=10;var o=s.GetXData(t.Point.X),l=parseInt(o.toFixed(0));this.CorssCursorIndex.DataIndex=l%s.MinuteCount}else if(n>=200&&n<=299){this.CorssCursorIndex.DayIndex=n-200,this.CorssCursorIndex.Type=20;var h=this.MultiDayBeforeOpenData;if(this.DayOffset){var u=0,f=this.MultiDayBeforeOpenData.length;v.IsNumber(this.DayOffset.Offset)&&(u=this.DayOffset.Offset),v.IsNumber(this.DayOffset.ShowDayCount)&&(f=this.DayOffset.ShowDayCount),h=this.MultiDayBeforeOpenData.slice(u,u+f)}s.GetLeftExtendXValidData(t.Point.X,{Data:h,IndexData:this.CorssCursorIndex})}else if(n>=300&&n<=399){this.CorssCursorIndex.DayIndex=n-300,this.CorssCursorIndex.Type=30;var h=this.MultiDayAfterCloseData;if(this.DayOffset&&this.MultiDayAfterCloseData){var u=0,f=this.MultiDayAfterCloseData.length;v.IsNumber(this.DayOffset.Offset)&&(u=this.DayOffset.Offset),v.IsNumber(this.DayOffset.ShowDayCount)&&(f=this.DayOffset.ShowDayCount),h=this.MultiDayAfterCloseData.slice(u,u+f)}s.GetRightExtendXValidData(t.Point.X,{Data:h,IndexData:this.CorssCursorIndex})}this.LastPoint.X=this.CorssCursorIndex.Point.X,t.Point.X=this.CorssCursorIndex.Point.X}},this.PtInClient_V2=function(t,n){if(this.Canvas.beginPath(),this.Frame.IsHScreen===!0){var s=this.Frame.ChartBorder.GetHScreenBorder();this.Canvas.rect(s.Left,s.TopEx,s.Right-s.Left,s.BottomEx-s.TopEx)}else{var s=this.Frame.ChartBorder.GetBorder();if(s.DayBorder){for(var o=0;o<s.DayBorder.length;++o){var l=s.DayBorder[o];if(this.Canvas.beginPath(),this.Canvas.rect(l.LeftEx,s.TopEx,l.RightEx-l.LeftEx,s.BottomEx-s.TopEx),this.Canvas.isPointInPath(t,n))return 100+o;if(this.Canvas.beginPath(),this.Canvas.rect(l.Left,s.TopEx,l.LeftEx-l.Left,s.BottomEx-s.TopEx),this.Canvas.isPointInPath(t,n))return 200+o;if(this.Canvas.beginPath(),this.Canvas.rect(l.RightEx,s.TopEx,l.Right-l.RightEx,s.BottomEx-s.TopEx),this.Canvas.isPointInPath(t,n))return 300+o}return-2}this.Canvas.rect(s.LeftEx,s.Top,s.RightEx-s.LeftEx,s.Bottom-s.Top)}return this.Canvas.isPointInPath(t,n)?1:this.Frame.ChartBorder.LeftExtendWidth>10&&(this.Canvas.beginPath(),this.Frame.IsHScreen===!0?this.Canvas.rect(s.Left,s.Top,s.Right-s.Left,s.TopEx-s.Top):this.Canvas.rect(s.Left,s.Top,s.LeftEx-s.Left,s.Bottom-s.Top),this.Canvas.isPointInPath(t,n))?2:this.Frame.ChartBorder.RightExtendWidth>10&&(this.Canvas.beginPath(),this.Frame.IsHScreen===!0?this.Canvas.rect(s.Left,s.BottomEx,s.Right-s.Left,s.Bottom-s.BottomEx):this.Canvas.rect(s.RightEx,s.Top,s.Right-s.RightEx,s.Bottom-s.Top),this.Canvas.isPointInPath(t,n))?3:-1},this.OnTouchStart=function(t){var n=this;if(this.DragMode!=0&&!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){if(this.IsPress=!1,this.IsOnTouch=!0,this.TouchDrawCount=0,this.PhonePinch=null,this.StopDragTimer(),this.EnableScrollUpDown==!1&&t.preventDefault(),this.IsPhoneDragging(t)){var s={Click:{},LastMove:{}},o=this.GetToucheData(t,this.IsForceLandscape),l=this.PointAbsoluteToRelative(o[0].clientX,o[0].clientY,!0);if(this.TryClickLock||this.TryClickIndexTitle){var h=l.X,u=l.Y;if(this.TryClickLock&&this.TryClickLock(h,u)||this.TryClickIndexTitle&&this.TryClickIndexTitle(h,u))return}if(this.ClickFrameButton){var f=this.Frame.PtInButtons(l.X,l.Y);if(f){this.ClickFrameButton(f,t);return}}s.Click.X=o[0].clientX,s.Click.Y=o[0].clientY,s.LastMove.X=o[0].clientX,s.LastMove.Y=o[0].clientY;var C=this,D=function(){if(C.ChartCorssCursor.IsShow===!0){var R=C.PointAbsoluteToRelative(s.Click.X,s.Click.Y,!0),A=R.X,P=R.Y;C.OnMouseMove(A,P,t)}};if(this.ChartDrawOption.IsLockScreen)if(this.MouseDrag=s,this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.IsSelected=!1),this.SelectChartDrawPicture=null,this.CurrentChartDrawPicture){var c=this.CurrentChartDrawPicture;c.Status==2?this.SetChartDrawPictureThirdPoint(s.Click.X,s.Click.Y,!0):(this.SetChartDrawPictureFirstPoint(s.Click.X,s.Click.Y,!0),this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo({Corss:!1,Tooltip:!1})),t.cancelable&&t.preventDefault();return}else{var T={};if(T.X=o[0].clientX-e.getBoundingClientRect().left,T.Y=o[0].clientY-e.getBoundingClientRect().top,this.GetChartDrawPictureByPoint(T)){T.ChartDrawPicture.EnableMove==!0&&(T.ChartDrawPicture.Status=20),T.ChartDrawPicture.ValueToPoint(),T.ChartDrawPicture.MovePointIndex=T.PointIndex,T.ChartDrawPicture.IsSelected=!0,this.CurrentChartDrawPicture=T.ChartDrawPicture,this.SelectChartDrawPicture=T.ChartDrawPicture;var S=this.GetEventCallback($.ON_CLICK_DRAWPICTURE);if(S&&S.Callback){var I={DrawPicture:T.ChartDrawPicture};S.Callback(S,I,this)}t.cancelable&&t.preventDefault();return}}else{this.EnableScrollUpDown==!0&&(this.DragTimer=setTimeout(function(){C.IsPress=!0,s.Click.X==s.LastMove.X&&s.Click.Y==s.LastMove.Y&&(C.MouseDrag,C.MouseDrag=null,D(),C.PreventTouchEvent(t))},800)),this.MouseDrag=s,this.PhoneTouchInfo={Start:{X:o[0].clientX,Y:o[0].clientY},End:{X:o[0].clientX,Y:o[0].clientY}},this.SelectChartDrawPicture=null;var g=!0;this.EnableClickModel&&(this.ClickModel.IsShowCorssCursor==!0?g=!1:g=!0),g?(this.StopDragTimer(),this.DragTimer=setTimeout(function(){n.IsPress=!0,s.Click.X==s.LastMove.X&&s.Click.Y==s.LastMove.Y&&(n.MouseDrag=null,s.Click.X,s.Click.Y,n.EnableClickModel===!0&&(n.ClickModel.IsShowCorssCursor=!0),C.MoveCorssCursor(s.Click,t))},this.PressTime)):this.EnableClickModel||(this.EnableScrollUpDown==!1||this.IsClickShowCorssCursor)&&D()}this.EnableZoomIndexWindow&&(this.PhoneDBClick.AddTouchStart(o[0].clientX,o[0].clientY,Date.now()),k.Chart.Log("[MinuteChartContainer::OnTouchStart] PhoneDBClick ",this.PhoneDBClick)),this.TouchEvent({EventID:$.ON_PHONE_TOUCH,FunctionName:"OnTouchStart"},t)}else if(this.IsPhonePinching(t)){var E={Start:{},Last:{}},o=this.GetToucheData(t,this.IsForceLandscape);E.Start={X:o[0].pageX,Y:o[0].pageY,X2:o[1].pageX,Y2:o[1].pageY},E.Last={X:o[0].pageX,Y:o[0].pageY,X2:o[1].pageX,Y2:o[1].pageY},this.PhonePinch=E,this.SelectChartDrawPicture=null}}},this.OnTouchMove=function(t){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var n=this.GetToucheData(t,this.IsForceLandscape);if(this.IsPhoneDragging(t)){var s=this.MouseDrag;if(s==null){var o=B(),l=n[0].clientX-e.getBoundingClientRect().left*o,h=n[0].clientY-e.getBoundingClientRect().top*o;this.OnMouseMove(l,h,t)}else{var u=this.GetMoveAngle(s.LastMove,{X:n[0].clientX,Y:n[0].clientY}),f=Math.abs(s.LastMove.X-n[0].clientX),C=Math.abs(s.LastMove.Y-n[0].clientY);if(f=parseInt(f),this.CurrentChartDrawPicture&&this.CurrentChartDrawPicture.EnableMove===!0){var D=this.CurrentChartDrawPicture;if(D.Status==1||D.Status==2){if(f<5&&C<5)return;this.SetChartDrawPictureSecondPoint(n[0].clientX,n[0].clientY,!0)&&this.DrawDynamicInfo()}else if(D.Status==3)this.SetChartDrawPictureThirdPoint(n[0].clientX,n[0].clientY,!0)&&this.DrawDynamicInfo();else if(D.Status==20){if(f<5&&C<5)return;this.MoveChartDrawPicture(n[0].clientX-s.LastMove.X,n[0].clientY-s.LastMove.Y,!0)&&this.DrawDynamicInfo()}s.LastMove.X=n[0].clientX,s.LastMove.Y=n[0].clientY}else if(!(this.EnableClickModel&&this.ClickModel.IsShowCorssCursor===!1)){if((C>0&&f<=3||u<=this.TouchMoveMinAngle)&&this.EnableScrollUpDown==!0){this.StopDragTimer();return}this.PreventTouchEvent(t),this.MouseDrag=null;var o=B(),l=n[0].clientX-e.getBoundingClientRect().left*o,h=n[0].clientY-e.getBoundingClientRect().top*o;this.OnMouseMove(l,h,t)}}this.PhoneTouchInfo&&(this.PhoneTouchInfo.End.X=n[0].clientX,this.PhoneTouchInfo.End.Y=n[0].clientY)}else if(this.IsPhonePinching(t)){this.PreventTouchEvent(t);var c=this.PhonePinch;if(!c)return;var T=Math.abs(n[0].pageY-n[1].pageY),S=Math.abs(c.Last.Y-c.Last.Y2),I=T-S,g=Math.abs(n[0].pageX-n[1].pageX),E=Math.abs(c.Last.X-c.Last.X2),F=g-E,R=this.ZoomStepPixel;if(Math.abs(F)>R){var A=this.GetEventCallback($.ON_MINUTE_TOUCH_ZOOM);if(A&&A.Callback){var P={XStep:F,YStep:I,PreventDefault:!1};if(A.Callback(A,P,this),P.PreventDefault){this.PhonePinch=null,this.StopDragTimer();return}}}c.Last={X:n[0].pageX,Y:n[0].pageY,X2:n[1].pageX,Y2:n[1].pageY}}this.EnableScrollUpDown==!1?t.preventDefault():s==null?this.PreventTouchEvent(t):this.StopDragTimer()}},this.OnTouchEnd=function(t){if(k.Chart.Log("[MinuteChartContainer::OnTouchEnd]",t),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){if(this.CurrentChartDrawPicture){var n=this.CurrentChartDrawPicture;n.Status==2||n.Status==1||n.Status==3?(n.PointStatus=n.Status,this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo()):n.Status==20&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}if(this.EnableZoomIndexWindow){var s=Date.now();this.PhoneDBClick.AddTouchEnd(s),this.PhoneDBClick.IsVaildDBClick()&&(this.OnTouchDBClick(this.PhoneDBClick.Start),this.PhoneDBClick.Clear())}this.IsOnTouch=!1,this.StopDragTimer(),this.TouchEvent({EventID:$.ON_PHONE_TOUCH,FunctionName:"OnTouchEnd"},t),this.OnTouchFinished(),this.TouchDrawCount=0}},this.OnKeyDown=function(t){if(this.StopDisplayLatest(),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var n=this.GetEventCallback($.ON_KEYDOWN);if(n&&n.Callback){var s={e:t,PreventDefault:!1};if(n.Callback(n,s,this),s.PreventDefault)return}var o=t.keyCode?t.keyCode:t.which,l=!1;if(this.ChartCorssCursor&&this.ChartCorssCursor.OnKeyDown){var s={e:t,KeyID:o,Draw:!1,PreventDefault:!1};this.ChartCorssCursor.OnKeyDown(s),l=s.Draw}switch(o){case 37:if(this.EnableNewIndex)this.MoveCorssCursorIndex({IsMoveLeft:!0});else{if(!v.IsNumber(this.CursorIndex)){var h=0;this.Frame.XPointCount?h=this.Frame.XPointCount:h=this.Frame.SubFrame[0].Frame.XPointCount,this.CursorIndex=h-1}if(this.CursorIndex=parseInt(this.CursorIndex),this.CursorIndex<=.99999){if(!this.DataMoveLeft())break;this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw()}else--this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo()}break;case 39:if(this.EnableNewIndex)this.MoveCorssCursorIndex({IsMoveLeft:!1});else{var h=0;if(this.Frame.XPointCount?h=this.Frame.XPointCount:h=this.Frame.SubFrame[0].Frame.XPointCount,v.IsNumber(this.CursorIndex)||(this.CursorIndex=0),this.CursorIndex=parseInt(this.CursorIndex),this.CursorIndex+1>=h){if(!this.DataMoveRight())break;this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw()}else{var u=null;if(this.Frame.Data?u=this.Frame.Data:u=this.Frame.SubFrame[0].Frame.Data,!u||this.CursorIndex+u.DataOffset+1>=u.Data.length)break;++this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo()}}break;case 46:if(this.SelectChartDrawPicture){var f=this.SelectChartDrawPicture;k.Chart.Log(f,"drawPicturedrawPicturedrawPicture"),this.SelectChartDrawPicture=null,this.ClearChartDrawPicture(f)}else if(this.SelectedChart&&this.SelectedChart.Selected.Identify){var C=this.GetSelectedChartInfo(this.SelectedChart.Selected);C&&(C.Type==Ye.OVERLAY_INDEX?this.DeleteOverlayWindowsIndex(C.IndexID):C.Type==Ye.OVERLAY_MINUTE&&this.DeleteOverlaySymbol(C.Symbol))}break;case 32:this.OnMarkRectSelect(t);break;case 33:if(this.PageInfo.Enable){var D={ID:ve.OP_SCROLL_LEFT,Step:this.PageInfo.ShowDayCount};this.ChartOperator(D)}break;case 34:if(this.PageInfo.Enable){var D={ID:ve.OP_SCROLL_RIGHT,Step:this.PageInfo.ShowDayCount};this.ChartOperator(D)}break;case 27:if(this.CurrentChartDrawPicture){var f=this.CurrentChartDrawPicture;f.Status!=20&&(this.CurrentChartDrawPicture=null)}break;default:return}l&&this.DrawDynamicInfo(),t.preventDefault?t.preventDefault():t.returnValue=!1}},this.OnMarkRectSelect=function(t){var n=this.ChartCorssCursor;if(!(!n||n.Status==0)&&v.IsNumber(n.CursorIndex)&&!(!this.SourceData||!this.SourceData.Data)){var s=this.GetRectSelectPaint();if(s){var o=n.CursorIndex;k.Chart.Log("[MinuteChartContainer::OnMarkRectSelect] dataIndex",o);var l=this.SourceData;o=parseInt(o.toFixed(0));var h=o+l.DataOffset;h>=l.Data.length&&(h=l.Data.length-1);var u=l.Data[h];if(k.Chart.Log("[MinuteChartContainer::OnMarkRectSelect] item",u),!!this.SetRectSelectData(u)){var f=s.GetPointCount(),C=B();if(f==1){var D=this.GetEventCallback($.ON_KEYDOWN_SELECT_RECT_FIRST);if(D&&D.Callback){var c={X:n.LastPoint.X/C,Y:n.LastPoint.Y/C,Item:u,Index:h,RectSelectPaint:s,e:t};D.Callback(D,c,this)}}else if(f==2){var T=s.GetSelectRectData(),D=this.GetEventCallback($.ON_KEYDOWN_SELECT_RECT);if(D&&D.Callback){var c={X:n.LastPoint.X/C,Y:n.LastPoint.Y/C,SelectData:T,RectSelectPaint:s,e:t};D.Callback(D,c,this)}this.DialogSelectRect&&(t.data={Chart:this,X:n.LastPoint.X/C,Y:n.LastPoint.Y/C,SelectData:T,RectSelectPaint:s},this.DrawSelectRectDialog(t))}this.Draw()}}}},this.OnRightMenu=function(t,n,s){var o=B(),l=this.Frame.PtInFrame(t*o,n*o);this.PopupRightMenuV2({X:s.offsetX,Y:s.offsetY,FrameID:l},s);var h=this.GetEventCallback($.ON_CONTEXT_MENU);if(h){var u={X:t,Y:n,Event:s,FrameID:l};h.Callback(h,u,this)}},this.GetRightMenuData=function(t){for(var n=this.Frame.SubFrame.length,s=[],o=0;o<this.OverlayChartPaint.length;++o){var l=this.OverlayChartPaint[o];l&&l.Symbol&&s.push(l.Symbol)}var h=!1;this.ChartCorssCursor&&(h=this.ChartCorssCursor.IsShowCorss);var u=[{Name:"叠加品种",SubMenu:[{Name:"上证指数",Data:{ID:q.CMD_OVERLAY_SYMBOL_ID,Args:["000001.sh",!s.includes("000001.sh")]},Checked:s.includes("000001.sh")},{Name:"深证成指",Data:{ID:q.CMD_OVERLAY_SYMBOL_ID,Args:["399001.sz",!s.includes("399001.sz")]},Checked:s.includes("399001.sz")},{Name:"中小板指",Data:{ID:q.CMD_OVERLAY_SYMBOL_ID,Args:["399005.sz",!s.includes("399005.sz")]},Checked:s.includes("399005.sz")},{Name:"创业板指",Data:{ID:q.CMD_OVERLAY_SYMBOL_ID,Args:["399006.sz",!s.includes("399006.sz")]},Checked:s.includes("399006.sz")},{Name:"沪深300",Data:{ID:q.CMD_OVERLAY_SYMBOL_ID,Args:["000300.sh",!s.includes("000300.sh")]},Checked:s.includes("000300.sh")}]},{Name:"多日分时图",SubMenu:[{Name:"当日分时图",Data:{ID:q.CMD_CHANGE_DAY_COUNT_ID,Args:[1]},Checked:this.DayCount==1},{Name:"最近2日",Data:{ID:q.CMD_CHANGE_DAY_COUNT_ID,Args:[2]},Checked:this.DayCount==2},{Name:"最近3日",Data:{ID:q.CMD_CHANGE_DAY_COUNT_ID,Args:[3]},Checked:this.DayCount==3},{Name:"最近4日",Data:{ID:q.CMD_CHANGE_DAY_COUNT_ID,Args:[4]},Checked:this.DayCount==4},{Name:"最近5日",Data:{ID:q.CMD_CHANGE_DAY_COUNT_ID,Args:[5]},Checked:this.DayCount==5},{Name:"基准线选择",SubMenu:[{Name:"最新昨收价",Data:{ID:q.CMD_CHANGE_BASELINE_ID,Args:[0]},Checked:this.BaselineType===0},{Name:"多日前昨收价",Data:{ID:q.CMD_CHANGE_BASELINE_ID,Args:[1]},Checked:this.BaselineType===1}]}]},{Name:"指标窗口个数",SubMenu:[{Name:"1个窗口",Data:{ID:q.CMD_CHANGE_WINDOW_COUNT_ID,Args:[2]},Checked:n==3},{Name:"2个窗口",Data:{ID:q.CMD_CHANGE_WINDOW_COUNT_ID,Args:[3]},Checked:n==4},{Name:"3个窗口",Data:{ID:q.CMD_CHANGE_WINDOW_COUNT_ID,Args:[4]},Checked:n==5},{Name:"4个窗口",Data:{ID:q.CMD_CHANGE_WINDOW_COUNT_ID,Args:[5]},Checked:n==6},{Name:"5个窗口",Data:{ID:q.CMD_CHANGE_WINDOW_COUNT_ID,Args:[6]},Checked:n==7}]},{Name:"指标切换",SubMenu:[{Name:"MACD",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"MACD"]}},{Name:"DMI",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"DMI"]}},{Name:"DMA",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"DMA"]}},{Name:"BRAR",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"BRAR"]}},{Name:"KDJ",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"KDJ"]}},{Name:"RSI",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"RSI"]}},{Name:"WR",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"WR"]}},{Name:"CCI",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"CCI"]}},{Name:"TRIX",Data:{ID:q.CMD_CHANGE_INDEX_ID,Args:[t,"TRIX"]}}]},{Name:"区间选择",Data:{ID:q.CMD_ENABLE_SELECT_RECT_ID,Args:[!this.EnableSelectRect]},Checked:this.EnableSelectRect},{Name:"其他设置",SubMenu:[{Name:"画图工具",Data:{ID:q.CMD_SHOW_DRAWTOOL_ID,Args:[]},Checked:this.IsShowDrawToolDialog()},{Name:"十字光标线",Data:{ID:q.CMD_SHOW_CORSS_LINE_ID,Args:[!h]},Checked:h},{Name:Ne.SEPARATOR_LINE_NAME},{Name:"语言设置",SubMenu:[{Name:"中文",Data:{ID:q.CMD_CHANGE_LANGUAGE_ID,Args:["CN"]},Checked:this.LanguageID==xe.LANGUAGE_CHINESE_ID},{Name:"英语",Data:{ID:q.CMD_CHANGE_LANGUAGE_ID,Args:["EN"]},Checked:this.LanguageID==xe.LANGUAGE_ENGLISH_ID},{Name:"繁体",Data:{ID:q.CMD_CHANGE_LANGUAGE_ID,Args:["TC"]},Checked:this.LanguageID==xe.LANGUAGE_TRADITIONAL_CHINESE_ID}]},{Name:"区间选择样式",SubMenu:[{Name:"样式1(默认)",Data:{ID:q.CMD_CHANGE_DRAG_RECT_SHOW_MODE_ID,Args:[0]},Checked:this.ChartDragSelectRect.ShowMode==0},{Name:"样式2",Data:{ID:q.CMD_CHANGE_DRAG_RECT_SHOW_MODE_ID,Args:[1]},Checked:this.ChartDragSelectRect.ShowMode==1},{Name:"样式3",Data:{ID:q.CMD_CHANGE_DRAG_RECT_SHOW_MODE_ID,Args:[2]},Checked:this.ChartDragSelectRect.ShowMode==2}]},{Name:"K线浮动框",SubMenu:[{Name:"禁用",Data:{ID:q.CMD_DIALOG_TOOLTIP_ATTRIBUTE,Args:[{Enable:!1}]},Checked:!this.DialogTooltip},{Name:"样式1",Data:{ID:q.CMD_DIALOG_TOOLTIP_ATTRIBUTE,Args:[{Enable:!0,Style:0}]},Checked:this.DialogTooltip&&this.DialogTooltip.Style===0},{Name:"样式2",Data:{ID:q.CMD_DIALOG_TOOLTIP_ATTRIBUTE,Args:[{Enable:!0,Style:1}]},Checked:this.DialogTooltip&&this.DialogTooltip.Style===1}]}]}];if(U.IsSHSZStockA(this.Symbol)){var l={Name:"集合竞价",Data:{ID:q.CMD_SHOW_BEFORE_DATA_ID,Args:[!this.IsShowBeforeData]},Checked:this.IsShowBeforeData};u.splice(4,0,l)}for(var o=0;o<u.length;++o){var l=u[o];if(l.Name=="叠加品种"){for(var f=0;f<l.SubMenu.length;++f)if(l.SubMenu[f].Checked){l.SubMenu.push({Name:Ne.SEPARATOR_LINE_NAME}),l.SubMenu.push({Name:"取消叠加",Data:{ID:q.CMD_DELETE_ALL_OVERLAY_SYMBOL_ID}});break}}}return u},this.OnWheel=function(t){k.Chart.Log("[MinuteChartContainer::OnWheel]",t)},this.OnDoubleClick=function(t,n,s){k.Chart.Log("[MinuteChartContainer::OnDoubleClick]",s),this.ClickChartTimer!=null&&(clearTimeout(this.ClickChartTimer),this.ClickChartTimer=null);var o;this.SelectedChart.EnableSelected&&(o=this.PtInChart(t,n));var l={SelectedChart:o};if(this.DBClickEvent(l,s),!o&&this.EnableZoomIndexWindow){var h=this.Frame.PtInFrame(t,n);k.Chart.Log("[MinuteChartContainer::OnDoubleClick] frameId",h),h>=this.Frame.ZoomStartWindowIndex&&this.ZoomIndexWindow(h,{X:t,Y:n})&&(this.Frame.SetSizeChage(!0),this.Draw())}},this.GetDataItem=function(t){if(!t||!v.IsNumber(t.Index)||!this.SourceData||!this.SourceData.Data)return null;var n=this.SourceData,s=t.ClientPos;if(s==2||s==3||s>=200&&s<=299||s>=300&&s<=399){if(!this.ChartCorssCursor||!this.ChartCorssCursor.CallAcutionXOperator)return null;var o=this.Frame.IsHScreen===!0,l=this.ChartCorssCursor.CallAcutionXOperator;if(l.Value=o?t.Point.Y:t.Point.X,l.Point={X:t.Point.X,Y:t.Point.Y},l.ClientPos=s,s==2){if(!this.BeforeOpenData)return null}else if(s==3){if(!this.AfterCloseData)return null}else if(s>=200&&s<=299){if(!this.MultiDayBeforeOpenData||!v.IsNonEmptyArray(this.MultiDayBeforeOpenData))return}else if(s>=300&&tclientPos<=399&&(!this.MultiDayAfterCloseData||!v.IsNonEmptyArray(this.MultiDayAfterCloseData)))return;if(l.Operator()){var f=l.Item;return{Type:s,Item:f,Index:l.DataIndex}}return null}var h=parseInt(t.Index.toFixed(0)),u=h+n.DataOffset;if(u>=n.Data.length)return null;var f=n.Data[u];return{Type:s,Item:f,Index:u}},this.UpdatePointByCursorIndex=function(){this.LastPoint.X=this.Frame.GetXFromIndex(this.CursorIndex);var t=this.CursorIndex;t=parseInt(t.toFixed(0));var n=this.Frame.SourceData;if(!(n.DataOffset+t>=n.Data.length)){var s=n.Data[n.DataOffset+t],o=null;s.Before?o=s.Before.Close:o=s.Close,this.LastPoint.Y=this.Frame.GetYFromData(o)}},this.Create=function(t,n){var s=this;this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new Bn,this.ChartCorssCursor.PtInClient=function(C,D){return s.PtInClient(C,D)},this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=Je.Create("CorssCursor_Minute_XStringFormat"),this.ChartCorssCursor.StringFormatX.GetEventCallback=function(C){return s.GetEventCallback(C)},this.ChartCorssCursor.StringFormatY=Je.Create("CorssCursor_YStringFormat"),this.ChartCorssCursor.StringFormatY.GetEventCallback=function(C){return s.GetEventCallback(C)},this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY.ShareAfterVol=this.ShareAfterVol,this.ChartCorssCursor.CallAcutionXOperator=new Dh,this.ChartCorssCursor.GetEventCallback=function(C){return s.GetEventCallback(C)},this.ChartSplashPaint=new Li,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.HQChart=this,this.Frame=new Qh,this.Frame.ChartBorder=new ra,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=25,this.Frame.ChartBorder.TitleHeight=0,this.Frame.ChartBorder.Left=50,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.Frame.GetExtendChartRightWidth=function(){return s.GetExtendChartRightWidth()},this.Frame.GetEventCallback=function(C){return s.GetEventCallback(C)},this.Frame.ZoomStartWindowIndex=2,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(t),this.CreateMainKLine(),this.CreateExtendChart("RectSelectPaint",n?n.SelectRect:null),this.EnableIndexChartDrag&&this.CreateExtendChart("DragMovePaint"),this.CreateDragSelectRect(n?n.DragSelectRect:null);for(var o=0;o<this.Frame.SubFrame.length;++o){var l=new Qa;(o==0||o==1)&&(l.IsShowMainIndexTitle=!1),l.Frame=this.Frame.SubFrame[o].Frame,l.Canvas=this.Canvas,l.LanguageID=this.LanguageID,l.GetEventCallback=function(C){return s.GetEventCallback(C)},l.SelectedChart=this.SelectedChart,l.MainTitlePaint=this.TitlePaint[0],this.TitlePaint.push(l)}this.ChartCorssCursor.StringFormatX.Frame=this.Frame.SubFrame[0].Frame,this.ChartCorssCursor.StringFormatY.Frame=this.Frame,this.ChartCorssCursor.CallAcutionXOperator&&(this.ChartCorssCursor.CallAcutionXOperator.Frame=this.Frame.SubFrame[0].Frame);var h=!0,u=!0;if(n&&n.Listener){var f=n.Listener;f.KeyDown===!1&&(h=!1,k.Chart.Log("[MinuteChartContainer::Create] not register keydown event.")),f.Wheel===!1&&(u=!1,k.Chart.Log("[MinuteChartContainer::Create] not register wheel event."))}h&&this.UIElement.addEventListener("keydown",function(C){s.OnKeyDown(C)},!0),u&&this.UIElement.addEventListener("wheel",function(C){s.OnWheel(C)},!0)},this.CreateChildWindow=function(t){for(var n=this,s=this.GetEventCallback($.ON_CREATE_FRAME),o=0;o<t;++o){var l=new ra;l.UIElement=this.UIElement;var h=new hn;h.Canvas=this.Canvas,h.ChartBorder=l,h.Identify=o,h.GlobalOption=this.GlobalOption,o<2&&(h.ChartBorder.TitleHeight=0),h.XPointCount=243,h.HQChart=this,h.GetEventCallback=function(c){return n.GetEventCallback(c)};var u=[9,8,7,6,5,4,3,2,1];h.HorizontalMax=u[0],h.HorizontalMin=u[u.length-1],o==0?(h.YSplitOperator=new sD,h.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price"),h.YSplitOperator.GetEventCallback=function(c){return n.GetEventCallback(c)},h.YSplitOperator.DayOffset=this.DayOffset,h.YSplitOperator.GlobalOption=this.GlobalOption,h.YSplitOperator.HQChart=this):(h.YSplitOperator=new Za,h.YSplitOperator.LanguageID=this.LanguageID,h.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),h.YSplitOperator.GetEventCallback=function(c){return n.GetEventCallback(c)},o==1&&(h.YSplitOperator.ShareAfterVol=this.ShareAfterVol)),h.YSplitOperator.Frame=h,h.YSplitOperator.ChartBorder=l,h.XSplitOperator=new Ch,h.XSplitOperator.Frame=h,h.XSplitOperator.ChartBorder=l,h.XSplitOperator.DayOffset=this.DayOffset,h.XSplitOperator.GetEventCallback=function(c){return n.GetEventCallback(c)},o!=t-1&&(h.XSplitOperator.ShowText=!1),h.XSplitOperator.Operator();for(var f in u)h.HorizontalInfo[f]=new Ut,h.HorizontalInfo[f].Value=u[f],!(o==0&&f==h.HorizontalMin)&&(h.HorizontalInfo[f].Message[1]=u[f].toString(),h.HorizontalInfo[f].Font="14px 微软雅黑");var C=new yr;if(h.FrameData.SubFrameItem=C,C.Frame=h,o==0?C.Height=20:C.Height=10,this.Frame.SubFrame[o]=C,s&&s.Callback){var D={SubFrame:this.Frame.SubFrame[o],WindowIndex:o};s.Callback(s,D,this)}}},this.CreateSubFrameItem=function(t,n){var s=this,o=new ra;if(o.UIElement=this.UIElement,n&&n.ChartBorder&&n.ChartBorder.MultiDayMinute){var l=n.ChartBorder.MultiDayMinute;o.MultiDayMinute.Count=l.Count,o.MultiDayMinute.Left=l.Left,o.MultiDayMinute.Right=l.Right}var h=null;this.ClassName=="MinuteChartHScreenContainer"?h=new Jh:h=new hn,h.Canvas=this.Canvas,h.ChartBorder=o,h.Identify=t,h.XPointCount=243,h.GlobalOption=this.GlobalOption,h.HQChart=this,h.GetEventCallback=function(S){return s.GetEventCallback(S)};var u=[9,8,7,6,5,4,3,2,1];h.HorizontalMax=u[0],h.HorizontalMin=u[u.length-1],h.YSplitOperator=new Za,h.YSplitOperator.LanguageID=this.LanguageID,h.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),h.YSplitOperator.Frame=h,h.YSplitOperator.ChartBorder=o,h.XSplitOperator=new Ch,h.XSplitOperator.Frame=h,h.XSplitOperator.ChartBorder=o,h.XSplitOperator.ShowText=!1,h.XSplitOperator.DayOffset=this.DayOffset,h.XSplitOperator.GetEventCallback=function(S){return s.GetEventCallback(S)},h.YSplitOperator.GetEventCallback=function(S){return s.GetEventCallback(S)},h.XSplitOperator.Symbol=this.Symbol,this.DayCount>1&&(h.XSplitOperator.DayCount=this.DayData.length,h.XSplitOperator.DayData=this.DayData,h.DayCount=this.DayData.length);var f=this.Frame.SubFrame[0].Frame.XPointCount;h.XPointCount=f,h.Data=this.ChartPaint[0].Data;for(var C in u)h.HorizontalInfo[C]=new Ut,h.HorizontalInfo[C].Value=u[C],h.HorizontalInfo[C].Message[1]=u[C].toString(),h.HorizontalInfo[C].Font="14px 微软雅黑";var D=new yr;h.FrameData.SubFrameItem=D,D.Frame=h,D.Height=10;var c=this.GetEventCallback($.ON_CREATE_FRAME);if(c&&c.Callback){var T={SubFrame:D,WindowIndex:t};c.Callback(c,T,this)}return D},this.AddNewSubFrame=function(t){var n=this,s=this.Frame.SubFrame[0].Frame,o=this.Frame.SubFrame.length,l=this.CreateSubFrameItem(o,s),h=B();l.Frame.ChartBorder.TitleHeight*=h,this.Frame.SubFrame[o]=l;var u=new Qa;u.Frame=this.Frame.SubFrame[o].Frame,u.Canvas=this.Canvas,u.LanguageID=this.LanguageID,u.GetEventCallback=function(D){return n.GetEventCallback(D)},u.MainTitlePaint=this.TitlePaint[0],this.TitlePaint[o+1]=u,this.SetSubFrameOption(l,t);for(var f=0;f<this.Frame.SubFrame.length;++f){var C=this.Frame.SubFrame[f].Frame;f==this.Frame.SubFrame.length-1?C.XSplitOperator.ShowText=!0:C.XSplitOperator.ShowText=!1}return this.UpdataDataoffset(),this.Frame.SetSizeChage(!0),this.UpdateXShowText&&this.UpdateXShowText(),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw(),o},this.UpdateXShowText=function(){for(var t=!0,n=this.Frame.SubFrame.length-1;n>=0;--n){var s=this.Frame.SubFrame[n].Frame,o=this.Frame.SubFrame[n];t?(s.XSplitOperator.ShowText=!0,o.Height>0&&(t=!1)):s.XSplitOperator.ShowText=!1}},this.DeleteIndexPaint=function(t,n){var s=this.Frame.SubFrame[t].Frame;if(s){for(var o=[],l=0;l<this.ChartPaint.length;++l){var h=this.ChartPaint[l],u=h.ChartFrame.Guid==s.Guid||h.ChartFrame==s;l==0||!u?o.push(h):n===!0&&h&&h.OnDestroy&&h.OnDestroy()}s.YSpecificMaxMin=null,s.IsLocked=!1,s.YSplitOperator.SplitType=s.YSplitOperator.DefaultSplitType,this.ChartPaint=o;var f=t+1;this.TitlePaint[f].Data=[],this.TitlePaint[f].Title=null}},this.CreateStockInfo=function(){this.ExtendChartPaint[0]=new tI,this.ExtendChartPaint[0].Canvas=this.Canvas,this.ExtendChartPaint[0].ChartBorder=this.Frame.ChartBorder,this.ExtendChartPaint[0].ChartFrame=this.Frame,this.Frame.ChartBorder.Right=300},this.CreateMainKLine=function(){var t=this,n=Cs.Create("ChartMinutePriceLine");n.Canvas=this.Canvas,n.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,n.ChartFrame=this.Frame.SubFrame[0].Frame,n.Name="Minute-Line",n.Identify="Minute-Line",n.Color=d.Minute.PriceColor,n.LineWidth=d.Minute.PriceLineWidth,n.AreaColor=d.Minute.AreaPriceColor,n.GetEventCallback=function(l){return t.GetEventCallback(l)},this.ChartPaint[0]=n;var s=new YC;s.Canvas=this.Canvas,s.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,s.ChartFrame=this.Frame.SubFrame[0].Frame,s.Name="Minute-Average-Line",s.Identify="Minute-Average-Line",s.Color=d.Minute.AvPriceColor,s.IsDrawArea=!1,this.ChartPaint[1]=s;var o=Cs.Create("ChartMinuteVolumBar");o.Color=d.Minute.VolBarColor,o.Canvas=this.Canvas,o.ChartBorder=this.Frame.SubFrame[1].Frame.ChartBorder,o.ChartFrame=this.Frame.SubFrame[1].Frame,o.Name="Minute-Vol-Bar",o.Identify="Minute-Vol-Bar",o.ShareAfterVol=this.ShareAfterVol,this.ChartPaint[2]=o,this.TitlePaint[0]=new xI,this.TitlePaint[0].Frame=this.Frame.SubFrame[0].Frame,this.TitlePaint[0].Canvas=this.Canvas,this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.TitlePaint[0].LanguageID=this.LanguageID,this.TitlePaint[0].CallAcutionXOperator=new Dh,this.TitlePaint[0].CallAcutionXOperator.Frame=this.Frame.SubFrame[0].Frame,this.TitlePaint[0].HQChart=this},this.ChangeScriptIndex=function(t,n,s){this.DeleteIndexPaint(t,!0),this.WindowIndex[t]=new Ie(n.Name,n.Script,n.Args,n);var o=this.SourceData;this.BindIndexData(t,o),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangeAPIIndex=function(t,n){this.DeleteIndexPaint(t,!0);var s=n.API;this.WindowIndex[t]=new ga(s.Name,s.Script,s.Args,n),n&&n.Window&&this.SetFrameToolbar(t,n.Window),this.Frame.ClearUpDonwFrameYData({Index:t});var o=this.ChartPaint[0].Data;this.BindIndexData(t,o),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangeIndex=function(t,n,s){if(!(this.Frame.SubFrame.length<3)){if(s&&s.API)return this.ChangeAPIIndex(t,s);var o=new Z,l=o.Get(n);if(l)return t<2&&(t=2),t>=this.Frame.SubFrame.length&&(t=2),Z.ModifyAttribute(l,s),this.ChangeScriptIndex(t,l,s)}},this.ChangeIndexWindowCount=function(t){var n=this;if(!(t<2)&&this.Frame.SubFrame.length!=t){var s=this.Frame.SubFrame.length;if(s>t){for(var o=this.GetEventCallback($.ON_DELETE_FRAME),l=s-1;l>=t;--l){this.DeleteIndexPaint(l),this.DeleteChartPaintExtend({WindowIndex:l});var h=this.Frame.SubFrame[l].Frame;if(h.ClearToolbar&&h.ClearToolbar(),o&&o.Callback){var u={SubFrame:this.Frame.SubFrame[l],WindowIndex:l};o.Callback(o,u,this)}}this.Frame.SubFrame.splice(t,s-t),this.WindowIndex.splice(t,s-t),this.TitlePaint.splice(t+1,s-t)}else{for(var f=this.Frame.SubFrame[0].Frame,l=s;l<t;++l){var C=this.CreateSubFrameItem(l,f);this.Frame.SubFrame[l]=C;var D=new Qa;D.Frame=this.Frame.SubFrame[l].Frame,D.Canvas=this.Canvas,D.LanguageID=this.LanguageID,D.GetEventCallback=function(F){return n.GetEventCallback(F)},D.SelectedChart=this.SelectedChart,D.MainTitlePaint=this.TitlePaint[0],this.TitlePaint[l+1]=D}for(var c=["RSI","MACD","DMA","DMI","KDJ","WR"],T=new Z,l=s;l<t;++l){var S=c[l%c.length],I=T.Get(S);this.WindowIndex[l]=new Ie(I.Name,I.Script,I.Args,I);var g=this.SourceData;this.BindIndexData(l,g)}for(var l=0;l<this.Frame.SubFrame.length;++l){var h=this.Frame.SubFrame[l].Frame;l==this.Frame.SubFrame.length-1?h.XSplitOperator.ShowText=!0:h.XSplitOperator.ShowText=!1}this.UpdataDataoffset()}this.UpdateXShowText(),this.Frame.SetSizeChage(!0),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()}},this.ChangeIndexTemplate=function(t){var n=this;if(Array.isArray(t.Windows)){var s=t.Windows.length,o=this.Frame.SubFrame.length,l=2;s+=l;var h=null,u=null;v.IsNumber(t.DayCount)&&t.DayCount!=this.DayCount&&(h=t.DayCount),t.Symbol&&(u=t.Symbol);for(var f=h!=null||u!=null,C=l;C<o;++C){this.DeleteIndexPaint(C);var D=this.Frame.SubFrame[C];D.YSpecificMaxMin=null,D.IsLocked=!1,D.YSplitScale=null}if(o>s){for(var c=this.GetEventCallback($.ON_DELETE_FRAME),C=o-1;C>=s;--C)if(this.Frame.SubFrame[C].Frame.ClearToolbar(),c&&c.Callback){var T={SubFrame:this.Frame.SubFrame[C],WindowIndex:C};c.Callback(c,T,this)}this.Frame.SubFrame.splice(s,o-s),this.WindowIndex.splice(s,o-s),this.TitlePaint.splice(s+1,o-s)}else for(var C=o;C<s;++C){var S=this.CreateSubFrameItem(C);this.Frame.SubFrame[C]=S;var I=new Qa;I.Frame=this.Frame.SubFrame[C].Frame,I.Canvas=this.Canvas,I.LanguageID=this.LanguageID,I.GetEventCallback=function(vt){return n.GetEventCallback(vt)},I.SelectedChart=this.SelectedChart,I.MainTitlePaint=this.TitlePaint[0],this.TitlePaint[C+1]=I}for(var C=0;C<s;++C){var g=C,E=null,F=null;t.Frame&&t.Frame.length>C&&(F=t.Frame[g]),g>=l&&(E=t.Windows[g-l]);var R=g+1;if(this.TitlePaint[R].Data=[],this.TitlePaint[R].Title=null,E)if(E.Script)this.WindowIndex[g]=new Ie(E.Name,E.Script,E.Args,E);else if(E.API){var A=E.API;this.WindowIndex[g]=new ga(A.Name,A.Script,A.Args,E)}else{var P=E.Index,p=$a.Get(P);if(p)this.WindowIndex[g]=p.Create(),this.CreateWindowIndex(g);else{var w=new Z,H=w.Get(P);H&&(Z.ModifyAttribute(H,E),this.WindowIndex[g]=new Ie(H.Name,H.Script,H.Args,H))}}this.SetSubFrameAttribute(this.Frame.SubFrame[g],E,F)}for(var C=0;C<this.Frame.SubFrame.length;++C)this.DeleteWindowsOverlayIndex(C);for(var C=0;C<this.Frame.SubFrame.length;++C){var E=this.Frame.SubFrame[C].Frame;C==this.Frame.SubFrame.length-1?E.XSplitOperator.ShowText=!0:E.XSplitOperator.ShowText=!1}var W=[];if(v.IsNonEmptyArray(t.OverlayIndex))for(var C=0;C<t.OverlayIndex.length;++C){var E=t.OverlayIndex[C];E.Index&&(E.IndexName=E.Index),E.Windows>=0&&(E.WindowIndex=E.Windows);var ht=this.CreateOverlayWindowsIndex(E);ht&&W.push({WindowsIndex:E.WindowIndex,Overlay:ht})}if(this.Frame.SetSizeChage(!0),f){u||(u=this.Symbol);var t={};v.IsNumber(h)&&(t.DayCount=h),this.ChangeSymbol(u,t)}else{if(!this.SourceData){this.Draw();return}for(var rt=this.SourceData,C=0;C<s;++C)this.BindIndexData(C,rt);for(var C=0;C<W.length;++C){var E=W[C];this.BindOverlayIndexData(E.Overlay,E.WindowsIndex,rt)}this.UpdataDataoffset(),this.UpdateXShowText&&this.UpdateXShowText(),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()}}},this.RemoveIndexWindow=function(t){if(k.Chart.Log("[MinuteChartContainer::RemoveIndexWindow] remove id",t),!(t<2)&&this.Frame.SubFrame&&!(t>=this.Frame.SubFrame.length)){this.Frame.RestoreIndexWindows(),this.Frame.SubFrame[t].Frame,this.DeleteIndexPaint(t),this.DeleteChartPaintExtend({WindowIndex:t}),this.Frame.SubFrame[t].Frame.ClearToolbar();var n=this.GetEventCallback($.ON_DELETE_FRAME);if(n&&n.Callback){var s={SubFrame:this.Frame.SubFrame[t],WindowIndex:t};n.Callback(n,s,this)}this.Frame.SubFrame.splice(t,1),this.WindowIndex.splice(t,1),this.TitlePaint.splice(t+1,1);for(var o=0;o<this.Frame.SubFrame.length;++o){var l=this.Frame.SubFrame[o].Frame;o==this.Frame.SubFrame.length-1?l.XSplitOperator.ShowText=!0:l.XSplitOperator.ShowText=!1,l.Identify=o}this.Frame.SetSizeChage(!0),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()}},this.AutoUpdateEvent=function(t,n){var s=t?$.RECV_START_AUTOUPDATE:$.RECV_STOP_AUTOUPDATE;if(this.mapEvent.has(s)){var o=this,l=this.mapEvent.get(s),h={Stock:{Symbol:this.Symbol,Name:this.Name,DayCount:this.DayCount},Explain:n};t&&(h.Callback=function(u){o.RecvMinuteData(u)}),l.Callback(l,h,this)}},this.ClearIndexPaint=function(){if(this.Frame&&this.Frame.SubFrame)for(var t=0;t<this.Frame.SubFrame.length;++t){t>=2&&this.DeleteIndexPaint(t,!0);var n=this.Frame.SubFrame[t];if(v.IsNonEmptyArray(n.OverlayIndex))for(var s=0;s<n.OverlayIndex.length;++s){for(var o=n.OverlayIndex[s],l=0;l<o.ChartPaint.length;++l){var h=o.ChartPaint[l];h&&h.OnDestroy&&h.OnDestroy()}o.ChartPaint=[]}}for(var t=1;t<this.TitlePaint.length;++t){var n=this.TitlePaint[t];n.OverlayIndex=new Dt.default}},this.ResetDayOffset=function(){this.PageInfo.Enable?(this.DayOffset.Offset=this.PageInfo.Offset,this.DayOffset.ShowDayCount=this.PageInfo.ShowDayCount):(this.DayOffset.Offset=0,this.DayOffset.ShowDayCount=-1),this.DayOffset.PageInfo=null},this.ResetDataStatus=function(){this.DataStatus.MultiDay=!1,this.DataStatus.LatestDay=!1,this.DataStatus.LatestDate=null},this.ClearOverlaySymbolData=function(){for(var t=0;t<this.OverlayChartPaint.length;++t){var n=this.OverlayChartPaint[t];n.Status=Le.STATUS_NONE_ID,n.Data.Data=[]}},this.ChangeSymbol=function(t,n){if(this.StopDisplayLatest(),this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"MinuteChartContainer::ChangeSymbol"),this.Symbol=t,this.ResetDayOffset(),this.ResetDataStatus(),this.ClearIndexPaint(),this.ResetOverlaySymbolStatus(),this.ReloadChartDrawPicture(),this.ClearIndexRunCount(),this.ClearStockCache(),this.Frame.ClearYCoordinateMaxMin(),n){if(v.IsNumber(n.DayCount)&&(this.DayCount=n.DayCount),v.IsNonEmptyArray(n.Windows))for(var s=0;s<n.Windows.length;++s){var o=2+s;if(o>=this.WindowIndex.length)break;var l=n.Windows[s];if(l)if(l.Script)this.WindowIndex[o]=new Ie(l.Name,l.Script,l.Args,l);else if(l.API){var h=l.API;this.WindowIndex[o]=new ga(h.Name,h.Script,h.Args,l)}else{var u=new Z,f=l.Index,C=u.Get(f);C&&(Z.ModifyAttribute(C,l),C.ID=f,this.WindowIndex[o]=new Ie(C.Name,C.Script,C.Args,C))}}if(n.ClearOverlay===!0){for(var s=0;s<this.OverlayChartPaint.length;++s){var l=this.OverlayChartPaint[s];l.IsDelete=!0}this.OverlayChartPaint=[],this.Frame.SubFrame[0].Frame.YSplitOperator.OverlayChartPaint=this.OverlayChartPaint,this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint}if(n.Overlay&&v.IsNonEmptyArray(n.Overlay)){for(var D=new Fe.default,s=0;s<this.OverlayChartPaint.length;++s){var l=this.OverlayChartPaint[s];D.add(l.Symbol)}for(var s=0;s<n.Overlay.length;++s){var l=n.Overlay[s];if(!D.has(l.Symbol)){var c=new rn;c.Canvas=this.Canvas,c.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,c.ChartFrame=this.Frame.SubFrame[0].Frame,c.Name="Overlay-Minute",c.Symbol=l.Symbol,c.Identify="Overlay-Minute-"+l.Symbol,l.Color?c.Color=l.Color:c.Color=d.OverlaySymbol.Color[d.OverlaySymbol.Random%d.OverlaySymbol.Color.length],++d.OverlaySymbol.Random,c.MainData=this.SourceData,c.SetOption&&c.SetOption(l),this.OverlayChartPaint.push(c)}}}v.IsNonEmptyArray(n.AryDate)&&(this.AryDate=n.AryDate.slice())}!t||this.DayCount<=0?this.DrawEmpty():(this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.Draw(),this.RequestData())},this.SetPageInfo=function(t){t&&(v.IsBool(t.Enable)&&(this.PageInfo.Enable=t.Enable),v.IsNumber(t.Offset)&&(this.PageInfo.Offset=t.Offset),v.IsNumber(t.ShowDayCount)&&(this.PageInfo.ShowDayCount=t.ShowDayCount))},this.ClearMinuteData=function(){this.SourceData=null,this.DayData=null,this.BeforeOpenData=null,this.AfterCloseData=null,this.MultiDayBeforeOpenData=null,this.MultiDayAfterCloseData=null},this.ChangeDayCount=function(t,n){t<0||(this.StopDisplayLatest(),this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"MinuteChartContainer::ChangeDayCount"),this.DayCount=t,this.ClearMinuteData(),n&&n.PageInfo&&(this.SetPageInfo(n.PageInfo),this.ResetDayOffset()),n&&v.IsNonEmptyArray(n.AryDate)&&(this.AryDate=n.AryDate.slice()),this.ReloadChartDrawPicture(),this.ResetDataStatus(),this.ClearIndexPaint(),this.Frame.ClearYCoordinateMaxMin(),this.ResetOverlaySymbolStatus(),this.RequestData())},this.ChangeBaselineType=function(t){this.BaselineType!=t&&(this.BaselineType=t,this.DayCount>1&&this.RequestData())},this.OverlaySymbols=function(t,n){if(n&&n.ClearAll===!0){for(var s=0;s<this.OverlayChartPaint.length;++s){var o=this.OverlayChartPaint[s];o.IsDelete=!0}this.OverlayChartPaint=[]}for(var l=[],s=0,h=0;s<t.length;++s){var u=t[s],f=u.Symbol,C=!1;for(h=0;h<this.OverlayChartPaint.length;++h){var o=this.OverlayChartPaint[h];if(o.Symbol==f){C=!0,console.warn("[MinuteChartContainer::OverlaySymbols] overlay symbol="+f+" exist.");break}}C||l.push(u)}if(!v.IsNonEmptyArray(l))return!0;for(var s=0;s<l.length;++s){var u=l[s],f=u.Symbol,D=new rn;D.Canvas=this.Canvas,D.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,D.ChartFrame=this.Frame.SubFrame[0].Frame,D.Name="Overlay-Minute",D.Symbol=f,D.Identify="Overlay-Minute-"+f,u.Option&&u.Option.Color?D.Color=u.Option.Color:D.Color=d.OverlaySymbol.Color[d.OverlaySymbol.Random%d.OverlaySymbol.Color.length],++d.OverlaySymbol.Random,D.MainData=this.SourceData,D.SetOption&&D.SetOption(u.Option),this.OverlayChartPaint.push(D)}return this.DayCount<=1?this.RequestOverlayMinuteData():this.RequestOverlayHistoryMinuteData(),!0},this.OverlaySymbol=function(t,n){var s=null;if(v.IsString(t)?s=[t]:Array.isArray(t)&&(s=t),!v.IsNonEmptyArray(s))return!1;for(var o=[],l=0,h=0;l<s.length;++l){var u=s[l],f=!1;for(h=0;h<this.OverlayChartPaint.length;++h){var C=this.OverlayChartPaint[h];if(C.Symbol==u){f=!0,console.warn("[MinuteChartContainer::OverlaySymbol] overlay symbol="+u+" exist.");break}}f||o.push(u)}if(!v.IsNonEmptyArray(o))return!0;for(var l=0;l<o.length;++l){var u=o[l],D=new rn;D.Canvas=this.Canvas,D.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,D.ChartFrame=this.Frame.SubFrame[0].Frame,D.Name="Overlay-Minute",D.Symbol=u,D.Identify="Overlay-Minute-"+u,n&&n.Color?D.Color=n.Color:D.Color=d.OverlaySymbol.Color[d.OverlaySymbol.Random%d.OverlaySymbol.Color.length],++d.OverlaySymbol.Random,D.MainData=this.SourceData,D.SetOption&&D.SetOption(n),this.OverlayChartPaint.push(D)}return this.DayCount<=1?this.RequestOverlayMinuteData():this.RequestOverlayHistoryMinuteData(),!0},this.DeleteOverlaySymbol=function(t){for(var n in this.OverlayChartPaint){var s=this.OverlayChartPaint[n];if(s.Symbol===t)return s.IsDelete=!0,this.OverlayChartPaint.splice(n,1),this.UpdateFrameMaxMin(),this.Draw(),!0}return console.warn("[MinuteChartContainer::DeleteOverlaySymbol] overlay symbol="+t+" not exist."),!1},this.ClearOverlaySymbol=function(){for(var t in this.OverlayChartPaint){var n=this.OverlayChartPaint[t];n.IsDelete=!0}this.OverlayChartPaint=[],this.Frame.SubFrame[0].Frame.YSplitOperator.OverlayChartPaint=this.OverlayChartPaint,this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.UpdateFrameMaxMin(),this.Draw()},this.ShowBeforeData=function(t,n){this.ShowCallAuctionData({Left:t},n)},this.ShowCallAuctionData=function(t,n){if(t){var s=!1;if(v.IsBool(t.Left)&&this.IsShowBeforeData!=t.Left&&(this.IsShowBeforeData=t.Left,s=!0),v.IsBool(t.Right)&&this.IsShowAfterData!=t.Right&&(this.IsShowAfterData=t.Right,s=!0),t.MultiDay){var o=t.MultiDay;v.IsBool(o.Left)&&this.IsShowMultiDayBeforeData!=o.Left&&(this.IsShowMultiDayBeforeData=o.Left,s=!0),v.IsBool(o.Right)&&this.IsShowMultiDayAfterData!=o.Right&&(this.IsShowMultiDayAfterData=o.Right,s=!0)}if(n){if(n.BeforeOpen){var o=n.BeforeOpen;v.IsNumber(o.Left)&&this.ExtendWidth.Left!=o.Left&&(this.ExtendWidth.Left=o.Left,s=!0)}if(n.AfterClose){var o=n.AfterClose;v.IsNumber(o.Right)&&this.ExtendWidth.Right!=o.Right&&(this.ExtendWidth.Right=o.Right,s=!0)}if(n.MultiDay){var o=n.MultiDay;v.IsNumber(o.Left)&&this.MultiDayExtendWidth.Left!=o.Left&&(this.MultiDayExtendWidth.Left=o.Left,s=!0),v.IsNumber(o.Right)&&this.MultiDayExtendWidth.Right!=o.Right&&(this.MultiDayExtendWidth.Right=o.Right,s=!0)}}s&&(this.Frame.ClearYCoordinateMaxMin(),this.RequestData())}},this.RequestData=function(){this.DayCount<=1?this.RequestMinuteData():this.RequestHistoryMinuteData()},this.ChangeDrawType=function(t){if(!(this.ChartPaint.length<=0)){if(t==0)this.ChartPaint[0].IsDrawArea=!0;else if(t==1)this.ChartPaint[0].IsDrawArea=!1;else return;this.Draw()}},this.UpdateDataOffset=function(){this.SourceData.DataOffset=this.DayOffset.DataOffset;for(var t=0;t<this.ChartPaint.length;++t){var n=this.ChartPaint[t];n.Data&&(n.Data.DataOffset=this.DayOffset.DataOffset,(n.ClassName=="ChartMinuteVolumBar"||n.ClassName=="ChartMinutePriceLine")&&(n.DayOffset=this.DayOffset))}for(var t=0;t<this.OverlayChartPaint.length;++t){var n=this.OverlayChartPaint[t];n.Data&&(n.Data.DataOffset=this.DayOffset.DataOffset)}for(var t=0;t<this.Frame.SubFrame.length;++t)for(var s=this.Frame.SubFrame[t],o=0;o<s.OverlayIndex.length;++o)for(var l=s.OverlayIndex[o],h=0;h<l.ChartPaint.length;++h){var n=l.ChartPaint[h];n.Data&&(n.Data.DataOffset=this.DayOffset.DataOffset)}},this.RequestHistoryMinuteData=function(){var t=this;if(this.IsBeforeData=!1,this.IsAfterData=!1,this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.Draw(),this.NetworkFilter){var n={Before:this.IsShowMultiDayBeforeData,After:this.IsShowMultiDayAfterData},s={Name:"MinuteChartContainer::RequestHistoryMinuteData",Explain:"多日分时数据",Request:{Url:t.HistoryMinuteApiUrl,Data:{daycount:t.DayCount,symbol:t.Symbol,callcation:n,AryDate:this.AryDate},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(o){t.ChartSplashPaint.EnableSplash(!1),t.RecvHistoryMinuteData(o)}),s.PreventDefault==!0)return}Vt.HttpRequest({url:t.HistoryMinuteApiUrl,data:{symbol:t.Symbol,daycount:t.DayCount},type:"post",dataType:"json",async:!0,success:function(l){t.ChartSplashPaint.EnableSplash(!1),t.RecvHistoryMinuteData(l)}})},this.RecvHistoryMinuteData=function(t){if(this.EnableVerifyRecvData&&t.symbol!=this.Symbol){k.Chart.Warn("[MinuteChartContainer::RecvHistoryMinuteData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+t.symbol+"]");return}this.DayData=ce.JsonDataToMinuteDataArray(t),this.ColorLineData=ce.JsonDataToHistoryMinuteLineColorData(t),this.MultiDayBeforeOpenData=ce.JosnDataToBeforeOpenDataArray(t),this.MultiDayAfterCloseData=ce.JosnDataToAfterCloseDataArray(t);var n=ce.JsonDataToHistoryMinuteLastUpdateTime(t);this.DataStatus.MultiDay=!0,this.CaclutateCallCationYRange(),this.Symbol=t.symbol,this.Name=t.name,this.SetCallCationDataBorder({Left:!1,Right:!1,MultiDay:{Left:this.IsShowMultiDayBeforeData,Right:this.IsShowMultiDayAfterData}}),this.CaclutateLimitPrice(this.DayData[0].YClose,t.data[0].limitprice),this.UpdateHistoryMinuteUI(n),this.RecvMinuteDataEvent({FunctionName:"RecvHistoryMinuteData"}),this.RequestOverlayHistoryMinuteData(),this.BindAllOverlayIndexData(this.SourceData),this.AutoUpdateEvent(!0,"MinuteChartContainer::RequestHistoryMinuteData"),this.AutoUpdate()},this.CaclutateCallCationYRange=function(){var t=null,n=null;if(v.IsNonEmptyArray(this.MultiDayAfterCloseData)){for(var s={Max:null,Min:null},o=0;o<this.MultiDayAfterCloseData.length;++o){var l=this.MultiDayAfterCloseData[o];(s.Max==null||s.Max<l.VolMax)&&(s.Max=l.VolMax),(s.Min==null||s.Min>l.VolMin)&&(s.Min=l.VolMin)}t=s}if(v.IsNonEmptyArray(this.MultiDayBeforeOpenData)){for(var s={Max:null,Min:null},o=0;o<this.MultiDayBeforeOpenData.length;++o){var l=this.MultiDayBeforeOpenData[o];(s.Max==null||s.Max<l.VolMax)&&(s.Max=l.VolMax),(s.Min==null||s.Min>l.VolMin)&&(s.Min=l.VolMin)}n=s}if(this.ShareAfterVol==2&&t&&n){var h=Math.max(t.Max,n.Max),u=Math.min(t.Min,n.Min);t.Max=n.Max=h,t.Min=n.Min=u}if(t)for(var o=0;o<this.MultiDayAfterCloseData.length;++o){var l=this.MultiDayAfterCloseData[o];l.VolMax=t.Max,l.VolMin=t.Min}if(n)for(var o=0;o<this.MultiDayBeforeOpenData.length;++o){var l=this.MultiDayBeforeOpenData[o];l.VolMax=n.Max,l.VolMin=n.Min}},this.UpdateHistoryMinuteUI=function(t){var n=this.HistoryMinuteDataToArray(this.DayData),s=new Y;if(s.Data=n,t&&(s.UpdateTime=t),this.SourceData=s,this.TradeDate=this.DayData[0].Date,this.PageInfo&&this.PageInfo.Enable){this.DayOffset.DayCount=this.DayData.length,this.DayOffset.ShowDayCount==-1&&(this.DayOffset.ShowDayCount=this.DayData.length),this.DayOffset.Offset==-8888&&(this.DayOffset.Offset=this.DayOffset.DayCount-this.DayOffset.ShowDayCount);var o=this.DayOffset.ShowDayCount;this.Frame.SetDayCount(o)}else{this.DayOffset.Offset=0,this.DayOffset.ShowDayCount=this.DayData.length;var o=this.DayOffset.ShowDayCount;this.Frame.SetDayCount(this.DayData.length)}var l=this.Symbol.toUpperCase(),h=U.IsFutures(l),u=this.DayData[0];this.BaselineType===1&&(u=this.DayData[this.DayData.length-1]);var f=u.YClose;v.IsNumber(u.YClearing)&&h&&(f=u.YClearing),this.BindMainData(s,f),U.IsForeignExchange(l)&&(this.ChartPaint[1].Data=null);for(var C=0;C<this.Frame.SubFrame.length;++C){var D=this.Frame.SubFrame[C];D.Frame.XSplitOperator.Symbol=this.Symbol,D.Frame.XSplitOperator.DayCount=o,D.Frame.XSplitOperator.DayData=this.DayData,D.Frame.XSplitOperator.Operator(),D.Frame.XSplitOperator.IsBeforeData=this.IsBeforeData,D.Frame.XSplitOperator.IsAfterData=this.IsAfterData,D.Frame.YSplitOperator.Symbol=this.Symbol,D.Frame.YSplitOperator.IsBeforeData=this.IsBeforeData,D.Frame.YSplitOperator.IsAfterData=this.IsAfterData;for(var c in D.OverlayIndex){var T=D.OverlayIndex[c];T.Frame.XPointCount=D.Frame.XPointCount,T.Frame.MinuteCount=D.Frame.MinuteCount}}if(this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.IsBeforeData=this.IsBeforeData,this.ChartCorssCursor.StringFormatX.IsAfterData=this.IsAfterData,this.TitlePaint[0].IsShowDate=!0,this.UpdateDataOffset(),this.UpdateFrameMaxMin(),this.CreateChartDrawPictureByStorage(),this.Frame.SubFrame.length>2){var S=new Y;S.Data=n;for(var I=2;I<this.Frame.SubFrame.length;++I)this.BindIndexData(I,S)}this.Frame.SetSizeChage(!0),this.Draw()},this.HistoryMinuteDataToArray=function(t){for(var n=[],s=t.length-1;s>=0;--s)for(var o=t[s],l=0;l<o.Data.length;++l)n.push(o.Data[l]);return n},this.UpdateLatestMinuteData=function(t,n,s){if(this.DayData){for(var o=0;o<this.DayData.length;++o){var l=this.DayData[o];if(l.Date===n){l.Data=t,s&&v.IsNumber(s.yclose)&&(l.YClose=s.yclose),s&&v.IsNumber(s.yclearing)&&(l.YClearing=s.yclearing);return}}if(this.DayData.length>0&&this.DayData[0].Date<n){var h=new Y;h.Date=n,h.Data=t,s&&v.IsNumber(s.yclose)&&(h.YClose=s.yclose),s&&v.IsNumber(s.yclearing)&&(h.YClearing=s.yclearing),this.DayData.unshift(h)}}},this.UpdateLatestMinuteDataV2=function(t){if(this.DayCount>1){if(!this.DayData)return;for(var n=null,s=0;s<this.DayData.length;++s){var o=this.DayData[s];if(o.Date===date){n=o;break}}if(!n)return;for(var l=-1,h=t.Data[0],s=0;s<n.Data.length;++s){var o=n.Data[s];if(o.Date==h.Date&&o.Time==h.Time){l=s;break}}l<0&&(l=n.Data.length);for(var s=0,u=l;s<t.Data.length;++s,++u){var o=t.Data[s];n.Data[u]=o}}else{if(!this.SourceData)return;for(var l=-1,h=t.Data[0],s=0;s<this.SourceData.Data.length;++s){var o=this.SourceData.Data[s];if(o.Date==h.Date&&o.Time==h.Time){l=s;break}}l<0&&(l=this.SourceData.Data.length);for(var s=0,u=l;s<t.Data.length;++s,++u){var o=t.Data[s];this.SourceData.Data[u]=o}}},this.RequestMinuteData=function(){var t=this,n=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","minute","minutecount"],s=this.Symbol.toUpperCase();if(U.IsFutures(s)&&(n.push("clearing"),n.push("yclearing")),this.IsBeforeData=!1,this.IsShowBeforeData&&this.DayCount===1&&U.IsSHSZStockA(t.Symbol)&&(this.IsBeforeData=!0,n.push("before")),this.IsAfterData=!1,this.IsShowAfterData&&this.DayCount===1&&U.IsSHSZStockA(t.Symbol)&&(this.IsAfterData=!0),this.NetworkFilter){var o=null;if(this.DayCount>1){if(v.IsNonEmptyArray(this.DayData)){var l=this.DayData[0];o=l.GetDateRange()}}else this.SourceData&&(o=this.SourceData.GetDateRange());var h={Before:this.IsShowBeforeData,After:this.IsShowAfterData};this.DayCount>1&&(h={Before:this.IsShowMultiDayBeforeData,After:this.IsShowMultiDayAfterData});var u={Name:"MinuteChartContainer::RequestMinuteData",Explain:"最新分时数据",Request:{Url:t.MinuteApiUrl,Data:{field:n,symbol:[t.Symbol],callcation:h,AryDate:this.AryDate},Type:"POST"},Self:this,PreventDefault:!1};if(o&&(u.DateRange=o),this.NetworkFilter(u,function(f){t.ChartSplashPaint.EnableSplash(!1),t.RecvMinuteData(f)}),u.PreventDefault==!0)return}Vt.HttpRequest({url:t.MinuteApiUrl,data:{field:n,symbol:[t.Symbol],start:-1},type:"post",dataType:"json",async:!0,success:function(C){t.ChartSplashPaint.EnableSplash(!1),t.RecvMinuteData(C)}})},this.RecvMinuteDataEvent=function(t){if(this.mapEvent.has($.RECV_MINUTE_DATA)){var n=this.mapEvent.get($.RECV_MINUTE_DATA),s={MinuteData:this.SourceData,Stock:{Symbol:this.Symbol,Name:this.Name},Option:t,DataStatus:this.DataStatus};n.Callback(n,s,this)}},this.UpdateLineColorData=function(t,n){if(!this.ColorLineData){this.ColorLineData=t;return}var s=this.ColorLineData.filter(function(l,h,u){return l.Date!=n});if(v.IsNonEmptyArray(t))for(var o in t)s.push(t[o]);this.ColorLineData=s},this.UpdateCallCationData=function(t,n){if(t&&v.IsNonEmptyArray(this.MultiDayBeforeOpenData)){var s=this.MultiDayBeforeOpenData[this.MultiDayBeforeOpenData.length-1];s.Date==t.Date?this.MultiDayBeforeOpenData[this.MultiDayBeforeOpenData.length-1]=t:s.Date<t.Date&&this.MultiDayBeforeOpenData.push(t)}if(n&&v.IsNonEmptyArray(this.MultiDayAfterCloseData)){var s=this.MultiDayAfterCloseData[this.MultiDayAfterCloseData.length-1];s.Date==n.Date?this.MultiDayAfterCloseData[this.MultiDayAfterCloseData.length-1]=n:s.Date<n.Date&&this.MultiDayAfterCloseData.push(n)}this.CaclutateCallCationYRange()},this.RecvUpdateMinuteData=function(t){var n=ce.JsonDataToUpdateMinuteData(t),s=ce.JsonDataToMinuteLineColorData(t);this.BeforeOpenData=null,this.AfterCloseData=null;var o=ce.JsonDataToBeforeOpenData(t),l=ce.JsonDataToAfterCloseData(t),h=ce.JsonDataToMinuteLastUpdateTime(t);if(this.DayCount>1){this.UpdateCallCationData(o,l),this.UpdateLineColorData(s,n.date),this.UpdateLatestMinuteDataV2(n),this.UpdateHistoryMinuteUI(h),this.RecvMinuteDataEvent({FunctionName:"RecvUpdateMinuteData"}),this.RequestOverlayMinuteData(),this.BindAllOverlayIndexData(this.SourceData),this.AutoUpdateEvent(!0,"MinuteChartContainer::RecvUpdateMinuteData"),this.AutoUpdate();return}this.UpdateLatestMinuteDataV2(n);var u=this.SourceData,f=this.SourceData.Data;if(this.ColorLineData=s,this.TradeDate=t.stock[0].date,this.Frame.SetDayCount(1),this.SourceData.UpdateTime=h,this.Symbol=n.Symbol,this.Name=n.Name,this.SetCallCationDataBorder({Left:this.IsBeforeData,Right:this.IsAfterData,MultiDay:{Left:!1,Right:!1}}),this.ShareAfterVol==2&&this.BeforeOpenData&&this.AfterCloseData){var C=Math.max(this.BeforeOpenData.VolMax,this.AfterCloseData.VolMax),D=Math.min(this.BeforeOpenData.VolMin,this.AfterCloseData.VolMin);this.BeforeOpenData.VolMax=this.AfterCloseData.VolMax=C,this.BeforeOpenData.VolMin=this.AfterCloseData.VolMin=D}var c=n.YClose,T=this.Symbol.toUpperCase(),S=U.IsFutures(T);n.YClearing>0&&S&&(c=n.YClearing),this.CaclutateLimitPrice(c,n.LimitPrice);var I=null;if(n.High>0&&n.Low>0&&(I={High:n.High,Low:n.Low}),this.BindMainData(u,c,I),this.Frame.SubFrame.length>2){var g=new Y;g.Data=f;for(var E=2;E<this.Frame.SubFrame.length;++E)this.BindIndexData(E,g)}for(var F=0;F<this.Frame.SubFrame.length;++F){var R=this.Frame.SubFrame[F];if(R.Frame.XSplitOperator.Symbol=this.Symbol,R.Frame.XSplitOperator.DayCount=1,R.Frame.XSplitOperator.Operator(),R.Frame.YSplitOperator.Symbol=this.Symbol,v.IsNonEmptyArray(R.OverlayIndex))for(var A=0;A<R.OverlayIndex.length;++A){var P=R.OverlayIndex[A];P.Frame.XPointCount=R.Frame.XPointCount,P.Frame.MinuteCount=R.Frame.MinuteCount}}this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.Symbol=this.Symbol,U.IsSHSZ(T)&&(this.TitlePaint[0].IsShowDate=!1),t.stock[0].IsHistoryMinute==!0&&(this.TitlePaint[0].IsShowDate=!0);var p=this.GetChartMinuteInfo();p&&(p.SourceData=this.SourceData),this.RecvMinuteDataEvent({FunctionName:"RecvUpdateMinuteData"}),this.RequestMinuteInfoData(),this.RequestOverlayMinuteData(),this.CreateChartDrawPictureByStorage(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.BindAllOverlayIndexData(this.SourceData),this.AutoUpdateEvent(!0,"MinuteChartContainer::RecvUpdateMinuteData"),this.AutoUpdate()},this.RecvMinuteData=function(t){if(!t){k.Chart.Warn("[MinuteChartContainer::RecvMinuteData] recv data is null");return}if(t.dataType==1){this.RecvUpdateMinuteData(t);return}if(t.stock[0]){if(t.stock[0].symbol!=this.Symbol&&this.EnableVerifyRecvData){k.Chart.Warn("[MinuteChartContainer::RecvMinuteData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+t.stock[0].symbol+"]");return}var n=ce.JsonDataToMinuteData(t),s=ce.JsonDataToMinuteLineColorData(t);this.BeforeOpenData=null,this.AfterCloseData=null;var o=ce.JsonDataToBeforeOpenData(t),l=ce.JsonDataToAfterCloseData(t),h=ce.JsonDataToMinuteLastUpdateTime(t);this.IsBeforeData&&(this.BeforeOpenData=o),this.IsAfterData&&(this.AfterCloseData=l);var u=this.DataStatus.LatestDay==!1;if(this.DataStatus.LatestDate=t.stock[0].date,this.DataStatus.LatestDay=!0,this.DayCount>1){this.UpdateCallCationData(o,l),this.UpdateLineColorData(s,t.stock[0].date),this.UpdateLatestMinuteData(n,t.stock[0].date,t.stock[0]),this.UpdateHistoryMinuteUI(h),this.RecvMinuteDataEvent({FunctionName:"RecvMinuteData"}),this.RequestOverlayMinuteData(),this.BindAllOverlayIndexData(this.SourceData),this.AutoUpdateEvent(!0,"MinuteChartContainer::RecvMinuteData"),this.AutoUpdate();return}if(this.IsOnTouch==!0&&this.SourceData&&v.IsNonEmptyArray(this.SourceData.Data)){this.AutoUpdate();return}var f=new Y;if(f.Data=n,f.UpdateTime=h,this.ColorLineData=s,this.TradeDate=t.stock[0].date,this.Frame.SetDayCount(1),this.SourceData=f,this.Symbol=t.stock[0].symbol,this.Name=t.stock[0].name,this.SetCallCationDataBorder({Left:this.IsBeforeData,Right:this.IsAfterData,MultiDay:{Left:!1,Right:!1}}),this.ShareAfterVol==2&&this.BeforeOpenData&&this.AfterCloseData){var C=Math.max(this.BeforeOpenData.VolMax,this.AfterCloseData.VolMax),D=Math.min(this.BeforeOpenData.VolMin,this.AfterCloseData.VolMin);this.BeforeOpenData.VolMax=this.AfterCloseData.VolMax=C,this.BeforeOpenData.VolMin=this.AfterCloseData.VolMin=D}var c=t.stock[0].yclose,T=this.Symbol.toUpperCase(),S=U.IsFutures(T);t.stock[0].yclearing>0&&S&&(c=t.stock[0].yclearing),this.CaclutateLimitPrice(c,t.stock[0].limitprice);var I=null;if(t.stock[0].high>0&&t.stock[0].low>0&&(I={High:t.stock[0].high,Low:t.stock[0].low}),this.BindMainData(f,c,I),this.Frame.SubFrame.length>2){var g=new Y;g.Data=n;for(var E=2;E<this.Frame.SubFrame.length;++E)this.BindIndexData(E,g)}for(var F in this.Frame.SubFrame){var R=this.Frame.SubFrame[F];R.Frame.XSplitOperator.Symbol=this.Symbol,R.Frame.XSplitOperator.DayCount=1,R.Frame.XSplitOperator.Operator(),R.Frame.YSplitOperator.Symbol=this.Symbol;for(var A in R.OverlayIndex){var P=R.OverlayIndex[A];P.Frame.XPointCount=R.Frame.XPointCount,P.Frame.MinuteCount=R.Frame.MinuteCount}}this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.Symbol=this.Symbol,U.IsSHSZ(T)&&(this.TitlePaint[0].IsShowDate=!1),t.stock[0].IsHistoryMinute==!0&&(this.TitlePaint[0].IsShowDate=!0);var p=this.GetChartMinuteInfo();p&&(p.SourceData=this.SourceData),this.RecvMinuteDataEvent({FunctionName:"RecvMinuteData",Day:{IsFirstData:u}}),this.RequestMinuteInfoData(),this.RequestOverlayMinuteData(),this.CreateChartDrawPictureByStorage(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.BindAllOverlayIndexData(this.SourceData),t.AutoUpdate===!1||(this.AutoUpdateEvent(!0,"MinuteChartContainer::RecvMinuteData"),this.AutoUpdate())}},this.CaclutateLimitPrice=function(t,n){if(this.LimitPrice=null,n&&n.max>0&&n.min>0){this.LimitPrice={Max:n.max,Min:n.min};return}var s=U.GetLimitPriceRange(this.Symbol,this.Name);if(!s){k.Chart.Log("[MinuteChartContainer::CaclutateLimitPrice] "+this.Symbol+" no limit price.");return}t<=0||(this.LimitPrice={Max:t*(1+s.Max),Min:t*(1+s.Min)},k.Chart.Log("[MinuteChartContainer::CaclutateLimitPrice] "+this.Symbol+" yClose:"+t+" max:"+this.LimitPrice.Max+" min:"+this.LimitPrice.Min),this.LimitPrice.Max=parseFloat(this.LimitPrice.Max.toFixed(2)),this.LimitPrice.Min=parseFloat(this.LimitPrice.Min.toFixed(2)),k.Chart.Log("[MinuteChartContainer::CaclutateLimitPrice] "+this.Symbol+" tofixed(2) max:"+this.LimitPrice.Max+" min:"+this.LimitPrice.Min))},this.RequestSingleOverlayMinuteData=function(t,n,s){var o=this;if(s.Status=Le.STATUS_REQUESTDATA_ID,this.NetworkFilter){var l={Name:"MinuteChartContainer::RequestOverlayMinuteData",Explain:"叠加股票最新分时数据",Request:{Url:this.HistoryMinuteApiUrl,Data:{days:[n],symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(l,function(h){s.Status=Le.STATUS_RECVDATA_ID,o.RecvOverlayMinuteData(h,s)}),l.PreventDefault==!0)return}Vt.HttpRequest({url:this.HistoryMinuteApiUrl,data:{symbol:t,days:[n]},type:"post",dataType:"json",async:!0,success:function(u){s.Status=Le.STATUS_RECVDATA_ID,o.RecvOverlayMinuteData(u,s)}})},this.RequestOverlayMinuteData=function(){for(var t=this.TradeDate,n=0;n<this.OverlayChartPaint.length;++n){var s=this.OverlayChartPaint[n];if(s.MainData&&s.Status==Le.STATUS_NONE_ID){var o=s.Symbol;o&&this.RequestSingleOverlayMinuteData(o,t,s)}}},this.RecvMultiOverlayMinuteData=function(t){if(v.IsNonEmptyArray(t)){for(var n=!1,s=0;s<t.length;++s){var o=t[s];if(o.symbol)for(var l=0;l<this.OverlayChartPaint.length;++l){var h=this.OverlayChartPaint[l];if(h.MainData&&o.symbol==h.Symbol){this.RecvOverlayMinuteData(o,h,{Redraw:!1}),n=!0;break}}}n&&(this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw())}},this.RecvOverlayMinuteData=function(t,n,s){if(!n.IsDelete){if(this.EnableVerifyRecvData&&t.symbol!=n.Symbol){k.Chart.Warn("[MinuteChartContainer::RecvOverlayMinuteData] recv data symbol not match. paint["+n.Symbol+"] , Recv["+t.symbol+"]");return}var o=ce.JsonDataToMinuteDataArray(t),l=null,h;if(this.DayCount>1){if(o.length<=0)return;var u=o[0];for(var f in n.SourceData){var C=n.SourceData[f];if(C.Date==u.Date){n.SourceData[f]=u;var D=this.HistoryMinuteDataToArray(n.SourceData),l=new Y;l.Data=D,h=u.YClose;break}}if(l==null)return}else o.length>0?l=o[0]:l=new Y,h=l.YClose;n.Data=l,n.Title=t.name,n.Symbol=t.symbol,n.YClose=h,n.Status=Le.STATUS_FINISHED_ID;var c=!0;s&&s.Redraw==!1&&(c=!1),c&&(this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw())}},this.RequestSingleOverlayHistoryMinuteData=function(t,n,s){var o=this;if(s.Status=Le.STATUS_REQUESTDATA_ID,this.NetworkFilter){var l={Name:"MinuteChartContainer::RequestOverlayHistoryMinuteData",Explain:"叠加股票多日分时数据",Request:{Url:o.HistoryMinuteApiUrl,Data:{days:n,symbol:t},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(l,function(h){s.Status=Le.STATUS_RECVDATA_ID,o.RecvOverlayHistoryMinuteData(h,s)}),l.PreventDefault==!0)return}Vt.HttpRequest({url:o.HistoryMinuteApiUrl,data:{symbol:t,days:n},type:"post",dataType:"json",async:!0,success:function(u){s.Status=Le.STATUS_RECVDATA_ID,o.RecvOverlayHistoryMinuteData(u,s)}})},this.RequestOverlayHistoryMinuteData=function(){if(v.IsNonEmptyArray(this.DayData)){for(var t=[],n=0;n<this.DayData.length;++n){var s=this.DayData[n];t.push(s.Date)}if(!(t.length<=0))for(var n=0;n<this.OverlayChartPaint.length;++n){var s=this.OverlayChartPaint[n],o=s.Symbol;o&&s.Status==Le.STATUS_NONE_ID&&this.RequestSingleOverlayHistoryMinuteData(o,t,s)}}},this.RecvOverlayHistoryMinuteData=function(t,n){if(this.EnableVerifyRecvData&&t.symbol!=n.Symbol){k.Chart.Warn("[MinuteChartContainer::RecvOverlayHistoryMinuteData] recv data symbol not match. paint["+n.Symbol+"] , Recv["+t.symbol+"]");return}if(v.IsNonEmptyArray(this.DayData)){var s=ce.JsonDataToMinuteDataArray(t);if(v.IsNonEmptyArray(s)){for(var o=[],l=0;l<this.DayData.length;++l){for(var h=this.DayData[l],u=!1,f=0;f<s.length;++f)if(h.Date==s[f].Date){o.push(s[f]),u=!0;break}if(!u){var C=new Y;C.Date=h.Date,C.Data.length=h.Data.length,o.push(C)}}n.SourceData=o;var D=this.HistoryMinuteDataToArray(o),c=o[0].YClose,T=new Y;T.Data=D,n.Data=T,n.Title=t.name,n.Symbol=t.symbol,n.YClose=c,n.Status=Le.STATUS_FINISHED_ID,this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}}},this.CancelAutoUpdate=function(){typeof this.AutoUpdateTimer=="number"&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=void 0)},this.AutoUpdate=function(){if(this.CancelAutoUpdate(),!!this.IsAutoUpdate&&this.Symbol){var t=this,n=U.GetMarketStatus(this.Symbol);if(n==0||n==3){this.AutoUpdateTimer=setTimeout(function(){t.AutoUpdate()},2e4);return}var s=this.AutoUpdateFrequency;n==1?this.AutoUpdateTimer=setTimeout(function(){t.AutoUpdate()},s):n==2&&(this.AutoUpdateTimer=setTimeout(function(){t.ResetOverlaySymbolStatus(),t.RequestMinuteData()},s))}},this.BindIndexData=function(t,n,s){if(this.WindowIndex[t]){if(typeof this.WindowIndex[t].RequestData=="function"){this.WindowIndex[t].RequestData(this,t,n);return}if(typeof this.WindowIndex[t].ExecuteScript=="function"){this.WindowIndex[t].ExecuteScript(this,t,n);return}this.WindowIndex[t].BindData(this,t,n)}},this.BindMainData=function(t,n,s){var o=this.IsShowMultiDayBeforeData?this.MultiDayBeforeOpenData:null,l=this.IsShowMultiDayAfterData?this.MultiDayAfterCloseData:null,h=new Y;if(h.Data=t.GetClose(),this.ChartPaint[0].Data=h,this.ChartPaint[0].YClose=n,this.ChartPaint[0].NotSupportMessage=null,this.ChartPaint[0].IsShowLead=!1,this.ChartPaint[0].LeadData=null,this.ChartPaint[0].BeforeOpenData=this.BeforeOpenData,this.ChartPaint[0].AfterCloseData=this.AfterCloseData,this.ChartPaint[0].MultiDayBeforeOpenData=o,this.ChartPaint[0].MultiDayAfterCloseData=l,this.ChartPaint[0].ColorLineData=this.ColorLineData,this.ChartPaint[0].Source=t,U.IsSHSZIndex(this.Symbol)&&this.DayCount==1&&this.IsShowLead){var u=new Y;u.Data=t.GetLead(),this.ChartPaint[0].LeadData=u,this.ChartPaint[0].IsShowLead=!0}var f=this.Frame.SubFrame[0].Frame;f.YSplitOperator.YClose=n,f.YSplitOperator.Data=h,this.Frame.Data=this.ChartPaint[0].Data,this.Frame.SourceData=t;for(var C in this.Frame.SubFrame){var D=this.Frame.SubFrame[C].Frame;D.Data=t}h=new Y,h.Data=t.GetMinuteAvPrice(),this.ChartPaint[1].Data=h;var c=this.Symbol.toUpperCase();U.IsForeignExchange(c)?this.ChartPaint[1].Data=null:U.IsShowAvPrice&&!U.IsShowAvPrice(c)&&(this.ChartPaint[1].Data=null),f.YSplitOperator.AverageData=h,f.YSplitOperator.OverlayChartPaint=this.OverlayChartPaint,f.YSplitOperator.LimitPrice=this.LimitPrice,f.YSplitOperator.MultiDayBeforeOpenData=o,f.YSplitOperator.MultiDayAfterCloseData=l,f.YSplitOperator.DayCount=this.DayCount,s?(f.YSplitOperator.High=s.High,f.YSplitOperator.Low=s.Low):(f.YSplitOperator.High=null,f.YSplitOperator.Low=null),this.ChartPaint[2].Data=t,this.ChartPaint[2].YClose=n,this.ChartPaint[2].Symbol=this.Symbol,this.ChartPaint[2].BeforeOpenData=this.BeforeOpenData,this.ChartPaint[2].AfterCloseData=this.AfterCloseData,this.ChartPaint[2].MultiDayBeforeOpenData=o,this.ChartPaint[2].MultiDayAfterCloseData=l;for(var C in this.Frame.SubFrame){var D=this.Frame.SubFrame[C];D.Frame.YSplitOperator.BeforeOpenData=this.BeforeOpenData,D.Frame.YSplitOperator.IsBeforeData=this.IsBeforeData,D.Frame.YSplitOperator.AfterCloseData=this.AfterCloseData,D.Frame.YSplitOperator.IsAfterData=this.IsAfterData,D.Frame.YSplitOperator.MultiDayBeforeOpenData=o,D.Frame.YSplitOperator.MultiDayAfterCloseData=l}U.IsShowMinutePostionLine(c)?this.BindOverlayPositionData(t,n):this.ClearBindOverlayPositionData(),this.TitlePaint[0].Data=this.SourceData,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=this.Name,this.TitlePaint[0].YClose=n,this.TitlePaint[0].BeforeOpenData=this.BeforeOpenData,this.TitlePaint[0].AfterCloseData=this.AfterCloseData,this.TitlePaint[0].MultiDayBeforeOpenData=this.IsShowMultiDayBeforeData?this.MultiDayBeforeOpenData:null,this.TitlePaint[0].MultiDayAfterCloseData=this.IsShowMultiDayAfterData?this.MultiDayAfterCloseData:null,this.TitlePaint[0].CallAcutionXOperator&&(this.TitlePaint[0].CallAcutionXOperator.BeforeOpenData=this.BeforeOpenData,this.TitlePaint[0].CallAcutionXOperator.AfterCloseData=this.AfterCloseData,this.TitlePaint[0].CallAcutionXOperator.MultiDayBeforeOpenData=o,this.TitlePaint[0].CallAcutionXOperator.MultiDayAfterCloseData=l,this.TitlePaint[0].CallAcutionXOperator.DayOffset=this.DayOffset),this.ChartCorssCursor&&this.ChartCorssCursor.StringFormatY&&(this.ChartCorssCursor.StringFormatY.YClose=n,this.ChartCorssCursor.StringFormatY.BeforeOpenData=this.BeforeOpenData,this.ChartCorssCursor.StringFormatY.AfterCloseData=this.AfterCloseData,this.ChartCorssCursor.StringFormatY.MultiDayBeforeOpenData=o,this.ChartCorssCursor.StringFormatY.MultiDayAfterCloseData=l,this.ChartCorssCursor.StringFormatY.DayOffset=this.DayOffset,this.ChartCorssCursor.StringFormatX.Data=this.ChartPaint[0].Data,this.ChartCorssCursor.StringFormatX.BeforeOpenData=this.BeforeOpenData,this.ChartCorssCursor.StringFormatX.AfterCloseData=this.AfterCloseData,this.ChartCorssCursor.StringFormatX.MultiDayBeforeOpenData=o,this.ChartCorssCursor.StringFormatX.MultiDayAfterCloseData=l,this.ChartCorssCursor.StringFormatX.DayOffset=this.DayOffset,this.ChartCorssCursor.CallAcutionXOperator&&(this.ChartCorssCursor.CallAcutionXOperator.BeforeOpenData=this.BeforeOpenData,this.ChartCorssCursor.CallAcutionXOperator.AfterCloseData=this.AfterCloseData,this.ChartCorssCursor.CallAcutionXOperator.MultiDayBeforeOpenData=o,this.ChartCorssCursor.CallAcutionXOperator.MultiDayAfterCloseData=l,this.ChartCorssCursor.CallAcutionXOperator.DayOffset=this.DayOffset)),this.ExtendChartPaint[0]&&(this.ExtendChartPaint[0].Symbol=this.Symbol,this.ExtendChartPaint[0].Name=this.Name);for(var C=0;C<this.OverlayChartPaint.length;++C){var D=this.OverlayChartPaint[C];D.MainData=t}},this.BindOverlayPositionData=function(t,n){var s=this;if(!(this.Frame.SubFrame.length<2)){for(var o=null,l=null,h=this.Frame.SubFrame[1],u=null,f=0;f<h.OverlayIndex.length;++f){var C=h.OverlayIndex[f];if(C.Identify=="Position_Line_Frame"){u=C;break}}if(u){l=u.Frame;for(var f=0;f<u.ChartPaint.length;++f){var C=u.ChartPaint[f];if(C.Name=="Position-Line"){o=C;break}}o||(o=new cf,o.Canvas=this.Canvas,o.Name="Position-Line",o.ChartBorder=l.ChartBorder,o.ChartFrame=l,o.Identify=u.Identify,o.Color=d.Minute.PositionColor,u.ChartPaint.push(o))}else{u=new ln,u.Identify="Position_Line_Frame",this.ClassName=="MinuteChartContainer"?l=new hh:l=new lh,l.Canvas=this.Canvas,l.MainFrame=h.Frame,l.ChartBorder=h.Frame.ChartBorder,l.GlobalOption=this.GlobalOption,u.Frame=l,l.YSplitOperator=new Za,l.YSplitOperator.LanguageID=this.LanguageID,l.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),l.YSplitOperator.Frame=l,l.YSplitOperator.ChartBorder=l.ChartBorder,l.YSplitOperator.SplitCount=h.Frame.YSplitOperator.SplitCount,l.YSplitOperator.GetEventCallback=function(S){return s.GetEventCallback(S)},l.YSplitOperator.OverlayIdentify=u.Identify,l.YSplitOperator.FloatPrecision=0;var o=new cf;o.Canvas=this.Canvas,o.Name="Position-Line",o.ChartBorder=l.ChartBorder,o.ChartFrame=l,o.Identify=u.Identify,o.Color=d.Minute.PositionColor,u.ChartPaint.push(o),h.OverlayIndex.push(u),h.Frame.RightFrame=l}var D=this.Frame.SubFrame[0].Frame.XPointCount;l.XPointCount=D,h.Frame.IsShowPositionTitle=!0;var c=new Y;c.Data=t.GetPosition(),o.Data=c}},this.ClearBindOverlayPositionData=function(){if(!(this.Frame.SubFrame.length<2)){var t=this.Frame.SubFrame[1];t.Frame.RightFrame=null,t.Frame.IsShowPositionTitle=!1;for(var n in t.OverlayIndex){var s=t.OverlayIndex[n];if(s.Identify=="Position_Line_Frame"){t.OverlayIndex.splice(n,1);break}}}},this.GetOverlayIndexByIdentify=function(t){for(var n=0;n<this.Frame.SubFrame.length;++n){var s=this.Frame.SubFrame[n];if(v.IsNonEmptyArray(s.OverlayIndex))for(var o=0;o<s.OverlayIndex.length;++o){var l=s.OverlayIndex[o];if(l.Identify===t)return{OverlayItem:l,WindowIndex:n}}}return null},this.RecvOverlayIndex=function(t,n){var s=this.GetOverlayIndexByIdentify(t);if(s==null){console.warn("[MinuteChartContainer::RecvOverlayIndex] can't find overlay index. [identify="+t+"]");return}if(s.Script&&typeof s.RecvSubscribeData=="function"){var o=this.SourceData;o&&s.Script.RecvSubscribeData(n,this,s.WindowIndex,o)}},this.UpdateOverlayIndex=function(t){var n=this.GetOverlayIndexByIdentify(t);if(n==null){console.warn("[MinuteChartContainer::UpdateOverlayIndex] can't find overlay index. [identify="+t+"]");return}var s=this.SourceData;s&&this.BindOverlayIndexData(n.OverlayItem,n.WindowIndex,s)},this.AddOverlayIndex=function(t){var n=this.CreateOverlayWindowsIndex(t);if(n){var s=this.SourceData;this.BindOverlayIndexData(n,t.WindowIndex,s),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.CreateOverlayWindowsIndex=function(t){var n=this,s=t.IndexName,o=t.WindowIndex,l=null,h=null,u=null;if(t.API)l=t.API;else if(t.Script)h={Script:t.Script,ID:t.indexName,Name:t.indexName},t.Name&&(h.Name=t.Name);else{var f=new Z;if(h=f.Get(s),!h&&(u=$a.Get(s),!u))return console.warn("[MinuteChartContainer::CreateOverlayIndex] can not find index["+s+"]"),null}var C=this.Frame.SubFrame[o],D=new ln;t.Identify&&(D.Identify=t.Identify);var c=null;if(this.ClassName=="MinuteChartContainer"?c=new hh:c=new lh,c.Canvas=this.Canvas,c.MainFrame=C.Frame,c.ChartBorder=C.Frame.ChartBorder,c.GlobalOption=this.GlobalOption,v.IsBool(t.ShowRightText)&&(c.IsShow=t.ShowRightText),v.IsBool(t.IsShareY)&&(c.IsShareY=t.IsShareY),v.IsBool(t.IsCalculateYMaxMin)&&(c.IsCalculateYMaxMin=t.IsCalculateYMaxMin),v.IsNumber(t.IsShowMainFrame)&&(c.IsShowMainFrame=t.IsShowMainFrame),c.YSplitOperator=new Za,c.YSplitOperator.LanguageID=this.LanguageID,c.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),c.YSplitOperator.Frame=c,c.YSplitOperator.ChartBorder=c.ChartBorder,c.YSplitOperator.SplitCount=C.Frame.YSplitOperator.SplitCount,c.YSplitOperator.GetEventCallback=function(g){return n.GetEventCallback(g)},c.YSplitOperator.HQChart=this,c.YSplitOperator.OverlayIdentify=D.Identify,t.Frame){var T=t.Frame;T.Custom&&(c.YSplitOperator.Custom=T.Custom)}if(D.Frame=c,l){var S=new ga(l.Name,l.Script,l.Args,t,!0);S.OverlayIndex={IsOverlay:!0,Identify:D.Identify,WindowIndex:o,Frame:D},D.Script=S}else if(h){Z.ModifyAttribute(h,t);var I=new cs(h.Name,h.Script,h.Args,h);I.OverlayIndex={IsOverlay:!0,Identify:D.Identify,WindowIndex:o,Frame:D},D.Script=I}else{var I=u.Create();I.OverlayIndex={IsOverlay:!0,Identify:D.Identify,WindowIndex:o,Frame:D},I.Create(this,o),D.Script=I}return C.OverlayIndex.push(D),D},this.DeleteOverlayWindowsIndex=function(t){this.DeleteOverlayIndex(t,null)&&(this.Frame.ResetXYSplit(!0),this.Draw())},this.BindAllOverlayIndexData=function(t,n){if(!(!this.Frame||!this.Frame.SubFrame))for(var s=0;s<this.Frame.SubFrame.length;++s)for(var o=this.Frame.SubFrame[s],l=0;l<o.OverlayIndex.length;++l){var h=o.OverlayIndex[l];this.BindOverlayIndexData(h,s,t,n)}},this.BindOverlayIndexData=function(t,n,s,o){if(t.Script){if(typeof t.Script.RequestData=="function"){t.Script.RequestData(this,n,s);return}if(typeof t.Script.ExecuteScript=="function"){t.Script.ExecuteScript(this,n,s);return}t.Script.BindData(this,n,s)}},this.GetChartPaint=function(t){var n=new Array;for(var s in this.ChartPaint)if(!(s<3)){var o=this.ChartPaint[s];o.ChartFrame==this.Frame.SubFrame[t].Frame&&n.push(o)}return n},this.CreateWindowIndex=function(t){this.WindowIndex[t].Create(this,t)},this.OnTouchFinished=function(){if(this.EnableClickModel===!0){if(this.ClickModel.IsShowCorssCursor==!0&&this.TouchDrawCount>0)return;this.ClickModel.IsShowCorssCursor=!1,this.DrawDynamicInfo();return}if(this.CorssCursorTouchEnd===!0){this.DrawDynamicInfo();return}},this.CreateExtendChart=function(t,n){var s;switch(t){case"MinuteTooltip":return n.Create&&typeof n.Create=="function"?s=n.Create():s=new eD,s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,n.LanguageID=this.LanguageID,s.SetOption(n),this.ExtendChartPaint.push(s),s;case"MinutePCTooltip":return n.Create&&typeof n.Create=="function"?s=n.Create():s=new jd,s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,n.LanguageID=this.LanguageID,s.SetOption(n),this.ExtendChartPaint.push(s),s;case"MinuteBackgroundPaint":return s=new nI,s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,n.LanguageID=this.LanguageID,s.SetOption(n),this.ExtendChartPaint.push(s),s;default:return s=Br.Create(t),s?(s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,s.SetOption(n),this.ExtendChartPaint.push(s),s):null}},this.SetMinuteInfo=function(t,n){this.ChartInfo=[];for(var s in t){var o=vn.Get(t[s]);if(o){var l=o.Create();this.ChartInfo.push(l)}}n==!0&&this.RequestMinuteInfoData()},this.GetChartMinuteInfo=function(){return this.ChartInfoPaint},this.CreateMinuteInfo=function(t){var n=new Xd;return n.Canvas=this.Canvas,n.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,n.ChartFrame=this.Frame.SubFrame[0].Frame,n.HQChartBorder=this.Frame.ChartBorder,n.ChartMinutePrice=this.ChartPaint[0],t&&n.SetOption&&n.SetOption(t),this.ChartInfoPaint=n,n},this.RequestMinuteInfoData=function(){if(!(this.ChartInfo.length<=0)){var t=this.GetChartMinuteInfo();t||(t=this.CreateMinuteInfo(null)),t.SourceData=this.SourceData;for(var n in this.ChartInfo)this.ChartInfo[n].RequestData(this)}},this.UpdataChartInfo=function(){var t=this.GetChartMinuteInfo();if(t){var n=new Dt.default;for(var s in this.ChartInfo){var o=this.ChartInfo[s].Data;for(var l in o){var h=o[l],u=h.Date+" "+h.Time;n.has(u)?n.get(u).Data.push(h):n.set(u,{Data:new Array(h)})}}t.Data=n}},this.RecvWindowIndex=function(t,n){var s=this.WindowIndex[t];if(s&&typeof s.RecvSubscribeData=="function"){var o=this.SourceData;s.RecvSubscribeData(n,this,t,o)}},this.UpdateWindowIndex=function(t){if(!(t<2)){var n=this.SourceData;this.BindIndexData(t,n),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.CreateChartDrawPicture=function(t,n,s){var o=null,l=gt.GetDrawPictureByName(t);if(l&&(o=l.Create(),o.ClassName=="ChartDrawPictureText"&&(o.HQChart=this)),!o&&gt.MapIonFont.has(t)){var h=gt.MapIonFont.get(t);o=new ol,o.FontOption.Family=h.Family,o.Text=h.Text,h.Color&&(o.LineColor=h.Color)}if(!o)return!1;o.Canvas=this.Canvas,o.Status=0,o.Symbol=this.Symbol,o.Period=888888888,o.Option=this.ChartDrawOption,s&&(o.FinishedCallback=s),n&&o.SetOption(n);var u=this;return o.Update=function(){u.DrawDynamicInfo()},o.GetActiveDrawPicture=function(){return u.GetActiveDrawPicture()},this.CurrentChartDrawPicture=o,k.Chart.Log("[MinuteChartContainer::CreateChartDrawPicture] ",t,this.CurrentChartDrawPicture),!0},this.AddChartDrawPicture=function(t){if(!t||t.FrameID<0||t.FrameID>=this.Frame.SubFrame.length)return null;var n=this,s=gt.GetDrawPictureByClassName(t.ClassName);if(!s)return null;var o=s.Create();return o.Canvas=this.Canvas,o.Status=10,o.Frame=this.Frame.SubFrame[t.FrameID].Frame,o.Symbol=this.Symbol,o.Period=888888888,t.Value&&(o.Value=t.Value),t.Guid&&(o.Guid=t.Guid),o.ImportStorageData&&o.ImportStorageData(t),o.SetOption(t),t.EnableUpdateXValue&&o.UpdateXValue(),o.ValueToPoint(),o.GetActiveDrawPicture=function(){return n.GetActiveDrawPicture()},o.ClassName==="ChartDrawPictureText"&&(o.IsInitialized=!0),this.ChartDrawPicture.push(o),t.Draw==!0&&this.DrawDynamicInfo(),o},this.ReloadChartDrawPicture=function(){this.ChartDrawPicture=[],this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.IsSelected=!1),this.SelectChartDrawPicture=null,this.CurrentChartDrawPicture=null,this.MoveOnChartDrawPicture=null,this.ChartDrawStorage&&(this.ChartDrawStorageCache=this.ChartDrawStorage.GetDrawData({Symbol:this.Symbol,Period:888888888}))},this.CreateChartDrawPictureByStorage=function(){var t=this;if(!(!this.ChartDrawStorageCache||this.ChartDrawStorageCache.length<=0)){for(var n=0;n<this.ChartDrawStorageCache.length;++n){var s=this.ChartDrawStorageCache[n];if(!(s.FrameID<0||!this.Frame.SubFrame||this.Frame.SubFrame.length<s.FrameID)){var o=gt.CreateChartDrawPicture(s);o&&(o.Canvas=this.Canvas,o.Status=10,o.Frame=this.Frame.SubFrame[s.FrameID].Frame,o.ImportStorageData&&o.ImportStorageData(s),o.ResetXValue(),o.UpdateXValue(),o.ValueToPoint(),o.GetActiveDrawPicture=function(){return t.GetActiveDrawPicture()},o.ClassName==="ChartDrawPictureText"&&(o.IsInitialized=!0),this.ChartDrawPicture.push(o))}}this.ChartDrawStorageCache=null}},this.SetSizeChange=function(t){this.Frame.SetSizeChage(t);for(var n in this.ExtendChartPaint){var s=this.ExtendChartPaint[n];s.SizeChange=t}},this.SetSizeChage=this.SetSizeChange,this.GetDataIndexByPoint=function(t){var n=this.Frame;if(this.Frame.SubFrame&&this.Frame.SubFrame.length>0&&(n=this.Frame.SubFrame[0].Frame),!!n){var s=n.GetXData(t),o=parseInt(s.toFixed(0));return o}},this.GetDateTimeByPoint=function(t,n){var s=this.PtInClient_V2(t,n);if(s<=0||!this.Frame.SubFrame[0]||!this.Frame.SubFrame[0].Frame)return null;var o=this.Frame.SubFrame[0].Frame,l=this.Frame.SourceData;if(!l||!v.IsNonEmptyArray(l.Data))return null;var h=-1,u={ClientPos:s};if(s==1){var f=o.GetXData(t);h=parseInt(f.toFixed(0)),v.IsNumber(l.DataOffset)&&(h+=l.DataOffset)}else if(s>=100&&s<=199){var C=s-100,f=o.GetXData(t);h=parseInt(f.toFixed(0));var D=h%o.MinuteCount;u.DayIndex=C,u.DataIndex=D}else return null;if(h<0||h>=l.Data.length)return null;u.Index=h;var c=l.Data[h];return c?(u.Date=c.Date,u.Time=c.Time,u):null},this.GetSelectRectData=function(t){if(Math.abs(t.XStart-t.XEnd)<5)return!1;var n=this.PtInClient(t.XStart,t.YStart),s=this.PtInClient(t.XEnd,t.YEnd);t.StartClientPos=n,t.EndClientPos=s;var o=this.SourceData;if(!o||!v.IsNonEmptyArray(o.Data))return!1;var l=this.GetDataIndexByPoint(t.XStart),h=this.GetDataIndexByPoint(t.XEnd);if(Math.abs(l-h)<2)return!1;t.Data=o;var u=o.DataOffset;l+=u,h+=u,l>h?(t.Start=h,t.End=l):(t.Start=l,t.End=h);var f=o.Data.length;return t.End>=f&&(t.End=f-1),!0},this.Super_UpdateFrameMaxMin=this.UpdateFrameMaxMin,this.UpdateFrameMaxMin=function(){if(this.Super_UpdateFrameMaxMin(),this.DayCount==1){var t=this.Frame.SubFrame[1];t.Frame&&(t.Frame.XYSplit=!0)}},this.ExportMainData=function(t,n){var s=t.ExportMinuteData(n);return s},this.DisplayLatest=function(){var t=this.GetEventCallback($.ON_DISPLAY_LATEST);if(t){var n={PreventDefault:!1};if(t.Callback(t,n,this),n.PreventDefault)return}this.CursorIndex=null,this.LastPoint.X=0,this.LastPoint.Y=0,this.GlobalOption.IsDisplayLatest=!0,this.DrawDynamicInfo()},this.TryClickIndexTitle=function(t,n){for(var s=0;s<this.TitlePaint.length;++s){var o=this.TitlePaint[s];if(o.IsClickTitle&&o.IsClickTitle(t,n)){var l={Point:{X:t,Y:n},Title:o.Title,FrameID:o.Frame.Identify};k.Chart.Log("[MinuteChartContainer::TryClickIndexTitle] click title ",l);var h=this.GetEventCallback($.ON_CLICK_INDEXTITLE);return h&&h.Callback&&h.Callback(h,l,this),!0}}return!1},this.ClearSelectedXBorder=function(){if(!(!this.GlobalOption||!this.GlobalOption.SelectedXBorder)){var t=this.GlobalOption.SelectedXBorder;t.Date=null}},this.DrawSelectedXBorder=function(){if(this.DayCount<=1||this.Frame.IsHScreen===!0)return null;if(!(!this.GlobalOption||!this.GlobalOption.SelectedXBorder)){var t=this.GlobalOption.SelectedXBorder;if(v.IsPlusNumber(t.Mode)&&v.IsPlusNumber(t.Date)&&v.IsNonEmptyArray(this.DayData)){var n=null,s=t.DayIndex,o=this.Frame.ChartBorder.GetBorder(),l={Left:o.Left,Top:o.Top,Right:o.Right,Bottom:o.Bottom};l.Width=l.Right-l.Left;var h=this.Frame.SubFrame[0].Frame,u=h.XPointCount,f=h.MinuteCount,C=u/f,D=l.Width/C;if(o.DayBorder){for(var s=-1,c=0;c<this.DayData.length;++c){var T=this.DayData[c];if(T.Date==t.Date){s=this.DayData.length-1-c;break}}if(s<0)return;var t=o.DayBorder[s];if(!t)return;n={Left:t.LeftEx,Right:t.RightEx,Top:o.Bottom,Bottom:o.ChartHeight},n.Width=n.Right-n.Left,n.Height=n.Bottom-n.Top}else{for(var s=-1,c=0;c<this.DayData.length;++c){var T=this.DayData[c];if(T.Date==t.Date){s=this.DayData.length-1-c;break}}if(s<0)return;n={Left:o.Left+s*D,Width:D,Top:o.Bottom,Bottom:o.ChartHeight},n.Right=n.Left+n.Width,n.Height=n.Bottom-n.Top}h.Canvas.strokeStyle=d.SelFrameBorderColor,h.Canvas.strokeRect(L(n.Left),L(n.Top),b(n.Width),b(n.Height)-1)}}},this.PtInMulitDayMinute=function(t,n){if(this.DayCount<=1||this.Frame.IsHScreen===!0||!v.IsNonEmptyArray(this.DayData))return null;var s=this.Frame.ChartBorder.GetBorder(),o={Left:s.Left,Top:s.Top,Right:s.Right,Bottom:s.Bottom};if(o.Width=o.Right-o.Left,!(t>o.Left&&t<o.Right&&n>o.Top&&n<o.Bottom))return null;if(s.DayBorder)for(var l=0;l<s.DayBorder.length;++l){var h=s.DayBorder[l],u={Left:h.LeftEx,Right:h.RightEx};if(t>=u.Left&&t<=u.Right){var f=this.DayData[this.DayData.length-1-l];return f?f.Date:null}}else for(var C=this.Frame.SubFrame[0].Frame,D=C.XPointCount,c=C.MinuteCount,T=D/c,S=o.Width/T,u={Left:o.Left,Right:S+o.Left},l=0;l<T;++l){if(t>=u.Left&&t<=u.Right){var f=this.DayData[this.DayData.length-1-l];return f?f.Date:null}u.Left+=S,u.Right+=S}return null},this.DrawTooltipDialog=function(){this.DialogTooltip&&this.UpdateTooltipDialog()},this.UpdateTooltipDialog=function(){if(!this.DialogTooltip||!this.ChartCorssCursor)return!1;var t=null,n=0;if(this.ChartCorssCursor.ClientPos>=0){var s=this.TitlePaint[0];if(s&&s.PointInfo){var o=s.PointInfo;if(o.ClientPos==2||o.ClientPos==3||o.ClientPos>=200&&o.ClientPos<=299||o.ClientPos>=300&&o.ClientPos<=399){var l=s.GetCurrentAuctionData();if(!l)return!1;t={Type:1,Data:l}}else{var h=s.GetCurrentKLineData();if(!h)return!1;t={Type:0,Data:h}}}}else{if(!this.SourceData||!v.IsNonEmptyArray(this.SourceData.Data))return!1;var h=this.SourceData.Data[this.SourceData.Data.length-1],u={Symbol:this.Symbol,Date:h.Date,Time:h.Time};if(!this.DialogTooltip.IsEqualDataID(u))return!1;t={Type:0,Data:h},n=2}var f={DataType:n,ClientPos:this.ChartCorssCursor.ClientPos,IsShowCorss:this.ChartCorssCursor.IsShowCorss,MinItem:t,Symbol:this.Symbol,Name:this.Name,LastValue:this.ChartCorssCursor.LastValue};return this.DialogTooltip.Update(f),!0},this.DrawSelectRectDialog=function(t){this.DialogSelectRect&&this.UpdateSelectRectDialog(t)},this.UpdateSelectRectDialog=function(t){if(!this.DialogSelectRect)return!1;var n=t.data,s,o;if(n&&v.IsNumber(n.X)&&v.IsNumber(n.Y)){var l=this.UIElement.getBoundingClientRect(),h=Da();s=n.X,o=n.Y,s+=l.left+h.Left,o+=l.top+h.Top}var u={Symbol:this.Symbol,Name:this.Name,SelectData:n.SelectData,X:s,Y:o,e:t};this.DialogSelectRect.Update(u)}}ce.JsonDataToBeforeOpenData=function(e){var a=e.stock[0].symbol,r=a.toUpperCase();U.IsSHSZ(r);var t=U.GetVolUnit(r),n=e.stock[0].yclose,s=e.stock[0].yclose,o=e.stock[0],l=o.date,h={Data:[],TotalCount:15,Ver:1,Date:l},u=qe.MINUTE_BEFOREOPEN_EXTENDDATA;if(o.beforeinfo&&(v.IsNumber(o.beforeinfo.totalcount)&&(h.TotalCount=o.beforeinfo.totalcount),v.IsNumber(o.beforeinfo.ver)&&(h.Ver=o.beforeinfo.ver)),h.Ver==1){if(v.IsNonEmptyArray(o.before))for(var f=0;f<o.before.length;++f){var C=new Lr,D=o.before[f];C.YClose=n,C.Time=D[0],C.Date=l,C.Price=D[1],C.Price?s=C.Price:C.Price=s,C.Vol[0]=D[2],C.Amount=D[3],v.IsNumber(D[4])&&D[4]>19000101&&(C.Date=D[4]),C.DateTime=C.Date+" "+C.Time,h.Data.push(C)}}else if(h.Ver==2){var c=0;for(var f in o.before){var C=new Lr,D=o.before[f];C.YClose=n,C.Time=D[0],C.Date=l,C.Price=D[1],C.Vol[0]=D[2],C.Vol[1]=D[3],C.ColorID=D[4],v.IsNumber(D[6])&&(C.Date=D[6]),C.DateTime=C.Date+" "+C.Time+")";var T=C.Vol[0]+C.Vol[1];v.IsNumber(D[5])&&(T=D[5]),T>c&&(c=T),D[u]&&(C.ExtendData=D[u]),h.Data.push(C)}h.VolMax=c/t,h.VolMin=0}else if(h.Ver==3){var c=0;for(var f in o.before){var C=new Lr,D=o.before[f];C.YClose=n,C.Time=D[0],C.Date=l,C.Price=D[1],C.AvPrice=D[2],C.Vol[0]=D[3],C.ColorID=D[4],C.DateTime=l.toString()+" "+C.Time.toString();var T=C.Vol[0];v.IsNumber(D[5])&&(T=D[5]),T>c&&(c=T),D[u]&&(C.ExtendData=D[u]),h.Data.push(C)}h.VolMax=c/t,h.VolMin=0}return h};ce.JsonDataToAfterCloseData=function(e){var a=e.stock[0].yclose;e.stock[0].yclose;var r=e.stock[0],t=r.date;if(!r.afterinfo)return null;var n=e.stock[0].symbol,s=n.toUpperCase(),o={Data:[],TotalCount:3*60,Ver:2,Date:t},l=r.afterinfo;v.IsNumber(l.totalcount)&&(o.TotalCount=l.totalcount),v.IsNumber(l.ver)&&(o.Ver=l.ver);var h=qe.MINUTE_AFTERCLOSE_EXTENDDATA,u=U.GetVolUnit(s);if(o.Ver==1)for(var f=0;f<r.after.length;++f){var l=new Rr,C=r.after[f];l.YClose=a,l.Time=C[0],l.Date=t,l.Price=C[1],l.Vol[0]=C[2],l.Amount=C[3],v.IsNumber(C[4])&&(l.Date=C[4]),l.DateTime=l.Date+" "+l.Time,o.Data.push(l)}else if(o.Ver==2){var D=0;for(var f in r.after){var l=new Rr,C=r.after[f];l.YClose=a,l.Time=C[0],l.Date=t,l.Price=C[1],l.Vol[0]=C[2],l.Vol[1]=C[3],l.ColorID=C[4],l.DateTime=t.toString()+" "+l.Time.toString();var c=l.Vol[0]+l.Vol[1];v.IsNumber(C[5])&&(c=C[5]),c>D&&(D=c),C[h]&&(l.ExtendData=C[h]),o.Data.push(l)}o.VolMax=D/u,o.VolMin=0}else if(o.Ver==3){var D=0;for(var f in r.after){var l=new Rr,C=r.after[f];l.YClose=a,l.Time=C[0],l.Date=t,l.Price=C[1],l.AvPrice=C[2],l.Vol[0]=C[3],l.ColorID=C[4],l.DateTime=t.toString()+" "+l.Time.toString();var c=l.Vol[0];v.IsNumber(C[5])&&(c=C[5]),c>D&&(D=c),C[h]&&(l.ExtendData=C[h]),o.Data.push(l)}o.VolMax=D/u,o.VolMin=0}return o};ce.JsonDataToMinuteData=function(e,a){var r=e.stock[0].symbol,t=r.toUpperCase();U.IsSHSZ(t);var n=U.IsFutures(t),s=U.IsSHO(t),o=U.IsSZO(t),l=[],h=e.stock[0].yclose,u=e.stock[0].yclose,f=e.stock[0].yclose,C=e.stock[0].yclearing;if(n&&C&&(h=u=C),!v.IsNonEmptyArray(e.stock[0].minute))return l;for(var D=e.stock[0].date,c=0;c<e.stock[0].minute.length;++c){var T=e.stock[0].minute[c],S=new fs;S.YClearing=C,S.YClose=f,S.Close=T.price,S.Open=T.open,S.High=T.high,S.Low=T.low,S.Vol=T.vol,S.Amount=T.amount,T.date>0&&(D=T.date),S.DateTime=D.toString()+" "+T.time.toString(),S.Date=D,S.Time=T.time,(n||s||o||v.IsNumber(T.position))&&(S.Position=T.position),S.Increase=T.increase,S.Risefall=T.risefall,S.AvPrice=T.avprice,v.IsNumber(T.lead)&&(S.Lead=T.lead),v.IsNumber(S.Close)||(S.Close=h,S.Open=S.High=S.Low=S.Close),S.AvPrice||(S.AvPrice=u),f&&S.Close&&(S.Increase=(S.Close-f)/f*100),n&&C&&S.Close&&(S.Increase=(S.Close-C)/C*100),v.IsNumber(T.price)&&(h=T.price),v.IsNumber(T.avprice)&&S.AvPrice===T.avprice&&(u=T.avprice),T.ExtendData&&(S.ExtendData=T.ExtendData),l[c]=S}return l};ce.JsonDataToUpdateMinuteData=function(e){if(!e||!e.stock)return null;var a=e.stock[0];if(!v.IsNumber(a.date))return null;var r=e.stock[0].symbol,t=r.toUpperCase();U.IsSHSZ(t);var n=U.IsFutures(t),s={Date:a.date,Data:[],Symbol:r,Name:a.name},o=qe.MINUTE_DAY_EXTENDDATA;if(v.IsNumber(a.high)&&(s.High=a.high),v.IsNumber(a.low)&&(s.Low=a.low),v.IsNumber(a.yclose)&&(s.YClose=a.yclose),v.IsNumber(a.YClearing)&&(s.YClearing=a.yclearing),v.IsNonEmptyArray(a.minute))for(var l=0;l<a.minute.length;++l){var h=a.minute[l],u=new fs;u.YClearing=s.YClearing,u.YClose=s.YClose,u.Date=h[0],u.Time=h[1],u.Open=h[2],u.High=h[3],u.Low=h[4],u.Close=h[5],u.AvPrice=h[6],u.Vol=h[7],u.Amount=h[8],v.IsNumber(h[9])&&(u.Increase=h[9]),v.IsNumber(h[10])&&(u.Risefall=h[10]),v.IsNumber(h[11])&&(u.Lead=h[11]),h[o]&&(u.ExtendData=h[o]),u.DateTime=u.Date.toString()+" "+u.Time.toString(),v.IsNumber(s.YClose)&&u.Close&&(u.Increase=(u.Close-s.YClose)/s.YClose*100),n&&s.YClearing&&u.Close&&(u.Increase=(u.Close-s.YClearing)/s.YClearing*100),s.Data.push(u)}return s};ce.JsonDataToMinuteLineColorData=function(e){if(!e||!e.stock[0])return null;var a=e.stock[0];if(!a.linecolor||!v.IsNonEmptyArray(a.linecolor.data))return null;var r=[];for(var t in a.linecolor.data){var n=a.linecolor.data[t];if(!(!v.IsNumber(n.type)||!v.IsNumber(n.date)||!v.IsNumber(n.start)||!v.IsNumber(n.end)||!n.color)&&!(n.start>=n.end)){var s={Type:n.type,Date:n.date,Start:n.start,End:n.end,Color:n.color};v.IsPlusNumber(n.linewidth)&&(s.LineWidth=n.linewidth),r.push(s)}}return r};ce.JsonDataToMinuteLastUpdateTime=function(e){if(!e||!e.stock[0])return null;var a=e.stock[0];return!v.IsNumber(a.date)||!v.IsNumber(a.time)?null:{Date:a.date,Time:a.time}};ce.JsonDataToHistoryMinuteLastUpdateTime=function(e){if(!e||!e.updatetime)return null;var a=e.updatetime;return!v.IsNumber(a.date)||!v.IsNumber(a.time)?null:{Date:a.date,Time:a.time}};ce.JsonDataToMinuteDataArray=function(e){var a=e.symbol,r=a.toUpperCase();U.IsSHSZ(r);var t=U.IsSHO(r),n=U.IsSZO(r),s=U.IsFutures(r),o=[],l=qe.MINUTE_MULTI_DAY_EXTENDDATA;for(var h in e.data){var u=[],f=e.data[h],C=f.date,D=f.yclearing,c=f.yclose,T=c,S=null;s&&D&&(T=S=D);for(var I in f.minute){var g=f.minute[I];g[2]&&(T=g[2]);var E=new fs;E.YClearing=D,E.YClose=c,E.Close=g[2],E.Open=g[1],E.High=g[3],E.Low=g[4],E.Increase=null,E.Vol=g[5],E.Amount=g[6],7<g.length&&g[7]>0&&(E.AvPrice=g[7]),E.DateTime=C.toString()+" "+g[0].toString(),E.Date=C,E.Time=g[0],8<g.length&&g[8]>0&&(E.Date=g[8],E.DateTime=E.Date.toString()+" "+g[0].toString()),(s||t||n)&&9<g.length&&(E.Position=g[9]),v.IsNumber(E.Close)||(E.Close=T,E.Open=E.High=E.Low=E.Close),!E.AvPrice&&S&&(E.AvPrice=S),E.Close&&c&&(E.Increase=(E.Close-c)/c*100),E.Close&&D&&s&&(E.Increase=(E.Close-D)/D*100),g.length>7&&g[7]>0&&E.AvPrice===g[7]&&(S=g[7]),g[l]&&(E.ExtendData=g[l]),u[I]=E}var F=new Y;F.Data=u,F.YClose=c,v.IsNumber(D)&&(F.YClearing=D),F.Close=f.close,F.Date=C,o.push(F)}return o};ce.JsonDataToHistoryMinuteLineColorData=function(e){if(!e)return null;var a=[];for(var r in e.data){var t=e.data[r];if(t.linecolor)for(var n in t.linecolor.data){var s=t.linecolor.data[n];if(!(!v.IsNumber(s.type)||!v.IsNumber(s.date)||!v.IsNumber(s.start)||!v.IsNumber(s.end)||!s.color)&&!(s.start>=s.end)){var o={Type:s.type,Date:s.date,Start:s.start,End:s.end,Color:s.color};v.IsPlusNumber(s.linewidth)&&(o.LineWidth=s.linewidth),a.push(o)}}}return a.length>0?a:null};ce.JsonDataToCallAuctionItem=function(e,a,r,t){var n=t?t.toUpperCase():null,s=U.GetVolUnit(n),o=a.Date,l=a.YClose,h=a.YClearing,u=r?qe.MINUTE_BEFOREOPEN_EXTENDDATA:qe.MINUTE_AFTERCLOSE_EXTENDDATA;if(a.Ver==1){var f=null;for(var C in e){var D=r?new Lr:new Rr,c=e[C];D.YClose=l,D.YClearing=h,D.Time=c[0],D.Date=o,D.Price=c[1],D.Price?f=D.Price:D.Price=f,D.Vol[0]=c[2],D.Amount=c[3],v.IsNumber(c[4])&&(D.Date=c[4]),D.DateTime=D.Date+" "+D.Time,a.Data.push(D)}}else if(a.Ver==2){var T=0;for(var C in e){var D=r?new Lr:new Rr,c=e[C];D.YClose=l,D.YClearing=h,D.Time=c[0],D.Date=o,D.Price=c[1],D.Vol[0]=c[2],D.Vol[1]=c[3],D.ColorID=c[4],D.DateTime=o.toString()+" "+D.Time.toString();var S=D.Vol[0]+D.Vol[1];v.IsNumber(c[5])&&(S=c[5]),S>T&&(T=S),c[u]&&(D.ExtendData=c[u]),a.Data.push(D)}a.VolMax=T/s,a.VolMin=0}else if(beforeOpenData.Ver==3){var T=0;for(var C in e){var D=r?new Lr:new Rr,c=e[C];D.YClose=l,D.YClearing=h,D.Time=c[0],D.Date=o,D.Price=c[1],D.AvPrice=c[2],D.Vol[0]=c[3],D.ColorID=c[4],D.DateTime=o.toString()+" "+D.Time.toString();var S=D.Vol[0];v.IsNumber(c[5])&&(S=c[5]),S>T&&(T=S),c[u]&&(D.ExtendData=c[u]),a.Data.push(D)}a.VolMax=T/s,a.VolMin=0}};ce.JosnDataToBeforeOpenDataArray=function(e){if(!e||!e.data)return null;var a=[];for(var r in e.data){var t=e.data[r],n={Data:[],TotalCount:15,Ver:1,Date:t.date,YClose:t.yclose,YClearing:t.YClearing};t.beforeinfo&&(v.IsNumber(t.beforeinfo.totalcount)&&(n.TotalCount=t.beforeinfo.totalcount),v.IsNumber(t.beforeinfo.ver)&&(n.Ver=t.beforeinfo.ver)),ce.JsonDataToCallAuctionItem(t.before,n,!0,e.symbol),a.push(n)}return a.sort(function(s,o){return s.Date-o.Date}),a};ce.JosnDataToAfterCloseDataArray=function(e){if(!e||!e.data)return null;var a=[];for(var r in e.data){var t=e.data[r],n={Data:[],TotalCount:15,Ver:1,Date:t.date,YClose:t.yclose,YClearing:t.YClearing};t.afterinfo&&(v.IsNumber(t.afterinfo.totalcount)&&(n.TotalCount=t.afterinfo.totalcount),v.IsNumber(t.afterinfo.ver)&&(n.Ver=t.afterinfo.ver)),ce.JsonDataToCallAuctionItem(t.after,n,!1,e.symbol),a.push(n)}return a.sort(function(s,o){return s.Date-o.Date}),a};function Mm(e){this.newMethod=de,this.newMethod(e),delete this.newMethod,this.ClassName="CustomKLineChartContainer",this.CustomKLineApiUrl=d.Domain+"/API/IndexCalculate",this.CustomStock,this.QueryDate={Start:20180101,End:20180627},this.RequestHistoryData=function(){var a=this;this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.Draw(),Vt.HttpRequest({url:this.CustomKLineApiUrl,data:{stock:a.CustomStock,Name:a.Symbol,date:{startdate:a.QueryDate.Start,enddate:a.QueryDate.End}},type:"post",dataType:"json",async:!0,success:function(t){a.ChartSplashPaint.EnableSplash(!1),a.RecvHistoryData(t)}})},this.RecvHistoryData=function(a){var r=de.JsonDataToHistoryData(a),t=new Y;t.Data=r,t.DataType=0;var n=new Y;if(n.Data=r,n.Right=this.Right,n.Period=this.Period,n.DataType=0,n.Right>0){var s=n.GetRightData(n.Right,{AlgorithmType:this.RightFormula});n.Data=s}if(Y.IsDayPeriod(this.Period,!1)){var o=t.GetPeriodData(n.Period);n.Data=o}this.SourceData=t,this.Name=a.name,this.BindMainData(n,this.PageSize);for(var l=0;l<this.Frame.SubFrame.length;++l)this.BindIndexData(l,n);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}}function gD(e,a){a===!0?(this.newMethod=pD,this.newMethod(e),delete this.newMethod):(this.newMethod=de,this.newMethod(e),delete this.newMethod),this.BuySellPaint,this.TrainDataCount=300,this.TrainStartDate,this.AutoRunTimer=null,this.BuySellData=[],this.TrainCallback,this.DragMode=1,this.IsAutoUpdate=!1,this.KLineSourceData,this.TrainInfo={Start:{},End:{}},this.Super_RecvFlowCapitalData=this.RecvFlowCapitalData,this.CreateBuySellPaint=function(){var r=new Qd;r.Canvas=this.Canvas,r.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,r.ChartFrame=this.Frame.SubFrame[0].Frame,r.Name="KLine-Train-BuySell",this.ChartPaintEx[0]=r},this.GetKDataIndexByDateTime=function(r,t){if(!t||!r)return-1;for(var n=0;n<r.length;++n){var s=r[n];if(Y.IsMinutePeriod(this.Period,!0)){if(v.IsNumber(this.TrainStartDate.Time)){if(s.Date>=this.TrainStartDate.Date&&s.Time>=this.TrainStartDate.Time)return n}else if(s.Date>=this.TrainStartDate.Date)return n}else if((Y.IsDayPeriod(this.Period,!0)||Y.IsTickPeriod(this.Period))&&s.Date>=this.TrainStartDate.Date)return n}return-1},this.AfterBindMainData=function(r){this.ChartPaintEx[0]||this.CreateBuySellPaint();var t=this.ChartPaint[0].Data;this.ChartPaintEx[0].Data=t;var n=t.Data[t.Data.length-1];this.TrainInfo.LastShowData=n,this.TrainInfo.LastData=this.SourceData.Data[this.SourceData.Data.length-1],r!="Update"&&this.UpdateTrainUICallback("开始")},this.BeforeBindMainData=function(r){if(r!="Update"){this.KLineSourceData=new Y,this.KLineSourceData.Data=this.SourceData.Data.slice(0);var t=this.SourceData.Data.length,n=t-this.TrainDataCount-20,s=this.GetKDataIndexByDateTime(this.SourceData.Data,this.TrainStartDate);s>=0&&(n=s+1,t-n<this.TrainDataCount&&(this.TrainDataCount=t-n));var o=n-1,l=this.SourceData.Data[o];this.TrainInfo.Start.Index=o,this.TrainInfo.Start.Date=l.Date,this.TrainInfo.Start.Time=l.Time,this.TrainInfo.End.Index=o,this.TrainInfo.End.Date=l.Date,this.TrainInfo.End.Time=l.Time,this.TrainInfo.LastData=l,this.SourceData.Data.length=n}},this.Run=function(r){if(!this.AutoRunTimer&&!(this.TrainDataCount<=0)){var t=this;this.AutoRunTimer=setInterval(function(){t.MoveNextKLineData(r)||clearInterval(t.AutoRunTimer)},1e3)}},this.MoveNextKLineData=function(r){if(this.TrainDataCount<=0)return!1;var t=1;r&&r.Step>1&&(t=r.Step);for(var n=0,s=0;s<t;++s){var o=this.TrainInfo.End.Index+1;if(o>=this.KLineSourceData.Data.length)break;var l=this.KLineSourceData.Data[o];if(this.SourceData.Data.push(l),this.TrainInfo.End.Index=o,this.TrainInfo.End.Date=l.Date,this.TrainInfo.End.Time=l.Time,--this.TrainDataCount,++n,this.TrainDataCount<=0)break}if(n==0)return!1;var h=this.Frame.GetCurrentPageSize();return v.IsNumber(h)&&(this.PageSize=h-this.RightSpaceCount),r&&r.PageSize>0&&(this.PageSize=r.PageSize),this.Update(),this.TrainDataCount<=0?(this.FinishTrainData(),this.UpdateTrainUICallback("结束"),!1):(this.UpdateTrainUICallback("训练中"),!0)},this.UpdateTrainUICallback=function(r){if(this.mapEvent.has($.RECV_TRAIN_MOVE_STEP)){var t=this.mapEvent.get($.RECV_TRAIN_MOVE_STEP);if(t.Callback){var n={TrainDataCount:this.TrainDataCount,BuySellData:this.BuySellData,KLine:{Start:{Index:this.TrainInfo.Start.Index,Date:this.TrainInfo.Start.Date},End:{Index:this.TrainInfo.End.Index,Date:this.TrainInfo.End.Date}},LastData:this.TrainInfo.LastData,LastShowData:this.TrainInfo.LastShowData};v.IsNumber(this.TrainInfo.Start.Time)&&(n.KLine.Start.Time=this.TrainInfo.Start.Time),v.IsNumber(this.TrainInfo.End.Time)&&(n.KLine.End.Time=this.TrainInfo.End.Time),r&&(n.Description=r),this.TrainDataCount<=0&&(n.Symbol=this.Symbol,n.Name=this.Name),t.Callback(t,n,this)}}},this.FinishTrainData=function(){k.Chart.Log("[KLineTrainChartContainer::FinishTrainData] trian end ")},this.Stop=function(){this.AutoRunTimer!=null&&clearInterval(this.AutoRunTimer),this.AutoRunTimer=null},this.BuyOrSell=function(r,t){var n=this.TrainInfo.LastShowData;if(!n)return!1;var s=this.ChartPaintEx[0];if(!s)return!1;var o=this.ChartPaint[0].Data;if(!o||o.Data.length<=0)return!1;var l=o.Data.length-1,h={Date:this.TrainInfo.End.Date,Time:this.TrainInfo.End.Time,Price:r.Price,Vol:r.Vol,Op:0,ID:r.ID};r.Op==1&&(h.Op=1);var u=l;h.Key=u,this.BuySellData.push(h),s.AddTradeItem(h),t==!0&&this.Draw()},this.RestartTrain=function(r){k.Chart.Log("[KLineTrainChartContainer::RestartTrain] option ",r),this.TrainInfo={Start:{},End:{}},this.BuySellData=[],this.KLineSourceData=null;var t=this.ChartPaintEx[0];t&&(t.Data=null,t.ClearTradeData()),r.Symbol&&(this.Symbol=r.Symbol),v.IsNumber(r.Period)&&(this.Period=r.Period),v.IsNumber(r.Right)&&(this.Right=r.Right),r.Train&&(r.Train.DataCount>1&&(this.TrainDataCount=r.Train.DataCount),r.Train.DateTime&&(this.TrainStartDate=r.Train.DateTime));var n=this.Symbol;this.ChangeSymbol(n)},this.RecvFlowCapitalData=function(r){if(!(!r.stock||r.stock.length!=1)){var t=r.stock[0],n=new Array;for(var s in t.stockday){var o=t.stockday[s],l=new Wt;l.Date=o.date;var h=o.capital;h&&h.a>0&&(l.Value=h.a,n.push(l))}if(Y.IsMinutePeriod(this.Period,!0)){var c=this.SourceData.GetMinuteFittingFinanceData(n);for(var u in this.SourceData.Data){var o=this.SourceData.Data[u];c[u]&&(o.FlowCapital=c[u].Value)}var f=this.ChartPaint[0].Data,C=new Y;if(C.Data=this.SourceData.Data,Y.IsMinutePeriod(f.Period,!1)){var D=C.GetPeriodData(f.Period);C.Data=D}f.Data=C.Data;var c=this.KLineSourceData.GetMinuteFittingFinanceData(n);for(var T in this.KLineSourceData.Data){var o=this.KLineSourceData.Data[T];c[T]&&(o.FlowCapital=c[T].Value)}}else{var c=this.SourceData.GetFittingFinanceData(n);for(var S in this.SourceData.Data){var o=this.SourceData.Data[S];c[S]&&(o.FlowCapital=c[S].Value)}var f=this.ChartPaint[0].Data,C=new Y;if(C.Data=this.SourceData.Data,f.Right>0){var I=C.GetRightData(f.Right,{AlgorithmType:this.RightFormula});C.Data=I}if(Y.IsDayPeriod(f.Period,!1)){var D=C.GetPeriodData(f.Period);C.Data=D}f.Data=C.Data;var c=this.KLineSourceData.GetFittingFinanceData(n);for(var g in this.KLineSourceData.Data){var o=this.KLineSourceData.Data[g];c[g]&&(o.FlowCapital=c[g].Value)}}this.FlowCapitalReady=!0;var E=!1;for(var F in this.ExtendChartPaint){var o=this.ExtendChartPaint[F];if(o.ClassName=="StockChip"){E=!0;break}}E&&this.Draw()}},this.AutoUpdate()}function Lm(e,a){this.newMethod=gD,this.newMethod(e,a),delete this.newMethod,this.IsHScreen=a,this.IsZoomLockRight=!0,this.RightSpaceCount=0,this.RecvFlowCapitalData=function(r){this.Super_RecvFlowCapitalData(r)},this.BeforeBindMainData=function(r){},this.UpdateLastDataIcon=function(){if(this.ChartPaintEx[0]){var r=this.ChartPaintEx[0];r.LastDataIndex=this.TrainInfo.End.Index}},this.AfterBindMainData=function(r){if(this.ChartPaintEx[0]||(this.CreateBuySellPaint(),this.ChartPaintEx[0].LastDataDrawType=1),r!="Update"){var t=this.ChartOperator_Temp_GetHistroyData();if(!t)return!1;var n=t.Data.length,s=n-this.TrainDataCount-20,o=this.Frame.SubFrame[0].Frame.XPointCount,l=this.GetKDataIndexByDateTime(t.Data,this.TrainStartDate);l>=0&&(s=l+1,n-s<this.TrainDataCount&&(this.TrainDataCount=n-s));var h=s-o;t.DataOffset=h;var u=s-1,f=t.Data[u];this.TrainInfo.LastShowData=f,this.TrainInfo.LastData=f,this.TrainInfo.Start.Index=u,this.TrainInfo.Start.Date=f.Date,this.TrainInfo.Start.Time=f.Time,this.TrainInfo.End.Index=u,this.TrainInfo.End.Date=f.Date,this.TrainInfo.End.Time=f.Time,this.UpdateLastDataIcon(),this.UpdateTrainUICallback("开始")}},this.Super_UpdataDataoffset=this.UpdataDataoffset,this.UpdataDataoffset=function(){this.Super_UpdataDataoffset();var r=this.ChartPaint[0].Data;this.ChartPaintEx[0].Data=r},this.MoveNextKLineData=function(r){if(this.TrainDataCount<=0)return!1;var t=this.ChartOperator_Temp_GetHistroyData();if(!t)return!1;var n=1;r&&r.Step>1&&(n=r.Step);for(var s=t.Data.length,o=0,l=0;l<n;++l){var h=this.TrainInfo.End.Index+1;if(h>=s)break;var u=t.Data[h];if(this.TrainInfo.End.Index=h,this.TrainInfo.End.Date=u.Date,this.TrainInfo.End.Time=u.Time,--this.TrainDataCount,++o,this.TrainDataCount<=0)break}if(o==0)return!1;this.TrainInfo.LastShowData=u,this.TrainInfo.LastData=u;var f=this.TrainInfo.End.Index,C=this.Frame.SubFrame[0].Frame.XPointCount,D=f-C+1;return t.DataOffset=D,this.UpdateLastDataIcon(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.TrainDataCount<=0?(this.FinishTrainData(),this.UpdateTrainUICallback("结束"),!1):(this.UpdateTrainUICallback("训练中"),!0)},this.BuyOrSell=function(r,t){var n=this.TrainInfo.LastShowData;if(!n)return!1;var s=this.ChartPaintEx[0];if(!s)return!1;var o=this.ChartPaint[0].Data;if(!o||o.Data.length<=0)return!1;var l=this.TrainInfo.End.Index,h={Date:this.TrainInfo.End.Date,Time:this.TrainInfo.End.Time,Price:r.Price,Vol:r.Vol,Op:0,ID:r.ID};r.Op==1&&(h.Op=1);var u=l;h.Key=u,this.BuySellData.push(h),s.AddTradeItem(h),t==!0&&this.Draw()},this.DataMove=function(r,t){var n=this.GetMoveOneStepWidth(),s=r;if(r=parseInt(r/n),r<=0)return!1;var o=this.ChartOperator_Temp_GetHistroyData();if(!o)return!1;var l=0;if(this.Frame.XPointCount?l=this.Frame.XPointCount:l=this.Frame.SubFrame[0].Frame.XPointCount,!l)return!1;if(this.Frame.SubFrame&&this.Frame.SubFrame.length>0&&this.Frame.SubFrame[0].Frame){var h=this.Frame.SubFrame[0].Frame;(h.DataWidth<=1||h.DistanceWidth<=1)&&v.IsPlusNumber(this.StepPixel)&&(r=s*this.StepPixel)}if(t){if(this.RightSpaceCount>0){if(l+o.DataOffset>=o.Data.length+this.RightSpaceCount-1)return!1;o.DataOffset+=r,o.DataOffset+l>=o.Data.length+this.RightSpaceCount&&(o.DataOffset=o.Data.length-(l-this.RightSpaceCount))}else{var u=this.TrainInfo.End.Index+1;if(l+o.DataOffset>=u)return!1;o.DataOffset+=r,o.DataOffset+l>=u&&(o.DataOffset=u-l)}return!0}else return o.DataOffset<=0?!1:(o.DataOffset-=r,o.DataOffset<0&&(o.DataOffset=0),!0)},this.DataMoveRight=function(){var r=this.ChartOperator_Temp_GetHistroyData();if(!r)return!1;var t=0;if(this.Frame.XPointCount?t=this.Frame.XPointCount:t=this.Frame.SubFrame[0].Frame.XPointCount,!t)return!1;var n=this.TrainInfo.End.Index+1;return t+r.DataOffset>=n?!1:(++r.DataOffset,!0)}}function pD(e){this.newMethod=de,this.newMethod(e),delete this.newMethod,this.ClassName="KLineChartHScreenContainer",this.OnMouseMove=function(a,r,t,n){this.LastPoint.X=a,this.LastPoint.Y=r,this.CursorIndex=this.Frame.GetXData(r);var s={ParentFunction:"OnMouseMove",Point:{X:a,Y:r},IsPhone:n===!0};this.DrawDynamicInfo(s)},e.onmousedown=function(a){if(this.JSChartContainer&&this.JSChartContainer.DragMode!=0){var r=B();if(this.JSChartContainer.TryClickLock){var t=(a.clientX-this.getBoundingClientRect().left)*r,n=(a.clientY-this.getBoundingClientRect().top)*r;if(this.JSChartContainer.TryClickLock(t,n))return}var s={Click:{},LastMove:{}};s.Click.X=a.clientX,s.Click.Y=a.clientY,s.LastMove.X=a.clientX,s.LastMove.Y=a.clientY,this.JSChartContainer.MouseDrag=s,document.JSChartContainer=this.JSChartContainer,this.JSChartContainer.SelectChartDrawPicture=null,e.ondblclick=function(o){var l=o.clientX-this.getBoundingClientRect().left,h=o.clientY-this.getBoundingClientRect().top;this.JSChartContainer&&this.JSChartContainer.OnDoubleClick(l,h,o)},document.onmousemove=function(o){if(this.JSChartContainer&&!(this.JSChartContainer.ChartSplashPaint&&this.JSChartContainer.ChartSplashPaint.IsEnableSplash==!0)){var l=this.JSChartContainer.MouseDrag;if(l){var h=Math.abs(l.LastMove.Y-o.clientY);if(this.JSChartContainer.DragMode==1){if(h<5)return;var u=this.JSChartContainer.GetMoveOneStepWidth();if(h<u)return;var f=!0;l.LastMove.Y<o.clientY&&(f=!1),this.JSChartContainer.DataMove(h,f)&&(this.JSChartContainer.UpdataDataoffset(),this.JSChartContainer.UpdatePointByCursorIndex(),this.JSChartContainer.UpdateFrameMaxMin(),this.JSChartContainer.ResetFrameXYSplit(),this.JSChartContainer.Draw()),l.LastMove.X=o.clientX,l.LastMove.Y=o.clientY}}}},document.onmouseup=function(o){document.onmousemove=null,document.onmouseup=null,this.JSChartContainer.MouseDrag=null,this.JSChartContainer.CurrentChartDrawPicture=null,this.JSChartContainer=null}}},this.OnTouchStart=function(a){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){this.IsPress=!1,this.PhonePinch=null,this.IsOnTouch=!0,this.TouchDrawCount=0,this.StopDragTimer();var r=this.IsSingleTouch(a);if(a.cancelable&&a.preventDefault(),this.IsPhoneDragging(a)){var t=this.GetToucheData(a,!1),n=this.PointAbsoluteToRelative(t[0].clientX,t[0].clientY,!0);if(this.TryClickLock||this.TryClickIndexTitle){var s=n.X,o=n.Y;if(this.TryClickLock&&this.TryClickLock(s,o)||this.TryClickIndexTitle&&this.TryClickIndexTitle(s,o))return}if(this.ClickFrameButton){var l=this.Frame.PtInButtons(n.X,n.Y);if(l){this.ClickFrameButton(l,a);return}}this.EnableVerticalDrag&&(this.VerticalDrag={IsDrag:!1},this.Frame.PtInFrameVertical(n.X,n.Y)&&(this.VerticalDrag.IsDrag=!0));var h=!0;this.ChartDrawOption.IsLockScreen?h=!1:this.DragMode==Ve.CLICK_TOUCH_MODE_ID?this.TouchStatus.CorssCursorShow==!0&&(h=!1):this.DragMode==Ve.DISABLE_DRAG_ID?h=!1:r||(h=!1),this.VerticalDrag&&(h=!1);var u={Click:{},LastMove:{}};if(u.Click.X=t[0].clientX,u.Click.Y=t[0].clientY,u.LastMove.X=t[0].clientX,u.LastMove.Y=t[0].clientY,this.MouseDrag=u,this.PhoneTouchInfo={Start:{X:t[0].clientX,Y:t[0].clientY},End:{X:t[0].clientX,Y:t[0].clientY}},this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.IsSelected=!1),this.SelectChartDrawPicture=null,this.CurrentChartDrawPicture){var f=this.CurrentChartDrawPicture;f.Status==2?this.SetChartDrawPictureThirdPoint(u.Click.X,u.Click.Y,!0):(this.SetChartDrawPictureFirstPoint(u.Click.X,u.Click.Y,!0),this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo({Corss:!1,Tooltip:!1})),a.cancelable&&a.preventDefault();return}else{var C={};if(C.X=t[0].clientX-e.getBoundingClientRect().left,C.Y=t[0].clientY-e.getBoundingClientRect().top,this.GetChartDrawPictureByPoint(C)){C.ChartDrawPicture.Status=20,C.ChartDrawPicture.ValueToPoint(),C.ChartDrawPicture.MovePointIndex=C.PointIndex,C.ChartDrawPicture.IsSelected=!0,this.CurrentChartDrawPicture=C.ChartDrawPicture,this.SelectChartDrawPicture=C.ChartDrawPicture;var D=this.GetEventCallback($.ON_CLICK_DRAWPICTURE);if(D&&D.Callback){var c={DrawPicture:C.ChartDrawPicture};D.Callback(D,c,this)}a.cancelable&&a.preventDefault();return}}if(h){var T=this;this.DragTimer=setTimeout(function(){T.IsPress=!1,u.Click.X==u.LastMove.X&&u.Click.Y==u.LastMove.Y&&(T.MouseDrag,T.MouseDrag=null,T.MoveCorssCursor(u.Click,a))},T.PressTime)}this.ChartDrawOption.IsLockScreen?this.MouseDrag=null:this.DragMode==Ve.CLICK_TOUCH_MODE_ID||(this.DragMode==Ve.DISABLE_DRAG_ID?(this.MouseDrag=null,this.MoveCorssCursor(u.Click,a)):this.VerticalDrag?this.VerticalDrag.IsDrag||this.MoveCorssCursor(u.Click,a):this.IsClickShowCorssCursor&&this.MoveCorssCursor(u.Click,a))}else if(this.IsPhonePinching(a)){var S={Start:{},Last:{}},t=this.GetToucheData(a,!1);S.Start={X:t[0].pageX,Y:t[0].pageY,X2:t[1].pageX,Y2:t[1].pageY},S.Last={X:t[0].pageX,Y:t[0].pageY,X2:t[1].pageX,Y2:t[1].pageY},this.PhonePinch=S,this.SelectChartDrawPicture=null}this.TouchEvent({EventID:$.ON_PHONE_TOUCH,FunctionName:"OnTouchStart"},a)}},this.OnTouchMove=function(a){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){a.cancelable&&a.preventDefault();var r=this.GetToucheData(a,!1);if(this.IsPhoneDragging(a)){var t=this.MouseDrag;if(t==null)this.ChartDrawOption.IsLockScreen||this.MoveCorssCursor({X:r[0].clientX,Y:r[0].clientY},a);else{var n=Math.abs(t.LastMove.Y-r[0].clientY),s=Math.abs(t.LastMove.X-r[0].clientX),o=this.DragMode==Ve.CLICK_TOUCH_MODE_ID&&this.TouchStatus.CorssCursorShow==!0;if(this.VerticalDrag&&(this.VerticalDrag.IsDrag===!0?o=!1:o=!0),this.CurrentChartDrawPicture){var l=this.CurrentChartDrawPicture;if(l.Status==1||l.Status==2){if(n<5&&s<5)return;this.SetChartDrawPictureSecondPoint(r[0].clientX,r[0].clientY,!0)&&this.DrawDynamicInfo()}else if(l.Status==3)this.SetChartDrawPictureThirdPoint(r[0].clientX,r[0].clientY,!0)&&this.DrawDynamicInfo();else if(l.Status==20){if(n<5&&s<5)return;this.MoveChartDrawPicture(r[0].clientX-t.LastMove.X,r[0].clientY-t.LastMove.Y,!0)&&this.DrawDynamicInfo()}t.LastMove.X=r[0].clientX,t.LastMove.Y=r[0].clientY}else if(o)this.MouseDrag,this.MouseDrag=null,this.MoveCorssCursor(t.Click,a);else if(this.DragMode==1||o==!1){if(n<5)return;var h=this.GetMoveOneStepWidth();if(n<h||this.EnableVerticalDrag&&(!this.VerticalDrag||!this.VerticalDrag.IsDrag))return;var u=!0;t.LastMove.Y<r[0].clientY&&(u=!1),this.DataMove(n,u)?(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw(),this.OnKLinePageChange("OnTouchMove")):this.DragDownloadData&&this.DragDownloadData(),t.LastMove.X=r[0].clientX,t.LastMove.Y=r[0].clientY}}this.PhoneTouchInfo&&(this.PhoneTouchInfo.End.X=r[0].clientX,this.PhoneTouchInfo.End.Y=r[0].clientY)}else if(this.IsPhonePinching(a)){if(this.DragMode==Ve.DISABLE_DRAG_ID)return;var f=this.PhonePinch;if(!f)return;var C=Math.abs(r[0].pageX-r[1].pageX),D=Math.abs(f.Last.X-f.Last.X2),c=C-D;if(Math.abs(c)<5)return;if(c>0){var T={};if(T.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomUp(T))return;this.CursorIndex=T.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("OnTouchMove")}else{var T={};if(T.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomDown(T))return;this.CursorIndex=T.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("OnTouchMove")}f.Last={X:r[0].pageX,Y:r[0].pageY,X2:r[1].pageX,Y2:r[1].pageY}}}},this.OnTouchEnd=function(a){if(k.Chart.Log("[KLineChartHScreenContainer:OnTouchEnd]",a),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){if(this.CurrentChartDrawPicture){var r=this.CurrentChartDrawPicture;r.Status==2||r.Status==1||r.Status==3?(r.PointStatus=r.Status,this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo()):r.Status==20&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}this.IsOnTouch=!1,this.VerticalDrag=null,this.StopDragTimer(),this.TouchEvent({EventID:$.ON_PHONE_TOUCH,FunctionName:"OnTouchEnd"},a),this.OnTouchFinished(),this.TouchDrawCount=0}},this.Create=function(a){var r=this;this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new Bn,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=Je.Create("CorssCursor_XStringFormat"),this.ChartCorssCursor.StringFormatX.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY=Je.Create("CorssCursor_YStringFormat"),this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY.ExtendChartPaint=this.ExtendChartPaint,this.ChartCorssCursor.GetEventCallback=function(s){return r.GetEventCallback(s)},this.ChartSplashPaint=new Li,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.HQChart=this,this.Frame=new yC,this.Frame.ChartBorder=new ra,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(a),this.CreateMainKLine();for(var t in this.Frame.SubFrame){var n=new Qa;n.Frame=this.Frame.SubFrame[t].Frame,n.Canvas=this.Canvas,n.LanguageID=this.LanguageID,n.GetEventCallback=function(s){return r.GetEventCallback(s)},n.SelectedChart=this.SelectedChart,this.TitlePaint.push(n)}this.UIElement.addEventListener("keydown",NC,!0)},this.CreateChildWindow=function(a){for(var r=this,t=0;t<a;++t){var n=new ra;n.UIElement=this.UIElement;var s=on.Create("KLineHScreenFrame",{ID:t});if(s.Canvas=this.Canvas,s.GetExtraCanvas=function(u){return r.GetExtraCanvas(u)},s.ChartBorder=n,s.Identify=t,s.RightSpaceCount=this.RightSpaceCount,s.GetEventCallback=function(u){return r.GetEventCallback(u)},s.GlobalOption=this.GlobalOption,s.HorizontalMax=20,s.HorizontalMin=10,t==0){s.YSplitOperator=new Ds,s.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price"),s.YSplitOperator.FrameSplitData2=this.FrameSplitData.get("double"),s.YSplitOperator.GetEventCallback=function(u){return r.GetEventCallback(u)},s.YSplitOperator.HQChart=this;var o=B();n.TopSpace=12*o,n.BottomSpace=12*o}else s.YSplitOperator=new Za,s.YSplitOperator.LanguageID=this.LanguageID,s.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),s.YSplitOperator.GetEventCallback=function(u){return r.GetEventCallback(u)},s.YSplitOperator.HQChart=this;s.YSplitOperator.Frame=s,s.YSplitOperator.ChartBorder=n,s.XSplitOperator=new br,s.XSplitOperator.Frame=s,s.XSplitOperator.ChartBorder=n,s.XSplitOperator.GetEventCallback=function(u){return r.GetEventCallback(u)},t!=a-1&&(s.XSplitOperator.ShowText=!1);for(var l=s.HorizontalMin;l<=s.HorizontalMax;l+=1)s.HorizontalInfo[l]=new Ut,s.HorizontalInfo[l].Value=l,!(t==0&&l==s.HorizontalMin)&&(s.HorizontalInfo[l].Message[1]=l.toString(),s.HorizontalInfo[l].Font="14px 微软雅黑");var h=new yr;s.FrameData.SubFrameItem=h,h.Frame=s,t==0?h.Height=20:h.Height=10,this.Frame.SubFrame[t]=h}},this.CreateStockChipPhone=function(a){var r=new iD;return r.Canvas=this.Canvas,r.ChartBorder=this.Frame.ChartBorder,r.ChartFrame=this.Frame,r.HQChart=this,r.Left=this.Frame.ChartBorder.Bottom,r.SetOption(a),this.ExtendChartPaint.push(r),this.Frame.ChartBorder.Bottom+=r.Width,this.GlobalOption.RightHorizontal.Show=!1,r},this.DeleteStockChipChart=function(){var a=this.GetStockChipChart();if(a){var r=a.Chart.Width;this.DeleteExtendChart(a),this.Frame.ChartBorder.Bottom-=r,a.Chart.ClassName=="StockChipPhone"&&(this.GlobalOption.RightHorizontal.Show=!0,this.Frame.ResetXYSplit()),this.SetSizeChange(!0),this.Draw()}}}function Tf(e){this.newMethod=ce,this.newMethod(e),delete this.newMethod,this.ClassName="MinuteChartHScreenContainer",this.OnMouseMove=function(a,r,t,n){this.LastPoint.X=a,this.LastPoint.Y=r,this.CursorIndex=this.Frame.GetXData(r);var s=this.PtInClient(a,r),o={ParentFunction:"OnMouseMove",Point:{X:a,Y:r},IsPhone:n===!0,ClientPos:s};this.DrawDynamicInfo(o)},this.Create=function(a){var r=this;this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new Bn,this.ChartCorssCursor.PtInClient=function(s,o){return r.PtInClient(s,o)},this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=Je.Create("CorssCursor_Minute_XStringFormat"),this.ChartCorssCursor.StringFormatX.GetEventCallback=function(s){return r.GetEventCallback(s)},this.ChartCorssCursor.StringFormatY=Je.Create("CorssCursor_YStringFormat"),this.ChartCorssCursor.StringFormatY.GetEventCallback=function(s){return r.GetEventCallback(s)},this.ChartCorssCursor.CallAcutionXOperator=new Dh,this.ChartCorssCursor.GetEventCallback=function(s){return r.GetEventCallback(s)},this.ChartSplashPaint=new Li,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.HQChart=this,this.Frame=new yC,this.Frame.ChartBorder=new ra,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=25,this.Frame.ChartBorder.Left=50,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(a),this.CreateMainKLine();for(var t in this.Frame.SubFrame){var n=new Qa;n.Frame=this.Frame.SubFrame[t].Frame,n.Canvas=this.Canvas,n.LanguageID=this.LanguageID,n.GetEventCallback=function(s){return r.GetEventCallback(s)},n.SelectedChart=this.SelectedChart,this.TitlePaint.push(n)}this.ChartCorssCursor.StringFormatX.Frame=this.Frame.SubFrame[0].Frame,this.ChartCorssCursor.StringFormatY.Frame=this.Frame,this.ChartCorssCursor.CallAcutionXOperator.Frame=this.Frame.SubFrame[0].Frame,this.UIElement.addEventListener("keydown",NC,!0)},this.CreateChildWindow=function(a){for(var r=this,t=0;t<a;++t){var n=new ra;n.UIElement=this.UIElement;var s=new Jh;s.Canvas=this.Canvas,s.ChartBorder=n,s.Identify=t,t<2&&(s.ChartBorder.TitleHeight=0),s.XPointCount=243,s.HQChart=this,s.GetEventCallback=function(u){return r.GetEventCallback(u)};var o=[9,8,7,6,5,4,3,2,1];s.HorizontalMax=o[0],s.HorizontalMin=o[o.length-1],t==0?(s.YSplitOperator=new sD,s.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price"),s.YSplitOperator.GetEventCallback=function(u){return r.GetEventCallback(u)},s.YSplitOperator.DayOffset=this.DayOffset,s.YSplitOperator.HQChart=this):(s.YSplitOperator=new Za,s.YSplitOperator.LanguageID=this.LanguageID,s.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),s.YSplitOperator.GetEventCallback=function(u){return r.GetEventCallback(u)}),s.YSplitOperator.Frame=s,s.YSplitOperator.ChartBorder=n,s.XSplitOperator=new Ch,s.XSplitOperator.Frame=s,s.XSplitOperator.ChartBorder=n,s.XSplitOperator.DayOffset=this.DayOffset,s.XSplitOperator.GetEventCallback=function(u){return r.GetEventCallback(u)},t!=a-1&&(s.XSplitOperator.ShowText=!1),s.XSplitOperator.Operator();for(var l in o)s.HorizontalInfo[l]=new Ut,s.HorizontalInfo[l].Value=o[l],!(t==0&&l==s.HorizontalMin)&&(s.HorizontalInfo[l].Message[1]=o[l].toString(),s.HorizontalInfo[l].Font="14px 微软雅黑");var h=new yr;s.FrameData.SubFrameItem=h,h.Frame=s,t==0?h.Height=20:h.Height=10,this.Frame.SubFrame[t]=h}}}function Rm(e){this.newMethod=Kh,this.newMethod(e),delete this.newMethod,this.ClassName="DepthChartContainer",this.Symbol,this.MapAsk=new Dt.default,this.MapBid=new Dt.default,this.IsAutoUpdate=!1,this.AutoUpdateFrequency=3e4,this.AutoUpdateTimer,this.DefaultZoom=.8,this.MaxVolRate=1.1,this.Create=function(a){var r=this;this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new DI,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.HQChart=this,this.ChartSplashPaint=new Li,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.Frame=new Ld,this.Frame.ChartBorder=new ra,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.ChartBorder.TitleHeight=0,this.Frame.Canvas=this.Canvas,this.Frame.Identify=0;var t=new Za;t.FrameSplitData=this.FrameSplitData.get("double"),t.LanguageID=this.LanguageID,t.Frame=this.Frame,t.SplitCount=5,t.LineType=3,t.IgnoreYValue=[0],t.ChartBorder=this.Frame.ChartBorder,t.GetEventCallback=function(l){return r.GetEventCallback(l)},this.Frame.YSplitOperator=t;var n=new CI;n.Frame=this.Frame,n.ChartBorder=this.Frame.ChartBorder,n.LanguageID=this.LanguageID,n.LineType=3,n.GetEventCallback=function(l){return r.GetEventCallback(l)},this.Frame.XSplitOperator=n,this.ChartCorssCursor&&(this.ChartCorssCursor.Frame=this.Frame),this.ChartSplashPaint.Frame=this.Frame;var s=new $d;s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.Name="深度图",this.ChartPaint.push(s);var o=!0;a&&a.Wheel===!1&&(o=!1,k.Chart.Log("[DepthChartContainer::Create] not register wheel event.")),this.UIElement.addEventListener("keydown",function(l){r.OnKeyDown(l)},!0),o&&this.UIElement.addEventListener("wheel",function(l){r.OnWheel(l)},!0)},this.OnWheel=function(a){k.Chart.Log("[KLineChartContainer::OnWheel]",a);var r=a.clientX-this.UIElement.getBoundingClientRect().left,t=a.clientY-this.UIElement.getBoundingClientRect().top,n=!1;this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),n=this.Canvas.isPointInPath(r,t);var s=a.wheelDelta;v.IsObjectExist(a.wheelDelta)||(s=a.deltaY*-.01);var o=!0;this.EnableZoomUpDown&&this.EnableZoomUpDown.Wheel===!1&&(o=!1),n&&s<0&&o?this.Frame.ZoomDown()&&(this.UpdateFrameMaxMin(),this.Draw()):n&&s>0&&o&&this.Frame.ZoomUp()&&(this.UpdateFrameMaxMin(),this.Draw()),a.preventDefault?a.preventDefault():a.returnValue=!1},this.UIOnMouseDown=function(a){},this.OnTouchStart=function(a){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){this.IsOnTouch=!0,this.TouchDrawCount=0,this.PhonePinch=null;var r=this.IsSingleTouch(a);if((this.EnableScrollUpDown==!1||!r)&&a.cancelable&&a.preventDefault(),this.IsPhoneDragging(a)){var t={Click:{},LastMove:{}},n=this.GetToucheData(a,this.IsForceLandscape);t.Click.X=n[0].clientX,t.Click.Y=n[0].clientY,t.LastMove.X=n[0].clientX,t.LastMove.Y=n[0].clientY,this.MouseDrag=t,this.MoveCorssCursor(t.Click,a)}else if(this.IsPhonePinching(a)){var s={Start:{},Last:{}},n=this.GetToucheData(a,this.IsForceLandscape);s.Start={X:n[0].pageX,Y:n[0].pageY,X2:n[1].pageX,Y2:n[1].pageY},s.Last={X:n[0].pageX,Y:n[0].pageY,X2:n[1].pageX,Y2:n[1].pageY},this.PhonePinch=s}}},this.OnTouchMove=function(a){var r=this.GetToucheData(a,!1);if(this.IsPhoneDragging(a)){var t=this.MouseDrag;if(t==null){var n=B(),s=r[0].clientX-e.getBoundingClientRect().left*n,o=r[0].clientY-e.getBoundingClientRect().top*n;this.OnMouseMove(s,o,a)}else{var l=this.GetMoveAngle(t.LastMove,{X:r[0].clientX,Y:r[0].clientY}),h=Math.abs(t.LastMove.X-r[0].clientX),u=Math.abs(t.LastMove.Y-r[0].clientY);if(h=parseInt(h),(u>0&&h<=3||l<=this.TouchMoveMinAngle)&&this.EnableScrollUpDown==!0)return;this.PreventTouchEvent(a),this.MouseDrag=null;var n=B(),s=r[0].clientX-e.getBoundingClientRect().left*n,o=r[0].clientY-e.getBoundingClientRect().top*n;this.OnMouseMove(s,o,a)}}else if(this.IsPhonePinching(a)){this.PreventTouchEvent(a);var f=this.PhonePinch;if(!f||this.EnableZoomUpDown&&this.EnableZoomUpDown.Touch===!1)return;var C=Math.abs(r[0].pageY-r[1].pageY),D=Math.abs(f.Last.Y-f.Last.Y2),c=C-D,T=Math.abs(r[0].pageX-r[1].pageX),S=Math.abs(f.Last.X-f.Last.X2),I=T-S,g=this.ZoomStepPixel;if(Math.abs(c)<g&&Math.abs(I)<g)return;var E=c;if(Math.abs(c)<g&&(E=I),E>0){if(!this.Frame.ZoomUp())return;this.UpdateFrameMaxMin(),this.Draw()}else{if(!this.Frame.ZoomDown())return;this.UpdateFrameMaxMin(),this.Draw()}f.Last={X:r[0].pageX,Y:r[0].pageY,X2:r[1].pageX,Y2:r[1].pageY}}this.PreventTouchEvent(a)},this.OnTouchEnd=function(a){k.Chart.Log("[DepthChartContainer::OnTouchEnd]",a),this.IsOnTouch=!1,this.OnTouchFinished(),this.TouchDrawCount=0},this.OnTouchFinished=function(){if(this.CorssCursorTouchEnd===!0){this.DrawDynamicInfo();return}},this.ChangeSymbol=function(a){this.CancelAutoUpdate(),this.Symbol=a,this.MapBid=new Dt.default,this.MapAsk=new Dt.default,this.Frame.VerticalRange.Differ=null,this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.Draw(),this.RequestDepthData()},this.RequestDepthData=function(){var a=this;if(this.NetworkFilter){var r={Name:"DepthChartContainer::RequestDepthData",Explain:"深度图数据",Request:{Data:{symbol:a.Symbol}},Self:this,PreventDefault:!1};if(this.NetworkFilter(r,function(t){a.ChartSplashPaint.EnableSplash(!1),a.RecvDepthData(t),a.AutoUpdate()}),r.PreventDefault==!0)return}},this.RecvDepthData=function(a){this.UpdateAskAndBid(a);var r=(0,qs.default)(this.MapAsk.values());r.sort(function(u,f){return u.Price-f.Price});var o=0;for(var t in r){var n=r[t];o+=n.Vol,r[t]={Price:n.Price,Vol:o}}var s=(0,qs.default)(this.MapBid.values());s.sort(function(u,f){return f.Price-u.Price});var o=0;for(var t in s){var n=s[t];o+=n.Vol,s[t]={Price:n.Price,Vol:o}}var l={Asks:r,Bids:s},h=this.ChartPaint[0];h.Data=l,this.Frame.XSplitOperator.Symbol=this.Symbol,this.ChartCorssCursor.Data=l,this.ChartCorssCursor.Symbol=this.Symbol,this.UpdateFramePriceList(),this.UpdateFrameMaxMin(),this.Draw()},this.UpdateAskAndBid=function(a){a.datatype=="snapshot"&&(this.MapBid=new Dt.default,this.MapAsk=new Dt.default);for(var r in a.asks){var t=a.asks[r],n=parseFloat(t[0]),s=parseFloat(t[1]);if(this.MapAsk.has(n)){var o=this.MapAsk.get(n);s<=0?this.MapAsk.delete(n):o.Vol=s}else s>0&&this.MapAsk.set(n,{Price:n,Vol:s})}for(var r in a.bids){var t=a.bids[r],n=parseFloat(t[0]),s=parseFloat(t[1]);if(this.MapBid.has(n)){var o=this.MapBid.get(n);s<=0?this.MapBid.delete(n):o.Vol=s}else s>0&&this.MapBid.set(n,{Price:n,Vol:s})}},this.UpdateFramePriceList=function(){var a=(0,qs.default)(this.MapAsk.keys()),r=(0,qs.default)(this.MapBid.keys());a.sort(function(T,S){return T-S}),r.sort(function(T,S){return T-S});var t={Max:88,Min:8};if(a.length>1&&r.length>1){var n=a[0],s=a[a.length-1],o=r[0],l=r[r.length-1],h=s-n,u=l-o,f=Math.max(h,u),C={Min:n,Max:n+f},D={Max:l,Min:l-f};t={Max:C.Max,Min:D.Min}}this.Frame.SetPriceList(a,r);var c=this.Frame.VerticalRange;c.Max=t.Max,c.Center=t.Min+(t.Max-t.Min)/2,c.Min=t.Min,c.MaxDiffer=f,c.Ask=C,c.Bid=D,v.IsNumber(c.Differ)||(c.Differ=f*this.DefaultZoom),c.Min=c.Center-c.Differ,c.Max=c.Center+c.Differ},this.UpdateFrameMaxMin=function(){var a=this.ChartPaint[0].GetMaxMin();this.Frame.HorizontalMax=a.Max*this.MaxVolRate,this.Frame.HorizontalMin=0,this.Frame.XYSplit=!0},this.CancelAutoUpdate=function(){typeof this.AutoUpdateTimer=="number"&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=void 0)},this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.AutoUpdate=function(){if(this.CancelAutoUpdate(),!!this.IsAutoUpdate&&this.Symbol){var a=this,r=U.GetMarketStatus(this.Symbol);if(!(r==0||r==3)){var t=this.AutoUpdateFrequency;r==1?this.AutoUpdateTimer=setTimeout(function(){a.AutoUpdate()},t):r==2&&(this.AutoUpdateTimer=setTimeout(function(){a.RequestDepthData()},t))}}}}function Sf(e,a){this.Name=e,this.Param=a,this.LineColor,this.ReqeustData=null}function Ls(e){this.Index,this.Name=e,this.Script=null,this.ClassName="BaseIndex",this.OverlayIndex=null,this.GetEventCallback,this.Status=0,this.Guid=Re(),this.Create=function(a,r){},this.NotSupport=function(a,r,t){var n=this.IsOverlay();if(!n){a.DeleteIndexPaint(r);var s=a.Frame.SubFrame[r].Frame,o=new Od;o.Canvas=a.Canvas,o.ChartBorder=s.ChartBorder,o.ChartFrame=s,o.NotSupportMessage=t,a.ChartPaint.push(o)}},this.FormatIndexTitle=function(){var a=this.Name,r=null;for(var t in this.Index){var n=this.Index[t];n.Param!=null&&(r?r+=","+n.Param.toString():r=n.Param.toString())}return r&&(a+="("+r+")"),a},this.IsOverlay=function(){return!(!this.OverlayIndex||this.OverlayIndex.IsOverlay!=!0)},this.CreateChart=function(a){return new va},this.CreatePaints=function(a,r){var t=null,n=this.IsOverlay();n?(t=this.OverlayIndex.Frame.Frame,this.OverlayIndex.Frame.ChartPaint=[]):(t=a.Frame.SubFrame[r].Frame,a.DeleteIndexPaint(r));var s=[];for(var o in this.Index){var l=this.CreateChart(o);l.Color=this.Index[o].LineColor,l.Canvas=a.Canvas,l.Name=this.Name+"-"+o.toString(),l.ChartBorder=t.ChartBorder,l.ChartFrame=t,n?this.OverlayIndex.Frame.ChartPaint.push(l):a.ChartPaint.push(l),s.push(l)}return s},this.SendEvent=function(a,r,t,n){if(a.GetIndexEvent){var s=a.GetIndexEvent();if(s){var o={Data:this.GetOutData(),WindowIndex:r,Name:this.Name,HistoryData:t,Stock:{Symbol:a.Symbol,Name:a.Name}};n&&(o.Error=n),s.Callback(s,o,self)}}},this.GetOutData=function(){return null}}function Nm(){this.newMethod=Ls,this.newMethod("OX"),delete this.newMethod,this.ClassName="JSIndex_OX",this.IsUsePageData=!0,this.BlockSize=.5,this.Arguments=[{Name:"Reversal",Value:3}],this.SetArgs=function(e){if(!(!e||!v.IsNonEmptyArray(e)))for(var a=0;a<e.length;++a){var r=e[a];r.Name=="Reversal"&&this.SetParamValue(r.Name,r.Value)}},this.SetParamValue=function(e,a){for(var r=0;r<this.Arguments.length;++r){var t=this.Arguments[r];t.Name==e&&(t.Value=a)}},this.GetParamValue=function(e){for(var a=0;a<this.Arguments.length;++a){var r=this.Arguments[a];if(r.Name==e)return r.Value}},this.RequestData=function(e,a,r){return this.BindData(e,a,r),e.UpdataDataoffset(),e.UpdateFrameMaxMin(),e.Draw(),!0},this.CreatePaints=function(e,a){var r=null,t=this.IsOverlay();t?(r=this.OverlayIndex.Frame.Frame,this.OverlayIndex.Frame.ChartPaint=[]):(r=e.Frame.SubFrame[a].Frame,e.DeleteIndexPaint(a));var n=[],s=new Jd;return s.Canvas=e.Canvas,s.Name=this.Name+"-0",s.ChartBorder=r.ChartBorder,s.ChartFrame=r,t?this.OverlayIndex.Frame.ChartPaint.push(s):e.ChartPaint.push(s),n.push(s),n},this.CalculateBlockSize=function(e,a){var r=e-a;return r<=5?.25:r<=20?.5:r<=100?1:r<=200?2:r<=500?5:r<=1e3?10:50},this.Calculate=function(e,a){if(!e.ChartPaint[0])return null;var r=e.ChartPaint[0].ShowRange;if(!r||!v.IsNonEmptyArray(a.Data))return null;for(var t=null,n=null,s=null,o=r.Start;o<=r.End&&o<a.Data.length;++o){var l=a.Data[o];t==null?v.IsNumber(l.High)&&(t=l.High):v.IsNumber(l.High)&&t<l.High&&(t=l.High),n==null?v.IsNumber(l.Low)&&(n=l.Low):v.IsNumber(l.Low)&&n>l.Low&&(n=l.Low),s==null&&v.IsNumber(l.High)&&(s=l.High)}var h=this.GetParamValue("Reversal"),u=this.CalculateBlockSize(t,n);this.BlockSize=u;for(var f={Max:t+u,Min:n-u,StartPrice:s,Data:[],BlockSize:u},C=1,D=s,c={Type:0,Data:[],Start:null,End:null},o=r.Start,T=0;o<=r.End&&o<a.Data.length;++o){var l=a.Data[o];if(C==1){if(l.High>=D+u){var S=parseInt((l.High-D)/u);for(T=0;T<S;++T)D+=u,c.Data.push(D)}else if(l.Low<=D-u*h){C=0,c&&v.IsNonEmptyArray(c.Data)&&f.Data.push(c),c={Type:1,Data:[],Start:null,End:null};var S=parseInt((D-l.Low)/u);for(T=0;T<S;++T)D-=u,c.Data.push(D)}}else if(l.Low<=D-u){var S=parseInt((D-l.Low)/u);for(T=0;T<S;++T)D-=u,c.Data.push(D)}else if(l.High>=D+u*h){C=1,c&&v.IsNonEmptyArray(c.Data)&&f.Data.push(c),c={Type:0,Data:[],Start:null,End:null};var S=parseInt((l.High-D)/u);for(T=0;T<S;++T)D+=u,c.Data.push(D)}c.Start==null&&(c.Start=l),c.End=l}return c&&v.IsNonEmptyArray(c.Data)&&f.Data.push(c),f},this.BindData=function(e,a,r){var t=this.CreatePaints(e,a),n=this.IsOverlay(),s=e.GetEventCallback($.ON_CALCULATE_INDEX_OX);if(s&&s.Callback){var o={HQChart:e,WidnowIndex:a,HisData:r,OXData:null};s.Callback(s,o,this),t[0].OXData=o.OXData}else t[0].OXData=this.Calculate(e,r);var l=this.BlockSize,h=this.GetParamValue("Reversal"),u=this.Name+" BlockSize="+l+" Reversal="+h,f=a+1;if(n){var C=e.TitlePaint[f],D={Data:[],Title:""};C.OverlayIndex.set(this.OverlayIndex.Identify,D)}else e.TitlePaint[f].Title=u;return!0}}function Am(e){this.newMethod=Ls,this.newMethod("VRVR"),delete this.newMethod,this.ClassName="VolProfileVisibleRangeIndex",this.IsUsePageData=!0,this.ChartVolProfile,this.HQChart,this.WindowIndex,this.RequestTimer=null,this.DelayRequestFrequency=500,this.VolType=0,this.BarPosition=1,this.BarWidthRate=.3,this.Arguments=[{Name:"VAVol",Value:70},{Name:"BarPosition",Value:0}],this.SetArgs=function(a){if(!(!a||!v.IsNonEmptyArray(a)))for(var r=0;r<a.length;++r){var t=a[r];t.Name=="VAVol"?this.SetParamValue(t.Name,t.Value):t.Name=="BarPosition"&&this.SetParamValue(t.Name,t.Value)}},this.SetParamValue=function(a,r){for(var t=0;t<this.Arguments.length;++t){var n=this.Arguments[t];n.Name==a&&(n.Value=r)}},e&&(v.IsNumber(e.VolType)&&(this.VolType=e.VolType),v.IsNumber(e.BarWidthRate)&&(this.BarWidthRate=e.BarWidthRate),v.IsNumber(e.DelayRequestFrequency)&&(this.DelayRequestFrequency=e.DelayRequestFrequency),e.Args&&this.SetArgs(e.Args),v.IsNumber(e.BarPosition)&&(this.BarPosition=e.BarPosition,this.SetParamValue("BarPosition",this.BarPosition))),this.GetParamValue=function(a){for(var r=0;r<this.Arguments.length;++r){var t=this.Arguments[r];if(t.Name==a)return t.Value}},this.Create=function(a,r){this.HQChart=a,this.WindowIndex=r},this.CreateChart=function(a,r){var t=null,n=this.IsOverlay();n?(t=this.OverlayIndex.Frame.Frame,this.OverlayIndex.Frame.ChartPaint=[]):(t=a.Frame.SubFrame[r].Frame,a.DeleteIndexPaint(r));var s=[],o=new Zd;return o.Canvas=a.Canvas,o.Name=this.Name+"-0",o.ChartBorder=t.ChartBorder,o.ChartFrame=t,o.HQChart=this.HQChart,o.Identify=this.Guid,o.SetOption(this),n?this.OverlayIndex.Frame.ChartPaint.push(o):a.ChartPaint.push(o),s.push(o),this.ChartVolProfile=o,s},this.CancelRequestTimer=function(){this.RequestTimer&&(clearTimeout(this.RequestTimer),this.RequestTimer=null)},this.RequestData=function(a,r,t,n){var s=this;this.CancelRequestTimer();var o=function(){var h=a.ChartPaint[0],u=h.Data;if(!(!u||v.IsNonEmptyArray(!u.Data))){var f=h.DrawKRange;if(!(!f||!v.IsNumber(f.Start)||!v.IsNumber(f.End))){var C=u.Data[f.Start],D=u.Data[f.End],c={Start:{Date:C.Date,DataIndex:f.Start},End:{Date:D.Date,DataIndex:f.End},Chart:s};v.IsNumber(C.Time)&&(c.Start.Time=C.Time),v.IsNumber(D.Time)&&(c.End.Time=D.Time),c.ValueAreaVol=s.Arguments[0].Value,s.Arguments[1].Value>0?s.BarPosition=1:s.BarPosition=0,s.ChartVolProfile&&s.ChartVolProfile.SetOption({BarPosition:s.BarPosition}),s.DataStatus=0,a&&a.RequestVolumeProfileData&&a.RequestVolumeProfileData(c)}}};return n&&n.Type==1?this.RequestTimer=setTimeout(function(){o()},this.DelayRequestFrequency):o(),!0},this.OnRecvVolumeProfileData=function(a){return this.BindData(a),this.HQChart.UpdataDataoffset(),this.HQChart.UpdateFrameMaxMin(),this.HQChart.Draw(),!0},this.BindData=function(a){(!this.ChartVolProfile||this.ChartVolProfile.IsDestroy==!0)&&this.CreateChart(this.HQChart,this.WindowIndex);var r=this.ChartVolProfile;if(r.Data=null,!(!a||!v.IsNonEmptyArray(a.Data))&&!(!v.IsNumber(a.MaxPrice)||!v.IsNumber(a.MinPrice))){for(var t=0,n=0,s=null,o=0,l=0;o<a.Data.length;++o){var h=a.Data[o];for(n=0,l=0;l<h.Vol.length;++l){var u=h.Vol[l];v.IsNumber(u.Value)&&(n+=u.Value)}t<n&&(t=n,s=h.Price)}if(!(this.maxVolPrice<=0||this.maxVol<=0)){r.MaxVolPrice=s,r.MaxVol=t,r.MaxPrice=a.MaxPrice,r.MinPrice=a.MinPrice,r.Data=a;var f=this.WindowIndex+1;this.HQChart.TitlePaint[f].Title="VPVR",this.HQChart.TitlePaint[f].Identify=this.Guid;var C=new re(r.Data,"VPVR",r.Data);C.ChartClassName="ChartVolProfileVisibleRange",C.Chart=r,this.HQChart.TitlePaint[f].Data[0]=C}}}}function ym(){this.newMethod=Ls,this.newMethod("CJL"),delete this.newMethod,this.Index=new Array(new Sf("VOL",null),new Sf("OPID",null)),this.Index[0].LineColor=d.Index.LineColor[0],this.Index[1].LineColor=d.Index.LineColor[1],this.CreateChart=function(e){if(e==0){var a=new el;return a}else if(e==1){var a=new BC;return a.LineWidth=1*B(),a}},this.RequestData=function(e,a,r){return this.BindData(e,a,r),e.UpdataDataoffset(),e.UpdateFrameMaxMin(),e.Draw(),!0},this.BindData=function(e,a,r){var t=this.CreatePaints(e,a),n=this.IsOverlay();if(t.length!=this.Index.length)return!1;var s=r.GetVol(),o=r.GetPosition();t[0].HistoryData=r,t[0].Data.Data=s,t[1].Data.Data=o;var l=a+1;if(n){var h=e.TitlePaint[l],u={Data:[],Title:""};h.OverlayIndex.set(this.OverlayIndex.Identify,u);for(var f in t){var C=new re(t[f].Data,this.Index[f].Name,this.Index[f].LineColor);h.OverlayIndex.get(this.OverlayIndex.Identify).Data[f]=C}}else e.TitlePaint[l].Data[0]=new re(t[0].Data,this.Index[0].Name,this.Index[0].LineColor),e.TitlePaint[l].Data[1]=new re(t[1].Data,this.Index[1].Name,this.Index[1].LineColor),e.TitlePaint[l].Title=this.Name;return!0}}function fl(e,a,r,t){this.newMethod=Ls,this.newMethod(e),delete this.newMethod,this.Script=a,this.Arguments=[],this.OutVar=[],this.ApiUrl=d.PyIndexDomain+"/hq/code",r&&(this.Arguments=r),this.RequestData=function(n,s,o){this.OutVar=[];var l=this,h={HQChart:n,WindowIndex:s,HistoryData:o},u="";for(var f in this.Arguments){u.length>0&&(u+=",");var C=this.Arguments[f];u+='"'+C.Name+'":'+C.Value}u="{"+u+"}";var D=JSON.parse(u),c=(0,Aa.default)({code:this.Script,symbol:h.HQChart.Symbol,period:h.HQChart.Period,right:h.HQChart.Right,params:D,numcount:n.MaxRequestDataCount});return Vt.HttpRequest({url:this.ApiUrl,data:c,type:"post",dataType:"json",contentType:" application/json; charset=utf-8",async:!0,success:function(S){l.RecvData(S,h)},complete:function(S){},error:function(S,I){l.RecvError(S,I,h)}}),!0},this.RecvError=function(n,s,o){k.Chart.Log("[PyScriptIndex::RecvError] error",s),o.HQChart.ScriptErrorCallback&&o.HQChart.ScriptErrorCallback(s)},this.RecvData=function(n,s){if(n.code!=0){k.Chart.Log("[PyScriptIndex::RecvData] failed.",n),s.HQChart.ScriptErrorCallback&&s.HQChart.ScriptErrorCallback(n.msg);return}k.Chart.Log("[PyScriptIndex::RecvData] recv data.",n);var o=n.date;for(var l in n.data){for(var h=n.data[l],u=[],f=0;f<o.length&&f<o.length;++f)if(!(f>=h.data.length)){var C=new Wt;C.Date=o[f],C.Value=h.data[f],u.push(C)}var D=s.HistoryData.GetFittingData(u),c=new Y;c.Data=D,c.Period=s.HQChart.Period,c.Right=s.HQChart.Right;var T={Name:h.name,Type:h.graph,LineWidth:h.width,Data:c.GetValue(),Color:h.color};this.OutVar.push(T)}this.BindData(s.HQChart,s.WindowIndex,s.HistoryData),s.HQChart.UpdataDataoffset(),s.HQChart.UpdateFrameMaxMin(),s.HQChart.Draw()},this.BindData=function(n,s,o){n.DeleteIndexPaint(s);for(var l in this.OutVar){var h=this.OutVar[l];switch(h.Type){case"line":this.CreateLine(n,s,h,l);break;case"colorstick":this.CreateColorStock(n,s,h,l);break}}var u=s+1;n.TitlePaint[u].Title=this.Name;var f="";for(var C in this.Arguments){var D=this.Arguments[C];f.length>0&&(f+=","),f+=D.Value.toString()}return f.length>0&&(n.TitlePaint[u].Title=this.Name+"("+f+")"),!0},this.CreateLine=function(n,s,o,l){var h=new va;h.Canvas=n.Canvas,h.DrawType=1,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Color?h.Color=o.Color:h.Color=this.GetDefaultColor(l),o.LineWidth>0&&(h.LineWidth=o.LineWidth),o.IsShow==!1&&(h.IsShow=!1);var u=s+1;h.Data.Data=o.Data,n.TitlePaint[u].Data[l]=new re(h.Data,o.Name,h.Color),n.ChartPaint.push(h)},this.CreateColorStock=function(n,s,o,l){var h=new il;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame;var u=s+1;h.Data.Data=o.Data,n.TitlePaint[u].Data[l]=new re(h.Data,o.Name,this.GetDefaultColor(l)),n.ChartPaint.push(h)},this.GetDefaultColor=function(n){var s=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],o=parseInt(n);return s[o%(s.length-1)]}}function Om(e,a,r,t){this.newMethod=fl,this.newMethod(e),delete this.newMethod,this.JsonData,t.JsonData&&(this.JsonData=t.JsonData),this.RequestData=function(n,s,o){if(!this.JsonData)console.warn("[PyScriptIndex::RequestData] JsonData is null"),l.HQChart.ScriptErrorCallback&&l.HQChart.ScriptErrorCallback("json 数据不能为空");else{var l={HQChart:n,WindowIndex:s,HistoryData:o};this.JsonData.code=0;var h=this.JsonData;this.RecvData(h,l)}}}fl.prototype.GetDefaultColor=function(e){var a=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],r=parseInt(e);return a[r%(a.length-1)]};function _a(){}_a.Get=function(e){var a=new Dt.default([["互动易",{Create:function(){return new Pm}}],["公告",{Create:function(){return new Bm}}],["业绩预告",{Create:function(){return new bm}}],["调研",{Create:function(){return new wm}}],["大宗交易",{Create:function(){return new Gm}}],["龙虎榜",{Create:function(){return new _m}}]]);return a.get(e)};_a.GetClassInfo=function(e){var a=new Dt.default([["互动易",{ClassName:"InvestorInfo"}],["公告",{ClassName:"AnnouncementInfo"}],["业绩预告",{ClassName:"PforecastInfo"}],["调研",{ClassName:"ResearchInfo"}],["大宗交易",{ClassName:"BlockTrading"}],["龙虎榜",{ClassName:"TradeDetail"}]]);return a.get(e)};_a.GetIconUrl=function(e){switch(e){case ee.INVESTOR:return d.KLine.Info.Investor.Icon;case ee.PFORECAST:return d.KLine.Info.Pforecast.Icon;case ee.ANNOUNCEMENT:return d.KLine.Info.Announcement.Icon;case ee.ANNOUNCEMENT_QUARTER_1:case ee.ANNOUNCEMENT_QUARTER_2:case ee.ANNOUNCEMENT_QUARTER_3:case ee.ANNOUNCEMENT_QUARTER_4:return d.KLine.Info.Announcement.IconQuarter;case ee.RESEARCH:return d.KLine.Info.Research.Icon;case ee.BLOCKTRADING:return d.KLine.Info.BlockTrading.Icon;case ee.TRADEDETAIL:return d.KLine.Info.TradeDetail.Icon;default:return d.KLine.Info.Announcement.Icon}};_a.GetIconLibrary=function(e){var a=d.KLine.Info.IconLibrary;if(!a||!a.Icon)return d.KLine.Info.Announcement.IconFont;if(e>=0&&e<a.Icon.length){var r=a.Icon[e],t={Text:r.Text,HScreenText:r.HScreenText,Color:r.Color,Family:a.Family};return t}return d.KLine.Info.Announcement.IconFont};_a.GetIconFont=function(e){if(e>=ee.ANNOUNCEMENT_EX_START&&e<=ee.ANNOUNCEMENT_EX_END){var a=e-ee.ANNOUNCEMENT_EX_START;return _a.GetIconLibrary(a)}switch(e){case ee.INVESTOR:return d.KLine.Info.Investor.IconFont;case ee.PFORECAST:return d.KLine.Info.Pforecast.IconFont;case ee.ANNOUNCEMENT:return d.KLine.Info.Announcement.IconFont;case ee.ANNOUNCEMENT_QUARTER_1:case ee.ANNOUNCEMENT_QUARTER_2:case ee.ANNOUNCEMENT_QUARTER_3:case ee.ANNOUNCEMENT_QUARTER_4:return d.KLine.Info.Announcement.IconFont2;case ee.RESEARCH:return d.KLine.Info.Research.IconFont;case ee.BLOCKTRADING:return d.KLine.Info.BlockTrading.IconFont;case ee.TRADEDETAIL:return d.KLine.Info.TradeDetail.IconFont;default:return d.KLine.Info.Announcement.IconFont}};function kr(){this.MaxRequestDataCount=1e3,this.StartDate=20160101,this.Data,this.ClassName="IKLineInfo",this.Explain="IKLineInfo",this.GetToday=function(){var e=new Date,a=e.getFullYear()*1e4+(e.getMonth()+1)*100+e.getDate();return a},this.GetRequestData=function(e){var a={Symbol:e.Symbol,MaxRequestDataCount:e.MaxRequestDataCount,MaxRequestMinuteDayCount:e.MaxRequestMinuteDayCount,Period:e.Period},r=null;return e.ChartOperator_Temp_GetHistroyData&&(r=e.ChartOperator_Temp_GetHistroyData()),r&&(a.DateRange=r.GetDateRange()),a},this.NetworkFilter=function(e,a){if(!e.NetworkFilter)return!1;var r=this,t={HQChart:e},n={Name:this.ClassName+"::RequestData",Explain:this.Explain,Request:this.GetRequestData(e),Self:this,HQChart:e,PreventDefault:!1};return a&&(a.Update==!0&&(n.Update={Start:{Date:a.StartDate}},t.Update={Start:{Date:a.StartDate}}),n.CallFunctionName=a.FunctionName),e.NetworkFilter(n,function(s){r.RecvData(s,t)}),n.PreventDefault==!0}}function Pm(){this.newMethod=kr,this.newMethod(),delete this.newMethod,this.ClassName="InvestorInfo",this.Explain="互动易",this.RequestData=function(e,a){var r=this,t={HQChart:e};if(this.Data=[],!this.NetworkFilter(e,a)){var n={filed:["question","answerdate","symbol","id"],symbol:[t.HQChart.Symbol],querydate:{StartDate:this.StartDate,EndDate:this.GetToday()},start:0,end:this.MaxRequestDataCount},s=d.Domain+d.KLine.Info.Investor.ApiUrl;return Vt.HttpRequest({url:s,data:n,type:"post",dataType:"json",async:!0,success:function(l){r.RecvData(l,t)}}),!0}},this.RecvData=function(e,a){if(!(e.list.length<=0)){for(var r in e.list){var t=e.list[r],n=new Xr;n.Date=t.answerdate,n.Title=t.question,n.InfoType=ee.INVESTOR,this.Data.push(n)}a.HQChart.UpdataChartInfo(),a.HQChart.Draw()}}}function Bm(){this.newMethod=kr,this.newMethod(),delete this.newMethod,this.ClassName="AnnouncementInfo",this.Explain="公告",this.ApiType=1,this.RequestData=function(e,a){var r=this,t={HQChart:e};if(a&&a.Update===!0||(this.Data=[]),!this.NetworkFilter(e,a))if(this.ApiType==1){var n=d.CacheDomain+"/cache/analyze/shszreportlist/"+t.HQChart.Symbol+".json";Vt.HttpRequest({url:n,type:"get",dataType:"json",async:!0,success:function(o){r.RecvData(o,t)},error:function(o,l){r.RecvError(o,l,t)}})}else{var n=d.Domain+d.KLine.Info.Announcement.ApiUrl;Vt.HttpRequest({url:n,data:{filed:["title","releasedate","symbol","id"],symbol:[t.HQChart.Symbol],querydate:{StartDate:this.StartDate,EndDate:this.GetToday()},start:0,end:this.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(l){r.RecvData(l,t)},error:function(l,h){r.RecvError(l,h,t)}})}},this.RecvData=function(e,a){if(v.IsNonEmptyArray(e.report)){for(var r=[],t=0;t<e.report.length;++t){var n=e.report[t],s=new Xr;s.Date=n.releasedate,s.Title=n.title,s.InfoType=ee.ANNOUNCEMENT,v.IsNumber(n.time)&&(s.Time=n.time);for(var o in n.type){var l=n.type[o];switch(l){case"一季度报告":s.InfoType=ee.ANNOUNCEMENT_QUARTER_1;break;case"半年度报告":s.InfoType=ee.ANNOUNCEMENT_QUARTER_2;break;case"三季度报告":s.InfoType=ee.ANNOUNCEMENT_QUARTER_3;break;case"年度报告":s.InfoType=ee.ANNOUNCEMENT_QUARTER_4;break}}for(var o in n.typeex){var h=n.typeex[o];s.InfoType=ee.ANNOUNCEMENT_EX_START+h;break}r.push(s)}e.Update===!0&&this.Data.length>0?this.UpdateData(r):this.Data=r,a.HQChart.UpdataChartInfo(),a.HQChart.Draw()}},this.UpdateData=function(e){if(!(!e||e.length<=0)){var a=new Fe.default;for(var r in this.Data){var t=this.Data[r],n=t.Date+"-"+t.Time+"-"+t.InfoType+"-"+t.Title;a.add(n)}var s=0;for(var r in e){var t=e[r],n=t.Date+"-"+t.Time+"-"+t.InfoType+"-"+t.Title;a.has(n)||(this.Data.push(t),++s)}k.Chart.Log("[AnnouncementInfo::UpdateData] add new count="+s)}},this.RecvError=function(e,a,r){console.warn("[AnnouncementInfo::RecvError] error, http ",a,e)}}function bm(){this.newMethod=kr,this.newMethod(),delete this.newMethod,this.ClassName="PforecastInfo",this.Explain="业绩预告",this.RequestData=function(e,a){if(this.Data=[],d.Domain+d.KLine.Info.Pforecast.ApiUrl,!this.NetworkFilter(e,a))return console.warn("[PforecastInfo::RequestData] NetworkFilter error."),!0},this.RecvData=function(e,a){if(v.IsNonEmptyArray(e.report)){for(var r=0;r<e.report.length;++r){var t=e.report[r],n=new Xr;n.Date=t.date,n.Title=t.title,n.InfoType=ee.PFORECAST,n.ExtendData={Type:t.title,ReportDate:t.reportdate},t.fweek&&(n.ExtendData.FWeek={},t.fweek.week1!=null&&(n.ExtendData.FWeek.Week1=t.fweek.week1),t.fweek.week4!=null&&(n.ExtendData.FWeek.Week4=t.fweek.week4)),this.Data.push(n)}a.HQChart.UpdataChartInfo(),a.HQChart.Draw()}}}function wm(){this.newMethod=kr,this.newMethod(),delete this.newMethod,this.ClassName="ResearchInfo",this.Explain="调研",this.RequestData=function(e,a){if(this.Data=[],d.Domain+d.KLine.Info.Research.ApiUrl,!this.NetworkFilter(e,a))return console.warn("[ResearchInfo::RequestData] NetworkFilter error."),!0},this.RecvData=function(e,a){if(v.IsNonEmptyArray(e.list)){for(var r=0;r<e.list.length;++r){var t=e.list[r],n=new Xr;n.ID=t.id,n.Date=t.researchdate,n.InfoType=ee.RESEARCH,n.ExtendData={Level:t.level,Type:t.type},this.Data.push(n)}a.HQChart.UpdataChartInfo(),a.HQChart.Draw()}}}function Gm(){this.newMethod=kr,this.newMethod(),delete this.newMethod,this.ClassName="BlockTrading",this.Explain="大宗交易",this.RequestData=function(e,a){var r=this,t={HQChart:e};this.Data=[];var n=d.Domain+d.KLine.Info.BlockTrading.ApiUrl;if(!this.NetworkFilter(e,a))return Vt.HttpRequest({url:n,data:{field:["blocktrading.price","blocktrading.vol","blocktrading.premium","fweek","price"],condition:[{item:["date","int32","gte",this.StartDate]},{item:["blocktrading.vol","int32","gte","0"]}],symbol:[t.HQChart.Symbol],start:0,end:this.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(o){r.RecvData(o,t)}}),!0},this.RecvData=function(e,a){if(e.stock.length==1&&!(e.stock[0].stockday.length<=0)){for(var r in e.stock[0].stockday){var t=e.stock[0].stockday[r],n=new Xr;n.Date=t.date,n.InfoType=ee.BLOCKTRADING,n.ExtendData={Price:t.blocktrading.price,Premium:t.blocktrading.premium,Vol:t.blocktrading.vol,ClosePrice:t.price},t.fweek&&(n.ExtendData.FWeek={},t.fweek.week1!=null&&(n.ExtendData.FWeek.Week1=t.fweek.week1),t.fweek.week4!=null&&(n.ExtendData.FWeek.Week4=t.fweek.week4)),this.Data.push(n)}a.HQChart.UpdataChartInfo(),a.HQChart.Draw()}}}function _m(){this.newMethod=kr,this.newMethod(),delete this.newMethod,this.ClassName="TradeDetail",this.Explain="大宗交易",this.RequestData=function(e,a){var r=this,t={HQChart:e};this.Data=[];var n=d.Domain+d.KLine.Info.TradeDetail.ApiUrl;if(!this.NetworkFilter(e,a))return Vt.HttpRequest({url:n,data:{field:["tradedetail.typeexplain","tradedetail.type","fweek"],condition:[{item:["date","int32","gte",this.StartDate]},{item:["tradedetail.type","int32","gte","0"]}],symbol:[t.HQChart.Symbol],start:0,end:this.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(o){r.RecvData(o,t)}}),!0},this.RecvData=function(e,a){if(e.stock.length==1&&!(e.stock[0].stockday.length<=0)){for(var r in e.stock[0].stockday){var t=e.stock[0].stockday[r],n=new Xr;n.Date=t.date,n.InfoType=ee.TRADEDETAIL,n.ExtendData={Detail:new Array};for(var s in t.tradedetail){var o=t.tradedetail[s];n.ExtendData.Detail.push({Type:o.type,TypeExplain:o.typeexplain})}t.fweek&&(n.ExtendData.FWeek={},t.fweek.week1!=null&&(n.ExtendData.FWeek.Week1=t.fweek.week1),t.fweek.week4!=null&&(n.ExtendData.FWeek.Week4=t.fweek.week4)),this.Data.push(n)}a.HQChart.UpdataChartInfo(),a.HQChart.Draw()}}}function vn(){}vn.InfoMap=new Dt.default([["大盘异动",{Create:function(){return new Vm}}]]);vn.Get=function(e){return vn.InfoMap.get(e)};function Hm(){this.Data,this.ClassName="IMinuteInfo"}function Vm(){this.newMethod=Hm,this.newMethod(),delete this.newMethod,this.ClassName="MarketEventInfo",this.RequestData=function(e){var a=this;this.Data=[];var r={HQChart:e},t=d.CacheDomain+"/cache/analyze/shszevent/marketevent/concept/"+e.TradeDate+".json";if(e.NetworkFilter){var n={Name:"MarketEventInfo::RequestData",Explain:"大盘异动",Request:{Url:t,Type:"Get",Data:{Date:e.TradeDate,Symbol:e.Symbol}},Self:this,PreventDefault:!1};if(e.NetworkFilter(n,function(s){a.RecvData(s,r),r.HQChart.UpdataChartInfo(),r.HQChart.Draw()}),n.PreventDefault==!0)return}return Vt.HttpRequest({url:t,type:"get",dataType:"json",async:!0,success:function(o){a.RecvData(o,r)},error:function(o,l){console.warn("[MarketEventInfo::RequestData] error, http ",l,o)}}),!0},this.RecvData=function(e,a){for(var r in e.event){var t=e.event[r];for(var n in t.data){var s=t.data[n];if(Array.isArray(s)){if(s.length<2)continue;var o={Date:t.date,Time:s[0],Title:s[1],Type:0};s.length>=3&&s[2]&&typeof s[2]=="string"&&(o.Color=s[2]),s.length>=4&&s[3]&&typeof s[3]=="string"&&(o.BGColor=s[3]),this.Data.push(o)}else{if(!v.IsNumber(s.Date)||!v.IsNumber(s.Time)||!s.Title)continue;var o={Date:s.Date,Time:s.Time,Title:s.Title,Type:0};s.Color&&(o.Color=s.Color),s.BGColor&&(o.BGColor=s.BGColor),v.IsNumber(s.Price)&&(o.Price=s.Price),s.Content&&(o.Content=s.Content),s.Link&&(o.Link=s.Link),this.Data.push(o)}}}a.HQChart.UpdataChartInfo(),a.HQChart.Draw()}}function Ym(){this.DataMap=new Dt.default([["ChartPictureSettingMenu",{Create:function(a){return new Xm(a)}}],["ChartPictureTextSettingMenu",{Create:function(a){return new Dl(a)}}]]),this.Create=function(e,a){if(!this.DataMap.has(e))return k.Warn("[DialogFactory::Create] can't find class="+e+"."),null;var r=this.DataMap.get(e);return r.Create(a)},this.Add=function(e,a){this.DataMap.set(e,{Create:a.Create})}}var ED=new Ym;function Cl(e){this.DivElement=e,this.ID=null,this.TimeOut=null,this.Hide=function(){(0,yt.default)("#"+this.ID).hide()},this.Show=function(a,r,t,n){var s={display:"block"};v.IsNumber(a)&&(s.left=a+"px"),v.IsNumber(r)&&(s.top=r+"px"),v.IsNumber(t)&&(s.width=t+"px"),v.IsNumber(n)&&(s.height=n+"px"),(0,yt.default)("#"+this.ID).css(s)}}function Xm(e){this.newMethod=Cl,this.newMethod(e),delete this.newMethod,this.HQChart,this.ChartPicture,this.SubToolsDiv,this.SettingMenu,this.SettingPV,this.DoModal=function(a){if(!this.SubToolsDiv){this.ID=Re();var r=document.createElement("div");r.className="subTolls",r.id=this.ID,this.DivElement.appendChild(r),this.SubToolsDiv=r}this.HQChart=a.data.HQChart,this.ChartPicture=a.data.ChartPicture;var t=B(),n=this.HQChart.Frame.SubFrame[0].Frame,s=n.ChartBorder.Top+40,o=n.ChartBorder.Right,l=n.ChartBorder.GetLeft(),h=this.ChartPicture.ClassName,u=this.ChartPicture.LineColor;(u.indexOf("rgb(")==0||u.indexOf("RGB(")==0)&&(u=gt.RGBToHex(u.toLowerCase()));var f="";h==="ChartDrawPictureText"?f='<span class="changes-color" title="改变图形颜色"><i class="iconfont icon-bianji"></i><input type="color" name="color" id="color" class="change-color" value="'+u+`"></span>
<span class="subtool-set" title="设置"><i class="iconfont icon-shezhi"></i></span><span class="subtool-del"><i class="iconfont icon-recycle_bin"></i></span>`:h=="ChartDrawVolProfile"?f='<span class="vp-set" title="设置"><i class="iconfont icon-shezhi"></i></span><span class="subtool-del"><i class="iconfont icon-recycle_bin"></i></span>':f='<p class="changes-color" title="改变图形颜色"><i class="iconfont icon-bianji"></i><input type="color" name="color" id="color" class="change-color" value="'+u+`"></p>
        <p class="subtool-del"><i class="iconfont icon-recycle_bin"></i></p>`,this.SubToolsDiv.style.right=o/t+"px",this.SubToolsDiv.style.top=s/t+"px",this.SubToolsDiv.innerHTML=f,this.SubToolsDiv.style.position="absolute",this.SubToolsDiv.style.display="block";var C=this.HQChart,D=this.ChartPicture;this.SubToolsDiv,(0,yt.default)(".subtool-del").click(function(){C.SelectChartDrawPicture=null,C.ClearChartDrawPicture(D),(0,yt.default)(".subTolls").css("display","none")});var c=this;(0,yt.default)(".subtool-set").click(function(){(0,yt.default)(c.SubToolsDiv).hide(),c.SettingMenu||(c.SettingMenu=new Dl(n.ChartBorder.UIElement.parentNode)),c.SettingMenu.ChartPicture=D,c.SettingMenu.HQChart=C,c.SettingMenu.Position={Left:o+80,Top:s+20},c.SettingMenu.DoModal()}),(0,yt.default)(".changes-color").click(function(){document.getElementById("color").click(),(0,yt.default)(".change-color").change(function(){var T=(0,yt.default)(".change-color").val();D.LineColor=T,D.PointColor=T,C.ChartDrawStorage&&C.ChartDrawStorage.SaveDrawData(D)})}),(0,yt.default)(".vp-set").click(function(){c.SettingPV||(c.SettingPV=new km(n.ChartBorder.UIElement.parentNode)),c.SettingPV.ChartPicture=D,c.SettingPV.HQChart=C,c.SettingPV.Position={Left:o+80,Top:s+20},c.SettingPV.DoModal()}),k.Chart.Log("[ChartPictureSettingMenu::DoModal]",{Top:s,Left:l,Right:o})}}function Dl(e){this.newMethod=Cl,this.newMethod(e),delete this.newMethod,this.ChartPicture,this.SettingDiv,this.Position,this.BackupData,this.Close=function(){this.SettingDiv&&this.DivElement.removeChild(this.SettingDiv)},this.DoModal=function(){var E=this.ChartPicture.Text,a=this.ChartPicture.FontOption,r=this.ChartPicture.LineColor;this.BackupData={Text:E,LineColor:r,FontOption:{Family:a.Family,Size:a.Size,Weight:a.Weight,Style:a.Style}},k.Chart.Log("[ChartPictureTextSettingMenu::DoModal] picture info",this.BackupData);var t=this,n=this.DivElement.getElementsByClassName("chartpicture-text-setting")[0];n?this.SettingDiv=n:(n=document.createElement("div"),n.className="chartpicture-text-setting",this.DivElement.appendChild(n),this.SettingDiv=n);var s='<div class="titleWrap"><span class="titleName">样式设置</span><i class="closeBtn iconfont icon-close"></i></div>',o=[10,11,12,14,16,20,24,28,32,40],l=["微软雅黑","宋体","Arial","仿宋"],h="",u="";l.forEach(function(F,R){u+=R!==0?"<p>"+F+"</P>":'<p class="active">'+F+"</P>"}),o.forEach(function(F,R){h+=R!==5?"<p>"+F+"</P>":'<p class="active">'+F+"</P>"});var f='<div class="contentWrap"><div class="styleOptions"><span class="colorPicker"><input type="color" id="fontColor" value="#1e90ff"></span><div class="likeSelect fontSelect"><span class="choicedText">微软雅黑</span><div class="selectList">'+u+'</div><i class="iconfont icon-xia"></i></div><div class="likeSelect fontSizeSelect"><span class="choicedText">20</span><div class="selectList">'+h+'</div><i class="iconfont icon-xia"></i></div><span class="strongFont likeBtn"><i class="iconfont icon-jiacu"></i></span><span class="italicsFont likeBtn"><i class="iconfont icon-qingxieL"></i></span></div><textarea class="tArea" id="tArea" placeholder="Text"></textarea></div>',C='<div class="btnsContainer"><span class="okBtn btn">确认</span><span class="cancelBtn btn">取消</span></div>',D=B(),c=s+f+C;this.SettingDiv.style.left=this.Position.Left/D+"px",this.SettingDiv.style.top=this.Position.Top/D+"px",this.SettingDiv.innerHTML=c,this.SettingDiv.style.position="absolute",this.SettingDiv.style.display="block",(0,yt.default)(".chartpicture-text-setting .colorPicker").css({borderColor:t.ChartPicture.LineColor,"background-color":t.ChartPicture.LineColor});var T=this.ChartPicture.FontOption.Family;(0,yt.default)(".chartpicture-text-setting .fontSelect .choicedText").html(T),l.forEach(function(F,R){F==T&&((0,yt.default)(".chartpicture-text-setting .fontSelect p").removeClass("active"),(0,yt.default)(".chartpicture-text-setting .fontSelect p").eq(R).addClass("active"))});var S=this.ChartPicture.FontOption.Size;(0,yt.default)(".chartpicture-text-setting .fontSizeSelect .choicedText").html(S),o.forEach(function(F,R){F==S&&((0,yt.default)(".chartpicture-text-setting .fontSizeSelect p").removeClass("active"),(0,yt.default)(".chartpicture-text-setting .fontSizeSelect p").eq(R).addClass("active"))});var I=this.ChartPicture.FontOption.Weight;I!=null&&I=="bold"&&(0,yt.default)(".chartpicture-text-setting .strongFont").addClass("hot");var g=this.ChartPicture.FontOption.Style;g!=null&&g=="italic"&&(0,yt.default)(".chartpicture-text-setting .italicsFont").addClass("hot");var E=this.ChartPicture.Text;(0,yt.default)(".chartpicture-text-setting .tArea").val(E),(0,yt.default)(".chartpicture-text-setting #fontColor").change({Picture:this.ChartPicture},function(F){var R=(0,yt.default)(this).val();(0,yt.default)(this).parent().css({borderColor:R,"background-color":R});var A=F.data.Picture;A.LineColor=R,A.Update&&A.Update()}),(0,yt.default)(".chartpicture-text-setting .fontSelect,.chartpicture-text-setting .fontSizeSelect").click(function(){(0,yt.default)(this).find(".selectList").toggle(),(0,yt.default)(this).toggleClass("hot")}),(0,yt.default)(".chartpicture-text-setting .fontSelect p").click({Picture:this.ChartPicture},function(F){var R=(0,yt.default)(this).closest(".fontSelect").find(".choicedText").html(),A=F.currentTarget.innerHTML;if(R!==A){(0,yt.default)(this).closest(".fontSelect").find(".choicedText").html(A),(0,yt.default)(this).siblings().removeClass("active"),(0,yt.default)(this).addClass("active");var P=F.data.Picture;P.FontOption.Family=A,P.Update&&P.Update()}}),(0,yt.default)(".chartpicture-text-setting .fontSizeSelect p").click({Picture:this.ChartPicture},function(F){var R=(0,yt.default)(this).closest(".fontSizeSelect").find(".choicedText").html(),A=F.currentTarget.innerHTML;if(R!==A){(0,yt.default)(this).closest(".fontSizeSelect").find(".choicedText").html(A),(0,yt.default)(this).siblings().removeClass("active"),(0,yt.default)(this).addClass("active");var P=F.data.Picture;P.FontOption.Size=Number(A),P.Update&&P.Update()}}),(0,yt.default)(".chartpicture-text-setting .strongFont").click({Picture:this.ChartPicture},function(F){(0,yt.default)(this).toggleClass("hot");var R=(0,yt.default)(this).attr("class");if(R.indexOf("hot")>0){var A=F.data.Picture;A.FontOption.Weight="bold",A.Update&&A.Update()}}),(0,yt.default)(".chartpicture-text-setting .italicsFont").click({Picture:this.ChartPicture},function(F){(0,yt.default)(this).toggleClass("hot");var R=(0,yt.default)(this).attr("class");if(R.indexOf("hot")>0){var A=F.data.Picture;A.FontOption.Style="italic",A.Update&&A.Update()}}),(0,yt.default)(".chartpicture-text-setting .titleWrap .closeBtn,.chartpicture-text-setting .btnsContainer .cancelBtn").click({Picture:this.ChartPicture},function(F){var R=F.data.Picture;R.Text=t.BackupData.Text,R.LineColor=t.BackupData.LineColor,R.FontOption=t.BackupData.FontOption,R.Update&&R.Update(),t.Close()}),(0,yt.default)(".chartpicture-text-setting .tArea").keyup({Picture:this.ChartPicture},function(F){k.Chart.Log('[ChartPictureTextSettingMenu::DoModal] $(".chartpicture-text-setting .tArea").keyup()');var R=(0,yt.default)(this).val(),A=F.data.Picture;A.Text=R,A.Update&&A.Update()}),(0,yt.default)(".chartpicture-text-setting .btnsContainer .okBtn").click(function(){t.Close(),t.HQChart&&t.HQChart.ChartDrawStorage&&t.HQChart.ChartDrawStorage.SaveDrawData(t.ChartPicture)})}}function km(e){this.newMethod=Cl,this.newMethod(e),delete this.newMethod,this.ChartPicture,this.SettingDiv,this.Position,this.ID=Re(),this.Close=function(){this.SettingDiv&&this.DivElement.removeChild(this.SettingDiv)},this.DoModal=function(){var a=this.ChartPicture.VAVol,r=this.ChartPicture.BarPosition,t=this,n=document.getElementById(this.ID);n?this.SettingDiv=n:(n=document.createElement("div"),n.className="jchart-modifyindex-box",n.id=this.ID,this.DivElement.appendChild(n),this.SettingDiv=n),n.innerHTML=`<div class='parameter'>            <div class='parameter-header'>                <span>固定范围成交量分布设置</span>                <strong id='close' class='icon iconfont icon-close'></strong>            </div>            <div class='parameter-content'>
                <input class='row-line' value=`+a+` />VAVol <br>
                <input class='row-line' value=`+r+` />BarPosition
            </div>            <div class='parameter-footer'>                <button class='submit' >确定</button>                <button class='cancel' >取消</button>            </div>        </div>`;var s=B(),o=this.HQChart.Frame.SubFrame[0].Frame,l=o.ChartBorder.Top+40,h=o.ChartBorder.Right;o.ChartBorder.GetLeft(),this.SettingDiv.style.right=h/s+"px",this.SettingDiv.style.top=l/s+"px",this.SettingDiv.style.position="absolute",this.SettingDiv.style.display="block";var u=n.getElementsByClassName("cancel")[0];u.onclick=function(){t.Close()};var f=n.getElementsByClassName("icon iconfont icon-close")[0];f.onclick=function(){t.Close()};var C=n.getElementsByClassName("submit")[0];C.onclick=function(){var D=n.getElementsByClassName("row-line")[0].value;t.ChartPicture.VAVol=parseFloat(D);var D=parseInt(n.getElementsByClassName("row-line")[1].value);t.ChartPicture.BarPosition=D>0?1:0,t.ChartPicture.RequestVolumeProfileData(),t.Close()}}}var U={SH:".SH",SZ:".SZ",SHSZ_C_Index:".CI",BJ:".BJ",SHO:".SHO",SZO:".SZO",HK:".HK",FHK:".FHK",SHFE:".SHF",SHFE2:".SHFE",CFFEX:".CFE",CFFEX2:".CFFEX",CFFEX3:".CF",DCE:".DCE",CZCE:".CZC",GZFE:".GZFE",USA:".USA",FTSE:".FTSE",BIT:".BIT",BIZ:".BIZ",FOREX:".FOREX",NYMEX:".NYMEX",COMEX:".COMEX",NYBOT:".NYBOT",CBOT:".CBOT",LME:".LME",TOCOM:".TOCOM",IPE:".IPE",TW:".TW",JP:".JP",HSX:".HSX",HNX:".HNX",UPCOM:".UPCOM",ET:".ET",IsET:function(a){return a?a.indexOf(this.ET)>0:!1},IsETShowAvPrice:function(a){return!1},IsHSX:function(a){return a?a.indexOf(this.HSX)>0:!1},IsHNX:function(a){return a?a.indexOf(this.HNX)>0:!1},IsUPCOM:function(a){return a?a.indexOf(this.UPCOM)>0:!1},IsNYMEX:function(a){return a?a.indexOf(this.NYMEX)>0:!1},IsCOMEX:function(a){return a?a.indexOf(this.COMEX)>0:!1},IsNYBOT:function(a){return a?a.indexOf(this.NYBOT)>0:!1},IsCBOT:function(a){return a?a.indexOf(this.CBOT)>0:!1},IsLME:function(a){return a?a.indexOf(this.LME)>0:!1},IsTOCOM:function(a){return a?a.indexOf(this.TOCOM)>0:!1},IsIPE:function(a){return a?a.indexOf(this.IPE)>0:!1},IsForeignExchange:function(a){return a?a.indexOf(this.FOREX)>0:!1},IsFTSE:function(a){return a?a.indexOf(this.FTSE)>0:!1},IsFHK:function(a){return a?a.indexOf(this.FHK)>0:!1},IsBIT:function(a){return a?a.indexOf(this.BIT)>0||a.indexOf(this.BIZ)>0:!1},IsUSA:function(a){return a?a.indexOf(this.USA)>0:!1},IsSH:function(a){var r=a.length-this.SH.length,t=a.indexOf(this.SH);return t==r},IsSZ:function(a){var r=a.length-this.SZ.length,t=a.indexOf(this.SZ);return t==r},IsBJ:function(a){var r=a.length-this.BJ.length,t=a.indexOf(this.BJ);return t==r},IsSHSZCustomIndex:function(a){var r=a.length-this.SHSZ_C_Index.length,t=a.indexOf(this.SHSZ_C_Index);return t==r},IsSHO:function(a){if(this.IsSH(a)&&a.length==11&&a[0]=="1")return!0;var r=a.length-this.SHO.length,t=a.indexOf(this.SHO);return t==r},IsSZO:function(a){if(this.IsSZ(a)&&a.length==11&&a[0]=="9")return!0;var r=a.length-this.SZO.length,t=a.indexOf(this.SZO);return t==r},IsHK:function(a){var r=a.length-this.HK.length,t=a.indexOf(this.HK);return t==r},IsTW:function(a){var r=a.length-this.TW.length,t=a.indexOf(this.TW);return t==r},IsJP:function(a){var r=a.length-this.JP.length,t=a.indexOf(this.JP);return t==r},IsSHFE:function(a){return a?a.indexOf(this.SHFE)>0||a.indexOf(this.SHFE2)>0:!1},IsCFFEX:function(a){if(!a)return!1;if(a.indexOf(this.CFFEX)>0||a.indexOf(this.CFFEX2)>0)return!0;var r=a.indexOf(this.CFFEX3);return r>0&&r+this.CFFEX3.length==a.length},IsDCE:function(a){return a?a.indexOf(this.DCE)>0:!1},IsCZCE:function(a){return a?a.indexOf(this.CZCE)>0:!1},IsGZFE:function(a){return a?a.indexOf(this.GZFE)>0:!1},IsChinaFutures:function(a){return this.IsSHO(a)||this.IsSZO(a)||this.IsGZFE(a)||this.IsCFFEX(a)||this.IsCZCE(a)||this.IsDCE(a)||this.IsSHFE(a)},IsFutures:function(a){return a?this.IsChinaFutures(a)||this.IsNYMEX(a)||this.IsCOMEX(a)||this.IsNYBOT(a)||this.IsCBOT(a)||this.IsLME(a)||this.IsTOCOM(a):!1},IsSHSZ:function(a){return this.IsSZ(a)||this.IsSH(a)||this.IsSHSZCustomIndex(a)},IsSHSZFund:function(a){if(!a)return!1;if(this.IsSH(a)){if(a.charAt(0)=="5"&&a.charAt(1)=="1")return!0}else if(this.IsSZ(a)&&a.charAt(0)=="1"&&(a.charAt(1)=="5"||a.charAt(1)=="6"||a.charAt(1)=="7"||a.charAt(1)=="8"))return!0;return!1},IsSHSZIndex:function(a){if(!a)return!1;var r=a.toUpperCase();if(this.IsSH(r)){var t=r.replace(".SH","");if(r.charAt(0)=="0"&&parseInt(t)<=3e3)return!0}else if(this.IsSZ(r)){if(r.charAt(0)=="3"&&r.charAt(1)=="9")return!0}else if(this.IsSHSZCustomIndex(r))return!0;return!1},IsSHSZStockA:function(a){if(!a)return!1;var r=a.toUpperCase();if(this.IsSH(r)){if(r.replace(".SH",""),r.charAt(0)=="6")return!0}else if(this.IsSZ(r)){if(r.charAt(0)=="0"){if(r.charAt(1)=="0"&&r.charAt(2)=="2"||r.charAt(1)!="7"&&r.charAt(1)!="8")return!0}else if(r.charAt(0)=="3"&&r.charAt(1)=="0"&&(r.charAt(2)=="0"||r.charAt(2)=="1"))return!0}return!1},IsBJStock:function(a){if(!a)return!1;var r=a.toUpperCase();if(!this.IsBJ(r))return!1;var t=r.charAt(0);return t=="4"||t=="8"},IsSHStockSTAR:function(a){if(!a)return!1;var r=a.toUpperCase();return this.IsSH(r)?r.charAt(0)=="6"&&r.charAt(1)=="8"&&r.charAt(2)=="8":!1},IsSHGEM:function(a){if(!a)return!1;var r=a.toUpperCase();return this.IsSH(r)?r.charAt(0)=="3"&&r.charAt(1)=="0":!1},GetMarketStatus:function(a){if(!a)return 0;var r=a.toUpperCase(),t=new Date,n=t.getDay(),s=t.getHours()*100+t.getMinutes();if(this.IsUSA(r)){var o=cl(-4),n=o.getDay(),s=o.getHours()*100+o.getMinutes();return n==6||n==0?0:s>1730?3:s<930?1:2}else return this.IsBIT(r)||this.IsForeignExchange(r)?2:this.IsFTSE(r)?n==6||n==0?0:s>=830&&s<=2359||s>=0&&s<=500?2:0:this.IsFHK(r)?n==6||n==0?0:s>=900&&s<=2359||s>=0&&s<=320?2:0:this.IsET(r)?this.GetETMarketStatus(a):this.IsHK(r)?n==6||n==0?0:s>1630?3:s<925?1:2:this.IsTW(r)?n==6||n==0?0:s>1410?3:s<820?1:2:this.IsJP(r)?n==6||n==0?0:s>1520?3:s<830?1:2:this.IsNYMEX(r)?this.GetNYMEXMarketStatus(r):this.IsCOMEX(r)?this.GetCOMEXMarketStatus(r):this.IsNYBOT(r)?this.GetNYBOTMarketStatus(r):this.IsCBOT(r)?this.GetCBOTMarketStatus(r):this.IsLME(r)?this.GetLMEMarketStatus(r):this.IsTOCOM(r)?this.GetTOCOMMarketStatus(r):this.IsChinaFutures(r)?n==6||n==0?0:this.IsCFFEX(r)?s>1540?3:s<910?1:2:s>=2100||s<=240||s>=830&&s<=1510?2:1:n==6||n==0?0:s>1540?3:s<910?1:2},GetLimitPriceRange:function(a,r){return this.IsSHSZStockA(a)?this.IsSHStockSTAR(a)?{Max:.2,Min:-.2}:this.IsSHGEM(a)?{Max:.2,Min:-.2}:r?r.indexOf("ST")>=0?{Max:.05,Min:-.05}:{Max:.1,Min:-.1}:null:null},GetDefaultDecimal:function(a){return 2},GetSHDecimal:function(a){return 2},GetSZDecimal:function(a){return 2},GetFHKDecimal:function(a){return 0},GetFTSEDecimal:function(a){return 0},GetBITDecimal:function(a){return 2},GetSHODecimal:function(a){return 4},GetETDecimal:function(a){return 2},GetHKDecimal:function(a){return 2},GetTWDecimal:function(a){return 2},GetJPDecimal:function(a){return 2},GetHSXDecimal:function(a){return 2},GetHNXDecimal:function(a){return 2},GetUPCOMDecimal:function(a){return 2},GetForeignExchangeDecimal:function(a){return 4},GetNYMEXDecimal:function(a){return ur.GetDecimal(a)},GetCOMEXDecimal:function(a){return fr.GetDecimal(a)},GetNYBOTDecimal:function(a){return Cr.GetDecimal(a)},GetCBOTDecimal:function(a){return Dr.GetDecimal(a)},GetLMEDecimal:function(a){return wr.GetDecimal(a)},GetTOCOMDecimal:function(a){return Gr.GetDecimal(a)},GetIPEDecimal:function(a){return _r.GetDecimal(a)},GetETMarketStatus:function(a){return 2},GetNYMEXMarketStatus:function(a){return ur.GetMarketStatus(a)},GetCOMEXMarketStatus:function(a){return fr.GetMarketStatus(a)},GetNYBOTMarketStatus:function(a){return Cr.GetMarketStatus(a)},GetCBOTMarketStatus:function(a){return Dr.GetMarketStatus(a)},GetLMEMarketStatus:function(a){return wr.GetMarketStatus(a)},GetTOCOMMarketStatus:function(a){return Gr.GetMarketStatus(a)},GetIPEMarketStatus:function(a){return _r.GetMarketStatus(a)},IsShowMinuteVolTitle:function(a){return a&&a.toUpperCase(),!1},IsShowMinutePostionLine:function(a){return!!(U.IsFutures(a)||U.IsSHO(a)||U.IsSZO(a))},IsShowMinuteColorVolBar:function(a){return!!d.Minute.VolBarColor},IsEnableRight:function(a,r,t){return!U.IsSHSZStockA(r)&&!U.IsBJStock(r)||Y.IsTickPeriod(a)?!1:v.IsPlusNumber(t)?!0:!Y.IsMinutePeriod(a,!0)},GetVolUnit:function(a){return a&&(U.IsSHSZ(a)||U.IsBJ(a))?100:1}};function Wm(){this.SHSZ=null,this.BJ=null,this.SHO=null,this.SZO=null,this.HK=null,this.Futures=new Dt.default,this.USA=null,this.FTSE=null,this.FHK=null,this.ForeEx=null,this.BIT=null,this.TW=null,this.JP=null,this.HSX=null,this.HNX=null,this.UPCOM=null,this.Initialize=function(){},this.GetET=function(e){throw{Name:"MinuteTimeStringData::GetET",Error:"not implement"}},this.GetSHSZ=function(e){return this.SHSZ||(this.SHSZ=this.CreateSHSZData()),this.SHSZ},this.GetBJ=function(e){return this.BJ||(this.BJ=this.CreateBJData()),this.BJ},this.GetSHO=function(e){return this.SHO||(this.SHO=this.CreateSHOData()),this.SHO},this.GetSZO=function(e){return this.SZO||(this.SZO=this.CreateSZOData()),this.SZO},this.GetHK=function(e){return this.HK||(this.HK=this.CreateHKData()),this.HK},this.GetTW=function(e){return this.TW&&(this.TW=this.CreateTWData()),this.TW},this.GetJP=function(e){return this.JP&&(this.JP=this.CreateJPData()),this.JP},this.GetHSX=function(e){return this.HSX&&(this.HSX=this.CreateHSXData()),this.HSX},this.GetHNX=function(e){return this.HNX&&(this.HSX=this.CreateHNXData()),this.HNX},this.GetUPCOM=function(e){return this.UPCOM&&(this.UPCOM=this.CreateUPCOMData()),this.UPCOM},this.GetFutures=function(e){if(!this.Futures.has(e.Name)){var a=this.CreateTimeData(e.Data);this.Futures.set(e.Name,a)}return this.Futures.get(e.Name)},this.GetUSA=function(e){return this.USA||(this.USA=this.CreateUSAData(0)),this.USA},this.GetFTSE=function(){return this.FTSE||(this.FTSE=this.CreateFTSEData()),this.FTSE},this.GetFHK=function(){return this.FHK||(this.FHK=this.CreateFHKData()),this.FHK},this.GetForeignExchange=function(e){return this.ForeEx||(this.ForeEx=this.CreateForeignExchangeData()),this.ForeEx},this.GetBIT=function(e){return this.BIT||(this.BIT=this.CreateBITData()),this.BIT},this.CreateSHSZData=function(){var e=[{Start:925,End:925},{Start:930,End:1130},{Start:1300,End:1500}];return this.CreateTimeData(e)},this.CreateBJData=function(){var e=[{Start:925,End:925},{Start:930,End:1130},{Start:1300,End:1500}];return this.CreateTimeData(e)},this.CreateSHOData=function(){var e=[{Start:930,End:1129},{Start:1300,End:1500}];return this.CreateTimeData(e)},this.CreateSZOData=function(){var e=[{Start:930,End:1129},{Start:1300,End:1500}];return this.CreateTimeData(e)},this.CreateHKData=function(){var e=[{Start:930,End:1200},{Start:1300,End:1600}];return this.CreateTimeData(e)},this.CreateTWData=function(){var e=[{Start:900,End:1330}];return this.CreateTimeData(e)},this.CreateJPData=function(){var e=[{Start:900,End:1130},{Start:1230,End:1500}];return this.CreateTimeData(e)},this.CreateFTSEData=function(){var e=[{Start:1700,End:2359},{Start:0,End:445},{Start:900,End:1630}];return this.CreateTimeData(e)},this.CreateFHKData=function(){var e=[{Start:1715,End:2359},{Start:0,End:300},{Start:915,End:1200},{Start:1300,End:1630}];return this.CreateTimeData(e)},this.CreateHSXData=function(){throw{Name:"MinuteTimeStringData::CreateHSXData",Error:"not implement"}},this.CreateHNXData=function(){throw{Name:"MinuteTimeStringData::CreateHNXData",Error:"not implement"}},this.CreateUPCOMData=function(){throw{Name:"MinuteTimeStringData::CreateUPCOMData",Error:"not implement"}},this.CreateUSAData=function(e){if(e==1){var a=[{Start:2130,End:2359},{Start:0,End:400}];return this.CreateTimeData(a)}else if(e==2){var r=[{Start:2230,End:2359},{Start:0,End:500}];return this.CreateTimeData(r)}else{var t=[{Start:930,End:1600}];return this.CreateTimeData(t)}},this.CreateForeignExchangeData=function(){var e=[{Start:600,End:2359},{Start:0,End:559}];return this.CreateTimeData(e)},this.CreateBITData=function(){var e=[{Start:600,End:2359},{Start:0,End:559}];return this.CreateTimeData(e)},this.CreateTimeData=function(e){var a=[];for(var r in e)for(var t=e[r],n=t.Start;n<=t.End;++n)n%100>=60||a.push(n);return a},this.GetTimeData=function(e){if(!e)return this.SHSZ;var a=e.toLocaleUpperCase();if(U.IsSHO(a))return this.GetSHO();if(U.IsSZO(a))return this.GetSZO();if(U.IsSH(a)||U.IsSZ(a))return this.GetSHSZ(a);if(U.IsBJ(a))return this.GetBJ(a);if(U.IsHK(a))return this.GetHK(a);if(U.IsTW(a))return this.GetTW(a);if(U.IsJP(a))return this.GetJP(a);if(U.IsUSA(a))return this.GetUSA(a);if(U.IsCFFEX(a)||U.IsCZCE(a)||U.IsDCE(a)||U.IsSHFE(a)||U.IsGZFE(a)){var r=Rs.GetSplitData(a);return r?this.GetFutures(r):null}if(U.IsFTSE(a))return this.GetFTSE();if(U.IsFHK(a))return this.GetFHK();if(U.IsForeignExchange(a))return this.GetForeignExchange(a);if(U.IsET(a))return this.GetET(a);if(U.IsBIT(a))return this.GetBIT(a);if(U.IsHSX(a))return this.GetHSX(a);if(U.IsHNX(a))return this.GetHNX(a);if(U.IsUPCOM(a))return this.GetUPCOM(a);if(U.IsNYMEX(a)){var r=ur.GetSplitData(a);return r?this.GetFutures(r):null}if(U.IsCOMEX(a)){var r=fr.GetSplitData(a);return r?this.GetFutures(r):null}if(U.IsNYBOT(a)){var r=Cr.GetSplitData(a);return r?this.GetFutures(r):null}if(U.IsCBOT(a)){var r=Dr.GetSplitData(a);return r?this.GetFutures(r):null}if(U.IsLME(a)){var r=wr.GetSplitData(a);return r?this.GetFutures(r):null}if(U.IsTOCOM(a)){var r=Gr.GetSplitData(a);return r?this.GetFutures(r):null}if(U.IsIPE(a)){var r=_r.GetSplitData(a);return r?this.GetFutures(r):null}}}function Um(){var e={Full:[[0,0,"rgb(200,200,200)","09:30"],[31,0,"RGB(200,200,200)","10:00"],[61,0,"RGB(200,200,200)","10:30"],[91,0,"RGB(200,200,200)","11:00"],[122,1,"RGB(200,200,200)","13:00"],[152,0,"RGB(200,200,200)","13:30"],[182,0,"RGB(200,200,200)","14:00"],[212,0,"RGB(200,200,200)","14:30"],[242,1,"RGB(200,200,200)","15:00"]],Simple:[[0,0,"rgb(200,200,200)","09:30"],[61,0,"RGB(200,200,200)","10:30"],[122,1,"RGB(200,200,200)","13:00"],[182,0,"RGB(200,200,200)","14:00"],[242,1,"RGB(200,200,200)","15:00"]],Min:[[0,0,"rgb(200,200,200)","09:30"],[122,1,"RGB(200,200,200)","13:00"],[242,1,"RGB(200,200,200)","15:00"]],Count:243,MiddleCount:122,GetData:function(u){return u<200?this.Min:u<400?this.Simple:this.Full}},a={Full:[[0,0,"rgb(200,200,200)","09:30"],[30,0,"RGB(200,200,200)","10:00"],[60,0,"RGB(200,200,200)","10:30"],[90,0,"RGB(200,200,200)","11:00"],[120,1,"RGB(200,200,200)","13:00"],[150,0,"RGB(200,200,200)","13:30"],[180,0,"RGB(200,200,200)","14:00"],[210,0,"RGB(200,200,200)","14:30"],[240,1,"RGB(200,200,200)","15:00"]],Simple:[[0,0,"rgb(200,200,200)","09:30"],[60,0,"RGB(200,200,200)","10:30"],[120,1,"RGB(200,200,200)","13:00"],[180,0,"RGB(200,200,200)","14:00"],[240,1,"RGB(200,200,200)","15:00"]],Min:[[0,0,"rgb(200,200,200)","09:30"],[120,1,"RGB(200,200,200)","13:00"],[240,1,"RGB(200,200,200)","15:00"]],Count:241,MiddleCount:120,GetData:function(u){return u<200?this.Min:u<400?this.Simple:this.Full}},r={Full:[[0,1,"RGB(200,200,200)","09:30"],[30,0,"RGB(200,200,200)","10:00"],[60,1,"RGB(200,200,200)","10:30"],[90,0,"RGB(200,200,200)","11:00"],[120,1,"RGB(200,200,200)","11:30"],[151,0,"RGB(200,200,200)","13:00"],[181,1,"RGB(200,200,200)","13:30"],[211,0,"RGB(200,200,200)","14:00"],[241,1,"RGB(200,200,200)","14:30"],[271,0,"RGB(200,200,200)","15:00"],[301,1,"RGB(200,200,200)","15:30"],[331,1,"RGB(200,200,200)","16:00"]],Simple:[[0,1,"RGB(200,200,200)","09:30"],[60,1,"RGB(200,200,200)","10:30"],[120,1,"RGB(200,200,200)","11:30"],[211,0,"RGB(200,200,200)","14:00"],[271,0,"RGB(200,200,200)","15:00"],[331,1,"RGB(200,200,200)","16:00"]],Min:[[0,1,"RGB(200,200,200)","09:30"],[151,0,"RGB(200,200,200)","13:00"],[331,1,"RGB(200,200,200)","16:00"]],Count:332,MiddleCount:151,GetData:function(u){return u<200?this.Min:u<450?this.Simple:this.Full}},t={Full:[[0,0,"rgb(200,200,200)","9:30"],[30,0,"RGB(200,200,200)","10:00"],[90,1,"RGB(200,200,200)","11:00"],[150,0,"RGB(200,200,200)","12:00"],[210,0,"RGB(200,200,200)","13:00"],[270,0,"RGB(200,200,200)","14:00"],[330,0,"RGB(200,200,200)","15:00"],[390,0,"RGB(200,200,200)","16:00"]],Simple:[[30,0,"rgb(200,200,200)","10:00"],[150,1,"RGB(200,200,200)","12:00"],[270,0,"RGB(200,200,200)","14:00"],[390,0,"RGB(200,200,200)","16:00"]],Min:[[30,0,"rgb(200,200,200)","10:00"],[210,1,"RGB(200,200,200)","13:00"],[390,0,"RGB(200,200,200)","16:00"]],Count:391,MiddleCount:211,GetData:function(u){return u<200?this.Min:u<400?this.Simple:this.Full}},n={Full:[[0,1,"RGB(200,200,200)","17:00"],[120,1,"RGB(200,200,200)","19:00"],[240,1,"RGB(200,200,200)","21:00"],[360,1,"RGB(200,200,200)","23:00"],[480,1,"RGB(200,200,200)","01:00"],[600,1,"RGB(200,200,200)","03:00"],[706,1,"RGB(200,200,200)","09:00"],[826,1,"RGB(200,200,200)","11:00"],[946,1,"RGB(200,200,200)","13:00"],[1066,1,"RGB(200,200,200)","15:00"],[1156,1,"RGB(200,200,200)","16:30"]],Simple:[[0,1,"RGB(200,200,200)","17:00"],[240,1,"RGB(200,200,200)","21:00"],[480,1,"RGB(200,200,200)","01:00"],[706,1,"RGB(200,200,200)","09:00"],[946,1,"RGB(200,200,200)","13:00"],[1156,1,"RGB(200,200,200)","16:30"]],Min:[[0,1,"RGB(200,200,200)","17:00"],[706,1,"RGB(200,200,200)","09:00"],[1156,1,"RGB(200,200,200)","16:30"]],Count:1157,MiddleCount:707,GetData:function(u){return u<200?this.Min:u<450?this.Simple:this.Full}},s={Full:[[0,1,"RGB(200,200,200)","17:15"],[105,1,"RGB(200,200,200)","19:00"],[225,1,"RGB(200,200,200)","21:00"],[345,1,"RGB(200,200,200)","23:00"],[586,0,"RGB(200,200,200)","09:15"],[691,1,"RGB(200,200,200)","11:00"],[812,1,"RGB(200,200,200)","14:00"],[963,1,"RGB(200,200,200)","16:30"]],Simple:[[0,1,"RGB(200,200,200)","17:15"],[225,1,"RGB(200,200,200)","21:00"],[586,0,"RGB(200,200,200)","09:15"],[752,1,"RGB(200,200,200)","13:00"],[963,1,"RGB(200,200,200)","16:30"]],Min:[[0,1,"RGB(200,200,200)","17:15"],[586,0,"RGB(200,200,200)","09:15"],[963,1,"RGB(200,200,200)","16:30"]],Count:963,MiddleCount:526,GetData:function(u){return u<200?this.Min:u<450?this.Simple:this.Full}},o={Full:[[0,1,"RGB(200,200,200)","06:00"],[120,1,"RGB(200,200,200)","08:00"],[240,1,"RGB(200,200,200)","10:00"],[360,1,"RGB(200,200,200)","12:00"],[480,0,"RGB(200,200,200)","14:00"],[600,1,"RGB(200,200,200)","16:00"],[720,1,"RGB(200,200,200)","18:00"],[840,1,"RGB(200,200,200)","20:00"],[960,1,"RGB(200,200,200)","22:00"],[1080,1,"RGB(200,200,200)","0:00"],[1200,1,"RGB(200,200,200)","02:00"],[1320,1,"RGB(200,200,200)","04:00"]],Simple:[[0,1,"RGB(200,200,200)","06:00"],[240,1,"RGB(200,200,200)","10:00"],[480,0,"RGB(200,200,200)","14:00"],[720,1,"RGB(200,200,200)","18:00"],[960,1,"RGB(200,200,200)","22:00"],[1200,1,"RGB(200,200,200)","02:00"]],Min:[[0,1,"RGB(200,200,200)","06:00"],[480,0,"RGB(200,200,200)","14:00"],[960,1,"RGB(200,200,200)","22:00"]],Count:1440,MiddleCount:600,GetData:function(u){return u<200?this.Min:u<450?this.Simple:this.Full}},l={Full:[[0,1,"RGB(200,200,200)","09:00"],[30,0,"RGB(200,200,200)","09:30"],[60,1,"RGB(200,200,200)","10:00"],[90,0,"RGB(200,200,200)","10:30"],[120,1,"RGB(200,200,200)","11:00"],[150,0,"RGB(200,200,200)","11:30"],[180,1,"RGB(200,200,200)","12:00"],[210,0,"RGB(200,200,200)","12:30"],[240,1,"RGB(200,200,200)","13:00"],[270,0,"RGB(200,200,200)","13:30"]],Simple:[[0,1,"RGB(200,200,200)","09:00"],[60,1,"RGB(200,200,200)","10:00"],[120,1,"RGB(200,200,200)","11:00"],[180,1,"RGB(200,200,200)","12:00"],[270,0,"RGB(200,200,200)","13:30"]],Min:[[0,1,"RGB(200,200,200)","09:00"],[60,1,"RGB(200,200,200)","11:00"],[270,0,"RGB(200,200,200)","13:30"]],Count:271,MiddleCount:151,GetData:function(u){return u<200?this.Min:u<450?this.Simple:this.Full}};this.GetCoordinateData=function(h,u){var f=null;if(!h)f=e;else{var C=h.toLocaleUpperCase();if(U.IsSHO(C))f=this.GetSHOData(C,u);else if(U.IsSZO(C))f=this.GetSZOData(C,u);else if(U.IsSH(C)||U.IsSZ(C)||U.IsSHSZIndex(C))f=this.GetSHSZData(C,u);else if(U.IsBJ(C))f=this.GetBJData(C,u);else if(U.IsHK(C))f=this.GetHKData(C,u);else if(U.IsTW(C))f=this.GetTWData(C,u);else if(U.IsJP(C))f=this.GetJPData(C,u);else{if(U.IsCFFEX(C)||U.IsCZCE(C)||U.IsDCE(C)||U.IsSHFE(C)||U.IsGZFE(C))return this.GetChinatFuturesData(C,u);if(U.IsUSA(C))f=this.GetUSAData(C,u);else if(U.IsFTSE(C))f=this.GetFTSEData(C,u);else if(U.IsFHK(C))f=this.GetFHKData(C,u);else if(U.IsForeignExchange(C))f=this.GetForeignExchangeData(C);else if(U.IsBIT(C,u))f=this.GetBITData(C,u);else if(U.IsET(C))f=this.GetETData(C,u);else{if(U.IsNYMEX(C))return f=this.GetNYMEXData(C,u);if(U.IsCOMEX(C))return f=this.GetCOMEXData(C,u);if(U.IsNYBOT(C))return f=this.GetNYBOTData(C,u);if(U.IsCBOT(C))return f=this.GetCBOTData(C,u);if(U.IsLME(C))return f=this.GetLMEData(C,u);if(U.IsTOCOM(C))return f=this.GetTOCOMData(C,u);if(U.IsIPE(C))return f=this.GetIPEData(C,u);if(U.IsHSX(C))return f=this.GetHSXData(C,u);if(U.IsHNX(C))return f=this.GetHNXData(C,u);if(U.IsUPCOM(C))return f=this.GetUPCOMData(C,u)}}}var D={Count:f.Count,MiddleCount:f.MiddleCount,Data:f.GetData(u)};return D},this.GetSHSZData=function(h,u){var f=e;return f},this.GetBJData=function(h,u){var f=e;return f},this.GetUSAData=function(h,u){var f=t;return f},this.GetHKData=function(h,u){var f=r;return f},this.GetTWData=function(h,u){return l},this.GetSHOData=function(h,u){var f=a;return f},this.GetSZOData=function(h,u){var f=a;return f},this.GetFuturesData=function(h,u,f){var C=f.GetSplitData(h);if(!C)return null;var D=Wi.GetFutures(C);if(!D)return null;var c={Count:D.length},T=null,S=200,I=480;u<S?T=C.Coordinate.Min:u<I?T=C.Coordinate.Simple:T=C.Coordinate.Full;for(var g=[],E=0;E<D.length;++E)for(var F=D[E],R=0;R<T.length;++R){var A=T[R];if(F==A.Value){var P=[E,0,"RGB(200,200,200)",A.Text];g.push(P);break}}return c.Data=g,c},this.GetChinatFuturesData=function(h,u){return this.GetFuturesData(h,u,Rs)},this.GetNYMEXData=function(h,u){return this.GetFuturesData(h,u,ur)},this.GetCOMEXData=function(h,u){return this.GetFuturesData(h,u,fr)},this.GetNYBOTData=function(h,u){return this.GetFuturesData(h,u,Cr)},this.GetCBOTData=function(h,u){return this.GetFuturesData(h,u,Dr)},this.GetLMEData=function(h,u){return this.GetFuturesData(h,u,wr)},this.GetTOCOMData=function(h,u){return this.GetFuturesData(h,u,Gr)},this.GetIPEData=function(h,u){return this.GetFuturesData(h,u,_r)},this.GetFTSEData=function(h,u){var f=n;return f},this.GetFHKData=function(h,u){var f=s;return f},this.GetForeignExchangeData=function(h,u){var f=o;return f},this.GetBITData=function(h,u){var f=o;return f},this.GetETData=function(h,u){throw{Name:"MinuteCoordinateData::GetETData",Error:"not implement"}},this.GetJPData=function(h,u){throw{Name:"MinuteCoordinateData::GetJPData",Error:"not implement"}},this.GetHSXData=function(h,u){throw{Name:"MinuteCoordinateData::GetHSXData",Error:"not implement"}},this.GetHNXData=function(h,u){throw{Name:"MinuteCoordinateData::GetHNXData",Error:"not implement"}},this.GetUPCOMData=function(h,u){throw{Name:"MinuteCoordinateData::GetUPCOMData",Error:"not implement"}}}function Km(){this.TIME_SPLIT=[{Name:"9:00-10:15,10:31-11:30,13:31-15:00",Data:[{Start:900,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1e3,Text:"10:00"},{Value:1100,Text:"11:00"},{Value:1400,Text:"14:00"},{Value:1500,Text:"15:00"}],Min:[{Value:900,Text:"9:00"},{Value:1330,Text:"13:30"},{Value:1500,Text:"15:00"}]}},{Name:"9:30-11:30,13:01-15:15",Data:[{Start:930,End:1130},{Start:1301,End:1515}],Coordinate:{Full:[{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1515,Text:"15:15"}],Simple:[{Value:930,Text:"9:30"},{Value:1030,Text:"10:30"},{Value:1300,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1515,Text:"15:15"}],Min:[{Value:930,Text:"9:30"},{Value:1300,Text:"13:00"},{Value:1515,Text:"15:15"}]}},{Name:"9:30-11:30,13:00-15:00",Data:[{Start:930,End:1130},{Start:1301,End:1500}],Coordinate:{Full:[{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:930,Text:"9:30"},{Value:1030,Text:"10:30"},{Value:1300,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1500,Text:"15:00"}],Min:[{Value:930,Text:"9:30"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-23:30,9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:2100,End:2330},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-1:00,9:01-10:15,10:31-11:30,13:31-15:00",Data:[{Start:2100,End:2359},{Start:0,End:100},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-2:30,9:01-10:15,10:31-11:30,13:31-15:00",Data:[{Start:2100,End:2359},{Start:0,End:230},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-23:00,9:01-10:15,10:30-11:30,13:31-15:00",Data:[{Start:2100,End:2300},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:1030,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1500,Text:"15:00"}]}},{Name:"9:00-11:30,13:00-15:00",Data:[{Start:900,End:1130},{Start:1300,End:1500}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1e3,Text:"10:00"},{Value:1300,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1500,Text:"15:00"}],Min:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-23:00,9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:2100,End:2300},{Start:900,End:1015},{Start:1030,End:1130},{Start:1330,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:1030,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1500,Text:"15:00"}]}},{Name:"9:01-10:15,10:31-11:30,13:31-15:00",Data:[{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:901,Text:"9:00"},{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:901,Text:"9:00"},{Value:1e3,Text:"10:00"},{Value:1330,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Min:[{Value:901,Text:"9:00"},{Value:1330,Text:"13:30"},{Value:1500,Text:"15:00"}]}},{Name:"21:01-1:00,9:01-10:15,10:31-11:30,13:31-15:00",Data:[{Start:2101,End:2359},{Start:0,End:100},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2101,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2101,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2101,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:01-23:00,9:01-10:15,10:30-11:30,13:31-15:00",Data:[{Start:2101,End:2300},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2101,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:1030,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2101,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2101,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:01-2:30,9:01-10:15,10:31-11:30,13:31-15:00",Data:[{Start:2101,End:2359},{Start:0,End:230},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2101,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2101,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"}],Min:[{Value:2101,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"9:30-11:30,13:01-15:15",Data:[{Start:931,End:1130},{Start:1301,End:1515}],Coordinate:{Full:[{Value:931,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1301,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1515,Text:"15:15"}],Simple:[{Value:931,Text:"9:30"},{Value:1030,Text:"10:30"},{Value:1301,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1515,Text:"15:15"}],Min:[{Value:931,Text:"9:30"},{Value:1301,Text:"13:00"},{Value:1515,Text:"15:15"}]}},{Name:"9:31-11:30,13:01-15:00",Data:[{Start:931,End:1130},{Start:1301,End:1500}],Coordinate:{Full:[{Value:931,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1301,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:931,Text:"9:30"},{Value:1030,Text:"10:30"},{Value:1301,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1500,Text:"15:00"}],Min:[{Value:931,Text:"9:30"},{Value:1301,Text:"13:00"},{Value:1500,Text:"15:00"}]}}],this.MAP_TWOWORDS=new Dt.default([[U.DCE+"-JD",{Time:0,Decimal:0,Name:"鸡蛋"}],[U.DCE+"-FB",{Time:0,Decimal:2,Name:"纤板"}],[U.DCE+"-BB",{Time:0,Decimal:2,Name:"胶板"}],[U.DCE+"-PP",{Time:6,Decimal:0,Name:"丙烯"}],[U.DCE+"-JM",{Time:6,Decimal:1,Name:"焦煤"}],[U.DCE+"-EG",{Time:6,Decimal:0,Name:"乙二醇"}],[U.DCE+"-EB",{Time:6,Decimal:0,Name:"苯乙烯"}],[U.DCE+"-CS",{Time:6,Decimal:0,Name:"淀粉"}],[U.DCE+"-PG",{Time:6,Decimal:0,Name:"液化气"}],[U.DCE+"-RR",{Time:6,Decimal:0,Name:"梗米"}],[U.DCE+"-LH",{Time:0,Decimal:0,Name:"生猪"}],[U.SHFE+"-CU",{Time:4,Decimal:0,Name:"铜"}],[U.SHFE+"-AL",{Time:4,Decimal:0,Name:"铝"}],[U.SHFE+"-NI",{Time:4,Decimal:0,Name:"镍"}],[U.SHFE+"-SN",{Time:4,Decimal:0,Name:"沪锡"}],[U.SHFE+"-ZN",{Time:4,Decimal:0,Name:"沪锌"}],[U.SHFE+"-PB",{Time:4,Decimal:0,Name:"沪铅"}],[U.SHFE+"-RU",{Time:6,Decimal:0,Name:"天然橡胶"}],[U.SHFE+"-FU",{Time:6,Decimal:0,Name:"燃料油"}],[U.SHFE+"-RB",{Time:6,Decimal:0,Name:"螺纹钢"}],[U.SHFE+"-BU",{Time:6,Decimal:0,Name:"石油沥青"}],[U.SHFE+"-HC",{Time:6,Decimal:0,Name:"热轧卷板"}],[U.SHFE+"-SP",{Time:6,Decimal:0,Name:"纸浆"}],[U.SHFE+"-WR",{Time:0,Decimal:0,Name:"线材"}],[U.SHFE+"-AG",{Time:5,Decimal:0,Name:"白银"}],[U.SHFE+"-AU",{Time:5,Decimal:2,Name:"黄金"}],[U.SHFE+"-SS",{Time:4,Decimal:0,Name:"不锈钢"}],[U.SHFE+"-AO",{Time:4,Decimal:0,Name:"氧化铝"}],[U.SHFE+"-BR",{Time:6,Decimal:0,Name:"合成橡胶"}],[U.SHFE+"-NR",{Time:6,Decimal:1,Name:"20号胶"}],[U.SHFE+"-SC",{Time:5,Decimal:1,Name:"原油"}],[U.SHFE+"-LU",{Time:6,Decimal:0,Name:"低硫燃油"}],[U.SHFE+"-BC",{Time:4,Decimal:0,Name:"国际铜"}],[U.SHFE+"-EC",{Time:0,Decimal:0,Name:"集运指数"}],[U.CZCE+"-CF",{Time:6,Decimal:0,Name:"棉花"}],[U.CZCE+"-SR",{Time:6,Decimal:0,Name:"白糖"}],[U.CZCE+"-MA",{Time:6,Decimal:0,Name:"甲醇"}],[U.CZCE+"-ZC",{Time:6,Decimal:1,Name:"动力煤"}],[U.CZCE+"-TA",{Time:6,Decimal:0,Name:"精对苯二甲酸(PTA)"}],[U.CZCE+"-RM",{Time:6,Decimal:0,Name:"菜籽粕"}],[U.CZCE+"-OI",{Time:6,Decimal:0,Name:"菜籽油"}],[U.CZCE+"-ME",{Time:3,Decimal:0,Name:"甲醇(老)"}],[U.CZCE+"-FG",{Time:6,Decimal:0,Name:"平板玻璃"}],[U.CZCE+"-WS",{Time:0,Decimal:0}],[U.CZCE+"-WT",{Time:0,Decimal:0}],[U.CZCE+"-GN",{Time:0,Decimal:0}],[U.CZCE+"-RO",{Time:0,Decimal:0}],[U.CZCE+"-RS",{Time:0,Decimal:0,Name:"菜籽"}],[U.CZCE+"-ER",{Time:0,Decimal:0}],[U.CZCE+"-RI",{Time:0,Decimal:0,Name:"早籼稻"}],[U.CZCE+"-WH",{Time:0,Decimal:0,Name:"强麦"}],[U.CZCE+"-AP",{Time:0,Decimal:0,Name:"苹果"}],[U.CZCE+"-PM",{Time:0,Decimal:0,Name:"普麦"}],[U.CZCE+"-QM",{Time:0,Decimal:0}],[U.CZCE+"-TC",{Time:0,Decimal:0}],[U.CZCE+"-JR",{Time:0,Decimal:0,Name:"粳稻"}],[U.CZCE+"-LR",{Time:0,Decimal:0,Name:"晚籼稻"}],[U.CZCE+"-SF",{Time:0,Decimal:0,Name:"硅铁"}],[U.CZCE+"-SM",{Time:0,Decimal:0,Name:"锰硅"}],[U.CZCE+"-CJ",{Time:0,Decimal:2,Name:"红枣"}],[U.CZCE+"-CY",{Time:6,Decimal:0,Name:"棉纱"}],[U.CZCE+"-UR",{Time:0,Decimal:0,Name:"尿素"}],[U.CZCE+"-SA",{Time:6,Decimal:0,Name:"纯碱"}],[U.CZCE+"-PF",{Time:6,Decimal:0,Name:"短纤"}],[U.CZCE+"-PK",{Time:0,Decimal:0,Name:"花生"}],[U.CZCE+"-PR",{Time:6,Decimal:0,Name:"瓶片"}],[U.CFFEX+"-TF",{Time:1,Decimal:3,Name:"二债"}],[U.CFFEX+"-TS",{Time:1,Decimal:3,Name:"五债"}],[U.CFFEX+"-IH",{Time:2,Decimal:1,Name:"上证股指期货"}],[U.CFFEX+"-IC",{Time:2,Decimal:1,Name:"中证股指期货"}],[U.CFFEX+"-IF",{Time:2,Decimal:1,Name:"沪深股指期货"}],[U.CFFEX+"-IM",{Time:2,Decimal:1,Name:"中证1000股指期货"}],[U.CFFEX+"-IO",{Time:2,Decimal:1,Name:"沪深300股指期权"}],[U.CFFEX+"-MO",{Time:2,Decimal:1,Name:"中证1000股指期权"}],[U.CFFEX+"-HO",{Time:2,Decimal:1,Name:"上证50股指期权"}],[U.GZFE+"-SI",{Time:0,Decimal:2,Name:"工业硅"}],[U.GZFE+"-LC",{Time:0,Decimal:2,Name:"碳酸锂"}]]),this.MAP_ONEWORD=new Dt.default([[U.DCE+"-C",{Time:6,Decimal:0,Name:"玉米"}],[U.DCE+"-L",{Time:6,Decimal:0,Name:"乙烯"}],[U.DCE+"-V",{Time:6,Decimal:0,Name:"PVC"}],[U.DCE+"-A",{Time:6,Decimal:0,Name:"豆一"}],[U.DCE+"-B",{Time:6,Decimal:0,Name:"豆二"}],[U.DCE+"-M",{Time:6,Decimal:0,Name:"豆粕"}],[U.DCE+"-Y",{Time:6,Decimal:0,Name:"豆油"}],[U.DCE+"-P",{Time:6,Decimal:0,Name:"棕榈"}],[U.DCE+"-J",{Time:6,Decimal:1,Name:"焦炭"}],[U.DCE+"-I",{Time:6,Decimal:1,Name:"铁矿"}],[U.CFFEX+"-T",{Time:1,Decimal:3,Name:"十债"}]]),this.AddNewFutures=function(e){if(e){var a=e.Suffix+"-"+e.Symbol,r={Time:e.Time,Decimal:e.Decimal,Name:e.Name};e.Symbol.length==1?this.MAP_ONEWORD.set(a,r):e.Symbol.length==2&&this.MAP_TWOWORDS.set(a,r)}},this.GetData=function(e){var a=e.charAt(0),r=e.substr(0,2),t=null,n=null;return U.IsDCE(e)?(t=U.DCE+"-"+a,n=U.DCE+"-"+r):U.IsSHFE(e)?(t=U.SHFE+"-"+a,n=U.SHFE+"-"+r):U.IsCFFEX(e)?(t=U.CFFEX+"-"+a,n=U.CFFEX+"-"+r):U.IsCZCE(e)?(t=U.CZCE+"-"+a,n=U.CZCE+"-"+r):U.IsGZFE(e)&&(t=U.GZFE+"-"+a,n=U.GZFE+"-"+r),this.MAP_TWOWORDS.has(n)?this.MAP_TWOWORDS.get(n):this.MAP_ONEWORD.has(t)?this.MAP_ONEWORD.get(t):null},this.GetSplitData=function(e){var a=this.GetData(e);return a?this.TIME_SPLIT[a.Time]:null},this.GetDecimal=function(e){var a=this.GetData(e);return a?a.Decimal:2}}function cr(){this.TIME_SPLIT=[{Name:"6:00-5:00",Data:[{Start:600,End:2359},{Start:0,End:500}],Coordinate:{Full:[{Value:600,Text:"6:00"},{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"},{Value:400,Text:"4:00"}],Simple:[{Value:600,Text:"6:00"},{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:600,Text:"6:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}}],this.TIME_SPLIT2=[{Name:"7:00-6:00",Data:[{Start:700,End:2359},{Start:0,End:600}],Coordinate:{Full:[{Value:700,Text:"7:00"},{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"},{Value:500,Text:"5:00"}],Simple:[{Value:700,Text:"7:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"},{Value:1900,Text:"19:00"},{Value:2300,Text:"23:00"},{Value:300,Text:"3:00"}],Min:[{Value:700,Text:"7:00"},{Value:1900,Text:"19:00"},{Value:500,Text:"5:00"}]}}],this.FUTURES_LIST=[{Symbol:"CL",Decimal:2,Time:0,Name:"原油"},{Symbol:"NG",Decimal:3,Time:0,Name:"天然气"},{Symbol:"RB",Decimal:4,Time:0,Name:"汽油"},{Symbol:"PL",Decimal:1,Time:0,Name:"铂金"},{Symbol:"PA",Decimal:2,Time:0,Name:"钯金"},{Symbol:"HR",Decimal:0,Time:0,Name:"热轧钢卷"},{Symbol:"QM",Decimal:3,Time:0,Name:"迷你原油"},{Symbol:"HO",Decimal:4,Time:0,Name:"燃油"}],this.MarketSuffix=".NYMEX",this.TimeType=0,this.GetFuturesInfo=function(e){if(e.indexOf(this.MarketSuffix)<=0)return null;for(var a in this.FUTURES_LIST){var r=this.FUTURES_LIST[a];if(e.indexOf(r.Symbol)==0)return r}return null},this.GetSplitData=function(e){var a=this.TimeType==0?this.TIME_SPLIT:this.TIME_SPLIT2,r=this.GetFuturesInfo(e);return r?a[r.Time]:a[0]},this.GetDecimal=function(e){var a=this.GetFuturesInfo(e);return a?a.Decimal:3},this.GetMarketStatus=function(e){var a=cl(-4),r=new Date,t=a.getDay(),n=r.getHours()*100+r.getMinutes();return t==6||t==0?0:n>430&&n<730?1:2},this.AddNewFutures=function(e){if(e){for(var a={Symbol:e.Symbol,Time:e.Time,Decimal:e.Decimal,Name:e.Name},r=0;r<this.FUTURES_LIST.length;++r){var t=this.FUTURES_LIST[r];if(t.Symbol==a.Symbol){this.FUTURES_LIST[r]=a;return}}this.FUTURES_LIST.push(a)}}}function zm(){this.newMethod=cr,this.newMethod(),delete this.newMethod,this.FUTURES_LIST=[{Symbol:"GC",Decimal:1,Time:0,Name:"COMEX黄金"},{Symbol:"QO",Decimal:2,Time:0,Name:"迷你黄金"},{Symbol:"MG",Decimal:1,Time:0,Name:"微型黄金"},{Symbol:"QI",Decimal:4,Time:0,Name:"迷你白银"},{Symbol:"SI",Decimal:3,Time:0,Name:"COMEX白银"},{Symbol:"HG",Decimal:4,Time:0,Name:"COMEX铜"}],this.MarketSuffix=".COMEX"}function Jm(){this.newMethod=cr,this.newMethod(),delete this.newMethod,this.TIME_SPLIT=[{Name:"9:00-2:20",Data:[{Start:900,End:2359},{Start:0,End:220}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:100,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1700,Text:"17:00"},{Value:100,Text:"1:00"}]}},{Name:"15:30-1:00",Data:[{Start:1530,End:2359},{Start:0,End:100}],Coordinate:{Full:[{Value:1600,Text:"16:00"},{Value:1700,Text:"17:00"},{Value:1800,Text:"18:00"},{Value:1900,Text:"19:00"},{Value:2e3,Text:"20:00"},{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:0,Text:"0:00"},{Value:100,Text:"1:00"}],Simple:[{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"}],Min:[{Value:1600,Text:"16:00"},{Value:2100,Text:"21:00"},{Value:100,Text:"1:00"}]}}],this.TIME_SPLIT2=[{Name:"10:00-3:20",Data:[{Start:1e3,End:2359},{Start:0,End:320}],Coordinate:{Full:[{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:1e3,Text:"10:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"16:30-2:00",Data:[{Start:1630,End:2359},{Start:0,End:200}],Coordinate:{Full:[{Value:1700,Text:"17:00"},{Value:1800,Text:"18:00"},{Value:1900,Text:"19:00"},{Value:2e3,Text:"20:00"},{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:0,Text:"0:00"},{Value:100,Text:"1:00"},{Value:200,Text:"2:00"}],Simple:[{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"}],Min:[{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:200,Text:"2:00"}]}}],this.FUTURES_LIST=[{Symbol:"SB",Decimal:2,Time:1},{Symbol:"CT",Decimal:2,Time:0}],this.MarketSuffix=".NYBOT",this.GetMarketStatus=function(e){var a=cl(-4),r=a.getDay(),t=a.getHours()*100+a.getMinutes();if(r==6||r==0)return 0;var n=this.GetFuturesInfo(e);if(!n)return 2;if(n.Symbol=="SB"){if(t>300&&t<1400)return 2}else if(n.Symbol=="CT")return t>=0&&t<=1500||t>=2e3&&t<=2359?2:1;return 0}}function Zm(){this.newMethod=cr,this.newMethod(),delete this.newMethod,this.TIME_SPLIT=[{Name:"8:00-2:20",Data:[{Start:800,End:2359},{Start:0,End:220}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"8:00-2:45",Data:[{Start:800,End:2359},{Start:0,End:245}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"6:00-5:00",Data:[{Start:600,End:2359},{Start:0,End:500}],Coordinate:{Full:[{Value:600,Text:"6:00"},{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"},{Value:400,Text:"4:00"}],Simple:[{Value:600,Text:"6:00"},{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:600,Text:"6:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}},{Name:"08:00-20:45 21:31-02:20",Data:[{Start:800,End:2045},{Start:2131,End:2359},{Start:0,End:220}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"8:00-2:45",Data:[{Start:800,End:2045},{Start:2131,End:2359},{Start:0,End:245}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"06:00-04:15 04:31-05:00",Data:[{Start:600,End:2359},{Start:0,End:415},{Start:431,End:500}],Coordinate:{Full:[{Value:600,Text:"6:00"},{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"},{Value:400,Text:"4:00"}],Simple:[{Value:600,Text:"6:00"},{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:600,Text:"6:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}}],this.TIME_SPLIT2=[{Name:"9:00-3:20",Data:[{Start:900,End:2359},{Start:0,End:320}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1900,Text:"19:00"},{Value:300,Text:"3:00"}]}},{Name:"9:00-3:45",Data:[{Start:900,End:2359},{Start:0,End:345}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1900,Text:"19:00"},{Value:300,Text:"3:00"}]}},{Name:"7:00-6:00",Data:[{Start:700,End:2359},{Start:0,End:600}],Coordinate:{Full:[{Value:700,Text:"7:00"},{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"},{Value:500,Text:"5:00"}],Simple:[{Value:700,Text:"7:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"},{Value:1900,Text:"19:00"},{Value:2300,Text:"23:00"},{Value:300,Text:"3:00"}],Min:[{Value:700,Text:"7:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}},{Name:"09:00-21:45 22:31-03:20",Data:[{Start:900,End:2145},{Start:2231,End:2359},{Start:0,End:320}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1900,Text:"19:00"},{Value:300,Text:"3:00"}]}},{Name:"09:00-21:45 22:31-03:45",Data:[{Start:900,End:2145},{Start:2231,End:2359},{Start:0,End:345}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1900,Text:"19:00"},{Value:300,Text:"3:00"}]}},{Name:"07:00-05:15 05:31-06:00",Data:[{Start:700,End:2359},{Start:0,End:515},{Start:531,End:600}],Coordinate:{Full:[{Value:700,Text:"7:00"},{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"},{Value:500,Text:"5:00"}],Simple:[{Value:700,Text:"7:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"},{Value:1900,Text:"19:00"},{Value:2300,Text:"23:00"},{Value:300,Text:"3:00"}],Min:[{Value:700,Text:"7:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}}],this.FUTURES_LIST=[{Symbol:"ZC",Decimal:2,Time:0,Name:"玉米"},{Symbol:"XC",Decimal:2,Time:1,Name:"迷你玉米"},{Symbol:"ZS",Decimal:2,Time:0,Name:"大豆"},{Symbol:"XK",Decimal:2,Time:1,Name:"迷你大豆"},{Symbol:"ZL",Decimal:2,Time:0,Name:"豆油"},{Symbol:"ZR",Decimal:2,Time:0,Name:"稻谷"},{Symbol:"ZO",Decimal:2,Time:0,Name:"燕麦"},{Symbol:"ZW",Decimal:2,Time:0,Name:"小麦"},{Symbol:"XW",Decimal:2,Time:1,Name:"迷你小麦"},{Symbol:"ZM",Decimal:1,Time:0,Name:"豆粕"},{Symbol:"EH",Decimal:3,Time:2},{Symbol:"YM",Decimal:0,Time:2,Name:"小型道指"},{Symbol:"ES",Decimal:2,Time:2,Name:"小型标普"},{Symbol:"NQ",Decimal:2,Time:2,Name:"小型纳指"},{Symbol:"TY",Decimal:4,Time:2,Name:"10年美国债"},{Symbol:"TU",Decimal:4,Time:2,Name:"2年美国债"},{Symbol:"FV",Decimal:4,Time:2,Name:"5年美国债"},{Symbol:"US",Decimal:4,Time:2,Name:"30年美国债"},{Symbol:"UL",Decimal:4,Time:2,Name:"超国债"}],this.MarketSuffix=".CBOT"}function Qm(){this.newMethod=cr,this.newMethod(),delete this.newMethod,this.TIME_SPLIT=[{Name:"LME 9:00-3:00",Data:[{Start:900,End:2359},{Start:0,End:300}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:100,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1800,Text:"18:00"},{Value:300,Text:"3:00"}]}}],this.TIME_SPLIT=[{Name:"LME 8:00-2:00",Data:[{Start:800,End:2359},{Start:0,End:200}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}}],this.FUTURES_LIST=[{Symbol:"SN",Decimal:0,Time:0,Name:"LME锡"},{Symbol:"AH",Decimal:2,Time:0,Name:"LME铝"},{Symbol:"PB",Decimal:2,Time:0,Name:"LME铅"},{Symbol:"ZS",Decimal:2,Time:0,Name:"LME锌"},{Symbol:"CA",Decimal:2,Time:0,Name:"LME铜"},{Symbol:"NI",Decimal:0,Time:0,Name:"LME镍"}],this.MarketSuffix=".LME"}function $m(){this.newMethod=cr,this.newMethod(),delete this.newMethod,this.TimeType=0,this.TIME_SPLIT=[{Name:"15:30-04:30 07:46-14:15",Data:[{Start:1530,End:2359},{Start:0,End:430},{Start:746,End:1415}],Coordinate:{Full:[{Value:1530,Text:"15:30"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:300,Text:"3:00"},{Value:430,Text:"4:30"},{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1415,Text:"14:15"}],Simple:[{Value:1530,Text:"15:30"},{Value:1900,Text:"19:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:430,Text:"4:30"},{Value:1100,Text:"11:00"},{Value:1415,Text:"14:15"}],Min:[{Value:1530,Text:"15:30"},{Value:100,Text:"1:00"},{Value:1415,Text:"14:15"}]}}],this.FUTURES_LIST=[{Symbol:"JRV",Decimal:0,Time:0,Name:"东京TSR20橡胶"},{Symbol:"JPL",Decimal:0,Time:0,Name:"东京铂金"},{Symbol:"JAU",Decimal:0,Time:0,Name:"东京黄金"},{Symbol:"JCO",Decimal:0,Time:0,Name:"中东原油"},{Symbol:"JRU",Decimal:1,Time:0,Name:"东京RSS3橡胶橡胶"},{Symbol:"JAG",Decimal:1,Time:0,Name:"日白银"},{Symbol:"JPA",Decimal:1,Time:0,Name:"日钯金"}],this.MarketSuffix=".TOCOM"}function qm(){this.newMethod=cr,this.newMethod(),delete this.newMethod,this.MarketSuffix=".IPE",this.TIME_SPLIT=[{Name:"8:00-6:00",Data:[{Start:800,End:2359},{Start:0,End:600}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"},{Value:400,Text:"4:00"},{Value:600,Text:"6:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"},{Value:400,Text:"4:00"},{Value:600,Text:"6:00"}],Min:[{Value:800,Text:"8:00"},{Value:2e3,Text:"20:00"},{Value:600,Text:"6:00"}]}}],this.TIME_SPLIT2=[{Name:"09:00-07:00",Data:[{Start:900,End:2359},{Start:0,End:700}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"},{Value:500,Text:"5:00"},{Value:700,Text:"7:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"},{Value:500,Text:"5:00"},{Value:700,Text:"7:00"}],Min:[{Value:900,Text:"9:00"},{Value:2100,Text:"21:00"},{Value:700,Text:"7:00"}]}}],this.FUTURES_LIST=[{Symbol:"RC",Decimal:2,Time:0,Name:"罗布斯塔咖啡"},{Symbol:"W",Decimal:2,Time:0,Name:"白糖"},{Symbol:"C",Decimal:2,Time:0,Name:"伦敦可可"},{Symbol:"R",Decimal:2,Time:0,Name:"长期英国国债"},{Symbol:"L",Decimal:2,Time:0,Name:"3个月英镑利率"},{Symbol:"T",Decimal:2,Time:0,Name:"WTI原油"},{Symbol:"G",Decimal:2,Time:0,Name:"低硫柴油"},{Symbol:"B",Decimal:2,Time:0,Name:"布伦特原油"}]}var Wi=new Wm,vl=new Um,Rs=new Km,ur=new cr,fr=new zm,Cr=new Jm,Dr=new Zm,wr=new Qm,Gr=new $m,_r=new qm;function jt(e){var a=2;if(!e)return a;var r=e.toUpperCase();return typeof U.GetCustomDecimal=="function"?U.GetCustomDecimal(r):(U.IsSHSZFund(r)?a=3:U.IsSHO(r)||U.IsSZO(r)?a=U.GetSHODecimal(r):U.IsChinaFutures(r)?a=Rs.GetDecimal(r):U.IsFHK(r)?a=U.GetFHKDecimal(r):U.IsFTSE(r)?a=U.GetFTSEDecimal(r):U.IsBIT(r)?a=U.GetBITDecimal(r):U.IsET(r)?a=U.GetETDecimal(r):U.IsForeignExchange(r)?a=U.GetForeignExchangeDecimal(r):U.IsNYMEX(r)?a=ur.GetDecimal(r):U.IsCOMEX(r)?a=fr.GetDecimal(r):U.IsNYBOT(r)?a=Cr.GetDecimal(r):U.IsCBOT(r)?a=Dr.GetDecimal(r):U.IsLME(r)?a=wr.GetDecimal(r):U.IsTOCOM(r)?a=Gr.GetDecimal(r):U.IsIPE(r)?a=_r.GetDecimal(r):U.IsHK(r)?a=U.GetHKDecimal(r):U.IsTW(r)?a=U.GetTWDecimal(r):U.IsJP(r)?a=U.GetJPDecimal(r):U.IsHSX(r)?a=U.GetHSXDecimal(r):U.IsHNX(r)?a=U.GetHNXDecimal(r):U.IsUPCOM(r)?a=U.GetUPCOMDecimal(r):U.IsSZ(r)?a=U.GetSZDecimal(r):U.IsSH(r)?a=U.GetSHDecimal(r):a=U.GetDefaultDecimal(r),a)}function cl(e){if(typeof e=="number"){var a=new Date,r=a.getTime(),t=a.getTimezoneOffset()*6e4,n=r+t;return new Date(n+36e5*e)}}if(!k)var k={Chart:{Log:console.log,Warn:console.warn},Complier:{Log:console.log,Warn:console.warn}};var Yt={Domain:"http://127.0.0.1:8080",CacheDomain:"http://127.0.0.1:8087",DrawIcon:{Family:"iconfont",Data:new Dt.default([[1,{Text:"",Color:"rgb(243,28,15)"}],[2,{Text:"",Color:"rgb(87,247,41)"}],[3,{Text:"",Color:"rgb(237,153,0)"}],[4,{Text:"",Color:"rgb(237,153,0)"}],[5,{Text:"",Color:"rgb(237,153,0)"}],[6,{Text:"",Color:"rgb(140,57,208)"}],[7,{Text:"",Color:"rgb(246,135,37)"}],[8,{Text:"",Color:"rgb(85,231,56)"}],[9,{Text:"",Color:"rgb(227,61,41)"}],[10,{Text:"",Color:"rgb(216,78,48)"}],[11,{Text:"",Color:"rgb(249,187,0)"}],[12,{Text:"",Color:"rgb(249,187,0)"}],[13,{Text:"",Color:"rgb(216,42,0)"}],[14,{Text:"",Color:"rgb(58,90,236)"}],[15,{Text:"",Color:"rgb(227,149,0)"}],[16,{Text:"",Color:"rgb(208,82,78)"}],[17,{Text:"",Color:"rgb(234,114,26)"}],[18,{Text:"",Color:"rgb(116,25,255)"}],[19,{Text:"",Color:"rgb(102,9,11)"}],[20,{Text:"",Color:"rgb(127,125,137)"}],[21,{Text:"",Color:"rgb(110,188,255)"}],[22,{Text:"",Color:"rgb(238,79,51)"}],[23,{Text:"",Color:"rgb(244,71,0)"}],[24,{Text:"",Color:"rgb(102,183,248)"}],[25,{Text:"",Color:"rgb(234,88,231)"}],[26,{Text:"",Color:"rgb(242,171,0)"}],[27,{Text:"",Color:"rgb(87,247,168)"}],[28,{Text:"",Color:"rgb(97,204,113)"}],[29,{Text:"",Color:"rgb(84,115,193)"}],[30,{Text:"",Color:"rgb(141,51,255)"}],[31,{Text:"",Color:"rgb(200,126,24)"}],[32,{Text:"",Color:"rgb(195,41,32)"}],[33,{Text:"",Color:"rgb(215,85,194)"}],[34,{Text:"",Color:"rgb(250,222,105)"}],[35,{Text:"",Color:"rgb(112,249,224)"}],[36,{Text:"",Color:"rgb(217,107,98)"}],[37,{Text:"",Color:"rgb(114,231,17)"}],[38,{Text:"",Color:"rgb(238,31,25)"}],[39,{Text:"",Color:"rgb(92,247,113)"}],[40,{Text:"",Color:"rgb(175,175,175)"}],[41,{Text:"",Color:"rgb(252,228,23)"}],[42,{Text:"",Color:"rgb(88,195,235)"}],[43,{Text:"",Color:"rgb(55,74,94)"}],[44,{Text:"",Color:"rgb(248,175,33)"}],[45,{Text:"",Color:"rgb(194,180,112)"}],[46,{Text:"",Color:"rgb(50,153,28)"}],[47,{Text:"",Color:"rgb(17,65,152)"}],[48,{Text:"",Color:"rgb(194,55,26)"}],[49,{Text:"",Color:"rgb(243,0,0)"}]])},CustomDrawIcon:{Data:new Dt.default},CustomFunction:{Data:new Dt.default},CustomVariant:{Data:new Dt.default},CustomDataFunction:{Data:new Dt.default([["L2_VOLNUM",{Name:"L2_VOLNUM",Description:"单数分档,按: N(0--1):(超大+大)/(中+小),M(0--1):买/卖二类,沪深京品种的资金流向,仅日线以上周期,用于特定版本",ArgCount:2}],["L2_VOL",{Name:"L2_VOL",Description:"成交量分档,按: N(0--3):超大/大/中/小四档处理,M(0--3):买入/卖出/主买/主卖四类,沪深京品种的资金流向,仅日线以上周期,用于特定版本",ArgCount:2}],["L2_AMO",{Name:"L2_AMO",Description:"成交额分档,按: N(0--3):超大/大/中/小四档处理,M(0--3):买入/卖出/主买/主卖四类,沪深京品种的资金流向,仅日线以上周期,用于特定版本",ArgCount:2}]])},GetDrawIcon:function(a){var r;if(Yt.CustomDrawIcon.Data.has(a)){var t=Yt.CustomDrawIcon.Data.get(a);return t.Symbol?r={Symbol:t.Symbol,Color:t.Color,IconFont:!1,ID:a}:r={Symbol:t.Text,Color:t.Color,Family:t.Family,IconFont:!0,ID:a},r}if(Yt.DrawIcon.Data.has(a)){var n=Yt.DrawIcon.Data.get(a);return r={Symbol:n.Text,Color:n.Color,Family:Yt.DrawIcon.Family,IconFont:!0,ID:a},r}return null},GetDrawTextIcon:function(a){var r=new Dt.default([[1,{Symbol:"↑",Color:"rgb(238,44,44)"}],[2,{Symbol:"↓",Color:"rgb(0,139,69)"}],[3,{Symbol:"😧"}],[4,{Symbol:"😨"}],[5,{Symbol:"😁"}],[6,{Symbol:"😱"}],[7,{Symbol:"B",Color:"rgb(238,44,44)"}],[8,{Symbol:"S",Color:"rgb(0,139,69)"}],[9,{Symbol:"💰"}],[10,{Symbol:"📪"}],[11,{Symbol:"👆"}],[12,{Symbol:"👇"}],[13,{Symbol:"B",Color:"rgb(178,34,34)"}],[14,{Symbol:"S",Color:"rgb(0,139,69)"}],[36,{Symbol:"Χ",Color:"rgb(238,44,44)"}],[37,{Symbol:"X",Color:"rgb(0,139,69)"}],[38,{Symbol:"▲",Color:"rgb(238,44,44)"}],[39,{Symbol:"▼",Color:"rgb(0,139,69)"}],[40,{Symbol:"◉",Color:"rgb(238,44,44)"}],[41,{Symbol:"◈",Color:"rgb(238,44,44)"}],[42,{Symbol:"📌"}],[43,{Symbol:"💎"}],[44,{Symbol:"🥇"}],[45,{Symbol:"🥈"}],[46,{Symbol:"🥉"}],[47,{Symbol:"🏅"}]]),t=r.get(a);return t},IsCustomFunction:function(a){return!!Yt.CustomFunction.Data.has(a)},IsCustomVariant:function(a){return!!Yt.CustomVariant.Data.has(a)},IsCustomDataFunction:function(a){return!!Yt.CustomDataFunction.Data.has(a)}},vs={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"},df={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},$e={FromCodePoint:function(a){return a<65536?String.fromCharCode(a):String.fromCharCode(55296+(a-65536>>10))+String.fromCharCode(56320+(a-65536&1023))},IsWhiteSpace:function(a){return a===32||a===9||a===11||a===12||a===160||a>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(a)>=0},IsLineTerminator:function(a){return a===10||a===13||a===8232||a===8233},IsIdentifierStart:function(a){return a===36||a===95||a>=65&&a<=90||a>=97&&a<=122||a===92||a===12304||a===12305||a===9650||a===9660||a>=128&&df.NonAsciiIdentifierStart.test($e.FromCodePoint(a))},IsIdentifierPart:function(a){return a===36||a===95||a>=65&&a<=90||a>=97&&a<=122||a>=48&&a<=57||a===92||a===35||a===12304||a===12305||a===9650||a===9660||a>=128&&df.NonAsciiIdentifierPart.test($e.FromCodePoint(a))},IsDecimalDigit:function(a){return a>=48&&a<=57},IsHexDigit:function(a){return a>=48&&a<=57||a>=65&&a<=70||a>=97&&a<=102},isOctalDigit:function(a){return a>=48&&a<=55}},qa={};qa[1]="Boolean";qa[2]="<end>";qa[3]="Identifier";qa[4]="Keyword";qa[5]="Null";qa[6]="Numeric";qa[7]="Punctuator";qa[8]="String";qa[9]="RegularExpression";qa[10]="Template";function za(){}za.GetPeriodInfo=function(e){var a=[{Name:"MIN1",Period:4,Order:1},{Name:"MIN5",Period:5,Order:2},{Name:"MIN15",Period:6,Order:3},{Name:"MIN30",Period:7,Order:4},{Name:"MIN60",Period:8,Order:5},{Name:"DAY",Period:0,Order:1e3},{Name:"MULTIDAY",Period:40002,Order:1002},{Name:"DAY2",Period:40002,Order:1002},{Name:"DAY3",Period:40003,Order:1003},{Name:"DAY4",Period:40004,Order:1004},{Name:"DAY5",Period:40005,Order:1005},{Name:"WEEK",Period:1,Order:1005},{Name:"DAY6",Period:40006,Order:1006},{Name:"DAY7",Period:40007,Order:1007},{Name:"DAY8",Period:40008,Order:1008},{Name:"DAY9",Period:40009,Order:1009},{Name:"DAY10",Period:40009,Order:1010},{Name:"WEEK2",Period:21,Order:1010},{Name:"DAY11",Period:40011,Order:1011},{Name:"DAY12",Period:40012,Order:1012},{Name:"DAY13",Period:40013,Order:1013},{Name:"DAY14",Period:40014,Order:1014},{Name:"MONTH",Period:2,Order:1030},{Name:"SEASON",Period:9,Order:1090},{Name:"HALFYEAR",Period:22,Order:1180},{Name:"YEAR",Period:3,Order:1365}];if(e.Name){for(var r in a)if(e.Name&&a[r].Name==e.Name)return a[r];return null}if(v.IsNumber(e.PeriodID)){for(var r in a)if(a[r].Period==e.PeriodID)return a[r];return null}return null};za.GetConvertValueName=function(e){var a;return e=="COVER_C"?a="CLOSE":e=="COVER_O"?a="OPEN":e=="COVER_H"?a="HIGH":e=="COVER_L"?a="LOW":e=="COVER_A"?a="AMOUNT":e=="COVER_V"&&(a="VOL"),a};function bn(){this.Error=[],this.RecordError=function(e){this.Error.push(e)},this.ConstructError=function(e,a){var r=new Error(e);try{throw r}catch(t){vf.default&&ld.default&&(r=(0,vf.default)(t),r.Column=a)}return r},this.CreateError=function(e,a,r,t,n){var s="Line "+a+": "+t,o=this.ConstructError(s,r);return o.Index=e,o.LineNumber=a,o.Description=t,o.Word=n,o},this.ThrowError=function(e,a,r,t,n){var s=this.CreateError(e,a,r,t,n);throw s},this.ThrowDownloadJob=function(e,a,r,t,n){var s=this.CreateError(e,a,r,t);throw s.Job=n,s}}function xD(e,a){this.Source=e,this.ErrorHandler=a,this.Length=e.length,this.Index=0,this.LineNumber=e.length>0?1:0,this.LineStart=0,this.CurlyStack=[],this.SaveState=function(){return{Index:this.Index,LineNumber:this.LineNumber,LineStart:this.LineStart}},this.RestoreState=function(r){this.Index=r.Index,this.LineNumber=r.LineNumber,this.LineStart=r.LineStart},this.IsEOF=function(){return this.Index>=this.Length},this.IsKeyword=function(r){return!1},this.CodePointAt=function(r){var t=this.Source.charCodeAt(r);if(t>=55296&&t<=56319){var n=this.Source.charCodeAt(r+1);if(n>=56320&&n<=57343){var s=t;t=(s-55296)*1024+n-56320+65536}}return t},this.Lex=function(){if(this.IsEOF())return{Type:2,Value:"",LineNumber:this.LineNumber,LineStart:this.LineStart,Start:this.Index,End:this.Index};var r=this.Source.charCodeAt(this.Index);return $e.IsIdentifierStart(r)?this.ScanIdentifier():r===40||r===41||r===59?this.ScanPunctuator():r===39||r===34?this.ScanStringLiteral():r==46?$e.IsDecimalDigit(this.Source.charCodeAt(this.Index+1))?this.ScanNumericLiteral():this.ScanPunctuator():$e.IsDecimalDigit(r)?this.ScanNumericLiteral():r>=55296&&r<57343&&$e.IsIdentifierStart(this.CodePointAt(this.Index))?this.ScanIdentifier():this.ScanPunctuator()},this.ScanIdentifier=function(){var r=void 0,t=this.Index,n=this.Source.charCodeAt(t)===92?this.GetComplexIdentifier():this.GetIdentifier();if(n.length?r=3:this.IsKeyword(n)?r=4:n==null?r=5:n=="true"||n=="false"?r=1:r=3,r!=3&&t+n.length!=this.Index)throw this.Index,this.Index=t,vs.InvalidEscapedReservedWord;return(n=="AND"||n=="OR")&&(r=7),{Type:r,Value:n,LineNumber:this.LineNumber,LineStart:this.LineStart,Start:t,End:this.Index}},this.GetIdentifier=function(){for(var r=this.Index++;!this.IsEOF();){var t=this.Source.charCodeAt(this.Index);if(t==92)return this.Index=r,this.GetComplexIdentifier();if(t>=55296&&t<57343)return this.Index=r,this.GetComplexIdentifier();if($e.IsIdentifierPart(t))++this.Index;else break}return this.Source.slice(r,this.Index)},this.ScanPunctuator=function(){var r=this.Index,t=this.Source[this.Index];switch(t){case"(":++this.Index;break;case")":case";":case",":++this.Index;break;case".":++this.Index;break;default:t=this.Source.substr(this.Index,3),t=="AND"?this.Index+=3:(t=this.Source.substr(this.Index,2),t==="&&"||t==="||"||t==="=="||t==="!="||t==="<="||t===">="||t==="=>"||t==":="||t=="OR"||t=="<>"?this.Index+=2:(t=this.Source[this.Index],"<>=!+-*%&|^/:".indexOf(t)>=0&&++this.Index))}return this.Index==r&&this.ThrowUnecpectedToken(),{Type:7,Value:t,LineNumber:this.LineNumber,LineStart:this.LineStart,Start:r,End:this.Index}},this.ScanStringLiteral=function(){var r=this.Index,t=this.Source[this.Index];++this.Index;for(var n="";!this.IsEOF();){var s=this.Source[this.Index++];if(s==t){t="";break}else{if(s=="\\")throw"not complete";if($e.IsLineTerminator(s.charCodeAt(0)))break;n+=s}}return t!=""&&(this.Index=r,this.ThrowUnecpectedToken()),{Type:8,Value:n,LineNumber:this.LineNumber,LineStart:this.LineStart,Start:r,End:this.Index}},this.ScanNumericLiteral=function(){var r=this.Index,t=this.Source[this.Index],n="";if(t!="."){if(n=this.Source[this.Index++],t=this.Source[this.Index],n=="0"&&(t=="x"||t=="X"))return++this.Index,this.ScanHexLiteral(r);for(;$e.IsDecimalDigit(this.Source.charCodeAt(this.Index));)n+=this.Source[this.Index++];t=this.Source[this.Index]}if(t=="."){for(n+=this.Source[this.Index++];$e.IsDecimalDigit(this.Source.charCodeAt(this.Index));)n+=this.Source[this.Index++];t=this.Source[this.Index]}if(t=="e"||t=="E")if(n+=this.Source[this.Index++],t=this.Source[this.Index],(t=="+"||t=="-")&&(n+=this.Source[this.Index]),$e.IsDecimalDigit(this.Source.charCodeAt(this.Index)))for(;$e.IsDecimalDigit(this.Source.charCodeAt(this.Index));)n+=this.Source[this.Index++];else this.ThrowUnecpectedToken();return $e.IsIdentifierStart(this.Source.charCodeAt(this.Index))&&this.ThrowUnecpectedToken(),{Type:6,Value:parseFloat(n),LineNumber:this.LineNumber,LineStart:this.LineStart,Start:r,End:this.Index}},this.ScanComments=function(){var r=void 0;for(this.Index==0;!this.IsEOF();){var t=this.Source.charCodeAt(this.Index);if($e.IsWhiteSpace(t))++this.Index;else if($e.IsLineTerminator(t))++this.Index,t==13&&this.Source.charCodeAt(this.Index)==10&&++this.Index,++this.LineNumber,this.LineStart=this.Index;else if(t==47)if(t=this.Source.charCodeAt(this.Index+1),t==47)this.Index+=2,this.SkipSingleLineComment(2);else break;else if(t==123)this.Index+=1,this.SkipMultiLineComment();else break}return r},this.SkipMultiLineComment=function(){for(var r=[];!this.IsEOF();){var t=this.Source.charCodeAt(this.Index);if($e.IsLineTerminator(t))++this.LineNumber,++this.Index,this.LineStart=this.Index;else{if(t==125)return this.Index+=1,r;++this.Index}}return r},this.SkipSingleLineComment=function(r){for(var t=[];!this.IsEOF();){var n=this.Source.charCodeAt(this.Index);if(++this.Index,$e.IsLineTerminator(n))return n===13&&this.Source.charCodeAt(this.Index)===10&&++this.Index,++this.LineNumber,this.LineStart=this.Index,t}return t},this.ThrowUnecpectedToken=function(r,t){return r||(r=vs.UnexpectedTokenIllegal),this.ErrorHandler.ThrowError(this.Index,this.LineNumber,this.Index-this.LineStart+1,r,t)}}function jm(e){this.ErrorHandler=new bn,this.Scanner=new xD(e,this.ErrorHandler),this.Buffer=[],this.GetNextToken=function(){if(this.Buffer.length==0&&(this.Scanner.ScanComments(),!this.Scanner.IsEOF())){var a=this.Scanner.Lex(),r={Type:qa[a.Type],Value:this.Scanner.Source.slice(a.Start,a.End)};this.Buffer.push(r)}return this.Buffer.shift()}}var ut={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};function tg(e){this.IsNeedIndexData=!1,this.IsNeedLatestIndexData=!1,this.IsNeedSymbolData=!1,this.IsNeedMarginData=new Fe.default,this.IsNeedNewsAnalysisData=new Fe.default,this.NeedBlockIncreaseData=[],this.IsNeedSymbolExData=new Fe.default,this.NeedHK2SHSZData=[],this.IsNeedSectionFinance=new Dt.default,this.FunctionData=[],this.Dynainfo=[],this.IsAPIData=[],this.ExecuteIndex=[],this.OtherSymbolData=[],this.PeriodSymbolData=[],this.ErrorHandler=e,this.GetDataJobList=function(){var a=[];this.IsNeedSymbolData&&a.push({ID:z.JOB_DOWNLOAD_SYMBOL_DATA}),this.IsNeedIndexData&&a.push({ID:z.JOB_DOWNLOAD_INDEX_DATA}),this.IsNeedLatestIndexData&&a.push({ID:z.JOB_DOWNLOAD_LATEST_INDEX_DATA});for(var r=0;r<this.Dynainfo.length;++r){var t=this.Dynainfo[r];a.push(t)}for(var r in this.NeedBlockIncreaseData)a.push(this.NeedBlockIncreaseData[r]);var n=!0,s=!1,o=void 0;try{for(var l=(0,ye.default)(this.IsNeedMarginData),h;!(n=(h=l.next()).done);n=!0){var u=h.value;a.push({ID:u})}}catch(H){s=!0,o=H}finally{try{!n&&l.return&&l.return()}finally{if(s)throw o}}for(var r in this.NeedHK2SHSZData)a.push(this.NeedHK2SHSZData[r]);var f=!0,C=!1,D=void 0;try{for(var c=(0,ye.default)(this.IsNeedNewsAnalysisData),T;!(f=(T=c.next()).done);f=!0){var u=T.value;a.push({ID:u})}}catch(H){C=!0,D=H}finally{try{!f&&c.return&&c.return()}finally{if(C)throw D}}var S=!0,I=!1,g=void 0;try{for(var E=(0,ye.default)(this.IsNeedSymbolExData),F;!(S=(F=E.next()).done);S=!0){var u=F.value;a.push({ID:u})}}catch(H){I=!0,g=H}finally{try{!S&&E.return&&E.return()}finally{if(I)throw g}}var R=!0,A=!1,P=void 0;try{for(var p=(0,ye.default)(this.IsNeedSectionFinance),w;!(R=(w=p.next()).done);R=!0){var t=w.value;a.push({ID:z.JOB_DOWNLOAD_SECTION_SF,SF:t})}}catch(H){A=!0,P=H}finally{try{!R&&p.return&&p.return()}finally{if(A)throw P}}for(var r in this.IsAPIData){var t=this.IsAPIData[r];a.push(t)}for(var r in this.ExecuteIndex){var t=this.ExecuteIndex[r];a.push(t)}for(var r in this.OtherSymbolData){var t=this.OtherSymbolData[r];a.push(t)}for(var r in this.PeriodSymbolData){var t=this.PeriodSymbolData[r];a.push(t)}for(var r in this.FunctionData){var t=this.FunctionData[r];a.push(t)}return a},this.VerifySymbolVariable=function(a,r){var t=new Fe.default(["INDEXA","INDEXC","INDEXH","INDEXL","INDEXO","INDEXV","INDEXDEC","INDEXADV"]);if(t.has(a)){this.IsNeedIndexData=!0;return}var n=new Fe.default(["CLOSE","C","VOL","V","OPEN","O","HIGH","H","LOW","L","AMOUNT","AMO","VOLINSTK"]);if(n.has(a)){this.IsNeedSymbolData=!0;return}a==="VOLR"&&(this.IsNeedSymbolExData.has(z.JOB_DOWNLOAD_VOLR_DATA)||this.IsNeedSymbolExData.add(z.JOB_DOWNLOAD_VOLR_DATA));var s=new Fe.default(["CAPITAL","TOTALCAPITAL","EXCHANGE","HYBLOCK","DYBLOCK","GNBLOCK","FGBLOCK","ZSBLOCK","ZHBLOCK","ZDBLOCK","HYZSCODE","GNBLOCKNUM","FGBLOCKNUM","ZSBLOCKNUM","ZHBLOCKNUM","ZDBLOCKNUM","HYSYL","HYSJL","FROMOPEN","LARGEINTRDVOL","LARGEOUTTRDVOL","TRADENUM","TRADEINNUM","TRADEOUTNUM","LARGETRDINNUM","LARGETRDOUTNUM","CUR_BUYORDER","CUR_SELLORDER","ACTINVOL","ACTOUTVOL","BIDORDERVOL","BIDCANCELVOL","AVGBIDPX","OFFERORDERVOL","OFFERCANCELVOL","AVGOFFERPX"]);if(s.has(a)){var o={ID:z.JOB_DOWNLOAD_VARIANT,VariantName:a};r&&(o.Token={Index:r.Start,Line:r.LineNumber}),this.FunctionData.push(o);return}if(a=="ADVANCE"||a=="DECLINE"){var o={ID:z.JOB_DOWNLOAD_INDEX_INCREASE_DATA,IsSelfSymbol:!0,FunctionName:a};r&&(o.Token={Index:r.Start,Line:r.LineNumber}),this.NeedBlockIncreaseData.push(o);return}if(a.indexOf("#")>0){var l=a.split("#");if(l.length!=2){var h=a+", 跨周期语法错误, 变量名#周期";this.ThrowUnexpectedToken(r,h)}else{var u=["C","CLOSE","O","OPEN","H","HIGH","L","LOW","AMOUNT","AMO","VOL","V","VOLINSTK"];if(u.indexOf(l[0])<0){var h=a+", 跨周期语法错误, 数据只支持'OPEN,HIGH,LOW,CLOSE,VOL,AMOUNT,VOLINSTK'";this.ThrowUnexpectedToken(r,h)}var f=["MIN1","MIN5","MIN15","MIN30","MIN60","MIN120","MIN240","DAY","WEEK","MONTH","SEASON","YEAR","HALFYEAR","WEEK2","MULTIDAY","DAY2","DAY3","DAY4","DAY5","DAY6","DAY7","DAY8","DAY9","DAY10","DAY11","DAY12","DAY13","DAY14","DAY15"];if(f.indexOf(l[1])<0){var h=a+", 跨周期语法错误， 周期只支持'MIN1,MIN5,MIN15,MIN30,MIN60,DAY,WEEK,MONTH,SEASON,YEAR'";this.ThrowUnexpectedToken(r,h)}var o={ID:z.JOB_DOWNLOAD_SYMBOL_PERIOD_DATA,VarName:a,ValueName:l[0],PeriodName:l[1]};r&&(o.Token={Index:r.Start,Line:r.LineNumber}),this.PeriodSymbolData.push(o)}return}if(Yt.IsCustomVariant(a)){var o={VariantName:a,ID:z.JOB_CUSTOM_VARIANT_DATA};r&&(o.Token={Index:r.Start,Line:r.LineNumber}),this.FunctionData.push(o);return}},this.VerifySymbolLiteral=function(a,r){if(v.IsString(a)&&a.indexOf("$")>0){var t=a.split("$");if(t.length!=2)return;var n={Literal:a,ID:z.JOB_DOWNLOAD_OTHER_SYMBOL_DATA};r&&(n.Token={Index:r.Start,Line:r.LineNumber}),this.OtherSymbolData.push(n)}},this.VerifySymbolFunction=function(a,r,t){if(Yt.IsCustomFunction(a.Name)){var n={FunctionName:a.Name,ID:z.JOB_CUSTOM_FUNCTION_DATA,Args:r};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(n);return}if(Yt.IsCustomDataFunction(a.Name)){var n={FunctionName:a.Name,ID:z.JOB_CUSTOM_DATA_FUNCTION,Args:r};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(n);return}if(a.Name=="DYNAINFO"){var n={ID:z.JOB_DOWNLOAD_SYMBOL_LATEST_DATA,Args:r,FunctionName:a.Name};this.Dynainfo.push(n);return}if(a.Name=="FINANCE"){var n={ID:z.JOB_DOWNLOAD_FINANCE,Args:r,FunctionName:a.Name};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(n);return}if(a.Name=="FINVALUE"){var n={ID:z.JOB_DOWNLOAD_FINVALUE,Args:r,FunctionName:a.Name};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(n);return}if(a.Name=="FINONE"){var n={ID:z.JOB_DOWNLOAD_FINONE,Args:r,FunctionName:a.Name};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(n);return}for(var s=0;s<cn.length;++s){var o=cn[s];if(o.Name==a.Name){var n={ID:o.JobID,Args:r,FunctionName:a.Name};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(n);return}}if(a.Name==="MARGIN"){var l=z.GetMarginJobID(r[0].Value);l&&!this.IsNeedMarginData.has(l)&&this.IsNeedMarginData.add(l);return}if(a.Name==="NEWS"){var h=z.GetNewsAnalysisID(r[0].Value);h&&!this.IsNeedNewsAnalysisData.has(h)&&this.IsNeedNewsAnalysisData.add(h);return}if(a.Name==="HK2SHSZ"){var n={ID:z.JOB_DOWNLOAD_HK_TO_SHSZ,Args:r,FunctionName:a.Name};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.NeedHK2SHSZData.push(n);return}if(a.Name=="COST"||a.Name=="WINNER"||a.Name=="PPART"||a.Name=="COSTEX"||a.Name=="LWINNER"||a.Name=="PWINNER"){var n={ID:z.JOB_DOWNLOAD_FINANCE,Args:[7],FunctionName:"FINANCE",FunctionName2:a.Name};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(n);return}if(a.Name=="INBLOCK"){var n={ID:z.JOB_DOWNLOAD_VARIANT,VariantName:"INBLOCK"};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(n);return}if(a.Name==="BETA"){this.IsNeedIndexData=!0;return}if(a.Name=="UPCOUNT"||a.Name=="DOWNCOUNT"){var n={ID:z.JOB_DOWNLOAD_INDEX_INCREASE_DATA,Args:r,FunctionName:a.Name};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.NeedBlockIncreaseData.push(n);return}if(a.Name=="STKINDI"||a.Name=="CALCSTOCKINDEX"){var n={ID:z.JOB_EXECUTE_INDEX,Args:r,FunctionName:a.Name};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.ExecuteIndex.push(n);return}if(a.Type==ut.Literal){var n={ID:z.JOB_EXECUTE_INDEX,Args:r,FunctionName:a.Value,DynamicName:a.Value};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.ExecuteIndex.push(n);return}if(a.Name=="COVER_C"||a.Name=="COVER_O"||a.Name=="COVER_H"||a.Name=="COVER_L"||a.Name=="COVER_A"||a.Name=="COVER_V"){var u=r[0].Value,f=["MIN1","MIN5","MIN15","MIN30","MIN60","DAY","WEEK","MONTH","SEASON","YEAR"];if(f.indexOf(u)<0){var C=a.Name+", 跨周期函数错误， 周期只支持'MIN1,MIN5,MIN15,MIN30,MIN60,DAY,WEEK,MONTH,SEASON,YEAR'";this.ThrowUnexpectedToken(t,C)}var D=za.GetConvertValueName(a.Name),n={ID:z.JOB_DOWNLOAD_SYMBOL_PERIOD_DATA,FunctionName:a.Name,ValueName:D,PeriodName:u};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.PeriodSymbolData.push(n);return}if(a.Name=="SF"){var c=z.GetSectionReportPeriod(r[0].Value,r[1].Value);if(!c)return;var T=z.GetSectionFinanceID(r[2].Value);if(!T)return;var S=c.Year+"-"+c.Quarter;if(this.IsNeedSectionFinance.has(S)){var I=this.IsNeedSectionFinance.get(S);I.Fields.has(T)||I.Fields.add(T)}else{var I={Period:c,Fields:new Fe.default([T])};this.IsNeedSectionFinance.set(S,I)}return}if(a.Name=="LOADAPIDATA"){var n={Name:a.Name,ID:z.JOB_DOWNLOAD_CUSTOM_API_DATA,Args:r};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.IsAPIData.push(n);return}var g=new Fe.default(["CLOSE","C","VOL","V","OPEN","O","HIGH","H","LOW","L","AMOUNT","AMO","VOLINSTK"]);if(g.has(a.Name)){var n={Name:a.Name,ID:z.JOB_DOWNLOAD_OTHER_SYMBOL_DATA,Args:r};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.OtherSymbolData.push(n);return}},this.VerifyMemberVariable=function(a,r,t){var n={ID:z.JOB_EXECUTE_INDEX,Member:{Object:a,Property:r}};t&&(n.Token={Index:t.Start,Line:t.LineNumber}),this.ExecuteIndex.push(n)},this.ExpressionStatement=function(a){return{Type:ut.ExpressionStatement,Expression:a}},this.Script=function(a){return{Type:ut.Program,Body:a,SourceType:"通达信脚本"}},this.SequenceExpression=function(a){return{Type:ut.SequenceExpression,Expression:a}},this.BinaryExpression=function(a,r,t){var n=a==="||"||a==="&&"||a=="AND"||a=="OR",s=n?ut.LogicalExpression:ut.BinaryExpression;return{Type:s,Operator:a,Left:r,Right:t}},this.Literal=function(a,r,t){return this.VerifySymbolLiteral(a,t),{Type:ut.Literal,Value:a,Raw:r}},this.Identifier=function(a,r){return this.VerifySymbolVariable(a,r),{Type:ut.Identifier,Name:a}},this.MemberIdentifier=function(a,r){return{Type:ut.Identifier,Name:a}},this.AssignmentExpression=function(a,r,t){return{Type:ut.AssignmentExpression,Operator:a,Left:r,Right:t}},this.UnaryExpression=function(a,r){return{Type:ut.UnaryExpression,Operator:a,Argument:r,Prefix:!0}},this.EmptyStatement=function(){return{Type:ut.EmptyStatement}},this.CallExpression=function(a,r,t){return this.VerifySymbolFunction(a,r,t),{Type:ut.CallExpression,Callee:a,Arguments:r}},this.StaticMemberExpression=function(a,r,t){return this.VerifyMemberVariable(a,r,t),{Type:ut.MemberExpression,Computed:!1,Object:a,Property:r}},this.Directive=function(a,r){return{Type:ut.ExpressionStatement,Expression:a,Directive:r}},this.ThrowUnexpectedToken=function(a,r){throw this.UnexpectedTokenError(a,r)},this.UnexpectedTokenError=function(a,r){var t=r||vs.UnexpectedToken,n="ILLEGAL";if(a&&(n=a.Value),t=t.replace("%0",n),a&&typeof a.LineNumber=="number"){var s=a.Start,o=a.LineNumber,l=-1;return this.ErrorHandler.CreateError(s,o,l,t)}}}function Tl(e){this.ErrorHandler=new bn,this.Scanner=new xD(e,this.ErrorHandler),this.Node=new tg(this.ErrorHandler),this.LookAhead={Type:2,Value:"",LineNumber:this.Scanner.LineNumber,LineStart:0,Start:0,End:0},this.HasLineTerminator=!1,this.Context={IsModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,FirstCoverInitializedNameError:null,IsAssignmentTarget:!1,IsBindingElement:!1,InFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},Strict:!1},this.PeratorPrecedence={")":0,";":0,",":0,"]":0,"||":1,OR:1,"&&":2,AND:2,"|":3,"^":4,"&":5,"==":6,"=":6,"!=":6,"<>":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.StartMarker={Index:0,Line:this.Scanner.LineNumber,Column:0},this.LastMarker={Index:0,Line:this.Scanner.LineNumber,Column:0},this.Initialize=function(){this.NextToken(),this.LastMarker={Index:this.Scanner.Index,Line:this.Scanner.LineNumber,Column:this.Scanner.Index-this.Scanner.LineStart}},this.CreateNode=function(){return{Index:this.StartMarker.Index,Line:this.StartMarker.Line,Column:this.StartMarker.Column}},this.StartNode=function(a,r){r==null&&(r=0);var t=a.Start-a.LineStart,n=a.LineNumber;return t<0&&(t+=r,n--),{Index:a.Start,Line:n,Column:t}},this.Match=function(a){return this.LookAhead.Type==7&&this.LookAhead.Value==a},this.Expect=function(a,r){var t=this.NextToken();(t.Type!=7||t.Value!=a)&&this.ThrowUnexpectedToken(t,r)},this.MatchAssign=function(){if(this.LookAhead.Type!=7)return!1;var a=this.LookAhead.Value;return a==":"||a==":="},this.GetTokenRaw=function(a){return this.Scanner.Source.slice(a.Start,a.End)},this.NextToken=function(){var a=this.LookAhead;this.LastMarker.Index=this.Scanner.Index,this.LastMarker.Line=this.Scanner.LineNumber,this.LastMarker.Column=this.Scanner.Index-this.Scanner.LineStart,this.CollectComments(),this.Scanner.Index!==this.StartMarker.Index&&(this.StartMarker.Index=this.Scanner.Index,this.StartMarker.Line=this.Scanner.LineNumber,this.StartMarker.Column=this.Scanner.Index-this.Scanner.LineStart);var r=this.Scanner.Lex();return this.HasLineTerminator=a.LineNumber!=r.LineNumber,r&&this.Context.Strict&&r.Type==3,this.LookAhead=r,a},this.CollectComments=function(){this.Scanner.ScanComments()},this.ParseScript=function(){for(var a=this.CreateNode(),r=this.ParseDirectivePrologues();this.LookAhead.Type!=2;)r.push(this.ParseStatementListItem());return this.Finalize(a,this.Node.Script(r))},this.ParseDirective=function(){var a=this.LookAhead,r=this.CreateNode(),t=this.ParseExpression(),n=t.Type===ut.Literal?this.GetTokenRaw(a).slice(1,-1):null;return this.ConsumeSemicolon(),this.Finalize(r,n?this.Node.Directive(t,n):this.Node.ExpressionStatement(t))},this.ParseDirectivePrologues=function(){for(var a=[];;){var r=this.LookAhead;if(r.Type!=8)break;var t=this.ParseDirective();a.push(t)}return a},this.ParseStatementListItem=function(){var a=void 0;return this.Context.IsAssignmentTarget=!0,this.Context.IsBindingElement=!0,this.LookAhead.Type==4||(a=this.ParseStatement()),a},this.ParseStatement=function(){var a=void 0;switch(this.LookAhead.Type){case 1:case 5:case 6:case 8:case 10:case 9:a=this.ParseExpressionStatement();break;case 7:var r=this.LookAhead.Value;r==="("?a=this.ParseExpressionStatement():r===";"?a=this.ParseEmptyStatement():a=this.ParseExpressionStatement();break;case 3:a=this.ParseLabelledStatement();break;case 4:break;default:a="error"}return a},this.ParseEmptyStatement=function(){var a=this.CreateNode();return this.Expect(";"),this.Finalize(a,this.Node.EmptyStatement())},this.ParseLabelledStatement=function(){var a=this.CreateNode(),r=this.ParseExpression();this.ConsumeSemicolon();var t=new this.Node.ExpressionStatement(r);return this.Finalize(a,t)},this.ParseExpression=function(){var a=this.LookAhead,r=this.IsolateCoverGrammar(this.ParseAssignmentExpression);if(this.Match(",")){var t=[];for(t.push(r);this.LookAhead.Type!=2&&this.Match(",");)this.NextToken(),t.push(this.IsolateCoverGrammar(this.ParseAssignmentExpression));r=this.Finalize(this.StartNode(a),this.Node.SequenceExpression(t))}return r},this.ParseAssignmentExpression=function(){var a=void 0,r=this.LookAhead,t=r;if(a=this.ParseConditionalExpression(),this.MatchAssign()){if(!this.Context.IsAssignmentTarget){var n=a.Marker;this.ThrowUnexpectedError(n.Index,n.Line,n.Column,vs.InvalidLHSInAssignment)}!this.Match("=")&&!this.Match(":")?(this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1):this.ReinterpretExpressionAsPattern(a),t=this.NextToken();var s=t.Value,o=this.IsolateCoverGrammar(this.ParseAssignmentExpression);a=this.Finalize(this.StartNode(r),this.Node.AssignmentExpression(s,a,o)),this.Context.FirstCoverInitializedNameError=null}return a},this.ParseConditionalExpression=function(){this.LookAhead;var a=this.InheritCoverGrammar(this.ParseBinaryExpression);return a},this.ParseBinaryExpression=function(){var a=this.LookAhead,r=this.InheritCoverGrammar(this.ParseExponentiationExpression),t=this.LookAhead,n=this.BinaryPrecedence(t);if(n>0){this.NextToken(),this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1;for(var s=[a,this.LookAhead],o=r,l=this.IsolateCoverGrammar(this.ParseExponentiationExpression),h=[o,t.Value,l],u=[n];n=this.BinaryPrecedence(this.LookAhead),!(n<=0);){for(;h.length>2&&n<=u[u.length-1];){l=h.pop();var f=h.pop();u.pop(),o=h.pop(),s.pop();var C=this.StartNode(s[s.length-1]);h.push(this.Finalize(C,this.Node.BinaryExpression(f,o,l)))}h.push(this.NextToken().Value),u.push(n),s.push(this.LookAhead),h.push(this.IsolateCoverGrammar(this.ParseExponentiationExpression))}var D=h.length-1;r=h[D];for(var c=s.pop();D>1;){var T=s.pop(),S=c&&c.LineStart,I=this.StartNode(T,S),g=h[D-1];r=this.Finalize(I,this.Node.BinaryExpression(g,h[D-2],r)),D-=2,c=T}}return r},this.ParseExponentiationExpression=function(){this.LookAhead;var a=this.InheritCoverGrammar(this.ParseUnaryExpression);return a},this.ParseUnaryExpression=function(){var a=void 0;if(this.Match("+")||this.Match("-")){var r=this.StartNode(this.LookAhead),t=this.NextToken();a=this.InheritCoverGrammar(this.ParseUnaryExpression),a=this.Finalize(r,this.Node.UnaryExpression(t.Value,a)),this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1}else a=this.ParseUpdateExpression();return a},this.ParseUpdateExpression=function(){var a=void 0;return this.LookAhead,a=this.InheritCoverGrammar(this.ParseLeftHandSideExpressionAllowCall),a},this.ParseLeftHandSideExpressionAllowCall=function(){var a=this.LookAhead,r=void 0;for(r=this.InheritCoverGrammar(this.ParsePrimaryExpression);;)if(this.Match(".")){this.Context.IsBindingElement=!1,this.Context.IsAssignmentTarget=!0,this.Expect(".");var t=this.ParseMemberIdentifierName();r=this.Finalize(this.StartNode(a),this.Node.StaticMemberExpression(r,t,a))}else if(this.Match("(")){this.Context.IsBindingElement=!1,this.Context.IsAssignmentTarget=!1;var n=this.ParseArguments();r=this.Finalize(this.StartNode(a),this.Node.CallExpression(r,n,a))}else break;return r},this.IsIdentifierName=function(a){return a.Type===3||a.Type===4||a.Type===1||a.Type===5},this.ParseIdentifierName=function(){var a=this.CreateNode(),r=this.NextToken();return this.IsIdentifierName(r)||this.ThrowUnexpectedToken(r),this.Finalize(a,this.Node.Identifier(r.Value,r))},this.ParseMemberIdentifierName=function(){var a=this.CreateNode(),r=this.NextToken();return this.IsIdentifierName(r)||this.ThrowUnexpectedToken(r),this.Finalize(a,this.Node.MemberIdentifier(r.Value,r))},this.ParseArguments=function(){this.Expect("(");var a=[];if(!this.Match(")"))for(;;){var r=this.IsolateCoverGrammar(this.ParseAssignmentExpression);if(a.push(r),this.Match(")")||(this.ExpectCommaSeparator(),this.Match(")")))break}return this.Expect(")"),a},this.ExpectCommaSeparator=function(){this.Expect(",","函数参数格式错误")},this.ParsePrimaryExpression=function(){var a=this.CreateNode(),r=void 0,t,n;switch(this.LookAhead.Type){case 3:t=this.NextToken(),r=this.Finalize(a,this.Node.Identifier(t.Value,t));break;case 6:case 8:this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1,t=this.NextToken(),n=this.GetTokenRaw(t),r=this.Finalize(a,this.Node.Literal(t.Value,n,t));break;case 7:switch(this.LookAhead.Value){case"(":this.Context.IsBindingElement=!1,r=this.InheritCoverGrammar(this.ParseGroupExpression);break;default:r=this.ThrowUnexpectedToken(this.NextToken())}break;default:r=this.ThrowUnexpectedToken(this.NextToken())}return r},this.ParseGroupExpression=function(){var a=void 0;if(this.Expect("("),this.Match(")"))this.NextToken();else{this.LookAhead;var r=!1;if(this.Context.IsBindingElement=!0,a=this.InheritCoverGrammar(this.ParseAssignmentExpression),this.Match(",")){var t=[];for(this.Context.IsAssignmentTarget=!1,t.push(a);this.LookAhead.Type!=2&&this.Match(",");)this.NextToken(),this.Match(")")}r||(this.Expect(")"),this.Context.IsBindingElement=!1)}return a},this.ParseExpressionStatement=function(){var a=this.CreateNode(),r=this.ParseExpression();return this.ConsumeSemicolon(),this.Finalize(a,this.Node.ExpressionStatement(r))},this.ConsumeSemicolon=function(){this.Match(";")?this.NextToken():this.HasLineTerminator||(this.LastMarker.Index=this.StartMarker.Index,this.LastMarker.Line=this.StartMarker.Line,this.LastMarker.Column=this.StartMarker.Column)},this.ReinterpretExpressionAsPattern=function(a){switch(a.Type){}},this.Finalize=function(a,r){return r.Marker={Line:a.Line,Column:a.Column,Index:a.Index},r},this.BinaryPrecedence=function(a){var r=a.Value,t=void 0;return a.Type===7?t=this.PeratorPrecedence[r]||0:t=0,t},this.IsolateCoverGrammar=function(a){var r=this.Context.IsBindingElement,t=this.Context.IsAssignmentTarget,n=this.Context.FirstCoverInitializedNameError;this.Context.IsBindingElement=!0,this.Context.IsAssignmentTarget=!0,this.Context.FirstCoverInitializedNameError=null;var s=a.call(this);return this.Context.FirstCoverInitializedNameError!=null,this.Context.IsBindingElement=r,this.Context.IsAssignmentTarget=t,this.Context.FirstCoverInitializedNameError=n,s},this.InheritCoverGrammar=function(a){var r=this.Context.IsBindingElement,t=this.Context.IsAssignmentTarget,n=this.Context.FirstCoverInitializedNameError;this.Context.IsBindingElement=!0,this.Context.IsAssignmentTarget=!0,this.Context.FirstCoverInitializedNameError=null;var s=a.call(this);return this.Context.IsBindingElement=this.Context.IsBindingElement&&r,this.Context.IsAssignmentTarget=this.Context.IsAssignmentTarget&&t,this.Context.FirstCoverInitializedNameError=n||this.Context.FirstCoverInitializedNameError,s},this.ThrowUnexpectedToken=function(a,r){throw this.UnexpectedTokenError(a,r)},this.ThrowUnexpectedError=function(a,r,t,n){var s=n||"执行异常";return this.ErrorHandler.ThrowError(a,r,t,s)},this.UnexpectedTokenError=function(a,r){var t=r||vs.UnexpectedToken,n="ILLEGAL";if(a&&(n=a.Value),t=t.replace("%0",n),a&&typeof a.LineNumber=="number"){var s=a.Start,o=a.LineNumber,l=this.LastMarker.Index-this.LastMarker.Column,h=a.Start-l+1;return this.ErrorHandler.CreateError(s,o,h,t)}else{var u=this.LastMarker.Index,f=this.LastMarker.Line,C=this.LastMarker.Column+1;return this.ErrorHandler.CreateError(u,f,C,t)}}}function pi(e,a){this.ErrorHandler=e,this.SymbolData=a,this.Add=function(r,t){var n=typeof r=="number",s=typeof t=="number";if(n&&s)return r+t;var o=[];if(!n&&!s){for(var l=Math.max(r.length,t.length),h=0;h<l;++h)o[h]=null,h<r.length&&h<t.length&&this.IsNumber(r[h])&&this.IsNumber(t[h])&&(o[h]=r[h]+t[h]);return o}var u=void 0,f=void 0;n?(u=r,f=t):(u=t,f=r);for(var C in f)o[C]=null,this.IsNumber(f[C])&&this.IsNumber(u)&&(o[C]=u+f[C]);return o},this.Subtract=function(r,t){var n=typeof r=="number",s=typeof t=="number";if(n&&s)return r-t;var o=[];if(!n&&!s){for(var l=Math.max(r.length,t.length),h=0;h<l;++h)o[h]=null,h<r.length&&h<t.length&&this.IsNumber(r[h])&&this.IsNumber(t[h])&&(o[h]=r[h]-t[h]);return o}if(n)for(var u in t)o[u]=null,this.IsNumber(r)&&this.IsNumber(t[u])&&(o[u]=r-t[u]);else for(var f in r)o[f]=null,this.IsNumber(r[f])&&this.IsNumber(t)&&(o[f]=r[f]-t);return o},this.Multiply=function(r,t){var n=typeof r=="number",s=typeof t=="number";if(n&&s)return r*t;var o=[];if(!n&&!s){for(var l=Math.max(r.length,t.length),h=0;h<l;++h)o[h]=null,h<r.length&&h<t.length&&this.IsNumber(r[h])&&this.IsNumber(t[h])&&(o[h]=r[h]*t[h]);return o}var u=void 0,f=void 0;n?(u=r,f=t):(u=t,f=r);for(var C in f)o[C]=null,this.IsNumber(f[C])&&this.IsNumber(u)&&(o[C]=u*f[C]);return o},this.Divide=function(r,t){var n=typeof r=="number",s=typeof t=="number";if(n&&s)return t==0?null:r/t;var o=[];if(!n&&!s){for(var l=Math.max(r.length,t.length),h=0;h<l;++h)o[h]=null,h<r.length&&h<t.length&&this.IsNumber(r[h])&&this.IsDivideNumber(t[h])&&(o[h]=r[h]/t[h]);return o}if(n)for(var u in t)o[u]=null,this.IsNumber(r)&&this.IsDivideNumber(t[u])&&(o[u]=r/t[u]);else for(var f in r)o[f]=null,this.IsNumber(r[f])&&this.IsDivideNumber(t)&&(o[f]=r[f]/t);return o},this.GT=function(r,t){var n=v.IsNumber(r),s=v.IsNumber(t);if(n&&s)return r>t?1:0;var o=[];if(Array.isArray(r)&&Array.isArray(t)){for(var l=Math.max(r.length,t.length),h=0;h<l;++h)if(o[h]=null,h<r.length&&h<t.length){if(!v.IsVaild(r[h])||!v.IsVaild(t[h]))continue;!isNaN(r[h])&&!isNaN(t[h])&&(o[h]=r[h]>t[h]?1:0)}return o}if(n&&Array.isArray(t))for(var u in t)o[u]=null,v.IsVaild(r)&&v.IsVaild(t[u])&&!isNaN(r)&&!isNaN(t[u])&&(o[u]=r>t[u]?1:0);else if(s&&Array.isArray(r))for(var f in r)o[f]=null,v.IsVaild(r[f])&&v.IsVaild(t)&&!isNaN(r[f])&&!isNaN(t)&&(o[f]=r[f]>t?1:0);return o},this.GTE=function(r,t){var n=v.IsNumber(r),s=v.IsNumber(t);if(n&&s)return r>=t?1:0;var o=[];if(Array.isArray(r)&&Array.isArray(t)){for(var l=Math.max(r.length,t.length),h=0;h<l;++h)if(o[h]=null,h<r.length&&h<t.length){if(!v.IsVaild(r[h])||!v.IsVaild(t[h]))continue;o[h]=r[h]>=t[h]?1:0}return o}if(n&&Array.isArray(t))for(var u in t)o[u]=null,v.IsVaild(r)&&v.IsVaild(t[u])&&(o[u]=r>=t[u]?1:0);else if(s&&Array.isArray(r))for(var f in r)o[f]=null,v.IsVaild(r[f])&&v.IsVaild(t)&&(o[f]=r[f]>=t?1:0);return o},this.LT=function(r,t){var n=v.IsNumber(r),s=v.IsNumber(t);if(n&&s)return r<t?1:0;var o=[];if(Array.isArray(r)&&Array.isArray(t)){for(var l=Math.max(r.length,t.length),h=0;h<l;++h)if(o[h]=null,h<r.length&&h<t.length){if(!v.IsVaild(r[h])||!v.IsVaild(t[h]))continue;o[h]=r[h]<t[h]?1:0}return o}if(n&&Array.isArray(t))for(var u in t)o[u]=null,v.IsVaild(r)&&v.IsVaild(t[u])&&(o[u]=r<t[u]?1:0);else if(s&&Array.isArray(r))for(var f in r)o[f]=null,v.IsVaild(r[f])&&v.IsVaild(t)&&(o[f]=r[f]<t?1:0);return o},this.LTE=function(r,t){var n=v.IsNumber(r),s=v.IsNumber(t);if(n&&s)return r>=t?1:0;var o=[];if(Array.isArray(r)&&Array.isArray(t)){for(var l=Math.max(r.length,t.length),h=0;h<l;++h)if(o[h]=null,h<r.length&&h<t.length){if(!v.IsVaild(r[h])||!v.IsVaild(t[h]))continue;o[h]=r[h]<=t[h]?1:0}return o}if(n&&Array.isArray(t))for(var u in t)o[u]=null,v.IsVaild(r)&&v.IsVaild(t[u])&&(o[u]=r<=t[u]?1:0);else if(s&&Array.isArray(r))for(var f in r)o[f]=null,v.IsVaild(r[f])&&v.IsVaild(t)&&(o[f]=r[f]<=t?1:0);return o},this.EQ=function(r,t){var n=v.IsNumber(r),s=v.IsNumber(t);if(n&&s)return r==t?1:0;var o=[];if(Array.isArray(r)&&Array.isArray(t)){for(var l=Math.max(r.length,t.length),h=0;h<l;++h)o[h]=null,h<r.length&&h<t.length&&!isNaN(r[h])&&!isNaN(t[h])&&(o[h]=r[h]==t[h]?1:0);return o}if(n&&Array.isArray(t))for(var u in t)o[u]=null,!isNaN(r)&&!isNaN(t[u])&&(o[u]=r==t[u]?1:0);else if(s&&Array.isArray(r))for(var f in r)o[f]=null,!isNaN(r[f])&&!isNaN(t)&&(o[f]=r[f]==t?1:0);return o},this.NEQ=function(r,t){var n=v.IsNumber(r),s=v.IsNumber(t);if(n&&s)return r!=t?1:0;var o=[];if(Array.isArray(r)&&Array.isArray(t)){for(var l=Math.max(r.length,t.length),h=0;h<l;++h)o[h]=null,h<r.length&&h<t.length&&!isNaN(r[h])&&!isNaN(t[h])&&(o[h]=r[h]!=t[h]?1:0);return o}if(n&&Array.isArray(t))for(var u in t)o[u]=null,!isNaN(r)&&!isNaN(t[u])&&(o[u]=r!=t[u]?1:0);else if(s&&Array.isArray(r))for(var f in r)o[f]=null,!isNaN(r[f])&&!isNaN(t)&&(o[f]=r[f]!=t?1:0);return o},this.And=function(r,t){var n=typeof r=="number",s=typeof t=="number";if(n&&s)return r&&t?1:0;var o=[];if(!n&&!s){for(var l=Math.max(r.length,t.length),h=0;h<l;++h)o[h]=null,h<r.length&&h<t.length&&!isNaN(r[h])&&!isNaN(t[h])&&(o[h]=r[h]&&t[h]?1:0);return o}if(n)for(var u in t)o[u]=null,!isNaN(r)&&!isNaN(t[u])&&(o[u]=r&&t[u]?1:0);else for(var f in r)o[f]=null,!isNaN(r[f])&&!isNaN(t)&&(o[f]=r[f]&&t?1:0);return o},this.Or=function(r,t){var n=typeof r=="number",s=typeof t=="number";if(n&&s)return r||t?1:0;var o=[];if(!n&&!s){for(var l=Math.max(r.length,t.length),h=0;h<l;++h)o[h]=null,h<r.length&&h<t.length&&!isNaN(r[h])&&!isNaN(t[h])&&(o[h]=r[h]||t[h]?1:0);return o}if(n)for(var u in t)o[u]=null,!isNaN(r)&&!isNaN(t[u])&&(o[u]=r||t[u]?1:0);else for(var f in r)o[f]=null,!isNaN(r[f])&&!isNaN(t)&&(o[f]=r[f]||t?1:0);return o},this.IF=function(r,t,n){var s=this.IsNumber(r),o=this.IsNumber(t),l=this.IsNumber(n),h=Array.isArray(t),u=Array.isArray(n);if(s)return r?t:n;var f=[];for(var C in r)r[C]?o?f[C]=t:h?f[C]=t[C]:f[C]=null:l?f[C]=n:u?f[C]=n[C]:f[C]=null;return f},this.IFN=function(r,t,n){return this.IF(r,n,t)},this.REF=function(r,t){var n=[];if(typeof t=="number")if(v.IsNumber(r)){if(t<0)return n;var s=this.SymbolData.Data.Data;if(!s||s.length<=0)return n;for(var o=s.length,l=t;l<o;++l)n[l]=r}else{if(r.length<=0||t>=r.length)return n;n=r.slice(0,r.length-t);for(var h=r[0],u=0;u<t;++u)n.unshift(h)}else for(var f=0;f<r.length;++f)if(n[f]=null,!(f>=t.length)){var C=t[f];C>=0&&C<=f?n[f]=r[f-C]:f?n[f]=n[f-1]:n[f]=r[f]}return n},this.REFV=function(r,t){var n=[];if(typeof t=="number"){if(r.length<=0||t>=r.length)return n;n=r.slice(0,r.length-t);for(var s=0;s<t;++s)n.unshift(null)}else for(var o=0;o<r.length;++o)if(n[o]=null,!(o>=t.length)){var l=t[o];l>=0&&l<=o&&(n[o]=r[o-l])}return n},this.REFX=function(r,t){var n=[];if(typeof t=="number"){if(r.length<=0)return n;if(t>=r.length)return r.length>0?r[r.length-1]:n;n=r.slice(t,r.length);for(var s=r[r.length-1],o=0;o<t;++o)n.push(s)}else for(var l=r.length,h=0;h<r.length;++h)if(n[h]=null,!(h>=t.length)){var u=t[h];u>=0&&u+h<l?n[h]=r[h+u]:h?n[h]=n[h-1]:n[h]=r[h]}return n},this.REFXV=function(r,t){var n=[];if(typeof t=="number"){if(r.length<=0||t>=r.length)return n;n=r.slice(t,r.length);for(var s=0;s<t;++s)n.push(null)}else for(var o=r.length,l=0;l<r.length;++l)if(n[l]=null,!(l>=t.length)){var h=t[l];h>=0&&h+l<o&&(n[l]=r[l+h])}return n},this.MAX=function(r,t){if(r.length==0&&this.ThrowUnexpectedNode(t,"MAX() Error: 参数个数不能为0"),r.length==1)return r[0];var n=[],s=[];for(var o in r){var l=r[o];v.IsNumber(l)?s.push(l):Array.isArray(l)&&n.push(l)}var h=null;if(s.length>0){h=s[0];for(var o=1;o<s.length;++o)h=Math.max(h,s[o])}var u=null;if(n.length>0){u=n[0].slice(0);for(var o=1;o<n.length;++o){var f=n[o];for(var C in f){var D=u[C],l=f[C];if(v.IsNumber(D)){if(!v.IsNumber(l)){u[C]=null;continue}u[C]=Math.max(D,l)}}}}if(u==null&&h!=null)return h;if(u&&h==null)return u;for(var o in u)v.IsNumber(u[o])&&(u[o]=Math.max(u[o],h));return u},this.MIN=function(r,t){if(r.length==0&&this.ThrowUnexpectedNode(t,"MIN() Error: 参数个数不能为0"),r.length==1)return r[0];var n=[],s=[];for(var o in r){var l=r[o];v.IsNumber(l)?s.push(l):Array.isArray(l)&&n.push(l)}var h=null;if(s.length>0){h=s[0];for(var o=1;o<s.length;++o)h=Math.min(h,s[o])}var u=null;if(n.length>0){u=n[0].slice(0);for(var o=1;o<n.length;++o){var f=n[o];for(var C in f){var D=u[C],l=f[C];if(v.IsNumber(D)){if(!v.IsNumber(l)){u[C]=null;continue}u[C]=Math.min(D,l)}}}}if(u==null&&h!=null)return h;if(u&&h==null)return u;for(var o in u)v.IsNumber(u[o])&&(u[o]=Math.min(u[o],h));return u},this.ABS=function(r){var t=[];for(var n in r)t[n]=null,isNaN(r[n])||(t[n]=Math.abs(r[n]));return t},this.MA=function(r,t){var n=[];if(t<=0)return n;if(Array.isArray(t)){for(var s=0;s<r.length;++s)if(n[s]=null,!(s>=t.length)){var C=t[s];if(this.IsNumber(C)&&!(C<=0)){for(var D=0,c=0,T=s,S=0;T>=0&&S<C;--T,++S)D+=r[T],++c;c>0&&(n[s]=D/c)}}}else{if(t=parseInt(t),t<=0&&(t=1),!r||!r.length)return n;for(var s=0;s<r.length&&(n[s]=null,!this.IsNumber(r[s]));++s);for(var r=r.slice(0),o=0;s<r.length;++s,++o){if(o<t-1){n[s]=null;continue}for(var l=r[s-(t-1)],h=0,u=t-1;u>=0;--u){var f=r[s-u];this.IsNumber(f)?l=f:(f=l,r[s-u]=f),h+=f}n[s]=h/t}}return n},this.EMA=function(r,t){var n=[];if(r.length<=0)return n;if(Array.isArray(t))for(var s=0;s<t.length;++s){var o=t[s];if(this.IsNumber(o)&&(o=parseInt(o),!(o<=0))){o>s+1&&(o=s+1);for(var l=[2/(o+1),(o-1)/(o+1)],h=null,u=null,f=0;f<o;++f){var C=s-(o-f-1),D=r[C];this.IsNumber(D)||coninue,u==null?(h=D,u=h):(h=l[0]*D+l[1]*u,u=h)}n[s]=h}}else{if(t=parseInt(t),t<=0)return n;for(var c=0;c<r.length&&!(r[c]!=null&&!isNaN(r[c]));++c);var T=c,S=c+1;n[T]=r[T];for(var s=c+1;s<r.length;++s,++T,++S)n[S]=(2*r[S]+(t-1)*n[T])/(t+1)}return n},this.XMA=function(r,t){for(var n=[],s=0;s<r.length&&!this.IsNumber(r[s]);++s);for(var o=parseInt((t-2)/2),l=0,h=0,u=0,f=0,C=s,D=0;C<r.length;++C){for(u=C-o-1,f=C+(t-o)-1,D=u;D<f;++D)D>=0&&D<r.length&&this.IsNumber(r[D])&&(l+=r[D],++h);h!=0?n[C]=l/h:n[C]=null,l=0,h=0}return n},this.SMA=function(r,t,n){var s=[];if(Array.isArray(t))for(var o=0;o<t.length;++o){var l=t[o];if(this.IsNumber(l)&&(l=parseInt(l),!(l<=0))){l>o+1&&(l=o+1);for(var h=null,u=null,f=0;f<l;++f){var C=o-(l-f-1),D=r[C];this.IsNumber(D)&&(h==null?(h=D,u=D):(u=(n*D+(l-n)*h)/l,h=u))}s[o]=u}}else{for(var o=t,c=null;o<r.length;++o)if(!(r[o]==null||isNaN(r[o]))){c=r[o],s[o]=c;break}for(++o;o<r.length;++o)s[o]=(n*r[o]+(t-n)*c)/t,c=s[o]}return s},this.DMA=function(r,t){var n=[];if(r.length<0||r.length!=t.length)return n;for(var s=0;s<r.length;++s)if(r[s]!=null&&!isNaN(r[s])&&t[s]!=null&&!isNaN(t[s])){n[s]=r[s];break}for(s=s+1;s<r.length;++s)r[s]==null||t[s]==null?n[s]=null:t[s]<1?n[s]=t[s]*r[s]+(1-t[s])*n[s-1]:n[s]=r[s];return n},this.WMA=function(r,t){var n=[];if(!r||!r.length)return n;if(Array.isArray(t)){for(T=0;T<t.length&&T<r.length;++T){n[T]=null;var s=t[T];if(!(s<=0)){for(var o=0,l=0,h=0,u=0,f=0;f<s;++f)if(h=T-(s-f-1),l=r[h],o=f,this.IsNumber(l)){u=l;break}if(!(o>=s)){for(var C=0,D=0,f=o,c=1;f<s;++f,++c)h=T-(s-f-1),l=r[h],this.IsNumber(l)?u=l:l=u,D+=c,C+=l*c;n[T]=C/D}}}return n}else{if(t<=0)return[];var T=0;for(T=0;T<r.length&&!this.IsNumber(r[T]);++T)n[T]=null;for(var r=r.slice(0),S=0;T<r.length;++T,++S){if(S<t-1){n[T]=null;continue}for(var u=r[T-(t-1)],C=0,D=0,f=t-1;f>=0;--f){var l=r[T-f];this.IsNumber(l)?u=l:(l=u,r[T-f]=l),D+=t-f,C+=l*(t-f)}n[T]=C/D}return n}},this.MEMA=function(h,t){var n=[];if(!h||!h.length)return n;var s=0,o=0;for(o=0;o<h.length&&!this.IsNumber(h[o]);++o)n[o]=null;if(s=o,t<1||s+t>=h.length)return n;for(var l=0,h=h.slice(0);s<o+t;++s)n[s]=null,!this.IsNumber(h[s])&&s-1>=0&&(h[s]=h[s-1]),l+=h[s];for(n[s-1]=l/t;s<h.length;++s)this.IsNumber(n[s-1])&&this.IsNumber(h[s])?n[s]=(h[s]+n[s-1]*(t-1))/t:s-1>-1&&this.IsNumber(n[s-1])?n[s]=n[s-1]:n[s]=null;return n},this.EXPMA=function(r,t){var n=[];if(t>=r.length)return n;for(var s=t;s<r.length;++s)if(r[s]!=null){n[s]=r[s];break}for(s=s+1;s<r.length;++s)n[s-1]!=null&&r[s]!=null?n[s]=(2*r[s]+(t-1)*n[s-1])/(t+1):n[s-1]!=null&&(n[s]=n[s-1]);return n},this.EXPMEMA=function(r,t){var n=[];if(t>=r.length)return n;for(var s=0;s<r.length&&!(r[s]&&!isNaN(r[s]));++s);for(var o=0,l=0;s<r.length&&l<t;++l,++s)r[s]&&!isNaN(r[s])?o+=r[s]:o+=r[s-1];for(n[s-1]=o/t;s<r.length;++s)n[s-1]!=null&&r[s]!=null?n[s]=(2*r[s]+(t-1)*n[s-1])/(t+1):n[s-1]!=null&&(n[s]=n[s-1]);return n},this.SUMBARS=function(r,t){var n=[];if(!r||!r.length||!t||!t.length)return n;for(var s=0,o=0,l=0;s<r.length&&!this.IsNumber(r[s]);++s)n[s]=null;for(o=r.length-1;o>=s;--o){var h=0;for(l=o,h=0;l>=s&&h<t[o];--l)h+=r[l];l<s?n[o]=null:n[o]=o-l}for(o=s+1;o<r.length;++o)n[o]==null&&(n[o]=n[o-1]);return n},this.REVERSE=function(r){if(this.IsNumber(r))return 0-r;for(var t=[],n=0;n<r.length&&!this.IsNumber(r[n]);++n)t[n]=null;for(;n<r.length;++n)this.IsNumber(r[n])?t[n]=0-r[n]:t[n]=null;return t},this.COUNT=function(r,t){if(Array.isArray(t)){for(var n=null,s=r.length,o=0;o<s;++o)if(this.IsNumber(r[o])){n=o;break}if(n==null)return[];for(var l=[],h=0,o=0;o<t.length;++o){var u=t[o];if(u==0){l[o]=0;continue}v.IsNumber(u)?u<0&&(u=o+1):u=o+1,h=0;for(var f=o,C=0;f>=0&&C<u;--f,++C)r[f]&&++h;l[o]=h}return l}else{for(var u=t,s=r.length,u=u<1?s:u,o=0,f=0;o<s&&!this.IsNumber(r[o]);++o);for(var l=[],D=0;o<s&&f<u;++o,++f)D=r[o]?D+1:D,l[o]=D;for(;o<s;++o)r[o-u]&&D&&D--,D=r[o]?D+1:D,l[o]=D;return l}},this.HHV=function(r,t){var n=[];if(Array.isArray(t)){for(var s=null,o=0,l=0;o<r.length;++o)if(n[o]=null,!(o>=t.length)){s=null;var h=t[o];if(h>0&&h<=o)for(l=o-h;l<=o;++l)(s==null||s<r[l])&&(s=r[l]);else for(h=o,l=0;l<=o;++l)(s==null||s<r[l])&&(s=r[l]);n[o]=s}}else{if(!v.IsNonEmptyArray(r))return n;t=parseInt(t),(t<=0||t>r.length)&&(t=r.length);var u=this.GetFirstVaildIndex(r);if(u>=r.length)return n;var f=u;f<r.length&&(n[f]=r[f]);for(var o=f+1,l=2;o<r.length&&l<t;++o,++l)r[o]>=r[f]&&(f=o),n[o]=r[f];for(;o<r.length;++o){if(o-f<t)f=r[o]<r[f]?f:o;else for(l=f=o-t+1;l<=o;++l)f=r[l]<r[f]?f:l;n[o]=r[f]}}return n},this.HV=function(r,t){var n=this.HHV(r,t);return this.REF(n,1)},this.LLV=function(r,t){var n=[];if(Array.isArray(t)){for(var s=0;s<r.length;++s)if(n[s]=null,!(s>=t.length)){var o=null,l=t[s];if(l>0&&l<=s)for(var h=s-l;h<=s;++h)(o==null||o>r[h])&&(o=r[h]);else{l=s;for(var h=0;h<=s;++h)(o==null||o>r[h])&&(o=r[h])}n[s]=o}}else{if(!v.IsNonEmptyArray(r))return n;t=parseInt(t),(t<=0||t>r.length)&&(t=r.length);var u=this.GetFirstVaildIndex(r);if(u>=r.length)return n;var f=u;f<r.length&&(n[f]=r[f]);for(var s=f+1,h=2;s<r.length&&h<t;++s,++h)r[s]<=r[f]&&(f=s),n[s]=r[f];for(;s<r.length;++s){if(s-f<t)f=r[s]>r[f]?f:s;else for(h=f=s-t+1;h<=s;++h)f=r[h]>r[f]?f:h;n[s]=r[f]}}return n},this.LV=function(r,t){var n=this.LLV(r,t);return this.REF(n,1)},this.STD=function(r,t){var n=[];if(!Array.isArray(r))return n;var s=this.GetFirstVaildIndex(r);if(!v.IsNumber(t)||s+t>r.length||t<1)return n;var o=s,l=0,h=!0,u=0,f=0;for(o+=t-1;o<r.length;++o){if(u=0,h){for(h=!1,l=o-t+1;l<=o;++l)f+=r[l];f/=t}else f+=(r[o]-r[o-t])/t;for(l=o-t+1;l<=o;++l)u+=(r[l]-f)*(r[l]-f);n[o]=Math.sqrt(u/(t-1))}return n},this.STDDEV=function(r,t){var n=[];if(!Array.isArray(r))return n;var s=this.GetFirstVaildIndex(r);if(!v.IsNumber(t)||s+t>r.length||t<1)return n;var o=s,l=0,h=!0,u=0,f=0;for(o+=t-1;o<r.length;++o){if(u=0,h){for(h=!1,l=o-t+1;l<=o;++l)f+=r[l];f/=t}else f+=(r[o]-r[o-t])/t;for(l=o-t+1;l<=o;++l)u+=(r[l]-f)*(r[l]-f);n[o]=Math.sqrt(u/(t-1))/Math.sqrt(t)}return n},this.AVEDEV=function(r,t){for(var n=[],s=0,o=[],l=t-1;l<r.length;++l){s=0;for(var h=0;h<t;++h)s+=r[l-h];o[l]=s/t}for(var l=t-1;l<r.length;++l){s=0;for(var h=0;h<t;++h)s+=Math.abs(r[l-h]-o[l]);n[l]=s/t}return n},this.CROSS=function(r,t){var n=[];if(Array.isArray(r)&&Array.isArray(t)){if(r.length!=t.length)return n=[];for(var s=0;s<r.length&&!(this.IsNumber(r[s])&&this.IsNumber(t[s]));++s);for(++s;s<r.length;++s)n[s]=r[s]>t[s]&&r[s-1]<t[s-1]?1:0}else if(Array.isArray(r)&&typeof t=="number"){for(var s=0;s<r.length&&!this.IsNumber(r[s]);++s);for(++s;s<r.length;++s)n[s]=r[s]>t&&r[s-1]<t?1:0}else if(typeof r=="number"&&Array.isArray(t)){for(var s=0;s<t.length&&!this.IsNumber(t[s]);++s);for(++s;s<t.length;++s)n[s]=t[s]<r&&t[s-1]>r?1:0}return n},this.CROSSDOWN=function(r,t){return this.CROSS(t,r)},this.CROSSUP=function(r,t){return this.CROSS(r,t)},this.MULAR=function(r,t){var n=[];if(Array.isArray(t))for(var o=0;o<r.length;++o){n[o]=null;var u=t[o];if(this.IsNumber(u)&&(u=parseInt(u),!(u<0)))for(var l=o,h=0;l>=0&&h<u;--l,++h)h==0?n[o]=r[l]:n[o]*=r[l]}else{if(r.length<t)return n;if(t==0){for(var s=t;s<r.length;++s)if(this.IsNumber(r[s])){n[s]=r[s];break}for(++s;s<r.length;++s)n[s]=n[s-1]*r[s]}else for(var o=t-1,l=0;o<r.length;++o,++l)for(var h=0;h<t;++h)h==0?n[o]=r[h+l]:n[o]*=r[h+l]}return n},this.SUM=function(r,t){var n=[];if(Array.isArray(t))for(var o=0;o<r.length;++o){n[o]=null;var u=t[o];if(u>0)for(var l=o,h=0;l>=0&&h<u;--l,++h)h==0?n[o]=r[l]:n[o]+=r[l]}else if(t<=0){for(var s=-1,o=0;o<r.length;++o)if(v.IsNumber(r[o])){s=o;break}if(s<0)return n;n[s]=r[s];for(var o=s+1;o<r.length;++o)n[o]=n[o-1]+r[o]}else{n[0]=r[0];for(var o=1;o<t&&o<r.length;++o)n[o]=n[o-1]+r[o];for(var o=t-1,l=0;o<r.length;++o,++l)for(var h=0;h<t;++h)h==0?n[o]=r[h+l]:n[o]+=r[h+l]}return n},this.BARSCOUNT=function(r){var t=[],n=null;for(var s in r){if(t[s]=0,n==null){if(!this.IsNumber(r[s]))continue;n=0}t[s]=n,++n}return t},this.DEVSQ=function(r,t){if(this.IsNumber(r)&&this.IsNumber(t))return 0;var n=[];if(Array.isArray(r)){var s=null;if(Array.isArray(t)){for(var l=t.length-1;l>=0;--l)if(this.IsNumber(t[l])){s=parseInt(t[l]);break}}else s=parseInt(t);if(!this.IsNumber(s))return n;var o=r.length,l=0,h=0,u=0,f=0,C=0;for(l=0;l<o&&!this.IsNumber(r[l]);++l)n[l]=null;if(s<1||l+s>o)return n;for(f=0;l<o&&h<s;++l,++h)f+=r[l]/s;if(h==s){for(C=0,l--;u<s;u++)C+=(r[l-u]-f)*(r[l-u]-f);n[l]=C,l++}for(;l<o;++l){for(f+=(r[l]-r[l-s])/s,C=0,u=0;u<s;++u)C+=(r[l-u]-f)*(r[l-u]-f);n[l]=C}}return n},this.NOT=function(r){var t=typeof r=="number";if(t)return r?0:1;var n=[];for(var s in r)n[s]=null,this.IsNumber(r[s])&&(n[s]=r[s]?0:1);return n},this.FORCAST=function(r,t){var n=[];typeof t!="number"&&(t=parseInt(t));var s=t,o=r.length;if(s<1||s>=o)return n;var l=0,h=0,u=0,f=0,C,D,c,T,S;for(T=0;T<o&&!this.IsNumber(r[T]);++T)n[T]=null;for(c=T+s-1;c<o;++c){for(l=h=u=f=0,T=0,S=s;T<s&&T<=c;++T,--S)l+=S,h+=r[c-T];for(l/=s,h/=s,T=0,S=s;T<s&&T<=c;++T,--S)u+=(S-l)*(r[c-T]-h),f+=(S-l)*(S-l);D=u/f,C=h-l*D,n[c]=D*s+C}return n},this.TSMA=function(r,t){var n=[];typeof t!="number"&&(t=parseInt(t));var s=t,o=r.length;if(s<1||s>=o)return n;var l=0,h=0,u=0,f=0,C,D,c,T,S;for(T=0;T<o&&!this.IsNumber(r[T]);++T)n[T]=null;for(c=T+s-1;c<o;++c){for(l=h=u=f=0,T=0,S=s;T<s&&T<=c;++T,--S)l+=S,h+=r[c-T];for(l/=s,h/=s,T=0,S=s;T<s&&T<=c;++T,--S)u+=(S-l)*(r[c-T]-h),f+=(S-l)*(S-l);D=u/f,C=h-l*D,n[c]=D*s+C+D}return n},this.SLOPE=function(r,t){var n=[];if(typeof t!="number"&&(t=parseInt(t)),t<1||!r.length||t>=r.length)return n;for(var s=0,o=0;o<r.length&&(n[o]=null,!this.IsNumber(r[o]));++o,++s);for(var l=void 0,h=void 0,u=void 0,f=void 0,C=s+t-1;C<r.length;++C){n[C]=null,l=h=u=f=0;for(var D=0;D<t&&D<=C;++D)l+=C-D,h+=r[C-D];for(l=l/t,h=h/t,D=0;D<t&&D<=C;++D)u+=(C-D-l)*(r[C-D]-h),f+=(C-D-l)*(C-D-l);f?n[C]=u/f:C&&(n[C]=n[C-1])}return n},this.STDP=function(r,t){var n=[];if(!Array.isArray(r))return n;var s=this.GetFirstVaildIndex(r);if(!v.IsNumber(t)||s+t>r.length||t<1)return n;var o=s,l=0,h=!0,u=0,f=0;for(o+=t-1;o<r.length;++o){if(u=0,h){for(h=!1,l=o-t+1;l<=o;++l)f+=r[l];f/=t}else f+=(r[o]-r[o-t])/t;for(l=o-t+1;l<=o;++l)u+=(r[l]-f)*(r[l]-f);n[o]=Math.sqrt(u/t)}return n},this.VAR=function(r,t){if(this.IsNumber(r)&&this.IsNumber(t))return 0;var n=[];if(Array.isArray(r)&&this.IsNumber(t)){var s=parseInt(t),o=r.length;if(s<=0||s>=o)return n;var l,h;for(l=0;l<o&&!this.IsNumber(r[l]);++l)n[l]=null;var u,f;for(h=0,l=l+s-1;l<o;++l){for(u=f=0,h=0;h<s&&h<=l;++h)u+=r[l-h]*r[l-h],f+=r[l-h];n[l]=(s*u-f*f)/s*(s-1)}}else if(Array.isArray(r)&&Array.isArray(t))for(var C=this.GetFirstVaildIndex(r),l=C;l<r.length;++l){var u=f=0;if(this.IsNumber(t[l])){var s=parseInt(t[l]);if(!(s<=0||l-(s-1)<0)){for(var h=0;h<s;++h)u+=r[l-h]*r[l-h],f+=r[l-h];n[l]=(s*u-f*f)/s*(s-1)}}}return n},this.VARP=function(r,t){var n=[];typeof t!="number"&&(t=parseInt(t));var s=t,o=r.length;if(s<1||s>=o)return n;var l=0,h=0;for(l=0;l<o&&!this.IsNumber(r[l]);++l)n[l]=null;for(var u=0,f=0;l<o&&h<s;++l,++h)u+=r[l]*r[l],f+=r[l];for(h==s&&(n[l-1]=(s*u-f*f)/(s*s));l<o;++l)u+=r[l]*r[l]-r[l-s]*r[l-s],f+=r[l]-r[l-s],n[l]=(s*u-f*f)/(s*s);return n},this.RANGE=function(r,t,n){var s=typeof r=="number",o=typeof t=="number",l=typeof n=="number";if(s&&o&&l)return r>Math.min(t,n)&&r<Math.max(t,n)?1:0;for(var h=[],u=void 0,f=void 0,C=0;C<r.length;++C)if(h[C]=null,u=r[C],!!this.IsNumber(u)){if(o)f=t;else{if(C>=t.length)continue;f=t[C]}if(this.IsNumber(f)){if(l)rangeValue2=n;else{if(C>=n.length)continue;rangeValue2=n[C]}this.IsNumber(rangeValue2)&&(h[C]=u>Math.min(f,rangeValue2)&&u<Math.max(f,rangeValue2)?1:0)}}return h},this.EXIST=function(r,t){if(typeof r=="number")return 0;if(Array.isArray(t)){var n=[];if(r.length<=0)return n;for(var s in r)n[s]=0;for(var s=0;s<t.length&&s<r.length;++s){var o=t[s];if(this.IsNumber(o)&&(o=parseInt(o),!(o<=0))){o>s+1&&(o=s+1);for(var l=!1,h=0,u=0;u<o;++u)if(h=r[s],this.IsNumber(h)&&h>0){l=!0;break}n[s]=l?1:0}}return n}else{t=parseInt(t);for(var f=null,n=[],h,C=0;C<r.length;++C)n[C]=null,h=r[C],this.IsNumber(h)&&h>0&&(f=C),f!=null&&C-f<t?n[C]=1:n[C]=0;return n}},this.TFILTER=function(r,t,n){if(!this.IsNumber(n))return[];if(n==1)return this.And(r,this.EQ(this.COUNT(r,this.BARSLAST(t)),1));if(n==2)return this.And(t,this.EQ(this.COUNT(t,this.BARSLAST(r)),1));if(n==0){for(var s=this.And(t,this.EQ(this.COUNT(t,this.BARSLAST(r)),1)),o=this.And(t,this.EQ(this.COUNT(t,this.BARSLAST(r)),1)),l=0;l<s.length;++l){var h=o[l];h>0&&(s[l]=2)}return s}return[]},this.FILTER=function(r,t){for(var n=[],s=0,o=0;s<r.length;++s)if(r[s]){for(n[s]=1,o=0;o<t&&o+s+1<r.length;++o)n[o+s+1]=0;s+=t}else n[s]=0;return n},this.FILTERX=function(r,t,n){for(var s=[],o=0,l=0;o<r.length;++o)if(r[o]){for(s[o]=1,l=0;l<t&&o-l-1>=0;++l)s[o-l-1]=0;o+=t}else s[o]=0;return s},this.BARSLAST=function(r){var t=[];if(!r)return t;for(var n=null,s=0;s<r.length;++s)t[s]=null,r[s]>0?n=0:n!=null&&++n,n!=null&&(t[s]=n);return t},this.BARSLASTS=function(r,t,n){var s=[];if(!r)return s;t<=0&&(t=r.length);for(var o=null,l=0,h=0,u=0;u<r.length;++u){s[u]=null;var f=r[u];f>0?(o==null?(o=0,++h):(++h,h>t&&(o-=l)),l=0):o!=null&&(++o,++l),o!=null&&(s[u]=o)}return s},this.BARSSINCEN=function(r,t){var n=[];if(this.IsNumber(t)&&Array.isArray(r)){var s=t;s<1&&(s=r.length);var o=this.GetFirstVaildIndex(r);if(o>=r.length)return n;var l=0;for(o<=s-1?l=s-1:l=o,n[l]=l-o;l<r.length;++l)if(this.IsNumber(n[l-1])){if(n[l-1]+1<s)n[l]=n[l-1]+1;else for(var h=l-s+1;h<=l;++h)if(!(Math.abs(r[h])<1e-6)){n[l]=l-h;break}}else Math.abs(r[l])<1e-6||(n[l]=0)}return n},this.BARSSINCE=function(r){for(var t=[],n=null,s=0;s<r.length;++s)t[s]=null,n==null?r[s]&&(n=0):++n,n&&(t[s]=n);return t},this.Trigonometric=function(r,t){if(Array.isArray(r)){var n=[];for(var s in r){var o=r[s];this.IsNumber(o)?n[s]=t(o):n[s]=null}return n}else return this.IsNumber(r)?t(r):null},this.ASIN=function(r){if(Array.isArray(r)){var t=[];for(var n in r){var s=r[n];if(t[n]=null,this.IsNumber(s)){if(s>=-1&&s<=1)t[n]=Math.asin(s);else if(n-1>=0){var o=t[n-1];this.IsNumber(o)&&(t[n]=o)}}}return t}else return this.IsNumber(r)?Math.acos(r):null},this.ACOS=function(r){if(Array.isArray(r)){var t=[];for(var n in r){var s=r[n];if(t[n]=null,this.IsNumber(s)){if(s>=-1&&s<=1)t[n]=Math.acos(s);else if(n-1>=0){var o=t[n-1];this.IsNumber(o)&&(t[n]=o)}}}return t}else return this.IsNumber(r)?Math.acos(r):null},this.LAST=function(r,t,n){if(!Array.isArray(r))return[];for(var s=[],o=r.length,l=t,h=n,u=0,f=0,C=0,D=0;u<o&&!r[u];++u);for(f=u,D=u-h+1;f<o;++f,++D){for(C=l==0?u:Math.max(u,f-l);C<D&&!(r[C]<=0);++C);s[f]=C<D?0:1}return s},this.ZIG=function(r,t){var n=this.SymbolData.Data,s=[];if(typeof r=="number")switch(r){case 0:r=n.GetOpen();break;case 1:r=n.GetHigh();break;case 2:r=n.GetLow();break;case 3:r=n.GetClose();break;default:return s}return this.ZIG_Calculate(r,t)},this.GetFirstVaildIndex=function(r){for(var t=0;t<r.length;++t)if(this.IsNumber(r[t]))return t;return r.length},this.ZIG_Calculate=function(r,t){var n=[],s=r.length,o=this.GetFirstVaildIndex(r),l=0,h=0,u=0,f=0,C=0;for(l=o+1,h=u=o;l<s-1&&u==o;++l)u=Math.abs(r[l]-r[o])*100>=t*r[o]?r[l]>r[o]?l:-l:o;for(;l<s-1;++l)if(r[l]>=r[l-1]&&r[l]>=r[l+1])if(u<0){if((r[l]-r[-u])*100<t*r[-u])continue;for(C=(r[h]-r[f=-u])/(-u-h),n[f--]=r[-u];f>=h;f--)n[f]=r[-u]+(-u-f)*C;h=-u,u=l}else r[l]>r[u]&&(u=l);else if(r[l]<=r[l-1]&&r[l]<=r[l+1])if(u>0){if((r[u]-r[l])*100<t*r[u])continue;for(C=(r[u]-r[f=h])/(u-h),n[f++]=r[h];f<=u;++f)n[f]=r[h]+(f-h)*C;h=u,u=-l}else r[l]<r[-u]&&(u=-l);if(Math.abs(u)>=s-2&&(u>0&&r[s-1]>=r[u]&&(u=s-1),u<0&&r[s-1]<=r[-u]&&(u=1-s)),u>0)for(C=(r[u]-r[f=h])/(u-h),n[f++]=r[h];f<=u;++f)n[f]=r[h]+(f-h)*C;else for(C=(r[h]-r[f=-u])/(-u-h),n[f--]=r[-u];f>=h;f--)n[f]=r[-u]+(-u-f)*C;if((u=Math.abs(u))<s-1)if(r[s-1]>=r[u])for(C=(r[s-1]-r[f=u])/(s-u),n[f++]=r[u];f<s;++f)n[f]=r[u]+(f-u)*C;else for(C=(r[u]-r[f=s-1])/(s-u),n[f--]=r[s-1];f>=u;f--)n[f]=r[s-1]+(s-f)*C;return n},this.JSDraw=null,this.CalculateZIGLine=function(r,t,n,s,o){this.JSDraw==null&&(this.JSDraw=new Wr(this.ErrorHandler));var l=t.Up,h=r;if(l)for(var u=r.ID+1;u<n.ID;++u){var f=s[u];this.IsNumber(f)&&h.Value<f&&(h={ID:u,Value:f})}else for(var u=r.ID+1;u<n.ID;++u){var f=s[u];this.IsNumber(f)&&h.Value>f&&(h={ID:u,Value:f})}t.Value=h.Value,t.ID=h.ID;var C={Start:{ID:r.ID,Value:r.Value},End:{ID:t.ID,Value:t.Value}},D=this.JSDraw.CalculateDrawLine(C);for(var u in D){var c=D[u];o[c.ID]=c.Value}if(n.ID==s.length-1){C={Start:{ID:t.ID,Value:t.Value},End:{ID:n.ID,Value:n.Value}},D=this.JSDraw.CalculateDrawLine(C);for(var u in D){var c=D[u];o[c.ID]=c.Value}}else r.ID=t.ID,r.Value=t.Value,t.ID=n.ID,t.Value=n.Value,t.Up=r.Value<t.Value},this.TROUGHBARS=function(r,t,n){var s=this.ZIG(r,t),o=[],l=n;if(l<1)return o;for(var h=s.length,u=[],C=0;C<l;++C)u[C]=0;var f=0,C=this.GetFirstVaildIndex(s)+1;for(l--;C<h&&s[C]>s[C-1];++C);for(;C<h&&s[C]<s[C-1];++C);for(u[0]=--C;C<h-1;++C){if(s[C]<s[C+1]){if(f){if(l)for(var D=u.slice(0),c=0;c<l;++c)u[c+1]=D[c];u[f=0]=C}}else f=1;u[l]&&(o[C]=C-u[l])}return u[l]&&(o[C]=C-u[l]),o},this.TROUGH=function(r,t,n){var s=this.ZIG(r,t),o=[],l=n;if(l<1)return o;for(var h=s.length,u=[],C=0;C<l;++C)u[C]=0;var C=1,f=0,C=this.GetFirstVaildIndex(s)+1;for(l--;C<h&&s[C]>s[C-1];++C);for(;C<h&&s[C]<s[C-1];++C);for(u[0]=--C;C<h-1;++C){if(s[C]<s[C+1]){if(f){if(l)for(var D=u.slice(0),c=0;c<l;++c)u[c+1]=D[c];u[f=0]=C}}else f=1;u[l]&&(o[C]=s[u[l]])}return u[l]&&(o[C]=s[u[l]]),o},this.PEAKBARS=function(r,t,n){var s=this.ZIG(r,t),o=[],l=s.length,h=n;if(h<1)return o;for(var u=[],C=0;C<h;++C)u[C]=0;var f=0,C=this.GetFirstVaildIndex(s)+1;for(h--;C<l&&s[C]<s[C-1];++C);for(;C<l&&s[C]>s[C-1];++C);for(u[0]=--C;C<l-1;++C){if(s[C]>s[C+1]){if(f){if(h)for(var D=u.slice(0),c=0;c<h;++c)u[c+1]=D[c];u[f=0]=C}}else f=1;u[h]&&(o[C]=C-u[h])}return u[h]&&(o[C]=C-u[h]),o},this.PEAK=function(r,t,n){var s=this.ZIG(r,t),o=[],l=s.length,h=n;if(h<1)return o;for(var u=0,f=[],C=0;C<h;++C)f[C]=0;var C=this.GetFirstVaildIndex(s)+1;for(h--;C<l&&s[C]<s[C-1];++C);for(;C<l&&s[C]>s[C-1];++C);for(f[0]=--C;C<l-1;++C){if(s[C]>s[C+1]){if(u){if(h)for(var D=f.slice(0),c=0;c<h;++c)f[c+1]=D[c];f[u=0]=C}}else u=1;f[h]&&(o[C]=s[f[h]])}return f[h]&&(o[C]=s[f[h]]),o},this.EVERY=function(r,t){var n=[];if(t<1)return n;if(v.IsNumber(t)){t=parseInt(t);for(var s=0;s<r.length&&(n[s]=null,!this.IsNumber(r[s]));++s);for(var o=0;s<r.length;++s)r[s]?o+=1:o=0,o==t?(n[s]=1,--o):n[s]=0}else if(Array.isArray(t))for(var s=0;s<t.length;++s){var l=t[s];if(n[s]=null,!!v.IsPlusNumber(l)){l=parseInt(l);for(var o=0,h=s,u=0;h>=0&&u<l;--h,++u)r[h]&&++o;n[s]=o==l?1:0}}return n},this.COST=function(r,t){var n=[],s=r/100;if(s<1e-6||s>1)return n;var o=this.SymbolData.Data.Data;if(!o||o.length<=0)return n;for(var l=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:t}),h=o[0].High,u=o[0].Low,f=0;f<o.length;++f){var C=o[f];u=Math.min(u,C.Low),h=Math.max(h,C.High)}(u>2e3||u<0||h>2e3||u<0)&&this.ThrowUnexpectedNode(t,"COST() 历史K线最大最小值错误, 超出(0,1000)范围");var D=parseInt(h*100+1),c=parseInt(u*100-1),T=0,S=0,I=0;h=D/100,u=c/100;var g=D-c+1;if(g<1)return n;for(var E=[],F=[],f=0;f<g;++f)E[f]=0,F[f]=0;for(var R=0,A=0,P=0,p=0,f=0;f<o.length;++f)if(!(f>=l.length)){if(l[f]>1){var w=o[f];R=w.Vol/l[f];for(var H=0;H<g;H++)E[H]*=1-R;T=parseInt(Math.min(D,Math.max(c,w.Low*100)))-c,S=parseInt(Math.min(D,Math.max(c,w.High*100)))-c,I=parseInt(Math.min(D,Math.max(c,w.Close*100)))-c;for(var H=0;H<g;++H)F[H]=0;var W=parseInt((T+S+2*I)/4);if(W==S||W==T)F[W]+=w.Vol;else{for(var ht=w.Vol/(W-T),rt=T;rt<W;++rt)F[rt]+=(rt-T)*(ht/(W-T));for(rt;rt<=S;++rt)F[rt]+=(rt-S)*(ht/(W-S))}for(var A=0,H=T;H<=S;H++)E[H]+=F[H];for(var H=0;H<g;H++)A+=E[H];for(H=0,p=P=0;H<g;++H)if(P+=E[H],P>=A*s){p=(h-u)*H/g+u;break}}n[f]=p}return n},this.WINNER=function(r,t){var n=[],s=this.SymbolData.Data.Data;if(!s||s.length<=0)return n;for(var o=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:t}),l=s[0].High,h=s[0].Low,u=0;u<s.length;++u){var f=s[u];h=Math.min(h,f.Low),l=Math.max(l,f.High)}(h>5e3||h<0||l>5e3||h<0)&&this.ThrowUnexpectedNode(t,"WINNER() 历史K线最大最小值错误, 超出(0,5000)范围");var C=parseInt(l*100+1),D=parseInt(h*100-1),c=0,T=0,S=0;l=C/100,h=D/100;var I=C-D+1;if(I<1)return n;for(var g=[],E=[],u=0;u<I;++u)g[u]=0,E[u]=0;for(var F=0,R=0,A=0,u=0;u<s.length;++u)if(!(u>=o.length)&&o[u]>1){var P=s[u];F=P.Vol/o[u];for(var p=0;p<I;p++)g[p]*=1-F;c=parseInt(Math.min(C,Math.max(D,P.Low*100)))-D,T=parseInt(Math.min(C,Math.max(D,P.High*100)))-D,S=parseInt(Math.min(C,Math.max(D,P.Close*100)))-D;for(var p=0;p<I;++p)E[p]=0;var w=parseInt((c+T+2*S)/4);if(w==T||w==c)E[w]+=P.Vol;else{for(var H=P.Vol/(w-c),W=c;W<w;++W)E[W]+=(W-c)*(H/(w-c));for(W;W<=T;++W)E[W]+=(W-T)*(H/(w-T))}for(var R=0,p=c;p<=T;p++)g[p]+=E[p];for(var p=0;p<I;p++)R+=g[p];Array.isArray(r)?T=parseInt(Math.min(r[u]*100-D,I-1)):T=parseInt(Math.min(r*100-D,I-1));for(var p=0,A=0;p<=T;p++)A+=g[p];R>0?n[u]=A/R:u-1>=0&&(n[u]=n[u-1])}return n},this.COSTEX=function(r,t,n){var s=[],o=this.SymbolData.Data.Data;if(!o||o.length<=0)return s;for(var l=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:n}),h=o[0].High,u=o[0].Low,f=0;f<o.length;++f){var C=o[f];u=Math.min(u,C.Low),h=Math.max(h,C.High)}(u>5e3||u<0||h>5e3||u<0)&&this.ThrowUnexpectedNode(n,"COSTEX() 历史K线最大最小值错误, 超出(0,5000)范围");var D=parseInt(h*100+1),c=parseInt(u*100-1),T=0,S=0,I=0;h=D/100,u=c/100;var g=D-c+1;if(g<1)return s;for(var E=[],F=[],f=0;f<g;++f)E[f]=0,F[f]=0;for(var R=0,A=0,P=0,p=0,w=0,H=0,f=0,W=0;f<o.length;++f)if(!(f>=l.length)&&l[f]>1){var ht=o[f];R=ht.Vol/l[f];for(var W=0;W<g;W++)E[W]*=1-R;T=parseInt(Math.min(D,Math.max(c,ht.Low*100)))-c,S=parseInt(Math.min(D,Math.max(c,ht.High*100)))-c,I=parseInt(Math.min(D,Math.max(c,ht.Close*100)))-c;for(var W=0;W<g;++W)F[W]=0;var rt=parseInt((T+S+2*I)/4);if(rt==S||rt==T)F[rt]+=ht.Vol;else{for(var nt=ht.Vol/(rt-T),vt=T;vt<rt;++vt)F[vt]+=(vt-T)*(nt/(rt-T));for(vt;vt<=S;++vt)F[vt]+=(vt-S)*(nt/(rt-S))}for(var W=T;W<=S;W++)E[W]+=F[W];for(var W=0;W<g;W++);for(Array.isArray(r)?S=parseInt(Math.min(r[f]*100-c,g-1)):S=parseInt(Math.min(r*100-c,g-1)),W=0,P=0,p=0;W<=S;W++)P+=E[W],p+=.01*(W+c)*E[W];for(Array.isArray(t)?S=parseInt(Math.min(t[f]*100-c,g-1)):S=parseInt(Math.min(t*100-c,g-1)),W=0,w=0,H=0;W<=S;W++)w+=E[W],H+=.01*(W+c)*E[W];A=P-w,dPerVolRange=p-H,Math.abs(dPerVolRange)>.001&&A!=0?s[f]=dPerVolRange/A:f-1>=0&&(s[f]=s[f-1])}return s},this.PPART=function(r,t){var n=[],s=r;if(s<0)return n;var o=this.SymbolData.Data.Data;if(!o||o.length<=0)return n;for(var l=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:t}),h=s,u=0;h<o.length;++h){var f=h-s;if(!(f<0)){var C=0;for(u=0;u<s;++u){var D=o[u+f];C+=D.Vol}if(h<l.length&&l[h]>0){var c=1-C/l[h];n[h]=c}}}return n},this.LWINNER=function(r,t,n){var s=r;s<=0&&this.ThrowUnexpectedNode(n,"LWINNER() 第1个参数错误");var o=[],l=this.SymbolData.Data.Data;if(!l||l.length<=0)return o;for(var h=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:n}),u=0,f=0,C=s-1,D=0,c=0;C<l.length;++C){for(var T=C-s+1,S=l[T].High,I=l[T].Low,D=0;D<s;++D){var g=l[T+D];I=Math.min(I,g.Low),S=Math.max(S,g.High)}(I>5e3||I<0||S>5e3||I<0)&&this.ThrowUnexpectedNode(n,"LWINNER() 历史K线最大最小值错误, 超出(0,5000)范围");var E=parseInt(S*100+1),F=parseInt(I*100-1),R=0,A=0,P=0;S=E/100,I=F/100;var p=E-F+1;if(p<1)return o;for(var w=[],H=[],D=0;D<p;++D)w[D]=0,H[D]=0;for(D=0;D<s;++D){var W=h[T+D];if(!(W<1)){var ht=l[T+D],rt=ht.Vol/W;for(c=0;c<p;c++)w[c]*=1-rt;R=parseInt(Math.min(E,Math.max(F,ht.Low*100)))-F,A=parseInt(Math.min(E,Math.max(F,ht.High*100)))-F,P=parseInt(Math.min(E,Math.max(F,ht.Close*100)))-F;for(var c=0;c<p;++c)H[c]=0;var nt=parseInt((R+A+2*P)/4);if(nt==A||nt==R)H[nt]+=ht.Vol;else{for(var vt=ht.Vol/(nt-R),Nt=R;Nt<nt;++Nt)H[Nt]+=(Nt-R)*(vt/(nt-R));for(var Ft;Ft<=A;++Ft)H[Ft]+=(Ft-A)*(vt/(nt-A))}u=0;for(var c=R;c<=A;c++)w[c]+=H[c]}}for(var D=0;D<p;D++)u+=w[D];for(Array.isArray(t)?A=parseInt(Math.min(t[C]*100-F,p-1)):A=parseInt(Math.min(t*100-F,p-1)),f=0,c=0;c<=A;c++)f+=w[c];u>0&&f>0&&f<=u?o[C]=f/u:C-1>=0&&(o[C]=o[C-1])}return o},this.PWINNER=function(r,t,n){var s=[];return s},this.CalculateChip=function(r,t,n,s){for(var o={Min:null,Max:null,Data:[]},l=1,h=null,u=null,f=r;f>=0;--f){var C={},D=n[f];f==r?C.Vol=D.Vol*t[f]:C.Vol=D.Vol*l,C.Date=D.Date,C.High=D.High,C.Low=D.Low,(h==null||h<C.High)&&(h=C.High),(u==null||u<C.Low)&&(u=C.Low),o.Data[f]=C,l*=1-t[f]/100*s}return o.Max=h,o.Min=u,o},this.UPNDAY=function(r,t){var n=[];if(t<1||r==null||t>r.length)return n;for(var s=0,o=0;o<r.length;++o)if(n[o]=0,!(o-1<0)){if(!this.IsNumber(r[o])||!this.IsNumber(r[o-1])){s=0;continue}r[o]>r[o-1]?++s:s=0,s==t&&(n[o]=1,--s)}return n},this.DOWNNDAY=function(r,t){var n=[];if(t<1||r==null||t>r.length)return n;for(var s=0,o=0;o<r.length;++o)if(n[o]=0,!(o-1<0)){if(!this.IsNumber(r[o])||!this.IsNumber(r[o-1])){s=0;continue}r[o]<r[o-1]?++s:s=0,s==t&&(n[o]=1,--s)}return n},this.NDAY=function(r,t,n){var s=[];if(n<1||!Array.isArray(r)&&!Array.isArray(t)||r==null||t==null)return s;if(Array.isArray(r)&&Array.isArray(t)){if(n>=r.length||n>=t.length)return s;for(var o=Math.max(r.length,t.length),l=0,h=0;h<o;++h)if(s[h]=0,!(h>=r.length||h>=t.length)){if(!this.IsNumber(r[h])||!this.IsNumber(t[h])){l=0;continue}r[h]>t[h]?++l:l=0,l==n&&(s[h]=1,--l)}}else if(Array.isArray(r)&&!Array.isArray(t)){if(n>=r.length||!this.IsNumber(t))return;var l=0;for(var u in r){if(s[u]=0,!this.IsNumber(r[u])){l=0;continue}r[u]>t?++l:l=0,l==n&&(s[u]=1,--l)}}else if(!Array.isArray(r)&&Array.isArray(t)){if(n>=t.length||!this.IsNumber(r))return;var l=0;for(var f in t){if(s[f]=0,!this.IsNumber(t[f])){l=0;continue}r>t[f]?++l:l=0,l==n&&(s[f]=1,--l)}}return s},this.LONGCROSS=function(r,t,n){for(var s=[],o=Math.max(r.length,t.length),l=0;l<o;++l)s[l]=0,!(l-1<0)&&(l>=r.length||l>=t.length||!this.IsNumber(r[l])||!this.IsNumber(t[l])||!this.IsNumber(r[l-1])||!this.IsNumber(t[l-1])||r[l]>t[l]&&r[l-1]<t[l-1]&&(s[l]=1));for(var h=0,u=0;h<o;++h)if(s[h]){for(u=1;u<=n&&h-u>=0;++u)if(r[h-u]>=t[h-u]){s[h]=0;break}}return s},this.ISVALID=function(r){if(Array.isArray(r)){for(var t=[],n=0;n<r.length;++n){var s=r[n];s?t[n]=1:t[n]=0}return t}else return r?1:0},this.EXISTR=function(r,t,n){var s=[];if(!Array.isArray(r)||(t=parseInt(t),n=parseInt(n),t<=0&&(t=r.length),n<=0&&(n=1),n>t))return s;for(var s=[],o,l=0,h=0;l<r.length;++l)if(s[l]=null,!(l-t<0||l-n<0))for(s[l]=0,h=t;h>=n;--h){var o=r[l-h];if(this.IsNumber(o)&&o){s[l]=1;break}}return s},this.RELATE=function(r,t,n){var s=[];if(n<1&&(n=1),!Array.isArray(r)||!Array.isArray(t))return s;for(var o=this.CalculateAverage(r,n),l=this.CalculateAverage(t,n),h=Math.max(r.length,t.length),u=0,f=0;u<h;++u)if(s[u]=null,!(u>=r.length||u>=t.length||u>=o.length||u>=l.length)){var C=o[u],D=l[u],c=0,T=0,S=0;for(f=u-n+1;f<=u;++f)c+=(r[f]-C)*(t[f]-D),T+=Math.pow(r[f]-C,2),S+=Math.pow(t[f]-D,2);s[u]=c/n/(Math.sqrt(T/n)*Math.sqrt(S/n))}return s},this.CalculateAverage=function(r,t){var n=[];if(t<1)return n;for(var s=0,o=0;o<r.length&&!this.IsNumber(r[o]);++o);for(;o<r.length&&o<t;++o){n[o]=null;var l=r[o];this.IsNumber(l)&&(s+=l)}for(n[o-1]=s/t;o<r.length;++o){var l=r[o],h=r[o-t];this.IsNumber(l)||(l=0),this.IsNumber(h)||(h=0),s=s-h+l,n[o]=s/t}return n},this.COVAR=function(r,t,n){if(this.IsNumber(r)||this.IsNumber(t))return 0;var s=[];if(n<1&&(n=1),!Array.isArray(r)||!Array.isArray(t))return s;for(var o=this.CalculateAverage(r,n),l=this.CalculateAverage(t,n),h=Math.max(r.length,t.length),h=Math.max(r.length,t.length),u=0,f=0;u<h;++u)if(s[u]=null,!(u>=r.length||u>=t.length||u>=o.length||u>=l.length)){var C=o[u],D=l[u],c=0;for(f=u-n+1;f<=u;++f)c+=(r[f]-C)*(t[f]-D);s[u]=c/n}return s},this.HHVBARS=function(r,t){var n=[];if(!Array.isArray(r))return n;if(Array.isArray(t))for(var s=0;s<t.length;++s){n[s]=null;var o=t[s];if(this.IsNumber(o)){var l=s-o;l<0&&(l=0);for(var h=null,u=l;u<r.length;++u)if(this.IsNumber(r[u])){h=u;break}for(var f=0;u<r.length&&f<o;++f,++u)r[u]>=r[h]&&(h=u);h!=null&&(n[s]=s-h)}}else{t<1&&(t=r.length);for(var h=null,s=0;s<r.length;++s)if(n[s]=null,this.IsNumber(r[s])){h=s;break}var u=0;for(s=h+1;s<r.length&&u<t;++s,++u)r[s]>=r[h]&&(h=s),t==r.length&&(n[s]=s-h);for(;s<r.length;++s){if(s-h<t)r[s]>=r[h]&&(h=s);else for(h=s-t+1,u=h;u<=s;++u)r[u]>=r[h]&&(h=u);n[s]=s-h}}return n},this.LLVBARS=function(r,t){var n=[];if(!Array.isArray(r))return n;if(Array.isArray(t))for(var s=0;s<t.length;++s){n[s]=null;var o=t[s];if(this.IsNumber(o)){var l=s-o;l<0&&(l=0);for(var h=null,u=l;u<r.length;++u)if(this.IsNumber(r[u])){h=u;break}for(var f=0;u<r.length&&f<o;++f,++u)r[u]<=r[h]&&(h=u);h!=null&&(n[s]=s-h)}}else{t<1&&(t=r.length);for(var h=null,s=0;s<r.length;++s)if(n[s]=null,this.IsNumber(r[s])){h=s;break}var u=0;for(s=h+1;s<r.length&&u<t;++s,++u)r[s]<=r[h]&&(h=s),t==r.length&&(n[s]=s-h);for(;s<r.length;++s){if(s-h<t)r[s]<=r[h]&&(h=s);else for(h=s-t+1,u=h;u<=s;++u)r[u]<=r[h]&&(h=u);n[s]=s-h}}return n},this.BETA=function(r){var t=[],n=this.SymbolData.Data,s=this.SymbolData.IndexData;r<=0&&(r=1);for(var o=[],l=[],h=0;h<n.Data.length;++h){o[h]=0,l[h]=0;var u=n.Data[h],f=s.Data[h];u.Close>0&&u.YClose>0&&(o[h]=(u.Close-u.YClose)/u.YClose),f.Close>0&&f.YClose>0&&(l[h]=(f.Close-f.YClose)/f.YClose)}for(var C=this.CalculateAverage(o,r),D=this.CalculateAverage(l,r),c=0,T=0;c<n.Data.length;++c)if(t[c]=null,!(c>=o.length||c>=l.length||c>=C.length||c>=D.length)){var S=C[c],I=D[c],g=0,E=0;for(T=c-r+1;T<=c;++T){var F=l[T]-I,R=o[T]-S;g+=F*R,E+=F*F}this.IsDivideNumber(E)&&this.IsNumber(g)&&(t[c]=g/E)}return t},this.BETA2=function(r,t,n){var s=[];n<=0&&(n=1);for(var o=[null],l=[null],h=Math.max(r.length,t.length),u={X:r[0],Y:t[0]},f=1;f<h;++f){o[f]=0,l[f]=0;var C=r[f],D=t[f];u.X>0&&(o[f]=(C-u.X)/u.X),u.Y>0&&(l[f]=(D-u.Y)/u.Y),u={X:C,Y:D}}for(var c=this.CalculateAverage(o,n),T=this.CalculateAverage(l,n),f=0,S=0;f<h;++f)if(s[f]=null,!(f>=o.length||f>=l.length||f>=c.length||f>=T.length)){var I=c[f],g=T[f],E=0,F=0;for(S=f-n+1;S<=f;++S){var R=o[S]-I,A=l[S]-g;E+=R*A,F+=R*R}this.IsDivideNumber(F)&&this.IsNumber(E)&&(s[f]=E/F)}return s},this.SAR=function(r,t,n){var s=[],o=this.SymbolData.Data;if(r>=o.Data.length)return s;for(var l=null,h=null,u=0;u<r;++u){var f=o.Data[u];(l==null||l<f.High)&&(l=f.High),(h==null||h>f.Low)&&(h=f.Low)}var C=0,D=1,c=C;s[r-1]=h;for(var T=h,S=o.Data[0].High,I=t/100,u=r;u<o.Data.length;++u){var g=S,f=o.Data[u],E=o.Data[u-1];c==C?f.Low<s[u-1]?(c=D,S=f.Low,I=t/100,T=Math.max(f.High,E.High),T=Math.max(T,g+I*(S-g))):(c=C,f.High>g&&(S=f.High,I=Math.min(I+t/100,n/100)),T=Math.min(f.Low,E.Low),T=Math.min(T,s[u-1]+I*(S-s[u-1]))):c==D&&(f.High>s[u-1]?(c=C,S=f.High,I=t/100,T=Math.min(f.Low,E.Low),T=Math.min(T,s[u-1]+I*(S-g))):(c=D,f.Low<g&&(S=f.Low,I=Math.min(I+t/100,n/100)),T=Math.max(f.High,E.High),T=Math.max(T,s[u-1]+I*(S-s[u-1])))),s[u]=T}return s},this.SARTURN=function(r,t,n){var s=[],o=this.SAR(r,t,n),l=this.SymbolData.Data,h=0;for(h=0;h<o.length&&!this.IsNumber(o[h]);++h);var u=0;h<l.Data.length&&(u=l.Data[h].Close>o[h]);for(var f=h+1;f<l.Data.length;++f){var C=l.Data[f];C.Close<o[f]&&u?s[f]=-1:s[f]=C.Close>o[f]&&!u?1:0,u=C.Close>o[f]}return s},this.BACKSET=function(r,t){var n=[];if(!r)return n;var s=r.length;if(!this.IsNumber(s)||s<=0)return n;if(Array.isArray(t)){for(var o=0;o<s;++o)n[o]=0;for(var o=0;o<s;++o){var l=r[o],h=t[o];if(this.IsNumber(l)&&l&&this.IsNumber(h))for(var u=o,f=0;u>=0&&f<h;--u,++f)n[u]=1}}else{for(var o=0;o<s;++o)n[o]=0;for(var C=0;C<s&&!this.IsNumber(r[C]);++C);if(C==s)return n;for(var D=Math.min(s-C,Math.max(t,1)),o=s-1,u=0;o>=0;--o){var l=r[o];if(this.IsNumber(l)&&l)for(u=o;u>o-D;--u)n[u]=1}if(r[o])for(u=o;u>=C;--u)n[u]=1}return n},this.BETWEEN=function(r,t,n){var s=[],o=typeof r=="number",l=typeof t=="number",h=typeof n=="number";if(o&&l&&h)return r>=t&&r<=n?1:0;for(var u in r){s[u]=0;var f=r[u],C=null,D=null;l?C=t:u<t.length-1&&(C=t[u]),h?D=n:u<n.length-1&&(D=n[u]),!(C==null||D==null)&&(C>D?f>=D&&f<=C&&(s[u]=1):f<=D&&f>=C&&(s[u]=1))}return s},this.STRCAT=function(r,t){var n=[];return v.IsString(r)&&v.IsString(t)&&(n=r+t),n},this.VARCAT=function(r,t){var n=[];if(Array.isArray(r)&&Array.isArray(t))for(var s=Math.max(r.length,t.length),o="",l=0;l<s;++l){if(n[l]=null,o="",l<r.length){var h=r[l];v.IsString(h)&&(o+=h)}if(l<t.length){var h=t[l];v.IsString(h)&&(o+=h)}o!=""&&(n[l]=o)}else if(v.IsString(r)&&Array.isArray(t))for(var l=0;l<t.length;++l){n[l]=null;var h=t[l];v.IsString(h)&&(n[l]=r+h)}else if(Array.isArray(r)&&v.IsString(t))for(var l=0;l<r.length;++l){n[l]=null;var h=r[l];v.IsString(h)&&(n[l]=h+t)}else v.IsString(r)&&v.IsString(t)&&(n=r+t);return n},this.FINDSTR=function(r,t){var n=[],s,o;if(v.IsNumber(r)?s=r.toString():s=r,v.IsNumber(t)?o=t.toString():o=t,v.IsString(s)&&v.IsString(o))return s.indexOf(o)>=0?1:0;if(Array.isArray(r)&&v.IsString(o))for(var l=0;l<r.length;++l){var h=r[l];v.IsString(h)?n[l]=h.indexOf(o)>=0?1:0:v.IsNumber(h)?(s=h.toString(),n[l]=s.indexOf(o)>=0?1:0):n[l]=0}return n},this.STRLEN=function(r){if(v.IsString(r))return r.length;if(Array.isArray(r)){for(var t=[],n=0;n<r.length;++n){var s=r[n];v.IsString(s)?t[n]=s.length:t[n]=null}return t}return null},this.STRCMP=function(r,t){return v.IsString(r)&&v.IsString(t)?r==t?1:0:null},this.STRSPACE=function(r){var t=[];if(Array.isArray(r))for(var n=0;n<r.length;++n){t[n]=null;var s=r[n];v.IsString(s)&&(t[n]=s+" ")}else v.IsString(r)&&(t=r+" ");return t},this.CON2STR=function(r,t){var n=[];if(Array.isArray(r))for(var s=r.length-1;s>=0;--s){var o=r[s];if(this.IsNumber(o))return n=o.toFixed(t),n}else this.IsNumber(r)&&(n=r.toFixed(t));return n},this.VAR2STR=function(r,t){var n=[];if(Array.isArray(r))for(var s=0;s<r.length;++s){n[s]=null;var o=r[s];this.IsNumber(o)&&(n[s]=o.toFixed(t))}else this.IsNumber(r)&&(n=r.toFixed(t));return n},this.MOD=function(r,t){var n=[],s=typeof r=="number",o=typeof t=="number";if(s&&o)return pi.MOD(r,t);if(!s&&!o){for(var l=Math.max(r.length,t.length),h=0;h<l;++h)n[h]=null,h<r.length&&h<t.length&&this.IsNumber(r[h])&&this.IsNumber(t[h])&&(n[h]=pi.MOD(r[h],t[h]));return n}else if(s&&!o){for(var u in t)n[u]=null,this.IsNumber(r)&&this.IsNumber(t[u])&&(n[u]=pi.MOD(r,t[u]));return n}else if(!s&&o){for(var u in r)n[u]=null,this.IsNumber(r[u])&&this.IsNumber(t)&&(n[u]=pi.MOD(r[u],t));return n}return n},this.POW=function(r,t){var n=[];if(Array.isArray(r)&&Array.isArray(t))for(var s=0;s<r.length;++s){var o=r[s],l=t[s];this.IsNumber(o)&&this.IsNumber(l)?n[s]=Math.pow(o,l):n[s]=null}else if(v.IsNumber(r)&&Array.isArray(t))for(var s=0;s<t.length;++s){var h=t[s];this.IsNumber(h)?n[s]=Math.pow(r,h):n[s]=null}else{if(v.IsNumber(r)&&v.IsNumber(t))return Math.pow(r,t);if(Array.isArray(r)&&v.IsNumber(t))for(var s=0;s<r.length;++s){var h=r[s];this.IsNumber(h)?n[s]=Math.pow(h,t):n[s]=null}}return n},this.CEILING=function(r){var t=typeof r=="number";if(t)return parseInt(r);var n=[];for(var s in r){var o=r[s];this.IsNumber(o)?n[s]=parseInt(o):n[s]=null}return n},this.FLOOR=function(r){var t=typeof r=="number";if(t)return parseInt(r-1);var n=[];for(var s in r){var o=r[s];this.IsNumber(o)?n[s]=parseInt(o-1):n[s]=null}return n},this.ZTPRICE=function(r,t){if(!this.IsNumber(t))return null;if(Array.isArray(r)){var n=[];for(var s in r){var o=r[s];this.IsNumber(o)?n[s]=(1+t)*o:n[s]=null}return n}else if(this.IsNumber(r)){var n=(1+t)*r;return n}},this.DTPRICE=function(r,t){if(!this.IsNumber(t))return null;if(Array.isArray(r)){var n=[];for(var s in r){var o=r[s];this.IsNumber(o)?n[s]=(1-t)*o:n[s]=null}return n}else if(this.IsNumber(r)){var n=(1-t)*r;return n}},this.FRACPART=function(r){if(Array.isArray(r)){var t=[],n=0;for(var s in r){var o=r[s];this.IsNumber(o)?(n=parseInt(o),t[s]=o-n):t[s]=null}return t}else if(this.IsNumber(r)){n=parseInt(r);var t=r-n;return t}},this.SIGN=function(r){if(Array.isArray(r)){for(var t=[],n=0;n<r.length;++n){var s=r[n];t[n]=null,v.IsNumber(s)&&(s>0?t[n]=1:s==0?t[n]=0:t[n]=-1)}return t}else return r>0?1:r==0?0:-1},this.BARSLASTCOUNT=function(r){var t=null;if(Array.isArray(r)){if(t=[],r.length>0)for(var n=0,s=r.length-1;s>=0;--s){n=0;for(var o=s;o>=0&&r[o];--o)++n;t[s]=n}}else r?t=1:t=0;return t},this.INTPART=function(r){var t=null;if(Array.isArray(r)){t=[];for(var n in r){var s=r[n];this.IsNumber(s)?t[n]=parseInt(s):t[n]=null}}else this.IsNumber(r)&&(t=parseInt(r));return t},this.CONST=function(r){if(Array.isArray(r)){var t=r.length;return t>0?r[t-1]:null}else return r},this.TOPRANGE=function(r){if(this.IsNumber(r))return 0;var t=[];if(Array.isArray(r))for(var n=r.length,s=n-1;s>=0;--s){t[s]=0;var o=r[s];if(this.IsNumber(o)){for(var l=0,h=s-1;h>=0&&!(r[h]>o);--h)++l;t[s]=l}}return t},this.LOWRANGE=function(r){if(this.IsNumber(r))return 0;var t=[];if(Array.isArray(r))for(var n=r.length,s=n-1;s>=0;--s){t[s]=0;var o=r[s];if(this.IsNumber(o)){for(var l=0,h=s-1;h>=0&&!(r[h]<o);--h)++l;t[s]=l}}return t},this.FINDLOW=function(r,t,n,s){if(this.IsNumber(r))return r;var o=[];if(Array.isArray(r))for(var l=r.length,h=l-1;h>=0;--h){o[h]=null;for(var u=[],f=t;f<n;++f){var C=h-f;if(C<0)break;var D=r[C];this.IsNumber(D)&&u.push(D)}if(u.length>0){u.sort(function(T,S){return T-S});var C=s-1;C<0?C=0:C>=u.length&&(C=u.length-1),o[h]=u[C]}}return o},this.FINDHIGH=function(r,t,n,s){if(this.IsNumber(r))return r;var o=[];if(Array.isArray(r))for(var l=r.length,h=l-1;h>=0;--h){o[h]=null;for(var u=[],f=t;f<n;++f){var C=h-f;if(C<0)break;var D=r[C];this.IsNumber(D)&&u.push(D)}if(u.length>0){u.sort(function(T,S){return S-T});var C=s-1;C<0?C=0:C>=u.length&&(C=u.length-1),o[h]=u[C]}}return o},this.FINDHIGHBARS=function(r,t,n,s){if(this.IsNumber(r))return n-t-s;var o=[];if(Array.isArray(r))for(var l=r.length,h=l-1;h>=0;--h){o[h]=null;for(var u=[],f=t;f<n;++f){var C=h-f;if(C<0)break;var D=r[C];this.IsNumber(D)&&u.push({Value:D,Period:f})}if(u.length>0){u.sort(function(T,S){return S.Value-T.Value});var C=s-1;C<0?C=0:C>=u.length&&(C=u.length-1),o[h]=u[C].Period}}return o},this.FINDLOWBARS=function(r,t,n,s){if(this.IsNumber(r))return n-t-s;var o=[];if(Array.isArray(r))for(var l=r.length,h=l-1;h>=0;--h){o[h]=null;for(var u=[],f=t;f<n;++f){var C=h-f;if(C<0)break;var D=r[C];this.IsNumber(D)&&u.push({Value:D,Period:f})}if(u.length>0){u.sort(function(T,S){return T.Value-S.Value});var C=s-1;C<0?C=0:C>=u.length&&(C=u.length-1),o[h]=u[C].Period}}return o},this.HOD=function(r,t){var n=[];if(v.IsNumber(r))return 1;if(Array.isArray(r))for(var s=r.length,o=s-1;o>=0;--o){var l=r[o];if(v.IsNumber(l)){if(Array.isArray(t))var h=parseInt(t[o]);else var h=parseInt(t);t<=0&&(h=o);for(var u=1,f=o-1,C=1;f>=0&&C<h;--f,++C){var D=r[f];v.IsNumber(D)&&D>l&&++u}n[o]=u}}return n},this.LOD=function(r,t){var n=[];if(v.IsNumber(r))return 1;if(Array.isArray(r))for(var s=r.length,o=s-1;o>=0;--o){var l=r[o];if(v.IsNumber(l)){if(Array.isArray(t))var h=parseInt(t[o]);else var h=parseInt(t);t<=0&&(h=o);for(var u=1,f=o-1,C=1;f>=0&&C<h;--f,++C){var D=r[f];v.IsNumber(D)&&D<l&&++u}n[o]=u}}return n},this.BARSNEXT=function(r){if(!Array.isArray(r))return 0;for(var t=[],n=0;n<r.length;++n){t[n]=0;for(var s=n,o=0;s<r.length;++s,++o){var l=r[s];if(l>0){t[n]=o;break}}}return t},this.RAND=function(r){if(Array.isArray(r)){var t=[];for(var n in r){t[n]=null;var s=r[n],o=parseInt(s);o<=0||(t[n]=Math.ceil(Math.random()*o))}return t}else{var o=parseInt(r);if(o<=0)return null;for(var l=this.SymbolData.Data,h=l.Data.length,t=[],n=0;n<h;++n)t[n]=Math.ceil(Math.random()*o);return t}},this.AMA=function(r,t){var n=[],s;if(Array.isArray(t)){for(var o=r.length-1;o>=0;--o)if(this.IsNumber(t[o])){s=t[o];break}}else s=t;if(this.IsNumber(s)){if(s>1)return n;var l=0,h=0;for(l;l<r.length;++l)if(n[l]=null,this.IsNumber(r[l])){h=r[l],n[l]=h;break}for(var o=l+1;o<r.length;++o){var u=r[o];n[o]=n[o-1]+s*(u-n[o-1])}}return n},this.TMA=function(r,t,n){var s=[];if(this.IsNumber(t)&&t<=1&&this.IsNumber(n)&&n<1){var o=!1;for(var l in r)if(s[l]=null,o==!1){var h=r[l];this.IsNumber(h)&&(s[l]=h,s[l],o=!0)}else{var h=r[l];if(!this.IsNumber(h))continue;s[l]=t*s[l-1]+n*h,s[l]}}return s},this.ROUND=function(r){if(this.IsNumber(r))return Math.round(r);var t=[];if(Array.isArray(r))for(var n in r){var s=r[n];this.IsNumber(s)?t[n]=Math.round(s):t[n]=null}return t},this.ROUND2=function(r,t){var n=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12],s=0;if(this.IsNumber(t)&&(s=parseInt(t)),t<0?s=0:t>=n.length&&(s=n.length-1),this.IsNumber(r))return Math.round(r*n[s])/n[s];var o=[];if(Array.isArray(r))for(var l in r){var h=r[l];this.IsNumber(h)?o[l]=Math.round(h*n[s])/n[s]:o[l]=null}return o},this.TRMA=function(r,t){if(!this.IsNumber(t)||t<=0)return[];t=parseInt(t);var n=0,s=0;t%2==0?(n=parseInt(t/2),s=n+1):(n=parseInt((t+1)/2),s=n);var o=this.MA(r,n),l=this.MA(o,s);return l},this.VALUEWHEN=function(r,t){if(Array.isArray(r)){var n=[];if(Array.isArray(t)){var s=null;for(var o in r){if(o>=t.length){n[o]=s;continue}var l=t[o];r[o]?(n[o]=l,s=l):n[o]=s}}else{var s=null;for(var o in r)r[o]?(n[o]=t,s=t):n[o]=s}return n}else return r?1:0},this.HARMEAN=function(r,t){var n=[];if(Array.isArray(r)){if(Array.isArray(t))for(var s=0;s<r.length;++s){if(s>=t.length){n[s]=null;continue}var o=parseInt(t[s]);if(o<=0||o>s){n[s]=null;continue}for(var l=0,h=0;h<o;++h){var u=r[s-h];if(!this.IsNumber(u)||u==0){l=null;break}l+=1/u}l==null?n[s]=null:n[s]=1/(l/o)}else if(this.IsNumber(t)){if(t=parseInt(t),t<=0)return n;for(var s=0;s<r.length;++s){if(t>s){n[s]=null;continue}for(var l=0,h=0;h<t;++h){var u=r[s-h];if(!this.IsNumber(u)||u==0){l=null;break}l+=1/u}l==null?n[s]=null:n[s]=1/(l/t)}}}return n},this.DATETODAY=function(r){var t=[],n=new Date("1990-12-19"),s=19901219,o=1e3*60*60*24;if(Array.isArray(r))for(var l in r){t[l]=null;var h=r[l];if(this.IsNumber(h)){var u=h+19e6;if(!(u<s)){var f=parseInt(u/1e4),C=parseInt(u%1e4/100),D=parseInt(u%100),c=new Date(f+"-"+C+"-"+D);t[l]=Math.round((c-n)/o)}}}else if(this.IsNumber(r)){var u=r+19e6;if(u>=s){var f=parseInt(u/1e4),C=parseInt(u%1e4/100),D=parseInt(u%100),c=new Date(f+"-"+C+"-"+D);return Math.round((c-c)/o)}}return t},this.DAYTODATE=function(r){var t=new Date("1990-12-19"),n=[];if(Array.isArray(r))for(var s in r){n[s]=null;var o=r[s];if(this.IsNumber(o)){t.setDate(t.getDate()+o);var l=t.getFullYear()*1e4+(t.getMonth()+1)*100+t.getDate();l-=19e6,n[s]=l,t.setDate(t.getDate()-o)}}else if(this.IsNumber(r)){t.setDate(t.getDate()+r);var l=t.getFullYear()*1e4+(t.getMonth()+1)*100+t.getDate();return l-=19e6,l}return n},this.TIMETOSEC=function(r){var t=parseInt(r/1e4),n=parseInt(r%1e4/100),s=r%100,o=t*60*60+n*60+s;return o},this.SECTOTIME=function(r){var t=86400,n=60*60,s=60,o=Math.floor(r%t/n),l=Math.floor(r%n/s),h=r%s,u=o*1e4+l*100+h;return u},this.ANY=function(r,t){t<=0&&(t=1);var n=[];if(Array.isArray(r)){if(t>=r.length)return 0;for(var s=t,o=0;s<r.length;++s){var l=0;for(o=0;o<t;++o){var h=r[s-o];if(h>0){l=1;break}}n[s]=l}return n}else if(v.IsNumber(r)){if(r<=0||t>=this.SymbolData.Data.Data.length)return 0;for(var s=t;s<this.SymbolData.Data.Data.length;++s)n[s]=1;return n}else return 0},this.ALL=function(r,t){t<=0&&(t=1);var n=[];if(Array.isArray(r)){if(t>=r.length)return 0;for(var s=t,o=0;s<r.length;++s){var l=1;for(o=0;o<t;++o){var h=r[s-o];if(!(h>0)){l=0;break}}n[s]=l}return n}else if(v.IsNumber(r)){if(r<=0||t>=this.SymbolData.Data.Data.length)return 0;for(var s=t;s<this.SymbolData.Data.Data.length;++s)n[s]=1;return n}else return 0},this.TESTSKIP=function(r,t){if(Array.isArray(r)){if(r.length<=0)return!1;var n=r[r.length-1];return!!n}else return v.IsNumber(r)?!(r<=0):!!r},this.IFC=function(r){if(Array.isArray(r)){var t=r[r.length-1];return v.IsNumber(t)?t>0:!1}else return v.IsNumber(r)?r>0:!1},this.ALIGNRIGHT=function(r){if(Array.isArray(r)){for(var t=[],n=r.length-1,s=r.length-1;s>=0;--s){var o=r[s];(v.IsNumber(o)||v.IsString(o))&&(t[n]=o,--n)}for(var s=n;s>=0;--s)t[s]=null;return t}else return r},this.SUMBARS=function(r,t){var n=Array.isArray(r),s=Array.isArray(t),o=v.IsNumber(r),l=v.IsNumber(t),h=[];if(n&&l)for(var u=0,f=0;u<r.length;++u){for(var C=0,f=0,D=u-1;D>=0;--D,++f){var c=r[u];if(v.IsNumber(c)&&(C+=r[D],C>t))break}h[u]=f}else if(n&&s)for(var T=Math.max(r.length,t.length),u=0;u<T;++u){h[u]=null;var C=0,f=0,S=t[u];if(v.IsNumber(S)){for(var D=u-1;D>=0;--D,++f){var c=r[u];if(v.IsNumber(c)&&(C+=r[D],C>S))break}h[u]=f}}else if(o&&s)for(var u=0;u<t.length;++u){h[u]=null;var C=0,f=0,S=t[u];if(v.IsNumber(S)){for(var D=u-1;D>=0&&(C+=r,!(C>S));--D,++f);h[u]=f}}return h},this.STRFORMAT=function(r,t,n){var s=r.match(/{[0-9.:]+}/g);if(!v.IsNonEmptyArray(s))return null;for(var o=new Dt.default,l=0;l<s.length;++l){var h=s[l];if(!(h.length<3)){var u=h.slice(1,h.length-1),f=-1,C=-1;if(u.indexOf(":")>0){var D=u.split(":");if(D&&(D[0]&&(f=parseInt(D[0])),D[1]))if(D[1].indexOf(".")>=0){for(var c=0,T=D[1],S=T.length-1;S>=0&&T[S]=="0";--S)++c;c>0&&(C=c)}else D[1]=="0"&&(C=0)}else f=parseInt(u);if(!(f<0)){var I={Src:h,Index:f,Text:null,Decimal:null};C>=0&&(I.Decimal=C),o.set(f,I)}}}for(var g=!1,E=0,l=1;l<t.length;++l){var h=t[l];Array.isArray(h)&&(g=!0,E<h.length&&(E=h.length))}if(g){for(var F=[],l=0;l<E;++l){var R=r,A=!0,P=!1,p=void 0;try{for(var w=(0,ye.default)(o),H;!(A=(H=w.next()).done);A=!0){var h=H.value,W=h[1],I=t[W.Index+1],ht="null";if(I)if(Array.isArray(I)){var u=I[l];u&&(v.IsNumber(W.Decimal)?ht=""+u.toFixed(W.Decimal):ht=""+u)}else ht=""+I;R=R.replace(W.Src,ht)}}catch(Jt){P=!0,p=Jt}finally{try{!A&&w.return&&w.return()}finally{if(P)throw p}}F[l]=R}return F}else{var F=r,rt=!0,nt=!1,vt=void 0;try{for(var Nt=(0,ye.default)(o),Ft;!(rt=(Ft=Nt.next()).done);rt=!0){var h=Ft.value,W=h[1],I=t[W.Index+1],ht="null";I&&(ht=""+I),F=F.replace(W.Src,ht)}}catch(Jt){nt=!0,vt=Jt}finally{try{!rt&&Nt.return&&Nt.return()}finally{if(nt)throw vt}}return F}},this.CallFunction=function(r,t,n,s){switch(r){case"MAX":case"MAX6":return this.MAX(t,n);case"MIN":case"MIN6":return this.MIN(t,n);case"REF":return this.REF(t[0],t[1]);case"REFV":return this.REFV(t[0],t[1]);case"REFX":return this.REFX(t[0],t[1]);case"REFXV":return this.REFXV(t[0],t[1]);case"REFX1":return this.REFX(t[0],t[1]);case"ABS":return this.ABS(t[0]);case"MA":return this.MA(t[0],t[1]);case"EMA":return this.EMA(t[0],t[1]);case"SMA":return this.SMA(t[0],t[1],t[2]);case"DMA":return this.DMA(t[0],t[1]);case"XMA":return this.XMA(t[0],t[1]);case"EXPMA":return this.EXPMA(t[0],t[1]);case"EXPMEMA":return this.EXPMEMA(t[0],t[1]);case"COUNT":return this.COUNT(t[0],t[1]);case"LLV":return this.LLV(t[0],t[1]);case"LV":return this.LV(t[0],t[1]);case"LLVBARS":return this.LLVBARS(t[0],t[1]);case"HHV":return this.HHV(t[0],t[1]);case"HV":return this.HV(t[0],t[1]);case"HHVBARS":return this.HHVBARS(t[0],t[1]);case"MULAR":return this.MULAR(t[0],t[1]);case"CROSS":return this.CROSS(t[0],t[1]);case"LONGCROSS":return this.LONGCROSS(t[0],t[1],t[2]);case"ISVALID":return this.ISVALID(t[0]);case"CROSSDOWN":return this.CROSSDOWN(t[0],t[1]);case"CROSSUP":return this.CROSSUP(t[0],t[1]);case"AVEDEV":return this.AVEDEV(t[0],t[1]);case"STD":return this.STD(t[0],t[1]);case"STDDEV":return this.STDDEV(t[0],t[1]);case"IF":case"IFF":case"IFELSE":return this.IF(t[0],t[1],t[2]);case"IFN":return this.IFN(t[0],t[1],t[2]);case"NOT":return this.NOT(t[0]);case"SUM":return this.SUM(t[0],t[1]);case"RANGE":return this.RANGE(t[0],t[1],t[2]);case"EXIST":return this.EXIST(t[0],t[1]);case"EXISTR":return this.EXISTR(t[0],t[1],t[2]);case"FILTER":return this.FILTER(t[0],t[1]);case"TFILTER":return this.TFILTER(t[0],t[1],t[2]);case"FILTERX":return this.FILTERX(t[0],t[1],n);case"SLOPE":return this.SLOPE(t[0],t[1]);case"BARSLAST":return this.BARSLAST(t[0]);case"BARSLASTS":return this.BARSLASTS(t[0],t[1],n);case"BARSCOUNT":return this.BARSCOUNT(t[0]);case"BARSSINCEN":return this.BARSSINCEN(t[0],t[1]);case"BARSSINCE":return this.BARSSINCE(t[0]);case"LAST":return this.LAST(t[0],t[1],t[2]);case"EVERY":return this.EVERY(t[0],t[1]);case"DEVSQ":return this.DEVSQ(t[0],t[1]);case"ZIG":return this.ZIG(t[0],t[1]);case"TROUGHBARS":return this.TROUGHBARS(t[0],t[1],t[2]);case"TROUGH":return this.TROUGH(t[0],t[1],t[2]);case"PEAKBARS":return this.PEAKBARS(t[0],t[1],t[2]);case"PEAK":return this.PEAK(t[0],t[1],t[2]);case"COST":return this.COST(t[0]);case"WINNER":return this.WINNER(t[0],n);case"PPART":return this.PPART(t[0],n);case"COSTEX":return this.COSTEX(t[0],t[1],n);case"LWINNER":return this.LWINNER(t[0],t[1],n);case"PWINNER":return this.PWINNER(t[0],t[1],n);case"FORCAST":return this.FORCAST(t[0],t[1]);case"TSMA":return this.TSMA(t[0],t[1]);case"STDP":return this.STDP(t[0],t[1]);case"VAR":return this.VAR(t[0],t[1]);case"VARP":return this.VARP(t[0],t[1]);case"UPNDAY":return this.UPNDAY(t[0],t[1]);case"DOWNNDAY":return this.DOWNNDAY(t[0],t[1]);case"NDAY":return this.NDAY(t[0],t[1],t[2]);case"RELATE":return this.RELATE(t[0],t[1],t[2]);case"COVAR":return this.COVAR(t[0],t[1],t[2]);case"BETA":return this.BETA(t[0]);case"BETA2":return this.BETA2(t[0],t[1],t[2]);case"WMA":return this.WMA(t[0],t[1]);case"MEMA":return this.MEMA(t[0],t[1]);case"SUMBARS":return this.SUMBARS(t[0],t[1]);case"REVERSE":return this.REVERSE(t[0]);case"SAR":return this.SAR(t[0],t[1],t[2]);case"SARTURN":return this.SARTURN(t[0],t[1],t[2]);case"BACKSET":return this.BACKSET(t[0],t[1]);case"BETWEEN":return this.BETWEEN(t[0],t[1],t[2]);case"STRCAT":return this.STRCAT(t[0],t[1]);case"CON2STR":return this.CON2STR(t[0],t[1]);case"VAR2STR":return this.VAR2STR(t[0],t[1]);case"VARCAT":return this.VARCAT(t[0],t[1]);case"STRSPACE":return this.STRSPACE(t[0]);case"FINDSTR":return this.FINDSTR(t[0],t[1]);case"STRCMP":return this.STRCMP(t[0],t[1]);case"STRLEN":return this.STRLEN(t[0]);case"STRFORMAT":return this.STRFORMAT(t[0],t,n);case"DTPRICE":return this.DTPRICE(t[0],t[1]);case"ZTPRICE":return this.ZTPRICE(t[0],t[1]);case"MOD":return this.MOD(t[0],t[1]);case"POW":return this.POW(t[0],t[1]);case"CEILING":return this.CEILING(t[0]);case"FLOOR":return this.FLOOR(t[0]);case"FRACPART":return this.FRACPART(t[0]);case"SIGN":return this.SIGN(t[0]);case"BARSLASTCOUNT":return this.BARSLASTCOUNT(t[0]);case"INTPART":return this.INTPART(t[0]);case"CONST":return this.CONST(t[0]);case"TOPRANGE":return this.TOPRANGE(t[0]);case"LOWRANGE":return this.LOWRANGE(t[0]);case"FINDLOW":return this.FINDLOW(t[0],t[1],t[2],t[3]);case"FINDLOWBARS":return this.FINDLOWBARS(t[0],t[1],t[2],t[3]);case"FINDHIGH":return this.FINDHIGH(t[0],t[1],t[2],t[3]);case"FINDHIGHBARS":return this.FINDHIGHBARS(t[0],t[1],t[2],t[3]);case"BARSNEXT":return this.BARSNEXT(t[0]);case"HOD":return this.HOD(t[0],t[1]);case"LOD":return this.LOD(t[0],t[1]);case"AMA":return this.AMA(t[0],t[1]);case"TMA":return this.TMA(t[0],t[1],t[2]);case"ROUND":return this.ROUND(t[0]);case"ROUND2":return this.ROUND2(t[0],t[1]);case"TRMA":return this.TRMA(t[0],t[1]);case"VALUEWHEN":return this.VALUEWHEN(t[0],t[1]);case"HARMEAN":return this.HARMEAN(t[0],t[1]);case"DATETODAY":return this.DATETODAY(t[0]);case"DAYTODATE":return this.DAYTODATE(t[0]);case"TIMETOSEC":return this.TIMETOSEC(t[0]);case"SECTOTIME":return this.SECTOTIME(t[0]);case"ANY":return this.ANY(t[0],t[1]);case"ALL":return this.ALL(t[0],t[1]);case"TESTSKIP":return this.TESTSKIP(t[0],n);case"SUMBARS":return this.SUMBARS(t[0],t[1]);case"ALIGNRIGHT":return this.ALIGNRIGHT(t[0]);case"ATAN":return this.Trigonometric(t[0],Math.atan);case"ACOS":return this.ACOS(t[0]);case"ASIN":return this.ASIN(t[0]);case"COS":return this.Trigonometric(t[0],Math.cos);case"SIN":return this.Trigonometric(t[0],Math.sin);case"TAN":return this.Trigonometric(t[0],Math.tan);case"LN":return this.Trigonometric(t[0],Math.log);case"LOG":return this.Trigonometric(t[0],od.default);case"EXP":return this.Trigonometric(t[0],Math.exp);case"SQRT":return this.Trigonometric(t[0],Math.sqrt);case"RAND":return this.RAND(t[0]);default:this.ThrowUnexpectedNode(n,"函数"+r+"不存在",r)}},this.CallCustomFunction=function(r,t,n,s){var o=Yt.CustomFunction.Data.get(r),l=n.GetStockCacheData({CustomName:r,Node:s});if(!o.Invoke)return{Out:l};k.Complier.Log("[JSAlgorithm::CallCustomFunction] call custom function functionInfo=",o);var h=this,u={Name:r,Args:t,Symbol:n.Symbol,Period:n.Period,Right:n.Right,KData:n.Data,DownloadData:l,ThrowError:function(C){h.ThrowUnexpectedNode(s,C)}};return o.Invoke(u)},this.ThrowUnexpectedNode=function(r,t,n){var s=r.Marker,o=t||"执行异常";return this.ErrorHandler.ThrowError(s.Index,s.Line,s.Column,o,n)}}pi.prototype.IsNumber=function(e){return!(e==null||isNaN(e))};pi.prototype.IsDivideNumber=function(e){return!(e==null||isNaN(e)||e==0)};pi.MOD=function(e,a){if(e<0&&a<0||e>=0&&a>=0){if(parseInt(e)==e&&parseInt(a)==a)return e%a;var r=parseFloat((e-Math.floor(e/a)*a).toFixed(1));return r}else{var t=Math.abs(e),n=Math.abs(a),r=Math.abs(Math.abs(a)*(Math.floor(t/n)+1)-Math.abs(e));return a<0&&(r=-r),r}};function Wr(e,a){this.ErrorHandler=e,this.SymbolData=a,this.DRAWTEXT=function(r,t,n){var s=[],o={DrawData:s,DrawType:"DRAWTEXT",Text:n};if(Array.isArray(r)){if(r.length<=0)return o;var l=this.IsNumber(t),h=!1;(t==="TOP"||t==="BOTTOM")&&(o.FixedPosition=t,h=!0);for(var u in r)s[u]=null,!(isNaN(r[u])||!r[u])&&(l||h?s[u]=t:this.IsNumber(t[u])&&(s[u]=t[u]))}else if(this.IsNumber(r)&&r){var l=this.IsNumber(t),h=!1;(t==="TOP"||t==="BOTTOM")&&(o.FixedPosition=t,h=!0);for(var u=0;u<this.SymbolData.Data.Data.length;++u)l||h?s[u]=t:this.IsNumber(t[u])&&(s[u]=t[u])}return o},this.DRAWTEXT_FIX=function(r,t,n,s,o){var l={Value:[],Text:[]},h={DrawData:l,DrawType:"DRAWTEXT_FIX",Text:null,Position:{X:t,Y:n,Type:s}};if(r.length<=0)return h;if(Array.isArray(r))for(var u in r)l.Text[u]=null,l.Value[u]=0,!(isNaN(r[u])||!r[u])&&(l.Value[u]=1,l.Text[u]=o);else if(r)for(var u=0;u<this.SymbolData.Data.Data.length;++u)l.Text[u]=o,l.Value[u]=1;return h},this.SUPERDRAWTEXT=function(r,t,n,s,o){var l=[],h={DrawData:l,DrawType:"SUPERDRAWTEXT",Text:n,YOffset:o,Direction:s,TextAlign:"center"};if(r.length<=0)return h;var u=typeof t=="number";for(var f in r)l[f]=null,!(isNaN(r[f])||!r[f])&&(u?l[f]=t:this.IsNumber(t[f])&&(l[f]=t[f]));return h},this.STICKLINE=function(r,t,n,s,o){var l=[],h={DrawData:l,DrawType:"STICKLINE",Width:s,Type:o};h.Width<0&&(h.Width=3);var u=typeof t=="number",f=typeof n=="number";if(Array.isArray(r)){if(r.length<=0)return h;for(var C in r)if(l[C]=null,!(isNaN(r[C])||!r[C]))if(u&&f)l[C]={Value:t,Value2:n};else if(u&&!f){if(isNaN(n[C]))continue;l[C]={Value:t,Value2:n[C]}}else if(!u&&f){if(isNaN(t[C]))continue;l[C]={Value:t[C],Value2:n}}else{if(isNaN(t[C])||isNaN(n[C]))continue;l[C]={Value:t[C],Value2:n[C]}}}else{if(!r)return h;for(var C=0;C<this.SymbolData.Data.Data.length;++C)if(l[C]=null,u&&f)l[C]={Value:t,Value2:n};else if(u&&!f){if(!v.IsNumber(n[C]))continue;l[C]={Value:t,Value2:n[C]}}else if(!u&&f){if(!v.IsNumber(t[C]))continue;l[C]={Value:t[C],Value2:n}}else{if(!v.IsNumber(t[C])||!v.IsNumber(n[C]))continue;l[C]={Value:t[C],Value2:n[C]}}}return h},this.DRAWLINE=function(r,t,n,s,o){var l=[],h={DrawData:l,DrawType:"DRAWLINE",Expand:o};if(r.length<=0)return h;for(var u=Math.max(r.length,n.length),f=!1,C=!1,D={Start:{},End:{},List:new Array},c=0;c<u;++c){if(l[c]=null,c<r.length&&c<n.length){if(f==!1&&C==!1){if(r[c]==null||!r[c])continue;f=!0,D.Start={ID:c,Value:t[c]}}else if(f==!0&&C==!1){var T=n[c]!=null&&n[c];if(!T){r[c]&&(D.Start={ID:c,Value:t[c]});continue}T&&(C=!0,D.End={ID:c,Value:s[c]})}else if(f==!0&&C==!0){var T=n[c]!=null&&n[c];if(T)D.End={ID:c,Value:s[c]};else if(r[c]){var S=this.CalculateDrawLine(D);for(var I in S){var g=S[I];l[g.ID]=g.Value}o==1&&this.CalculateDrawDataExtendLine(l,D.Start.ID-2),f=C=!1,D={Start:{},End:{}},f=!0,C=!1,D.Start={ID:c,Value:t[c]}}}}if(f==!0&&C==!0){var E=this.CalculateDrawLine(D);for(var F in E){var R=E[F];l[R.ID]=R.Value}}}return o==1&&this.CalculateDrawDataExtendLine(l),h},this.DRAWBAND=function(r,t,n,s){v.IsNumber(t)&&(t="rgb("+t+",0,0)"),v.IsNumber(s)&&(s="rgb("+s+",0,0)");var o=[],l={DrawData:o,DrawType:"DRAWBAND",Color:[null,null]};t&&(l.Color[0]=t.toLowerCase()),s&&(l.Color[1]=s.toLowerCase());var h=v.IsNumber(r),u=v.IsNumber(n);if(!h&&!u)for(var f=Math.max(r.length,n.length),C=0;C<f;++C){var D={Value:null,Value2:null};C<r.length&&(D.Value=r[C]),C<n.length&&(D.Value2=n[C]),o.push(D)}else if(h&&!u)for(var f=n.length,C=0;C<f;++C){var D={Value:r,Value2:null};C<n.length&&(D.Value2=n[C]),o.push(D)}else if(!h&&u)for(var f=r.length,C=0;C<f;++C){var D={Value:null,Value2:n};C<r.length&&(D.Value=r[C]),o.push(D)}else if(h&&u)for(var f=this.SymbolData.Data.Data.length,C=0;C<f;++C){var D={Value:r,Value2:n};o.push(D)}return l},this.GetDataByIndex=function(r,t){var n={Result:!1,Data:null};return this.IsNumber(r)?(n.Result=!0,n.Data=r):t<r.length?(n.Result=!0,n.Data=r[t]):n.Result=!1,n},this.FILLRGN=function(r,t,n){var s=[],o={DrawData:s,DrawType:"FILLRGN"};if(this.IsNumber(t),this.IsNumber(n),Array.isArray(r))for(var l in r){s[l]=null;var h=r[l];if(h){var u=this.GetDataByIndex(t,l);if(u.Result){var f=this.GetDataByIndex(n,l);if(f.Result){var C={Value:u.Data,Value2:f.Data};s[l]=C}}}}else if(r)for(var l=0;l<this.SymbolData.Data.Data.length;++l){s[l]=null;var u=this.GetDataByIndex(t,l);if(u.Result){var f=this.GetDataByIndex(n,l);if(f.Result){var C={Value:u.Data,Value2:f.Data};s[l]=C}}}return o},this.DRAWKLINE=function(r,t,n,s){for(var o=[],l={DrawData:o,DrawType:"DRAWKLINE"},h=Math.max(r.length,t.length,n.length,s.length),u=0;u<h;++u){var f={Open:null,High:null,Low:null,Close:null};u<r.length&&u<t.length&&u<n.length&&u<s.length&&(f.Open=t[u],f.High=r[u],f.Low=n[u],f.Close=s[u]),o[u]=f}return l},this.DRAWKLINE_IF=function(r,t,n,s,o){for(var l=[],h={DrawData:l,DrawType:"DRAWKLINE_IF"},u=Math.max(r.length,t.length,n.length,s.length,o.length),f=0;f<u;++f){var C={Open:null,High:null,Low:null,Close:null};f<t.length&&f<n.length&&f<s.length&&f<o.length&&f<r.length&&r[f]&&(C.Open=n[f],C.High=t[f],C.Low=s[f],C.Close=o[f]),l[f]=C}return h},this.DRAWOVERLAYKLINE=function(r,t,n,s){for(var o=[],l={DrawData:o,DrawType:"DRAWOVERLAYKLINE"},h=Math.max(t.length,r.length,n.length,s.length),u=this.SymbolData.Data.Data,f=0;f<h;++f){var C={Open:null,High:null,Low:null,Close:null},D=u[f];f<t.length&&f<r.length&&f<n.length&&f<s.length&&v.IsNumber(r[f])&&v.IsNumber(t[f])&&v.IsNumber(n[f])&&v.IsNumber(n[f])&&(C.Open=r[f],C.High=t[f],C.Low=n[f],C.Close=s[f],C.Date=D.Date,v.IsNumber(D.Time)&&(C.Time=D.Time)),o[f]=C}return l},this.DRAWCOLORKLINE=function(r,t,n){var s=[],o={DrawData:s,DrawType:"DRAWCOLORKLINE",IsEmptyBar:n!=0,Color:t};if(Array.isArray(r))for(var l=0;l<r.length&&l<this.SymbolData.Data.Data.length;++l){s[l]=null;var h=r[l];if(h){var u=this.SymbolData.Data.Data[l];u&&(s[l]={Open:u.Open,High:u.High,Low:u.Low,Close:u.Close})}}else if(r)for(var l=0;l<this.SymbolData.Data.Data.length;++l){s[l]=null;var u=this.SymbolData.Data.Data[l];u&&(s[l]={Open:u.Open,High:u.High,Low:u.Low,Close:u.Close})}return o},this.POLYLINE=function(r,t){var n=[],s={DrawData:n,DrawType:"POLYLINE"},o=v.IsNumber(t),l=!1,h=!1;if(o){if(this.IsNumber(r)){if(r)for(var u=this.SymbolData.Data.Data.length,f=0;f<u;++f)n[f]=t}else if(Array.isArray(r))for(var C=!1,f=0;f<r.length;++f)if(n[f]=null,C)n[f]=t;else{if(!r[f])continue;C=!0,n[f]=t}}else if(v.IsNumber(r)){if(!r)return s;for(var D={Start:{},End:{},List:[]},f=0;f<t.length;++f)if(n[f]=null,l==!1&&h==!1){if(!this.IsNumber(t[f]))continue;l=!0,D.Start={ID:parseInt(f),Value:t[f]}}else if(l==!0&&h==!1){if(!this.IsNumber(t[f]))continue;D.End={ID:parseInt(f),Value:t[f]};var c=this.CalculateDrawLine(D);for(var T in c){var S=c[T];n[S.ID]=S.Value}var I={ID:D.End.ID,Value:D.End.Value};D={Start:I,End:{}}}this.CalculateDrawDataExtendLine(n)}else{var g={Start:{},End:{},List:[]};for(var E in r)if(n[E]=null,l==!1&&h==!1){if(r[E]==null||!r[E]||E>=t.length||!this.IsNumber(t[E]))continue;l=!0,g.Start={ID:parseInt(E),Value:t[E]}}else if(l==!0&&h==!1){if(r[E]==null||!r[E]||E>=t.length||!this.IsNumber(t[E]))continue;g.End={ID:parseInt(E),Value:t[E]};var F=this.CalculateDrawLine(g);for(var R in F){var A=F[R];n[A.ID]=A.Value}var P={ID:g.End.ID,Value:g.End.Value};g={Start:P,End:{}}}this.CalculateDrawDataExtendLine(n)}return s},this.CalculateDrawDataExtendLine=function(r,t){if(!(t<0)){var n=null,s=r.length;this.IsNumber(t)&&t<s&&(s=t);for(var o=s-1;o>=0;--o)if(this.IsNumber(r[o])){n=o;break}if(n!=null&&n-1>=0)for(var l=n-1,o=n+1;o<s;++o){var h=r[l],u=r[n],f=(h-u)*(o-l)/(n-l);if(h-f<0)break;r[o]=h-f}}},this.DRAWNUMBER=function(r,t,n,s){var o={Value:[],Text:[]},l={DrawData:o,DrawType:"DRAWNUMBER"},h=2;v.IsNumber(s)&&(h=s);var u={DataType:0,SingleValue:null,ArrayValue:null};Array.isArray(t)?(u.ArrayValue=t,u.DataType=2):((t==="TOP"||t==="BOTTOM")&&(l.FixedPosition=t),u.SingleValue=t,u.DataType=1);var f={DataType:0,SingleValue:null,ArrayValue:null};if(Array.isArray(n)?(f.ArrayValue=n,f.DataType=2):(f.SingleValue=n,f.DataType=1,v.IsNumber(n)&&(v.IsInteger(n)?f.SingleValue=n.toString():text=n.toFixed(h))),Array.isArray(r))for(var C=0;C<r.length;++C)o.Value[C]=null,r[C]&&(o.Value[C]=this.DRAWNUMBER_Temp_PriceItem(C,u),o.Text[C]=this.DRAWNUMBER_Temp_NumberItem(C,f,h));else if(this.IsNumber(r)&&r)for(var C=0;C<this.SymbolData.Data.Data.length;++C)o.Value[C]=this.DRAWNUMBER_Temp_PriceItem(C,u),o.Text[C]=this.DRAWNUMBER_Temp_NumberItem(C,f,h);return l},this.DRAWNUMBER_Temp_PriceItem=function(r,t){return t?t.DataType==1?t.SingleValue:v.IsNonEmptyArray(t.ArrayValue)?t.ArrayValue[r]:null:null},this.DRAWNUMBER_Temp_NumberItem=function(r,t,n){if(!t)return null;if(t.DataType==1)return t.SingleValue;if(!v.IsNonEmptyArray(t.ArrayValue))return null;var s=t.ArrayValue[r];return this.IsNumber(s)?v.IsInteger(s)?s.toString():s.toFixed(n):s.toString()},this.DRAWNUMBER_FIX=function(r,t,n,s,o){var l={Value:[],Text:[]},h={DrawData:l,DrawType:"DRAWNUMBER_FIX",Position:{X:t,Y:n,Type:s}},u=v.IsNumber(o);if(Array.isArray(r)){for(var f in r)if(l.Text[f]=null,l.Value[f]=null,!!r[f])if(u)l.Text[f]=this.RemoveZero(o.toFixed(2)),l.Value[f]=o;else{if(f>=o.length||!v.IsNumber(o[f]))continue;var C=o[f];l.Text[f]=this.RemoveZero(C.toFixed(2)),l.Value[f]=C}}else if(r)for(var f=0;f<this.SymbolData.Data.Data.length;++f)if(u)l.Text[f]=this.RemoveZero(o.toFixed(2)),l.Value[f]=o;else{if(f>=o.length||!v.IsNumber(o[f]))continue;var C=o[f];l.Text[f]=this.RemoveZero(C.toFixed(2)),l.Value[f]=C}return h},this.DRAWICON=function(r,t,n){if(v.IsString(n)){var s=n.replace("ICO","");n=parseInt(s)}var o=Yt.GetDrawIcon(n);o||Yt.GetDrawTextIcon(n),o||(o={Symbol:"🚩"});var l=[],h={DrawData:l,DrawType:"DRAWICON",Icon:o,IconType:n};if(r.length<=0)return h;var u=typeof t=="number";if(typeof r=="number"){if(!r)return h;for(var f=0;f<this.SymbolData.Data.Data.length;++f)u?l[f]=t:f<t.length&&this.IsNumber(t[f])?l[f]=t[f]:l[f]=null;return h}for(var f in r)l[f]=null,r[f]&&(u?l[f]=t:this.IsNumber(t[f])&&(l[f]=t[f]));return h},this.ICON=function(r,t){if(v.IsString(t)){var n=t.replace("ICO","");t=parseInt(n)}var s=Yt.GetDrawIcon(t);s||Yt.GetDrawTextIcon(t),s||(s={Symbol:"🚩"});for(var o=[],l={DrawData:o,DrawType:"ICON",Icon:s},h=0;h<this.SymbolData.Data.Data.length;++h){var u=this.SymbolData.Data.Data[h];u&&(r==0?o[h]=u.Low:r==1&&(o[h]=u.High))}return l},this.TIPICON=function(r,t,n,s){if(v.IsString(n)){var o=n.replace("ICO","");n=parseInt(o)}var l=Yt.GetDrawIcon(n),h=[],u={DrawData:h,DrawType:"TIPICON",Icon:l,IconType:n,Text:s};if(r.length<=0)return u;var f=typeof t=="number";if(v.IsNumber(r)){if(!r)return u;for(var C=0;C<this.SymbolData.Data.Data.length;++C)f?h[C]=t:C<t.length&&v.IsNumber(t[C])?h[C]=t[C]:h[C]=null}else if(Array.isArray(r))for(var C=0;C<r.length;++C)h[C]=null,r[C]&&(f?h[C]=t:v.IsNumber(t[C])&&(h[C]=t[C]));return u},this.DRAWCHANNEL=function(r,t,n,s,o,l,h){var u=[],f={DrawData:u,DrawType:"DRAWCHANNEL",Border:{}};if(r.length<=0)return f;if(s&&(f.Border.Color=s),h&&(f.AreaColor=h),o>0&&(f.Border.Width=o),l)if(l=="0")f.Border.Dotted=[];else{var C=l.split(",");f.Border.Dotted=[];for(var D in C){var c=C[D];if(c){var T=parseInt(C[D]);v.IsNumber(T)&&(T<=0||f.Border.Dotted.push(T))}}f.Border.Dotted.length<=0&&(f.Border.Dotted=null)}var S=typeof t=="number",I=typeof n=="number";if(typeof r=="number"){if(!r)return f;for(var D=0;D<this.SymbolData.Data.Data.length;++D)if(u[D]=null,S&&I)u[D]={Value:t,Value2:n};else if(S&&!I){if(isNaN(n[D]))continue;u[D]={Value:t,Value2:n[D]}}else if(!S&&I){if(isNaN(t[D]))continue;u[D]={Value:t[D],Value2:n}}else{if(isNaN(t[D])||isNaN(n[D]))continue;u[D]={Value:t[D],Value2:n[D]}}}else for(var D=0;D<r.length;++D)if(u[D]=null,!(isNaN(r[D])||!r[D]))if(S&&I)u[D]={Value:t,Value2:n};else if(S&&!I){if(isNaN(n[D]))continue;u[D]={Value:t,Value2:n[D]}}else if(!S&&I){if(isNaN(t[D]))continue;u[D]={Value:t[D],Value2:n}}else{if(isNaN(t[D])||isNaN(n[D]))continue;u[D]={Value:t[D],Value2:n[D]}}return f},this.RGB=function(r,t,n){var s="RGB("+r+","+t+","+n+")";return s},this.RGBA=function(r,t,n,s){var o="RGB("+r+","+t+","+n+","+s+")";return o},this.UPCOLOR=function(r){return r},this.DOWNCOLOR=function(r){return r},this.STICKTYPE=function(r){return r},this.XMOVE=function(r){return r},this.YMOVE=function(r){return r},this.LINEDASH=function(r){return v.IsNonEmptyArray(r)?r.slice():[]},this.KLINETYPE=function(r){return r},this.FIRSTDRAW=function(r){return r},this.SOUND=function(r){return{Name:"SOUND",Value:r}},this.PLAYSOUND=function(r,t){return null},this.PARTLINE=function(r){var t=[],n={DrawData:t,DrawType:"PARTLINE"};if(r.length<3)return n;for(var s=r[0],o=[],l=1;l<r.length&&l+1<r.length;l+=2)o.push({Cond:r[l],RGB:r[l+1]});for(var l in s){var h={Value:null,RGB:null};t[l]=h;var u=s[l];if(this.IsNumber(u)){var f=null;for(var C in o){var D=o[C];if(Array.isArray(D.Cond)){if(l<D.Cond.length&&D.Cond[l]){f=D.RGB;break}}else if(this.IsNumber(D.Cond)&&D.Cond){f=D.RGB;break}}f&&(h.Value=u,h.RGB=f)}}return n},this.FILLRGN2=function(r){var t=[],n={DrawData:t,DrawType:"FILLRGN2"};if(r.length<4)return n;for(var s=r[0],o=r[1],l=[],h=2;h<r.length&&h+1<r.length;h+=2)l.push({Cond:r[h],Color:r[h+1]});for(var h=0;h<this.SymbolData.Data.Data.length;++h){t[h]=null;var u={Value:null,Value2:null,Color:null};for(var f in l){var C=l[f];if(Array.isArray(C.Cond)){if(h<C.Cond.length&&C.Cond[h]){u.Color=C.Color;break}}else if(this.IsNumber(C.Cond)&&C.Cond){u.Color=C.Color;break}}if(u.Color){if(Array.isArray(s)){if(h>=s.length||!this.IsNumber(s[h]))continue;u.Value=s[h]}else if(this.IsNumber(s))u.Value=s;else continue;if(Array.isArray(o)){if(h>=o.length||!this.IsNumber(o[h]))continue;u.Value2=o[h]}else if(this.IsNumber(o))u.Value2=o;else continue;t[h]=u}}return n},this.FLOATRGN=function(r){var t=[],n={DrawData:t,DrawType:"FLOATRGN"};if(r.length<4)return n;for(var s=r[0],o=r[1],l=[],h=2;h<r.length&&h+1<r.length;h+=2)l.push({Cond:r[h],Color:r[h+1]});for(var h=0;h<this.SymbolData.Data.Data.length;++h){t[h]=null;var u={Value:null,Value2:null,Color:null};for(var f in l){var C=l[f];if(Array.isArray(C.Cond)){if(h<C.Cond.length&&C.Cond[h]){u.Color=C.Color;break}}else if(this.IsNumber(C.Cond)&&C.Cond){u.Color=C.Color;break}}if(u.Color){if(Array.isArray(s)){if(h>=s.length||!this.IsNumber(s[h]))continue;u.Value=s[h]}else if(this.IsNumber(s))u.Value=s;else continue;if(Array.isArray(o)){if(h>=o.length||!this.IsNumber(o[h]))continue;u.Value2=o[h]}else if(this.IsNumber(o))u.Value2=o;else continue;t[h]=u}}return n},this.FILLBGRGN=function(r,t){var n=[],s={DrawData:n,DrawType:r==1?"FILLTOPRGN":"FILLBOTTOMRGN"};if(t.length<3)return s;for(var o=t[0],l=[],h=1;h<t.length&&h+1<t.length;h+=2)l.push({Cond:t[h],Color:t[h+1]});for(var h=0;h<this.SymbolData.Data.Data.length;++h){n[h]=null;var u={Value:null,Color:null};for(var f in l){var C=l[f];if(Array.isArray(C.Cond)){if(h<C.Cond.length&&C.Cond[h]){u.Color=C.Color;break}}else if(this.IsNumber(C.Cond)&&C.Cond){u.Color=C.Color;break}}if(u.Color){if(Array.isArray(o)){if(h>=o.length||!this.IsNumber(o[h]))continue;u.Value=o[h]}else if(this.IsNumber(o))u.Value=o;else continue;n[h]=u}}return s},this.FILLVERTICALRGN=function(r){var t=[],n={DrawData:t,DrawType:"FILLVERTICALRGN"};if(r.length<2)return n;for(var s=[],o=0;o<r.length&&o+1<r.length;o+=2)s.push({Cond:r[o],Color:r[o+1]});for(var o=0;o<this.SymbolData.Data.Data.length;++o){t[o]=null;var l={Color:null};for(var h in s){var u=s[h];if(Array.isArray(u.Cond)){if(o<u.Cond.length&&u.Cond[o]){l.Color=u.Color;break}}else if(this.IsNumber(u.Cond)&&u.Cond){l.Color=u.Color;break}}l.Color&&(t[o]=l)}return n},this.DRAWGBK=function(r,t,n,s){var o={Color:[],Angle:s};t&&o.Color.push(t),n&&o.Color.push(n);var l={DrawData:null,DrawType:"DRAWGBK"};if(Array.isArray(r))for(var h in r){var u=r[h];if(u){l.DrawData=o;break}}else r&&(l.DrawData=o);return l},this.DRAWGBK2=function(r,t,n,s){var o={Color:[],Angle:s};t&&o.Color.push(t),n&&o.Color.push(n);var l={DrawData:null,DrawType:"DRAWGBK2"};if(Array.isArray(r)){o.Data=[];for(var h in r){var u=r[h];o.Data[h]=u?1:0}l.DrawData=o}else r&&(l.DrawData=o,l.DrawType="DRAWGBK");return l},this.DRAWGBK_DIV=function(r,t,n,s,o){var l={AryColor:[t,n],ColorType:s,FillType:o,Data:[]},h={DrawData:l,DrawType:"DRAWGBK_DIV"};if(!this.SymbolData||!this.SymbolData.Data||!v.IsNonEmptyArray(this.SymbolData.Data.Data))return h;var u=this.SymbolData.Data.Data;if(Array.isArray(r))for(var f=0;f<u.length;++f){var C=r[f],D=null;if(C){var c=u[f];o==1?D={AryValue:[c.High,c.Low]}:o==2?D={AryValue:[c.Open,c.Close]}:D={AryValue:null}}l.Data[f]=D}else if(r)for(var f=0;f<u.length;++f){var c=u[f],D=null;o==1?D={AryValue:[c.High,c.Low]}:o==2?D={AryValue:[c.Open,c.Close]}:D={AryValue:null},l.Data[f]=D}return h},this.DRAWTEXT_LINE=function(r,t,n,s,o,l,h){var u={Text:{Title:n,Color:s},Line:{Type:l,Color:h}};o<=0&&(o=12),u.Text.Font=o*B()+"px 微软雅黑";var f={DrawData:null,DrawType:"DRAWTEXT_LINE"};if(Array.isArray(r)){var C=null;v.IsNonEmptyArray(r)&&(C=r[r.length-1]),C&&(Array.isArray(t)?u.Price=t[r.length-1]:u.Price=t,f.DrawData=u)}else if(r){if(Array.isArray(t)){var D=null;t.length>0&&(D=t[t.length-1]),u.Price=D}else u.Price=t;f.DrawData=u}return f},this.DRAWRECTREL=function(r,t,n,s,o){var l={Rect:{Left:Math.min(r,n),Top:Math.min(t,s),Right:Math.max(n,r),Bottom:Math.max(s,t)},Color:o};o==0&&(l.Color=null);var h={DrawData:l,DrawType:"DRAWRECTREL"};return h},this.DRAWTEXTREL=function(r,t,n){var s={Point:{X:r,Y:t}};v.IsString(n)?s.Text=n:v.IsNonEmptyArray(n)&&(s.Text=n[0]);var o={DrawData:s,DrawType:"DRAWTEXTREL"};return o},this.DRAWTEXTABS=function(r,t,n){var s={Point:{X:r,Y:t}};v.IsString(n)?s.Text=n:v.IsNonEmptyArray(n)&&(s.Text=n[0]);var o={DrawData:s,DrawType:"DRAWTEXTABS"};return o},this.DRAWOVERLAYLINE=function(r,t,n){var s={Data:r,MainData:t};n&&typeof n=="string"&&(s.Title=n);var o={DrawData:s,DrawType:"DRAWOVERLAYLINE"};return o},this.DRAWSL=function(r,t,n,s,o){var l={Data:[],Option:[]},h={DrawData:l,DrawType:"DRAWSL"},u=this.IsNumber(t);if(Array.isArray(r))for(var f in r)l.Data[f]=null,r[f]&&(u?(l.Data[f]=t,l.Option[f]={Slope:n,Length:s,Direct:o}):f<t.length&&this.IsNumber(t[f])&&(l.Data[f]=t[f],l.Option[f]={Slope:n,Length:s,Direct:o}));else if(r)for(var C=this.SymbolData.Data.Data.length,f=0;f<C;++f)l.Data[f]=null,u?(l.Data[f]=t,l.Option[f]={Slope:n,Length:s,Direct:o}):f<t.length&&this.IsNumber(t[f])&&(l.Data[f]=t[f],l.Option[f]={Slope:n,Length:s,Direct:o});return h},this.VERTLINE=function(r,t){var n={Data:[],LineType:t},s={DrawData:n,DrawType:"VERTLINE"};if(Array.isArray(r))for(var o=0;o<r.length;++o){var l=r[o];l?n.Data[o]=1:n.Data[o]=0}return s},this.HORLINE=function(r,t,n,s){var o={Data:[],LineType:n,Extend:s},l={DrawData:o,DrawType:"HORLINE"};if(Array.isArray(r)&&Array.isArray(t))for(var h=0;h<r.length;++h){var u=r[h];if(o.Data[h]=null,!!u&&!(h>=t.length)){var f=t[h];v.IsNumber(f)&&(o.Data[h]=f)}}else if(Array.isArray(r)&&v.IsNumber(t))for(var h=0;h<r.length;++h){var u=r[h];o.Data[h]=null,u&&(o.Data[h]=t)}else if(v.IsNumber(r)&&r&&this.SymbolData&&this.SymbolData.Data&&this.SymbolData.Data.Data){if(Array.isArray(t)){for(var C=this.SymbolData.Data.Data.length,h=0;h<C;++h)if(o.Data[h]=null,!(h>=t.length)){var f=t[h];v.IsNumber(f)&&(o.Data[h]=f)}}else if(v.IsNumber(t))for(var C=this.SymbolData.Data.Data.length,h=0;h<C;++h)o.Data[h]=t}return l},this.BACKGROUND=function(r,t,n,s,o,l){var h={Margin:[0,1,1,1]};return r&&(h.Color=r),t&&(h.Border=t),v.IsNumber(n)&&(h.Margin[2]=n),v.IsNumber(s)&&(h.Margin[3]=s),v.IsNumber(o)&&(h.Margin[0]=o),v.IsNumber(l)&&(h.Margin[1]=l),h},this.CKLINE=function(r,t,n,s){var o={Color:r,LineWidth:1,LineType:0,LineDot:[3,3]};if(v.IsPlusNumber(t)&&(o.LineWidth=t),v.IsPlusNumber(n)&&(o.LineType=n),s){var l=s.split(","),h=[];for(var u in l){var f=l[u];if(f){var C=parseInt(l[u]);C<=0||h.push(C)}}h.length>0&&(o.LineDotted=h)}o.Data=[];for(var u=0;u<this.SymbolData.Data.Data.length;++u){var f=this.SymbolData.Data.Data[u];o.Data[u]={High:f.High,Low:f.Low}}return o},this.BUY=function(r,t,n,s){var o={Color:"rgb(0,255,0)",Type:"SVG",Icon:""};v.IsString(n)&&(o.Icon=n),s&&(o.Color=s);var l=this.CalculateTradeData(r,t,o);return l.DrawType="BUY",l},this.BUYSHORT=function(r,t,n,s){var o={Color:"rgb(0,255,0)",Type:"SVG",Icon:""};v.IsString(n)&&(o.Icon=n),s&&(o.Color=s);var l=this.CalculateTradeData(r,t,o);return l.DrawType="BUYSHORT",l},this.SELL=function(r,t,n,s){var o={Color:"rgb(255,0,0)",Type:"SVG",Icon:""};v.IsString(n)&&(o.Icon=n),s&&(o.Color=s);var l=this.CalculateTradeData(r,t,o);return l.DrawType="SELL",l},this.SELLSHORT=function(r,t,n,s){var o={Color:"rgb(255,0,0)",Type:"SVG",Icon:""};v.IsString(n)&&(o.Icon=n),s&&(o.Color=s);var l=this.CalculateTradeData(r,t,o);return l.DrawType="SELLSHORT",l},this.CalculateTradeData=function(r,t,n){var s=[],o=[],l={DrawData:{Data:s,Icons:o}};if(Array.isArray(r))for(var h=Array.isArray(t),u=0;u<r.length;++u)s[u]=0,o[u]=null,r[u]&&(s[u]=1,h?o[u]={Value:t[u],Type:n.Type,Color:n.Color,Icon:n.Icon}:o[u]={Value:t,Type:n.Type,Color:n.Color,Icon:n.Icon});else v.IsNumber(r)&&r>0;return l},this.DRAWLASTBARICON=function(r,t){if(v.IsString(t)){var n=t.replace("ICO","");t=parseInt(n)}var s=Yt.GetDrawIcon(t);s||Yt.GetDrawTextIcon(t),s||(s={Symbol:"🚩"});var o={Value:null,Icon:s,IconType:t};v.IsNonEmptyArray(r)?o.Value=r[r.length-1]:o.Value=r;var l={DrawData:o,DrawType:"DRAWLASTBARICON"};return l},this.DRAWLASTBARTEXT=function(r,t){var n={Value:null,Text:t};v.IsNonEmptyArray(r)?n.Value=r[r.length-1]:n.Value=r;var s={DrawData:n,DrawType:"DRAWLASTBARTEXT"};return s},this.DRAWLASTBARNUMBER=function(r,t,n,s){var o={Value:null,Text:null,Color:s};v.IsNonEmptyArray(r)?o.Value=r[r.length-1]:o.Value=r;var l=2;if(v.IsNumber(n)&&(l=parseInt(n)),v.IsNumber(t))o.Text=t.toFixed(l);else if(v.IsNonEmptyArray(t)){var h=t[t.length-1];v.IsNumber(h)&&(o.Text=h.toFixed(l))}var u={DrawData:o,DrawType:"DRAWLASTBARNUMBER"};return u}}Wr.prototype.CalculateDrawLine=function(e){e.List=[];for(var a=e.Start.ID;a<=e.End.ID;++a)e.List.push(a);var r=Math.abs(e.Start.Value-e.End.Value),t=e.List.length-1,n=[];if(n.push({ID:e.Start.ID,Value:e.Start.Value}),e.Start.Value>e.End.Value)for(var s=1;s<e.List.length-1;++s){var o=r*(e.List.length-1-s)/t+e.End.Value;n.push({ID:e.List[s],Value:o})}else for(var l=1;l<e.List.length-1;++l){var o=r*l/t+e.Start.Value;n.push({ID:e.List[l],Value:o})}return n.push({ID:e.End.ID,Value:e.End.Value}),n};Wr.prototype.IsNumber=function(e){return!(e==null||isNaN(e))};Wr.prototype.IsDrawFunction=function(e){var a=new Fe.default(["STICKLINE","DRAWTEXT","SUPERDRAWTEXT","DRAWLINE","DRAWBAND","DRAWKLINE","DRAWKLINE1","DRAWKLINE_IF","DRAWCOLORKLINE","PLOYLINE","DRAWOVERLAYKLINE","POLYLINE","DRAWNUMBER","DRAWNUMBER_FIX","DRAWICON","DRAWCHANNEL","PARTLINE","DRAWTEXT_FIX","DRAWGBK","DRAWTEXT_LINE","DRAWRECTREL","DRAWTEXTABS","DRAWTEXTREL","DRAWOVERLAYLINE","FILLRGN","FILLRGN2","FILLTOPRGN","FILLBOTTOMRGN","FILLVERTICALRGN","FLOATRGN","DRAWSL","DRAWGBK2","DRAWGBK_DIV","VERTLINE","HORLINE","TIPICON","BUY","SELL","SELLSHORT","BUYSHORT","DRAWLASTBARICON","DRAWLASTBARNUMBER","DRAWLASTBARTEXT"]);return!!a.has(e)};Wr.prototype.RemoveZero=function(e){for(;e.length>0;){var a=e.length-1,r=e[a];if(r=="0")e=e.substr(0,a);else if(r=="."){e=e.substr(0,a);break}else break}return e};var hi={YCLOSE:3,OPEN:4,HIGH:5,LOW:6,CLOSE:7,VOL:8,AMOUNT:10,AMPLITUDE:13,INCREASE:14,EXCHANGERATE:37};function wn(e,a,r){this.AST=e,this.Execute=r,this.Symbol="600000.sh",this.Name,this.Data=null,this.PeriodData=new Dt.default,this.IsApiPeriod=!1,this.SourceData=null,this.MarketValue=null,this.Period=0,this.Right=0,this.DataType=0,this.IsBeforeData=!1,this.DayCount,this.Arguments=[],this.KLineApiUrl=Yt.Domain+"/API/KLine2",this.MinuteKLineApiUrl=Yt.Domain+"/API/KLine3",this.RealtimeApiUrl=Yt.Domain+"/API/stock",this.HistoryMinuteApiUrl=d.Domain+"/API/StockMinuteData",this.StockHistoryDayApiUrl=Yt.Domain+"/API/StockHistoryDay",this.StockHistoryDay3ApiUrl=Yt.Domain+"/API/StockHistoryDay3",this.StockHistoryDay2ApiUrl=Yt.Domain+"/API/StockHistoryDay2",this.StockNewsAnalysisApiUrl=Yt.CacheDomain+"/cache/newsanalyze",this.HKToSHSZApiUrl=[Yt.CacheDomain+"/cache/historyday/all/hk2shsz.json",Yt.CacheDomain+"/cache/analyze/hk2shsz/hk2shsz.json",Yt.Domain+"/API/HKToSHSZMinuteData",Yt.CacheDomain+"/cache/analyze/hk2szshanalyze"],this.MaxRequestDataCount=1e3,this.MaxRequestMinuteDayCount=5,this.KLineDateTimeRange,this.LatestData=new Dt.default,this.IndexData,this.LatestIndexData,this.MarginData=new Dt.default,this.HKToSHSZData=new Dt.default,this.NewsAnalysisData=new Dt.default,this.ExtendData=new Dt.default,this.UserData=new Dt.default,this.CustomAPIData=new Dt.default,this.ScriptIndexOutData=new Dt.default,this.OtherSymbolData=new Dt.default,this.StockData=new Dt.default,this.SectionFinanceData=new Dt.default,this.ThrowSFPeirod=new Fe.default,this.NetworkFilter,this.DrawInfo,a&&(a.HQDataType&&(this.DataType=a.HQDataType),a.Data&&(this.Data=a.Data,this.DataType!=wt.MINUTE_ID&&this.DataType!=wt.MULTIDAY_MINUTE_ID&&this.DataType!=wt.HISTORY_MINUTE_ID&&(this.Period=a.Data.Period,this.Right=a.Data.Right)),a.SourceData&&(this.SourceData=a.SourceData),a.Symbol&&(this.Symbol=a.Symbol),a.Name&&(this.Name=a.Name),a.MaxRequestDataCount>0&&(this.MaxRequestDataCount=a.MaxRequestDataCount),a.MaxRequestMinuteDayCount>0&&(this.MaxRequestMinuteDayCount=a.MaxRequestMinuteDayCount),a.KLineApiUrl&&(this.KLineApiUrl=a.KLineApiUrl),a.Right&&(this.Right=a.Right),a.Period&&(this.Period=a.Period),a.IsBeforeData===!0&&(this.IsBeforeData=a.IsBeforeData),a.NetworkFilter&&(this.NetworkFilter=a.NetworkFilter),a.DayCount>0&&(this.DayCount=a.DayCount),a.Arguments&&(this.Arguments=a.Arguments),a.KLineRange&&(this.KLineDateTimeRange=a.KLineRange),a.IsApiPeriod&&(this.IsApiPeriod=a.IsApiPeriod),a.DrawInfo&&(this.DrawInfo=a.DrawInfo)),this.RecvError=function(t){throw k.Complier.Log("[JSSymbolData::RecvError] ajax error.",t.status),{FunctionName:"RecvError",Request:t}},this.GetLatestDataKey=function(n){var n="DYNAINFO-"+n;return n},this.GetLatestData=function(t){var n=this.JobArgumentsToArray(t,1),s=n[0],o=this.GetLatestDataKey(s);if(this.LatestData.has(o))return this.Execute.RunNextJob();var l=this;if(this.NetworkFilter){var h={Name:"JSSymbolData::GetLatestData",Explain:"DYNAINFO()",Args:n,Request:{Url:l.RealtimeApiUrl,Type:"POST",Data:{symbol:[this.Symbol],field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","exchangerate","amplitude"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(h,function(u){l.RecvLatestData(u),l.Execute.RunNextJob()}),h.PreventDefault==!0)return}Vt.HttpRequest({url:l.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","exchangerate","amplitude"],symbol:[this.Symbol]},type:"post",dataType:"json",async:!0,success:function(f){l.RecvLatestData(f),l.Execute.RunNextJob()},error:function(f){l.RecvError(f)}})},this.RecvLatestData=function(t){if(t.ver==2){this.RecvLatestDataVer2(t);return}if(!(!t.stock||t.stock.length!=1)){var n=t.stock[0];n&&(v.IsNumber(n.yclose)&&this.LatestData.set(hi.YCLOSE,n.yclose),v.IsNumber(n.open)&&this.LatestData.set(hi.OPEN,n.open),v.IsNumber(n.high)&&this.LatestData.set(hi.HIGH,n.high),v.IsNumber(n.low)&&this.LatestData.set(hi.LOW,n.low),v.IsNumber(n.price)&&this.LatestData.set(hi.CLOSE,n.price),v.IsNumber(n.vol)&&this.LatestData.set(hi.VOL,n.vol),v.IsNumber(n.amount)&&this.LatestData.set(hi.AMOUNT,n.amount),v.IsNumber(n.increase)&&this.LatestData.set(hi.INCREASE,n.increase),v.IsNumber(n.exchangerate)&&this.LatestData.set(hi.EXCHANGERATE,n.exchangerate),v.IsNumber(n.amplitude)&&this.LatestData.set(hi.AMPLITUDE,n.amplitude),k.Complier.Log("[JSSymbolData::RecvLatestData] symbol, LatestData",n.symbol,this.LatestData))}},this.RecvLatestDataVer2=function(t){if(v.IsNonEmptyArray(t.data)){for(var n=t.symbol,s=0;s<t.data.length;++s){var o=t.data[s];o&&v.IsNumber(o.id)&&(v.IsNumber(o.value)||v.IsString(o.value))&&(k.Complier.Log("[JSSymbolData::RecvLatestDataVer2] symbol="+n+" DYNAINFO("+o.id+")="+o.value+"."),this.LatestData.set(o.id,o.value))}k.Complier.Log("[JSSymbolData::RecvLatestDataVer2]",this.LatestData)}},this.GetLatestCacheData=function(t){return this.LatestData.has(t)?this.LatestData.get(t):null},this.GetLatestIndexData=function(){if(this.LatestIndexData)return this.Execute.RunNextJob();var t=this;if(this.NetworkFilter){var n={Name:"JSSymbolData::GetLatestIndexData",Explain:"最新大盘数据",Request:{Url:t.RealtimeApiUrl,Type:"POST",Data:{symbol:["000001.sh"],field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","amplitude"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(n,function(s){t.RecvLatestIndexData(s),t.Execute.RunNextJob()}),n.PreventDefault==!0)return}Vt.HttpRequest({url:t.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","amplitude"],symbol:["000001.sh"]},type:"post",dataType:"json",async:!0,success:function(o){t.RecvLatestIndexData(o),t.Execute.RunNextJob()},error:function(o){t.RecvError(o)}})},this.RecvLatestIndexData=function(t){if(!(!t.stock||t.stock.length!=1)){var n=t.stock[0];this.LatestIndexData={Symbol:n.symbol,Name:n.name,Date:n.date,Time:n.time,YClose:n.yclose,Price:n.price,Open:n.open,High:n.high,Low:n.low,Vol:n.vol,Amount:n.amount,Increase:n.increase,Amplitude:n.amplitude},k.Complier.Log("[JSSymbolData::RecvLatestIndexData]",this.LatestIndexData)}},this.GetVolRateData=function(t,n){var s=t.ID.toString()+"-VolRate-"+this.Symbol;if(this.ExtendData.has(s))return this.Execute.RunNextJob();var o=this,l=30;if(this.NetworkFilter){var h=this.Data.GetDateRange(),l=1;this.DataType==wt.MULTIDAY_MINUTE_ID&&(l=this.DayCount);var u={Name:"JSSymbolData::GetVolRateData",Explain:"分时量比数据(成交量)",Request:{Url:o.KLineApiUrl,Type:"POST",Data:{symbol:o.Symbol,dayCount:l,field:["name","symbol","vol"],period:0,right:0,dateRange:h}},Self:this,PreventDefault:!1};if(this.NetworkFilter(u,function(C){o.RecvVolRateData(C,s),o.Execute.RunNextJob()}),u.PreventDefault==!0)return}Vt.HttpRequest({url:o.KLineApiUrl,data:{field:["name","symbol","vol"],symbol:o.Symbol,start:-1,count:l},type:"post",dataType:"json",async:!0,success:function(C){o.RecvVolRateData(C,s),o.Execute.RunNextJob()},error:function(C){o.RecvError(C)}})},this.RecvVolRateData=function(t,n){var s=0,o=0,l=new Dt.default;if(t.Ver==2){if(!v.IsNonEmptyArray(t.data))return;for(var h=0;h<t.data.length;++h){var u=t.data[h];v.IsNonEmptyArray(u)&&(u.length<2||v.IsNumber(u[0])&&v.IsPlusNumber(u[1])&&l.set(u[0],{AvgVol5:u[1]}))}}else{if(!v.IsNonEmptyArray(t.data))return;var f=241;v.IsNumber(t.minutecount)&&(f=t.minutecount);for(var h=0,C=0,D=0;h<t.data.length;++h){for(s=0,C=h,D=0;C>=0&&D<5;--C,++D){var u=t.data[C];v.IsNumber(u[6])&&(s+=u[6])}if(D>0){o=s/D/f;var u=t.data[h];l.set(u[0],{AvgVol5:o})}}}l.size>0&&this.ExtendData.set(n,l),k.Complier.Log("[JSSymbolData::RecvVolRateData]",l)},this.GetVolRateCacheData=function(t){var n=z.JOB_DOWNLOAD_VOLR_DATA.toString()+"-VolRate-"+this.Symbol;(!n||!this.ExtendData.has(n))&&this.Execute.ThrowUnexpectedNode(t,"不支持VOLR");for(var s=[],o=this.ExtendData.get(n),l=0,h=0,u=null,f=0,C=0;f<this.Data.Data.length;++f){s[f]=null;var D=this.Data.Data[f];if(h!=D.Date){if(u=null,C=0,l=0,o.has(D.Date)){var c=o.get(D.Date);u=c.AvgVol5}h=D.Date}u!=null&&(l+=D.Vol,s[f]=l/(C+1)/u*100,++C)}return s},this.GetIndexData=function(){if(this.IndexData)return this.Execute.RunNextJob();var t=this;if(Y.IsDayPeriod(this.Period,!0)){if(this.NetworkFilter){var n=this.Data.GetDateRange(),s={Name:"JSSymbolData::GetIndexData",Explain:"大盘数据",Period:t.Period,Request:{Url:t.KLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol","up","down","stop","unchanged"],indexSymbol:"000001.sh",symbol:this.Symbol,period:this.Period,dateRange:n}},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(o){t.RecvIndexHistroyData(o),t.Execute.RunNextJob()}),s.PreventDefault==!0)return}Vt.HttpRequest({url:t.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","up","down","stop","unchanged"],symbol:"000001.sh",start:-1,count:t.MaxRequestDataCount+500},type:"post",dataType:"json",async:!0,success:function(l){t.RecvIndexHistroyData(l),t.Execute.RunNextJob()},error:function(l){t.RecvError(l)}})}else if(Y.IsMinutePeriod(this.Period,!0)){if(this.NetworkFilter){var n=this.Data.GetDateRange(),s={Name:"JSSymbolData::GetIndexData",Explain:"大盘数据",Period:t.Period,Request:{Url:t.MinuteKLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],indexSymbol:"000001.sh",symbol:this.Symbol,period:this.Period,dateRange:n}},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(h){t.RecvIndexMinuteHistroyData(h),t.Execute.RunNextJob()}),s.PreventDefault==!0)return}Vt.HttpRequest({url:t.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:"000001.sh",start:-1,count:t.MaxRequestMinuteDayCount+5},type:"post",dataType:"json",async:!0,success:function(l){t.RecvIndexMinuteHistroyData(l),t.Execute.RunNextJob()},error:function(l){t.RecvError(l)}})}},this.RecvIndexHistroyData=function(t){k.Complier.Log("[JSSymbolData::RecvIndexHistroyData] recv data",t);var n=this.JsonDataToHistoryData(t);if(this.IndexData=new Y,this.IndexData.DataType=0,this.IndexData.Data=n,this.IsApiPeriod==!0)this.IndexData.Period=this.Period,this.IndexData.Data=this.Data.FixKData(n,this.Period);else{var s=this.SourceData.GetOverlayData(this.IndexData.Data);if(this.IndexData.Data=s,Y.IsDayPeriod(this.Period,!1)){var o=this.IndexData.GetPeriodData(this.Period);this.IndexData.Data=o}}},this.RecvIndexMinuteHistroyData=function(t){k.Complier.Log("[JSSymbolData::RecvIndexMinuteHistroyData] recv data",t);var n=this.JsonDataToMinuteHistoryData(t);if(this.IndexData=new Y,this.IndexData.DataType=1,this.IndexData.Data=n,this.IsApiPeriod==!0)this.IndexData.Period=this.Period,this.IndexData.Data=this.Data.FixKData(n,this.Period);else if(Y.IsMinutePeriod(this.Period,!1)){var s=this.IndexData.GetPeriodData(this.Period);this.IndexData.Data=s}},this.GetOtherSymbolParam=function(t){var n=t.split("$"),s=new Fe.default(["CLOSE","C","VOL","V","OPEN","O","HIGH","H","LOW","L","AMOUNT","AMO","VOLINSTK"]);if(!s.has(n[1]))return null;var o=n[0];if(o.length==6)o[0]=="6"||o[0]=="5"||o[0]=="8"||o[0]=="9"?o+=".SH":(o[0]=="0"||o[0]=="1"||o[0]=="2"||o[0]=="3")&&(o+=".SZ");else if(o.indexOf("SZ")==0)o=o.substr(2)+".SZ";else if(o.indexOf("SH")==0)o=o.substr(2)+".SH";else if(o.indexOf("_")>0){var l=o.split("_");o=l[1]+"."+l[0]}else return null;return{Symbol:o.toLowerCase(),DataName:n[1]}},this.GetOtherSymbolData=function(t){var n=this.Symbol;if(t.Literal){var s=this.GetOtherSymbolParam(t.Literal.toUpperCase());if(!s){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,t.Literal+" Error.")}n=s.Symbol}else{var s=t.Args;if(s.length>0){var l=s[0];if(l.Type==ut.Literal)n=l.Value;else if(l.Type==ut.Identifier){var h=!1;for(var u in this.Arguments){var f=this.Arguments[u];if(f.Name==l.Name){n=f.Value,h=!0;break}}if(!h){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,t.FunctionName+"() Error: can't read "+l.Name)}}}}if(t.Symbol=n.toLowerCase(),t.Symbol==this.Symbol)return this.Execute.RunNextJob();if(this.OtherSymbolData.has(t.Symbol))return this.Execute.RunNextJob();var C=this;if(this.DataType==wt.KLINE_ID&&Y.IsDayPeriod(this.Period,!0)){if(this.NetworkFilter){var D=this.Data.GetDateRange(),c={Name:"JSSymbolData::GetOtherSymbolData",Explain:"指定个股数据",Request:{Data:{symbol:t.Symbol,right:C.Right,period:C.Period,dateRange:D}},Self:this,PreventDefault:!1};if(this.NetworkFilter(c,function(T){C.RecvOtherSymbolKData(T,t),C.Execute.RunNextJob()}),c.PreventDefault==!0)return}Vt.HttpRequest({url:C.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:C.MaxRequestDataCount+500},type:"post",dataType:"json",async:!0,success:function(S){C.RecvOtherSymbolKDayData(S,t),C.Execute.RunNextJob()},error:function(S){C.RecvError(S)}})}else if(Y.IsMinutePeriod(this.Period,!0)||this.DataType==wt.MINUTE_ID||this.DataType==wt.MULTIDAY_MINUTE_ID){if(this.NetworkFilter){var D=this.Data.GetDateRange(),c={Name:"JSSymbolData::GetOtherSymbolData",Explain:"指定个股数据",Request:{Data:{symbol:t.Symbol,right:C.Right,period:C.Period,dateRange:D}},Self:this,PreventDefault:!1};if(this.NetworkFilter(c,function(I){C.RecvOtherSymbolKData(I,t),C.Execute.RunNextJob()}),c.PreventDefault==!0)return}Vt.HttpRequest({url:C.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:C.MaxRequestMinuteDayCount+5},type:"post",dataType:"json",async:!0,success:function(S){C.RecvOtherSymbolKMinuteData(S,t),C.Execute.RunNextJob()},error:function(S){C.RecvError(S)}})}},this.RecvOtherSymbolKData=function(t,n){k.Complier.Log("[JSSymbolData::RecvOtherSymbolKData] recv data",t);var s=new Y,o=null,l=this.Period;this.DataType==wt.KLINE_ID&&Y.IsDayPeriod(this.Period,!0)?(o=this.JsonDataToHistoryData(t),s.DataType=0):(o=this.JsonDataToMinuteHistoryData(t),s.DataType=1,(this.DataType==wt.MINUTE_ID||this.DataType==wt.MULTIDAY_MINUTE_ID)&&(l=4)),s.Period=this.Period,s.Right=this.Right,s.Data=this.Data.FixKData(o,l),this.OtherSymbolData.set(n.Symbol,s)},this.RecvOtherSymbolKDayData=function(t,n){k.Complier.Log("[JSSymbolData::RecvOtherSymbolKDayData] recv data",t);var s=this.JsonDataToHistoryData(t),o=new Y;o.DataType=0,o.Data=s;var l=this.SourceData.GetOverlayData(o.Data);if(o.Data=l,Y.IsDayPeriod(this.Period,!1)){var h=o.GetPeriodData(this.Period);o.Data=h}this.OtherSymbolData.set(n.Symbol,o)},this.RecvOtherSymbolKMinuteData=function(t,n){k.Complier.Log("[JSSymbolData::RecvOtherSymbolKMinuteData] recv data",t);var s=this.JsonDataToMinuteHistoryData(t),o=new Y;if(o.DataType=1,o.Data=s,Y.IsMinutePeriod(this.Period,!1)){var l=o.GetPeriodData(this.Period);o.Data=l}this.OtherSymbolData.set(n.Symbol,o)},this.GetOtherSymolCacheData=function(t){var n,s;if(t.FunctionName){s=t.FunctionName;var o=t.Args;if(o.length<=0)return this.GetSymbolCacheData(s);n=o[0].toString().toLowerCase()}else if(t.Literal){var o=this.GetOtherSymbolParam(t.Literal.toUpperCase());if(!o)return[];n=o.Symbol,s=o.DataName}if(n==this.Symbol)return this.GetSymbolCacheData(s);if(!this.OtherSymbolData.has(n))return[];var l=this.OtherSymbolData.get(n),h=n.toUpperCase();switch(s){case"CLOSE":case"C":return l.GetClose();case"VOL":case"V":return l.GetVol(U.GetVolUnit(h));case"OPEN":case"O":return l.GetOpen();case"HIGH":case"H":return l.GetHigh();case"LOW":case"L":return l.GetLow();case"AMOUNT":case"AMO":return l.GetAmount();case"VOLINSTK":return l.GetPosition()}},this.GetIndexCacheData=function(t){if(!this.IndexData)return new Array;switch(t){case"INDEXA":return this.IndexData.GetAmount();case"INDEXC":return this.IndexData.GetClose();case"INDEXH":return this.IndexData.GetHigh();case"INDEXL":return this.IndexData.GetLow();case"INDEXO":return this.IndexData.GetOpen();case"INDEXV":return this.IndexData.GetVol();case"INDEXADV":return this.IndexData.GetUp();case"INDEXDEC":return this.IndexData.GetDown()}},this.GetBlockSymbol=function(t){var n=new Dt.default([["沪深A股","CNA.ci"],["创业板","GEM.ci"],["沪市A股","SHA.ci"],["中小板","SME.ci"],["深市A股","SZA.ci"]]);if(n.has(t))return n.get(t);if(!t)return null;var s=null,o=t.toUpperCase();if(o.indexOf(".SH")>0||o.indexOf(".SZ")>0){var l=new Fe.default(["000001.SH","000003.SH","000016.SH","000300.SH","000905.SH","399001.SZ"," 399005.SZ","399006.SZ"]);if(!l.has(o))return null;s=t.replace(".SH",".sh"),s=t.replace(".SZ",".sz")}else t.indexOf(".CI")>0&&(s=t.replace(".CI",".ci"));return s},this.GetIndexIncreaseData=function(t){var n=null;if(t.IsSelfSymbol)n=this.Symbol;else{if(!t.Args||t.Args.length<=0){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,t.FunctionName+" Error: 参数不能为空")}n=t.Args[0].Value}var o=this.GetBlockSymbol(n);if(!o){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,t.FunctionName+" Error: can't support "+n)}var l=t.ID.toString()+"-UpCount-"+o,h=t.ID.toString()+"-DownCount-"+o;if(this.ExtendData.has(l)&&this.ExtendData.has(h))return this.Execute.RunNextJob();var u=this;if(this.NetworkFilter){var f={Type:this.DataType};this.DataType===wt.KLINE_ID&&(f.Period=this.Period);var C=this.Data.GetDateRange(),D={Name:"JSSymbolData::GetIndexIncreaseData",Explain:"涨停家数统计",DateRange:C,DataType:f,Request:{Url:"数据地址",Type:"POST",Data:{symbol:this.Symbol,blocksymbol:o,field:["up","down"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(D,function(T){this.DataType===wt.KLINE_ID?this.RecvHistoryIncreaseDataV2(T,{UpKey:l,DownKey:h}):this.RecvMinuteIncreaseDataV2(T,{UpKey:l,DownKey:h}),u.Execute.RunNextJob()}),D.PreventDefault==!0)return}if(this.DataType===wt.MINUTE_ID||this.DataType===wt.MULTIDAY_MINUTE_ID){var c=Yt.CacheDomain+"/cache/analyze/increaseanalyze/"+o+".json";k.Complier.Log("[JSSymbolData::GetIndexIncreaseData] minute Get url=",c),Vt.HttpRequest({url:c,type:"get",dataType:"json",async:!0,success:function(S){u.RecvMinuteIncreaseData(S,{UpKey:l,DownKey:h}),u.Execute.RunNextJob()},error:function(S){u.RecvError(S)}})}else this.DataType===wt.KLINE_ID&&Y.IsDayPeriod(this.Period,!0)?(k.Complier.Log("[JSSymbolData::GetIndexIncreaseData] K day Get url=",u.KLineApiUrl),Vt.HttpRequest({url:u.KLineApiUrl,data:{symbol:o,start:-1,count:u.MaxRequestDataCount,field:["up","down"]},type:"post",dataType:"json",async:!0,success:function(S){u.RecvHistoryIncreaseData(S,{UpKey:l,DownKey:h}),u.Execute.RunNextJob()},error:function(S){u.RecvError(S)}})):this.Execute.RunNextJob()},this.RecvHistoryIncreaseDataV2=function(t,n){k.Complier.Log("[JSSymbolData::RecvHistoryIncreaseData] recv data, key",t,n);var s=[],o=[];for(var l in t.data){var h=t.data[l],u=new Wt,f=new Wt,C=h[0],D=null;u.Date=C,f.Date=C,Y.IsMinutePeriod(this.Period,!0)&&v.IsNumber(h[1])&&(D=h[1],u.Time=D,f.Time=D),u.Value=h[2],s[l]=u,f.Value=h[3],o[l]=f}var c=this.Data.GetFittingData2(s,0),T=this.Data.GetFittingData2(o,0);this.ExtendData.set(n.UpKey,c),this.ExtendData.set(n.DownKey,T)},this.RecvHistoryIncreaseData=function(t,n){k.Complier.Log("[JSSymbolData::RecvHistoryIncreaseData] recv data",t);var s=[],o=[];for(var l in t.data){var h=t.data[l],u=new Wt,f=new Wt;u.Date=h[0],u.Value=h[8],s[l]=u,f.Date=h[0],f.Value=h[9],o[l]=f}var C,D;this.SourceData?C=this.SourceData.GetFittingData(s):C=this.Data.GetFittingData(aryData),this.SourceData?D=this.SourceData.GetFittingData(o):D=this.Data.GetFittingData(aryData),this.ExtendData.set(n.UpKey,C),this.ExtendData.set(n.DownKey,D)},this.RecvMinuteIncreaseDataV2=function(t,n){k.Complier.Log("[JSSymbolData::RecvMinuteIncreaseDataV2] recv data, key",t,n)},this.RecvMinuteIncreaseData=function(t,n){if(k.Complier.Log("[JSSymbolData::RecvMinuteIncreaseData] recv data",t),!!t.minute){var s=t.minute;if(!(!s.time||!s.up||!s.down)){var o=[],l=[];if(this.IsBeforeData)for(var h=0,u=0;h<this.Data.Data.length;++h){o[h]=null,l[h]=null;var f=this.Data.Data[h];if(!f.Before){var C=f.DateTime;if(C){var D=C.split(" ");if(D.length==2){var c=parseInt(D[0]);c==t.date&&(o[h]=s.up[u],l[h]=s.down[u],++u)}}}}else for(var h=0,u=0;h<this.Data.Data.length;++h){o[h]=null,l[h]=null;var f=this.Data.Data[h],C=f.DateTime;if(C){var D=C.split(" ");if(D.length==2){var c=parseInt(D[0]);c==t.date&&(o[h]=s.up[u],l[h]=s.down[u],++u)}}}this.ExtendData.set(n.UpKey,o),this.ExtendData.set(n.DownKey,l)}}},this.GetIndexIncreaseCacheData=function(t,n,s){var o=this.GetBlockSymbol(n);o||this.Execute.ThrowUnexpectedNode(s,"不支持函数"+t+"("+n+")");var l;if(t=="UPCOUNT"||t=="ADVANCE"?l=z.JOB_DOWNLOAD_INDEX_INCREASE_DATA.toString()+"-UpCount-"+o:(t=="DOWNCOUNT"||t=="DECLINE")&&(l=z.JOB_DOWNLOAD_INDEX_INCREASE_DATA.toString()+"-DownCount-"+o),(!l||!this.ExtendData.has(l))&&this.Execute.ThrowUnexpectedNode(s,"不支持函数"+t+"("+n+")"),this.DataType===wt.MINUTE_ID||this.DataType===wt.MULTIDAY_MINUTE_ID)return this.ExtendData.get(l);if(this.DataType===wt.KLINE_ID&&Y.IsDayPeriod(this.Period,!0)){var h=this.ExtendData.get(l),u=new Y;if(u.Data=h,u.Period=this.Period,u.Period>0){var f=u.GetPeriodSingleData(u.Period);u.Data=f}return u.GetValue()}else return null},this.GetSymbolData=function(){if(this.Data)return this.Execute.RunNextJob();var t=this;if(this.DataType===wt.MINUTE_ID){Vt.HttpRequest({url:t.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","minute","time","minutecount"],symbol:[t.Symbol],start:-1},type:"post",dataType:"json",async:!0,success:function(o){t.RecvMinuteData(o),t.Execute.RunNextJob()}});return}if(this.DataType===wt.MULTIDAY_MINUTE_ID){Vt.HttpRequest({url:t.HistoryMinuteApiUrl,data:{symbol:t.Symbol,daycount:t.DayCount},type:"post",dataType:"json",async:!0,success:function(o){t.RecvMultiDayMinuteData(o),t.Execute.RunNextJob()}});return}if(Y.IsDayPeriod(this.Period,!0)){if(this.NetworkFilter){var n={Name:"JSSymbolData::GetSymbolData",Explain:"日线数据",Request:{Url:t.RealtimeApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestDataCount,period:this.Period,right:this.Right}},Self:this,PreventDefault:!1};if(this.KLineDateTimeRange&&(n.Request.KLineDataTimeRange={Start:{Date:this.KLineDateTimeRange.Start.Date},End:{Date:this.KLineDateTimeRange.End.Date}},this.IsNumber(this.KLineDateTimeRange.Start.Time)&&(n.Request.KLineDataTimeRange.Start.Time=this.KLineDateTimeRange.Start.Time),this.IsNumber(this.KLineDateTimeRange.End.Time)&&(n.Request.KLineDataTimeRange.End.Time=this.KLineDateTimeRange.End.Time)),this.NetworkFilter(n,function(s){t.RecvHistroyData(s),t.Execute.RunNextJob()}),n.PreventDefault==!0)return}Vt.HttpRequest({url:t.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(o){t.RecvHistroyData(o),t.Execute.RunNextJob()},error:function(o){t.RecvError(o)}})}else if(Y.IsMinutePeriod(this.Period,!0)||Y.IsSecondPeriod(this.Period)||Y.IsMilliSecondPeriod(this.Period)){if(this.NetworkFilter){var n={Name:"JSSymbolData::GetSymbolData",Explain:"分钟K线数据",Request:{Url:t.MinuteKLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestMinuteDayCount,period:this.Period,right:this.Right}},Self:this,PreventDefault:!1};if(this.KLineDateTimeRange&&(n.Request.KLineDataTimeRange={Start:{Date:this.KLineDateTimeRange.Start.Date},End:{Date:this.KLineDateTimeRange.End.Date}},this.IsNumber(this.KLineDateTimeRange.Start.Time)&&(n.Request.KLineDataTimeRange.Start.Time=this.KLineDateTimeRange.Start.Time),this.IsNumber(this.KLineDateTimeRange.End.Time)&&(n.Request.KLineDataTimeRange.End.Time=this.KLineDateTimeRange.End.Time)),this.NetworkFilter(n,function(o){t.RecvMinuteHistroyData(o),t.Execute.RunNextJob()}),n.PreventDefault==!0)return}Vt.HttpRequest({url:this.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(o){t.RecvMinuteHistroyData(o),t.Execute.RunNextJob()},error:function(o){t.RecvError(o)}})}},this.RecvHistroyData=function(t){k.Complier.Log("[JSSymbolData::RecvHistroyData] recv data",t);var n=this.JsonDataToHistoryData(t);if(this.Data=new Y,this.Data.DataType=0,this.Data.Data=n,this.SourceData=new Y,this.SourceData.Data=n,!this.IsApiPeriod){if(this.Right>0){var s=this.Data.GetRightData(this.Right);this.Data.Data=s}if(Y.IsDayPeriod(this.Period,!1)){var o=this.Data.GetPeriodData(this.Period);this.Data.Data=o}}this.Data.Right=this.Right,this.Data.Period=this.Period,this.Name=t.name},this.RecvMinuteHistroyData=function(t){k.Complier.Log("[JSSymbolData::RecvMinuteHistroyData] recv data",t);var n=this.JsonDataToMinuteHistoryData(t);if(this.Data=new Y,this.Data.DataType=1,this.Data.Data=n,this.SourceData=new Y,this.SourceData.Data=n,!this.IsApiPeriod){if(Y.IsMinutePeriod(this.Period,!1)){var s=this.Data.GetPeriodData(this.Period);this.Data.Data=s}}this.Data.Period=this.Period,this.Name=t.name},this.RecvMinuteData=function(t){k.Complier.Log("[JSSymbolData::RecvMinuteData] recv data",t);var n=this.JsonDataToMinuteData(t);this.Data=new Y,this.Data.DataType=2,this.Data.Data=n,this.Name=t.stock[0].name},this.RecvMultiDayMinuteData=function(t){var n=this.JsonDataToMultiDayMinuteData(t);this.Data=new Y,this.Data.DataType=2,this.Data.Data=n,this.Name=t.name},this.GetSymbolCacheData=function(t){if(!this.Data)return new Array;var n=this.Symbol.toUpperCase();switch(t){case"CLOSE":case"C":return this.Data.GetClose();case"VOL":case"V":return this.Data.GetVol(U.GetVolUnit(n));case"OPEN":case"O":return this.Data.GetOpen();case"HIGH":case"H":return this.Data.GetHigh();case"LOW":case"L":return this.Data.GetLow();case"AMOUNT":case"AMO":return this.Data.GetAmount();case"OPI":case"VOLINSTK":return this.Data.GetPosition();case"ZSTJJ":return this.Data.GetAvPrice();case"SETTLE":case"QHJSJ":return this.Data.GetSettlementPrice();case"ISEQUAL":return this.Data.GetIsEqual();case"ISUP":return this.Data.GetIsUp();case"ISDOWN":return this.Data.GetIsDown()}},this.GetSymbolPeriodData=function(t){var n=za.GetPeriodInfo({Name:t.PeriodName}).Period,s={PeriodID:n,PeriodName:t.PeriodName};if(n==this.Period&&this.Execute.RunNextJob(),this.IsApiPeriod){if(this.PeriodData.has(t.PeriodName))return this.Execute.RunNextJob()}else if(Y.IsDayPeriod(n,!0)){if(Y.IsDayPeriod(this.Period,!0))return this.Execute.RunNextJob();s={PeriodID:0,PeriodName:"DAY"}}else if(Y.IsMinutePeriod(n,!0)){if(Y.IsMinutePeriod(this.Period,!0))return this.Execute.RunNextJob();s={PeriodID:4,PeriodName:"MIN1"}}else return this.Execute.RunNextJob();var o=this;if(this.NetworkFilter){var l={Name:"JSSymbolData::GetSymbolPeriodData",Explain:"跨周期数据",Request:{Data:{field:["symbol","name",t.ValueName],period:t.PeriodName,symbol:o.Symbol}},Self:this,PreventDefault:!1};if(this.NetworkFilter(l,function(h){o.RecvSymbolPeriodData(h,s),o.Execute.RunNextJob()}),l.PreventDefault==!0)return}if(Y.IsMinutePeriod(n,!0))Vt.HttpRequest({url:this.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:o.Symbol,start:-1,count:o.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(u){o.RecvSymbolPeriodData(u,s),o.Execute.RunNextJob()},error:function(u){o.RecvError(u)}});else if(Y.IsDayPeriod(n,!0))Vt.HttpRequest({url:o.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:o.Symbol,start:-1,count:o.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(u){o.RecvSymbolPeriodData(u,s),o.Execute.RunNextJob()},error:function(u){o.RecvError(u)}});else return this.Execute.RunNextJob()},this.RecvSymbolPeriodData=function(t,n){if(k.Complier.Log("[JSSymbolData::RecvSymbolPeriodData] data, periodInfo ",t,n),Y.IsDayPeriod(n.PeriodID,!0)){var s=this.JsonDataToHistoryData(t),o=new Y;o.DataType=0,o.Data=s,o.Right=0,o.Period=n.PeriodID,this.PeriodData.set(n.PeriodName,o)}else if(Y.IsMinutePeriod(n.PeriodID,!0)){var s=this.JsonDataToMinuteHistoryData(t),l=new Y;l.DataType=1,l.Data=s,l.Right=0,l.Period=n.PeriodID,this.PeriodData.set(n.PeriodName,l)}},this.GetSymbolPeriodCacheData=function(t,n){var s=za.GetPeriodInfo({Name:n});if(this.Period==s.Period)return this.GetSymbolCacheData(t);var o=null;if(this.IsApiPeriod){var l=za.GetPeriodInfo({PeriodID:this.Period});if(!l||l.Order>s.Order||!this.PeriodData.has(n))return null;o=this.PeriodData.get(n),o=o.Data}else{var l=za.GetPeriodInfo({PeriodID:this.Period});if(!l||l.Order>s.Order)return null;if(Y.IsDayPeriod(s.Period,!0)&&Y.IsMinutePeriod(this.Period,!0)){var h=this.PeriodData.get("DAY");s.Period==0?o=h.Data:o=h.GetPeriodData(s.Period)}else{var u=new Y;if(u.Data=this.SourceData.Data,u.Period=this.Period,u.Right=this.Right,Y.IsDayPeriod(s.Period,!0)&&u.Right>0){var f=u.GetRightData(u.Right);u.Data=f}o=u.GetPeriodData(s.Period)}}var C=this.Data.ConverPeriod(o,this.Period,s.Period),D=new Y;D.Data=C;var c=this.Symbol.toUpperCase();switch(t){case"C":case"CLOSE":return D.GetClose();case"O":case"OPEN":return D.GetOpen();case"H":case"HIGH":return D.GetHigh();case"L":case"LOW":return D.GetLow();case"AMO":case"AMOUNT":return D.GetAmount();case"V":case"VOL":return D.GetVol(U.GetVolUnit(c));case"VOLINSTK":return D.GetPosition();default:return null}},this.GetSymbolPeriodCacheData2=function(t,n,s){var o=za.GetPeriodInfo({Name:n});if(!o)return null;var l=za.GetPeriodInfo({PeriodID:this.Period});if(!l||l.Order>o.Order)return null;var h;if(l.Period==o.Period)h=this.Data;else{var u;if(this.IsApiPeriod){if(!this.PeriodData.has(n))return null;u=this.PeriodData.get(n)}else if(Y.IsMinutePeriod(l.Period,!0)&&Y.IsDayPeriod(o.Period,!0)){var f=this.PeriodData.get("DAY");o.Period==0?u=f:u=f.GetPeriodData(o.Period)}else{var C=new Y;if(C.Data=this.SourceData.Data,C.Period=this.Period,C.Right=this.Right,Y.IsDayPeriod(o.Period,!0)&&C.Right>0){var D=C.GetRightData(C.Right);C.Data=D}u=C.GetPeriodData(o.Period)}var c=this.Data.ConverPeriod(u,this.Period,o.Period),h=new Y;h.Data=c}if(v.IsPlusNumber(s)){var T=new Y,c=h.GetRef(s);T.Data=c,h=T}var S=this.Symbol.toUpperCase();switch(t){case"C":case"CLOSE":return h.GetClose();case"O":case"OPEN":return h.GetOpen();case"H":case"HIGH":return h.GetHigh();case"L":case"LOW":return h.GetLow();case"AMO":case"AMOUNT":return h.GetAmount();case"V":case"VOL":return U.IsSHSZ(S)?h.GetVol(100):h.GetVol();case"VOLINSTK":return h.GetPosition();default:return null}},this.GetCurrBarsCount=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n=this.Data.Data.length,s=n-1;s>=0;--s)t.push(s+1);return t},this.GetBarPos=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n=this.Data.Data.length,s=0;s<n;++s)t.push(s+1);return t},this.GetTotalTradeMinuteCount=function(){var t=vl.GetCoordinateData(this.Symbol);return t&&t.Count>0?t.Count-1:242},this.GetTotalBarsCount=function(){var t=this.Data.Data.length;return t},this.GetIsLastBar=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n=this.Data.Data.length,s=0;s<n;++s)s==n-1?t.push(1):t.push(0);return t},this.GetBarStatus=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n=this.Data.Data.length,s=0;s<n;++s)s==0?t[s]=1:s==n-1?t[s]=2:t[s]=0;return t},this.GetTRData=function(t){var n=[];if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return n;for(var s=this.Data.Data.length,o=0;o<s;++o){var l=this.Data.Data[o],h=null;if(v.IsNumber(l.High)&&v.IsNumber(l.Low)){var u=Math.abs(l.High-l.Low);(h==null||h<u)&&(h=u)}if(v.IsNumber(l.High)&&v.IsNumber(l.YClose)){var u=Math.abs(l.High-l.YClose);(h==null||h<u)&&(h=u)}if(v.IsNumber(l.YClose)&&v.IsNumber(l.Low)){var u=Math.abs(l.Low-l.YClose);(h==null||h<u)&&(h=u)}n[o]=h}return n},this.GetMarginCacheData=function(t,n){var s=z.GetMarginJobID(t);return s||this.Execute.ThrowUnexpectedNode(n,"不支持MARGIN("+t+")"),this.MarginData.has(s)?this.MarginData.get(s):[]},this.GetMarginData=function(t){if(this.MarginData.has(t))return this.Execute.RunNextJob();k.Complier.Log("[JSSymbolData::GetMarginData] jobID=",t);var n=this,s=["name","date","symbol"];switch(t){case z.JOB_DOWNLOAD_MARGIN_BALANCE:s.push("margin.balance");break;case z.JOB_DOWNLOAD_MARGIN_RATE:s.push("margin.rate");break;case z.JOB_DOWNLOAD_MARGIN_BUY_BALANCE:case z.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:case z.JOB_DOWNLOAD_MARGIN_BUY_REPAY:case z.JOB_DOWNLOAD_MARGIN_BUY_NET:s.push("margin.buy");break;case z.JOB_DOWNLOAD_MARGIN_SELL_BALANCE:case z.JOB_DOWNLOAD_MARGIN_SELL_VOLUME:case z.JOB_DOWNLOAD_MARGIN_SELL_REPAY:case z.JOB_DOWNLOAD_MARGIN_SELL_NET:s.push("margin.sell");break}Vt.HttpRequest({url:this.StockHistoryDayApiUrl,data:{field:s,symbol:[this.Symbol],orderfield:"date"},type:"post",dataType:"json",async:!0,success:function(l){n.RecvMarginData(l,t),n.Execute.RunNextJob()}})},this.RecvMarginData=function(t,n){if(k.Complier.Log(t),!(!t.stock||t.stock.length!=1)){var s=t.stock[0],o=new Array,l=[],h=[],u=[];for(var f in s.stockday){var C=s.stockday[f],D=C.margin;if(D){var c=new Wt;switch(c.Date=C.date,n){case z.JOB_DOWNLOAD_MARGIN_BALANCE:if(!this.IsNumber(D.balance))continue;c.Value=D.balance,o.push(c);break;case z.JOB_DOWNLOAD_MARGIN_RATE:if(!this.IsNumber(D.rate))continue;c.Value=D.rate,o.push(c);break;case z.JOB_DOWNLOAD_MARGIN_BUY_BALANCE:case z.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:case z.JOB_DOWNLOAD_MARGIN_BUY_REPAY:case z.JOB_DOWNLOAD_MARGIN_BUY_NET:var T=D.buy;if(!T||!this.IsNumber(T.balance)||!this.IsNumber(T.amount)||!this.IsNumber(T.repay)||!this.IsNumber(T.net))continue;c.Value=T.balance;var I=new Wt;I.Date=C.date,I.Value=T.amount;var g=new Wt;g.Date=C.date,g.Value=T.repay;var E=new Wt;E.Date=C.date,E.Value=T.net,o.push(c),l.push(I),h.push(g),u.push(E);break;case z.JOB_DOWNLOAD_MARGIN_SELL_BALANCE:case z.JOB_DOWNLOAD_MARGIN_SELL_VOLUME:case z.JOB_DOWNLOAD_MARGIN_SELL_REPAY:case z.JOB_DOWNLOAD_MARGIN_SELL_NET:var S=D.sell;if(!S||!this.IsNumber(S.balance)||!this.IsNumber(S.volume)||!this.IsNumber(S.repay)||!this.IsNumber(S.net))continue;c.Value=T.balance;var I=new Wt;I.Date=C.date,I.Value=T.volume;var g=new Wt;g.Date=C.date,g.Value=T.repay;var E=new Wt;E.Date=C.date,E.Value=T.net,o.push(c),l.push(I),h.push(g),u.push(E);break;default:continue}}}var F=[];n===z.JOB_DOWNLOAD_MARGIN_BALANCE||n===z.JOB_DOWNLOAD_MARGIN_RATE?F.push({JobID:n,Data:o}):n===z.JOB_DOWNLOAD_MARGIN_BUY_BALANCE||n===z.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT||n===z.JOB_DOWNLOAD_MARGIN_BUY_REPAY||n===z.JOB_DOWNLOAD_MARGIN_BUY_NET?(F.push({JobID:z.JOB_DOWNLOAD_MARGIN_BUY_BALANCE,Data:o}),F.push({JobID:z.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT,Data:l}),F.push({JobID:z.JOB_DOWNLOAD_MARGIN_BUY_REPAY,Data:h}),F.push({JobID:z.JOB_DOWNLOAD_MARGIN_BUY_NET,Data:u})):(n===z.JOB_DOWNLOAD_MARGIN_SELL_BALANCE||n===z.JOB_DOWNLOAD_MARGIN_SELL_VOLUME||n===z.JOB_DOWNLOAD_MARGIN_SELL_REPAY||n===z.JOB_DOWNLOAD_MARGIN_SELL_NET)&&(F.push({JobID:z.JOB_DOWNLOAD_MARGIN_SELL_BALANCE,Data:o}),F.push({JobID:z.JOB_DOWNLOAD_MARGIN_SELL_VOLUME,Data:l}),F.push({JobID:z.JOB_DOWNLOAD_MARGIN_SELL_REPAY,Data:h}),F.push({JobID:z.JOB_DOWNLOAD_MARGIN_SELL_NET,Data:u}));for(var R in F){var A=this.SourceData.GetFittingData(F[R].Data),P=new Y;if(P.Data=A,P.Period=this.Period,P.Period>0){var p=P.GetPeriodSingleData(P.Period);P.Data=p}var w=P.GetValue();this.MarginData.set(F[R].JobID,w)}}},this.GetNewsAnalysisCacheData=function(t,n){var s=z.GetNewsAnalysisID(t);return s||this.Execute.ThrowUnexpectedNode(n,"不支持NEWS("+t+")"),this.NewsAnalysisData.has(s)?this.NewsAnalysisData.get(s):[]},this.GetHKToSHSZData=function(t){var n=t.Args,s=this.Symbol;if(n.length>0){var o=n[0];if(o.Type==ut.Literal)s=o.Value;else if(o.Type==ut.Identifier){var l=!1;for(var h in this.Arguments){var u=this.Arguments[h];if(u.Name==o.Name){s=u.Value,l=!0;break}}if(!l){var f=t.Token;this.Execute.ErrorHandler.ThrowError(f.Index,f.Line,0,"HK2SHSZ() Error: can't read "+o.Name)}}}t.Symbol=s,s==1||s==2||s==3?this.GetHKToSHSZMarketData(s,t):this.GetHKToSHSZStockData(s,t)},this.GetHKToSHSZStockData=function(t,n){if(this.HKToSHSZData.has(t))return this.Execute.RunNextJob();var s=t.toLowerCase(),o=this,l=this.HKToSHSZApiUrl[3]+"/"+s+".json";Vt.HttpRequest({url:l,type:"get",dataType:"json",async:!0,success:function(u){o.RecvHKToSHSZStockData(u,n),o.Execute.RunNextJob()},error:function(u){console.warn("[JSSymbolData::GetHKToSHSZStockData] request url="+l+" failed. error="+u.status),o.RecvHKToSHSZStockData(null,n),o.Execute.RunNextJob()}})},this.RecvHKToSHSZStockData=function(c,n){if(c){for(var s=c.symbol,o=s.toUpperCase(),l=[],h=0;h<c.date.length;++h){var u=new Wt;u.Date=c.date[h],u.Value=c.vol[h],l.push(u)}var f=this.Data.GetFittingData(l),C=new Y;if(C.Data=f,C.Period=this.Period,C.Period>0){var D=C.GetPeriodSingleData(C.Period);C.Data=D}var c=C.GetValue();this.HKToSHSZData.set(o,c)}},this.GetHKToSHSZMarketData=function(t,n){if(this.HKToSHSZData.has(t))return this.Execute.RunNextJob();var s,o=0;this.DataType===wt.MINUTE_ID?o=1:this.DataType==wt.MULTIDAY_MINUTE_ID?o=2:this.Period<=3&&(o=0),s=this.HKToSHSZApiUrl[o];var l=this;k.Complier.Log("[JSSymbolData::GetHKToSHSZMarketData] code="+t+" url="+s+", dataType="+o),o===2?Vt.HttpRequest({url:s,data:{symbol:this.Symbol,daycount:this.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(u){l.RecvMulitMinuteHKToSHSZData(u,n),l.Execute.RunNextJob()}}):Vt.HttpRequest({url:s,type:"get",dataType:"json",async:!0,success:function(u){o==0?l.RecvHKToSHSZData(u,n):o==1&&l.RecvMinuteHKToSHSZData(u,n),l.Execute.RunNextJob()}})},this.RecvMinuteHKToSHSZData=function(t,n){var s=[],o=[],l=[];if(this.IsBeforeData){for(u in this.SourceData.Data){var h=this.SourceData.Data[u];if(h.Before)s.push(null),o.push(null),l.push(null);else break}for(var u=0;u<t.time.length;++u){var f=t.time[u];if(f!==925){var C=t.hk2sh[u],D=t.hk2sz[u],c=C+D;s.push(c),o.push(C),l.push(D)}}}else for(var u=0;u<t.time.length;++u){var f=t.time[u],C=t.hk2sh[u],D=t.hk2sz[u],c=C+D;s.push(c),o.push(C),l.push(D)}var T=[{Data:s,ID:1},{Data:o,ID:2},{Data:l,ID:3}];for(var u in T){var h=T[u];this.HKToSHSZData.set(h.ID,h.Data)}},this.RecvHKToSHSZData=function(t,n){for(var s=[],o=[],l=[],h=0;h<t.date.length;++h){var u=t.date[h],f=t.hk2sh[h]*1e6,C=t.hk2sz[h]*1e6,D=f+C,c=new Wt;c.Date=u,c.Value=D;var T=new Wt;T.Date=u,T.Value=f;var S=new Wt;S.Date=u,S.Value=C,s.push(c),o.push(T),l.push(S)}var I=[{Data:s,ID:1},{Data:o,ID:2},{Data:l,ID:3}];for(var g in I){var E=this.Data.GetFittingData(I[g].Data),F=new Y;if(F.Data=E,F.Period=this.Period,F.Period>0){var R=F.GetPeriodSingleData(F.Period);F.Data=R}var A=F.GetValue();this.HKToSHSZData.set(I[g].ID,A)}},this.RecvMulitMinuteHKToSHSZData=function(t,n){if(!(!t.data||t.data.length<=0)){for(var s=[],o=[],l=[],h=0,u=0;h<this.Data.Data.length&&u<t.data.length;){s[h]=null,o[h]=null,l[h]=null;var f=this.Data.Data[h],C=f.DateTime;if(!C){++h;continue}var D=C.split(" ");if(D.length!=2){++h;continue}var c=parseInt(D[0]),T=t.data[u];if(!T.minute||T.minute.length<=0){++u;continue}if(T.date>c){++h;continue}else if(T.date<c){++u;continue}for(var S in T.minute){var I=T.minute[S],g=I[1],E=I[2],F=g+E;s[h]=F,o[h]=g,l[h]=E,++h}++u}var R=[{Data:s,ID:1},{Data:o,ID:2},{Data:l,ID:3}];for(var h in R){var f=R[h];this.HKToSHSZData.set(f.ID,f.Data)}}},this.GetHKToSHSZCacheData=function(t,n){return t||(t=this.Symbol),typeof t=="string"&&(t=t.toUpperCase()),this.HKToSHSZData.has(t)?this.HKToSHSZData.get(t):[]},this.GetNewsAnalysisData=function(t){if(this.NewsAnalysisData.has(t))return this.Execute.RunNextJob();var n=this,s=new Dt.default([[z.JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE,"negative"],[z.JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH,"research"],[z.JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT,"interact"],[z.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE,"holderchange"],[z.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2,"holderchange"],[z.JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER,"trustholder"],[z.JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING,"Blocktrading"],[z.JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS,"companynews"],[z.JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS,"topmanagers"],[z.JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE,"Pledge"]]);if(!s.has(t)){this.Execute.RunNextJob();return}var o=s.get(t),l=this.StockNewsAnalysisApiUrl+"/"+o+"/"+this.Symbol+".json";Vt.HttpRequest({url:l,type:"get",dataType:"json",async:!0,success:function(u){n.RecvNewsAnalysisData(u,t),n.Execute.RunNextJob()},error:function(u,f){n.RecvNewsAnalysisDataError(u,f,t),n.Execute.RunNextJob()}})},this.RecvNewsAnalysisDataError=function(t,n,s){k.Complier.Log("[JSSymbolData::RecvNewsAnalysisDataError] ajax error.",t.status);for(var o=[],l=0;l<this.Data.Data.length;++l){var h=new Wt;h.Date=this.Data.Data[l].Date,h.Value=0,o.push(h)}var u=new Y;u.Data=o,this.NewsAnalysisData.set(s,u.GetValue())},this.RecvNewsAnalysisData=function(t,n){if(!(!t.data||!t.date)&&!(t.data.length<=0||t.data.length!=t.date.length))if(k.Complier.Log("[JSSymbolData::RecvNewsAnalysisData] jobID",n,t.update),n==z.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE||n==z.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2){for(var s=[],o=[],l=0;l<t.data.length;++l){var h=new Wt;h.Date=t.date[l],h.Value=t.data[l],this.IsNumber(h.Value)&&s.push(h),l<t.data2.length&&(h=new Wt,h.Date=t.date[l],h.Value=t.data2[l],this.IsNumber(h.Value)&&o.push(h))}var u=this.Data.GetFittingData2(s,0),f=new Y;f.Data=u,this.NewsAnalysisData.set(z.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE,f.GetValue()),u=this.Data.GetFittingData2(o,0),f=new Y,f.Data=u,this.NewsAnalysisData.set(z.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2,f.GetValue())}else{for(var s=[],l=0;l<t.data.length;++l){var h=new Wt;h.Date=t.date[l],h.Value=t.data[l],s.push(h)}var C=this.Data.GetFittingData2(s,0),f=new Y;f.Data=C,this.NewsAnalysisData.set(n,f.GetValue())}},this.GetSectionFinanceData=function(t){var n=t.SF[0],s=t.SF[1].Period;if(this.SectionFinanceData.has(n))return this.Execute.RunNextJob();k.Complier.Log("[JSSymbolData::GetSectionFinanceData] "+s.Year+"-"+s.Quarter);var o="announcement"+s.Quarter,l=this,h=["name","date","symbol",o,"finance"+s.Quarter],u=[o+".year","int32","eq",s.Year.toString()];Vt.HttpRequest({url:this.StockHistoryDayApiUrl,data:{field:h,symbol:[this.Symbol],condition:[{item:u}]},type:"post",dataType:"json",async:!0,success:function(C){l.RecvSectionFinanceData(C,t),l.Execute.RunNextJob()}})},this.RecvSectionFinanceData=function(u,n){if(!(!u.stock||u.stock.length!=1)){var s=u.stock[0];if(!(!s.stockday||s.stockday.length<=0)){var o=s.stockday[0],l=n.SF[1].Period,h=null;if(l.Quarter===1?h=o.finance1:l.Quarter===2?h=o.finance2:l.Quarter===3?h=o.finance3:l.Quarter===4&&(h=o.finance4),!!h){var u=new Dt.default([[z.JOB_DOWNLOAD_SECTION_F_01,h.currentassets],[z.JOB_DOWNLOAD_SECTION_F_02,h.monetaryfunds],[z.JOB_DOWNLOAD_SECTION_F_03,h.inventory],[z.JOB_DOWNLOAD_SECTION_F_04,h.currentliabilities],[z.JOB_DOWNLOAD_SECTION_F_05,h.ncurrentliabilities],[z.JOB_DOWNLOAD_SECTION_F_06,h.expenses3],[z.JOB_DOWNLOAD_SECTION_F_07,h.investmentincome],[z.JOB_DOWNLOAD_SECTION_F_08,h.pcnprofit],[z.JOB_DOWNLOAD_SECTION_F_09,h.nnetprofit],[z.JOB_DOWNLOAD_SECTION_F_10,h.npersearning],[z.JOB_DOWNLOAD_SECTION_F_11,h.woewa],[z.JOB_DOWNLOAD_SECTION_F_12,h.inprocess],[z.JOB_DOWNLOAD_SECTION_F_13,h.accdepreciation],[z.JOB_DOWNLOAD_SECTION_F_14,h.mholderprofit],[z.JOB_DOWNLOAD_SECTION_F_15,h.lossexchange],[z.JOB_DOWNLOAD_SECTION_F_16,h.baddebts],[z.JOB_DOWNLOAD_SECTION_F_17,h.fixedassets],[z.JOB_DOWNLOAD_SECTION_F_18,h.curdepreciation],[z.JOB_DOWNLOAD_SECTION_F_19,h.orevenues],[z.JOB_DOWNLOAD_SECTION_F_20,h.moprofit],[z.JOB_DOWNLOAD_SECTION_F_21,h.oprofit],[z.JOB_DOWNLOAD_SECTION_F_22,h.nprofit],[z.JOB_DOWNLOAD_SECTION_F_23,h.areceivable],[z.JOB_DOWNLOAD_SECTION_F_24,h.financialcost],[z.JOB_DOWNLOAD_SECTION_F_25,h.ccfo],[z.JOB_DOWNLOAD_SECTION_F_26,h.totalassets],[z.JOB_DOWNLOAD_SECTION_F_27,h.totalliabilities],[z.JOB_DOWNLOAD_SECTION_F_28,h.totalownersequity],[z.JOB_DOWNLOAD_SECTION_F_29,h.grossmargin],[z.JOB_DOWNLOAD_SECTION_F_30,h.percreserve],[z.JOB_DOWNLOAD_SECTION_F_31,h.peruprofit],[z.JOB_DOWNLOAD_SECTION_F_32,h.persearning],[z.JOB_DOWNLOAD_SECTION_F_33,h.pernetasset],[z.JOB_DOWNLOAD_SECTION_F_34,h.perccfo],[z.JOB_DOWNLOAD_SECTION_F_38,h.alratio],[z.JOB_DOWNLOAD_SECTION_F_39,h.profityoy]]);l.Quarter===4&&(u.set(z.JOB_DOWNLOAD_SECTION_F_35,h.nnprofitincrease),u.set(z.JOB_DOWNLOAD_SECTION_F_36,h.nnprofitspeed),u.set(z.JOB_DOWNLOAD_SECTION_F_37,h.nprofitincrease));var f=n.SF[0];this.SectionFinanceData.set(f,u)}}}},this.GetSectionFinanceCacheData=function(t,n,s,o){var l=z.GetSectionReportPeriod(t,n);l||this.Execute.ThrowUnexpectedNode(o,"不支持FS("+t+", "+n+", '"+s+"') 报告期错误");var h=z.GetSectionFinanceID(s);h||this.Execute.ThrowUnexpectedNode(o,"不支持FS("+t+", "+n+",'"+s+"') 财务数据字段名称错误");var u=l.Year+"-"+l.Quarter;if(!this.SectionFinanceData.has(u)&&!this.ThrowSFPeirod.has(u)){this.ThrowSFPeirod.add(u);var f={ID:z.JOB_DOWNLOAD_SECTION_SF,SF:[u,{Period:l,Fields:new Fe.default([h])}]};this.Execute.ThrowDownloadSF(o,f,"FS("+t+", "+n+", '"+s+"') 动态下载")}if(!this.SectionFinanceData.has(u))return this.Execute.ThrowUnexpectedNode(o,"不支持FS("+t+", "+n+", '"+s+"') 没有这期财务数据");var C=this.SectionFinanceData.get(u);return C.has(h)||this.Execute.ThrowUnexpectedNode(o,"不支持FS("+t+", "+n+", '"+s+"') 没有这期财务数据字段"),C.get(h)},this.GetStockDataKey=function(t,n){var s=t.FunctionName;if(n.length>0){s+="(";for(var o=0;o<n.length;++o)o>0&&(s+=","),s+=n[o].toString();s+=")"}return s},this.GetFinance=function(t){var n=this.JobArgumentsToArray(t,1),s=n[0],o=this.GetStockDataKey(t,n);if(this.StockData.has(o))return this.Execute.RunNextJob();var l=this;if(this.NetworkFilter){var h=this.Data.GetDateRange(),u={Name:"JSSymbolData::GetFinance",Explain:"财务数据FINANCE(ID)",JobID:t.ID,Request:{Url:l.RealtimeApiUrl,Type:"POST",Data:{id:s,symbol:this.Symbol,daterange:h}},Self:this,PreventDefault:!1};if(this.NetworkFilter(u,function(C){C.Error?l.AddStockValueError(o,C.Error):l.RecvStockValue(C,t,o,0),l.Execute.RunNextJob()}),u.PreventDefault==!0)return}var f=new If({Job:t,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,RealtimeUrl:this.RealtimeApiUrl,Args:n,DataKey:o,Callback:function(D,c,T){l.RecvStockValue(D,c,T,0),l.Execute.RunNextJob()},ErrorCallback:function(D){l.AddStockValueError(o,D)}});f.Download()},this.GetProFinance=function(t){for(var n=t.ID,s=null,o=0;o<cn.length;++o){var l=cn[o];if(l.JobID==n){s=l;break}}if(!s)return this.Execute.RunNextJob();var h=this.JobArgumentsToArray(t,s.ArgCount),u=this.GetStockDataKey(t,h);if(this.StockData.has(u))return this.Execute.RunNextJob();var f=this,C=0;if([z.JOB_DOWNLOAD_GPJYVALUE,z.JOB_DOWNLOAD_SCJYVALUE,z.JOB_DOWNLOAD_BKJYVALUE].includes(n)&&(C=h[2]==1?0:2),this.NetworkFilter){var D=this.Data.GetDateRange(),c={Name:s.FuncName,Explain:s.Explain,JobID:n,Request:{Url:f.StockHistoryDayApiUrl,Type:"POST",Data:{Args:h,symbol:this.Symbol,daterange:D}},Self:this,PreventDefault:!1};if(this.NetworkFilter(c,function(T){f.RecvStockValue(T,t,u,C),f.Execute.RunNextJob()}),c.PreventDefault==!0)return}k.Chart.Warn("[JSSymbolData::GetProFinance] "+s.FuncName+" Not implemented.")},this.GetVariantData=function(t){var n=t.VariantName;if(this.StockData.has(n))return this.Execute.RunNextJob();var s=this;if(this.NetworkFilter){var o=this.Data.GetDateRange(),l={Name:"JSSymbolData::GetVariantData",Explain:"变量数据下载",JobID:t.ID,Request:{Url:"数据地址",Type:"POST",Data:{VariantName:t.VariantName,symbol:this.Symbol,daterange:o}},Self:this,PreventDefault:!1};if(this.NetworkFilter(l,function(D){if(D.Error)s.AddStockValueError(n,D.Error);else{var c=0;v.IsNumber(D.DataType)&&(c=D.DataType),s.RecvStockValue(D.Data,t,n,c)}s.Execute.RunNextJob()}),l.PreventDefault==!0)return}var h=function(c){s.AddStockValueError(n,c)},u;if(t.VariantName=="CAPITAL"||t.VariantName=="TOTALCAPITAL"||t.VariantName=="EXCHANGE"){var f=function(c,T,S){s.RecvStockValue(c,T,S,0),s.Execute.RunNextJob()};u=new If({Job:t,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,RealtimeUrl:this.RealtimeApiUrl,Args:[t.VariantName],DataKey:n,Callback:f,ErrorCallback:h})}else if(t.VariantName=="HYBLOCK"||t.VariantName=="DYBLOCK"||t.VariantName=="GNBLOCK"){var f=function(T,S,I,g){s.RecvStockValue(T,S,I,g),s.Execute.RunNextJob()};u=new sg({Job:t,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,RealtimeUrl:this.RealtimeApiUrl,Args:[t.VariantName],DataKey:n,Callback:f,ErrorCallback:h})}else if(t.VariantName=="INBLOCK"){var C=t.VariantName+", 请对接外部数据.";this.AddStockValueError(n,C),this.Execute.RunNextJob();return}else{var C="不支持变量"+t.VariantName+", 请对接外部数据.";this.AddStockValueError(n,C),this.Execute.RunNextJob();return}u.Download()},this.GetCustomVariantData=function(t){var n=t.VariantName;if(this.StockData.has(n))return this.Execute.RunNextJob();var s=Yt.CustomVariant.Data.get(n),o=this;if(this.NetworkFilter){var l=this.Data.GetDateRange(),h={Name:"JSSymbolData::GetCustomVariantData",Explain:"自定义变量数据下载",JobID:t.ID,Request:{Url:"数据地址",Type:"POST",Data:{VariantName:t.VariantName,symbol:this.Symbol,daterange:l,period:this.Period,right:this.Right}},Self:this,VariantInfo:s,PreventDefault:!1};this.NetworkFilter(h,function(u){u.Error?o.AddStockValueError(n,u.Error):o.RecvStockValue(u.Data,t,n,u.DataType),o.Execute.RunNextJob()})}else this.AddStockValueError(n,"自定义变量"+n+"下载失败"),this.Execute.RunNextJob()},this.GetCustomFunctionData=function(t){var n=t.FunctionName,s=Yt.CustomFunction.Data.get(n);if(!s.IsDownload)return this.Execute.RunNextJob();if(this.StockData.has(n))return this.Execute.RunNextJob();var o=this;if(this.NetworkFilter){var l=this.Data.GetDateRange(),h={Name:"JSSymbolData::GetCustomFunctionData",Explain:"自定义函数数据下载",JobID:t.ID,Request:{Url:"数据地址",Type:"POST",Data:{FunctionName:t.FunctionName,symbol:this.Symbol,daterange:l,JobItem:t,period:this.Period,right:this.Right}},Self:this,FunctionInfo:s,PreventDefault:!1};this.NetworkFilter(h,function(u){u.Error?o.AddStockValueError(n,u.Error):o.RecvStockValue(u.Data,t,n,u.DataType),o.Execute.RunNextJob()})}else this.AddStockValueError(n,"自定义函数"+n+"下载失败"),this.Execute.RunNextJob()},this.GetCustomFunctionDataV2=function(t){var n=t.FunctionName,s=Yt.CustomDataFunction.Data.get(n);if(s){var o=this.JobArgumentsToArray(t,s.ArgCount),l=this.GetStockDataKey(t,o);if(this.StockData.has(l))return this.Execute.RunNextJob();var h=this;if(this.NetworkFilter){var u=this.Data.GetDateRange(),f={Name:"JSSymbolData::GetCustomFunctionData",Explain:"自定义函数数据下载",JobID:t.ID,Request:{Url:"数据地址",Type:"POST",Data:{FunctionName:t.FunctionName,symbol:this.Symbol,daterange:u,JobItem:t,Key:l,period:this.Period,right:this.Right}},Self:this,FunctionInfo:s,PreventDefault:!1};this.NetworkFilter(f,function(C){C.Error?h.AddStockValueError(l,C.Error):h.RecvStockValue(C.Data,t,l,C.DataType),h.Execute.RunNextJob()})}else this.AddStockValueError(l,"自定义函数"+l+"下载失败"),this.Execute.RunNextJob()}},this.RecvStockValue=function(t,n,s,o){if(!t){k.Complier.Log("[JSSymbolData::RecvStockValue] key="+s+" data is null");return}if(o==0)if(Array.isArray(t)){var l=this.Data,h;if(this.DataType==wt.KLINE_ID)if(Y.IsDayPeriod(this.Period,!0))h=l.GetFittingFinanceData(t);else if(Y.IsMinutePeriod(this.Period,!0))h=l.GetMinuteFittingFinanceData(t);else return;else h=l.GetMinuteFittingFinanceData(t);var u=new Y;u.Data=h;var f=u.GetValue();if(s=="EXCHANGE")for(var C in f){var D=l.Data[C];v.IsPlusNumber(f[C])&&(f[C]=D.Vol/f[C]*100)}this.StockData.set(s,{Data:f})}else this.StockData.set(s,{Data:t.Value});else if(o==1)this.StockData.set(s,{Data:t.Value});else if(o==2){var l=this.Data,h;if(this.DataType==wt.KLINE_ID)if(Y.IsDayPeriod(this.Period,!0))h=l.GetFittingTradeData(t,0);else if(Y.IsMinutePeriod(this.Period,!0))h=l.GetMinuteFittingTradeData(t,0);else if(Y.IsTickPeriod(this.Period))h=l.GetMinuteFittingTradeData(t,0);else return;else h=l.GetMinuteFittingTradeData(t,0);var u=new Y;u.Data=h;var f=u.GetValue();this.StockData.set(s,{Data:f})}},this.AddStockValueError=function(t,n){this.StockData.set(t,{Error:n})},this.GetStockCacheData=function(t){var n;if(t.FunctionName)n=this.GetStockDataKey({FunctionName:t.FunctionName},t.Args);else if(t.VariantName)n=t.VariantName;else if(t.CustomName)n=t.CustomName;else return null;if(!this.StockData.has(n))return null;var s=this.StockData.get(n);return s.Error&&this.Execute.ThrowUnexpectedNode(t.Node,s.Error),s.Data},this.IsInBlock=function(t,n){var s=this.GetStockCacheData({VariantName:"INBLOCK",Node:n});if(!s)return 0;for(var o=s.split("|"),l=0;l<o.length;++l){var h=o[l];if(h==t)return 1}return 0},this.JobArgumentsToArray=function(t,n){var s=t.Args;if(s.length!=n){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,t.FunctionName+"() Error: argument count error.")}for(var l=[],h=0;h<s.length;++h){var u=s[h];if(v.IsNumber(u))l.push(u);else if(u.Type==ut.Literal)l.push(u.Value);else if(u.Type==ut.Identifier){var f=!1;for(var C in this.Arguments){var D=this.Arguments[C];if(D.Name==u.Name){l.push(D.Value),f=!0;break}}if(!f){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,t.FunctionName+"() Error: can't read "+u.Name)}}}return l},this.DownloadCustomAPIData=function(t){if(!this.NetworkFilter)return this.Execute.RunNextJob();var n=[];for(var s in t.Args){var o=t.Args[s];if(o.Type==ut.Literal)n.push(o.Value);else if(o.Type==ut.Identifier){var l=!1;for(var h in this.Arguments){var u=this.Arguments[h];if(u.Name==o.Name){n.push(u.Value),l=!0;break}}if(!l){var f=t.Token;this.Execute.ErrorHandler.ThrowError(f.Index,f.Line,0,"LoadAPIData() Error: can't read "+o.Name)}}else return this.Execute.RunNextJob()}var C=this,D={Name:"JSSymbolData::DownloadCustomAPIData",Explain:"下载自定义api数据",Period:this.Period,Right:this.Right,Symbol:this.Symbol,KData:this.Data,Cache:this.CustomAPIData,Args:n,Self:this,PreventDefault:!1};this.NetworkFilter(D,function(c){C.RecvCustomAPIData(c,n),C.Execute.RunNextJob()}),D.PreventDefault!=!0&&this.Execute.RunNextJob()},this.RecvCustomAPIData=function(t,n){t&&(t.Type==1?this.RecvCustomAPISingleData(t,n):this.RecvCustomAPIGroupData(t,n))},this.RecvCustomAPIGroupData=function(t,n){if(!(!t||!t.data)){var s=t.data,o=this.GenerateCustomAPIKey(n);if(Y.IsMinutePeriod(this.Period,!0)){if(!s.date||!s.time)return;var l=s.date;s.time;for(var h in s)if(!(h=="date"||h=="time"))var u=s[h]}else if(Y.IsDayPeriod(this.Period,!0)){if(!s.date)return;var l=s.date,f={__Type__:"Object"};for(var h in s)if(h!="date"){var u=s[h];if(Array.isArray(u)){var C=this.FittingCustomAPIArray(u,l);f[h]=C}else this.IsNumber(u)&&(f[h]=u)}this.CustomAPIData.set(o,f)}}},this.RecvCustomAPISingleData=function(t,n){var s=t.data,o=this.GenerateCustomAPIKey(n);if(Y.IsMinutePeriod(this.Period,!0)){if(!s.date||!s.time)return;var l=s.date;s.time;for(var h in s)h=="date"||h=="time"||s[h]}else if(Y.IsDayPeriod(this.Period,!0)){if(!s.date)return;var l=s.date,u=s.value,f=null;Array.isArray(u)?t.DataType==1?f=this.FittingCustomAPIFinanceArray(u,l):f=this.FittingCustomAPIArray(u,l):f=u,this.CustomAPIData.set(o,f)}},this.FittingCustomAPIFinanceArray=function(t,n,s){var o=this.Data,l=[];for(var h in t){var u=t[h],f=new Wt;f.Date=n[h],s&&h<s.length&&(f.Time=s[h]),f.Value=u,l.push(f)}var C;if(Y.IsDayPeriod(this.Period,!0))C=o.GetFittingFinanceData(l);else if(Y.IsMinutePeriod(this.Period,!0))C=o.GetMinuteFittingFinanceData(l);else return null;var D=new Y;D.Data=C;var c=D.GetValue();return c},this.FittingCustomAPIArray=function(t,n,s){var o=this.Data,l=[];for(var h in t){var u=t[h],f=new Wt;f.Date=n[h],s&&h<s.length&&(f.Time=s[h]),f.Value=u,l.push(f)}var C;if(Y.IsDayPeriod(this.Period,!0))C=o.GetFittingData(l);else if(Y.IsMinutePeriod(this.Period,!0))C=o.GetMinuteFittingData(l);else return null;var D=new Y;D.Data=C;var c=D.GetValue();return c},this.GenerateCustomAPIKey=function(t){if(t.length<=0)return"__12_EMPTY_ARGS__";var n="";for(var s in t)n.length>0&&(n+=","),n+=t[s];return n},this.GetCustomApiData=function(t){var n=this.GenerateCustomAPIKey(t);return this.CustomAPIData.has(n)?this.CustomAPIData.get(n):(k.Complier.Log("[JSSymbolData::GetCustomApiData] can't find api data key=["+n+"]"),null)},this.ReadArgumentValue=function(t,n){if(n.Name=t.Name,t.Type==ut.Literal)return n.Value=t.Value,!0;if(t.Type==ut.Identifier){var s=!1;for(var o in this.Arguments){var l=this.Arguments[o];if(l.Name==t.Name)return n.Value=l.Value,s=!0,!0}if(!s)return n.Error="can't read "+t.Name,!1}return n.Error="can't read "+t.Name+", type error.",!1},this.ReadIndexFunctionOut=function(t,n){var s={};if((typeof t>"u"?"undefined":(0,or.default)(t))==="object"){if(!this.ReadArgumentValue(t,s))return n.Error=s.Error,!1}else s.Value=t;return n.OutIndex=s.Value,n.Out=null,!0},this.ReadIndexFunctionValue=function(t,n){var s={};if((typeof t>"u"?"undefined":(0,or.default)(t))==="object"){if(!this.ReadArgumentValue(t,s))return n.Error=s.Error,!1}else s.Value=t;var o=s.Value.indexOf(".");if(o!=-1){n.Name=s.Value.slice(0,o);var l=s.Value.indexOf("#",o+1);l!=-1?(n.Out=s.Value.slice(o+1,l),n.Period=s.Value.slice(l+1)):n.Out=s.Value.slice(o+1)}else{var l=s.Value.indexOf("#");l!=-1?(n.Name=s.Value.slice(0,l),n.Period=s.Value.slice(l+1)):n.Name=s.Value}var h=new Dt.default([["DAY",0],["WEEK",1],["MONTH",2],["SEASON",9],["YEAR",3],["HALFYEAR",22],["WEEK2",21],["MIN1",4],["MIN5",5],["MIN15",6],["MIN30",7],["MIN60",8],["MIN120",11],["MIN240",12],["DAY2",40002],["MULTIDAY",40002],["DAY3",40003],["DAY4",40004],["DAY5",40005],["DAY6",40006],["DAY7",40007],["DAY8",40008],["DAY9",40009],["DAY10",40010],["DAY11",40011],["DAY12",40012],["DAY13",40013],["DAY14",40014],["DAY15",40015]]);if(n.Period){if(!h.has(n.Period))return n.Error=n.Period+", 周期错误",!1;n.PeriodID=h.get(n.Period)}return!0},this.ReadSymbolArgumentValue=function(t,n){var s={};if((typeof t>"u"?"undefined":(0,or.default)(t))==="object"){if(!this.ReadArgumentValue(t,s))return n.Error=s.Error,!1}else s.Value=t;s.Value==""&&(s.Value=this.Symbol);var o=s.Value;return o.indexOf(".SH")>0?n.Symbol=o.replace(".SH",".sh"):o.indexOf(".SZ")>0?n.Symbol=o.replace(".SZ",".sz"):o.indexOf("SH")==0?n.Symbol=o.slice(2)+".sh":o.indexOf("SZ")==0?n.Symbol=o.slice(2)+".sz":n.Symbol=o,!0},this.ReadIndexArgumentValue=function(t,n){n.Args=[];for(var s in n.SytemIndex.Args){var o=n.SytemIndex.Args[s];n.Args.push({Value:o.Value,Name:o.Name})}if(t.length>2&&n.SytemIndex.Args&&n.SytemIndex.Args.length>0)for(var s=2,l=0;s<t.length&&l<n.SytemIndex.Args.length;++s,++l){var h={},o=t[s];if((typeof o>"u"?"undefined":(0,or.default)(o))==="object"){if(!this.ReadArgumentValue(o,h))return n.Error=h.Error,!1}else h.Value=o;n.Args[l].Value=h.Value}return!0},this.GenerateScriptIndexKey=function(t){var n="",s=t.Args;for(var o in s){n.length>0&&(n+=",");var l=s[o];n+=l.Value.toString()}var h="ALL";t.Out?h=t.Out:v.IsPlusNumber(t.OutIndex)&&(h="Out["+(t.OutIndex-1)+"]");var u="("+t.Symbol+","+t.PeriodID+"), "+t.Name+"("+n+")=>"+h;return u},this.CallMemberScriptIndex=function(t){var n=this;if(t.Member.Object.Type!=ut.Identifier||t.Member.Property.Type!=ut.Identifier){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallMemberScriptIndex() Error: 参数错误")}var o=t.Member.Object.Name,l=t.Member.Property.Name;if(l==""||l==null){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallMemberScriptIndex() Error: "+o+"."+l+" 指标输出变量错误")}if(this.Execute.VarTable.has(o)){var h=this.Execute.VarTable.get(o);if(h.hasOwnProperty(l))return k.Complier.Log("[JSSymbolData::CallMemberScriptIndex] index data "+o+"."+l+" in cache."),this.Execute.RunNextJob()}var u=o+"."+l,f={Job:t,PeriodID:this.Period,Symbol:this.Symbol};if(!this.ReadIndexFunctionValue(u,f)){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallMemberScriptIndex() Error: '"+u+"' "+f.Error)}var C=new Z,D=C.Get(f.Name);if(!D){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallMemberScriptIndex() Error: '"+u+"' "+f.Name+" 指标不存在")}if(Array.isArray(D.Args)&&D.Args.length>0){f.Args=[];for(var c in D.Args){var T=D.Args[c];f.Args.push({Value:T.Value,Name:T.Name})}}k.Complier.Log("[JSSymbolData::CallMemberScriptIndex] call script index",f);var S=this.Data.GetDateRange(),I={HQDataType:this.DataType,Symbol:f.Symbol,Name:"",Right:this.Right,Period:f.PeriodID,Data:null,SourceData:null,Callback:function(E,F,R){n.RecvMemberScriptIndexData(E,F,R),n.Execute.RunNextJob()},CallbackParam:f,Async:!0,MaxRequestDataCount:this.MaxRequestDataCount+30*2,MaxRequestMinuteDayCount:this.MaxRequestMinuteDayCount+2,Arguments:f.Args,IsBeforeData:this.IsBeforeData,NetworkFilter:this.NetworkFilter,IsApiPeriod:this.IsApiPeriod,KLineRange:S};be.Execute(D.Script,I,function(g,E){n.ExecuteScriptIndexError(g,E)})},this.CallDynamicScriptIndex=function(t,n){var s=this,o=t.DynamicName,l={Job:t,PeriodID:this.Period,Symbol:this.Symbol};if(!this.ReadIndexFunctionValue(o,l)){var h=t.Token;this.Execute.ErrorHandler.ThrowError(h.Index,h.Line,0,"CallDynamicScriptIndex() Error: '"+o+"' "+l.Error)}var u=new Z,f=u.Get(l.Name);if(!f){var h=t.Token;this.Execute.ErrorHandler.ThrowError(h.Index,h.Line,0,"CallDynamicScriptIndex() Error: '"+o+"' "+l.Name+" 指标不存在")}if(l.SytemIndex=f,!this.ReadDynamicIndexArgumentValue(t.Args,l,n)){var h=t.Token;this.Execute.ErrorHandler.ThrowError(h.Index,h.Line,0,"CallDynamicScriptIndex() "+l.Name+" 指标参数错误 : "+l.Error+" ")}k.Complier.Log("[JSSymbolData::CallMemberScriptIndex] call script index",l);var C=this.Data.GetDateRange(),D={HQDataType:this.DataType,Symbol:l.Symbol,Name:"",Right:this.Right,Period:l.PeriodID,Data:null,SourceData:null,Callback:function(T,S,I){s.RecvDynamicScriptIndexData(T,S,I),s.Execute.RunNextJob()},CallbackParam:l,Async:!0,MaxRequestDataCount:this.MaxRequestDataCount+30*2,MaxRequestMinuteDayCount:this.MaxRequestMinuteDayCount+2,Arguments:l.Args,IsBeforeData:this.IsBeforeData,NetworkFilter:this.NetworkFilter,IsApiPeriod:this.IsApiPeriod,KLineRange:C};be.Execute(f.Script,D,function(c,T){s.ExecuteScriptIndexError(c,T)})},this.ReadDynamicIndexArgumentValue=function(t,n,s){n.Args=[];for(var o=0;o<n.SytemIndex.Args.length;++o){var l=n.SytemIndex.Args[o];n.Args.push({Value:l.Value,Name:l.Name,IsDefault:!0})}if(!v.IsNonEmptyArray(t))return!0;for(var o=0;o<t.length;++o){var l=t[o],h=n.Args[o];h&&(l.Type==ut.Literal?(h.Value=l.Value,h.IsDefault=!1):l.Type==ut.Identifier&&s.has(l.Name)&&(h.Value=s.get(l.Name),h.IsDefault=!1))}return!0},this.CallScriptIndex=function(t,n){var s=this;if(t.Member)return this.CallMemberScriptIndex(t);if(t.DynamicName)return this.CallDynamicScriptIndex(t,n);if(!t.Args||!(t.Args.length>=2)){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,"CallScriptIndex() Error: "+t.FunctionName+" 参数错误")}var l={Job:t,PeriodID:this.Period};if(!this.ReadSymbolArgumentValue(t.Args[0],l)){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,"CallScriptIndex() Error: "+l.Error)}if(!this.ReadIndexFunctionValue(t.Args[1],l)){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,"CallScriptIndex() Error: "+l.Error)}if(t.FunctionName=="CALCSTOCKINDEX"&&!this.ReadIndexFunctionOut(t.Args[2],l)){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,"CallScriptIndex() Error: "+l.Error)}var h=new Z,u=h.Get(l.Name);if(!u){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,"CallScriptIndex() "+l.Name+" 指标不存在")}if(l.SytemIndex=u,!this.ReadIndexArgumentValue(t.Args,l)){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,"CallScriptIndex() "+l.Name+" 指标参数错误 : "+l.Error+" ")}k.Complier.Log("[JSSymbolData::CallScriptIndex] call script index",l);var f=null;if(this.Data&&this.Data.Data.length>0){var C=this.Data.Data[0],D=this.Data.Data[this.Data.Data.length-1];f={Start:{Date:C.Date,Time:C.Time},End:{Date:D.Date,Time:D.Time}}}var c={HQDataType:this.DataType,Symbol:l.Symbol,Name:"",Right:this.Right,Period:l.PeriodID,Data:null,SourceData:null,Callback:function(S,I,g){s.RecvScriptIndexData(S,I,g),s.Execute.RunNextJob()},CallbackParam:l,Async:!0,MaxRequestDataCount:this.MaxRequestDataCount+30*2,MaxRequestMinuteDayCount:this.MaxRequestMinuteDayCount+2,Arguments:l.Args,IsBeforeData:this.IsBeforeData,NetworkFilter:this.NetworkFilter,IsApiPeriod:this.IsApiPeriod,KLineRange:f};be.Execute(l.SytemIndex.Script,c,function(T,S){s.ExecuteScriptIndexError(T,S)})},this.RecvMemberScriptIndexData=function(t,n,s){k.Complier.Log("[JSSymbolData::RecvMemberScriptIndexData] ",t,n,s);var o=s.Data.Data,l=t,h=this.Data.FitKLineIndex(o,l,this.Period,n.PeriodID),u=n.Job.Member,f=u.Object.Name;u.Property.Name;var C={};this.Execute.VarTable.has(f)?C=this.Execute.VarTable.get(f):this.Execute.VarTable.set(f,C);for(var D in h){var c=t[D].Name;n.Period&&(c+="#"+n.Period),C[c]=h[D].Data}},this.RecvDynamicScriptIndexData=function(t,n,s){k.Complier.Log("[JSSymbolData::RecvDynamicScriptIndexData] ",t,n,s);var o=s.Data.Data,l=t,h=this.Data.FitKLineIndex(o,l,this.Period,n.PeriodID),u=n.Name,f={};this.Execute.VarTable.has(u)?f=this.Execute.VarTable.get(u):this.Execute.VarTable.set(u,f);for(var C="",D=0;D<n.Args.length;++D){var c=n.Args[D];c.IsDefault===!1&&(C.length>0&&(C+=","),C+=""+c.Value)}for(var T="("+C+")",D=0;D<h.length;++D){var S=t[D].Name+"#"+T;n.Period&&(S+="#"+n.Period),f[S]=h[D].Data}},this.RecvScriptIndexData=function(t,n,s){var o=this.GenerateScriptIndexKey(n);k.Complier.Log("[JSSymbolData::RecvScriptIndexData] ",t,n,s,o);var l=s.Data.Data,h=t;if(n.Out){for(var u=0;u<t.length;++u){var f=t[u];if(f.Name==n.Out){h=[f];break}}var C=this.Data.FitKLineIndex(l,h,this.Period,n.PeriodID);this.ScriptIndexOutData.set(o,C[0].Data)}else if(v.IsPlusNumber(n.OutIndex)){var D=n.OutIndex-1;h=[t[D]];var C=this.Data.FitKLineIndex(l,h,this.Period,n.PeriodID);this.ScriptIndexOutData.set(o,C[0].Data)}else{var C=this.Data.FitKLineIndex(l,h,this.Period,n.PeriodID),c={__Type__:"Object"};for(var u in C){var f=C[u];c[f.Name]=f.Data}this.ScriptIndexOutData.set(o,c)}},this.ExecuteScriptIndexError=function(t,n){var s=n.Job.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallScriptIndex() "+n.Name+" 指标执行错误 : "+t+" ")},this.GetScriptIndexOutData=function(t,n,s){var o={PeriodID:this.Period};this.ReadSymbolArgumentValue(t[0],o)||this.Execute.ThrowUnexpectedNode(n,s+"() 股票代码错误: "+o.Error),this.ReadIndexFunctionValue(t[1],o)||this.Execute.ThrowUnexpectedNode(n,s+"() 指标错误: "+o.Error),s=="CALCSTOCKINDEX"&&(this.ReadIndexFunctionOut(t[2],o)||this.Execute.ThrowUnexpectedNode(n,s+"() Error: "+o.Error));var l=new Z,h=l.Get(o.Name);h||this.Execute.ThrowUnexpectedNode(n,s+"() 指标错误: "+o.Name+" 指标不存在"),o.SytemIndex=h,this.ReadIndexArgumentValue(t,o)||this.Execute.ThrowUnexpectedNode(n,s+"()  指标参数错误: "+o.Error);var u=this.GenerateScriptIndexKey(o);return this.ScriptIndexOutData.has(u)?this.ScriptIndexOutData.get(u):null},this.JsonDataToHistoryData=function(t){for(var n=t.data,s=new Array,o=0,l=1,h=2,u=3,f=4,C=5,D=6,c=7,T=8,S=9,I=10,g=11,E=0;E<n.length;++E){var F=new Pt;F.Date=n[E][o],F.Open=n[E][h],F.YClose=n[E][l],F.Close=n[E][C],F.High=n[E][u],F.Low=n[E][f],F.Vol=n[E][D],F.Amount=n[E][c],n[E].length>T&&(F.Up=n[E][T]),n[E].length>S&&(F.Down=n[E][S]),n[E].length>I&&(F.Stop=n[E][I]),n[E].length>g&&(F.Unchanged=n[E][g]),!(isNaN(F.Open)||F.Open<=0)&&s.push(F)}return s},this.JsonDataToMinuteHistoryData=function(t){for(var n=t.data,s=new Array,o=0,l=1,h=2,u=3,f=4,C=5,D=6,c=7,T=8,S=0;S<n.length;++S){var I=new Pt;I.Date=n[S][o],I.Open=n[S][h],I.YClose=n[S][l],I.Close=n[S][C],I.High=n[S][u],I.Low=n[S][f],I.Vol=n[S][D],I.Amount=n[S][c],I.Time=n[S][T],s.push(I)}for(var g=0;g<s.length;++g){var E=s[g];if(E==null&&coninue,isNaN(E.Open)||E.Open<=0||isNaN(E.High)||E.High<=0||isNaN(E.Low)||E.Low<=0||isNaN(E.Close)||E.Close<=0||isNaN(E.YClose)||E.YClose<=0)if(g==0)E.YClose>0&&(E.Open=E.YClose,E.High=E.YClose,E.Low=E.YClose,E.Close=E.YClose);else for(var F=g-1;F>=0;--F){var R=s[F];if(R==null&&coninue,R.Open>0&&R.High>0&&R.Low>0&&R.Close>0){E.YClose<=0&&(E.YClose=R.Close),E.Open=R.Open,E.High=R.High,E.Low=R.Low,E.Close=R.Close;break}}}return s},this.JsonDataToMinuteData=function(t){var n=new Array;for(var s in t.stock[0].minute){var o=t.stock[0].minute[s],l=new fs;l.Close=o.price,l.Open=o.open,l.High=o.high,l.Low=o.low,l.Vol=o.vol,l.Amount=o.amount,s==0?l.DateTime=t.stock[0].date.toString()+" 0925":l.DateTime=t.stock[0].date.toString()+" "+o.time.toString(),l.Date=t.stock[0].date,l.Time=o.time,l.Increase=o.increase,l.Risefall=o.risefall,l.AvPrice=o.avprice,n[s]=l}return n},this.JsonDataToMultiDayMinuteData=function(t){var n=t.symbol,s=n.toUpperCase(),o=U.IsSHSZ(s);U.IsChinaFutures(s);var l=[];for(var h in t.data){var E=[],u=t.data[h],f=u.date,C=u.yclose,D=C,c=null;for(var T in u.minute){var S=u.minute[T];S[2]&&(D=S[2]);var I=new fs;I.Close=S[2],I.Open=S[1],I.High=S[3],I.Low=S[4],I.Vol=S[5]/100,I.Amount=S[6],7<S.length&&S[7]>0&&(I.AvPrice=S[7],c=S[7]),I.DateTime=f.toString()+" "+S[0].toString(),I.Date=f,I.Time=S[0],I.Close||(I.Close=D,I.Open=I.High=I.Low=I.Close),!I.AvPrice&&c&&(I.AvPrice=c),I.Close&&C?I.Increase=(I.Close-C)/C*100:I.Increase=null,T==0&&(o&&(I.DateTime=f.toString()+" 0925"),I.IsFristData=!0),I.Open<=0&&(I.Open=null),I.Close<=0&&(I.Close=null),I.AvPrice<=0&&(I.AvPrice=null),I.High<=0&&(I.High=null),I.Low<=0&&(I.Low=null),I.AvPrice<=0&&(I.AvPrice=null),E[T]=I}var g=new Y;g.Data=E,g.YClose=C,g.Close=u.close,g.Date=f,l.push(g)}for(var E=[],h=l.length-1;h>=0;--h){var I=l[h];for(var T in I.Data)E.push(I.Data[T])}return E},this.CODELIKE=function(t){return this.Symbol&&this.Symbol.indexOf(t)==0?1:0},this.NAMELIKE=function(t){return this.Name&&this.Name.indexOf(t)==0?1:0},this.SETCODE=function(){return this.Symbol.indexOf(".sh")?1:(this.Symbol.indexOf(".sz"),0)},this.GetSymbol=function(){return this.Symbol},this.GetName=function(){return this.Name},this.DATE=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n in this.Data.Data){var s=this.Data.Data[n];t[n]=s.Date-19e6}return t},this.YEAR=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n in this.Data.Data){var s=this.Data.Data[n];this.IsNumber(s.Date)?t[n]=parseInt(s.Date/1e4):t[n]=null}return t},this.DAY=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n in this.Data.Data){var s=this.Data.Data[n];this.IsNumber(s.Date)?t[n]=parseInt(s.Date%100):t[n]=null}return t},this.MONTH=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n in this.Data.Data){var s=this.Data.Data[n];this.IsNumber(s.Date)?t[n]=parseInt(s.Date%1e4/100):t[n]=null}return t},this.TIME=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n=0;n<this.Data.Data.length;++n){var s=this.Data.Data[n];this.IsNumber(s.Time)?t[n]=s.Time:t[n]=0}return t},this.TIME2=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n=0;n<this.Data.Data.length;++n){var s=this.Data.Data[n];this.IsNumber(s.Time)?t[n]=s.Time*100:t[n]=0}return t},this.DateTime=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n=Y.IsMinutePeriod(this.Period,!0),s=0;s<this.Data.Data.length;++s){var o=this.Data.Data[s];n?t[s]=o.Date*1e4+o.Time:t[s]=o.Date}return t},this.WEEK=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;var n=new Date;for(var s in this.Data.Data){var o=this.Data.Data[s];if(t[s]=null,!!this.IsNumber(o.Date)){var l=parseInt(o.Date/1e4),h=parseInt(o.Date%1e4/100),u=o.Date%100;n.setFullYear(l,h-1,u),t[s]=n.getDay()}}return t},this.DAYSTOTODAY=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n=new Date,s=new Date(n.getFullYear(),n.getMonth(),n.getDate()),o=0;o<this.Data.Data.length;++o){var l=this.Data.Data[o];if(t[o]=null,!!this.IsNumber(l.Date)){var h=parseInt(l.Date/1e4),u=parseInt(l.Date%1e4/100),f=l.Date%100,C=new Date(h,u-1,f),D=Math.ceil((s-C)/(24*60*60*1e3));t[o]=D}}return t},this.WEEKOFYEAR=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n in this.Data.Data){var s=this.Data.Data[n];if(t[n]=null,!!this.IsNumber(s.Date)){var o=parseInt(s.Date/1e4),l=parseInt(s.Date%1e4/100),h=s.Date%100,u=new Date(o,l-1,h),f=new Date(o,0,1),C=Math.ceil((u-f)/(24*60*60*1e3));C+=f.getDay()+1-1;var D=Math.ceil(C/7),c=D;t[n]=c}}return t},this.GetYearWeek=function(t){var n=new Date(t.getFullYear(),0,1),s=t.getDay();s==0&&(s=7);var o=n.getDay();o==0&&(o=7);var l=t.getTime()-n.getTime(),h=Math.floor((l+(o-s)*(24*60*60*1e3))/864e5);return Math.ceil(h/7)+1},this.REFDATE=function(t,n){var s=null;if(Array.isArray(n)?n.length>0&&(s=n[n.length-1]):this.IsNumber(n)&&(s=n),s==null)return null;s<5e6&&(s+=19e6);var o=null;for(var l in this.Data.Data)if(this.Data.Data[l].Date==s){o=parseInt(l);break}return o==null||o>=t.length?null:t[o]},this.PERIOD=function(){var t=[5,6,7,11,0,1,2,3,4,5,9];return this.Period>=0&&this.Period<=t.length-1?t[this.Period]:this.Period},this.GetDrawNull=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var n in this.Data.Data)t[n]=null;return t},this.HOUR=function(){var t=[];if(!this.Data||!this.Data.Data||!v.IsNonEmptyArray(this.Data.Data))return t;for(var n=0;n<this.Data.Data.length;++n){var s=this.Data.Data[n];t[n]=0,v.IsNumber(s.Time)&&(t[n]=parseInt(s.Time/100))}return t},this.MINUTE=function(){var t=[];if(!this.Data||!this.Data.Data||!v.IsNonEmptyArray(this.Data.Data))return t;for(var n=0;n<this.Data.Data.length;++n){var s=this.Data.Data[n];t[n]=0,v.IsNumber(s.Time)&&(t[n]=s.Time%100)}return t},this.SysParam=function(t,n){if(!this.DrawInfo)return[];if(t==2){if(n.IsUsePageData=!0,v.IsNumber(this.DrawInfo.Start))return this.DrawInfo.Start+1}else if(t==3){if(n.IsUsePageData=!0,v.IsNumber(this.DrawInfo.End))return this.DrawInfo.End+1}else if(t==4){if(n.IsUsePageData=!0,!v.IsNumber(this.DrawInfo.End)||!v.IsNumber(this.DrawInfo.Start))return[];if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return[];for(var s=null,o=this.DrawInfo.Start;o<=this.DrawInfo.End&&o<this.Data.Data.length;++o){var l=this.Data.Data[o];v.IsNumber(l.High)&&(s==null||s<l.High)&&(s=l.High)}return s}else if(t==5){if(n.IsUsePageData=!0,!v.IsNumber(this.DrawInfo.End)||!v.IsNumber(this.DrawInfo.Start))return[];if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return[];for(var h=null,o=this.DrawInfo.Start;o<=this.DrawInfo.End&&o<this.Data.Data.length;++o){var l=this.Data.Data[o];v.IsNumber(l.Low)&&(h==null||h>l.Low)&&(h=l.Low)}return h}return[]}}wn.prototype.IsNumber=function(e){return!(e==null||isNaN(e))};wn.prototype.IsDivideNumber=function(e){return!(e==null||isNaN(e)||e==0)};wn.prototype.JsonDataToFinance=function(e){for(var a,r=1;r<=4;++r){switch(r){case 1:var t=e.finance1,n=e.announcement1;break;case 2:var t=e.finance2,n=e.announcement2;break;case 3:var t=e.finance3,n=e.announcement3;break;case 4:var t=e.finance4,n=e.announcement4;break}!t||!n||!this.IsNumber(n.year)||!this.IsNumber(n.quarter)||(a?a.Announcement.year<n.year&&(a={Date:e.date,Finance:t,Announcement:n}):a={Date:e.date,Finance:t,Announcement:n})}return a};var z={JOB_DOWNLOAD_SYMBOL_DATA:1,JOB_DOWNLOAD_INDEX_DATA:2,JOB_DOWNLOAD_SYMBOL_LATEST_DATA:3,JOB_DOWNLOAD_INDEX_INCREASE_DATA:4,JOB_DOWNLOAD_VOLR_DATA:5,JOB_DOWNLOAD_LATEST_INDEX_DATA:8,JOB_DOWNLOAD_OTHER_SYMBOL_DATA:9,JOB_DOWNLOAD_SYMBOL_PERIOD_DATA:10,JOB_DOWNLOAD_FINVALUE:301,JOB_DOWNLOAD_FINONE:302,JOB_DOWNLOAD_FINANCE:303,JOB_DOWNLOAD_GPJYVALUE:304,JOB_DOWNLOAD_VARIANT:305,JOB_DOWNLOAD_SCJYVALUE:306,JOB_DOWNLOAD_GPJYONE:307,JOB_DOWNLOAD_SCJYONE:308,JOB_DOWNLOAD_BKJYVALUE:309,JOB_DOWNLOAD_BKJYONE:310,JOB_DOWNLOAD_MARGIN_BALANCE:1e3,JOB_DOWNLOAD_MARGIN_RATE:1001,JOB_DOWNLOAD_MARGIN_BUY_BALANCE:1010,JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:1011,JOB_DOWNLOAD_MARGIN_BUY_REPAY:1012,JOB_DOWNLOAD_MARGIN_BUY_NET:1013,JOB_DOWNLOAD_MARGIN_SELL_BALANCE:1020,JOB_DOWNLOAD_MARGIN_SELL_VOLUME:1021,JOB_DOWNLOAD_MARGIN_SELL_REPAY:1022,JOB_DOWNLOAD_MARGIN_SELL_NET:1023,JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE:2e3,JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH:2001,JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT:2002,JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE:2003,JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2:2004,JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER:2005,JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING:2006,JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS:2007,JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS:2008,JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE:2009,JOB_DOWNLOAD_HK_TO_SH:2050,JOB_DOWNLOAD_HK_TO_SZ:2051,JOB_DOWNLOAD_HK_TO_SH_SZ:2052,JOB_DOWNLOAD_HK_TO_SHSZ:2053,JOB_CUSTOM_FUNCTION_DATA:6e3,JOB_CUSTOM_VARIANT_DATA:6001,JOB_CUSTOM_DATA_FUNCTION:6002,JOB_DOWNLOAD_SECTION_SF:2e4,JOB_DOWNLOAD_SECTION_F_01:20001,JOB_DOWNLOAD_SECTION_F_02:20002,JOB_DOWNLOAD_SECTION_F_03:20003,JOB_DOWNLOAD_SECTION_F_04:20004,JOB_DOWNLOAD_SECTION_F_05:20005,JOB_DOWNLOAD_SECTION_F_06:20006,JOB_DOWNLOAD_SECTION_F_07:20007,JOB_DOWNLOAD_SECTION_F_08:20008,JOB_DOWNLOAD_SECTION_F_09:20009,JOB_DOWNLOAD_SECTION_F_10:20010,JOB_DOWNLOAD_SECTION_F_11:20011,JOB_DOWNLOAD_SECTION_F_12:20012,JOB_DOWNLOAD_SECTION_F_13:20013,JOB_DOWNLOAD_SECTION_F_14:20014,JOB_DOWNLOAD_SECTION_F_15:20015,JOB_DOWNLOAD_SECTION_F_16:20016,JOB_DOWNLOAD_SECTION_F_17:20017,JOB_DOWNLOAD_SECTION_F_18:20018,JOB_DOWNLOAD_SECTION_F_19:20019,JOB_DOWNLOAD_SECTION_F_20:20020,JOB_DOWNLOAD_SECTION_F_21:20021,JOB_DOWNLOAD_SECTION_F_22:20022,JOB_DOWNLOAD_SECTION_F_23:20023,JOB_DOWNLOAD_SECTION_F_24:20024,JOB_DOWNLOAD_SECTION_F_25:20025,JOB_DOWNLOAD_SECTION_F_26:20026,JOB_DOWNLOAD_SECTION_F_27:20027,JOB_DOWNLOAD_SECTION_F_28:20028,JOB_DOWNLOAD_SECTION_F_29:20029,JOB_DOWNLOAD_SECTION_F_30:20030,JOB_DOWNLOAD_SECTION_F_31:20031,JOB_DOWNLOAD_SECTION_F_32:20032,JOB_DOWNLOAD_SECTION_F_33:20033,JOB_DOWNLOAD_SECTION_F_34:20034,JOB_DOWNLOAD_SECTION_F_35:20035,JOB_DOWNLOAD_SECTION_F_36:20036,JOB_DOWNLOAD_SECTION_F_37:20037,JOB_DOWNLOAD_SECTION_F_38:20038,JOB_DOWNLOAD_SECTION_F_39:20039,JOB_DOWNLOAD_CUSTOM_API_DATA:3e4,JOB_EXECUTE_INDEX:30010,JOB_RUN_SCRIPT:1e4,GetMarginJobID:function(a){var r=new Dt.default([[1,z.JOB_DOWNLOAD_MARGIN_BALANCE],[2,z.JOB_DOWNLOAD_MARGIN_RATE],[3,z.JOB_DOWNLOAD_MARGIN_BUY_BALANCE],[4,z.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT],[5,z.JOB_DOWNLOAD_MARGIN_BUY_REPAY],[6,z.JOB_DOWNLOAD_MARGIN_BUY_NET],[7,z.JOB_DOWNLOAD_MARGIN_SELL_BALANCE],[8,z.JOB_DOWNLOAD_MARGIN_SELL_VOLUME],[9,z.JOB_DOWNLOAD_MARGIN_SELL_REPAY],[10,z.JOB_DOWNLOAD_MARGIN_SELL_NET]]);return r.has(a)?r.get(a):null},GetNewsAnalysisID:function(a){var r=new Dt.default([[1,z.JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE],[2,z.JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH],[3,z.JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT],[4,z.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE],[5,z.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2],[6,z.JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER],[7,z.JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING],[8,z.JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS],[9,z.JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS],[10,z.JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE]]);return r.has(a)?r.get(a):null},GetSectionFinanceID:function(a){var r=new Dt.default([["流动资产",z.JOB_DOWNLOAD_SECTION_F_01],["货币资金",z.JOB_DOWNLOAD_SECTION_F_02],["存货",z.JOB_DOWNLOAD_SECTION_F_03],["流动负债",z.JOB_DOWNLOAD_SECTION_F_04],["非流动负债",z.JOB_DOWNLOAD_SECTION_F_05],["三项费用",z.JOB_DOWNLOAD_SECTION_F_06],["投资收益",z.JOB_DOWNLOAD_SECTION_F_07],["归母净利润",z.JOB_DOWNLOAD_SECTION_F_08],["扣非净利润",z.JOB_DOWNLOAD_SECTION_F_09],["扣非每股收益",z.JOB_DOWNLOAD_SECTION_F_10],["加权平均净资产收益",z.JOB_DOWNLOAD_SECTION_F_11],["在建工程",z.JOB_DOWNLOAD_SECTION_F_12],["累计折旧",z.JOB_DOWNLOAD_SECTION_F_13],["少数股东利润",z.JOB_DOWNLOAD_SECTION_F_14],["汇兑损益",z.JOB_DOWNLOAD_SECTION_F_15],["坏账计提",z.JOB_DOWNLOAD_SECTION_F_16],["固定资产",z.JOB_DOWNLOAD_SECTION_F_17],["当期折旧",z.JOB_DOWNLOAD_SECTION_F_18],["营业总收入",z.JOB_DOWNLOAD_SECTION_F_19],["主营业务利润",z.JOB_DOWNLOAD_SECTION_F_20],["营业利润",z.JOB_DOWNLOAD_SECTION_F_21],["净利润",z.JOB_DOWNLOAD_SECTION_F_22],["应收账款",z.JOB_DOWNLOAD_SECTION_F_23],["财务费用",z.JOB_DOWNLOAD_SECTION_F_24],["经营性现金流",z.JOB_DOWNLOAD_SECTION_F_25],["资产总计",z.JOB_DOWNLOAD_SECTION_F_26],["负债总计",z.JOB_DOWNLOAD_SECTION_F_27],["所有者权益总计",z.JOB_DOWNLOAD_SECTION_F_28],["毛利率",z.JOB_DOWNLOAD_SECTION_F_29],["每股资本公积金",z.JOB_DOWNLOAD_SECTION_F_30],["每股未分配利润",z.JOB_DOWNLOAD_SECTION_F_31],["每股收益",z.JOB_DOWNLOAD_SECTION_F_32],["每股净资产",z.JOB_DOWNLOAD_SECTION_F_33],["每股经营性现金流",z.JOB_DOWNLOAD_SECTION_F_34],["扣非净利润涨幅",z.JOB_DOWNLOAD_SECTION_F_35],["扣非净利润涨速",z.JOB_DOWNLOAD_SECTION_F_36],["净利润涨幅",z.JOB_DOWNLOAD_SECTION_F_37],["资产负债率",z.JOB_DOWNLOAD_SECTION_F_38],["利润同比",z.JOB_DOWNLOAD_SECTION_F_39]]);return r.has(a)?r.get(a):null},GetSectionReportPeriod:function(a,r){return a>=2e3&&r>=1&&r<=4?{Year:a,Quarter:r}:null}},cn=[{Name:"GPJYVALUE",JobID:z.JOB_DOWNLOAD_GPJYVALUE,Explain:"股票交易类数据GPJYVALUE(ID,N,TYPE)",FuncName:"JSSymbolData::GetGPJYValue",ArgCount:3},{Name:"GPJYONE",JobID:z.JOB_DOWNLOAD_GPJYONE,Explain:"股票交易类数据GPJYONE(ID,N,Y,MMDD)",FuncName:"JSSymbolData::GetGPJYOne",ArgCount:4},{Name:"SCJYVALUE",JobID:z.JOB_DOWNLOAD_SCJYVALUE,Explain:"市场交易类数据SCJYVALUE(ID,N,TYPE)",FuncName:"JSSymbolData::GetSCJYValue",ArgCount:3},{Name:"SCJYONE",JobID:z.JOB_DOWNLOAD_SCJYONE,Explain:"市场交易类数据SCJYONE(ID,N,Y,MMDD)",FuncName:"JSSymbolData::GetSCJYOne",ArgCount:4},{Name:"BKJYVALUE",JobID:z.JOB_DOWNLOAD_BKJYVALUE,Explain:"板块交易类数据BKJYVALUE(ID,N,TYPE)",FuncName:"JSSymbolData::GetBKJYValue",ArgCount:3},{Name:"BKJYONE",JobID:z.JOB_DOWNLOAD_BKJYONE,Explain:"板块交易类数据BKJYONE(ID,N,Y,MMDD)",FuncName:"JSSymbolData::GetBKJYOne",ArgCount:4},{Name:"FINVALUE",JobID:z.JOB_DOWNLOAD_FINVALUE,Explain:"财务数据FINVALUE(ID)",FuncName:"JSSymbolData::GetFinValue",ArgCount:1},{Name:"FINONE",JobID:z.JOB_DOWNLOAD_FINONE,Explain:"财务数据FINONE(ID,Y,MMDD)",FuncName:"JSSymbolData::GetFinOne",ArgCount:3}];function eg(e,a){var r=this;this.AST=e,this.ErrorHandler=new bn,this.VarTable=new Dt.default,this.VarDrawTable=new Dt.default,this.OutVarTable=[],this.Arguments=[],this.ErrorCallback,this.GetEventCallback,this.IsUsePageData=!1,this.IndexCtrl,this.Debug=0,this.DebugFilter,this.Interrupt={Exit:!1},this.ConstVarTable=new Dt.default([["CLOSE",null],["VOL",null],["OPEN",null],["HIGH",null],["LOW",null],["AMOUNT",null],["C",null],["V",null],["O",null],["H",null],["L",null],["AMO",null],["VOLR",null],["VOLINSTK",null],["OPI",null],["QHJSJ",null],["SETTLE",null],["ZSTJJ",null],["ISEQUAL",null],["ISUP",null],["ISDOWN"],["DATE",null],["YEAR",null],["MONTH",null],["PERIOD",null],["WEEK",null],["WEEKDAY",null],["TIME",null],["DAY",null],["DATETIME",null],["TIME2",null],["WEEKOFYEAR",null],["DAYSTOTODAY",null],["HOUR",null],["MINUTE",null],["INDEXA",null],["INDEXC",null],["INDEXH",null],["INDEXL",null],["INDEXO",null],["INDEXV",null],["INDEXADV",null],["INDEXDEC",null],["ADVANCE",null],["DECLINE",null],["FROMOPEN",null],["TOTALFZNUM",null],["CURRBARSCOUNT",null],["TOTALBARSCOUNT",null],["ISLASTBAR",null],["BARSTATUS",null],["BARPOS",null],["CAPITAL",null],["TOTALCAPITAL",null],["EXCHANGE",null],["SETCODE",null],["CODE",null],["STKNAME",null],["TQFLAG",null],["HYBLOCK",null],["DYBLOCK",null],["GNBLOCK",null],["FGBLOCK",null],["ZSBLOCK",null],["ZHBLOCK",null],["ZDBLOCK",null],["HYZSCODE",null],["GNBLOCKNUM",null],["FGBLOCKNUM",null],["ZSBLOCKNUM",null],["ZHBLOCKNUM",null],["ZDBLOCKNUM",null],["HYSYL",null],["HYSJL",null],["DRAWNULL",null],["NULL",null],["MACHINEDATE",null],["MACHINETIME",null],["MACHINEWEEK",null],["TR",null],["AUTOFILTER",null],["LARGEINTRDVOL",null],["LARGEOUTTRDVOL",null],["TRADENUM",null],["TRADEINNUM",null],["TRADEOUTNUM",null],["LARGETRDINNUM",null],["LARGETRDOUTNUM",null],["CUR_BUYORDER",null],["CUR_SELLORDER",null],["ACTINVOL",null],["ACTOUTVOL",null],["BIDORDERVOL",null],["BIDCANCELVOL",null],["AVGBIDPX",null],["OFFERORDERVOL",null],["OFFERCANCELVOL",null],["AVGOFFERPX",null]]),this.SymbolData=new wn(this.AST,a,this),this.Algorithm=new pi(this.ErrorHandler,this.SymbolData),this.Draw=new Wr(this.ErrorHandler,this.SymbolData),this.JobList=[],this.UpdateUICallback=null,this.CallbackParam=null,this.IsSectionMode=!1,a&&(a.Callback&&(this.UpdateUICallback=a.Callback),a.CallbackParam&&(this.CallbackParam=a.CallbackParam,this.CallbackParam.HQChart&&(this.GetEventCallback=function(t){return r.CallbackParam.HQChart.GetEventCallback(t)})),a.Arguments&&(this.Arguments=a.Arguments),a.IsSectionMode&&(this.IsSectionMode=a.IsSectionMode),a.Self&&(this.IndexCtrl=a.Self),v.IsNumber(a.Debug)&&(this.Debug=a.Debug),a.DebugFilter&&(this.DebugFilter=a.DebugFilter)),this.Execute=function(){this.OutVarTable=[],this.VarTable=new Dt.default,this.VarDrawTable=new Dt.default,k.Complier.Log("[JSExecute::Execute] Load Arguments",this.Arguments);for(var t in this.Arguments){var n=this.Arguments[t];this.VarTable.set(n.Name,n.Value)}this.RunNextJob()},this.RunNextJob=function(){if(!(this.JobList.length<=0)){k.Complier.Log("[JSExecute::Execute] JobList",this.JobList);var t=this.JobList.shift();switch(t.ID){case z.JOB_DOWNLOAD_SYMBOL_DATA:return this.SymbolData.GetSymbolData();case z.JOB_DOWNLOAD_SYMBOL_PERIOD_DATA:return this.SymbolData.GetSymbolPeriodData(t);case z.JOB_DOWNLOAD_INDEX_DATA:return this.SymbolData.GetIndexData();case z.JOB_DOWNLOAD_LATEST_INDEX_DATA:return this.SymbolData.GetLatestIndexData();case z.JOB_DOWNLOAD_INDEX_INCREASE_DATA:return this.SymbolData.GetIndexIncreaseData(t);case z.JOB_DOWNLOAD_SYMBOL_LATEST_DATA:return this.SymbolData.GetLatestData(t);case z.JOB_DOWNLOAD_VOLR_DATA:return this.SymbolData.GetVolRateData(t);case z.JOB_DOWNLOAD_OTHER_SYMBOL_DATA:return this.SymbolData.GetOtherSymbolData(t);case z.JOB_DOWNLOAD_RELEASE_DATE_DATA:return this.SymbolData.GetCompanyReleaseDate(t.ID);case z.JOB_DOWNLOAD_MARGIN_BALANCE:case z.JOB_DOWNLOAD_MARGIN_RATE:case z.JOB_DOWNLOAD_MARGIN_BUY_BALANCE:case z.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:case z.JOB_DOWNLOAD_MARGIN_BUY_REPAY:case z.JOB_DOWNLOAD_MARGIN_BUY_NET:case z.JOB_DOWNLOAD_MARGIN_SELL_BALANCE:case z.JOB_DOWNLOAD_MARGIN_SELL_VOLUME:case z.JOB_DOWNLOAD_MARGIN_SELL_REPAY:case z.JOB_DOWNLOAD_MARGIN_SELL_NET:return this.SymbolData.GetMarginData(t.ID);case z.JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE:case z.JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH:case z.JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT:case z.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE:case z.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2:case z.JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER:case z.JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING:case z.JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS:case z.JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS:case z.JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE:return this.SymbolData.GetNewsAnalysisData(t.ID);case z.JOB_DOWNLOAD_HK_TO_SHSZ:return this.SymbolData.GetHKToSHSZData(t);case z.JOB_DOWNLOAD_SECTION_SF:return this.SymbolData.GetSectionFinanceData(t);case z.JOB_DOWNLOAD_FINANCE:return this.SymbolData.GetFinance(t);case z.JOB_DOWNLOAD_FINONE:case z.JOB_DOWNLOAD_FINVALUE:case z.JOB_DOWNLOAD_GPJYVALUE:case z.JOB_DOWNLOAD_GPJYONE:case z.JOB_DOWNLOAD_SCJYVALUE:case z.JOB_DOWNLOAD_SCJYONE:case z.JOB_DOWNLOAD_BKJYVALUE:case z.JOB_DOWNLOAD_BKJYONE:return this.SymbolData.GetProFinance(t);case z.JOB_DOWNLOAD_VARIANT:return this.SymbolData.GetVariantData(t);case z.JOB_CUSTOM_VARIANT_DATA:return this.SymbolData.GetCustomVariantData(t);case z.JOB_CUSTOM_FUNCTION_DATA:return this.SymbolData.GetCustomFunctionData(t);case z.JOB_CUSTOM_DATA_FUNCTION:return this.SymbolData.GetCustomFunctionDataV2(t);case z.JOB_DOWNLOAD_CUSTOM_API_DATA:return this.SymbolData.DownloadCustomAPIData(t);case z.JOB_EXECUTE_INDEX:return this.SymbolData.CallScriptIndex(t,this.VarTable);case z.JOB_RUN_SCRIPT:return this.Debug===1&&this.DebugFilter?this.DebugRun():this.Run()}}},this.ReadSymbolData=function(t,n){switch(t){case"CLOSE":case"C":case"VOL":case"V":case"OPEN":case"O":case"HIGH":case"H":case"LOW":case"L":case"AMOUNT":case"AMO":case"OPI":case"VOLINSTK":case"SETTLE":case"QHJSJ":case"ZSTJJ":case"ISEQUAL":case"ISUP":case"ISDOWN":return this.SymbolData.GetSymbolCacheData(t);case"VOLR":return this.SymbolData.GetVolRateCacheData(n);case"TR":return this.SymbolData.GetTRData(n);case"INDEXA":case"INDEXC":case"INDEXH":case"INDEXH":case"INDEXO":case"INDEXV":case"INDEXL":case"INDEXADV":case"INDEXDEC":return this.SymbolData.GetIndexCacheData(t);case"CURRBARSCOUNT":return this.SymbolData.GetCurrBarsCount();case"BARPOS":return this.SymbolData.GetBarPos();case"TOTALBARSCOUNT":return this.SymbolData.GetTotalBarsCount();case"TOTALFZNUM":return this.SymbolData.GetTotalTradeMinuteCount();case"ISLASTBAR":return this.SymbolData.GetIsLastBar();case"BARSTATUS":return this.SymbolData.GetBarStatus();case"TOTALCAPITAL":case"CAPITAL":case"EXCHANGE":case"HYBLOCK":case"DYBLOCK":case"GNBLOCK":case"FGBLOCK":case"ZSBLOCK":case"ZHBLOCK":case"ZDBLOCK":case"HYZSCODE":case"GNBLOCKNUM":case"FGBLOCKNUM":case"ZSBLOCKNUM":case"ZHBLOCKNUM":case"ZDBLOCKNUM":case"HYSYL":case"HYSJL":case"FROMOPEN":case"LARGEINTRDVOL":case"LARGEOUTTRDVOL":case"TRADENUM":case"TRADEINNUM":case"TRADEOUTNUM":case"LARGETRDINNUM":case"LARGETRDOUTNUM":case"CUR_BUYORDER":case"CUR_SELLORDER":case"ACTINVOL":case"ACTOUTVOL":case"BIDORDERVOL":case"BIDCANCELVOL":case"AVGBIDPX":case"OFFERORDERVOL":case"OFFERCANCELVOL":case"AVGOFFERPX":return this.SymbolData.GetStockCacheData({VariantName:t,Node:n});case"SETCODE":return this.SymbolData.SETCODE();case"CODE":return this.SymbolData.GetSymbol();case"STKNAME":return this.SymbolData.GetName();case"TIME":return this.SymbolData.TIME();case"TIME2":return this.SymbolData.TIME2();case"DATE":return this.SymbolData.DATE();case"DATETIME":return this.SymbolData.DateTime();case"YEAR":return this.SymbolData.YEAR();case"MONTH":return this.SymbolData.MONTH();case"WEEK":case"WEEKDAY":return this.SymbolData.WEEK();case"DAY":return this.SymbolData.DAY();case"PERIOD":return this.SymbolData.PERIOD();case"HOUR":return this.SymbolData.HOUR();case"MINUTE":return this.SymbolData.MINUTE();case"DRAWNULL":case"NULL":return this.SymbolData.GetDrawNull();case"ADVANCE":case"DECLINE":return this.SymbolData.GetIndexIncreaseCacheData(t,this.SymbolData.Symbol,n);case"TQFLAG":return this.SymbolData.Right;case"MACHINEDATE":{var s=new Date;return s.getFullYear()*1e4+s.getMonth()*1*100+s.getDate()-19e6}case"MACHINETIME":{var s=new Date;return s.getHours()*1e4+s.getMinutes()*1*100+s.getSeconds()}case"MACHINEWEEK":{var s=new Date;return s.getDay()}case"WEEKOFYEAR":return this.SymbolData.WEEKOFYEAR();case"DAYSTOTODAY":return this.SymbolData.DAYSTOTODAY()}this.ThrowUnexpectedNode(n,"变量"+t+"不存在",t)},this.ReadCustomVariant=function(t,n){return this.SymbolData.GetStockCacheData({VariantName:t,Node:n})},this.ReadVariable=function(t,n){if(this.ConstVarTable.has(t)){var s=this.ConstVarTable.get(t);return s==null&&(s=this.ReadSymbolData(t,n),this.ConstVarTable.set(t,s)),s}if(Yt.IsCustomVariant(t))return this.ReadCustomVariant(t,n);if(this.VarTable.has(t))return this.VarTable.get(t);if(t.indexOf("#")>0){var o=t.split("#");return this.SymbolData.GetSymbolPeriodCacheData(o[0],o[1])}if(t.indexOf("COLOR")==0){var l=be.ColorVarToRGB(t);if(l)return l}return this.ThrowUnexpectedNode(n,"变量"+t+"不存在",t),null},this.ReadMemberVariable=function(t){var n=t.Object,s=t.Property,o=void 0;if(n.Type==ut.BinaryExpression||n.Type==ut.LogicalExpression?o=this.VisitBinaryExpression(n):n.Type==ut.CallExpression?o=this.VisitCallExpression(n):o=this.GetNodeValue(n),!o)return null;var l=o[s.Name];return l||null},this.SingleDataToArrayData=function(t){for(var n=this.SymbolData.Data.Data.length,s=[],o=0;o<n;++o)s[o]=t;return s},this.RunAST=function(){this.AST||this.ThrowError(),this.AST.Body||this.ThrowError();for(var t=0;t<this.AST.Body.length;++t){var n=this.AST.Body[t];if(this.RunASTNode(n,t),this.Interrupt&&this.Interrupt.Exit){k.Complier.Log("[JSExecute::RunAST] Interrupt",this.Interrupt);break}}return k.Complier.Log("[JSExecute::RunAST]",this.VarTable),this.OutVarTable},this.RunASTNode=function(t,n){this.VisitNode(t);var s=n;if(t.Type==ut.ExpressionStatement&&t.Expression){if(t.Expression.Type==ut.AssignmentExpression){if(t.Expression.Operator==":"&&t.Expression.Left){var o=t.Expression,l=o.Left.Name,h=this.VarTable.get(l);if(this.VarDrawTable.has(l)){var u=this.VarDrawTable.get(l);this.OutVarTable.push({Name:u.Name,Draw:u,Type:1})}else{var f=0;if(h&&(typeof h>"u"?"undefined":(0,or.default)(h))=="object"&&h.__Type__=="Object")f=1e3;else if(!this.IsSectionMode&&!Array.isArray(h))if(typeof h=="string"){var C=parseFloat(h);v.IsNumber(C)?h=this.SingleDataToArrayData(C):(h=this.SingleDataToArrayData(h),f=1001)}else h=this.SingleDataToArrayData(h);this.OutVarTable.push({Name:l,Data:h,Type:f})}}}else if(t.Expression.Type==ut.CallExpression){var D=t.Expression;if(this.Draw.IsDrawFunction(D.Callee.Name)){var c=D.Draw;c.Name=D.Callee.Name,this.OutVarTable.push({Name:c.Name,Draw:c,Type:1})}else if(D.Callee.Name==="IFC"&&D.Draw){var T=D.Draw;T.Name=T.DrawType,this.OutVarTable.push({Name:T.Name,Draw:T,Type:1})}else{var S=D.Out;F="__temp_c_"+D.Callee.Name+"_"+s+"__";var f=0;Array.isArray(S)||(S=this.SingleDataToArrayData(S)),this.OutVarTable.push({Name:F,Data:S,Type:f,NoneName:!0})}}else if(t.Expression.Type==ut.Identifier){var I=t.Expression.Name,g=this.ReadVariable(I,t.Expression),f=0;g&&(typeof g>"u"?"undefined":(0,or.default)(g))=="object"&&g.__Type__=="Object"?f=1e3:!this.IsSectionMode&&!Array.isArray(g)&&(typeof g=="string"?g=this.SingleDataToArrayData(parseFloat(g)):g=this.SingleDataToArrayData(g)),I="__temp_i_"+s+"__",this.OutVarTable.push({Name:I,Data:g,Type:f,NoneName:!0})}else if(t.Expression.Type==ut.Literal){var E=t.Expression.Value;v.IsString(E)&&E.indexOf("$")>0&&(E=this.SymbolData.GetOtherSymolCacheData({Literal:E})),F="__temp_li_"+s+"__";var f=0;Array.isArray(E)||(E=this.SingleDataToArrayData(E)),this.OutVarTable.push({Name:F,Data:E,Type:f,NoneName:!0})}else if(t.Expression.Type==ut.BinaryExpression){var F="__temp_b_"+s+"__",R=t.Expression.Out,f=0;Array.isArray(R)||(R=this.SingleDataToArrayData(R)),this.OutVarTable.push({Name:F,Data:R,Type:f,NoneName:!0})}else if(t.Expression.Type==ut.LogicalExpression){var F="__temp_l_"+s+"__",A=t.Expression.Out,f=0;Array.isArray(A)||(A=this.SingleDataToArrayData(A)),this.OutVarTable.push({Name:F,Data:A,Type:f,NoneName:!0})}else if(t.Expression.Type==ut.UnaryExpression){var F="__temp_u_"+s+"__",P={};if(this.ReadUnaryExpression(t.Expression,P)){var f=0;this.OutVarTable.push({Name:F,Data:P.OutVar,Type:f,NoneName:!0})}}else if(t.Expression.Type==ut.MemberExpression){var p=this.ReadMemberVariable(t.Expression);if(p){var f=0,F="__temp_di_"+s+"__";Array.isArray(p)||(p=this.SingleDataToArrayData(p)),this.OutVarTable.push({Name:F,Data:p,Type:f,NoneName:!0})}}else if(t.Expression.Type==ut.SequenceExpression){for(var w=void 0,H=void 0,W=void 0,ht=void 0,rt=void 0,nt=void 0,vt=void 0,Nt=!1,Ft=!1,Bt=!1,Jt=!1,te=!1,Me=!1,we=!1,Oa=!1,It=!1,bt=!0,xt=!1,qt=!1,ge=!1,me=!1,ha=!1,Oe=!0,Ni=!1,Te=!1,Ci=!1,ja=-1,Di=-1,vi=-1,ti=null,la=null,Ai=null,Zi=null,Qi=null,Ta=null,Ra=null,je=0;je<t.Expression.Expression.length;++je){var dt=t.Expression.Expression[je];if(dt.Type==ut.AssignmentExpression&&dt.Operator==":"&&dt.Left){if(je==0){w=dt.Left.Name;var Xe=this.VarTable.get(w);this.VarDrawTable.has(w)?H=this.VarDrawTable.get(w):Array.isArray(Xe)||(Xe=this.SingleDataToArrayData(Xe),this.VarTable.set(w,Xe))}}else if(dt.Type==ut.Identifier){var he=dt.Name;if(he==="COLORSTICK")Nt=!0;else if(he==="POINTDOT")Ft=!0;else if(he==="CIRCLEDOT")Jt=!0;else if(he==="DOTLINE")qt=!0;else if(he=="UPDOWNDOT")Bt=!0;else if(he==="LINESTICK")te=!0;else if(he==="STICK")Me=!0;else if(he==="VOLSTICK")we=!0;else if(he=="LINEAREA")Oa=!0;else if(he==="DRAWABOVE")Ni=!0;else if(he==="DRAWCENTER")Te=!0;else if(he=="DRAWBELOW")Ci=!0;else if(he=="STEPLINE")It=!0;else if(he=="SINGLELINE")me=!0;else if(he.indexOf("COLOR")==0)W=he;else if(he.indexOf("RGBX")==0&&he.length==10)W=he;else if(he.indexOf("LINETHICK")==0)vt=he;else if(he=="ALIGN0")ja=0;else if(he=="ALIGN1")ja=1;else if(he=="ALIGN2")ja=2;else if(he=="VALIGN0")Di=0;else if(he=="VALIGN1")Di=1;else if(he=="VALIGN2")Di=2;else if(he.indexOf("NODRAW")==0)bt=!1;else if(he.indexOf("EXDATA")==0)xt=!0;else if(he.indexOf("LINEOVERLAY")==0)ge=!0;else if(he.indexOf("NOTEXT")==0||he.indexOf("NOTITLE")==0)Oe=!1;else if(he.indexOf("FONTSIZE")==0){var _n=he.replace("FONTSIZE","");vi=parseInt(_n)}else if(je==0){w=dt.Name;var Tr=this.ReadVariable(w,dt);Array.isArray(Tr)||(Tr=this.SingleDataToArrayData(Tr)),w="__temp_si_"+s+"__",ha=!0,this.VarTable.set(w,Tr)}}else if(dt.Type==ut.Literal){if(je==0){var As=this.SingleDataToArrayData(dt.Value);w=dt.Value.toString(),this.VarTable.set(w,As)}}else if(dt.Type==ut.CallExpression)if(je==0)if(this.Draw.IsDrawFunction(dt.Callee.Name))H=dt.Draw,H.Name=dt.Callee.Name;else{var ys=dt.Out;w="__temp_sc_"+dt.Callee.Name+"_"+s+"__",ha=!0,this.VarTable.set(w,ys)}else if(dt.Callee.Name=="RGB"||dt.Callee.Name=="RGBA")W=dt.Out;else if(dt.Callee.Name=="UPCOLOR")ht=dt.Out;else if(dt.Callee.Name=="DOWNCOLOR")rt=dt.Out;else if(dt.Callee.Name=="STICKTYPE")nt=dt.Out;else if(dt.Callee.Name=="XMOVE")Zi=dt.Out;else if(dt.Callee.Name=="YMOVE")Qi=dt.Out;else if(dt.Callee.Name=="LINEDASH")v.IsNonEmptyArray(dt.Out)&&(Ra=dt.Out.slice());else if(dt.Callee.Name=="FIRSTDRAW")dt.Out===0?Ai=!1:dt.Out===1&&(Ai=!0);else if(dt.Callee.Name=="SOUND")this.GetSoundEvent(),w=null;else if(dt.Callee.Name=="ICON"){var yi=this.VarTable.get(w);yi&&(H=this.GetOutIconData(yi,dt.Draw),H&&(H.Name=dt.Callee.Name)),w=null}else dt.Callee.Name=="BACKGROUND"?(ti=dt.Draw,w=null):dt.Callee.Name=="CKLINE"?(la=dt.Draw,w=null):dt.Callee.Name=="KLINETYPE"&&(Ta=dt.Out);else if(dt.Type==ut.BinaryExpression){if(je==0){w="__temp_sb_"+s+"__";var Xa=dt.Out;ha=!0,this.VarTable.set(w,Xa)}}else if(dt.Type==ut.UnaryExpression){if(je==0){w="__temp_su_"+s+"__";var P={};this.ReadUnaryExpression(dt,P)&&(ha=!0,this.VarTable.set(w,P.OutVar))}}else if(dt.Type==ut.MemberExpression&&je==0){var p=this.ReadMemberVariable(dt);p&&(Array.isArray(p)||(varValue=this.SingleDataToArrayData(p)),ha=!0,w="__temp_di_"+s+"__",this.VarTable.set(w,p))}}if(Ft&&w){var Pa=this.VarTable.get(w);Array.isArray(Pa)||(Pa=this.SingleDataToArrayData(Pa));var ei={Name:w,Data:Pa,Radius:d.POINTDOT.Radius,Type:3};W&&(ei.Color=W),vt&&(ei.LineWidth=vt),this.OutVarTable.push(ei)}else if(Jt&&w){var Sr=this.VarTable.get(w);Array.isArray(Sr)||(Sr=this.SingleDataToArrayData(Sr));var Oi={Name:w,Data:Sr,Radius:d.CIRCLEDOT.Radius,Type:3};W&&(Oi.Color=W),vt&&(Oi.LineWidth=vt),this.OutVarTable.push(Oi)}else if(Bt&&w){var $i=this.VarTable.get(w);Array.isArray($i)||($i=this.SingleDataToArrayData($i));var dr={Name:w,Data:$i,Radius:d.CIRCLEDOT.Radius,Type:3,UpDownDot:!0};W&&(dr.Color=W),vt&&(dr.LineWidth=vt),this.OutVarTable.push(dr)}else if(te&&w){var Hn=this.VarTable.get(w),ai={Name:w,Data:Hn,Type:4};W&&(ai.Color=W),vt&&(ai.LineWidth=vt),this.OutVarTable.push(ai)}else if(Me&&w){var qi=this.VarTable.get(w),Ir={Name:w,Data:qi,Type:5};W&&(Ir.Color=W),vt&&(Ir.LineWidth=vt),this.OutVarTable.push(Ir)}else if(we&&w){var Os=this.VarTable.get(w),ke={Name:w,Data:Os,Type:6};W&&(ke.Color=W),ht&&(ke.UpColor=ht),rt&&(ke.DownColor=rt),vt&&(ke.LineWidth=vt),v.IsNumber(nt)&&(ke.StickType=nt),this.OutVarTable.push(ke)}else if(Oa&&w){var ta=this.VarTable.get(w),ci={Name:w,Data:ta,Type:9};W&&(ci.Color=W),ht&&(ci.UpColor=ht),rt&&(ci.DownColor=rt),vt&&(ci.LineWidth=vt),this.OutVarTable.push(ci)}else if(Nt&&w){var Vn=this.VarTable.get(w),Pi={Name:w,Data:Vn,Color:W,Type:2};vt&&(Pi.LineWidth=vt),W&&(Pi.Color=W),ht&&(Pi.UpColor=ht),rt&&(Pi.DownColor=rt),this.OutVarTable.push(Pi)}else if(w&&W&&!H){var ji=this.VarTable.get(w);Array.isArray(ji)||(ji=this.SingleDataToArrayData(ji));var Ke={Name:w,Data:ji,Color:W,Type:0};vt&&(Ke.LineWidth=vt),bt==!1&&(Ke.IsShow=!1),xt==!0&&(Ke.IsExData=!0),qt==!0&&(Ke.IsDotLine=!0),v.IsNonEmptyArray(Ra)&&(Ke.LineDash=Ra),ge==!0&&(Ke.IsOverlayLine=!0),me==!0&&(Ke.IsSingleLine=!0),ha==!0&&(Ke.NoneName=!0),Oe==!1&&(Ke.IsShowTitle=!1),It==!0&&(Ke.Type=7),this.OutVarTable.push(Ke)}else if(H){var p={Name:H.Name,Draw:H,Type:1};W&&(p.Color=W),qt==!0&&(p.IsDotLine=!0),v.IsNonEmptyArray(Ra)&&(p.LineDash=Ra),vt&&(p.LineWidth=vt),Ni&&(p.IsDrawAbove=!0),Te&&(p.IsDrawCenter=!0),Ci&&(p.IsDrawBelow=!0),ja>=0&&(p.DrawAlign=ja),Di>=0&&(p.DrawVAlign=Di),vi>0&&(p.DrawFontSize=vi),ti&&(p.Background=ti),la&&(p.VerticalLine=la),v.IsNumber(Zi)&&(p.XOffset=Zi),v.IsNumber(Qi)&&(p.YOffset=Qi),v.IsBool(Ai)&&(p.IsFirstDraw=Ai),v.IsNumber(Ta)&&(p.KLineType=Ta),this.OutVarTable.push(p)}else if(w){var Bi=this.VarTable.get(w),ua={Name:w,Data:Bi,Type:0};W&&(ua.Color=W),vt&&(ua.LineWidth=vt),bt==!1&&(ua.IsShow=!1),xt==!0&&(ua.IsExData=!0),qt==!0&&(ua.IsDotLine=!0),v.IsNonEmptyArray(Ra)&&(ua.LineDash=Ra),ge==!0&&(ua.IsOverlayLine=!0),me==!0&&(ua.IsSingleLine=!0),Oe==!1&&(ua.IsShowTitle=!1),It==!0&&(ua.Type=7),this.OutVarTable.push(ua)}}}},this.ReadUnaryExpression=function(t,n){var s=t.Argument,o=null;if(s.Type==ut.Literal)o=s.Value,Array.isArray(o)||(o=this.SingleDataToArrayData(o));else if(s.Type==ut.Identifier){var l=s.Name;o=this.ReadVariable(l,t.Expression),Array.isArray(o)||(o=this.SingleDataToArrayData(o))}else if(s.Type==ut.BinaryExpression)o=s.Out,Array.isArray(o)||(o=this.SingleDataToArrayData(o));else if(s.Type==ut.CallExpression){var h=s;if(this.Draw.IsDrawFunction(h.Callee.Name))return!1;if(h.Callee.Name==="IFC"&&h.Draw)return!1;o=h.Out,Array.isArray(o)||(o=this.SingleDataToArrayData(o))}else return!1;return t.Operator=="-"&&o&&(o=this.Algorithm.Subtract(0,o)),n.OutVar=o,!0},this.GetOutIconData=function(t,n){if(Array.isArray(t)){for(var s=0;s<t.length&&s<n.DrawData.length;++s){var o=t[s];o<=0&&(n.DrawData[s]=null)}return n}return t?n:null},this.GetSoundEvent=function(){return this.GetEventCallback?this.GetEventCallback($.ON_PLAY_SOUND):null},this.Run=function(){try{var t=this.RunAST();k.Complier.Log("[JSComplier.Run] execute finish",t),this.IndexCtrl&&(this.IndexCtrl.Status=0),this.UpdateUICallback&&(k.Complier.Log("[JSComplier.Run] invoke UpdateUICallback."),this.CallbackParam&&this.CallbackParam.Job&&this.CallbackParam.Job.ID==z.JOB_EXECUTE_INDEX?this.UpdateUICallback(t,this.CallbackParam,this.SymbolData):(this.CallbackParam&&this.CallbackParam.Self&&this.CallbackParam.Self.ClassName==="ScriptIndexConsole"&&(this.CallbackParam.JSExecute=this),this.IsUsePageData==!0&&(this.CallbackParam.Self.IsUsePageData=!0),this.UpdateUICallback(t,this.CallbackParam)))}catch(n){k.Complier.Log(n),n.Job?(k.Complier.Log("[JSComplier.Run] download job and reexectue",n.Job),this.JobList.push(n.Job),this.JobList.push({ID:z.JOB_RUN_SCRIPT}),this.Execute()):this.ErrorCallback&&(this.IndexCtrl&&(this.IndexCtrl.Status=0),this.ErrorCallback(n,this.CallbackParam))}},this.DebugRun_End=function(){var t=this.OutVarTable;k.Complier.Log("[JSComplier.DebugRun_End] execute finish",t),this.IndexCtrl&&(this.IndexCtrl.Status=0),this.UpdateUICallback&&(k.Complier.Log("[JSComplier.DebugRun_End] invoke UpdateUICallback."),this.CallbackParam&&this.CallbackParam.Job&&this.CallbackParam.Job.ID==z.JOB_EXECUTE_INDEX?this.UpdateUICallback(t,this.CallbackParam,this.SymbolData):(this.CallbackParam&&this.CallbackParam.Self&&this.CallbackParam.Self.ClassName==="ScriptIndexConsole"&&(this.CallbackParam.JSExecute=this),this.IsUsePageData==!0&&(this.CallbackParam.Self.IsUsePageData=!0),this.UpdateUICallback(t,this.CallbackParam)))},this.DebugRun_Next=function(t){var n=this;if(t.ExeLine<t.LineCount){var s=this.AST.Body[t.ExeLine];this.RunASTNode(s),++t.ExeLine,this.DebugFilter(t,function(){n.DebugRun_Next(t)})}else this.DebugRun_End(),t.Status=2,this.DebugFilter(t,null)},this.DebugRun=function(){var t=this;try{this.AST||this.ThrowError(),this.AST.Body||this.ThrowError();var n={LineCount:this.AST.Body.length,ExeLine:0,Self:this,Status:1};this.DebugFilter(n,function(){t.DebugRun_Next(n)})}catch(s){this.ErrorCallback&&(this.IndexCtrl&&(this.IndexCtrl.Status=0),this.ErrorCallback(s,this.CallbackParam))}},this.VisitNode=function(t){switch(t.Type){case ut.SequenceExpression:this.VisitSequenceExpression(t);break;case ut.ExpressionStatement:this.VisitNode(t.Expression);break;case ut.AssignmentExpression:this.VisitAssignmentExpression(t);break;case ut.BinaryExpression:case ut.LogicalExpression:this.VisitBinaryExpression(t);break;case ut.CallExpression:this.VisitCallExpression(t);break;case ut.UnaryExpression:this.VisitUnaryExpression(t);break}},this.VisitUnaryExpression=function(t){if(t.Operator=="-")var n=this.GetNodeValueEx(t.Argument),s=this.Algorithm.Subtract(0,n);else var s=t.Argument.Value;return s},this.VisitSequenceExpression=function(t){for(var n in t.Expression){var s=t.Expression[n];this.VisitNode(s)}},this.GetDynamicScriptIndex=function(t,n){var s=t.Callee.Value,o=s.split(".");o.length!=2&&this.ThrowUnexpectedNode(t,"调用指标格式'"+s+"'错误");var l=o[0],h=o[1],u=null,f=h.indexOf("#");f!=-1&&(u=h.slice(f+1),h=h.slice(0,f));for(var C="",D=0;D<n.length;++D){var I=n[D];C.length>0&&(C+=","),C+=""+I}var c="("+C+")",T=h+"#"+c;if(u&&(T+="#"+u),!this.VarTable.has(l))return null;var S=this.VarTable.get(l),I=S[T];return I},this.VisitCallExpression=function(t){for(var n=t.Callee.Name,s=[],o=0;o<t.Arguments.length;++o){var l=t.Arguments[o],h;if(n==="IFC"&&o>=1)break;l.Type==ut.BinaryExpression||l.Type==ut.LogicalExpression?h=this.VisitBinaryExpression(l):l.Type==ut.CallExpression?h=this.VisitCallExpression(l):h=this.GetNodeValue(l),s.push(h)}if(t.Callee.Type==ut.Literal){t.Out=[],t.Draw=null;var u=this.GetDynamicScriptIndex(t,s);return u&&(t.Out=u),t.Out}if(n==="IFC"){var f=this.Algorithm.IFC(s[0]),l=f?t.Arguments[1]:t.Arguments[2],h;return l.Type==ut.BinaryExpression||l.Type==ut.LogicalExpression?h=this.VisitBinaryExpression(l):l.Type==ut.CallExpression?h=this.VisitCallExpression(l):h=this.GetNodeValue(l),t.Out=h,l.Draw&&(t.Draw=l.Draw),t.Out}if(Yt.IsCustomFunction(n)){var u=this.Algorithm.CallCustomFunction(n,s,this.SymbolData,t);return t.Out=[],t.Draw=null,u&&(u.Out&&(t.Out=u.Out),u.Draw&&(t.Draw=u.Draw)),t.Out}if(Yt.IsCustomDataFunction(n)){var C=Yt.CustomDataFunction.Data.get(n);return t.Out=this.SymbolData.GetStockCacheData({FunctionName:n,Args:s,ArgCount:C.ArgCount,Node:t}),t.Draw=null,t.Out}switch(n){case"DYNAINFO":t.Out=this.SymbolData.GetLatestCacheData(s[0]);break;case"STICKLINE":t.Draw=this.Draw.STICKLINE(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"DRAWTEXT":t.Draw=this.Draw.DRAWTEXT(s[0],s[1],s[2]),t.Out=[];break;case"DRAWTEXT_FIX":t.Draw=this.Draw.DRAWTEXT_FIX(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"SUPERDRAWTEXT":t.Draw=this.Draw.SUPERDRAWTEXT(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"DRAWICON":t.Draw=this.Draw.DRAWICON(s[0],s[1],s[2]),t.Out=[];break;case"ICON":t.Draw=this.Draw.ICON(s[0],s[1]),t.Out=[];break;case"TIPICON":t.Draw=this.Draw.TIPICON(s[0],s[1],s[2],s[3]),t.Out=[];break;case"BACKGROUND":t.Draw=this.Draw.BACKGROUND(s[0],s[1],s[2],s[3],s[4],s[5]),t.Out=[];break;case"CKLINE":t.Draw=this.Draw.CKLINE(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"DRAWLINE":t.Draw=this.Draw.DRAWLINE(s[0],s[1],s[2],s[3],s[4]),t.Out=t.Draw.DrawData;break;case"DRAWBAND":t.Draw=this.Draw.DRAWBAND(s[0],s[1],s[2],s[3]),t.Out=[];break;case"FILLRGN":s.length>=4?t.Draw=this.Draw.FILLRGN2(s):t.Draw=this.Draw.FILLRGN(s[0],s[1],s[2]),t.Out=[];break;case"FLOATRGN":t.Draw=this.Draw.FLOATRGN(s),t.Out=[];break;case"FILLTOPRGN":t.Draw=this.Draw.FILLBGRGN(1,s),t.Out=[];break;case"FILLBOTTOMRGN":t.Draw=this.Draw.FILLBGRGN(0,s),t.Out=[];break;case"FILLVERTICALRGN":t.Draw=this.Draw.FILLVERTICALRGN(s),t.Out=[];break;case"DRAWKLINE":case"DRAWKLINE1":t.Draw=this.Draw.DRAWKLINE(s[0],s[1],s[2],s[3]),t.Out=[];break;case"DRAWKLINE_IF":t.Draw=this.Draw.DRAWKLINE_IF(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"KLINETYPE":t.Out=this.Draw.KLINETYPE(s[0]);break;case"DRAWOVERLAYKLINE":t.Draw=this.Draw.DRAWOVERLAYKLINE(s[0],s[1],s[2],s[3]),t.Out=[];break;case"DRAWCOLORKLINE":t.Draw=this.Draw.DRAWCOLORKLINE(s[0],s[1],s[2]),t.Out=[];break;case"PLOYLINE":case"POLYLINE":t.Draw=this.Draw.POLYLINE(s[0],s[1]),t.Out=t.Draw.DrawData;break;case"DRAWNUMBER":t.Draw=this.Draw.DRAWNUMBER(s[0],s[1],s[2],s[3]),t.Out=t.Draw.DrawData.Value;break;case"DRAWNUMBER_FIX":t.Draw=this.Draw.DRAWNUMBER_FIX(s[0],s[1],s[2],s[3],s[4]),t.Out=t.Draw.DrawData.Value;break;case"DRAWCHANNEL":t.Draw=this.Draw.DRAWCHANNEL(s[0],s[1],s[2],s[3],s[4],s[5],s[6]),t.Out=[];break;case"RGB":t.Out=this.Draw.RGB(s[0],s[1],s[2]);break;case"RGBA":t.Out=this.Draw.RGBA(s[0],s[1],s[2],s[3]);break;case"UPCOLOR":t.Out=this.Draw.UPCOLOR(s[0]);break;case"DOWNCOLOR":t.Out=this.Draw.DOWNCOLOR(s[0]);break;case"STICKTYPE":t.Out=this.Draw.STICKTYPE(s[0]);break;case"XMOVE":t.Out=this.Draw.XMOVE(s[0]);break;case"YMOVE":t.Out=this.Draw.YMOVE(s[0]);break;case"LINEDASH":t.Out=this.Draw.LINEDASH(s);break;case"FIRSTDRAW":t.Out=this.Draw.FIRSTDRAW(s[0]);break;case"PARTLINE":t.Draw=this.Draw.PARTLINE(s),t.Out=[];break;case"DRAWGBK":t.Draw=this.Draw.DRAWGBK(s[0],s[1],s[2],s[3]),t.Out=[];break;case"DRAWGBK2":t.Draw=this.Draw.DRAWGBK2(s[0],s[1],s[2],s[3]),t.Out=[];break;case"DRAWGBK_DIV":t.Draw=this.Draw.DRAWGBK_DIV(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"DRAWTEXT_LINE":t.Draw=this.Draw.DRAWTEXT_LINE(s[0],s[1],s[2],s[3],s[4],s[5],s[6]),t.Out=[];break;case"DRAWRECTREL":t.Draw=this.Draw.DRAWRECTREL(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"DRAWTEXTREL":t.Draw=this.Draw.DRAWTEXTREL(s[0],s[1],s[2]),t.Out=[];break;case"DRAWTEXTABS":t.Draw=this.Draw.DRAWTEXTABS(s[0],s[1],s[2]),t.Out=[];break;case"DRAWOVERLAYLINE":t.Draw=this.Draw.DRAWOVERLAYLINE(s[0],s[1],s[2]),t.Out=t.Draw.DrawData.Data;break;case"DRAWSL":t.Draw=this.Draw.DRAWSL(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"VERTLINE":t.Draw=this.Draw.VERTLINE(s[0],s[1]),t.Out=t.Draw.DrawData.Data;break;case"HORLINE":t.Draw=this.Draw.HORLINE(s[0],s[1],s[2],s[3]),t.Out=t.Draw.DrawData.Data;break;case"DRAWLASTBARICON":t.Draw=this.Draw.DRAWLASTBARICON(s[0],s[1]),t.Out=[];break;case"DRAWLASTBARNUMBER":t.Draw=this.Draw.DRAWLASTBARNUMBER(s[0],s[1],s[2],s[3]),t.Out=[];break;case"DRAWLASTBARTEXT":t.Draw=this.Draw.DRAWLASTBARTEXT(s[0],s[1]),t.Out=[];break;case"CODELIKE":t.Out=this.SymbolData.CODELIKE(s[0]);break;case"NAMELIKE":case"NAMEINCLUDE":t.Out=this.SymbolData.NAMELIKE(s[1]);break;case"REFDATE":t.Out=this.SymbolData.REFDATE(s[0],s[1]);break;case"FINANCE":t.Out=this.SymbolData.GetStockCacheData({FunctionName:n,Args:s,ArgCount:1,Node:t});break;case"FINVALUE":t.Out=this.SymbolData.GetStockCacheData({FunctionName:n,Args:s,ArgCount:1,Node:t});break;case"FINONE":t.Out=this.SymbolData.GetStockCacheData({FunctionName:n,Args:s,ArgCount:3,Node:t});break;case"GPJYVALUE":case"SCJYVALUE":case"BKJYVALUE":t.Out=this.SymbolData.GetStockCacheData({FunctionName:n,Args:s,ArgCount:3,Node:t});break;case"GPJYONE":case"SCJYONE":case"BKJYONE":t.Out=this.SymbolData.GetStockCacheData({FunctionName:n,Args:s,ArgCount:4,Node:t});break;case"MARGIN":t.Out=this.SymbolData.GetMarginCacheData(s[0],t);break;case"HK2SHSZ":t.Out=this.SymbolData.GetHKToSHSZCacheData(s[0],t);break;case"NEWS":t.Out=this.SymbolData.GetNewsAnalysisCacheData(s[0],t);break;case"UPCOUNT":case"DOWNCOUNT":t.Out=this.SymbolData.GetIndexIncreaseCacheData(n,s[0],t);break;case"SF":t.Out=this.SymbolData.GetSectionFinanceCacheData(s[0],s[1],s[2],t);break;case"LOADAPIDATA":t.Out=this.SymbolData.GetCustomApiData(s);break;case"STKINDI":case"CALCSTOCKINDEX":t.Out=this.SymbolData.GetScriptIndexOutData(s,t,n);break;case"SOUND":t.Draw=this.Draw.SOUND(s[0]),t.Out=[];break;case"PLAYSOUND":t.Draw=this.Draw.PLAYSOUND(s[0],s[1]),t.Out=[];break;case"CLOSE":case"C":case"VOL":case"V":case"OPEN":case"O":case"HIGH":case"H":case"LOW":case"L":case"AMOUNT":case"AMO":t.Out=this.SymbolData.GetOtherSymolCacheData({FunctionName:n,Args:s});break;case"INBLOCK":t.Out=this.SymbolData.IsInBlock(s[0],t);break;case"COVER_C":case"COVER_O":case"COVER_H":case"COVER_L":case"COVER_A":case"COVER_V":return s.length==2?this.SymbolData.GetSymbolPeriodCacheData2(za.GetConvertValueName(n),s[0],s[1]):this.SymbolData.GetSymbolPeriodCacheData(za.GetConvertValueName(n),s[0]);case"SYSPARAM":t.Out=this.SymbolData.SysParam(s[0],this);break;case"TESTSKIP":var D=this.Algorithm.TESTSKIP(s[0],t);if(t.Out=null,D&&(this.Interrupt.Exit=!0,t&&t.Marker)){var c=t.Marker;this.Interrupt.Line=c.Line,this.Interrupt.Index=c.Index,this.Interrupt.Column=c.Column}break;case"BUY":t.Draw=this.Draw.BUY(s[0],s[1],s[2],s[3]),t.Out=t.Draw.DrawData.Data;break;case"SELL":t.Draw=this.Draw.SELL(s[0],s[1],s[2],s[3]),t.Out=t.Draw.DrawData.Data;break;case"SELLSHORT":t.Draw=this.Draw.SELLSHORT(s[0],s[1],s[2],s[3]),t.Out=t.Draw.DrawData.Data;break;case"BUYSHORT":t.Draw=this.Draw.BUYSHORT(s[0],s[1],s[2],s[3]),t.Out=t.Draw.DrawData.Data;break;default:t.Out=this.Algorithm.CallFunction(n,s,t,this.SymbolData);break}return t.Out},this.VisitAssignmentExpression=function(t){var n=t.Left;n.Type!=ut.Identifier&&this.ThrowUnexpectedNode(t);var s=n.Name,o=t.Right,l=null,h=null;o.Type==ut.BinaryExpression||o.Type==ut.LogicalExpression?l=this.VisitBinaryExpression(o):o.Type==ut.CallExpression?(l=this.VisitCallExpression(o),o.Draw&&(h=o.Draw)):o.Type==ut.Literal?(l=o.Value,v.IsString(l)&&o.Value.indexOf("$")>0&&(l=this.SymbolData.GetOtherSymolCacheData({Literal:l}))):o.Type==ut.Identifier?l=this.ReadVariable(o.Name,o):o.Type==ut.MemberExpression?l=this.ReadMemberVariable(o):o.Type==ut.UnaryExpression&&(l=this.VisitUnaryExpression(o)),h&&this.VarDrawTable.set(s,h),this.VarTable.set(s,l)},this.VisitBinaryExpression=function(t){var n=[];n.push(t);for(var s=null;n.length!=0;)if(s=n[n.length-1],s.Left&&t!=s.Left&&t!=s.Right)n.push(s.Left);else if(s.Right&&t!=s.Right)n.push(s.Right);else{var o=n.pop();if(o.Type==ut.BinaryExpression){var l=this.GetNodeValue(o.Left),h=this.GetNodeValue(o.Right);switch(o.Out=null,o.Operator){case"-":o.Out=this.Algorithm.Subtract(l,h);break;case"*":o.Out=this.Algorithm.Multiply(l,h);break;case"/":o.Out=this.Algorithm.Divide(l,h);break;case"+":o.Out=this.Algorithm.Add(l,h);break;case">":o.Out=this.Algorithm.GT(l,h);break;case">=":o.Out=this.Algorithm.GTE(l,h);break;case"<":o.Out=this.Algorithm.LT(l,h);break;case"<=":o.Out=this.Algorithm.LTE(l,h);break;case"==":case"=":o.Out=this.Algorithm.EQ(l,h);break;case"!=":case"<>":o.Out=this.Algorithm.NEQ(l,h);break}}else if(o.Type==ut.LogicalExpression){var u=this.GetNodeValue(o.Left),f=this.GetNodeValue(o.Right);switch(o.Out=null,o.Operator){case"&&":case"AND":o.Out=this.Algorithm.And(u,f);break;case"||":case"OR":o.Out=this.Algorithm.Or(u,f);break}}t=s}return t.Out},this.GetNodeValueEx=function(t){var n=null;return t.Type==ut.BinaryExpression||t.Type==ut.LogicalExpression?n=this.VisitBinaryExpression(t):t.Type==ut.CallExpression?n=this.VisitCallExpression(t):n=this.GetNodeValue(t),n},this.GetNodeValue=function(t){switch(t.Type){case ut.Literal:return t.Value;case ut.UnaryExpression:var n=this.VisitUnaryExpression(t);return n;case ut.Identifier:var n=this.ReadVariable(t.Name,t);return n;case ut.BinaryExpression:case ut.LogicalExpression:return t.Out;case ut.CallExpression:return this.VisitCallExpression(t);case ut.MemberExpression:return this.ReadMemberVariable(t);default:this.ThrowUnexpectedNode(t)}},this.ThrowUnexpectedNode=function(t,n,s){var o=t.Marker,l=n||"执行异常";return this.ErrorHandler.ThrowError(o.Index,o.Line,o.Column,l,s)},this.ThrowDownloadSF=function(t,n,s){var o=t.Marker,l=s;return this.ErrorHandler.ThrowDownloadJob(o.Index,o.Line,o.Column,l,n)},this.ThrowError=function(){}}function ag(e,a){this.AST=e,this.ErrorHandler=new bn,this.ErrorCallback,this.UpdateUICallback,this.CallbackParam,this.JobList=[],this.VarTable=new Dt.default,this.OutVarTable=[],this.MaxValueLength=150,this.ConstVarTable=new Dt.default([["CLOSE","收盘价"],["VOL","成交量"],["OPEN","开盘价"],["HIGH","最高价"],["LOW","最低价"],["AMOUNT","成交量"],["C","收盘价"],["V","成交量"],["O","开盘价"],["H","最高价"],["L","最低价"],["AMO","成交量"],["VOLR","量比"],["VOLINSTK","持仓量"],["OPI","持仓量"],["ZSTJJ","均价"],["QHJSJ","结算价"],["SETTLE","结算价"],["DATE","日期"],["YEAR","年份"],["MONTH","月份"],["DAY","日"],["PERIOD","周期"],["WEEK","星期"],["TIME","时间"],["INDEXA","大盘成交额"],["INDEXC","大盘收盘价"],["INDEXH","大盘最高价"],["INDEXL","大盘最低价"],["INDEXO","大盘开盘价"],["INDEXV","大盘成交量"],["INDEXADV","大盘上涨家数"],["INDEXDEC","´大盘下跌家数"],["ADVANCE","上涨家数"],["DECLINE","下跌家数"],["FROMOPEN","当前离开盘分钟数"],["TOTALFZNUM","总分钟数"],["CURRBARSCOUNT","到最后交易的周期"],["TOTALBARSCOUNT","总的周期数"],["ISLASTBAR","是否是最后一个周期"],["BARSTATUS","数据位置状态"],["CAPITAL","当前流通股本(手)"],["TOTALCAPITAL","当前总股本(手)"],["EXCHANGE","换手率"],["SETCODE","市场类型"],["CODE","品种代码"],["STKNAME","品种名称"],["TQFLAG","当前复权状态"],["HYBLOCK","所属行业"],["DYBLOCK","所属地域"],["GNBLOCK","所属概念"],["FGBLOCK","所属风格板块"],["ZSBLOCK","所属指数板块"],["ZHBLOCK","所属组合板块"],["ZDBLOCK","所属自定义板块"],["HYZSCODE","所属行业的板块指数代码"],["GNBLOCKNUM","所属概念板块的个数"],["FGBLOCKNUM","所属风格板块的个数"],["ZSBLOCKNUM","所属指数板块的个数"],["ZHBLOCKNUM","所属组合板块的个数"],["ZDBLOCKNUM","所属自定义板块的个数"],["HYSYL","指数市盈率或个股所属行业的市盈率"],["HYSJL","指数市净率或个股所属行业的市净率"],["DRAWNULL","无效数据"],["TR","求真实波幅"],["LARGEINTRDVOL","逐笔买入大单成交量"],["LARGEOUTTRDVOL","逐笔卖出大单成交量"],["TRADENUM","逐笔成交总单数"],["TRADEINNUM","逐笔买入成交单数"],["TRADEOUTNUM","逐笔卖出成交单数"],["LARGETRDINNUM","逐笔买入大单成交单数"],["LARGETRDOUTNUM","逐笔卖出大单成交单数"],["CUR_BUYORDER","总委买量"],["CUR_SELLORDER","总委卖量"],["ACTINVOL","主动买成交量"],["ACTOUTVOL","主动卖成交量"],["BIDORDERVOL","累计总有效委买量"],["BIDCANCELVOL","累计总有效撤买量"],["AVGBIDPX","最新委买均价"],["OFFERORDERVOL","累计总有效委卖量"],["OFFERCANCELVOL","累计总有效撤卖量"],["AVGOFFERPX","最新委卖均价"],["COLORBLACK","黑色"],["COLORBLUE","蓝色"],["COLORGREEN","绿色"],["COLORCYAN","青色"],["COLORRED","红色"],["COLORMAGENTA","洋红色"],["COLORBROWN","棕色"],["COLORLIGRAY","淡灰色"],["COLORGRAY","深灰色"],["COLORLIBLUE","淡蓝色"],["COLORLIGREEN","淡绿色"],["COLORLICYAN","淡青色"],["COLORLIRED","淡红色"],["COLORLIMAGENTA","淡洋红色"],["COLORWHITE","白色"],["COLORYELLOW","黄色"]]),a&&(a.Callback&&(this.UpdateUICallback=a.Callback),a.CallbackParam&&(this.CallbackParam=a.CallbackParam),a.Arguments&&(this.Arguments=a.Arguments)),this.Run=function(){try{this.OutVarTable=[],this.VarTable=new Dt.default,k.Complier.Log("[JSExecute::JSExplainer] Load Arguments",this.Arguments);for(var r in this.Arguments){var t=this.Arguments[r];this.VarTable.set(t.Name,t.Value)}var n=this.RunAST();k.Complier.Log("[JSExplainer.Run] explain finish",n),this.UpdateUICallback&&(k.Complier.Log("[JSExplainer.Run] invoke UpdateUICallback."),this.UpdateUICallback(n))}catch(s){k.Complier.Log("[JSExplainer.Run] throw error ",s),this.ErrorCallback&&this.ErrorCallback(s,this.OutVarTable)}},this.RunAST=function(){this.AST||this.ThrowError(),this.AST.Body||this.ThrowError();for(var r=0;r<this.AST.Body.length;++r){var t=this.AST.Body[r];if(this.VisitNode(t),t.Type==ut.ExpressionStatement&&t.Expression){if(t.Expression.Type==ut.AssignmentExpression){if(t.Expression.Operator==":"&&t.Expression.Left){var n=t.Expression,s=n.Left.Name,o="输出"+s+": "+this.VarTable.get(s);this.OutVarTable.push({Name:s,Data:o,Type:0})}else if(t.Expression.Operator==":="&&t.Expression.Left){var l=t.Expression,h=l.Left.Name,u="赋值"+h+": "+this.VarTable.get(h);this.OutVarTable.push({Name:h,Data:u,Type:0,IsOut:!1})}}else if(t.Expression.Type==ut.CallExpression){var f=t.Expression;if(this.IsDrawFunction(f.Callee.Name)){var C=f.Out,D=f.Callee.Name;this.OutVarTable.push({Name:D,Draw:"输出: "+C,Type:1})}else{var c=f.Out;g="__temp_c_"+f.Callee.Name+"_"+r+"__",this.OutVarTable.push({Name:g,Data:"输出: "+c,Type:0,NoneName:!0})}}else if(t.Expression.Type==ut.Identifier){var T=t.Expression.Name,S=this.ReadVariable(T,t.Expression);T="__temp_i_"+r+"__",this.OutVarTable.push({Name:T,Data:"输出: "+S,Type:0,NoneName:!0})}else if(t.Expression.Type==ut.Literal){var I=t.Expression.Value;v.IsString(I)&&I.indexOf("$")>0&&(I=this.GetOtherSymbolExplain({Literal:I},t)),g="__temp_li_"+r+"__",this.OutVarTable.push({Name:g,Data:"输出: "+I,Type:0,NoneName:!0})}else if(t.Expression.Type==ut.BinaryExpression){var g="__temp_b_"+r+"__",E=t.Expression.Out;this.OutVarTable.push({Name:g,Data:"输出: "+E,Type:0,NoneName:!0})}else if(t.Expression.Type==ut.LogicalExpression){var g="__temp_l_"+r+"__",F=t.Expression.Out;this.OutVarTable.push({Name:g,Data:"输出: "+F,Type:0,NoneName:!0})}else if(t.Expression.Type==ut.UnaryExpression){var g="__temp_l_"+r+"__",R=t.Expression.Argument,A=null;if(R.Type==ut.Literal)A=R.Value;else if(R.Type==ut.Identifier){var P=R.Name;A=this.ReadVariable(P,t.Expression)}else R.Type==ut.BinaryExpression&&(A=R.Out);t.Expression.Operator=="-"&&(A="-"+A),this.OutVarTable.push({Name:g,Data:"输出: "+A,Type:0,NoneName:!0})}else if(t.Expression.Type==ut.SequenceExpression){var p=void 0,w=void 0,H=void 0,W=void 0,ht=void 0,rt=!1,nt=!1,vt=!1,Nt=!1,Ft=!1,Bt=!1,Jt=!0,te=!1,Me=!1,we=!1;for(var Oa in t.Expression.Expression){var It=t.Expression.Expression[Oa];if(It.Type==ut.AssignmentExpression&&It.Operator==":"&&It.Left){p=It.Left.Name;var bt=this.VarTable.get(p);this.VarTable.set(p,this.ConvertToShortValue(bt))}else if(It.Type==ut.Identifier){var xt=It.Name;if(xt==="COLORSTICK")rt=!0;else if(xt==="POINTDOT")nt=!0;else if(xt==="CIRCLEDOT")vt=!0;else if(xt==="DOTLINE")te=!0;else if(xt==="LINESTICK")Nt=!0;else if(xt==="STICK")Ft=!0;else if(xt==="VOLSTICK")Bt=!0;else if(xt==="DRAWABOVE")we=!0;else if(xt.indexOf("COLOR")==0)W=xt;else if(xt.indexOf("LINETHICK")==0)ht=xt;else if(xt!="ALIGN0"){if(xt!="ALIGN1"){if(xt!="ALIGN2"){if(xt!="VALIGN0"){if(xt!="VALIGN1"){if(xt!="VALIGN2"){if(xt.indexOf("NODRAW")==0)Jt=!1;else if(xt.indexOf("EXDATA")!=0){if(xt.indexOf("LINEOVERLAY")!=0)if(xt.indexOf("FONTSIZE")==0)xt.replace("FONTSIZE","");else{p=It.Name;var qt=this.ReadVariable(p,It);p="__temp_si_"+r+"__",Me=!0,this.VarTable.set(p,this.ConvertToShortValue(qt))}}}}}}}}}else if(It.Type==ut.Literal){var ge=It.Value;p=It.Value.toString(),Me=!0,this.VarTable.set(p,ge)}else if(It.Type==ut.CallExpression){if(Oa==0)if(this.IsDrawFunction(It.Callee.Name))H=It.Out,w=It.Callee.Name;else{var me=It.Out;p="__temp_sc_"+It.Callee.Name+"_"+r+"__",Me=!0,this.VarTable.set(p,me)}}else if(It.Type==ut.BinaryExpression){p="__temp_sb_"+r+"__";var ha=It.Out;Me=!0,this.VarTable.set(p,ha)}else if(It.Type==ut.UnaryExpression){p="__temp_sb_"+r+"__";var R=It.Argument,Oe=null;if(R.Type==ut.Literal)Oe=R.Value;else if(R.Type==ut.Identifier){var Ni=R.Name;Oe=this.ReadVariable(Ni,t.Expression)}else R.Type==ut.BinaryExpression&&(Oe=R.Out);It.Operator=="-"&&(Oe="-"+Oe),Me=!0,this.VarTable.set(p,Oe)}}var Te;if(H?Te="输出: "+H:Me?Te="输出: "+this.VarTable.get(p):Te="输出"+p+": "+this.VarTable.get(p),W&&(Te+=",颜色"+this.GetColorExplain(W)),ht&&(Te+=",线段粗细"+this.GetLineWidthExplain(ht)),Jt==!1&&(Te+=",不显示"),te==!0&&(Te+=",画虚线"),we==!0&&(Te+=",显示在位置之上"),nt&&p){Te+=",画小圆点线";var Ci={Name:p,Draw:Te,Radius:d.POINTDOT.Radius,Type:3};this.OutVarTable.push(Ci)}else if(vt&&p){Te+=",画小圆圈线";var ja={Name:p,Draw:Te,Radius:d.CIRCLEDOT.Radius,Type:3};this.OutVarTable.push(ja)}else if(Nt&&p){Te+=",画出柱状线和指标线";var Di={Name:p,Draw:Te,Type:4};this.OutVarTable.push(Di)}else if(Ft&&p){Te+=",画柱状线";var vi={Name:p,Draw:Te,Type:5};this.OutVarTable.push(vi)}else if(Bt&&p){Te+=",画成交量柱状线";var ti={Name:p,Draw:Te,Type:6};this.OutVarTable.push(ti)}else if(p&&W){var la={Name:p,Data:Te,Color:W,Type:0};this.OutVarTable.push(la)}else if(H){var Ai={Name:w,Draw:Te,Type:1};this.OutVarTable.push(Ai)}else if(rt&&p){Te+=",画彩色柱状线";var Zi={Name:p,Draw:Te,Color:W,Type:2};this.OutVarTable.push(Zi)}else if(p){var Qi={Name:p,Data:Te,Type:0};this.OutVarTable.push(Qi)}}}}return k.Complier.Log("[JSExplainer::Run]",this.VarTable),this.OutVarTable},this.VisitNode=function(r){switch(r.Type){case ut.SequenceExpression:this.VisitSequenceExpression(r);break;case ut.ExpressionStatement:this.VisitNode(r.Expression);break;case ut.AssignmentExpression:this.VisitAssignmentExpression(r);break;case ut.BinaryExpression:case ut.LogicalExpression:this.VisitBinaryExpression(r);break;case ut.CallExpression:this.VisitCallExpression(r);break;case ut.UnaryExpression:this.VisitUnaryExpression(r);break}},this.VisitSequenceExpression=function(r){for(var t in r.Expression){var n=r.Expression[t];this.VisitNode(n)}},this.VisitUnaryExpression=function(r){if(r.Operator=="-"){var t=this.GetNodeValueEx(r.Argument);return"-"+t}return r.Argument.Value},this.VisitCallExpression=function(r){var t=r.Callee.Name,n=[];for(var s in r.Arguments){var o=r.Arguments[s],l=void 0;o.Type==ut.BinaryExpression||o.Type==ut.LogicalExpression?l=this.VisitBinaryExpression(o):o.Type==ut.CallExpression?l=this.VisitCallExpression(o):l=this.GetNodeValue(o),n.push(l)}if(r.Callee.Type==ut.Literal){var h=r.Callee.Value;return r.Out="指标引用'"+h+"'",r.Out}if(Yt.IsCustomFunction(t)){var u=Yt.CustomFunction.Data.get(t);return u.Description?r.Out=u.Description:r.Out="自定义函数"+t,r.Out}return r.Out=this.CallFunctionExplain(t,n,r),r.Out},this.FUNCTION_INFO_LIST=new Dt.default([["REF",{Name:"REF",Param:{Count:2},ToString:function(t){return t[1]+"日前的"+t[0]}}],["REFX",{Name:"REFX",Param:{Count:2},ToString:function(t){return t[1]+"日后的"+t[0]}}],["REFV",{Name:"REFV",Param:{Count:2},ToString:function(t){return t[1]+"日前的(未作平滑处理)"+t[0]}}],["REFXV",{Name:"REFXV",Param:{Count:2},ToString:function(t){return t[1]+"日后的(未作平滑处理)"+t[0]}}],["REFDATE",{Name:"REFDATE",Param:{Count:2},ToString:function(t){return t[1]+"日"+t[0]}}],["COUNT",{Name:"COUNT",Param:{Count:2},ToString:function(t){return"统计"+t[1]+"日中满足"+t[0]+"的天数"}}],["BARSLASTCOUNT",{Name:"BARSLASTCOUNT",Param:{Count:1},ToString:function(t){return"条件"+t[0]+"连续成立次数"}}],["BARSCOUNT",{Name:"BARSCOUNT",Param:{Count:1},ToString:function(t){return t[0]+"有效数据周期数"}}],["BARSLAST",{Name:"BARSLAST",Param:{Count:1},ToString:function(t){return"上次"+t[0]+"不为0距今天数"}}],["BARSLASTS",{Name:"BARSLASTS",Param:{Count:2},ToString:function(t){return"倒数第N次成立时距今的周期数"}}],["BARSNEXT",{Name:"BARSNEXT",Param:{Count:1},ToString:function(t){return"下次"+t[0]+"不为0距今天数"}}],["BARSSINCEN",{Name:"BARSSINCEN",Param:{Count:2},ToString:function(t){return"在"+t[1]+"周期内首次"+t[0]+"距今天数"}}],["BARSSINCE",{Name:"BARSSINCE",Param:{Count:1},ToString:function(t){return"首次"+t[0]+"距今天数"}}],["HHV",{Name:"HHV",Param:{Count:2},ToString:function(t){return t[1]+"日内"+t[0]+"的最高值"}}],["LLV",{Name:"LLV",Param:{Count:2},ToString:function(t){return t[1]+"日内"+t[0]+"的最低值"}}],["ZTPRICE",{Name:"ZTPRICE",Param:{Count:2},ToString:function(t){return"计算涨停价"}}],["DTPRICE",{Name:"DTPRICE",Param:{Count:2},ToString:function(t){return"计算跌停价"}}],["BACKSET",{Name:"BACKSET",Param:{Count:2},ToString:function(t){return"若"+t[0]+"则将最近"+t[1]+"周期置为1"}}],["HOD",{Name:"HOD",Param:{Count:2},ToString:function(t){return t[1]+"日内"+t[0]+"的高值名次"}}],["LOD",{Name:"LOD",Param:{Count:2},ToString:function(t){return t[1]+"日内"+t[0]+"的低值名次"}}],["REVERSE",{Name:"REVERSE",Param:{Count:1},ToString:function(t){return t[0]+"的相反数"}}],["FILTER",{Name:"FILTER",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日过滤"}}],["FILTERX",{Name:"FILTERX",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日反向过滤"}}],["TFILTER",{Name:"TFILTER",Param:{Count:3},ToString:function(t){return"信号过滤(多头)"}}],["SUMBARS",{Name:"SUMBARS",Param:{Count:2},ToString:function(t){return t[0]+"累加至"+t[1]+"的天数"}}],["MA",{Name:"MA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日简单移动平均"}}],["SMA",{Name:"SMA",Param:{Count:3},ToString:function(t){return t[0]+"的"+t[1]+"日["+t[2]+"日权重]移动平均"}}],["MEMA",{Name:"MEMA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日平滑移动平均"}}],["EMA",{Name:"EMA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日指数移动平均"}}],["EXPMA",{Name:"EXPMA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日指数移动平均"}}],["EXPMEMA",{Name:"EXPMEMA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日指数平滑移动平均"}}],["WMA",{Name:"WMA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日加权移动平均"}}],["DMA",{Name:"DMA",Param:{Count:2},ToString:function(t){return"以"+t[1]+"为权重"+t[0]+"的动态移动平均"}}],["XMA",{Name:"XMA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日偏移移动平均"}}],["RANGE",{Name:"RANGE",Param:{Count:3},ToString:function(t){return t[0]+"位于"+t[1]+"和"+t[2]+"之间"}}],["CONST",{Name:"CONST",Param:{Count:1},ToString:function(t){return t[0]+"的最后一日值"}}],["TOPRANGE",{Name:"TOPRANGE",Param:{Count:1},ToString:function(t){return"当前值是近"+t[0]+"周期的最大值"}}],["LOWRANGE",{Name:"LOWRANGE",Param:{Count:1},ToString:function(t){return"当前值是近"+t[0]+"周期的最小值"}}],["FINDHIGH",{Name:"FINDHIGH",Param:{Count:4},ToString:function(t){return t[0]+"在"+t[1]+"日前的"+t[2]+"天内第"+t[3]+"个最高价"}}],["FINDHIGHBARS",{Name:"FINDHIGHBARS",Param:{Count:4},ToString:function(t){return t[0]+"在"+t[1]+"日前的"+t[2]+"天内第"+t[3]+"个最高价到当前周期的周期数"}}],["FINDLOW",{Name:"FINDLOW",Param:{Count:4},ToString:function(t){return t[0]+"在"+t[1]+"日前的"+t[2]+"天内第"+t[3]+"个最低价"}}],["FINDLOWBARS",{Name:"FINDLOWBARS",Param:{Count:2},ToString:function(t){return t[0]+"在"+t[1]+"日前的"+t[2]+"天内第"+t[3]+"个最低价到当前周期的周期数"}}],["SUM",{Name:"SUM",Param:{Count:2},ToString:function(t){return""+t[0]+t[1]+"日累加"}}],["MULAR",{Name:"MULAR",Param:{Count:2},ToString:function(t){return t[0]+"和"+t[1]+"日累乘"}}],["AMA",{Name:"AMA",Param:{Count:2},ToString:function(t){return"以"+t[1]+"为权重"+t[0]+"的自适应均线"}}],["TMA",{Name:"TMA",Param:{Count:3},ToString:function(t){return t[0]+"的"+t[1]+"日["+t[2]+"日权重]移动平均"}}],["CROSS",{Name:"CROSS",Param:{Count:2},ToString:function(t){return t[0]+"上穿"+t[1]}}],["LONGCROSS",{Name:"LONGCROSS",Param:{Count:3},ToString:function(t){return t[0]+"小于"+t[1]+"保持"+t[2]+"个交易日后交叉上穿"}}],["UPNDAY",{Name:"UPNDAY",Param:{Count:2},ToString:function(t){return"最近"+t[1]+"日"+t[0]+"连涨"}}],["DOWNNDAY",{Name:"DOWNNDAY",Param:{Count:2},ToString:function(t){return"最近"+t[1]+"日"+t[0]+"连跌"}}],["NDAY",{Name:"NDAY",Param:{Count:3},ToString:function(t){return"最近"+t[2]+"日"+t[0]+"一直大于"+t[1]}}],["EXIST",{Name:"EXIST",Param:{Count:2},ToString:function(t){return"最近"+t[1]+"日存在"+t[0]}}],["EXISTR",{Name:"EXISTR",Param:{Count:3},ToString:function(t){return"从前"+t[1]+"日到前"+t[2]+"日存在"+t[0]}}],["EVERY",{Name:"EVERY",Param:{Count:2},ToString:function(t){return"最近"+t[1]+"日一直存在"+t[0]}}],["LAST",{Name:"LAST",Param:{Count:3},ToString:function(t){return"从前"+t[1]+"日到前"+t[2]+"日持续"+t[0]}}],["NOT",{Name:"NOT",Param:{Count:1},ToString:function(t){return t[0]+"取反"}}],["IF",{Name:"IF",Param:{Count:3},ToString:function(t){return"如果"+t[0]+",返回"+t[1]+",否则返回"+t[2]}}],["IFF",{Name:"IFF",Param:{Count:3},ToString:function(t){return"如果"+t[0]+",返回"+t[1]+",否则返回"+t[2]}}],["IFN",{Name:"IFN",Param:{Count:3},ToString:function(t){return"如果"+t[0]+",返回"+t[1]+",否则返回"+t[2]}}],["IFC",{Name:"IFC",Param:{Count:3},ToString:function(t){return"如果"+t[0]+",返回"+t[1]+",否则返回"+t[2]}}],["TESTSKIP",{Name:"TESTSKIP",Param:{Count:1},ToString:function(t){return"如果满足条件"+t[0]+",公式返回"}}],["VALUEWHEN",{Name:"VALUEWHEN",Param:{Count:2},ToString:function(t){return"如果"+t[0]+",返回"+t[1]+",否则返回上个输出值 "}}],["MAX",{Name:"MAX",Param:{Count:2},ToString:function(t){return t[0]+"和"+t[1]+"的较大值"}}],["MIN",{Name:"MIN",Param:{Count:2},ToString:function(t){return t[0]+"和"+t[1]+"的较小值"}}],["ACOS",{Name:"ACOS",Param:{Count:1},ToString:function(t){return t[0]+"的反余弦"}}],["ASIN",{Name:"ASIN",Param:{Count:1},ToString:function(t){return t[0]+"的反正弦"}}],["ATAN",{Name:"ATAN",Param:{Count:1},ToString:function(t){return t[0]+"的反正切"}}],["COS",{Name:"COS",Param:{Count:1},ToString:function(t){return t[0]+"的余弦"}}],["SIN",{Name:"SIN",Param:{Count:1},ToString:function(t){return t[0]+"的正弦"}}],["TAN",{Name:"TAN",Param:{Count:1},ToString:function(t){return t[0]+"的正切"}}],["EXP",{Name:"EXP",Param:{Count:1},ToString:function(t){return t[0]+"的指数"}}],["LN",{Name:"LN",Param:{Count:1},ToString:function(t){return t[0]+"的自然对数"}}],["LOG",{Name:"LOG",Param:{Count:1},ToString:function(t){return t[0]+"的对数"}}],["SQRT",{Name:"SQRT",Param:{Count:1},ToString:function(t){return t[0]+"的开方"}}],["ABS",{Name:"ABS",Param:{Count:1},ToString:function(t){return t[0]+"的绝对值"}}],["POW",{Name:"POW",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"乘幂"}}],["CEILING",{Name:"CEILING",Param:{Count:1},ToString:function(t){return t[0]+"的向上舍入"}}],["FLOOR",{Name:"FLOOR",Param:{Count:1},ToString:function(t){return t[0]+"的向上舍入"}}],["INTPART",{Name:"INTPART",Param:{Count:1},ToString:function(t){return t[0]+"的整数部分"}}],["BETWEEN",{Name:"BETWEEN",Param:{Count:3},ToString:function(t){return t[0]+"位于"+t[1]+"和"+t[2]+"之间"}}],["FRACPART",{Name:"FRACPART",Param:{Count:1},ToString:function(t){return t[0]+"的小数部分"}}],["ROUND",{Name:"ROUND",Param:{Count:1},ToString:function(t){return"对"+t[0]+"(进行)四舍五入"}}],["ROUND2",{Name:"ROUND2",Param:{Count:2},ToString:function(t){return"对"+t[0]+"(进行)四舍五入"}}],["SIGN",{Name:"SIGN",Param:{Count:1},ToString:function(t){return t[0]+"的符号"}}],["MOD",{Name:"MOD",Param:{Count:2},ToString:function(t){return t[0]+"关于"+t[1]+"的模"}}],["RAND",{Name:"RAND",Param:{Count:1},ToString:function(t){return"随机正整数"}}],["AVEDEV",{Name:"AVEDEV",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日平均绝对偏差"}}],["DEVSQ",{Name:"DEVSQ",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日数据偏差平方和"}}],["FORCAST",{Name:"FORCAST",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日线性回归预测值"}}],["TSMA",{Name:"TSMA",Param:{Count:2},ToString:function(t){return t[0]+"在"+t[1]+"个周期内的时间序列三角移动平均"}}],["SLOPE",{Name:"SLOPE",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日线性回归斜率"}}],["STD",{Name:"STD",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日估算标准差"}}],["STDP",{Name:"STDP",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日总体标准差"}}],["STDDEV",{Name:"STDDEV",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日标准偏差"}}],["VAR",{Name:"VAR",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日估算样本方差"}}],["VARP",{Name:"VARP",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日总体样本方差"}}],["COVAR",{Name:"COVAR",Param:{Count:3},ToString:function(t){return t[0]+"和"+t[1]+"的"+t[2]+"周期的协方差"}}],["RELATE",{Name:"RELATE",Param:{Count:3},ToString:function(t){return t[0]+"和"+t[1]+"的"+t[0]+"周期的相关系数"}}],["BETA",{Name:"BETA",Param:{Count:1},ToString:function(t){return"β(Beta)系数"}}],["BETAEX",{Name:"BETAEX",Param:{Count:3},ToString:function(t){return t[0]+"和"+t[1]+"的"+t[2]+"周期的相关放大系数"}}],["COST",{Name:"COST",Param:{Count:1},ToString:function(t){return"获利盘为"+t[0]+"%的成本分布"}}],["WINNER",{Name:"WINNER",Param:{Count:1},ToString:function(t){return"以"+t[0]+"计算的获利盘比例"}}],["LWINNER",{Name:"LWINNER",Param:{Count:2},ToString:function(t){return"最近"+t[0]+"日那部分成本以"+t[1]+"价格卖出的获利盘比例"}}],["PWINNER",{Name:"PWINNER",Param:{Count:2},ToString:function(t){return t[0]+"日前那部分成本以"+t[1]+"价格卖出的获利盘比例"}}],["COSTEX",{Name:"COSTEX",Param:{Count:2},ToString:function(t){return"位于价格"+t[0]+"和"+t[1]+"间的成本"}}],["PPART",{Name:"PPART",Param:{Count:2},ToString:function(t){return t[0]+"日前那部分成本占总成本的比例"}}],["SAR",{Name:"SAR",Param:{Count:3},ToString:function(t){return"步长为"+t[1]+"极限值为"+t[0]+"的"+t[2]+"日抛物转向"}}],["SARTURN",{Name:"SARTURN",Param:{Count:3},ToString:function(t){return"步长为"+t[1]+"极限值为"+t[0]+"的"+t[2]+"日抛物转向点"}}],["CON2STR",{Name:"CON2STR",Param:{Count:2},ToString:function(t){return t[0]+"转为字符串"}}],["VAR2STR",{Name:"VAR2STR",Param:{Count:2},ToString:function(t){return t[0]+"转为字符串"}}],["STR2CON",{Name:"STR2CON",Param:{Count:1},ToString:function(t){return t[0]+"转为数字"}}],["STRLEN",{Name:"STRLEN",Param:{Count:1},ToString:function(t){return"得到"+t[0]+"字符串长度"}}],["STRCAT",{Name:"STRCAT",Param:{Count:2},ToString:function(t){return"字符串相加"}}],["VARCAT",{Name:"VARCAT",Param:{Count:2},ToString:function(t){return"字符串相加"}}],["STRSPACE",{Name:"STRSPACE",Param:{Count:1},ToString:function(t){return"字符串"+t[0]+"加一空格"}}],["SUBSTR",{Name:"SUBSTR",Param:{Count:3},ToString:function(t){return"字符串"+t[0]+"中取一部分"}}],["STRCMP",{Name:"STRCMP",Param:{Count:2},ToString:function(t){return"字符串"+t[0]+"和字符串"+t[1]+"比较"}}],["FINDSTR",{Name:"FINDSTR",Param:{Count:2},ToString:function(t){return"字符串"+t[0]+"中查找字符串"+t[1]}}],["NAMEINCLUDE",{Name:"NAMEINCLUDE",Param:{Count:1},ToString:function(t){return"查找品种名称中包含"+t[0]}}],["CODELIKE",{Name:"CODELIKE",Param:{Count:1},ToString:function(t){return"查找品种名称中包含"+t[0]}}],["INBLOCK",{Name:"AVEDEV",Param:{Count:1},ToString:function(t){return"属于"+t[0]+"板块"}}],["STKINDI",{Name:"STKINDI",Param:{Dynamic:!0},ToString:function(t){return"指标引用"}}],["STRFORMAT",{Name:"STRFORMAT",Param:{Dynamic:!0},ToString:function(t){return"格式化"+t[0]+"字符串"}}],["NAMELIKE",{Name:"NAMELIKE",Param:{Count:1},ToString:function(t){return"品种名称是否以'"+t[0]+"'开头"}}],["HHVBARS",{Name:"HHVBARS",Param:{Count:2},ToString:function(t){return t[1]==0?"历史"+t[0]+"新高距今天数":t[1]+"日内"+t[0]+"新高距今天数"}}],["LLVBARS",{Name:"LLVBARS",Param:{Count:2},ToString:function(t){return t[1]==0?"历史"+t[0]+"新低距今天数":t[1]+"日内"+t[0]+"新低距今天数"}}],["L2_VOLNUM",{Name:"L2_VOLNUM",Param:{Count:2},ToString:function(t){return"单数分档"}}],["L2_VOL",{Name:"L2_VOL",Param:{Count:2},ToString:function(t){return"成交量分档"}}],["L2_AMO",{Name:"L2_AMO",Param:{Count:2},ToString:function(t){return"成交额分档"}}]]),this.CallFunctionExplain=function(r,t,n){if(this.FUNCTION_INFO_LIST.has(r)){var s=this.FUNCTION_INFO_LIST.get(r);return s.Param.Dynamic===!0||s.Param.Count!=t.length&&this.ThrowUnexpectedNode(n,"函数"+r+"参数个数不正确. 需要"+s.Param.Count+"个参数"),s.ToString(t)}switch(r){case"CALCSTOCKINDEX":return"引用"+t[0]+"的"+t[1]+"指标第"+t[2]+"个输出值";case"PEAK":case"PEAKBARS":case"ZIG":case"ZIGA":case"TROUGH":case"TROUGHBARS":return this.GetZIGExplain(r,t);case"FINANCE":return this.GetFinanceExplain(t);case"DYNAINFO":return this.GetDynainfoExplain(t);case"CLOSE":case"C":case"VOL":case"V":case"OPEN":case"O":case"HIGH":case"H":case"LOW":case"L":case"AMOUNT":case"AMO":return this.GetOtherSymbolExplain({FunctionName:r,Args:t},n);case"PLOYLINE":return"当满足条件"+t[0]+"时以"+t[1]+"位置为顶点画折线连接";case"DRAWLINE":return"当满足条件"+t[0]+"时,在"+t[1]+"位置画直线起点，当满足条件"+t[2]+"时,在"+t[3]+"位置画直线终点,"+t[4]+"表示是否延长";case"DRAWSL":return"当满足条件"+t[0]+"时,在"+t[1]+"位置画斜线线性回归,"+t[2]+"斜率,"+t[3]+"长度,"+t[4]+"方向";case"DRAWKLINE":case"DRAWKLINE1":return"K线";case"DRAWICON":return"当满足条件"+t[0]+"时,在"+t[1]+"位置画"+t[2]+"号图标";case"DRAWTEXT":return"当满足条件"+t[0]+"时,在"+t[1]+"位置书写文字";case"DRAWTEXT_FIX":return"当满足条件"+t[0]+"时,在横轴"+t[1]+"纵轴"+t[2]+"位置书写文字";case"DRAWNUMBER":return"当满足条件"+t[0]+"时,在"+t[1]+"位置书写数字";case"DRAWNUMBER_FIX":return"当满足条件"+t[0]+"时,在横轴"+t[1]+"纵轴"+t[2]+"位置书写数字";case"RGB":return"自定色["+t[0]+","+t[1]+","+t[2]+"]";case"RGBA":return"自定色["+t[0]+","+t[1]+","+t[2]+","+t[3]+"]";case"DRAWBAND":return"画带状线";case"DRAWRECTREL":return"相对位置上画矩形.";case"DRAWGBK":return"填充背景";case"TIPICON":return"当满足条件"+t[0]+"时,在"+t[1]+"位置画"+t[2]+"号图标";case"STICKLINE":var o="";return t[4]==-1?o="虚线空心柱":t[4]==0?o="实心柱":o="实线空心柱","当满足条件"+t[0]+"时, 在"+t[1]+"和"+t[2]+"位置之间画柱状线,宽度为"+t[3]+","+o;case"PARTLINE":return"画折线";case"SELL":return"卖出平仓";case"BUY":return"买入开仓";case"SELLSHORT":return"卖出开仓";case"BUYSHORT":return"买入平仓";case"DRAWLASTBARNUMBER":return"在最后一根k线输出数值";case"DRAWLASTBARTEXT":return"在最后一根k线显示文字";case"DRAWLASTBARICON":return"在最后一根k线绘制图标";case"YMOVE":return;case"BACKGROUND":return"绘制背景";case"UPCOLOR":return"上涨颜色"+t[0];case"DOWNCOLOR":return"下跌颜色"+t[0];case"STICKTYPE":case"FIRSTDRAW":return"";default:this.ThrowUnexpectedNode(n,"函数"+r+"不存在")}},this.GetDynainfoExplain=function(r){var t=new Dt.default([[3,"前收盘价"],[4,"开盘价"],[5,"最高价"],[6,"最低价"],[7,"现价"],[8,"总量"],[9,"现量"],[10,"总金额"],[11,"均价"],[12,"日涨跌"],[13,"振幅"],[14,"涨幅"],[15,"开盘时的成交金额"],[16,"前5日每分钟均量"],[17,"量比"],[18,"上涨家数"],[19,"下跌家数"]]),n=r[0];return t.has(n)?t.get(n):"即时行情["+n+"]"},this.GetFinanceExplain=function(r){var t=new Dt.default([[1,"总股本"],[2,"市场类型"],[3,"沪深品种类型"],[4,"沪深行业代码"],[5,"B股"],[6,"H股"],[7,"流通股本[股]"],[8,"股东人数[户]"],[9,"资产负债率%"],[10,"总资产"],[11,"流动资产"],[12,"固定资产"],[13,"无形资产"],[15,"流动负债"],[16,"少数股东权益"]]),n=r[0];return t.has(n)?t.get(n):"财务数据["+n+"]"},this.GetZIGExplain=function(r,t){var n=t[0];switch(n==0?n="开盘价":n==1?n="最高价":n==2?n="最低价":n==3&&(n="收盘价"),r){case"PEAK":return n+"的"+t[1]+"%之字转向的前"+t[2]+"个波峰值";case"PEAKBARS":return n+"的"+t[1]+"5%之字转向的前"+t[2]+"个波峰位置";case"ZIG":return n+"的"+t[1]+"的之字转向";case"ZIGA":return n+"变化"+t[1]+"的之字转向";case"TROUGH":return n+"的"+t[1]+"%之字转向的前"+t[2]+"个波谷值";case"TROUGHBARS":return n+"的"+t[1]+"%之字转向的前"+t[2]+"个波谷位置"}},this.GetColorExplain=function(r){var t=new Dt.default([["COLORBLACK","黑色"],["COLORBLUE","蓝色"],["COLORGREEN","绿色"],["COLORCYAN","青色"],["COLORRED","红色"],["COLORMAGENTA","洋红色"],["COLORBROWN","棕色"],["COLORLIGRAY","淡灰色"],["COLORGRAY","深灰色"],["COLORLIBLUE","淡蓝色"],["COLORLIGREEN","淡绿色"],["COLORLICYAN","淡青色"],["COLORLIRED","淡红色"],["COLORLIMAGENTA","淡洋红色"],["COLORWHITE","白色"],["COLORYELLOW","黄色"]]);return t.has(r)?t.get(r):r.indexOf("COLOR")==0?"#"+r.substr(5):"rgb(30,144,255)"},this.GetLineWidthExplain=function(r){var t=parseInt(r.replace("LINETHICK",""));return v.IsPlusNumber(t)?t:1},this.SymbolPeriodExplain=function(r,t){var n=new Dt.default([["CLOSE","收盘价"],["C","收盘价"],["VOL","成交量"],["V","成交量"],["OPEN","开盘价"],["O","开盘价"],["HIGH","最高价"],["H","最高价"],["LOW","最低价"],["L","最低价"],["AMOUNT","成交金额"],["AMO","成交金额"],["VOLINSTK","持仓量"]]),s=new Dt.default([["MIN1","1分钟"],["MIN5","5分钟"],["MIN15","15分钟"],["MIN30","30分钟"],["MIN60","60分钟"],["DAY","日"],["WEEK","周"],["MONTH","月"],["SEASON","季"],["YEAR","年"],["WEEK2","双周"],["HALFYEAR","半年"]]),o=r;n.has(r)&&(o=n.get(r));var l=t;return s.has(t)&&(l=s.get(t)),o+"[取"+l+"数据]"},this.GetOtherSymbolExplain=function(r,t){var n=new Dt.default([["CLOSE","收盘价"],["C","收盘价"],["VOL","成交量"],["V","成交量"],["OPEN","开盘价"],["O","开盘价"],["HIGH","最高价"],["H","最高价"],["LOW","最低价"],["L","最低价"],["AMOUNT","成交金额"],["AMO","成交金额"],["VOLINSTK","持仓量"]]);if(r.FunctionName){var s=r.Args,o=n.get(r.FunctionName);return"["+s[0]+"]"+o}else if(r.Literal){var l=r.Literal.toUpperCase(),s=l.split("$");if(!n.has(s[1]))return"";var h=s[0],o=n.get(s[1]);return"["+h+"]"+o}},this.IsDrawFunction=function(r){var t=new Fe.default(["STICKLINE","DRAWTEXT","SUPERDRAWTEXT","DRAWLINE","DRAWBAND","DRAWKLINE","DRAWKLINE1","DRAWKLINE_IF","PLOYLINE","POLYLINE","DRAWNUMBER","DRAWNUMBER_FIX","DRAWICON","DRAWCHANNEL","PARTLINE","DRAWTEXT_FIX","DRAWGBK","DRAWTEXT_LINE","DRAWRECTREL","DRAWTEXTABS","DRAWOVERLAYLINE","FILLRGN","FILLRGN2","FILLTOPRGN","FILLBOTTOMRGN","FILLVERTICALRGN","FLOATRGN","DRAWSL","DRAWGBK2","BUY","BUYSHORT","SELL","SELLSHORT"]);return!!t.has(r)},this.VisitAssignmentExpression=function(r){var t=r.Left;t.Type!=ut.Identifier&&this.ThrowUnexpectedNode(r);var n=t.Name,s=r.Right,o=null;s.Type==ut.BinaryExpression||s.Type==ut.LogicalExpression?o=this.VisitBinaryExpression(s):s.Type==ut.CallExpression?o=this.VisitCallExpression(s):s.Type==ut.Literal?(o=s.Value,v.IsString(o)&&s.Value.indexOf("$")>0&&(o=this.GetOtherSymbolExplain({Literal:o},r))):s.Type==ut.Identifier?o=this.ReadVariable(s.Name,s):s.Type==ut.MemberExpression?o=this.ReadMemberVariable(s):s.Type==ut.UnaryExpression&&(o=this.VisitUnaryExpression(s)),this.VarTable.set(n,this.ConvertToShortValue(o))},this.ConvertToShortValue=function(r){var t=this.MaxValueLength;if(r&&r.length>=t){var n=r.slice(0,t-10);return n+="......",n}return r},this.ReadMemberVariable=function(r){var t=r.Object,n=r.Property,s=void 0;if(t.Type==ut.BinaryExpression||t.Type==ut.LogicalExpression)s=this.VisitBinaryExpression(t);else if(t.Type==ut.CallExpression)s=this.VisitCallExpression(t);else{if(n.Name.indexOf("#")>0)var o=n.Name.split("#"),l=t.Name+"的"+o[0]+"[周期"+o[1]+"]";else var l=t.Name+"的"+n.Name;return l}if(!s)return null;var l=s[n.Name];return l||null},this.VisitBinaryExpression=function(r){var t=[];t.push(r);for(var n=null;t.length!=0;)if(n=t[t.length-1],n.Left&&r!=n.Left&&r!=n.Right)t.push(n.Left);else if(n.Right&&r!=n.Right)t.push(n.Right);else{var s=t.pop();if(s.Type==ut.BinaryExpression){var o=this.GetNodeValue(s.Left),l=this.GetNodeValue(s.Right);s.Out=null,s.Out="("+o+" "+s.Operator+" "+l+")",o=="收盘价"&&l=="开盘价"?s.Operator==">"?s.Out="(收阳线)":s.Operator=="<"?s.Out="(收阴线)":s.Operator=="="&&(s.Out="(平盘)"):o=="开盘价"&&l=="收盘价"&&(s.Operator=="<"?s.Out="(收阳线)":s.Operator==">"?s.Out="(收阴线)":s.Operator=="="&&(s.Out="(平盘)"))}else if(s.Type==ut.LogicalExpression){var h=this.GetNodeValue(s.Left),u=this.GetNodeValue(s.Right);switch(s.Out=null,s.Operator){case"&&":case"AND":s.Out="("+h+" 并且 "+u+")";break;case"||":case"OR":s.Out="("+h+" 或者 "+u+")";break}}r=n}return r.Out},this.GetNodeValueEx=function(r){var t=null;return r.Type==ut.BinaryExpression||r.Type==ut.LogicalExpression?t=this.VisitBinaryExpression(r):r.Type==ut.CallExpression?t=this.VisitCallExpression(r):t=this.GetNodeValue(r),t},this.GetNodeValue=function(r){switch(r.Type){case ut.Literal:return r.Value;case ut.UnaryExpression:return this.VisitUnaryExpression(r);case ut.Identifier:var t=this.ReadVariable(r.Name,r);return t;case ut.BinaryExpression:case ut.LogicalExpression:return r.Out;case ut.CallExpression:return this.VisitCallExpression(r);default:this.ThrowUnexpectedNode(r)}},this.ReadVariable=function(r,t){if(this.ConstVarTable.has(r)){var n=this.ConstVarTable.get(r);return n}if(Yt.IsCustomVariant(r)){var s=Yt.CustomVariant.Data.get(r);return s.Description?s.Description:r}if(this.VarTable.has(r))return this.VarTable.get(r);if(r.indexOf("#")>0){var o=r.split("#");return this.SymbolPeriodExplain(o[0],o[1])}return r=="AUTOFILTER"?this.AUTOFILTER():(this.ThrowUnexpectedNode(t,"变量"+r+"不存在"),r)},this.AUTOFILTER=function(){return null},this.ThrowUnexpectedNode=function(r,t){var n=r.Marker,s=t||"执行异常";return this.ErrorHandler.ThrowError(n.Index,n.Line,n.Column,s)},this.ThrowError=function(){}}function be(){}be.Tokenize=function(e){k.Complier.Log("[JSComplier.Tokenize]",e);var a=new jm(e),r=[];try{for(;;){var t=a.GetNextToken();if(!t)break;r.push(t)}}catch{}return r};be.Parse=function(e){k.Complier.Log("[JSComplier.Parse]",e);var a=new Tl(e);a.Initialize();var r=a.ParseScript(),t=r;return t};be.Execute=function(e,a,r){var t=function(){try{a.Self&&(a.Self.Status=1),k.Complier.Log("[JSComplier.Execute]",e,a),k.Complier.Log("[JSComplier.Execute] parser .....");var s=new Tl(e);s.Initialize();var o=s.ParseScript(),l=o;k.Complier.Log("[JSComplier.Execute] parser finish.",l),a.Self&&(a.Self.Status=2),k.Complier.Log("[JSComplier.Execute] execute .....");var h=new eg(l,a);h.ErrorCallback=r,h.JobList=s.Node.GetDataJobList(),a.ClassName=="ScriptIndexConsole"&&!a.Data&&h.JobList.unshift({ID:z.JOB_DOWNLOAD_SYMBOL_DATA}),h.JobList.push({ID:z.JOB_RUN_SCRIPT}),a.Self&&(a.Self.Status=3);var u=h.Execute()}catch(f){k.Complier.Log(f),r&&r(f,a.CallbackParam),a.Self&&(a.Self.Status=0)}};t(),k.Complier.Log("[JSComplier.Execute] async execute.")};be.Explain=function(e,a,r){var t=function(){try{k.Complier.Log("[JSComplier.Explain]",e,a),k.Complier.Log("[JSComplier.Explain] parser .....");var s=new Tl(e);s.Initialize();var o=s.ParseScript(),l=o;k.Complier.Log("[JSComplier.Explain] parser finish.",l),k.Complier.Log("[JSComplier.Explain] explain .....");var h=new ag(l,a);h.ErrorCallback=r,h.JobList=s.Node.GetDataJobList(),h.JobList.push({ID:z.JOB_RUN_SCRIPT});var u=h.Run()}catch(f){k.Complier.Log(f),r&&r(f,a.CallbackParam)}};t(),k.Complier.Log("[JSComplier.Explain] async explain.")};be.SetDomain=function(e,a){e&&(Yt.Domain=e),a&&(Yt.CacheDomain=a)};be.AddIcon=function(e){Yt.CustomDrawIcon.Data.set(e.ID,e)};be.AddFunction=function(e){if(!(!e||!e.Name)){var a=e.Name.toUpperCase();Yt.CustomFunction.Data.set(a,e)}};be.AddVariant=function(e){if(!(!e||!e.Name)){var a=e.Name.toUpperCase();Yt.CustomVariant.Data.set(a,e)}};be.ColorVarToRGB=function(e){var a=new Dt.default([["COLORBLACK","rgb(0,0,0)"],["COLORBLUE","rgb(18,95,216)"],["COLORGREEN","rgb(25,158,0)"],["COLORCYAN","rgb(0,255,198)"],["COLORRED","rgb(238,21,21)"],["COLORMAGENTA","rgb(255,0,222)"],["COLORBROWN","rgb(149,94,15)"],["COLORLIGRAY","rgb(218,218,218)"],["COLORGRAY","rgb(133,133,133)"],["COLORLIBLUE","rgb(94,204,255)"],["COLORLIGREEN","rgb(183,255,190)"],["COLORLICYAN","rgb(154,255,242)"],["COLORLIRED","rgb(255,172,172)"],["COLORLIMAGENTA","rgb(255,145,241)"],["COLORWHITE","rgb(255,255,255)"],["COLORYELLOW","rgb(255,198,0)"]]);if(a.has(e))return a.get(e);if(e.indexOf("COLOR")==0){var r=e.substr(5);if(r.length!=6)return null;var t=r.substr(0,2),n=parseInt(t,16);t=r.substr(2,2);var s=parseInt(t,16);t=r.substr(4,2);var o=parseInt(t,16);return"rgb("+o+","+s+","+n+")"}if(e.indexOf("RGBX")==0){var r=e.substr(4);if(r.length!=6)return null;var t=r.substr(0,2),o=parseInt(t,16);t=r.substr(2,2);var s=parseInt(t,16);t=r.substr(4,2);var n=parseInt(t,16);return"rgb("+o+","+s+","+n+")"}return null};var wt={KLINE_ID:0,MINUTE_ID:2,HISTORY_MINUTE_ID:3,MULTIDAY_MINUTE_ID:4},Ja={OVERLAY_BARS:"OVERLAY_BARS",KLINE_TABLE:"KLINE_TABLE",SCATTER_PLOT:"SCATTER_PLOT",CLIP_COLOR_STICK:"CLIP_COLOR_STICK"};function ig(){this.DataMap=new Dt.default,this.Add=function(e,a){this.DataMap.set(e,{MinuteFittingCallback:a.MinuteFittingCallback,KLineFittingCallback:a.KLineFittingCallback,CreateChartCallback:a.CreateChartCallback,FormatTitleCallback:a.FormatTitleCallback})},this.Get=function(e){return this.DataMap.has(e)?this.DataMap.get(e):null},this.Has=function(e){return this.DataMap.has(e)}}var Ei=new ig;function Ie(e,a,r,t){this.newMethod=Ls,this.newMethod(e),delete this.newMethod,this.ClassName="ScriptIndex",this.Script=a,this.Arguments=[],this.OutVar=[],this.ID,this.FloatPrecision=2,this.StringFormat,this.IsShowIndexTitle=!0,this.KLineType=null,this.InstructionType,this.YSpecificMaxMin=null,this.YSplitScale=null,this.Condition=null,this.OutName=null,this.YSplitType,this.IsLocked=!1,this.LockCallback=null,this.LockID=null,this.LockBG=null,this.LockTextColor=null,this.LockText=null,this.LockFont=null,this.LockCount=20,this.LockMinWidth=null,this.TitleFont=d.TitleFont,this.IsShortTitle=!1,this.IsUsePageData=!1,this.YAxis=null,this.Debug,this.IsSync=!1,this.IsShow=!0,this.RunCount=0,this.MaxRunCount=-1,t&&(t.FloatPrecision>=0&&(this.FloatPrecision=t.FloatPrecision),t.StringFormat>0&&(this.StringFormat=t.StringFormat),v.IsBool(t.IsShowIndexTitle)&&(this.IsShowIndexTitle=t.IsShowIndexTitle),t.ID&&(this.ID=t.ID),(t.KLineType>=0||t.KLineType===-1)&&(this.KLineType=t.KLineType),t.InstructionType&&(this.InstructionType=t.InstructionType),t.YSpecificMaxMin&&(this.YSpecificMaxMin=t.YSpecificMaxMin),t.YSplitScale&&(this.YSplitScale=t.YSplitScale),t.Condition&&(this.Condition=t.Condition),t.TitleFont&&(this.TitleFont=t.TitleFont),t.IsShortTitle&&(this.IsShortTitle=t.IsShortTitle),t.OutName&&(this.OutName=t.OutName),v.IsNumber(t.YSplitType)&&(this.YSplitType=t.YSplitType),v.IsBool(t.IsSync)&&(this.IsSync=t.IsSync),v.IsNumber(t.MaxRunCount)&&(this.MaxRunCount=t.MaxRunCount),t.Debug&&v.IsPlusNumber(t.Debug.Count)&&t.Debug.Callback&&(this.Debug={Count:t.Debug.Count,Callback:t.Debug.Callback})),t&&t.Lock&&(t.Lock.IsLocked==!0&&(this.IsLocked=!0),t.Lock.Callback&&(this.LockCallback=t.Lock.Callback),t.Lock.ID&&(this.LockID=t.Lock.ID),t.Lock.BG&&(this.LockBG=t.Lock.BG),t.Lock.TextColor&&(this.LockTextColor=t.Lock.TextColor),t.Lock.Text&&(this.LockText=t.Lock.Text),t.Lock.Font&&(this.LockFont=t.Lock.Font),t.Lock.Count&&(this.LockCount=t.Lock.Count),t.Lock.MinWidth&&(this.LockMinWidth=t.Lock.MinWidth*B())),t&&t.YAxis&&(this.YAxis={},v.IsNumber(t.YAxis.FloatPrecision)&&(this.YAxis.FloatPrecision=t.YAxis.FloatPrecision),v.IsNumber(t.YAxis.StringFormat)&&(this.YAxis.StringFormat=t.YAxis.StringFormat),v.IsBool(t.YAxis.EnableRemoveZero)&&(this.YAxis.EnableRemoveZero=t.YAxis.EnableRemoveZero),v.IsBool(t.YAxis.ExcludeValue)&&(this.YAxis.ExcludeValue=t.YAxis.ExcludeValue)),r&&(this.Arguments=r),this.CopyTo=function(n){n.FloatPrecision=this.FloatPrecision,n.StringFormat=this.StringFormat,n.KLineType=this.KLineType,n.InstructionType=this.InstructionType,n.Condition=this.Condition,n.TitleFont=this.TitleFont,n.IsShortTitle=this.IsShortTitle,n.OutName=this.OutName,n.Arguments=this.Arguments,n.Script=this.Script,n.Name=this.Name,n.ID=this.ID},this.SetLock=function(n){n.IsLocked==!0?(this.IsLocked=!0,n.Callback&&(this.LockCallback=n.Callback),n.ID&&(this.LockID=n.ID),n.BG&&(this.LockBG=n.BG),n.TextColor&&(this.LockTextColor=n.TextColor),n.Text&&(this.LockText=n.Text),n.Font&&(this.LockFont=n.Font),n.Count&&(this.LockCount=n.Count),n.MinWidth&&(this.LockMinWidth=n.MinWidth*B())):(this.IsLocked=!1,this.LockCallback=null,this.LockID=null,this.LockBG=null,this.LockTextColor=null,this.LockText=null,this.LockFont=null,this.LockCount=20)},this.IsExcessRunCount=function(){return this.MaxRunCount<0?!1:this.RunCount>=this.MaxRunCount},this.ExecuteScript=function(n,s,o){this.OutVar=[];var l={HQChart:n,WindowIndex:s,HistoryData:o,Self:this},h=wt.KLINE_ID;n.ClassName==="MinuteChartContainer"||n.ClassName==="MinuteChartHScreenContainer"?n.DayCount>1?h=wt.MULTIDAY_MINUTE_ID:h=wt.MINUTE_ID:n.ClassName==="HistoryMinuteChartContainer"&&(h=wt.HISTORY_MINUTE_ID);var u={HQDataType:h,Symbol:n.Symbol,Name:n.Name,Data:o,SourceData:n.SourceData,Callback:this.RecvResultData,CallbackParam:l,Async:!0,MaxRequestDataCount:n.MaxRequestDataCount,MaxRequestMinuteDayCount:n.MaxRequestMinuteDayCount,Arguments:this.Arguments,Condition:this.Condition,IsBeforeData:n.IsBeforeData,IsApiPeriod:n.IsApiPeriod,DrawInfo:null,Self:this};if(this.Debug&&v.IsPlusNumber(this.Debug.Count)&&this.Debug.Callback&&(--this.Debug.Count,u.Debug=1,u.DebugFilter=this.Debug.Callback),n&&n.ChartPaint[0]){var f=n.ChartPaint[0];f&&f.DrawKRange&&(u.DrawInfo={Start:f.DrawKRange.Start,End:f.DrawKRange.End})}if(h===wt.HISTORY_MINUTE_ID&&(u.TrateDate=n.TradeDate),h===wt.MULTIDAY_MINUTE_ID&&(u.DayCount=n.DayCount),n.NetworkFilter&&(u.NetworkFilter=n.NetworkFilter),this.Condition&&!this.IsMeetCondition(l,u)){this.ShowConditionError(l,this.Condition.Message);return}++this.RunCount;var C=this.Script;be.Execute(C,u,n.ScriptErrorCallback)},this.IsMeetCondition=function(n,s){return k.Complier.Log("[ScriptIndex::IsMeetCondition] ",this.Condition),!(this.Condition.Period&&(!this.IsMeetPeriodCondition(n,s)||!this.IsMeetIncludeCondition(n,s)))},this.IsMeetPeriodCondition=function(n,s){if(!this.Condition.Period)return!0;for(var o in this.Condition.Period){var l=this.Condition.Period[o];switch(l){case Ce.MINUTE_ID:if(s.HQDataType==wt.MINUTE_ID)return!0;break;case Ce.MULTIDAY_MINUTE_ID:if(s.HQDataType==wt.MULTIDAY_MINUTE_ID)return!0;break;case Ce.KLINE_DAY_ID:case Ce.KLINE_WEEK_ID:case Ce.KLINE_MONTH_ID:case Ce.KLINE_YEAR_ID:case Ce.KLINE_TWOWEEK_ID:case Ce.KLINE_QUARTER_ID:case Ce.KLINE_MINUTE_ID:case Ce.KLINE_5_MINUTE_ID:case Ce.KLINE_15_MINUTE_ID:case Ce.KLINE_30_MINUTE_ID:case Ce.KLINE_60_MINUTE_ID:if(n.HQChart.Period==l)return!0;break}}return!1},this.IsMeetIncludeCondition=function(n,s){if(!this.Condition.Include||this.Condition.Include.length<=0)return!0;var o=n.HQChart.Symbol;o&&(o=o.toUpperCase());for(var l in this.Condition.Include){var h=this.Condition.Include[l];if(o==h)return!0}return!1},this.ShowConditionError=function(n,s){var o=n.HQChart,l=n.WindowIndex;o.DeleteIndexPaint(l),l==0&&o.ShowKLine(!0);var h="指标不支持当前品种或周期";s&&(h=s);var u=new va;u.Canvas=o.Canvas,u.ChartBorder=o.Frame.SubFrame[l].Frame.ChartBorder,u.ChartFrame=o.Frame.SubFrame[l].Frame,u.NotSupportMessage=h,o.ChartPaint.push(u),o.UpdataDataoffset(),o.UpdateFrameMaxMin(),o.Draw()},this.RecvResultData=function(n,s){var o=s.HQChart,l=s.WindowIndex,h=s.HistoryData;if(s.Self.OutVar=n,s.Self.BindData(o,l,h),s.Self.IsLocked==!1)s.HQChart.Frame.SubFrame[l].Frame.SetLock(null);else{var u={IsLocked:!0,Callback:s.Self.LockCallback,IndexName:s.Self.Name,ID:s.Self.LockID,BG:s.Self.LockBG,Text:s.Self.LockText,TextColor:s.Self.LockTextColor,Font:s.Self.LockFont,Count:s.Self.LockCount,MinWidth:s.Self.LockMinWidth};s.HQChart.Frame.SubFrame[l].Frame.SetLock(u)}if(s.HQChart.UpdataDataoffset(),s.HQChart.UpdateFrameMaxMin(),s.Self.IsSync===!1&&s.HQChart.Draw(),o.GetIndexEvent){var f=o.GetIndexEvent();if(f){var C=s.Self,D={OutVar:C.OutVar,WindowIndex:l,Name:C.Name,Arguments:C.Arguments,HistoryData:h,Stock:{Symbol:o.Symbol,Name:o.Name}};f.Callback(f,D,C)}}},this.SetChartIndexName=function(n){this.Name?n.IndexName=this.Name:this.ID&&n.IndexName==this.ID,this.ID&&(n.IndexID=this.ID),this.YAxis&&v.IsBool(this.YAxis.ExcludeValue)&&(n.IsExcludeYValue=this.YAxis.ExcludeValue),n.Script=this},this.SetTitleData=function(n,s){n.ChartClassName=s.ClassName,n.IsVisible=s.IsVisible},this.ReloadChartResource=function(n,s,o){var l=n.GetEventCallback($.ON_RELOAD_INDEX_CHART_RESOURCE);if(!(!l||!l.Callback)){var h={Chart:o,IndexName:this.Name,IndexID:this.ID,HQChart:n,WindowIndex:s};l.Callback(l,h,this)}},this.CreateLine=function(n,s,o,l,h){if(h==7)var u=new fh;else var u=new va;if(u.Canvas=n.Canvas,u.DrawType=1,u.Name=o.Name,u.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,u.ChartFrame=n.Frame.SubFrame[s].Frame,u.Identify=this.Guid,o.Color?u.Color=this.GetColor(o.Color):u.Color=this.GetDefaultColor(l),h==8&&(u.DrawType=2,u.BreakPoint=o.BreakPoint),o.LineWidth){var f=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(f)&&f>0&&(u.LineWidth=f)}o.IsDotLine&&(u.IsDotLine=!0,u.LineDash=d.DOTLINE.LineDash.slice()),v.IsNonEmptyArray(o.LineDash)&&(u.LineDash=o.LineDash),o.IsShow==!1&&(u.IsShow=!1);var C=s+1;u.Data.Data=o.Data,this.ReloadChartResource(n,s,u),o.IsShowTitle===!1||v.IsString(o.Name)&&o.Name.indexOf("NOTEXT")==0||(o.NoneName?n.TitlePaint[C].Data[l]=new re(u.Data,null,u.Color):n.TitlePaint[C].Data[l]=new re(u.Data,o.Name,u.Color),this.SetTitleData(n.TitlePaint[C].Data[l],u)),this.SetChartIndexName(u),n.ChartPaint.push(u)},this.CreateArea=function(n,s,o,l){var h=new Pd;if(h.Canvas=n.Canvas,h.DrawType=1,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Identify=this.Guid,o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),o.DownColor?h.AreaColor=o.DownColor:o.UpColor&&(h.AreaColor=o.UpColor,h.AreaDirection=1),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));v.IsPlusNumber(u)&&(h.LineWidth=u)}v.IsNonEmptyArray(o.LineDash)&&(h.LineDash=o.LineDash),o.IsShow==!1&&(h.IsShow=!1);var f=s+1;h.Data.Data=o.Data,o.IsShowTitle===!1||v.IsString(o.Name)&&o.Name.indexOf("NOTEXT")==0||(o.NoneName?n.TitlePaint[f].Data[l]=new re(h.Data,null,h.Color):n.TitlePaint[f].Data[l]=new re(h.Data,o.Name,h.Color),n.TitlePaint[f].Data[l].ChartClassName=h.ClassName),this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreateOverlayLine=function(n,s,o,l,h){if(h==7)var u=new fh;var u=new BC;if(u.Canvas=n.Canvas,u.DrawType=1,u.Name=o.Name,u.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,u.ChartFrame=n.Frame.SubFrame[s].Frame,o.Color?u.Color=this.GetColor(o.Color):u.Color=this.GetDefaultColor(l),o.LineWidth){var f=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(f)&&f>0&&(u.LineWidth=f)}o.IsDotLine&&(u.IsDotLine=!0),o.IsShow==!1&&(u.IsShow=!1);var C=s+1;u.Data.Data=o.Data,n.TitlePaint[C].Data[l]=new re(u.Data,o.Name,u.Color),n.TitlePaint[C].Data[l].ChartClassName=u.ClassName,n.ChartPaint.push(u)},this.CreateSingleLine=function(n,s,o,l,h){var u=new wd;if(u.Canvas=n.Canvas,u.DrawType=1,u.Name=o.Name,u.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,u.ChartFrame=n.Frame.SubFrame[s].Frame,u.Identify=this.Guid,o.Color?u.Color=this.GetColor(o.Color):u.Color=this.GetDefaultColor(l),o.LineWidth){var f=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(f)&&f>0&&(u.LineWidth=f)}o.IsDotLine&&(u.IsDotLine=!0),o.IsShow==!1&&(u.IsShow=!1);var C=s+1;u.Data.Data=o.Data,this.ReloadChartResource(n,s,u),o.IsShowTitle===!1||v.IsString(o.Name)&&o.Name.indexOf("NOTEXT")==0||(o.NoneName?n.TitlePaint[C].Data[l]=new re(u.Data,null,u.Color):n.TitlePaint[C].Data[l]=new re(u.Data,o.Name,u.Color),this.SetTitleData(n.TitlePaint[C].Data[l],u)),this.SetChartIndexName(u),n.ChartPaint.push(u)},this.CreateBar=function(n,s,o,l){var h=new VC;h.Canvas=n.Canvas,o.Draw.Width>0?h.Width=o.Draw.Width:h.Width=0,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),h.Data.Data=o.Draw.DrawData,h.BarType=o.Draw.Type,this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreateText=function(n,s,o,l,h){var u=new gi;u.Canvas=n.Canvas,u.Name=o.Name,u.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,u.ChartFrame=n.Frame.SubFrame[s].Frame,u.ReloadResource(),o.Color?u.Color=this.GetColor(o.Color):u.Color=this.GetDefaultColor(l),o.IsDrawCenter===!0&&(u.TextAlign="center"),o.IsDrawAbove===!0&&(u.Direction=1),o.IsDrawBelow===!0&&(u.Direction=2),o.Draw.Position&&(u.Position=o.Draw.Position),o.Draw.DrawData&&(u.Data.Data=o.Draw.DrawData),u.Text=o.Draw.Text,o.Draw.Direction>0&&(u.Direction=o.Draw.Direction),o.Draw.YOffset>0&&(u.YOffset=o.Draw.YOffset),o.Draw.TextAlign&&(u.TextAlign=o.Draw.TextAlign),o.DrawVAlign>=0&&(o.DrawVAlign==0?u.Direction=1:o.DrawVAlign==1?u.Direction=0:o.DrawVAlign==2&&(u.Direction=2)),o.DrawAlign>=0&&(o.DrawAlign==0?u.TextAlign="left":o.DrawAlign==1?u.TextAlign="center":o.DrawAlign==2&&(u.TextAlign="right")),o.DrawFontSize>0&&(u.FixedFontSize=o.DrawFontSize),o.Background&&(u.TextBG=o.Background),this.SetChartIndexName(u),n.ChartPaint.push(u)},this.CreateDrawNumber=function(n,s,o,l){var h=new Vd;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.ReloadResource(),o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),o.IsDrawCenter===!0&&(h.TextAlign="center"),o.IsDrawAbove===!0&&(h.TextBaseline="bottom"),o.IsDrawBelow===!0&&(h.TextBaseline="top"),h.Data.Data=o.Draw.DrawData.Value,h.Text=o.Draw.DrawData.Text,o.Draw.Direction>0&&(h.Direction=o.Draw.Direction),o.Draw.YOffset>0&&(h.YOffset=o.Draw.YOffset),o.Draw.TextAlign&&(h.TextAlign=o.Draw.TextAlign),o.Draw.FixedPosition==="TOP"?h.FixedPosition=1:o.Draw.FixedPosition==="BOTTOM"&&(h.FixedPosition=2),o.DrawVAlign>=0&&(o.DrawVAlign==0?h.TextBaseline="top":o.DrawVAlign==1?h.TextBaseline="middle":o.DrawVAlign==2&&(h.TextBaseline="bottom")),o.DrawAlign>=0&&(o.DrawAlign==0?h.TextAlign="left":o.DrawAlign==1?h.TextAlign="center":o.DrawAlign==2&&(h.TextAlign="right")),o.DrawFontSize>0&&(h.FixedFontSize=o.DrawFontSize),o.Background&&(h.TextBG=o.Background),o.VerticalLine&&(h.VerticalLine=o.VerticalLine),n.ChartPaint.push(h)},this.CreateDrawTextV2=function(n,s,o,l){var h=new al;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.ReloadResource(),o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),o.IsDrawCenter===!0&&(h.TextAlign="center"),o.IsDrawAbove===!0&&(h.TextBaseline="bottom"),o.IsDrawBelow===!0&&(h.TextBaseline="top"),o.Draw.DrawData&&(h.Data.Data=o.Draw.DrawData),h.Text=o.Draw.Text,o.Draw.Direction>0&&(h.Direction=o.Draw.Direction),o.Draw.YOffset>0&&(h.YOffset=o.Draw.YOffset),o.Draw.TextAlign&&(h.TextAlign=o.Draw.TextAlign),o.Draw.FixedPosition==="TOP"?h.FixedPosition=1:o.Draw.FixedPosition==="BOTTOM"&&(h.FixedPosition=2),o.DrawVAlign>=0&&(o.DrawVAlign==0?h.TextBaseline="top":o.DrawVAlign==1?h.TextBaseline="middle":o.DrawVAlign==2&&(h.TextBaseline="bottom")),o.DrawAlign>=0&&(o.DrawAlign==0?h.TextAlign="left":o.DrawAlign==1?h.TextAlign="center":o.DrawAlign==2&&(h.TextAlign="right")),o.DrawFontSize>0&&(h.FixedFontSize=o.DrawFontSize),o.Background&&(h.TextBG=o.Background),o.VerticalLine&&(h.VerticalLine=o.VerticalLine),v.IsNumber(o.YOffset)&&(h.ShowOffset.Y=o.YOffset),v.IsNumber(o.XOffset)&&(h.ShowOffset.X=o.XOffset),this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreateMACD=function(n,s,o,l){var h=new il;if(h.Canvas=n.Canvas,h.Identify=this.Guid,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(h.LineWidth=u)}var f=s+1;h.Data.Data=o.Data;var C=this.GetDefaultColor(l);o.Color&&(C=this.GetColor(o.Color)),o.UpColor&&(h.UpColor=o.UpColor),o.DownColor&&(h.DownColor=o.DownColor),this.ReloadChartResource(n,s,h),n.TitlePaint[f].Data[l]=new re(h.Data,o.Name,C),this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreatePointDot=function(n,s,o,l,h){var u=new wC;if(u.Canvas=n.Canvas,u.Name=o.Name,u.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,u.ChartFrame=n.Frame.SubFrame[s].Frame,o.Color?u.Color=this.GetColor(o.Color):u.Color=this.GetDefaultColor(l),o.Radius&&(u.Radius=o.Radius),o.LineWidth){var f=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(f)&&f>0&&(u.Radius=f)}v.IsBool(o.UpDownDot)&&(u.EnableUpDownColor=o.UpDownDot,u.HistoryData=h);var C=s+1;u.Data.Data=o.Data,n.TitlePaint[C].Data[l]=new re(u.Data,o.Name,u.Color),this.SetChartIndexName(u),n.ChartPaint.push(u)},this.CreateStick=function(n,s,o,l){var h=new tl;if(h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(h.LineWidth=u)}var f=s+1;h.Data.Data=o.Data,this.ReloadChartResource(n,s,h),n.TitlePaint[f].Data[l]=new re(h.Data,o.Name,h.Color),this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreateLineStick=function(n,s,o,l){var h=new GC;if(h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(h.LineWidth=u)}var f=s+1;h.Data.Data=o.Data,n.TitlePaint[f].Data[l]=new re(h.Data,o.Name,h.Color),n.ChartPaint.push(h)},this.CreateStraightLine=function(n,s,o,l){var h=new va;if(h.DrawType=1,h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(h.LineWidth=u)}var f=s+1;h.Data.Data=o.Draw.DrawData,o.Name=="DRAWLINE"&&(n.TitlePaint[f].Data[l]=new re(h.Data,null,h.Color)),n.ChartPaint.push(h)},this.CreateVolStick=function(n,s,o,l,h){var u=new el;if(u.Canvas=n.Canvas,u.Name=o.Name,u.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,u.ChartFrame=n.Frame.SubFrame[s].Frame,u.KLineDrawType=n.KLineDrawType,u.Identify=this.Guid,o.Color?u.Color=this.GetColor(o.Color):u.Color=this.GetDefaultColor(l),o.UpColor&&(u.UpColor=o.UpColor),o.DownColor&&(u.DownColor=o.DownColor),v.IsNumber(o.StickType)&&(u.BarType=o.StickType),v.IsNumber(o.BarColorType)&&(u.BarColorType=o.BarColorType),o.LineWidth){var f=parseInt(o.LineWidth.replace("LINETHICK",""));v.IsPlusNumber(f)&&(u.BarWidth=f)}var C=s+1;if(u.Data.Data=o.Data,u.HistoryData=h,this.ReloadChartResource(n,s,u),o.IsShowTitle!==!1){if(!(v.IsString(o.Name)&&o.Name.indexOf("NOTEXT")==0)){var D=new re(u.Data,o.Name,u.Color);n.TitlePaint[C].Data[l]=D,this.SetTitleData(D,u)}}this.SetChartIndexName(u),n.ChartPaint.push(u)},this.CreateBand=function(n,s,o,l){var h=new XC;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.FirstColor=o.Draw.Color[0],h.SecondColor=o.Draw.Color[1],h.Data.Data=o.Draw.DrawData,v.IsBool(o.IsFirstDraw)&&(h.IsDrawFirst=o.IsFirstDraw);var u=s+1,f=new re(h.Data,o.Name,h.Color);f.DataType=h.ClassName,f.ExtendData={Color:[h.FirstColor,h.SecondColor]},n.TitlePaint[u].Data[l]=f,this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreateFillRGN=function(n,s,o,l){var h=new kC;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Data.Data=o.Draw.DrawData,o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),n.ChartPaint.push(h)},this.CreateFillRGN2=function(n,s,o,l){var h=new WC;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Data.Data=o.Draw.DrawData,n.ChartPaint.push(h)},this.CreateFillBGRGN=function(n,s,o,l){var h=new Ud;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Data.Data=o.Draw.DrawData,n.ChartPaint.push(h)},this.CreateFLOATRGN=function(n,s,o,l){var h=new Wd;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Data.Data=o.Draw.DrawData,n.ChartPaint.push(h)},this.CreateKLine=function(n,s,o,l){var h=new Pr;h.Canvas=n.Canvas,h.Name=o.Name,h.Identify=this.Guid,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Data.Data=o.Draw.DrawData,h.IsShowMaxMinPrice=!1,h.IsShowKTooltip=!1,v.IsNumber(o.KLineType)&&(h.DrawType=o.KLineType),o.Color&&(h.UnchagneColor=h.DownColor=h.UpColor=this.GetColor(o.Color)),this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreateOverlayKLine=function(n,s,o,l){var h=null;if(n.IsKLineContainer())h=new OC;else if(n.IsMinuteContainer())h=new rn;else return;h.Canvas=n.Canvas,h.Name=o.Name,h.Identify=this.Guid,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),h.Data.Data=o.Draw.DrawData,h.MainData=n.ChartPaint[0].Data,n.ChartPaint.push(h)},this.CreateDrawColorKLine=function(n,s,o,l){var h=new uh;h.Canvas=n.Canvas,h.Name=o.Name,h.DrawName="DRAWCOLORKLINE",h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Data.Data=o.Draw.DrawData,v.IsBool(o.Draw.IsEmptyBar)&&(h.IsEmptyBar=o.Draw.IsEmptyBar),o.Draw.Color&&(h.Color=o.Draw.Color),n.ChartPaint.push(h)},this.CreatePolyLine=function(n,s,o,l){var h=new va;if(h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),o.IsDotLine&&(h.IsDotLine=!0),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(h.LineWidth=u)}var f=s+1;h.Data.Data=o.Draw.DrawData,n.TitlePaint[f].Data[l]=new re(h.Data," ",h.Color),n.ChartPaint.push(h)},this.CreateChartSlopeLine=function(n,s,o,l){var h=new Gd;if(h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),o.IsDotLine&&(h.IsDotLine=!0),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(h.LineWidth=u)}var f=s+1;h.Data.Data=o.Draw.DrawData.Data,h.Option=o.Draw.DrawData.Option,n.TitlePaint[f].Data[l]=new re(h.Data,null,h.Color),n.ChartPaint.push(h)},this.CreateChartVericaltLine=function(n,s,o,l){var h=new _C;if(h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(h.LineWidth=u)}this.SetChartLineDash(h,o.Draw.DrawData),h.Data.Data=o.Draw.DrawData.Data,n.ChartPaint.push(h)},this.SetChartLineDash=function(n,s){if(v.IsNumber(s.LineType)){var o=s.LineType,l=B();switch(o){case 1:n.LineType=[10*l,10*l];break;case 2:n.LineType=[0,10*l],n.LineCap="square";break;case 3:n.LineType=[10*l,3*l,3*l,3*l];break;case 4:n.LineType=[10*l,3*l,3*l,3*l,3*l,3*l];break}}else if(v.IsString(s.LineType)){for(var h=s.LineType.split(","),u=[],f=0;f<h.length;++f)u.push(parseInt(h[f]));n.LineType=u}},this.CreateChartHorizontalLine=function(n,s,o,l){var h=new HC;if(h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(h.LineWidth=u)}this.SetChartLineDash(h,o.Draw.DrawData),h.ExtendType=o.Draw.DrawData.Extend,h.Data.Data=o.Draw.DrawData.Data,n.ChartPaint.push(h)},this.CreateBackgroud=function(n,s,o,l){var h=new KC;if(h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Draw&&o.Draw.DrawData){var u=o.Draw.DrawData;h.Color=u.Color,h.ColorAngle=u.Angle,u.Data&&(h.Data.Data=u.Data)}n.ChartPaint.push(h)},this.CreateBackgroundDiv=function(n,s,o,l){var h=new Kd;if(h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Draw&&o.Draw.DrawData){var u=o.Draw.DrawData;h.AryColor=u.AryColor,h.ColorType=u.ColorType,u.Data&&(h.Data.Data=u.Data)}n.ChartPaint.push(h)},this.CreateLineMultiData=function(n,s,o,l){var h=new _d;if(h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Draw&&o.Draw.DrawData){var u=o.Draw.DrawData;h.Color=u.Color,u.PointColor&&(h.PointColor=u.PointColor),v.IsPlusNumber(u.PointRadius)&&(h.PointRadius=u.PointRadius),v.IsPlusNumber(u.LineWidth)&&(h.LineWidth=u.LineWidth),u.Data&&(h.Data.Data=u.Data)}var f=s+1,C=new re(h.Data,o.Name,h.Color);C.DataType="MULTI_POINT_LINE",n.TitlePaint[f].Data[l]=C,n.ChartPaint.push(h)},this.CreateTradeIcon=function(n,s,o,l){var h=new Hd;if(h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Data.Data=o.Draw.DrawData.Data,h.AryIcon=o.Draw.DrawData.Icons,h.TradeType=o.Draw.DrawType,o.Color&&v.IsNonEmptyArray(h.AryIcon))for(var u=0;u<h.AryIcon.length;++u){var f=h.AryIcon[u];!f||!f.Color||(f.Color=o.Color)}o.DrawFontSize>0&&(h.SVG.Size=o.DrawFontSize*B()),n.ChartPaint.push(h)},this.CreateTextLine=function(n,s,o,l){var h=new zC;if(h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Draw&&o.Draw.DrawData){var u=o.Draw.DrawData;h.Text=u.Text,h.Line=u.Line,h.Price=u.Price}n.ChartPaint.push(h)},this.CreateNumberText=function(n,s,o,l){var h=new gi;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.ReloadResource(),h.TextAlign="center",o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),o.IsDrawAbove?h.Direction=1:h.Direction=2,o.Draw.Position&&(h.Position=o.Draw.Position),h.Data.Data=o.Draw.DrawData.Value,h.Text=o.Draw.DrawData.Text,this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreateDrawText=function(n,s,o,l){var h=new gi;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.ReloadResource(),o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),o.IsDrawAbove?h.Direction=1:h.Direction=0,o.DrawFontSize>0&&(h.TextFont=o.DrawFontSize*B()+"px 微软雅黑"),h.DrawData=o.Draw.DrawData,this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreateIcon=function(n,s,o,l){var h=new gi;h.Canvas=n.Canvas,h.TextAlign="center",h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Direction=2,o.IsDrawAbove&&(h.Direction=1),o.DrawVAlign>=0&&(o.DrawVAlign==0?h.Direction=1:o.DrawVAlign==1?h.Direction=0:o.DrawVAlign==2&&(h.Direction=2)),o.DrawAlign>=0&&(o.DrawAlign==0?h.TextAlign="left":o.DrawAlign==1?h.TextAlign="center":o.DrawAlign==2&&(h.TextAlign="right")),h.Data.Data=o.Draw.DrawData;var u=o.Draw.Icon;u.IconFont==!0?(h.IconFont={Family:u.Family,Text:u.Symbol,Color:u.Color},o.Color&&(h.IconFont.Color=this.GetColor(o.Color))):(h.Text=u.Symbol,o.Color?h.Color=this.GetColor(o.Color):u.Color?h.Color=u.Color:h.Color="rgb(0,0,0)"),o.DrawFontSize>0&&(h.FixedFontSize=o.DrawFontSize),v.IsNumber(o.XOffset)&&(h.ShowOffset.X=o.XOffset),v.IsNumber(o.YOffset)&&(h.ShowOffset.Y=o.YOffset),this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreateTipIcon=function(n,s,o,l){var h=new Cn;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,n.ChartPaint[0].IsMinuteFrame()?h.Data=n.SourceData:h.Data=n.ChartPaint[0].Data,h.Family=o.Draw.Icon.Family,h.TextFont=d.TIPICON.TextFont;var u=d.TIPICON.Size,f=d.TIPICON.Color,C=0,D=2;if(v.IsNumber(o.YOffset)&&(C=o.YOffset),o.Color&&(f=this.GetColor(o.Color)),o.DrawFontSize>0&&(u=o.DrawFontSize),o.DrawVAlign>=0&&(D=o.DrawVAlign),o.Draw&&v.IsNonEmptyArray(o.Draw.DrawData)&&o.Draw.Icon){var c=o.Draw.DrawData,T=[],S=Array.isArray(o.Draw.Text),I=null;!S&&o.Draw.Text&&(I={Text:o.Draw.Text});for(var g=0;g<c.length;++g){var E=c[g];if(v.IsNumber(E)){var F={Index:g,Value:E,SVG:{Symbol:o.Draw.Icon.Symbol,Size:u,Color:f,YOffset:C,VAlign:D}};if(S){var R=o.Draw.Text[g];R&&(F.Tooltip={Text:R})}else F.Tooltip=I;T.push(F)}}h.Texts=T}n.ChartPaint.push(h)},this.CreateDrawLastBarText=function(n,s,o,l){var h=new Yd;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,n.ChartPaint[0].IsMinuteFrame()?h.Data=n.SourceData:h.Data=n.ChartPaint[0].Data;var u=o.Draw.DrawData;u&&(u.Color?u.Color=this.GetColor(u.Color):u.Color=this.GetDefaultColor(l),o.Color&&(u.Color=this.GetColor(o.Color)),o.DrawVAlign>=0&&(o.DrawVAlign==0?u.TextBaseline="top":o.DrawVAlign==1?u.TextBaseline="middle":o.DrawVAlign==2&&(u.TextBaseline="bottom")),o.DrawAlign>=0&&(o.DrawAlign==0?u.TextAlign="left":o.DrawAlign==1?u.TextAlign="center":o.DrawAlign==2&&(u.TextAlign="right")),v.IsNumber(o.YOffset)&&(u.YOffset=o.YOffset),v.IsNumber(o.XOffset)&&(u.XOffset=o.XOffset),o.DrawFontSize>0&&(u.FontSize=o.DrawFontSize)),h.LastBarItem=u,n.ChartPaint.push(h)},this.CreateChannel=function(n,s,o,l){var h=new UC;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Draw.AreaColor?h.AreaColor=o.Draw.AreaColor:o.Color?h.AreaColor=this.GetColor(o.Color):h.AreaColor=this.GetDefaultColor(l),o.Draw.Border.Color?h.LineColor=o.Draw.Border.Color:h.LineColor=null,o.Draw.Border.Dotted&&(h.LineDotted=o.Draw.Border.Dotted),o.Draw.Border.Width>0&&(h.LineWidth=o.Draw.Border.Width),h.Data.Data=o.Draw.DrawData,n.ChartPaint.push(h)},this.CreatePartLine=function(n,s,o,l){var h=new bC;if(h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));v.IsPlusNumber(u)&&(h.LineWidth=u)}h.Data.Data=o.Draw.DrawData,this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreateMultiLine=function(n,s,o,l){var h=new ZC;if(h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Data=n.ChartPaint[0].Data,h.Lines=o.Draw.DrawData,o.Draw.Name&&(h.Name=o.Draw.Name),o.Draw.LineDash&&(h.LineDash=o.Draw.LineDash),v.IsNumber(o.Draw.LineWidth)&&(h.LineWidth=o.Draw.LineWidth),v.IsBool(o.Draw.IsFullRangeMaxMin)&&(h.IsFullRangeMaxMin=o.Draw.IsFullRangeMaxMin),o.Draw.Arrow){var u=o.Draw.Arrow;u.Start==!0&&(h.Arrow.Start=!0),u.End==!0&&(h.Arrow.End=!0),v.IsNumber(u.Angle)&&(h.ArrawAngle=u.Angle),v.IsNumber(u.Length)&&(h.ArrawLength=u.Length),v.IsNumber(u.LineWidth)&&(h.ArrawLineWidth=u.LineWidth)}this.ReloadChartResource(n,s,h),this.SetChartIndexName(h),n.ChartPaint.push(h);var f=s+1;if(o.IsShowTitle!==!1){var C=new re(h.Data,h.Name,null);C.DataType="ChartMultiLine",C.Lines=h.Lines,n.TitlePaint[f].Data[l]=C}},this.CreateMultiPoint=function(n,s,o,l){var h=new QC;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Data=n.ChartPaint[0].Data,h.PointGroup=o.Draw.DrawData,o.Draw.Name&&(h.Name=o.Draw.Name),this.SetChartIndexName(h),n.ChartPaint.push(h);var u=s+1,f=new re(h.Data,h.Name,null);f.DataType="ChartMultiPoint",f.PointGroup=h.PointGroup,n.TitlePaint[u].Data[l]=f},this.CreateMultiBar=function(n,s,o,l){var h=new JC;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Data=n.ChartPaint[0].Data,h.Bars=o.Draw.DrawData;var u=s+1,f=new re({KData:h.Data,BarData:h.Bars},o.Name,null);f.IsShow=!1,f.DataType="MULTI_BAR",n.TitlePaint[u].Data[l]=f,this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreateMultiText=function(n,s,o,l){var h=new $C;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Data=n.ChartPaint[0].Data,h.Texts=o.Draw.DrawData,this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreateMultiSVGIcon=function(n,s,o,l){var h=new qC;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Data=n.ChartPaint[0].Data,h.Family=o.Draw.DrawData.Family,h.AryIcon=o.Draw.DrawData.Icon,h.BuildCacheData(),this.SetChartIndexName(h),n.ChartPaint.push(h)},this.CreateChartDrawSVG=function(n,s,o,l){var h=new Cn;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,n.ChartPaint[0].IsMinuteFrame()?h.Data=n.SourceData:h.Data=n.ChartPaint[0].Data,v.IsBool(o.Draw.DrawData.EnableTooltip)&&(h.EnableTooltip=o.Draw.DrawData.EnableTooltip),v.IsBool(o.Draw.DrawData.IsDrawFirst)&&(h.IsDrawFirst=o.Draw.DrawData.IsDrawFirst),h.Family=o.Draw.DrawData.Family,h.TextFont=o.Draw.DrawData.TextFont,h.Texts=o.Draw.DrawData.Data,n.ChartPaint.push(h)},this.CreateMulitHtmlDom=function(n,s,o,l){var h=new jC;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.HQChart=n,h.Data=n.ChartPaint[0].Data,h.Texts=o.Draw.DrawData,h.DrawCallback=o.Draw.Callback,n.ChartPaint.push(h)},this.CreateStackedBar=function(n,s,o,l){var h=new tD;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.HQChart=n,h.Identify=this.Guid,h.Data.Data=o.Draw.DrawData,v.IsNonEmptyArray(o.Draw.BarColor)&&(h.BarColor=o.Draw.BarColor),v.IsNonEmptyArray(o.Draw.BarName)&&(h.BarName=o.Draw.BarName),v.IsNumber(o.Draw.LineWidth)&&(h.LineWidth=o.Draw.LineWidth),v.IsNumber(o.Draw.BarType)&&(h.BarType=o.Draw.BarType),n.ChartPaint.push(h);var u=s+1,f=new re(h.Data,h.BarName,h.BarColor);f.DataType="ChartStackedBar",n.TitlePaint[u].Data[l]=f},this.CreateKLineTable=function(n,s,o,l){var h=new yd;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.HQChart=n,h.Identify=this.Guid,h.Data.Data=o.Draw.DrawData,v.IsNumber(o.Draw.RowCount)&&(h.RowCount=o.Draw.RowCount),v.IsBool(o.Draw.IsShowRowName)&&(h.IsShowRowName=o.Draw.IsShowRowName),v.IsNonEmptyArray(o.Draw.RowName)&&(h.RowName=o.Draw.RowName),o.Draw.BGColor&&(h.BGColor=o.Draw.BGColor),n.ChartPaint.push(h);var u=s+1,f=new re(h.Data,h.BarName,h.BarColor);f.DataType="ChartKLineTable",n.TitlePaint[u].Data[l]=f},this.CreateScatterPlot=function(n,s,o,l){var h=new Bd;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.HQChart=n,h.Identify=this.Guid,h.Data.Data=o.Draw.DrawData,h.Color=o.Draw.Color,h.Radius=o.Draw.Radius,n.ChartPaint.push(h)},this.CreateClipColorStick=function(n,s,o,l){var h=new kd;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.HQChart=n,h.Identify=this.Guid,h.Data.Data=o.Draw.DrawData,o.Option&&h.SetOption&&h.SetOption(o.Option),n.ChartPaint.push(h);var u=s+1;if(o.IsShowTitle!==!1){var f=this.GetDefaultColor(l);o.Option&&o.Option.TitleColor&&(f=this.GetColor(o.Option.TitleColor)),n.TitlePaint[u].Data[l]=new re(h.Data,o.Name,f)}},this.CreateColorKLine=function(n,s,o,l){var h=new uh;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Data=n.ChartPaint[0].Data,h.KLineColor=o.Draw.DrawData.KLine,o.Color&&(h.Color=o.Color),n.ChartPaint.push(h)},this.CreateRectangle=function(n,s,o,l){var h=new zd;h.Canvas=n.Canvas,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,h.Color=[o.Draw.DrawData.Color],h.Rect=o.Draw.DrawData.Rect,o.Color&&(h.BorderColor=this.GetColor(o.Color)),n.ChartPaint.push(h)},this.CreateScriptOverlayLine=function(n,s,o,l){var h=new bd;if(h.Canvas=n.Canvas,h.DrawType=1,h.Name=o.Name,h.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=n.Frame.SubFrame[s].Frame,o.Color?h.Color=this.GetColor(o.Color):h.Color=this.GetDefaultColor(l),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(h.LineWidth=u)}o.IsDotLine&&(h.IsDotLine=!0),o.IsShow==!1&&(h.IsShow=!1);var f=s+1;h.Data.Data=o.Draw.DrawData.Data,h.MainData.Data=o.Draw.DrawData.MainData,o.Draw.DrawData.Title&&(n.TitlePaint[f].Data[l]=new re(h.Data,o.Draw.DrawData.Title,h.Color)),n.ChartPaint.push(h)},this.CreateSelfKLine=function(n,s,o){var l=new Pr;l.Canvas=n.Canvas,l.Name="Self Kline",l.Identify=this.Guid,l.ChartBorder=n.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=n.Frame.SubFrame[s].Frame,l.Data=o,l.IsShowMaxMinPrice=!1,l.IsShowKTooltip=!1,l.DrawType=this.KLineType,n.ChartPaint.push(l)},this.BindInstructionData=function(n,s,o){if(!(this.OutVar==null||this.OutVar.length<0)){var l="";for(var h in this.Arguments){var u=this.Arguments[h];l.length>0&&(l+=","),l+=u.Value.toString()}if(l.length>0&&(l="("+l+")"),this.InstructionType==2){var f=this.OutVar[this.OutVar.length-1];return n.SetInstructionData(this.InstructionType,{Data:f.Data,Name:this.Name,Param:l,ID:this.ID}),!0}else if(this.InstructionType==1){var C,D;for(var c in this.OutVar){var T=this.OutVar[c];T.Name=="ENTERLONG"?C=T.Data:T.Name=="EXITLONG"&&(D=T.Data)}return n.SetInstructionData(this.InstructionType,{Buy:C,Sell:D,Name:this.Name,Param:l,ID:this.ID}),!0}}},this.BindData=function(n,s,o){if(s==0&&this.InstructionType){this.BindInstructionData(n,s,o);return}if(n.DeleteIndexPaint(s),s==0&&n.ShowKLine(!0),!(this.OutVar==null||this.OutVar.length<0)){if(this.KLineType!=null&&(this.KLineType===0||this.KLineType===1||this.KLineType===2?this.CreateSelfKLine(n,s,o):this.KLineType===-1&&s==0&&n.ShowKLine(!1)),s>=1&&n.Frame){var l=n.Frame.SubFrame[s].Frame.YSplitOperator;l&&(l.Reset(),l.FloatPrecision=this.FloatPrecision,this.YAxis&&l.SetOption(this.YAxis)),this.YSpecificMaxMin&&(n.Frame.SubFrame[s].Frame.YSpecificMaxMin=this.YSpecificMaxMin),this.YSplitScale&&(n.Frame.SubFrame[s].Frame.YSplitScale=this.YSplitScale)}v.IsNumber(this.YSplitType)&&(n.Frame.SubFrame[s].Frame.YSplitOperator.SplitType=this.YSplitType);for(var h=0;h<this.OutVar.length;++h){var u=this.OutVar[h];if(u.IsExData!==!0&&!(u.Type==1e3||u.Type==1001)){if(u.Type==0)u.IsOverlayLine?this.CreateOverlayLine(n,s,u,h,u.Type):u.IsSingleLine?this.CreateSingleLine(n,s,u,h,u.Type):this.CreateLine(n,s,u,h,u.Type);else if(u.Type==1)switch(u.Draw.DrawType){case"STICKLINE":this.CreateBar(n,s,u,h);break;case"DRAWTEXT":this.CreateDrawTextV2(n,s,u,h);break;case"SUPERDRAWTEXT":this.CreateText(n,s,u,h);break;case"DRAWLINE":this.CreateStraightLine(n,s,u,h);break;case"DRAWBAND":this.CreateBand(n,s,u,h);break;case"FILLRGN":this.CreateFillRGN(n,s,u,h);break;case"FILLRGN2":this.CreateFillRGN2(n,s,u,h);break;case"FILLTOPRGN":case"FILLBOTTOMRGN":case"FILLVERTICALRGN":this.CreateFillBGRGN(n,s,u,h);break;case"FLOATRGN":this.CreateFLOATRGN(n,s,u,h);break;case"DRAWKLINE":case"DRAWKLINE1":this.CreateKLine(n,s,u,h);break;case"DRAWOVERLAYKLINE":this.CreateOverlayKLine(n,s,u,h);break;case"DRAWCOLORKLINE":this.CreateDrawColorKLine(n,s,u,h);break;case"DRAWKLINE_IF":this.CreateKLine(n,s,u,h);break;case"POLYLINE":this.CreatePolyLine(n,s,u,h);break;case"DRAWGBK":case"DRAWGBK2":this.CreateBackgroud(n,s,u,h);break;case"DRAWGBK_DIV":this.CreateBackgroundDiv(n,s,u,h);break;case"DRAWTEXT_LINE":this.CreateTextLine(n,s,u,h);break;case"DRAWNUMBER":this.CreateDrawNumber(n,s,u,h);break;case"DRAWNUMBER_FIX":case"DRAWTEXT_FIX":this.CreateNumberText(n,s,u,h);break;case"DRAWICON":this.CreateIcon(n,s,u,h);break;case"ICON":this.CreateIcon(n,s,u,h);break;case"TIPICON":this.CreateTipIcon(n,s,u,h);break;case"DRAWCHANNEL":this.CreateChannel(n,s,u,h);break;case"PARTLINE":this.CreatePartLine(n,s,u,h);break;case"DRAWRECTREL":this.CreateRectangle(n,s,u,h);break;case"DRAWTEXTABS":case"DRAWTEXTREL":this.CreateDrawText(n,s,u,h);break;case"DRAWOVERLAYLINE":this.CreateScriptOverlayLine(n,s,u,h);break;case"DRAWSL":this.CreateChartSlopeLine(n,s,u,h);break;case"VERTLINE":this.CreateChartVericaltLine(n,s,u,h);break;case"HORLINE":this.CreateChartHorizontalLine(n,s,u,h);break;case"MULTI_LINE":this.CreateMultiLine(n,s,u,h);break;case"MULTI_POINT":this.CreateMultiPoint(n,s,u,h);break;case"MULTI_BAR":this.CreateMultiBar(n,s,u,h);break;case"MULTI_TEXT":this.CreateMultiText(n,s,u,h);break;case"MULTI_SVGICON":this.CreateMultiSVGIcon(n,s,u,h);break;case"DRAWSVG":this.CreateChartDrawSVG(n,s,u,h);break;case"MULTI_HTMLDOM":this.CreateMulitHtmlDom(n,s,u,h);break;case"COLOR_KLINE":this.CreateColorKLine(n,s,u,h);break;case"KLINE_BG":this.CreateBackgroud(n,s,u,h);break;case"MULTI_POINT_LINE":this.CreateLineMultiData(n,s,u,h);break;case"BUY":case"SELL":case"SELLSHORT":case"BUYSHORT":this.CreateTradeIcon(n,s,u,h);break;case"DRAWLASTBARICON":case"DRAWLASTBARNUMBER":case"DRAWLASTBARTEXT":this.CreateDrawLastBarText(n,s,u,h);break;case Ja.OVERLAY_BARS:this.CreateStackedBar(n,s,u,h);break;case Ja.KLINE_TABLE:this.CreateKLineTable(n,s,u,h);break;case Ja.SCATTER_PLOT:this.CreateScatterPlot(n,s,u,h);break;case Ja.CLIP_COLOR_STICK:this.CreateClipColorStick(n,s,u,h);break;default:{var f=Ei.Get(u.Draw.DrawType);f&&f.CreateChartCallback&&f.CreateChartCallback(n,s,u,h,this)}break}else u.Type==2?this.CreateMACD(n,s,u,h):u.Type==3?this.CreatePointDot(n,s,u,h,o):u.Type==4?this.CreateLineStick(n,s,u,h):u.Type==5?this.CreateStick(n,s,u,h):u.Type==6?this.CreateVolStick(n,s,u,h,o):u.Type==7?this.CreateLine(n,s,u,h,u.Type):u.Type==8?this.CreateLine(n,s,u,h,u.Type):u.Type==9&&this.CreateArea(n,s,u,h);var D=n.TitlePaint[s+1];D&&D.Data&&h<D.Data.length&&(this.StringFormat>0&&(D.Data[h].StringFormat=this.StringFormat),this.FloatPrecision>=0&&(D.Data[h].FloatPrecision=this.FloatPrecision),this.OutName&&this.OutName.length>0&&this.Arguments&&this.Arguments.length>0&&D.SetDynamicTitle(this.OutName,this.Arguments))}}var C=s+1,D=n.TitlePaint[C];if(D.Title=this.Name,D.Identify=this.Guid,D.ArgumentsText=null,D.Script=this,D.IsShowMainIndexTitle=this.IsShowIndexTitle,!this.IsShortTitle){for(var c="",T=0;T<this.Arguments.length;++T){var S=this.Arguments[T];c.length>0&&(c+=","),c+=S.Value.toString()}c.length>0&&(D.ArgumentsText="("+c+")")}return this.TitleFont&&(D.Font=this.TitleFont),!0}},this.GetDefaultColor=function(n){var s=null;d&&d.Index&&d.Index.LineColor&&(s=d.Index.LineColor),(!s||!Array.isArray(s))&&(s=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"]);var o=parseInt(n);return s[o%(s.length-1)]},this.GetColor=function(n){if(n.indexOf("RGB(")==0)return n.toLowerCase();if(n.indexOf("rgb(")==0)return n;if(n.indexOf("RGBA(")==0)return n.toLowerCase();if(n.indexOf("rgba(")==0)return n;var s=be.ColorVarToRGB(n);return s||"rgb(30,144,255)"}}function cs(e,a,r,t){this.newMethod=Ie,this.newMethod(e,a,r,t),delete this.newMethod,this.ClassName="OverlayScriptIndex",this.OverlayIndex=null,this.ShowConditionError=function(n,s){var o=n.HQChart;n.WindowIndex;var l="指标不支持当前品种或周期";s&&(l=s);var h=this.OverlayIndex,u=h.Frame;u.ChartPaint=[];var f=new va;f.Canvas=o.Canvas,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.NotSupportMessage=l,u.ChartPaint.push(f),o.Draw()},this.BindData=function(n,s,o){if(!(!this.OverlayIndex||this.OverlayIndex.IsOverlay!=!0)&&(this.OverlayIndex.Frame.ChartPaint=[],!!v.IsNonEmptyArray(this.OutVar))){var l=this.OverlayIndex.Frame.Frame.YSplitOperator;l&&(l.Reset(),l.FloatPrecision=this.FloatPrecision,v.IsNumber(this.YSplitType)&&(l.SplitType=this.YSplitType),this.YAxis&&l.SetOption(this.YAxis));var h={Data:[],Title:this.Name,Frame:this.OverlayIndex.Frame.Frame,Script:this,IsShowIndexTitle:this.IsShowIndexTitle},u="";for(var f in this.Arguments){var C=this.Arguments[f];u.length>0&&(u+=","),u+=C.Value.toString()}u.length>0&&(h.Title=this.Name+"("+u+")");var D=s+1,c=n.TitlePaint[D];if(c.OverlayIndex.set(this.OverlayIndex.Identify,h),this.OutName&&this.OutName.length>0&&this.Arguments&&this.Arguments.length>0&&c.SetDynamicTitle(this.OutName,this.Arguments,this.OverlayIndex.Identify),this.OverlayIndex.Frame.Frame.Title=this.Name,n.Frame.SubFrame[s]){var T=n.Frame.SubFrame[s].Frame;T&&(this.OverlayIndex.Frame.Frame.XPointCount=T.XPointCount)}for(var f=0;f<this.OutVar.length;++f){var S=this.OutVar[f];if(S.IsExData!==!0){if(S.Type==0)this.CreateLine(n,s,S,f,S.Type);else if(S.Type==1)switch(S.Draw.DrawType){case"STICKLINE":this.CreateBar(n,s,S,f);break;case"DRAWTEXT":this.CreateDrawTextV2(n,s,S,f);break;case"SUPERDRAWTEXT":this.CreateText(n,s,S,f);break;case"DRAWLINE":this.CreateStraightLine(n,s,S,f);break;case"DRAWBAND":this.CreateBand(n,s,S,f);break;case"DRAWKLINE":this.CreateKLine(n,s,S,f);break;case"DRAWKLINE_IF":this.CreateKLine(n,s,S,f);break;case"POLYLINE":this.CreatePolyLine(n,s,S,f);break;case"DRAWGBK":case"DRAWGBK2":this.CreateBackgroud(n,s,S,f);break;case"DRAWNUMBER":case"DRAWNUMBER_FIX":case"DRAWTEXT_FIX":this.CreateNumberText(n,s,S,f);break;case"DRAWICON":this.CreateIcon(n,s,S,f);break;case"TIPICON":this.CreateTipIcon(n,s,S,f);break;case"DRAWCHANNEL":this.CreateChannel(n,s,S,f);break;case"DRAWTEXT_LINE":this.CreateTextLine(n,s,S,f);break;case"VERTLINE":this.CreateChartVericaltLine(n,s,S,f);break;case"HORLINE":this.CreateChartHorizontalLine(n,s,S,f);break;case"MULTI_LINE":this.CreateMultiLine(n,s,S,f);break;case"MULTI_POINT":this.CreateMultiPoint(n,s,S,f);break;case"MULTI_BAR":this.CreateMultiBar(n,s,S,f);break;case"MULTI_TEXT":this.CreateMultiText(n,s,S,f);break;case"MULTI_SVGICON":this.CreateMultiSVGIcon(n,s,S,f);break;case"DRAWSVG":this.CreateChartDrawSVG(n,s,S,f);break;case"MULTI_HTMLDOM":this.CreateMulitHtmlDom(n,s,S,f);break;case"KLINE_BG":this.CreateBackgroud(n,s,S,f);break;case"PARTLINE":this.CreatePartLine(n,s,S,f);break;case"DRAWTEXTABS":case"DRAWTEXTREL":this.CreateDrawText(n,s,S,f);break;case Ja.OVERLAY_BARS:this.CreateStackedBar(n,s,S,f);break;case"DRAWCOLORKLINE":this.CreateDrawColorKLine(n,s,S,f);break;default:{var I=Ei.Get(S.Draw.DrawType);I&&I.CreateChartCallback&&I.CreateChartCallback(n,s,S,f,this)}break}else S.Type==2?this.CreateMACD(n,s,S,f):S.Type==3?this.CreatePointDot(n,s,S,f,o):S.Type==4?this.CreateLineStick(n,s,S,f):S.Type==5?this.CreateStick(n,s,S,f):S.Type==6?this.CreateVolStick(n,s,S,f,o):S.Type==7?this.CreateLine(n,s,S,f,S.Type):S.Type==8&&this.CreateLine(n,s,S,f,S.Type);var g=h.Data[f];g&&(this.FloatPrecision>=0&&(g.FloatPrecision=this.FloatPrecision),v.IsNumber(this.StringFormat)&&(g.StringFormat=this.StringFormat))}}return!0}},this.RecvResultData=function(n,s){var o=s.HQChart,l=s.WindowIndex,h=s.HistoryData;s.Self.OutVar=n,s.Self.BindData(o,l,h),s.HQChart.UpdataDataoffset(),s.HQChart.UpdateFrameMaxMin(),s.Self.IsSync===!1&&s.HQChart.Draw();var u=o.GetOverlayIndexEvent();if(u){var f=s.Self,C={OutVar:f.OutVar,WindowIndex:l,Name:f.Name,Arguments:f.Arguments,HistoryData:h,Identify:f.OverlayIndex.Identify,Stock:{Symbol:o.Symbol,Name:o.Name}};u.Callback(u,C,f)}},this.ReloadChartResource=function(n,s,o){var l=n.GetEventCallback($.ON_RELOAD_OVERLAY_INDEX_CHART_RESOURCE);if(!(!l||!l.Callback)){var h=this.OverlayIndex,u=h.Frame,f=u.Script,C={Chart:o,IndexName:f.Name,IndexID:f.ID,HQChart:n,WindowIndex:s,Guid:h.Identify};l.Callback(l,C,this)}},this.CreateLine=function(n,s,o,l,h){var u=this.OverlayIndex,f=u.Frame;if(h==7)var C=new fh;else var C=new va;if(C.Canvas=n.Canvas,C.DrawType=1,C.Name=o.Name,C.ChartBorder=f.Frame.ChartBorder,C.ChartFrame=f.Frame,C.Identify=u.Identify,o.Color?C.Color=this.GetColor(o.Color):C.Color=this.GetDefaultColor(l),h==8&&(C.DrawType=2,C.BreakPoint=o.BreakPoint),o.LineWidth){var D=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(D)&&D>0&&(C.LineWidth=D)}o.IsShow==!1&&(C.IsShow=!1),C.Data.Data=o.Data,this.ReloadChartResource(n,s,C);var c=s+1,T=n.TitlePaint[c],S=new re(C.Data,o.Name,C.Color);this.SetTitleData(S,C),T.OverlayIndex.get(u.Identify).Data[l]=S,this.SetChartIndexName(C),f.ChartPaint.push(C)},this.CreateBar=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new VC;f.Canvas=n.Canvas,o.Draw.Width>0?f.Width=o.Draw.Width:f.Width=1,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(l),f.Data.Data=o.Draw.DrawData,this.SetChartIndexName(f),u.ChartPaint.push(f)},this.CreateDrawText=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new gi;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.ReloadResource(),o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(l),o.IsDrawAbove?f.Direction=1:f.Direction=0,f.DrawData=o.Draw.DrawData,o.DrawFontSize>0&&(f.TextFont=o.DrawFontSize*B()+"px 微软雅黑"),u.ChartPaint.push(f)},this.CreateDrawTextV2=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new al;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.ReloadResource(),o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(l),o.IsDrawCenter===!0&&(f.TextAlign="center"),o.IsDrawAbove===!0&&(f.TextBaseline="bottom"),o.IsDrawBelow===!0&&(f.TextBaseline="top"),o.Draw.DrawData&&(f.Data.Data=o.Draw.DrawData),f.Text=o.Draw.Text,o.Draw.Direction>0&&(f.Direction=o.Draw.Direction),o.Draw.YOffset>0&&(f.YOffset=o.Draw.YOffset),o.Draw.TextAlign&&(f.TextAlign=o.Draw.TextAlign),o.Draw.FixedPosition==="TOP"?f.FixedPosition=1:o.Draw.FixedPosition==="BOTTOM"&&(f.FixedPosition=2),o.DrawVAlign>=0&&(o.DrawVAlign==0?f.TextBaseline="top":o.DrawVAlign==1?f.TextBaseline="middle":o.DrawVAlign==2&&(f.TextBaseline="bottom")),o.DrawAlign>=0&&(o.DrawAlign==0?f.TextAlign="left":o.DrawAlign==1?f.TextAlign="center":o.DrawAlign==2&&(f.TextAlign="right")),o.DrawFontSize>0&&(f.FixedFontSize=o.DrawFontSize),o.Background&&(f.TextBG=o.Background),o.VerticalLine&&(f.VerticalLine=o.VerticalLine),v.IsNumber(o.XOffset)&&(f.ShowOffset.X=o.XOffset),v.IsNumber(o.YOffset)&&(f.ShowOffset.Y=o.YOffset),u.ChartPaint.push(f)},this.CreateText=function(n,s,o,l,h){var u=this.OverlayIndex,f=u.Frame,C=new gi;C.Canvas=n.Canvas,C.Name=o.Name,C.ChartBorder=f.Frame.ChartBorder,C.ChartFrame=f.Frame,C.Identify=u.Identify,C.ReloadResource(),o.Color?C.Color=this.GetColor(o.Color):C.Color=this.GetDefaultColor(l),o.Draw.Position&&(C.Position=o.Draw.Position),o.Draw.DrawData&&(C.Data.Data=o.Draw.DrawData),C.Text=o.Draw.Text,o.Draw.Direction>0&&(C.Direction=o.Draw.Direction),o.Draw.YOffset>0&&(C.YOffset=o.Draw.YOffset),o.Draw.TextAlign&&(C.TextAlign=o.Draw.TextAlign),f.ChartPaint.push(C)},this.CreateMACD=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new il;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify;var C=s+1;f.Data.Data=o.Data;var D=n.TitlePaint[C],c=this.GetDefaultColor(l);o.Color&&(c=this.GetColor(o.Color)),o.UpColor&&(f.UpColor=o.UpColor),o.DownColor&&(f.DownColor=o.DownColor),this.ReloadChartResource(n,s,f),D.OverlayIndex.get(h.Identify).Data[l]=new re(f.Data,o.Name,c),this.SetChartIndexName(f),u.ChartPaint.push(f)},this.CreatePointDot=function(n,s,o,l,h){var u=this.OverlayIndex,f=u.Frame,C=new wC;if(C.Canvas=n.Canvas,C.Name=o.Name,C.ChartBorder=f.Frame.ChartBorder,C.ChartFrame=f.Frame,C.Identify=u.Identify,o.Color?C.Color=this.GetColor(o.Color):C.Color=this.GetDefaultColor(l),o.Radius&&(C.Radius=o.Radius),o.LineWidth){var D=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(D)&&D>0&&(C.Radius=D)}v.IsBool(o.UpDownDot)&&(C.EnableUpDownColor=o.UpDownDot,C.HistoryData=h);var c=s+1;C.Data.Data=o.Data;var T=n.TitlePaint[c];T.OverlayIndex.get(u.Identify).Data[l]=new re(C.Data,o.Name,C.Color),this.SetChartIndexName(C),f.ChartPaint.push(C)},this.CreateStick=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new tl;if(f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(l),o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(C)&&C>0&&(f.LineWidth=C)}var D=s+1;f.Data.Data=o.Data,this.ReloadChartResource(n,s,f);var c=n.TitlePaint[D];c.OverlayIndex.get(h.Identify).Data[l]=new re(f.Data,o.Name,f.Color),u.ChartPaint.push(f)},this.CreateLineStick=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new GC;if(f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(l),o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(C)&&C>0&&(f.LineWidth=C)}var D=s+1;f.Data.Data=o.Data;var c=n.TitlePaint[D];c.OverlayIndex.get(h.Identify).Data[l]=new re(f.Data,o.Name,f.Color),u.ChartPaint.push(f)},this.CreateStraightLine=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new va;if(f.DrawType=1,f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(l),o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(C)&&C>0&&(f.LineWidth=C)}f.Data.Data=o.Draw.DrawData,u.ChartPaint.push(f)},this.CreateVolStick=function(n,s,o,l,h){var u=this.OverlayIndex,f=u.Frame,C=new el;if(C.Canvas=n.Canvas,C.Name=o.Name,C.ChartBorder=f.Frame.ChartBorder,C.ChartFrame=f.Frame,C.Identify=u.Identify,C.KLineDrawType=n.KLineDrawType,o.Color?C.Color=this.GetColor(o.Color):C.Color=this.GetDefaultColor(l),o.UpColor&&(C.UpColor=o.UpColor),o.DownColor&&(C.DownColor=o.DownColor),v.IsNumber(o.StickType)&&(C.BarType=o.StickType),v.IsNumber(o.BarColorType)&&(C.BarColorType=o.BarColorType),o.LineWidth){var D=parseInt(o.LineWidth.replace("LINETHICK",""));v.IsPlusNumber(D)&&(C.BarWidth=D)}var c=s+1;C.Data.Data=o.Data,C.HistoryData=h,this.ReloadChartResource(n,s,C);var T=n.TitlePaint[c],S=new re(C.Data,o.Name,C.Color);T.OverlayIndex.get(u.Identify).Data[l]=S,this.SetTitleData(S,C),this.SetChartIndexName(C),f.ChartPaint.push(C)},this.CreateBand=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new XC;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.FirstColor=o.Draw.Color[0],f.SecondColor=o.Draw.Color[1],f.Data.Data=o.Draw.DrawData,v.IsBool(o.IsFirstDraw)&&(f.IsDrawFirst=o.IsFirstDraw),this.SetChartIndexName(f),u.ChartPaint.push(f)},this.CreateKLine=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new Pr;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.Data.Data=o.Draw.DrawData,f.IsShowMaxMinPrice=!1,f.IsShowKTooltip=!1,o.Color&&(f.UnchagneColor=f.DownColor=f.UpColor=this.GetColor(o.Color)),u.ChartPaint.push(f)},this.CreatePolyLine=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new va;if(f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(l),o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(C)&&C>0&&(f.LineWidth=C)}var D=s+1;f.Data.Data=o.Draw.DrawData;var c=n.TitlePaint[D];c.OverlayIndex.get(h.Identify).Data[l]=new re(line.Data," ",line.Color),u.ChartPaint.push(f)},this.CreateNumberText=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new gi;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.ReloadResource(),f.TextAlign="center",o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(l),o.IsDrawAbove?f.Direction=1:f.Direction=2,o.Draw.Position&&(f.Position=o.Draw.Position),f.Data.Data=o.Draw.DrawData.Value,f.Text=o.Draw.DrawData.Text,this.SetChartIndexName(f),u.ChartPaint.push(f)},this.CreateTextLine=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new zC;if(f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,o.Draw&&o.Draw.DrawData){var C=o.Draw.DrawData;f.Text=C.Text,f.Line=C.Line,f.Price=C.Price}u.ChartPaint.push(f)},this.CreateStackedBar=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new tD;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,v.IsNonEmptyArray(o.Draw.BarColor)&&(f.BarColor=o.Draw.BarColor),v.IsNonEmptyArray(o.Draw.BarName)&&(f.BarName=o.Draw.BarName),v.IsNumber(o.Draw.LineWidth)&&(f.LineWidth=o.Draw.LineWidth),v.IsNumber(o.Draw.BarType)&&(f.BarType=o.Draw.BarType),f.Data.Data=o.Draw.DrawData;var C=s+1,D=n.TitlePaint[C],c=new re(f.Data,f.BarName,f.BarColor);c.DataType="ChartStackedBar",D.OverlayIndex.get(h.Identify).Data[l]=c,u.ChartPaint.push(f)},this.CreateDrawColorKLine=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new uh;f.Canvas=n.Canvas,f.Name=o.Name,f.DrawName="DRAWCOLORKLINE",f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.Data.Data=o.Draw.DrawData,v.IsBool(o.Draw.IsEmptyBar)&&(f.IsEmptyBar=o.Draw.IsEmptyBar),o.Draw.Color&&(f.Color=o.Draw.Color),u.ChartPaint.push(f)},this.CreateIcon=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new gi;f.Canvas=n.Canvas,f.TextAlign="center",f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,o.DrawVAlign>=0&&(o.DrawVAlign==0?f.Direction=1:o.DrawVAlign==1?f.Direction=0:o.DrawVAlign==2&&(f.Direction=2)),o.DrawAlign>=0&&(o.DrawAlign==0?f.TextAlign="left":o.DrawAlign==1?f.TextAlign="center":o.DrawAlign==2&&(f.TextAlign="right")),v.IsNumber(o.XOffset)&&(f.ShowOffset.X=o.XOffset),v.IsNumber(o.YOffset)&&(f.ShowOffset.Y=o.YOffset),f.Data.Data=o.Draw.DrawData;var C=o.Draw.Icon;C.IconFont==!0?f.IconFont={Family:C.Family,Text:C.Symbol,Color:C.Color}:(f.Text=C.Symbol,o.Color?f.Color=this.GetColor(o.Color):C.Color?f.Color=C.Color:f.Color="rgb(0,0,0)"),this.SetChartIndexName(f),u.ChartPaint.push(f)},this.CreateTipIcon=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new Cn;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,n.ChartPaint[0].IsMinuteFrame()?f.Data=n.SourceData:f.Data=n.ChartPaint[0].Data,f.Family=o.Draw.Icon.Family,f.TextFont=d.TIPICON.TextFont;var C=d.TIPICON.Size,D=d.TIPICON.Color,c=0,T=2;if(v.IsNumber(o.YOffset)&&(c=o.YOffset),o.Color&&(D=this.GetColor(o.Color)),o.DrawFontSize>0&&(C=o.DrawFontSize),o.DrawVAlign>=0&&(T=o.DrawVAlign),o.Draw&&v.IsNonEmptyArray(o.Draw.DrawData)&&o.Draw.Icon){var S=o.Draw.DrawData,I=[],g=Array.isArray(o.Draw.Text),E=null;!g&&o.Draw.Text&&(E={Text:o.Draw.Text});for(var F=0;F<S.length;++F){var R=S[F];if(v.IsNumber(R)){var A={Index:F,Value:R,SVG:{Symbol:o.Draw.Icon.Symbol,Size:C,Color:D,YOffset:c,VAlign:T}};if(g){var P=o.Draw.Text[F];P&&(A.Tooltip={Text:P})}else A.Tooltip=E;I.push(A)}}f.Texts=I}u.ChartPaint.push(f)},this.CreateChannel=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new UC;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,o.Draw.AreaColor?f.AreaColor=o.Draw.AreaColor:o.Color?f.AreaColor=this.GetColor(o.Color):f.AreaColor=this.GetDefaultColor(l),o.Draw.Border.Color?f.LineColor=o.Draw.Border.Color:f.LineColor=null,o.Draw.Border.Dotted&&(f.LineDotted=o.Draw.Border.Dotted),o.Draw.Border.Width>0&&(f.LineWidth=o.Draw.Border.Width),f.Data.Data=o.Draw.DrawData,u.ChartPaint.push(f)},this.CreatePartLine=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new bC;if(f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));v.IsPlusNumber(C)&&(f.LineWidth=C)}f.Data.Data=o.Draw.DrawData,this.SetChartIndexName(f),u.ChartPaint.push(f)},this.CreateMultiLine=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new ZC;if(f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.Data=n.ChartPaint[0].Data,f.Lines=o.Draw.DrawData,o.Draw.LineDash&&(f.LineDash=o.Draw.LineDash),v.IsNumber(o.Draw.LineWidth)&&(f.LineWidth=o.Draw.LineWidth),v.IsBool(o.Draw.IsFullRangeMaxMin)&&(f.IsFullRangeMaxMin=o.Draw.IsFullRangeMaxMin),o.Draw.Arrow){var C=o.Draw.Arrow;C.Start==!0&&(f.Arrow.Start=!0),C.End==!0&&(f.Arrow.End=!0),v.IsNumber(C.Angle)&&(f.ArrawAngle=C.Angle),v.IsNumber(C.Length)&&(f.ArrawLength=C.Length),v.IsNumber(C.LineWidth)&&(f.ArrawLineWidth=C.LineWidth)}this.ReloadChartResource(n,s,f),this.SetChartIndexName(f),u.ChartPaint.push(f)},this.CreateMultiPoint=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new QC;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.Data=n.ChartPaint[0].Data,f.PointGroup=o.Draw.DrawData,u.ChartPaint.push(f)},this.CreateBackgroud=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new KC;if(f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,o.Draw&&o.Draw.DrawData){var C=o.Draw.DrawData;f.Color=C.Color,f.ColorAngle=C.Angle,C.Data&&(f.Data.Data=C.Data)}u.ChartPaint.push(f)},this.CreateMultiBar=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new JC;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.Data=n.ChartPaint[0].Data,f.Bars=o.Draw.DrawData;var C=s+1,D=n.TitlePaint[C],c=new re({KData:f.Data,BarData:f.Bars},o.Name,null);c.IsShow=!1,c.DataType="MULTI_BAR",D.OverlayIndex.get(h.Identify).Data[l]=c,this.SetChartIndexName(f),u.ChartPaint.push(f)},this.CreateMultiText=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new $C;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.Data=n.ChartPaint[0].Data,f.Texts=o.Draw.DrawData,this.SetChartIndexName(f),u.ChartPaint.push(f)},this.CreateMultiSVGIcon=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new qC;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.Data=n.ChartPaint[0].Data,f.Family=o.Draw.DrawData.Family,f.AryIcon=o.Draw.DrawData.Icon,f.BuildCacheData(),this.SetChartIndexName(f),u.ChartPaint.push(f)},this.CreateChartDrawSVG=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new Cn;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,n.ChartPaint[0].IsMinuteFrame()?f.Data=n.SourceData:f.Data=n.ChartPaint[0].Data,v.IsBool(o.Draw.DrawData.EnableTooltip)&&(f.EnableTooltip=o.Draw.DrawData.EnableTooltip),v.IsBool(o.Draw.DrawData.IsDrawFirst)&&(f.IsDrawFirst=o.Draw.DrawData.IsDrawFirst),f.Family=o.Draw.DrawData.Family,f.TextFont=o.Draw.DrawData.TextFont,f.Texts=o.Draw.DrawData.Data,o.Draw.AutoPosition&&(f.AutoPosition=o.Draw.AutoPosition),this.ReloadChartResource(n,s,f),this.SetChartIndexName(f),u.ChartPaint.push(f)},this.CreateMulitHtmlDom=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new jC;f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.HQChart=n,f.Data=n.ChartPaint[0].Data,f.Texts=o.Draw.DrawData,f.DrawCallback=o.Draw.Callback,u.ChartPaint.push(f)},this.CreateChartVericaltLine=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new _C;if(f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.HQChart=n,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(l),o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(C)&&C>0&&(f.LineWidth=C)}this.SetChartLineDash(f,o.Draw.DrawData),f.Data.Data=o.Draw.DrawData.Data,u.ChartPaint.push(f)},this.CreateChartHorizontalLine=function(n,s,o,l){var h=this.OverlayIndex,u=h.Frame,f=new HC;if(f.Canvas=n.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=h.Identify,f.HQChart=n,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(l),o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(C)&&C>0&&(f.LineWidth=C)}this.SetChartLineDash(f,o.Draw.DrawData),f.ExtendType=o.Draw.DrawData.Extend,f.Data.Data=o.Draw.DrawData.Data,u.ChartPaint.push(f)},this.CreateSelfKLine=function(n,s,o){var l=this.OverlayIndex,h=l.Frame,u=new Pr;u.Canvas=n.Canvas,u.Name="Self Kline",u.ChartBorder=h.Frame.ChartBorder,u.ChartFrame=h.Frame,u.Identify=l.Identify,u.Data=o,u.IsShowMaxMinPrice=!1,u.IsShowKTooltip=!1,u.DrawType=this.KLineType,h.ChartPaint.push(u)},this.GetDefaultColor=function(n){var s=["rgb(24,71,178)","rgb(42,230,215)","rgb(252,96,154)","rgb(0,128,255)","rgb(229,0,79)","rgb(68,114,196)","rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)"],o=parseInt(n);return s[o%(s.length-1)]}}function ga(e,a,r,t,n){n?this.newMethod=cs:this.newMethod=Ie,this.newMethod(e,a,r,t),delete this.newMethod,this.ClassName="APIScriptIndex",this.IsOverlayIndex=n==!0,this.ApiUrl,this.HQDataType,this.Version=1,t&&t.API&&(t.API.Url&&(this.ApiUrl=t.API.Url),t.API.Name&&(this.Name=this.ID=t.API.Name),t.API.ID&&(this.ID=t.API.ID),t.API.Version>0&&(this.Version=t.API.Version),t.API.IsUsePageData===!0&&(this.IsUsePageData=t.API.IsUsePageData)),this.Super_CopyTo=this.CopyTo,this.CopyTo=function(s){this.Super_CopyTo(s),s.ApiUrl=this.ApiUrl,s.Version=this.Version,s.IsOverlayIndex=this.IsOverlayIndex},this.RecvSubscribeData=function(s,o,l,h){this.Version==2?this.RecvAPIData2(s,o,l,h):this.RecvAPIData(s,o,l,h)},this.ExecuteScript=function(s,o,l){k.Complier.Log("[APIScriptIndex::ExecuteScript] name, Arguments ",this.Name,this.Arguments);var h=wt.KLINE_ID,u=null;s.ClassName==="MinuteChartContainer"||s.ClassName==="MinuteChartHScreenContainer"?(s.DayCount>1?h=wt.MULTIDAY_MINUTE_ID:h=wt.MINUTE_ID,u=l.GetDateRange()):s.ClassName==="HistoryMinuteChartContainer"?h=wt.HISTORY_MINUTE_ID:u=l.GetDateRange();var f=[];if(this.Arguments)for(var C in this.Arguments){var D=this.Arguments[C];f.push({name:D.Name,value:D.Value})}var c;s.GetRequestDataCount&&(c=s.GetRequestDataCount());var T=this,S={indexname:this.ID,symbol:s.Symbol,script:this.Script,args:f,period:s.Period,right:s.Right,hqdatatype:h};if(u&&(S.DateRange=u),c&&(S.maxdatacount=c.MaxRequestDataCount,S.maxminutedaycount=c.MaxRequestMinuteDayCount),(h==wt.MULTIDAY_MINUTE_ID||h==wt.MINUTE_ID)&&(S.daycount=s.DayCount),this.HQDataType=h,++this.RunCount,s.NetworkFilter){var I={Name:"APIScriptIndex::ExecuteScript",Explain:"指标计算",Request:{Url:T.ApiUrl,Type:"POST",Data:S},Self:this,HQChart:s,PreventDefault:!1};if(s.NetworkFilter(I,function(g){T.Version==2?T.RecvAPIData2(g,s,o,l):T.RecvAPIData(g,s,o,l)}),I.PreventDefault==!0)return}Vt.HttpRequest({url:T.ApiUrl,data:S,type:"post",dataType:"json",async:!0,success:function(E){T.RecvAPIData(E,s,o,l)},error:function(E){T.RecvError(E)}})},this.RecvAPIData2=function(s,o,l,h){if(k.Complier.Log("[APIScriptIndex::RecvAPIData2] recv data ",this.Name,s),this.HQDataType==wt.KLINE_ID?(this.OutVar=this.ConvertToLocalData(s,o),k.Complier.Log("[APIScriptIndex::RecvAPIData2] conver to OutVar ",this.OutVar)):this.HQDataType==wt.MINUTE_ID?(this.OutVar=this.ConvertToLocalData(s,o),k.Complier.Log("[APIScriptIndex::RecvAPIData2] conver to OutVar ",this.OutVar)):this.HQDataType==wt.MULTIDAY_MINUTE_ID&&(this.OutVar=this.ConvertToLocalData(s,o),k.Complier.Log("[APIScriptIndex::RecvAPIData2] conver to OutVar ",this.OutVar)),this.BindData(o,l,h),o.UpdataDataoffset(),o.UpdateFrameMaxMin(),o.Draw(),o.GetIndexEvent){var u=o.GetIndexEvent();if(u){var s={OutVar:this.OutVar,WindowIndex:l,Name:this.Name,Arguments:this.Arguments,HistoryData:h,Stock:{Symbol:o.Symbol,Name:o.Name}};u.Callback(u,s,this)}}},this.ConvertToLocalData=function(s,o){var l=s.OutVar;if(o.ClassName=="MinuteChartContainer"||o.ClassName=="MinuteChartHScreenContainer")var h=o.SourceData,u=h.GetAPIDataIndex(s.Date,s.Time);else{var h=o.ChartPaint[0].Data;if(Y.IsDayPeriod(s.Period,!0))var u=h.GetAPIDataIndex(s.Date);else var u=h.GetAPIDataIndex(s.Date,s.Time)}var f=[];for(var C in l){var D=l[C],c={Type:D.Type,Name:D.Name};if(D.Type==0){c.Data=[];for(var T=0;T<u.length;++T){var S=u[T];S.Index<0?c.Data[T]=null:c.Data[T]=D.Data[S.Index]}c.Name&&c.Name.indexOf("@NODRAW@")>=0&&(c.Name=c.Name.replace("@NODRAW@",""))}else if(D.Type==1){c.Name=D.DrawType,c.Draw={DrawType:D.DrawType};var I=D.Draw;switch(D.DrawType){case"STICKLINE":{for(var g=[],T=0;T<u.length;++T){g[T]=null;var S=u[T],E=S.Index;if(!(E<0)){var F=I.Price[E],R=I.Price2[E];!v.IsNumber(F)||!v.IsNumber(R)||(g[T]={Value:F,Value2:R})}}c.Draw.DrawData=g,c.Draw.Width=I.Width,c.Draw.Type=I.Empty}break;case"DRAWTEXT":{for(var g=[],A=[],T=0;T<u.length;++T){g[T]=null;var S=u[T],E=S.Index;if(!(E<0)){var F=I.Price[E];if(v.IsNumber(F)&&(g[T]=F),Array.isArray(I.Text)){var D=I.Text[E];v.IsString(D)&&(A[T]=D)}}}Array.isArray(I.Text)?c.Draw.Text=A:c.Draw.Text=I.Text,c.Draw.DrawData=g}break;case"DRAWNUMBER":{for(var g={Value:[],Text:[]},T=0;T<u.length;++T){g.Value[T]=null,g.Text[T]=null;var S=u[T],E=S.Index;if(!(E<0)){var F=I.Price[E],P=I.Number[E];!v.IsNumber(F)||!v.IsNumber(P)||(g.Value[T]=F,g.Text[T]=P.toFixed(2))}}c.Draw.DrawData=g}break;case"DRAWBAND":{for(var g=[],T=0;T<u.length;++T){g[T]=null;var S=u[T],E=S.Index;if(!(E<0)){var F=I.Val1[E],R=I.Val2[E];!v.IsNumber(F)||!v.IsNumber(R)||(g[T]={Value:F,Value2:R})}}c.Draw.DrawData=g,c.Draw.Color=[null,null],I.Color1&&(c.Draw.Color[0]=I.Color1.toLowerCase()),I.Color2&&(c.Draw.Color[1]=I.Color2.toLowerCase())}break;case"DRAWKLINE":{for(var g=[],T=0;T<u.length;++T){var D={Open:null,High:null,Low:null,Close:null};g[T]=D;var S=u[T],E=S.Index;if(!(E<0)){var p=I.High[E],w=I.Low[E],H=I.Open[E],W=I.Close[E];v.IsPlusNumber(p)&&v.IsPlusNumber(w)&&v.IsPlusNumber(H)&&v.IsPlusNumber(W)&&(D.Open=H,D.Close=W,D.High=p,D.Low=w)}}c.Draw.DrawData=g}break;case"DRAWTEXT_FIX":{for(var g={Value:[],Text:[]},T=0;T<u.length;++T){g.Value[T]=0,g.Text[T]=null;var S=u[T],E=S.Index;if(!(E<0)){var ht=I.Cond[E];ht&&(g.Value[T]=1,g.Text[T]=I.Text)}}c.Draw.DrawData=g,c.Draw.Position={X:I.X,Y:I.Y,Type:I.Type}}break;case"DRAWNUMBER_FIX":{for(var g={Value:[],Text:[]},T=0;T<u.length;++T){g.Value[T]=null,g.Text[T]=null;var S=u[T],E=S.Index;if(!(E<0)){var rt=I.Number[E];v.IsNumber(rt)&&(g.Value[T]=rt,g.Text[T]=v.RemoveZero(rt.toFixed(2)))}}c.Draw.DrawData=g,c.Draw.Position={X:I.X,Y:I.Y,Type:I.Type}}break;case"DRAWICON":{var nt=Yt.GetDrawIcon(I.Type);nt||Yt.GetDrawTextIcon(I.Type),nt||(nt={Symbol:"🚩"}),c.Draw.Icon=nt;for(var g=[],T=0;T<u.length;++T){g[T]=null;var S=u[T],E=S.Index;if(!(E<0)){var rt=I.Price[E];v.IsNumber(rt)&&(g[T]=rt)}}c.Draw.DrawData=g}break;case"PARTLINE":{for(var g=[],T=0;T<u.length;++T){g[T]={Value:null,RGB:null};var S=u[T],E=S.Index;if(!(E<0)){var vt=I.Color[E];if(v.IsString(vt)){var rt=I.Price[E];v.IsNumber(rt)&&(g[T].Value=rt,g[T].RGB=vt)}}}c.Draw.DrawData=g}break;case"FILLRGN":{for(var g=[],T=0;T<u.length;++T){g[T]=null;var S=u[T],E=S.Index;if(!(E<0)){var vt=I.Color[E];if(v.IsString(vt)){var rt=I.Price[E];if(v.IsNumber(rt)){var Nt=I.Price2[E];v.IsNumber(Nt)&&(g[T]={Value:rt,Value2:Nt,Color:vt})}}}}c.Draw.DrawData=g,c.Draw.DrawType="FILLRGN2"}break;default:continue}}else continue;for(var C in D.Attribute){var Ft=D.Attribute[C];switch(Ft){case"COLORSTICK":c.Type=2;break;case"POINTDOT":c.Radius=d.POINTDOT.Radius,c.Type=3;break;case"CIRCLEDOT":c.Radius=d.CIRCLEDOT.Radius,c.Type=3;break;case"DOTLINE":c.IsDotLine=!0;break;case"DRAWABOVE":c.IsDrawAbove=!0;break;case"LINESTICK":c.Type=4;break;case"STICK":c.Type=5;break;case"VOLSTICK":c.Type=6;break;case"LINEAREA":c.Type=9;break;case"NODRAW":c.IsShow=!1;break;case"NONE_OUT_NAME":c.NoneName=!0;break;case"NOTEXT":c.IsShowTitle=!1;break}Ft.indexOf("COLOR")==0?c.Color=Ft:Ft.indexOf("LINETHICK")==0&&(c.LineWidth=Ft)}f.push(c)}return f},this.RecvAPIData=function(s,o,l,h){if(k.Complier.Log("[APIScriptIndex::RecvAPIData] recv data ",this.Name,s),s.code==0){if(o.EnableVerifyRecvData&&(!s.stock||o.Symbol!=s.stock.symbol)){k.Chart.Warn("[APIScriptIndex::RecvAPIData] recv data symbol not match. HQChart["+o.Symbol+"]");return}if(s.error&&v.IsString(s.error.message)){var u={HQChart:o,WindowIndex:l,HistoryData:h,Self:this};this.ShowConditionError(u,s.error.message);return}if(s.outdata&&s.outdata.name&&(this.Name=s.outdata.name),s.outdata.args){this.Arguments=[];for(var f in s.outdata.args){var C=s.outdata.args[f];this.Arguments.push({Name:C.name,Value:C.value})}}if(this.HQDataType==wt.KLINE_ID?(this.OutVar=this.FittingData(s.outdata,o),k.Complier.Log("[APIScriptIndex::RecvAPIData] conver to OutVar ",this.OutVar)):this.OutVar=this.FittingMinuteData(s.outdata,o),this.BindData(o,l,h),this.IsLocked==!1)o.Frame.SubFrame[l].Frame.SetLock(null);else{var D={IsLocked:!0,Callback:this.LockCallback,IndexName:this.Name,ID:this.LockID,BG:this.LockBG,Text:this.LockText,TextColor:this.LockTextColor,Font:this.LockFont,Count:this.LockCount,MinWidth:this.LockMinWidth};o.Frame.SubFrame[l].Frame.SetLock(D)}if(o.UpdataDataoffset(),o.UpdateFrameMaxMin(),s.Redraw===!1||this.IsSync===!1&&o.Draw(),o.GetIndexEvent){var c=o.GetIndexEvent();if(c){var s={OutVar:this.OutVar,WindowIndex:l,Name:this.Name,Arguments:this.Arguments,HistoryData:h,Stock:{Symbol:o.Symbol,Name:o.Name}};c.Callback(c,s,this)}}}},this.FittingArray=function(s,o,l,h,u){var f=h.ChartPaint[0].Data,C=[];for(var D in s){var c=s[D],T=new Wt;T.Date=o[D],l&&D<l.length&&(T.Time=l[D]),T.Value=c,C.push(T)}var S;Y.IsDayPeriod(h.Period,!0)?S=f.GetFittingData(C):S=f.GetMinuteFittingData(C);var I=new Y;I.Data=S;var g;return u==1?g=I.GetObject():g=I.GetValue(),g},this.FittingMultiLine=function(s,o,l,h){var u=h.ChartPaint[0].Data;if(Y.IsDayPeriod(h.Period,!0)){var u=h.ChartPaint[0].Data,f=[];for(var C in s){var D=s[C];for(var c in D.Point){var T=D.Point[c];f.push(T)}}return f.sort(function(g,E){return g.Date-E.Date}),u.GetDateIndex(f),s}else if(Y.IsMinutePeriod(h.Period,!0)||Y.IsTickPeriod(h.Period)||Y.IsSecondPeriod(h.Period)){var u=h.ChartPaint[0].Data,f=[];for(var C in s){var D=s[C];for(var c in D.Point){var T=D.Point[c];f.push(T)}}return f.sort(function(E,F){return E.Date==F.Date?E.Time-F.Time:E.Date-F.Date}),u.GetDateTimeIndex(f),s}else if(this.HQDataType==wt.MINUTE_ID||this.HQDataType==wt.MULTIDAY_MINUTE_ID){var S=h.SourceData,f=[];for(var C in s){var D=s[C];for(var c in D.Point){var T=D.Point[c];f.push(T)}}return f.sort(function(g,E){return g.Date==E.Date?g.Time-E.Time:g.Date-E.Date}),S.GetDateTimeIndex(f),s}return null},this.FittingMultiText=function(s,o,l,h){if(Y.IsDayPeriod(h.Period,!0)){var u=h.ChartPaint[0].Data;return s.sort(function(C,D){return C.Date-D.Date}),u.GetDateIndex(s),s}else if(Y.IsMinutePeriod(h.Period,!0)||Y.IsTickPeriod(h.Period)||Y.IsSecondPeriod(h.Period)||Y.IsMilliSecondPeriod(h.Period)){var u=h.ChartPaint[0].Data;return s.sort(function(D,c){return D.Date==c.Date?D.Time-c.Time:D.Date-c.Date}),u.GetDateTimeIndex(s),s}else if(this.HQDataType==wt.MINUTE_ID||this.HQDataType==wt.MULTIDAY_MINUTE_ID){var f=h.SourceData;return s.sort(function(C,D){return C.Date==D.Date?C.Time-D.Time:C.Date-D.Date}),f.GetDateTimeIndex(s),s}return null},this.FittingData=function(s,o){var l=s.outvar,h=s.date,u=s.time;o.ChartPaint[0].Data;var f=[];if(!l)return f;for(var C=0;C<l.length;++C){var D=l[C],c={Name:D.name,Type:D.type};if(D.color&&(c.Color=D.color),v.IsBool(D.IsShowTitle)&&(c.IsShowTitle=D.IsShowTitle),D.data)c.Data=this.FittingArray(D.data,h,u,o),D.color&&(c.Color=D.color),D.linewidth&&(c.LineWidth=D.linewidth),v.IsBool(D.isshow)&&(c.IsShow=D.isshow),D.isexdata==!0&&(c.IsExData=!0),D.BreakPoint&&(c.BreakPoint=D.BreakPoint),D.UpColor&&(c.UpColor=D.UpColor),D.DownColor&&(c.DownColor=D.DownColor),v.IsBool(D.isDotLine)&&(c.IsDotLine=D.isDotLine),v.IsNonEmptyArray(D.lineDash)&&(c.LineDash=D.lineDash),v.IsBool(D.isSingleLine)&&(c.IsSingleLine=D.isSingleLine),v.IsNumber(D.StickType)&&(c.StickType=D.StickType),v.IsNumber(D.BarColorType)&&(c.BarColorType=D.BarColorType),f.push(c);else if(D.Draw){var T=D.Draw,S={};if(T.DrawType=="DRAWICON")S.Icon=T.Icon,S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData=this.FittingArray(T.DrawData,h,u,o),c.Draw=S,f.push(c);else if(T.DrawType=="DRAWTEXT")S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData=this.FittingArray(T.DrawData,h,u,o),c.Draw=S,f.push(c);else if(T.DrawType=="STICKLINE")S.Name=T.Name,S.Type=T.Type,S.Width=T.Width,S.DrawType=T.DrawType,S.DrawData=this.FittingArray(T.DrawData,h,u,o,1),c.Draw=S,f.push(c);else if(T.DrawType=="DRAWBAND")S.Name=T.Name,S.Type=T.Type,S.DrawType=T.DrawType,S.DrawData=this.FittingArray(T.DrawData,h,u,o,1),S.Color=T.Color,c.Draw=S,f.push(c);else if(T.DrawType=="MULTI_LINE"){if(S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData=this.FittingMultiLine(T.DrawData,h,u,o),v.IsNonEmptyArray(S.DrawData))for(var I=0;I<S.DrawData.length;++I)this.GetKLineData(S.DrawData[I].Point,o);c.Draw=S,T.LineDash&&(S.LineDash=T.LineDash),v.IsBool(T.IsFullRangeMaxMin)&&(S.IsFullRangeMaxMin=T.IsFullRangeMaxMin),T.Arrow&&(S.Arrow=T.Arrow),v.IsNumber(T.LineWidth)&&(S.LineWidth=T.LineWidth),f.push(c)}else if(T.DrawType=="MULTI_POINT"){if(S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData=this.FittingMultiLine(T.DrawData,h,u,o),v.IsNonEmptyArray(S.DrawData))for(var I=0;I<S.DrawData.length;++I)this.GetKLineData(S.DrawData[I].Point,o);c.Draw=S,f.push(c)}else if(T.DrawType=="MULTI_BAR")S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData=this.FittingMultiLine(T.DrawData,h,u,o),c.Draw=S,f.push(c);else if(T.DrawType==Ja.OVERLAY_BARS)S.Name=T.Name,S.Type=T.Type,S.DrawType=T.DrawType,S.BarName=T.BarName,S.BarColor=T.BarColor,S.LineWidth=T.LineWidth,S.BarType=T.BarType,S.DrawData=this.FittingArray(T.DrawData,h,u,o,1),c.Draw=S,f.push(c);else if(T.DrawType==Ja.SCATTER_PLOT)S.Name=T.Name,S.Type=T.Type,S.DrawType=T.DrawType,S.DrawData=this.FittingArray(T.DrawData,h,u,o,1),S.Color=T.Color,S.Radius=T.Radius,c.Draw=S,f.push(c);else if(T.DrawType==Ja.KLINE_TABLE)S.Name=T.Name,S.Type=T.Type,S.DrawType=T.DrawType,S.DrawData=this.FittingArray(T.DrawData,h,u,o,1),S.RowCount=T.RowCount,S.RowName=T.RowName,S.IsShowRowName=T.IsShowRowName,S.BGColor=T.BGColor,c.Draw=S,f.push(c);else if(T.DrawType=="MULTI_TEXT")S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData=this.FittingMultiText(T.DrawData,h,u,o),this.GetKLineData(S.DrawData,o),c.Draw=S,f.push(c);else if(T.DrawType=="MULTI_SVGICON")S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData={Icon:T.DrawData.Icon,Family:T.DrawData.Family},c.Draw=S,f.push(c);else if(T.DrawType=="DRAWSVG")S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,T.AutoPosition&&(S.AutoPosition=T.AutoPosition),S.DrawData={Data:this.FittingMultiText(T.Data,h,u,o),Family:T.Family,TextFont:T.TextFont,EnableTooltip:T.EnableTooltip,IsDrawFirst:T.IsDrawFirst},this.GetKLineData(S.DrawData.Data,o),c.Draw=S,f.push(c);else if(T.DrawType=="MULTI_HTMLDOM")S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,S.Callback=T.Callback,S.DrawData=this.FittingMultiText(T.DrawData,h,u,o),this.GetKLineData(S.DrawData,o),c.Draw=S,f.push(c);else if(T.DrawType=="COLOR_KLINE"){S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType;var g=this.FittingMultiText(T.DrawData.KLine,h,u,o),E=new Dt.default;for(var C in g){var D=g[C];E.set(D.Index,D)}S.DrawData={KLine:E},T.Color&&(c.Color=T.Color),c.Draw=S,f.push(c)}else if(T.DrawType=="KLINE_BG")S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData={},S.DrawData.Color=T.Color,S.DrawData.Angle=T.Angle,T.Ver==2?S.DrawData.Data=this.FittingKLineBG_V2(T.DrawData,o):S.DrawData.Data=this.FittingKLineBG(T.DrawData,o),c.Draw=S,c.Name=T.DrawType,f.push(c);else if(T.DrawType=="MULTI_POINT_LINE")S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData={},S.DrawData.Color=T.Color,S.DrawData.PointRadius=T.PointRadius,S.DrawData.PointColor=T.PointColor,S.DrawData.LineWidth=T.LineWidth,S.DrawData.Data=this.FittingMultiPointLine(T.DrawData,o),c.Draw=S,f.push(c);else if(T.DrawType=="PARTLINE")S.Name=T.Name,S.Type=T.Type,S.DrawType=T.DrawType,S.DrawData=this.FittingArray(T.DrawData,h,u,o,1),c.Draw=S,T.LineWidth&&(c.LineWidth=T.LineWidth),f.push(c);else if(T.DrawType==Ja.CLIP_COLOR_STICK)S.Name=T.Name,S.Type=T.Type,S.DrawType=T.DrawType,S.DrawData=this.FittingArray(T.Data,h,u,o),c.Draw=S,T.LineWidth&&(c.LineWidth=T.LineWidth),T.UpColor&&(c.UpColor=T.UpColor),T.DownColor&&(c.DownColor=T.DownColor),f.push(c);else if(T.DrawType=="DRAWCOLORKLINE")S.Name=T.Name,S.Type=T.Type,S.DrawType=T.DrawType,S.DrawData=this.FittingArray(T.DrawData,h,u,o,1),c.Draw=S,T.Color&&(S.Color=T.Color),v.IsBool(T.IsEmptyBar)&&(S.IsEmptyBar=T.IsEmptyBar),f.push(c);else{var F=Ei.Get(T.DrawType);F&&F.KLineFittingCallback&&F.KLineFittingCallback(D,c,{Date:h,Time:u,HQChart:o},this)&&f.push(c)}}}return f},this.GetKLineData=function(s,o){if(s&&Array.isArray(s)){if(this.HQDataType==wt.MINUTE_ID||this.HQDataType==wt.MULTIDAY_MINUTE_ID)var l=o.SourceData;else var l=o.ChartPaint[0].Data;for(var h in s){var u=s[h];if(v.IsString(u.Value)&&v.IsNumber(u.Index)&&!(u.Index<0||u.Index>=l.Data.length)){var f=u.Value.toUpperCase(),C=l.Data[u.Index];switch(f){case"HIGH":case"H":u.Value=C.High;break;case"L":case"LOW":u.Value=C.Low;break;case"C":case"CLOSE":u.Value=C.Close;break}}}}},this.FittingKLineBG=function(s,o){var l=o.ChartPaint[0].Data,h=[];if(Y.IsDayPeriod(o.Period,!0)){for(var u=!1,f=0,C=0;f<l.Data.length;){h[f]=0;var D=l.Data[f];if(C>=s.length){++f;continue}var c=s[C];c.Date<D.Date?++C:(c.Date>D.Date||(u=!0,h[f]=1,++C),++f)}if(u)return h}else if(Y.IsMinutePeriod(o.Period,!0)){for(var u=!1,f=0,C=0;f<l.Data.length;){h[f]=0;var D=l.Data[f];if(C>=s.length){++f;continue}var c=s[C];c.Date<D.Date||c.Date==D.Date&&c.Time<D.Time?++C:(c.Date>D.Date||c.Date==D.Date&&c.Time>D.Time||(u=!0,h[f]=1,++C),++f)}if(u)return h}return null},this.FittingKLineBG_V2=function(s,o){var l=o.ChartPaint[0].Data,h=[];if(Y.IsDayPeriod(o.Period,!0)){for(var u=!1,f=0,C=0;f<l.Data.length;++f){h[f]=0;var D=l.Data[f],c=D.Date;for(C=0;C<s.length;++C){var T=s[C];if(c>=T.Start.Date&&c<=T.End.Date){h[f]=1,u=!0;break}}}if(u)return h}else if(Y.IsMinutePeriod(o.Period,!0)){for(var S=[],f=0;f<s.length;++f){var I=s[f],g=I.Start.Date*1e4;v.IsNumber(I.Start.Time)&&(g+=I.Start.Time);var E=I.End.Date*1e4;v.IsNumber(I.End.Time)&&(E+=I.End.Time),S.push({Start:g,End:E})}for(var u=!1,f=0,C=0;f<l.Data.length;++f){h[f]=0;var D=l.Data[f],c=D.Date*1e4+D.Time;for(C=0;C<S.length;++C){var T=S[C];if(c>=T.Start&&c<=T.End){h[f]=1,u=!0;break}}}if(u)return h}return null},this.FittingMinuteData=function(s,o){for(var l=s.outvar,h=s.date,u=s.time,f=[],C=0;C<l.length;++C){var D=l[C],c={Name:D.name,Type:D.type};if(v.IsBool(D.IsShowTitle)&&(c.IsShowTitle=D.IsShowTitle),D.data)c.Data=this.FittingMinuteArray(D.data,h,u,o),D.color&&(c.Color=D.color),D.linewidth>=1&&(c.LineWidth=D.linewidth),D.isshow==!1&&(c.IsShow=!1),D.isexdata==!0&&(c.IsExData=!0),D.BreakPoint&&(c.BreakPoint=D.BreakPoint),D.UpColor&&(c.UpColor=D.UpColor),D.DownColor&&(c.DownColor=D.DownColor),v.IsBool(D.isDotLine)&&(c.IsDotLine=D.isDotLine),v.IsNonEmptyArray(D.lineDash)&&(c.LineDash=D.lineDash),v.IsBool(D.isSingleLine)&&(c.IsSingleLine=D.isSingleLine),f.push(c);else if(D.Draw){var T=D.Draw,S={};if(T.DrawType=="DRAWICON")S.Icon=T.Icon,S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData=this.FittingMinuteArray(T.DrawData,h,u,o),c.Draw=S,f.push(c);else if(T.DrawType=="DRAWTEXT")S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData=this.FittingMinuteArray(T.DrawData,h,u,o),c.Draw=S,f.push(c);else if(T.DrawType=="STICKLINE")S.Name=T.Name,S.Type=T.Type,S.Width=T.Width,S.DrawType=T.DrawType,S.DrawData=this.FittingMinuteArray(T.DrawData,h,u,o,1),c.Draw=S,f.push(c);else if(T.DrawType==Ja.OVERLAY_BARS)S.Name=T.Name,S.Type=T.Type,S.DrawType=T.DrawType,S.BarName=T.BarName,S.BarColor=T.BarColor,S.LineWidth=T.LineWidth,S.DrawData=this.FittingMinuteArray(T.DrawData,h,u,o,1),c.Draw=S,f.push(c);else if(T.DrawType==Ja.CLIP_COLOR_STICK)S.Name=T.Name,S.Type=T.Type,S.DrawType=T.DrawType,S.DrawData=this.FittingMinuteArray(T.Data,h,u,o),c.Draw=S,T.Option&&(c.Option=T.Option),f.push(c);else if(T.DrawType=="MULTI_LINE"){S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData=this.FittingMultiLine(T.DrawData,h,u,o);for(var I in S.DrawData)this.GetKLineData(S.DrawData[I].Point,o);c.Draw=S,T.LineDash&&(S.LineDash=T.LineDash),T.Arrow&&(S.Arrow=T.Arrow),f.push(c)}else if(T.DrawType=="MULTI_POINT"){if(S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData=this.FittingMultiLine(T.DrawData,h,u,o),v.IsNonEmptyArray(S.DrawData))for(var I=0;I<S.DrawData.length;++I)this.GetKLineData(S.DrawData[I].Point,o);c.Draw=S,f.push(c)}else if(T.DrawType=="MULTI_TEXT")S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData=this.FittingMultiText(T.DrawData,h,u,o),this.GetKLineData(S.DrawData,o),c.Draw=S,f.push(c);else if(T.DrawType=="MULTI_SVGICON")S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,S.DrawData={Icon:T.DrawData.Icon,Family:T.DrawData.Family},c.Draw=S,f.push(c);else if(T.DrawType=="DRAWSVG")S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,T.AutoPosition&&(S.AutoPosition=T.AutoPosition),S.DrawData={Data:this.FittingMultiText(T.Data,h,u,o),Family:T.Family,TextFont:T.TextFont,EnableTooltip:T.EnableTooltip,IsDrawFirst:T.IsDrawFirst},this.GetKLineData(S.DrawData.Data,o),c.Draw=S,f.push(c);else if(T.DrawType=="MULTI_HTMLDOM")S.Text=T.Text,S.Name=T.Name,S.DrawType=T.DrawType,S.Callback=T.Callback,S.DrawData=this.FittingMultiText(T.DrawData,h,u,o),this.GetKLineData(S.DrawData,o),c.Draw=S,f.push(c);else if(T.DrawType=="DRAWCOLORKLINE")S.Name=T.Name,S.Type=T.Type,S.DrawType=T.DrawType,S.DrawData=this.FittingArray(T.DrawData,h,u,o,1),c.Draw=S,T.Color&&(S.Color=T.Color),v.IsBool(T.IsEmptyBar)&&(S.IsEmptyBar=T.IsEmptyBar),f.push(c);else{var g=Ei.Get(T.DrawType);g&&g.MinuteFittingCallback&&g.MinuteFittingCallback(D,c,{Date:h,Time:u,HQChart:o},this)&&f.push(c)}}}return f},this.FittingMinuteArray=function(s,o,l,h,u){var f=h.SourceData,C=[];for(var D in s){var c=s[D],T=new Wt;T.Date=o[D],l&&D<l.length&&(T.Time=l[D]),T.Value=c,C.push(T)}var S;u==5?S=f.GetMinuteFittingDataV2(C):S=f.GetMinuteFittingData(C);var I=new Y;I.Data=S;var g=I.GetValue();return g},this.FittingMultiPointLine=function(s,o){var l=o.Period,h=s.Data,u=[];if(Y.IsDayPeriod(l,!0)){var f=h[0],C=o.ChartPaint[0].Data,D=C.Data[0],c=0,T=0;if(f.Date>D.Date){var S=0;for(c=0;c<C.Data.length;++c){var I=C.Data[c];if(I.Date==f.Date)break;if(I.Date>f.Date){c=S;break}S=c}}else for(T=0;T<h.length;++T){var g=h[T];if(g.Date>=D.Date)break}for(var E=null,F=c,R=T;F<C.Data.length&&R<h.length;){var I=C.Data[F],g=h[R];g.Date<=I.Date?(u[F]||(u[F]=[]),u[F].push({Date:g.Date,Value:g.Value,Data:g.Data,KDate:I.Date,Type:1}),E=g,++R):(E&&!u[F]&&(u[F]={Date:E.Date,Value:E.Value,Type:0}),++F)}if(E)for(;F<C.Data.length;++F)u[F]||(u[F]={Date:E.Date,Value:E.Value,Type:0});return u}else if(Y.IsMinutePeriod(l,!0)){var C=o.ChartPaint[0].Data;return u}}}function rg(e,a,r){this.newMethod=Ie,this.newMethod(e,null,a,null),delete this.newMethod,this.JsonData,r.JsonData&&(this.JsonData=r.JsonData),this.RequestData=function(t,n,s){if(!this.JsonData){console.warn("[LocalJsonDataIndex::RequestData] JsonData is null"),param.HQChart.ScriptErrorCallback&&param.HQChart.ScriptErrorCallback("json 数据不能为空");return}this.OutVar=this.FittingData(this.JsonData,s),this.BindData(t,n,s)},this.FittingData=function(t,n){outVar=t.OutVar,date=t.Date,time=t.Time,result=[];for(i in outVar){if(item=outVar[i],k.Complier.Log("[LocalJsonDataIndex::FittingData] item",item),item.Type!=0&&item.Type!=3){console.warn("[LocalJsonDataIndex::FittingData] can't support ",item.Name,item.Type);continue}var s=[];outVarItem={Name:item.Name,Type:item.Type};for(j in item.Data){var o=new Wt;o.Date=date[j],time&&j<time.length&&(o.Time=time[j]),o.Value=item.Data[j],s.push(o)}if(n.Period<4)var l=n.GetFittingData(s);else var l=n.GetMinuteFittingData(s);var h=new Y;h.Data=l,outVarItem.Data=h.GetValue(),result.push(outVarItem)}return result}}function Sl(e){this.ID,this.Name,this.Script,this.Arguments=[],this.ClassName="ScriptIndexConsole",this.ErrorCallback,this.FinishCallback,this.IsSectionMode=!1,this.NetworkFilter,this.IsApiPeriod=!1,e&&(e.Name&&(this.Name=e.Name),e.Script&&(this.Script=e.Script),e.ID&&(this.ID=e.ID),e.Args&&(this.Arguments=e.Args),e.ErrorCallback&&(this.ErrorCallback=e.ErrorCallback),e.FinishCallback&&(this.FinishCallback=e.FinishCallback),e.IsSectionMode&&(this.IsSectionMode=e.IsSectionMode),e.NetworkFilter&&(this.NetworkFilter=e.NetworkFilter),v.IsBool(e.IsApiPeriod)&&(this.IsApiPeriod=e.IsApiPeriod)),this.ExecuteScript=function(a){this.OutVar=[];var r={Self:this},t={HQDataType:a.HQDataType,Symbol:a.Stock.Symbol,Name:a.Stock.Name,Period:a.Period,Right:a.Right,Callback:this.RecvResultData,CallbackParam:r,Async:!0,MaxRequestDataCount:a.Request.MaxDataCount,MaxRequestMinuteDayCount:a.Request.MaxMinuteDayCount,Arguments:this.Arguments,IsSectionMode:this.IsSectionMode,ClassName:"ScriptIndexConsole",NetworkFilter:this.NetworkFilter,IsApiPeriod:this.IsApiPeriod,Self:this};a.HQDataType===wt.HISTORY_MINUTE_ID&&(t.TrateDate=a.Request.TradeDate),a.HQDataType==wt.MULTIDAY_MINUTE_ID&&(t.DayCount=a.DayCount),a.Data&&(t.Data=a.Data);var n=this.Script;be.Execute(n,t,this.ErrorCallback)},this.RecvResultData=function(a,r){var t=r.Self,n=r.JSExecute,s=null;n.SymbolData.Data&&(s=n.SymbolData.Data.GetDate());var o={Out:a,Date:s,Stock:{Name:n.SymbolData.Name,Symbol:n.SymbolData.Symbol},Index:{Name:t.Name,ID:t.ID}};(n.SymbolData.DataType==wt.MULTIDAY_MINUTE_ID||n.SymbolData.DataType==wt.MINUTE_ID||n.SymbolData.DataType==wt.KLINE_ID&&Y.IsMinutePeriod(n.SymbolData.Period,!0))&&(o.Time=n.SymbolData.Data.GetTime()),t.FinishCallback&&t.FinishCallback(o,r.JSExecute)}}Sl.SetDomain=function(e,a){be.SetDomain(e,a)};function If(e){this.Url=e.Url,this.RealtimeUrl=e.RealtimeUrl,this.Job=e.Job,this.Symbol=e.Symbol,this.Args=e.Args,this.DataKey=e.DataKey,this.RecvCallback=e.Callback,this.ErrorCallback=e.ErrorCallback,this.Download=function(){var a=this.Args[0];switch(a){case 1:case 7:case"EXCHANGE":this.DownloadHistoryData(a);break;case 3:this.GetSymbolType(a);break;case 9:case 18:case 30:case 32:case 33:case 34:case 38:case 40:case 41:case 42:case 43:case"CAPITAL":case"TOTALCAPITAL":case 100:this.DownloadRealtimeData(a);break;default:this.DownloadRealtimeData(a);break}},this.GetSymbolType=function(a){var r=1;U.IsSHSZIndex(this.Symbol)&&(r=0);var t={Date:null,Value:r};this.RecvCallback(t,this.Job,this.DataKey)},this.DownloadRealtimeData=function(a){var r=this,t=this.GetFieldList();if(!t){this.Job.FunctionName2?message=this.Job.FunctionName2+" can't support.":this.Job.FunctionName?message=this.Job.FunctionName+"("+this.Args[0]+") can't support.":message=this.Args[0]+" can't support.",this.ErrorCallback(message),r.RecvCallback(null,r.Job,r.DataKey);return}Vt.HttpRequest({url:this.RealtimeUrl,data:{field:t,symbol:[this.Symbol],condition:[],start:0,end:10},type:"post",dataType:"json",async:!0,success:function(s){var o=r.RealtimeDataToHQChartData(s);r.RecvCallback(o,r.Job,r.DataKey)}})},this.DownloadHistoryData=function(a){var r=this,t=this.GetFieldList();if(!t){message=this.Job.FunctionName+"("+this.Args[0]+") can't support.",this.ErrorCallback(message),r.RecvCallback(null,r.Job,r.DataKey);return}Vt.HttpRequest({url:this.Url,data:{field:t,symbol:[this.Symbol],condition:[],start:0,end:200},type:"post",dataType:"json",async:!0,success:function(s){var o=r.ToHQChartData(s);o&&o.sort(function(l,h){return l.Date-h.Date}),r.RecvCallback(o,r.Job,r.DataKey)}})},this.GetFieldList=function(){var a=this.Args[0];switch(a){case 1:return["capital.total","capital.date"];case 7:return["capital.a","capital.date"];case"EXCHANGE":return["capital.a","capital.date"];case 9:return["finance.peruprofit","symbol","date"];case 18:return["finance.percreserve","symbol","date"];case 30:return["finance.nprofit","symbol","date"];case 32:return["finance.peruprofit","symbol","date"];case 33:return["finance.persearning","symbol","date"];case 34:return["finance.pernetasset","symbol","date"];case 38:return["finance.persearning","symbol","date"];case 40:return["capital.a","capital.date","symbol","date","price"];case 41:return["capital.total","capital.date","symbol","date","price"];case"CAPITAL":return["capital.a","capital.date","symbol","date"];case"TOTALCAPITAL":return["capital.total","capital.date","symbol","date"];case 42:return["company.releasedate","symbol","date"];case 43:return["dividendyield","symbol","date"];case 100:return["shareholder","symbol","date"];default:return null}},this.RealtimeDataToHQChartData=function(a,n){if(!a.stock||a.stock.length!=1)return null;var t=a.stock[0],n=this.Args[0],s=t.date;switch(n){case 9:return t.finance?{Date:s,Value:t.finance.peruprofit}:null;case 18:return t.finance?{Date:s,Value:t.finance.percreserve}:null;case 30:return t.finance?{Date:s,Value:t.finance.nprofit}:null;case 32:return t.finance?{Date:s,Value:t.finance.peruprofit}:null;case 33:return t.finance?{Date:s,Value:t.finance.persearning}:null;case 34:return t.finance?{Date:s,Value:t.finance.pernetasset}:null;case 38:return t.finance?{Date:s,Value:t.finance.persearning}:null;case 40:return t.capital?{Date:s,Value:t.capital.a*t.price}:null;case 41:return t.capital?{Date:s,Value:t.capital.total*t.price}:null;case 42:if(!t.company)return null;{var o=t.company.releasedate,l=parseInt(o/1e4),h=parseInt(o%1e4/100),u=o%100,f=new Date(l,h-1,u),C=new Date,D=parseInt((C.getTime()-f.getTime())/(1e3*60*60*24));return{Date:s,Value:D+1}}case 43:return t.dividendyield?{Date:s,Value:t.dividendyield.quarter4}:null;case 100:return t.shareholder?{Date:s,Value:t.shareholder.count}:null;case"CAPITAL":return t.capital?{Date:s,Value:t.capital.a/100}:null;case"TOTALCAPITAL":return t.capital?{Date:s,Value:t.capital.total/100}:null}},this.ToHQChartData=function(a){if(!a.stock||a.stock.length!=1)return null;var r=[],t=new Fe.default,n=a.stock[0],s=this.Args[0];for(var o in n.stockday){var l=n.stockday[o],h=this.ToHQChartItemData(l,s);h&&!t.has(h.Date)&&(r.push(h),t.add(h.Date))}return r},this.ToHQChartItemData=function(a,r){if(!a)return null;var t=a.date;switch(r){case 1:return a.capital?{Date:t,Value:a.capital.total}:null;case 7:case"EXCHANGE":return a.capital?{Date:t,Value:a.capital.a}:null;default:return null}}}function sg(e){this.Url=e.Url,this.RealtimeUrl=e.RealtimeUrl,this.Job=e.Job,this.Symbol=e.Symbol,this.Args=e.Args,this.DataKey=e.DataKey,this.RecvCallback=e.Callback,this.ErrorCallback=e.ErrorCallback,this.Download=function(){var a=this.Args[0];switch(a){case"HYBLOCK":case"DYBLOCK":case"GNBLOCK":this.DownloadGroupName(a);break}},this.DownloadGroupName=function(a){var r=this,t=["name","symbol"];a=="HYBLOCK"?t.push("industry"):a=="DYBLOCK"?t.push("region"):a=="GNBLOCK"&&t.push("concept"),Vt.HttpRequest({url:r.RealtimeUrl,data:{field:t,symbol:[this.Symbol]},type:"post",dataType:"json",async:!0,success:function(s){var o=r.RecvGroupName(s);r.RecvCallback(o,r.Job,r.DataKey,1)},error:function(s){r.ErrorCallback(s)}})},this.RecvGroupName=function(a){if(!a.stock||a.stock.length!=1)return null;var r=a.stock[0],t=this.Args[0],n=null;if(t=="HYBLOCK"){var s=r.industry;if(!s)return null;var n;for(var o in s){var l=s[o];n=l.name}}else if(t=="DYBLOCK"){var h=r.region;if(!h)return null;for(var o in h){var l=h[o];n=l.name}}else if(t=="GNBLOCK"){var u=r.concept;if(!u)return null;n="";for(var o in u){var l=u[o];n.length>0&&(n+=" "),n+=l.name}}return{Value:n}}}be.AddVariant({Name:"DHIGH",Description:"不定周期最高价"});be.AddVariant({Name:"DOPEN",Description:"不定周期开盘价"});be.AddVariant({Name:"DLOW",Description:"不定周期最低价"});be.AddVariant({Name:"DCLOSE",Description:"不定周期收盘价"});be.AddVariant({Name:"DVOL",Description:"不定周期成交量价"});function ng(){var e={BGColor:"rgb(0,0,0)",TooltipBGColor:"rgb(255, 255, 255)",TooltipAlpha:.92,SelectRectBGColor:"rgba(1,130,212,0.06)",UpBarColor:"rgb(238,21,21)",DownBarColor:"rgb(25,158,0)",UnchagneBarColor:"rgb(228,228,228)",EmptyBarBGColor:"rgb(0,0,0)",SplashScreen:{BGColor:"rgba(112,128,144,0.5)",TextColor:"rgb(230,230,230)"},HLCArea:{HighLineColor:"rgb(238,21,21)",LowLineColor:"rgb(25,158,0)",CloseLineColor:"rgb(156,156,156)",LineWidth:2*B(),UpAreaColor:"rgba(238,21,21, 0.3)",DownAreaColor:"rgba(25,158,0, 0.3)"},Minute:{VolBarColor:null,PriceColor:"rgb(25,180,231)",AreaPriceColor:"rgba(63,158,255,.3)",AvPriceColor:"rgb(255,236,0)",PositionColor:"rgb(201, 9, 224)",VolTitleColor:"rgb(190,190,190)",Before:{BGColor:"rgba(105,105,105,0.5)",AvPriceColor:"rgb(248,248,255)",CloseIcon:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"}},After:{BGColor:"rgba(105,105,105,0.5)",AvPriceColor:"rgb(248,248,255)"},NightDay:{NightBGColor:"rgb(22,22,22)",Font:12*B()+"px 微软雅黑",Day:{Color:"rgb(153,153,153)",BGColor:"rgb(51,51,51)",BorderColor:"rgb(51,51,51)",Margin:{Left:5,Top:2,Bottom:2,Right:5}},Night:{Color:"rgb(153,153,153)",BGColor:"rgb(51,51,51)",BorderColor:"rgb(51,51,51)",Margin:{Left:5,Top:2,Bottom:2,Right:5}}}},PopMinuteChart:{BGColor:"rgba(0,0,0,0.85)",BorderColor:"rgb(230,230,230)"},DefaultTextColor:"rgb(101,104,112)",DefaultTextFont:14*B()+"px 微软雅黑",TitleFont:13*B()+"px 微软雅黑",IndexTitleColor:"rgb(190, 190 ,190)",IndexTitleBGColor:"rgb(0,0,0)",IndexTitleBorderColor:"rgb(211, 211, 211)",IndexTitleBorderMoveOnColor:"rgb(30,144,255)",UpTextColor:"rgb(238,21,21)",DownTextColor:"rgb(25,158,0)",UnchagneTextColor:"rgb(190, 190 ,190)",CloseLineColor:"rgb(250,250,250)",IndexTitle:{UpDownArrow:{UpColor:"rgb(238,21,21)",DownColor:"rgb(25,158,0)",UnchangeColor:"rgb(190, 190 ,190)"},NameArrow:{Color:"rgb(190, 190 ,190)",Space:2,Symbol:"▼"}},Title:{TradeIndexColor:"rgb(105,105,105)",ColorIndexColor:"rgb(112,128,144)",VolColor:"rgb(190, 190 ,190)",AmountColor:"rgb(190, 190 ,190)",DateTimeColor:"rgb(190, 190 ,190)",SettingColor:"rgb(190, 190 ,190)",NameColor:"rgb(190, 190 ,190)",TurnoverRateColor:"rgb(101,104,112)",PositionColor:"rgb(101,104,112)"},FrameBorderPen:"rgb(47,51,62)",MultiDayBorderPen:"rgba(236,236,236,0.5)",FrameSplitPen:"rgba(236,236,236,0.13)",FrameSplitTextColor:"rgb(220,220,220)",FrameSplitTextFont:12*B()+"px 微软雅黑",FrameTitleBGColor:"rgb(0,0,0)",OverlayIndexTitleBGColor:"rgba(0,0,0,0.7)",Frame:{XBottomOffset:2*B(),PercentageText:{PriceColor:"rgb(101,104,112)",PercentageColor:"rgb(101,104,112)",SplitColor:"rgb(101,104,112)",Font:14*B()+"px 微软雅黑"}},OverlayFrame:{BolderPen:"rgb(130,130,130)",TitleColor:"rgb(181,181,181)",TitleFont:11*B()+"px arial"},FrameLatestPrice:{TextColor:"rgb(255,255,255)",UpBarColor:"rgb(238,21,21)",DownBarColor:"rgb(25,158,0)",UnchagneBarColor:"rgb(190,190,190)",BGAlpha:.6,EmptyBGColor:"rgb(0,0,0)"},CorssCursorBGColor:"rgb(43,54,69)",CorssCursorTextColor:"rgb(255,255,255)",CorssCursorTextFont:12*B()+"px 微软雅黑",CorssCursorHPenColor:"rgb(130,130,130)",CorssCursorVPenColor:"rgb(130,130,130)",CorssCursor:{RightButton:{BGColor:"rgb(43,54,69)",PenColor:"rgb(255,255,255)",Icon:{Text:"",Color:"rgb(255,255,255)",Family:"iconfont",Size:18}}},OrderFlow:{UpColor:{BG:"rgb(223,191,180)",Border:"rgb(196,84,86)"},DownColor:{BG:"rgb(176,212,184)",Border:"rgb(66,94,74)"},UnchagneColor:{BG:"rgb(216,221,177)",Border:"rgb(209,172,129)"},Text:{Color:"rgb(248,248,255)",Family:"Arial",FontMaxSize:16,MaxValue:"8888"},Line:{UpDownColor:"rgb(220,220,220)",MiddleColor:"rgb(211,211,211)"}},KLine:{MaxMin:{Font:12*B()+"px 微软雅黑",Color:"rgb(255,250,240)",RightArrow:"→",LeftArrow:"←",HighYOffset:0,LowYOffset:0},Info:{Investor:{ApiUrl:"/API/NewsInteract",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#1c65db"}},Announcement:{ApiUrl:"/API/ReportList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f5a521"},IconFont2:{Family:"iconfont",Text:"",HScreenText:"",Color:"#ed7520"}},Pforecast:{ApiUrl:"/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#986cad"}},Research:{ApiUrl:"/API/InvestorRelationsList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#19b1b7"}},BlockTrading:{ApiUrl:"/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f39f7c"}},TradeDetail:{ApiUrl:"/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#b22626"}}},NumIcon:{Color:"rgb(251,80,80)",Family:"iconfont",Text:["","","","","","","","","","","","","","","","","","","","",""]},TradeIcon:{Family:"iconfont",Buy:{Color:"rgb(255,15,4)",Text:"",HScreenText:""},Sell:{Color:"rgb(64,122,22)",Text:"",HScreenText:""}}},VirtualKLine:{Color:"rgb(119,136,153)",LineDash:[2,2]},PriceGapStyple:{Line:{Color:"rgb(128,128,128)"},Text:{Color:"rgb(219,220,220)",Font:12*B()+"px 微软雅黑"}},Index:{LineColor:["rgb(255,189,09)","rgb(22,198,255)","rgb(174,35,161)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],NotSupport:{Font:14*B()+"px 微软雅黑",TextColor:"rgb(250,250,250)"}},ColorArray:["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],Buttons:{CloseOverlayIndex:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},CloseWindow:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},ChangeIndex:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},OverlayIndex:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},ModifyIndexParam:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},MaxMinWindow:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},TitleWindow:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},ExportData:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},Tooltip:{Color:"rgb(204,204,204)",ColorBG:"rgb(32,32,32)",ColorBorder:"rgb(69,69,69)"}},DrawPicture:{LineColor:["rgb(41,98,255)"],PointColor:["rgb(41,98,255)","rgb(89,135,255)","rgb(0,0,0)"]},TooltipPaint:{BGColor:"rgba(20,20,20,0.8)",BorderColor:"rgb(210,210,210)",TitleColor:"rgb(210,210,210)",TitleFont:13*B()+"px 微软雅黑",DateTimeColor:"rgb(210,210,210)",VolColor:"rgb(255, 185, 15)",AmountColor:"rgb(210,210,210)",PositionColor:"rgb(255,215,0)"},PCTooltipPaint:{BGColor:"rgba(20,20,20,0.8)",BorderColor:"rgb(210,210,210)",TitleColor:"rgb(210,210,210)",TitleFont:12*B()+"px 微软雅黑",DateTimeColor:"rgb(210,210,210)",VolColor:"rgb(161,154,3)",AmountColor:"rgb(161,154,3)"},DialogTooltip:{BGColor:"rgb(20,20,20)",BorderColor:"rgb(170,170,170)",TitleColor:"rgb(250,250,250)",VolColor:"rgb(255, 185, 15)",AmountColor:"rgb(210,210,210)",DateTimeColor:"rgb(210,210,210)",TurnoverRateColor:"rgb(43,54,69)",PositionColor:"rgb(255,0,255)",TextColor:"rgb(210,210,210)",ValueColor:"rgb(210,210,210)",TitleBGColor:"rgb(200, 66, 69)"},FloatTooltip:{BGColor:"rgb(20,20,20)",BorderColor:"rgb(170,170,170)",VolColor:"rgb(255, 185, 15)",AmountColor:"rgb(210,210,210)",DateTimeColor:"rgb(210,210,210)",TurnoverRateColor:"rgb(43,54,69)",PositionColor:"rgb(255,0,255)",TextColor:"rgb(210,210,210)",ValueColor:"rgb(210,210,210)"},DialogSelectRect:{BGColor:"rgb(20,20,20)",BorderColor:"rgb(170,170,170)",TitleColor:"rgb(210,210,210)",VolColor:"rgb(255, 185, 15)",AmountColor:"rgb(210,210,210)",TextColor:"rgb(210,210,210)",ValueColor:"rgb(210,210,210)",TurnoverRateColor:"rgb(43,54,69)",PositionColor:"rgb(255,0,255)"},DialogSearchIndex:{BGColor:"rgb(20,20,20)",BorderColor:"rgb(170,170,170)",TitleColor:"rgb(230,230,230)",IndexNameColor:"rgb(210,210,210)",GroupNameColor:"rgb(210,210,210)",InputTextColor:"rgb(210,210,210)"},DialogPopKeyboard:{BGColor:"rgb(20,20,20)",BorderColor:"rgb(170,170,170)",TitleColor:"rgb(240,240,240)",Input:{BGColor:"rgb(20,20,20)",TextColor:"rgb(250,250,250)"}},MinuteInfo:{TextColor:"rgb(84,143,255)",Font:14*B()+"px 微软雅黑",PointColor:"rgb(38,113,254)",LineColor:"rgb(120,167,255)",TextBGColor:"rgba(255,255,255,1)"},DepthMapPaint:{LineColor:"rgba(255,185,15)",AreaColor:"rgba(255,185,15,0.8)",TextColor:"rgba(255,255,255)",TextBGColor:"rgb(43,54,69)"},KLineYAxisBGPaint:{Font:12*B()+"px 微软雅黑",TextColor:"rgb(255,255,255)",LineColor:"rgb(255,255,255)"},StockChip:{InfoColor:"rgb(255,255,255)",DayInfoColor:"rgb(0,0,0)"},DepthChart:{BidColor:{Line:"rgb(82,176,123)",Area:"rgba(82,176,123,0.5)"},AskColor:{Line:"rgb(207,76,89)",Area:"rgba(207,76,89, 0.5)"},LineWidth:4},DepthCorss:{BidColor:{Line:"rgb(82,176,123)"},AskColor:{Line:"rgb(207,76,89)"},LineWidth:2,LineDash:[3,3],Tooltip:{BGColor:"rgba(54,54,54, 0.8)",TextColor:"rgb(203,215,224)",Border:{Top:5,Left:20,Bottom:5,Center:5},Font:14*B()+"px 微软雅黑",LineHeight:16}},ChartDrawVolProfile:{BGColor:"rgba(244,250,254,0.3)",BorderColor:"rgba(255,255,255)",VolLineColor:"rgb(232,5,9)",UpVolColor:"rgba(103,179,238, 0.24)",DownVolColor:"rgba(237,208,105,0.24)",AreaUpColor:"rgb(103,179,238,0.7)",AreaDonwColor:"rgba(237,208,105,0.7)",Text:{Color:"rgb(0,0,0)",Family:"Arial",FontMaxSize:18,FontMinSize:6}},RectSelect:{LineColor:"rgb(115,83,64)",LineWidth:1*B(),LineDotted:[3,3],AreaColor:"rgba(26,13,7,0.5)"},RectDrag:{LineColor:"rgb(220,220,220)",LineWidth:1*B(),BGColor:"rgba(220,220,220,0.2)"},SelectedChart:{LineWidth:1,LineColor:"rgb(55,100,100)",Radius:4,MinSpace:200,BGColor:"rgb(255,255,255)"},DragMovePaint:{TextColor:"rgb(255,255,255)"},SessionBreaksPaint:{BGColor:[null,"rgb(42,46,57)"],SplitLine:{Color:"rgb(73,133,231)",Width:1*B(),Dash:[5*B(),5*B()]}},DealList:{BorderColor:"rgb(38,38,41)",Header:{Color:"RGB(245,245,245)",Mergin:{Left:5,Right:5,Top:4,Bottom:2},Font:{Size:12,Name:"微软雅黑"}},Row:{Mergin:{Top:2,Bottom:2},Font:{Size:15,Name:"微软雅黑"},BarMergin:{Top:2,Left:3,Right:3,Bottom:2}},FieldColor:{Vol:"rgb(192,192,0)",Time:"rgb(245,245,245)",Deal:"rgb(111,128,112)",Index:"rgb(245,245,245)",BarTitle:"rgb(245,245,245)",Text:"rgb(245,245,245)"},UpTextColor:"rgb(238,21,21)",DownTextColor:"rgb(25,158,0)",UnchagneTextColor:"rgb(228,228,228)"},Report:{BorderColor:"rgb(38,38,41)",SelectedColor:"rgb(49,48,56)",Header:{Color:"RGB(245,245,245)",SortColor:"rgb(255,0,0)",Font:{Size:12,Name:"微软雅黑"}},Item:{Mergin:{Top:2,Bottom:4,Left:5,Right:5},Font:{Size:15,Name:"微软雅黑"},BarMergin:{Top:2,Left:3,Right:3,Bottom:2},NameFont:{Size:14,Name:"微软雅黑"},SymbolFont:{Size:12,Name:"微软雅黑"}},FixedItem:{Font:{Size:15,Name:"微软雅黑"}},LimitBorder:{Color:"rgb(64,64,64)",Mergin:{Top:1,Bottom:1,Left:0,Right:0}},FieldColor:{Index:"rgb(245,245,245)",Symbol:"rgb(255,255,255)",Name:"rgb(255,255,255)",Amount:"rgb(2,226,244)",Vol:"rgb(192,192,0)",BarTitle:"rgb(245,245,245)",Text:"rgb(245,245,245)"},NameSymbolV2:{Name:{Size:14,Name:"微软雅黑",Color:"rgb(250,250,250)"},Symbol:{Size:12,Name:"微软雅黑",Color:"rgb(190, 190, 190)"}},CloseLine:{CloseColor:"rgb(30,144,255)",YCloseColor:"rgba(220,220,220,0.5)",AreaColor:"rgba(220,220,220,0.2)"},KLine:{UpColor:"rgb(255,0,0)",DownColor:"rgb(0,128,0)",UnchagneColor:"rgb(240,240,240)",DataWidth:16,DistanceWidth:3},UpTextColor:"rgb(238,21,21)",DownTextColor:"rgb(25,158,0)",UnchagneTextColor:"rgb(228,228,228)",Tab:{Font:{Size:12,Name:"微软雅黑"},ScrollBarWidth:100,ButtonColor:"rgb(13,12,15)",BarColor:"rgb(48,48,48)",BorderColor:"rgb(48,48,48)",TabTitleColor:"rgb(153,153,153)",TabSelectedTitleColor:"rgb(255,255,255)",TabSelectedBGColor:"rgb(234,85,4)",TabMoveOnTitleColor:"rgb(255,255,255)",TabBGColor:"rgb(28,28,31)"},PageInfo:{Font:{Size:15,Name:"微软雅黑"},TextColor:"rgb(255,255,255)",BGColor:"rgba(49,48,56,0.8)",Mergin:{Left:5,Right:5,Top:4,Bottom:2}},DragRow:{Color:"rgba(255,250, 250,0.8)",TextColor:"rgba(0,0, 0, 0.8)",MoveRowColor:"rgb(135,206,250)",SrcRowColor:"rgb(49,48,56)"},VScrollbar:{BarWidth:40,ScrollBarHeight:60,ButtonColor:"rgba(13,12,15,0.8)",BarColor:"rgba(48,48,48,0.9)",BorderColor:"rgba(48,48,48,0.9)",BGColor:"rgba(211,211,211,0.5)"},CheckBox:{Family:"iconfont",Size:15,Checked:{Color:"rgb(69,147,238)",Symbol:"",DisableColor:"rgb(120,120,120)",MouseOnColor:"rgb(69,147,238)"},Unchecked:{Color:"rgb(210,210,210)",Symbol:"",DisableColor:"rgb(120,120,120)",MouseOnColor:"rgb(69,147,238)"}},Link:{Font:12*B()+"px 微软雅黑",TextColor:"rgb(0,144,255)",Disable:{TextColor:"rgb(211,211,211)"},MouseOn:{TextColor:"rgb(0,144,255)"}},ProgressBar:{BGColor:"rgb(20,24,28)",BarColor:"rgb(47,124,197)",Margin:{Left:2,Right:2,Bottom:2,Top:2},BarMargin:{Left:2,Right:2,Bottom:2,Top:2},TextColor:"rgb(230,230,230)",Font:12*B()+"px 微软雅黑",TextMargin:{Left:40,Right:2,Bottom:2,Top:2},Disable:{BGColor:"rgb(61,61,61)",BarColor:"rgb(131,131,131)",TextColor:"rgb(159,161,159)"}}},TReport:{BorderColor:"rgb(38,38,41)",SelectedColor:"rgb(180,180,180)",Header:{Color:"rgb(187,187,187)",SortColor:"rgb(255,0,0)",Mergin:{Left:5,Right:5,Top:4,Bottom:2},Font:{Size:14,Name:"微软雅黑"}},Item:{Mergin:{Top:2,Bottom:0,Left:5,Right:5},Font:{Size:15,Name:"微软雅黑"},BarMergin:{Top:2,Left:3,Right:3,Bottom:2},NameFont:{Size:14,Name:"微软雅黑"},SymbolFont:{Size:12,Name:"微软雅黑"}},CenterItem:{TextColor:"rgb(16,226,217)",BaseTextColor:"rgb(60,60,83)",BGColor:"rgb(65,65,65)"},FieldColor:{Index:"rgb(250,250,250)",Symbol:"rgb(60,60,60)",Name:"rgb(250,250,250)",Vol:"rgb(192,165,3)",Position:"rgb(250,250,250)",Amount:"rgb(16,226,217)",Text:"rgb(250,250,250)"},UpTextColor:"rgb(238,21,21)",DownTextColor:"rgb(25,158,0)",UnchangeTextColor:"rgb(187,187,187)",UpBGColor:"rgb(35,5,5)",DownBGColor:"rgb(5,35,5)",MarkBorder:{MaxPositionColor:"rgb(192,192,0)"}},Keyboard:{BorderColor:"rgb(38,38,41)",SelectedColor:"rgb(49,48,56)",TextColor:"rgb(245,245,245)",Item:{Mergin:{Top:2,Bottom:0,Left:1,Right:1},Font:{Size:15,Name:"微软雅黑"},BarMergin:{Top:2,Left:0,Right:0,Bottom:2},NameFont:{Size:14,Name:"微软雅黑"},SymbolFont:{Size:12,Name:"微软雅黑"}},VScrollbar:{ScrollBarHeight:50,ButtonColor:"rgba(13,12,15,0.8)",BarColor:"rgba(48,48,48,0.9)",BorderColor:"rgba(48,48,48,0.9)",BGColor:"rgba(211,211,211,0.5)",BarWidth:{Size:8}}},ScrollBar:{BorderColor:"rgb(38,38,41)",XSplitTextColor:"rgb(240,240,240)",XSplitLineColor:"rgb(38,38,41)",Slider:{DateFont:14*B()+"px 微软雅黑",DateColor:"rgb(240,240,240)",BarColor:"rgb(105,105,105)",BarAreaColor:"rgba(128,128,128,0.65)"},BGChart:{Color:"rgb(105,113,125)",LineWidth:1,AreaColor:"rgba(24,28,42,0.5)"}},FrameButtomToolbar:{BGColor:"rgb(25,25,25)",BorderColor:"rgb(60,60,60)",Button:{Font:{Family:"微软雅黑"},TitleColor:{Selected:"rgb(255,255,255)",Default:"rgb(140,140,140)",MoveOn:"rgb(255,255,255)"},BGColor:{Selected:"rgb(234,85,4)",Default:"rgb(25,25,25)",MoveOn:"rgb(59,59,59)"},BorderColor:"rgb(60,60,60)"}}};return e}var vh={BLACK_ID:1,WHITE_ID:0};function FD(){}FD.GetStyleConfig=function(e){switch(e){case vh.BLACK_ID:return ng();case vh.WHITE_ID:return new dD;default:return null}};function ch(e){this.DivElement=e,this.JSChartContainer,this.CanvasElement=document.createElement("canvas"),this.CanvasElement.className="jsdeallist-drawing",this.CanvasElement.id=Re(),this.CanvasElement.setAttribute("tabindex",0),this.CanvasElement.style&&(this.CanvasElement.style.outline="none"),e.hasChildNodes()&&k.Chart.Log("[JSDealChart::JSDealList] divElement hasChildNodes",e.childNodes),e.appendChild(this.CanvasElement),this.OnSize=function(){var a=parseInt(this.DivElement.style.height.replace("px",""));this.CanvasElement.height=a,this.CanvasElement.width=parseInt(this.DivElement.style.width.replace("px","")),this.CanvasElement.style.width=this.CanvasElement.width+"px",this.CanvasElement.style.height=this.CanvasElement.height+"px";var r=B();this.CanvasElement.height*=r,this.CanvasElement.width*=r,k.Chart.Log("[JSDealChart::OnSize] devicePixelRatio="+window.devicePixelRatio+", height="+this.CanvasElement.height+", width="+this.CanvasElement.width),this.JSChartContainer&&this.JSChartContainer.OnSize&&this.JSChartContainer.OnSize()},this.SetOption=function(a){var r=this.CreateJSDealChartContainer(a);if(!r)return!1;a.OnCreatedCallback&&a.OnCreatedCallback(r),this.JSChartContainer=r,this.DivElement.JSChart=this,a.Symbol?r.ChangeSymbol(a.Symbol):r.Draw()},this.CreateJSDealChartContainer=function(a){var r=new Tn(this.CanvasElement);if(r.Create(a),a.NetworkFilter&&(r.NetworkFilter=a.NetworkFilter),v.IsNonEmptyArray(a.Column)&&r.SetColumn(a.Column),v.IsNumber(a.ShowOrder)&&(r.ChartPaint[0].ShowOrder=a.ShowOrder),this.SetChartBorder(r,a),a.IsAutoUpdate!=null&&(r.IsAutoUpdate=a.IsAutoUpdate),a.AutoUpdateFrequency>0&&(r.AutoUpdateFrequency=a.AutoUpdateFrequency),v.IsBool(a.EnableFilter)&&(r.EnableFilter=a.EnableFilter),a.EventCallback)for(var t=0;t<a.EventCallback.length;++t){var n=a.EventCallback[t];r.AddEventCallback(n)}return r},this.SetChartBorder=function(a,r){if(r.Border){r.Border,v.IsNumber(r.Border.Left)&&(a.Frame.ChartBorder.Left=r.Border.Left),v.IsNumber(r.Border.Right)&&(a.Frame.ChartBorder.Right=r.Border.Right),v.IsNumber(r.Border.Top)&&(a.Frame.ChartBorder.Top=r.Border.Top),v.IsNumber(r.Border.Bottom)&&(a.Frame.ChartBorder.Bottom=r.Border.Bottom);var t=B();a.Frame.ChartBorder.Left*=t,a.Frame.ChartBorder.Right*=t,a.Frame.ChartBorder.Top*=t,a.Frame.ChartBorder.Bottom*=t}},this.ChangeSymbol=function(a,r){this.JSChartContainer&&this.JSChartContainer.ChangeSymbol(a,r)},this.SetColumn=function(a,r){this.JSChartContainer&&this.JSChartContainer.SetColumn(a,r)},this.EnableFilter=function(a,r){this.JSChartContainer&&this.JSChartContainer.EnableFilter(a,r)},this.AddEventCallback=function(a){this.JSChartContainer&&typeof this.JSChartContainer.AddEventCallback=="function"&&(k.Chart.Log("[JSDealChart:AddEventCallback] obj=",a),this.JSChartContainer.AddEventCallback(a))},this.ReloadResource=function(a){this.JSChartContainer&&typeof this.JSChartContainer.ReloadResource=="function"&&(k.Chart.Log("[JSDealChart:ReloadResource] "),this.JSChartContainer.ReloadResource(a))}}ch.Init=function(e){var a=new ch(e);return a.OnSize(),a};function Tn(e){this.ClassName="JSDealChartContainer",this.Frame,this.ChartPaint=[],this.ChartSplashPaint=null,this.LoadDataSplashTitle="数据加载中",this.Canvas=e.getContext("2d"),this.ShowCanvas=null,this.Symbol,this.Name,this.TradeDate,this.NetworkFilter,this.Data={DataOffset:0,Data:[]},this.SourceData={DataOffset:0,Data:[]},this.IsShowLastPage=!0,this.mapEvent=new Dt.default,this.AutoUpdateTimer=null,this.AutoUpdateFrequency=15e3,this.LoadDataSplashTitle="数据加载中",this.UIElement=e,this.LastPoint=new ft,this.IsDestroy=!1,this.ChartDestory=function(){this.IsDestroy=!0,this.StopAutoUpdate()},this.EnableFilterData=!1,this.FilterData=function(a){if(!this.EnableFilterData)return a;var r=this.GetEventCallback($.ON_FILTER_DEAL_DATA);if(!r||!r.Callback)return a;var t={Data:a,Result:[]};return r.Callback(r,t,this),t.Result},this.EnableFilter=function(a,r){this.EnableFilterData=a,this.Data.Data=this.FilterData(this.SourceData.Data),this.Data.DataOffset=0,r&&(r.GotoLastPage==!0&&this.GotoLastPage(),r.Redraw==!0&&this.Draw())},this.CloneArray=function(a){var r=[];if(!v.IsNonEmptyArray(a))return r;for(var t=0;t<a.length;++t)r.push(a[t]);return r},this.Create=function(a){var r=this;this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new Li,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.Frame=new og,this.Frame.ChartBorder=new ra,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartSplashPaint.Frame=this.Frame;var t=new hg;t.Frame=this.Frame,t.ChartBorder=this.Frame.ChartBorder,t.Canvas=this.Canvas,t.GetEventCallback=function(o){return r.GetEventCallback(o)},this.ChartPaint[0]=t,a&&(v.IsBool(a.IsSingleTable)&&(t.IsSingleTable=a.IsSingleTable),v.IsBool(a.IsShowHeader)&&(t.IsShowHeader=a.IsShowHeader),v.IsBool(a.IsShowLastPage)&&(this.IsShowLastPage=a.IsShowLastPage),v.IsNumber(a.BorderLine)&&(this.Frame.BorderLine=a.BorderLine));var n=!0,s=!0;a&&(a.KeyDown===!1&&(n=!1,k.Chart.Log("[JSDealChartContainer::Create] not register keydown event.")),a.Wheel===!1&&(s=!1,k.Chart.Log("[JSDealChartContainer::Create] not register wheel event."))),n&&this.UIElement.addEventListener("keydown",function(o){r.OnKeyDown(o)},!0),s&&this.UIElement.addEventListener("wheel",function(o){r.OnWheel(o)},!0)},this.Draw=function(){if(!(this.UIElement.width<=0||this.UIElement.height<=0)){this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height);var a=B();if(this.Canvas.lineWidth=a,this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash){this.Frame.Draw({IsEnableSplash:this.ChartSplashPaint.IsEnableSplash}),this.ChartSplashPaint.Draw();return}this.Frame.Draw(),this.Frame.DrawLogo();for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.IsDrawFirst&&t.Draw()}for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.IsDrawFirst||t.Draw()}}},this.ChangeSymbol=function(a,r){this.Symbol=a,this.Data=null,this.SourceData=null;var t=this.ChartPaint[0];if(t&&(t.Data=null),r&&v.IsNumber(r.TradeDate)&&(this.TradeDate=r.TradeDate),!this.Symbol){this.Draw();return}this.RequestDealData()},this.CancelAutoUpdate=function(){typeof this.AutoUpdateTimer=="number"&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=null)},this.AutoUpdateEvent=function(a,r){var t=a?$.RECV_START_AUTOUPDATE:$.RECV_STOP_AUTOUPDATE;if(this.mapEvent.has(t)){var n=this,s=this.mapEvent.get(t),o={Stock:{Symbol:this.Symbol,Name:this.Name,DayCount:this.DayCount},Explain:r};a&&(o.Callback=function(l){n.RecvDealUpdateData(l)}),s.Callback(s,o,this)}},this.RequestDealData=function(){this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.Draw();var a=this;if(this.NetworkFilter){var r={Name:"JSDealChartContainer::RequestDealData",Explain:"成交明细",Request:{Data:{symbol:a.Symbol,tradeDate:a.TradeDate}},Self:this,PreventDefault:!1};if(this.NetworkFilter(r,function(n){a.ChartSplashPaint.EnableSplash(!1),a.RecvDealData(n),a.AutoUpdateEvent(!0,"JSDealChartContainer::RequestDealData"),a.AutoUpdate()}),r.PreventDefault==!0)return}var t=d.CacheDomain+"/cache/dealday/today/"+this.Symbol+".json";Vt.HttpRequest({url:t,type:"get",dataType:"json",async:!0,success:function(s){a.ChartSplashPaint.EnableSplash(!1),a.RecvDealData(s),a.AutoUpdate(1)},error:function(s,o){a.ChartSplashPaint.EnableSplash(!1),a.AutoUpdate()}})},this.RecvDealData=function(a){var r=Tn.JsonDataToDealData(a);this.SourceData={DataOffset:0,Data:r},this.Data={DataOffset:0,Data:this.FilterData(this.CloneArray(r))},this.Symbol=a.symbol,this.Name=a.name;var t=this.ChartPaint[0];if(t.Data=this.Data,t.Symbol=this.Symbol,t.YClose=a.yclose,t.Open=a.open,this.IsShowLastPage){var n=t.GetPageSize(!0),s=r.length-n;s<0&&(s=0),this.Data.DataOffset=s}this.Draw()},this.RequestDealUpdateData=function(){var a=this;if(this.NetworkFilter){var r={Name:"JSDealChartContainer::RequestDealUpdateData",Explain:"增量成交明细",Request:{Data:{symbol:a.Symbol}},Self:this,PreventDefault:!1};if(this.Data&&v.IsNonEmptyArray(this.Data.Data)){var t=this.Data.Data[this.Data.Data.length-1];r.LastItem=t}if(this.NetworkFilter(r,function(n){a.RecvDealUpdateData(n),a.AutoUpdate()}),r.PreventDefault==!0)return}},this.RecvDealUpdateData=function(a){var r=Tn.JsonDataToDealData(a);v.IsNonEmptyArray(r)&&(a.UpdateType===1?(this.SourceData.Data=r,this.Data.Data=this.FilterData(this.CloneArray(r)),this.Data.DataOffset>=this.Data.Data.length&&(this.Data.DataOffset=0)):(this.AddDealData(this.SourceData,r),this.AddDealData(this.Data,this.FilterData(r))),this.Draw())},this.AddDealData=function(a,r){if(!a.Data)a.Data=r;else{var t=0,n=this.ChartPaint[0];n&&(t=n.GetPageSize());for(var s=0;s<r.length;++s)a.Data.push(r[s]),a.DataOffset+t<a.Data.length&&++a.DataOffset}},this.AutoUpdate=function(a){if(this.CancelAutoUpdate(),!!this.IsAutoUpdate&&this.Symbol){var r=this,t=U.GetMarketStatus(this.Symbol);if(!(t==0||t==3)){var n=this.AutoUpdateFrequency;t==1?this.AutoUpdateTimer=setTimeout(function(){r.AutoUpdate()},n):t==2&&(this.AutoUpdateTimer=setTimeout(function(){r.RequestDealUpdateData()},n))}}},this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"JSDealChartContainer::StopAutoUpdate"),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.AddEventCallback=function(a){if(!(!a||!a.event||!a.callback)){var r={Callback:a.callback,Source:a};this.mapEvent.set(a.event,r)}},this.RemoveEventCallback=function(a){this.mapEvent.has(a)&&this.mapEvent.delete(a)},this.GetEventCallback=function(a){if(!this.mapEvent.has(a))return null;var r=this.mapEvent.get(a);return r},this.OnSize=function(){if(this.Frame){this.SetSizeChange(!0);var a=this.ChartPaint[0];if(a&&this.Data&&this.Data.DataOffset>0&&v.IsNonEmptyArray(this.Data.Data)){var r=a.GetPageSize(!0);r+this.Data.DataOffset>=this.Data.Data.length&&this.GotoLastPage()}this.Draw()}},this.SetSizeChange=function(a){var r=this.ChartPaint[0];r&&(r.SizeChange=a)},this.OnWheel=function(a){if(k.Chart.Log("[JSDealChartContainer::OnWheel]",a),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)&&!(!this.Data||!v.IsNonEmptyArray(this.Data.Data))){var r=a.clientX-this.UIElement.getBoundingClientRect().left,t=a.clientY-this.UIElement.getBoundingClientRect().top,n=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),n=this.Canvas.isPointInPath(r,t),!!n){var s=this.ChartPaint[0];if(s){var o=a.wheelDelta;v.IsObjectExist(a.wheelDelta)||(o=a.deltaY*-.01),o<0?this.GotoNextPage()&&this.Draw():o>0&&this.GotoPreviousPage()&&this.Draw(),a.preventDefault?a.preventDefault():a.returnValue=!1}}}},this.OnKeyDown=function(a){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var r=a.keyCode?a.keyCode:a.which;switch(r){case 38:this.GotoPreviousPage()&&this.Draw();break;case 40:this.GotoNextPage()&&this.Draw();break}a.preventDefault?a.preventDefault():a.returnValue=!1}},this.GotoNextPage=function(){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return!1;var a=this.ChartPaint[0];if(!a)return!1;var r=a.GetPageSize();if(r>this.Data.Data.length)return!1;var t=this.Data.DataOffset+r;return t+r==this.Data.Data.length-1?!1:(t+r>this.Data.Data.length?this.Data.DataOffset=this.Data.Data.length-r:this.Data.DataOffset=t,!0)},this.GotoPreviousPage=function(){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return!1;var a=this.ChartPaint[0];if(!a||this.Data.DataOffset<=0)return!1;var r=a.GetPageSize(),t=this.Data.DataOffset;return t-=r,t<0&&(t=0),this.Data.DataOffset=t,!0},this.GotoLastPage=function(){var a=this.ChartPaint[0];if(a){var r=a.GetPageSize(!0),t=this.Data.Data.length-r;t<0&&(t=0),this.Data.DataOffset=t}},this.SetColumn=function(a,r){var t=this.ChartPaint[0];t&&(t.SetColumn(a),t.SizeChange=!0,r&&r.Redraw&&this.Draw())},this.ReloadResource=function(a){this.Frame.ReloadResource(a);for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.ReloadResource&&t.ReloadResource(a)}a&&a.Redraw&&(this.SetSizeChange(!0),this.Draw())}}Tn.JsonDataToDealData=function(e){e.symbol;var a=[];if(!v.IsNonEmptyArray(e.detail))return a;for(var r=0;r<e.detail.length;++r){var t=e.detail[r],n={Time:t[0],Price:t[1],Vol:t[2],BS:t[4],Amount:t[3]};n.Source=t,t[5]&&(n.StrTime=t[5]),t[6]&&(n.ID=t[6]),a.push(n)}return a};function og(){this.ChartBorder,this.Canvas,this.BorderColor=d.DealList.BorderColor,this.LogoTextColor=d.FrameLogo.TextColor,this.LogoTextFont=d.FrameLogo.Font,this.ReloadResource=function(e){this.BorderColor=d.DealList.BorderColor,this.LogoTextColor=d.FrameLogo.TextColor,this.LogoTextFont=d.FrameLogo.Font},this.Draw=function(e){var a=L(this.ChartBorder.GetLeft()),r=L(this.ChartBorder.GetTop()),t=L(this.ChartBorder.GetRight()),n=L(this.ChartBorder.GetBottom()),s=t-a,o=n-r;v.IsNumber(this.BorderLine)?(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),(this.BorderLine&1)>0&&(this.Canvas.moveTo(a,r),this.Canvas.lineTo(t,r)),(this.BorderLine&2)>0&&(this.Canvas.moveTo(a,n),this.Canvas.lineTo(t,n)),(this.BorderLine&4)>0&&(this.Canvas.moveTo(a,r),this.Canvas.lineTo(a,n)),(this.BorderLine&8)>0&&(this.Canvas.moveTo(t,r),this.Canvas.lineTo(t,n)),this.Canvas.stroke()):(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(a,r,s,o))},this.DrawLogo=function(){var e=d.FrameLogo.Text;if(v.IsString(e)){this.Canvas.fillStyle=this.LogoTextColor,this.Canvas.font=this.LogoTextFont,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var a=this.ChartBorder.GetLeft()+5,r=this.ChartBorder.GetBottom()-5;this.Canvas.fillText(e,a,r)}}}var fe={TIME_ID:0,PRICE_ID:1,VOL_ID:2,DEAL_ID:3,BS_ID:4,UPDOWN_ID:5,STRING_TIME_ID:6,INDEX_ID:7,MULTI_BAR_ID:8,CENTER_BAR_ID:9,CUSTOM_TEXT_ID:10};function hg(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ChartDealList",this.IsDrawFirst=!1,this.GetEventCallback,this.Data,this.Symbol,this.YClose,this.Open,this.Decimal=2,this.IsSingleTable=!1,this.IsShowHeader=!0,this.ShowOrder=1,this.SizeChange=!0,this.UpColor=d.DealList.UpTextColor,this.DownColor=d.DealList.DownTextColor,this.UnchagneColor=d.DealList.UnchagneTextColor,this.BorderColor=d.DealList.BorderColor,this.HeaderFontConfig={Size:d.DealList.Header.Font.Size,Name:d.DealList.Header.Font.Name},this.HeaderColor=d.DealList.Header.Color,this.HeaderMergin={Left:d.DealList.Header.Mergin.Left,Right:d.DealList.Header.Mergin.Right,Top:d.DealList.Header.Mergin.Top,Bottom:d.DealList.Header.Mergin.Bottom},this.ItemFontConfig={Size:d.DealList.Row.Font.Size,Name:d.DealList.Row.Font.Name},this.RowMergin={Top:d.DealList.Row.Mergin.Top,Bottom:d.DealList.Row.Mergin.Bottom},this.BarMergin={Top:d.DealList.Row.BarMergin.Top,Left:d.DealList.Row.BarMergin.Left,Right:d.DealList.Row.BarMergin.Right,Bottom:d.DealList.Row.BarMergin.Bottom},this.HeaderFont=12*B()+"px 微软雅黑",this.ItemFont=15*B()+"px 微软雅黑",this.RowCount=0,this.TableWidth=0,this.TableCount=0,this.HeaderHeight=0,this.Column=[{Type:fe.TIME_ID,Title:"时间",TextAlign:"center",Width:null,TextColor:d.DealList.FieldColor.Time,MaxText:"88:88:88",Foramt:"HH:MM:SS"},{Type:fe.PRICE_ID,Title:"价格",TextAlign:"center",Width:null,MaxText:"888888.88"},{Type:fe.VOL_ID,Title:"成交",TextAlign:"right",Width:null,TextColor:d.DealList.FieldColor.Vol,MaxText:"888888"},{Type:fe.BS_ID,Title:"",TextAlign:"right",Width:null,MaxText:"擎"}],this.RectClient={},this.ReloadResource=function(e){this.UpColor=d.DealList.UpTextColor,this.DownColor=d.DealList.DownTextColor,this.UnchagneColor=d.DealList.UnchagneTextColor,this.BorderColor=d.DealList.BorderColor,this.HeaderFontConfig={Size:d.DealList.Header.Font.Size,Name:d.DealList.Header.Font.Name},this.HeaderColor=d.DealList.Header.Color,this.HeaderMergin={Left:d.DealList.Header.Mergin.Left,Right:d.DealList.Header.Mergin.Right,Top:d.DealList.Header.Mergin.Top,Bottom:d.DealList.Header.Mergin.Bottom},this.ItemFontConfig={Size:d.DealList.Row.Font.Size,Name:d.DealList.Row.Font.Name},this.RowMergin={Top:d.DealList.Row.Mergin.Top,Bottom:d.DealList.Row.Mergin.Bottom};for(var a=0;a<this.Column.length;++a){var r=this.Column[a];r.Type==fe.TIME_ID||r.Type==fe.STRING_TIME_ID?r.TextColor=d.DealList.FieldColor.Time:r.Type==fe.VOL_ID?r.TextColor=d.DealList.FieldColor.Vol:r.Type==fe.DEAL_ID?r.TextColor=d.DealList.FieldColor.Deal:r.Type==fe.INDEX_ID&&(r.TextColor=d.DealList.FieldColor.Index)}},this.SetColumn=function(e){if(v.IsNonEmptyArray(e)){this.Column=[];for(var a=0;a<e.length;++a){var r=e[a],t=this.GetDefaultColunm(r.Type);if(t){if(r.Title&&(t.Title=r.Title),r.TextAlign&&(t.TextAlign=r.TextAlign),r.TextColor&&(t.TextColor=r.TextColor),r.MaxText&&(t.MaxText=r.MaxText),r.Type==fe.MULTI_BAR_ID||r.Type==fe.CENTER_BAR_ID){if(!v.IsNumber(r.DataIndex))continue;t.DataIndex=r.DataIndex}else r.Type==fe.TIME_ID&&v.IsString(r.Foramt)&&(t.Foramt=r.Foramt);this.Column.push(t)}}}},this.GetDefaultColunm=function(e){for(var a=[{Type:fe.TIME_ID,Title:"时间",TextAlign:"center",Width:null,TextColor:d.DealList.FieldColor.Time,MaxText:"88:88:88",Foramt:"HH:MM:SS"},{Type:fe.PRICE_ID,Title:"价格",TextAlign:"center",Width:null,MaxText:"888888.88"},{Type:fe.VOL_ID,Title:"成交",TextAlign:"right",Width:null,TextColor:d.DealList.FieldColor.Vol,MaxText:"888888"},{Type:fe.BS_ID,Title:"",TextAlign:"right",Width:null,MaxText:"擎"},{Type:fe.DEAL_ID,Title:"笔数",TextAlign:"right",Width:null,TextColor:d.DealList.FieldColor.Deal,MaxText:"8888"},{Type:fe.UPDOWN_ID,Title:"涨跌",TextAlign:"right",Width:null,MaxText:"-8888.88"},{Type:fe.STRING_TIME_ID,Title:"时间",TextAlign:"center",Width:null,TextColor:d.DealList.FieldColor.Time,MaxText:"88:88:88"},{Type:fe.INDEX_ID,Title:"序号",TextAlign:"center",Width:null,TextColor:d.DealList.FieldColor.Index,MaxText:"88888"},{Type:fe.MULTI_BAR_ID,Title:"柱子",TextAlign:"center",Width:null,TextColor:d.DealList.FieldColor.BarTitle,MaxText:"888888"},{Type:fe.CENTER_BAR_ID,Title:"柱子2",TextAlign:"center",Width:null,TextColor:d.DealList.FieldColor.BarTitle,MaxText:"888888"},{Type:fe.CUSTOM_TEXT_ID,Title:"自定义",TextAlign:"center",Width:null,TextColor:d.DealList.FieldColor.Text,MaxText:"擎擎擎擎擎"}],r=0;r<a.length;++r){var t=a[r];if(t.Type==e)return t}return null},this.Draw=function(){this.SizeChange?this.CalculateSize():this.UpdateCacheData(),this.DrawBorder(),this.DrawHeader(),this.DrawBody(),this.SizeChange=!1},this.UpdateCacheData=function(){this.RectClient.Left=this.ChartBorder.GetLeft(),this.RectClient.Right=this.ChartBorder.GetRight(),this.RectClient.Top=this.ChartBorder.GetTop(),this.RectClient.Bottom=this.ChartBorder.GetBottom(),this.Decimal=jt(this.Symbol)},this.GetPageSize=function(e){e&&this.CalculateSize();var a=this.TableCount*this.RowCount;return a},this.CalculateSize=function(){this.UpdateCacheData();var e=B();this.HeaderFont=this.HeaderFontConfig.Size*e+"px "+this.HeaderFontConfig.Name,this.ItemFont=this.ItemFontConfig.Size*e+"px "+this.ItemFontConfig.Name,this.Canvas.font=this.ItemFont;for(var a=0,r=0,t=0;t<this.Column.length;++t){var n=this.Column[t];r=this.Canvas.measureText(n.MaxText).width,n.Width=r+4,a+=n.Width}var s=this.RectClient.Right-this.RectClient.Left;this.TableCount=parseInt(s/a),this.IsSingleTable&&(this.TableCount=1),this.TableWidth=s/this.TableCount,this.HeaderHeight=this.GetFontHeight(this.HeaderFont,"擎")+this.HeaderMergin.Top+this.HeaderMergin.Bottom,this.IsShowHeader||(this.HeaderHeight=0),this.RowHeight=this.GetFontHeight(this.ItemFont,"擎")+this.HeaderMergin.Top+this.HeaderMergin.Bottom,this.RowCount=parseInt((this.RectClient.Bottom-this.RectClient.Top-this.HeaderHeight)/this.RowHeight)},this.DrawHeader=function(){if(this.IsShowHeader){var e=this.RectClient.Left+this.HeaderMergin.Left,a=this.RectClient.Top,r=a+this.HeaderMergin.Top+(this.HeaderHeight-this.HeaderMergin.Top-this.HeaderMergin.Bottom)/2;this.Canvas.font=this.HeaderFont,this.Canvas.fillStyle=this.HeaderColor;for(var t=0,n=0;t<this.TableCount;++t){var s=e+this.TableWidth*t,o=s;for(n=0;n<this.Column.length;++n){var l=this.Column[n],h=l.Width;n==this.Column.length-1&&(h=this.TableWidth-(o-s)-this.HeaderMergin.Right-this.HeaderMergin.Left);var u=o;l.TextAlign=="center"?(u=o+h/2,this.Canvas.textAlign="center"):l.TextAlign=="right"?(u=o+h,this.Canvas.textAlign="right"):this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(l.Title,u,r),o+=l.Width}}}},this.DrawBorder=function(){var e=L(this.RectClient.Left),a=L(this.RectClient.Right),r=L(this.RectClient.Top),t=L(this.RectClient.Bottom);this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),this.IsShowHeader&&(this.Canvas.moveTo(e,r+this.HeaderHeight),this.Canvas.lineTo(a,r+this.HeaderHeight));for(var n=L(e+this.TableWidth),s=1;s<this.TableCount;++s)this.Canvas.moveTo(n,r),this.Canvas.lineTo(n,t),n=L(n+this.TableWidth);this.Canvas.stroke()},this.DrawBody=function(){if(this.Data&&v.IsNonEmptyArray(this.Data.Data)){this.Canvas.font=this.ItemFont;var e=this.RectClient.Top+this.HeaderHeight,a=this.RectClient.Left+this.HeaderMergin.Left,r=this.Data.Data.length,t=this.Data.DataOffset;if(this.ShowOrder==1){var t=this.Data.DataOffset+this.TableCount*this.RowCount;t>=r&&(t=r-1);for(var n=0,s=0;n<this.TableCount;++n){var o=a+this.TableWidth*n,l=o,h=e;for(s=0;s<this.RowCount&&t>=0;++s,--t){var u=this.Data.Data[t];this.DrawRow(u,l,h,t),h+=this.RowHeight}}}else for(var n=0,s=0;n<this.TableCount;++n){var o=a+this.TableWidth*n,l=o,h=e;for(s=0;s<this.RowCount&&t<r;++s,++t){var u=this.Data.Data[t];this.DrawRow(u,l,h,t),h+=this.RowHeight}}}},this.DrawRow=function(e,a,r,t,n){for(var s=a,o=a+this.TableWidth,l=0;l<this.Column.length;++l){var h=this.Column[l],u=h.TextColor,f=null,C=h.Width,D=h.TextAlign;if(a+C>o)break;if(l==this.Column.length-1&&(C=this.TableWidth-(a-s)-this.HeaderMergin.Right-this.HeaderMergin.Left),h.Type==fe.TIME_ID)f=v.FormatTimeString(e.Time,h.Foramt);else if(h.Type==fe.STRING_TIME_ID)f=e.StrTime;else if(h.Type==fe.PRICE_ID)e.Price>this.YClose?u=this.UpColor:e.Price<this.YClose?u=this.DownColor:u=this.UnchagneColor,f=e.Price.toFixed(this.Decimal);else if(h.Type==fe.VOL_ID)f=v.FormatValueString(e.Vol,0),u=this.GetVolColor(h,e);else if(h.Type==fe.DEAL_ID)f=v.FormatValueString(e.Deal,0);else if(h.Type==fe.BS_ID)e.BS==1?(f="B",u=this.UpColor):e.BS==2&&(f="S",u=this.DownColor);else if(h.Type==fe.UPDOWN_ID){if(v.IsNumber(this.YClose)){var c=e.Price-this.YClose;f=c.toFixed(2),c>0?u=this.UpColor:c<0?u=this.DownColor:u=this.UnchagneColor}}else if(h.Type==fe.INDEX_ID)f=(t+1).toString();else if(h.Type==fe.MULTI_BAR_ID){var T={Left:a,Top:r,Width:C,Height:this.RowHeight};this.DrawMultiBar(h,e,T)}else if(h.Type==fe.CENTER_BAR_ID){var T={Left:a,Top:r,Width:C,Height:this.RowHeight};this.DrawCenterBar(h,e,T)}else if(h.Type==fe.CUSTOM_TEXT_ID){var S={Text:null,TextColor:null,TextAlign:null},T={Left:a,Top:r,Width:C,Height:this.RowHeight};this.DrawCustomText(h,e,T,t,l,S)&&(S.Text&&(f=S.Text),S.TextColor&&(u=S.TextColor),S.TextAlign&&(D=S.TextAlign))}this.DrawItemText(f,u,D,a,r,C),a+=h.Width}},this.DrawItemText=function(e,a,r,t,n,s){var o=t;r=="center"?(o=t+s/2,this.Canvas.textAlign="center"):r=="right"?(o=t+s,this.Canvas.textAlign="right"):this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=a,e&&this.Canvas.fillText(e,o,n+this.RowHeight/2)},this.DrawMultiBar=function(e,a,r){if(!a.Source||!v.IsNonEmptyArray(a.Source))return!1;var t=a.Source[e.DataIndex];if(!t||!v.IsNonEmptyArray(t.Value))return!1;for(var n=r.Width-this.BarMergin.Left-this.BarMergin.Right,s=r.Left+this.BarMergin.Left,o=r.Top+this.RowMergin.Top+this.BarMergin.Top,l=r.Height-this.RowMergin.Top-this.RowMergin.Bottom-this.BarMergin.Top-this.BarMergin.Bottom,h=s+n,u=0;u<t.Value.length;++u){var f=t.Value[u];if(!(f<=0)){if(s>=h)break;var C=n*f;C<1&&(C=1),s+C>h&&(C=h-s);var D=u;v.IsNonEmptyArray(t.Color)&&u<t.Color.length&&(D=t.Color[u]),this.Canvas.fillStyle=d.DealList.FieldColor.Bar[D],this.Canvas.fillRect(s,o,C,l),s+=C}}return!0},this.DrawCenterBar=function(e,a,r){if(!a.Source||!v.IsNonEmptyArray(a.Source))return!1;var t=a.Source[e.DataIndex];if(!t||!v.IsNonEmptyArray(t.Value))return!1;for(var n=(r.Width-this.BarMergin.Left-this.BarMergin.Right)/2,s=r.Left+this.BarMergin.Left,o=s+n,l=r.Top+this.RowMergin.Top+this.BarMergin.Top,h=r.Height-this.RowMergin.Top-this.RowMergin.Bottom-this.BarMergin.Top-this.BarMergin.Bottom,u=0;u<t.Value.length&&u<2;++u){var f=t.Value[u];if(!(f<=0)){f>1&&(f=1);var C=n*f;C<1&&(C=1);var D=u;v.IsNonEmptyArray(t.Color)&&u<t.Color.length&&(D=t.Color[u]),this.Canvas.fillStyle=d.DealList.FieldColor.Bar[D],u==0?this.Canvas.fillRect(o,l,-C,h):this.Canvas.fillRect(o,l,C,h)}}},this.DrawCustomText=function(e,a,r,t,n,s){var o=this.GetEventCallback($.ON_DRAW_DEAL_TEXT);if(!o||!o.Callback)return!1;var l={Data:a,DataIndex:t,ColumnIndex:n,ColumnInfo:e,Out:{Text:null,TextColor:null,TextAlign:null}};return o.Callback(o,l,this),l.Out.Text?(s.Text=l.Out.Text,l.Out.TextColor&&(s.TextColor=l.Out.TextColor),l.Out.TextAlign&&(s.TextAlign=l.Out.TextAlign),!0):!1},this.GetVolColor=function(e,a){var r=this.GetEventCallback($.ON_DRAW_DEAL_VOL_COLOR);if(r&&r.Callback){var t={Data:a,TextColor:null};if(r.Callback(r,t,this),t.TextColor)return t.TextColor}return e.TextColor},this.GetFontHeight=function(e,a){return Ea(this.Canvas,e,a)}}function Fi(e){this.DivElement=e,this.JSChartContainer,this.ResizeListener,this.CanvasElement=document.createElement("canvas"),this.CanvasElement.className="jsreportlist-drawing",this.CanvasElement.id=Re(),this.CanvasElement.setAttribute("tabindex",0),this.CanvasElement.style&&(this.CanvasElement.style.outline="none"),e.hasChildNodes()&&k.Chart.Log("[JSReportChart::JSReportChart] divElement hasChildNodes",e.childNodes),e.appendChild(this.CanvasElement),this.MapExtraCanvasElement=new Dt.default,this.CreateExtraCanvasElement=function(a,r){if(this.MapExtraCanvasElement.has(a))return this.MapExtraCanvasElement.get(a);var t=document.createElement("canvas");t.className="jsreportlist-drawing-extra",t.id=Re(),a==Fi.CorssCursorCanvasKey?t.setAttribute("tabindex",5):t.setAttribute("tabindex",1),t.style&&(t.style.outline="none",t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style["pointer-events"]="none"),r&&(v.IsNumber(r.TabIndex)&&t.setAttribute("tabindex",r.TabIndex),v.IsNumber(r.ZIndex)&&(t.style["z-index"]=r.ZIndex)),this.CanvasElement&&(t.height=this.CanvasElement.height,t.width=this.CanvasElement.width,t.style&&(t.style.width=this.CanvasElement.style.width,t.style.height=this.CanvasElement.style.height)),e.appendChild(t);var n={Element:t,Canvas:null};this.MapExtraCanvasElement.set(a,n)},this.GetExtraCanvas=function(a){if(!this.MapExtraCanvasElement.has(a))return null;var r=this.MapExtraCanvasElement.get(a);return r.Element?(r.Canvas||(r.Canvas=r.Element.getContext("2d")),r):null},this.OnSize=function(){var a=this.DivElement.offsetHeight,r=this.DivElement.offsetWidth;this.DivElement.style.height&&this.DivElement.style.width&&(this.DivElement.style.height.includes("px")&&(a=parseInt(this.DivElement.style.height.replace("px",""))),this.DivElement.style.width.includes("px")&&(r=parseInt(this.DivElement.style.width.replace("px","")))),this.CanvasElement.height=a,this.CanvasElement.width=r,this.CanvasElement.style.width=this.CanvasElement.width+"px",this.CanvasElement.style.height=this.CanvasElement.height+"px";var t=B();this.CanvasElement.height*=t,this.CanvasElement.width*=t;var n=!0,s=!1,o=void 0;try{for(var l=(0,ye.default)(this.MapExtraCanvasElement),h;!(n=(h=l.next()).done);n=!0){var u=h.value,f=u[1],C=f.Element;C&&(C.height=this.CanvasElement.height,C.width=this.CanvasElement.width,C.style.width=this.CanvasElement.style.width,C.style.height=this.CanvasElement.style.height)}}catch(D){s=!0,o=D}finally{try{!n&&l.return&&l.return()}finally{if(s)throw o}}k.Chart.Log("[JSReportChart::OnSize] devicePixelRatio="+window.devicePixelRatio+", height="+this.CanvasElement.height+", width="+this.CanvasElement.width),this.JSChartContainer&&this.JSChartContainer.OnSize&&this.JSChartContainer.OnSize()},this.SetOption=function(a){var r=this.CreateJSReportChartContainer(a);if(!r)return!1;if(a.OnCreatedCallback&&a.OnCreatedCallback(r),this.JSChartContainer=r,this.DivElement.JSChart=this,a.EventCallback)for(var t=0;t<a.EventCallback.length;++t){var n=a.EventCallback[t];r.AddEventCallback(n)}a.EnableResize==!0&&this.CreateResizeListener(),a.EnablePopMenuV2===!0&&r.InitalPopMenu(),a.EnableTooltip&&this.CreateExtraCanvasElement(Fi.TooltipCursorCanvasKey,{ZIndex:99}),a.MinuteChartTooltip&&a.MinuteChartTooltip.Enable&&r.InitalMinuteChartTooltip(a.MinuteChartTooltip),a.Symbol&&(r.Symbol=a.Symbol),a.Name&&(r.Name=a.Name);var s={Callback:null};r.Symbol&&(s.Callback=function(){r.RequestMemberListData()}),a.LoadStockList===!1?(r.ChartSplashPaint.IsEnableSplash=!1,r.Draw()):r.RequestStockListData(s)},this.CreateJSReportChartContainer=function(a){var r=this,t=new lg(this.CanvasElement);if(t.GetExtraCanvas=function(l){return r.GetExtraCanvas(l)},t.Create(a),a.NetworkFilter&&(t.NetworkFilter=a.NetworkFilter),v.IsNonEmptyArray(a.Column)&&t.SetColumn(a.Column),v.IsNonEmptyArray(a.Tab)&&t.SetTab(a.Tab),v.IsNumber(a.TabSelected)&&t.SetSelectedTab(a.TabSelected),v.IsBool(a.EnableDragRow)&&(t.EnableDragRow=a.EnableDragRow),v.IsNumber(a.DragRowType)&&(t.DragRowType=a.DragRowType),v.IsBool(a.EnableDragHeader)&&(t.EnableDragHeader=a.EnableDragHeader),v.IsNumber(a.WheelPageType)&&(t.WheelPageType=a.WheelPageType),v.IsBool(a.PageUpDownCycle)&&(t.PageUpDownCycle=a.PageUpDownCycle),a.VScrollbar&&t.SetVScrollbar(a.VScrollbar),a.SortInfo){var n=a.SortInfo;v.IsNumber(n.Field)&&(t.SortInfo.Field=n.Field),v.IsNumber(n.Sort)&&(t.SortInfo.Sort=n.Sort)}if(a.VirtualTable){var n=a.VirtualTable;v.IsBool(n.Enable)&&(t.Data.Virtual.Enable=n.Enable)}var s=t.GetReportChart();if(s&&(v.IsNumber(a.TextOverflowStyle)&&(s.TextOverflowStyle=a.TextOverflowStyle),v.IsNumber(a.MultiSelectModel)&&(s.MultiSelectModel=a.MultiSelectModel)),this.SetChartBorder(t,a),a.IsAutoUpdate!=null&&(t.IsAutoUpdate=a.IsAutoUpdate),a.AutoUpdateFrequency>0&&(t.AutoUpdateFrequency=a.AutoUpdateFrequency),v.IsBool(a.EnableFilter)&&(t.EnableFilter=a.EnableFilter),a.EventCallback)for(var o=0;o<a.EventCallback.length;++o){var n=a.EventCallback[o];t.AddEventCallback(n)}return t},this.SetChartBorder=function(a,r){if(r.Border){r.Border,v.IsNumber(r.Border.Left)&&(a.Frame.ChartBorder.Left=r.Border.Left),v.IsNumber(r.Border.Right)&&(a.Frame.ChartBorder.Right=r.Border.Right),v.IsNumber(r.Border.Top)&&(a.Frame.ChartBorder.Top=r.Border.Top),v.IsNumber(r.Border.Bottom)&&(a.Frame.ChartBorder.Bottom=r.Border.Bottom);var t=B();a.Frame.ChartBorder.Left*=t,a.Frame.ChartBorder.Right*=t,a.Frame.ChartBorder.Top*=t,a.Frame.ChartBorder.Bottom*=t}},this.CreateResizeListener=function(){var a=this;this.ResizeListener=new ResizeObserver(function(r){a.OnDivResize(r)}),this.ResizeListener.observe(this.DivElement)},this.OnDivResize=function(a){k.Chart.Log("[JSReportChart::OnDivResize] entries=",a),this.OnSize()},this.ChangeSymbol=function(a,r){this.JSChartContainer&&this.JSChartContainer.ChangeSymbol(a,r)},this.SetColumn=function(a,r){this.JSChartContainer&&this.JSChartContainer.SetColumn(a,r)},this.SetSelectedRow=function(a){this.JSChartContainer&&this.JSChartContainer.SetSelectedRow(a)},this.EnableFilter=function(a,r){this.JSChartContainer&&this.JSChartContainer.EnableFilter(a,r)},this.AddEventCallback=function(a){this.JSChartContainer&&typeof this.JSChartContainer.AddEventCallback=="function"&&(k.Chart.Log("[JSReportChart:AddEventCallback] obj=",a),this.JSChartContainer.AddEventCallback(a))},this.ReloadResource=function(a){this.JSChartContainer&&typeof this.JSChartContainer.ReloadResource=="function"&&(k.Chart.Log("[JSReportChart:ReloadResource] "),this.JSChartContainer.ReloadResource(a))},this.ChartDestory=function(){this.JSChartContainer&&typeof this.JSChartContainer.ChartDestory=="function"&&this.JSChartContainer.ChartDestory()},this.Draw=function(){this.JSChartContainer&&typeof this.JSChartContainer.Draw=="function"&&(k.Chart.Log("[JSReportChart:Draw] "),this.JSChartContainer.Draw())}}Fi.TooltipCursorCanvasKey="hq_report_tooltip";Fi.Init=function(e){var a=new Fi(e);return a.OnSize(),a};Fi.SetStyle=function(e){e&&d.SetStyle(e)};Fi.GetResource=function(){return d};function es(){this.OriginalSymbol,this.Symbol,this.Name,this.YClose,this.Open,this.Price,this.High,this.Low,this.Amount,this.Vol,this.Increase,this.UpDown,this.Exchange,this.Amplitude,this.BuyPrice,this.BuyVol,this.SellPrice,this.SellVol,this.AvPrice,this.LimitHigh,this.LimitLow,this.VolIn,this.VolOut,this.DealNum,this.OutShares,this.TotalShares,this.MarketValue,this.CircMarketValue,this.CloseLine,this.ExtendData,this.Time,this.Date}function lg(e){this.ClassName="JSReportChartContainer",this.Frame,this.ChartPaint=[],this.ChartSplashPaint=null,this.LoadDataSplashTitle="数据加载中",this.SplashTitle={StockList:"下载码表中.....",MemberList:"下载成分中....."},this.Canvas=e.getContext("2d"),this.TooltipCanvas,this.ChartTooltip,this.Tooltip=document.createElement("div"),this.Tooltip.className="jsreport-tooltip",this.Tooltip.style.background=d.TooltipBGColor,this.Tooltip.style.opacity=d.TooltipAlpha,this.Tooltip.style["pointer-events"]="none",this.Tooltip.id=Re(),e.parentNode.appendChild(this.Tooltip),this.Symbol,this.Name,this.NetworkFilter,this.Data={XOffset:0,YOffset:0,Data:[],Virtual:{Enable:!1,Count:0}},this.SourceData={Data:[]},this.BlockData=new Dt.default,this.MapStockData=new Dt.default,this.FixedRowData={Data:[],Type:0,Symbol:[]},this.FlashBG=new Dt.default,this.FlashBGTimer=null,this.GlobalOption={FlashBGCount:0},this.SortInfo={Field:-1,Sort:0},this.DragRow,this.DragColumnWidth,this.EnableDragRow=!1,this.DragRowType=0,this.AutoDragScrollTimer=null,this.EnablePageScroll=!1,this.DragMove,this.DragHeader,this.EnableDragHeader=!1,this.mapEvent=new Dt.default,this.AutoUpdateTimer=null,this.AutoUpdateFrequency=15e3,this.DelayUpdateTimer=null,this.DelayUpdateFrequency=500,this.UIElement=e,this.LastPoint=new ft,this.IsOnTouch=!1,this.TouchDrag,this.TouchMoveMinAngle=70,this.YStepPixel=5*B(),this.XStepPixel=10*B(),this.PageUpDownCycle=!0,this.DragPageCycle=!0,this.WheelPageType=0,this.DragXScroll=null,this.DragYScroll=null,this.IsShowVScrollbar=!1,this.IsDestroy=!1,this.JSPopMenu,this.IsShowRightMenu=!0,this.TooltipMinuteChart,this.LastMouseStatus={MoveStatus:null,TooltipStatus:null,MouseOnStatus:null},this.ChartDestory=function(){this.IsDestroy=!0,this.StopAutoUpdate(),this.DestroyMinuteChartTooltip()},this.StopAutoDragScrollTimer=function(){k.Chart.Log("[JSReportChartContainer::StopAutoDragScrollTimer] stop "),this.EnablePageScroll=!1,this.AutoDragScrollTimer!=null&&(clearTimeout(this.AutoDragScrollTimer),this.AutoDragScrollTimer=null)},this.InitalPopMenu=function(){this.JSPopMenu||(this.JSPopMenu=new Ne,this.JSPopMenu.Inital())},this.InitalMinuteChartTooltip=function(a){this.TooltipMinuteChart||(this.TooltipMinuteChart=new Gn,this.TooltipMinuteChart.Inital(this,a),this.TooltipMinuteChart.Create())},this.DestroyMinuteChartTooltip=function(){this.TooltipMinuteChart&&(this.TooltipMinuteChart.Destroy(),this.TooltipMinuteChart=null)},this.ShowMinuteChartTooltip=function(a,r,t){if(this.TooltipMinuteChart){var n=this.UIElement.getBoundingClientRect(),s=Da(),o=n.left+s.Left,l=n.top+s.Top;t.Offset={Left:o,Top:l},this.TooltipMinuteChart.Show(t,a,r)}},this.HideMinuteChartTooltip=function(){this.TooltipMinuteChart&&this.TooltipMinuteChart.Hide()},this.AutoScrollPage=function(a){var r=this;this.AutoDragScrollTimer=setTimeout(function(){r.ChartOperator_Temp_ScrollPage(a)},300)},this.ChartOperator_Temp_ScrollPage=function(a){if(this.EnablePageScroll){var r=this.GetReportChart();if(r){if(a>0){var t=r.GetCurrentPageStatus();if(t.IsEnd)return;this.MoveYOffset(a,!1),++a}else if(a<0){if(this.Data.YOffset<=0)return;this.MoveYOffset(a,!1),--a}else return;this.Draw(),this.EnablePageScroll&&this.AutoScrollPage(a)}}},this.ClearCanvas=function(a){a&&this.UIElement&&a.clearRect(0,0,this.UIElement.width,this.UIElement.height)},this.ClearFixedRowData=function(){this.FixedRowData.Data=[],this.FixedRowData.Symbol=[]},this.SetFixedRowCount=function(a){var r=this.GetReportChart();r&&(r.FixedRowCount=a)},this.Create=function(a){var r=this;this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new Li,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.IsEnableSplash=!0,this.Frame=new ug,this.Frame.ChartBorder=new ra,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartSplashPaint.Frame=this.Frame;var t=new fg;t.Frame=this.Frame,t.ChartBorder=this.Frame.ChartBorder,t.Canvas=this.Canvas,t.UIElement=this.UIElement,t.GetEventCallback=function(C){return r.GetEventCallback(C)},t.GetStockDataCallback=function(C){return r.GetStockData(C)},t.GetBlockDataCallback=function(C){return r.GetBlockData(C)},t.GetFlashBGDataCallback=function(C,D){return r.GetFlashBGData(C,D)},t.Data=this.Data,t.GlobalOption=this.GlobalOption,t.FixedRowData=this.FixedRowData,t.SortInfo=this.SortInfo,t.Tab=new Cg,t.Tab.Frame=this.Frame,t.Tab.Canvas=this.Canvas,t.Tab.ChartBorder=this.Frame.ChartBorder,t.Tab.Report=t,t.VScrollbar=new MD,t.VScrollbar.Frame=this.Frame,t.VScrollbar.Canvas=this.Canvas,t.VScrollbar.ChartBorder=this.Frame.ChartBorder,t.VScrollbar.Report=t,t.VScrollbar.IsShowCallback=function(){return r.DragYScroll?!0:r.IsShowVScrollbar},this.ChartPaint[0]=t;var n=new vg;if(n.Frame=this.Frame,n.ChartBorder=this.Frame.ChartBorder,this.ChartTooltip=n,a&&a.PageInfo===!0){var s=new Dg;s.Frame=this.Frame,s.ChartBorder=this.Frame.ChartBorder,s.Canvas=this.Canvas,s.Report=t,this.ChartPaint[1]=s}if(a&&(v.IsBool(a.IsShowHeader)&&(t.IsShowHeader=a.IsShowHeader),v.IsNumber(a.FixedColumn)&&(t.FixedColumn=a.FixedColumn),v.IsNumber(a.BorderLine)&&(this.Frame.BorderLine=a.BorderLine),v.IsBool(a.TabShow)&&(t.Tab.IsShow=a.TabShow),v.IsNumber(a.FixedRowCount)&&(t.FixedRowCount=a.FixedRowCount),v.IsBool(a.ItemBorder)&&(t.IsDrawBorder=a.ItemBorder),v.IsNumber(a.SelectedModel)&&(t.SelectedModel=a.SelectedModel),v.IsNonEmptyArray(a.FixedSymbol))){t.FixedRowCount=0,this.FixedRowData.Type=1,this.FixedRowData.Symbol=[];for(var o=a.FixedSymbol,l=0;l<o.length;++l){var h=o[l];this.FixedRowData.Symbol.push(h.Symbol),++t.FixedRowCount}}var u=!0,f=!0;a&&(a.KeyDown===!1&&(u=!1,k.Chart.Log("[JSDealChartContainer::Create] not register keydown event.")),a.Wheel===!1&&(f=!1,k.Chart.Log("[JSDealChartContainer::Create] not register wheel event."))),u&&this.UIElement.addEventListener("keydown",function(C){r.OnKeyDown(C)},!0),f&&this.UIElement.addEventListener("wheel",function(C){r.OnWheel(C)},!0),this.UIElement.ondblclick=function(C){r.UIOnDblClick(C)},this.UIElement.onmousedown=function(C){r.UIOnMouseDown(C)},this.UIElement.onmouseup=function(C){r.UIOnMounseUp(C)},this.UIElement.oncontextmenu=function(C){r.UIOnContextMenu(C)},this.UIElement.onmousemove=function(C){r.UIOnMouseMove(C)},this.UIElement.onmouseout=function(C){r.UIOnMounseOut(C)},this.UIElement.onmouseleave=function(C){r.UIOnMouseleave(C)},this.UIElement.ontouchstart=function(C){r.OnTouchStart(C)},this.UIElement.ontouchmove=function(C){r.OnTouchMove(C)},this.UIElement.ontouchend=function(C){r.OnTouchEnd(C)}},this.Draw=function(){if(!(this.UIElement.width<=0||this.UIElement.height<=0)){this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height);var a=B();if(this.Canvas.lineWidth=a,this.LastMouseStatus.MouseOnStatus=null,this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash){this.Frame.Draw({IsEnableSplash:this.ChartSplashPaint.IsEnableSplash}),this.ChartSplashPaint.Draw();return}this.Frame.Draw(),this.Frame.DrawLogo();for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.IsDrawFirst&&t.Draw(this.LastMouseStatus)}for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.IsDrawFirst||t.Draw(this.LastMouseStatus)}this.GlobalOption.FlashBGCount>0&&this.DelayDraw(500),this.DrawTooltip(this.LastMouseStatus.TooltipStatus)}},this.DelayDraw=function(a){var r=this;typeof this.FlashBGTimer=="number"&&(clearTimeout(this.FlashBGTimer),this.FlashBGTimer=null),this.FlashBGTimer=setTimeout(function(){r.Draw()},a)},this.ResetReportStatus=function(){this.Data.XOffset=0,this.Data.YOffset=0},this.ResetReportSelectStatus=function(){var a=this.GetReportChart();a&&(a.SelectedRow=-1,a.SelectedFixedRow=-1,a.MultiSelectedRow=[])},this.ClearData=function(){this.SourceData.Data=[],this.Data.Data=[],this.Data.Virtual.Count=0,this.BlockData=new Dt.default},this.ClearMapStockData=function(){this.MapStockData=new Dt.default},this.ResetSortStatus=function(){this.SortInfo.Field=-1,this.SortInfo.Sort=0},this.SetSelectedRow=function(a){var r=this.GetReportChart();if(!r||!r.SetSelectedRow(a))return!1;this.Draw()},this.SetSymbolList=function(a,r){if(this.ClearData(),this.ResetReportStatus(),this.ResetSortStatus(),v.IsNonEmptyArray(a))for(var t=0;t<a.length;++t)this.Data.Data.push(a[t]);var n=this.ChartPaint[0];n&&(n.Data=this.Data),this.Draw()},this.ChangeSymbol=function(a,r){var t=this;if(this.Symbol=a,this.ClearData(),this.ResetReportStatus(),this.ResetSortStatus(),this.ResetReportSelectStatus(),r){if(v.IsNumber(r.TabSelected)){var n=this.GetTabChart();n&&(n.SelectedTabIndex=r.TabSelected)}if(Array.isArray(r.FixedSymbol)){var s=this.GetReportChart();if(s){s.FixedRowCount=0,this.FixedRowData.Type=1,this.FixedRowData.Symbol=[];for(var o=r.FixedSymbol,l=0;l<o.length;++l){var h=o[l];this.FixedRowData.Symbol.push(h.Symbol),++s.FixedRowCount}this.SetSizeChange(!0)}}if(r.SortInfo){var h=r.SortInfo;v.IsNumber(h.Field)&&(this.SortInfo.Field=h.Field),v.IsNumber(h.Sort)&&(this.SortInfo.Sort=h.Sort)}if(v.IsBool(r.IsReloadStockList)){var u={Callback:null};this.Symbol&&(u.Callback=function(){t.RequestMemberListData()}),this.MapStockData=new Dt.default,this.RequestStockListData(u);return}}this.RequestMemberListData()},this.UpdateFullData=function(a){var r=[];if(v.IsNonEmptyArray(a.data))for(var t=0;t<a.data.length;++t){var n=a.data[t],s=n[0],o=null;this.MapStockData.has(s)?o=this.MapStockData.get(s):(o=new es,o.OriginalSymbol=s,this.MapStockData.set(s,o)),o.Symbol=this.GetSymbolNoSuffix(s),o.Name=n[1],this.ReadStockJsonData(o,n),r.push(s)}if(this.Data.Data=[],this.SourceData.Data=[],v.IsNonEmptyArray(r))for(var t=0;t<r.length;++t)this.Data.Data.push(r[t]),this.SourceData.Data.push(r[t]);this.Draw()},this.SetFullData=function(a){this.ClearMapStockData(),this.ClearData(),this.ResetReportStatus(),this.ResetSortStatus(),this.ResetReportSelectStatus(),this.UpdateFullData(a)},this.RequestMemberListData=function(){var a=this;if(this.NetworkFilter){var r={Name:"JSReportChartContainer::RequestMemberListData",Explain:"板块成分数据",Request:{Data:{symbol:this.Symbol}},Self:this,PreventDefault:!1};if(this.SortInfo.Field>=0&&this.SortInfo.Sort>0){var t=this.GetReportChart();if(t){var n=t.Column[this.SortInfo.Field];r.Sort={Column:n,Field:this.SortInfo.Field,Sort:this.SortInfo.Sort}}}if(this.NetworkFilter(r,function(s){a.ChartSplashPaint.EnableSplash(!1),a.RecvMemberListData(s)}),r.PreventDefault==!0)return}},this.RecvMemberListData=function(a){if(this.ClearData(),v.IsNonEmptyArray(a.data))for(var r=0;r<a.data.length;++r)this.Data.Data.push(a.data[r]),this.SourceData.Data.push(a.data[r]);if(a.Virtual){var t=a.Virtual;v.IsNumber(t.Count)&&(this.Data.Virtual.Count=t.Count)}this.Draw(),this.UpdateStockData()},this.AutoUpdateEvent=function(a,r){var t=a?$.RECV_START_AUTOUPDATE:$.RECV_STOP_AUTOUPDATE;if(this.mapEvent.has(t)){var n=this,s=this.mapEvent.get(t),o={Stock:{Symbol:this.Symbol,Name:this.Name,DayCount:this.DayCount},Explain:r};a&&(o.Callback=function(l){n.RecvDealUpdateData(l)}),s.Callback(s,o,this)}},this.RequestStockListData=function(a){this.ChartSplashPaint.SetTitle(this.SplashTitle.StockList),this.ChartSplashPaint.EnableSplash(!0),this.Draw();var r=this;if(this.NetworkFilter){var t={Name:"JSReportChartContainer::RequestStockListData",Explain:"码表数据",Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(n){r.ChartSplashPaint.EnableSplash(!1),r.RecvStockListData(n,a)}),t.PreventDefault==!0)return}},this.RecvStockListData=function(a,r){if(v.IsNonEmptyArray(a.data))for(var t=0;t<a.data.length;++t){var n=a.data[t],s=n[0],o=null;this.MapStockData.has(s)?o=this.MapStockData.get(s):(o=new es,o.OriginalSymbol=s,this.MapStockData.set(s,o)),o.Symbol=this.GetSymbolNoSuffix(s),o.Name=n[1],v.IsNumber(n[88])&&(o.PriceColorType=n[88]),this.ReadStockJsonData(o,n)}if(r&&r.Callback){r.Callback();return}this.Draw(),this.UpdateStockData()},this.UpdateMapStockData=function(a){if(!(!a||!v.IsNonEmptyArray(a.data)))for(var r=0;r<a.data.length;++r){var t=a.data[r],n=t[0],s=null;this.MapStockData.has(n)?s=this.MapStockData.get(n):(s=new es,s.OriginalSymbol=n,this.MapStockData.set(n,s)),s.Symbol=this.GetSymbolNoSuffix(n),s.Name=t[1],this.ReadStockJsonData(s,t)}},this.GetStockData=function(a){return!this.MapStockData||!this.MapStockData.has(a)?null:this.MapStockData.get(a)},this.GetBlockData=function(a){return!this.BlockData||!this.BlockData.has(a)?null:this.BlockData.get(a)},this.SetFlashBGItem=function(a,r){var t={ID:r.ID,Color:r.Color,Count:1};if(v.IsNumber(r.Count)&&(t.Count=r.Count),v.IsNumber(r.Time)?t.Time=r.Time:t.Time=Date.now(),this.FlashBG.has(a)){var n=this.FlashBG.get(a);n.LastTime=t.Time,n.Data.set(t.ID,t)}else{var n={LastTime:t.Time,Data:new Dt.default([[t.ID,t]])};this.FlashBG.set(a,n)}},this.GetFlashBGData=function(a,r){if(!this.FlashBG||!this.FlashBG.has(a))return null;var t=3*1e3,n=this.FlashBG.get(a);if(r-n.LastTime>=t)return this.FlashBG.delete(a),null;if(!n.Data||n.Data.size<=0)return this.FlashBG.delete(a),null;var s=[],o=!0,l=!1,h=void 0;try{for(var u=(0,ye.default)(n.Data),f;!(o=(f=u.next()).done);o=!0){var C=f.value,D=C[1];(r-D.Time>=t||D.Count<=0)&&s.push(D.ID)}}catch(T){l=!0,h=T}finally{try{!o&&u.return&&u.return()}finally{if(l)throw h}}if(v.IsNonEmptyArray(s)){for(var c=0;c<s.length;++c)n.Data.delete(s[c]);if(n.Data.size<=0)return this.FlashBG.delete(a),null}return n},this.DelayUpdateStockData=function(){var a=this;this.DelayUpdateTimer!=null&&(clearTimeout(this.DelayUpdateTimer),this.DelayUpdateTimer=null);var r=this.DelayUpdateFrequency;this.DelayUpdateTimer=setTimeout(function(){a.UpdateStockData()},r)},this.UpdateStockData=function(){if(v.IsNonEmptyArray(this.Data.Data)){var a=this.ChartPaint[0];if(a){if(this.Data.Virtual&&this.Data.Virtual.Enable){this.RequestVirtualStockData();return}if(this.SortInfo&&this.SortInfo.Field>=0&&this.SortInfo.Sort>0){var r=a.Column[this.SortInfo.Field];if(r.Sort==2){this.RequestStockSortData(r,this.SortInfo.Field,this.SortInfo.Sort);return}}var t=a.ShowSymbol;v.IsNonEmptyArray(t)&&this.RequestStockData(t)}}},this.RequestStockData=function(a){var r=this;if(this.NetworkFilter){var t={Name:"JSDealChartContainer::RequestStockData",Explain:"报价列表股票数据",Request:{Data:{stocks:a},symbol:this.Symbol,name:this.Name},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(n){r.RecvStockData(n),r.AutoUpdate()}),t.PreventDefault==!0)return}},this.RecvStockData=function(a){var r=this,t=new Fe.default;if(v.IsNonEmptyArray(a.data))for(var n=0;n<a.data.length;++n){var s=a.data[n],o=s[0];if(o){var l=null;this.MapStockData.has(o)?l=this.MapStockData.get(o):(l=new es,l.OriginalSymbol=o,l.Symbol=this.GetSymbolNoSuffix(o),this.MapStockData.set(o,l)),this.ReadStockJsonData(l,s),t.has(o)||t.add(o)}}var u=this.ChartPaint[0];if(u){var h=!1,u=this.ChartPaint[0];if(u&&this.SortInfo.Sort==1&&v.IsNumber(this.SortInfo.Field)&&this.SortInfo.Field>=0){var f=u.Column[this.SortInfo.Field],C=this.GetEventCallback($.ON_REPORT_LOCAL_SORT);if(C&&C.Callback){var D={Column:f,SortInfo:this.SortInfo,SymbolList:this.Data.Data,Result:null};C.Callback(C,D,this),Array.isArray(D.Result)&&(this.Data.Data=D.Result)}else this.Data.Data.sort(function(T,S){return r.LocalSort(T,S,f,r.SortInfo.Sort)});h=!0}else for(var c=u.ShowSymbol,n=0;n<c.length;++n)if(t.has(c[n].Symbol)){h=!0;break}h&&this.Draw()}},this.ReadStockJsonData=function(a,r){v.IsString(r[1])&&(a.Name=r[1]),v.IsNumber(r[2])&&(a.YClose=r[2]),v.IsNumber(r[3])&&(a.Open=r[3]),v.IsNumber(r[4])&&(a.High=r[4]),v.IsNumber(r[5])&&(a.Low=r[5]),v.IsNumber(r[6])&&(a.Price=r[6]),v.IsNumber(r[7])&&(a.Vol=r[7]),v.IsNumber(r[8])&&(a.Amount=r[8]),v.IsNumber(r[9])&&(a.BuyPrice=r[9]),v.IsNumber(r[10])&&(a.BuyVol=r[10]),v.IsNumber(r[11])&&(a.SellPrice=r[11]),v.IsNumber(r[12])&&(a.SellVol=r[12]),v.IsNumber(r[13])&&(a.AvPrice=r[13]),v.IsNumber(r[14])&&(a.OutShares=r[14]),v.IsNumber(r[15])&&(a.TotalShares=r[15]),v.IsNumber(r[16])&&(a.LimitHigh=r[16]),v.IsNumber(r[17])&&(a.LimitLow=r[17]),v.IsNumber(r[18])&&(a.VolIn=r[18]),v.IsNumber(r[19])&&(a.VolOut=r[19]),v.IsNumber(r[20])&&(a.DealNum=r[20]),v.IsNumber(r[21])&&(a.Increase=r[21]),v.IsNumber(r[22])&&(a.UpDown=r[22]),v.IsNumber(r[23])&&(a.Exchange=r[23]),v.IsNumber(r[24])&&(a.Amplitude=r[24]),v.IsNumber(r[25])&&(a.CircMarketValue=r[25]),v.IsNumber(r[26])&&(a.MarketValue=r[26]),r[27]&&(a.NameEx=r[27]),v.IsNumber(r[21])||v.IsNumber(a.Price)&&v.IsNumber(a.YClose)&&a.YClose!=0&&(a.Increase=(a.Price-a.YClose)/a.YClose*100),v.IsNumber(r[22])||v.IsNumber(a.Price)&&v.IsNumber(a.YClose)&&(a.UpDown=a.Price-a.YClose),v.IsNumber(r[23])||v.IsNumber(a.Vol)&&v.IsNumber(a.OutShares)&&a.OutShares>0&&(a.Exchange=a.Vol/a.OutShares*100),v.IsNumber(r[24])||v.IsNumber(a.High)&&v.IsNumber(a.Low)&&v.IsNumber(a.YClose)&&a.YClose!=0&&(a.Amplitude=(a.High-a.Low)/a.YClose*100),v.IsNumber(r[25])||v.IsNumber(a.OutShares)&&v.IsNumber(a.Price)&&(a.CircMarketValue=a.OutShares*a.Price),v.IsNumber(r[26])||v.IsNumber(a.TotalShares)&&v.IsNumber(a.Price)&&(a.MarketValue=a.TotalShares*a.Price),r[30]&&(a.ExtendData=r[30]),r[31]&&this.BlockData.set(a.OriginalSymbol,r[31]),r[32]&&(a.CloseLine=r[32]),r[33]&&(a.KLine=r[33]),v.IsNumber(r[35])&&(a.Time=r[35]),v.IsNumber(r[36])&&(a.Date=r[36]),v.IsBool(r[37])&&(a.Checked=r[37]),v.IsNumber(r[38])&&(a.Position=r[38]),v.IsNumber(r[39])&&(a.FClose=r[39]),v.IsNumber(r[40])&&(a.YFClose=r[40]),v.IsNumber(r[41])&&(a.OpenPosition=r[41]),v.IsNumber(r[42])&&(a.ClosePosition=r[42]),v.IsNumber(r[43])&&(a.RSpeed1M=r[43]),v.IsNumber(r[44])&&(a.RSpeed3M=r[44]),v.IsNumber(r[45])&&(a.RSpeed5M=r[45]),v.IsNumber(r[46])&&(a.RSpeed10M=r[46]),v.IsNumber(r[47])&&(a.RSpeed15M=r[47]),v.IsNumber(r[101])&&(a.ReserveNumber1=r[101]),v.IsNumber(r[102])&&(a.ReserveNumber2=r[102]),v.IsNumber(r[103])&&(a.ReserveNumber3=r[103]),v.IsNumber(r[104])&&(a.ReserveNumber4=r[104]),v.IsNumber(r[105])&&(a.ReserveNumber5=r[105]),v.IsNumber(r[106])&&(a.ReserveNumber6=r[106]),v.IsNumber(r[107])&&(a.ReserveNumber7=r[107]),v.IsNumber(r[108])&&(a.ReserveNumber8=r[108]),v.IsNumber(r[109])&&(a.ReserveNumber9=r[109]),v.IsNumber(r[110])&&(a.ReserveNumber10=r[110]),v.IsString(r[201])&&(a.ReserveString1=r[201]),v.IsString(r[202])&&(a.ReserveString2=r[202]),v.IsString(r[203])&&(a.ReserveString3=r[203]),v.IsString(r[204])&&(a.ReserveString4=r[204]),v.IsString(r[205])&&(a.ReserveString5=r[205]),v.IsString(r[206])&&(a.ReserveString6=r[206]),v.IsString(r[207])&&(a.ReserveString7=r[207]),v.IsString(r[208])&&(a.ReserveString8=r[208]),v.IsString(r[209])&&(a.ReserveString9=r[209]),v.IsString(r[210])&&(a.ReserveString10=r[210]),(v.IsNumber(r[301])||v.IsObject(r[301]))&&(a.ReserveProgressBar1=r[301]),(v.IsNumber(r[302])||v.IsObject(r[302]))&&(a.ReserveProgressBar2=r[302]),(v.IsNumber(r[303])||v.IsObject(r[303]))&&(a.ReserveProgressBar3=r[303]),(v.IsNumber(r[304])||v.IsObject(r[304]))&&(a.ReserveProgressBar4=r[304]),(v.IsNumber(r[305])||v.IsObject(r[305]))&&(a.ReserveProgressBar5=r[305]),(v.IsNumber(r[306])||v.IsObject(r[306]))&&(a.ReserveProgressBar6=r[306]),(v.IsNumber(r[307])||v.IsObject(r[307]))&&(a.ReserveProgressBar7=r[307]),(v.IsNumber(r[308])||v.IsObject(r[308]))&&(a.ReserveProgressBar8=r[308]),(v.IsNumber(r[309])||v.IsObject(r[309]))&&(a.ReserveProgressBar9=r[309]),(v.IsNumber(r[310])||v.IsObject(r[310]))&&(a.ReserveProgressBar10=r[310]),v.IsObject(r[351])&&(a.ReserveButton1=r[351]),v.IsObject(r[352])&&(a.ReserveButton2=r[352]),v.IsObject(r[353])&&(a.ReserveButton3=r[353]),v.IsObject(r[354])&&(a.ReserveButton4=r[354]),v.IsObject(r[355])&&(a.ReserveButton5=r[355]),v.IsObject(r[356])&&(a.ReserveButton6=r[356]),v.IsObject(r[357])&&(a.ReserveButton7=r[357]),v.IsObject(r[358])&&(a.ReserveButton8=r[358]),v.IsObject(r[359])&&(a.ReserveButton9=r[359]),v.IsObject(r[360])&&(a.ReserveButton10=r[360])},this.GetSymbolNoSuffix=function(a){var r=a.lastIndexOf(".");return r>0?a.substring(0,r):a},this.CancelAutoUpdate=function(){typeof this.AutoUpdateTimer=="number"&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=null)},this.AutoUpdate=function(a){if(this.CancelAutoUpdate(),!!this.IsAutoUpdate){var r=this,t=2,n=this.GetEventCallback($.ON_REPORT_MARKET_STATUS);if(n&&n.Callback){var s={MarketStatus:2};n.Callback(n,s,this),v.IsNumber(s.MarketStatus)&&(t=s.MarketStatus)}if(!(t==0||t==3)){var o=this.AutoUpdateFrequency;t==1?this.AutoUpdateTimer=setTimeout(function(){r.AutoUpdate()},o):t==2&&(this.AutoUpdateTimer=setTimeout(function(){r.UpdateStockData()},o))}}},this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"JSDealChartContainer::StopAutoUpdate"),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.AddEventCallback=function(a){if(!(!a||!a.event||!a.callback)){var r={Callback:a.callback,Source:a};this.mapEvent.set(a.event,r)}},this.RemoveEventCallback=function(a){this.mapEvent.has(a)&&this.mapEvent.delete(a)},this.GetEventCallback=function(a){if(!this.mapEvent.has(a))return null;var r=this.mapEvent.get(a);return r},this.OnSize=function(){this.Frame&&(this.SetSizeChange(!0),this.Draw(),this.DelayUpdateStockData())},this.SetSizeChange=function(a){for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t&&(t.SizeChange=a)}},this.OnWheel=function(a){if(k.Chart.Log("[JSReportChartContainer::OnWheel]",a),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)&&!(!this.Data||!v.IsNonEmptyArray(this.Data.Data))){var r=a.clientX-this.UIElement.getBoundingClientRect().left,t=a.clientY-this.UIElement.getBoundingClientRect().top,n=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),n=this.Canvas.isPointInPath(r,t),!!n){var s=this.ChartPaint[0];if(s){var o=a.wheelDelta;v.IsObjectExist(a.wheelDelta)||(o=a.deltaY*-.01),this.WheelPageType==1?(console.log("[OnWheel] wheelValue="+o),o<0?(this.LastMouseStatus.TooltipStatus=null,this.HideMinuteChartTooltip(),this.GotoNextItem(1)&&(this.Draw(),this.DelayUpdateStockData())):o>0&&(this.LastMouseStatus.TooltipStatus=null,this.HideMinuteChartTooltip(),this.GotoNextItem(-1)&&(this.Draw(),this.DelayUpdateStockData()))):o<0?(this.LastMouseStatus.TooltipStatus=null,this.HideMinuteChartTooltip(),this.GotoNextPage(this.PageUpDownCycle)&&(this.Draw(),this.DelayUpdateStockData())):o>0&&(this.LastMouseStatus.TooltipStatus=null,this.HideMinuteChartTooltip(),this.GotoPreviousPage(this.PageUpDownCycle)&&(this.Draw(),this.DelayUpdateStockData())),a.preventDefault?a.preventDefault():a.returnValue=!1}}}},this.OnKeyDown=function(a){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var r=this.GetReportChart();if(r){var t=a.keyCode?a.keyCode:a.which;if(t!=116){switch(this.HideMinuteChartTooltip(),t){case 33:this.GotoPreviousPage(this.PageUpDownCycle)&&(this.Draw(),this.DelayUpdateStockData());break;case 34:this.GotoNextPage(this.PageUpDownCycle)&&(this.Draw(),this.DelayUpdateStockData());break;case 38:var n=this.MoveSelectedRow(-1);n&&(n.Redraw&&this.Draw(),n.Update&&this.DelayUpdateStockData());break;case 40:var n=this.MoveSelectedRow(1);n&&(n.Redraw&&this.Draw(),n.Update&&this.DelayUpdateStockData());break;case 37:this.MoveXOffset(-1)&&this.Draw();break;case 39:this.MoveXOffset(1)&&this.Draw();break}a.preventDefault?a.preventDefault():a.returnValue=!1}}}},this.UIOnDblClick=function(a){var r=B(),t=(a.clientX-this.UIElement.getBoundingClientRect().left)*r,n=(a.clientY-this.UIElement.getBoundingClientRect().top)*r,s=this.ChartPaint[0];s&&s.OnDblClick(t,n,a)},this.UIOnMouseDown=function(a){var r=this;this.DragXScroll=null,this.DragYScroll=null,this.DragHeader=null,this.DragColumnWidth=null,this.DragMove={Click:{X:a.clientX,Y:a.clientY},Move:{X:a.clientX,Y:a.clientY},PreMove:{X:a.clientX,Y:a.clientY}};var t=B(),n=(a.clientX-this.UIElement.getBoundingClientRect().left)*t,s=(a.clientY-this.UIElement.getBoundingClientRect().top)*t,o=this.ChartPaint[0];if(o){var l=o.PtInHeaderDragBorder(n,s);if(l)this.DragColumnWidth={ClickPoint:{X:n,Y:s},LastPoint:{X:n,Y:s},ClickData:l,ColumnWidth:l.Column.Width};else{var h=o.OnMouseDown(n,s,a);if(!h)return;if((h.Type==2||h.Type==4)&&(a.button==0||a.button==2))a.button==0&&h.Type==2&&this.EnableDragRow&&this.SortInfo.Sort<=0&&(this.DragRow={Click:{X:a.clientX,Y:a.clientY},LastMove:{X:a.clientX,Y:a.clientY},Data:h}),h.Redraw==!0&&this.Draw();else if(h.Type==3&&a.button==0)this.DragHeader={ClickPoint:{X:n,Y:s},Click:{X:a.clientX,Y:a.clientY},ClickData:h,LastMove:{X:a.clientX,Y:a.clientY},MovePoint:null,MoveToData:null};else if(h.Type==1&&a.button==0){var u=h.Tab;u.Type==1?this.MoveXOffset(-1)&&this.Draw():u.Type==2?this.MoveXOffset(1)&&this.Draw():u.Type==3?this.DragXScroll={Click:{X:n,Y:s},LastMove:{X:n,Y:s}}:u.Type==4?this.SetXOffset(u.Pos)&&this.Draw():u.Type==5&&this.OnClickTab(u,a)}else if(h.Type==5&&a.button==0){var f=h.VScrollbar;f.Type==1?this.MoveYOffset(-1)&&(this.Draw(),this.DelayUpdateStockData()):f.Type==2?this.MoveYOffset(1)&&(this.Draw(),this.DelayUpdateStockData()):f.Type==3?this.DragYScroll={Click:{X:n,Y:s},LastMove:{X:n,Y:s}}:f.Type==4&&this.SetYOffset(f.Pos)&&(this.Draw(),this.DelayUpdateStockData())}}}document.onmousemove=function(C){r.DocOnMouseMove(C)},document.onmouseup=function(C){r.DocOnMouseUp(C)}},this.UIOnMounseUp=function(a){console.log('"UIOnMounseUp')},this.UIOnContextMenu=function(a){if(a.preventDefault(),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)&&this.IsShowRightMenu){var r=a.clientX-this.UIElement.getBoundingClientRect().left,t=a.clientY-this.UIElement.getBoundingClientRect().top;typeof this.OnRightMenu=="function"&&this.OnRightMenu(r,t,a)}},this.OnRightMenu=function(a,r,t){},this.UIOnMouseMove=function(a){var r=B(),t=(a.clientX-this.UIElement.getBoundingClientRect().left)*r,n=(a.clientY-this.UIElement.getBoundingClientRect().top)*r,s=this.LastMouseStatus.MouseOnStatus;this.LastMouseStatus.OnMouseMove=null;var o=!1;this.LastMouseStatus.TooltipStatus&&(o=!0),this.LastMouseStatus.TooltipStatus=null;var l=!1,h=null;if(!this.DragRow&&!this.DrawHeader&&!this.DragColumnWidth){var u=this.GetTabChart(),f=!1;if(u){var C=u.PtInTab(t,n);if(C){var D=C.Index;u.MoveOnTabIndex!=D&&(u.MoveOnTabIndex=D,f=!0)}else u.MoveOnTabIndex>=0&&(u.MoveOnTabIndex=-1,f=!0)}this.LastMouseStatus.OnMouseMove={X:t,Y:n};var c={Cursor:"default",Name:"Default"},T=this.GetReportChart(),S=!1;if(T){var I=T.PtInHeaderDragBorder(t,n);if(I)c={Cursor:"col-resize",Name:"DragHeaderWidth"},k.Chart.Log("[JSReportChartContainer::UIOnMouseMove] drag column width ",I);else{var g=T.GetButtonData(t,n),E=null;g&&(c={Cursor:"pointer",Name:"Botton"},(g.Type==1||g.Type==0||g.Type==2)&&(E={Index:g.Index,ColumnIndex:g.ColumnIndex})),(!s&&E||s&&!E||s&&E&&(s.Index!=E.Index||s.ColumnIndex!=E.ColumnIndex))&&(S=!0);var F=T.GetTooltipData(t,n);F&&(F.Type==20?F.Stock&&F.Stock.Symbol&&(l=!0,h={Symbol:F.Stock.OriginalSymbol,Rect:F.Rect}):(this.LastMouseStatus.TooltipStatus={X:t,Y:n,Data:F,ClientX:a.clientX,ClientY:a.clientY},o=!0))}var R=T.VScrollbar;if(R.Enable){var A=T.PtInClient(t,n);this.IsShowVScrollbar=A,this.DragYScroll||(A&&!R.LastStatus.Draw||!A&&R.LastStatus.Draw)&&(S=!0)}}c&&(this.UIElement.style.cursor=c.Cursor),S||f?this.Draw():o&&this.DrawTooltip(this.LastMouseStatus.TooltipStatus),l?this.ShowMinuteChartTooltip(null,null,h):this.HideMinuteChartTooltip()}},this.UIOnMounseOut=function(a){this.HideMinuteChartTooltip();var r=!1,t=this.GetTabChart();t&&t.MoveOnTabIndex>=0&&(t.MoveOnTabIndex=-1,r=!0,this.Draw());var n=this.GetVScrollbarChart();n.Enable&&(this.IsShowVScrollbar=!1,this.DragYScroll||n.LastStatus.Draw&&(r=!0)),r&&this.Draw()},this.UIOnMouseleave=function(a){this.HideMinuteChartTooltip();var r=this.GetTabChart();r&&r.MoveOnTabIndex>=0&&(r.MoveOnTabIndex=-1,this.Draw())},this.DocOnMouseMove=function(a){if(this.DragMove.PreMove.X=this.DragMove.Move.X,this.DragMove.PreMove.Y=this.DragMove.Move.Y,this.DragMove.Move.X=a.clientX,this.DragMove.Move.Y=a.clientX,(this.DragMove.Move.X!=this.DragMove.PreMove.X||this.DragMove.Move.Y!=this.DragMove.PreMove.Y)&&this.StopAutoDragScrollTimer(),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var r=B(),t=(a.clientX-this.UIElement.getBoundingClientRect().left)*r,n=(a.clientY-this.UIElement.getBoundingClientRect().top)*r;if(this.DragRow){var s=this.DragRow,o=s.LastMove.Y-a.clientY;if(Math.abs(o)<2)return;var l=this.GetReportChart();if(s.LastMove.X=a.clientX,s.LastMove.Y=a.clientY,s.Inside={X:t,Y:n},l){var h=l.OnDrawgRow(t,n,a);if(h)if(h.Type==2)h.Data.DataIndex!=s.Data.Row.DataIndex&&(s.MoveRow=h);else if(h.Type==7){var u=l.GetCurrentPageStatus();u.IsEnd||(this.MoveYOffset(1,!1),s.MoveRow=null,this.EnablePageScroll=!0,this.AutoScrollPage(2))}else h.Type==5&&this.Data.YOffset>0&&(this.MoveYOffset(-1,!1),s.MoveRow=null,this.EnablePageScroll=!0,this.AutoScrollPage(-2));l.DragRow=s}this.Draw()}else if(this.DragXScroll){var f=this.ChartPaint[0];if(!f||!f.Tab)return;this.DragXScroll.LastMove.X=t,this.DragXScroll.LastMove.Y=n;var C=f.Tab.GetScrollPostionByPoint(t,n);this.SetXOffset(C)&&this.Draw()}else if(this.DragYScroll){var f=this.ChartPaint[0];if(!f||!f.VScrollbar)return;this.DragYScroll.LastMove.X=t,this.DragYScroll.LastMove.Y=n;var C=f.VScrollbar.GetScrollPostionByPoint(t,n);this.SetYOffset(C)&&(this.Draw(),this.DelayUpdateStockData())}else if(this.DragHeader&&this.DragHeader.ClickData){if(this.DragHeader.ClickData.Header.IsFixed||!this.EnableDragHeader)return;var D=a.clientX-this.DragHeader.Click.X,c=a.clientY-this.DragHeader.Click.Y;if(Math.abs(c)<=1&&Math.abs(D)<=1)return;this.DragHeader.LastMove.X=a.clientX,this.DragHeader.LastMove.Y=a.clientY,this.DragHeader.MovePoint?(this.DragHeader.MovePoint.X=t,this.DragHeader.MovePoint.Y=n):this.DragHeader.MovePoint={X:t,Y:n},this.OnMoveDragHeader(t,n,a),this.ShowDragHeaderTooltip(t,n,a)}else if(this.DragColumnWidth&&this.DragColumnWidth.ClickData){var D=t-this.DragColumnWidth.ClickPoint.X;if(Math.abs(D)<1)return;var T=this.DragColumnWidth.ColumnWidth+D;if(T<=10)return;var S=this.DragColumnWidth.ClickData.Index,I=this.GetEventCallback($.ON_REPORT_DRAG_COLUMN_WIDTH);if(I&&I.Callback){var g={Index:S,Width:T,PreventDefault:!1};if(this.DragColumnWidth&&this.DragColumnWidth.ClickData&&(g.Column=this.DragColumnWidth.ClickData.Column),I.Callback(I,g,this),g.PreventDefault)return}this.SetColumnFixedWidth(S,T),this.DragColumnWidth.LastPoint.X=t,this.DragColumnWidth.LastPoint.Y=n}}},this.SetColumnFixedWidth=function(a,r){var t=this.ChartPaint[0];if(t){var n=t.Column[a];n&&(n.FixedWidth=r,this.SetSizeChange(!0),this.Draw())}},this.OnMoveDragHeader=function(a,r,t){var n=this.ChartPaint[0];if(n){var s=this.DragHeader.ClickData;if(this.DragHeader.MoveToData=null,!s.Header.IsFixed){var o=this.DragHeader.ClickPoint.Y,l=n.OnMouseDown(a,o,t);if(!l||!l.Header||l.Header.IsFixed||l.Header.Index==s.Header.Index)return;this.DragHeader.MoveToData=l,console.log("[JSReportChartContainer::OnMoveDragHeader] Click[Index="+s.Header.Index+", Title="+s.Header.Column.Title+"] => Move[Index="+l.Header.Index+", Title="+l.Header.Column.Title+"]")}}},this.ShowDragHeaderTooltip=function(a,r,t){if(this.DragHeader){var n=this.DragHeader;if(!(!n.ClickData||!n.MovePoint)){var s=this.GetEventCallback($.ON_REPORT_DRAG_HEADER_TOOLTIP);if(s){var o={PreventDefault:!1,e:t,X:a,Y:r,DragHeader:this.DragHeader,Tooltip:this.Tooltip};if(s.Callback(s,o,this),o.PreventDefault)return}var l=n.ClickData.Header.Column.Title;this.Tooltip.className="jchart-chartdrawsvg-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=t.clientX+"px",this.Tooltip.style.top=t.clientY+"px",this.Tooltip.style.width="100px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=l,this.Tooltip.style.display="block"}}},this.HideTooltip=function(){this.Tooltip.style.display!="none"&&(this.Tooltip.style.display="none")},this.DocOnMouseUp=function(a){document.onmousemove=null,document.onmouseup=null,this.StopAutoDragScrollTimer(),this.HideTooltip();var r=this.GetReportChart(),t={Cursor:"default",Name:"Default"},n=!1;this.DragRow&&(r&&(this.OnDragRow(),r.DragRow=null),n=!0);var s=this.DragHeader;if(this.DragHeader=null,this.DragXScroll=null,this.DragYScroll&&(n=!0,this.DragYScroll=null),this.DragRow=null,this.DragMove=null,this.DragColumnWidth=null,n&&this.Draw(),s){var o=s.ClickData,l=s.MoveToData;o&&l?this.SwapColumn(o.Header.Index,l.Header.Index,{Redraw:!0}):this.OnClickHeader(o,a)}t&&(this.UIElement.style.cursor=t.Cursor)},this.OnDragRow=function(){if(!(!this.SourceData||!v.IsNonEmptyArray(this.SourceData.Data))&&!(!this.DragRow||!this.DragRow.MoveRow)){var a=this.DragRow,r=a.Data.Row.DataIndex,t=a.MoveRow.Data.DataIndex;if(!(r==t||r<0||t<0)){var n=this.SourceData.Data;if(!(r>=n.length||t>=n.length)){var s=this.GetEventCallback($.ON_REPORT_DRAG_ROW);if(s){var o={Symbol:this.Symbol,Src:{Index:r,Symbol:n[r]},To:{Index:t,Symbol:n[t]},PreventDefault:!1};if(s.Callback(s,o,this),o.PreventDefault)return}if(this.DragRowType==1){var l=n[r];n[r]=n[t],n[t]=l,this.Data.Data=n.slice(0)}else{var h=n[r];n.splice(r,1),n.splice(t,0,h),this.Data.Data=n.slice(0)}var u=this.GetReportChart();u&&(u.SelectedModel==0?u.SelectedRow=a.MoveRow.Data.Index:u.SelectedRow=a.MoveRow.Data.DataIndex)}}}},this.IsPhoneDragging=function(a){var r=a.changedTouches.length,t=a.touches.length;return r==1&&t==1},this.GetTouchData=function(a){for(var r=[],t=B(),n=0;n<a.touches.length;++n){var s=a.touches[n],o={clientX:s.clientX*t,clientY:s.clientY*t,pageX:s.pageX*t,pageY:s.pageY*t,InsideX:(s.clientX-this.UIElement.getBoundingClientRect().left)*t,InsideY:(s.clientY-this.UIElement.getBoundingClientRect().top)*t};r.push(o)}return r},this.GetMoveAngle=function(a,r){var t=Math.abs(a.X-r.X),n=Math.abs(a.Y-r.Y),s=Math.atan(t/n)*180/Math.PI;return s},this.PreventTouchEvent=function(a){a.cancelable&&a.preventDefault(),a.stopPropagation()},this.OnTouchStart=function(a){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){this.IsOnTouch=!0;var r=this.GetReportChart();if(r&&this.IsPhoneDragging(a)){var t={Click:{},LastMove:{},InsideClick:{}},n=this.GetTouchData(a);t.Click.X=n[0].clientX,t.Click.Y=n[0].clientY,t.InsideClick.X=n[0].InsideX,t.InsideClick.Y=n[0].InsideY,t.LastMove.X=n[0].clientX,t.LastMove.Y=n[0].clientY,t.IsXMove=!1,t.IsYMove=!1,r.IsPtInBody(t.InsideClick.X,t.InsideClick.Y)&&(this.TouchDrag=t),this.TouchInfo={InsideClick:{X:n[0].InsideX,Y:n[0].InsideY},Click:{X:n[0].clientX,Y:n[0].clientY}},this.PreventTouchEvent(a)}}},this.OnDragYOffset=function(a,r,t,n){if(t<5)return!1;var s=!0;a.LastMove.Y<r[0].clientY&&(s=!1);var o=this.YStepPixel;o<=0&&(o=5);var l=parseInt(t/o);return l<=0?!1:(s==!1&&(l*=-1),this.MoveYOffset(l,this.DragPageCycle)&&(a.IsYMove=!0,this.Draw(),this.DelayUpdateStockData()),!0)},this.OnDragXOffset=function(a,r,t,n){if(t<5)return!1;var s=!0;a.LastMove.X<r[0].clientX&&(s=!1);var o=this.XStepPixel;o<=0&&(o=5);var l=parseInt(t/o);return l<=0?!1:(s||(l*=-1),this.MoveXOffset(l)&&(a.IsXMove=!0,this.Draw()),!0)},this.OnTouchMove=function(a){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var r=this.GetReportChart();if(r){var t=this.GetTouchData(a);if(this.IsPhoneDragging(a)){var n=this.TouchDrag;if(this.TouchInfo.Move={X:t[0].clientX,Y:t[0].clientY},n){this.PreventTouchEvent(a);var s=this.GetMoveAngle(n.LastMove,{X:t[0].clientX,Y:t[0].clientY}),o=Math.abs(n.LastMove.X-t[0].clientX),l=Math.abs(n.LastMove.Y-t[0].clientY);if(n.IsYMove==!0){if(this.ShowPageInfo(!0),!this.OnDragYOffset(n,t,l,a))return}else if(n.IsXMove==!0){if(!this.OnDragXOffset(n,t,o,a))return}else if(l>0&&s<this.TouchMoveMinAngle){if(this.ShowPageInfo(!0),!this.OnDragYOffset(n,t,l,a))return}else if(o>0&&s>=this.TouchMoveMinAngle){if(!this.OnDragXOffset(n,t,o,a))return}else return;n.LastMove.X=t[0].clientX,n.LastMove.Y=t[0].clientY}}}}},this.OnTouchEnd=function(a){k.Chart.Log("[JSReportChartContainer:OnTouchEnd]",a),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)&&(this.ShowPageInfo(!1),this.OnTouchClick(this.TouchInfo,a),this.IsOnTouch=!1,this.TouchDrag=null,this.TouchInfo=null)},this.OnTouchClick=function(a,r){if(!a||!a.Click||a.Move)return!1;var t=a.InsideClick,n=this.GetReportChart();if(!n)return!1;var s=n.OnMouseDown(t.X,t.Y,r);if(!s)return!1;s.Type==2||s.Type==4?s.Redraw==!0&&this.Draw():s.Type==3&&this.OnClickHeader(s,r),k.Chart.Log("[JSReportChartContainer:OnTouchClick] clickData",s)},this.GetTabChart=function(){var a=this.ChartPaint[0];return a?a.Tab:null},this.GetVScrollbarChart=function(){var a=this.ChartPaint[0];return a?a.VScrollbar:null},this.GetReportChart=function(){var a=this.ChartPaint[0];return a},this.GotoNextItem=function(a){if(a==0||!this.Data||!v.IsNonEmptyArray(this.Data.Data))return!1;var r=this.ChartPaint[0];if(!r)return!1;var t=r.GetPageSize();if(t>this.Data.Data.length)return!1;var n=0;if(a>0)for(var s=0;s<a&&!(this.Data.YOffset+t>=this.Data.Data.length);++s)++this.Data.YOffset,++n;else if(a<0){a=Math.abs(a);for(var s=0;s<a&&!(this.Data.YOffset<=0);++s)--this.Data.YOffset,++n}return n>0},this.GotoNextPage=function(a){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return!1;var r=this.ChartPaint[0];if(!r)return!1;var t=r.GetPageSize(),n=r.GetAllRowCount();if(t>n)return!1;if(this.Data.YOffset+t>=n)return a===!0?(this.Data.YOffset=0,!0):!1;this.Data.YOffset+=t;var s=n-this.Data.YOffset;return r.SelectedModel==0&&r.SelectedRow>s-1&&(r.SelectedRow=s-1),!0},this.GotoPreviousPage=function(a){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return!1;var r=this.ChartPaint[0];if(!r)return!1;var t=r.GetPageSize(),n=r.GetAllRowCount();if(t>n)return!1;if(this.Data.YOffset<=0)return a===!0?(this.Data.YOffset=n-t,!0):!1;var s=this.Data.YOffset;return s-=t,s<0&&(s=0),this.Data.YOffset=s,!0},this.MoveYOffset=function(a,r){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return!1;var t=this.ChartPaint[0];if(!t)return!1;var n=t.GetCurrentPageStatus();if(n.IsSinglePage)return!1;if(a>0){var s=this.Data.Data.length,o=n.PageSize,l=this.Data.YOffset;if(r)for(var h=0;h<a;++h)++l,l+o>s&&(l=0);else{if(l+o>=s)return!1;for(var h=0;h<a&&!(l+o+1>s);++h)++l}return this.Data.YOffset=l,!0}else if(a<0){a=Math.abs(a);var l=this.Data.YOffset;if(r)for(var o=n.PageSize,h=0;h<a;++h)--l,l<0&&(l=this.Data.Data.length-o);else{if(this.Data.YOffset<=0)return!1;for(var h=0;h<a&&!(l-1<0);++h)--l}return this.Data.YOffset=l,!0}return!1},this.MoveSelectedRow=function(a){var r=this.ChartPaint[0];if(!r||!v.IsNonEmptyArray(this.Data.Data))return null;var t={Redraw:!1,Update:!1};if(r.MultiSelectModel==1){var n=r.GetCurrentPageStatus();if(v.IsNonEmptyArray(n.MultiSelectedRow)){var s=n.MultiSelectedRow[0];if(a>0){if(s==this.Data.Data.length-1)return t;if(s<0||s<n.Start||s>n.End)return r.MultiSelectedRow=[n.Start],t.Redraw=!0,t;for(var o=this.Data.YOffset,l=0;l<a;++l)++s,s>n.End&&++o,s>=this.Data.Data.length&&(s=0,o=0);return t.Redraw=!0,t.Update=o!=this.Data.YOffset,r.MultiSelectedRow=[s],this.Data.YOffset=o,t}else if(a<0){if(s==0)return t;if(s<0||s<n.Start||s>n.End)return r.MultiSelectedRow=[n.End],t.Redraw=!0,t;a=Math.abs(a);for(var o=this.Data.YOffset,l=0;l<a;++l)--s,s<n.Start&&--o,s<0&&(s=this.Data.Data.length-1,o=this.Data.Data.length-h,o<0&&(o=0));return t.Redraw=!0,t.Update=o!=this.Data.YOffset,r.MultiSelectedRow=[s],this.Data.YOffset=o,t}else return null}else{var s=-1;if(a>0)s=n.Start;else if(a<0)s=n.End;else return null;r.MultiSelectedRow=[s],t.Redraw=!0}return t}if(r.SelectedModel==0){var n=r.GetCurrentPageStatus(),h=n.End-n.Start+1,s=n.SelectedRow;if(a>0)return s+=a,s=s%h,r.SelectedRow=s,r.SelectedFixedRow=-1,t.Redraw=!0,t;if(a<0)return s+=a,s<0&&(s=s%h,s=h+s),r.SelectedRow=s,r.SelectedFixedRow=-1,t.Redraw=!0,t}else if(r.SelectedModel==1){var n=r.GetCurrentPageStatus(),h=n.PageSize,s=n.SelectedRow;if(a>0){if(s<0||s<n.Start||s>n.End)return r.SelectedRow=n.Start,t.Redraw=!0,t;for(var o=this.Data.YOffset,l=0;l<a;++l)++s,s>n.End&&++o,s>=this.Data.Data.length&&(s=0,o=0);return t.Redraw=!0,t.Update=o!=this.Data.YOffset,r.SelectedRow=s,this.Data.YOffset=o,t}else if(a<0){if(s<0||s<n.Start||s>n.End)return r.SelectedRow=n.End,t.Redraw=!0,t;a=Math.abs(a);for(var o=this.Data.YOffset,l=0;l<a;++l)--s,s<n.Start&&--o,s<0&&(s=this.Data.Data.length-1,o=this.Data.Data.length-h,o<0&&(o=0));return t.Redraw=!0,t.Update=o!=this.Data.YOffset,r.SelectedRow=s,this.Data.YOffset=o,t}}return null},this.MoveXOffset=function(a){var r=this.ChartPaint[0];if(!r)return!1;var t=r.GetXScrollRange();if(t<=0)return!1;if(a>0){if(this.Data.XOffset>=t)return!1;for(var n=0;n<a&&!(this.Data.XOffset>=t);++n)++this.Data.XOffset;return!0}else if(a<0){if(this.Data.XOffset<=0)return!1;a=Math.abs(a);for(var n=0;n<a&&!(this.Data.XOffset-1<0);++n)--this.Data.XOffset;return!0}return!1},this.SetXOffset=function(a){if(!v.IsNumber(a))return!1;var r=this.ChartPaint[0];if(!r)return!1;var t=r.GetXScrollRange();return a<0&&(a=0),a>t&&(a=t),this.Data.XOffset=a,!0},this.SetYOffset=function(a){if(!v.IsNumber(a))return!1;var r=this.ChartPaint[0];if(!r)return!1;var t=r.GetYScrollRange();return a<0&&(a=0),a>t&&(a=t),this.Data.YOffset=a,!0},this.GotoLastPage=function(){var a=this.ChartPaint[0];if(a){var r=a.GetPageSize(!0),t=this.Data.Data.length-r;t<0&&(t=0),this.Data.DataOffset=t}},this.SetColumn=function(a,r){var t=this.ChartPaint[0];t&&(t.SetColumn(a),t.SizeChange=!0,r&&r.Redraw&&this.Draw())},this.SetTab=function(a,r){var t=this.ChartPaint[0];if(t){var n=t.Tab;n&&(n.SetTabList(a),r&&r.Redraw&&this.Draw())}},this.SetVScrollbar=function(a){var r=this.GetReportChart();if(r){var t=r.VScrollbar;t&&t.SetOption(a)}},this.SetSelectedTab=function(a,r){var t=this.ChartPaint[0];if(t){var n=t.Tab;n&&(n.SelectedTabIndex=a)}},this.ReloadResource=function(a){this.Frame.ReloadResource(a);for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.ReloadResource&&t.ReloadResource(a)}a&&a.Redraw&&(this.SetSizeChange(!0),this.Draw()),this.MinuteChartTooltip&&this.MinuteChartTooltip.ReloadResource(a)},this.SortColumn=function(a,r){var t=this;if(a<0)return!1;var n=this.GetReportChart();if(!n)return!1;var s=n.Column[a];if(!s||s.Sort!=1&&s.Sort!=2)return!1;var o={Field:a,Sort:r};if(this.Data.Virtual&&this.Data.Virtual.Enable)return this.SortInfo.Field=o.Field,this.SortInfo.Sort=o.Sort,this.Data.YOffset=0,this.ResetReportSelectStatus(),this.RequestVirtualStockData(),!0;if(o.Sort==0)this.Data.Data=[],v.IsNonEmptyArray(this.SourceData.Data)&&(this.Data.Data=this.SourceData.Data.slice());else if(o.Sort==1||o.Sort==2){if(s.Sort==1){var l=this.GetEventCallback($.ON_REPORT_LOCAL_SORT);if(l&&l.Callback){var h={Column:s,SortInfo:o,SymbolList:this.Data.Data,Result:null};l.Callback(l,h,this),Array.isArray(h.Result)&&(this.Data.Data=h.Result)}else this.Data.Data.sort(function(u,f){return t.LocalSort(u,f,s,o.Sort)})}else if(s.Sort==2)return v.IsNonEmptyArray(this.Data.Data)?(this.SortInfo.Field=o.Field,this.SortInfo.Sort=o.Sort,this.Data.YOffset=0,this.ResetReportSelectStatus(),this.RequestStockSortData(s,o.Field,o.Sort),!0):void 0}return this.Data.YOffset=0,this.ResetReportSelectStatus(),this.SortInfo.Field=o.Field,this.SortInfo.Sort=o.Sort,this.Draw(),this.DelayUpdateStockData(),!0},this.OnClickHeader=function(a,r){var t=this,n=a.Header;if(n.Column&&n.Column.EnablePopupHeaderMenu){this.PopupHeaderMenu(a,r);return}if(n.Column&&(n.Column.Sort==1||n.Column.Sort==2)){var s=n.Index,o={Field:this.SortInfo.Field,Sort:this.SortInfo.Sort},l=n.Column.SortType;if(o.Field!=s)o.Field=s,o.Sort=l[0];else if(l.length==1)o.Sort=l[0];else for(var h=0;h<l.length;++h)if(o.Sort==l[h]){o.Sort=l[(h+1)%l.length];break}if(n.Column.Sort==1||n.Column.Sort==2){if(o.Sort==0){this.Data.Data=[];for(var h=0;h<this.SourceData.Data.length;++h)this.Data.Data.push(this.SourceData.Data[h])}else if(n.Column.Sort==1){var u=this.GetEventCallback($.ON_REPORT_LOCAL_SORT);if(u&&u.Callback){var f={Column:n.Column,SortInfo:o,SymbolList:this.Data.Data,Result:null};u.Callback(u,f,this),Array.isArray(f.Result)&&(this.Data.Data=f.Result)}else this.Data.Data.sort(function(C,D){return t.LocalSort(C,D,n.Column,o.Sort)})}else if(n.Column.Sort==2){if(!v.IsNonEmptyArray(this.Data.Data))return;this.SortInfo.Field=o.Field,this.SortInfo.Sort=o.Sort,this.Data.YOffset=0,this.ResetReportSelectStatus(),this.RequestStockSortData(n.Column,o.Field,o.Sort);return}this.Data.YOffset=0,this.ResetReportSelectStatus(),this.SortInfo.Field=o.Field,this.SortInfo.Sort=o.Sort,this.Draw(),this.DelayUpdateStockData()}}},this.PopupHeaderMenu=function(a,r){var t=this;if(this.JSPopMenu&&this.GetEventCallback){var n=this.GetEventCallback($.ON_CREATE_REPORT_HEADER_MENU);if(!(!n||!n.Callback)){var s=a.Header,o=s.Column,l={Menu:null,Position:Ne.POSITION_ID.DROPDOWN_MENU_ID};l.ClickCallback=function(u){t.OnClickHeaderMenu(o,u)};var h={MenuData:l,Column:o,Index:s.Index,PreventDefault:!1,e:r};n.Callback(n,h,this),h.PreventDefault!=!0&&l.Menu&&this.PopupMenuByDrapdown(l,s.Rect)}}},this.PopupMenuByDrapdown=function(a,r){if(this.JSPopMenu){var t=B(),n={Left:r.Left/t,Right:r.Right/t,Bottom:r.Bottom/t,Top:r.Top/t};n.Width=n.Right-n.Left,n.Height=n.Bottom-n.Top;var s=this.UIElement.getBoundingClientRect(),o=Da(),l=s.left+o.Left,h=s.top+o.Top;n.Left+=l,n.Right+=l,n.Top+=h,n.Bottom+=h,this.JSPopMenu.CreatePopMenu(a),this.JSPopMenu.PopupMenuByDrapdown(n)}},this.GetTabPopMenu=function(a){var r=[];if(v.IsNonEmptyArray(a.ArySubMenu))for(var t=0;t<a.ArySubMenu.length;++t){var n=a.ArySubMenu[t],s={Name:n.Title,Data:{ID:n.CommandID,Args:[n.ID]}};n.Text&&(s.Text=n.Text),r.push(s)}return r},this.PopupTabMenu=function(a,r,t){if(this.JSPopMenu){var n=r.Rect,s=B(),o={Left:n.Left/s,Right:n.Right/s,Bottom:n.Bottom/s,Top:n.Top/s};o.Width=o.Right-o.Left,o.Height=o.Bottom-o.Top;var l=this.UIElement.getBoundingClientRect(),h=Da(),u=l.left+h.Left,f=l.top+h.Top;o.Left+=u,o.Right+=u,o.Top+=f,o.Bottom+=f,this.JSPopMenu.CreatePopMenu(a),this.JSPopMenu.PopupMenuByTab(o),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()}},this.OnClickTab=function(a,r){var t=this;if(a.Tab){var n=!1,s=B(),o=(r.clientX-this.UIElement.getBoundingClientRect().left)*s;(r.clientY-this.UIElement.getBoundingClientRect().top)*s;var l={Left:this.UIElement.getBoundingClientRect().left,Top:this.UIElement.getBoundingClientRect().top};if(a.Tab.IsMenu){var h={Menu:this.GetTabPopMenu(a.Tab),Position:Ne.POSITION_ID.TAB_MENU_ID};h.ClickCallback=function(C){t.OnClickTabPopMenu(a,C)};var u=this.GetEventCallback($.ON_CLICK_REPORT_TABMENU);if(u&&u.Callback){var f={MenuData:h,Tab:a,PreventDefault:!1,e:r};if(u.Callback(u,f,this),f.PreventDefault==!0)return}this.PopupTabMenu(h,a.Tab,r)}else{var u=this.GetEventCallback($.ON_CLICK_REPORT_TAB);if(u&&u.Callback){var f={Data:a,IsSide:{X:o,Y:o},UIElement:l,e:r,Redraw:n,PreventDefault:!1};if(u.Callback(u,f,this),v.IsBool(f.Redraw)&&(n=f.Redraw),f.PreventDefault==!0)return}a.Tab.CommandID==q.CMD_REPORT_CHANGE_BLOCK_ID&&(this.ExecuteMenuCommand(a.Tab.CommandID,[a.Tab.ID]),this.SetSelectedTab(a.Index),n=!0)}n&&this.Draw()}},this.OnClickTabPopMenu=function(a,r){k.Chart.Log("[JSReportChartContainer::OnClickTabPopMenu] ",a,r);var t=r.Data.ID,n=r.Data.Args,s=this.GetEventCallback($.ON_MENU_COMMAND);if(s&&s.Callback){var r={PreventDefault:!1,CommandID:t,Args:n,SrcData:r,TabData:a};if(s.Callback(s,r,this),r.PreventDefault)return}this.ExecuteMenuCommand(t,n),this.SetSelectedTab(a.Index),this.Draw()},this.OnClickHeaderMenu=function(a,r){k.Chart.Log("[JSReportChartContainer::OnClickHeaderMenu] ",a,r);var t=r.Data.ID,n=r.Data.Args,s=this.GetEventCallback($.ON_MENU_COMMAND);if(s&&s.Callback){var r={PreventDefault:!1,CommandID:t,Args:n,SrcData:r,MenuData:a};if(s.Callback(s,r,this),r.PreventDefault)return}this.ExecuteMenuCommand(t,n)},this.ExecuteMenuCommand=function(a,r){k.Chart.Log("[JSReportChartContainer::ExecuteMenuCommand] cmdID=, aryArgs=",a,r);var t=null,n=null;switch(v.IsNonEmptyArray(r)&&(n=r[0],v.IsNumber(r[0])&&(t=r[0])),a){case q.CMD_REPORT_CHANGE_BLOCK_ID:n&&this.ChangeSymbol(n);break;case q.CMD_REPORT_COLUMN_SORT_ID:v.IsNumber(t)&&v.IsNumber(r[1])&&this.SortColumn(t,r[1]);break;case q.CMD_REPORT_COLUMN_MOVE_ID:if(v.IsNumber(t)&&v.IsNumber(r[1])){var s=t,o=t+r[1];this.SwapColumn(s,o,{Redraw:!0})}break;case q.CMD_REPORT_COLUMN_DEL_ID:v.IsNumber(t)&&this.DeleteColumn(t,{Redraw:!0});break}},this.SwapColumn=function(a,r,t){var n=this.GetReportChart();n&&n.SwapColumn(a,r)&&t&&t.Redraw&&(this.SetSizeChange(!0),this.Draw())},this.DeleteColumn=function(a,r){var t=this.GetReportChart();t&&t.DeleteColumn(a)&&r&&r.Redraw&&(this.SetSizeChange(!0),this.Draw())},this.LocalSort=function(a,r,t,n){switch(t.Type){case X.SYMBOL_ID:case X.NAME_ID:return this.LocalStringSort(a,r,t,n);case X.NAME_EX_ID:return this.LocalNameExSort(a,r,t,n);case X.PRICE_ID:case X.VOL_ID:case X.INCREASE_ID:case X.UPDOWN_ID:case X.BUY_PRICE_ID:case X.SELL_PRICE_ID:case X.AMOUNT_ID:case X.BUY_VOL_ID:case X.SELL_VOL_ID:case X.YCLOSE_ID:case X.OPEN_ID:case X.HIGH_ID:case X.LOW_ID:case X.AVERAGE_PRICE_ID:case X.OUTSTANDING_SHARES_ID:case X.TOTAL_SHARES_ID:case X.CIRC_MARKET_VALUE_ID:case X.MARKET_VALUE_ID:case X.EXCHANGE_RATE_ID:case X.AMPLITUDE_ID:case X.LIMIT_HIGH_ID:case X.LIMIT_LOW_ID:case X.FUTURES_POSITION_ID:case X.FUTURES_CLOSE_ID:case X.FUTURES_YCLOSE_ID:case X.FUTURES_OPEN_POSITION_ID:case X.FUTURES_CLOSE_POSITION_ID:case X.VOL_IN_ID:case X.VOL_OUT_ID:case X.DATE_ID:case at.RESERVE_NUMBER1_ID:case at.RESERVE_NUMBER2_ID:case at.RESERVE_NUMBER3_ID:case at.RESERVE_NUMBER4_ID:case at.RESERVE_NUMBER5_ID:case at.RESERVE_NUMBER6_ID:case at.RESERVE_NUMBER7_ID:case at.RESERVE_NUMBER8_ID:case at.RESERVE_NUMBER9_ID:case at.RESERVE_NUMBER10_ID:return this.LocalNumberSort(a,r,t,n);case X.CUSTOM_NUMBER_TEXT_ID:return this.LoacCustomNumberSort(a,r,t,n);case X.CUSTOM_STRING_TEXT_ID:return this.LoacCustomStringSort(a,r,t,n);case X.CUSTOM_DATETIME_TEXT_ID:return this.LoacCustomDateTimeSort(a,r,t,n);default:return 0}},this.GetStockExtendData=function(a,r){if(v.IsNumber(r.DataIndex)){if(r.DataIndex<0)return null;var t=this.GetStockData(a);return!t||!t.ExtendData?null:t.ExtendData[r.DataIndex]}if(v.IsNumber(r.BlockIndex)){if(r.BlockIndex<0)return null;var t=this.GetBlockData(a);return t?t[r.BlockIndex]:null}return null},this.LocalNameExSort=function(a,r,t,n){var s=this.GetStockData(a),o=this.GetStockData(r),l="",h="";return n==2&&(l="啊啊啊啊啊",h="啊啊啊啊啊"),s&&s.Name&&(l=s.Name),o&&o.Name&&(h=o.Name),n==1?h<l?-1:h<l?1:0:l<h?-1:l>h?1:0},this.LocalStringSort=function(a,r,t,n){var s=this.GetStockData(a),o=this.GetStockData(r),l="",h="";n==2&&(l="啊啊啊啊啊",h="啊啊啊啊啊");var u=li.get(t.Type);return s&&s[u]&&(l=s[u]),o&&o[u]&&(h=o[u]),n==1?h<l?-1:h<l?1:0:l<h?-1:l>h?1:0},this.LocalNumberSort=function(a,r,t,n){var s=this.GetStockData(a),o=this.GetStockData(r),l=-99999999999999,h=-99999999999999;n==2&&(l=h=99999999999999);var u=li.get(t.Type);return s&&v.IsNumber(s[u])&&(l=s[u]),o&&v.IsNumber(o[u])&&(h=o[u]),n==1?h<l?-1:h<l?1:0:l<h?-1:l>h?1:0},this.LoacCustomNumberSort=function(a,r,t,n){var s=-99999999999999,o=-99999999999999;n==2&&(s=o=99999999999999);var l=this.GetStockExtendData(a,t);v.IsNumber(l)&&(s=l);var l=this.GetStockExtendData(r,t);return v.IsNumber(l)&&(o=l),n==1?o<s?-1:o<s?1:0:s<o?-1:s>o?1:0},this.LoacCustomDateTimeSort=function(a,r,t,n){var s=-99999999999999,o=-99999999999999;n==2&&(s=o=99999999999999);var l=this.GetStockExtendData(a,t);v.IsNumber(l)&&(s=l);var l=this.GetStockExtendData(r,t);return v.IsNumber(l)&&(o=l),n==1?o<s?-1:o<s?1:0:s<o?-1:s>o?1:0},this.LoacCustomStringSort=function(a,r,t,n){var s="",o="";n==2&&(o=s="啊啊啊啊啊");var l=this.GetStockExtendData(a,t);v.IsString(l)&&(s=l);var l=this.GetStockExtendData(r,t);return v.IsString(l)&&(o=l),n==1?o<s?-1:o<s?1:0:s<o?-1:s>o?1:0},this.RequestStockSortData=function(a,r,t){var n=this.ChartPaint[0];if(n){var s=this,o=this.Data.YOffset,l=n.GetPageSize(),h=o+l;if(h>=this.Data.Data.length&&(h=this.Data.Data.length-1),this.NetworkFilter){var u={Name:"JSDealChartContainer::RequestStockSortData",Explain:"报价列表股票排序数据",Request:{Data:{range:{start:o,end:h,count:this.Data.Data.length},column:{name:a.Title,type:a.Type,index:r,ID:a.ID},sort:t,symbol:this.Symbol,name:this.Name,pageSize:l}},Self:this,PreventDefault:!1};if(n.FixedRowCount>0&&n.FixedRowData.Type==1){for(var f=[],C=0;C<n.FixedRowData.Symbol.length;++C){var D=n.FixedRowData.Symbol[C];D&&f.push(D)}u.Request.FixedSymbol=f}if(this.NetworkFilter(u,function(c){s.RecvStockSortData(c),s.AutoUpdate()}),u.PreventDefault==!0)return}}},this.RecvStockSortData=function(a){var r=[];if(v.IsNonEmptyArray(a.data))for(var t=0;t<a.data.length;++t){var n=a.data[t],s=n[0];if(s){var o=null;this.MapStockData.has(s)?o=this.MapStockData.get(s):(o=new es,o.OriginalSymbol=s,o.Symbol=this.GetSymbolNoSuffix(s),this.MapStockData.set(s,o)),this.ReadStockJsonData(o,n),r.push(s)}}if(v.IsNonEmptyArray(a.index))for(var t=0;t<a.index.length;++t){var l=a.index[t],h=r[t],u=this.Data.Data[l];h!=u&&(this.Data.Data[l]=h)}if(a.Virtual){var n=a.Virtual;v.IsNumber(n.Count)&&(this.Data.Virtual.Count=n.Count)}var f=this.ChartPaint[0];f&&this.Draw()},this.RequestVirtualStockData=function(){var a=this.ChartPaint[0];if(a){var r=this,t=this.Data.YOffset,n=a.GetPageSize(),s=t+n,o=a.GetAllRowCount();if(s>=o&&(s=o-1),!!this.NetworkFilter){var l={range:{start:t,end:s,count:a.GetAllRowCount()},column:null,sort:0,symbol:this.Symbol,name:this.Name,pageSize:n};if(this.SortInfo&&this.SortInfo.Field>=0&&this.SortInfo.Sort>0){var h=a.Column[this.SortInfo.Field];l.column={name:h.Title,type:h.Type,index:this.SortInfo.Field,ID:h.ID},l.sort=this.SortInfo.Sort}var u={Name:"JSDealChartContainer::RequestVirtualStockData",Explain:"报价列表股票数据(虚拟表格)",Request:{Data:l},Self:this,PreventDefault:!1};if(a.FixedRowCount>0&&a.FixedRowData.Type==1){for(var f=[],C=0;C<a.FixedRowData.Symbol.length;++C){var D=a.FixedRowData.Symbol[C];D&&f.push(D)}u.Request.FixedSymbol=f}this.NetworkFilter(u,function(c){r.RecvStockSortData(c),r.AutoUpdate()}),u.PreventDefault!=!0}}},this.ShowPageInfo=function(a){var r=this.ChartPaint[1];return r?(r.IsShow=a,!0):!1},this.DrawTooltip=function(a){if(this.GetExtraCanvas){if(!this.TooltipCanvas){var r=this.GetExtraCanvas(Fi.TooltipCursorCanvasKey);if(!r)return;this.TooltipCanvas=r.Canvas}this.TooltipCanvas&&(this.ClearCanvas(this.TooltipCanvas),this.ChartTooltip&&(!a||!a.Data||(this.ChartTooltip.Canvas=this.TooltipCanvas,this.ChartTooltip.Point={X:a.X,Y:a.Y},this.ChartTooltip.Data=a.Data.Data,this.ChartTooltip.Draw())))}}}function ug(){this.ChartBorder,this.Canvas,this.BorderLine=null,this.BorderColor=d.Report.BorderColor,this.LogoTextColor=d.FrameLogo.TextColor,this.LogoTextFont=d.FrameLogo.Font,this.ReloadResource=function(e){this.BorderColor=d.Report.BorderColor,this.LogoTextColor=d.FrameLogo.TextColor,this.LogoTextFont=d.FrameLogo.Font},this.Draw=function(){var e=L(this.ChartBorder.GetLeft()),a=L(this.ChartBorder.GetTop()),r=L(this.ChartBorder.GetRight()),t=L(this.ChartBorder.GetBottom()),n=r-e,s=t-a;v.IsNumber(this.BorderLine)?(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),(this.BorderLine&1)>0&&(this.Canvas.moveTo(e,a),this.Canvas.lineTo(r,a)),(this.BorderLine&2)>0&&(this.Canvas.moveTo(e,t),this.Canvas.lineTo(r,t)),(this.BorderLine&4)>0&&(this.Canvas.moveTo(e,a),this.Canvas.lineTo(e,t)),(this.BorderLine&8)>0&&(this.Canvas.moveTo(r,a),this.Canvas.lineTo(r,t)),this.Canvas.stroke()):(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(e,a,n,s))},this.DrawLogo=function(){var e=d.FrameLogo.Text;if(v.IsString(e)){this.Canvas.fillStyle=this.LogoTextColor,this.Canvas.font=this.LogoTextFont,this.Canvas.textAlign="right",this.Canvas.textBaseline="bottom";var a=this.ChartBorder.GetRight()-30,r=this.ChartBorder.GetBottom()-5;this.Canvas.fillText(e,a,r)}}}var X={SYMBOL_ID:0,NAME_ID:1,PRICE_ID:2,VOL_ID:3,INCREASE_ID:4,UPDOWN_ID:5,BUY_PRICE_ID:6,SELL_PRICE_ID:7,AMOUNT_ID:8,BUY_VOL_ID:9,SELL_VOL_ID:10,YCLOSE_ID:11,OPEN_ID:12,HIGH_ID:13,LOW_ID:14,AVERAGE_PRICE_ID:15,INDEX_ID:16,OUTSTANDING_SHARES_ID:17,TOTAL_SHARES_ID:18,CIRC_MARKET_VALUE_ID:19,MARKET_VALUE_ID:20,EXCHANGE_RATE_ID:21,AMPLITUDE_ID:22,LIMIT_HIGH_ID:23,LIMIT_LOW_ID:24,VOL_IN_ID:25,VOL_OUT_ID:26,NAME_EX_ID:27,CLOSE_LINE_ID:28,KLINE_ID:29,TIME_ID:31,DATE_ID:32,CHECKBOX_ID:33,FUTURES_POSITION_ID:34,FUTURES_CLOSE_ID:35,FUTURES_YCLOSE_ID:36,FUTURES_OPEN_POSITION_ID:37,FUTURES_CLOSE_POSITION_ID:38,RISING_SPEED_1M_ID:60,RISING_SPEED_3M_ID:61,RISING_SPEED_5M_ID:62,RISING_SPEED_10M_ID:63,RISING_SPEED_15M_ID:64,SYMBOL_NAME_V2_ID:98,SYMBOL_NAME_ID:99,CUSTOM_STRING_TEXT_ID:100,CUSTOM_NUMBER_TEXT_ID:101,CUSTOM_DATETIME_TEXT_ID:102,CUSTOM_ICON_ID:103,CUSTOM_CHECKBOX_ID:104,CUSTOM_BUTTON_ID:105,CUSTOM_PROGRESS_ID:106,CUSTOM_LINK_ID:107,RESERVE_NUMBER1_ID:201,RESERVE_NUMBER2_ID:202,RESERVE_NUMBER3_ID:203,RESERVE_NUMBER4_ID:204,RESERVE_NUMBER5_ID:205,RESERVE_NUMBER6_ID:206,RESERVE_NUMBER7_ID:207,RESERVE_NUMBER8_ID:208,RESERVE_NUMBER9_ID:209,RESERVE_NUMBER10_ID:210,RESERVE_STRING1_ID:301,RESERVE_STRING2_ID:302,RESERVE_STRING3_ID:303,RESERVE_STRING4_ID:304,RESERVE_STRING5_ID:305,RESERVE_STRING6_ID:306,RESERVE_STRING7_ID:307,RESERVE_STRING8_ID:308,RESERVE_STRING9_ID:309,RESERVE_STRING10_ID:310,RESERVE_PROGRESS_BAR1_ID:401,RESERVE_PROGRESS_BAR2_ID:402,RESERVE_PROGRESS_BAR3_ID:403,RESERVE_PROGRESS_BAR4_ID:404,RESERVE_PROGRESS_BAR5_ID:405,RESERVE_PROGRESS_BAR6_ID:406,RESERVE_PROGRESS_BAR7_ID:407,RESERVE_PROGRESS_BAR8_ID:408,RESERVE_PROGRESS_BAR9_ID:409,RESERVE_PROGRESS_BAR10_ID:410,RESERVE_BUTTON1_ID:451,RESERVE_BUTTON2_ID:452,RESERVE_BUTTON3_ID:453,RESERVE_BUTTON4_ID:454,RESERVE_BUTTON5_ID:455,RESERVE_BUTTON6_ID:456,RESERVE_BUTTON7_ID:457,RESERVE_BUTTON8_ID:458,RESERVE_BUTTON9_ID:459,RESERVE_BUTTON10_ID:460},li=new Dt.default([[X.SYMBOL_ID,"Symbol"],[X.NAME_ID,"Name"],[X.PRICE_ID,"Price"],[X.INCREASE_ID,"Increase"],[X.UPDOWN_ID,"UpDown"],[X.VOL_ID,"Vol"],[X.BUY_PRICE_ID,"BuyPrice"],[X.SELL_PRICE_ID,"SellPrice"],[X.AMOUNT_ID,"Amount"],[X.BUY_VOL_ID,"BuyVol"],[X.SELL_VOL_ID,"SellVol"],[X.YCLOSE_ID,"YClose"],[X.OPEN_ID,"Open"],[X.HIGH_ID,"High"],[X.LOW_ID,"Low"],[X.AVERAGE_PRICE_ID,"AvPrice"],[X.OUTSTANDING_SHARES_ID,"OutShares"],[X.TOTAL_SHARES_ID,"TotalShares"],[X.CIRC_MARKET_VALUE_ID,"CircMarketValue"],[X.MARKET_VALUE_ID,"MarketValue"],[X.EXCHANGE_RATE_ID,"Exchange"],[X.AMPLITUDE_ID,"Amplitude"],[X.LIMIT_HIGH_ID,"LimitHigh"],[X.LIMIT_LOW_ID,"LimitLow"],[X.VOL_IN_ID,"VolIn"],[X.VOL_OUT_ID,"VolOut"],[X.NAME_EX_ID,"NameEx"],[X.DATE_ID,"Date"],[X.FUTURES_POSITION_ID,"Position"],[X.FUTURES_CLOSE_ID,"FClose"],[X.FUTURES_YCLOSE_ID,"YFClose"],[X.FUTURES_OPEN_POSITION_ID,"OpenPosition"],[X.FUTURES_CLOSE_POSITION_ID,"ClosePosition"],[X.RISING_SPEED_1M_ID,"RSpeed1M"],[X.RISING_SPEED_3M_ID,"RSpeed3M"],[X.RISING_SPEED_5M_ID,"RSpeed5M"],[X.RISING_SPEED_10M_ID,"RSpeed10M"],[X.RISING_SPEED_15M_ID,"RSpeed15M"],[X.RESERVE_NUMBER1_ID,"ReserveNumber1"],[X.RESERVE_NUMBER2_ID,"ReserveNumber2"],[X.RESERVE_NUMBER3_ID,"ReserveNumber3"],[X.RESERVE_NUMBER4_ID,"ReserveNumber4"],[X.RESERVE_NUMBER5_ID,"ReserveNumber5"],[X.RESERVE_NUMBER6_ID,"ReserveNumber6"],[X.RESERVE_NUMBER7_ID,"ReserveNumber7"],[X.RESERVE_NUMBER8_ID,"ReserveNumber8"],[X.RESERVE_NUMBER9_ID,"ReserveNumber9"],[X.RESERVE_NUMBER10_ID,"ReserveNumber10"],[X.RESERVE_STRING1_ID,"ReserveString1"],[X.RESERVE_STRING2_ID,"ReserveString2"],[X.RESERVE_STRING3_ID,"ReserveString3"],[X.RESERVE_STRING4_ID,"ReserveString4"],[X.RESERVE_STRING5_ID,"ReserveString5"],[X.RESERVE_STRING6_ID,"ReserveString6"],[X.RESERVE_STRING7_ID,"ReserveString7"],[X.RESERVE_STRING8_ID,"ReserveString8"],[X.RESERVE_STRING9_ID,"ReserveString9"],[X.RESERVE_STRING10_ID,"ReserveString10"],[X.RESERVE_PROGRESS_BAR1_ID,"ReserveProgressBar1"],[X.RESERVE_PROGRESS_BAR2_ID,"ReserveProgressBar2"],[X.RESERVE_PROGRESS_BAR3_ID,"ReserveProgressBar3"],[X.RESERVE_PROGRESS_BAR4_ID,"ReserveProgressBar4"],[X.RESERVE_PROGRESS_BAR5_ID,"ReserveProgressBar5"],[X.RESERVE_PROGRESS_BAR6_ID,"ReserveProgressBar6"],[X.RESERVE_PROGRESS_BAR7_ID,"ReserveProgressBar7"],[X.RESERVE_PROGRESS_BAR8_ID,"ReserveProgressBar8"],[X.RESERVE_PROGRESS_BAR9_ID,"ReserveProgressBar9"],[X.RESERVE_PROGRESS_BAR10_ID,"ReserveProgressBar10"],[X.RESERVE_BUTTON1_ID,"ReserveButton1"],[X.RESERVE_BUTTON2_ID,"ReserveButton2"],[X.RESERVE_BUTTON3_ID,"ReserveButton3"],[X.RESERVE_BUTTON4_ID,"ReserveButton4"],[X.RESERVE_BUTTON5_ID,"ReserveButton5"],[X.RESERVE_BUTTON6_ID,"ReserveButton6"],[X.RESERVE_BUTTON7_ID,"ReserveButton7"],[X.RESERVE_BUTTON8_ID,"ReserveButton8"],[X.RESERVE_BUTTON9_ID,"ReserveButton9"],[X.RESERVE_BUTTON10_ID,"ReserveButton10"]]);function fg(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ChartReport",this.UIElement,this.IsDrawFirst=!1,this.GetEventCallback,this.GetStockDataCallback,this.GetFlashBGDataCallback,this.GetBlockDataCallback,this.Data,this.FixedRowData,this.SortInfo,this.FixedColumn=2,this.FixedRowCount=0,this.IsShowHeader=!0,this.SizeChange=!0,this.SelectedModel=0,this.SelectedRow=-1,this.SelectedFixedRow=-1,this.IsDrawBorder=1,this.MultiSelectModel=0,this.MultiSelectedRow=[],this.ShowSymbol=[],this.DragRow,this.Tab,this.VScrollbar,this.GlobalOption,this.TextOverflowStyle=0,this.UpColor=d.Report.UpTextColor,this.DownColor=d.Report.DownTextColor,this.UnchagneColor=d.Report.UnchagneTextColor,this.BorderColor=d.Report.BorderColor,this.SelectedColor=d.Report.SelectedColor,this.HeaderFontConfig={Size:d.Report.Header.Font.Size,Name:d.Report.Header.Font.Name},this.HeaderColor=d.Report.Header.Color,this.HeaderMergin={Left:d.Report.Header.Mergin.Left,Right:d.Report.Header.Mergin.Right,Top:d.Report.Header.Mergin.Top,Bottom:d.Report.Header.Mergin.Bottom},this.SortConfig={Size:d.Report.SortIcon.Size,Family:d.Report.SortIcon.Family,Arrow:d.Report.SortIcon.Arrow.slice(),Color:d.Report.SortIcon.Color.slice(),Margin:{Left:d.Report.SortIcon.Margin.Left,Bottom:d.Report.SortIcon.Margin.Bottom}},this.ItemFontConfig={Size:d.Report.Item.Font.Size,Name:d.Report.Item.Font.Name},this.ItemFixedFontConfg={Size:d.Report.FixedItem.Font.Size,Name:d.Report.FixedItem.Font.Name},this.ItemMergin={Left:d.Report.Item.Mergin.Left,Right:d.Report.Item.Mergin.Right,Top:d.Report.Item.Mergin.Top,Bottom:d.Report.Item.Mergin.Bottom},this.BarMergin={Top:d.Report.Item.BarMergin.Top,Left:d.Report.Item.BarMergin.Left,Right:d.Report.Item.BarMergin.Right,Bottom:d.Report.Item.BarMergin.Bottom},this.LimitDrawType=0,this.LimitBorderColor=d.Report.LimitBorder.Color,this.LimitUpBGColor=d.Report.LimitColor.UpColor,this.LimitDownBGColor=d.Report.LimitColor.DownColor,this.LimitTextColor=d.Report.LimitColor.TextColor,this.LimitMergin={Top:d.Report.LimitBorder.Mergin.Top,Left:d.Report.LimitBorder.Mergin.Left,Right:d.Report.LimitBorder.Mergin.Right,Bottom:d.Report.LimitBorder.Mergin.Bottom},this.DragRowColor=d.Report.DragRow.Color,this.DragRowTextColor=d.Report.DragRow.TextColor,this.DragMoveRowColor=d.Report.DragRow.MoveRowColor,this.DragSrcRowColor=d.Report.DragRow.SrcRowColor,this.CloseLineConfig={CloseColor:d.Report.CloseLine.CloseColor,YCloseColor:d.Report.CloseLine.YCloseColor,AreaColor:d.Report.CloseLine.AreaColor},this.KLineConfig={UpColor:d.Report.KLine.UpColor,DownColor:d.Report.KLine.DownColor,UnchagneColor:d.Report.KLine.UnchagneColor,DataWidth:d.Report.KLine.DataWidth,DistanceWidth:d.Report.KLine.DistanceWidth},this.CheckBoxConfig=At(d.Report.CheckBox),this.LinkConfig=At(d.Report.Link),this.ProgressBarConfig=At(d.Report.ProgressBar),this.ButtonConfig=At(d.Report.Button),this.ItemSymbolFontConfig={Size:d.Report.Item.SymbolFont.Size,Name:d.Report.Item.SymbolFont.Name},this.ItemNameFontConfg={Size:d.Report.Item.NameFont.Size,Name:d.Report.Item.NameFont.Name},this.NameSymbolV2Config=At(d.Report.NameSymbolV2),this.HeaderFont=12*B()+"px 微软雅黑",this.SortFont=null,this.ItemFont=15*B()+"px 微软雅黑",this.ItemFontHeight=0,this.ItemFixedFont=15*B()+"px 微软雅黑",this.ItemSymbolFont=12*B()+"px 微软雅黑",this.ItemNameFont=15*B()+"px 微软雅黑",this.ItemNameHeight=0,this.ItemSymbolHeight=0,this.NameSymbolFont={Symbol:null,Name:null},this.RowCount=0,this.HeaderHeight=0,this.FixedRowHeight=0,this.RowHeight=0,this.ItemTextLines=1,this.BottomToolbarHeight=0,this.IsShowAllColumn=!1,this.DevicePixelRatio=B(),this.Column=[{Type:X.INDEX_ID,Title:"序号",TextAlign:"center",Width:null,TextColor:d.Report.FieldColor.Index,MaxText:"8888"},{Type:X.SYMBOL_ID,Title:"代码",TextAlign:"left",Width:null,TextColor:d.Report.FieldColor.Symbol,MaxText:"888888"},{Type:X.NAME_ID,Title:"名称",TextAlign:"left",Width:null,TextColor:d.Report.FieldColor.Name,MaxText:"擎擎擎擎"},{Type:X.INCREASE_ID,Title:"涨幅%",TextAlign:"right",Width:null,MaxText:"-888.88"}],this.RectClient={},this.TooltipRect=[],this.ButtonRect=[],this.LastMouseStatus,this.ReloadResource=function(e){this.DevicePixelRatio=B(),this.UpColor=d.Report.UpTextColor,this.DownColor=d.Report.DownTextColor,this.UnchagneColor=d.Report.UnchagneTextColor,this.BorderColor=d.Report.BorderColor,this.SelectedColor=d.Report.SelectedColor,this.HeaderFontConfig={Size:d.Report.Header.Font.Size,Name:d.Report.Header.Font.Name},this.HeaderColor=d.Report.Header.Color,this.HeaderMergin={Left:d.Report.Header.Mergin.Left,Right:d.Report.Header.Mergin.Right,Top:d.Report.Header.Mergin.Top,Bottom:d.Report.Header.Mergin.Bottom},this.ItemFontConfig={Size:d.Report.Item.Font.Size,Name:d.Report.Item.Font.Name},this.ItemMergin={Left:d.Report.Item.Mergin.Left,Right:d.Report.Item.Mergin.Right,Top:d.Report.Item.Mergin.Top,Bottom:d.Report.Item.Mergin.Bottom},this.BarMergin={Top:d.Report.Item.BarMergin.Top,Left:d.Report.Item.BarMergin.Left,Right:d.Report.Item.BarMergin.Right,Bottom:d.Report.Item.BarMergin.Bottom},this.LimitBorderColor=d.Report.LimitBorder.Color,this.LimitMergin={Top:d.Report.LimitBorder.Mergin.Top,Left:d.Report.LimitBorder.Mergin.Left,Right:d.Report.LimitBorder.Mergin.Right,Bottom:d.Report.LimitBorder.Mergin.Bottom},this.SortConfig={Size:d.Report.SortIcon.Size,Family:d.Report.SortIcon.Family,Arrow:d.Report.SortIcon.Arrow.slice(),Color:d.Report.SortIcon.Color.slice(),Margin:{Left:d.Report.SortIcon.Margin.Left,Bottom:d.Report.SortIcon.Margin.Bottom}};for(var a=0;a<this.Column.length;++a){var r=this.Column[a];r.Type==X.INDEX_ID?r.TextColor=d.Report.FieldColor.Index:r.Type==X.SYMBOL_ID?r.TextColor=d.Report.FieldColor.Symbol:r.Type==X.NAME_ID?r.TextColor=d.Report.FieldColor.Name:r.Type==X.VOL_ID||r.Type==X.BUY_VOL_ID||r.Type==X.SELL_VOL_ID?r.TextColor=d.Report.FieldColor.Vol:r.Type==X.AMOUNT_ID?r.TextColor=d.Report.FieldColor.Amount:r.Type==X.VOL_IN_ID?r.TextColor=d.Report.DownTextColor:r.Type==X.VOL_OUT_ID?r.TextColor=d.Report.UpTextColor:r.TextColor=d.Report.FieldColor.Text}this.Tab&&this.Tab.ReloadResource(e),this.VScrollbar&&this.VScrollbar.ReloadResource(e),this.CheckBoxConfig=At(d.Report.CheckBox),this.LinkConfig=At(d.Report.Link),this.ProgressBarConfig=At(d.Report.ProgressBar)},this.SetColumn=function(e){if(v.IsNonEmptyArray(e)){this.Column=[];for(var a=0;a<e.length;++a){var r=e[a],t=this.GetDefaultColunm(r.Type);if(t){if(r.Title&&(t.Title=r.Title),r.TextAlign&&(t.TextAlign=r.TextAlign),r.TextColor&&(t.TextColor=r.TextColor),r.HeaderColor&&(t.HeaderColor=r.HeaderColor),r.MaxText&&(t.MaxText=r.MaxText),r.MaxText2&&(t.MaxText=r.MaxText2),v.IsNumber(r.Space)&&(t.Space=r.Space),r.ID&&(t.ID=r.ID),r.FullColBGColor&&(t.FullColBGColor=r.FullColBGColor),r.HeaderBGColor&&(t.HeaderBGColor=r.HeaderBGColor),v.IsNumber(r.Sort)&&(t.Sort=r.Sort),v.IsNumber(r.FixedWidth)&&(t.FixedWidth=r.FixedWidth),v.IsBool(r.EnableDragWidth)&&(t.EnableDragWidth=r.EnableDragWidth),v.IsBool(r.IsDrawCallback)?t.IsDrawCallback=r.IsDrawCallback:t.IsDrawCallback=!1,v.IsNumber(r.FloatPrecision)&&(t.FloatPrecision=r.FloatPrecision),v.IsNumber(r.ColorType)&&(t.ColorType=r.ColorType),r.Icon&&(t.Icon=r.Icon),v.IsBool(r.EnableChartTooltip)&&(t.EnableChartTooltip=r.EnableChartTooltip),v.IsBool(r.EnablePopupHeaderMenu)&&(t.EnablePopupHeaderMenu=r.EnablePopupHeaderMenu),(r.Sort==1||r.Sort==2)&&(t.SortType=[1,2],v.IsNonEmptyArray(r.SortType)&&(t.SortType=r.SortType.slice())),r.Type==X.CUSTOM_STRING_TEXT_ID){if(!v.IsNumber(r.DataIndex)&&!v.IsNumber(r.BlockIndex))continue;t.FormatType=0,v.IsNumber(r.DataIndex)&&(t.DataIndex=r.DataIndex),v.IsNumber(r.BlockIndex)&&(t.BlockIndex=r.BlockIndex),v.IsNumber(r.FormatType)&&(t.FormatType=r.FormatType)}else if(r.Type==X.CUSTOM_NUMBER_TEXT_ID){if(!v.IsNumber(r.DataIndex)&&!v.IsNumber(r.BlockIndex))continue;v.IsNumber(r.DataIndex)&&(t.DataIndex=r.DataIndex),v.IsNumber(r.BlockIndex)&&(t.BlockIndex=r.BlockIndex),t.Decimal=2,t.FormatType=0,t.ColorType=0,v.IsNumber(r.Decimal)&&(t.Decimal=r.Decimal),v.IsNumber(r.FormatType)&&(t.FormatType=r.FormatType),v.IsNumber(r.ColorType)&&(t.ColorType=r.ColorType)}else if(r.Type==X.CUSTOM_DATETIME_TEXT_ID){if(!v.IsNumber(r.DataIndex)&&!v.IsNumber(r.BlockIndex))continue;v.IsNumber(r.DataIndex)&&(t.DataIndex=r.DataIndex),v.IsNumber(r.BlockIndex)&&(t.BlockIndex=r.BlockIndex),t.FormatType=0,t.ValueType=0,v.IsNumber(r.FormatType)&&(t.FormatType=r.FormatType),v.IsNumber(r.ValueType)&&(t.FormatType=r.ValueType)}else if(r.Type==X.CUSTOM_CHECKBOX_ID){if(!v.IsNumber(r.DataIndex)&&!v.IsNumber(r.BlockIndex))continue;v.IsNumber(r.DataIndex)&&(t.DataIndex=r.DataIndex),v.IsNumber(r.BlockIndex)&&(t.BlockIndex=r.BlockIndex),r.CheckBox?t.CheckBox=At(r.CheckBox):t.CheckBox=this.CheckBoxConfig}else if(r.Type==X.CUSTOM_BUTTON_ID){if(!v.IsNumber(r.DataIndex)&&!v.IsNumber(r.BlockIndex))continue;v.IsNumber(r.DataIndex)&&(t.DataIndex=r.DataIndex),v.IsNumber(r.BlockIndex)&&(t.BlockIndex=r.BlockIndex),r.Button?t.Button=At(r.Button):t.Button=this.ButtonConfig}else if(this.IsReserveButtonColumn(r.Type))r.Button?t.Button=At(r.Button):t.Button=this.ButtonConfig;else if(r.Type==X.CUSTOM_PROGRESS_ID){if(!v.IsNumber(r.DataIndex)&&!v.IsNumber(r.BlockIndex))continue;v.IsNumber(r.DataIndex)&&(t.DataIndex=r.DataIndex),v.IsNumber(r.BlockIndex)&&(t.BlockIndex=r.BlockIndex),r.ProgressBar?t.ProgressBar=At(r.ProgressBar):t.ProgressBar=this.ProgressBarConfig}else if(this.IsReserveProgressBarColumn(r.Type))r.ProgressBar?t.ProgressBar=At(r.ProgressBar):t.ProgressBar=this.ProgressBarConfig;else if(r.Type==X.CUSTOM_LINK_ID){if(!v.IsNumber(r.DataIndex)&&!v.IsNumber(r.BlockIndex))continue;v.IsNumber(r.DataIndex)&&(t.DataIndex=r.DataIndex),v.IsNumber(r.BlockIndex)&&(t.BlockIndex=r.BlockIndex),r.Link?t.Link=At(r.Link):t.Link=this.LinkConfig}else r.Type==X.CUSTOM_ICON_ID||(r.Type==X.CLOSE_LINE_ID?v.IsBool(r.IsDrawArea)&&(t.IsDrawArea=r.IsDrawArea):r.Type==X.TIME_ID?v.IsNumber(r.ValueType)&&(t.ValueType=r.ValueType):r.Type==X.DATE_ID&&v.IsNumber(r.FormatType)&&(t.FormatType=r.FormatType));this.Column.push(t)}}}},this.SwapColumn=function(e,a){if(!v.IsNumber(e)||!v.IsNumber(a))return!1;var r=this.Column.length;if(e<0||e>=r||a<0||a>=r)return!1;if(e!=a){var t=this.Column[e];return this.Column[e]=this.Column[a],this.Column[a]=t,!0}},this.DeleteColumn=function(e){return!v.IsNonEmptyArray(this.Column)||e<0||e>=this.Column.length?!1:(this.Column.splice(e,1),!0)},this.GetXScrollPos=function(){return this.Data.XOffset},this.GetXScrollRange=function(){var e=this.Column.length-this.FixedColumn-3;return e<0?0:e},this.GetYScrollRange=function(){if(!v.IsNonEmptyArray(this.Data.Data))return 0;var e=this.GetAllRowCount(),a=e-this.RowCount;return a},this.GetDefaultColunm=function(e){for(var a=[{Type:X.INDEX_ID,Title:"序号",TextAlign:"center",Width:null,TextColor:d.Report.FieldColor.Index,MaxText:"8888"},{Type:X.SYMBOL_ID,Title:"代码",TextAlign:"left",Width:null,TextColor:d.Report.FieldColor.Symbol,MaxText:"888888"},{Type:X.NAME_ID,Title:"名称",TextAlign:"left",Width:null,TextColor:d.Report.FieldColor.Name,MaxText:"擎擎擎擎0"},{Type:X.NAME_EX_ID,Title:"名称",TextAlign:"left",Width:null,TextColor:d.Report.FieldColor.Name,MaxText:"擎擎擎擎擎擎"},{Type:X.SYMBOL_NAME_ID,Title:"股票名称",TextAlign:"left",Width:null,TextColor:d.Report.FieldColor.Name,MaxText:"擎擎擎擎0"},{Type:X.SYMBOL_NAME_V2_ID,Title:"名称/代码",TextAlign:"left",Width:null,TextColor:d.Report.NameSymbolV2.Name.Color,MaxText:"擎擎擎擎*",MaxText2:"999999",Space:5,TextColor2:d.Report.NameSymbolV2.Symbol.Color},{Type:X.INCREASE_ID,Title:"涨幅%",TextAlign:"right",Width:null,MaxText:"-888.88"},{Type:X.PRICE_ID,Title:"现价",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:X.UPDOWN_ID,Title:"涨跌",TextAlign:"right",Width:null,MaxText:"-888.88"},{Type:X.AMPLITUDE_ID,Title:"振幅%",TextAlign:"right",Width:null,MaxText:"888.88"},{Type:X.BUY_PRICE_ID,Title:"买价",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:X.SELL_PRICE_ID,Title:"卖价",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:X.AVERAGE_PRICE_ID,Title:"均价",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:X.OPEN_ID,Title:"今开",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:X.HIGH_ID,Title:"最高",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:X.LOW_ID,Title:"最低",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:X.YCLOSE_ID,Title:"昨收",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:X.VOL_ID,Title:"总量",TextAlign:"right",TextColor:d.Report.FieldColor.Vol,Width:null,MaxText:"8888.8擎"},{Type:X.AMOUNT_ID,Title:"总金额",TextAlign:"right",TextColor:d.Report.FieldColor.Amount,Width:null,MaxText:"8888.8擎"},{Type:X.EXCHANGE_RATE_ID,Title:"换手%",TextAlign:"right",TextColor:d.Report.FieldColor.Text,Width:null,MaxText:"88.88擎"},{Type:X.OUTSTANDING_SHARES_ID,Title:"流通股本",TextAlign:"right",TextColor:d.Report.FieldColor.Text,Width:null,MaxText:"8888.8擎"},{Type:X.TOTAL_SHARES_ID,Title:"总股本",TextAlign:"right",TextColor:d.Report.FieldColor.Text,Width:null,MaxText:"8888.8擎"},{Type:X.CIRC_MARKET_VALUE_ID,Title:"流通市值",TextAlign:"right",TextColor:d.Report.FieldColor.Text,Width:null,MaxText:"8888.8擎"},{Type:X.MARKET_VALUE_ID,Title:"总市值",TextAlign:"right",TextColor:d.Report.FieldColor.Text,Width:null,MaxText:"8888.8擎"},{Type:X.VOL_IN_ID,Title:"内盘",TextAlign:"right",TextColor:d.Report.DownTextColor,Width:null,MaxText:"8888.8擎"},{Type:X.VOL_OUT_ID,Title:"外盘",TextAlign:"right",TextColor:d.Report.UpTextColor,Width:null,MaxText:"8888.8擎"},{Type:X.CLOSE_LINE_ID,Title:"走势",TextAlign:"center",TextColor:d.Report.CloseLineColor,Width:null,MaxText:"88888.88888"},{Type:X.BUY_VOL_ID,Title:"买量",TextAlign:"right",TextColor:d.Report.FieldColor.Vol,Width:null,MaxText:"8888.8擎"},{Type:X.SELL_VOL_ID,Title:"卖量",TextAlign:"right",TextColor:d.Report.FieldColor.Vol,Width:null,MaxText:"8888.8擎"},{Type:X.CUSTOM_STRING_TEXT_ID,Title:"自定义",TextAlign:"center",Width:null,TextColor:d.Report.FieldColor.Text,MaxText:"擎擎擎擎擎"},{Type:X.CUSTOM_NUMBER_TEXT_ID,Title:"自定义",TextAlign:"center",Width:null,TextColor:d.Report.FieldColor.Text,MaxText:"擎擎擎擎擎"},{Type:X.CUSTOM_DATETIME_TEXT_ID,Title:"自定义",TextAlign:"center",Width:null,TextColor:d.Report.FieldColor.Text,MaxText:"9999-99-99"},{Type:X.CUSTOM_ICON_ID,Title:"  ",TextAlign:"left",FixedWidth:20,TextColor:d.Report.FieldColor.Text},{Type:X.KLINE_ID,Title:"K线",TextAlign:"left",FixedWidth:50,TextColor:d.Report.FieldColor.Text},{Type:X.TIME_ID,Title:"时间",TextAlign:"left",ValueType:0,TextColor:d.Report.FieldColor.Text,MaxText:"99:99:99.999"},{Type:X.DATE_ID,Title:"日期",TextAlign:"left",FormatType:0,TextColor:d.Report.FieldColor.Text,MaxText:"9999-99-99"},{Type:X.CHECKBOX_ID,Title:"",TextAlign:"center",FixedWidth:20*B()},{Type:X.CUSTOM_CHECKBOX_ID,Title:"",TextAlign:"center",FixedWidth:20*B()},{Type:X.CUSTOM_BUTTON_ID,Title:"",TextAlign:"center",FixedWidth:50*B()},{Type:X.CUSTOM_PROGRESS_ID,Title:"进度条",TextAlign:"center",FixedWidth:100*B()},{Type:X.CUSTOM_LINK_ID,Title:"链接地址",TextAlign:"center",MaxText:"擎擎擎擎擎"},{Type:X.FUTURES_POSITION_ID,Title:"持仓量",TextAlign:"right",TextColor:d.Report.FieldColor.Vol,Width:null,MaxText:"8888888"},{Type:X.FUTURES_CLOSE_ID,Title:"结算价",TextAlign:"right",Width:null,MaxText:"8888888"},{Type:X.FUTURES_YCLOSE_ID,Title:"昨结算价",TextAlign:"right",Width:null,MaxText:"8888888"},{Type:X.FUTURES_OPEN_POSITION_ID,Title:"开仓量",TextAlign:"right",TextColor:d.Report.FieldColor.Text,Width:null,MaxText:"8888888"},{Type:X.FUTURES_CLOSE_POSITION_ID,Title:"平仓量",TextAlign:"right",TextColor:d.Report.FieldColor.Text,Width:null,MaxText:"8888888"},{Type:X.RISING_SPEED_1M_ID,Title:"涨速%",TextAlign:"right",Width:null,MaxText:"-888.88"},{Type:X.RISING_SPEED_3M_ID,Title:"3分涨速%",TextAlign:"right",Width:null,MaxText:"-888.88"},{Type:X.RISING_SPEED_5M_ID,Title:"5分涨速%",TextAlign:"right",Width:null,MaxText:"-888.88"},{Type:X.RISING_SPEED_10M_ID,Title:"10分涨速%",TextAlign:"right",Width:null,MaxText:"-888.88"},{Type:X.RISING_SPEED_15M_ID,Title:"15分涨速%",TextAlign:"right",Width:null,MaxText:"-888.88"},{Type:X.RESERVE_NUMBER1_ID,Title:"数值1",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:X.RESERVE_NUMBER2_ID,Title:"数值2",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:X.RESERVE_NUMBER3_ID,Title:"数值3",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:X.RESERVE_NUMBER4_ID,Title:"数值4",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:X.RESERVE_NUMBER5_ID,Title:"数值5",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:X.RESERVE_NUMBER6_ID,Title:"数值6",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:X.RESERVE_NUMBER7_ID,Title:"数值7",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:X.RESERVE_NUMBER8_ID,Title:"数值8",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:X.RESERVE_NUMBER9_ID,Title:"数值9",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:X.RESERVE_NUMBER10_ID,Title:"数值10",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:X.RESERVE_STRING1_ID,Title:"文字1",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:X.RESERVE_STRING2_ID,Title:"文字2",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:X.RESERVE_STRING3_ID,Title:"文字3",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:X.RESERVE_STRING4_ID,Title:"文字4",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:X.RESERVE_STRING5_ID,Title:"文字5",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:X.RESERVE_STRING6_ID,Title:"文字6",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:X.RESERVE_STRING7_ID,Title:"文字7",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:X.RESERVE_STRING8_ID,Title:"文字8",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:X.RESERVE_STRING9_ID,Title:"文字9",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:X.RESERVE_STRING10_ID,Title:"文字10",TextAlign:"right",TextColor:d.Report.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:X.RESERVE_PROGRESS_BAR1_ID,Title:"进度条1",TextAlign:"center",FixedWidth:100*B()},{Type:X.RESERVE_PROGRESS_BAR2_ID,Title:"进度条2",TextAlign:"center",FixedWidth:100*B()},{Type:X.RESERVE_PROGRESS_BAR3_ID,Title:"进度条3",TextAlign:"center",FixedWidth:100*B()},{Type:X.RESERVE_PROGRESS_BAR4_ID,Title:"进度条4",TextAlign:"center",FixedWidth:100*B()},{Type:X.RESERVE_PROGRESS_BAR5_ID,Title:"进度条5",TextAlign:"center",FixedWidth:100*B()},{Type:X.RESERVE_PROGRESS_BAR6_ID,Title:"进度条6",TextAlign:"center",FixedWidth:100*B()},{Type:X.RESERVE_PROGRESS_BAR7_ID,Title:"进度条7",TextAlign:"center",FixedWidth:100*B()},{Type:X.RESERVE_PROGRESS_BAR8_ID,Title:"进度条8",TextAlign:"center",FixedWidth:100*B()},{Type:X.RESERVE_PROGRESS_BAR9_ID,Title:"进度条9",TextAlign:"center",FixedWidth:100*B()},{Type:X.RESERVE_PROGRESS_BAR10_ID,Title:"进度条10",TextAlign:"center",FixedWidth:100*B()},{Type:X.RESERVE_BUTTON1_ID,Title:"按钮1",TextAlign:"center",FixedWidth:50*B()},{Type:X.RESERVE_BUTTON2_ID,Title:"按钮2",TextAlign:"center",FixedWidth:50*B()},{Type:X.RESERVE_BUTTON3_ID,Title:"按钮3",TextAlign:"center",FixedWidth:50*B()},{Type:X.RESERVE_BUTTON4_ID,Title:"按钮4",TextAlign:"center",FixedWidth:50*B()},{Type:X.RESERVE_BUTTON5_ID,Title:"按钮5",TextAlign:"center",FixedWidth:50*B()},{Type:X.RESERVE_BUTTON6_ID,Title:"按钮6",TextAlign:"center",FixedWidth:50*B()},{Type:X.RESERVE_BUTTON7_ID,Title:"按钮7",TextAlign:"center",FixedWidth:50*B()},{Type:X.RESERVE_BUTTON8_ID,Title:"按钮8",TextAlign:"center",FixedWidth:50*B()},{Type:X.RESERVE_BUTTON9_ID,Title:"按钮9",TextAlign:"center",FixedWidth:50*B()},{Type:X.RESERVE_BUTTON10_ID,Title:"按钮10",TextAlign:"center",FixedWidth:50*B()}],r=0;r<a.length;++r){var t=a[r];if(t.Type==e)return t}return null},this.ClipClient=function(){this.Canvas.save(),this.Canvas.beginPath(),this.Canvas.rect(this.RectClient.Left,this.RectClient.Top,this.RectClient.Right-this.RectClient.Left,this.RectClient.Bottom-this.RectClient.Top),this.Canvas.clip()},this.Draw=function(e){if(this.ShowSymbol=[],this.TooltipRect=[],this.ButtonRect=[],this.DevicePixelRatio=B(),this.LastMouseStatus=e,this.GlobalOption&&(this.GlobalOption.FlashBGCount=0),this.SizeChange?this.CalculateSize():this.UpdateCacheData(),this.ClipClient(),this.DrawHeader(),this.DrawBody(),this.Canvas.restore(),this.Tab&&this.BottomToolbarHeight>0){var a=this.ChartBorder.GetBottom();this.Tab.DrawTab(this.RectClient.Left,a-this.BottomToolbarHeight,this.RectClient.Right,a),this.Tab.DrawScrollbar(this.RectClient.Left,a-this.BottomToolbarHeight,this.RectClient.Right,a)}if(this.ClipClient(),this.DrawBorder(),this.Canvas.restore(),this.DrawDragRow(),this.VScrollbar){var a=this.ChartBorder.GetBottom();this.VScrollbar.DrawScrollbar(this.RectClient.Left,this.RectClient.Top+this.HeaderHeight,this.RectClient.Right,a-this.BottomToolbarHeight-4)}this.LastMouseStatus=null,this.SizeChange=!1},this.UpdateCacheData=function(){this.RectClient.Left=this.ChartBorder.GetLeft(),this.RectClient.Right=this.ChartBorder.GetRight(),this.RectClient.Top=this.ChartBorder.GetTop(),this.RectClient.Bottom=this.ChartBorder.GetBottom()-this.BottomToolbarHeight},this.GetPageSize=function(e){e&&this.CalculateSize();var a=this.RowCount;return a},this.GetCurrentPageStatus=function(){var e={Start:this.Data.YOffset,PageSize:this.RowCount,IsEnd:!1,SelectedRow:this.SelectedRow,IsSinglePage:!1,DataCount:0,MultiSelectModel:this.MultiSelectModel};return this.MultiSelectModel==1&&(e.SelectedRow=-1,e.MultiSelectedRow=this.MultiSelectedRow.slice(),e.MultiSelectedRow.sort(function(a,r){return a>r})),v.IsNonEmptyArray(this.Data.Data)?(e.End=this.Data.YOffset+this.RowCount-1,e.IsSinglePage=this.Data.Data.length<=this.RowCount,e.DataCount=this.Data.Data.length,e.End>=this.Data.Data.length-1&&(e.IsEnd=!0),e.End>=this.Data.Data.length&&(e.End=this.Data.Data.length-1)):(e.Start=0,e.End=0,e.IsEnd=!0,e.IsSinglePage=!0),e},this.CalculateSize=function(){this.Tab&&this.Tab.IsShow?(this.Tab.CalculateSize(),this.BottomToolbarHeight=this.Tab.Height):this.BottomToolbarHeight=0,this.VScrollbar&&this.VScrollbar.Enable&&this.VScrollbar.CalculateSize(),this.UpdateCacheData();var e=B();this.HeaderFont=this.HeaderFontConfig.Size*e+"px "+this.HeaderFontConfig.Name,this.ItemFont=this.ItemFontConfig.Size*e+"px "+this.ItemFontConfig.Name,this.ItemFixedFont=this.ItemFixedFontConfg.Size*e+"px "+this.ItemFixedFontConfg.Name,this.ItemSymbolFont=this.ItemSymbolFontConfig.Size*e+"px "+this.ItemSymbolFontConfig.Name,this.ItemNameFont=this.ItemNameFontConfg.Size*e+"px "+this.ItemNameFontConfg.Name,this.NameSymbolFont.Symbol=this.NameSymbolV2Config.Symbol.Size*e+"px "+this.NameSymbolV2Config.Symbol.Name,this.NameSymbolFont.Name=this.ItemSymbolFontConfig.Name.Size*e+"px "+this.NameSymbolV2Config.Name.Name,this.ItemFontHeight=this.GetFontHeight(this.ItemFont,"擎"),this.RowHeight=this.ItemFontHeight+this.ItemMergin.Top+this.ItemMergin.Bottom,this.ItemTextLines=1,this.FixedRowHeight=this.GetFontHeight(this.ItemFixedFont,"擎")+this.ItemMergin.Top+this.ItemMergin.Bottom,this.SortFont=this.SortConfig.Size*e+"px "+this.SortConfig.Family,this.Canvas.font=this.ItemFont;for(var a=0,r=0;r<this.Column.length;++r){var t=this.Column[r];if(t.Type==X.SYMBOL_NAME_ID){this.Canvas.font=this.ItemNameFont;var n=this.Canvas.measureText(t.MaxText).width,s=this.GetFontHeight(this.ItemNameFont,"擎");this.ItemNameHeight=s,this.Canvas.font=this.ItemSymbolFont;var o=this.Canvas.measureText(t.MaxText).width,l=this.GetFontHeight(this.ItemSymbolFont,"擎");this.ItemSymbolHeight=l,this.Canvas.font=this.ItemFont,a=Math.max(n,o),t.Width=a+4+this.ItemMergin.Left+this.ItemMergin.Right;var h=s+l+this.ItemMergin.Top+this.ItemMergin.Bottom;this.ItemTextLines=2,h>this.RowHeight&&(this.RowHeight=h),h>this.FixedRowHeight&&(this.FixedRowHeight=h)}else if(t.Type==X.SYMBOL_NAME_V2_ID){this.Canvas.font==this.NameSymbolFont.Name;var n=this.Canvas.measureText(t.MaxText).width,s=this.GetFontHeight(this.ItemNameFont,"擎");this.Canvas.font==this.NameSymbolFont.Symbol;var o=this.Canvas.measureText(t.MaxText2).width,l=this.GetFontHeight(this.ItemSymbolFont,"擎");this.ItemNameHeight=Math.abs(s,l);var u=2;v.IsNumber(t.Space)&&(u=t.Space),a=n+o+u,t.Width=a+4+this.ItemMergin.Left+this.ItemMergin.Right}else v.IsNumber(t.FixedWidth)?a=t.FixedWidth:a=this.Canvas.measureText(t.MaxText).width,t.Width=a+4+this.ItemMergin.Left+this.ItemMergin.Right;if(t.Icon&&t.Icon.Symbol&&(t.Width+=t.Icon.Size,t.Icon.Margin)){var f=t.Icon.Margin;v.IsNumber(f.Left)&&(t.Width+=f.Left),v.IsNumber(f.Right)&&(t.Width+=f.Right)}}this.Canvas.font=this.HeaderFont;for(var r=0;r<this.Column.length;++r){var t=this.Column[r];if(!(!t.Title||t.Title.length<=0)){var C=t.Title;a=this.Canvas.measureText(C).width,t.Sort>0&&a+this.SortConfig.Size*e,a+=4+this.HeaderMergin.Left+this.HeaderMergin.Right,t.Width<a&&(t.Width=a)}}this.HeaderHeight=this.GetFontHeight(this.HeaderFont,"擎")+this.HeaderMergin.Top+this.HeaderMergin.Bottom,this.IsShowHeader||(this.HeaderHeight=0),this.FixedRowCount<=0&&(this.FixedRowHeight=0),this.RowCount=parseInt((this.RectClient.Bottom-this.RectClient.Top-this.HeaderHeight-this.FixedRowHeight*this.FixedRowCount)/this.RowHeight);for(var D=0,c=this.RectClient.Right-this.RectClient.Left,r=0;r<this.Column.length;++r){var t=this.Column[r];D+=t.Width}this.IsShowAllColumn=D<c},this.DrawHeader=function(){if(this.IsShowHeader){var e=this.RectClient.Left,a=this.RectClient.Top;a+this.HeaderMergin.Top+(this.HeaderHeight-this.HeaderMergin.Top-this.HeaderMergin.Bottom)/2;var r=a+this.HeaderHeight,t=this.IsDrawSortBGIcon();this.Canvas.font=this.HeaderFont;for(var n=e,s=0;s<this.FixedColumn&&s<this.Column.length;++s){var o=this.Column[s],l=o.Width,h=l-this.HeaderMergin.Left-this.HeaderMergin.Right,u=n+this.HeaderMergin.Left;if(o.HeaderBGColor){var f={Left:n,Top:a,Width:l,Height:this.HeaderHeight};f.Right=f.Left+f.Width,f.Bottom=f.Top+f.Height,this.DrawItemBG({Rect:f,BGColor:o.HeaderBGColor})}var C=0;if(o.Icon&&o.Icon.Symbol){var C=o.Icon.Size;if(o.Icon.Margin){var D=o.Icon.Margin;v.IsNumber(D.Left)&&(C+=D.Left),v.IsNumber(D.Right)&&(C+=D.Right)}}h-=C,o.HeaderColor?this.Canvas.fillStyle=o.HeaderColor:this.Canvas.fillStyle=this.HeaderColor;var c={};this.SortInfo&&this.SortInfo.Field==s&&this.SortInfo.Sort>0?this.DrawSortHeader(o.Title,o.TextAlign,u,r,h,this.SortInfo.Sort,c):o.Sort>0&&t?this.DrawSortHeader(o.Title,o.TextAlign,u,r,h,0,c):this.DrawText(o.Title,o.TextAlign,u,r,h,c),C>0&&(this.DrawHeaderIcon(o.Icon,c.Right,r,s,o),this.Canvas.font=this.HeaderFont),this.Canvas.fillStyle=this.HeaderColor,n+=o.Width}for(var s=this.FixedColumn+this.Data.XOffset;s<this.Column.length;++s){var o=this.Column[s],l=o.Width,h=l-this.HeaderMergin.Left-this.HeaderMergin.Right,u=n+this.HeaderMergin.Left;if(o.HeaderBGColor){var f={Left:n,Top:a,Width:l,Height:this.HeaderHeight};f.Right=f.Left+f.Width,f.Bottom=f.Top+f.Height,this.DrawItemBG({Rect:f,BGColor:o.HeaderBGColor})}var C=0;if(o.Icon&&o.Icon.Symbol){var C=o.Icon.Size;if(o.Icon.Margin){var D=o.Icon.Margin;v.IsNumber(D.Left)&&(C+=D.Left),v.IsNumber(D.Right)&&(C+=D.Right)}}h-=C,o.HeaderColor?this.Canvas.fillStyle=o.HeaderColor:this.Canvas.fillStyle=this.HeaderColor;var c={};this.SortInfo&&this.SortInfo.Field==s&&this.SortInfo.Sort>0?this.DrawSortHeader(o.Title,o.TextAlign,u,r,h,this.SortInfo.Sort,c):o.Sort>0?this.DrawSortHeader(o.Title,o.TextAlign,u,r,h,0,c):this.DrawText(o.Title,o.TextAlign,u,r,h,c),C>0&&(this.DrawHeaderIcon(o.Icon,c.Right,r,s,o),this.Canvas.font=this.HeaderFont),n+=o.Width}}},this.DrawText=function(e,a,r,t,n,s){var o=this.Canvas.measureText(e).width;a=="center"?r=r+(n-o)/2:a=="right"&&(r=r+n-o),this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.fillText(e,r,t-this.HeaderMergin.Bottom),s&&(s.Right=r+o,s.Width=o)},this.DrawHeaderIcon=function(e,a,r,t,n){var s=e.Size+"px "+e.Family;this.Canvas.font=s,this.Canvas.textAlign="left",e.Color&&(this.Canvas.fillStyle=e.Color);var o=a,l=r;if(e.Margin&&v.IsNumber(e.Margin.Left)&&(o+=e.Margin.Left),e.Margin&&v.IsNumber(e.Margin.Bottom)&&(l-=e.Margin.Bottom),this.Canvas.fillText(e.Symbol,o,l),e.Tooltip){var h={Left:o,Bottom:l,Width:e.Size,Height:e.Size};h.Right=h.Left+h.Width,h.Top=h.Bottom-h.Height;var u={Rect:h,Type:2,Column:n,Index:t,Data:e.Tooltip.Data};this.TooltipRect.push(u)}},this.IsDrawSortBGIcon=function(){return!(!v.IsNonEmptyArray(this.SortConfig.Arrow)||!this.SortConfig.Arrow[0]||!v.IsNonEmptyArray(this.SortConfig.Color)||!this.SortConfig.Color[0])},this.DrawSortHeader=function(e,a,r,t,n,s,o){var l=B(),h=this.SortConfig.Arrow[s],u=this.SortConfig.Arrow[0],f=this.SortConfig.Color[0];this.Canvas.font=this.HeaderFont;var C=this.Canvas.measureText(e).width,D=this.SortConfig.Size*l+this.SortConfig.Margin.Left;a=="center"?r=r+n/2-(D+C)/2:a=="right"&&(r=r+n-D-C),this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left";var c=r;this.Canvas.font=this.HeaderFont,this.Canvas.fillStyle=this.HeaderColor,this.Canvas.fillText(e,c,t-this.HeaderMergin.Bottom),c+=C+this.SortConfig.Margin.Left,this.Canvas.font=this.SortFont,u&&f&&(this.Canvas.fillStyle=f,this.Canvas.fillText(u,c,t-this.SortConfig.Margin.Bottom)),s>0&&(this.Canvas.fillStyle=this.SortConfig.Color[s],this.Canvas.fillText(h,c,t-this.SortConfig.Margin.Bottom)),this.Canvas.font=this.HeaderFont,this.Canvas.fillStyle=this.HeaderColor,o&&(o.Right=r+C+D,o.Width=C+D)},this.DrawBorder=function(){if(this.IsDrawBorder){var e=this.RectClient.Left,a=this.RectClient.Right,r=this.RectClient.Top;this.RectClient.Bottom,this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),this.Canvas.moveTo(e,L(r+this.HeaderHeight)),this.Canvas.lineTo(a,L(r+this.HeaderHeight));for(var s=r+this.HeaderHeight+this.RowHeight,o=s,t=0;t<this.FixedRowCount;++t){var n=L(s);this.Canvas.moveTo(e,n),this.Canvas.lineTo(a,n),o=s,s+=this.FixedRowHeight}for(var s=r+this.HeaderHeight+this.RowHeight+this.FixedRowHeight*this.FixedRowCount,o=s,t=0;t<this.RowCount;++t){var n=L(s);this.Canvas.moveTo(e,n),this.Canvas.lineTo(a,n),o=s,s+=this.RowHeight}for(var l=e,t=0;t<this.FixedColumn&&t<this.Column.length;++t){var h=this.Column[t],u=L(l+h.Width);this.Canvas.moveTo(u,r),this.Canvas.lineTo(u,o),l+=h.Width}for(var t=this.FixedColumn+this.Data.XOffset;t<this.Column.length;++t){var h=this.Column[t],u=L(l+h.Width);this.Canvas.moveTo(u,r),this.Canvas.lineTo(u,o),l+=h.Width}this.Canvas.stroke()}},this.GetAllRowCount=function(){var e=this.Data.Data.length;return this.Data.Virtual&&this.Data.Virtual.Enable&&(e=this.Data.Virtual.Count),e},this.DrawBody=function(){if(this.Data&&!(!v.IsNonEmptyArray(this.Data.Data)&&!this.Data.Virtual.Enable)){this.Canvas.font=this.ItemFont;var e=this.RectClient.Top+this.HeaderHeight,a=this.RectClient.Left,r=this.RectClient.Right-this.RectClient.Left,t=e;this.Canvas.font=this.ItemFixedFont;for(var n=0;n<this.FixedRowCount;++n)this.SelectedFixedRow==n&&(this.Canvas.fillStyle=this.SelectedColor,this.Canvas.fillRect(a,t,r,this.FixedRowHeight)),this.FixedRowData.Type==1?this.DrawFixedSymbolRow(t,n):this.DrawFixedRow(t,n),t+=this.FixedRowHeight;t=e+this.FixedRowHeight*this.FixedRowCount,this.Canvas.font=this.ItemFont;var s=this.GetEventCallback($.ON_DRAW_REPORT_ROW_BG),o=this.GetSelectedSymbol(),l;this.MultiSelectModel==1&&(l=new Fe.default(this.MultiSelectedRow));for(var h=this.GetAllRowCount(),n=this.Data.YOffset,u=0;n<h&&u<this.RowCount;++n,++u){var f=this.Data.Data[n],C=!1;if(this.MultiSelectModel==1?l.has(n)&&(C=!0):this.SelectedModel==0?u==this.SelectedRow&&(C=!0):n==this.SelectedRow&&(C=!0),this.DragRow){if(this.DragRow.Data){var D=this.DragRow.Data.Row.DataIndex;D==n&&(this.Canvas.fillStyle=this.DragSrcRowColor,this.Canvas.fillRect(a,t,r,this.RowHeight))}if(this.DragRow.MoveRow){var D=this.DragRow.MoveRow.Data.DataIndex;D==n&&(this.Canvas.fillStyle=this.DragMoveRowColor,this.Canvas.fillRect(a,t,r,this.RowHeight))}C=!1}if(s&&s.Callback){var c={RowIndex:n,Symbol:f,Out:null,Selected:o,MultiSelectModel:this.MultiSelectModel};s.Callback(s,c,this),c.Out&&c.Out.BGColor&&(this.Canvas.fillStyle=c.Out.BGColor,this.Canvas.fillRect(a,t,r,this.RowHeight))}C&&(this.Canvas.fillStyle=this.SelectedColor,this.Canvas.fillRect(a,t,r,this.RowHeight)),this.DrawRow(f,t,n),this.ShowSymbol.push({Index:n,Symbol:f}),t+=this.RowHeight}}},this.GetSelectedSymbol=function(){if(this.MultiSelectModel==1){if(!v.IsNonEmptyArray(this.MultiSelectedRow))return null;for(var e=[],a=0;a<this.MultiSelectedRow.length;++a){var r=this.Data.Data[this.MultiSelectedRow[a]];r&&e.push(r)}return e}else{if(this.SelectedRow<0)return null;var t=this.SelectedRow;this.SelectedModel==0&&(t=this.Data.YOffset+this.SelectedRow);var n=this.Data.Data[t];return[n]}},this.DrawFixedSymbolRow=function(e,a){if(this.RectClient.Left,this.RectClient.Right,!(!this.FixedRowData||!v.IsNonEmptyArray(this.FixedRowData.Symbol))){var r=this.FixedRowData.Symbol[a];r&&(this.DrawRow(r,e,a,1),this.ShowSymbol.push({Index:a,Symbol:r,RowType:1}))}},this.DrawFixedRow=function(e,a){for(var r=this.RectClient.Left,t=this.RectClient.Right,n=0;n<this.FixedColumn&&n<this.Column.length;++n){var s=this.Column[n];if(this.DrawFixedItem(a,n,s,r,e),r+=s.Width,r>=t)break}for(var n=this.FixedColumn+this.Data.XOffset;n<this.Column.length;++n){var s=this.Column[n];if(this.DrawFixedItem(a,n,s,r,e),r+=s.Width,r>=t)break}},this.DrawFixedItem=function(e,a,r,t,n){var s=t+this.ItemMergin.Left,o=r.Width-this.ItemMergin.Left-this.ItemMergin.Right,l={Text:null,TextColor:r.TextColor,TextAlign:r.TextAlign};if(this.GetFixedRowTextDrawInfo(e,a,r,l)){this.DrawItemText(l.Text,l.TextColor,l.TextAlign,s,n,o);return}if(!(!this.FixedRowData||!v.IsNonEmptyArray(this.FixedRowData.Data))){var h=this.FixedRowData.Data,u=h[e];if(v.IsNonEmptyArray(u)){var f=u[a];!f||!f.Text||(l.Text=f.Text,f.Color&&(l.TextColor=f.Color),f.TextAlign&&(l.TextAlign=f.TextAlign),this.DrawItemText(l.Text,l.TextColor,l.TextAlign,s,n,o))}}},this.DrawRow=function(e,a,r,t){var n=this.RectClient.Left,s=this.RectClient.Right,o={Symbol:e,Stock:null,Block:null};this.GetStockDataCallback&&(o.Stock=this.GetStockDataCallback(e)),this.GetBlockDataCallback&&(o.Block=this.GetBlockDataCallback(e)),this.GetFlashBGDataCallback&&(o.FlashBG=this.GetFlashBGDataCallback(e,Date.now())),o.Decimal=jt(e);for(var l=0;l<this.FixedColumn&&l<this.Column.length;++l){var h=this.Column[l];if(this.DrawItem(r,o,h,n,a,t,l),n+=h.Width,n>=s)break}for(var l=this.FixedColumn+this.Data.XOffset;l<this.Column.length;++l){var h=this.Column[l];if(this.DrawItem(r,o,h,n,a,t,l),n+=h.Width,n>=s)break}},this.DrawItem=function(e,a,r,t,n,s,o){var l=r.Width,h=t+this.ItemMergin.Left,u=r.Width-this.ItemMergin.Left-this.ItemMergin.Right,f=a.Stock,C={Text:null,TextColor:r.TextColor,TextAlign:r.TextAlign,Tooltip:null,Index:e,ColumnIndex:o},D={Left:t,Top:n,Width:r.Width,Height:this.RowHeight};if(D.Right=D.Left+D.Width,D.Bottom=D.Top+D.Height,C.Rect=D,r.FullColBGColor&&this.DrawItemBG({Rect:D,BGColor:r.FullColBGColor}),r.Type==X.INDEX_ID){if(s==1)return;C.Text=(e+1).toString()}else if(r.Type==X.SYMBOL_ID)f&&f.Symbol?C.Text=f.Symbol:C.Text=a.Symbol,this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.SYMBOL_NAME_ID)this.DrawSymbolName(a,r,t,n,s),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.SYMBOL_NAME_V2_ID)this.DrawSymbolNameV2(a,r,t,n,s),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.NAME_ID)f&&f.Name&&v.IsString(f.Name)&&(C.Text=this.TextEllipsis(f.Name,u,r.MaxText),C.TextColor=this.GetNameColor(r,a.Symbol,s)),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.NAME_EX_ID){if(f&&f.NameEx){var c=f.NameEx;C.Text=this.TextEllipsis(c.Text,u,r.MaxText),C.TextColor=this.GetNameColor(r,a.Symbol,s),c.Symbol&&(C.Symbol=c.Symbol)}}else if(r.Type==X.PRICE_ID)f&&this.GetPriceDrawInfo(f.Price,f,a,C,{LimitBG:!0}),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.OPEN_ID)f&&(this.DrawLimitPriceBorder(f.Open,f,t,n,r.Width),this.GetPriceDrawInfo(f.Open,f,a,C,{LimitBG:!0})),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.HIGH_ID)f&&(this.DrawLimitPriceBorder(f.High,f,t,n,r.Width),this.GetPriceDrawInfo(f.High,f,a,C,{LimitBG:!0})),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.LOW_ID)f&&(this.DrawLimitPriceBorder(f.Low,f,t,n,r.Width),this.GetPriceDrawInfo(f.Low,f,a,C,{LimitBG:!0})),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.YCLOSE_ID)f&&this.GetPriceDrawInfo(f.YClose,f,a,C),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.BUY_PRICE_ID)f&&this.GetPriceDrawInfo(f.BuyPrice,f,a,C),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.FUTURES_CLOSE_ID||r.Type==X.FUTURES_YCLOSE_ID){var T=li.get(r.Type);if(f&&v.IsNumber(f[T])){var S=f[T];this.GetPriceDrawInfo(S,f,a,C)}this.FormatDrawInfo(r,f,C,a)}else if(r.Type==X.SELL_PRICE_ID)f&&this.GetPriceDrawInfo(f.SellPrice,f,a,C),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.AVERAGE_PRICE_ID)f&&this.GetPriceDrawInfo(f.AvPrice,f,a,C),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.EXCHANGE_RATE_ID)f&&v.IsNumber(f.Exchange)&&(C.Text=f.Exchange.toFixed(2)),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.BUY_VOL_ID)f&&v.IsNumber(f.BuyVol)&&(C.Text=this.FormatVolString(f.BuyVol)),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.SELL_VOL_ID)f&&v.IsNumber(f.SellVol)&&(C.Text=this.FormatVolString(f.SellVol)),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.VOL_ID)f&&v.IsNumber(f.Vol)&&(C.Text=this.FormatVolString(f.Vol)),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.VOL_IN_ID)f&&v.IsNumber(f.VolIn)&&(C.Text=this.FormatVolString(f.VolIn)),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.VOL_OUT_ID)f&&v.IsNumber(f.VolOut)&&(C.Text=this.FormatVolString(f.VolOut)),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.TOTAL_SHARES_ID)f&&v.IsNumber(f.TotalShares)&&(C.Text=this.FormatVolString(f.TotalShares)),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.OUTSTANDING_SHARES_ID)f&&v.IsNumber(f.OutShares)&&(C.Text=this.FormatVolString(f.OutShares)),this.FormatDrawInfo(r,f,C,a);else if(r.Type==X.CIRC_MARKET_VALUE_ID||r.Type==X.MARKET_VALUE_ID||r.Type==X.AMOUNT_ID){var T=li.get(r.Type);f&&v.IsNumber(f[T])&&(C.Text=this.FormatVolString(f[T])),this.FormatDrawInfo(r,f,C,a)}else if(r.Type==X.INCREASE_ID||r.Type==X.AMPLITUDE_ID||r.Type==X.UPDOWN_ID||r.Type==X.RISING_SPEED_1M_ID||r.Type==X.RISING_SPEED_3M_ID||r.Type==X.RISING_SPEED_5M_ID||r.Type==X.RISING_SPEED_10M_ID||r.Type==X.RISING_SPEED_15M_ID){var T=li.get(r.Type);if(f&&v.IsNumber(f[T])){var S=f[T];C.Text=S.toFixed(2),C.TextColor=this.GetUpDownColor(S,0)}this.FormatDrawInfo(r,f,C,a)}else if(r.Type==X.FUTURES_POSITION_ID||r.Type==X.FUTURES_OPEN_POSITION_ID||r.Type==X.FUTURES_CLOSE_POSITION_ID){var T=li.get(r.Type);if(f&&v.IsNumber(f[T])){var S=f[T];C.Text=S.toFixed(0)}this.FormatDrawInfo(r,f,C,a)}else if(r.Type==X.CUSTOM_STRING_TEXT_ID)this.GetCustomStringDrawInfo(a,r,C);else if(r.Type==X.CUSTOM_NUMBER_TEXT_ID)this.GetCustomNumberDrawInfo(a,r,C);else if(r.Type==X.CUSTOM_DATETIME_TEXT_ID)this.GetCustomDateTimeDrawInfo(a,r,C);else if(r.Type==X.CUSTOM_ICON_ID)this.GetCustomIconDrawInfo(a,r,C);else if(r.Type==X.CLOSE_LINE_ID){var D={Left:t,Top:n,Width:r.Width,Height:this.RowHeight};D.Right=D.Left+D.Width,D.Bottom=D.Top+D.Height,f&&this.DrawLine(f.CloseLine,r,D)}else if(r.Type==X.KLINE_ID){var D={Left:t,Top:n,Width:r.Width,Height:this.RowHeight};D.Right=D.Left+D.Width,D.Bottom=D.Top+D.Height,this.DrawKLine(f.KLine,r,D,a)}else r.Type==X.TIME_ID?this.FormaTimeDrawInfo(r,f,C,a):r.Type==X.DATE_ID?this.FormaDateDrawInfo(r,f,C,a):r.Type==X.CHECKBOX_ID?(D={Left:t,Top:n,Width:r.Width,Height:this.RowHeight},D.Right=D.Left+D.Width,D.Bottom=D.Top+D.Height,C.Rect=D,C.Checked=!1,C.Enable=!0,C.CheckBox=this.CheckBoxConfig,C.Data=f,f&&v.IsBool(f.Checked)&&(C.Checked=f.Checked)):r.Type==X.CUSTOM_CHECKBOX_ID?(D={Left:t,Top:n,Width:r.Width,Height:this.RowHeight},D.Right=D.Left+D.Width,D.Bottom=D.Top+D.Height,C.Rect=D,this.GetCustomCheckBoxDrawInfo(a,r,C)):r.Type==X.CUSTOM_BUTTON_ID?(D={Left:t,Top:n,Width:r.Width,Height:this.RowHeight},D.Right=D.Left+D.Width,D.Bottom=D.Top+D.Height,C.Rect=D,this.GetCustomButtonDrawInfo(a,r,C)):r.Type==X.CUSTOM_PROGRESS_ID?(D={Left:t,Top:n,Width:r.Width,Height:this.RowHeight},D.Right=D.Left+D.Width,D.Bottom=D.Top+D.Height,C.Rect=D,this.GetCustomProgressBarDrawInfo(a,r,C)):r.Type==X.CUSTOM_LINK_ID?this.GetCustomLinkDrawInfo(a,r,C):[X.RESERVE_NUMBER1_ID,X.RESERVE_NUMBER2_ID,X.RESERVE_NUMBER3_ID,X.RESERVE_NUMBER4_ID,X.RESERVE_NUMBER5_ID,X.RESERVE_NUMBER6_ID,X.RESERVE_NUMBER7_ID,X.RESERVE_NUMBER8_ID,X.RESERVE_NUMBER9_ID,X.RESERVE_NUMBER10_ID].includes(r.Type)?this.FormatReserveNumber(r,f,C):[X.RESERVE_STRING1_ID,X.RESERVE_STRING2_ID,X.RESERVE_STRING3_ID,X.RESERVE_STRING4_ID,X.RESERVE_STRING5_ID,X.RESERVE_STRING6_ID,X.RESERVE_STRING7_ID,X.RESERVE_STRING8_ID,X.RESERVE_STRING9_ID,X.RESERVE_STRING10_ID].includes(r.Type)?this.FormatReserveString(r,f,C):this.IsReserveProgressBarColumn(r.Type)?this.FormatReserveProgressBar(r,f,C):this.IsReserveButtonColumn(r.Type)&&this.FormatReserveButton(r,f,C);if(s==3&&(C.TextColor=this.DragRowTextColor),C.Symbol)this.DrawItemTextEx(C,h,n,u);else if(r.Type==X.CUSTOM_ICON_ID)this.DrawIconItem(C,h,n,u);else if(r.Type==X.CHECKBOX_ID||r.Type==X.CUSTOM_CHECKBOX_ID)this.DrawCheckbox(C,t,n,l);else if(r.Type==X.CUSTOM_BUTTON_ID||this.IsReserveButtonColumn(r.Type))this.DrawButton(C,t,n,l);else if(r.Type==X.CUSTOM_PROGRESS_ID||this.IsReserveProgressBarColumn(r.Type))this.DrawProgressBar(C,t,n,l);else if(r.Type==X.CUSTOM_LINK_ID)this.DrawLinkText(C,h,n,u);else{if(a.FlashBG&&a.FlashBG.Data&&r.ID!=null&&a.FlashBG.Data.has(r.ID)){var I=a.FlashBG.Data.get(r.ID),g={Rect:C.Rect,BGColor:I.Color};--I.Count,this.DrawItemBG(g),this.GlobalOption&&++this.GlobalOption.FlashBGCount}this.DrawItemBG(C),r.Type==X.CUSTOM_STRING_TEXT_ID?this.DrawCustomText(C,r,h,n,u):this.DrawItemText(C.Text,C.TextColor,C.TextAlign,h,n,u,C.BGColor)}if(C.Tooltip){var E={Rect:D,Stock:f,Index:e,Column:r,RowType:s,Type:C.Tooltip.Type,Data:C.Tooltip.Data};this.TooltipRect.push(E)}else if(r.EnableChartTooltip){var E={Rect:D,Stock:f,Index:e,Column:r,RowType:s,Type:20};this.TooltipRect.push(E)}if(C.Botton){var F={Stock:f,Index:e,ColumnIndex:o,Column:r,Rect:C.Botton.Rect,Type:C.Botton.Type,Data:C.Data};this.ButtonRect.push(F)}},this.IsReserveProgressBarColumn=function(e){var a=[X.RESERVE_PROGRESS_BAR1_ID,X.RESERVE_PROGRESS_BAR2_ID,X.RESERVE_PROGRESS_BAR3_ID,X.RESERVE_PROGRESS_BAR4_ID,X.RESERVE_PROGRESS_BAR5_ID,X.RESERVE_PROGRESS_BAR6_ID,X.RESERVE_PROGRESS_BAR7_ID,X.RESERVE_PROGRESS_BAR8_ID,X.RESERVE_PROGRESS_BAR9_ID,X.RESERVE_PROGRESS_BAR10_ID];return a.includes(e)},this.IsReserveButtonColumn=function(e){var a=[X.RESERVE_BUTTON1_ID,X.RESERVE_BUTTON2_ID,X.RESERVE_BUTTON3_ID,X.RESERVE_BUTTON4_ID,X.RESERVE_BUTTON5_ID,X.RESERVE_BUTTON6_ID,X.RESERVE_BUTTON7_ID,X.RESERVE_BUTTON8_ID,X.RESERVE_BUTTON9_ID,X.RESERVE_BUTTON10_ID];return a.includes(e)},this.DrawCustomText=function(e,a,r,t,n){if(e.Text){var s=e.Text,o=r;e.TextAlign=="center"?(o=r+n/2,this.Canvas.textAlign="center"):e.TextAlign=="right"?(o=r+n-2,this.Canvas.textAlign="right"):(o+=2,this.Canvas.textAlign="left");var l=this.Canvas.measureText(s).width+1,h=!1;if(l>=n){if(a.FormatType==2){var u=s.length+5;s="";for(var f=0;f<u;++f)s+="#"}else a.FormatType==1&&(s=this.TextEllipsis(s,n,a.MaxText));this.Canvas.save(),h=!0;var C={Left:r,Top:t+this.ItemMergin.Top,Width:n,Height:this.RowHeight};this.Canvas.beginPath(),this.Canvas.rect(C.Left,C.Top,C.Width,C.Height),this.Canvas.clip(),e.Tooltip={Type:1,Data:{AryText:[{Text:e.Text}]}}}this.Canvas.textBaseline="bottom",this.Canvas.fillStyle=e.TextColor,this.Canvas.fillText(s,o,t+this.RowHeight-this.ItemMergin.Bottom),h&&this.Canvas.restore()}},this.DrawSymbolName=function(e,a,r,t,n){var s=e.Stock,o=v.RemoveMarketSuffix(e.Symbol),l;if(s&&(o=s.Symbol,l=s.Name),!(!o&&!l)){var h=t+this.ItemMergin.Top+this.ItemNameHeight,u=r+this.ItemMergin.Left,f=u,C=a.Width-this.ItemMergin.Left-this.ItemMergin.Right,D=a.TextAlign;D=="center"?(f=u+C/2,this.Canvas.textAlign="center"):D=="right"?(f=u+C-2,this.Canvas.textAlign="right"):(f+=2,this.Canvas.textAlign="left");var c=this.GetNameColor(a,o,n),T=l;T&&(this.Canvas.textBaseline="bottom",this.Canvas.fillStyle=c,this.Canvas.font=this.ItemNameFont,T=this.TextEllipsis(T,C,a.MaxText),T&&this.Canvas.fillText(T,f,h)),T=o,T&&(this.Canvas.textBaseline="bottom",this.Canvas.font=this.ItemSymbolFont,this.Canvas.fillStyle=c,this.Canvas.fillText(T,f,h+this.ItemSymbolHeight)),this.Canvas.font=this.ItemFont}},this.DrawSymbolNameV2=function(e,a,r,t,n){var s=e.Stock,o=v.RemoveMarketSuffix(e.Symbol),l;if(s&&(o=s.Symbol,l=s.Name),!(!o&&!l)){var h=t+this.ItemMergin.Top+this.ItemNameHeight,u=r+this.ItemMergin.Left,f=u,C=a.Width-this.ItemMergin.Left-this.ItemMergin.Right,D=a.TextAlign;D=="center"?(f=u+C/2,this.Canvas.textAlign="center"):D=="right"?(f=u+C-2,this.Canvas.textAlign="right"):(f+=2,this.Canvas.textAlign="left"),this.Canvas.textBaseline="bottom";var I=a.TextColor,c=l;if(c&&(this.Canvas.fillStyle=I,this.Canvas.font=this.NameSymbolFont.Name,c=this.TextEllipsis(c,C,a.MaxText),c)){this.Canvas.fillText(c,f,h);var T=this.Canvas.measureText(c).width,S=2;v.IsNumber(a.Space)&&(S=a.Space),f+=T+S}var I=a.TextColor2;c=o,c&&(this.Canvas.font=this.NameSymbolFont.Symbol,this.Canvas.fillStyle=I,this.Canvas.fillText(c,f,h)),this.Canvas.font=this.ItemFont}},this.DrawLimitPriceBorder=function(e,a,r,t,n){if(!(!v.IsNumber(e)||!a)){var s=!1;if(v.IsNumber(a.LimitHigh)&&e>=a.LimitHigh&&(s=!0),v.IsNumber(a.LimitLow)&&e<=a.LimitLow&&(s=!0),!!s){var o=r+this.ItemMergin.Left+this.LimitMergin.Left,l=n-this.ItemMergin.Left-this.ItemMergin.Right-this.LimitMergin.Left-this.LimitMergin.Right,h=t+this.ItemMergin.Top+this.LimitMergin.Top,u=this.RowHeight-this.ItemMergin.Top-this.ItemMergin.Bottom-this.LimitMergin.Top-this.LimitMergin.Bottom;this.Canvas.strokeStyle=this.LimitBorderColor,this.Canvas.strokeRect(L(o),L(h),b(l),b(u))}}},this.GetExtendData=function(e,a){return v.IsNumber(a.DataIndex)?!e.Stock||!e.Stock.ExtendData?null:a.DataIndex<0?void 0:e.Stock.ExtendData[a.DataIndex]:v.IsNumber(a.BlockIndex)?!e.Block||a.BlockIndex<0?void 0:e.Block[a.BlockIndex]:null},this.GetCustomStringDrawInfo=function(e,a,r){var t=this.GetExtendData(e,a);if(a.IsDrawCallback){this.GetCustomTextDrawInfo(a,e.Symbol,t,r,e);return}v.IsString(t)&&(r.Text=t)},this.GetCustomNumberDrawInfo=function(e,a,r){var t=this.GetExtendData(e,a);if(a.IsDrawCallback){this.GetCustomTextDrawInfo(a,e.Symbol,t,r,e);return}if(v.IsNumber(t)){switch(a.FormatType){case 1:r.Text=t.toFixed(a.Decimal);break;case 2:r.Text=v.FormatValueThousandsString(t,a.Decimal);break;case 3:r.Text=this.FormatVolString(t);break;default:r.Text=v.FormatValueString(t,a.Decimal);break}switch(a.ColorType){case 1:r.TextColor=this.GetUpDownColor(t,0);break;case 2:v.IsNumber(e.Stock.YClose)?r.TextColor=this.GetUpDownColor(t,e.Stock.YClose):r.TextColor=this.UnchagneColor;break}}},this.GetCustomDateTimeDrawInfo=function(e,a,r){var t=this.GetExtendData(e,a);if(v.IsNumber(t)){if(a.IsDrawCallback){this.GetCustomTextDrawInfo(a,e.Symbol,t,r,e);return}a.ValueType==0&&(a.FormatType==1?r.Text=v.FormatDateString(t,"YYYY/MM/DD"):r.Text=v.FormatDateString(t))}},this.GetCustomIconDrawInfo=function(e,a,r){if(a.IsDrawCallback){this.GetCustomIconData(a,e.Symbol,r,e);return}},this.GetCustomCheckBoxDrawInfo=function(e,a,r){var t=this.GetExtendData(e,a);t&&v.IsBool(t.Checked)&&(r.Checked=t.Checked,r.Enable=!0,r.Data=t,v.IsBool(t.DisableCheckBox)&&(r.Enable=!t.DisableCheckBox),r.CheckBox=a.CheckBox)},this.GetCustomButtonDrawInfo=function(e,a,r){var t=this.GetExtendData(e,a);t&&(r.Text=t.Title,r.Button=a.Button,r.Font=a.Button.Font,r.Enable=!0,r.Data=t,v.IsBool(t.Enable)&&(r.Enable=t.Enable))},this.GetCustomProgressBarDrawInfo=function(e,a,r){var t=this.GetExtendData(e,a);t&&(r.Text=t.Title,r.ProgressBar=a.ProgressBar,r.Enable=!0,r.Value=t.Value,r.Data=t,v.IsBool(t.Enable)&&(r.Enable=t.Enable),t.TextColor&&(r.TextColor=t.TextColor),t.BarColor&&(r.BarColor=t.BarColor),t.BGColor&&(r.BGColor=t.BGColor))},this.GetCustomLinkDrawInfo=function(e,a,r){var t=this.GetExtendData(e,a);t&&(r.Text=t.Title,r.Link=a.Link,r.Enable=!0,r.Data=t,r.MaxText=a.MaxText,v.IsBool(t.Enable)&&(r.Enable=t.Enable),t.TextColor&&(r.TextColor=t.TextColor))},this.FormatReserveNumber=function(e,a,r){e.DefaultText&&(r.Text=e.DefaultText);var t=li.get(e.Type);if(!(!a||!t)){var n=a[t];v.IsNumber(n)&&(v.IsNumber(e.ColorType)&&(e.ColorType==1?r.TextColor=this.GetUpDownColor(n,0):e.ColorType==2&&(r.TextColor=this.GetUpDownColorV2(n,0))),r.Text=n.toFixed(e.FloatPrecision))}},this.FormatReserveString=function(e,a,r){e.DefaultText&&(r.Text=e.DefaultText);var t=li.get(e.Type);if(!(!a||!t)){var n=a[t];v.IsObject(n)?(n.Text&&(r.Text=n.Text),n.TextColor&&(r.TextColor=n.TextColor),n.BGColor&&(r.BGColor=n.BGColor)):v.IsString(n)&&(r.Text=n)}},this.FormatReserveProgressBar=function(e,a,r){var t=li.get(e.Type);if(!(!a||!t)){var n=a[t];v.IsNumber(n)?(r.ProgressBar=e.ProgressBar,r.Enable=!0,r.Value=n,r.Data={Value:n}):v.IsObject(n)&&(n.Title&&(r.Text=n.Title),r.ProgressBar=e.ProgressBar,r.Enable=!0,r.Value=n.Value,r.Data=n,v.IsBool(n.Enable)&&(r.Enable=n.Enable),n.TextColor&&(r.TextColor=n.TextColor),n.BarColor&&(r.BarColor=n.BarColor),n.BGColor&&(r.BGColor=n.BGColor))}},this.FormatReserveButton=function(e,a,r){var t=li.get(e.Type);if(!(!a||!t)){var n=a[t];n&&(r.Text=n.Title,r.Button=e.Button,r.Font=e.Button.Font,r.Enable=!0,r.Data=n,v.IsBool(n.Enable)&&(r.Enable=n.Enable))}},this.FormaTimeDrawInfo=function(e,a,r,t){v.IsNumber(a.Time)&&(e.ValueType==0?r.Text=v.FormatTimeString(a.Time,"HH:MM"):e.ValueType==1?r.Text=v.FormatTimeString(a.Time,"HH:MM:SS"):e.ValueType==2&&(r.Text=v.FormatTimeString(a.Time,"HH:MM:SS.fff")))},this.FormaDateDrawInfo=function(e,a,r,t){v.IsNumber(a.Date)&&(e.FormatType==0?r.Text=v.FormatDateString(a.Date,"YYYY-MM-DD"):e.FormatType==1?r.Text=v.FormatDateString(a.Date,"YYYY/MM/DD"):e.FormatType==2?r.Text=v.FormatDateString(a.Date,"YYYY/MM/DD/W"):e.FormatType==3?r.Text=v.FormatDateString(a.Date,"YYYY-MM"):e.FormatType==4?r.Text=v.FormatDateString(a.Date,"MM/DD"):e.FormatType==4&&(r.Text=v.FormatDateString(a.Date,"MM-DD")))},this.GetCustomIconData=function(e,a,r,t){var n=this.GetEventCallback($.ON_REPORT_DRAW_CUSTOM_ICON);if(!n||!n.Callback)return!1;var s={Symbol:a,Column:e,Data:t,Out:{Text:null,TextColor:null,TextAlign:null,Font:null}};return n.Callback(n,s,this),s.Out.Text&&(r.Text=s.Out.Text),s.Out.TextColor&&(r.TextColor=s.Out.TextColor),s.Out.TextAlign&&(r.TextAlign=s.Out.TextAlign),s.Out.BGColor&&(r.BGColor=s.Out.BGColor),s.Out.Font&&(r.Font=s.Out.Font),!0},this.GetPriceDrawInfo=function(e,a,r,t,n){if(!v.IsNumber(e))return!1;t.Text=e.toFixed(r.Decimal);var s=null;a.PriceColorType===1?v.IsNumber(a.YFClose)&&(s=a.YFClose):v.IsNumber(a.YClose)&&(s=a.YClose),v.IsNumber(s)?t.TextColor=this.GetUpDownColor(e,s):t.TextColor=this.UnchagneColor,n&&n.LimitBG&&(v.IsNumber(a.LimitHigh)&&e>=a.LimitHigh&&(t.BGColor=this.LimitUpBGColor,t.TextColor=this.LimitTextColor),v.IsNumber(a.LimitLow)&&e<=a.LimitLow&&(t.BGColor=this.LimitDownBGColor,t.TextColor=this.LimitTextColor))},this.GetUpDownColor=function(e,a){return e>a?this.UpColor:e<a?this.DownColor:this.UnchagneColor},this.GetUpDownColorV2=function(e,a){return e>=a?this.UpColor:this.DownColor},this.FormatVolString=function(e,a){return v.FormatVolString(e,a)},this.DrawItemBG=function(e){if(e.BGColor&&e.Rect){var a=e.Rect;this.Canvas.fillStyle=e.BGColor,this.Canvas.fillRect(a.Left,a.Top,a.Width,a.Height)}},this.DrawItemText=function(e,a,r,t,n,s,o){if(e){var l=t;r=="center"?(l=t+s/2,this.Canvas.textAlign="center"):r=="right"?(l=t+s-2,this.Canvas.textAlign="right"):(l+=2,this.Canvas.textAlign="left");var h=this.Canvas.measureText(e).width+1,u=!1;if(h>=s){this.Canvas.save(),u=!0;var f={Left:t,Top:n+this.ItemMergin.Top,Width:s,Height:this.RowHeight};if(this.Canvas.beginPath(),this.Canvas.rect(f.Left,f.Top,f.Width,f.Height),this.Canvas.clip(),this.TextOverflowStyle==1){var C=e.length+5;e="";for(var D=0;D<C;++D)e+="#"}}if(this.Canvas.textBaseline="bottom",this.Canvas.fillStyle=a,this.ItemTextLines>1){var c=(this.RowHeight-this.ItemMergin.Bottom-this.ItemMergin.Top-this.ItemFontHeight)/2,T=n+this.RowHeight-this.ItemMergin.Bottom-c;this.Canvas.fillText(e,l,T)}else this.Canvas.fillText(e,l,n+this.RowHeight-this.ItemMergin.Bottom);u&&this.Canvas.restore()}},this.DrawItemTextEx=function(e,a,r,t){var n=e.Text,s=e.TextColor,o=e.Symbol,l=e.TextAlign,h=this.Canvas.measureText(n).width+1,u=h,f=o.Size*B()+"px "+o.Family;this.Canvas.font=f;for(var C=[],D=0;D<o.Data.length;++D){var c=o.Data[D],T=this.Canvas.measureText(c.Text).width+1;if(u+T>t)break;u+=T,C[D]=T}var S=a,I=r+this.ItemMergin.Top+this.RowHeight/2;l=="center"?S=a+(t-u)/2:l=="right"?S=a+(t-u):S+=2,this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.font=this.ItemFont,this.Canvas.fillStyle=s,this.Canvas.fillText(n,S,I),S+=h,this.Canvas.font=f;for(var D=0;D<C.length;++D){var c=o.Data[D];this.Canvas.fillStyle=c.Color,this.Canvas.fillText(c.Text,S,I),S+=C[D]}this.Canvas.font=this.ItemFont},this.DrawIconItem=function(e,a,r,t){if(!(!e||!e.Font||!e.Text)){var n=e.Text,s=e.TextColor,o=e.TextAlign;this.Canvas.font=e.Font;var l=this.Canvas.measureText(n).width+1,h=a,u=r+this.ItemMergin.Top+this.RowHeight/2;o=="center"?h=a+(t-l)/2:o=="right"?h=a+(t-l):h+=2,this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.fillStyle=s,this.Canvas.fillText(n,h,u),this.Canvas.font=this.ItemFont}},this.DrawCheckbox=function(e,a,r,t){if(v.IsBool(e.Checked)&&e.CheckBox){var n=e.CheckBox;e.Font=n.Size*this.DevicePixelRatio+"px "+n.Family;var s=e.TextAlign,o=e.CheckBox.Size*this.DevicePixelRatio,l=a+e.CheckBox.Margin.Left,h=r+this.RowHeight-e.CheckBox.Margin.Bottom;s=="center"?l=a+t/2-o/2:s=="right"&&(l=a+t-n.Margin.Right);var u={Left:l,Bottom:h,Width:o,Height:o};u.Right=u.Left+u.Width,u.Top=u.Bottom-u.Height;var f=!1;if(e.Enable&&this.LastMouseStatus&&this.LastMouseStatus.OnMouseMove){var C=this.LastMouseStatus.OnMouseMove.X,D=this.LastMouseStatus.OnMouseMove.Y;C>u.Left&&C<u.Right&&D>u.Top&&D<u.Bottom&&(f=!0,this.LastMouseStatus.MouseOnStatus={Index:e.Index,ColumnIndex:e.ColumnIndex,Type:0})}if(this.Canvas.font=e.Font,this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",e.Checked===!0){var c=n.Checked.Color;e.Enable===!1?c=n.Checked.DisableColor:f&&(c=n.Checked.MouseOnColor),this.Canvas.fillStyle=c,this.Canvas.fillText(n.Checked.Symbol,l,h)}else if(e.Checked===!1){var c=n.Unchecked.Color;e.Enable===!1?c=n.Unchecked.DisableColor:f&&(c=n.Unchecked.MouseOnColor),this.Canvas.fillStyle=c,this.Canvas.fillText(n.Unchecked.Symbol,l,h)}e.Enable&&(e.Botton={Rect:u,Type:0})}},this.DrawButton=function(e,a,r,t){if(e.Button){var n=e.Button,s={Left:a+e.Button.Margin.Left,Top:r+e.Button.Margin.Top,Height:this.RowHeight-e.Button.Margin.Top-e.Button.Margin.Bottom,Width:t-e.Button.Margin.Left-e.Button.Margin.Right};s.Right=s.Left+s.Width,s.Bottom=s.Top+s.Height;var o=n.BGColor,l=n.TextColor;if(e.Enable===!1)o=n.Disable.BGColor,l=n.Disable.TextColor;else if(this.LastMouseStatus&&this.LastMouseStatus.OnMouseMove&&n.MouseOn){var u=this.LastMouseStatus.OnMouseMove.X,f=this.LastMouseStatus.OnMouseMove.Y;u>s.Left&&u<s.Right&&f>s.Top&&f<s.Bottom&&(o=n.MouseOn.BGColor,l=n.MouseOn.TextColor,this.LastMouseStatus.MouseOnStatus={Index:e.Index,ColumnIndex:e.ColumnIndex,Type:1})}this.Canvas.fillStyle=o,this.Canvas.fillRect(s.Left,s.Top,s.Width,s.Height),this.Canvas.font=e.Font,this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.fillStyle=l;var h=this.Canvas.measureText(e.Text).width,u=s.Left;h<s.Width&&(u+=(s.Width-h)/2);var f=s.Bottom-e.Button.TextMargin.Bottom;this.Canvas.fillText(e.Text,u,f),e.Enable&&(e.Botton={Rect:s,Type:1})}},this.DrawProgressBar=function(e,a,r,t){if(e.ProgressBar){var n=e.ProgressBar,s={Left:a+n.Margin.Left,Top:r+n.Margin.Top,Height:this.RowHeight-n.Margin.Top-n.Margin.Bottom,Width:t-n.Margin.Left-n.Margin.Right};s.Right=s.Left+s.Width,s.Bottom=s.Top+s.Height;var o=n.BGColor,l=n.BarColor,h=n.TextColor;e.Enable===!1&&(o=n.Disable.BGColor,l=n.Disable.BarColor,h=n.Disable.TextColor),e.BGColor&&(o=e.BGColor),e.TextColor&&(h=e.TextColor),e.BarColor&&(l=e.BarColor),o&&(this.Canvas.fillStyle=o,this.Canvas.fillRect(s.Left,s.Top,s.Width,s.Height));var u=s.Width-n.BarMargin.Left-n.BarMargin.Right,f=e.Value,C={Left:s.Left+n.BarMargin.Left,Top:s.Top+n.BarMargin.Top,Bottom:s.Bottom-n.BarMargin.Bottom,Width:0};if(f>0&&(f>1&&(f=1),C.Width=u*f,C.Height=C.Bottom-C.Top,C.Width<1&&(s.Width=1),Array.isArray(l)?this.Canvas.fillStyle=this.CreateLinearGradient(l,s.Left,s.Top,s.Right,s.Top):this.Canvas.fillStyle=l,this.Canvas.fillRect(C.Left,C.Top,C.Width,C.Height)),h&&e.Text){this.Canvas.font=n.Font,this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.fillStyle=h;var D=C.Left+n.TextMargin.Left,c=C.Bottom-n.TextMargin.Bottom;this.Canvas.fillText(e.Text,D,c)}}},this.CreateLinearGradient=function(e,a,r,t,n){for(var s=this.Canvas.createLinearGradient(a,r,t,n),o=1/(e.length-1),l=0;l<e.length;++l){var h=l*o;s.addColorStop(h,e[l])}return s},this.DrawLinkText=function(e,a,r,t){if(!(!e.Link||!e.Text)){var n=e.Link,s=e.Text,o=e.TextAlign,l=n.Font,h=n.TextColor;this.Canvas.font=l;var u=this.Canvas.measureText(s).width,f=this.Canvas.measureText("擎").width,C=a;t>=u?o=="center"?C=a+(t-u)/2:o=="right"&&(C=a+t-u):(s=this.TextEllipsis(s,t,e.MaxText),u=this.Canvas.measureText(s).width,e.Tooltip={Type:2,Data:{AryText:[{Text:e.Text}]}});var D={Left:C,Bottom:r+this.RowHeight-this.ItemMergin.Bottom,Height:f,Width:u};D.Right=D.Left+D.Width,D.Top=D.Bottom-D.Height;var c=!1;if(e.Enable===!1)h=n.Disable.TextColor;else if(this.LastMouseStatus&&this.LastMouseStatus.OnMouseMove&&n.MouseOn){var C=this.LastMouseStatus.OnMouseMove.X,T=this.LastMouseStatus.OnMouseMove.Y;C>D.Left&&C<D.Right&&T>D.Top&&T<D.Bottom&&(h=n.MouseOn.TextColor,c=!0,this.LastMouseStatus.MouseOnStatus={Index:e.Index,ColumnIndex:e.ColumnIndex,Type:2})}this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.fillStyle=h,this.Canvas.fillText(s,D.Left,D.Bottom),c&&(this.Canvas.strokeStyle=h,this.Canvas.beginPath(),this.Canvas.moveTo(D.Left,D.Bottom),this.Canvas.lineTo(D.Right,D.Bottom),this.Canvas.stroke()),e.Enable&&(e.Botton={Rect:D,Type:2})}},this.TextEllipsis=function(e,a,r){if(!e)return null;if(e.length<r.length)return e;var t=r.length-3;if(t<0)return null;for(var n=e.slice(0,t),s=t;s<e.length;++s){var o=n+e[s]+"...",l=this.Canvas.measureText(o).width;if(l>a){n+="...";break}n+=e[s]}return n},this.DrawMultiBar=function(e,a,r){if(!a.Source||!v.IsNonEmptyArray(a.Source))return!1;var t=a.Source[e.DataIndex];if(!t||!v.IsNonEmptyArray(t.Value))return!1;for(var n=r.Width-this.BarMergin.Left-this.BarMergin.Right,s=r.Left+this.BarMergin.Left,o=r.Top+this.RowMergin.Top+this.BarMergin.Top,l=r.Height-this.RowMergin.Top-this.RowMergin.Bottom-this.BarMergin.Top-this.BarMergin.Bottom,h=s+n,u=0;u<t.Value.length;++u){var f=t.Value[u];if(!(f<=0)){if(s>=h)break;var C=n*f;C<1&&(C=1),s+C>h&&(C=h-s);var D=u;v.IsNonEmptyArray(t.Color)&&u<t.Color.length&&(D=t.Color[u]),this.Canvas.fillStyle=d.DealList.FieldColor.Bar[D],this.Canvas.fillRect(s,o,C,l),s+=C}}return!0},this.DrawCenterBar=function(e,a,r){if(!a.Source||!v.IsNonEmptyArray(a.Source))return!1;var t=a.Source[e.DataIndex];if(!t||!v.IsNonEmptyArray(t.Value))return!1;for(var n=(r.Width-this.BarMergin.Left-this.BarMergin.Right)/2,s=r.Left+this.BarMergin.Left,o=s+n,l=r.Top+this.RowMergin.Top+this.BarMergin.Top,h=r.Height-this.RowMergin.Top-this.RowMergin.Bottom-this.BarMergin.Top-this.BarMergin.Bottom,u=0;u<t.Value.length&&u<2;++u){var f=t.Value[u];if(!(f<=0)){f>1&&(f=1);var C=n*f;C<1&&(C=1);var D=u;v.IsNonEmptyArray(t.Color)&&u<t.Color.length&&(D=t.Color[u]),this.Canvas.fillStyle=d.DealList.FieldColor.Bar[D],u==0?this.Canvas.fillRect(o,l,-C,h):this.Canvas.fillRect(o,l,C,h)}}},this.DrawLine=function(e,a,r){if(!e||!v.IsNonEmptyArray(e.Data))return!1;var t=r.Width-this.ItemMergin.Left-this.ItemMergin.Right,n=r.Left+this.ItemMergin.Left,s=r.Top+this.ItemMergin.Top,o=r.Height-this.ItemMergin.Top-this.ItemMergin.Bottom,l=n+t,h=s+o,u=function(p){var w=e.Count;if(w==1)return p==0?n:l;if(w<=0)return n;if(p>=w)return l;var H=n+t*p/w;return H},f=e.Max,C=e.Min;if(v.IsNumber(e.YClose))if(e.YClose==f&&e.YClose==C)f=e.YClose+e.YClose*.1,C=e.YClose-e.YClose*.1;else{var D=Math.max(Math.abs(e.YClose-f),Math.abs(e.YClose-C));f=e.YClose+D,C=e.YClose-D}var c=function(w){if(w<=C)return h;if(w>=f)return s;var w=o*(w-C)/(f-C);return h-w};this.Canvas.save();var T=null;if(v.IsNumber(e.YClose)){var F=c(e.YClose);F=L(F),T=F,this.Canvas.setLineDash([2,2]),this.Canvas.strokeStyle=this.CloseLineConfig.YCloseColor,this.Canvas.beginPath(),this.Canvas.moveTo(n,F),this.Canvas.lineTo(l,F),this.Canvas.stroke(),this.Canvas.setLineDash([])}e.Color?this.Canvas.strokeStyle=e.Color:this.Canvas.strokeStyle=this.CloseLineConfig.CloseColor;for(var S=!0,I={},g=0,E,F,R=0;R<e.Data.length;++R){var A=e.Data[R];v.IsNumber(A)&&(E=u(R),F=c(A),S?(this.Canvas.beginPath(),this.Canvas.moveTo(E,F),S=!1,I={X:E,Y:F}):this.Canvas.lineTo(E,F),++g)}g>0&&(this.Canvas.stroke(),a.IsDrawArea&&v.IsNumber(T)&&(this.Canvas.lineTo(E,T),this.Canvas.lineTo(I.X,T),this.Canvas.closePath(),this.SetFillStyle(this.CloseLineConfig.AreaColor,n,s,n,h),this.Canvas.fill())),this.Canvas.restore()},this.DrawKLine=function(e,a,r,t){if(a.IsDrawCallback){var n=this.GetEventCallback($.ON_REPORT_DRAW_KLINE);if(n||n.Callback){var s={Column:a,Data:t,KLineData:e,Rect:r,PreventDefault:!1};if(n.Callback(n,s,this),s.PreventDefault)return}}if(e&&v.IsNonEmptyArray(e.Data)){var o=e.Data[1],l=e.Data[2],h=[{Open:e.Data[0],High:o,Low:l,Close:e.Data[3]}];this.DrawKLineBar(h,o,l,r)}},this.DrawKLineBar=function(e,a,r,t){for(var n=4,o=t.Left+this.ItemMergin.Left,s=t.Width-this.ItemMergin.Left-this.ItemMergin.Right,o=t.Left+this.ItemMergin.Left,l=t.Top+this.ItemMergin.Top+n,h=t.Height-this.ItemMergin.Top-this.ItemMergin.Bottom-n*2,u=o+s,f=l+h,C=function(H){if(H<=r)return f;if(H>=a)return l;var H=h*(H-r)/(a-r);return f-H},D=this.KLineConfig.DataWidth,c=this.KLineConfig.DistanceWidth,T=o,S,I,g=0;g<e.length;++g,T+=D+c){var E=e[g];if(S=T,I=T+D,I>u)break;var F=C(E.Low),R=C(E.High),A=C(E.Open),P=C(E.Close);E.Open<E.Close?this.DrawKBarItem(E,D,this.KLineConfig.UpColor,1,S,I,F,R,A,P):E.Open>E.Close?this.DrawKBarItem(E,D,this.KLineConfig.DownColor,0,S,I,F,R,A,P):this.DrawKBarItem(E,D,this.KLineConfig.UnchagneColor,0,S,I,F,R,A,P)}},this.DrawKBarItem=function(e,a,r,t,n,s,o,l,h,u){var f=!1;t==1&&(f=!0);var C=Math.min(h,u),D=Math.max(h,u),c=Math.max(e.Open,e.Close),T=Math.min(e.Open,e.Close);this.Canvas.fillStyle=r,this.Canvas.strokeStyle=r;var S=n+(s-n)/2;if(f&&a%2!=0&&(a-=1),a>=4){if(e.High>c){this.Canvas.beginPath();var I=S;f&&(I=n+a/2),this.Canvas.moveTo(L(I),L(C)),this.Canvas.lineTo(L(I),L(l)),this.Canvas.stroke()}if(Math.abs(D-C)<1?this.Canvas.fillRect(b(n),b(C),b(a),1):f?(this.Canvas.beginPath(),this.Canvas.rect(L(n),L(C),b(a),b(D-C)),this.Canvas.stroke()):this.Canvas.fillRect(b(n),b(C),b(a),b(D-C)),e.Low<T){this.Canvas.beginPath();var I=S;f&&(I=n+a/2),this.Canvas.moveTo(L(I),L(D)),this.Canvas.lineTo(L(I),L(o)),this.Canvas.stroke()}}},this.SetFillStyle=function(e,a,r,t,n){if(Array.isArray(e)){var s=this.Canvas.createLinearGradient(a,r,t,n),o=1/e.length;for(var l in e)s.addColorStop(l*o,e[l]);this.Canvas.fillStyle=s}else this.Canvas.fillStyle=e},this.GetCustomTextDrawInfo=function(e,a,r,t,n){var s=this.GetEventCallback($.ON_DRAW_CUSTOM_TEXT);if(!s||!s.Callback)return!1;var o={Symbol:a,Column:e,Value:r,Data:n,Out:{Text:null,TextColor:null,TextAlign:null}};return s.Callback(s,o,this),o.Out.Text&&(t.Text=o.Out.Text),o.Out.TextColor&&(t.TextColor=o.Out.TextColor),o.Out.TextAlign&&(t.TextAlign=o.Out.TextAlign),o.Out.BGColor&&(t.BGColor=o.Out.BGColor),!0},this.FormatDrawInfo=function(e,a,r,t){if(!e.IsDrawCallback)return!1;var n=this.GetEventCallback($.ON_REPORT_FORMAT_DRAW_INFO);if(!n||!n.Callback)return!1;var s={Stock:a,Column:e,Data:t,DrawInfo:r};n.Callback(n,s,this)},this.GetFixedRowTextDrawInfo=function(e,a,r,t){var n=this.GetEventCallback($.ON_DRAW_REPORT_FIXEDROW_TEXT);if(!n||!n.Callback)return!1;var s={RowIndex:e,ColIndex:a,Column:r,Data:this.FixedRowData,Out:{Text:null,TextColor:null,TextAlign:null}};return n.Callback(n,s,this),s.Out.Text&&(t.Text=s.Out.Text),s.Out.TextColor&&(t.TextColor=s.Out.TextColor),s.Out.TextAlign&&(t.TextAlign=s.Out.TextAlign),!0},this.GetVolColor=function(e,a){var r=this.GetEventCallback($.ON_DRAW_DEAL_VOL_COLOR);if(r&&r.Callback){var t={Data:a,TextColor:null};if(r.Callback(r,t,this),t.TextColor)return t.TextColor}return e.TextColor},this.GetNameColor=function(e,a,r){var t=this.GetEventCallback($.ON_DRAW_REPORT_NAME_COLOR);if(t&&t.Callback){var n={Symbol:a,TextColor:null,RowType:r};if(t.Callback(t,n,this),n.TextColor)return n.TextColor}return e.TextColor},this.GetFontHeight=function(e,a){return Ea(this.Canvas,e,a)},this.OnMouseDown=function(e,a,r){if(!this.Data)return null;if(this.Tab){var t=this.Tab.OnMouseDown(e,a,r);if(t)return{Type:1,Tab:t}}if(this.VScrollbar){var n=this.VScrollbar.OnMouseDown(e,a,r);if(n)return{Type:5,VScrollbar:n}}var s=B(),o={X:e/s,Y:a/s};if(this.UIElement)var l={Left:this.UIElement.getBoundingClientRect().left,Top:this.UIElement.getBoundingClientRect().top};else var l={Left:null,Top:null};var f=this.PtInFixedBody(e,a);if(f){var h=!0,u=$.ON_CLICK_REPORT_FIXEDROW;return r.button==2&&(u=$.ON_RCLICK_REPORT_FIXEDROW),this.SendClickEvent(u,{Data:f,X:e,Y:a,e:r,Inside:o,UIElement:l}),this.SelectedFixedRow=f.Index,this.SelectedRow=-1,this.MultiSelectedRow=[],{Type:4,Redraw:h,Row:f}}var f=this.PtInBody(e,a);if(f){var C={Redraw:!1};this.OnClickButton(e,a,r,C);var h=!0;if(this.MultiSelectModel==1){if(r&&r.ctrlKey){var D=this.MultiSelectedRow.indexOf(f.DataIndex);D>=0?this.MultiSelectedRow.splice(D,1):this.MultiSelectedRow.push(f.DataIndex)}else r&&r.shiftKey?this.OnShiftClickRow(f):this.MultiSelectedRow.length==1&&this.MultiSelectedRow[0]==f.DataIndex?h=!1:this.MultiSelectedRow=[f.DataIndex];this.SelectedFixedRow=-1}else this.SelectedModel==0?(this.SelectedRow==f.Index&&(h=!1),this.SelectedRow=f.Index,this.SelectedFixedRow=-1):(this.SelectedRow==f.DataIndex&&(h=!1),this.SelectedRow=f.DataIndex,this.SelectedFixedRow=-1);var u=$.ON_CLICK_REPORT_ROW;return r.button==2&&(u=$.ON_RCLICK_REPORT_ROW),this.SendClickEvent(u,{Data:f,X:e,Y:a,e:r,Inside:o,UIElement:l}),{Type:2,Redraw:h||C.Redraw,Row:f}}var c=this.PtInHeader(e,a);if(c){var u=$.ON_CLICK_REPORT_HEADER;return r.button==2?u=$.ON_RCLICK_REPORT_HEADER:r.button==0&&(u=$.ON_CLICK_REPORT_HEADER),this.SendClickEvent(u,{Data:f,X:e,Y:a,e:r,Inside:o,UIElement:l}),{Type:3,Redraw:h,Header:c}}return null},this.OnShiftClickRow=function(e){if(this.MultiSelectedRow.length<=0){this.MultiSelectedRow.push(e.DataIndex);return}for(var a=null,r=null,t=0;t<this.MultiSelectedRow.length;++t){var n=this.MultiSelectedRow[t];if((a==null||a<n)&&(a=n),(r==null||r>n)&&(r=n),n==e.DataIndex){this.MultiSelectedRow.splice(t,1);return}}if(a==r){var s=e.DataIndex,o=a;s>o&&(s=a,o=e.DataIndex),this.MultiSelectedRow=[];for(var t=s;t<=o;++t)this.MultiSelectedRow.push(t)}else if(e.DataIndex<=a&&e.DataIndex>=r)this.MultiSelectedRow.push(e.DataIndex);else{var s=Math.min(e.DataIndex,r),o=Math.max(e.DataIndex,a);this.MultiSelectedRow=[];for(var t=s;t<=o;++t)this.MultiSelectedRow.push(t)}},this.OnDrawgRow=function(e,a,r){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return null;var t=this.RowHeight/2,n=this.RectClient.Top+this.HeaderHeight,s=this.ChartBorder.GetChartWidth(),o=n+this.FixedRowHeight*this.FixedRowCount;if(a<o+t)return{Type:5};for(var l=this.Data.YOffset,h=0;l<this.Data.Data.length&&h<this.RowCount;++l,++h){var u=this.Data.Data[l],f={Left:0,Top:o,Right:s,Bottom:o+this.RowHeight};if(f.Top+=t,f.Bottom+=t,e>=f.Left&&e<=f.Right&&a>=f.Top&&a<=f.Bottom){var C={DataIndex:l,Index:h,Symbol:u,Pos:0};return h==0?C.Pos=1:h==this.RowCount-1&&(C.Pos=2),{Type:2,Data:C}}o+=this.RowHeight}return h<this.RowCount?{Type:6}:{Type:7}},this.OnClickButton=function(e,a,r,t){if(r.button!=0)return!1;var n=this.GetButtonData(e,a);if(!n)return!0;if(n.Type===0){var s={Column:n.Column,Index:n.Index,Stock:n.Stock,ColumnIndex:n.ColumnIndex,Data:n.Data,Value:!0,PreventDefault:!1};return v.IsBool(n.Data.Checked)&&(s.Value=!n.Data.Checked),this.SendClickEvent($.ON_CLICK_REPORT_CHECKBOX,s),s.PreventDefault||(v.IsBool(n.Data.Checked)?n.Data.Checked=!n.Data.Checked:n.Data.Checked=!0),t.Redraw=!0,!0}else if(n.Type===1){var s={Column:n.Column,Index:n.Index,Stock:n.Stock,ColumnIndex:n.ColumnIndex,Data:n.Data};return this.SendClickEvent($.ON_CLICK_REPORT_BUTTON,s),t.Redraw=!0,!0}else if(n.Type===2){var s={Column:n.Column,Index:n.Index,Stock:n.Stock,ColumnIndex:n.ColumnIndex,Data:n.Data};return this.SendClickEvent($.ON_CLICK_REPORT_LINK,s),t.Redraw=!0,!0}return!1},this.OnDblClick=function(e,a,r){if(!this.Data)return!1;var t=this.PtInHeaderDragBorder(e,a);if(t)return this.SendClickEvent($.ON_DBCLICK_REPORT_DRAG_COLUMN_WIDTH,{Data:t,X:e,Y:a}),!0;var n=this.PtInBody(e,a);return n?(this.SendClickEvent($.ON_DBCLICK_REPORT_ROW,{Data:n,X:e,Y:a}),!0):!1},this.PtInClient=function(e,a){return e>this.RectClient.Left&&e<this.RectClient.Right&&a>this.RectClient.Top&&a<this.RectClient.Bottom},this.PtInBody=function(e,a){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return null;var r=this.RectClient.Top+this.HeaderHeight,t=this.RectClient.Left,n=this.RectClient.Right;this.RectClient.Right-this.RectClient.Left;for(var s=r+this.FixedRowHeight*this.FixedRowCount,o=this.Data.YOffset,l=0;o<this.Data.Data.length&&l<this.RowCount;++o,++l){var h=this.Data.Data[o],u={Left:t,Top:s,Right:n,Bottom:s+this.RowHeight};if(e>=u.Left&&e<=u.Right&&a>=u.Top&&a<=u.Bottom){var f={Rect:u,DataIndex:o,Index:l,Symbol:h};return f.Item=this.PtInItem(e,a,u.Top,u.Bottom),f}s+=this.RowHeight}return null},this.PtInFixedBody=function(e,a){if(this.FixedRowCount<=0)return null;var r=this.RectClient.Top+this.HeaderHeight,t=this.RectClient.Left,n=this.RectClient.Right;this.RectClient.Right-this.RectClient.Left;for(var s=r,o=0;o<this.FixedRowCount;++o){var l={Left:t,Top:s,Right:n,Bottom:s+this.FixedRowHeight};if(e>=l.Left&&e<=l.Right&&a>=l.Top&&a<=l.Bottom){var h={Rect:l,Index:o};return h.Item=this.PtInItem(e,a,l.Top,l.Bottom),h}s+=this.FixedRowHeight}return null},this.PtInItem=function(e,a,r,t){for(var n=this.RectClient.Left,s=this.RectClient.Right,o=n,l=0;l<this.FixedColumn&&l<this.Column.length;++l){var h=this.Column[l],u={Left:o,Right:o+h.Width,Top:r,Bottom:t};if(e>=u.Left&&e<=u.Right&&a>=u.Top&&a<=u.Bottom)return{Rect:u,Column:h,Index:l,IsFixed:!0};o+=h.Width}for(var l=this.FixedColumn+this.Data.XOffset;l<this.Column.length;++l){var h=this.Column[l];if(o>=s)break;var u={Left:o,Right:o+h.Width,Top:r,Bottom:t};if(e>=u.Left&&e<=u.Right&&a>=u.Top&&a<=u.Bottom)return{Rect:u,Column:h,Index:l,IsFixed:!1};o+=h.Width}return null},this.PtInHeader=function(e,a){if(!this.IsShowHeader)return null;var r=this.RectClient.Left,t=this.RectClient.Right,n=this.RectClient.Top,s=n+this.HeaderHeight;return e>=r&&e<=t&&a>=n&&a<=s?this.PtInItem(e,a,n,s):null},this.IsPtInBody=function(e,a){var r=this.RectClient.Top+this.HeaderHeight,t=this.RectClient.Left,n=this.RectClient.Right,s=this.RectClient.Bottom;return e>=t&&e<=n&&a>=r&&a<=s},this.IsPtInHeader=function(e,a){if(!this.IsShowHeader)return!1;var r=this.RectClient.Left,t=this.RectClient.Right,n=this.RectClient.Top,s=n+this.HeaderHeight;return e>=r&&e<=t&&a>=n&&a<=s},this.SendClickEvent=function(e,a){var r=this.GetEventCallback(e);r&&r.Callback&&r.Callback(r,a,this)},this.DrawDragRow=function(){if(this.DragRow){var e=this.DragRow;if(!(!e.Data||!e.Inside||!e.Data.Row)){var a=e.Data.Row.DataIndex;if(!(!v.IsNumber(a)||a<0)){var r=e.Inside.Y-this.RowHeight/2,t=r,n=this.RectClient.Left,s=this.RectClient.Right-this.RectClient.Left;this.Canvas.fillStyle=this.DragRowColor,this.Canvas.fillRect(n,r,s,this.RowHeight);var o=this.Data.Data[a],l={Symbol:o,Stock:null,Block:null};this.GetStockDataCallback&&(l.Stock=this.GetStockDataCallback(o)),this.GetBlockDataCallback&&(l.Block=this.GetBlockDataCallback(o)),l.Decimal=jt(o);var h=this.RectClient.Right;this.Canvas.font=this.ItemFont;for(var u=0;u<this.FixedColumn&&u<this.Column.length;++u){var f=this.Column[u];if(this.DrawItem(a,l,f,n,t,3),n+=f.Width,n>=h)break}for(var u=this.FixedColumn+this.Data.XOffset;u<this.Column.length;++u){var f=this.Column[u];if(this.DrawItem(a,l,f,n,t,3),n+=f.Width,n>=h)break}}}}},this.GetTooltipData=function(e,a){if(!v.IsNonEmptyArray(this.TooltipRect))return null;for(var r=0;r<this.TooltipRect.length;++r){var t=this.TooltipRect[r],n=t.Rect;if(n&&e>=n.Left&&e<=n.Right&&a>=n.Top&&a<=n.Bottom)return{Rect:t.Rect,Stock:t.Stock,Column:t.Column,Index:t.Index,Type:t.Type,Data:t.Data}}return null},this.GetButtonData=function(e,a){if(!v.IsNonEmptyArray(this.ButtonRect))return null;for(var r=0;r<this.ButtonRect.length;++r){var t=this.ButtonRect[r],n=t.Rect;if(n&&e>=n.Left&&e<=n.Right&&a>=n.Top&&a<=n.Bottom)return{Rect:t.Rect,Stock:t.Stock,Column:t.Column,Index:t.Index,Type:t.Type,Data:t.Data,ColumnIndex:t.ColumnIndex}}},this.PtInHeaderDragBorder=function(e,a){if(!this.IsShowHeader)return null;var r=this.RectClient.Left,t=this.RectClient.Right,n=this.RectClient.Top,s=n+this.HeaderHeight;if(!(e>=r&&e<=t&&a>=n&&a<=s))return null;for(var o=r,l=5*B(),h=0;h<this.FixedColumn&&h<this.Column.length;++h){var u=this.Column[h];if(u.EnableDragWidth===!0){var f={Right:o+u.Width,Top:n,Bottom:s};if(f.Left=f.Right-l,e>=f.Left&&e<=f.Right&&a>=f.Top&&a<=f.Bottom)return{Rect:f,Column:u,Index:h,IsFixed:!0}}o+=u.Width}for(var h=this.FixedColumn+this.Data.XOffset;h<this.Column.length;++h){var u=this.Column[h];if(o>=t)break;if(u.EnableDragWidth===!0){var f={Right:o+u.Width,Top:n,Bottom:s};if(f.Left=f.Right-l,e>=f.Left&&e<=f.Right&&a>=f.Top&&a<=f.Bottom)return{Rect:f,Column:u,Index:h,IsFixed:!1}}o+=u.Width}return null},this.SetSelectedRow=function(e){if(!e||this.SelectedModel===0)return!1;if(e.Symbol){for(var a=e.Symbol,r=!1,t=0;t<this.Data.Data.length;++t){var n=this.Data.Data[t];if(a==n){this.SelectedRow=t,r=!0;break}}return r?(e.AutoYScroll===!0&&this.UpdatePageYOffset({SelectedRow:this.SelectedRow}),r):!1}return!1},this.UpdatePageYOffset=function(e){if(e){var a=e.SelectedRow;if(!(a<0)){var r=this.GetCurrentPageStatus();r.IsSinglePage||a>=r.Start&&a<=r.End||(this.Data.YOffset=a)}}}}function Cg(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ChartReportTab",this.IsDrawFirst=!1,this.GetEventCallback,this.Report,this.IsShow=!0,this.TabList=[],this.SelectedTabIndex=-1,this.MoveOnTabIndex=-1,this.MaxPos=15,this.CurrentPos=15,this.Step=1,this.ScrollBarWidth=d.Report.Tab.ScrollBarWidth,this.ButtonColor=d.Report.Tab.ButtonColor,this.BarColor=d.Report.Tab.BarColor,this.BorderColor=d.Report.Tab.BorderColor,this.Mergin={Left:2,Right:2,Top:2,Bottom:2},this.TabFontConfig={Size:d.Report.Tab.Font.Size,Name:d.Report.Tab.Font.Name},this.TabFont,this.TabTitleColor=d.Report.Tab.TabTitleColor,this.TabSelectedTitleColor=d.Report.Tab.TabSelectedTitleColor,this.TabSelectedBGColor=d.Report.Tab.TabSelectedBGColor,this.TabMoveOnTitleColor=d.Report.Tab.TabMoveOnTitleColor,this.TabBGColor=d.Report.Tab.TabBGColor,this.TabMergin={Top:d.Report.Tab.Mergin.Top,Left:d.Report.Tab.Mergin.Left,Right:d.Report.Tab.Mergin.Right,Bottom:d.Report.Tab.Mergin.Bottom},this.Height,this.ButtonSize=25,this.TabWidth=0,this.RectScroll={Left:null,Right:null,Bar:null,Client:null},this.ReloadResource=function(e){this.ScrollBarWidth=d.Report.Tab.ScrollBarWidth,this.ButtonColor=d.Report.Tab.ButtonColor,this.BarColor=d.Report.Tab.BarColor,this.BorderColor=d.Report.Tab.BorderColor,this.TabFontConfig={Size:d.Report.Tab.Font.Size,Name:d.Report.Tab.Font.Name},this.TabTitleColor=d.Report.Tab.TabTitleColor,this.TabSelectedTitleColor=d.Report.Tab.TabSelectedTitleColor,this.TabSelectedBGColor=d.Report.Tab.TabSelectedBGColor,this.TabMoveOnTitleColor=d.Report.Tab.TabMoveOnTitleColor,this.TabBGColor=d.Report.Tab.TabBGColor,this.TabMergin={Top:d.Report.Tab.Mergin.Top,Left:d.Report.Tab.Mergin.Left,Right:d.Report.Tab.Mergin.Right,Bottom:d.Report.Tab.Mergin.Bottom}},this.SetTabList=function(e){this.TabList=[];for(var a=0;a<e.length;++a){var r=e[a];if(r.Title){var t={Title:r.Title,IsMenu:!1,FixedSymbol:[],FixedRowCount:0};if(r.ID&&(t.ID=r.ID),r.CommandID&&(t.CommandID=r.CommandID),v.IsBool(r.IsMenu)&&(t.IsMenu=r.IsMenu),v.IsNonEmptyArray(r.FixedSymbol))for(var n=0;n<r.FixedSymbol.length;++n){var s=r.FixedSymbol[n];!s||!s.Symbol||(t.FixedSymbol.push(s),++t.FixedRowCount)}v.IsNonEmptyArray(r.ArySubMenu)&&(t.ArySubMenu=r.ArySubMenu.slice()),this.TabList.push(t)}}},this.CalculateSize=function(){var e=B();this.TabFont=this.TabFontConfig.Size*e+"px "+this.TabFontConfig.Name,this.Height=this.GetFontHeight(this.TabFont,"8")+this.Mergin.Top+this.Mergin.Bottom;var a=Math.min(25,this.Height-this.Mergin.Top-this.Mergin.Bottom);this.ButtonSize=a},this.DrawScrollbar=function(o,a,r,t){this.RectScroll={Left:null,Right:null,Bar:null,Client:null};var n=this.Report.GetXScrollPos(),s=this.Report.GetXScrollRange();if(!(s<=0)&&!this.Report.IsShowAllColumn){var o=o+this.TabWidth;if(!(o+this.ScrollBarWidth*2>r)){this.MaxPos=s,this.CurrentPos=n;var l=this.ButtonSize,h={Left:o+this.Mergin.Left,Top:t-l-this.Mergin.Bottom,Width:l,Height:l};h.Right=h.Left+l,h.Bottom=h.Top+l;var u={Left:r-l-this.Mergin.Right,Top:h.Top,Width:l,Height:l};u.Right=u.Left+l,u.Bottom=u.Top+l,this.Canvas.fillStyle=this.ButtonColor,this.Canvas.fillRect(h.Left,h.Top,h.Width,h.Height),this.Canvas.fillRect(u.Left,u.Top,u.Width,u.Height),this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(h.Left,h.Top,h.Width,h.Height),this.Canvas.strokeRect(u.Left,u.Top,u.Width,u.Height);var f=u.Left-2-(h.Right+2),C=f-this.ScrollBarWidth,D=C*this.CurrentPos/this.MaxPos,c=h.Right+2+D,T={Left:c,Top:h.Top,Width:this.ScrollBarWidth,Height:h.Height};T.Right=T.Left+this.ScrollBarWidth,T.Bottom=h.Bottom,this.Canvas.fillStyle=this.BarColor,this.Canvas.fillRect(T.Left,T.Top,T.Width,T.Height),this.RectScroll.Left=h,this.RectScroll.Right=u,this.RectScroll.Bar=T,this.RectScroll.Client={Left:h.Right,Right:u.Left,Top:h.Top,Bottom:h.Bottom}}}},this.DrawTab=function(e,a,r,t){this.TabWidth=0,this.Canvas.font=this.TabFont,this.Canvas.textBaseline="bottom";var n=t-a,s=e+1,o=t-this.TabMergin.Bottom,l=0,h,u=0,f=0;for(f=0;f<this.TabList.length;++f){var C=this.TabList[f];h=C.Title,C.IsMenu&&(h+="▲"),l=s+this.TabMergin.Left,u=this.Canvas.measureText(h).width;var D={Left:s,Top:a,Width:u+this.TabMergin.Left+this.TabMergin.Right,Height:n};if(D.Right=D.Left+D.Width,D.Bottom=D.Top+D.Height,D.Right>r)break;var c=this.TabBGColor;f==this.SelectedTabIndex&&(c=this.TabSelectedBGColor),this.Canvas.fillStyle=c,this.Canvas.fillRect(D.Left,D.Top,D.Width,D.Height),this.Canvas.textAlign="left";var T=this.TabTitleColor;f==this.MoveOnTabIndex&&(T=this.TabMoveOnTitleColor),f==this.SelectedTabIndex&&(T=this.TabSelectedTitleColor),this.Canvas.fillStyle=T,this.Canvas.fillText(h,l,o),C.Rect=D,s+=D.Width+1,this.TabWidth+=D.Width+1}for(;f<this.TabList.length;++f){var C=this.TabList[f];C.Rect=null}},this.OnMouseDown=function(e,a,r){var t=this.PtInTab(e,a);return t||this.PtInScroll(e,a)},this.PtInScroll=function(e,a){if(!this.RectScroll)return null;if(this.RectScroll.Left){var r=this.RectScroll.Left;if(e>=r.Left&&e<=r.Right&&a>=r.Top&&a<=r.Bottom)return{Type:1,Rect:r}}if(this.RectScroll.Right){var r=this.RectScroll.Right;if(e>=r.Left&&e<=r.Right&&a>=r.Top&&a<=r.Bottom)return{Type:2,Rect:r}}if(this.RectScroll.Bar){var r=this.RectScroll.Bar;if(e>=r.Left&&e<=r.Right&&a>=r.Top&&a<=r.Bottom)return{Type:3,Rect:r}}if(this.RectScroll.Client){var r=this.RectScroll.Client;if(e>=r.Left&&e<=r.Right&&a>=r.Top&&a<=r.Bottom)return{Type:4,Rect:r,Pos:this.GetScrollPostionByPoint(e,a)}}return null},this.PtInTab=function(e,a){for(var r=0;r<this.TabList.length;++r){var t=this.TabList[r];if(t.Rect){var n=t.Rect;if(e>=n.Left&&e<=n.Right&&a>=n.Top&&a<=n.Bottom){var s={Type:5,Rect:n,Tab:t,Index:r};return t.IsMenu==!0&&s.Type==6,s}}}return null},this.GetFontHeight=function(e,a){return Ea(this.Canvas,e,a)},this.GetScrollPostionByPoint=function(e,a){var r=this.RectScroll.Client,t=r.Right-r.Left-this.ScrollBarWidth,n=parseInt(this.MaxPos*(e-r.Left)/t);return n}}function Dg(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ChartPageInfo",this.IsDrawFirst=!1,this.IsShow=!1,this.SizeChange=!0,this.Report,this.FontConfig={Size:d.Report.PageInfo.Font.Size,Name:d.Report.PageInfo.Font.Name},this.TextColor=d.Report.PageInfo.TextColor,this.BGColor=d.Report.PageInfo.BGColor,this.Mergin={Top:d.Report.PageInfo.Mergin.Top,Left:d.Report.PageInfo.Mergin.Left,Right:d.Report.PageInfo.Mergin.Right,Bottom:d.Report.PageInfo.Mergin.Bottom},this.Font,this.TextHeight=0,this.ReloadResource=function(e){this.FontConfig={Size:d.Report.PageInfo.Font.Size,Name:d.Report.PageInfo.Font.Name},this.TextColor=d.Report.PageInfo.TextColor,this.BGColor=d.Report.PageInfo.BGColor,this.Mergin={Top:d.Report.PageInfo.Mergin.Top,Left:d.Report.PageInfo.Mergin.Left,Right:d.Report.PageInfo.Mergin.Right,Bottom:d.Report.PageInfo.Mergin.Bottom}},this.Draw=function(){if(this.IsShow&&this.Report){var e=this.Report.GetCurrentPageStatus();if(!e.IsSinglePage){if(this.SizeChange){var a=B();this.Font=this.FontConfig.Size*a+"px "+this.FontConfig.Name,this.TextHeight=Ea(this.Canvas,this.Font,"擎")+this.Mergin.Top+this.Mergin.Bottom}var r=this.ChartBorder.GetLeft(),t=this.ChartBorder.GetRight(),n=this.ChartBorder.GetBottom()-2,s=r+(t-r)/2,o=e.DataCount+"/"+e.DataCount;this.Canvas.font=this.Font;var l=this.Canvas.measureText(o).width+4,h=s-l/2-this.Mergin.Left,u=n-this.TextHeight;this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(h,u,l+(this.Mergin.Left+this.Mergin.Right),this.TextHeight),o=e.Start+1+"/"+e.DataCount,this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(o,s,n-this.Mergin.Bottom),this.SizeChange=!1}}}}function MD(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ChartVScrollbar",this.IsDrawFirst=!1,this.GetEventCallback,this.Report,this.MaxPos=15,this.CurrentPos=15,this.Step=1,this.ButtonSize=25,this.Enable=!1,this.LastStatus={Draw:!1},this.GlobalOption,this.Style=0,this.ScrollBarHeight=d.Report.VScrollbar.ScrollBarHeight,this.ButtonColor=d.Report.VScrollbar.ButtonColor,this.BarColor=d.Report.VScrollbar.BarColor,this.BorderColor=d.Report.VScrollbar.BorderColor,this.BGColor=d.Report.VScrollbar.BGColor,this.Margin={Left:2,Right:2,Top:2,Bottom:2},this.BarWithConfig={Size:d.Report.VScrollbar.BarWidth.Size},this.RectScroll={Top:null,Bottom:null,Bar:null,Client:null},this.SetOption=function(e){if(e&&(v.IsBool(e.Enable)&&(this.Enable=e.Enable),v.IsNumber(e.Style)&&(this.Style=e.Style),v.IsNumber(e.BarWidth)&&(this.BarWithConfig.Size=e.BarWidth),e.Margin)){var a=e.Margin;v.IsNumber(a.Top)&&(this.Margin.Top=a.Top),v.IsNumber(a.Bottom)&&(this.Margin.Bottom=a.Bottom),v.IsNumber(a.Left)&&(this.Margin.Left=a.Left),v.IsNumber(a.Right)&&(this.Margin.Right=a.Right)}},this.ReloadResource=function(e){this.ScrollBarHeight=d.Report.VScrollbar.ScrollBarHeight,this.ButtonColor=d.Report.VScrollbar.ButtonColor,this.BarColor=d.Report.VScrollbar.BarColor,this.BorderColor=d.Report.VScrollbar.BorderColor,this.BGColor=d.Report.VScrollbar.BGColor,this.BarWithConfig={Size:d.Report.VScrollbar.BarWidth.Size}},this.CalculateSize=function(){var e=B(),a=this.BarWithConfig.Size*e+this.Margin.Left+this.Margin.Right;this.ButtonSize=Math.min(25,a)},this.DrawScrollbarStyle2=function(e,a,r,t){if(this.LastStatus.Draw=!1,this.RectScroll={Left:null,Right:null,Bar:null,Client:null},!!this.Enable){var n=this.IsShowCallback();if(n){var s=this.Report.GetCurrentPageStatus();if(!s.IsSinglePage){var o=s.Start,l=s.DataCount-s.PageSize,h=this.ButtonSize;this.MaxPos=l,this.CurrentPos=o;var u=a+this.Margin.Top+2,f=t-this.Margin.Bottom-2,C=f-u,D=C-this.ScrollBarHeight,c=D*this.CurrentPos/this.MaxPos,T=u+2+c,S={Right:r-this.Margin.Right,Top:T,Width:h,Height:this.ScrollBarHeight};S.Left=S.Right-h,S.Bottom=S.Top+S.Height,S.Bottom>f-2&&(S.Bottom=f-2,S.Top=S.Bottom-S.Height),this.RectScroll.Bar=S,this.RectScroll.Client={Left:S.Left,Right:S.Right,Top:u,Bottom:f};var I={Right:r,Top:a,Bottom:t,Width:h+this.Margin.Right+this.Margin.Left};I.Left=I.Right-I.Width,I.Height=I.Bottom-I.Top,this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(I.Left,I.Top,I.Width,I.Height),this.Canvas.fillStyle=this.BarColor,this.Canvas.fillRect(S.Left,S.Top,S.Width,S.Height),this.LastStatus.Draw=!0}}}},this.DrawScrollbarStyle=function(e,a,r,t){if(this.LastStatus.Draw=!1,this.RectScroll={Left:null,Right:null,Bar:null,Client:null},!!this.Enable){var n=this.IsShowCallback();if(n){var s=this.Report.GetCurrentPageStatus();if(!s.IsSinglePage){var o=s.Start,l=s.DataCount-s.PageSize,h=this.ButtonSize;this.MaxPos=l,this.CurrentPos=o;var u={Right:r-this.Margin.Right,Top:a+this.Margin.Top,Width:h,Height:h};u.Left=u.Right-h,u.Bottom=u.Top+h;var f={Right:r-this.Margin.Right,Bottom:t-this.Margin.Bottom,Width:h,Height:h};f.Left=f.Right-h,f.Top=f.Bottom-h;var C=f.Top-2-(u.Bottom+2),D=C-this.ScrollBarHeight,c=D*this.CurrentPos/this.MaxPos,T=u.Bottom+2+c,S={Right:r-this.Margin.Right,Top:T,Width:h,Height:this.ScrollBarHeight};S.Left=S.Right-h,S.Bottom=S.Top+S.Height,S.Bottom>f.Top-2&&(S.Bottom=f.Top-2,S.Top=S.Bottom-S.Height),this.RectScroll.Top=u,this.RectScroll.Bottom=f,this.RectScroll.Bar=S,this.RectScroll.Client={Left:u.Left,Right:u.Right,Top:u.Bottom,Bottom:f.Top};var I={Right:r,Top:a,Bottom:t,Width:h+this.Margin.Right+this.Margin.Left};I.Left=I.Right-I.Width,I.Height=I.Bottom-I.Top,this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(I.Left,I.Top,I.Width,I.Height),this.Canvas.fillStyle=this.ButtonColor,this.Canvas.fillRect(u.Left,u.Top,u.Width,u.Height),this.Canvas.fillRect(f.Left,f.Top,f.Width,f.Height),this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(u.Left,u.Top,u.Width,u.Height),this.Canvas.strokeRect(f.Left,f.Top,f.Width,f.Height),this.Canvas.fillStyle=this.BarColor,this.Canvas.fillRect(S.Left,S.Top,S.Width,S.Height),this.LastStatus.Draw=!0}}}},this.DrawScrollbar=function(e,a,r,t){this.Style==1?this.DrawScrollbarStyle2(e,a,r,t):this.DrawScrollbarStyle(e,a,r,t)},this.OnMouseDown=function(e,a,r){return this.PtInScroll(e,a)},this.PtInScroll=function(e,a){if(!this.RectScroll)return null;if(this.RectScroll.Top){var r=this.RectScroll.Top;if(e>=r.Left&&e<=r.Right&&a>=r.Top&&a<=r.Bottom)return{Type:1,Rect:r}}if(this.RectScroll.Bottom){var r=this.RectScroll.Bottom;if(e>=r.Left&&e<=r.Right&&a>=r.Top&&a<=r.Bottom)return{Type:2,Rect:r}}if(this.RectScroll.Bar){var r=this.RectScroll.Bar;if(e>=r.Left&&e<=r.Right&&a>=r.Top&&a<=r.Bottom)return{Type:3,Rect:r}}if(this.RectScroll.Client){var r=this.RectScroll.Client;if(e>=r.Left&&e<=r.Right&&a>=r.Top&&a<=r.Bottom)return{Type:4,Rect:r,Pos:this.GetScrollPostionByPoint(e,a)}}return null},this.GetScrollPostionByPoint=function(e,a){var r=this.RectScroll.Client,t=r.Bottom-r.Top-this.ScrollBarHeight,n=parseInt(this.MaxPos*(a-r.Top)/t);return n}}function vg(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ChartCellTooltip",this.BGColor="rgba(255,255,225, 0.9)",this.BorderColor="rgb(0,0,0)",this.Margin={Left:5,Right:5,Top:4,Bottom:5},this.Font=13*B()+"px 微软雅黑",this.TextColor="rgb(0,0,0)",this.YOffset=20,this.XOffset=5,this.Point,this.Data,this.Draw=function(){if(this.Canvas&&!(!this.Data||!v.IsNonEmptyArray(this.Data.AryText))&&this.Point){var e={Width:0,Height:0,Text:[]};this.CalculateTextSize(this.Data.AryText,e),v.IsNonEmptyArray(e.Text)&&this.DrawTooltip(this.Data.AryText,e)}},this.CalculateTextSize=function(e,a){for(var r=0,t=0,n=0;n<e.length;++n){var s=e[n],o=0,l=0;if(!(!s.Title&&!s.Text)){s.Title&&(s.TitleFont?this.Canvas.font=s.TitleFont:this.Canvas.font=this.Font,l=this.Canvas.measureText(s.Title).width,o=this.Canvas.measureText("擎").width);var h=0,u=0;s.Text&&(s.Font?this.Canvas.font=s.Font:this.Canvas.font=this.Font,h=this.Canvas.measureText(s.Text).width,u=this.Canvas.measureText("擎").width);var f=l+h,C=Math.max(u,o);if(v.IsNumber(s.Space)&&(f+=s.Space),s.Margin){var D=s.Margin;v.IsNumber(D.Left)&&(f+=D.Left),v.IsNumber(D.Right)&&(f+=D.Right),v.IsNumber(D.Top)&&(C+=D.Top),v.IsNumber(D.Bottom)&&(C+=D.Bottom)}r<f&&(r=f),t+=C,a.Text[n]={Width:f,Height:C,TitleWidth:l,TextWidth:h}}}if(this.Margin){var D=this.Margin;v.IsNumber(D.Left)&&(r+=D.Left),v.IsNumber(D.Right)&&(r+=D.Right),v.IsNumber(D.Top)&&(t+=D.Top),v.IsNumber(D.Bottom)&&(t+=D.Bottom)}a.Width=r,a.Height=t},this.DrawTooltip=function(e,a){var r={Left:this.Point.X+this.XOffset,Top:this.Point.Y+this.YOffset,Width:a.Width,Height:a.Height};r.Right=r.Left+r.Width,r.Bottom=r.Top+r.Height;var t=this.ChartBorder.GetBorder();r.Bottom>t.ChartHeight&&(r.Bottom=this.Point.Y,r.Top=r.Bottom-r.Height),r.Right>t.ChartWidth&&(r.Right=this.Point.X,r.Left=r.Right-r.Width),this.BGColor&&(this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(L(r.Left),L(r.Top),b(r.Width),b(r.Height))),this.BorderColor&&(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(L(r.Left),L(r.Top),b(r.Width),b(r.Height)));var n=r.Left,s=r.Top;this.Margin&&v.IsNumber(this.Margin.Left)&&(n+=this.Margin.Left),this.Margin&&v.IsNumber(this.Margin.Top)&&(s+=this.Margin.Top);for(var o,l=s,h=0;h<e.length;++h){var u=e[h];if(!(!u.Title&&!u.Text)){var f=a.Text[h];o=n,l+=f.Height,u.Margin&&v.IsNumber(u.Margin.Left)&&(o+=u.Margin.Left),u.Margin&&v.IsNumber(u.Margin.Bottom)&&(l-=u.Margin.Bottom),u.Title&&(u.TitleColor?this.Canvas.fillStyle=u.TitleColor:this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(u.Title,o,l,f.TitleWidth),o+=f.TitleWidth,v.IsNumber(u.Space)&&(o+=u.Space)),u.Text&&(u.Color?this.Canvas.fillStyle=u.Color:this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(u.Text,o,l,f.TextWidth))}}}}function Ui(e){this.DivElement=e,this.JSChartContainer,this.ResizeListener,this.CanvasElement=document.createElement("canvas"),this.CanvasElement.className="jstreport-drawing",this.CanvasElement.id=Re(),this.CanvasElement.setAttribute("tabindex",0),this.CanvasElement.style&&(this.CanvasElement.style.outline="none"),e.hasChildNodes()&&k.Chart.Log("[JSTReportChart::JSReportChart] divElement hasChildNodes",e.childNodes),e.appendChild(this.CanvasElement),this.OnSize=function(){var a=this.DivElement.offsetHeight,r=this.DivElement.offsetWidth;this.DivElement.style.height&&this.DivElement.style.width&&(this.DivElement.style.height.includes("px")&&(a=parseInt(this.DivElement.style.height.replace("px",""))),this.DivElement.style.width.includes("px")&&(r=parseInt(this.DivElement.style.width.replace("px","")))),this.CanvasElement.height=a,this.CanvasElement.width=r,this.CanvasElement.style.width=this.CanvasElement.width+"px",this.CanvasElement.style.height=this.CanvasElement.height+"px";var t=B();this.CanvasElement.height*=t,this.CanvasElement.width*=t,k.Chart.Log("[JSTReportChart::OnSize] devicePixelRatio="+window.devicePixelRatio+", height="+this.CanvasElement.height+", width="+this.CanvasElement.width),this.JSChartContainer&&this.JSChartContainer.OnSize&&this.JSChartContainer.OnSize()},this.SetOption=function(a){var r=this.CreateJSTReportChartContainer(a);if(!r)return!1;if(a.OnCreatedCallback&&a.OnCreatedCallback(r),this.JSChartContainer=r,this.DivElement.JSChart=this,a.EnableResize==!0&&this.CreateResizeListener(),a.MinuteChartTooltip&&a.MinuteChartTooltip.Enable&&r.InitalMinuteChartTooltip(a.MinuteChartTooltip),a.Symbol){r.Draw();var t=a.Symbol;a.Name&&(t=a.Name),r.ChangeSymbol(a.Symbol,{Name:t})}},this.CreateJSTReportChartContainer=function(a){var r=new cg(this.CanvasElement);if(r.Create(a),a.NetworkFilter&&(r.NetworkFilter=a.NetworkFilter),v.IsNonEmptyArray(a.Column)&&r.SetColumn(a.Column),v.IsNonEmptyArray(a.Tab)&&r.SetTab(a.Tab),v.IsNumber(a.TabSelected)&&r.SetSelectedTab(a.TabSelected),v.IsBool(a.EnableDragRow)&&(r.EnableDragRow=a.EnableDragRow),v.IsNumber(a.DragRowType)&&(r.DragRowType=a.DragRowType),v.IsBool(a.EnableDragHeader)&&(r.EnableDragHeader=a.EnableDragHeader),v.IsBool(a.EnablePageCycle)&&(r.EnablePageCycle=a.EnablePageCycle),v.IsNumber(a.FixedRowCount)&&r.SetFixedRowCount(a.FixedRowCount),a.SortInfo){var t=a.SortInfo;v.IsNumber(t.Field)&&(r.SortInfo.Field=t.Field),v.IsNumber(t.Sort)&&(r.SortInfo.Sort=t.Sort)}if(this.SetChartBorder(r,a),a.IsAutoUpdate!=null&&(r.IsAutoUpdate=a.IsAutoUpdate),a.AutoUpdateFrequency>0&&(r.AutoUpdateFrequency=a.AutoUpdateFrequency),v.IsBool(a.EnableFilter)&&(r.EnableFilter=a.EnableFilter),a.EventCallback)for(var n=0;n<a.EventCallback.length;++n){var t=a.EventCallback[n];r.AddEventCallback(t)}return r},this.SetChartBorder=function(a,r){if(r.Border){r.Border,v.IsNumber(r.Border.Left)&&(a.Frame.ChartBorder.Left=r.Border.Left),v.IsNumber(r.Border.Right)&&(a.Frame.ChartBorder.Right=r.Border.Right),v.IsNumber(r.Border.Top)&&(a.Frame.ChartBorder.Top=r.Border.Top),v.IsNumber(r.Border.Bottom)&&(a.Frame.ChartBorder.Bottom=r.Border.Bottom);var t=B();a.Frame.ChartBorder.Left*=t,a.Frame.ChartBorder.Right*=t,a.Frame.ChartBorder.Top*=t,a.Frame.ChartBorder.Bottom*=t}},this.CreateResizeListener=function(){var a=this;this.ResizeListener=new ResizeObserver(function(r){a.OnDivResize(r)}),this.ResizeListener.observe(this.DivElement)},this.OnDivResize=function(a){k.Chart.Log("[JSTReportChart::OnDivResize] entries=",a),this.OnSize()},this.ChangeSymbol=function(a,r){this.JSChartContainer&&this.JSChartContainer.ChangeSymbol(a,r)},this.SetColumn=function(a,r){this.JSChartContainer&&this.JSChartContainer.SetColumn(a,r)},this.AddEventCallback=function(a){this.JSChartContainer&&typeof this.JSChartContainer.AddEventCallback=="function"&&(k.Chart.Log("[JSTReportChart:AddEventCallback] obj=",a),this.JSChartContainer.AddEventCallback(a))},this.ReloadResource=function(a){this.JSChartContainer&&typeof this.JSChartContainer.ReloadResource=="function"&&(k.Chart.Log("[JSTReportChart:ReloadResource] "),this.JSChartContainer.ReloadResource(a))},this.ChartDestory=function(){this.JSChartContainer&&typeof this.JSChartContainer.ChartDestory=="function"&&this.JSChartContainer.ChartDestory()},this.Draw=function(){this.JSChartContainer&&typeof this.JSChartContainer.Draw=="function"&&(k.Chart.Log("[JSTReportChart:Draw] "),this.JSChartContainer.Draw())}}Ui.Init=function(e){var a=new Ui(e);return a.OnSize(),a};Ui.SetStyle=function(e){e&&d.SetStyle(e)};Ui.GetResource=function(){return d};Ui.GetfloatPrecision=function(e){return jt(e)};function Xo(){this.Symbol,this.Name,this.YClose,this.Open,this.Price,this.High,this.Low,this.Amount,this.Vol,this.Positon,this.Increase,this.UpDown,this.Exchange,this.Amplitude,this.BuyPrice,this.BuyVol,this.SellPrice,this.SellVol,this.AvPrice,this.LimitHigh,this.LimitLow,this.CloseLine,this.ExtendData}function cg(e){this.ClassName="JSTReportChartContainer",this.Frame,this.ChartPaint=[],this.ChartSplashPaint=null,this.LoadDataSplashTitle="数据加载中",this.SplashTitle={StockList:"下载码表中....."},this.Canvas=e.getContext("2d"),this.Tooltip=document.createElement("div"),this.Tooltip.className="jstreport-tooltip",this.Tooltip.style.background=d.TooltipBGColor,this.Tooltip.style.opacity=d.TooltipAlpha,this.Tooltip.style["pointer-events"]="none",this.Tooltip.id=Re(),e.parentNode.appendChild(this.Tooltip),this.Symbol,this.Name,this.NetworkFilter,this.Data={XOffset:0,YOffset:0,Data:[],Price:null},this.BorderData={MapData:null},this.SourceData={Data:[]},this.FixedRowData={Data:[]},this.DelayUpdateTimer=null,this.DelayUpdateFrequency=500,this.MapStockData,this.MapExePriceData,this.FlashBG=new Dt.default,this.FlashBGTimer=null,this.GlobalOption={FlashBGCount:0},this.SortInfo={Field:-1,Sort:0},this.mapEvent=new Dt.default,this.AutoUpdateTimer=null,this.AutoUpdateFrequency=15e3,this.UIElement=e,this.LastPoint=new ft,this.IsOnTouch=!1,this.TouchDrag,this.TouchMoveMinAngle=70,this.YStepPixel=5*B(),this.XStepPixel=10*B(),this.DragXScroll=null,this.EnablePageCycle=!1,this.TooltipMinuteChart,this.LastMouseStatus={MoveStatus:null,TooltipStatus:null,MouseOnStatus:null},this.IsDestroy=!1,this.ChartDestory=function(){this.IsDestroy=!0,this.StopAutoUpdate(),this.DestroyMinuteChartTooltip()},this.InitalMinuteChartTooltip=function(a){this.TooltipMinuteChart||(this.TooltipMinuteChart=new Gn,this.TooltipMinuteChart.Inital(this,a),this.TooltipMinuteChart.Create())},this.DestroyMinuteChartTooltip=function(){this.TooltipMinuteChart&&(this.TooltipMinuteChart.Destroy(),this.TooltipMinuteChart=null)},this.ShowMinuteChartTooltip=function(a,r,t){if(this.TooltipMinuteChart){var n=this.UIElement.getBoundingClientRect(),s=Da(),o=n.left+s.Left,l=n.top+s.Top;t.Offset={Left:o,Top:l},this.TooltipMinuteChart.Show(t,a,r)}},this.HideMinuteChartTooltip=function(){this.TooltipMinuteChart&&this.TooltipMinuteChart.Hide()},this.ClearFixedRowData=function(){this.FixedRowData.Data=[]},this.SetFixedRowCount=function(a){var r=this.ChartPaint[0];r&&(r.FixedRowCount=a)},this.Create=function(a){var r=this;this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new Li,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.IsEnableSplash=!0,this.Frame=new Tg,this.Frame.ChartBorder=new ra,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartSplashPaint.Frame=this.Frame;var t=new Sg;t.Frame=this.Frame,t.ChartBorder=this.Frame.ChartBorder,t.Canvas=this.Canvas,t.UIElement=this.UIElement,t.GetEventCallback=function(o){return r.GetEventCallback(o)},t.GetExePriceDataCallback=function(o){return r.GetExePriceData(o)},t.GetFlashBGDataCallback=function(o,l){return r.GetFlashBGData(o,l)},t.Data=this.Data,t.BorderData=this.BorderData,t.GlobalOption=this.GlobalOption,t.FixedRowData=this.FixedRowData,t.SortInfo=this.SortInfo,this.ChartPaint[0]=t,a&&(v.IsBool(a.IsShowHeader)&&(t.IsShowHeader=a.IsShowHeader),v.IsNumber(a.FixedColumn)&&(t.FixedColumn=a.FixedColumn),v.IsNumber(a.BorderLine)&&(this.Frame.BorderLine=a.BorderLine),v.IsBool(a.ItemBorder)&&(t.IsDrawBorder=a.ItemBorder),v.IsNumber(a.SelectedModel)&&(t.SelectedModel=a.SelectedModel));var n=!0,s=!0;a&&(a.KeyDown===!1&&(n=!1,k.Chart.Log("[JSTReportChartContainer::Create] not register keydown event.")),a.Wheel===!1&&(s=!1,k.Chart.Log("[JSTReportChartContainer::Create] not register wheel event."))),n&&this.UIElement.addEventListener("keydown",function(o){r.OnKeyDown(o)},!0),s&&this.UIElement.addEventListener("wheel",function(o){r.OnWheel(o)},!0),this.UIElement.ondblclick=function(o){r.UIOnDblClick(o)},this.UIElement.onmousedown=function(o){r.UIOnMouseDown(o)},this.UIElement.onmousemove=function(o){r.UIOnMouseMove(o)},this.UIElement.onmouseout=function(o){r.UIOnMounseOut(o)},this.UIElement.onmouseleave=function(o){r.UIOnMouseleave(o)},this.UIElement.oncontextmenu=function(o){r.UIOnContextMenu(o)}},this.Draw=function(){if(!(this.UIElement.width<=0||this.UIElement.height<=0)){this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height);var a=B();if(this.Canvas.lineWidth=a,this.LastMouseStatus.MouseOnStatus=null,this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash){this.Frame.Draw({IsEnableSplash:this.ChartSplashPaint.IsEnableSplash}),this.ChartSplashPaint.Draw();return}this.Frame.Draw(),this.Frame.DrawLogo();for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.IsDrawFirst&&t.Draw()}for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.IsDrawFirst||t.Draw()}this.GlobalOption.FlashBGCount>0&&this.DelayDraw(500)}},this.DelayDraw=function(a){var r=this;typeof this.FlashBGTimer=="number"&&(clearTimeout(this.FlashBGTimer),this.FlashBGTimer=null),this.FlashBGTimer=setTimeout(function(){r.Draw()},a)},this.ClearData=function(){this.SourceData.Data=[],this.Data.Data=[],this.Data.Price=null,this.Data.XOffset=0,this.Data.YOffset=0,this.MapStockData=new Dt.default,this.MapExePriceData=null,this.BorderData.MapData=null},this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"JSTReportChartContainer::StopAutoUpdate"),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.AddEventCallback=function(a){if(!(!a||!a.event||!a.callback)){var r={Callback:a.callback,Source:a};this.mapEvent.set(a.event,r)}},this.RemoveEventCallback=function(a){this.mapEvent.has(a)&&this.mapEvent.delete(a)},this.GetEventCallback=function(a){if(!this.mapEvent.has(a))return null;var r=this.mapEvent.get(a);return r},this.OnSize=function(){this.Frame&&(this.SetSizeChange(!0),this.Draw(),this.DelayUpdateStockData())},this.SetSizeChange=function(a){for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t&&(t.SizeChange=a)}},this.ChangeSymbol=function(a,r){this.CancelAutoUpdate(),this.ClearData(),this.Symbol=a,this.Name=a,r&&r.Name&&(this.Name=r.Name),this.RequestStockListData()},this.CancelAutoUpdate=function(){typeof this.AutoUpdateTimer=="number"&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=null)},this.SetColumn=function(a,r){var t=this.ChartPaint[0];t&&(t.SetColumn(a),t.SizeChange=!0,r&&r.Redraw&&this.Draw())},this.RequestStockListData=function(){this.ChartSplashPaint.SetTitle(this.SplashTitle.StockList),this.ChartSplashPaint.EnableSplash(!0),this.Draw();var a=this;if(this.NetworkFilter){var r={Name:"JSTReportChartContainer::RequestStockListData",Explain:"T型报价列表数据",Self:this,PreventDefault:!1};if(this.NetworkFilter(r,function(t){t&&t.symbol==a.Symbol&&(a.ChartSplashPaint.EnableSplash(!1),a.RecvStockListData(t))}),r.PreventDefault==!0)return}throw{Name:"JSTReportChartContainer::RequestStockListData",Error:"(T型报价列表数据)不提供内置测试数据"}},this.RecvStockListData=function(a){if(this.MapExePriceData=new Dt.default,this.MapStockData=new Dt.default,v.IsNonEmptyArray(a.data))for(var r=0;r<a.data.length;++r){var t=a.data[r],n=t[0],s=new Xo;s.Symbol=s.Name=t[1],t[3]&&(s.Name=t[3]);var o=new Xo;o.Symbol=o.Name=t[2],t[4]&&(o.Name=t[4]),this.MapStockData.set(s.Symbol,s),this.MapStockData.set(o.Symbol,o);var l={ExePrice:n,LeftData:s,RightData:o};this.MapExePriceData.set(l.ExePrice,l),this.SourceData.Data.push(n),this.Data.Data.push(n)}if(v.IsNumber(a.price)&&(this.Data.Price=a.price),v.IsNumber(a.Decimal)){var h=this.ChartPaint[0];h&&(h.DefaultDecimal=a.Decimal)}this.Draw(),this.UpdateStockData()},this.GetExePriceData=function(a){return!this.MapExePriceData||!this.MapExePriceData.has(a)?null:this.MapExePriceData.get(a)},this.UpdateStockData=function(){if(v.IsNonEmptyArray(this.Data.Data)&&!(this.MapStockData.size<=0)){var a=[],r=!0,t=!1,n=void 0;try{for(var s=(0,ye.default)(this.MapStockData),o;!(r=(o=s.next()).done);r=!0){var l=o.value;a.push(l[0])}}catch(h){t=!0,n=h}finally{try{!r&&s.return&&s.return()}finally{if(t)throw n}}v.IsNonEmptyArray(a)&&this.RequestStockData(a)}},this.RequestStockData=function(a){var r=this;if(this.NetworkFilter){var t=this.ChartPaint[0],n={Name:"JSTReportChartContainer::RequestStockData",Explain:"T型报价列表期权数据",Request:{Data:{stocks:a,symbol:this.Symbol,fixedRowCount:t.FixedRowCount}},Self:this,PreventDefault:!1};if(this.NetworkFilter(n,function(s){r.RecvStockData(s),r.AutoUpdate()}),n.PreventDefault==!0)return}throw{Name:"JSTReportChartContainer::RequestStockData",Error:"(T型报价列表期权数据)不提供内置测试数据"}},this.RecvStockData=function(a){var r=this,t=new Fe.default;if(v.IsNonEmptyArray(a.data))for(var n=0;n<a.data.length;++n){var s=a.data[n],o=s[0];if(o){var l=null;this.MapStockData.has(o)?l=this.MapStockData.get(o):(l=new Xo,l.Symbol=o,this.MapStockData.set(o,l)),this.ReadStockJsonData(l,s),t.has(o)||t.add(o)}}if(v.IsNumber(a.price)&&(this.Data.Price=a.price),v.IsNonEmptyArray(a.fixedRowData))for(var n=0;n<a.fixedRowData.length;++n){var s=a.fixedRowData[n];!s||!s.TData||(this.FixedRowData.Data[n]=s)}var h=this.ChartPaint[0];if(h&&(this.SortInfo.Sort==1||this.SortInfo.Sort==2)&&v.IsNumber(this.SortInfo.Field)&&this.SortInfo.Field>=0){var u=h.Column[this.SortInfo.Field],f=this.GetEventCallback($.ON_TREPORT_LOCAL_SORT);if(f&&f.Callback){var C={Column:u,SortInfo:this.SortInfo,SymbolList:this.Data.Data,Result:null};f.Callback(f,C,this),Array.isArray(C.Result)&&(this.Data.Data=C.Result)}else this.Data.Data.sort(function(D,c){return r.LocalSort(D,c,u,r.SortInfo.Sort,r.SortInfo.CellType)})}this.CalculateData(),this.Draw()},this.CalculateData=function(){if(!(!this.MapExePriceData||this.MapExePriceData.size<=0)){var a={Max:null,ExePrice:null,CellType:1},r={Max:null,ExePrice:null,CellType:2};this.BorderData.MapData=new Dt.default;var t=!0,n=!1,s=void 0;try{for(var o=(0,ye.default)(this.MapExePriceData),l;!(t=(l=o.next()).done);t=!0){var h=l.value,u=h[1],f=u.LeftData,C=u.RightData;f&&v.IsNumber(f.Position)&&(a.Max==null||a.Max<f.Position)&&(a.Max=f.Position,a.ExePrice=h[0]),C&&v.IsNumber(C.Position)&&(r.Max==null||r.Max<C.Position)&&(r.Max=C.Position,r.ExePrice=h[0])}}catch(c){n=!0,s=c}finally{try{!t&&o.return&&o.return()}finally{if(n)throw s}}var D=[null,null,null];a.ExePrice&&(D[1]=a),r.ExePrice&&(D[2]=r),this.BorderData.MapData.set(at.POSITION_ID,{Data:D})}},this.ReadStockJsonData=function(a,r){v.IsString(r[1])&&(a.Name=r[1]),v.IsNumber(r[2])&&(a.YClose=r[2]),v.IsNumber(r[3])&&(a.Open=r[3]),v.IsNumber(r[4])&&(a.High=r[4]),v.IsNumber(r[5])&&(a.Low=r[5]),v.IsNumber(r[6])&&(a.Price=r[6]),v.IsNumber(r[7])&&(a.Vol=r[7]),v.IsNumber(r[8])&&(a.Amount=r[8]),v.IsNumber(r[9])&&(a.BuyPrice=r[9]),v.IsNumber(r[10])&&(a.BuyVol=r[10]),v.IsNumber(r[11])&&(a.SellPrice=r[11]),v.IsNumber(r[12])&&(a.SellVol=r[12]),v.IsNumber(r[13])&&(a.AvPrice=r[13]),v.IsNumber(r[14])&&(a.Position=r[14]),v.IsNumber(r[16])&&(a.LimitHigh=r[16]),v.IsNumber(r[17])&&(a.LimitLow=r[17]),v.IsNumber(r[21])&&(a.Increase=r[21]),v.IsNumber(r[22])&&(a.UpDown=r[22]),v.IsNumber(r[24])&&(a.Amplitude=r[24]),r[27]&&(a.NameEx=r[27]),v.IsNumber(r[21])||v.IsNumber(a.Price)&&v.IsNumber(a.YClose)&&a.YClose!=0&&(a.Increase=(a.Price-a.YClose)/a.YClose*100),v.IsNumber(r[22])||v.IsNumber(a.Price)&&v.IsNumber(a.YClose)&&(a.UpDown=a.Price-a.YClose),v.IsNumber(r[24])||v.IsNumber(a.High)&&v.IsNumber(a.Low)&&v.IsNumber(a.YClose)&&a.YClose!=0&&(a.Amplitude=(a.High-a.Low)/a.YClose*100),r[30]&&(a.ExtendData=r[30]),r[32]&&(a.CloseLine=r[32]),r[33]&&(a.KLine=r[33]),r[34]&&(a.ExePrice=r[34]),v.IsNumber(r[101])&&(a.ReserveNumber1=r[101]),v.IsNumber(r[102])&&(a.ReserveNumber2=r[102]),v.IsNumber(r[103])&&(a.ReserveNumber3=r[103]),v.IsNumber(r[104])&&(a.ReserveNumber4=r[104]),v.IsNumber(r[105])&&(a.ReserveNumber5=r[105]),v.IsNumber(r[106])&&(a.ReserveNumber6=r[106]),v.IsNumber(r[107])&&(a.ReserveNumber7=r[107]),v.IsNumber(r[108])&&(a.ReserveNumber8=r[108]),v.IsNumber(r[109])&&(a.ReserveNumber9=r[109]),v.IsNumber(r[110])&&(a.ReserveNumber10=r[110]),(v.IsString(r[201])||v.IsObject(r[201]))&&(a.ReserveString1=r[201]),(v.IsString(r[202])||v.IsObject(r[202]))&&(a.ReserveString2=r[202]),(v.IsString(r[203])||v.IsObject(r[203]))&&(a.ReserveString3=r[203]),(v.IsString(r[204])||v.IsObject(r[204]))&&(a.ReserveString4=r[204]),(v.IsString(r[205])||v.IsObject(r[205]))&&(a.ReserveString5=r[205]),(v.IsString(r[206])||v.IsObject(r[206]))&&(a.ReserveString6=r[206]),(v.IsString(r[207])||v.IsObject(r[207]))&&(a.ReserveString7=r[207]),(v.IsString(r[208])||v.IsObject(r[208]))&&(a.ReserveString8=r[208]),(v.IsString(r[209])||v.IsObject(r[209]))&&(a.ReserveString9=r[209]),(v.IsString(r[210])||v.IsObject(r[210]))&&(a.ReserveString10=r[210])},this.AutoUpdate=function(a){if(this.CancelAutoUpdate(),!!this.IsAutoUpdate){var r=this,t=2,n=this.GetEventCallback($.ON_TREPORT_MARKET_STATUS);if(n&&n.Callback){var s={MarketStatus:2};n.Callback(n,s,this),v.IsNumber(s.MarketStatus)&&(t=s.MarketStatus)}if(!(t==0||t==3)){var o=this.AutoUpdateFrequency;t==1?this.AutoUpdateTimer=setTimeout(function(){r.AutoUpdate()},o):t==2&&(this.AutoUpdateTimer=setTimeout(function(){r.UpdateStockData()},o))}}},this.DelayUpdateStockData=function(){var a=this;this.DelayUpdateTimer!=null&&(clearTimeout(this.DelayUpdateTimer),this.DelayUpdateTimer=null);var r=this.DelayUpdateFrequency;this.DelayUpdateTimer=setTimeout(function(){a.UpdateStockData()},r)},this.UIOnDblClick=function(a){var r=B(),t=(a.clientX-this.UIElement.getBoundingClientRect().left)*r,n=(a.clientY-this.UIElement.getBoundingClientRect().top)*r,s=this.GetTReportChart();s&&s.OnDblClick(t,n,a)},this.UIOnMouseDown=function(a){var r=B(),t=(a.clientX-this.UIElement.getBoundingClientRect().left)*r,n=(a.clientY-this.UIElement.getBoundingClientRect().top)*r,s=this.ChartPaint[0];if(s){var o=s.OnMouseDown(t,n,a);o&&(o.Type==2&&(a.button==0||a.button==2)?o.Redraw==!0&&this.Draw():o.Type==3&&a.button==0&&this.OnClickHeader(o,a))}},this.GetTReportChart=function(){var a=this.ChartPaint[0];return a||null},this.UIOnMouseMove=function(a){var r=B(),t=(a.clientX-this.UIElement.getBoundingClientRect().left)*r,n=(a.clientY-this.UIElement.getBoundingClientRect().top)*r;this.LastMouseStatus.MouseOnStatus,this.LastMouseStatus.OnMouseMove=null,this.LastMouseStatus.TooltipStatus,this.LastMouseStatus.TooltipStatus=null;var s=!1,o=null;this.LastMouseStatus.OnMouseMove={X:t,Y:n};var l={Cursor:"default",Name:"Default"},h=this.GetTReportChart();if(h){var u=h.GetTooltipData(t,n);u&&(u.Type==20?u.Data&&u.Data.Symbol&&(s=!0,o={Symbol:u.Data.Symbol,Rect:u.Rect}):this.LastMouseStatus.TooltipStatus={X:t,Y:n,Data:u,ClientX:a.clientX,ClientY:a.clientY})}l&&(this.UIElement.style.cursor=l.Cursor),s?this.ShowMinuteChartTooltip(null,null,o):this.HideMinuteChartTooltip()},this.UIOnMounseOut=function(a){this.HideMinuteChartTooltip()},this.UIOnMouseleave=function(a){this.HideMinuteChartTooltip()},this.UIOnContextMenu=function(a){a.preventDefault();var r=a.clientX-this.UIElement.getBoundingClientRect().left,t=a.clientY-this.UIElement.getBoundingClientRect().top;this.OnRightMenu(r,t,a)},this.OnRightMenu=function(a,r,t){},this.OnClickHeader=function(a,r){var t=a.Header;if(t.Column&&t.Column.Sort==1){var n={CellType:t.CellType,ColumnIndex:t.ColumnIndex};this.SortHeader(t.Column,n)}},this.SortHeader=function(a,r){var t=this,n={Field:this.SortInfo.Field,Sort:this.SortInfo.Sort,CellType:this.SortInfo.CellType},s=a.SortType;if(n.Field!=r.ColumnIndex||n.CellType!=r.CellType)n.Field=r.ColumnIndex,n.CellType=r.CellType,n.Sort=s[0];else if(s.length==1)n.Sort=s[0];else for(var o=0;o<s.length;++o)if(n.Sort==s[o]){n.Sort=s[(o+1)%s.length];break}if(n.Sort==0){this.Data.Data=[];for(var o=0;o<this.SourceData.Data.length;++o)this.Data.Data.push(this.SourceData.Data[o])}else{var l=this.GetEventCallback($.ON_TREPORT_LOCAL_SORT);if(l&&l.Callback){var h={Column:a,SortInfo:n,SymbolList:this.Data.Data,Result:null};l.Callback(l,h,this),Array.isArray(h.Result)&&(this.Data.Data=h.Result)}else this.Data.Data.sort(function(u,f){return t.LocalSort(u,f,a,n.Sort,n.CellType)})}this.Data.YOffset=0,this.SortInfo.Field=n.Field,this.SortInfo.Sort=n.Sort,this.SortInfo.CellType=n.CellType,this.Draw(),this.DelayUpdateStockData()},this.LocalSort=function(a,r,t,n,s){switch(t.Type){case at.SYMBOL_ID:case at.NAME_ID:return this.LocalStringSort(a,r,t,n,s);case at.PRICE_ID:case at.VOL_ID:case at.UPDOWN_ID:case at.BUY_PRICE_ID:case at.SELL_PRICE_ID:case at.AMOUNT_ID:case at.BUY_VOL_ID:case at.SELL_VOL_ID:case at.YCLOSE_ID:case at.OPEN_ID:case at.HIGH_ID:case at.LOW_ID:case at.AVERAGE_PRICE_ID:case at.EXE_PRICE_ID:case at.POSITION_ID:case at.AMPLITUDE_ID:case at.INCREASE_ID:case at.RESERVE_NUMBER1_ID:case at.RESERVE_NUMBER2_ID:case at.RESERVE_NUMBER3_ID:case at.RESERVE_NUMBER4_ID:case at.RESERVE_NUMBER5_ID:case at.RESERVE_NUMBER6_ID:case at.RESERVE_NUMBER7_ID:case at.RESERVE_NUMBER8_ID:case at.RESERVE_NUMBER9_ID:case at.RESERVE_NUMBER10_ID:return this.LocalNumberSort(a,r,t,n,s);default:return 0}},this.LocalNumberSort=function(a,r,t,n,s){var o=this.GetExePriceData(a),l=this.GetExePriceData(r),h=-99999999999999,u=-99999999999999;n==2&&(h=u=99999999999999);var f=Hi.get(t.Type);if(s==0)o&&v.IsNumber(o.ExePrice)&&(h=o.ExePrice),l&&v.IsNumber(l.ExePrice)&&(u=l.ExePrice);else if(s==1){if(o&&o.LeftData){var C=o.LeftData[f];v.IsNumber(C)&&(h=C)}if(l&&l.LeftData){var C=l.LeftData[f];v.IsNumber(C)&&(u=C)}}else if(s==2){if(o&&o.RightData){var C=o.RightData[f];v.IsNumber(C)&&(h=C)}if(l&&l.RightData){var C=l.RightData[f];v.IsNumber(C)&&(u=C)}}return n==1?u<h?-1:u<h?1:0:h<u?-1:h>u?1:0},this.OnWheel=function(a){if(k.Chart.Log("[JSTReportChartContainer::OnWheel]",a),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)&&!(!this.Data||!v.IsNonEmptyArray(this.Data.Data))){var r=a.clientX-this.UIElement.getBoundingClientRect().left,t=a.clientY-this.UIElement.getBoundingClientRect().top,n=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),n=this.Canvas.isPointInPath(r,t),!!n){var s=this.GetTReportChart();if(s){var o=a.wheelDelta;if(v.IsObjectExist(a.wheelDelta)||(o=a.deltaY*-.01),o<0){this.LastMouseStatus.TooltipStatus=null,this.HideMinuteChartTooltip();var l=this.MoveSelectedRow(1,{EnablePageCycle:this.EnablePageCycle});l&&(l.Redraw&&this.Draw(),l.Update&&this.DelayUpdateStockData())}else if(o>0){this.LastMouseStatus.TooltipStatus=null,this.HideMinuteChartTooltip();var l=this.MoveSelectedRow(-1,{EnablePageCycle:this.EnablePageCycle});l&&(l.Redraw&&this.Draw(),l.Update&&this.DelayUpdateStockData())}a.preventDefault?a.preventDefault():a.returnValue=!1}}}},this.OnKeyDown=function(a){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var r=this.GetTReportChart();if(r){var t=a.keyCode?a.keyCode:a.which;if(t!=116){switch(this.HideMinuteChartTooltip(),t){case 38:var n=this.MoveSelectedRow(-1,{EnablePageCycle:this.EnablePageCycle});n&&(n.Redraw&&this.Draw(),n.Update&&this.DelayUpdateStockData());break;case 40:var n=this.MoveSelectedRow(1,{EnablePageCycle:this.EnablePageCycle});n&&(n.Redraw&&this.Draw(),n.Update&&this.DelayUpdateStockData());break}a.preventDefault?a.preventDefault():a.returnValue=!1}}}},this.MoveSelectedRowEvent=function(a,r){var t=this.ChartPaint[0];if(!t)return null;var n=this.GetEventCallback($.ON_MOVE_SELECTED_TREPORT_ROW);if(!(!n||!n.Callback)&&!(a&&r&&a.ExePrice==r.ExePrice&&a.CellType==r.CellType)){a&&(t.GetExePriceDataCallback&&(a.TData=t.GetExePriceDataCallback(a.ExePrice)),a.TData&&(a.CellType==1?a.Item=a.TData.LeftData:a.CellType==2&&(a.Item=a.TData.RightData))),r&&(t.GetExePriceDataCallback&&(r.TData=t.GetExePriceDataCallback(r.ExePrice)),r.TData&&(r.CellType==1?r.Item=r.TData.LeftData:r.CellType==2&&(r.Item=r.TData.RightData)));var s={Old:a,Now:r,Symbol:this.Symbol};n.Callback(n,s,this)}},this.MoveSelectedRow=function(a,r){var t=this.ChartPaint[0];if(!t||!v.IsNonEmptyArray(this.Data.Data))return null;var n=!1;r&&v.IsBool(r.EnablePageCycle)&&(n=r.EnablePageCycle);var s={Redraw:!1,Update:!1},o=t.GetCurrentPageStatus(),l=o.PageSize,h=o.Start,u=1;if(o.SelectedRow){u=o.SelectedRow.CellType;for(var f=0;f<this.Data.Data.length;++f)if(o.SelectedRow.ExePrice==this.Data.Data[f]){h=f;break}}var C=null,D=null;if(t.SelectedRow&&(C=At(t.SelectedRow)),a>0){if(h<0||h<o.Start||h>o.End)return t.SelectedRow={ExePrice:this.Data.Data[o.Start],CellType:u},s.Redraw=!0,D=At(t.SelectedRow),this.MoveSelectedRowEvent(C,D),s;for(var c=this.Data.YOffset,f=0;f<a&&!(h+1>=this.Data.Data.length&&!n);++f)++h,h>o.End&&++c,h>=this.Data.Data.length&&(h=0,c=0);return s.Redraw=!0,s.Update=c!=this.Data.YOffset,t.SelectedRow={ExePrice:this.Data.Data[h],CellType:u},this.Data.YOffset=c,D=At(t.SelectedRow),this.MoveSelectedRowEvent(C,D),s}else if(a<0){if(h<0||h<o.Start||h>o.End)return t.SelectedRow={ExePrice:this.Data.Data[o.End],CellType:u},s.Redraw=!0,D=At(t.SelectedRow),this.MoveSelectedRowEvent(C,D),s;a=Math.abs(a);for(var c=this.Data.YOffset,f=0;f<a&&!(h<=0&&!n);++f)--h,h<o.Start&&--c,h<0&&(h=this.Data.Data.length-1,c=this.Data.Data.length-l,c<0&&(c=0));return s.Redraw=!0,s.Update=c!=this.Data.YOffset,t.SelectedRow={ExePrice:this.Data.Data[h],CellType:u},this.Data.YOffset=c,D=At(t.SelectedRow),this.MoveSelectedRowEvent(C,D),s}return null},this.SetFlashBGItem=function(a,r){var t={ID:r.ID,Color:r.Color,Count:1};if(v.IsNumber(r.Count)&&(t.Count=r.Count),v.IsNumber(r.Time)?t.Time=r.Time:t.Time=Date.now(),this.FlashBG.has(a)){var n=this.FlashBG.get(a);n.LastTime=t.Time,n.Data.set(t.ID,t)}else{var n={LastTime:t.Time,Data:new Dt.default([[t.ID,t]])};this.FlashBG.set(a,n)}},this.GetFlashBGData=function(a,r){if(!this.FlashBG||!this.FlashBG.has(a))return null;var t=3*1e3,n=this.FlashBG.get(a);if(r-n.LastTime>=t)return this.FlashBG.delete(a),null;if(!n.Data||n.Data.size<=0)return this.FlashBG.delete(a),null;var s=[],o=!0,l=!1,h=void 0;try{for(var u=(0,ye.default)(n.Data),f;!(o=(f=u.next()).done);o=!0){var C=f.value,D=C[1];(r-D.Time>=t||D.Count<=0)&&s.push(D.ID)}}catch(T){l=!0,h=T}finally{try{!o&&u.return&&u.return()}finally{if(l)throw h}}if(v.IsNonEmptyArray(s)){for(var c=0;c<s.length;++c)n.Data.delete(s[c]);if(n.Data.size<=0)return this.FlashBG.delete(a),null}return n}}function Tg(){this.ChartBorder,this.Canvas,this.BorderLine=null,this.ClassName="JSTReportFrame",this.BorderColor=d.TReport.BorderColor,this.LogoTextColor=d.FrameLogo.TextColor,this.LogoTextFont=d.FrameLogo.Font,this.ReloadResource=function(e){this.BorderColor=d.TReport.BorderColor,this.LogoTextColor=d.FrameLogo.TextColor,this.LogoTextFont=d.FrameLogo.Font},this.Draw=function(){var e=L(this.ChartBorder.GetLeft()),a=L(this.ChartBorder.GetTop()),r=L(this.ChartBorder.GetRight()),t=L(this.ChartBorder.GetBottom()),n=r-e,s=t-a;v.IsNumber(this.BorderLine)?(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),(this.BorderLine&1)>0&&(this.Canvas.moveTo(e,a),this.Canvas.lineTo(r,a)),(this.BorderLine&2)>0&&(this.Canvas.moveTo(e,t),this.Canvas.lineTo(r,t)),(this.BorderLine&4)>0&&(this.Canvas.moveTo(e,a),this.Canvas.lineTo(e,t)),(this.BorderLine&8)>0&&(this.Canvas.moveTo(r,a),this.Canvas.lineTo(r,t)),this.Canvas.stroke()):(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(e,a,n,s))},this.DrawLogo=function(){var e=d.FrameLogo.Text;if(v.IsString(e)){this.Canvas.fillStyle=this.LogoTextColor,this.Canvas.font=this.LogoTextFont,this.Canvas.textAlign="right",this.Canvas.textBaseline="bottom";var a=this.ChartBorder.GetRight()-30,r=this.ChartBorder.GetBottom()-5;this.Canvas.fillText(e,a,r)}}}var at={SYMBOL_ID:0,NAME_ID:1,PRICE_ID:2,VOL_ID:3,INCREASE_ID:4,UPDOWN_ID:5,BUY_PRICE_ID:6,SELL_PRICE_ID:7,AMOUNT_ID:8,BUY_VOL_ID:9,SELL_VOL_ID:10,YCLOSE_ID:11,OPEN_ID:12,HIGH_ID:13,LOW_ID:14,AVERAGE_PRICE_ID:15,INDEX_ID:16,EXE_PRICE_ID:17,POSITION_ID:18,AMPLITUDE_ID:22,LIMIT_HIGH_ID:23,LIMIT_LOW_ID:24,VOL_IN_ID:25,VOL_OUT_ID:26,NAME_EX_ID:27,CLOSE_LINE_ID:28,KLINE_ID:29,EXE_PRICE_EX_ID:30,RESERVE_NUMBER1_ID:201,RESERVE_NUMBER2_ID:202,RESERVE_NUMBER3_ID:203,RESERVE_NUMBER4_ID:204,RESERVE_NUMBER5_ID:205,RESERVE_NUMBER6_ID:206,RESERVE_NUMBER7_ID:207,RESERVE_NUMBER8_ID:208,RESERVE_NUMBER9_ID:209,RESERVE_NUMBER10_ID:210,RESERVE_STRING1_ID:301,RESERVE_STRING2_ID:302,RESERVE_STRING3_ID:303,RESERVE_STRING4_ID:304,RESERVE_STRING5_ID:305,RESERVE_STRING6_ID:306,RESERVE_STRING7_ID:307,RESERVE_STRING8_ID:308,RESERVE_STRING9_ID:309,RESERVE_STRING10_ID:310},Hi=new Dt.default([[at.SYMBOL_ID,"Symbol"],[at.NAME_ID,"Name"],[at.PRICE_ID,"Price"],[at.INCREASE_ID,"Increase"],[at.UPDOWN_ID,"UpDown"],[at.VOL_ID,"Vol"],[at.BUY_PRICE_ID,"BuyPrice"],[at.SELL_PRICE_ID,"SellPrice"],[at.AMOUNT_ID,"Amount"],[at.BUY_VOL_ID,"BuyVol"],[at.SELL_VOL_ID,"SellVol"],[at.YCLOSE_ID,"YClose"],[at.OPEN_ID,"Open"],[at.HIGH_ID,"High"],[at.LOW_ID,"Low"],[at.AVERAGE_PRICE_ID,"AvPrice"],[at.POSITION_ID,"Position"],[at.AMPLITUDE_ID,"Amplitude"],[at.EXE_PRICE_EX_ID,"ExePrice"],[at.RESERVE_NUMBER1_ID,"ReserveNumber1"],[at.RESERVE_NUMBER2_ID,"ReserveNumber2"],[at.RESERVE_NUMBER3_ID,"ReserveNumber3"],[at.RESERVE_NUMBER4_ID,"ReserveNumber4"],[at.RESERVE_NUMBER5_ID,"ReserveNumber5"],[at.RESERVE_NUMBER6_ID,"ReserveNumber6"],[at.RESERVE_NUMBER7_ID,"ReserveNumber7"],[at.RESERVE_NUMBER8_ID,"ReserveNumber8"],[at.RESERVE_NUMBER9_ID,"ReserveNumber9"],[at.RESERVE_NUMBER10_ID,"ReserveNumber10"],[at.RESERVE_STRING1_ID,"ReserveString1"],[at.RESERVE_STRING2_ID,"ReserveString2"],[at.RESERVE_STRING3_ID,"ReserveString3"],[at.RESERVE_STRING4_ID,"ReserveString4"],[at.RESERVE_STRING5_ID,"ReserveString5"],[at.RESERVE_STRING6_ID,"ReserveString6"],[at.RESERVE_STRING7_ID,"ReserveString7"],[at.RESERVE_STRING8_ID,"ReserveString8"],[at.RESERVE_STRING9_ID,"ReserveString9"],[at.RESERVE_STRING10_ID,"ReserveString10"]]);function Sg(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ChartTReport",this.UIElement,this.IsDrawFirst=!1,this.GetEventCallback,this.GetExePriceDataCallback,this.GetFlashBGDataCallback,this.GetBlockDataCallback,this.Data,this.BorderData,this.FixedRowData,this.SortInfo,this.FixedColumn=2,this.FixedRowCount=0,this.IsShowHeader=!0,this.SizeChange=!0,this.SelectedRow,this.RectSelectedRow,this.IsDrawBorder=1,this.ShowSymbol=[],this.GlobalOption,this.DefaultDecimal=2,this.UpColor=d.TReport.UpTextColor,this.DownColor=d.TReport.DownTextColor,this.UnchangeColor=d.TReport.UnchangeTextColor,this.BorderColor=d.TReport.BorderColor,this.SelectedColor=d.TReport.SelectedColor,this.UpBGColor=d.TReport.UpBGColor,this.DownBGColor=d.TReport.DownBGColor,this.HeaderFontConfig={Size:d.TReport.Header.Font.Size,Name:d.TReport.Header.Font.Name},this.HeaderColor=d.TReport.Header.Color,this.SortColor=d.TReport.Header.SortColor,this.HeaderMergin={Left:d.TReport.Header.Mergin.Left,Right:d.TReport.Header.Mergin.Right,Top:d.TReport.Header.Mergin.Top,Bottom:d.TReport.Header.Mergin.Bottom},this.MarkBorderConfig={MaxPositionColor:d.TReport.MarkBorder.MaxPositionColor},this.ItemFontConfig={Size:d.TReport.Item.Font.Size,Name:d.TReport.Item.Font.Name},this.ItemFixedFontConfg={Size:d.TReport.FixedItem.Font.Size,Name:d.TReport.FixedItem.Font.Name},this.ItemMergin={Left:d.TReport.Item.Mergin.Left,Right:d.TReport.Item.Mergin.Right,Top:d.TReport.Item.Mergin.Top,Bottom:d.TReport.Item.Mergin.Bottom},this.CenterItemConfig={TextColor:d.TReport.CenterItem.TextColor,BaseTextColor:d.TReport.CenterItem.BaseTextColor,BGColor:d.TReport.CenterItem.BGColor},this.HeaderFont=12*B()+"px 微软雅黑",this.ItemFont=15*B()+"px 微软雅黑",this.ItemFixedFont=15*B()+"px 微软雅黑",this.ItemSymbolFont=12*B()+"px 微软雅黑",this.ItemNameFont=15*B()+"px 微软雅黑",this.ItemNameHeight=0,this.RowCount=0,this.HeaderHeight=0,this.RowHeight=0,this.IsShowAllColumn=!1,this.ItemExtraWidth=0,this.Column=[{Type:at.PRICE_ID,Title:"现价",TextAlign:"right",Width:null,MaxText:"-888.88"},{Type:at.INCREASE_ID,Title:"涨幅%",TextAlign:"right",Width:null,MaxText:"-888.88"},{Type:at.BUY_PRICE_ID,Title:"买价",TextAlign:"right",Width:null,MaxText:"-888.88"},{Type:at.BUY_VOL_ID,Title:"买量",TextAlign:"right",Width:null,MaxText:"88888",TextColor:d.TReport.FieldColor.Vol},{Type:at.NAME_ID,Title:"合约代码",TextAlign:"right",Width:null,TextColor:d.TReport.FieldColor.Name,MaxText:"AAAAAA-A-AAAA"}],this.CenterColumn={Type:at.EXE_PRICE_ID,Title:"购<行权价>沽",TextAlign:"center",Width:null,MaxText:"99999.99",Sort:1,SortType:[1,2]},this.RectClient={},this.TooltipRect=[],this.ReloadResource=function(e){},this.SetColumn=function(e){if(v.IsNonEmptyArray(e)){this.Column=[];for(var a=0;a<e.length;++a){var r=e[a],t=this.GetDefaultColunm(r.Type);t&&(r.Title&&(t.Title=r.Title),r.TextAlign&&(t.TextAlign=r.TextAlign),r.TextColor&&(t.TextColor=r.TextColor),r.MaxText&&(t.MaxText=r.MaxText),r.ID&&(t.ID=r.ID),v.IsNumber(r.Sort)&&(t.Sort=r.Sort),v.IsBool(r.EnableTooltip)&&(t.EnableTooltip=r.EnableTooltip),v.IsNumber(r.FixedWidth)&&(t.FixedWidth=r.FixedWidth),v.IsNumber(r.FloatPrecision)&&(t.FloatPrecision=r.FloatPrecision),v.IsNumber(r.ColorType)&&(t.ColorType=r.ColorType),r.DefaultText&&(t.DefaultText=r.DefaultText),v.IsBool(r.EnableChartTooltip)&&(t.EnableChartTooltip=r.EnableChartTooltip),r.Sort==1&&(t.SortType=[1,2],v.IsNonEmptyArray(r.SortType)&&(t.SortType=r.SortType.slice())),this.Column.push(t))}}},this.GetDefaultColunm=function(e){for(var a=[{Type:at.INDEX_ID,Title:"序号",TextAlign:"center",Width:null,TextColor:d.TReport.FieldColor.Index,MaxText:"8888"},{Type:at.SYMBOL_ID,Title:"代码",TextAlign:"right",Width:null,TextColor:d.TReport.FieldColor.Symbol,MaxText:"888888"},{Type:at.NAME_ID,Title:"合约名称",TextAlign:"right",Width:null,TextColor:d.TReport.FieldColor.Name,MaxText:"AAAAAA-A-AAAA"},{Type:at.INCREASE_ID,Title:"涨幅%",TextAlign:"right",Width:null,MaxText:"-888.88",Sort:1,SortType:[1,2,0]},{Type:at.PRICE_ID,Title:"现价",TextAlign:"right",Width:null,MaxText:"88888.88",Sort:1,SortType:[1,2,0]},{Type:at.UPDOWN_ID,Title:"涨跌",TextAlign:"right",Width:null,MaxText:"-888.88",Sort:1,SortType:[1,2,0]},{Type:at.AMPLITUDE_ID,Title:"振幅%",TextAlign:"right",Width:null,MaxText:"888.88",Sort:1,SortType:[1,2,0]},{Type:at.BUY_PRICE_ID,Title:"买价",TextAlign:"right",Width:null,MaxText:"88888.88",Sort:1,SortType:[1,2,0]},{Type:at.SELL_PRICE_ID,Title:"卖价",TextAlign:"right",Width:null,MaxText:"88888.88",Sort:1,SortType:[1,2,0]},{Type:at.AVERAGE_PRICE_ID,Title:"均价",TextAlign:"right",Width:null,MaxText:"88888.88",Sort:1,SortType:[1,2,0]},{Type:at.OPEN_ID,Title:"今开",TextAlign:"right",Width:null,MaxText:"88888.88",Sort:1,SortType:[1,2,0]},{Type:at.HIGH_ID,Title:"最高",TextAlign:"right",Width:null,MaxText:"88888.88",Sort:1,SortType:[1,2,0]},{Type:at.LOW_ID,Title:"最低",TextAlign:"right",Width:null,MaxText:"88888.88",Sort:1,SortType:[1,2,0]},{Type:at.YCLOSE_ID,Title:"昨收",TextAlign:"right",Width:null,MaxText:"88888.88",Sort:1,SortType:[1,2,0]},{Type:at.POSITION_ID,Title:"持仓量",TextAlign:"right",Width:null,MaxText:"88888",Sort:1,SortType:[1,2,0],TextColor:d.TReport.FieldColor.Position},{Type:at.VOL_ID,Title:"总量",TextAlign:"right",TextColor:d.TReport.FieldColor.Vol,Width:null,MaxText:"88888",Sort:1,SortType:[1,2,0]},{Type:at.AMOUNT_ID,Title:"总金额",TextAlign:"right",TextColor:d.TReport.FieldColor.Amount,Width:null,MaxText:"8888.8擎",Sort:1,SortType:[1,2,0]},{Type:at.BUY_VOL_ID,Title:"买量",TextAlign:"right",TextColor:d.TReport.FieldColor.Vol,Width:null,MaxText:"88888",Sort:1,SortType:[1,2,0]},{Type:at.SELL_VOL_ID,Title:"卖量",TextAlign:"right",TextColor:d.TReport.FieldColor.Vol,Width:null,MaxText:"88888",Sort:1,SortType:[1,2,0]},{Type:at.RESERVE_NUMBER1_ID,Title:"数值1",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:at.RESERVE_NUMBER2_ID,Title:"数值2",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:at.RESERVE_NUMBER3_ID,Title:"数值3",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:at.RESERVE_NUMBER4_ID,Title:"数值4",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:at.RESERVE_NUMBER5_ID,Title:"数值5",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:at.RESERVE_NUMBER6_ID,Title:"数值6",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:at.RESERVE_NUMBER7_ID,Title:"数值7",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:at.RESERVE_NUMBER8_ID,Title:"数值8",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:at.RESERVE_NUMBER9_ID,Title:"数值9",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:at.RESERVE_NUMBER10_ID,Title:"数值10",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"9999.99",FloatPrecision:2},{Type:at.RESERVE_STRING1_ID,Title:"文字1",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:at.RESERVE_STRING2_ID,Title:"文字2",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:at.RESERVE_STRING3_ID,Title:"文字3",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:at.RESERVE_STRING4_ID,Title:"文字4",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:at.RESERVE_STRING5_ID,Title:"文字5",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:at.RESERVE_STRING6_ID,Title:"文字6",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:at.RESERVE_STRING7_ID,Title:"文字7",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:at.RESERVE_STRING8_ID,Title:"文字8",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:at.RESERVE_STRING9_ID,Title:"文字9",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"擎擎擎擎擎擎"},{Type:at.RESERVE_STRING10_ID,Title:"文字10",TextAlign:"right",TextColor:d.TReport.FieldColor.Text,MaxText:"擎擎擎擎擎擎"}],r=0;r<a.length;++r){var t=a[r];if(t.Type==e)return t}return null},this.Draw=function(){this.ShowSymbol=[],this.TooltipRect=[],this.RectSelectedRow=null,this.GlobalOption&&(this.GlobalOption.FlashBGCount=0),this.SizeChange?this.CalculateSize():this.UpdateCacheData(),this.Canvas.save(),this.Canvas.beginPath(),this.Canvas.rect(this.RectClient.Left,this.RectClient.Top,this.RectClient.Right-this.RectClient.Left,this.RectClient.Bottom-this.RectClient.Top),this.Canvas.clip(),this.DrawHeader(),this.DrawBody(),this.Canvas.restore(),this.SizeChange=!1},this.UpdateCacheData=function(){this.RectClient.Left=this.ChartBorder.GetLeft(),this.RectClient.Right=this.ChartBorder.GetRight(),this.RectClient.Top=this.ChartBorder.GetTop(),this.RectClient.Bottom=this.ChartBorder.GetBottom()},this.CalculateSize=function(){this.UpdateCacheData();var e=B();this.HeaderFont=this.HeaderFontConfig.Size*e+"px "+this.HeaderFontConfig.Name,this.ItemFont=this.ItemFontConfig.Size*e+"px "+this.ItemFontConfig.Name,this.ItemFixedFont=this.ItemFixedFontConfg.Size*e+"px "+this.ItemFixedFontConfg.Name,this.RowHeight=this.GetFontHeight(this.ItemFont,"擎")+this.ItemMergin.Top+this.ItemMergin.Bottom,this.FixedRowHeight=this.GetFontHeight(this.ItemFixedFont,"擎")+this.ItemMergin.Top+this.ItemMergin.Bottom,this.Canvas.font=this.ItemFont;for(var a=0,r=0;r<this.Column.length;++r){var n=this.Column[r];v.IsNumber(n.FixedWidth)?a=n.FixedWidth:a=this.Canvas.measureText(n.MaxText).width,n.Width=a+4+this.ItemMergin.Left+this.ItemMergin.Right}var n=this.CenterColumn;v.IsNumber(n.FixedWidth)?a=n.FixedWidth:a=this.Canvas.measureText(n.MaxText).width,n.Width=a+4+this.ItemMergin.Left+this.ItemMergin.Right,this.Canvas.font=this.HeaderFont;for(var r=0;r<this.Column.length;++r){var n=this.Column[r];if(!(!n.Title||n.Title.length<=0)){var t=n.Title;n.Sort>0&&(t+="↓"),a=this.Canvas.measureText(t).width,a+=4+this.HeaderMergin.Left+this.HeaderMergin.Right,n.Width<a&&(n.Width=a)}}var n=this.CenterColumn;if(!n.Title||n.Title.length>0){var t=n.Title;n.Sort>0&&(t+="↓"),a=this.Canvas.measureText(t).width,a+=4+this.HeaderMergin.Left+this.HeaderMergin.Right,n.Width<a&&(n.Width=a)}this.HeaderHeight=this.GetFontHeight(this.HeaderFont,"擎")+this.HeaderMergin.Top+this.HeaderMergin.Bottom,this.IsShowHeader||(this.HeaderHeight=0),this.FixedRowCount<=0&&(this.FixedRowHeight=0),this.RowCount=parseInt((this.RectClient.Bottom-this.RectClient.Top-this.HeaderHeight-this.FixedRowHeight*this.FixedRowCount)/this.RowHeight);for(var s=this.CenterColumn.Width,o=this.RectClient.Right-this.RectClient.Left,r=0;r<this.Column.length;++r){var n=this.Column[r];s+=n.Width*2}s<o?(this.IsShowAllColumn=!0,this.ItemExtraWidth=0,o-s-4>0&&(this.ItemExtraWidth=(o-s-4)/(this.Column.length*2+1))):(this.IsShowAllColumn=!1,this.ItemExtraWidth=0)},this.DrawHeader=function(){if(this.IsShowHeader){this.RectClient.Left;var e=this.RectClient.Top,a=e+this.HeaderMergin.Top+(this.HeaderHeight-this.HeaderMergin.Top-this.HeaderMergin.Bottom)/2;(this.RectClient.Right-this.RectClient.Left)/2+this.RectClient.Left,this.Canvas.font=this.HeaderFont,this.Canvas.fillStyle=this.HeaderColor;var r=this.RectClient.Left;this.RectClient.Right;var t=this.CenterColumn,n=this.GetCenterItemRect();this.SortInfo&&this.SortInfo.Sort>0&&this.SortInfo.CellType==0?this.DrawSortHeader(t.Title,t.TextAlign,n.Left,a,n.TextWidth,this.SortInfo.Sort):this.DrawText(t.Title,t.TextAlign,n.Left,a,n.TextWidth);for(var s=n.Left,o=n.Right,l=this.Data.XOffset;l<this.Column.length;++l){var t=this.Column[l],h=t.Width+this.ItemExtraWidth,u=h-this.HeaderMergin.Left-this.HeaderMergin.Right,C=s-h+this.HeaderMergin.Left;if(s-h<r)break;var f=this.SortInfo&&this.SortInfo.Field==l&&this.SortInfo.Sort>0;f&&this.SortInfo.CellType==1?this.DrawSortHeader(t.Title,t.TextAlign,C,a,u,this.SortInfo.Sort):this.DrawText(t.Title,t.TextAlign,C,a,u),s-=h;var C=o+this.HeaderMergin.Left;f&&this.SortInfo.CellType==2?this.DrawSortHeader(t.Title,t.TextAlign,C,a,u,this.SortInfo.Sort):this.DrawText(t.Title,t.TextAlign,C,a,u),o+=h}}},this.DrawSortHeader=function(e,a,r,t,n,s){var o=s==1?"↓":"↑",l=this.Canvas.measureText(o).width,h=this.Canvas.measureText(e).width+2;this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",a=="center"?r=r+n/2-(l+h)/2:a=="right"&&(r=r+n-l-h),this.Canvas.fillText(e,r,t),this.Canvas.fillStyle=this.SortColor,this.Canvas.fillText(o,r+h,t),this.Canvas.fillStyle=this.HeaderColor},this.DrawText=function(e,a,r,t,n){a=="center"?(r=r+n/2,this.Canvas.textAlign="center"):a=="right"?(r=r+n,this.Canvas.textAlign="right"):this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(e,r,t)},this.GetFontHeight=function(e,a){return Ea(this.Canvas,e,a)},this.DrawBody=function(){if(this.Data&&v.IsNonEmptyArray(this.Data.Data)){this.Canvas.font=this.ItemFont;var e=this.RectClient.Top+this.HeaderHeight;this.RectClient.Left,this.RectClient.Right-this.RectClient.Left;var a=e;this.Canvas.font=this.ItemFixedFont;for(var r=0;r<this.FixedRowCount;++r)this.DrawFixedRow(a,r),a+=this.FixedRowHeight;a=e+this.FixedRowHeight*this.FixedRowCount,this.Canvas.font=this.ItemFont;for(var r=this.Data.YOffset,t=0;r<this.Data.Data.length&&t<this.RowCount;++r,++t){var n=this.Data.Data[r];this.DrawRow(n,a,r),this.ShowSymbol.push({Index:r,ExePrice:n}),a+=this.RowHeight}if(this.RectSelectedRow){this.Canvas.fillStyle=this.SelectedColor;var s=2;this.Canvas.fillRect(this.RectSelectedRow.Left,this.RectSelectedRow.Bottom-s,this.RectSelectedRow.Right-this.RectSelectedRow.Left,s)}}},this.GetCenterItemRect=function(){var e=(this.RectClient.Right-this.RectClient.Left)/2+this.RectClient.Left,a=this.CenterColumn,r=a.Width+this.ItemExtraWidth,t=e-r/2,n=e+r/2,s=r-this.HeaderMergin.Left-this.HeaderMergin.Right;return{Left:t,Right:n,TextWidth:s,Width:r}},this.DrawFixedRow=function(e,a){if(!(!this.FixedRowData||!v.IsNonEmptyArray(this.FixedRowData.Data))){var r=this.GetCenterItemRect(),t=r.Left,n=r.Right,s=this.RectClient.Left;this.RectClient.Right;for(var o=this.Data.XOffset;o<this.Column.length;++o){var l=this.Column[o],h=l.Width+this.ItemExtraWidth;if(t-=h,t<s)break;var u=this.FixedRowData.Data[a];if(!(!u||!u.TData)){var f=null,C=null;u.TData&&u.TData.LeftData&&(f=u.TData.LeftData),u.TData&&u.TData.RightData&&(C=u.TData.RightData);var D={Left:t,Right:t+h,Top:e,Height:this.FixedRowHeight,Width:h};D.Bottom=D.Top+D.Height,this.DrawFixedItem(a,o,u,f,l,D,1),D={Left:n,Right:n+h,Top:e,Height:this.RowHeight,Width:h},D.Bottom=D.Top+D.Height,this.DrawFixedItem(a,o,u,C,l,D,2),n+=h}}}},this.DrawFixedItem=function(e,a,r,t,n,s,o){if(v.IsNonEmptyArray(t)){var l={Left:s.Left+this.ItemMergin.Left,Right:s.Right-this.ItemMergin.Right,Top:s.Top+this.ItemMergin.Top,Bottom:s.Bottom-this.ItemMergin.Bottom};l.Width=l.Right-l.Left,l.Height=l.Bottom-l.Top;var h=t[a];if(h){var u={Text:null,TextColor:n.TextColor,TextAlign:n.TextAlign,Rect:s,RectText:l};u.Text=h.Text,h.Color&&(u.TextColor=h.Color),h.TextAlign&&(u.TextAlign=h.TextAlign),this.DrawCell(u)}}},this.DrawRow=function(e,a,r){var t=this.GetCenterItemRect(),n=t.Left,s=t.Right,o=this.RectClient.Left,l=this.RectClient.Right,h={ExePrice:e,TData:null,Decimal:this.DefaultDecimal};if(this.GetExePriceDataCallback&&(h.TData=this.GetExePriceDataCallback(e)),this.GetFlashBGDataCallback&&h.TData){if(h.TData.LeftData){var u=h.TData.LeftData;h.TData.LeftFlashBG=this.GetFlashBGDataCallback(u.Symbol,Date.now()),u.Symbol&&(h.Decimal=Ui.GetfloatPrecision(u.Symbol))}if(h.TData.RightData){var u=h.TData.RightData;h.TData.RightFlashBG=this.GetFlashBGDataCallback(u.Symbol,Date.now()),u.Symbol&&(h.Decimal=Ui.GetfloatPrecision(u.Symbol))}}var f=!1;this.SelectedRow&&this.SelectedRow.ExePrice==e&&(f=!0);var C={Left:n,Right:s,Top:a,Height:this.RowHeight};if(C.Bottom=C.Top+C.Height,C.Width=C.Right-C.Left,this.DrawCenterItem(r,h,this.CenterColumn,C,0),f&&this.SelectedRow.CellType==0&&(this.RectSelectedRow=C),v.IsNumber(this.Data.Price)){var D=null,c=null;if(e>this.Data.Price?(D=this.UpBGColor,c=this.DownBGColor):(D=this.DownBGColor,c=this.UpBGColor),D){var T={Left:o+1,Right:t.Left,Top:a,Height:this.RowHeight};T.Bottom=T.Top+T.Height,T.Width=T.Right-T.Left,this.Canvas.fillStyle=D,this.Canvas.fillRect(T.Left,T.Top,T.Width,T.Height)}if(c){var T={Left:t.Right,Right:l,Top:a,Height:this.RowHeight};T.Bottom=T.Top+T.Height,T.Width=T.Right-T.Left,this.Canvas.fillStyle=c,this.Canvas.fillRect(T.Left,T.Top,T.Width,T.Height)}}for(var S=this.Data.XOffset;S<this.Column.length;++S){var u=this.Column[S],I=u.Width+this.ItemExtraWidth;if(n-=I,n<o)break;var g=null,E=null;h.TData&&(g=h.TData.LeftData),h.TData&&(E=h.TData.RightData),C={Left:n,Right:n+I,Top:a,Height:this.RowHeight,Width:I},C.Bottom=C.Top+C.Height,this.DrawItem(r,h,g,u,C,1),f&&this.SelectedRow.CellType==1&&(this.RectSelectedRow?this.RectSelectedRow.Left=C.Left:this.RectSelectedRow=C),C={Left:s,Right:s+I,Top:a,Height:this.RowHeight,Width:I},C.Bottom=C.Top+C.Height,this.DrawItem(r,h,E,u,C,2),s+=I,f&&this.SelectedRow.CellType==2&&(this.RectSelectedRow?this.RectSelectedRow.Right=C.Right:this.RectSelectedRow=C)}},this.FormatCenterItem=function(e,a){if(!(!e||!e.TData)){var r=this.GetExePriceExtendData(e.TData.LeftData),t=this.GetExePriceExtendData(e.TData.RightData);r&&(r.BGColor&&(a.BGColor=r.BGColor),r.TitleColor&&(a.TextColor=r.TitleColor),r.Text&&r.TextColor?a.Left={Text:r.Text,TextColor:r.TextColor}:r.IconFont&&r.TextColor&&(a.Left={IconFont:r.IconFont,TextColor:r.TextColor})),t&&(t.BGColor&&(a.BGColor=t.BGColor),t.TitleColor&&(a.TextColor=t.TitleColor),t.Text&&t.TextColor?a.Right={Text:t.Text,TextColor:t.TextColor}:t.IconFont&&t.TextColor&&(a.Right={IconFont:t.IconFont,TextColor:t.TextColor}))}},this.GetExePriceExtendData=function(e){if(!e)return null;var a=Hi.get(at.EXE_PRICE_EX_ID);if(!a)return null;var r=e[a];return r},this.DrawCenterItem=function(e,a,r,t,n){r.EnableTooltip===!0&&this.TooltipRect.push({Rect:t,Data:a,Index:e,Column:r,CellType:n,Type:1});var s={Left:t.Left+this.ItemMergin.Left,Right:t.Right-this.ItemMergin.Right,Top:t.Top+this.ItemMergin.Top,Bottom:t.Bottom-this.ItemMergin.Bottom};s.Width=s.Right-s.Left,s.Height=s.Bottom-s.Top;var o={Text:null,TextColor:this.CenterItemConfig.TextColor,BGColor:this.CenterItemConfig.BGColor,TextAlign:r.TextAlign,Rect:t,RectText:s};o.Text=""+a.ExePrice.toFixed(a.Decimal),this.FormatCenterItem(a,o),this.DrawCell(o)},this.DrawItem=function(e,a,r,t,n,s){t.EnableTooltip===!0&&this.TooltipRect.push({Rect:n,Data:r,Index:e,Column:t,CellType:s,Type:1});var o={Left:n.Left+this.ItemMergin.Left,Right:n.Right-this.ItemMergin.Right,Top:n.Top+this.ItemMergin.Top,Bottom:n.Bottom-this.ItemMergin.Bottom};o.Width=o.Right-o.Left,o.Height=o.Bottom-o.Top;var l={Text:null,TextColor:t.TextColor,TextAlign:t.TextAlign,Rect:n,RectText:o};if(r){switch(t.Type){case at.SYMBOL_ID:case at.NAME_ID:var h=Hi.get(t.Type);h&&(l.Text=r[h]);break;case at.PRICE_ID:case at.BUY_PRICE_ID:case at.SELL_PRICE_ID:var h=Hi.get(t.Type);h&&this.GetPriceDrawInfo(r[h],r,a,l);break;case at.SELL_VOL_ID:case at.BUY_VOL_ID:case at.POSITION_ID:case at.VOL_ID:case at.AMOUNT_ID:var h=Hi.get(t.Type);h&&(l.Text=this.FormatVolString(r[h]));break;case at.INCREASE_ID:case at.UPDOWN_ID:case at.AMPLITUDE_ID:var h=Hi.get(t.Type);if(h){var u=r[h];v.IsNumber(u)?(l.Text=u.toFixed(2),l.TextColor=this.GetUpDownColor(u,0)):this.GetNullDrawInfo(l)}break;case at.RESERVE_NUMBER1_ID:case at.RESERVE_NUMBER2_ID:case at.RESERVE_NUMBER3_ID:case at.RESERVE_NUMBER4_ID:case at.RESERVE_NUMBER5_ID:case at.RESERVE_NUMBER6_ID:case at.RESERVE_NUMBER7_ID:case at.RESERVE_NUMBER8_ID:case at.RESERVE_NUMBER9_ID:case at.RESERVE_NUMBER10_ID:this.FormatReserveNumber(t,r,l);break;case at.RESERVE_STRING1_ID:case at.RESERVE_STRING2_ID:case at.RESERVE_STRING3_ID:case at.RESERVE_STRING4_ID:case at.RESERVE_STRING5_ID:case at.RESERVE_STRING6_ID:case at.RESERVE_STRING7_ID:case at.RESERVE_STRING8_ID:case at.RESERVE_STRING9_ID:case at.RESERVE_STRING10_ID:this.FormatReserveString(t,r,l);break;default:l.Text="-----"}this.GetMarkBorderData(l,a.ExePrice,t.Type,s),this.GetFlashBGData(l,a,t.Type,s)}if(this.DrawCell(l,a,t.Type,s),t.EnableChartTooltip){var f={Rect:n,Data:r,Index:e,Column:t,CellType:s,Type:20};this.TooltipRect.push(f)}},this.FormatReserveNumber=function(e,a,r){e.DefaultText&&(r.Text=e.DefaultText);var t=Hi.get(e.Type);if(!(!a||!t)){var n=a[t];v.IsNumber(n)&&(v.IsNumber(e.ColorType)&&(e.ColorType==1?r.TextColor=this.GetUpDownColor(n,0):e.ColorType==2&&(r.TextColor=this.GetUpDownColorV2(n,0))),r.Text=n.toFixed(e.FloatPrecision))}},this.FormatReserveString=function(e,a,r){e.DefaultText&&(r.Text=e.DefaultText);var t=Hi.get(e.Type);if(!(!a||!t)){var n=a[t];v.IsObject(n)?(n.Text&&(r.Text=n.Text),n.TextColor&&(r.TextColor=n.TextColor),n.BGColor&&(r.BGColor=n.BGColor)):v.IsString(n)&&(r.Text=n)}},this.GetFlashBGData=function(e,a,r,t){if(a.TData){var n=null;if(t==1?n=a.TData.LeftFlashBG:t==2&&(n=a.TData.RightFlashBG),!(!n||!n.Data)&&n.Data.has(r)){var s=n.Data.get(r);e.FlashBGColor=s.Color,--s.Count,this.GlobalOption&&++this.GlobalOption.FlashBGCount}}},this.GetMarkBorderData=function(e,a,r,t){if(!(!this.BorderData||!this.BorderData.MapData)&&this.BorderData.MapData.has(r)){var n=this.BorderData.MapData.get(r);if(v.IsNonEmptyArray(n.Data)){if(t==1){var s=n.Data[1];if(!s)return;s.ExePrice==a&&(e.BorderColor=this.MarkBorderConfig.MaxPositionColor)}else if(t==2){var o=n.Data[2];if(!o)return;o.ExePrice==a&&(e.BorderColor=this.MarkBorderConfig.MaxPositionColor)}}}},this.GetNullDrawInfo=function(e){e.Text="--",e.TextColor=this.UnchangeColor},this.GetPriceDrawInfo=function(e,a,r,t){if(!v.IsNumber(e)){this.GetNullDrawInfo(t);return}t.Text=e.toFixed(r.Decimal),v.IsNumber(a.YClose)?t.TextColor=this.GetUpDownColor(e,a.YClose):t.TextColor=this.UnchangeColor},this.FormatVolString=function(e,a){return v.IsNumber(e)?v.FormatVolString(e,a):null},this.GetUpDownColor=function(e,a){return e>a?this.UpColor:e<a?this.DownColor:this.UnchangeColor},this.GetUpDownColorV2=function(e,a){return e>=a?this.UpColor:this.DownColor},this.DrawCell=function(e){var a=e.RectText,r=a.Top+a.Height/2,t=null;if(e.BGColor){var n=e.Rect;this.Canvas.fillStyle=e.BGColor,this.Canvas.fillRect(n.Left,n.Top,n.Width,n.Height)}if(e.FlashBGColor){var n=e.Rect;this.Canvas.fillStyle=e.FlashBGColor,this.Canvas.fillRect(n.Left,n.Top,n.Width,n.Height)}if(e.BorderColor){var n=e.Rect;this.Canvas.strokeStyle=e.BorderColor,this.Canvas.strokeRect(L(n.Left),L(n.Top+1),b(n.Width),b(n.Height-3))}if(e.Text&&(e.TextColor&&(this.Canvas.fillStyle=e.TextColor),this.DrawText(e.Text,e.TextAlign,a.Left,r,a.Width)),e.Left){var s=e.Left;this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=s.TextColor,s.IconFont?(t||(t=this.Canvas.font),this.Canvas.font=s.IconFont.Font,this.Canvas.fillText(s.IconFont.Symbol,a.Left,r)):s.Text&&this.Canvas.fillText(s.Text,a.Left,r)}if(e.Right){var s=e.Right;this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=s.TextColor,s.IconFont?(t||(t=this.Canvas.font),this.Canvas.font=s.IconFont.Font,this.Canvas.fillText(s.IconFont.Symbol,a.Right,r)):s.Text&&this.Canvas.fillText(s.Text,a.Right,r)}t&&(this.Canvas.font=t)},this.GetTooltipData=function(e,a){if(!v.IsNonEmptyArray(this.TooltipRect))return null;for(var r=0;r<this.TooltipRect.length;++r){var t=this.TooltipRect[r],n=t.Rect;if(n&&e>=n.Left&&e<=n.Right&&a>=n.Top&&a<=n.Bottom)return{Rect:t.Rect,Data:t.Data,Column:t.Column,Index:t.Index,Type:t.Type,CellType:t.CellType}}return null},this.OnMouseDown=function(e,a,r){if(!this.Data)return null;var t=B(),n={X:e/t,Y:a/t};if(this.UIElement)var s={Left:this.UIElement.getBoundingClientRect().left,Top:this.UIElement.getBoundingClientRect().top};else var s={Left:null,Top:null};var o=this.PtInBody(e,a);if(o){var l=!1;this.SelectedRow?(this.SelectedRow.ExePrice!=o.ExePrice||this.SelectedRow.CellType!=o.CellType)&&(this.SelectedRow.ExePrice=o.ExePrice,this.SelectedRow.CellType=o.CellType,l=!0):(this.SelectedRow={ExePrice:o.ExePrice,CellType:o.CellType},l=!0);var h=$.ON_CLICK_TREPORT_ROW;return r.button==2&&(h=$.ON_RCLICK_TREPORT_ROW),this.SendClickEvent(h,{Data:o,X:e,Y:a,e:r,Inside:n,UIElement:s}),{Type:2,Redraw:l,Row:o}}var u=this.PtInHeader(e,a);if(u){var h=$.ON_CLICK_TREPORT_HEADER;return r.button==2?h=$.ON_RCLICK_TREPORT_HEADER:r.button==0&&(h=$.ON_CLICK_TREPORT_HEADER),this.SendClickEvent(h,{Data:u,X:e,Y:a,e:r,Inside:n,UIElement:s}),{Type:3,Redraw:l,Header:u}}return null},this.PtInBody=function(e,a){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return null;for(var r=this.RectClient.Top+this.HeaderHeight,t=this.RectClient.Left,n=this.RectClient.Right,s=r+this.FixedRowHeight*this.FixedRowCount,o=this.Data.YOffset,l=0;o<this.Data.Data.length&&l<this.RowCount;++o,++l){var h=this.Data.Data[o],u={Left:t,Top:s,Right:n,Bottom:s+this.RowHeight};if(u.Height=u.Bottom-u.Top,u.Width=u.Right-u.Left,e>=u.Left&&e<=u.Right&&a>=u.Top&&a<=u.Bottom){var f={RectRow:u,DataIndex:o,Index:l,ExePrice:h};return this.PtInItem(e,a,f)}s+=this.RowHeight}return null},this.PtInItem=function(e,a,r,t){var n=this.GetCenterItemRect(),s=r.RectRow,o={Left:n.Left,Right:n.Right,Top:s.Top,Height:s.Height,Bottom:s.Bottom};if(e>=o.Left&&e<=o.Right&&a>=o.Top&&a<=o.Bottom){var l={Rect:o,DataIndex:r.DataIndex,Index:r.Index,ExePrice:r.ExePrice,CellType:0,Column:this.CenterColumn};return l.Item=this.GetExePriceDataCallback(r.ExePrice),l}var h=n.Left,u=n.Right,f=this.RectClient.Left;this.RectClient.Right;for(var C=this.Data.XOffset;C<this.Column.length;++C){var D=this.Column[C],c=D.Width+this.ItemExtraWidth;if(h-=c,h<f)break;var T={Left:h,Right:h+c,Top:s.Top,Height:s.Height,Bottom:s.Bottom,Width:c};if(e>=T.Left&&e<=T.Right&&a>=T.Top&&a<=T.Bottom){var l={Rect:o,DataIndex:r.DataIndex,Index:r.Index,ExePrice:r.ExePrice,CellType:1,ColumnIndex:C,Column:D};return l.Item=this.GetExePriceDataCallback(r.ExePrice),l}if(T={Left:u,Right:u+c,Top:s.Top,Height:s.Height,Bottom:s.Bottom,Width:c},e>=T.Left&&e<=T.Right&&a>=T.Top&&a<=T.Bottom){var l={Rect:o,DataIndex:r.DataIndex,Index:r.Index,ExePrice:r.ExePrice,CellType:2,ColumnIndex:C,Column:D};return l.Item=this.GetExePriceDataCallback(r.ExePrice),l}u+=c}return null},this.PtInHeader=function(e,a){if(!this.IsShowHeader)return null;var r=this.RectClient.Left,t=this.RectClient.Right,n=this.RectClient.Top,s=n+this.HeaderHeight;if(!(e>=r&&e<=t&&a>=n&&a<=s))return null;var o={Left:r,Right:t,Top:n,Bottom:s};o.Width=o.Right-o.Left,o.Height=o.Bottom-o.Top;var l={RectRow:o,DataIndex:-1,Index:-1,ExePrice:null};return this.PtInItem(e,a,l)},this.SendClickEvent=function(e,a){var r=this.GetEventCallback(e);r&&r.Callback&&r.Callback(r,a,this)},this.GetCurrentPageStatus=function(){var e={Start:this.Data.YOffset,PageSize:this.RowCount,IsEnd:!1,SelectedRow:this.SelectedRow,IsSinglePage:!1,DataCount:0};return v.IsNonEmptyArray(this.Data.Data)?(e.End=this.Data.YOffset+this.RowCount-1,e.IsSinglePage=this.Data.Data.length<=this.RowCount,e.DataCount=this.Data.Data.length,e.End>=this.Data.Data.length-1&&(e.IsEnd=!0),e.End>=this.Data.Data.length&&(e.End=this.Data.Data.length-1)):(e.Start=0,e.End=0,e.IsEnd=!0,e.IsSinglePage=!0),e},this.OnDblClick=function(e,a,r){if(!this.Data)return!1;var t=this.PtInBody(e,a);return t?(this.SendClickEvent($.ON_DBCLICK_TREPORT_ROW,{Data:t,X:e,Y:a}),!0):!1}}function Ts(e){this.DivElement=e,this.JSChartContainer,this.ResizeListener,this.CanvasElement=document.createElement("canvas"),this.CanvasElement.className="jskeyboard-drawing",this.CanvasElement.id=Re(),this.CanvasElement.setAttribute("tabindex",0),this.CanvasElement.style&&(this.CanvasElement.style.outline="none"),e.hasChildNodes()&&k.Chart.Log("[JSKeyboardChart::JSRepoJSKeyboardChartrtChart] divElement hasChildNodes",e.childNodes),e.appendChild(this.CanvasElement),this.OnSize=function(){var a=this.DivElement.offsetHeight,r=this.DivElement.offsetWidth;this.DivElement.style.height&&this.DivElement.style.width&&(this.DivElement.style.height.includes("px")&&(a=parseInt(this.DivElement.style.height.replace("px",""))),this.DivElement.style.width.includes("px")&&(r=parseInt(this.DivElement.style.width.replace("px","")))),this.CanvasElement.height=a,this.CanvasElement.width=r,this.CanvasElement.style.width=this.CanvasElement.width+"px",this.CanvasElement.style.height=this.CanvasElement.height+"px";var t=B();this.CanvasElement.height*=t,this.CanvasElement.width*=t,k.Chart.Log("[JSKeyboardChart::OnSize] devicePixelRatio="+window.devicePixelRatio+", height="+this.CanvasElement.height+", width="+this.CanvasElement.width),this.JSChartContainer&&this.JSChartContainer.OnSize&&this.JSChartContainer.OnSize()},this.SetOption=function(a){var r=this.CreateJSKeyboardChartContainer(a);if(!r)return!1;if(a.OnCreatedCallback&&a.OnCreatedCallback(r),this.JSChartContainer=r,this.DivElement.JSChart=this,a.EventCallback)for(var t=0;t<a.EventCallback.length;++t){var n=a.EventCallback[t];r.AddEventCallback(n)}a.EnableResize==!0&&this.CreateResizeListener(),r.Draw()},this.CreateJSKeyboardChartContainer=function(a){var r=new dg(this.CanvasElement);if(r.Create(a),a.NetworkFilter&&(r.NetworkFilter=a.NetworkFilter),v.IsNonEmptyArray(a.Column)&&r.SetColumn(a.Column),v.IsNumber(a.BorderLine)&&(r.Frame.BorderLine=a.BorderLine),this.SetChartBorder(r,a),a.EventCallback)for(var t=0;t<a.EventCallback.length;++t){var n=a.EventCallback[t];r.AddEventCallback(n)}return r},this.SetChartBorder=function(a,r){if(r.Border){r.Border,v.IsNumber(r.Border.Left)&&(a.Frame.ChartBorder.Left=r.Border.Left),v.IsNumber(r.Border.Right)&&(a.Frame.ChartBorder.Right=r.Border.Right),v.IsNumber(r.Border.Top)&&(a.Frame.ChartBorder.Top=r.Border.Top),v.IsNumber(r.Border.Bottom)&&(a.Frame.ChartBorder.Bottom=r.Border.Bottom);var t=B();a.Frame.ChartBorder.Left*=t,a.Frame.ChartBorder.Right*=t,a.Frame.ChartBorder.Top*=t,a.Frame.ChartBorder.Bottom*=t}},this.CreateResizeListener=function(){var a=this;this.ResizeListener=new ResizeObserver(function(r){a.OnDivResize(r)}),this.ResizeListener.observe(this.DivElement)},this.OnDivResize=function(a){k.Chart.Log("[JSKeyboardChart::OnDivResize] entries=",a),this.OnSize()},this.SetColumn=function(a,r){this.JSChartContainer&&this.JSChartContainer.SetColumn(a,r)},this.AddEventCallback=function(a){this.JSChartContainer&&typeof this.JSChartContainer.AddEventCallback=="function"&&(k.Chart.Log("[JSKeyboardChart:AddEventCallback] obj=",a),this.JSChartContainer.AddEventCallback(a))},this.ReloadResource=function(a){this.JSChartContainer&&typeof this.JSChartContainer.ReloadResource=="function"&&(k.Chart.Log("[JSKeyboardChart:ReloadResource] "),this.JSChartContainer.ReloadResource(a))},this.ChartDestory=function(){this.JSChartContainer&&typeof this.JSChartContainer.ChartDestory=="function"&&this.JSChartContainer.ChartDestory()},this.Draw=function(){this.JSChartContainer&&typeof this.JSChartContainer.Draw=="function"&&(k.Chart.Log("[JSKeyboardChart:Draw] "),this.JSChartContainer.Draw())},this.SetSymbolData=function(a){this.JSChartContainer&&typeof this.JSChartContainer.Draw=="function"&&(k.Chart.Log("[JSKeyboardChart:SetSymbolData] ",a),this.JSChartContainer.SetSymbolData(a))},this.Search=function(a){this.JSChartContainer&&typeof this.JSChartContainer.Search=="function"&&(k.Chart.Log("[JSKeyboardChart:Search] ",a),this.JSChartContainer.Search(a))},this.OnKeyDown=function(a){this.JSChartContainer&&typeof this.JSChartContainer.OnKeyDown=="function"&&(k.Chart.Log("[JSKeyboardChart:OnKeyDown] ",a),this.JSChartContainer.OnKeyDown(a))},this.ClearSearch=function(a){this.JSChartContainer&&typeof this.JSChartContainer.ClearSearch=="function"&&(k.Chart.Log("[JSKeyboardChart:ClearSearch] ",a),this.JSChartContainer.ClearSearch(a))}}Ts.Init=function(e){var a=new Ts(e);return a.OnSize(),a};Ts.SetStyle=function(e){e&&d.SetStyle(e)};function dg(e){this.ClassName="JSKeyboardChartContainer",this.Frame,this.ChartPaint=[],this.Canvas=e.getContext("2d"),this.ShowCanvas=null,this.NetworkFilter,this.Data={XOffset:0,YOffset:0,Data:[]},this.MapSymbol=new Dt.default,this.SourceData={Data:[]},this.FunctionKeyData=[],this.mapEvent=new Dt.default,this.UIElement=e,this.LastPoint=new ft,this.DragYScroll=null,this.IsDestroy=!1,this.ChartDestory=function(){this.IsDestroy=!0},this.ClearSearch=function(a){this.Data.Data=[],this.Data.XOffset=0,this.Data.YOffset=0,a&&a.Redraw==!0&&this.Draw()},this.SearchFunctionKeyData=function(a){if(a.length<=0||!v.IsNonEmptyArray(this.FunctionKeyData))return null;for(var r=[],t=0;t<this.FunctionKeyData.length;++t){var n=this.FunctionKeyData[t];if(n&&v.IsNonEmptyArray(n.Data)){for(var s=[],o=[],l=[],h=0;h<n.Data.length;++h){var u=n.Data[h];this.SearchSymbol(u,a,s,o,l)}v.IsNonEmptyArray(l)&&r.push.apply(r,l),v.IsNonEmptyArray(s)&&r.push.apply(r,s),v.IsNonEmptyArray(o)&&r.push.apply(r,o)}}return r.length>0?r:null},this.Search=function(a){var r,t,n,s,o=[],l=[],h=[],u=null;this.MapSymbol.clear(),this.Data.Data=[],this.Data.XOffset=0,this.Data.YOffset=0;var f=a.trim();if(f.length>0){u=this.SearchFunctionKeyData(f);for(var C=0;C<this.SourceData.Data.length;++C){var D=this.SourceData.Data[C];this.SearchSymbol(D,f,o,l,h)||this.SearchSpell(D,f,o,l)}}v.IsNonEmptyArray(u)&&(r=this.Data.Data).push.apply(r,(0,rd.default)(u)),v.IsNonEmptyArray(h)&&(t=this.Data.Data).push.apply(t,h),v.IsNonEmptyArray(o)&&(n=this.Data.Data).push.apply(n,o),v.IsNonEmptyArray(l)&&(s=this.Data.Data).push.apply(s,l),this.ChartPaint[0].SelectedRow=0,this.ChartPaint[0].SizeChange=!0,k.Chart.Log("[JSKeyboardChart:Search] search="+f+", source="+this.SourceData.Data.length+" match="+this.Data.Data.length),this.Draw()},this.SearchSymbol=function(a,r,t,n,s){var o=a.Symbol.indexOf(r);return o<0?!1:(a.Symbol==r?s.push(a.Symbol):o==0?t.push(a.Symbol):n.push(a.Symbol),this.MapSymbol.set(a.Symbol,a),!0)},this.SearchSpell=function(a,r,t,n){if(!v.IsString(a.Spell))return!1;var s=a.Spell.indexOf(r);return s!=0?!1:(t.push(a.Symbol),this.MapSymbol.set(a.Symbol,a),!0)},this.SetSymbolData=function(a){this.SourceData.Data=[];for(var r=0;r<a.length;++r){var t=a[r];v.IsNumber(t.Priority)?(this.FunctionKeyData[t.Priority]||(this.FunctionKeyData[t.Priority]={Priority:t.Priority,Data:[]}),this.FunctionKeyData[t.Priority].Data.push(t)):this.SourceData.Data.push(t)}},this.Create=function(a){var r=this;this.UIElement.JSChartContainer=this,this.Frame=new Ig,this.Frame.ChartBorder=new ra,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas;var t=new mg;t.Frame=this.Frame,t.ChartBorder=this.Frame.ChartBorder,t.Canvas=this.Canvas,t.UIElement=this.UIElement,t.GetEventCallback=function(o){return r.GetEventCallback(o)},t.GetStockDataCallback=function(o){return r.GetStockData(o)},t.Data=this.Data,this.ChartPaint[0]=t,t.VScrollbar=new gg,t.VScrollbar.Frame=this.Frame,t.VScrollbar.Canvas=this.Canvas,t.VScrollbar.ChartBorder=this.Frame.ChartBorder,t.VScrollbar.Report=t;var n=!0,s=!0;a&&(a.KeyDown===!1&&(n=!1,k.Chart.Log("[JSKeyboardChartContainer::Create] not register keydown event.")),a.Wheel===!1&&(s=!1,k.Chart.Log("[JSKeyboardChartContainer::Create] not register wheel event."))),n&&this.UIElement.addEventListener("keydown",function(o){r.OnKeyDown(o)},!0),s&&this.UIElement.addEventListener("wheel",function(o){r.OnWheel(o)},!0),this.UIElement.ondblclick=function(o){r.UIOnDblClick(o)},this.UIElement.onmousedown=function(o){r.UIOnMouseDown(o)},this.UIElement.oncontextmenu=function(o){r.UIOnContextMenu(o)},this.UIElement.onmousemove=function(o){r.UIOnMouseMove(o)},this.UIElement.onmouseout=function(o){r.UIOnMounseOut(o)},this.UIElement.onmouseleave=function(o){r.UIOnMouseleave(o)}},this.Draw=function(){if(!(this.UIElement.width<=0||this.UIElement.height<=0)){this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height);var a=B();this.Canvas.lineWidth=a,this.Frame.Draw(),this.Frame.DrawLogo();for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.IsDrawFirst&&t.Draw()}for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.IsDrawFirst||t.Draw()}}},this.GetStockData=function(a){return this.MapSymbol.has(a)?this.MapSymbol.get(a):null},this.ResetStatus=function(){this.Data.XOffset=0,this.Data.YOffset=0},this.ResetSelectStatus=function(){var a=this.GetReportChart();a&&(a.SelectedRow=-1,a.SelectedFixedRow=-1)},this.AddEventCallback=function(a){if(!(!a||!a.event||!a.callback)){var r={Callback:a.callback,Source:a};this.mapEvent.set(a.event,r)}},this.RemoveEventCallback=function(a){this.mapEvent.has(a)&&this.mapEvent.delete(a)},this.GetEventCallback=function(a){if(!this.mapEvent.has(a))return null;var r=this.mapEvent.get(a);return r},this.OnSize=function(){this.Frame&&(this.SetSizeChange(!0),this.Draw())},this.SetSizeChange=function(a){for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t&&(t.SizeChange=a)}},this.OnWheel=function(a){if(k.Chart.Log("[JSKeyboardChartContainer::OnWheel]",a),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)&&!(!this.Data||!v.IsNonEmptyArray(this.Data.Data))){var r=a.clientX-this.UIElement.getBoundingClientRect().left,t=a.clientY-this.UIElement.getBoundingClientRect().top,n=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),n=this.Canvas.isPointInPath(r,t),!!n){var s=this.ChartPaint[0];if(s){var o=a.wheelDelta;v.IsObjectExist(a.wheelDelta)||(o=a.deltaY*-.01),o<0?this.GotoNextPage(this.PageUpDownCycle)&&this.Draw():o>0&&this.GotoPreviousPage(this.PageUpDownCycle)&&this.Draw(),a.preventDefault?a.preventDefault():a.returnValue=!1}}}},this.OnKeyDown=function(a){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var r=this.GetReportChart();if(r){var t=a.keyCode?a.keyCode:a.which;switch(t){case 33:this.GotoPreviousPage(this.PageUpDownCycle)&&this.Draw();break;case 34:this.GotoNextPage(this.PageUpDownCycle)&&this.Draw();break;case 38:var n=this.MoveSelectedRow(-1);n&&n.Redraw&&this.Draw();break;case 40:var n=this.MoveSelectedRow(1);n&&n.Redraw&&this.Draw();break;case 37:this.MoveXOffset(-1)&&this.Draw();break;case 39:this.MoveXOffset(1)&&this.Draw();break;case 13:this.OnSelectedSymbol();break}a.preventDefault?a.preventDefault():a.returnValue=!1}}},this.OnSelectedSymbol=function(){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return!1;var a=this.ChartPaint[0];if(!a)return!1;var r=a.GetSelectedSymbol(),t=this.MapSymbol.get(r.Symbol);if(!t)return!1;var n=this.GetEventCallback($.ON_KEYBOARD_SELECTED);n&&n.Callback&&n.Callback(n,{Data:r,RowData:t},this)},this.UIOnDblClick=function(a){var r=B(),t=(a.clientX-this.UIElement.getBoundingClientRect().left)*r,n=(a.clientY-this.UIElement.getBoundingClientRect().top)*r,s=this.ChartPaint[0];s&&s.OnDblClick(t,n,a)&&this.OnSelectedSymbol()},this.UIOnMouseDown=function(a){var r=this;this.DragYScroll=null,this.DragMove={Click:{X:a.clientX,Y:a.clientY},Move:{X:a.clientX,Y:a.clientY},PreMove:{X:a.clientX,Y:a.clientY}};var t=B(),n=(a.clientX-this.UIElement.getBoundingClientRect().left)*t,s=(a.clientY-this.UIElement.getBoundingClientRect().top)*t,o=this.ChartPaint[0];if(o){var l=o.OnMouseDown(n,s,a);if(!l)return;if(l.Type==2&&(a.button==0||a.button==2))l.Redraw==!0&&this.Draw();else if(l.Type==5&&a.button==0){var h=l.VScrollbar;h.Type==1?this.MoveYOffset(-1)&&this.Draw():h.Type==2?this.MoveYOffset(1)&&this.Draw():h.Type==3?this.DragYScroll={Click:{X:n,Y:s},LastMove:{X:n,Y:s}}:h.Type==4&&this.SetYOffset(h.Pos)&&this.Draw()}}document.onmousemove=function(u){r.DocOnMouseMove(u)},document.onmouseup=function(u){r.DocOnMouseUp(u)}},this.UIOnContextMenu=function(a){a.preventDefault()},this.UIOnMouseMove=function(a){var r=B();(a.clientX-this.UIElement.getBoundingClientRect().left)*r,(a.clientY-this.UIElement.getBoundingClientRect().top)*r},this.UIOnMounseOut=function(a){},this.UIOnMouseleave=function(a){},this.DocOnMouseMove=function(a){if(this.DragMove.PreMove.X=this.DragMove.Move.X,this.DragMove.PreMove.Y=this.DragMove.Move.Y,this.DragMove.Move.X=a.clientX,this.DragMove.Move.Y=a.clientX,!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var r=B(),t=(a.clientX-this.UIElement.getBoundingClientRect().left)*r,n=(a.clientY-this.UIElement.getBoundingClientRect().top)*r;if(this.DragYScroll){var s=this.ChartPaint[0];if(!s||!s.VScrollbar)return;this.DragYScroll.LastMove.X=t,this.DragYScroll.LastMove.Y=n;var o=s.VScrollbar.GetScrollPostionByPoint(t,n);this.SetYOffset(o)&&this.Draw()}}},this.DocOnMouseUp=function(a){document.onmousemove=null,document.onmouseup=null,this.DragYScroll=null;var r=this.GetEventCallback($.ON_KEYBOARD_MOUSEUP);r&&r.Callback&&r.Callback(r,{},this)},this.GetMoveAngle=function(a,r){var t=Math.abs(a.X-r.X),n=Math.abs(a.Y-r.Y),s=Math.atan(t/n)*180/Math.PI;return s},this.PreventTouchEvent=function(a){a.cancelable&&a.preventDefault(),a.stopPropagation()},this.OnDragYOffset=function(a,r,t,n){if(t<5)return!1;var s=!0;a.LastMove.Y<r[0].clientY&&(s=!1);var o=this.YStepPixel;o<=0&&(o=5);var l=parseInt(t/o);return l<=0?!1:(s==!1&&(l*=-1),this.MoveYOffset(l,this.DragPageCycle)&&(a.IsYMove=!0,this.Draw(),this.DelayUpdateStockData()),!0)},this.OnDragXOffset=function(a,r,t,n){if(t<5)return!1;var s=!0;a.LastMove.X<r[0].clientX&&(s=!1);var o=this.XStepPixel;o<=0&&(o=5);var l=parseInt(t/o);return l<=0?!1:(s||(l*=-1),this.MoveXOffset(l)&&(a.IsXMove=!0,this.Draw()),!0)},this.GetReportChart=function(){var a=this.ChartPaint[0];return a},this.GotoNextPage=function(a){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return!1;var r=this.ChartPaint[0];if(!r)return!1;var t=r.GetPageSize();return t>this.Data.Data.length?!1:this.Data.YOffset+t>=this.Data.Data.length?a===!0?(this.Data.YOffset=0,!0):!1:(this.Data.YOffset+=t,this.Data.Data.length-this.Data.YOffset,r.SelectedRow=this.Data.YOffset,!0)},this.GotoPreviousPage=function(a){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return!1;var r=this.ChartPaint[0];if(!r)return!1;var t=r.GetPageSize();if(t>this.Data.Data.length)return!1;if(this.Data.YOffset<=0)return a===!0?(this.Data.YOffset=this.Data.Data.length-t,!0):!1;var n=this.Data.YOffset;return n-=t,n<0&&(n=0),this.Data.YOffset=n,r.SelectedRow=this.Data.YOffset,!0},this.MoveYOffset=function(a,r){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return!1;var t=this.ChartPaint[0];if(!t)return!1;var n=t.GetCurrentPageStatus();if(n.IsSinglePage)return!1;if(a>0){var s=this.Data.Data.length,o=n.PageSize,l=this.Data.YOffset;if(r)for(var h=0;h<a;++h)++l,l+o>s&&(l=0);else{if(l+o>=s)return!1;for(var h=0;h<a&&!(l+o+1>s);++h)++l}return this.Data.YOffset=l,!0}else if(a<0){a=Math.abs(a);var l=this.Data.YOffset;if(r)for(var o=n.PageSize,h=0;h<a;++h)--l,l<0&&(l=this.Data.Data.length-o);else{if(this.Data.YOffset<=0)return!1;for(var h=0;h<a&&!(l-1<0);++h)--l}return this.Data.YOffset=l,!0}return!1},this.GotoLastPage=function(){var a=this.ChartPaint[0];if(a){var r=a.GetPageSize(!0),t=this.Data.Data.length-r;t<0&&(t=0),this.Data.DataOffset=t}},this.SetColumn=function(a,r){var t=this.ChartPaint[0];t&&(t.SetColumn(a),t.SizeChange=!0,r&&r.Redraw&&this.Draw())},this.ReloadResource=function(a){this.Frame.ReloadResource(a);for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.ReloadResource&&t.ReloadResource(a)}a&&a.Redraw&&(this.SetSizeChange(!0),this.Draw())},this.MoveSelectedRow=function(a){var r=this.ChartPaint[0];if(!r||!v.IsNonEmptyArray(this.Data.Data))return null;var t={Redraw:!1},n=r.GetCurrentPageStatus();n.PageSize;var s=n.SelectedRow;if(a>0){if(s<0||s<n.Start||s>n.End)return r.SelectedRow=n.Start,t.Redraw=!0,t;for(var o=this.Data.YOffset,l=0;l<a&&(++s,s>n.End&&++o,!(s>=this.Data.Data.length));++l)t.Redraw=!0,r.SelectedRow=s,this.Data.YOffset=o;return t}else if(a<0){if(s<0||s<n.Start||s>n.End)return r.SelectedRow=n.End,t.Redraw=!0,t;a=Math.abs(a);for(var o=this.Data.YOffset,l=0;l<a&&(--s,s<n.Start&&--o,!(s<0));++l)t.Redraw=!0,r.SelectedRow=s,this.Data.YOffset=o;return t}},this.SetYOffset=function(a){if(!v.IsNumber(a))return!1;var r=this.ChartPaint[0];if(!r)return!1;var t=r.GetYScrollRange();return a<0&&(a=0),a>t&&(a=t),this.Data.YOffset=a,!0}}function Ig(){this.ChartBorder,this.Canvas,this.BorderLine=null,this.BorderColor=d.Keyboard.BorderColor,this.LogoTextColor=d.FrameLogo.TextColor,this.LogoTextFont=d.FrameLogo.Font,this.ReloadResource=function(e){this.BorderColor=d.Keyboard.BorderColor,this.LogoTextColor=d.FrameLogo.TextColor,this.LogoTextFont=d.FrameLogo.Font},this.Draw=function(){var e=L(this.ChartBorder.GetLeft()),a=L(this.ChartBorder.GetTop()),r=L(this.ChartBorder.GetRight()),t=L(this.ChartBorder.GetBottom()),n=r-e,s=t-a;v.IsNumber(this.BorderLine)?(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),(this.BorderLine&1)>0&&(this.Canvas.moveTo(e,a),this.Canvas.lineTo(r,a)),(this.BorderLine&2)>0&&(this.Canvas.moveTo(e,t),this.Canvas.lineTo(r,t)),(this.BorderLine&4)>0&&(this.Canvas.moveTo(e,a),this.Canvas.lineTo(e,t)),(this.BorderLine&8)>0&&(this.Canvas.moveTo(r,a),this.Canvas.lineTo(r,t)),this.Canvas.stroke()):(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(e,a,n,s))},this.DrawLogo=function(){var e=d.FrameLogo.Text;if(v.IsString(e)){this.Canvas.fillStyle=this.LogoTextColor,this.Canvas.font=this.LogoTextFont,this.Canvas.textAlign="right",this.Canvas.textBaseline="bottom";var a=this.ChartBorder.GetRight()-30,r=this.ChartBorder.GetBottom()-5;this.Canvas.fillText(e,a,r)}}}var Na={SHORT_SYMBOL_ID:0,SYMBOL_ID:1,NAME_ID:2,TYPE_ID:3,TYPE_NAME_ID:4};function mg(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ChartSymbolList",this.UIElement,this.IsDrawFirst=!1,this.GetEventCallback,this.Data,this.SizeChange=!0,this.SelectedRow=-1,this.IsDrawBorder=!1,this.ShowSymbol=[],this.VScrollbar,this.BorderColor=d.Keyboard.BorderColor,this.SelectedColor=d.Keyboard.SelectedColor,this.TextColor=d.Keyboard.TextColor,this.ItemFontConfig={Size:d.Keyboard.Item.Font.Size,Name:d.Keyboard.Item.Font.Name},this.ItemMergin={Left:d.Keyboard.Item.Mergin.Left,Right:d.Keyboard.Item.Mergin.Right,Top:d.Keyboard.Item.Mergin.Top,Bottom:d.Keyboard.Item.Mergin.Bottom},this.ItemFont=15*B()+"px 微软雅黑",this.ItemSymbolFont=12*B()+"px 微软雅黑",this.ItemNameFont=15*B()+"px 微软雅黑",this.ItemNameHeight=0,this.RowCount=0,this.RowHeight=0,this.Column=[{Type:Na.SHORT_SYMBOL_ID,Title:"代码",TextAlign:"left",Width:null,MaxText:"888888"},{Type:Na.NAME_ID,Title:"名称",TextAlign:"left",Width:null,MaxText:"擎擎擎擎擎擎"},{Type:Na.TYPE_NAME_ID,Title:"类型",TextAlign:"right",Width:null,MaxText:"擎擎擎擎"}],this.RectClient={},this.ReloadResource=function(e){this.BorderColor=d.Keyboard.BorderColor,this.SelectedColor=d.Keyboard.SelectedColor,this.TextColor=d.Keyboard.TextColor,this.VScrollbar&&this.VScrollbar.ReloadResource(e)},this.SetColumn=function(e){if(v.IsNonEmptyArray(e)){this.Column=[];for(var a=0;a<e.length;++a){var r=e[a],t=this.GetDefaultColunm(r.Type);t&&(r.Title&&(t.Title=r.Title),r.TextAlign&&(t.TextAlign=r.TextAlign),r.MaxText&&(t.MaxText=r.MaxText),this.Column.push(t))}}},this.GetDefaultColunm=function(e){for(var a=[{Type:Na.SHORT_SYMBOL_ID,Title:"代码",TextAlign:"left",Width:null,MaxText:"888888"},{Type:Na.NAME_ID,Title:"名称",TextAlign:"left",Width:null,MaxText:"擎擎擎擎擎擎"},{Type:Na.TYPE_NAME_ID,Title:"类型",TextAlign:"right",Width:null,MaxText:"擎擎擎擎"}],r=0;r<a.length;++r){var t=a[r];if(t.Type==e)return t}return null},this.Draw=function(){this.ShowSymbol=[],this.SizeChange?this.CalculateSize():this.UpdateCacheData();var e=this.IsShowVScrollbar();if(this.Canvas.save(),this.Canvas.beginPath(),this.Canvas.rect(this.RectClient.Left,this.RectClient.Top+1,this.RectClient.Right-this.RectClient.Left,this.RectClient.Bottom-(this.RectClient.Top+1)),this.Canvas.clip(),this.DrawBody(),this.Canvas.restore(),this.DrawBorder(),this.VScrollbar&&e){var a=this.ChartBorder.GetBottom();this.VScrollbar.DrawScrollbar(this.RectClient.Left,this.RectClient.Top+2,this.RectClient.Right+this.VScrollbar.ButtonSize+2,a-2)}this.SizeChange=!1},this.UpdateCacheData=function(){this.RectClient.Left=this.ChartBorder.GetLeft(),this.RectClient.Right=this.ChartBorder.GetRight(),this.RectClient.Top=this.ChartBorder.GetTop(),this.RectClient.Bottom=this.ChartBorder.GetBottom();var e=this.IsShowVScrollbar();e&&this.VScrollbar&&this.VScrollbar.Enable&&(this.RectClient.Right-=this.VScrollbar.ButtonSize+2)},this.GetPageSize=function(e){e&&this.CalculateSize();var a=this.RowCount;return a},this.GetCurrentPageStatus=function(){var e={Start:this.Data.YOffset,PageSize:this.RowCount,IsEnd:!1,SelectedRow:this.SelectedRow,IsSinglePage:!1,DataCount:0};return v.IsNonEmptyArray(this.Data.Data)?(e.End=this.Data.YOffset+this.RowCount-1,e.IsSinglePage=this.Data.Data.length<=this.RowCount,e.DataCount=this.Data.Data.length,e.End>=this.Data.Data.length-1&&(e.IsEnd=!0),e.End>=this.Data.Data.length&&(e.End=this.Data.Data.length-1)):(e.Star=0,e.End=0,e.IsEnd=!0,e.IsSinglePage=!0),e},this.CalculateSize=function(){this.VScrollbar&&this.VScrollbar.Enable&&this.VScrollbar.CalculateSize(),this.UpdateCacheData();var e=B();this.ItemFont=this.ItemFontConfig.Size*e+"px "+this.ItemFontConfig.Name,this.RowHeight=this.GetFontHeight(this.ItemFont,"擎")+this.ItemMergin.Top+this.ItemMergin.Bottom;var a=this.RectClient.Left,r=this.RectClient.Right;this.Canvas.font=this.ItemFont;for(var t=0,n=0;n<this.Column.length;++n){var s=this.Column[n];t=this.Canvas.measureText(s.MaxText).width,s.Width=t+4+this.ItemMergin.Left+this.ItemMergin.Right,n==this.Column.length-1&&a+s.Width<r&&(s.Width=r-a),a+=s.Width}this.RowCount=parseInt((this.RectClient.Bottom-this.RectClient.Top)/this.RowHeight)},this.DrawText=function(e,a,r,t,n){a=="center"?(r=r+n/2,this.Canvas.textAlign="center"):a=="right"?(r=r+n,this.Canvas.textAlign="right"):this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(e,r,t)},this.DrawBorder=function(){if(this.IsDrawBorder){var e=this.RectClient.Left,a=this.RectClient.Right,r=this.RectClient.Top;this.RectClient.Bottom,this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),this.Canvas.moveTo(e,L(r)),this.Canvas.lineTo(a,L(r));for(var t=r+this.RowHeight,n=t,s=0;s<this.RowCount;++s){var o=L(t);this.Canvas.moveTo(e,o),this.Canvas.lineTo(a,o),n=t,t+=this.RowHeight}for(var l=e,s=this.Data.XOffset;s<this.Column.length;++s){var h=this.Column[s],u=L(l+h.Width);this.Canvas.moveTo(u,r),this.Canvas.lineTo(u,n),l+=h.Width}this.Canvas.stroke()}},this.GetSelectedSymbol=function(){return this.SelectedRow<0||this.SelectedRow>=this.Data.Data.length?null:{Symbol:this.Data.Data[this.SelectedRow],RowID:this.SelectedRow}},this.DrawBody=function(){if(this.Data&&v.IsNonEmptyArray(this.Data.Data)){this.Canvas.font=this.ItemFont;var e=this.RectClient.Top,a=this.RectClient.Left,r=this.RectClient.Right-this.RectClient.Left,t=e;this.Canvas.font=this.ItemFont;for(var n=this.Data.YOffset,s=0;n<this.Data.Data.length&&s<this.RowCount;++n,++s){var o=this.Data.Data[n],l=!1;n==this.SelectedRow&&(l=!0),l&&(this.Canvas.fillStyle=this.SelectedColor,this.Canvas.fillRect(a+1,t,r,this.RowHeight)),this.DrawRow(o,t,n),this.ShowSymbol.push({Index:n,Symbol:o}),t+=this.RowHeight}}},this.DrawRow=function(e,a,r,t){var n=this.RectClient.Left,s=this.RectClient.Right,o={Symbol:e,Stock:null,Block:null};this.GetStockDataCallback&&(o.Stock=this.GetStockDataCallback(e));for(var l=this.Data.XOffset;l<this.Column.length;++l){var h=this.Column[l];if(this.DrawItem(r,o,h,n,a,t),n+=h.Width,n>=s)break}},this.DrawItem=function(e,a,r,t,n,s){r.Width;var o=t+this.ItemMergin.Left,l=r.Width-this.ItemMergin.Left-this.ItemMergin.Right,h=a.Stock,u={Text:null,TextColor:this.TextColor,TextAlign:r.TextAlign};r.Type==Na.SHORT_SYMBOL_ID?(h&&h.ShortSymbol?u.Text=h.ShortSymbol:u.Text=a.Symbol,h.Color&&(u.TextColor=h.Color)):r.Type==Na.NAME_ID?h&&h.Name&&(u.Text=this.TextEllipsis(h.Name,l,r.MaxText),h.Color&&(u.TextColor=h.Color)):r.Type==Na.TYPE_NAME_ID&&h&&h.TypeName&&(u.Text=this.TextEllipsis(h.TypeName,l,r.MaxText),h.Color&&(u.TextColor=h.Color)),this.DrawItemText(u.Text,u.TextColor,u.TextAlign,o,n,l)},this.DrawItemText=function(e,a,r,t,n,s){if(e){var o=t;r=="center"?(o=t+s/2,this.Canvas.textAlign="center"):r=="right"?(o=t+s-2,t+s-2>this.RectClient.Right&&(o=this.RectClient.Right-2),this.Canvas.textAlign="right"):(o+=2,this.Canvas.textAlign="left"),this.Canvas.textBaseline="middle",this.Canvas.fillStyle=a,this.Canvas.fillText(e,o,n+this.ItemMergin.Top+this.RowHeight/2)}},this.TextEllipsis=function(e,a,r){if(!e)return null;if(e.length<r.length)return e;var t=r.length-3;if(t<0)return null;for(var n=e.slice(0,t),s=t;s<e.length;++s){var o=n+e[s]+"...",l=this.Canvas.measureText(o).width;if(l>a){n+="...";break}n+=e[s]}return n},this.GetFontHeight=function(e,a){return Ea(this.Canvas,e,a)},this.OnMouseDown=function(e,a,r){if(!this.Data)return null;var t=B(),n={X:e/t,Y:a/t};if(this.UIElement)var s={Left:this.UIElement.getBoundingClientRect().left,Top:this.UIElement.getBoundingClientRect().top};else var s={Left:null,Top:null};if(this.VScrollbar){var o=this.VScrollbar.OnMouseDown(e,a,r);if(o)return{Type:5,VScrollbar:o}}var l=this.PtInBody(e,a);if(l){var h=!0;this.SelectedModel==0?(this.SelectedRow==l.Index&&(h=!1),this.SelectedRow=l.Index,this.SelectedFixedRow=-1):(this.SelectedRow==l.DataIndex&&(h=!1),this.SelectedRow=l.DataIndex,this.SelectedFixedRow=-1);var u=$.ON_CLICK_REPORT_ROW;return r.button==2&&(u=$.ON_RCLICK_REPORT_ROW),this.SendClickEvent(u,{Data:l,X:e,Y:a,e:r,Inside:n,UIElement:s}),{Type:2,Redraw:h,Row:l}}return null},this.OnDrawgRow=function(e,a,r){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return null;var t=this.RowHeight/2,n=this.RectClient.Top+this.HeaderHeight,s=this.ChartBorder.GetChartWidth(),o=n;if(a<o+t)return{Type:5};for(var l=this.Data.YOffset,h=0;l<this.Data.Data.length&&h<this.RowCount;++l,++h){var u=this.Data.Data[l],f={Left:0,Top:o,Right:s,Bottom:o+this.RowHeight};if(f.Top+=t,f.Bottom+=t,e>=f.Left&&e<=f.Right&&a>=f.Top&&a<=f.Bottom){var C={DataIndex:l,Index:h,Symbol:u,Pos:0};return h==0?C.Pos=1:h==this.RowCount-1&&(C.Pos=2),{Type:2,Data:C}}o+=this.RowHeight}return h<this.RowCount?{Type:6}:{Type:7}},this.OnDblClick=function(e,a,r){if(!this.Data)return!1;var t=this.PtInBody(e,a);return!!t},this.PtInBody=function(e,a){if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return null;var r=this.RectClient.Top,t=this.RectClient.Left,n=this.RectClient.Right;this.RectClient.Right-this.RectClient.Left;for(var s=r,o=this.Data.YOffset,l=0;o<this.Data.Data.length&&l<this.RowCount;++o,++l){var h=this.Data.Data[o],u={Left:t,Top:s,Right:n,Bottom:s+this.RowHeight};if(e>=u.Left&&e<=u.Right&&a>=u.Top&&a<=u.Bottom){var f={Rect:u,DataIndex:o,Index:l,Symbol:h};return f.Item=this.PtInItem(e,a,u.Top,u.Bottom),f}s+=this.RowHeight}return null},this.PtInItem=function(e,a,r,t){for(var n=this.RectClient.Left,s=this.RectClient.Right,o=n,l=0;l<this.FixedColumn&&l<this.Column.length;++l){var h=this.Column[l],u={Left:o,Right:o+h.Width,Top:r,Bottom:t};if(e>=u.Left&&e<=u.Right&&a>=u.Top&&a<=u.Bottom)return{Rect:u,Column:h,Index:l};o+=h.Width}for(var l=this.FixedColumn+this.Data.XOffset;l<this.Column.length;++l){var h=this.Column[l];if(o>=s)break;var u={Left:o,Right:o+h.Width,Top:r,Bottom:t};if(e>=u.Left&&e<=u.Right&&a>=u.Top&&a<=u.Bottom)return{Rect:u,Column:h,Index:l};o+=h.Width}return null},this.IsPtInBody=function(e,a){var r=this.RectClient.Top,t=this.RectClient.Left,n=this.RectClient.Right,s=this.RectClient.Bottom;return e>=t&&e<=n&&a>=r&&a<=s},this.SendClickEvent=function(e,a){var r=this.GetEventCallback(e);r&&r.Callback&&r.Callback(r,a,this)},this.GetYScrollRange=function(){if(!v.IsNonEmptyArray(this.Data.Data))return 0;var e=this.Data.Data.length-this.RowCount;return e},this.IsShowVScrollbar=function(){return v.IsNonEmptyArray(this.Data.Data)?this.Data.Data.length>this.RowCount:!1}}function gg(){this.newMethod=MD,this.newMethod(),delete this.newMethod,this.ClassName="ChartKeyboardVScrollbar",this.Enable=!0,this.ScrollBarHeight=d.Keyboard.VScrollbar.ScrollBarHeight,this.ButtonColor=d.Keyboard.VScrollbar.ButtonColor,this.BarColor=d.Keyboard.VScrollbar.BarColor,this.BorderColor=d.Keyboard.VScrollbar.BorderColor,this.BGColor=d.Keyboard.VScrollbar.BGColor,this.Mergin={Left:2,Right:2,Top:2,Bottom:2},this.BarWithConfig={Size:d.Keyboard.VScrollbar.BarWidth.Size},this.ReloadResource=function(e){this.ScrollBarHeight=d.Keyboard.VScrollbar.ScrollBarHeight,this.ButtonColor=d.Keyboard.VScrollbar.ButtonColor,this.BarColor=d.Keyboard.VScrollbar.BarColor,this.BorderColor=d.Keyboard.VScrollbar.BorderColor,this.BGColor=d.Keyboard.VScrollbar.BGColor,this.BarWithConfig={Size:d.Keyboard.VScrollbar.BarWidth.Size}},this.IsShowCallback=function(){return!0}}function Ss(e){this.DivElement=e,this.JSChartContainer,this.ResizeListener,this.CanvasElement=document.createElement("canvas"),this.CanvasElement.className="jsscrollbar-drawing",this.CanvasElement.id=Re(),this.CanvasElement.setAttribute("tabindex",0),this.CanvasElement.style&&(this.CanvasElement.style.outline="none"),e.hasChildNodes()&&k.Chart.Log("[JSScrollBarChart::JSScrollBarChart] divElement hasChildNodes",e.childNodes),e.appendChild(this.CanvasElement),this.OnSize=function(){var a=this.DivElement.offsetHeight,r=this.DivElement.offsetWidth;this.DivElement.style.height&&this.DivElement.style.width&&(this.DivElement.style.height.includes("px")&&(a=parseInt(this.DivElement.style.height.replace("px",""))),this.DivElement.style.width.includes("px")&&(r=parseInt(this.DivElement.style.width.replace("px","")))),this.CanvasElement.height=a,this.CanvasElement.width=r,this.CanvasElement.style.width=this.CanvasElement.width+"px",this.CanvasElement.style.height=this.CanvasElement.height+"px";var t=B();this.CanvasElement.height*=t,this.CanvasElement.width*=t,k.Chart.Log("[JSScrollBarChart::OnSize] devicePixelRatio="+window.devicePixelRatio+", height="+this.CanvasElement.height+", width="+this.CanvasElement.width),this.JSChartContainer&&this.JSChartContainer.OnSize&&this.JSChartContainer.OnSize()},this.SetOption=function(a){var r=this.CreateJSScrollBarChartContainer(a);if(!r)return!1;this.JSChartContainer=r,this.DivElement.JSChart=this,a.EnableResize==!0&&this.CreateResizeListener(),a.OnCreatedCallback&&a.OnCreatedCallback(r),r.Draw()},this.CreateJSScrollBarChartContainer=function(a){var r=new pg(this.CanvasElement);if(r.Create(a),v.IsNumber(a.DelayDragFrequency)&&(r.DelayDragFrequency=a.DelayDragFrequency),this.SetChartBorder(r,a),a.EventCallback)for(var t=0;t<a.EventCallback.length;++t){var n=a.EventCallback[t];r.AddEventCallback(n)}return r},this.SetChartBorder=function(a,r){if(r.Border){var t=r.Border;v.IsNumber(r.Border.Left)&&(a.Frame.ChartBorder.Left=r.Border.Left),v.IsNumber(r.Border.Right)&&(a.Frame.ChartBorder.Right=r.Border.Right),v.IsNumber(r.Border.Top)&&(a.Frame.ChartBorder.Top=r.Border.Top),v.IsNumber(r.Border.Bottom)&&(a.Frame.ChartBorder.Bottom=r.Border.Bottom);var n=B();a.Frame.ChartBorder.Left*=n,a.Frame.ChartBorder.Right*=n,a.Frame.ChartBorder.Top*=n,a.Frame.ChartBorder.Bottom*=n,v.IsBool(t.AutoLeft)&&(a.AutoMargin.Left=t.AutoLeft),v.IsBool(t.AutoRight)&&(a.AutoMargin.Right=t.AutoRight)}},this.CreateResizeListener=function(){var a=this;this.ResizeListener=new ResizeObserver(function(r){a.OnDivResize(r)}),this.ResizeListener.observe(this.DivElement)},this.OnDivResize=function(a){k.Chart.Log("[JSScrollBarChart::OnDivResize] entries=",a),this.OnSize()},this.AddEventCallback=function(a){this.JSChartContainer&&typeof this.JSChartContainer.AddEventCallback=="function"&&(k.Chart.Log("[JSScrollBarChart:AddEventCallback] obj=",a),this.JSChartContainer.AddEventCallback(a))},this.ReloadResource=function(a){this.JSChartContainer&&typeof this.JSChartContainer.ReloadResource=="function"&&(k.Chart.Log("[JSScrollBarChart:ReloadResource] "),this.JSChartContainer.ReloadResource(a))},this.ChartDestory=function(){this.JSChartContainer&&typeof this.JSChartContainer.ChartDestory=="function"&&this.JSChartContainer.ChartDestory()},this.Draw=function(){this.JSChartContainer&&typeof this.JSChartContainer.Draw=="function"&&(k.Chart.Log("[JSScrollBarChart:Draw] "),this.JSChartContainer.Draw())},this.RecvData=function(a,r){this.JSChartContainer&&typeof this.JSChartContainer.RecvData=="function"&&(k.Chart.Log("[JSScrollBarChart:RecvData] "),this.JSChartContainer.RecvData(a,r))},this.UpdateSlider=function(a){this.JSChartContainer&&typeof this.JSChartContainer.UpdateSlider=="function"&&(k.Chart.Log("[JSScrollBarChart:UpdateSlider] "),this.JSChartContainer.UpdateSlider(a))},this.Reset=function(a){this.JSChartContainer&&typeof this.JSChartContainer.Reset=="function"&&(k.Chart.Log("[JSScrollBarChart:Reset] "),this.JSChartContainer.Reset(a))},this.ReloadResource=function(a){this.JSChartContainer&&typeof this.JSChartContainer.ReloadResource=="function"&&(k.Chart.Log("[JSScrollBarChart:ReloadResource] "),this.JSChartContainer.ReloadResource(a))}}Ss.Init=function(e){var a=new Ss(e);return a.OnSize(),a};Ss.SetStyle=function(e){e&&d.SetStyle(e)};Ss.GetResource=function(){return d};function pg(e){this.ClassName="JSScrollBarChartContainer",this.Frame,this.ChartPaint=[],this.ChartSplashPaint=null,this.LoadDataSplashTitle="无数据",this.Canvas=e.getContext("2d"),this.ShowCanvas=null,this.XOffsetData={Start:-1,End:-1,Count:0},this.SourceData,this.SliderChart,this.DragMove,this.DragSlider,this.DragTimer,this.DelayDragFrequency=150,this.AutoMargin={Left:!1,Right:!1},this.mapEvent=new Dt.default,this.UIElement=e,this.LastPoint=new ft,this.IsDestroy=!1,this.HQChart=null,this.ChartDestory=function(){this.IsDestroy=!0},this.GetHQChart=function(){return this.HQChart},this.AddEventCallback=function(a){if(!(!a||!a.event||!a.callback)){var r={Callback:a.callback,Source:a};this.mapEvent.set(a.event,r)}},this.RemoveEventCallback=function(a){this.mapEvent.has(a)&&this.mapEvent.delete(a)},this.GetEventCallback=function(a){if(!this.mapEvent.has(a))return null;var r=this.mapEvent.get(a);return r},this.Create=function(a){var r=this;this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new Li,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.IsEnableSplash=!0,this.Frame=new Eg,this.Frame.ChartBorder=new ra,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartSplashPaint.Frame=this.Frame;var t=new Fg;t.ChartFrame=this.Frame,t.ChartBorder=this.Frame.ChartBorder,t.Canvas=this.Canvas,t.GetEventCallback=function(n){return r.GetEventCallback(n)},this.ChartPaint.push(t);var t=new xg;t.ChartFrame=this.Frame,t.ChartBorder=this.Frame.ChartBorder,t.Canvas=this.Canvas,t.OffsetData=this.XOffsetData,t.GetEventCallback=function(n){return r.GetEventCallback(n)},this.SliderChart=t,this.ChartPaint.push(t),this.UIElement.onmousedown=function(n){r.UIOnMouseDown(n)},this.UIElement.oncontextmenu=function(n){r.UIOnContextMenu(n)},this.UIElement.onmousemove=function(n){r.UIOnMouseMove(n)},this.UIElement.onmouseout=function(n){r.UIOnMounseOut(n)},this.UIElement.onmouseleave=function(n){r.UIOnMouseleave(n)}},this.CreateChartPaint=function(a){var r=this,t=Cs.Create(a);return t?(t.ChartFrame=this.Frame,t.ChartBorder=this.Frame.ChartBorder,t.Canvas=this.Canvas,t.Data=this.Frame.Data,t.GetEventCallback=function(n){return r.GetEventCallback(n)},t.GetHQChartCallback=function(){return r.GetHQChart()},t):null},this.GetChartPaintByClassName=function(a){for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];if(t.ClassName==a)return{Chart:t,Index:r}}return null},this.Draw=function(){if(!(this.UIElement.width<=0||this.UIElement.height<=0)){this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height);var a=B();if(this.Canvas.lineWidth=a,this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash){this.Frame.Draw({IsEnableSplash:this.ChartSplashPaint.IsEnableSplash}),this.ChartSplashPaint.Draw();return}this.Frame.Draw(),this.Frame.DrawLogo();for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.IsDrawFirst&&t.Draw()}for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.IsDrawFirst||t.Draw()}}},this.OnSize=function(){this.Frame&&(this.SetSizeChange(!0),this.Draw())},this.SetSizeChange=function(a){for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t&&(t.SizeChange=a)}},this.UpdateFrameMaxMin=function(){for(var a=null,r=null,t=0;t<this.ChartPaint.length;++t){var n=this.ChartPaint[t];if(n.GetMaxMin){var s=n.GetMaxMin();s==null||s.Max==null||s.Min==null||((a==null||a<s.Max)&&(a=s.Max),(r==null||r>s.Min)&&(r=s.Min))}}v.IsNumber(a)&&v.IsNumber(r)&&(this.Frame.HorizontalMax=a,this.Frame.HorizontalMin=r)},this.UIOnDblClick=function(a){},this.CancelDragTimer=function(){this.DragTimer&&(clearTimeout(this.DragTimer),this.DragTimer=null)},this.UIOnMouseDown=function(a){var r=this;this.CancelDragTimer(),this.DragSlider=null,this.DragMove={Click:{X:a.clientX,Y:a.clientY},Move:{X:a.clientX,Y:a.clientY},PreMove:{X:a.clientX,Y:a.clientY}};var t=B(),n=(a.clientX-this.UIElement.getBoundingClientRect().left)*t,s=(a.clientY-this.UIElement.getBoundingClientRect().top)*t;if(this.SliderChart){var o=this.SliderChart.PtInChart(n,s);if(!o){if(!this.Frame.PtInClient(n,s))return;var l=this.Frame.GetXData(n);l=Math.round(l);var h=this.GetPageRange(),u=h.ShowCount,f=l-parseInt(u/2);f<0&&(f=0);var C=f+u;C>=this.Frame.XPointCount&&(C=this.Frame.XPointCount-1,f=C-u);var D={UpdateData:{StartIndex:f,EndIndex:C,Type:3}};this.DragUpdate(D);return}this.DragSlider={Click:{X:a.clientX,Y:a.clientY},LastMove:{X:a.clientX,Y:a.clientY},Data:o},this.DragSlider.DrawCount=0}document.onmousemove=function(c){r.DocOnMouseMove(c)},document.onmouseup=function(c){r.DocOnMouseUp(c)}},this.UIOnContextMenu=function(a){a.preventDefault()},this.UIOnMouseMove=function(a){var r=B(),t=(a.clientX-this.UIElement.getBoundingClientRect().left)*r,n=(a.clientY-this.UIElement.getBoundingClientRect().top)*r;if(!this.DragSlider){var s=s={Cursor:"default"},o=this.SliderChart.PtInChart(t,n);if(o)switch(o.Data.Type){case 0:s={Cursor:"grab",Name:"SliderChart"};break;case 1:case 2:s={Cursor:"col-resize",Name:"SliderChart"};break}s&&(this.UIElement.style.cursor=s.Cursor)}},this.UIOnMounseOut=function(a){},this.UIOnMouseleave=function(a){},this.DocOnMouseMove=function(a){var r=this;if(this.DragMove.PreMove.X=this.DragMove.Move.X,this.DragMove.PreMove.Y=this.DragMove.Move.Y,this.DragMove.Move.X=a.clientX,this.DragMove.Move.Y=a.clientX,!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var t=B(),n=(a.clientX-this.UIElement.getBoundingClientRect().left)*t,s=(a.clientY-this.UIElement.getBoundingClientRect().top)*t;if(k.Chart.Log("[JSScrollBarChartContainer::DocOnMouseMove] x="+n+", y="+s),this.DragSlider){var o=this.DragSlider,l=(a.clientX-o.LastMove.X)*t;if(Math.abs(l)<1)return;var h=this.GetPageRange(),u=this.Frame.ChartBorder.GetLeft(),f=this.Frame.ChartBorder.GetRight();this.SliderChart.DragMode=!0;var C=o.Data.Data.Type,D=this.SliderChart.XStart+l,c=this.SliderChart.XEnd+l;C==0?(D<u?(D=h.First.XStart,c=h.First.XEnd):c>=f&&(D=h.Last.XStart,c=h.Last.XEnd),this.SliderChart.XStart=D,this.SliderChart.XEnd=c):C==1?(D<=u?D=h.First.XStart:D>=f&&(D=h.Last.XEnd),this.SliderChart.XStart=D):C==2&&(c>=f?c=h.Last.XEnd:c<=u&&(c=h.First.XStart),this.SliderChart.XEnd=c),o.UpdateData={XStart:D,XEnd:c,Type:C},o.LastMove.X=a.clientX,o.LastMove.Y=a.clientY,o.DrawCount==0?this.DragUpdate(o):this.DragTimer=setTimeout(function(){r.DragUpdate(r.DragSlider)},this.DelayDragFrequency)}}},this.DocOnMouseUp=function(a){document.onmousemove=null,document.onmouseup=null,this.CancelDragTimer();var r=this.DragSlider;this.DragMove=null,this.DragSlider=null,this.SliderChart.DragMode=!1,this.DragUpdate(r)},this.DragUpdate=function(a){!a||!a.UpdateData||(this.UpdateXDataOffset(a.UpdateData),this.Draw(),++a.DrawCount)},this.Reset=function(a){this.SourceData=null,this.XOffsetData.Start=-1,this.XOffsetData.End=-1,this.XOffsetData.Count=0,this.Frame.Data=null;for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.Data=null}this.ChartSplashPaint&&(this.ChartSplashPaint.IsEnableSplash=!0),a.Draw&&this.Draw()},this.UpdateSlider=function(a){if(!this.SliderChart.DragMode){var r=!1;(this.AutoMargin.Left||this.AutoMargin.Right)&&a.Border&&(this.AutoMargin.Left&&this.Frame.ChartBorder.Left!=a.Border.Left&&(r=!0),this.AutoMargin.Right&&this.Frame.ChartBorder.Right!=a.Border.Right&&(r=!0));var t=a.Data;if(!(this.XOffsetData.Start==a.Start&&this.XOffsetData.End==a.End&&this.SourceData==t&&!r)){this.SourceData=t;var n=t.Data.length;v.IsNumber(a.RightSpaceCount)&&(n+=a.RightSpaceCount),this.Frame.XPointCount=n,this.Frame.Data=t,this.XOffsetData.Count=n,this.XOffsetData.Start=a.Start,this.XOffsetData.End=a.End;for(var s=0;s<this.ChartPaint.length;++s){var o=this.ChartPaint[s];o.Data=t}this.AutoMargin.Left&&a.Border&&v.IsNumber(a.Border.Left)&&(this.Frame.ChartBorder.Left=a.Border.Left),this.AutoMargin.Right&&a.Border&&v.IsNumber(a.Border.Right)&&(this.Frame.ChartBorder.Right=a.Border.Right),this.UpdateFrameMaxMin(),this.ChartSplashPaint&&(this.ChartSplashPaint.IsEnableSplash=!1),a.Draw&&this.Draw()}}},this.UpdateXDataOffset=function(a){if(a){var r=a.Type;if(a.Type==0){var t=this.Frame.GetXData(a.XStart);t=parseInt(t+.5);var n=t-this.XOffsetData.Start;this.XOffsetData.Start=t,this.XOffsetData.End+=n}else if(a.Type==1){var t=this.Frame.GetXData(a.XStart);t=parseInt(t),this.XOffsetData.Start=t}else if(a.Type==2){var s=this.Frame.GetXData(a.XEnd);s=parseInt(s),this.XOffsetData.End=s}else a.Type==3&&(this.XOffsetData.End=a.EndIndex,this.XOffsetData.Start=a.StartIndex,r=0);var o=this.SourceData.Data[this.XOffsetData.End],l=this.SourceData.Data[this.XOffsetData.Start],h={Type:r,Count:this.XOffsetData.Count};if(this.XOffsetData.End>this.XOffsetData.Start?(h.Start={Index:this.XOffsetData.Start,Item:l},h.End={Index:this.XOffsetData.End,Item:o}):(h.Start={Index:this.XOffsetData.End,Item:o},h.End={Index:this.XOffsetData.Start,Item:l}),this.HQChart&&this.HQChart.JSChartContainer){var u=this.HQChart.JSChartContainer;if(u.ChartOperator){var a={ID:ve.OP_SCROOLBAR_SLIDER_CHANGED,Start:h.Start,End:h.End,Type:h.Type};u.ChartOperator(a)}}var f=this.GetEventCallback($.ON_SCROLLBAR_SLIDER_CHANGED);f&&f.Callback(f,h,this)}},this.ReloadResource=function(a){this.Frame.ReloadResource(a);for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.ReloadResource&&t.ReloadResource(a)}a&&a.Redraw&&(this.SetSizeChange(!0),this.Draw())},this.GetPageRange=function(){var a={},r=Math.abs(this.XOffsetData.Start-this.XOffsetData.End);a.ShowCount=r;var s=this.Frame.GetXFromIndex(0),n=this.Frame.GetXFromIndex(r);a.First={XStart:s,XEnd:n};var t=this.Frame.XPointCount-1,n=this.Frame.GetXFromIndex(t),s=this.Frame.GetXFromIndex(t-r);return a.Last={XStart:s,XEnd:n},a},this.ReloadResource=function(a){this.Frame.ReloadResource(a);for(var r=0;r<this.ChartPaint.length;++r){var t=this.ChartPaint[r];t.ReloadResource&&t.ReloadResource(a)}a.Draw==!0&&this.Draw()}}function Eg(){this.ChartBorder,this.Canvas,this.BorderLine=null,this.Data,this.Count=0,this.ClassName="JSScrollBarFrame",this.HorizontalMax=10,this.HorizontalMin=5,this.XPointCount=0,this.XSplitTextFont=d.ScrollBar.XSplitTextFont,this.XSplitTextColor=d.ScrollBar.XSplitTextColor,this.XSplitLineColor=d.ScrollBar.XSplitLineColor,this.BorderColor=d.ScrollBar.BorderColor,this.LogoTextColor=d.FrameLogo.TextColor,this.LogoTextFont=d.FrameLogo.Font,this.ReloadResource=function(e){this.BorderColor=d.ScrollBar.BorderColor,this.LogoTextColor=d.FrameLogo.TextColor,this.LogoTextFont=d.FrameLogo.Font},this.Draw=function(){this.DrawBorder(),this.DrawLogo(),this.DrawVertical()},this.DrawLogo=function(){var e=d.FrameLogo.Text;if(v.IsString(e)){this.Canvas.fillStyle=this.LogoTextColor,this.Canvas.font=this.LogoTextFont,this.Canvas.textAlign="left",this.Canvas.textBaseline="top";var a=this.ChartBorder.GetLeft()+2,r=this.ChartBorder.GetTop()+2;this.Canvas.fillText(e,a,r)}},this.DrawBorder=function(){var e=L(this.ChartBorder.GetLeft()),a=L(this.ChartBorder.GetTop()),r=L(this.ChartBorder.GetRight()),t=L(this.ChartBorder.GetBottom()),n=r-e,s=t-a;v.IsNumber(this.BorderLine)?(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),(this.BorderLine&1)>0&&(this.Canvas.moveTo(e,a),this.Canvas.lineTo(r,a)),(this.BorderLine&2)>0&&(this.Canvas.moveTo(e,t),this.Canvas.lineTo(r,t)),(this.BorderLine&4)>0&&(this.Canvas.moveTo(e,a),this.Canvas.lineTo(e,t)),(this.BorderLine&8)>0&&(this.Canvas.moveTo(r,a),this.Canvas.lineTo(r,t)),this.Canvas.stroke()):(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(e,a,n,s))},this.GetXFromIndex=function(e){var a=this.XPointCount;if(a==1)return e==0?this.ChartBorder.GetLeft():this.ChartBorder.GetRight();if(a<=0)return this.ChartBorder.GetLeft();if(e>=a)return this.ChartBorder.GetRight();var r=this.ChartBorder.GetLeft()+this.ChartBorder.GetWidth()*e/a;return r},this.GetYFromData=function(e){if(e<=this.HorizontalMin)return this.ChartBorder.GetBottomEx();if(e>=this.HorizontalMax)return this.ChartBorder.GetTopEx();var a=this.ChartBorder.GetHeightEx()*(e-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetBottomEx()-a},this.GetXData=function(e){return e<=this.ChartBorder.GetLeft()?0:e>=this.ChartBorder.GetRight()?this.XPointCount:(e-this.ChartBorder.GetLeft())*(this.XPointCount*1/this.ChartBorder.GetWidth())},this.GetPreSetpWidth=function(){return this.XPointCount*1/this.ChartBorder.GetWidth()},this.DrawVertical=function(){if(!(this.ChartBorder.Bottom<=5)&&!(!this.Data||!v.IsNonEmptyArray(this.Data.Data))){var e=this.Data.Data[0],a=parseInt(e.Date/1e4),r=e.Date%1e4;this.Canvas.font=this.XSplitTextFont,this.Canvas.fillStyle=this.XSplitTextColor,this.Canvas.textBaseline="top";var t=this.ChartBorder.GetBottom()+2,n=this.ChartBorder.GetTop(),s=this.ChartBorder.GetBottom(),o=0;if(Y.IsMilliSecondPeriod(this.Data.Period))for(var l=null,h=0;h<this.Data.Data.length;++h){var e=this.Data.Data[h],u=e.Date%1e4,f=parseInt(e.Time/1e3),C=parseInt(f/1e4);if(h==0){var D=v.FormatDateString(e.Date,"MM-DD"),c=this.ChartBorder.GetLeft();this.Canvas.textAlign="left",this.Canvas.fillText(D,c,t);var T=this.Canvas.measureText(D).width+2;o=c+T,r=u,l=C;continue}if(C!=l){var D=v.FormatTimeString(e.Time,"HH:MM:SS.fff"),c=this.GetXFromIndex(h),T=this.Canvas.measureText(D).width+2;c-T/2>o&&(this.Canvas.textAlign="center",this.Canvas.fillText(D,c,t),o=c+T/2),c=L(c),this.Canvas.strokeStyle=this.XSplitLineColor,this.Canvas.beginPath(),this.Canvas.moveTo(c,n),this.Canvas.lineTo(c,s),this.Canvas.stroke(),l=C}}else if(Y.IsMinutePeriod(this.Data.Period,!0))for(var h=0;h<this.Data.Data.length;++h){var e=this.Data.Data[h],u=e.Date%1e4;if(h==0){var D=v.FormatDateString(e.Date,"MM-DD"),c=this.ChartBorder.GetLeft();this.Canvas.textAlign="left",this.Canvas.fillText(D,c,t);var T=this.Canvas.measureText(D).width+2;o=c+T,r=u;continue}if(u!=r){var D=v.FormatDateString(e.Date,"MM-DD"),c=this.GetXFromIndex(h),T=this.Canvas.measureText(D).width+2;c-T/2>o&&(this.Canvas.textAlign="center",this.Canvas.fillText(D,c,t),o=c+T/2),c=L(c),this.Canvas.strokeStyle=this.XSplitLineColor,this.Canvas.beginPath(),this.Canvas.moveTo(c,n),this.Canvas.lineTo(c,s),this.Canvas.stroke(),r=u}}else for(var h=0;h<this.Data.Data.length;++h){var e=this.Data.Data[h],S=parseInt(e.Date/1e4);if(h==0){var D=""+S,c=this.ChartBorder.GetLeft(),T=this.Canvas.measureText(D).width+2;this.Canvas.textAlign="left",this.Canvas.fillText(D,c,t),o=c+T,a=S;continue}if(S!=a){var D=""+S,c=this.GetXFromIndex(h),T=this.Canvas.measureText(D).width+2;c-T/2>o&&(this.Canvas.textAlign="center",this.Canvas.fillText(D,c,t),o=c+T/2),c=L(c),this.Canvas.strokeStyle=this.XSplitLineColor,this.Canvas.beginPath(),this.Canvas.moveTo(c,n),this.Canvas.lineTo(c,s),this.Canvas.stroke(),a=S}}}},this.PtInClient=function(e,a){var r=L(this.ChartBorder.GetLeft()),t=L(this.ChartBorder.GetTop()),n=L(this.ChartBorder.GetRight()),s=L(this.ChartBorder.GetBottom());return e>=r&&e<=n&&a>=t&&a<=s}}function xg(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="SliderChart",this.OffsetData,this.Color=d.ScrollBar.Slider.BarAreaColor,this.BarColor=d.ScrollBar.Slider.BarColor,this.BarWidth=d.ScrollBar.Slider.BarWidth,this.BarPadding=d.ScrollBar.Slider.BarPadding,this.MinCenterWidth=d.ScrollBar.Slider.MinCenterWidth,this.DateFont=d.ScrollBar.Slider.DateFont,this.DateColor=d.ScrollBar.Slider.DateColor,this.AryRect=[],this.XStart,this.XEnd,this.SizeChange=!0,this.DragMode=!1,this.ReloadResource=function(e){this.Color=d.ScrollBar.Slider.BarAreaColor,this.BarColor=d.ScrollBar.Slider.BarColor,this.DateFont=d.ScrollBar.Slider.DateFont,this.DateColor=d.ScrollBar.Slider.DateColor},this.Draw=function(){if(this.AryRect=[],!(!this.OffsetData||!v.IsPlusNumber(this.OffsetData.Count))&&!(!v.IsNumber(this.OffsetData.Start)||!v.IsNumber(this.OffsetData.End))){var e=this.ChartBorder.GetTop(),a=this.ChartBorder.GetBottom(),r,t;if(this.DragMode){var n=this.XStart,s=this.XEnd,o=this.ChartFrame.GetXData(n),l=this.ChartFrame.GetXData(s);o=parseInt(o),l=parseInt(l),r={Data:this.Data.Data[this.OffsetData.Start],X:n,Type:o<l?0:1},t={Data:this.Data.Data[this.OffsetData.End],X:s,Type:l>o?1:0}}else{var h=this.OffsetData.Start,u=this.OffsetData.End,n=this.ChartFrame.GetXFromIndex(h),s=this.ChartFrame.GetXFromIndex(u);this.XStart=n,this.XEnd=s,r={Data:this.Data.Data[this.OffsetData.Start],X:n,Type:n<s?0:1},t={Data:this.Data.Data[this.OffsetData.End],X:s,Type:s>n?1:0}}this.Canvas.fillStyle=this.Color;var S={Left:Math.min(n,s),Top:e,Width:Math.abs(s-n),Height:a-e};S.Right=S.Left+S.Width,S.Bottom=S.Top+S.Height,S.Width<this.MinCenterWidth&&(S.Left-=(this.MinCenterWidth-S.Width)/2,S.Width=this.MinCenterWidth,S.Right=S.Left+S.Width),this.Canvas.fillRect(S.Left,S.Top,S.Width,S.Height),this.AryRect.push({Rect:S,Type:0});var f=B(),C=this.BarWidth*f,D=a-e-this.BarPadding*2*f,T=n-this.BarWidth/2,c=e+this.BarPadding*f;this.Canvas.fillStyle=this.BarColor;var S={Left:T,Top:c,Width:C,Height:D};S.Right=S.Left+S.Width,S.Bottom=S.Top+S.Height,this.Canvas.fillRect(S.Left,S.Top,S.Width,S.Height),this.AryRect.push({Rect:S,Type:1});var T=s-this.BarWidth/2,S={Left:T,Top:c,Width:C,Height:D};if(S.Right=S.Left+S.Width,S.Bottom=S.Top+S.Height,this.Canvas.fillRect(S.Left,S.Top,S.Width,S.Height),this.AryRect.push({Rect:S,Type:2}),t.Type==1){var I=this.OffsetData.End;I>=this.Data.Data.length&&(t.Data=this.Data.Data[this.Data.Data.length-1])}this.DrawDateTime(r),this.DrawDateTime(t)}},this.DrawDateTime=function(e){if(!(!e||!e.Data)){var a=v.FormatDateString(e.Data.Date),r=this.ChartBorder.GetTop(),t=this.ChartBorder.GetBottom(),n=null;if(Y.IsMilliSecondPeriod(this.Data.Period)){var s=parseInt(e.Data.Time/1e3);a=v.FormatTimeString(s,"HH:MM:SS")}else Y.IsSecondPeriod(this.Data.Period)?a=v.FormatTimeString(s,"HH:MM:SS"):Y.IsMinutePeriod(this.Data.Period,!0)&&(n=v.FormatTimeString(e.Data.Time,"HH:MM"));if(e.Type==0){this.Canvas.textAlign="right";var o=e.X-this.BarWidth/2}else if(e.Type==1){this.Canvas.textAlign="left";var o=e.X+this.BarWidth/2}this.Canvas.font=this.DateFont;var l=this.Canvas.measureText("擎").width;this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.DateColor;var h=r+(t-r)/2;this.Canvas.fillText(a,o,h),n&&(h+=l,this.Canvas.fillText(n,o,h))}},this.PtInChart=function(e,a){if(!v.IsNonEmptyArray(this.AryRect))return null;for(var r=this.AryRect.length-1;r>=0;--r){var t=this.AryRect[r],n=t.Rect;if(e>=n.Left&&e<=n.Right&&a>=n.Top&&a<=n.Bottom)return{Data:t}}return null}}function Fg(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ScrollBarBGChart",this.SizeChange=!0,this.Data,this.Color=d.ScrollBar.BGChart.Color,this.LineWidth=d.ScrollBar.BGChart.LineWidth,this.AreaColor=d.ScrollBar.BGChart.AreaColor,this.ReloadResource=function(e){this.Color=d.ScrollBar.BGChart.Color,this.LineWidth=d.ScrollBar.BGChart.LineWidth,this.AreaColor=d.ScrollBar.BGChart.AreaColor},this.Draw=function(){if(!(!this.Data||!v.IsNonEmptyArray(this.Data.Data))){this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*B());var e=this.ChartBorder.GetBottom();this.Canvas.strokeStyle=this.Color;for(var a=!0,r=0,t,n,s={},o=0;o<this.Data.Data.length;++o){var l=this.Data.Data[o],h=l.Close;v.IsNumber(h)&&(t=this.ChartFrame.GetXFromIndex(o),n=this.ChartFrame.GetYFromData(h),a?(this.Canvas.beginPath(),this.Canvas.moveTo(t,n),a=!1,s={X:t,Y:n}):this.Canvas.lineTo(t,n),++r)}r>0&&(this.Canvas.stroke(),this.Canvas.lineTo(t,e),this.Canvas.lineTo(s.X,e),this.Canvas.closePath(),this.Canvas.fillStyle=this.AreaColor,this.Canvas.fill()),this.Canvas.restore()}},this.GetMaxMin=function(){var e={Max:null,Min:null};if(!this.Data||!v.IsNonEmptyArray(this.Data.Data))return e;for(var a=0;a<this.Data.Data.length;++a){var r=this.Data.Data[a],t=r.Close;v.IsNumber(t)&&((e.Max==null||e.Max<t)&&(e.Max=t),(e.Min==null||e.Min>t)&&(e.Min=t))}return e}}function Ne(){this.Data={Menu:[],Position:0},this.RootDOM=null,this.TBodyDOM=null,this.ArySubRootDOM=[],this.ClickCallback=null,this.CheckedClassName="UMyChart_MenuItem_Span_Checked  iconfont icon-checked",this.RightArrowClassName="UMyChart_MenuItem_Span_Arrow  iconfont icon-menu_arraw_right",this.SelectedClassName="UMyChart_MenuItem_Tr_Selected",this.AryTDClassName=["UMyChart_MenuItem_Td_Status","UMyChart_MenuItem_Td_Content","UMyChart_MenuItem_Td_Shortcut","UMyChart_MenuItem_Td_Arrow"],this.Inital=function(){var e=this;window.addEventListener("mousedown",function(a){e.OnWindowMouseDown(a)})},this.CreatePopMenu=function(e){if(this.Clear(),!!v.IsNonEmptyArray(e.Menu)){var a=document.createElement("div");a.className="UMyChart_PopMenu";var r=document.createElement("table");r.className="UMyChart_PopMenu_Table",a.appendChild(r);var t=document.createElement("tbody");t.className="UMyChart_PopMenu_Tbody",r.appendChild(t);var n={Root:a,TBody:t,Table:r};a.JSMenuData=n;for(var s=0;s<e.Menu.length;++s){var o=e.Menu[s];if(o.Name==Ne.SEPARATOR_LINE_NAME){var l=this.CreateSeparatorTr();l&&t.appendChild(l);continue}var h=this.CreateMenu(n,o);t.appendChild(h)}document.body.appendChild(a),this.RootDOM=a,this.TBodyDOM=t,v.IsNumber(e.Position)&&(this.Data.Position=e.Position),e.ClickCallback&&(this.ClickCallback=e.ClickCallback)}},this.Clear=function(){if(this.Data.Menu=[],this.Data.Position=Ne.POSITION_ID.RIGHT_MENU_ID,this.ClickCallback=null,!!this.RootDOM){document.body.removeChild(this.RootDOM),this.RootDOM=null,this.TBodyDOM=null;for(var e=0;e<this.ArySubRootDOM.length;++e)document.body.removeChild(this.ArySubRootDOM[e]);this.ArySubRootDOM=[]}},this.CreateMenu=function(e,a){var r=this,t=document.createElement("tr");t.className="UMyChart_MenuItem_Tr",a.Disable===!0&&t.classList.add("UMyChart_DrawTool_Disable_Tr");for(var n=0;n<this.AryTDClassName.length;++n){var s=document.createElement("td");if(s.className=this.AryTDClassName[n],n==0){if(a.Checked){var o=document.createElement("span");o.className=this.CheckedClassName,o.style["font-size"]="10px",s.appendChild(o)}}else if(n==1)s.innerText=a.Name;else if(n==2)a.Text&&(s.innerText=a.Text);else if(n==3&&v.IsNonEmptyArray(a.SubMenu)){var o=document.createElement("span");o.className=this.RightArrowClassName,o.style["font-size"]="10px",s.appendChild(o)}t.appendChild(s)}if(v.IsNonEmptyArray(a.SubMenu)){var l=document.createElement("div");l.className="UMyChart_PopSubMenu";var h=document.createElement("table");h.className="UMyChart_PopMenu_Table",l.appendChild(h);var u=document.createElement("tbody");u.className="UMyChart_PopMenu_TBody",h.appendChild(u);var f={Root:l,TBody:u,Table:h};l.JSMenuData=f;for(var n=0;n<a.SubMenu.length;++n){var C=a.SubMenu[n];if(C.Name==Ne.SEPARATOR_LINE_NAME){var D=this.CreateSeparatorTr();D&&u.appendChild(D);continue}var c=this.CreateMenu(f,C);u.appendChild(c)}t.onmouseover=function(T){r.OnMouseOver(T,e,t,l)},document.body.appendChild(l),this.ArySubRootDOM.push(l)}else a.Disable===!0||(t.onmousedown=function(T){r.OnClickMenu(T,a,!1)},t.onmouseover=function(T){r.OnMouseOver(T,e)});return t},this.CreateSeparatorTr=function(){var e=document.createElement("tr");e.className="UMyChart_MenuItem_Tr_Separator";var a=document.createElement("td");a.className="UMyChart_MenuItem_Td_Status_Separator",e.appendChild(a);var a=document.createElement("td");a.className="UMyChart_MenuItem_Td_Separator",e.appendChild(a);var a=document.createElement("td");a.className="UMyChart_MenuItem_Td_Separator",e.appendChild(a);var a=document.createElement("td");return a.className="UMyChart_MenuItem_Td_Separator",e.appendChild(a),e},this.PopupMenuByTab=function(e){if(this.RootDOM&&e){var a=e.Left,r=e.Top-this.RootDOM.offsetHeight;this.RootDOM.style.visibility="visible",this.RootDOM.style.top=r+"px",this.RootDOM.style.left=a+"px"}},this.PopupMenuByRight=function(e,a){if(this.RootDOM&&!(!v.IsNumber(e)||!v.IsNumber(a))){var r=this.RootDOM.offsetHeight,t=a+r,n=window.innerHeight-15;t>n&&(a=n-r);var s=this.RootDOM.offsetWidth,o=e+s,l=window.innerWidth-15;o>l&&(e=l-s),this.RootDOM.style.visibility="visible",this.RootDOM.style.top=a+"px",this.RootDOM.style.left=e+"px"}},this.PopupMenuByDrapdown=function(e){if(this.RootDOM&&e){var a=e.Left,r=e.Bottom,t=this.RootDOM.offsetHeight,n=r+t,s=window.innerHeight-15;if(n>s&&(r=e.Top-t),this.Data.Position==Ne.POSITION_ID.DROPDOWN_RIGHT_MENU_ID){var o=this.RootDOM.offsetWidth;a=e.Right-o}this.RootDOM.style.visibility="visible",this.RootDOM.style.top=r+"px",this.RootDOM.style.left=a+"px"}},this.OnClickMenu=function(e,a,r){console.log("[JSPopMenu::OnClickMenu] e=, item=, bSubMenu",e,a,r),this.ClickCallback&&this.ClickCallback(a)},this.OnMouseOver=function(e,a,r,t){if(a&&a.PopMenu&&a.PopMenu!=t){a.PopMenu.style.visibility="hidden",a.PopRow&&a.PopRow.classList.remove(this.SelectedClassName);for(var n=a.PopMenu.JSMenuData,s=0;s<50&&!(!n||!n.PopMenu);++s)n.PopMenu.style.visibility="hidden",n=n.PopMenu;a.PopMenu=null,a.PopRow=null}if(t){if(t.style.visibility!="visible"){var o=r.getBoundingClientRect(),l=o.right,h=o.top,u=window.innerHeight-15,f=window.innerWidth-15,C=t.offsetHeight,D=t.offsetWidth,c=h+C,T=l+D;c>u&&(h=u-C),T>f&&(l=o.left-D),t.style.left=l+"px",t.style.top=h+"px",r.classList.add(this.SelectedClassName),t.style.visibility="visible"}a.PopMenu=t,a.PopRow=r}},this.OnWindowMouseDown=function(e){this.RootDOM&&(console.log("[JSPopMenu::OnWindowMouseDown] e=",e),this.Clear())}}Ne.POSITION_ID={};Ne.POSITION_ID.RIGHT_MENU_ID=0;Ne.POSITION_ID.TAB_MENU_ID=1;Ne.POSITION_ID.DROPDOWN_MENU_ID=2;Ne.POSITION_ID.DROPDOWN_RIGHT_MENU_ID=3;Ne.SEPARATOR_LINE_NAME="MENU_SEPARATOR";var Ee={CMD_SELECTED_ID:1,CMD_CHANGE_LINE_COLOR_ID:2,CMD_DELETE_ALL_DRAW_CHART_ID:3,CMD_ERASE_DRAW_CHART_ID:4,CMD_ENABLE_MAGNET_ID:5,CMD_DELETE_DRAW_CHART_ID:6,CMD_CHANGE_FONT_COLOR_ID:7,CMD_CHANGE_BG_COLOR_ID:8,CMD_CHANGE_BORDER_COLOR_ID:9,CMD_LOCK_DRAW_CHART_ID:10};function LD(){this.AryChartGroup=[{Title:"线段",AryChart:[{Title:"线段",ClassName:"hqchart_drawtool icon-draw_line",Type:0,Data:{ID:"线段"}},{Title:"线段信息",ClassName:"hqchart_drawtool icon-infoline",Type:0,Data:{ID:"InfoLine"}},{Title:"射线",ClassName:"hqchart_drawtool icon-draw_rays",Type:0,Data:{ID:"射线"}},{Title:"趋势线角度",ClassName:"hqchart_drawtool icon-qushixianjiaodu",Type:0,Data:{ID:"TrendAngle"}},{Title:"标价线",ClassName:"hqchart_drawtool icon-price_line",Type:0,Data:{ID:"标价线"}},{Title:"垂直线",ClassName:"hqchart_drawtool icon-vertical_line",Type:0,Data:{ID:"垂直线"}},{Title:"十字线",ClassName:"hqchart_drawtool icon-tubiao_shizixian",Type:0,Data:{ID:"十字线"}},{Title:"箭头",ClassName:"hqchart_drawtool icon-bottom-arrow-solid",Type:0,Data:{ID:"箭头"}},{Title:"大箭头",ClassName:"hqchart_drawtool icon-big_arrow",Type:0,Data:{ID:"ArrowMarker"}},{Title:"趋势线",ClassName:"hqchart_drawtool icon-draw_trendline",Type:0,Data:{ID:"趋势线"}},{Title:"水平线",ClassName:"hqchart_drawtool icon-draw_hline",Type:0,Data:{ID:"水平线"}},{Title:"水平射线",ClassName:"hqchart_drawtool icon-tubiao_shuipingshexian",Type:0,Data:{ID:"水平射线"}},{Title:"涂鸦线段",ClassName:"hqchart_drawtool icon-draw_line",Type:0,Data:{ID:"涂鸦线段"}},{Title:"阻速线",ClassName:"hqchart_drawtool icon-draw_resline",Type:0,Data:{ID:"阻速线"}},{Title:"通达信阻速线",ClassName:"hqchart_drawtool icon-draw_resline",Type:0,Data:{ID:"阻速线2"}},{Title:"江恩角度线",ClassName:"hqchart_drawtool icon-jiangenjiaoduxian",Type:0,Data:{ID:"江恩角度线"}},{Title:"通达信江恩角度线",ClassName:"hqchart_drawtool icon-jiangenjiaoduxian",Type:0,Data:{ID:"江恩角度线2"}}]},{Title:"通道",AryChart:[{Title:"平行线",ClassName:"hqchart_drawtool icon-draw_parallel_lines",Type:0,Data:{ID:"平行线"}},{Title:"水平线段",ClassName:"hqchart_drawtool icon-draw_hlinesegment",Type:0,Data:{ID:"水平线段"}},{Title:"平行射线",ClassName:"hqchart_drawtool icon-draw_p_rays_lines",Type:0,Data:{ID:"平行射线"}},{Title:"平行通道",ClassName:"hqchart_drawtool icon-draw_parallelchannel",Type:0,Data:{ID:"平行通道"}},{Title:"价格通道线",ClassName:"hqchart_drawtool icon-draw_pricechannel",Type:0,Data:{ID:"价格通道线"}},{Title:"箱型线",ClassName:"hqchart_drawtool icon-draw_box",Type:0,Data:{ID:"箱型线"}},{Title:"不相交通道",ClassName:"hqchart_drawtool icon-buxiangjiaojiao",Type:0,Data:{ID:"DisjointChannel"}},{Title:"平滑顶/底",ClassName:"hqchart_drawtool icon-tubiao_buxiangjiaotongdao",Type:0,Data:{ID:"FlatTop"}},{Title:"波段线",ClassName:"hqchart_drawtool icon-draw_waveband",Type:0,Data:{ID:"波段线"}},{Title:"百分比线",ClassName:"hqchart_drawtool icon-PercentageLine",Type:0,Data:{ID:"百分比线"}},{Title:"黄金分割",ClassName:"hqchart_drawtool icon-GoldenSection",Type:0,Data:{ID:"黄金分割"}},{Title:"线形回归线",ClassName:"hqchart_drawtool icon-linear_3",Type:0,Data:{ID:"线形回归线"}},{Title:"线形回归带",ClassName:"hqchart_drawtool icon-linear_1",Type:0,Data:{ID:"线形回归带"}},{Title:"延长线形回归带",ClassName:"hqchart_drawtool icon-linear_2",Type:0,Data:{ID:"延长线形回归带"}}]},{Title:"形状",AryChart:[{Title:"圆弧线",ClassName:"hqchart_drawtool icon-draw_arc",Type:0,Data:{ID:"圆弧线"}},{Title:"矩形",ClassName:"hqchart_drawtool icon-rectangle",Type:0,Data:{ID:"矩形"}},{Title:"平行四边形",ClassName:"hqchart_drawtool icon-draw_quadrangle",Type:0,Data:{ID:"平行四边形"}},{Title:"三角形",ClassName:"hqchart_drawtool icon-draw_triangle",Type:0,Data:{ID:"三角形"}},{Title:"圆",ClassName:"hqchart_drawtool icon-draw_circle",Type:0,Data:{ID:"圆"}},{Title:"对称角度",ClassName:"hqchart_drawtool icon-draw_symangle",Type:0,Data:{ID:"对称角度"}}]},{Title:"波浪线",AryChart:[{Title:"M头W底",ClassName:"hqchart_drawtool icon-draw_wavemw",Type:0,Data:{ID:"M头W底"}},{Title:"头肩型",ClassName:"hqchart_drawtool icon-draw_head_shoulders_bt",Type:0,Data:{ID:"头肩型"}},{Title:"波浪尺",ClassName:"hqchart_drawtool icon-waveruler",Type:0,Data:{ID:"波浪尺"}},{Title:"AB波浪尺",ClassName:"hqchart_drawtool icon-waveruler",Type:0,Data:{ID:"AB波浪尺"}}]},{Title:"斐波那契",AryChart:[{Title:"斐波那契周期线",ClassName:"hqchart_drawtool icon-feibonaqizhouqixian",Type:0,Data:{ID:"斐波那契周期线"}},{Title:"斐波那契楔形",ClassName:"hqchart_drawtool icon-feibonaqiqixing",Type:0,Data:{ID:"FibWedge"}},{Title:"斐波那契回撤",ClassName:"hqchart_drawtool icon-feibonaqihuiche",Type:0,Data:{ID:"FibRetracement"}},{Title:"斐波那契速度阻力扇",ClassName:"hqchart_drawtool icon-feibonaqisuduzulishan",Type:0,Data:{ID:"FibSpeedResistanceFan"}}]},{Title:"测量工具",AryChart:[{Title:"价格范围",ClassName:"hqchart_drawtool icon-shijianfanwei",Type:0,Data:{ID:"PriceRange"}},{Title:"时间范围",ClassName:"hqchart_drawtool icon-jiagefanwei",Type:0,Data:{ID:"DateRange"}},{Title:"价格和时间范围",ClassName:"hqchart_drawtool icon-jiagefanwei",Type:0,Data:{ID:"DatePriceRange"}},{Title:"监测线",ClassName:"hqchart_drawtool icon-jiance",Type:0,Data:{ID:"MonitorLine"}}]},{Title:"文字",AryChart:[{Title:"文字",ClassName:"hqchart_drawtool icon-draw_text",Type:0,Data:{ID:"文本"}},{Title:"锚点文字",ClassName:"hqchart_drawtool icon-maodianwenzi",Type:0,Data:{ID:"AnchoredText"}},{Title:"注释",ClassName:"hqchart_drawtool icon-maodian ",Type:0,Data:{ID:"Note"}},{Title:"价格标签",ClassName:"hqchart_drawtool icon-Tooltip",Type:0,Data:{ID:"PriceLabel"}},{Title:"价格注释",ClassName:"hqchart_drawtool icon-tooltiptext",Type:0,Data:{ID:"PriceNote"}},{Title:"向上箭头",ClassName:"iconfont icon-arrow_up",Type:0,Data:{ID:"icon-arrow_up"}},{Title:"向下箭头",ClassName:"iconfont icon-arrow_down",Type:0,Data:{ID:"icon-arrow_down"}},{Title:"向左箭头",ClassName:"iconfont icon-arrow_left",Type:0,Data:{ID:"icon-arrow_left"}},{Title:"向右箭头",ClassName:"iconfont icon-arrow_right",Type:0,Data:{ID:"icon-arrow_right"}}]}],this.ToolConfig={Title:"工具",AryTool:[{Title:"选中",ClassName:"hqchart_drawtool icon-arrow",Type:1,Data:{ID:Ee.CMD_SELECTED_ID}},{Title:"尺子",ClassName:"hqchart_drawtool icon-ruler",Type:0,Data:{ID:"尺子"}},{Title:"磁铁",ClassName:"hqchart_drawtool icon-xifu",Type:2,Data:{ID:Ee.CMD_ENABLE_MAGNET_ID}},{Title:"点击切换颜色",ClassName:"hqchart_drawtool icon-fangkuai",Type:2,Data:{ID:Ee.CMD_CHANGE_LINE_COLOR_ID}},{Title:"擦除画线",ClassName:"hqchart_drawtool icon-a-xiangpicachuxiangpica",Type:2,Data:{ID:Ee.CMD_ERASE_DRAW_CHART_ID}},{Title:"删除所有画线",ClassName:"hqchart_drawtool icon-recycle_bin",Type:2,Data:{ID:Ee.CMD_DELETE_ALL_DRAW_CHART_ID}}]},this.DivDialog=null,this.AryDivChart=[],this.HQChart=null,this.LineColor="rgb(255,140,0)",this.LineColorIndex=0,this.RandomLineColor=["rgb(255,69,0)","rgb(0,191,255)","rgb(255,0,255)","rgb(255,105,180)"],this.LineWidth=1*B(),this.ColumnCount=5,this.DragTitle=null,this.Inital=function(e){this.LineColor=d.DrawPicture.LineColor[0],this.RandomLineColor.splice(0,0,this.LineColor),this.HQChart=e},this.Create=function(){var e=this,a=document.createElement("div");a.className="UMyChart_DrawTool_Dialog_Div";var r=document.createElement("div");r.className="UMyChart_DrawTool_Title_Div",r.innerText="画图工具",r.onmousedown=function(u){e.OnMouseDownTitle(u)};var t=document.createElement("div");t.className="UMyChart_DrawTool_Close_Div",t.innerText="x",t.onmousedown=function(u){e.Close(u)},r.appendChild(t),a.appendChild(r);var n=document.createElement("table");n.className="UMyChart_DrawTool_Table",a.appendChild(n);var s=document.createElement("tbody");s.className="UMyChart_DrawTool_Tbody",n.appendChild(s);for(var o=0;o<this.AryChartGroup.length;++o){var l=this.AryChartGroup[o];if(v.IsNonEmptyArray(l.AryChart)){this.CreateChartGroupItem(l,s);var h=document.createElement("tr");h.className="UMyChart_DrawTool_Group_End_Tr",s.appendChild(h)}}this.CreateToolGroup(s),this.DivDialog=a,document.body.appendChild(a)},this.Destroy=function(){this.AryDivChart=[],this.DivDialog&&document.body.removeChild(this.DivDialog),this.DivDialog=null},this.CreateChartGroupItem=function(e,a){var r=document.createElement("tr");r.className="UMyChart_DrawTool_Group_Tr",a.appendChild(r);var t=document.createElement("td");t.className="UMyChart_DrawTool_Group_Td",t.innerText=e.Title,t.colSpan=this.ColumnCount,r.appendChild(t);for(var n=e.AryChart.length,s=0,o=0;s<n;){var r=document.createElement("tr");for(r.className="UMyChart_DrawTool_Tr",o=0;o<this.ColumnCount&&s<n;++o,++s){var l=e.AryChart[s];this.CreateChartItem(l,r)}a.appendChild(r)}},this.CreateChartItem=function(e,a){var r=this,t=document.createElement("td");t.className="UMyChart_DrawTool_Td",t.title=e.Title,a.appendChild(t);var n=document.createElement("span");n.className=e.ClassName,n.classList.add("UMyChart_DrawTool_Span"),t.appendChild(n);var s={Item:e,TD:t,Span:n};t.onmousedown=function(o){r.OnClickItem(o,s)},this.AryDivChart.push(s)},this.OnClickItem=function(e,a){if(console.log("[JSDialogDrawTool::OnClickChartItem] ",a),!(!a.Item||!a.Item.Data)){var r=a.Item.Type,t=a.Item.Data.ID;r==2&&t==Ee.CMD_CHANGE_LINE_COLOR_ID?this.OnChangeLineColor(a):r==2&&t==Ee.CMD_DELETE_ALL_DRAW_CHART_ID?this.DeleteAllChart():r==2&&t==Ee.CMD_ERASE_DRAW_CHART_ID?(this.ClearAllSelectedChart(),this.ClearCurrnetDrawPicture(),this.EnableEraseChart(!0)):r==1&&t==Ee.CMD_SELECTED_ID?(this.ClearAllSelectedChart(),this.ClearCurrnetDrawPicture(),this.EnableEraseChart(!1)):r==2&&t==Ee.CMD_ENABLE_MAGNET_ID?this.ChangeMagnet(a):r==0&&(this.ClearAllSelectedChart(),this.EnableEraseChart(!1),a.Span.classList.remove("UMyChart_DrawTool_Span"),a.Span.classList.add("UMyChart_DrawTool_Span_Selected"),this.CreateDrawPicture(a))}},this.ClearAllSelectedChart=function(){for(var e=0;e<this.AryDivChart.length;++e){var a=this.AryDivChart[e];a.Item.Type!=2&&(a.Span.classList.remove("UMyChart_DrawTool_Span_Selected"),a.Span.classList.add("UMyChart_DrawTool_Span"))}},this.CreateToolGroup=function(e){var a=document.createElement("tr");a.className="UMyChart_DrawTool_Group_Tr",e.appendChild(a);var r=document.createElement("td");r.className="UMyChart_DrawTool_Group_Td",r.innerText=this.ToolConfig.Title,r.colSpan=this.ColumnCount,a.appendChild(r);for(var t=this.ToolConfig.AryTool.length,n=0,s=0;n<t;){var a=document.createElement("tr");for(a.className="UMyChart_DrawTool_Tr",s=0;s<this.ColumnCount&&n<t;++s,++n){var o=this.ToolConfig.AryTool[n];this.CreateToolItem(o,a)}e.appendChild(a)}},this.CreateToolItem=function(e,a){var r=this,t=document.createElement("td");t.className="UMyChart_DrawTool_Td",t.title=e.Title,a.appendChild(t);var n=document.createElement("span");n.className=e.ClassName,n.classList.add("UMyChart_DrawTool_Span"),t.appendChild(n);var s={Item:e,TD:t,Span:n};e.Type==2&&e.Data.ID==Ee.CMD_CHANGE_LINE_COLOR_ID&&(n.style.color=this.LineColor),t.onmousedown=function(o){r.OnClickItem(o,s)},this.AryDivChart.push(s)},this.OnChangeLineColor=function(e){++this.LineColorIndex;var a=this.LineColorIndex%this.RandomLineColor.length;this.LineColor=this.RandomLineColor[a],e.Span.style.color=this.LineColor},this.DeleteAllChart=function(){this.HQChart&&this.HQChart.ClearChartDrawPicture()},this.SetEraseChartButtonStatus=function(e){for(var a=0;a<this.AryDivChart.length;++a){var r=this.AryDivChart[a];if(r.Item.Type==2&&r.Item.Data&&r.Item.Data.ID==Ee.CMD_ERASE_DRAW_CHART_ID){e?r.Span.classList.contains("UMyChart_DrawTool_Span")&&r.Span.classList.replace("UMyChart_DrawTool_Span","UMyChart_DrawTool_Span_Selected"):r.Span.classList.contains("UMyChart_DrawTool_Span_Selected")&&r.Span.classList.replace("UMyChart_DrawTool_Span_Selected","UMyChart_DrawTool_Span");break}}},this.EnableEraseChart=function(e){this.HQChart&&this.HQChart.EnableEraseChartDrawPicture!=e&&(this.HQChart.EnableEraseChartDrawPicture=e,this.SetEraseChartButtonStatus(e))},this.ChangeMagnet=function(e){if(this.HQChart){var a=!0;if(this.HQChart.ChartDrawOption.Magnet)var r=this.HQChart.ChartDrawOption.Magnet,a=!r.Enable;a?(this.HQChart.SetChartDrawOption({Magnet:{Enable:a,Type:0}}),e.Span.classList.remove("UMyChart_DrawTool_Span"),e.Span.classList.add("UMyChart_DrawTool_Span_Selected")):(this.HQChart.SetChartDrawOption({Magnet:{Enable:!1}}),e.Span.classList.remove("UMyChart_DrawTool_Span_Selected"),e.Span.classList.add("UMyChart_DrawTool_Span"))}},this.CreateDrawPicture=function(e){var a=this;if(!this.HQChart)return null;var r={LineColor:this.LineColor,LineWidth:this.LineWidth,PointColor:this.LineColor},t=e.Item.Data.ID;["icon-arrow_up","icon-arrow_down","icon-arrow_left","icon-arrow_right"].includes(t)?r=null:t=="InfoLine"?r.FormatLabelTextCallback=function(n){a.ChartInfoLine_FormatLabelText(n)}:t=="MonitorLine"&&(r.FormatLabelTextCallback=function(n){a.ChartDrawMonitorLine_FormatLabelText(n)}),this.HQChart.CreateChartDrawPicture(t,r,function(n){a.OnFinishDrawPicture(n,e)})},this.ClearCurrnetDrawPicture=function(){this.HQChart&&this.HQChart.ClearCurrnetDrawPicture()},this.OnFinishDrawPicture=function(e,a){a.Span.classList.remove("UMyChart_DrawTool_Span_Selected"),a.Span.classList.add("UMyChart_DrawTool_Span")},this.Show=function(e,a){this.DivDialog&&(this.DivDialog.style.visibility="visible",this.DivDialog.style.top=a+"px",this.DivDialog.style.left=e+"px")},this.Close=function(e){this.DivDialog&&(this.DivDialog.style.visibility="hidden")},this.IsShow=function(){return this.DivDialog?this.DivDialog.style.visibility==="visible":!1},this.OnMouseDownTitle=function(e){var a=this;if(this.DivDialog){var r={X:e.clientX,Y:e.clientY};r.YOffset=e.clientX-this.DivDialog.offsetLeft,r.XOffset=e.clientY-this.DivDialog.offsetTop,this.DragTitle=r,document.onmousemove=function(t){a.DocOnMouseMoveTitle(t)},document.onmouseup=function(t){a.DocOnMouseUpTitle(t)}}},this.DocOnMouseMoveTitle=function(e){if(this.DragTitle){var a=e.clientX-this.DragTitle.YOffset,r=e.clientY-this.DragTitle.XOffset,t=a+this.DivDialog.offsetWidth,n=r+this.DivDialog.offsetHeight;t+5>=window.innerWidth&&(a=window.innerWidth-this.DivDialog.offsetWidth-5),n+5>=window.innerHeight&&(r=window.innerHeight-this.DivDialog.offsetHeight-5),this.DivDialog.style.left=a+"px",this.DivDialog.style.top=r+"px",e.preventDefault&&e.preventDefault()}},this.DocOnMouseUpTitle=function(e){this.DragTitle=null,this.onmousemove=null,this.onmouseup=null},this.ChartInfoLine_FormatLabelText=function(e){if(v.IsNonEmptyArray(e.AryValue)&&!(!e.Data||!v.IsNonEmptyArray(e.Data.Data))){for(var a=0;a<e.AryValue.length;++a){var r=e.AryValue[a];if(!v.IsNumber(r.XValue)||r.XValue<0)return}var t=e.AryValue[0].XValue,n=e.AryValue[1].XValue,s=e.Data.Data[t],o=e.Data.Data[n];if(!(!s||!o)){var l=Y.IsMinutePeriod(e.Data.Period,!0);e.AryText=[],e.AryText.push({Name:"起始日期: ",Text:v.FormatDateString(s.Date),NameColor:"rgb(0,0,0)",TextColor:"rgb(30,10,30)"}),l&&e.AryText.push({Name:"起始时间: ",Text:v.FormatTimeString(s.Time,"HH:MM"),NameColor:"rgb(0,0,0)",TextColor:"rgb(30,10,30)"}),e.AryText.push({Name:"结束日期: ",Text:v.FormatDateString(o.Date),NameColor:"rgb(0,0,0)",TextColor:"rgb(30,10,30)"}),l&&e.AryText.push({Name:"结束时间: ",Text:v.FormatTimeString(o.Time,"HH:MM"),NameColor:"rgb(0,0,0)",TextColor:"rgb(30,10,30)"});var h=e.AryPoint[1].X-e.AryPoint[0].X,u=e.AryPoint[1].Y-e.AryPoint[0].Y,f="--";h!=0&&(f=""+(u/h).toFixed(4)),e.AryText.push({Name:"斜率: ",Text:f,NameColor:"rgb(0,0,0)",TextColor:"rgb(238, 0, 238)"}),e.AryText.push({Name:"其他: ",Text:"......",NameColor:"rgb(0,0,0)",TextColor:"rgb(156, 156, 156)"})}}},this.ChartDrawMonitorLine_FormatLabelText=function(e){if(!(!e.Data||!v.IsNonEmptyArray(e.Data.Data))&&!(!v.IsNumber(e.StartIndex)||e.StartIndex<0)){var a=e.Data.Data[e.StartIndex],r=e.Data.Data[e.Data.Data.length-1];e.YValue=r.Close;var t=Y.IsMinutePeriod(e.Data.Period,!0);e.AryText=[],e.AryText.push({Name:"起始: ",Text:v.FormatDateString(a.Date,"MM-DD"),NameColor:"rgb(0,0,0)",TextColor:"rgb(30,10,30)"}),t&&e.AryText.push({Name:"起始: ",Text:v.FormatTimeString(a.Time,"HH:MM"),NameColor:"rgb(0,0,0)",TextColor:"rgb(30,10,30)"}),e.AryText.push({Name:"最新: ",Text:v.FormatDateString(r.Date,"MM-DD"),NameColor:"rgb(0,0,0)",TextColor:"rgb(30,10,30)"}),t&&e.AryText.push({Name:"最新: ",Text:v.FormatTimeString(r.Time,"HH:MM"),NameColor:"rgb(0,0,0)",TextColor:"rgb(30,10,30)"}),e.AryText.push({Name:"ɑ: ",Text:"--.--",NameColor:"rgb(0, 0 ,255)",TextColor:"rgb(255, 165, 0)"}),e.AryText.push({Name:"β: ",Text:"--.--",NameColor:"rgb(0 ,0 ,255)",TextColor:"rgb(238 ,121, 66)"})}}}function Mg(){this.DivDialog=null,this.HQChart,this.ChartPicture,this.ColorButton=null,this.BGColorButton=null,this.FontColorButton=null,this.BorderColorButton=null,this.LockButton=null,this.RandomLineColor=["rgb(255,69,0)","rgb(173,255,47)","rgb(238,154,73)","rgb(255,105,180)"],this.RandomBGColor=["rgba(210,251,209，0.8)","rgb(217,217,253)","rgb(255,208,204)","rgb(252,249,206)"],this.RandomFontColor=["rgb(0,0,0)","rgb(255, 0, 0)","rgb(20, 255, 0)","rgb(255, 0, 255)"],this.RandomBorderColor=["rgb(0,0,0)","rgb(5, 246, 143)","rgb(139, 137, 137)","rgb(255, 20, 147)"],this.AryButton=[{Title:"修改线段颜色",ClassName:"hqchart_drawtool icon-huabi",Type:2,Data:{ID:Ee.CMD_CHANGE_LINE_COLOR_ID}},{Title:"修改字体颜色",ClassName:"hqchart_drawtool icon-zitiyanse",Type:2,Data:{ID:Ee.CMD_CHANGE_FONT_COLOR_ID}},{Title:"修改背景颜色",ClassName:"hqchart_drawtool icon-zitibeijingse",Type:2,Data:{ID:Ee.CMD_CHANGE_BG_COLOR_ID}},{Title:"修改边框颜色",ClassName:"hqchart_drawtool icon-biankuang",Type:2,Data:{ID:Ee.CMD_CHANGE_BORDER_COLOR_ID}},{Title:"上锁",ClassName:"hqchart_drawtool icon-lock",Type:2,Data:{ID:Ee.CMD_LOCK_DRAW_CHART_ID}},{Title:"删除图形",ClassName:"hqchart_drawtool icon-recycle_bin",Type:2,Data:{ID:Ee.CMD_DELETE_DRAW_CHART_ID}}],this.Inital=function(e){this.HQChart=e},this.Destroy=function(){this.ChartPicture=null,this.ColorButton=null,this.DivDialog&&(document.body.remove(this.DivDialog),this.DivDialog=null)},this.Create=function(){var e=this,a=document.createElement("div");a.className="UMyChart_Draw_Modify_Dialog_Div";var r=document.createElement("div");r.className="UMyChart_Draw_Modify_Dialog_Drag_Div",r.onmousedown=function(o){e.OnMouseDownTitle(o)},a.appendChild(r);var t=document.createElement("span");t.className="hqchart_drawtool icon-tuodong",t.classList.add("UMyChart_DrawTool_Span"),r.appendChild(t);for(var n=0;n<this.AryButton.length;++n){var s=this.AryButton[n];this.CreateButtonItem(s,a)}this.DivDialog=a,document.body.appendChild(a)},this.CreateButtonItem=function(e,a){var r=this,t=document.createElement("div");t.className="UMyChart_Draw_Modify_Dialog_Button_Div";var n=document.createElement("span");n.className="UMyChart_Draw_Modify_Tooltip",n.innerText=e.Title,t.appendChild(n);var s=document.createElement("span");s.className=e.ClassName,s.classList.add("UMyChart_DrawTool_Span"),t.appendChild(s);var o={Div:t,Span:s,Parent:a,Item:e,Tooltip:n};switch(t.onmousedown=function(l){r.OnClickButton(l,o)},t.onmouseover=function(l){r.OnHoverButton(l,o)},t.onmouseout=function(l){r.OnLeaveButton(l,o)},e.Data.ID){case Ee.CMD_CHANGE_LINE_COLOR_ID:this.ColorButton=o;break;case Ee.CMD_CHANGE_BG_COLOR_ID:this.BGColorButton=o,t.style.display="none";break;case Ee.CMD_CHANGE_FONT_COLOR_ID:this.FontColorButton=o,t.style.display="none";break;case Ee.CMD_CHANGE_BORDER_COLOR_ID:this.BorderColorButton=o,t.style.display="none";break;case Ee.CMD_LOCK_DRAW_CHART_ID:this.LockButton=o,this.LockButton.Span.style.color="rgb(220,220,220)";break}a.appendChild(t)},this.OnClickButton=function(e,a){if(console.log("[JSDialogModifyDraw::OnClickButton] ",a),!(!a.Item||!a.Item.Data)){var r=a.Item.Data.ID;switch(r){case Ee.CMD_CHANGE_LINE_COLOR_ID:this.ModifyLineColor();break;case Ee.CMD_DELETE_DRAW_CHART_ID:this.DeleteDrawPicture();break;case Ee.CMD_CHANGE_BG_COLOR_ID:this.ModifyBGColor();break;case Ee.CMD_CHANGE_FONT_COLOR_ID:this.ModifyFontColor();break;case Ee.CMD_CHANGE_BORDER_COLOR_ID:this.ModifyBorderColor();break;case Ee.CMD_LOCK_DRAW_CHART_ID:this.ModifyLockChart();break}}},this.OnHoverButton=function(e,a){a.Tooltip.style.display="inline"},this.OnLeaveButton=function(e,a){a.Tooltip.style.display="none"},this.Close=function(e){this.DivDialog&&(this.ChartPicture=null,this.DivDialog.style.visibility="hidden")},this.IsShow=function(){return this.DivDialog?this.DivDialog.style.visibility==="visible":!1},this.DeleteDrawPicture=function(){this.ChartPicture&&this.HQChart&&this.HQChart.ClearChartDrawPicture(this.ChartPicture),this.Close()},this.ShowButton=function(e,a){e.style.display!=a&&(e.style.display=a)},this.GetRandomColor=function(e,a){for(var r=0,t=0;t<a.length;++t)if(e==a[t]){r=t+1;break}r=r%a.length;var n=a[r];return n},this.ModifyLineColor=function(){if(!(!this.ChartPicture||!this.HQChart)){var e=this.GetRandomColor(this.ChartPicture.LineColor,this.RandomLineColor);this.ChartPicture.LineColor=e,this.ChartPicture.PointColor=e,this.ColorButton&&(this.ColorButton.Span.style.color=e),this.HQChart.ChartDrawStorage&&this.HQChart.ChartDrawStorage.SaveDrawData(this.ChartPicture),this.HQChart.Draw()}},this.ModifyFontColor=function(){if(!(!this.ChartPicture||!this.HQChart)){if(this.ChartPicture.ClassName=="ChartDrawNote"){var e=this.GetRandomColor(this.ChartPicture.NoteTextColor,this.RandomFontColor);this.ChartPicture.NoteTextColor=e}else{var e=this.GetRandomColor(this.ChartPicture.TextColor,this.RandomFontColor);this.ChartPicture.TextColor=e}this.FontColorButton&&(this.FontColorButton.Span.style.color=e),this.HQChart.ChartDrawStorage&&this.HQChart.ChartDrawStorage.SaveDrawData(this.ChartPicture),this.HQChart.Draw()}},this.ModifyBGColor=function(){if(!(!this.ChartPicture||!this.HQChart)){if(this.ChartPicture.ClassName=="ChartDrawNote"){var e=this.GetRandomColor(this.ChartPicture.NoteBGColor,this.RandomBGColor);this.ChartPicture.NoteBGColor=e}else{var e=this.GetRandomColor(this.ChartPicture.BGColor,this.RandomBGColor);this.ChartPicture.BGColor=e}this.BGColorButton&&(this.BGColorButton.Span.style.color=e),this.HQChart.ChartDrawStorage&&this.HQChart.ChartDrawStorage.SaveDrawData(this.ChartPicture),this.HQChart.Draw()}},this.ModifyLockChart=function(){!this.ChartPicture||!this.HQChart||(this.ChartPicture.EnableMove=!this.ChartPicture.EnableMove,this.LockButton&&(this.LockButton.Span.style.color=this.ChartPicture.EnableMove?"rgb(220,220,220)":"rgb(0,0,0)"))},this.ModifyBorderColor=function(){if(!(!this.ChartPicture||!this.HQChart)){if(this.ChartPicture.ClassName=="ChartDrawNote"){var e=this.GetRandomColor(this.ChartPicture.NoteBorderColor,this.RandomBorderColor);this.ChartPicture.NoteBorderColor=e}else{var e=this.GetRandomColor(this.ChartPicture.BorderColor,this.RandomBorderColor);this.ChartPicture.BorderColor=e}this.BorderColorButton&&(this.BorderColorButton.Span.style.color=e),this.HQChart.ChartDrawStorage&&this.HQChart.ChartDrawStorage.SaveDrawData(this.ChartPicture),this.HQChart.Draw()}},this.Show=function(e,a){this.DivDialog||this.Create(),this.DivDialog.style.visibility="visible",this.DivDialog.style.top=a+"px",this.DivDialog.style.left=e+"px"},this.SetChartPicture=function(e){this.ChartPicture=e;var a=!1,r=!1,t=!1,n=null,s=null,o=null,l=["ChartDrawPriceLabel","ChartDrawAnchoredText","ChartDrawPriceNote"];if(l.includes(e.ClassName)?(a=!0,r=!0,t=!0,n=e.BGColor,s=e.TextColor,o=e.BorderColor):e.ClassName=="ChartDrawNote"&&(a=!0,r=!0,t=!0,n=e.NoteBGColor,s=e.NoteTextColor,o=e.NoteBorderColor),this.ColorButton){var h=this.ColorButton;this.ShowButton(h.Div,"inline"),h.Span.style.color=e.LineColor}if(this.BGColorButton){var h=this.BGColorButton;this.ShowButton(h.Div,a?"inline":"none"),a&&(h.Span.style.color=n)}if(this.FontColorButton){var h=this.FontColorButton;this.ShowButton(h.Div,r?"inline":"none"),r&&(h.Span.style.color=s)}if(this.BorderColorButton){var h=this.BorderColorButton;this.ShowButton(h.Div,t?"inline":"none"),t&&(h.Span.style.color=o)}if(this.LockButton){var h=this.LockButton;h.Span.style.color=this.ChartPicture.EnableMove?"rgb(220,220,220)":"rgb(0,0,0)"}},this.OnMouseDownTitle=function(e){var a=this;if(this.DivDialog){var r={X:e.clientX,Y:e.clientY};r.YOffset=e.clientX-this.DivDialog.offsetLeft,r.XOffset=e.clientY-this.DivDialog.offsetTop,this.DragTitle=r,document.onmousemove=function(t){a.DocOnMouseMoveTitle(t)},document.onmouseup=function(t){a.DocOnMouseUpTitle(t)}}},this.DocOnMouseMoveTitle=function(e){if(this.DragTitle){var a=e.clientX-this.DragTitle.YOffset,r=e.clientY-this.DragTitle.XOffset,t=a+this.DivDialog.offsetWidth,n=r+this.DivDialog.offsetHeight;t+5>=window.innerWidth&&(a=window.innerWidth-this.DivDialog.offsetWidth-5),n+5>=window.innerHeight&&(r=window.innerHeight-this.DivDialog.offsetHeight-5),this.DivDialog.style.left=a+"px",this.DivDialog.style.top=r+"px",e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()}},this.DocOnMouseUpTitle=function(e){this.DragTitle=null,this.onmousemove=null,this.onmouseup=null}}function Sn(){this.DivDialog=null,this.TitleBox=null,this.HQChart=null,this.DragTitle=null,this.Date=null,this.ID=Re(),this.TitleColor=d.PopMinuteChart.TitleColor,this.TitleBGColor=d.PopMinuteChart.TitleBGColor,this.BGColor=d.PopMinuteChart.BGColor,this.BorderColor=d.PopMinuteChart.BorderColor,this.Minute={Option:Sn.GetMinuteOption(),JSChart:null,Date:null},this.Inital=function(e,a){if(this.HQChart=e,a&&v.IsObject(a.Option)){var r=At(a.Option);this.Minute.Option=(0,LC.default)(this.Minute.Option,r)}},this.Create=function(){var e=this,a=document.createElement("div");a.className="jchart_pop_minute_dailog",a.id=this.ID;var r=document.createElement("div");r.className="jschart_pop_minute_chart_Title_Div",r.onmousedown=function(l){e.OnMouseDownTitle(l)},a.appendChild(r);var t=document.createElement("div");t.className="jschart_pop_minute_chart_Title",t.innerText="分时图",this.DivInfoText=t,r.appendChild(t);var n=document.createElement("div");n.className="jschart_pop_minute_chart_Close_Div",n.innerText="x",n.onmousedown=function(l){e.Close(l)},r.appendChild(n);var s=document.createElement("div");s.className="jschart_pop_minute_chart",a.appendChild(s),this.TitleBox={DivTitle:r,DivName:t,DivColor:n},this.DivDialog=a;var o=Ht.Init(s);this.Minute.JSChart=o,this.HQChart&&(this.Minute.Option.Language=St.GetLanguageName(this.HQChart.LanguageID)),this.Minute.Option.OnCreatedCallback=function(l){e.OnCreateHQChart(l)},this.Minute.Option.NetworkFilter=function(l,h){e.NetworkFilter(l,h)},o.SetOption(this.Minute.Option),document.body.appendChild(a),this.UpdateStyle()},this.UpdateStyle=function(){this.DivDialog&&(this.BGColor&&(this.DivDialog.style["background-color"]=this.BGColor),this.BorderColor&&(this.DivDialog.style["border-color"]=this.BorderColor),this.TitleBGColor&&(this.TitleBox.DivTitle.style["background-color"]=this.TitleBGColor),this.TitleColor&&(this.TitleBox.DivName.style.color=this.TitleColor))},this.NetworkFilter=function(e,a){!this.HQChart||!this.HQChart.NetworkFilter||(e&&(e.PopMinuteData={Date:this.Date}),e.Name=="MinuteChartContainer::RequestMinuteData"&&(e.Request.Data.date=this.Date,e.Name="MinuteChartContainer::RequestPopMinuteData",e.Explain="指定日期分时数据"),this.HQChart.NetworkFilter(e,a))},this.OnCreateHQChart=function(e){},this.Destroy=function(){this.DivDialog&&document.body.removeChild(this.DivDialog),this.DivDialog=null,this.TitleBox=null,this.Minute.JSChart=null},this.IsShow=function(){return this.DivDialog?this.DivDialog.style.visibility==="visible":!1},this.Show=function(e,a,r){if(this.DivDialog||this.Create(),!(!e.Symbol||!v.IsPlusNumber(e.Date))){this.Date=e.Date;var t=e.Symbol;e.Name&&(t=e.Name);var n=t+" "+v.FormatDateString(e.Date)+" 分时图";this.TitleBox.DivName.innerText=n,this.Minute.JSChart&&this.Minute.JSChart.ChangeSymbol(e.Symbol);var s=this.DivDialog.offsetHeight,o=this.DivDialog.offsetWidth,l=window.innerWidth-5,h=window.innerHeight-5;a+o>l&&(a=l-o),r+s>h&&(r=h-s),this.DivDialog.style.visibility="visible",this.DivDialog.style.top=r+"px",this.DivDialog.style.left=a+"px"}},this.Close=function(e){this.DivDialog&&(this.DivDialog.style.visibility="hidden")},this.OnMouseDownTitle=function(e){var a=this;if(this.DivDialog){var r={X:e.clientX,Y:e.clientY};r.YOffset=e.clientX-this.DivDialog.offsetLeft,r.XOffset=e.clientY-this.DivDialog.offsetTop,this.DragTitle=r,document.onmousemove=function(t){a.DocOnMouseMoveTitle(t)},document.onmouseup=function(t){a.DocOnMouseUpTitle(t)}}},this.DocOnMouseMoveTitle=function(e){if(this.DragTitle){var a=e.clientX-this.DragTitle.YOffset,r=e.clientY-this.DragTitle.XOffset,t=a+this.DivDialog.offsetWidth,n=r+this.DivDialog.offsetHeight;t+5>=window.innerWidth&&(a=window.innerWidth-this.DivDialog.offsetWidth-5),n+5>=window.innerHeight&&(r=window.innerHeight-this.DivDialog.offsetHeight-5),this.DivDialog.style.left=a+"px",this.DivDialog.style.top=r+"px",e.preventDefault&&e.preventDefault()}},this.DocOnMouseUpTitle=function(e){this.DragTitle=null,this.onmousemove=null,this.onmouseup=null},this.ReloadResource=function(e){this.TitleColor=d.PopMinuteChart.TitleColor,this.TitleBGColor=d.PopMinuteChart.TitleBGColor,this.BGColor=d.PopMinuteChart.BGColor,this.BorderColor=d.PopMinuteChart.BorderColor,this.DivDialog&&(this.UpdateStyle(),this.Minute.JSChart&&this.Minute.JSChart.ReloadResource(e))},this.SetLanguage=function(e){this.DivDialog&&this.Minute.JSChart&&this.Minute.JSChart.SetLanguage(e)}}Sn.GetMinuteOption=function(){var e={Type:"分钟走势图",Windows:[],Symbol:null,IsAutoUpdate:!1,AutoUpdateFrequency:1e4,DayCount:1,IsShowRightMenu:!1,EnableSelectRect:!0,EnableZoomIndexWindow:!0,EnableResize:!0,CorssCursorInfo:{Left:2,Right:1,Bottom:1},MinuteLine:{},MinuteTitle:{IsShowTime:!0,IsShowName:!1,IsShowDate:!0,IsShowVolTitle:!0,IsTitleShowLatestData:!0},MinuteVol:{BarColorType:1},Border:{Left:20,Right:20,Top:25,Bottom:25,AutoLeft:{Blank:10,MinWidth:60},AutoRight:{Blank:10,MinWidth:60}},Frame:[{SplitCount:5},{SplitCount:3},{SplitCount:3}]};return e};function Gn(){this.DivDialog=null,this.HQChart=null,this.ID=Re(),this.BGColor=d.PopMinuteChart.BGColor,this.BorderColor=d.PopMinuteChart.BorderColor,this.OnCreateCallback,this.Minute={Option:Gn.GetMinuteOption(),JSChart:null,Symbol:null,Date:null},this.Inital=function(e,a){if(this.HQChart=e,a){if(v.IsObject(a.Option)){var r=At(a.Option);this.Minute.Option=(0,LC.default)(this.Minute.Option,r)}a.OnCreateCallback&&(this.OnCreateCallback=a.OnCreateCallback)}},this.Create=function(){var e=this,a=document.createElement("div");a.className="UMyChart_Tooltip_Minute_Div",a.id=this.ID;var r=document.createElement("div");r.className="UMyChart_Tooltip_Minute_Chart_Div",a.appendChild(r),this.DivDialog=a;var t=Ht.Init(r);this.Minute.JSChart=t,this.HQChart&&(this.Minute.Option.Language=St.GetLanguageName(this.HQChart.LanguageID)),this.Minute.Option.OnCreatedCallback=function(n){e.OnCreateHQChart(n)},this.Minute.Option.NetworkFilter=function(n,s){e.NetworkFilter(n,s)},t.SetOption(this.Minute.Option),document.body.appendChild(a),this.UpdateStyle()},this.UpdateStyle=function(){this.DivDialog&&(this.BGColor&&(this.DivDialog.style["background-color"]=this.BGColor),this.BorderColor&&(this.DivDialog.style["border-color"]=this.BorderColor))},this.NetworkFilter=function(e,a){!this.HQChart||!this.HQChart.NetworkFilter||this.HQChart.NetworkFilter(e,a)},this.OnCreateHQChart=function(e){this.OnCreateCallback&&this.OnCreateCallback(e)},this.Destroy=function(){this.DivDialog&&document.body.removeChild(this.DivDialog),this.DivDialog=null,this.TitleBox=null,this.Minute.JSChart||this.Minute.JSChart.ChartDestory(),this.Minute.JSChart=null},this.IsShow=function(){return this.DivDialog?this.DivDialog.style.visibility==="visible":!1},this.Show=function(e,a,r){if(this.DivDialog||this.Create(),!(!e||!e.Symbol)){var t=e.Symbol,n=null;if(v.IsPlusNumber(e.Date)&&(n=e.Date),this.Minute.JSChart&&(this.Minute.Symbol!=t||this.Minute.Date!=n)&&(this.Minute.Symbol=t,this.Minute.Date=n,this.Minute.JSChart.ChangeSymbol(t)),!v.IsNumberV2(a,r)){if(e.Rect){var s=e.Rect,o=B(),l={Left:s.Left/o,Right:s.Right/o,Bottom:s.Bottom/o,Top:s.Top/o};l.Width=l.Right-l.Left,l.Height=l.Bottom-l.Top;var h=this.DivDialog.offsetHeight,u=this.DivDialog.offsetWidth,a=l.Right+e.Offset.Left,r=l.Bottom+e.Offset.Top,f=window.innerWidth-5,C=window.innerHeight-5;a+u>f&&(a=l.Left+e.Offset.Left-u),r+h>C&&(r=l.Top+e.Offset.Top-h),this.DivDialog.style.visibility="visible",this.DivDialog.style.top=r+"px",this.DivDialog.style.left=a+"px"}}}},this.Hide=function(){this.DivDialog&&this.DivDialog.style.visibility!="hidden"&&(this.DivDialog.style.visibility="hidden")},this.ReloadResource=function(e){this.BGColor=d.PopMinuteChart.BGColor,this.BorderColor=d.PopMinuteChart.BorderColor,this.DivDialog&&(this.UpdateStyle(),this.Minute.JSChart&&this.Minute.JSChart.ReloadResource(e))}}Gn.GetMinuteOption=function(){var e={Type:"分钟走势图",Windows:[],Symbol:null,IsAutoUpdate:!1,AutoUpdateFrequency:1e4,DayCount:1,IsShowRightMenu:!1,EnableSelectRect:!0,EnableZoomIndexWindow:!0,EnableResize:!0,CorssCursorInfo:{Left:2,Right:1,Bottom:1},MinuteLine:{},MinuteTitle:{IsShowTime:!0,IsShowName:!0,IsShowDate:!0,IsShowVolTitle:!0,IsTitleShowLatestData:!0,ShowPostion:{Type:1,Margin:{Left:5*B(),Right:5*B()}}},MinuteVol:{BarColorType:1},Border:{Left:20,Right:120,Top:25,Bottom:25,AutoLeft:{Blank:10,MinWidth:40},AutoRight:{Blank:10,MinWidth:40}},Frame:[{SplitCount:5},{SplitCount:3},{SplitCount:3}]};return e};function dl(){this.DivDialog=null,this.DragTitle=null,this.TitleBox=null,this.InputDOM=null,this.Title="HQChart 键盘精灵",this.ID=Re(),this.ActiveDOM=null,this.InputStatus=0,this.BGColor=d.DialogPopKeyboard.BGColor,this.TitleColor=d.DialogPopKeyboard.TitleColor,this.TitleBGColor=d.DialogPopKeyboard.TitleBGColor,this.BorderColor=d.DialogPopKeyboard.BorderColor,this.InputBGColor=d.DialogPopKeyboard.Input.BGColor,this.InputTextColor=d.DialogPopKeyboard.Input.TextColor,this.Keyboard={Option:dl.GetOption(),JSChart:null},this.Inital=function(){var e=this;window.addEventListener("mousedown",function(a){e.OnWindowMouseDown(a)})},this.OnWindowMouseDown=function(e){this.DivDialog&&(console.log("[JSPopKeyboard::OnWindowMouseDown] e=",e),this.DivDialog.contains(e.target)||this.Hide())},this.Create=function(){var e=this,a=document.createElement("div");a.className="jchart_pop_keyboard_dailog",a.id=this.ID;var r=document.createElement("div");r.className="jschart_keyboard_Title_Div",r.onmousedown=function(u){e.OnMouseDownTitle(u)},a.appendChild(r);var t=document.createElement("div");t.className="jschart_keyboard_Title",t.innerText=this.Title,this.DivInfoText=t,r.appendChild(t);var n=document.createElement("div");n.className="jschart_keyboard_Close_Div",n.innerText="x",n.onmousedown=function(u){e.Hide()},r.appendChild(n),this.TitleBox={DivTitle:r,DivName:t,DivClose:n};var s=document.createElement("div");s.className="jschart_keyboard_Input_Div",a.appendChild(s);var o=document.createElement("input");o.className="jschart_keyboard_input",o.addEventListener("keydown",function(u){e.OnKeydown(u)}),o.addEventListener("keyup",function(u){e.OnKeyup(u)}),o.addEventListener("compositionstart",function(u){e.OnCompositionStart(u)}),o.addEventListener("compositionupdate",function(u){e.OnCompositionUpdate(u)}),o.addEventListener("compositionend",function(u){e.OnCompositionEnd(u)}),s.appendChild(o);var l=document.createElement("div");l.className="jschart_keyboard_Chart_Div",a.appendChild(l),this.DivDialog=a,this.InputDOM=o;var h=Ts.Init(l);this.Keyboard.JSChart=h,this.Keyboard.Option.OnCreatedCallback=function(u){e.OnCreateHQChart(u)},h.SetOption(this.Keyboard.Option),h.AddEventCallback({event:$.ON_KEYBOARD_MOUSEUP,callback:function(f,C,D){e.OnChartMouseUp(f,C,D)}}),this.UpdateStyle(),document.body.appendChild(a)},this.OnCreateHQChart=function(e){},this.OnCompositionStart=function(e){this.InputStatus=1},this.OnCompositionUpdate=function(e){},this.OnCompositionEnd=function(e){this.InputStatus=0},this.OnKeydown=function(e){if(this.InputStatus==0){var a=new Fe.default([40,38,13,33,34]);a.has(e.keyCode)&&this.Keyboard.JSChart.OnKeyDown(e),e.keyCode==27&&this.Hide()}},this.OnKeyup=function(e){if(this.InputStatus==0){var a=e.keyCode;if(a==8){var r=this.InputDOM.value;if(r.length==0){this.Hide();return}}if(a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122||a==8){var r=this.InputDOM.value;r=r.toUpperCase(),this.Keyboard.JSChart.Search(r)}}},this.OnMouseDownTitle=function(e){var a=this;if(this.DivDialog){var r={X:e.clientX,Y:e.clientY};r.YOffset=e.clientX-this.DivDialog.offsetLeft,r.XOffset=e.clientY-this.DivDialog.offsetTop,this.DragTitle=r,document.onmousemove=function(t){a.DocOnMouseMoveTitle(t)},document.onmouseup=function(t){a.DocOnMouseUpTitle(t)}}},this.DocOnMouseMoveTitle=function(e){if(this.DragTitle){var a=e.clientX-this.DragTitle.YOffset,r=e.clientY-this.DragTitle.XOffset,t=a+this.DivDialog.offsetWidth,n=r+this.DivDialog.offsetHeight;t+5>=window.innerWidth&&(a=window.innerWidth-this.DivDialog.offsetWidth-5),n+5>=window.innerHeight&&(r=window.innerHeight-this.DivDialog.offsetHeight-5),this.DivDialog.style.left=a+"px",this.DivDialog.style.top=r+"px",e.preventDefault&&e.preventDefault()}},this.DocOnMouseUpTitle=function(e){this.DragTitle=null,this.onmousemove=null,this.onmouseup=null},this.SetSymbolData=function(e){if(!this.Keyboard.JSChart)return!1;this.Keyboard.JSChart.SetSymbolData(e)},this.Show=function(){if(this.DivDialog){var e=this.DivDialog.offsetHeight,a=this.DivDialog.offsetWidth,r=window.innerWidth-5,t=window.innerHeight-5,n=r-a,s=t-e;this.DivDialog.style.visibility="visible",this.DivDialog.style.top=s+"px",this.DivDialog.style.left=n+"px"}},this.Hide=function(){this.DivDialog&&(this.DivDialog.style.visibility="hidden",this.InputDOM.value="",this.Keyboard.JSChart.ClearSearch(),this.ActiveDOM&&(this.ActiveDOM.focus&&this.ActiveDOM.focus(),this.ActiveDOM=null))},this.IsShow=function(){return this.DivDialog?this.DivDialog.style.visibility==="visible":!1},this.OnGlobalKeydown=function(e){if(this.DivDialog){var a=e.keyCode;a!=116&&(!this.IsShow()&&a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?(this.Show(),this.InputDOM.focus(),this.InputDOM.value==""&&(this.InputDOM.value=e.key,e.preventDefault()),e.target&&(this.ActiveDOM=e.target)):a==27&&this.IsShow()&&this.Hide())}},this.OnGlobalMouseDown=function(e){this.DivDialog&&this.DivDialog.style.display!="none"&&(this.DivDialog.contains(e.target)||this.Hide())},this.OnChartMouseUp=function(e,a,r){this.InputDOM.focus()},this.UpdateStyle=function(){this.DivDialog&&(this.BGColor&&(this.DivDialog.style["background-color"]=this.BGColor),this.BorderColor&&(this.DivDialog.style["border-color"]=this.BorderColor),this.InputBGColor&&(this.InputDOM.style["background-color"]=this.InputBGColor),this.InputTextColor&&(this.InputDOM.style.color=this.InputTextColor),this.TitleBGColor&&(this.TitleBox.DivTitle.style["background-color"]=this.TitleBGColor),this.TitleColor&&(this.TitleBox.DivName.style.color=this.TitleColor,this.TitleBox.DivClose.style.color=this.TitleColor))},this.ReloadResource=function(e){this.BGColor=d.DialogPopKeyboard.BGColor,this.TitleColor=d.DialogPopKeyboard.TitleColor,this.TitleBGColor=d.DialogPopKeyboard.TitleBGColor,this.BorderColor=d.DialogPopKeyboard.BorderColor,this.InputBGColor=d.DialogPopKeyboard.Input.BGColor,this.InputTextColor=d.DialogPopKeyboard.Input.TextColor,this.Keyboard.JSChart&&(this.Keyboard.JSChart.ReloadResource(),this.Keyboard.JSChart.Draw()),this.DivDialog&&this.UpdateStyle()}}dl.GetOption=function(){var e={Type:"键盘精灵",Border:{Left:1,Right:1,Bottom:1,Top:1},BorderLine:15,EnableResize:!0,Column:[{Type:Na.SHORT_SYMBOL_ID,Title:"代码",TextAlign:"left",Width:null,MaxText:"888888"},{Type:Na.NAME_ID,Title:"名称",TextAlign:"left",Width:null,MaxText:"擎擎擎擎擎擎擎擎"},{Type:Na.TYPE_NAME_ID,Title:"类型",TextAlign:"right",Width:null,MaxText:"擎擎擎擎擎"}]};return e};function Lg(){this.DivDialog=null,this.DragTitle=null,this.TitleBox=null,this.Style=0,this.HQChart=null,this.UpColor=d.UpTextColor,this.DownColor=d.DownTextColor,this.UnchangeColor=d.UnchagneTextColor,this.TitleColor=d.DialogTooltip.TitleColor,this.TitleBGColor=d.DialogTooltip.TitleBGColor,this.BGColor=d.DialogTooltip.BGColor,this.BorderColor=d.DialogTooltip.BorderColor,this.TextColor=d.DialogTooltip.TextColor,this.ValueColor=d.DialogTooltip.ValueColor,this.VolColor=d.DialogTooltip.VolColor,this.AmountColor=d.DialogTooltip.AmountColor,this.TurnoverRateColor=d.DialogTooltip.TurnoverRateColor,this.PositionColor=d.DialogTooltip.PositionColor,this.DateTimeColor=d.DialogTooltip.DateTimeColor,this.LanguageID=xe.LANGUAGE_CHINESE_ID,this.MaxRowCount=25,this.AryData=[],this.AryText=[],this.KItemCache=null,this.KItemCacheID=null,this.LastValueCache=null,this.LastValueCacheID=null,this.DataID=null,this.Inital=function(e,a){this.HQChart=e,a&&v.IsNumber(a.Style)&&(this.Style=a.Style)},this.Destroy=function(){this.AryData=[],this.AryText=[],this.KItemCache=null,this.KItemCacheID=null,this.DivDialog&&(document.body.removeChild(this.DivDialog),this.DivDialog=null)},this.OnClickColseButton=function(e){if(this.Close(e),this.HQChart&&this.HQChart.ChartCorssCursor){var a=this.HQChart.ChartCorssCursor;if(!a.IsShowCorss)return;a.IsShowCorss=!1,this.HQChart.Draw(),this.HQChart.SetFocus()}},this.IsEqualDataID=function(e){return!(!this.DataID||!e||this.DataID.Symbol!=e.Symbol||this.DataID.Date!=e.Date||v.IsNumber(this.DataID.Time)&&this.DataID.Time!=e.Time)},this.Create=function(){var e=this,a=document.createElement("div");a.className="UMyChart_Tooltip_Dialog_Div";var r=document.createElement("div");r.className="UMyChart_Tooltip_Title_Div",r.onmousedown=function(D){e.OnMouseDownTitle(D)};var t=document.createElement("div");t.className="UMyChart_Tooltip_Name_Div",t.innerText="----",r.appendChild(t);var n=document.createElement("div");n.className="UMyChart_Tooltip_Close_Div",n.innerText="x",n.onmousedown=function(D){e.OnClickColseButton(D)},r.appendChild(n),a.appendChild(r);var s=document.createElement("table");s.className="UMyChart_Tooltip_Table",a.appendChild(s);var o=document.createElement("tbody");if(o.className="UMyChart_Tooltip_Tbody",s.appendChild(o),this.AryData=[],this.Style==1)for(var l=0;l<this.MaxRowCount;++l){var h={Tr:null,TitleSpan:null,TextSpan:null,Tr2:null},u=document.createElement("tr");u.className="UMyChart_Tooltip_Group_Tr",o.appendChild(u),h.Tr=u;var f=document.createElement("td");f.className="UMyChart_Tooltip_Text_Sinlge_Td",u.appendChild(f);var C=document.createElement("span");C.className="UMyChart_Tooltip_Title_Left_Span",C.innerText="标题",f.appendChild(C),h.TitleSpan=C;var u=document.createElement("tr");u.className="UMyChart_Tooltip_Group_Tr",o.appendChild(u),h.Tr2=u;var f=document.createElement("td");f.className="UMyChart_Tooltip_Text_Sinlge_Td",u.appendChild(f);var C=document.createElement("span");C.className="UMyChart_Tooltip_Text_Span",C.innerText="数值",f.appendChild(C),h.TextSpan=C,this.AryData.push(h)}else for(var l=0;l<this.MaxRowCount;++l){var h={Tr:null,TitleSpan:null,TextSpan:null},u=document.createElement("tr");u.className="UMyChart_Tooltip_Group_Tr",o.appendChild(u),h.Tr=u;var f=document.createElement("td");f.className="UMyChart_Tooltip_Title_Td",u.appendChild(f);var C=document.createElement("span");C.className="UMyChart_Tooltip_Title_Span",C.innerText="标题",f.appendChild(C),h.TitleSpan=C;var f=document.createElement("td");f.className="UMyChart_Tooltip_Text_Td",u.appendChild(f);var C=document.createElement("span");C.className="UMyChart_Tooltip_Text_Span",C.innerText="数值",f.appendChild(C),h.TextSpan=C,this.AryData.push(h)}document.body.appendChild(a),this.DivName=t,this.DivDialog=a,this.TitleBox={DivTitle:r,DivName:t,DivColor:n},this.UpdateStyle()},this.UpdateKLineData=function(e){if(!(!e.KItem||!e.IsShowCorss)&&(this.LanguageID=this.HQChart.LanguageID,this.HQChart.ClassName=="KLineChartContainer")){var a=(0,Aa.default)(e.KItem),r=!1;this.KItemCacheID!=a&&(this.KItemCache=JSON.parse(a),this.KItemCacheID=a,r=!0),r&&this.UpdateTableDOM()}},this.UpdateMinuteData=function(e){if(!(!e.MinItem||!e.IsShowCorss)){var a=(0,Aa.default)(e.MinItem),r=!1;this.KItemCacheID!=a&&(this.KItemCache=JSON.parse(a),this.KItemCacheID=a,r=!0),r&&this.UpdateTableDOM()}},this.Update=function(e){if(!(!this.DivDialog||!this.TitleBox)){if(e.DataType==1){this.UpdateKLineData(e);return}else if(e.DataType==2){this.UpdateMinuteData(e);return}if(!(!e.KItem&&!e.MinItem||!e.IsShowCorss||e.ClientPos<0)){if(this.LanguageID=this.HQChart.LanguageID,this.HQChart.ClassName=="KLineChartContainer"){var a=(0,Aa.default)(e.KItem),r=(0,Aa.default)(e.LastValue),t=!1;this.KItemCacheID!=a&&(this.KItemCache=JSON.parse(a),this.KItemCacheID=a,t=!0),e.LastValue&&e.LastValue.Y&&v.IsNumber(e.LastValue.Y.Value)&&this.LastValueCacheID!=r&&(this.LastValueCache=JSON.parse(r),this.LastValueCacheID=r,t=!0),t&&(this.UpdateDataID(e),this.UpdateTableDOM())}else if(this.HQChart.ClassName=="MinuteChartContainer"){var a=(0,Aa.default)(e.MinItem),r=(0,Aa.default)(e.LastValue),t=!1;this.KItemCacheID!=a&&(this.KItemCache=JSON.parse(a),this.KItemCacheID=a,t=!0),e.LastValue&&e.LastValue.Y&&v.IsNumber(e.LastValue.Y.Value)&&this.LastValueCacheID!=r&&(this.LastValueCache=JSON.parse(r),this.LastValueCacheID=r,t=!0),t&&(this.UpdateDataID(e),this.UpdateTableDOM())}else return;this.TitleBox.DivName.innerText=e.Name,this.IsShow()||this.Show()}}},this.UpdateTableDOM=function(){if(this.KItemCache){if(this.HQChart.ClassName=="KLineChartContainer")this.AryText=this.GetFormatKLineTooltipText(this.KItemCache);else if(this.HQChart.ClassName=="MinuteChartContainer")this.AryText=this.GetFormatMinuteTooltipText(this.KItemCache);else return;var e=0;for(e=0;e<this.AryText.length&&e<this.MaxRowCount;++e){var a=this.AryText[e],r=this.AryData[e];r.TitleSpan.innerText=a.Title,r.TitleSpan.style.color=this.TextColor,r.TextSpan.innerText=a.Text,r.TextSpan.style.color=a.Color,r.Tr.style.display="",r.Tr2&&(r.Tr2.style.display="")}for(;e<this.MaxRowCount;++e){var r=this.AryData[e];r.Tr.style.display="none",r.Tr2&&(r.Tr2.style.display="none")}}},this.UpdateDataID=function(e){if(this.HQChart.ClassName=="KLineChartContainer"){var a=e.KItem;this.DataID={Symbol:e.Symbol,Date:a.Date,Time:null},v.IsNumber(a.Time)&&(this.DataID.Time=a.Time)}else if(this.HQChart.ClassName=="MinuteChartContainer"){var r=e.MinItem;if(r.Type==0){var t=r.Data;t&&(this.DataID={Symbol:e.Symbol,Date:t.Date,Time:t.Time})}else if(r.Type==1){var t=r.Data.Data;t&&(this.DataID={Symbol:e.Symbol,Date:t.Date,Time:t.Time})}}},this.Close=function(e){this.DivDialog&&(this.DivDialog.style.visibility="hidden")},this.OnMouseDownTitle=function(e){var a=this;if(this.DivDialog){var r={X:e.clientX,Y:e.clientY};r.YOffset=e.clientX-this.DivDialog.offsetLeft,r.XOffset=e.clientY-this.DivDialog.offsetTop,this.DragTitle=r,document.onmousemove=function(t){a.DocOnMouseMoveTitle(t)},document.onmouseup=function(t){a.DocOnMouseUpTitle(t)}}},this.DocOnMouseMoveTitle=function(e){if(this.DragTitle){var a=e.clientX-this.DragTitle.YOffset,r=e.clientY-this.DragTitle.XOffset,t=a+this.DivDialog.offsetWidth,n=r+this.DivDialog.offsetHeight;t+5>=window.innerWidth&&(a=window.innerWidth-this.DivDialog.offsetWidth-5),n+5>=window.innerHeight&&(r=window.innerHeight-this.DivDialog.offsetHeight-5),this.DivDialog.style.left=a+"px",this.DivDialog.style.top=r+"px",e.preventDefault&&e.preventDefault()}},this.DocOnMouseUpTitle=function(e){this.DragTitle=null,this.onmousemove=null,this.onmouseup=null},this.Show=function(s,o){if(!this.IsShow()&&this.DivDialog&&this.HQChart){var r=this.HQChart.Frame.ChartBorder.GetTop(),t=this.HQChart.Frame.ChartBorder.GetLeft(),n=this.HQChart.UIElement.getBoundingClientRect(),s=t+n.left+5,o=r+n.top+10;this.DivDialog.style.top=o+"px",this.DivDialog.style.left=s+"px",this.DivDialog.style.visibility="visible"}},this.IsShow=function(){return this.DivDialog?this.DivDialog.style.visibility==="visible":!1},this.GetFormatKLineTooltipText=function(e){var a=jt(this.HQChart.Symbol),r=this.HQChart.Symbol.toUpperCase(),t=U.GetVolUnit(r),n=0;this.Style==1&&(n=1);var s=this.ForamtDate(e.Date,"YYYY/MM/DD/W","DialogTooltip-Date"),o=null;v.IsNumber(e.Time)&&(o=this.FormatTime(e.Time,this.HQChart.Period,null,"DialogTooltip-Time"));var l=e.YClose,h=[this.ForamtPrice(e.Open,l,a,"DialogTooltip-Open",n),this.ForamtPrice(e.High,l,a,"DialogTooltip-High",n),this.ForamtPrice(e.Low,l,a,"DialogTooltip-Low",n),this.ForamtPrice(e.Close,l,a,"DialogTooltip-Close",n),this.FormatVol(e.Vol/t,"DialogTooltip-Vol"),this.FormatAmount(e.Amount,"DialogTooltip-Amount"),this.FormatIncrease(e.Close,l,a,"DialogTooltip-Increase",n),this.FormatAmplitude(e.High,e.Low,l,a,"DialogTooltip-Amplitude",n)];if(this.LastValueCache&&this.LastValueCache.Y){var u=this.LastValueCache.Y,f=null;u.Extend.FrameID==0?f=this.ForamtPrice(u.Value,null,a,"DialogTooltip-Value",2):f=this.ForamtValue(u.Value,2,"DialogTooltip-Value"),f&&h.unshift(f)}if(this.Style==1){o&&h.unshift(o);var s=this.ForamtDate(e.Date,"YYYY/MM/DD","DialogTooltip-Date");h.unshift(s)}else o&&h.unshift(o),h.unshift(s);U.IsSHSZStockA(r)&&e.FlowCapital>0&&h.push(this.FormatExchange(e.Vol,e.FlowCapital,"DialogTooltip-Exchange")),U.IsFutures(r)&&(h.push(this.FormatPosition(e.Position,"DialogTooltip-Position")),h.push(this.ForamtFClose(e.FClose,a,"DialogTooltip-FClose")));var C=this.HQChart.GetEventCallback($.ON_FORMAT_DIALOG_TOOLTIP);if(C&&C.Callback){var D={AryText:h,Data:e,Symbol:this.HQChart.Symbol,HQChart:this.HQChart,IsKLine:!0};C.Callback(C,D,this)}return h},this.GetFormatMinuteTooltipText=function(e){var a=jt(this.HQChart.Symbol),r=this.HQChart.Symbol.toUpperCase(),t=U.GetVolUnit(r),n=[];if(e.Type==0){var s=e.Data;if(s||(s={}),n=[this.ForamtDate(s.Date,this.Style==1?"MM/DD/W":"YYYY/MM/DD/W","DialogTooltip-Date"),this.FormatTime(s.Time,null,"HH:MM","DialogTooltip-Time"),this.ForamtPrice(s.Close,s.YClose,a,"DialogTooltip-Price",1),this.ForamtPrice(s.AvPrice,s.YClose,a,"DialogTooltip-AvPrice",1),this.FormatRisefall(s.Close,s.YClose,a,"DialogTooltip-Risefall"),this.FormatIncrease(s.Close,s.YClose,a,"DialogTooltip-Increase",1),this.FormatVol(s.Vol/t,"DialogTooltip-Vol"),this.FormatAmount(s.Amount,"DialogTooltip-Amount")],this.LastValueCache&&this.LastValueCache.Y){var s=this.LastValueCache.Y,o=null;s.Extend.FrameID==0?o=this.ForamtPrice(s.Value,null,a,"DialogTooltip-Value",2):o=this.ForamtValue(s.Value,2,"DialogTooltip-Value"),o&&n.splice(2,0,o)}}else if(e.Type==1){var s=e.Data.Data;s||(s={Vol:[]});var l="HH:MM:SS";s.Ver===1&&(l="HH:MM"),n=[this.ForamtDate(s.Date,this.Style==1?"MM/DD/W":"YYYY/MM/DD/W","DialogTooltip-Date"),this.FormatTime(s.Time,null,l,"DialogTooltip-Time"),this.ForamtPrice(s.Price,s.YClose,a,"DialogTooltip-AC-Price",1),this.FormatIncrease(s.Price,s.YClose,a,"DialogTooltip-AC-Increase",1),this.FormatVol(s.Vol[0]/t,"DialogTooltip-AC-Vol")]}var h=this.HQChart.GetEventCallback($.ON_FORMAT_DIALOG_TOOLTIP);if(h&&h.Callback){var u={AryText:n,Data:e,Symbol:this.HQChart.Symbol,HQChart:this.HQChart,IsMinute:!0};h.Callback(h,u,this)}return n},this.GetColor=function(e,a){return e>a?this.UpColor:e<a?this.DownColor:this.UnchangeColor},this.GetPriceColor=function(e,a){var r=this.GetColor(e,a);return r},this.ReloadResource=function(e){this.UpColor=d.UpTextColor,this.DownColor=d.DownTextColor,this.UnchangeColor=d.UnchagneTextColor,this.TitleColor=d.DialogTooltip.TitleColor,this.TitleBGColor=d.DialogTooltip.TitleBGColor,this.BGColor=d.DialogTooltip.BGColor,this.BorderColor=d.DialogTooltip.BorderColor,this.VolColor=d.DialogTooltip.VolColor,this.AmountColor=d.DialogTooltip.AmountColor,this.TurnoverRateColor=d.DialogTooltip.TurnoverRateColor,this.PositionColor=d.DialogTooltip.PositionColor,this.DateTimeColor=d.DialogTooltip.DateTimeColor,this.TextColor=d.DialogTooltip.TextColor,this.ValueColor=d.DialogTooltip.ValueColor,this.DivDialog&&this.UpdateStyle()},this.UpdateStyle=function(){this.DivDialog&&(this.BGColor&&(this.DivDialog.style["background-color"]=this.BGColor),this.BorderColor&&(this.DivDialog.style["border-color"]=this.BorderColor),this.TitleBGColor&&(this.TitleBox.DivTitle.style["background-color"]=this.TitleBGColor),this.TitleColor&&(this.TitleBox.DivName.style.color=this.TitleColor),this.UpdateTableDOM())},this.ForamtPrice=function(e,a,r,t,n){var s={Title:St.GetText(t,this.LanguageID),Text:"--.--",Color:this.ValueColor};if(!v.IsNumber(e))return s;if(n==2)return s.Text=e.toFixed(r),s.Color=this.ValueColor,s;if(v.IsNumber(a)&&n!=1){var o=(e-a)/a*100;s.Text=e.toFixed(r)+"("+o.toFixed(2)+"%)"}else s.Text=e.toFixed(r);return s.Color=this.GetColor(e,a),s},this.ForamtValue=function(e,a,r){var t={Title:St.GetText(r,this.LanguageID),Text:"--",Color:this.ValueColor};return v.IsNumber(e)&&(t.Text=v.FormatValueStringV2(e,a,2,this.LanguageID)),t},this.FormatVol=function(e,a){var r={Title:St.GetText(a,this.LanguageID),Text:"--",Color:this.VolColor};return v.IsNumber(e)&&(r.Text=v.FormatValueStringV2(e,0,2,this.LanguageID)),r},this.FormatAmount=function(e,a){var r={Title:St.GetText(a,this.LanguageID),Text:"--",Color:this.AmountColor};return v.IsNumber(e)&&(r.Text=v.FormatValueString(e,2,this.LanguageID)),r},this.FormatIncrease=function(e,a,r,t,n){var s={Title:St.GetText(t,this.LanguageID),Text:"--.--",Color:this.ValueColor};if(!v.IsNumber(e)||!v.IsNumber(a))return s;var o=e-a,l=(e-a)/a;return n==1?s.Text=(l*100).toFixed(2)+"%":s.Text=o.toFixed(r)+"("+(l*100).toFixed(2)+"%)",s.Color=this.GetColor(l,0),s},this.FormatRisefall=function(e,a,r,t){var n={Title:St.GetText(t,this.LanguageID),Text:"--.--",Color:this.ValueColor};if(!v.IsNumber(e)||!v.IsNumber(a))return n;var s=e-a;return n.Text=""+s.toFixed(r),n.Color=this.GetColor(s,0),n},this.FormatAmplitude=function(e,a,r,t,n,s){var o={Title:St.GetText(n,this.LanguageID),Text:"--.--",Color:this.ValueColor};if(!v.IsNumber(e)||!v.IsNumber(a)||!v.IsNumber(r))return o;var l=e-a,h=(e-a)/r;return s==1?o.Text=(h*100).toFixed(2)+"%":o.Text=l.toFixed(t)+"("+(h*100).toFixed(2)+"%)",o.Color=this.GetColor(h,0),o},this.ForamtDate=function(e,a,r){var t={Title:St.GetText("DialogTooltip-Date",this.LanguageID),Text:"----/--/--",Color:this.DateTimeColor};return v.IsNumber(e)&&(t.Text=v.FormatDateString(e,a)),t},this.FormatTime=function(e,a,r,t){var n={Title:St.GetText(t,this.LanguageID),Text:"--:--",Color:this.DateTimeColor};return v.IsNumber(e)&&(r||(r="HH:MM",Y.IsMinutePeriod(a,!0)?r="HH:MM":Y.IsSecondPeriod(a)?r="HH:MM:SS":Y.IsMilliSecondPeriod(a)&&(r="HH:MM:SS.fff")),n.Text=v.FormatTimeString(e,r)),n},this.FormatExchange=function(e,a,r){var t={Title:St.GetText(r,this.LanguageID),Text:"--.--",Color:this.DateTimeColor};if(!v.IsNumber(e)||!v.IsNumber(a)||a==0)return t;var n=e/a*100;return t.Text=n.toFixed(2)+"%",t},this.FormatPosition=function(e,a){var r={Title:St.GetText(a,this.LanguageID),Text:"--.--",Color:this.PositionColor};return v.IsNumber(e)&&(r.Text=e.toFixed(0)),r},this.ForamtFClose=function(e,a,r){var t={Title:St.GetText(r,this.LanguageID),Text:"--.--",Color:this.DateTimeColor};return v.IsNumber(e)&&(t.Text=e.toFixed(a)),t}}function Rg(){this.DivDialog=null,this.Style=0,this.HQChart=null,this.MaxRowCount=25,this.UpColor=d.UpTextColor,this.DownColor=d.DownTextColor,this.UnchangeColor=d.UnchagneTextColor,this.BGColor=d.FloatTooltip.BGColor,this.BorderColor=d.FloatTooltip.BorderColor,this.TextColor=d.FloatTooltip.TextColor,this.ValueColor=d.FloatTooltip.ValueColor,this.VolColor=d.FloatTooltip.VolColor,this.AmountColor=d.FloatTooltip.AmountColor,this.TurnoverRateColor=d.FloatTooltip.TurnoverRateColor,this.PositionColor=d.FloatTooltip.PositionColor,this.DateTimeColor=d.FloatTooltip.DateTimeColor,this.LanguageID=xe.LANGUAGE_CHINESE_ID,this.ValueAlign={Left:"UMyChart_Tooltip_Float_Text2_Span",MarginLeft:"UMyChart_Tooltip_Float_Text3_Span",Right:"UMyChart_Tooltip_Float_Text_Span"},this.AryData=[],this.AryText=[],this.KItemCache=null,this.KItemCacheID=null,this.Inital=function(e,a){this.HQChart=e,a&&(v.IsNumber(a.Style)&&(this.Style=a.Style),v.IsNumber(a.MaxRowCount)&&(this.MaxRowCount=a.MaxRowCount))},this.Destroy=function(){this.AryData=[],this.AryText=[],this.KItemCache=null,this.KItemCacheID=null,this.DivDialog&&(document.body.removeChild(this.DivDialog),this.DivDialog=null)},this.Show=function(e,a,r){if(this.DivDialog&&this.HQChart){var t=this.HQChart.UIElement.getBoundingClientRect(),n=0;r&&v.IsNumber(r.YMove)&&(n=r.YMove);var s=e+t.left,o=a+t.top+n,l=s+this.DivDialog.offsetWidth,h=o+this.DivDialog.offsetHeight;l+5>=window.innerWidth&&(s=s-this.DivDialog.offsetWidth),h+5>=window.innerHeight&&(o=a+t.top-this.DivDialog.offsetHeight),this.DivDialog.style.top=o+"px",this.DivDialog.style.left=s+"px",this.DivDialog.style.visibility!="visible"&&(this.DivDialog.style.visibility="visible")}},this.Hide=function(){this.DivDialog&&(this.KItemCache=null,this.KItemCacheID=null,this.DivDialog.style.visibility!="hidden"&&(this.DivDialog.style.visibility="hidden"))},this.Create=function(){var e=document.createElement("div");e.className="UMyChart_Tooltip_Float_Div";var a=document.createElement("table");a.className="UMyChart_Tooltip_Float_Table",e.appendChild(a);var r=document.createElement("tbody");r.className="UMyChart_Tooltip_Float_Tbody",a.appendChild(r),this.AryData=[];for(var t=0;t<this.MaxRowCount;++t){var n={Tr:null,TitleSpan:null,TextSpan:null,TitleTd:null,TextTd:null},s=document.createElement("tr");s.className="UMyChart_Tooltip_Float_Group_Tr",r.appendChild(s),n.Tr=s;var o=document.createElement("td");o.className="UMyChart_Tooltip_Float_Title_Td",s.appendChild(o),n.TitleTd=o;var l=document.createElement("span");l.className="UMyChart_Tooltip_Float_Title_Span",l.innerText="标题",o.appendChild(l),n.TitleSpan=l;var o=document.createElement("td");o.className="UMyChart_Tooltip_Float_Text_Td",s.appendChild(o),n.TextTd=o;var l=document.createElement("span");l.className="UMyChart_Tooltip_Float_Text_Span",l.innerText="数值",o.appendChild(l),n.TextSpan=l,this.AryData.push(n)}document.body.appendChild(e),this.DivDialog=e,this.UpdateStyle()},this.IsShow=function(){return this.DivDialog?this.DivDialog.style.visibility==="visible":!1},this.IsEqualHQID=function(e){if(!this.KItemCache||!e||!this.KItemCache.Item)return!1;var a=this.KItemCache.Item;return!(this.KItemCache.Symbol!=e.Symbol||a.Date!=e.Date||v.IsNumber(a.Time)&&a.Time!=e.Time)},this.UpdateStyle=function(){this.DivDialog&&(this.BGColor&&(this.DivDialog.style["background-color"]=this.BGColor),this.BorderColor&&(this.DivDialog.style["border-color"]=this.BorderColor))},this.Update=function(e){if(this.DivDialog)if(this.LanguageID=this.HQChart.LanguageID,e.DataType==1){var a=e.Tooltip;if(!a)return;a.Type==0?this.UpdateKLineToolitp(e):a.Type==1?this.UpdateKLineInfoTooltip(e):a.Type==2?this.UpdateTradeIndexTooltip(e):a.Type==3?this.UpdateMinuteInfoTooltip(e):a.Type==4?this.UpdatMultiSVGIconV2Tooltip(e):a.Type==5?this.UpdatChartOXTooltip(e):a.Type==6?this.UpdatChartScatterPlotTooltip(e):a.Type==7?this.UpdateChartDrawSVGTooltip(e):a.Type==8&&this.UpdateChartDrawSVGV2Tooltip(e)}else e.DataType==2&&this.UpdateRealtimeHQTooltip(e)},this.UpdateRealtimeHQTooltip=function(e){if(this.KItemCache){var a={Symbol:e.Symbol,Name:this.KItemCache.Name,Item:e.Data,IsOverlay:this.KItemCache.IsOverlay},r=(0,Aa.default)(a),t=!1;this.KItemCacheID!=r&&(this.KItemCache=a,this.KItemCacheID=r,this.AryText=this.GetFormatKLineTooltipText(this.KItemCache),t=!0),t&&this.UpdateTableDOM()}},this.ShowTooltip=function(e){if(e.Point){var a=e.Point.X,r=e.Point.Y;this.Show(a,r,{YMove:e.Point.YMove})}},this.UpdateKLineToolitp=function(e){var a=e.Tooltip,r=e.Symbol,t=e.Name,n=!1;a.ChartPaint.Name=="Overlay-KLine"&&(r=a.ChartPaint.Symbol,t=a.ChartPaint.Title,n=!0);var s={Symbol:r,Name:t,Item:At(a.Data),IsOverlay:n},o=(0,Aa.default)(s),l=!1;this.KItemCacheID!=o&&(this.KItemCache=s,this.KItemCacheID=o,this.AryText=this.GetFormatKLineTooltipText(this.KItemCache),l=!0),l&&this.UpdateTableDOM(),this.ShowTooltip(e)},this.UpdateChartDrawSVGTooltip=function(e){var a=e.Tooltip;if(!(!a.Data||!a.Data.Item||!a.Data.Item.Tooltip)){var r=a.Data.Item.Tooltip,t=[],n={Text:"",HTMLTitle:r.Text,Color:this.ValueColor,IsMergeCell:!0};t.push(n),this.AryText=t,this.UpdateTableDOM(),this.ShowTooltip(e)}},this.UpdateChartDrawSVGV2Tooltip=function(e){var a=e.Tooltip;if(!(!a.Data||!a.Data.Item||!a.Data.Item.Tooltip)){var r=a.Data.Item.Tooltip.AryText;if(v.IsNonEmptyArray(r)){for(var t=[],n=0;n<r.length;++n){var s=r[n],o={Title:"",Text:"",Color:this.ValueColor,ClassName:this.ValueAlign.MarginLeft};s.TextColor&&(o.Color=s.TextColor),s.Title&&(o.Title=s.Title),s.Text&&(o.Text=s.Text),t.push(o)}this.AryText=t,this.UpdateTableDOM(),this.ShowTooltip(e)}}},this.UpdateTradeIndexTooltip=function(e){var a=e.Tooltip;if(!(!a.Data||!a.Data.Data)){var r=a.Data.Data,t=r.KData,n=[],o={Title:"日期",Text:v.FormatDateString(t.Date,"YYYY-MM-DD"),Color:this.ValueColor};if(n.push(o),v.IsNumber(t.Time)){var s="HH:MM",o={Title:"时间",Text:v.FormatTimeString(t.Time,s),Color:this.ValueColor};n.push(o)}var o={Title:"指标名称:",Text:""+r.Name+r.Param,Color:this.ValueColor};n.push(o);var o={Title:"买卖方向:",Text:r.Type==1?"买入":"卖出",Color:r.Type==1?this.UpColor:this.DownColor};n.push(o);var o={};this.AryText=n,this.UpdateTableDOM(),this.ShowTooltip(e)}},this.UpdateMinuteInfoTooltip=function(e){var a=e.Tooltip;if(!(!a.Data||!a.Data.Data||!a.Data.Data.Item)){var r=a.Data.Data.Item,t=[],s={Title:"日期",Text:v.FormatDateString(r.Date,"YYYY-MM-DD"),Color:this.ValueColor};t.push(s);var n="HH:MM",s={Title:"时间",Text:v.FormatTimeString(r.Time,n),Color:this.ValueColor};t.push(s);var s={Title:"异动",Text:r.Title,Color:this.ValueColor};t.push(s),this.AryText=t,this.UpdateTableDOM(),this.ShowTooltip(e)}},this.UpdatMultiSVGIconV2Tooltip=function(e){var a=e.Tooltip;if(!(!a.Data||!a.Data.Item)){var r=a.Data.Item,t=[];if(r&&v.IsObject(r.Text)){var a=r.Text;if(v.IsNonEmptyArray(a.AryText))for(var n=0;n<a.AryText.length;++n){var s=a.AryText[n],o={Title:s.Title,Text:s.Text,Color:this.ValueColor};s.Color&&(o.Color=s.Color),s.Align=="Left"&&(s.ClassName=this.ValueAlign.Left),t.push(s)}}else{var l={Text:"",HTMLTitle:r.Text,Color:this.ValueColor,IsMergeCell:!0};t.push(l)}this.AryText=t,this.UpdateTableDOM(),this.ShowTooltip(e)}},this.UpdatChartOXTooltip=function(e){var a=e.Tooltip;if(!(!a.Data||!a.Data.Data)){var r=a.Data.Data,t=this.HQChart.Period,n=[];if(Y.IsDayPeriod(t,!0)){var s=v.FormatDateString(r.Start.Date,"YYYY-MM-DD"),o=v.FormatDateString(r.End.Date,"YYYY-MM-DD");n.push({Title:"起始时间",Text:s,Color:this.ValueColor}),n.push({Title:"结束时间",Text:o,Color:this.ValueColor})}else if(Y.IsMinutePeriod(t,!0)){var s=v.FormatDateString(r.Start.Date),l=v.FormatTimeString(r.Start.Time,"HH:MM"),o=v.FormatDateString(r.End.Date),h=v.FormatTimeString(r.End.Time,"HH:MM");n.push({Title:"起始时间",Text:s+" "+l,Color:this.ValueColor}),n.push({Title:"结束时间",Text:o+" "+h,Color:this.ValueColor})}this.AryText=n,this.UpdateTableDOM(),this.ShowTooltip(e)}},this.UpdateTableDOM=function(){var e=0;for(e=0;e<this.AryText.length&&e<this.MaxRowCount;++e){var a=this.AryText[e],r=this.AryData[e];a.HTMLTitle?r.TitleSpan.innerHTML=a.HTMLTitle:r.TitleSpan.innerText=a.Title,r.TitleSpan.style.color=this.TextColor,a.HTMLText?r.TextSpan.innerHTML=a.HTMLText:r.TextSpan.innerText=a.Text,r.TextSpan.style.color=a.Color,r.TextTd.style.color=a.Color,a.ClassName?r.TextSpan.className=a.ClassName:r.TextSpan.className!=this.ValueAlign.Right&&(r.TextSpan.className=this.ValueAlign.Right),a.IsMergeCell?(r.TitleTd.colspan=2,r.TextTd.style.display="none"):(r.TitleTd.colspan!=1&&(r.TitleTd.colspan=1),r.TextTd.style.display=""),r.Tr.style.display="",r.Tr2&&(r.Tr2.style.display="none")}for(;e<this.MaxRowCount;++e){var r=this.AryData[e];r.Tr.style.display="none",r.Tr2&&(r.Tr2.style.display="none")}},this.GetFormatKLineTooltipText=function(e){var a=e.Item,r=e.Symbol,t=r.toUpperCase(),n=jt(r),s=U.GetVolUnit(t),o=this.ForamtDate(a.Date,"YYYY/MM/DD/W","FloatTooltip-Date"),l=null;v.IsNumber(a.Time)&&(l=this.FormatTime(a.Time,this.HQChart.Period,null,"FloatTooltip-Time"));var h=null;e.IsOverlay&&(h={Title:"",Text:e.Name,Color:this.TextColor,ClassName:this.ValueAlign.Left});var u=a.YClose,f=[this.ForamtPrice(a.Open,u,n,"FloatTooltip-Open"),this.ForamtPrice(a.High,u,n,"FloatTooltip-High"),this.ForamtPrice(a.Low,u,n,"FloatTooltip-Low"),this.ForamtPrice(a.Close,u,n,"FloatTooltip-Close"),this.ForamtPrice(a.YClose,a.YClose,n,"FloatTooltip-YClose"),this.FormatVol(a.Vol/s,"FloatTooltip-Vol"),this.FormatAmount(a.Amount,"FloatTooltip-Amount"),this.FormatIncrease(a.Close,u,n,"FloatTooltip-Increase"),this.FormatAmplitude(a.High,a.Low,u,n,"FloatTooltip-Amplitude")];l&&f.unshift(l),f.unshift(o),h&&f.unshift(h),U.IsSHSZStockA(t)&&a.FlowCapital>0&&f.push(this.FormatExchange(a.Vol,a.FlowCapital,"FloatTooltip-Exchange")),U.IsFutures(t)&&(f.push(this.FormatPosition(a.Position,"FloatTooltip-Position")),f.push(this.ForamtFClose(a.FClose,n,"FloatTooltip-FClose")),f.push(this.ForamtFClose(a.YFClose,n,"FloatTooltip-YSettlePrice")));var C=this.HQChart.GetEventCallback($.ON_FORMAT_KLINE_FLOAT_TOOLTIP);if(C&&C.Callback){var D={AryText:f,Data:e,HQChart:this.HQChart};C.Callback(C,D,this)}return f},this.UpdateKLineInfoTooltip=function(e){for(var a=e.Tooltip,r=e.Symbol,t=jt(r),n=a.Data.Data,s=[],o=0;o<n.length;++o){var l=n[o],h=l.InfoType;switch(h){case ee.BLOCKTRADING:this.FormatBlockTradingText(l,t,s);break;case ee.TRADEDETAIL:this.FormatTradeDetailText(l,t,s);break;case ee.RESEARCH:this.FormatResearchText(l,s);break;case ee.PFORECAST:this.FormatPerformanceForecastText(l,s);break;default:this.FormatDefaultKLineInfoText(l,s);break}}var u=this.HQChart.GetEventCallback($.ON_FORMAT_KLINE_INFO_FLOAT_TOOLTIP);if(u&&u.Callback){var f={AryText:s,Data:e,HQChart:this.HQChart};u.Callback(u,f,this)}this.AryText=s,this.UpdateTableDOM(),this.ShowTooltip(e)},this.UpdatChartScatterPlotTooltip=function(e){var a=e.Tooltip;if(!(!a.Data||!a.Data.Data||!a.Data.Data.Tooltip)){for(var r=a.Data.Data.Tooltip,t=[],n=0;n<r.length;++n){var s=r[n];if(!(!s.Text&&!s.Title)){var o={Title:"",Text:"",Color:this.ValueColor};s.Title&&(o.Title=s.Title),s.Text&&(o.Text=s.Text),s.TextColor&&(o.Color=s.TextColor),t.push(o)}}this.AryText=t,this.UpdateTableDOM(),this.ShowTooltip(e)}},this.FormatDefaultKLineInfoText=function(s,a){var r,t=v.FormatDateString(s.Date,"YYYY-MM-DD");if(v.IsNumber(s.Time)){var n=v.FormatTimeString(s.Time);r=t+" "+n}else r=t;var s={Title:r,Text:s.Title,Color:this.ValueColor,ClassName:this.ValueAlign.MarginLeft};a.push(s)},this.FormatBlockTradingText=function(e,a,r){var n={Title:"",Text:"大宗交易",Color:this.TextColor,ClassName:this.ValueAlign.Left};r.push(n);var n={Title:"日期",Text:v.FormatDateString(e.Date,"YYYY-MM-DD"),Color:this.ValueColor};r.push(n);var t=e.ExtendData,n={Title:"成交价:",Text:t.Price.toFixed(a),Color:this.ValueColor};r.push(n);var n={Title:"收盘价:",Text:t.ClosePrice.toFixed(a),Color:this.ValueColor};r.push(n);var n={Title:"溢折价率:",Text:t.Premium.toFixed(2),Color:this.GetColor(t.Premium,0)};r.push(n);var n={Title:"成交量:",Text:v.FormatValueStringV2(t.Vol,0,2,this.LanguageID),Color:this.VolColor};r.push(n)},this.FormatTradeDetailText=function(e,a,r){if(e.ExtendData){var t=e.ExtendData;if(v.IsNonEmptyArray(t.Detail)){var n={Title:"日期",Text:v.FormatDateString(e.Date,"YYYY-MM-DD"),Color:this.ValueColor,ClassName:this.ValueAlign.MarginLeft};r.push(n);for(var s=0;s<t.Detail.length;++s){var o=t.Detail[s];if(s==0)var n={Title:"上榜原因:",Text:o.TypeExplain,Color:this.ValueColor,ClassName:this.ValueAlign.MarginLeft};else var n={Title:"",Text:o.TypeExplain,Color:this.ValueColor,ClassName:this.ValueAlign.MarginLeft};r.push(n)}if(t.FWeek){var l=t.FWeek.Week1;if(v.IsNumber(l)){var n={Title:"一周后涨幅:",Text:l.toFixed(2)+"%",Color:this.GetColor(l,0),ClassName:this.ValueAlign.MarginLeft};r.push(n)}var l=t.FWeek.Week4;if(v.IsNumber(l)){var n={Title:"四周后涨幅:",Text:l.toFixed(2)+"%",Color:this.GetColor(l,0),ClassName:this.ValueAlign.MarginLeft};r.push(n)}}}}},this.FormatResearchText=function(e,a){if(e.ExtendData){var r=e.ExtendData,t={Title:"日期",Text:v.FormatDateString(e.Date,"YYYY-MM-DD"),Color:this.ValueColor,ClassName:this.ValueAlign.MarginLeft};if(a.push(t),v.IsNonEmptyArray(r.Level)){for(var n="",s=0;s<r.Level.length;++s){var o=r.Level[s];n.length>0&&(n+=","),o==0?n+="证券代表":o==1?n+="董秘":o==2?n+="总经理":o==3&&(n+="董事长")}var t={Title:"接待人员:",Text:n,Color:this.ValueColor,ClassName:this.ValueAlign.MarginLeft};a.push(t)}else{var t={Title:"接待人员",Text:"----",Color:this.ValueColor,ClassName:this.ValueAlign.MarginLeft};a.push(t)}if(r.Type){var t={Title:"",Text:r.Type,Color:this.ValueColor,ClassName:this.ValueAlign.MarginLeft};a.push(t)}}},this.FormatPerformanceForecastText=function(e,a){if(e.ExtendData){var r=e.ExtendData,t=r.ReportDate;if(t){var n=parseInt(t/1e4),s=t%1e4,o="----";s==1231?o="年报":s==331?o="一季度报":s==630?o="半年度报":s==930&&(o="三季度报");var l={Title:"业绩预告:",Text:e.Title,Color:this.ValueColor,ClassName:this.ValueAlign.MarginLeft};a.push(l);var l={Title:"年份:",Text:""+n,Color:this.ValueColor,ClassName:this.ValueAlign.MarginLeft};a.push(l);var l={Title:"类型:",Text:o,Color:this.ValueColor,ClassName:this.ValueAlign.MarginLeft};a.push(l)}}},this.ForamtPrice=function(e,a,r,t){var n={Title:St.GetText(t,this.LanguageID),Text:"--.--",Color:this.ValueColor};return v.IsNumber(e)&&(n.Text=e.toFixed(r),n.Color=this.GetColor(e,a)),n},this.ForamtValue=function(e,a,r){var t={Title:St.GetText(r,this.LanguageID),Text:"--",Color:this.ValueColor};return v.IsNumber(e)&&(t.Text=v.FormatValueStringV2(e,a,2,this.LanguageID)),t},this.FormatVol=function(e,a){var r={Title:St.GetText(a,this.LanguageID),Text:"--",Color:this.VolColor};return v.IsNumber(e)&&(r.Text=v.FormatValueStringV2(e,0,2,this.LanguageID)),r},this.FormatAmount=function(e,a){var r={Title:St.GetText(a,this.LanguageID),Text:"--",Color:this.AmountColor};return v.IsNumber(e)&&(r.Text=v.FormatValueString(e,2,this.LanguageID)),r},this.FormatIncrease=function(e,a,r,t){var n={Title:St.GetText(t,this.LanguageID),Text:"--.--",Color:this.ValueColor};if(!v.IsNumber(e)||!v.IsNumber(a))return n;var s=(e-a)/a;return n.Text=(s*100).toFixed(2)+"%",n.Color=this.GetColor(s,0),n},this.FormatRisefall=function(e,a,r,t){var n={Title:St.GetText(t,this.LanguageID),Text:"--.--",Color:this.ValueColor};if(!v.IsNumber(e)||!v.IsNumber(a))return n;var s=e-a;return n.Text=""+s.toFixed(r),n.Color=this.GetColor(s,0),n},this.FormatAmplitude=function(e,a,r,t,n){var s={Title:St.GetText(n,this.LanguageID),Text:"--.--",Color:this.ValueColor};if(!v.IsNumber(e)||!v.IsNumber(a)||!v.IsNumber(r))return s;var o=e-a,l=o/r;return s.Text=(l*100).toFixed(2)+"%",s.Color=this.GetColor(l,0),s},this.ForamtDate=function(e,a,r){var t={Title:St.GetText("DialogTooltip-Date",this.LanguageID),Text:"----/--/--",Color:this.DateTimeColor};return v.IsNumber(e)&&(t.Text=v.FormatDateString(e,a)),t},this.FormatTime=function(e,a,r,t){var n={Title:St.GetText(t,this.LanguageID),Text:"--:--",Color:this.DateTimeColor};return v.IsNumber(e)&&(r||(r="HH:MM",Y.IsMinutePeriod(a,!0)?r="HH:MM":Y.IsSecondPeriod(a)?r="HH:MM:SS":Y.IsMilliSecondPeriod(a)&&(r="HH:MM:SS.fff")),n.Text=v.FormatTimeString(e,r)),n},this.FormatExchange=function(e,a,r){var t={Title:St.GetText(r,this.LanguageID),Text:"--.--",Color:this.DateTimeColor};if(!v.IsNumber(e)||!v.IsNumber(a)||a==0)return t;var n=e/a*100;return t.Text=n.toFixed(2)+"%",t},this.FormatPosition=function(e,a){var r={Title:St.GetText(a,this.LanguageID),Text:"--.--",Color:this.PositionColor};return v.IsNumber(e)&&(r.Text=e.toFixed(0)),r},this.ForamtFClose=function(e,a,r){var t={Title:St.GetText(r,this.LanguageID),Text:"--.--",Color:this.DateTimeColor};return v.IsNumber(e)&&(t.Text=e.toFixed(a)),t},this.GetColor=function(e,a){return e>a?this.UpColor:e<a?this.DownColor:this.UnchangeColor},this.ReloadResource=function(e){this.UpColor=d.UpTextColor,this.DownColor=d.DownTextColor,this.UnchangeColor=d.UnchagneTextColor,this.BGColor=d.FloatTooltip.BGColor,this.BorderColor=d.FloatTooltip.BorderColor,this.TextColor=d.FloatTooltip.TextColor,this.ValueColor=d.FloatTooltip.ValueColor,this.VolColor=d.FloatTooltip.VolColor,this.AmountColor=d.FloatTooltip.AmountColor,this.TurnoverRateColor=d.FloatTooltip.TurnoverRateColor,this.PositionColor=d.FloatTooltip.PositionColor,this.DateTimeColor=d.FloatTooltip.DateTimeColor,this.DivDialog&&this.UpdateStyle()}}function Ng(){this.DivDialog=null,this.DragTitle=null,this.HQChart=null,this.UpColor=d.UpTextColor,this.DownColor=d.DownTextColor,this.UnchangeColor=d.UnchagneTextColor,this.TitleColor=d.DialogSelectRect.TitleColor,this.TitleBGColor=d.DialogSelectRect.TitleBGColor,this.BGColor=d.DialogSelectRect.BGColor,this.BorderColor=d.DialogSelectRect.BorderColor,this.TextColor=d.DialogSelectRect.TextColor,this.ValueColor=d.DialogSelectRect.ValueColor,this.VolColor=d.DialogSelectRect.VolColor,this.AmountColor=d.DialogSelectRect.AmountColor,this.TurnoverRateColor=d.DialogSelectRect.TurnoverRateColor,this.PositionColor=d.DialogSelectRect.PositionColor,this.MaxRowCount=10,this.AryData=[],this.DateTimeBox={Start:{SpanText:null,SpanValue:null},End:{SpanText:null,SpanValue:null}},this.ShowData,this.SelectData,this.Inital=function(e,a){this.HQChart=e},this.Destroy=function(){this.AryData=[],this.ShowData=null,this.DateTimeBox={Start:{SpanText:null,SpanValue:null},End:{SpanText:null,SpanValue:null}},this.DivDialog&&(document.body.removeChild(this.DivDialog),this.DivDialog=null)},this.Create=function(){var e=this,a=document.createElement("div");a.className="UMyChart_SelectRect_Dialog_Div";var r=document.createElement("div");r.className="UMyChart_SelectRect_Title_Div",r.onmousedown=function(R){e.OnMouseDownTitle(R)};var t=document.createElement("div");t.className="UMyChart_SelectRect_Name_Div",t.innerText="区间统计",r.appendChild(t);var n=document.createElement("div");n.className="UMyChart_SelectRect_Close_Div",n.innerText="x",n.onmousedown=function(R){e.Close(R)},r.appendChild(n),a.appendChild(r);var s=document.createElement("div");s.className="UMyChart_SelectRect_DateTime_Div";var o=document.createElement("div");s.append(o);var h=document.createElement("span");h.className="UMyChart_SelectRect_DateTitle_Span",h.innerText="开始:",o.appendChild(h),this.DateTimeBox.Start.SpanText=h;var u=document.createElement("span");u.className="UMyChart_SelectRect_DateValue_Span",u.innerText="--/--",o.appendChild(u),this.DateTimeBox.Start.SpanValue=u;var f=document.createElement("span");f.className="UMyChart_SelectRect_ArrowButton_Span",f.innerText="<",f.onmousedown=function(R){e.MoveStartDate(-1)},o.appendChild(f);var f=document.createElement("span");f.className="UMyChart_SelectRect_ArrowButton_Span",f.innerText=">",f.onmousedown=function(R){e.MoveStartDate(1)},o.appendChild(f);var l=document.createElement("div");s.append(l);var h=document.createElement("span");h.className="UMyChart_SelectRect_DateTitle_Span",h.innerText="结束:",l.appendChild(h),this.DateTimeBox.End.SpanText=h;var u=document.createElement("span");u.className="UMyChart_SelectRect_DateValue_Span",u.innerText="--/--",l.appendChild(u),this.DateTimeBox.SpanEnd=u,this.DateTimeBox.End.SpanValue=u;var f=document.createElement("span");f.className="UMyChart_SelectRect_ArrowButton_Span",f.innerText="<",f.onmousedown=function(R){e.MoveEndDate(-1)},l.appendChild(f);var f=document.createElement("span");f.className="UMyChart_SelectRect_ArrowButton_Span",f.innerText=">",f.onmousedown=function(R){e.MoveEndDate(1)},l.appendChild(f),a.appendChild(s);var C=document.createElement("table");C.className="UMyChart_SelectRect_Table",a.appendChild(C);var D=document.createElement("tbody");D.className="UMyChart_SelectRect_Tbody",C.appendChild(D);for(var c=0;c<this.MaxRowCount;++c){var T={Tr:null,AryItem:[]},S=document.createElement("tr");S.className="UMyChart_SelectRect_Tr",D.appendChild(S),T.Tr=S;for(var I=0;I<3;++I){var g={Td:null,LeftSpan:null,RightSpan:null},E=document.createElement("td");E.className="UMyChart_SelectRect_Td",g.Td=E,S.appendChild(E);var F=document.createElement("span");F.className="UMyChart_SelectRect_Item_Left_Span",F.innerText="数值",g.LeftSpan=F,E.appendChild(F);var F=document.createElement("span");F.className="UMyChart_SelectRect_Item_Right_Span",F.innerText="--",g.RightSpan=F,E.appendChild(F),T.AryItem.push(g)}this.AryData.push(T)}document.body.appendChild(a),this.DivDialog=a,this.UpdateStyle()},this.Close=function(e){this.DivDialog&&(this.DivDialog.style.visibility="hidden",this.ShowData=null,this.SelectData=null)},this.MoveStartDate=function(e){if(!(!this.DivDialog||!this.HQChart)&&e!=0&&this.SelectData){var a=this.SelectData,r=!1;if(e>0){var t=a.Start,n=a.End;for(s=0;s<e&&t<n;++s)++t;a.Start!=t&&(a.Start=t,r=!0)}else{e=Math.abs(e);for(var t=a.Start,n=a.End,s=0;s<e&&t>0;++s)--t;a.Start!=t&&(a.Start=t,r=!0)}r&&this.UpdateSelectRect(a)}},this.MoveEndDate=function(e){if(this.DivDialog&&e!=0&&this.SelectData){var a=this.SelectData,r=!1;if(e>0){var t=a.End,n=a.Start;for(s=0;s<e&&t<this.ShowData.DataCount;++s)++t;a.End!=t&&(a.End=t,r=!0)}else{e=Math.abs(e);for(var t=a.End,n=a.Start,s=0;s<e&&t>n;++s)--t;a.End!=t&&(a.End=t,r=!0)}r&&this.UpdateSelectRect(a)}},this.Show=function(e,a){if(this.DivDialog&&this.HQChart){var r=this.HQChart.Frame.ChartBorder.GetTop(),t=this.HQChart.Frame.ChartBorder.GetLeft(),n=this.HQChart.UIElement.getBoundingClientRect();t=t+n.left+5,r=r+n.top+10,v.IsNumber(e)&&v.IsNumber(a)&&(t=e,r=a);var s=e+this.DivDialog.offsetWidth,o=a+this.DivDialog.offsetHeight;s+5>=window.innerWidth&&(t=window.innerWidth-this.DivDialog.offsetWidth-5),o+5>=window.innerHeight&&(r=window.innerHeight-this.DivDialog.offsetHeight-5),this.DivDialog.style.top=r+"px",this.DivDialog.style.left=t+"px",this.DivDialog.style.visibility="visible"}},this.IsShow=function(){return this.DivDialog?this.DivDialog.style.visibility==="visible":!1},this.OnMouseDownTitle=function(e){var a=this;if(this.DivDialog){var r={X:e.clientX,Y:e.clientY};r.YOffset=e.clientX-this.DivDialog.offsetLeft,r.XOffset=e.clientY-this.DivDialog.offsetTop,this.DragTitle=r,document.onmousemove=function(t){a.DocOnMouseMoveTitle(t)},document.onmouseup=function(t){a.DocOnMouseUpTitle(t)}}},this.DocOnMouseMoveTitle=function(e){if(this.DragTitle){var a=e.clientX-this.DragTitle.YOffset,r=e.clientY-this.DragTitle.XOffset,t=a+this.DivDialog.offsetWidth,n=r+this.DivDialog.offsetHeight;t+5>=window.innerWidth&&(a=window.innerWidth-this.DivDialog.offsetWidth-5),n+5>=window.innerHeight&&(r=window.innerHeight-this.DivDialog.offsetHeight-5),this.DivDialog.style.left=a+"px",this.DivDialog.style.top=r+"px",e.preventDefault&&e.preventDefault()}},this.DocOnMouseUpTitle=function(e){this.DragTitle=null,this.onmousemove=null,this.onmouseup=null},this.ReloadResource=function(e){if(this.UpColor=d.UpTextColor,this.DownColor=d.DownTextColor,this.UnchangeColor=d.UnchagneTextColor,this.TitleColor=d.DialogSelectRect.TitleColor,this.TitleBGColor=d.DialogSelectRect.TitleBGColor,this.BGColor=d.DialogSelectRect.BGColor,this.BorderColor=d.DialogSelectRect.BorderColor,this.TextColor=d.DialogSelectRect.TextColor,this.ValueColor=d.DialogSelectRect.ValueColor,this.VolColor=d.DialogSelectRect.VolColor,this.AmountColor=d.DialogSelectRect.AmountColor,this.TurnoverRateColor=d.DialogSelectRect.TurnoverRateColor,this.PositionColor=d.DialogSelectRect.PositionColor,!!this.DivDialog&&(this.UpdateStyle(),this.SelectData)){var a=this.SelectData;this.HQChart.UpdateSelectRect(a.Start,a.End);var r=this.CalculateKLineData({SelectData:a});this.FormatKLineText(r),this.ShowData=r,this.UpdateTableDOM(r)}},this.UpdateStyle=function(){if(this.DivDialog){if(this.BGColor&&(this.DivDialog.style["background-color"]=this.BGColor),this.BorderColor&&(this.DivDialog.style["border-color"]=this.BorderColor),this.DateTimeBox.Start){var e=this.DateTimeBox.Start;e.SpanText.style.color=this.TextColor,e.SpanValue.style.color=this.ValueColor}if(this.DateTimeBox.End){var e=this.DateTimeBox.End;e.SpanText.style.color=this.TextColor,e.SpanValue.style.color=this.ValueColor}}},this.UpdateTableDOM=function(e){for(var a=0,a=0,r=0,t=0;a<this.AryData.length&&t<e.AryText.length;++a){var n=this.AryData[a];for(r=0;r<n.AryItem.length&&!(t>=e.AryText.length);++r,++t){var s=n.AryItem[r],o=e.AryText[t];s.LeftSpan.innerText=o.Title,s.LeftSpan.style.color=this.TextColor,s.RightSpan.innerText=o.Text,s.RightSpan.style.color=o.Color}n.Tr.style.display=""}for(;a<this.AryData.length;++a){var n=this.AryData[a];n.Tr.style.display="none"}this.DateTimeBox.Start.SpanValue&&(this.DateTimeBox.Start.SpanValue.innerText=e.Date.Start.Text),this.DateTimeBox.End.SpanValue&&(this.DateTimeBox.End.SpanValue.innerText=e.Date.End.Text)},this.UpdateSelectRect=function(e){this.HQChart.UpdateSelectRect(e.Start,e.End);var a=null;this.HQChart.ClassName=="KLineChartContainer"?(a=this.CalculateKLineData({SelectData:e}),this.FormatKLineText(a)):this.HQChart.ClassName=="MinuteChartContainer"&&(a=this.CalculateMinuteData({SelectData:e}),this.FormatMinuteText(a)),a&&(this.ShowData=a,this.UpdateTableDOM(a))},this.Update=function(e){if(this.DivDialog){var a;this.HQChart.ClassName=="KLineChartContainer"?(a=this.CalculateKLineData(e),this.FormatKLineText(a)):this.HQChart.ClassName=="MinuteChartContainer"&&(a=this.CalculateMinuteData(e),this.FormatMinuteText(a)),a&&(this.ShowData=a,this.SelectData=e.SelectData,this.UpdateTableDOM(a),this.IsShow()||this.Show(e.X,e.Y))}},this.CreateEmptyShowData=function(){var e={Open:null,Close:null,High:null,Low:null,YClose:null,Vol:0,Amount:0,Date:{Start:{Time:null,Date:null,Text:""},End:{Time:null,Date:null,Text:""}},Count:0,KLine:{Up:0,Down:0,Unchanged:0},AryText:[],DataCount:0};return e},this.CalculateKLineData=function(e){var a=e.SelectData,r=a.Data,t=a.Start,n=a.End,s=this.CreateEmptyShowData();s.DataCount=r.Data.length;for(var o=t;o<r.Data.length&&o<=n;++o){var l=r.Data[o];++s.Count,!v.IsNumber(s.Open)&&v.IsNumber(l.Open)&&(s.Open=l.Open),v.IsNumber(l.Close)&&(s.Close=l.Close),v.IsNumber(l.Vol)&&(s.Vol+=l.Vol),v.IsNumber(l.Amount)&&(s.Amount+=l.Amount),v.IsNumber(l.High)&&(!v.IsNumber(s.High)||s.High<l.High)&&(s.High=l.High),v.IsNumber(l.Low)&&(!v.IsNumber(s.Low)||s.Low>l.Low)&&(s.Low=l.Low),v.IsNumber(l.Open)&&v.IsNumber(l.Close)&&(l.Close>l.Open?++s.KLine.Up:l.Close<l.Open?++s.KLine.Down:++s.KLine.Unchanged),v.IsNumber(l.Date)&&(s.Date.End.Date=l.Date,v.IsNumber(s.Date.Start.Date)||(s.Date.Start.Date=l.Date)),v.IsNumber(l.Time)&&(s.Date.End.Time=l.Time,v.IsNumber(s.Date.Start.Time)||(s.Date.Start.Time=l.Time))}return s},this.FormatKLineText=function(e){if(e){var a=jt(this.HQChart.Symbol);Y.IsMinutePeriod(this.HQChart.Period,!0)?(e.Date.Start.Text=v.FormatDateString(e.Date.Start.Date)+" "+v.FormatTimeString(e.Date.Start.Time,"HH:MM"),e.Date.End.Text=v.FormatDateString(e.Date.End.Date)+" "+v.FormatTimeString(e.Date.End.Time,"HH:MM")):Y.IsSecondPeriod(this.HQChart.Period)||Y.IsTickPeriod(this.HQChart.Period)?(e.Date.Start.Text=v.FormatDateString(e.Date.Start.Date)+" "+v.FormatTimeString(e.Date.Start.Time,"HH:MM:SS"),e.Date.End.Text=v.FormatDateString(e.Date.End.Date)+" "+v.FormatTimeString(e.Date.End.Time,"HH:MM:SS")):(e.Date.Start.Text=v.FormatDateString(e.Date.Start.Date),e.Date.End.Text=v.FormatDateString(e.Date.End.Date)),e.AryText.push(this.ForamtPrice(e.Open,e.Open,a,"DialogSelectRect-StartPrice")),e.AryText.push(this.ForamtPrice(e.Close,e.Open,a,"DialogSelectRect-EndPrice")),e.AryText.push(this.FormatIncrease(e.Close,e.Open,"DialogSelectRect-Increase")),e.AryText.push(this.ForamtPrice(e.High,e.Open,a,"DialogSelectRect-High")),e.AryText.push(this.ForamtPrice(e.Low,e.Open,a,"DialogSelectRect-Low")),e.AryText.push(this.FormatAmplitude(e.High,e.Low,e.Open,"DialogSelectRect-Amplitude")),e.AryText.push(this.FormatVol(e.Vol,"DialogSelectRect-Vol")),e.AryText.push(this.FormatAmount(e.Amount,"DialogSelectRect-Amount")),e.AryText.push(this.FormatNumber(e.Count,null,0,"DialogSelectRect-DataCount")),e.AryText.push(this.FormatNumber(e.KLine.Up,this.UpColor,0,"DialogSelectRect-Up")),e.AryText.push(this.FormatNumber(e.KLine.Down,this.DownColor,0,"DialogSelectRect-Down")),e.AryText.push(this.FormatNumber(e.KLine.Unchanged,this.UnchangeColor,0,"DialogSelectRect-Unchanged"))}},this.CalculateMinuteData=function(e){var a=e.SelectData,r=a.Data,t=a.Start,n=a.End,s=this.CreateEmptyShowData();s.DataCount=r.Data.length;for(var o=t;o<r.Data.length&&o<=n;++o){var l=r.Data[o];++s.Count,!v.IsNumber(s.Open)&&v.IsNumber(l.Open)&&(s.Open=l.Open),v.IsNumber(l.Close)&&(s.Close=l.Close),v.IsNumber(l.Vol)&&(s.Vol+=l.Vol),v.IsNumber(l.Amount)&&(s.Amount+=l.Amount),v.IsNumber(l.High)&&(!v.IsNumber(s.High)||s.High<l.High)&&(s.High=l.High),v.IsNumber(l.Low)&&(!v.IsNumber(s.Low)||s.Low>l.Low)&&(s.Low=l.Low),v.IsNumber(l.Open)&&v.IsNumber(l.Close)&&(l.Close>l.Open?++s.KLine.Up:l.Close<l.Open?++s.KLine.Down:++s.KLine.Unchanged),v.IsNumber(l.Date)&&(s.Date.End.Date=l.Date,v.IsNumber(s.Date.Start.Date)||(s.Date.Start.Date=l.Date)),v.IsNumber(l.Time)&&(s.Date.End.Time=l.Time,v.IsNumber(s.Date.Start.Time)||(s.Date.Start.Time=l.Time))}return s},this.FormatMinuteText=function(e){if(e){var a=jt(this.HQChart.Symbol);e.Date.Start.Text=v.FormatDateString(e.Date.Start.Date)+" "+v.FormatTimeString(e.Date.Start.Time,"HH:MM"),e.Date.End.Text=v.FormatDateString(e.Date.End.Date)+" "+v.FormatTimeString(e.Date.End.Time,"HH:MM"),e.AryText.push(this.ForamtPrice(e.Open,e.Open,a,"DialogSelectRect-StartPrice")),e.AryText.push(this.ForamtPrice(e.Close,e.Open,a,"DialogSelectRect-EndPrice")),e.AryText.push(this.FormatIncrease(e.Close,e.Open,"DialogSelectRect-Increase")),e.AryText.push(this.ForamtPrice(e.High,e.Open,a,"DialogSelectRect-High")),e.AryText.push(this.ForamtPrice(e.Low,e.Open,a,"DialogSelectRect-Low")),e.AryText.push(this.FormatAmplitude(e.High,e.Low,e.Open,"DialogSelectRect-Amplitude")),e.AryText.push(this.FormatVol(e.Vol,"DialogSelectRect-Vol")),e.AryText.push(this.FormatAmount(e.Amount,"DialogSelectRect-Amount")),e.AryText.push(this.FormatNumber(e.Count,null,0,"DialogSelectRect-DataCount"))}},this.GetColor=function(e,a){return e>a?this.UpColor:e<a?this.DownColor:this.UnchangeColor},this.GetPriceColor=function(e,a){var r=this.GetColor(e,a);return r},this.FormatEmpty=function(){var e={Title:"",Text:"",Color:this.ValueColor};return e},this.FormatNumber=function(e,a,r,t,n){var s={Title:St.GetText(t,this.LanguageID),Text:"----",Color:this.ValueColor};return v.IsNumber(e)&&(s.Text=e.toFixed(r),a&&(s.Color=a)),s},this.ForamtPrice=function(e,a,r,t){var n={Title:St.GetText(t,this.LanguageID),Text:"--.--",Color:this.ValueColor};return v.IsNumber(e)&&(n.Text=e.toFixed(r),n.Color=this.GetColor(e,a)),n},this.FormatIncrease=function(e,a,r){var t={Title:St.GetText(r,this.LanguageID),Text:"--.--",Color:this.ValueColor};if(!v.IsNumber(e)||!v.IsNumber(a))return t;var n=e-a,s=n/a;return t.Text=(s*100).toFixed(2)+"%",t.Color=this.GetColor(s,0),t},this.FormatAmplitude=function(e,a,r,t){var n={Title:St.GetText(t,this.LanguageID),Text:"--.--",Color:this.ValueColor};if(!v.IsNumber(e)||!v.IsNumber(a)||!v.IsNumber(r))return n;var s=e-a,o=s/r;return n.Text=(o*100).toFixed(2)+"%",n.Color=this.GetColor(o,0),n},this.FormatVol=function(e,a){var r={Title:St.GetText(a,this.LanguageID),Text:"--",Color:this.VolColor};return v.IsNumber(e)&&(r.Text=v.FormatValueStringV2(e,0,2,this.LanguageID)),r},this.FormatAmount=function(e,a){var r={Title:St.GetText(a,this.LanguageID),Text:"--",Color:this.AmountColor};return v.IsNumber(e)&&(r.Text=v.FormatValueString(e,2,this.LanguageID)),r}}function Il(){this.DivDialog=null,this.DragTitle=null,this.TitleBox=null,this.InputDom=null,this.Style=0,this.HQChart=null,this.OpData=null,this.TitleColor=d.DialogSearchIndex.TitleColor,this.TitleBGColor=d.DialogSearchIndex.TitleBGColor,this.BGColor=d.DialogSearchIndex.BGColor,this.BorderColor=d.DialogSearchIndex.BorderColor,this.IndexNameColor=d.DialogSearchIndex.IndexNameColor,this.GroupNameColor=d.DialogSearchIndex.GroupNameColor,this.InputTextColor=d.DialogSearchIndex.InputTextColor,this.MaxRowCount=30,this.ColCount=3,this.MaxGroupCount=10,this.AryData=[],this.AryGroup=[],this.IndexData=Il.GetDefaultIndexData(),this.Inital=function(e,a){this.HQChart=e,a&&(v.IsNumber(a.Style)&&(this.Style=a.Style),a.IndexData&&(this.IndexData=a.IndexData),v.IsNumber(a.MaxRowCount)&&(this.MaxRowCount=a.MaxRowCount))},this.Destroy=function(){this.AryData=[],this.AryGroup=[],this.IndexData=null,this.InputDom=null,this.HQChart=null,this.DivDialog&&(document.body.removeChild(this.DivDialog),this.DivDialog=null)},this.OnClickColseButton=function(e){this.Close(e)},this.SetOpData=function(e){this.OpData=e},this.Close=function(e){this.OpData=null,this.DivDialog&&(this.DivDialog.style.visibility="hidden")},this.OnMouseDownTitle=function(e){var a=this;if(this.DivDialog){var r={X:e.clientX,Y:e.clientY};r.YOffset=e.clientX-this.DivDialog.offsetLeft,r.XOffset=e.clientY-this.DivDialog.offsetTop,this.DragTitle=r,document.onmousemove=function(t){a.DocOnMouseMoveTitle(t)},document.onmouseup=function(t){a.DocOnMouseUpTitle(t)}}},this.DocOnMouseMoveTitle=function(e){if(this.DragTitle){var a=e.clientX-this.DragTitle.YOffset,r=e.clientY-this.DragTitle.XOffset,t=a+this.DivDialog.offsetWidth,n=r+this.DivDialog.offsetHeight;t+5>=window.innerWidth&&(a=window.innerWidth-this.DivDialog.offsetWidth-5),n+5>=window.innerHeight&&(r=window.innerHeight-this.DivDialog.offsetHeight-5),this.DivDialog.style.left=a+"px",this.DivDialog.style.top=r+"px",e.preventDefault&&e.preventDefault()}},this.DocOnMouseUpTitle=function(e){this.DragTitle=null,this.onmousemove=null,this.onmouseup=null},this.Show=function(e,a,r){if(this.DivDialog){if(r||(r=this.IndexData.Data[0].Group.ID),this.UpdateGroupData(),this.ChangeGroup(r),this.OpData&&this.OpData.Title&&(this.TitleBox.DivName.innerText=this.OpData.Title),!v.IsNumber(e)||!v.IsNumber(a)){var t=this.HQChart.UIElement.getBoundingClientRect();e=t.left+(t.right-t.left-this.DivDialog.offsetWidth)/2,a=t.top+(t.bottom-t.top-this.DivDialog.offsetHeight)/2}this.InputDom.value="",this.DivDialog.style.visibility="visible",this.DivDialog.style.top=a+"px",this.DivDialog.style.left=e+"px"}},this.Create=function(){var e=this,a=document.createElement("div");a.className="UMyChart_SearchIndex_Dialog_Div";var r=document.createElement("div");r.className="UMyChart_SearchIndex_Title_Div",r.onmousedown=function(A){e.OnMouseDownTitle(A)},a.appendChild(r);var t=document.createElement("div");t.className="UMyChart_SearchIndex_Name_Div",t.innerText="指标搜索",r.appendChild(t);var n=document.createElement("div");n.className="UMyChart_SearchIndex_Close_Div",n.innerText="x",n.onmousedown=function(A){e.OnClickColseButton(A)},r.appendChild(n);var s=document.createElement("div");s.className="UMyChart_SearchIndex_Frome_Div",a.appendChild(s);var o=document.createElement("div");o.className="UMyChart_SearchIndex_Input_Div",s.appendChild(o);var l=document.createElement("input");l.className="UMyChart_SearchIndex_Input",l.type="text",l.placeholder="输入指标名称",l.addEventListener("input",function(A){e.OnInputSearch(A)}),o.appendChild(l),this.InputDom=l;var h=document.createElement("div");h.className="UMyChart_SearchIndex_Container_Div",a.appendChild(h);var u=document.createElement("div");u.className="UMyChart_SearchIndex_GroupList_Div",h.appendChild(u);for(var f=0,C=0;f<this.MaxGroupCount;++f){var D={Div:null,Span:null},c=document.createElement("div");c.className="UMyChart_SearchIndex_Group_Div",u.appendChild(c),D.Div=c;var T=document.createElement("span");T.className="UMyChart_SearchIndex_Group_Span",T.innerText="分类名称",c.appendChild(T),D.Span=T,T.onmousedown=function(A){e.OnClickGroup(A)},this.AryGroup.push(D)}var S=document.createElement("div");S.className="UMyChart_SearchIndex_Table_Div",h.appendChild(S);var I=document.createElement("table");I.className="UMyChart_SearchIndex_Table",S.appendChild(I);var g=document.createElement("tbody");g.className="UMyChart_SearchIndex_Tbody",I.appendChild(g),this.AryData=[];for(var f=0,C=0;f<this.MaxRowCount;++f){var E={Tr:null,AryCell:[]},F=document.createElement("tr");for(F.className="UMyChart_SearchIndex_Group_Tr",g.appendChild(F),E.Tr=F,C=0;C<this.ColCount;++C){var R=this.CreateCellDOM(f,C,F);E.AryCell.push(R)}this.AryData.push(E)}document.body.appendChild(a),this.DivName=t,this.DivDialog=a,this.TitleBox={DivTitle:r,DivName:t,DivColor:n},this.UpdateStyle()},this.CreateCellDOM=function(e,a,r){var t=this,n={Td:null,Span:null,RowID:e,ColID:a,IndexItem:null},s=document.createElement("td");s.className="UMyChart_SearchIndex_Text_Td",r.appendChild(s),n.Td=s;var o=document.createElement("span");return o.className="UMyChart_SearchIndex_Text_Span",o.innerText="指标名称",o.onmousedown=function(l){t.OnClickIndex(l,n)},s.appendChild(o),n.Span=o,n},this.OnClickIndex=function(e,a){if(this.OpData&&!(!a||!a.IndexItem)){var r=this.HQChart.GetEventCallback($.SEARCH_DIALOG_ON_CLICK_INDEX);if(r&&r.Callback){var t={OpData:this.OpData,IndexData:a.IndexItem,HQChart:this.HQChart,PreventDefault:!1};if(r.Callback(r,t,this),t.PreventDefault==!0)return}if(this.OpData.OpType==1){if(!v.IsNumber(this.OpData.WindowIndex))return;var n=a.IndexItem;if(n.Type==0)this.HQChart.ChangeIndex(this.OpData.WindowIndex,n.ID);else if(n.Type==1){var s={ID:n.ID,Name:n.Name,Script:n.Script,Args:n.Args};this.HQChart.ChangeScriptIndex(this.OpData.WindowIndex,s)}else if(n.Type==2){var o={API:{ID:n.ID,Name:n.Name,Args:n.Args,Url:"local"}};this.HQChart.ChangeAPIIndex(this.OpData.WindowIndex,o)}else n.Type==3&&this.HQChart.ChangeIndexTemplate(n.TemplateData)}else if(this.OpData.OpType==2){if(!v.IsNumber(this.OpData.WindowIndex))return;var n=a.IndexItem;if(n.Type==0){var l={WindowIndex:this.OpData.WindowIndex,IndexName:n.ID};this.HQChart.AddOverlayIndex(l)}else if(n.Type==1){var l={WindowIndex:this.OpData.WindowIndex,IndexName:n.ID,Name:n.Name,Script:n.Script,Args:n.Args};this.HQChart.AddOverlayIndex(l)}else if(n.Type==2){var l={WindowIndex:this.OpData.WindowIndex,API:{ID:n.ID,Name:n.Name,Args:n.Args,Url:"local"}};this.HQChart.AddOverlayIndex(l)}else n.Type==3&&this.HQChart.ChangeIndexTemplate(n.TemplateData)}else if(this.OpData.OpType==3){var n=a.IndexItem;if(n.Type==0)this.HQChart.AddIndexWindow(n.ID,this.OpData);else if(n.Type==1){var s={ID:n.ID,Name:n.Name,Script:n.Script,Args:n.Args};this.HQChart.AddScriptIndexWindow(s,this.OpData)}else if(n.Type==2){var s={API:{ID:n.ID,Name:n.Name,Args:n.Args,Url:"local"}};this.HQChart.AddAPIIndexWindow(s,this.OpData)}else n.Type==3&&this.HQChart.ChangeIndexTemplate(n.TemplateData)}}},this.OnClickGroup=function(e){if(!e.target)return!1;var a=e.target.dataset.groupid;if(!a)return!1;this.ChangeGroup(a)},this.UpdateStyle=function(){this.DivDialog&&(this.BGColor&&(this.DivDialog.style["background-color"]=this.BGColor),this.BorderColor&&(this.DivDialog.style["border-color"]=this.BorderColor),this.TitleBGColor&&(this.TitleBox.DivTitle.style["background-color"]=this.TitleBGColor),this.TitleColor&&(this.TitleBox.DivName.style.color=this.TitleColor),this.InputTextColor&&(this.InputDom.style.color=this.InputTextColor))},this.ChangeGroup=function(e){if(this.IndexData&&v.IsNonEmptyArray(this.IndexData.Data)){for(var a=null,r=0;r<this.IndexData.Data.length;++r){var t=this.IndexData.Data[r];if(t.Group.ID==e){a=t;break}}a&&this.UpdateTableData(a)}},this.UpdateGroupData=function(){var e=0;for(e=0;e<this.IndexData.Data.length&&e<this.AryGroup.length;++e){var a=this.IndexData.Data[e],r=this.AryGroup[e];r.Span.innerText=a.Group.Name,r.Span.dataset.groupid=a.Group.ID,r.Span.dataset.groupname=a.Group.Name,r.Span.style.color=this.GroupNameColor,r.Div.style.display=="none"&&(r.Div.style.display="")}for(;e<this.AryGroup.length;++e){var r=this.AryGroup[e];r.Div.style.display="none"}},this.UpdateTableData=function(e){for(var a=0,r=0,t=0;a<this.AryData.length&&t<e.AryIndex.length;++a){var n=this.AryData[a],s=0;for(r=0;r<n.AryCell.length;++r){var o=n.AryCell[r];if(t<e.AryIndex.length){var l=e.AryIndex[t];o.Span.innerText=l.Name,o.Span.style.color=this.IndexNameColor,o.Td.style.display=="none"&&(o.Td.style.display=""),o.IndexItem=l,++t,++s}else o.Td.style.display="none"}s>0?n.Tr.style.display=="none"&&(n.Tr.style.display=""):n.Tr.style.display=="none"}for(;a<this.AryData.length;++a){var n=this.AryData[a];n.Tr.style.display="none"}},this.OnInputSearch=function(e){for(var a=e.target.value,r=[],t=this.SeachIndex(a),n=new Fe.default,s=0;s<t.length;++s){var o=t[s],l=o.ID+"-"+o.Type;n.add(l),r.push(o)}var h=new Z,u=h.Search(a);if(v.IsNonEmptyArray(u))for(var s=0;s<u.length;++s){var f=u[s],l=f+"-0";if(!n.has(l)){var o={Name:f,ID:f,Type:0};r.push(o)}}this.UpdateTableData({AryIndex:r})},this.SeachIndex=function(e){if(!this.IndexData||!v.IsNonEmptyArray(this.IndexData.Data))return[];for(var a=[],r=e.toUpperCase(),t=0,n=0;t<this.IndexData.Data.length;++t){var s=this.IndexData.Data[t];for(n=0;n<s.AryIndex.length;++n){var o=s.AryIndex[n];(o.Name.indexOf(e)>=0||o.Name.indexOf(r)>=0)&&a.push(o)}}return a},this.ReloadResource=function(e){this.TitleColor=d.DialogSearchIndex.TitleColor,this.TitleBGColor=d.DialogSearchIndex.TitleBGColor,this.BGColor=d.DialogSearchIndex.BGColor,this.BorderColor=d.DialogSearchIndex.BorderColor,this.IndexNameColor=d.DialogSearchIndex.IndexNameColor,this.GroupNameColor=d.DialogSearchIndex.GroupNameColor,this.InputTextColor=d.DialogSearchIndex.InputTextColor,this.DivDialog&&this.UpdateStyle()}}Il.GetDefaultIndexData=function(){var e={Name:"内置指标分类",Data:[{Group:{ID:"超买超卖型",Name:"超买超卖型"},AryIndex:[{Name:"ADTM 动态买卖气指标",ID:"ADTM",Type:0},{Name:"BIAS 乖离率",ID:"BIAS",Type:0},{Name:"BIAS36 三六乖离",ID:"BIAS36",Type:0},{Name:"BIAS_QL 乖离率-传统版",ID:"BIAS_QL",Type:0},{Name:"CCI 商品路径指标",ID:"CCI",Type:0},{Name:"FSL 分水岭",ID:"FSL",Type:0},{Name:"KDJ 随机指标",ID:"KDJ",Type:0},{Name:"MTM 动量线",ID:"MTM",Type:0},{Name:"OSC 变动速率线",ID:"OSC",Type:0},{Name:"RSI 相对强弱指标",ID:"RSI",Type:0},{Name:"ROC 变动率指标",ID:"ROC",Type:0},{Name:"WR 威廉指标",ID:"WR",Type:0}]},{Group:{ID:"趋势型",Name:"趋势型"},AryIndex:[{Name:"CHO 济坚指数",ID:"CHO",Type:0},{Name:"DMA 平均差",ID:"DMA",Type:0},{Name:"DMI 趋向指标",ID:"DMI",Type:0},{Name:"EMV 简易波动指标",ID:"EMV",Type:0},{Name:"MACD 平滑异同平均",ID:"MACD",Type:0},{Name:"TRIX 三重指数平均线",ID:"TRIX",Type:0},{Name:"UOS 终极指标",ID:"UOS",Type:0},{Name:"TRIX 三重指数平均线",ID:"TRIX",Type:0}]},{Group:{ID:"成交量型",Name:"成交量型"},AryIndex:[{Name:"HSL 换手率",ID:"HSL",Type:0},{Name:"OBV 累积能量线",ID:"OBV",Type:0},{Name:"NVI 负成交量",ID:"NVI",Type:0},{Name:"PVI 正成交量",ID:"PVI",Type:0},{Name:"VOL 成交量",ID:"VOL",Type:0}]},{Group:{ID:"均线型",Name:"均线型"},AryIndex:[{Name:"MA 均线",ID:"MA",Type:0},{Name:"BBI 多空线",ID:"BBI",Type:0}]},{Group:{ID:"路径型",Name:"路径型"},AryIndex:[{Name:"BOLL 布林线",ID:"BOLL",Type:0},{Name:"BOLL副图 布林线",ID:"BOLL副图",Type:0},{Name:"MIKE 麦克支撑压力",ID:"MIKE",Type:0},{Name:"ENE 轨道线",ID:"ENE",Type:0}]},{Group:{ID:"能量型",Name:"能量型"},AryIndex:[{Name:"BRAR 情绪指标",ID:"BRAR",Type:0},{Name:"CYR 市场强弱",ID:"CYR",Type:0},{Name:"MASS 梅斯线",ID:"MASS",Type:0},{Name:"PSY 心理线",ID:"PSY",Type:0},{Name:"CR 带状能量线",ID:"CR",Type:0},{Name:"VR 成交量变异率",ID:"VR",Type:0},{Name:"WAD 威廉多空力度线",ID:"WAD",Type:0}]},{Group:{ID:"自定义",Name:"自定义"},AryIndex:[{Name:"收盘线(后台指标)",ID:"CLOSE_LINE",Type:2,Args:null},(0,ae.default)({Name:"高低均价(自定义脚本)",ID:"HIGH_LOW_AV",Type:1,Args:null,Script:"均价:(H+L)/2;高:H;低:L;"},"Args",[{Name:"N",Value:20},{Name:"M",Value:6}])]},{Group:{ID:"组合指标",Name:"组合指标"},AryIndex:[{Name:"BOLL+ENE+KDJ",ID:"9E154D3C-A4D4-40DD-8D8F-2C499F35E31B",Type:3,TemplateData:{Windows:[{Index:"BOLL"},{Index:"ENE"},{Index:"KDJ"}]}},{Name:"MA_OSC+DPO_RSI",ID:"E828DD1C-D41B-4888-9CB5-4CA1D84F7B50",Type:3,TemplateData:{Windows:[{Index:"MA"},{Index:"DPO"}],OverlayIndex:[{Index:"OSC",Windows:0},{Index:"RSI",Windows:1}]}}]}]};return e};function Ag(){this.DivDialog=null,this.DragTitle=null,this.TitleBox=null,this.Style=0,this.TitleColor=d.DialogModifyIndexParam.TitleColor,this.TitleBGColor=d.DialogModifyIndexParam.TitleBGColor,this.BGColor=d.DialogModifyIndexParam.BGColor,this.BorderColor=d.DialogModifyIndexParam.BorderColor,this.ParamNameColor=d.DialogModifyIndexParam.ParamNameColor,this.InputTextColor=d.DialogModifyIndexParam.InputTextColor,this.MaxRowCount=30,this.HQChart=null,this.AryData=[],this.IndexData=null,this.Arguments=[],this.Inital=function(e,a){this.HQChart=e,a&&(v.IsNumber(a.Style)&&(this.Style=a.Style),v.IsNumber(a.MaxRowCount)&&(this.MaxRowCount=a.MaxRowCount))},this.Destroy=function(){this.AryData=[],this.HQChart=null,this.DivDialog&&(document.body.removeChild(this.DivDialog),this.DivDialog=null)},this.Show=function(e,a){if(this.DivDialog){if(this.UpdateParam(),this.IndexData&&this.IndexData.Title&&(this.TitleBox.DivName.innerText=this.IndexData.Title),!v.IsNumber(e)||!v.IsNumber(a)){var r=this.HQChart.UIElement.getBoundingClientRect();e=r.left+(r.right-r.left-this.DivDialog.offsetWidth)/2,a=r.top+(r.bottom-r.top-this.DivDialog.offsetHeight)/2}this.DivDialog.style.visibility="visible",this.DivDialog.style.top=a+"px",this.DivDialog.style.left=e+"px"}},this.OnClickColseButton=function(e){this.RestoreParam(),this.Close(e)},this.OnClickRestoreButton=function(e){var a=this.Arguments;a||(a=[]),this.UpdateParamTable(a),this.RestoreParam()},this.OnClickOkButton=function(e){this.Close(e)},this.Close=function(e){this.IndexData=null,this.Arguments=[],this.DivDialog&&(this.DivDialog.style.visibility="hidden")},this.SetIndexData=function(e){this.IndexData=e,this.BackupParam()},this.OnMouseDownTitle=function(e){var a=this;if(this.DivDialog){var r={X:e.clientX,Y:e.clientY};r.YOffset=e.clientX-this.DivDialog.offsetLeft,r.XOffset=e.clientY-this.DivDialog.offsetTop,this.DragTitle=r,document.onmousemove=function(t){a.DocOnMouseMoveTitle(t)},document.onmouseup=function(t){a.DocOnMouseUpTitle(t)}}},this.DocOnMouseMoveTitle=function(e){if(this.DragTitle){var a=e.clientX-this.DragTitle.YOffset,r=e.clientY-this.DragTitle.XOffset,t=a+this.DivDialog.offsetWidth,n=r+this.DivDialog.offsetHeight;t+5>=window.innerWidth&&(a=window.innerWidth-this.DivDialog.offsetWidth-5),n+5>=window.innerHeight&&(r=window.innerHeight-this.DivDialog.offsetHeight-5),this.DivDialog.style.left=a+"px",this.DivDialog.style.top=r+"px",e.preventDefault&&e.preventDefault()}},this.DocOnMouseUpTitle=function(e){this.DragTitle=null,this.onmousemove=null,this.onmouseup=null},this.Create=function(){var e=this,a=document.createElement("div");a.className="UMyChart_ModifyIndexParam_Dialog_Div";var r=document.createElement("div");r.className="UMyChart_ModifyIndexParam_Title_Div",r.onmousedown=function(T){e.OnMouseDownTitle(T)},a.appendChild(r);var t=document.createElement("div");t.className="UMyChart_ModifyIndexParam_Name_Div",t.innerText="指标参数修改",r.appendChild(t);var n=document.createElement("div");n.className="UMyChart_ModifyIndexParam_Close_Div",n.innerText="x",n.onmousedown=function(T){e.OnClickColseButton(T)},r.appendChild(n);var s=document.createElement("div");s.className="UMyChart_ModifyIndexParam_Frome_Div",a.appendChild(s);var o=document.createElement("div");o.className="UMyChart_ModifyIndexParam_Table_Div",s.appendChild(o);var l=document.createElement("table");l.className="UMyChart_ModifyIndexParam_Table",o.appendChild(l);var h=document.createElement("tbody");h.className="UMyChart_ModifyIndexParam_Tbody",l.appendChild(h),this.AryData=[];for(var u=0;u<this.MaxRowCount;++u){var f=this.CreateRowDOM(u,h);this.AryData.push(f)}var C=document.createElement("div");C.className="UMyChart_ModifyIndexParam_Button_Div",s.appendChild(C);var D=document.createElement("button");D.innerText="恢复默认",D.addEventListener("mousedown",function(T){e.OnClickRestoreButton(T)}),C.appendChild(D);var c=document.createElement("button");c.innerText="确认",c.addEventListener("mousedown",function(T){e.OnClickOkButton(T)}),C.appendChild(c),document.body.appendChild(a),this.DivName=t,this.DivDialog=a,this.TitleBox={DivTitle:r,DivName:t,DivColor:n},this.UpdateStyle()},this.CreateRowDOM=function(e,a){var r=this,t={Tr:null,TdName:null,SpanName:null,TdValue:null,Input:null,ParamItem:null},n=document.createElement("tr");n.className="UMyChart_ModifyIndexParam_Tr",a.appendChild(n),t.Tr=n;var o=document.createElement("td");o.className="UMyChart_ModifyIndexParam_Name_Td",n.appendChild(o),t.TdName=o;var s=document.createElement("span");s.className="UMyChart_ModifyIndexParam_Name_Span",s.innerText="参数",o.appendChild(s),t.SpanName=s;var o=document.createElement("td");o.className="UMyChart_ModifyIndexParam_Value_Td",n.appendChild(o),t.TdValue=o;var l=document.createElement("input");return l.className="UMyChart_ModifyIndexParam_Input",l.type="number",l.step=1,l.addEventListener("mouseup",function(h){r.OnParamMouseUp(h)}),l.addEventListener("keyup",function(h){r.OnParamKeyUp(h)}),o.appendChild(l),t.Input=l,t},this.UpdateStyle=function(){this.DivDialog&&(this.BGColor&&(this.DivDialog.style["background-color"]=this.BGColor),this.BorderColor&&(this.DivDialog.style["border-color"]=this.BorderColor),this.TitleBGColor&&(this.TitleBox.DivTitle.style["background-color"]=this.TitleBGColor),this.TitleColor&&(this.TitleBox.DivName.style.color=this.TitleColor))},this.UpdateParamTable=function(e){var a=0;for(a=0;a<e.length&&a<this.AryData.length;++a){var r=e[a],t=this.AryData[a];t.SpanName.innerText=r.Name+": ",t.SpanName.style.color=this.ParamNameColor,t.Input.value=r.Value,t.Input.style.color=this.InputTextColor,t.Input.dataset.paramid=r.Index,t.Tr.style.display=="none"&&(t.Tr.style.display="")}for(;a<this.AryData.length;++a){var t=this.AryData[a];t.Tr.style.display="none",t.Input.dataset.paramid=-1}},this.UpdateParam=function(){var e=[],a=this.IndexData.IndexScript;if(a&&v.IsNonEmptyArray(a.Arguments))for(var r=0;r<a.Arguments.length;++r){var t=a.Arguments[r];e.push({Name:t.Name,Value:t.Value,Index:r})}this.UpdateParamTable(e)},this.RestoreParam=function(){if(!(!this.IndexData||!this.IndexData.IndexScript)){var e=this.IndexData.IndexScript;if(v.IsNonEmptyArray(e.Arguments)&&v.IsNonEmptyArray(this.Arguments)){for(var a=!1,r=0;r<this.Arguments.length;++r){var t=this.Arguments[r],n=e.Arguments[r];t.Value!=n.Value&&(n.Value=t.Value,a=!0)}a&&(this.IndexData.Type==1?this.HQChart.UpdateWindowIndex(this.IndexData.WindowIndex):this.IndexData.Type==2&&this.HQChart.UpdateOverlayIndex(this.IndexData.Identify))}}},this.BackupParam=function(){if(this.Arguments=[],!(!this.IndexData||!this.IndexData.IndexScript)){var e=this.IndexData.IndexScript;if(v.IsNonEmptyArray(e.Arguments))for(var a=0;a<e.Arguments.length;++a){var r=e.Arguments[a];this.Arguments.push({Name:r.Name,Value:r.Value,Index:a})}}},this.OnParamMouseUp=function(e){var a=e.target,r=a.value,t=a.dataset.paramid;this.ModifyParam(t,parseInt(r))},this.OnParamKeyUp=function(e){var a=e.target,r=a.value,t=a.dataset.paramid;this.ModifyParam(t,parseInt(r))},this.ModifyParam=function(e,a){if(!(!this.IndexData||!this.IndexData.IndexScript)){var r=this.IndexData.IndexScript,t=r.Arguments[e];t&&t.Value!=a&&(t.Value=a,this.IndexData.Type==1?this.HQChart.UpdateWindowIndex(this.IndexData.WindowIndex):this.IndexData.Type==2&&this.HQChart.UpdateOverlayIndex(this.IndexData.Identify))}}}function yg(){this.Status=0,this.Create=function(){var e=this;addEventListener("message",function(a){e.OnRecvMessage(a)})},this.NetworkFilter=function(e,a,r){k.Complier.Log("[HQChartScriptWorker::NetworkFilter] ["+e.Name+"]["+e.Explain+"] data=",e)},this.ExecuteScript=function(e,a){var r=this,t={};if(e.Script)t.Name=e.Name,t.ID=e.Index,t.Script=e.Script;else{if(!e.Index)return!1;var n=new Z,s=n.Get(e.Index);if(!s)return!1;t.ID=e.Index,t.Name=s.Name,t.Script=s.Script,t.Args=s.Args}e.Args&&(t.Args=e.Args),v.IsBool(a.IsApiPeriod)&&(t.IsApiPeriod=a.IsApiPeriod);var o={Name:t.Name,ID:t.ID,Script:t.Script,Args:t.Args,Guid:a.Guid};t.ErrorCallback=function(f){r.OnExecuteError(f,o,a)},t.FinishCallback=function(f,C){r.OnExecuteFinish(f,o,C,a)},t.NetworkFilter=function(f,C){r.NetworkFilter(f,C,o,a)},k.Complier.Log("[HQChartScriptWorker::ExecuteScript] scriptObj=",t);var l=new Sl(t),h=null;a&&a.Data&&(h=new Y,h.Data=a.Data,h.Right=a.Right,h.Period=a.Period,h.DataType=a.DataType,h.Symbol=a.symbol);var u={HQDataType:wt.KLINE_ID,Stock:{Symbol:a.Symbol},Request:{MaxDataCount:500,MaxMinuteDayCount:5},Period:a.Period,Right:a.Right,Data:h};v.IsNumber(a.HQDataType)&&(u.HQDataType=a.HQDataType),l.ExecuteScript(u)},this.OnRecvMessage=function(e){var a=e.data;if(a&&a.ID==ss.EXECUTE_SCRIPT){if(!v.IsNonEmptyArray(a.AryIndex))return;for(var r=0;r<a.AryIndex.length;++r){var t=a.AryIndex[r];this.Status=1,this.ExecuteScript(t,a)}this.Status=0}},this.OnExecuteFinish=function(e,a,r,t){var n={Data:e,IndexInfo:a,ID:ss.FINISH_EXECUTE_SCRIPT,JobInfo:t};postMessage(n)},this.OnExecuteError=function(e,a,r){var t={IndexInfo:a,ID:ss.ERROR_EXECUTE_SCRIPT,Error:e};postMessage(t)}}var Og="1.1.14196";function Pg(){var e=`

*************************************************************************************************************************************************************************** 
*                                                                                                                                                                                                                                                                                                                                        
*                                                                                           :%@@-                                                                        
*                                                                                          :@@@@-                                                                        
*            =@@@@          :#@@@           .:+#@@@#=:                    :=*@@@@@@#+-.    *@@@@.                                                                        
*           :@@@@@         .@@@@@         .#@@@@@@@@@@@-                +@@@@@@@@@@@@@+    @@@@@                                                     -%@@*               
*           +@@@@%         #@@@@#        *@@@@@@@@@@@@@@%.            =@@@@@@@@@@@@@@@-    @@@@@                                                    -@@@@+               
*           %@@@@*         @@@@@+      .%@@@@@@@@@@@@@@@@%:          #@@@@@@@@@@@@@@@%     @@@@#                                                    *@@@@=               
*           @@@@@=         @@@@@-     .%@@@@@@@*++*%@@@@@@%        .%@@@@@@@%*+==+**=     -@@@@+                                                    #@@@@-               
*           @@@@@.         @@@@@.     #@@@@@%=      =@@@@@@*       %@@@@@@#:              *@@@@-   :::.           .-+*###+:          :::  .+##+: -%%@@@@@%%%%            
*          .@@@@@         .@@@@@.    +@@@@@%         .@@@@@@      *@@@@@@:                %@@@@: +@@@@@%.       :%@@@@@@@@@@:       *@@@ :@@@@@* @@@@@@@@@@@@            
*          :@@@@@         :@@@@@     @@@@@%           :@@@@@+     @@@@@@:                 %@@@@-@@@@@@@@@.      @@@@@@@@@@@@@.     :@@@%-@@@@@@.:@@@@@@@@@@@#            
*          -@@@@%         -@@@@@    =@@@@@.            %@@@@%    %@@@@@-                  %@@@@@@@@@@@@@@*      %@@@@@@@@@@@@+     -@@@@@@@@@@# -@@@@@@@@@@@.            
*          +@@@@%=========#@@@@%    @@@@@#             :@@@@@   .@@@@@%                   @@@@@@@@%@@@@@@@      -%+:.  .#@@@@*     +@@@@@@@%%@. .::+@@@@#::              
*          #@@@@@@@@@@@@@@@@@@@#   .@@@@@              .@@@@@   :@@@@@.                   @@@@@@#.  #@@@@@.             -@@@@*     #@@@@@@:        *@@@@+                
*          %@@@@@@@@@@@@@@@@@@@+   :@@@@@              .@@@@@   -@@@@@                    @@@@@+     @@@@@.             :@@@@*     @@@@@%          #@@@@-                
*          @@@@@@@@@@@@@@@@@@@@:   :@@@@%              :@@@@@   +@@@@%                   -@@@@+      @@@@@              -@@@@+     @@@@@.          @@@@@.                
*         .@@@@@@@@@@@@@@@@@@@@    :@@@@%              -@@@@%   *@@@@%                   #@@@@.      @@@@@       .=*#%%%@@@@@=    :@@@@#           @@@@@.                
*         -@@@@@:::::::::=@@@@@    :@@@@@              @@@@@*   +@@@@%                   @@@@@       @@@@%     -#@@@@@@@@@@@@:    -@@@@*           @@@@@                 
*         =@@@@%         =@@@@%    .@@@@@             :@@@@@.   -@@@@%                   @@@@@      .@@@@*    +@@@@@@@@@@@@@@.    =@@@@+          .@@@@@                 
*         +@@@@#         +@@@@#     @@@@@#            %@@@@%    :@@@@@                  .@@@@%      =@@@@=   -@@@@@*-:..%@@@@     +@@@@=          :@@@@#                 
*         *@@@@*         *@@@@*     +@@@@@:          #@@@@@+    .@@@@@@                 :@@@@%      *@@@@-   @@@@@.     @@@@%     #@@@@:          =@@@@+                 
*         %@@@@=         %@@@@+      @@@@@@-       .%@@@@@#      #@@@@@#                :@@@@%      #@@@@:   @@@@%      @@@@*     %@@@@.          #@@@@-                 
*         @@@@@-         @@@@@=      =@@@@@@#=...-*@@@@@@@:       @@@@@@%=.    :+**.    :@@@@*      %@@@@.  .@@@@*     *@@@@=     @@@@@           %@@@@+                 
*        .@@@@@:        .@@@@@:       *@@@@@@@@@@@@@@@@@@@#       =@@@@@@@@%%%@@@@@@    +@@@@-      @@@@@   .@@@@@:  :%@@@@@-    .@@@@%           %@@@@@*+-              
*        :@@@@@         :@@@@@         +@@@@@@@@@@@@@@@@@@@#       =@@@@@@@@@@@@@@@@%   %@@@@       @@@@@    @@@@@@@@@@@@@@@:    -@@@@*           *@@@@@@@@-             
*        =@@@@@         -@@@@@          :@@@@@@@@@@@@@@@@@@@#       :@@@@@@@@@@@@@@@%   @@@@@       %@@@%    #@@@@@@@@@#@@@@.    +@@@@-           .@@@@@@@@#             
*        *@@@@#         =@@@@%            :#@@@@@@@#: :@@@@@=         =@@@@@@@@@@@+.    @@@@@       :@@@+     *@@@@@@@- %@@@     *@@@=             =@@@@@@@*             
*        =++++-         -++++=               .:::.     .=*+:            :-=+++=:.       ****=        .=+.      .-++=:   :+++     -+=:               .-=+=:.     
*        
*        
*        HQChart       
*        Ver: `+Og+`  
*        License: Apache License 2.0                                                                              
*        Source: https://github.com/jones2000/HQChart
*
**************************************************************************************************************************************************************************                                                                                                                                                                      
    `;console.log(e)}Pg();Sh.default=(se={jsChartInit:Ht.Init,jsChartStyle:Ht.SetStyle,JSChart:Ht,ChartData:Y,SingleData:Wt,HistoryData:Pt,MARKET_SUFFIX_NAME:U,IFrameSplitOperator:v,FrameSplitKLinePriceY:Ds,FrameSplitKLineX:br,JSKLineInfoMap:_a,JSCHART_EVENT_ID:$,JSCHART_OPERATOR_ID:ve,JSCHART_DATA_FIELD_ID:qe,JSCHART_CUSTOM_YCOORDINATE_ID:Ka,JSAlgorithm:pi,JSComplier:be,JSIndexScript:Z,GetDevicePixelRatio:B},(0,ae.default)(se,"GetDevicePixelRatio",B),(0,ae.default)(se,"ScriptIndexConsole",Sl),(0,ae.default)(se,"STYLE_TYPE_ID",vh),(0,ae.default)(se,"HQChartStyle",FD),(0,ae.default)(se,"JSConsole",k),(0,ae.default)(se,"KLineTooltipPaint",rl),(0,ae.default)(se,"MinuteTooltipPaint",eD),(0,ae.default)(se,"ChartDrawTwoPointDemo",ul),(0,ae.default)(se,"ChartDrawThreePointDemo",cD),(0,ae.default)(se,"CoordinateInfo",Ut),(0,ae.default)(se,"JSDealChart",ch),(0,ae.default)(se,"DEAL_COLUMN_ID",fe),(0,ae.default)(se,"JSReportChart",Fi),(0,ae.default)(se,"REPORT_COLUMN_ID",X),(0,ae.default)(se,"JSTReportChart",Ui),(0,ae.default)(se,"TREPORT_COLUMN_ID",at),(0,ae.default)(se,"JSKeyboardChart",Ts),(0,ae.default)(se,"KEYBOARD_COLUMN_ID",Na),(0,ae.default)(se,"JSPopKeyboard",dl),(0,ae.default)(se,"JSScrollBarChart",Ss),(0,ae.default)(se,"IChartPainting",Xt),(0,ae.default)(se,"IExtendChartPainting",oa),(0,ae.default)(se,"IChartTitlePainting",sl),(0,ae.default)(se,"IChartDrawPicture",gt),(0,ae.default)(se,"DynamicTitleData",re),(0,ae.default)(se,"CONDITION_PERIOD",Ce),(0,ae.default)(se,"ChartMinuteVolumBar",PC),(0,ae.default)(se,"ChartKLine",Pr),(0,ae.default)(se,"KLineFrame",us),(0,ae.default)(se,"JSCHART_WORKER_MESSAGE_ID",ss),(0,ae.default)(se,"JS_Frame",{KLineFrame:us,KLineHScreenFrame:Zh}),(0,ae.default)(se,"JS_ChangeStringFormat",{IChangeStringFormat:Ya,HQMinuteTimeStringFormat:lD,HQDateStringFormat:hD,HQPriceStringFormat:oD}),(0,ae.default)(se,"JS_ID",{JSCHART_EVENT_ID:$,JSCHART_OPERATOR_ID:ve,JSCHART_DRAG_ID:Ve,JSCHART_BUTTON_ID:Rt,JSCHART_DATA_FIELD_ID:qe,JSCHART_WORKER_MESSAGE_ID:ss,JSCHART_MENU_ID:q}),(0,ae.default)(se,"HQChartScriptWorker",yg),(0,ae.default)(se,"JSPopMenu",Ne),(0,ae.default)(se,"JSDialogDrawTool",LD),se);var ml={};Object.defineProperty(ml,"__esModule",{value:!0});var Bg=On,mf=Ns(Bg),bg=xC,Be=Ns(bg),wg=Uh,_e=Ns(wg),Gg=EC,He=Ns(Gg),js,_g=MC,Pe=Ns(_g);function Ns(e){return e&&e.__esModule?e:{default:e}}function Hg(){this.Domain="http://127.0.0.1:8886",this.CacheDomain="http://127.0.0.1:8886"}var ca=new Hg;function Vg(){this.Stop,this.Down,this.Up,this.Unchanged,this.UpStock={Symbol:null,Name:null},this.DownStock={Symbol:null,Name:null}}function Yg(){this.Good,this.GoodIncrease={Day1:null,Week1:null,Week4:null}}function Xg(e,a,r){this.arySymbol=new Array,this.SortField=e,this.Order=a,this.TagID=new He.default([r])}function kg(){this.ROE,this.Date,this.PerSEarning,this.EPS,this.PerNetAsset,this.NProfit,this.NProfitIncrease,this.NnetProfit,this.NnProfitIncrease,this.NnProfitSpeed,this.Benford,this.SetData=function(e){isNaN(e.roe)||(this.ROE=e.roe),isNaN(e.finance.date)||(this.Date=e.finance.date),isNaN(e.finance.persearning)||(this.PerSEarning=e.finance.persearning),isNaN(e.finance.eps)||(this.EPS=e.finance.eps),isNaN(e.finance.pernetasset)||(this.PerNetAsset=e.finance.pernetasset),isNaN(e.finance.nprofit)||(this.NProfit=e.finance.nprofit),isNaN(e.finance.nprofitincrease)||(this.NProfitIncrease=e.finance.nprofitincrease),isNaN(e.finance.nnetprofit)||(this.NnetProfit=e.finance.nnetprofit),isNaN(e.finance.nnprofitincrease)||(this.NnProfitIncrease=e.finance.nnprofitincrease),isNaN(e.finance.nnprofitspeed)||(this.NnProfitSpeed=e.finance.nnprofitspeed),isNaN(e.finance.benford)||(this.Benford=e.finance.benford)}}function Wg(){this.Date,this.A,this.Total,this.ARate,this.SetData=function(e){isNaN(e.capital.date)||(this.Date=e.capital.date),isNaN(e.capital.a)||(this.A=e.capital.a),isNaN(e.capital.total)||(this.Total=e.capital.total),isNaN(e.capital.arate)||(this.ARate=e.capital.arate)}}function Ug(){this.SuperIn,this.SuperOut,this.BigIn,this.BigOut,this.MidIn,this.MidOut,this.SmallIn,this.SmallOut,this.MainIn,this.MainOut,this.MainNetIn,this.SetData=function(e){this.SuperIn=e.superin,this.SuperOut=e.superout,this.BigIn=e.bigin,this.BigOut=e.bigout,this.MidIn=e.midin,this.MidOut=e.midout,this.SmallIn=e.smallin,this.SmallOut=e.smallout,this.MainIn=e.mainin,this.MainOut=e.mainout,this.MainNetIn=e.mainnetin}}function ko(){this.SuperIn,this.SuperOut,this.BigIn,this.BigOut,this.MidIn,this.MidOut,this.SmallIn,this.SmallOut,this.MainIn,this.MainOut,this.MainNetIn,this.MainNetInRatio,this.SetData=function(e){this.SuperIn=e.superin,this.SuperOut=e.superout,this.BigIn=e.bigin,this.BigOut=e.bigout,this.MidIn=e.midin,this.MidOut=e.midout,this.SmallIn=e.smallin,this.SmallOut=e.smallout,this.MainIn=e.mainin,this.MainOut=e.mainout,this.MainNetIn=e.mainnetin,this.MainNetInRatio=e.mainnetinratio}}function tn(){this.DDX,this.DDY,this.DDZ,this.SetData=function(e){this.DDX=e.ddx,this.DDY=e.ddy,this.DDZ=e.ddz}}function Kg(){this.Name,this.Business,this.Vol,this.Price,this.ReleaseDate,this.Competence,this.SetData=function(e){e.company&&(this.Name=e.company.name,this.Business=e.company.business,this.Vol=e.company.vol,this.Price=e.company.price,this.ReleaseDate=e.company.releasedate,this.Competence=e.company.corecompetence)}}function zg(){this.Industry,this.Region,this.Concept,this.SetData=function(e){this.SetIndustryData(e),this.SetRegionData(e),this.SetConceptData(e)},this.SetIndustryData=function(e){if(e.industry){this.Industry=[];for(var a in e.industry){var r=e.industry[a];this.Industry.push({Name:r.name,Symbol:r.symbol})}}},this.SetRegionData=function(e){if(e.region){this.Region=[];for(var a in e.region){var r=e.region[a];this.Region.push({Name:r.name,Symbol:r.symbol})}}},this.SetConceptData=function(e){if(e.concept){this.Concept=[];for(var a in e.concept){var r=e.concept[a];this.Concept.push({Name:r.name,Symbol:r.symbol})}}}}function Jg(){this.IsMargin=!1,this.IsHK=!1,this.IsSHHK=!1,this.IsSZHK=!1,this.STType=0,this.HK,this.SetData=function(e){e.events&&(isNaN(e.events.margin)||(this.IsMargin=e.events.margin==1),isNaN(e.events.hk)||(this.IsHK=e.events.hk==1),isNaN(e.events.shhk)||(this.IsSHHK=e.events.shhk==1),isNaN(e.events.szhk)||(this.IsSZHK=e.events.szhk==1),isNaN(e.events.st)||(this.STType=e.events.st),this.IsHK&&e.events.hksymbol&&e.events.hkname&&(this.HK={Symbol:e.events.hksymbol,Name:e.events.hkname}))}}function gf(e){var a=e.toUpperCase();if(a.indexOf(".SH")>0){if(a=a.replace(".SH",""),a.charAt(0)=="0"&&parseInt(a)<=3e3)return!0}else if(a.indexOf(".SZ")>0){if(a=a.replace(".SZ",""),a.charAt(0)=="3"&&a.charAt(1)=="9")return!0}else if(a.indexOf(".CI")>0)return!0;return!1}function Th(e){this.Symbol=e,this.Name,this.Open,this.Price,this.High,this.Low,this.YClose,this.Vol,this.Amount,this.Date,this.Time,this.ExchangeRate,this.Amplitude,this.VolRatio,this.Increase,this.MaxPrice,this.MinPrice,this.RFPrice,this.IndexTop,this.Week,this.MinuteAmplitude={},this.RiseFallSpeed={},this.MAmount={},this.GetBaseData=function(a,r){switch(this.BaseDataTagID.add(a),r){case ot.SYMBOL:return this.Symbol;case ot.NAME:return this.Name;case ot.OPEN:return this.Open;case ot.PRICE:return this.Price;case ot.YCLOSE:return this.YClose;case ot.HIGH:return this.High;case ot.LOW:return this.Low;case ot.VOL:return this.Vol;case ot.AMOUNT:return this.Amount;case ot.DATE:return this.Date;case ot.TIME:return this.Time;case ot.INCREASE:return this.Increase;case ot.EXCHANGE_RATE:return this.ExchangeRate;case ot.AMPLITUDE:return this.Amplitude;case ot.MAX_PRICE:return this.MaxPrice;case ot.MIN_PRICE:return this.MinPrice;case ot.RISE_FALL_PRICE:return this.RFPrice;case ot.VOLRATIO:return this.VolRatio;case ot.INDEXTOP:return this.IndexTop;case ot.WEEK:return this.Week}},this.Heat,this.GetHeatData=function(a){return this.HeatTagID.add(a),this.Heat},this.Sort=new _e.default,this.GetSortData=function(a,r,t){var n=r.toString()+"-"+t.toString();if(!this.Sort.has(n)){var s=new Xg(r,t,a);return this.Sort.set(n,s),s}var s=this.Sort.get(n);return s.TagID.add(a),s},this.Buy5,this.GetBuy5=function(a){return this.BuySellTagID.add(a),this.Buy5},this.Sell5,this.GetSell5=function(a){return this.BuySellTagID.add(a),this.Sell5},this.Deal,this.GetDeal=function(a){return this.DealTagID.add(a),this.Deal},this.MarketValue,this.FlowMarketValue,this.Bookrate,this.Bookdiffer,this.PE,this.PE2,this.PE3,this.PB,this.GetDerivative=function(a,r){switch(this.DerivativeTagID.add(a),r){case ot.MARKET_VALUE:return this.MarketValue;case ot.FLOW_MARKET_VALUE:return this.FlowMarketValue;case ot.BOOK_RATE:return this.Bookrate;case ot.BOOK_DIFFER:return this.Bookdiffer;case ot.PE:return this.PE;case ot.PE2:return this.PE2;case ot.PE3:return this.PE3;case ot.PB:return this.PB}},this.Finance,this.GetFinance=function(a,r){if(!this.Finance)return this.FinanceTagID.add(a),null;switch(r){case ot.ROE:return this.Finance.ROE;case ot.FINANCE_DATE:return this.Finance.Date;case ot.FINANCE_PERSEARNING:return this.Finance.PerSEarning;case ot.FINANCE_PERNETASSET:return this.Finance.PerNetAsset;case ot.FINANCE_NPROFIT:return this.Finance.NProfit;case ot.FINANCE_NPROFITINCREASE:return this.Finance.NProfitIncrease;case ot.FINANCE_NNETPROFIT:return this.Finance.NnetProfit;case ot.FINANCE_NNPROFITINCREASE:return this.Finance.NnProfitIncrease;case ot.FINANCE_NNPROFITSPEED:return this.Finance.NnProfitSpeed;case ot.FINANCE_EPS:return this.Finance.EPS;case ot.FINANCE_BENFORD:return this.Finance.Benford}},this.Capital,this.GetCapital=function(a,r){if(!this.Capital)return this.CapitalTagID.add(a),null;switch(r){case ot.CAPITAL_TOTAL:return this.Capital.Total;case ot.CAPITAL_A:return this.Capital.A;case ot.CAPTIAL_ARATE:return this.Capital.ARate}},this.CapitalFlowDay,this.CapitalFlowDay3,this.CapitalFlowDay5,this.CapitalFlowDay10,this.GetCapitalFlowDay=function(a,r){var t=null;switch(r){case ot.CAPITAL_FLOW_DAY:this.CapitalFlowDayID.add(a),this.CapitalFlowDay&&(t=this.CapitalFlowDay);break;case ot.CAPITAL_FLOW_DAY3:this.CapitalFlowDay3ID.add(a),this.CapitalFlowDay3&&(t=this.CapitalFlowDay3);break;case ot.CAPITAL_FLOW_DAY5:this.CapitalFlowDay5ID.add(a),this.CapitalFlowDay5&&(t=this.CapitalFlowDay5);break;case ot.CAPITAL_FLOW_DAY10:this.CapitalFlowDay10ID.add(a),this.CapitalFlowDay10&&(t=this.CapitalFlowDay10);break}return t},this.DDE,this.DDE3,this.DDE5,this.DDE10,this.GetDDE=function(a,r){var t=null;switch(r){case ot.DDE:this.DDEID.add(a),this.DDE&&(t=this.DDE);break;case ot.DDE3:this.DDE3ID.add(a),this.DDE3&&(t=this.DDE3);break;case ot.DDE5:this.DDE5ID.add(a),this.DDE5&&(t=this.DDE5);break;case ot.DDE10:this.DDE10ID.add(a),this.DDE10&&(t=this.DDE10);break}return t},this.Event,this.GetEvent=function(a,r){return this.Event?this.Event:(this.EventTagID.add(a),null)},this.Company,this.GetCompany=function(a,r){if(!this.Company)return this.CompanyTagID.add(a),null;switch(r){case ot.COMPANY_NAME:return this.Company.Name;case ot.COMPANY_BUSINESS:return this.Company.Business;case ot.COMPANY_VOL:return this.Company.Vol;case ot.COMPANY_PRICE:return this.Company.Price;case ot.COMPANY_RELEASEDATE:return this.Company.ReleaseDate;case ot.COMPANY_COMPETENCE:return this.Company.Competence}},this.Plate,this.GetPlate=function(a,r){if(!this.Plate)return this.PlateTagID.add(a),null;switch(r){case ot.PLATE_INDUSTRY:return this.Plate.Industry;case ot.PLATE_CONCEPT:return this.Plate.Concept;case ot.PLATE_REGION:return this.Plate.Region}},this.TagID=new He.default,this.BaseDataTagID=new He.default,this.HeatTagID=new He.default,this.BuySellTagID=new He.default,this.DealTagID=new He.default,this.DerivativeTagID=new He.default,this.FinanceTagID=new He.default,this.CapitalTagID=new He.default,this.CapitalFlowDayID=new He.default,this.CapitalFlowDay3ID=new He.default,this.CapitalFlowDay5ID=new He.default,this.CapitalFlowDay10ID=new He.default,this.DDEID=new He.default,this.DDE3ID=new He.default,this.DDE5ID=new He.default,this.DDE10ID=new He.default,this.EventTagID=new He.default,this.CompanyTagID=new He.default,this.PlateTagID=new He.default,this.AttachTagID=function(a){this.TagID.add(a)},this.ClearTagID=function(){this.TagID.clear(),this.BaseDataTagID.clear(),this.HeatTagID.clear(),this.BuySellTagID.clear(),this.DealTagID.clear(),this.DerivativeTagID.clear(),this.FinanceTagID.clear(),this.CapitalTagID.clear(),this.CapitalFlowDayID.clear(),this.CapitalFlowDay3ID.clear(),this.CapitalFlowDay5ID.clear(),this.CapitalFlowDay10ID.clear(),this.DDEID.clear(),this.DDE3ID.clear(),this.DDE5ID.clear(),this.DDE10ID.clear(),this.EventTagID.clear(),this.CompanyTagID.clear();var a=!0,r=!1,t=void 0;try{for(var n=(0,Be.default)(this.Sort),s;!(a=(s=n.next()).done);a=!0){var o=s.value;o[1].TagID.clear()}}catch(l){r=!0,t=l}finally{try{!a&&n.return&&n.return()}finally{if(r)throw t}}},this.RemoveTagID=function(a){this.TagID.delete(a),this.BaseDataTagID.delete(a),this.HeatTagID.delete(a),this.BuySellTagID.delete(a),this.DealTagID.delete(a),this.DerivativeTagID.delete(a),this.FinanceTagID.delete(a),this.CapitalTagID.delete(a),this.CapitalFlowDayID.delete(a),this.CapitalFlowDay3ID.delete(a),this.CapitalFlowDay5ID.delete(a),this.CapitalFlowDay10ID.delete(a),this.DDEID.delete(a),this.DDE3ID.delete(a),this.DDE5ID.delete(a),this.DDE10ID.delete(a),this.EventTagID.delete(a),this.CompanyTagID.delete(a);var r=!0,t=!1,n=void 0;try{for(var s=(0,Be.default)(this.Sort),o;!(r=(o=s.next()).done);r=!0){var l=o.value;l[1].TagID.delete(a)}}catch(h){t=!0,n=h}finally{try{!r&&s.return&&s.return()}finally{if(t)throw n}}},this.SetBaseData=function(a){this.Name=a.name,this.YClose=a.yclose,this.Price=a.price,this.High=a.high,this.Low=a.low,this.Open=a.open,this.Vol=a.vol,this.Amount=a.amount,this.Date=a.date,this.Time=a.time,this.Increase=a.increase,isNaN(a.exchangerate)||(this.ExchangeRate=a.exchangerate),isNaN(a.amplitude)||(this.Amplitude=a.amplitude),isNaN(a.volratio)||(this.VolRatio=a.volratio),this.Name.indexOf("ST")>=0?(this.MaxPrice=(1+.05)*this.Open,this.MinPrice=(1-.05)*this.Open):(this.MaxPrice=(1+.1)*this.Open,this.MinPrice=(1-.1)*this.Open),this.Price&&this.YClose&&(this.RFPrice=this.Price-this.YClose),a.week&&(this.Week={},this.Week.Week1=a.week.week1,this.Week.Week4=a.week.week4,this.Week.Week13=a.week.week13,this.Week.Week26=a.week.week26,this.Week.Week52=a.week.week52)},this.SetDerivativeData=function(a){this.MarketValue=a.marketvalue,this.FlowMarketValue=a.flowmarketvalue,this.Bookrate=a.bookrate,this.Bookdiffer=a.bookdiffer,this.PE=a.pe,this.PE2=a.pe2,this.PE3=a.pe3,this.PB=a.pb},this.SetFinanceData=function(a){console.log(a),a.finance&&(this.Finance=new kg,this.Finance.SetData(a))},this.SetCapitalData=function(a){a.capital&&(this.Capital=new Wg,this.Capital.SetData(a))},this.SetIndexBaseData=function(a){this.SetBaseData(a);var r=new Vg;a.indextop&&(r.Up=a.indextop.up,r.Down=a.indextop.down,r.Unchanged=a.indextop.unchanged,r.Stop=a.indextop.stop,r.UpStock.Symbol=a.indextop.upstock.symbol,r.UpStock.Name=a.indextop.upstock.name,r.DownStock.Symbol=a.indextop.downstock.symbol,r.DownStock.Name=a.indextop.downstock.name),this.IndexTop=r},this.SetBuySellData=function(a){this.SetBaseData(a),this.Buy5=new Array,this.Sell5=new Array;for(var r in a.buy){var t=a.buy[r];this.Buy5.push({Price:t.price,Vol:t.vol})}for(var r in a.sell){var t=a.sell[r];this.Sell5.push({Price:t.price,Vol:t.vol})}},this.SetDealData=function(a){this.Price=a.price,this.High=a.high,this.Low=a.low,this.Vol=a.vol,this.Amount=a.amount,this.Date=a.date,this.Time=a.time,this.Increase=a.increase,this.Deal=new Array;for(var r in a.deal){var t=a.deal[r];if(!(isNaN(t.price)||isNaN(t.time))){var n="";t.bs===0?n="B":t.bs===1&&(n="S"),this.Deal.push({Price:t.price,Amount:t.amount,Vol:t.vol,Time:t.time,BS:n})}}},this.SetHeatData=function(a){var r=new Yg;r.Good=a.quadrant.good,r.GoodIncrease.Day1=a.quadrant.gincrease.day1,r.GoodIncrease.Week1=a.quadrant.gincrease.week1,r.GoodIncrease.Week4=a.quadrant.gincrease.week4,this.Heat=r},this.SetCapitalFlowDayData=function(a,r){if(a)switch(r){case mt.CAPITAL_FLOW_DAY_DATA:this.CapitalFlowDay=new Ug,this.CapitalFlowDay.SetData(a);break;case mt.CAPITAL_FLOW_DAY3_DATA:this.CapitalFlowDay3=new ko,this.CapitalFlowDay3.SetData(a);break;case mt.CAPITAL_FLOW_DAY5_DATA:this.CapitalFlowDay5=new ko,this.CapitalFlowDay5.SetData(a);break;case mt.CAPITAL_FLOW_DAY10_DATA:this.CapitalFlowDay10=new ko,this.CapitalFlowDay10.SetData(a);break}},this.SetDDE=function(a,r){if(a){switch(r){case mt.DDE_DAY_DATA:this.DDE=new tn,this.DDE.SetData(a);break;case mt.DDE_DAY3_DATA:this.DDE3=new tn,this.DDE3.SetData(a);break;case mt.DDE_DAY5_DATA:this.DDE5=new tn,this.DDE5.SetData(a);break;case mt.DDE_DAY10_DATA:this.DDE10=new tn,this.DDE10.SetData(a);break}return a}},this.SetEventData=function(a){a.events&&(this.Event=new Jg,this.Event.SetData(a))},this.SetCompanyData=function(a){a.company&&(this.Company=new Kg,this.Company.SetData(a))},this.SetPlateData=function(a){!a.industry&&!a.region&&!a.concept||(this.Plate=new zg,this.Plate.SetData(a))},this.SetData=function(a){a.name&&(this.Name=a.name),isNaN(a.yclose)||(this.YClose=a.yclose),isNaN(a.price)||(this.Price=a.price),isNaN(a.high)||(this.High=a.high),isNaN(a.low)||(this.Low=a.low),isNaN(a.vol)||(this.Vol=a.vol),isNaN(a.amount)||(this.Amount=a.amount),isNaN(a.date)||(this.Date=a.date),isNaN(a.time)||(this.Time=a.time),isNaN(a.increase)||(this.Increase=a.increase),isNaN(a.marketvalue)||(this.MarketValue=a.marketvalue),isNaN(a.flowmarketvalue)||(this.FlowMarketValue=a.flowmarketvalue),isNaN(a.bookrate)||(this.Bookrate=a.bookrate),isNaN(a.bookdiffer)||(this.Bookdiffer=a.bookdiffer),isNaN(a.pe)||(this.PE=a.pe),isNaN(a.pb)||(this.PB=a.pb),a.finance&&this.SetFinanceData(a),a.finance&&this.SetFinanceDetailData(a),a.capital&&this.SetCapitalData(a),a.mamplitude&&(isNaN(a.mamplitude[1])||(this.MinuteAmplitude.M1=a.mamplitude[1]),isNaN(a.mamplitude[3])||(this.MinuteAmplitude.M3=a.mamplitude[3]),isNaN(a.mamplitude[5])||(this.MinuteAmplitude.M5=a.mamplitude[5]),isNaN(a.mamplitude[10])||(this.MinuteAmplitude.M10=a.mamplitude[10]),isNaN(a.mamplitude[15])||(this.MinuteAmplitude.M15=a.mamplitude[15])),a.risefallspeed&&(isNaN(a.risefallspeed[1])||(this.RiseFallSpeed.M1=a.risefallspeed[1]),isNaN(a.risefallspeed[3])||(this.RiseFallSpeed.M3=a.risefallspeed[3]),isNaN(a.risefallspeed[5])||(this.RiseFallSpeed.M5=a.risefallspeed[5]),isNaN(a.risefallspeed[10])||(this.RiseFallSpeed.M10=a.risefallspeed[10]),isNaN(a.risefallspeed[15])||(this.RiseFallSpeed.M15=a.risefallspeed[15])),a.mamount&&(isNaN(a.mamount[1])||(this.MAmount.M1=a.mamount[1]),isNaN(a.mamount[3])||(this.MAmount.M5=a.mamount[3]),isNaN(a.mamount[5])||(this.MAmount.M5=a.mamount[5]),isNaN(a.mamount[10])||(this.MAmount.M10=a.mamount[10]),isNaN(a.mamount[15])||(this.MAmount.M15=a.mamount[15]))}}var ot={SYMBOL:0,NAME:1,OPEN:2,PRICE:3,HIGH:4,LOW:5,YCLOSE:6,VOL:7,AMOUNT:8,DATE:9,TIME:10,INCREASE:11,BUY5:12,SELL5:13,DEAL:14,AMPLITUDE:15,MARKET_VALUE:16,FLOW_MARKET_VALUE:17,BOOK_RATE:18,BOOK_DIFFER:19,PE:20,PB:21,EXCHANGE_RATE:23,ROE:24,FINANCE_DATE:25,FINANCE_PERSEARNING:26,FINANCE_PERNETASSET:27,FINANCE_NPROFIT:28,FINANCE_NPROFITINCREASE:29,FINANCE_NNETPROFIT:30,FINANCE_NNPROFITINCREASE:31,FINANCE_NNPROFITSPEED:32,FINANCE_EPS:33,MAX_PRICE:34,MIN_PRICE:35,RISE_FALL_PRICE:36,FINANCE_BENFORD:37,RISEFALLSPEED_1:38,RISEFALLSPEED_3:39,RISEFALLSPEED_5:40,RISEFALLSPEED_10:41,RISEFALLSPEED_15:42,MINUTE_AMPLITUDE_1:43,MINUTE_AMPLITUDE_3:44,MINUTE_AMPLITUDE_5:45,MINUTE_AMPLITUDE_10:46,MINUTE_AMPLITUDE_15:47,MINUTE_AMOUNT_1:48,MINUTE_AMOUNT_3:49,MINUTE_AMOUNT_5:50,MINUTE_AMOUNT_10:51,MINUTE_AMOUNT_15:52,COMPANY_NAME:53,PLATE_INDUSTRY:54,PLATE_CONCEPT:55,PLATE_REGION:56,COMPANY_BUSINESS:57,COMPANY_VOL:58,COMPANY_PRICE:59,COMPANY_RELEASEDATE:60,COMPANY_COMPETENCE:61,CAPITAL_FLOW_DAY:67,CAPITAL_FLOW_DAY3:68,CAPITAL_FLOW_DAY5:69,CAPITAL_FLOW_DAY10:70,DDE:71,DDE3:72,DDE5:73,DDE10:74,EVENTS:75,CAPITAL_A:76,CAPITAL_TOTAL:77,CAPTIAL_ARATE:78,VOLRATIO:79,PE2:80,PE3:81,INDEXTOP:100,WEEK:101,HEAT:102},pf={m_mapFiled:new _e.default([[ot.NAME,"name"],[ot.SYMBOL,"symbol"],[ot.PRICE,"price"],[ot.INCREASE,"increase"],[ot.PE,"pe"],[ot.FINANCE_BENFORD,"finance.benford"],[ot.YCLOSE,"yclose"],[ot.RISEFALLSPEED_1,"risefallspeed.1"],[ot.RISEFALLSPEED_3,"risefallspeed.3"],[ot.RISEFALLSPEED_5,"risefallspeed.5"],[ot.RISEFALLSPEED_10,"risefallspeed.10"],[ot.RISEFALLSPEED_15,"risefallspeed.15"],[ot.MINUTE_AMPLITUDE_1,"mamplitude.1"],[ot.MINUTE_AMPLITUDE_3,"mamplitude.3"],[ot.MINUTE_AMPLITUDE_5,"mamplitude.5"],[ot.MINUTE_AMPLITUDE_10,"mamplitude.10"],[ot.MINUTE_AMPLITUDE_15,"mamplitude.15"],[ot.MINUTE_AMOUNT_1,"mamount.1"],[ot.MINUTE_AMOUNT_3,"mamount.3"],[ot.MINUTE_AMOUNT_5,"mamount.5"],[ot.MINUTE_AMOUNT_10,"mamount.10"],[ot.MINUTE_AMOUNT_15,"mamount.15"]]),GetFieldName:function(a){return this.m_mapFiled.has(a)?this.m_mapFiled.get(a):null}};function RD(e,a){this.JSStock=e,this.TagID=a,this.Get=function(r,t){var n=e.Get(r,this.TagID);if(!n)return null;switch(t){case ot.SYMBOL:case ot.NAME:case ot.OPEN:case ot.PRICE:case ot.YCLOSE:case ot.HIGH:case ot.LOW:case ot.VOL:case ot.AMOUNT:case ot.DATE:case ot.TIME:case ot.INCREASE:case ot.EXCHANGE_RATE:case ot.AMPLITUDE:case ot.MAX_PRICE:case ot.MIN_PRICE:case ot.RISE_FALL_PRICE:case ot.INDEXTOP:case ot.WEEK:case ot.VOLRATIO:return n.GetBaseData(this.TagID,t);case ot.HEAT:return n.GetHeatData(this.TagID);case ot.BUY5:return n.GetBuy5(this.TagID);case ot.SELL5:return n.GetSell5(this.TagID);case ot.DEAL:return n.GetDeal(this.TagID);case ot.MARKET_VALUE:case ot.FLOW_MARKET_VALUE:case ot.BOOK_RATE:case ot.BOOK_DIFFER:case ot.PE:case ot.PE2:case ot.PE3:case ot.PB:return n.GetDerivative(this.TagID,t);case ot.ROE:case ot.FINANCE_DATE:case ot.FINANCE_PERSEARNING:case ot.FINANCE_PERNETASSET:case ot.FINANCE_NPROFIT:case ot.FINANCE_NPROFITINCREASE:case ot.FINANCE_NNETPROFIT:case ot.FINANCE_NNPROFITINCREASE:case ot.FINANCE_NNPROFITSPEED:case ot.FINANCE_EPS:case ot.FINANCE_BENFORD:return n.GetFinance(this.TagID,t);case ot.PLATE_INDUSTRY:case ot.PLATE_CONCEPT:case ot.PLATE_REGION:return n.GetPlate(this.TagID,t);case ot.CAPITAL_FLOW_DAY:case ot.CAPITAL_FLOW_DAY3:case ot.CAPITAL_FLOW_DAY5:case ot.CAPITAL_FLOW_DAY10:return n.GetCapitalFlowDay(this.TagID,t);case ot.DDE:case ot.DDE3:case ot.DDE5:case ot.DDE10:return n.GetDDE(this.TagID,t);case ot.EVENTS:return n.GetEvent(this.TagID,t);case ot.COMPANY_NAME:case ot.COMPANY_BUSINESS:case ot.COMPANY_VOL:case ot.COMPANY_PRICE:case ot.COMPANY_RELEASEDATE:case ot.COMPANY_COMPETENCE:return n.GetCompany(this.TagID,t);case ot.CAPITAL_A:case ot.CAPTIAL_ARATE:case ot.CAPITAL_TOTAL:return n.GetCapital(this.TagID,t);default:return null}},this.GetSort=function(r,t,n){var s=e.Get(r,this.TagID);return s==null?s:s.GetSortData(this.TagID,t,n)},this.EndRead=function(r){r==!0&&this.JSStock.ReqeustData()},this.SetQueryField=function(r,t){for(var n in t)this.Get(r,t[n])}}function Zg(){this.Symbol,this.Callback,this.Order=-1,this.SortField,this.Field,this.Plate,this.Data=new _e.default,this.ApiUrl=ca.Domain+"/API/StockHistoryDay",this.PageSize=20,this.PageIndex=1,this.Count,this.currentData=null,this.RequsetData=function(e,a){var r=this,t=typeof r.Symbol=="string"?[this.Symbol]:this.Symbol,n=t?t.length:0;this.Plate?this.currentData={plate:this.Plate,symbol:t,start:0,end:this.PageSize,field:this.Field,orderfield:this.SortField,order:this.Order,condition:e.GetQuery(),condition2:a?a.GetQuery():[]}:this.currentData={symbol:t,start:0,end:n,field:this.Field,orderfield:this.SortField,order:this.Order,condition:e.GetQuery(),condition2:a?a.GetQuery():[]},Pe.default.ajax({url:this.ApiUrl,data:r.currentData,method:"POST",dataType:"json",success:function(o){r.Count=o.data.count,r.RecvData(o,e)},fail:function(o){r.RecvError(o,e)}})},this.GetNextPage=function(){var e=this;this.PageSize*this.PageIndex<this.Count?(this.currentData.start=this.PageSize*this.PageIndex,this.PageIndex++,this.currentData.end=this.PageSize*this.PageIndex,Pe.default.ajax({url:this.ApiUrl,data:e.currentData,method:"POST",dataType:"json",success:function(r){e.RecvData(r)},fail:function(r){e.RecvError(r)}})):alert("数据已全部加载")},this.RecvData=function(e,a){var r=e.data;for(var t in r.stock){var n=r.stock[t],s=n.symbol,o={};this.Data.has(s)?o=this.Data.get(s):(o={Symbol:n.symbol,Name:n.name,Data:new _e.default},this.Data.set(s,o)),this.SetStockData(n,o)}this.Callback&&this.Callback(this,a)},this.SetStockData=function(e,a){for(var r in e.stockday){var t=e.stockday[r],n=t.date,s=new _e.default;this.SetFinanceData(t,s),this.SetBlocktradingData(t,s),this.SetChangesData(t,s),this.SetLiftingData(t,s),this.SetPforecastData(t,s),this.SetShortIndicatorsData(t,s),a.Data.set(n,s)}return a},this.SetFinanceData=function(e,a){var r=e.finance1;r&&(isNaN(r.nprofitincrease)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_NPROFITINCREASE,r.nprofitincrease),isNaN(r.nnprofitincrease)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_NNPROFITINCREASE,r.nnprofitincrease),isNaN(r.nnprofitspeed)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_NNPROFITSPEED,r.nnprofitspeed),isNaN(r.benford)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_BENFORD,r.benford));var t=e.announcement1;t&&(isNaN(t.year)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_YEAR,t.year),isNaN(t.quarter)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_QUARTER,t.quarter));var r=e.finance2;r&&(isNaN(r.nprofitincrease)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_NPROFITINCREASE,r.nprofitincrease),isNaN(r.nnprofitincrease)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_NNPROFITINCREASE,r.nnprofitincrease),isNaN(r.nnprofitspeed)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_NNPROFITSPEED,r.nnprofitspeed),isNaN(r.benford)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_BENFORD,r.benford));var t=e.announcement2;t&&(isNaN(t.year)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_YEAR,t.year),isNaN(t.quarter)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_QUARTER,t.quarter));var r=e.finance3;r&&(isNaN(r.nprofitincrease)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_NPROFITINCREASE,r.nprofitincrease),isNaN(r.nnprofitincrease)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_NNPROFITINCREASE,r.nnprofitincrease),isNaN(r.nnprofitspeed)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_NNPROFITSPEED,r.nnprofitspeed),isNaN(r.benford)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_BENFORD,r.benford));var t=e.announcement3;t&&(isNaN(t.year)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_YEAR,t.year),isNaN(t.quarter)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_QUARTER,t.quarter));var r=e.finance4;r&&(isNaN(r.nprofitincrease)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_NPROFITINCREASE,r.nprofitincrease),isNaN(r.nnprofitincrease)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_NNPROFITINCREASE,r.nnprofitincrease),isNaN(r.nnprofitspeed)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_NNPROFITSPEED,r.nnprofitspeed),isNaN(r.benford)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_BENFORD,r.benford));var t=e.announcement4;t&&(isNaN(t.year)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_YEAR,t.year),isNaN(t.quarter)||a.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_QUARTER,t.quarter))},this.SetBlocktradingData=function(e,a){var r=e.blocktrading;r&&a.set(STOCK_HISTORY_FIELD_NAME.BLOCK_TRADING,{Premium:r.premium,Price:r.price,Vol:r.vol,Amount:r.amount})},this.SetChangesData=function(e,a){var r=e.changes;r&&a.set(STOCK_HISTORY_FIELD_NAME.HOLDERS_CHANGES,{List:r.list})},this.SetLiftingData=function(e,a){var r=e.lifting;r&&a.set(STOCK_HISTORY_FIELD_NAME.LIFTING,{Lifting:r})},this.SetPforecastData=function(e,a){var r=e.pforecast;r&&a.set(STOCK_HISTORY_FIELD_NAME.PFORECAST,{Lowprofit:r[0].lowprofit,Highprofit:r[0].highprofit,Lowchange:r[0].lowchange,Highchange:r[0].highchange,Reportdate:r[0].reportdate})},this.SetShortIndicatorsData=function(e,a){var r=e.policy;if(r){var t=["三只乌鸦","乌云盖顶","黄昏之星","巨量阴线","头肩顶","射击之星","倾盆大雨","断头铡刀","淡友反攻","空方炮","连续1周空头排列"],n=0,s=[],o=0,l="";r.forEach(function(h){var u=t.some(function(f){return f===h.name});u&&(n++,s.push(h.time))}),n?(o=Math.max.apply(s,s),l=r.find(function(h){return h.time===o}).name):l="",console.log(l,n,"latestName-targetedCount"),a.set(STOCK_HISTORY_FIELD_NAME.SHORTIND_ICATORS,{latestIndicatorName:l,indicatorCount:n})}},this.RecvError=function(e,a){},this.CreateCondition=function(e){return new QueryCondition(e)}}sa.Init=function(){var e=new sa;return e};sa.SetDomain=function(e,a){e&&(ca.Domain=e),a&&(ca.CacheDomain=a)};sa.GetSearchStock=function(e){return new Qg(e)};sa.GetShortTerm=function(e){return new $g(e)};sa.GetDealDay=function(e){return new qg(e)};sa.GetBlockMember=function(e){return new jg(e)};sa.GetBlockTop=function(){return new tp};sa.GetMinuteImage=function(e){return new ep(e)};sa.GetHistoryDayData=function(e){return new ap(e)};sa.GetDealPriceListData=function(e){return new ip(e)};sa.GetLatestDetailData=function(e){return new rp(e)};sa.GetAnalylisPlate=function(){return new sp};sa.GetStockHistory=function(){return new Zg};var mt={BASE_DATA:1,INDEX_BASE_DATA:2,HEAT_DATA:3,SORT_DATA:4,BUY_SELL_DATA:5,DEAL_DATA:6,DERIVATIVE_DATA:7,FINANCE_DATA:8,SEARCH_STOCK_DATA:9,SELF_STOCK_DATA:10,LOGON_DATA:11,BLOCK_MEMBER_DATA:13,SHORT_TERM_DATA:14,COMPANY_DATA:15,PLATE_DATA:16,CAPITAL_DATA:17,CAPITAL_FLOW_DAY_DATA:23,CAPITAL_FLOW_DAY3_DATA:24,CAPITAL_FLOW_DAY5_DATA:25,CAPITAL_FLOW_DAY10_DATA:26,DDE_DAY_DATA:27,DDE_DAY3_DATA:28,DDE_DAY5_DATA:29,DDE_DAY10_DATA:30,DEAL_DAY_DATA:105,EVENT_DATA:106,IMAGE_MINUTE_DATA:107,HISTORY_DAY_DATA:108,DEAL_PRICE_LIST_DATA:109,LATEST_DETAIL_DATA:110};function sa(){this.MapStock=new _e.default,this.MapTagCallback=new _e.default,this.RequestVersion=new Array([100,100,100]),this.RealtimeApiUrl=ca.Domain+"/API/Stock",this.PlateQuadrantApiUrl=ca.Domain+"/API/StockPlateQuadrant",this.IsAutoUpdate=!0,this.AutoUpateTimeout=15e3,this.Timeout,this.NetworkFilter,this.GetStockRead=function(e,a){var r=!0,t=!1,n=void 0;try{for(var s=(0,Be.default)(this.MapStock),o;!(r=(o=s.next()).done);r=!0){var l=o.value;l[1].RemoveTagID(e)}}catch(u){t=!0,n=u}finally{try{!r&&s.return&&s.return()}finally{if(t)throw n}}this.MapTagCallback.set(e,a);var h=new RD(this,e);return h},this.Unsubscribe=function(e){var a=!0,r=!1,t=void 0;try{for(var n=(0,Be.default)(this.MapStock),s;!(a=(s=n.next()).done);a=!0){var o=s.value;o[1].RemoveTagID(e)}}catch(l){r=!0,t=l}finally{try{!a&&n.return&&n.return()}finally{if(r)throw t}}},this.UnsubscribeStock=function(e,a){var r=!0,t=!1,n=void 0;try{for(var s=(0,Be.default)(this.MapStock),o;!(r=(o=s.next()).done);r=!0){var l=o.value;if(l[0]===e){a?l[1].RemoveTagID(a):l[1].ClearTagID(),console.log("[JSStock::UnsubscribeStock] symbol="+e+", tagID="+a);break}}}catch(h){t=!0,n=h}finally{try{!r&&s.return&&s.return()}finally{if(t)throw n}}},this.Get=function(e,a){this.MapStock.has(e)||this.MapStock.set(e,new Th(e));var r=this.MapStock.get(e);return a&&r.AttachTagID(a),r},this.RequestData=function(){this.ClearTimer();var e=new Array,a=new Array,r=new Array,t=new Array,n=new Array,s=new Array,o=new Array,l=[],h=[],u=[],f=[],C=[],D=[],c=[],T=[],S=new Array,I=new Array,g=new Array,E=new Array,F=!0,R=!1,A=void 0;try{for(var P=(0,Be.default)(this.MapStock),p;!(F=(p=P.next()).done);F=!0){var w=p.value,H=w[1],W=w[0];H.BaseDataTagID.size>0&&(gf(W)?a.push(W):e.push(W)),H.BuySellTagID.size>0&&t.push(W),H.CapitalFlowDayID.size>0&&l.push(W),H.CapitalFlowDay3ID.size>0&&h.push(W),H.CapitalFlowDay5ID.size>0&&u.push(W),H.CapitalFlowDay10ID.size>0&&f.push(W),H.DDEID.size>0&&C.push(W),H.DDE3ID.size>0&&D.push(W),H.DDE5ID.size>0&&c.push(W),H.DDE10ID.size>0&&T.push(W),H.HeatTagID.size>0&&r.push(W),H.DealTagID.size>0&&n.push(W),H.DerivativeTagID.size>0&&s.push(W),H.FinanceTagID.size>0&&o.push(W),H.CapitalTagID.size>0&&E.push(W),H.Event==null&&H.EventTagID.size>0&&S.push(W),H.Company==null&&H.CompanyTagID.size>0&&I.push(W),w[1].Plate==null&&w[1].PlateTagID.size>0&&g.push(w[0])}}catch(ht){R=!0,A=ht}finally{try{!F&&P.return&&P.return()}finally{if(R)throw A}}t.length>0&&this.RequestBuySellData(t),e.length>0&&this.RequestBaseData(e),a.length>0&&this.RequestIndexBaseData(a),r.length>0&&this.RequestIndexHeatData(r),n.length>0&&this.RequestDealData(n),s.length>0&&this.RequestDerivativeData(s),o.length>0&&this.RequestFinanceData(o),E.length>0&&this.RequestCapitalData(E),l.length>0&&this.RequestSubDocumentData(l,"flowday"),h.length>0&&this.RequestSubDocumentData(h,"flowday3"),u.length>0&&this.RequestSubDocumentData(u,"flowday5"),f.length>0&&this.RequestSubDocumentData(f,"flowday10"),C.length>0&&this.RequestSubDocumentData(C,"dde"),D.length>0&&this.RequestSubDocumentData(D,"dde3"),c.length>0&&this.RequestSubDocumentData(c,"dde5"),T.length>0&&this.RequestSubDocumentData(T,"dde10"),S.length>0&&this.RequestEventData(S),I.length>0&&this.RequestCompanyData(I),g.length>0&&this.RequestPlateData(g),this.ReqeustAllSortData()},this.ReqeustData=this.RequestData,this.RequestBaseData=function(e){var a=this,r=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","increase","exchangerate","amplitude","volratio"];if(this.NetworkFilter){var t={Name:"JSStock::RequestBaseData",Explain:"股票基础数据",ID:mt.BASE_DATA,Request:{Url:a.RealtimeApiUrl,Data:{field:r,symbol:e},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(n){a.RecvData(n,mt.BASE_DATA)}),t.PreventDefault==!0)return}Pe.default.ajax({url:this.RealtimeApiUrl,data:{field:r,symbol:e},type:"post",dataType:"json",async:!0,success:function(s){a.RecvData(s,mt.BASE_DATA)},error:function(s){a.RecvError(s,mt.BASE_DATA)}})},this.RequestDerivativeData=function(e){var a=this,r=["name","symbol","marketvalue","flowmarketvalue","pe","pe2","pe3","pb","bookrate","bookdiffer"];if(this.NetworkFilter){var t={Name:"JSStock::RequestDerivativeData",Explain:"实时衍生数据",ID:mt.DERIVATIVE_DATA,Request:{Url:a.RealtimeApiUrl,Data:{field:r,symbol:e},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(n){a.RecvData(n,mt.DERIVATIVE_DATA)}),t.PreventDefault==!0)return}Pe.default.ajax({url:this.RealtimeApiUrl,data:{field:r,symbol:e},type:"post",dataType:"json",async:!0,success:function(s){a.RecvData(s,mt.DERIVATIVE_DATA)},error:function(s){a.RecvError(s,mt.DERIVATIVE_DATA)}})},this.RequestFinanceData=function(e){var a=this,r=["name","symbol","roe","finance"];if(this.NetworkFilter){var t={Name:"JSStock::RequestFinanceData",Explain:"财务数据",ID:mt.FINANCE_DATA,Request:{Url:a.RealtimeApiUrl,Data:{field:r,symbol:e},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(n){a.RecvData(n,mt.FINANCE_DATA)}),t.PreventDefault==!0)return}Pe.default.ajax({url:this.RealtimeApiUrl,data:{field:r,symbol:e},type:"post",dataType:"json",async:!0,success:function(s){a.RecvData(s,mt.FINANCE_DATA)},error:function(s){a.RecvError(s,mt.FINANCE_DATA)}})},this.RequestCapitalData=function(e){var a=this,r=["name","symbol","capital"];if(this.NetworkFilter){var t={Name:"JSStock::RequestCapitalData",Explain:"股本数据",ID:mt.CAPITAL_DATA,Request:{Url:a.RealtimeApiUrl,Data:{field:r,symbol:e},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(n){a.RecvData(n,mt.CAPITAL_DATA)}),t.PreventDefault==!0)return}Pe.default.ajax({url:this.RealtimeApiUrl,data:{field:r,symbol:e},type:"post",dataType:"json",async:!0,success:function(s){a.RecvData(s,mt.CAPITAL_DATA)},error:function(s){a.RecvError(s,mt.CAPITAL_DATA)}})},this.RequestBuySellData=function(e){var a=this,r=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","increase","buy","sell","exchangerate","amplitude"];if(this.NetworkFilter){var t={Name:"JSStock::RequestBuySellData",Explain:"买卖盘数据",ID:mt.BUY_SELL_DATA,Request:{Url:a.RealtimeApiUrl,Data:{field:r,symbol:e},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(n){a.RecvData(n,mt.BUY_SELL_DATA)}),t.PreventDefault==!0)return}Pe.default.ajax({url:this.RealtimeApiUrl,data:{field:r,symbol:e},type:"post",dataType:"json",async:!0,success:function(s){a.RecvData(s,mt.BUY_SELL_DATA)},error:function(s){a.RecvError(s,mt.BUY_SELL_DATA)}})},this.RequestDealData=function(e){var a=this,r=["name","symbol","price","high","low","vol","amount","date","time","increase","deal"];if(this.NetworkFilter){var t={Name:"JSStock::RequestDealData",Explain:"分笔数据",ID:mt.DEAL_DATA,Request:{Url:a.RealtimeApiUrl,Data:{field:r,symbol:e},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(n){a.RecvData(n,mt.DEAL_DATA)}),t.PreventDefault==!0)return}Pe.default.ajax({url:this.RealtimeApiUrl,data:{field:r,symbol:e},type:"post",dataType:"json",async:!0,success:function(s){a.RecvData(s,mt.DEAL_DATA)},error:function(s){a.RecvError(s,mt.DEAL_DATA)}})},this.RequestIndexBaseData=function(e){var a=this,r=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","indextop","increase"];if(this.NetworkFilter){var t={Name:"JSStock::RequestIndexBaseData",Explain:"指数基础数据(包含上涨下跌家数)",ID:mt.INDEX_BASE_DATA,Request:{Url:a.RealtimeApiUrl,Data:{field:r,symbol:e},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(n){a.RecvData(n,mt.INDEX_BASE_DATA)}),t.PreventDefault==!0)return}Pe.default.ajax({url:this.RealtimeApiUrl,data:{field:r,symbol:e},type:"post",dataType:"json",async:!0,success:function(s){console.log(s),a.RecvData(s,mt.INDEX_BASE_DATA)},error:function(s){a.RecvError(s,mt.INDEX_BASE_DATA)}})},this.RequestIndexHeatData=function(e){var a=this;Pe.default.ajax({url:this.PlateQuadrantApiUrl,data:{plate:e},type:"post",dataType:"json",async:!0,success:function(t){a.RecvData(t,mt.HEAT_DATA)},error:function(t){a.RecvError(t,mt.HEAT_DATA)}})},this.ReqeustAllSortData=function(){var e=new Array,a=!0,r=!1,t=void 0;try{for(var n=(0,Be.default)(this.MapStock),s;!(a=(s=n.next()).done);a=!0){var o=s.value;if(gf(o[0])&&!(o[1].Sort==null||o[1].Sort.size<=0)){var l=!0,h=!1,u=void 0;try{for(var f=(0,Be.default)(o[1].Sort),C;!(l=(C=f.next()).done);l=!0){var D=C.value,c=D[1],T={Plate:o[0],SortField:c.SortField,Order:c.Order,TagID:c.TagID};e.push(T)}}catch(I){h=!0,u=I}finally{try{!l&&f.return&&f.return()}finally{if(h)throw u}}}}}catch(I){r=!0,t=I}finally{try{!a&&n.return&&n.return()}finally{if(r)throw t}}for(var S in e){var D=e[S];this.ReqeustSortData(D)}},this.ReqeustSortData=function(e){var a=this,r=e,t="";switch(r.SortField){case ot.INCREASE:t="increase";break;case ot.PRICE:t="price";break;default:return}var n=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","increase","exchangerate"];if(this.NetworkFilter){var s={Name:"JSStock::ReqeustSortData",Explain:"板块排序数据",ID:mt.SORT_DATA,Request:{Url:a.RealtimeApiUrl,Data:{field:n,plate:[e.Plate],orderfield:t,order:e.Order,ordernull:1,filterstop:1},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(o){a.RecvData(o,mt.SORT_DATA,r)}),s.PreventDefault==!0)return}Pe.default.ajax({url:this.RealtimeApiUrl,data:{field:n,plate:[e.Plate],orderfield:t,order:e.Order,ordernull:1,filterstop:1},type:"post",dataType:"json",async:!0,success:function(l){a.RecvData(l,mt.SORT_DATA,r)},error:function(l){a.RecvError(l,mt.SORT_DATA,r)}})},this.RequestSubDocumentData=function(e,a){var r=this,t=new _e.default([["flowday",{Field:"flowday",RecvID:mt.CAPITAL_FLOW_DAY_DATA}],["flowday3",{Field:"flowday3",RecvID:mt.CAPITAL_FLOW_DAY3_DATA}],["flowday5",{Field:"flowday5",RecvID:mt.CAPITAL_FLOW_DAY5_DATA}],["flowday10",{Field:"flowday10",RecvID:mt.CAPITAL_FLOW_DAY10_DATA}],["dde",{Field:"dde",RecvID:mt.DDE_DAY_DATA}],["dde3",{Field:"dde3",RecvID:mt.DDE_DAY3_DATA}],["dde5",{Field:"dde5",RecvID:mt.DDE_DAY5_DATA}],["dde10",{Field:"dde10",RecvID:mt.DDE_DAY10_DATA}]]);if(t.has(a)){var n=t.get(a);if(this.NetworkFilter){var s={Name:"JSStock::RequestSubDocumentData",Explain:"子文档数据",ID:n.RecvID,Request:{Url:r.RealtimeApiUrl,Data:{field:["symbol",n.Field],symbol:e,start:0,end:50},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(o){r.RecvData(o,n.RecvID)}),s.PreventDefault==!0)return}Pe.default.ajax({url:this.RealtimeApiUrl,data:{field:["symbol",n.Field],symbol:e,start:0,end:50},type:"post",dataType:"json",success:function(l){r.RecvData(l,n.RecvID)},error:function(l){r.RecvError(l,n.RecvID)}})}},this.RequestEventData=function(e){var a=this;Pe.default.ajax({url:this.RealtimeApiUrl,data:{field:["symbol","events.margin","events.shhk","events.hk","events.st","events.hksymbol","events.hkname","events.szhk"],symbol:e,start:0,end:50},type:"POST",dataType:"json",success:function(t){a.RecvData(t,mt.EVENT_DATA)},error:function(t){a.RecvError(t,mt.EVENT_DATA)}})},this.RequestCompanyData=function(e){var a=this;Pe.default.ajax({url:this.RealtimeApiUrl,data:{field:["name","symbol","company"],symbol:e,start:0,end:50},type:"POST",dataType:"json",success:function(t){a.RecvData(t,mt.COMPANY_DATA)},error:function(t){a.RecvError(t,mt.COMPANY_DATA)}})},this.RequestPlateData=function(e){var a=this;Pe.default.ajax({url:this.RealtimeApiUrl,data:{field:["name","symbol","industry","region","concept"],symbol:e,start:0,end:50},type:"POST",dataType:"json",success:function(t){a.RecvData(t,mt.PLATE_DATA)},error:function(t){a.RecvError(t,mt.PLATE_DATA)}})},this.RecvError=function(e,a,r){console.log("RecvError: datatype="+a.toString()),console.log(e);var t=this;this.Timeout&&clearTimeout(this.Timeout),this.Timeout=setTimeout(function(){t.ReqeustData()},this.AutoUpateTimeout*2)},this.RecvData=function(e,a,r){var t;switch(a){case mt.BASE_DATA:case mt.INDEX_BASE_DATA:t=this.RecvBaseData(e,a);break;case mt.HEAT_DATA:t=this.RecvHeatData(e,a);break;case mt.SORT_DATA:t=this.RecvSortData(e,a,r);break;case mt.BUY_SELL_DATA:t=this.RecvBuySellData(e,a);break;case mt.DEAL_DATA:t=this.RecvDealData(e,a);break;case mt.DERIVATIVE_DATA:t=this.RecvDerivativeData(e,a);break;case mt.FINANCE_DATA:t=this.RecvFinanceData(e,a);break;case mt.CAPITAL_DATA:t=this.RecvCapitalData(e,a);break;case mt.CAPITAL_FLOW_DAY_DATA:case mt.CAPITAL_FLOW_DAY3_DATA:case mt.CAPITAL_FLOW_DAY5_DATA:case mt.CAPITAL_FLOW_DAY10_DATA:case mt.DDE_DAY_DATA:case mt.DDE_DAY3_DATA:case mt.DDE_DAY5_DATA:case mt.DDE_DAY10_DATA:t=this.RecvSubDocumentData(e,a);break;case mt.EVENT_DATA:t=this.RecvEventData(e,a);break;case mt.COMPANY_DATA:t=this.RecvCompanyData(e,a);break;case mt.PLATE_DATA:t=this.RecvPlateData(e,a);break}var n=!0,s=!1,o=void 0;try{for(var l=(0,Be.default)(t),h;!(n=(h=l.next()).done);n=!0){var u=h.value;this.MapTagCallback.has(u[0])&&this.MapTagCallback.get(u[0])(u[0],u[1],a,this)}}catch(f){s=!0,o=f}finally{try{!n&&l.return&&l.return()}finally{if(s)throw o}}this.AutoUpdate()},this.ClearTimer=function(){this.Timeout&&(clearTimeout(this.Timeout),this.Timeout=null)},this.AutoUpdate=function(){if(this.ClearTimer(),!!this.IsAutoUpdate){var e=this,a=!1,r=!0,t=!1,n=void 0;try{for(var s=(0,Be.default)(this.MapStock),o;!(r=(o=s.next()).done);r=!0){var l=o.value,h=ND.GetMarketStatus(l[0]);if(h==2){this.Timeout=setTimeout(function(){e.ReqeustData()},this.AutoUpateTimeout);return}else h==1&&(a=!0)}}catch(u){t=!0,n=u}finally{try{!r&&s.return&&s.return()}finally{if(t)throw n}}a&&(this.Timeout=setTimeout(function(){e.AutoUpdate()},this.AutoUpateTimeout))}},this.RecvBaseData=function(e,a){var r=new _e.default;for(var t in e.stock){var n=e.stock[t],s=this.MapStock.get(n.symbol);if(s){switch(a){case mt.BASE_DATA:s.SetBaseData(n);break;case mt.INDEX_BASE_DATA:s.SetIndexBaseData(n);break;default:continue}if(s.TagID.size>0){var o=!0,l=!1,h=void 0;try{for(var u=(0,Be.default)(s.TagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;r.has(C)?r.get(C).push(s.Symbol):r.set(C,new Array(s.Symbol))}}catch(D){l=!0,h=D}finally{try{!o&&u.return&&u.return()}finally{if(l)throw h}}}}}return r},this.RecvBuySellData=function(e,a){var r=new _e.default;for(var t in e.stock){var n=e.stock[t],s=this.MapStock.get(n.symbol);if(s){if(s.SetBuySellData(n),s.TagID.size>0){var o=!0,l=!1,h=void 0;try{for(var u=(0,Be.default)(s.TagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;r.has(C)?r.get(C).push(s.Symbol):r.set(C,new Array(s.Symbol))}}catch(g){l=!0,h=g}finally{try{!o&&u.return&&u.return()}finally{if(l)throw h}}}if(s.BuySellTagID.size>0){var D=!0,c=!1,T=void 0;try{for(var S=(0,Be.default)(s.BuySellTagID),I;!(D=(I=S.next()).done);D=!0){var C=I.value;r.has(C)?r.get(C).push(s.Symbol):r.set(C,new Array(s.Symbol))}}catch(g){c=!0,T=g}finally{try{!D&&S.return&&S.return()}finally{if(c)throw T}}}}}return r},this.RecvDerivativeData=function(e,a){var r=new _e.default;for(var t in e.stock){var n=e.stock[t],s=this.MapStock.get(n.symbol);if(s&&(s.SetDerivativeData(n),s.DerivativeTagID.size>0)){var o=!0,l=!1,h=void 0;try{for(var u=(0,Be.default)(s.DerivativeTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;r.has(C)?r.get(C).push(s.Symbol):r.set(C,new Array(s.Symbol))}}catch(D){l=!0,h=D}finally{try{!o&&u.return&&u.return()}finally{if(l)throw h}}}}return r},this.RecvFinanceData=function(e,a){var r=new _e.default;for(var t in e.stock){var n=e.stock[t],s=this.MapStock.get(n.symbol);if(s&&(s.SetFinanceData(n),s.FinanceTagID.size>0)){var o=!0,l=!1,h=void 0;try{for(var u=(0,Be.default)(s.FinanceTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;r.has(C)?r.get(C).push(s.Symbol):r.set(C,new Array(s.Symbol))}}catch(D){l=!0,h=D}finally{try{!o&&u.return&&u.return()}finally{if(l)throw h}}}}return r},this.RecvCapitalData=function(e,a){var r=new _e.default;for(var t in e.stock){var n=e.stock[t],s=this.MapStock.get(n.symbol);if(s&&(s.SetCapitalData(n),s.CapitalTagID.size>0)){var o=!0,l=!1,h=void 0;try{for(var u=(0,Be.default)(s.CapitalTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;r.has(C)?r.get(C).push(s.Symbol):r.set(C,new Array(s.Symbol))}}catch(D){l=!0,h=D}finally{try{!o&&u.return&&u.return()}finally{if(l)throw h}}}}return r},this.RecvDealData=function(e,a){var r=new _e.default;for(var t in e.stock){var n=e.stock[t],s=this.MapStock.get(n.symbol);if(s&&(s.SetDealData(n),s.DealTagID.size>0)){var o=!0,l=!1,h=void 0;try{for(var u=(0,Be.default)(s.DealTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;r.has(C)?r.get(C).push(s.Symbol):r.set(C,new Array(s.Symbol))}}catch(D){l=!0,h=D}finally{try{!o&&u.return&&u.return()}finally{if(l)throw h}}}}return r},this.RecvHeatData=function(e,a){var r=new _e.default;for(var t in e.data){var n=e.data[t],s=this.MapStock.get(n.symbol);if(s&&(s.SetHeatData(n),s.HeatTagID.size>0)){var o=!0,l=!1,h=void 0;try{for(var u=(0,Be.default)(s.HeatTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;r.has(C)?r.get(C).push(s.Symbol):r.set(C,new Array(s.Symbol))}}catch(D){l=!0,h=D}finally{try{!o&&u.return&&u.return()}finally{if(l)throw h}}}}return r},this.RecvSortData=function(e,a,r){var t=new _e.default,n=new Array,s=this.MapStock.get(r.Plate);for(var o in e.stock){var l=e.stock[o];if(n.push(l.symbol),this.MapStock.has(l.symbol)){var h=this.MapStock.get(l.symbol);h.SetBaseData(l)}else{var h=new Th(l.symbol);h.SetBaseData(l),this.MapStock.set(l.symbol,h)}}var u=r.SortField.toString()+"-"+r.Order.toString();if(!s.Sort.has(u))return t;var f=s.Sort.get(u);f.arySymbol=n;var C=!0,D=!1,c=void 0;try{for(var T=(0,Be.default)(r.TagID),S;!(C=(S=T.next()).done);C=!0){var l=S.value;t.set(l,new Array([s.Symbol]))}}catch(I){D=!0,c=I}finally{try{!C&&T.return&&T.return()}finally{if(D)throw c}}return t},this.RecvSubDocumentData=function(e,a){var r=new _e.default;for(var t in e.stock){var n=e.stock[t],s=this.MapStock.get(n.symbol);if(s){var o=null;switch(a){case mt.CAPITAL_FLOW_DAY_DATA:s.SetCapitalFlowDayData(n.flowday,a),o=s.CapitalFlowDayID;break;case mt.CAPITAL_FLOW_DAY3_DATA:s.SetCapitalFlowDayData(n.flowday3,a),o=s.CapitalFlowDay3ID;break;case mt.CAPITAL_FLOW_DAY5_DATA:s.SetCapitalFlowDayData(n.flowday5,a),o=s.CapitalFlowDay5ID;break;case mt.CAPITAL_FLOW_DAY10_DATA:s.SetCapitalFlowDayData(n.flowday10,a),o=s.CapitalFlowDay10ID;break;case mt.DDE_DAY_DATA:s.SetDDE(n.dde,a),o=s.DDEID;break;case mt.DDE_DAY3_DATA:s.SetDDE(n.dde3,a),o=s.DDE3ID;break;case mt.DDE_DAY5_DATA:s.SetDDE(n.dde5,a),o=s.DDE5ID;break;case mt.DDE_DAY10_DATA:s.SetDDE(n.dde10,a),o=s.DDE10ID;break}if(o&&o.size>0){var l=!0,h=!1,u=void 0;try{for(var f=(0,Be.default)(o),C;!(l=(C=f.next()).done);l=!0){var D=C.value;r.has(D)?r.get(D).push(s.Symbol):r.set(D,new Array(s.Symbol))}}catch(c){h=!0,u=c}finally{try{!l&&f.return&&f.return()}finally{if(h)throw u}}}}}return r},this.RecvEventData=function(e,a){var r=new _e.default;for(var t in e.stock){var n=e.stock[t],s=this.MapStock.get(n.symbol);if(s&&(s.SetEventData(n),s.EventTagID.size>0)){var o=!0,l=!1,h=void 0;try{for(var u=(0,Be.default)(s.EventTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;r.has(C)?r.get(C).push(s.Symbol):r.set(C,new Array(s.Symbol))}}catch(D){l=!0,h=D}finally{try{!o&&u.return&&u.return()}finally{if(l)throw h}}}}return r},this.RecvCompanyData=function(e,a){var r=new _e.default;for(var t in e.stock){var n=e.stock[t],s=this.MapStock.get(n.symbol);if(s&&(s.SetCompanyData(n),s.CompanyTagID.size>0)){var o=!0,l=!1,h=void 0;try{for(var u=(0,Be.default)(s.CompanyTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;r.has(C)?r.get(C).push(s.Symbol):r.set(C,new Array(s.Symbol))}}catch(D){l=!0,h=D}finally{try{!o&&u.return&&u.return()}finally{if(l)throw h}}}}return r},this.RecvPlateData=function(e,a){var r=new _e.default;for(var t in e.stock){var n=e.stock[t],s=this.MapStock.get(n.symbol);if(s&&(s.SetPlateData(n),s.PlateTagID.size>0)){var o=!0,l=!1,h=void 0;try{for(var u=(0,Be.default)(s.PlateTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;r.has(C)?r.get(C).push(s.Symbol):r.set(C,new Array(s.Symbol))}}catch(D){l=!0,h=D}finally{try{!o&&u.return&&u.return()}finally{if(l)throw h}}}}return r}}function Qg(e){this.SearchStockApiUrl=ca.Domain+"/API/StockSpell",this.UpdateUICallback=e,this.PageSize=50,this.Count,this.EndOffset,this.Data=new Array,this.SearchString="",this.SearchType=0,this.Search=function(a,r){if(this.SearchString==a&&this.SearchType==r)typeof this.UpdateUICallback=="function"&&this.UpdateUICallback(this);else{this.SearchString=a,this.SearchType=r,this.Count=0,this.EndOffset=0,this.Data=[];var t=this.PageSize-1;this.ReqeustSearchStock(this.SearchString,this.SearchType,this.EndOffset,t)}},this.IsEndPage=function(){return this.Count<=0?!0:this.EndOffset>this.Count-1},this.NextPage=function(){if(!(this.EndOffset+1>this.Count)){var a=this.EndOffset+this.PageSize;this.ReqeustSearchStock(this.SearchString,this.SearchType,this.EndOffset,a)}},this.ReqeustSearchStock=function(a,r,t,n){var s=this;Pe.default.ajax({url:this.SearchStockApiUrl,data:{input:a,start:t,end:n,type:r},type:"post",dataType:"json",async:!0,success:function(l){s.RecvSearchStockData(l,mt.SEARCH_STOCK_DATA)},error:function(l){s.RecvError(l,mt.SEARCH_STOCK_DATA)}})},this.RecvSearchStockData=function(a){for(var r in a.stock){var t=a.stock[r];this.Data.push({Name:t.name,Symbol:t.symbol,Type:t.type})}a.count==0?(this.Count=0,this.EndOffset=0):(this.Count==0&&(this.Count=a.count),this.EndOffset=a.end,this.Count>0&&this.EndOffset>this.Count&&(this.EndOffset=this.Count-1)),typeof this.UpdateUICallback=="function"&&this.UpdateUICallback(this)},this.RecvError=function(a,r){console.log("[SearchStock::RecvError] datatype="+r.toString()),console.log(a),typeof this.UpdateUICallback=="function"&&this.UpdateUICallback(this,"error")}}function Ri(){this.IsAutoUpdate=!0,this.AutoUpateTimeout=5e3,this.Timeout,this.ApiUrl,this.Data,this.Error,this.UpdateUICallback,this.RequestData=function(){},this.Stop=function(){this.IsAutoUpdate=!1,this.Timeout&&clearTimeout(this.Timeout)},this.AutoUpate=function(){if(this.Timeout&&clearTimeout(this.Timeout),!!this.IsAutoUpdate&&(this.Timeout&&clearTimeout(this.Timeout),!!this.IsAutoUpdate)){var e=this;if(this.Symbol){var a=ND.GetMarketStatus(this.Symbol);a==2?this.Timeout=setTimeout(function(){e.RequestData()},this.AutoUpateTimeout):a==1&&(this.Timeout=setTimeout(function(){e.AutoUpdate()},this.AutoUpateTimeout))}else{var e=this,r=new Date,t=r.getHours()*100+r.getMinutes();r.getDay()>0&&r.getDay()<6&&t>=930&&t<1530&&(this.Timeout=setTimeout(function(){e.RequestData()},this.AutoUpateTimeout))}}},this.InvokeUpdateUICallback=function(){this.UpdateUICallback&&this.UpdateUICallback(this)}}function $g(e){this.newMethod=Ri,this.newMethod(),delete this.newMethod,this.Symbol=e,this.ApiUrl=ca.Domain+"/API/StockShortTerm",this.Count=20,this.RequestData=function(){var a=this,r={count:this.Count};this.Symbol&&(r.symbol=this.Symbol),Pe.default.ajax({url:this.ApiUrl,data:r,type:"post",dataType:"json",async:!0,success:function(n){a.RecvData(n,mt.SHORT_TERM_DATA)},fail:function(n){a.RecvError(n,mt.SHORT_TERM_DATA)}})},this.RecvData=function(a,r){this.Data=[];for(var t in a.shortterm){var n=a.shortterm[t];this.Data.push({Date:n.date,Name:n.name,Symbol:n.symbol,Time:n.time,Content:n.content,TypeInfo:n.typeinfo,Type:n.type})}this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()},this.RecvError=function(a,r){}}function qg(e){this.newMethod=Ri,this.newMethod(),delete this.newMethod,this.Symbol=e,this.Date,this.RequestData=function(){this.Data=null,this.Error=null;var a=this,r=ca.CacheDomain+"/cache/dealday/day/"+this.Date+"/"+this.Symbol+".json";console.log("[DealDay::RequestData] cache url ",r),Pe.default.ajax({url:r,type:"get",dataType:"json",async:!0,success:function(n){a.RecvData(n,mt.DEAL_DAY_DATA)},error:function(n){a.RecvError(n,mt.DEAL_DAY_DATA)}})},this.RecvData=function(a,r){if(!a.day||!a.deal){this.InvokeUpdateUICallback();return}var t=a.deal.amount,n=a.deal.price,s=a.deal.time,o=a.deal.vol,l=a.deal.flag;if(!l||!o||!s||!n||!t){this.InvokeUpdateUICallback();return}for(var h={Date:a.date,Open:a.day.open,Close:a.day.price,YClose:a.day.yclose,Symbol:a.symbol,Name:a.name,Deal:[],PriceList:[]},u=new _e.default,f=0,C=Math.min(s.length,o.length,l.length,n.length,t.length),D=0;D<C;++D){var c={Time:s[D],Vol:o[D],Flag:"",Price:n[D],Amount:t[D]};l[D]===0?c.Flag="B":l[D]===1&&(c.Flag="S"),c.Time>15e4&&(c.Time=15e4),h.Deal.push(c);var T;u.has(c.Price)?(T=u.get(c.Price),T.Vol+=c.Vol):(T={Vol:c.Vol,Price:c.Price,BuyVol:0,SellVol:0,NoneVol:0},u.set(c.Price,T)),l[D]===0?T.BuyVol+=c.Vol:l[D]===1?T.SellVol+=c.Vol:T.NoneVol+=c.Vol,f+=c.Vol}var S=!0,I=!1,g=void 0;try{for(var E=(0,Be.default)(u),F;!(S=(F=E.next()).done);S=!0){var R=F.value,A=R[1];f>0&&(A.Proportion=A.Vol/f),h.PriceList.push(A)}}catch(P){I=!0,g=P}finally{try{!S&&E.return&&E.return()}finally{if(I)throw g}}h.PriceList.sort(function(P,p){return p.Price-P.Price}),this.Data=h,this.InvokeUpdateUICallback()},this.RecvError=function(a,r){console.log("[DealDay::RecvError] status="+a.status+" statusText="+a.statusText+" responseText="+a.responseText),this.Error={Status:a.status,Message:a.responseText},this.InvokeUpdateUICallback()}}function jg(e){this.newMethod=Ri,this.newMethod(),delete this.newMethod,this.ApiUrl=ca.Domain+"/API/StockBlockMember",this.PageSize=10,this.Start=0,this.OrderField,this.Order,this.Symbol=e,this.OrderNull=0,this.Field=new Array,this.Data=new Array,this.PageInfo,this.SetField=function(a){this.Field=new Array;for(var r in a){var t=a[r],n=pf.GetFieldName(t);n!=null&&this.Field.push(n)}return this.Field.length>0},this.SetOrder=function(a,r){this.Order=null,this.OrderField=null;var t=pf.GetFieldName(a);return t==null?!1:(this.OrderField=t,this.Order=r,!0)},this.RequestData=function(){this.Data=[];var a=this;Pe.default.ajax({url:this.ApiUrl,data:{symbol:this.Symbol,field:this.Field,order:this.Order,orderfield:this.OrderField,start:this.Start,end:this.Start+this.PageSize,ordernull:this.OrderNull},type:"post",dataType:"json",success:function(t){a.RecvData(t,mt.BLOCK_MEMBER_DATA)},error:function(t){a.RecvError(t,mt.BLOCK_MEMBER_DATA)}})},this.RecvData=function(a,r){for(var t in a.stock){var n=a.stock[t];if(n.symbol!=null){var s=new Th(n.symbol);s.SetData(n),this.Data.push(s)}}this.PageInfo={Count:a.count,Start:a.start,End:a.end},typeof this.UpdateUICallback=="function"&&this.UpdateUICallback(this),this.AutoUpate()},this.RecvError=function(a,r){}}function tp(){this.newMethod=Ri,this.newMethod(),delete this.newMethod,this.BlockType=1,this.Count=20,this.OrderField="increase",this.Order=-1,this.Field=["symbol","price","name","vol","increase","indextop","risefall"],this.ApiUrl=ca.Domain+"/API/StockBlockTop",this.SetField=function(e){},this.ReqeustData=function(){var e=this;Pe.default.ajax({url:this.ApiUrl,data:{blocktype:this.BlockType,start:0,end:this.Count,field:this.Field,orderfield:this.OrderField,order:this.Order},type:"post",dataType:"json",async:!0,success:function(r){e.RecvData(r,mt.BLOCK_TOP_DATA)},fail:function(r){e.RecvError(r,mt.BLOCK_TOP_DATA)}})},this.RecvData=function(e,a){var r=e;this.Data=[],this.resCount=r.count;for(var t in r.stock){var n=r.stock[t];if(n.indextop!=null)var s={Down:n.indextop.down,Stop:n.indextop.stop,Up:n.indextop.up,Unchanged:n.indextop.unchanged,DownStock:{Name:n.indextop.downstock.name,Symbol:n.indextop.downstock.symbol},UpStock:{Name:n.indextop.upstock.name,Symbol:n.indextop.upstock.symbol}};this.Data.push({Name:n.name,Symbol:n.symbol,Increase:n.increase,Risefall:n.risefall,IndexTop:s})}this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()},this.RecvError=function(e,a){}}function ep(e){this.newMethod=Ri,this.newMethod(),delete this.newMethod,this.ApiUrl=ca.Domain+"/API/StockMinuteImage",this.Symbol=[e],this.Data=[],this.RequestData=function(){this.Data=[];var a=this;Pe.default.ajax({url:this.ApiUrl,data:{symbol:this.Symbol},type:"post",dataType:"json",success:function(t){a.RecvData(t,mt.IMAGE_MINUTE_DATA)},error:function(t){a.RecvError(t,mt.IMAGE_MINUTE_DATA)}})},this.RecvData=function(a,r){for(var t in a.symbol){var n={Symbol:a.symbol[t],Image:a.imagerelative[t]};this.Data.push(n)}typeof this.UpdateUICallback=="function"&&this.UpdateUICallback(this)},this.RecvError=function(a,r){}}function ap(e){this.newMethod=Ri,this.newMethod(),delete this.newMethod,this.Symbol=e,this.RequestData=function(){this.Data=null,this.Error=null;var a=this,r=ca.CacheDomain+"/cache/historyday/all/"+this.Symbol+".json";console.log("[HistoryDayData::RequestData] cache url ",r),Pe.default.ajax({url:r,type:"get",dataType:"json",async:!0,success:function(n){a.RecvData(n,mt.HISTORY_DAY_DATA)},error:function(n){a.RecvError(n,mt.HISTORY_DAY_DATA)}})},this.RecvData=function(a,r){if(!a.symbol||!a.name){this.InvokeUpdateUICallback();return}var t=a.amount,n=a.close,s=a.date,o=a.high,l=a.low,h=a.open,u=a.vol,f=a.yclose;if(!t||!n||!s||!o||!l||!h||!u||!f){this.InvokeUpdateUICallback();return}for(var C={UpdateDate:a.update,Symbol:a.symbol,Name:a.name,KLine:[]},D=0;D<s.length;++D){var c={Date:s[D],YClose:f[D],Open:h[D],High:o[D],Low:l[D],Close:n[D],Vol:u[D],Amount:t[D]};C.KLine.push(c)}this.Data=C,this.InvokeUpdateUICallback()},this.RecvError=function(a,r){console.log("[HistoryDayData::RecvError] status="+a.status+" statusText="+a.statusText+" responseText="+a.responseText),this.Error={Status:a.status,Message:a.responseText},this.InvokeUpdateUICallback()},this.GetWeekData=function(){if(!this.Data||!this.Data.KLine)return[];var a=this.GetDayPeriodData(1);return a},this.GetMonthData=function(){if(!this.Data||!this.Data.KLine)return[];var a=this.GetDayPeriodData(2);return a},this.GetDayPeriodData=function(a){var r=new Array,t=0,n=null;for(var s in this.Data.KLine){var o=!1,l=this.Data.KLine[s];switch(a){case 1:var h=this.GetFirday(l.Date);h!=t&&(o=!0,t=h);break;case 2:parseInt(l.Date/100)!=parseInt(t/100)&&(o=!0,t=l.Date);break;case 3:parseInt(l.Date/1e4)!=parseInt(t/1e4)&&(o=!0,t=l.Date);break}if(o){if(n={},n.Date=l.Date,r.push(n),l.Open==null||l.Close==null)continue;n.Open=l.Open,n.High=l.High,n.Low=l.Low,n.YClose=l.YClose,n.Close=l.Close,n.Vol=l.Vol,n.Amount=l.Amount}else{if(n==null||l.Open==null||l.Close==null)continue;n.Open==null||n.Close==null?(n.Open=l.Open,n.High=l.High,n.Low=l.Low,n.YClose=l.YClose,n.Close=l.Close,n.Vol=l.Vol,n.Amount=l.Amount):(n.High<l.High&&(n.High=l.High),n.Low>l.Low&&(n.Low=l.Low),n.Close=l.Close,n.Vol+=l.Vol,n.Amount+=l.Amount,n.Date=l.Date)}}return r},this.GetFirday=function(a){var r=new Date(parseInt(a/1e4),a/100%100-1,a%100),t=r.getDay();if(t==5)return a;var n=r.getTime();if(t<5){var s=864e5*(5-t);n+=s}else{var s=864e5*(t-5);n-=s}r.setTime(n);var o=r.getFullYear()*1e4+(r.getMonth()+1)*100+r.getDate();return r.getDay(),o}}function ip(e){this.newMethod=Ri,this.newMethod(),delete this.newMethod,this.Symbol=e,this.ApiUrl=ca.Domain+"/API/StockPriceList",this.RequestData=function(){if(this.Symbol){var a=this,r={};Array.isArray(this.Symbol)?r.Symbol=this.Symbol:r.Symbol=[this.Symbol],Pe.default.ajax({url:this.ApiUrl,data:r,type:"post",dataType:"json",async:!0,success:function(n){a.RecvData(n,mt.DEAL_PRICE_LIST_DATA)},fail:function(n){a.RecvError(n,mt.DEAL_PRICE_LIST_DATA)}})}},this.RecvData=function(a,r){if(this.Data=null,!(a.statistics.length<=0)){this.Data={Day:{},PriceList:[]};var t=a.data[0];this.Data.Day={Date:t.date,YClose:t.yclose,Price:t.price,Vol:t.vol,Time:t.time},this.Data.Stock={Symbol:t.symbol,Name:t.name};var n=a.statistics[0];for(var s in n.list){var o=n.list[s],l={Price:o[0],Vol:o[1],BuyVol:o[2],SellVol:o[3],NoneVol:o[4]};t.vol>0&&(l.Proportion=l.Vol/t.vol),this.Data.PriceList.push(l)}this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()}},this.RecvError=function(a,r){}}function rp(e){this.newMethod=Ri,this.newMethod(),delete this.newMethod,this.IsAutoUpdate=!1,this.Symbol=e,this.PageSize=20,this.Request=function(a,r){this.Error=null;var t=this,n=a*r,s=n+r,o=ca.Domain+"/API/StockDetail";console.log("[LatestDetailData::RequestData] url="+o+", start="+n+" , end="+s),Pe.default.ajax({url:o,data:{symbol:this.Symbol,start:n,end:s},type:"post",dataType:"json",async:!0,success:function(h){t.RecvData(h,mt.LATEST_DETAIL_DATA)},error:function(h){t.RecvError(h,mt.LATEST_DETAIL_DATA)}})},this.RequestData=function(){this.Data={Deal:[],Count:0,Reqeust:{PageIndex:0},Response:{}},this.Request(0,this.PageSize)},this.RequestPage=function(a){this.Data||(this.Data={Deal:[],Count:0}),this.Data.Reqeust={PageIndex:a},this.Data.Response={};for(var r=a*this.PageSize,t=r+this.PageSize,n=!0,s=r;s<t;++s)if(!this.Data.Deal[s]){n=!1;break}n?(this.Data.Response={Start:r,End:t},this.InvokeUpdateUICallback()):this.Request(a,this.PageSize)},this.RecvData=function(a,r){if(this.Data.Count=a.count,!a.detail){this.InvokeUpdateUICallback();return}this.Data.Day={YClose:a.yclose,Open:a.open,Close:a.price,Date:a.date},this.Data.Stock={Symbol:a.symbol,Name:a.name};for(var t=a.start,n=0,s=t;n<a.detail.length;++n,++s){var o=a.detail[n],l={Time:o[0],Price:o[1],Vol:o[2],Amount:o[3],Flag:""};o[4]===0?l.Flag="B":o[4]===1&&(l.Flag="S"),this.Data.Deal[s]=l}this.Data.Response={Start:a.start,End:a.end},this.InvokeUpdateUICallback()},this.RecvError=function(a,r){console.log("[LatestDetailData::RecvError] status="+a.status+" statusText="+a.statusText+" responseText="+a.responseText),this.Error={Status:a.status,Message:a.responseText},this.InvokeUpdateUICallback()}}function sp(){this.newMethod=Ri,this.newMethod(),delete this.newMethod,this.ApiUrl=ca.Domain+"/api/StockListAnalyze",this.PolicyGuid,this.Plate="",this.SymbolList=[],this.RequestData=function(){var e=this;Pe.default.ajax({url:e.ApiUrl,data:{PolicyGuid:e.PolicyGuid,Plate:e.Plate,Symbol:e.SymbolList},type:"post",dataType:"json",async:!0,success:function(r){e.RecvData(r)},error:function(r){e.RecvError(r)}})},this.RecvData=function(e){this.Data={};var a=e;if(a.count!=0){if(a.concept){var r=[];for(var t in a.concept.data){var n=a.concept.data[t],s={};s.Name=n[0],s.Symbol=n[1],s.Ratio=n[2],s.Count=n[3],s.Increase=n[4],s.Price=n[5],s.Week1=n[6],s.Week4=n[7],r.push(s)}this.Data.Concept=r}a.distributed&&(this.Data.Distributed=a.distributed),a.industry&&(this.Data.Industry=a.industry),a.quadrant&&(this.Data.Quadrant=a.quadrant),a.region&&(this.Data.Region=a.region),this.UpdateUICallback&&this.UpdateUICallback(this)}},this.RecvError=function(e){console.log(e)}}var ND={SH:".SH",SZ:".SZ",HK:".HK",SHFE:".SHF",CFFEX:".CFE",DCE:".DCE",CZCE:".CZC",USA:".USA",IsUSA:function(a){return a?a.indexOf(this.USA)>0:!1},IsSH:function(a){var r=a.length-this.SH.length,t=a.indexOf(this.SH);return t==r},IsSZ:function(a){var r=a.length-this.SZ.length,t=a.indexOf(this.SZ);return t==r},IsHK:function(a){var r=a.length-this.HK.length,t=a.indexOf(this.HK);return t==r},IsSHFE:function(a){return a.indexOf(this.SHFE)>0},IsCFFEX:function(a){return a.indexOf(this.CFFEX)>0},IsDCE:function(a){return a.indexOf(this.DCE)>0},IsCZCE:function(a){return a.indexOf(this.CZCE)>0},IsChinaFutures:function(a){return this.IsCFFEX(a)||this.IsCZCE(a)||this.IsDCE(a)||this.IsSHFE(a)},IsSHSZ:function(a){return this.IsSZ(a)||this.IsSH(a)},IsSHSZFund:function(a){if(!a)return!1;if(this.IsSH(a)){if(a.charAt(0)=="5"&&a.charAt(1)=="1")return!0}else if(this.IsSZ(a)&&a.charAt(0)=="1"&&(a.charAt(1)=="5"||a.charAt(1)=="6"||a.charAt(1)=="7"||a.charAt(1)=="8"))return!0;return!1},IsSHSZIndex:function(a){if(!a)return!1;var r=a.toUpperCase();if(this.IsSH(r)){var t=r.replace(".SH","");if(r.charAt(0)=="0"&&parseInt(t)<=3e3)return!0}else if(this.IsSZ(r)){if(r.charAt(0)=="3"&&r.charAt(1)=="9")return!0}else if(r.indexOf(".CI")>0)return!0;return!1},IsSHSZStockA:function(a){if(!a)return!1;var r=a.toUpperCase();if(this.IsSH(r)){if(r.replace(".SH",""),r.charAt(0)=="6")return!0}else if(this.IsSZ(r)&&r.charAt(0)=="0"&&(r.charAt(1)=="0"&&r.charAt(1)=="2"||r.charAt(1)!="7"&&r.charAt(1)!="8"))return!0;return!1},IsSHStockSTAR:function(a){if(!a)return!1;var r=a.toUpperCase();return this.IsSH(r)?r.charAt(0)=="6"&&r.charAt(1)=="8"&&r.charAt(2)=="8":!1},GetMarketStatus:function(a){if(!a)return 0;var r=a.toUpperCase();if(this.IsUSA(r)){var t=GetLocalTime(-4);return s=t.getDay(),o=t.getHours()*100+t.getMinutes(),s==6||s==0?0:o>1730?3:o<930?1:2}else{var n=new Date,s=n.getDay(),o=n.getHours()*100+n.getMinutes();return s==6||s==0?0:o>1540?3:o<925?1:2}}};ml.default=(js={JSStockInit:sa.Init,STOCK_FIELD_NAME:ot,JSStock:sa,StockRead:RD},(0,mf.default)(js,"STOCK_FIELD_NAME",ot),(0,mf.default)(js,"RECV_DATA_TYPE",mt),js);var gl={};Object.defineProperty(gl,"__esModule",{value:!0});var np=Uh,Ef=op(np);function op(e){return e&&e.__esModule?e:{default:e}}function pl(){this.HistoryData,this.BuyData,this.SellData,this.IndexClose,this.NetCalculateModel=0,this.InitialCapital=1e4,this.Data=new Ef.default,this.SetPolicyData=function(e){this.HistoryData=e.KLineData,this.BuyData=e.BuyData,this.SellData=e.SellData,e.IndexClose&&(this.IndexClose=e.IndexClose)},this.ClearData=function(){this.Data=new Ef.default},this.GetBSData=function(e){for(var a=null,r=0;r<this.HistoryData.length;++r){var t=this.HistoryData[r];if(t.Date>=e){a=r;break}}if(a===null)return null;console.log("[RegressionTest::GetBSData] startDate="+e+" index="+a);for(var n=[],s=null,r=a;r<this.HistoryData.length;++r){var o=this.BuyData[r],l=this.SellData[r],h=this.HistoryData[r];if(s===null){if(o>0){var u={Data:h,Count:0};r+1<this.HistoryData.length&&(u.NextOpen=this.HistoryData[r+1].Open),s={B:[u],S:null}}}else{for(var f in s.B)++s.B[f].Count;if(o>0){var u={Data:h,Count:0};r+1<this.HistoryData.length&&(u.NextOpen=this.HistoryData[r+1].Open),s.B.push(u)}else l>0&&(s.S={Data:h},n.push(s),s=null)}}var C={StartDate:this.HistoryData[a].Date,StartIndex:a,Count:this.HistoryData.length-a,BSData:n};return console.log("[RegressionTest::GetBSData] data",C),C},this.Calculate=function(e){var a={Count:e.Count,Max:null,Min:null,Average:null},r={Count:0,Days:0,Success:0,Fail:0,SuccessRate:0};for(var t in e.BSData){var n=e.BSData[t];for(var s in n.B){var o=n.B[s];(a.Max===null||a.Max<o.Count)&&(a.Max=o.Count),(a.Min===null||a.Min>o.Count)&&(a.Min=o.Count),++r.Count,r.Days+=o.Count,n.S.Data.Close>o.Data.Open?++r.Success:++r.Fail}}r.Count>0&&(a.Average=r.Days/r.Count,r.SuccessRate=r.Success/r.Count);var l=1,h;for(var t in e.BSData){var n=e.BSData[t];this.NetCalculateModel===1&&n.B[0].NextOpen>0?h=n.B[0].NextOpen:h=n.B[0].Data.Open;var u=n.S.Data.Close,f=(u-h)/h+1;l*=f}l-=1;var C=this.HistoryData[e.StartIndex].Close,D=this.HistoryData[this.HistoryData.length-1].Close,c=(D-C)/C;console.log("[RegressionTest::Calculate] stock profit first["+this.HistoryData[e.StartIndex].Date+", YClose="+this.HistoryData[e.StartIndex].YClose+"] end["+this.HistoryData[this.HistoryData.length-1].Date+", Close="+this.HistoryData[this.HistoryData.length-1].Close+"]");var T=this.CaclulateNetValue(e),S=null,I=null;T&&T.length>0&&(S=this.CaclulateMaxDropdown(T),this.IndexClose&&(I=this.CaclulateBeta(T)));var g={Day:a,Trade:r,Profit:l,StockProfit:c,Excess:l-c,NetValue:T,MaxDropdown:S,Beta:I,BSDataPair:e.BSData};return console.log("[RegressionTest::Calculate] NetCalculateModel, result ",this.NetCalculateModel,g),g},this.CaclulateNetValue=function(e){for(var a=e.StartIndex,r=[],t={Position:0,Cache:this.InitialCapital},n=null,s,o=a;o<this.HistoryData.length;++o){var l=this.BuyData[o],h=this.SellData[o],u=this.HistoryData[o],f={Date:u.Date,Position:t.Position,Cache:t.Cache,Open:u.Open,Close:u.Close};if(f.MarketValue=f.Position*f.Close+f.Cache,n===null){if(l>0){n={B:{Data:u},S:null},this.NetCalculateModel===1&&o+1<this.HistoryData.length&&this.HistoryData[o+1].Open>0?s=this.HistoryData[o+1].Open:s=f.Open;var C=parseInt(f.Cache/s),D=f.Cache-s*C;f.Position=C,f.Cache=D,f.MarketValue=f.Position*f.Close+f.Cache}}else if(h>0){n.S={Data:u},n=null;var c=f.Position*f.Close;f.Position=0,f.Cache+=c,f.MarketValue=f.Position*f.Close+f.Cache}t.Position=f.Position,t.Cache=f.Cache,f.Net=f.MarketValue/this.InitialCapital,this.IndexClose&&(f.IndexClose=this.IndexClose[o]),r.push(f)}if(r.length<=0)return[];for(var T=[],o=0;o<r.length;++o){var S=r[o],I={Net:S.Net,Date:S.Date,Close:S.Close};S.IndexClose&&(I.IndexClose=S.IndexClose),T.push(I)}return T},this.CaclulateMaxDropdown=function(e){for(var a=e[0].Net,r=0,t,n=1;n<e.length;++n){var s=e[n],o=1-s.Net/a;r<o&&(r=o,t=s),a<s.Net&&(a=s.Net)}return console.log("[RegressionTest::CaclulateMaxDropdown] maxDay",t),r},this.CaclulateBeta=function(e){for(var a=e[0],r=[],t=[],n=0,s=0,o=1;o<e.length;++o){r[o-1]=0,t[o-1]=0;var l=e[o];l.IndexClose>0&&a.IndexClose>0&&(r[o-1]=(l.IndexClose-a.IndexClose)/a.IndexClose),l.Net>0&&a.Net>0&&(t[o-1]=(l.Net-a.Net)/a.Net),n+=r[o-1],s+=t[o-1],a=l}for(var h=n/r.length,u=s/t.length,f=0,o=0;o<r.length;++o)f+=(t[o]-u)*(r[o]-h);for(var C=0,o=0;o<r.length;++o)C+=(r[o]-h)*(r[o]-h);return f/C},this.Execute=function(e){for(var a in e){var r=e[a];if(this.Data.has(r.Name)){console.log("[RegressionTest::Execute] id="+a+" Name="+r.Name+" Date:"+r.Date+" is exsit.");continue}console.log("[RegressionTest::Execute] id="+a+" Name="+r.Name+" Date:"+r.Date);var t=this.GetBSData(r.Date),n=this.Calculate(t);this.Data.set(r.Name,n)}}}pl.CaclulateOverlayData=function(e){if(!e.Main||!e.Sub)return null;var a=e.Main.length;for(var r in e.Sub){var t=e.Sub[r];if(t.length!=a)return console.log("[RegressionTest::OverlayData] id="+r+" data count not match. MainData count="+a),null}var n=[],s={Sub:[]};s.Main=e.Main[0],n.push([]);for(var r=0;r<e.Sub.length;++r){var o=e.Sub[r];s.Sub[r]=o[0],n.push([])}for(var r=0;r<e.Main.length;++r){var l=e.Main[r],h=(l-s.Main)/s.Main;n[0][r]=h;for(var u=0;u<e.Sub.length;++u){var o=e.Sub[u],f=o[r],C=(f-s.Sub[u])/s.Sub[u];n[u+1][r]=C}}return n};pl.GetPolicyData=function(e){var a={KLineData:null,IndexClose:null,BuyData:null,SellData:null};a.KLineData=e.HistoryData.Data;for(var r in e.OutVar){var t=e.OutVar[r];t.Name=="INDEXCLOSE"?a.IndexClose=t.Data:t.Name=="DRAWICON"&&t.Draw&&t.Draw.Icon&&(t.Draw.Icon.ID===13?a.BuyData=t.Draw.DrawData:t.Draw.Icon.ID===14&&(a.SellData=t.Draw.DrawData))}return a.KLineData&&a.BuyData&&a.SellData?a:null};gl.default={RegressionTest:pl};Vi.Chart=Sh.default;Vi.Stock=ml.default;Vi.RegressionTest=gl.default;const La=e=>(yv("data-v-aa7b2b0e"),e=e(),Ov(),e),hp=La(()=>_t("img",{class:"refresh",src:Tv,alt:""},null,-1)),lp={class:"w-50 text-h5 font-weight-bold d-flex justify-center align-center"},up={class:"w-50 text-body-2"},fp={class:"mt-4"},Cp={class:"flexStart stati-box"},Dp={class:"stati-list"},vp=La(()=>_t("p",null,"最高",-1)),cp={class:"stati-list"},Tp=La(()=>_t("p",null,"最低",-1)),Sp={class:"stati-list"},dp=La(()=>_t("p",null,"涨停",-1)),Ip={class:"stati-list"},mp=La(()=>_t("p",null,"跌停",-1)),gp={class:"stati-list"},pp=La(()=>_t("p",null,"今开",-1)),Ep={class:"stati-list"},xp=La(()=>_t("p",null,"昨收",-1)),Fp={class:"stati-list"},Mp=La(()=>_t("p",null,"振幅",-1)),Lp={class:"stati-list"},Rp=La(()=>_t("p",null,"换手率",-1)),Np={class:"stati-list"},Ap=La(()=>_t("p",null,"成交量",-1)),yp={class:"stati-list"},Op=La(()=>_t("p",null,"成交额",-1)),Pp={class:"stati-list"},Bp=La(()=>_t("p",null,"市盈率",-1)),bp={class:"stati-list"},wp=La(()=>_t("p",null,"市净率",-1)),Gp={class:"flexBetween trading-box"},_p={key:0,src:Sv,alt:""},Hp={key:1,src:dv,alt:""},Vp=La(()=>_t("p",null,"自选",-1)),Yp={__name:"ChanrtPage",setup(e){const a={0:"d",1:"w",2:"m"},r=Ua("d"),t=Ua(""),n=Ua(["分时","日线","周线","月线"]),s=Ua(["5分","15分","30分","60分"]),o=Ua(""),l=Ua("5分钟"),h=gv(),u=pv(),f=Ua(""),C=Ua(!0),D=It=>{It=="分时"?P():It=="日线"?A(0):It=="周线"?A(1):It=="月线"&&A(2)},c=It=>{It=="15分"?(l.value=It,A(6)):It=="30分"?(l.value=It,A(7)):It=="60分"?(l.value=It,A(8)):It=="5分"&&(l.value=It,A(5))};function T(){}T.GetKLineOption=function(){var It={Type:"历史K线图",Windows:[{Index:"均线",Modify:!0,Change:!1},{Index:"VOL",Modify:!0,Change:!0,Close:!0},{Index:"MACD",Modify:!1,Change:!1,IsDrawTitleBG:!0}],IsAutoUpdate:!0,AutoUpdateFrequency:1e4,IsShowRightMenu:!1,ToolbarButtonStyle:1,IsApiPeriod:!0,KLine:{DragMode:1,Right:0,Period:0,MaxReqeustDataCount:1e3,MaxRequestMinuteDayCount:10,PageSize:40,IsShowTooltip:!1,DrawType:0,RightSpaceCount:1},KLineTitle:{IsShowName:!0,IsShowSettingInfo:!0},Border:{Left:1,Right:30,Bottom:25,Top:25},Frame:[{SplitCount:3,IsShowLeftText:!1,IsShowRightText:!0,Custom:[{Type:0,Position:"left"}]},{SplitCount:2,StringFormat:0,IsShowLeftText:!1},{SplitCount:2,StringFormat:0,IsShowLeftText:!1}],ExtendChart:[]};return It},T.GetMinuteOption=function(){var It={Type:"分钟走势图",Windows:[{Index:"MACD",Modify:!0,Change:!1,Close:!1}],IsAutoUpdate:!0,AutoUpdateFrequency:1e3,DayCount:1,IsShowRightMenu:!0,CorssCursorInfo:{Left:2,Right:1,Bottom:1,RightTextFormat:0,IsFixXLastTime:!0,RightButton:{Enable:!0},PriceFormatType:0,DataFormatType:0},MinuteLine:{IsDrawAreaPrice:!0},MinuteTitle:{IsShowTime:!0,IsShowName:!0,IsShowDate:!1,IsShowVolTitle:!0},MinuteVol:{BarColorType:1},EnableBorderDrag:!0,IsDrawPictureXY:!0,SelectedChart:{EnableSelected:!0,EnableMoveOn:!0},EnableIndexChartDrag:!0,EnableSelectRect:!0,Border:{Left:1,Right:1,Top:25,Bottom:25},Frame:[{SplitCount:5,Custom:[{Type:1,Position:"left",LineType:0,Data:[{Value:15.8,Color:"rgb(0,34,255)",TextColor:"rgb(255,255,255)"}]}]},{SplitCount:3}],ExtendChart:[]};return It},Vi.Chart.MARKET_SUFFIX_NAME.GetMarketStatus=function(It){var bt=new Date,xt=bt.getDay(),qt=bt.getHours()*100+bt.getMinutes();return xt==6||xt==0||qt>1530?0:qt<925?1:2};let S={Symbol:"0.000001",Chart:null};h.query.prefix?S.Symbol=h.query.prefix+"."+h.query.code:S.Symbol=h.query.code,Ev(()=>{h.query.title&&(t.value=h.query.title);const It=S.Symbol.split(".");f.value=xv(It[1],It[0]),Bt(),window.onresize=()=>{E()},E(),P(),Kt.getters.token&&(Kt.dispatch("watchlist/get",S.Symbol),Kt.state.watchlist.status&&(C.value=!0))}),Fv(()=>{S.Chart&&(S.Chart.ChartDestroy(),S.Chart=null)});var I=Ua(null),g=Ua(null);Ua(null);const E=function(){I.value;var It=554,bt=document.documentElement.clientWidth,xt=g.value;xt.style.width=bt+"px",xt.style.height=It-60+"px",S.Chart&&S.Chart.OnSize()},F=function(){S.Chart&&(S.Chart.ChartDestroy(),S.Chart=null);for(var It=document.getElementById("kline");It.hasChildNodes();)It.removeChild(It.lastChild)},R=function(It){F();var bt=T.GetKLineOption();bt.Symbol=S.Symbol,bt.Period=It,bt.KLine.Period=It;var xt=document.getElementById("kline"),qt=Vi.Chart.JSChart.Init(xt);bt.NetworkFilter=(ge,me)=>{w(ge,me)},qt.SetOption(bt),S.Chart=qt,Vi.Chart.JSChart.GetResource().FrameLogo.Text=null},A=function(It){It<3?Ft(It):It==4?r.value=1:It==5?r.value=5:It==6?r.value=15:It==7?r.value=30:It==8?r.value=60:r.value=15,R(It)},P=function(){p()||(r.value=1,Nt())},p=function(){if(!(!S.Chart||!S.Chart.JSChartContainer))return S.Chart.JSChartContainer.ClassName=="MinuteChartContainer"},w=function(It,bt){It.PreventDefault=!0,rt(It,bt)},H=function(It,bt){It.PreventDefault=!0,It.Name=="MinuteChartContainer::RequestMinuteData"&&W(It,bt)},W=(It,bt,xt)=>{Kt.dispatch("market/getStockKlineNew",{symbol:S.Symbol,klt:r.value}).then(qt=>{let ge=ht(qt.klines),me={stock:[{symbol:Lv(qt.code,qt.market),minute:ge,name:qt.name,yclose:qt.prePrice}],code:0};bt(me)}),Bt()},ht=(It,bt)=>{let xt=[];return It&&It.forEach(function(qt){let ge=qt.split(","),[me,ha]=ge[0].split(" "),Oe=me.replace(/-/g,""),Ni=ha.replace(/:/g,"");xt.push({date:parseInt(Oe),time:parseInt(Ni),open:parseFloat(ge[1]),high:parseFloat(ge[3]),low:parseFloat(ge[4]),price:parseFloat(ge[1]),amount:parseInt(ge[6]),avprice:parseFloat(ge[4])})}),xt},rt=(It,bt)=>{Kt.dispatch("market/getStockKlineNew",{symbol:S.Symbol,klt:r.value}).then(xt=>{let qt={};qt.name=xt.name,qt.symbol=xt.code,qt.code=0;let ge={};r.value=="d"||r.value=="w"||r.value=="m"?ge=vt(xt.klines,qt):(r.value==1||r.value==5||r.value==15||r.value==30||r.value==60)&&(ge=nt(xt.klines,qt)),bt(ge)}),Bt()},nt=(It,bt)=>{let xt=[],qt=0;return It.forEach(function(ge){let me=ge.split(",");const[ha,Oe]=me[0].split(" ");xt.push([ha.replace(/-/g,""),qt,parseFloat(me[1]),parseFloat(me[3]),parseFloat(me[4]),parseFloat(me[2]),parseFloat(me[5]),parseFloat(me[6]),Oe.replace(":","")]),qt=parseFloat(me[2])}),bt.data=xt,bt},vt=(It,bt)=>{let xt=[],qt=null;return It.forEach(function(ge){let me=ge.split(",");xt.push([me[0].split("-").join(""),qt,parseFloat(me[1]),parseFloat(me[3]),parseFloat(me[4]),parseFloat(me[2]),parseFloat(me[7]),parseFloat(me[8])]),qt=parseFloat(me[2])}),bt.data=xt,bt},Nt=function(){F();var It=T.GetMinuteOption();It.Symbol=S.Symbol;var bt=document.getElementById("kline"),xt=Vi.Chart.JSChart.Init(bt);It.NetworkFilter=(qt,ge)=>{H(qt,ge)},xt.SetOption(It),S.Chart=xt,Vi.Chart.JSChart.GetResource().FrameLogo.Text=null},Ft=It=>{a.hasOwnProperty(It)?r.value=a[It]:r.value="d"},Bt=()=>{Kt.dispatch("market/getStockNewInfo",S.Symbol)},Jt=It=>(It/1e4).toFixed(2)+"万",te=It=>(It/1e9).toFixed(2)+"亿",Me=It=>{if(It<0)return"green";if(It===0||It==="")return"black";if(It>0)return"red"},we=(It,bt,xt,qt)=>{u.push({path:It,query:{code:xt,title:bt,prefix:qt}})},Oa=()=>{Kt.getters.token||(Kt.dispatch("snackbar/warning",{active:!0,body:"请现登录！"}),u.push("Login")),Kt.dispatch("watchlist/push",{code:parseFloat(S.Symbol),name:t.value,price:Ca(Kt.state.market.stock_new_info.f43,Kt.state.market.stock_new_info.f59),percentage:Ca(Kt.state.market.stock_new_info.f170,Kt.state.market.stock_new_info.f59)}).then(It=>{let bt=Kt.state.watchlist.status?0:1;Kt.dispatch("watchlist/updateStatus",bt),bt?Kt.dispatch("snackbar/success",{active:!0,body:"关注成功！"}):Kt.dispatch("snackbar/success",{active:!0,body:"已取消关注！"})})};return(It,bt)=>(_i(),qr("div",null,[rr(Iv,null,{headerCenter:di(()=>[_t("h2",null,ze(t.value)+"（"+ze(f.value)+"）",1)]),headerRight:di(()=>[hp]),_:1}),_t("div",{class:Mv(["w-50 mx-auto mt-3 d-flex","text-"+Me(Qt(Kt).state.market.stock_new_info.f170)])},[_t("div",lp,ze(Qt(Ca)(Qt(Kt).state.market.stock_new_info.f43,Qt(Kt).state.market.stock_new_info.f59)),1),_t("div",up,[_t("div",null,ze(Qt(Ca)(Qt(Kt).state.market.stock_new_info.f169,Qt(Kt).state.market.stock_new_info.f59)),1),_t("div",null,ze(Qt(Ca)(Qt(Kt).state.market.stock_new_info.f170,Qt(Kt).state.market.stock_new_info.f59)+"%"),1)])],2),_t("div",fp,[rr(Bv,{modelValue:o.value,"onUpdate:modelValue":[bt[0]||(bt[0]=xt=>o.value=xt),D],"fixed-tabs":""},{default:di(()=>[(_i(!0),qr(Zl,null,Ql(n.value,xt=>(_i(),oo(bv,{key:xt,text:xt,value:xt,"min-width":"70"},null,8,["text","value"]))),128)),s.value.length?(_i(),oo(_v,{key:0},{activator:di(({props:xt})=>[rr(no,Rv({class:"align-self-center me-4",height:"100%",rounded:"0",variant:"plain"},xt),{default:di(()=>[ho(ze(l.value)+" ",1),rr(Nv,{icon:"mdi-menu-down",end:""})]),_:2},1040)]),default:di(()=>[rr(wv,{class:"bg-grey-lighten-3"},{default:di(()=>[(_i(!0),qr(Zl,null,Ql(s.value,xt=>(_i(),oo(Gv,{key:xt,title:xt,onClick:qt=>c(xt)},null,8,["title","onClick"]))),128))]),_:1})]),_:1})):Av("",!0)]),_:1},8,["modelValue"])]),_t("div",{id:"app",ref_key:"DivApp",ref:I,class:""},[_t("div",null,[_t("div",{id:"kline",ref_key:"DivKLine",ref:g,class:"hqchart"},null,512)])],512),_t("div",Cp,[_t("div",Dp,[vp,_t("span",null,ze(Qt(Ca)(Qt(Kt).state.market.stock_new_info.f44,Qt(Kt).state.market.stock_new_info.f59)),1)]),_t("div",cp,[Tp,_t("span",null,ze(Qt(Ca)(Qt(Kt).state.market.stock_new_info.f45,Qt(Kt).state.market.stock_new_info.f59)),1)]),_t("div",Sp,[dp,_t("span",null,ze(Qt(Ca)(Qt(Kt).state.market.stock_new_info.f51,Qt(Kt).state.market.stock_new_info.f59)),1)]),_t("div",Ip,[mp,_t("span",null,ze(Qt(Ca)(Qt(Kt).state.market.stock_new_info.f52,Qt(Kt).state.market.stock_new_info.f59)),1)]),_t("div",gp,[pp,_t("span",null,ze(Qt(Ca)(Qt(Kt).state.market.stock_new_info.f46,Qt(Kt).state.market.stock_new_info.f59)),1)]),_t("div",Ep,[xp,_t("span",null,ze(Qt(Ca)(Qt(Kt).state.market.stock_new_info.f60,Qt(Kt).state.market.stock_new_info.f59)),1)]),_t("div",Fp,[Mp,_t("span",null,ze(Qt(Ca)(Qt(Kt).state.market.stock_new_info.f170,Qt(Kt).state.market.stock_new_info.f59)+"%"),1)]),_t("div",Lp,[Rp,_t("span",null,ze(Qt(Ca)(Qt(Kt).state.market.stock_new_info.f168,Qt(Kt).state.market.stock_new_info.f59)+"%"),1)]),_t("div",Np,[Ap,_t("span",null,ze(Jt(Qt(Kt).state.market.stock_new_info.f47)+"手"),1)]),_t("div",yp,[Op,_t("span",null,ze(te(Qt(Kt).state.market.stock_new_info.f48)),1)]),_t("div",Pp,[Bp,_t("span",null,ze(Qt(Ca)(Qt(Kt).state.market.stock_new_info.f162,Qt(Kt).state.market.stock_new_info.f59)+"%"),1)]),_t("div",bp,[wp,_t("span",null,ze(Qt(Ca)(Qt(Kt).state.market.stock_new_info.f167,Qt(Kt).state.market.stock_new_info.f59)+"%"),1)])]),_t("div",Gp,[_t("div",{onClick:Oa},[Qt(Kt).state.watchlist.status?(_i(),qr("img",_p)):(_i(),qr("img",Hp)),Vp]),_t("div",null,[rr(no,{rounded:"0",class:"rounded-s-pill px-10",size:"large",to:"/"},{default:di(()=>[ho("首页")]),_:1}),rr(no,{color:"#fb5c39",class:"text-white rounded-e-pill px-10",rounded:"0",size:"large",onClick:bt[1]||(bt[1]=xt=>we("/Trading",t.value,Qt(S).Symbol,Qt(S).Symbol))},{default:di(()=>[ho("交易")]),_:1})])])]))}},iE=Pv(Yp,[["__scopeId","data-v-aa7b2b0e"]]);export{iE as default};
