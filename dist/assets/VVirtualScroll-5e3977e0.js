import{p as H,a as W,i as X,cV as K,a5 as O,x as Y,y as S,Y as $,a8 as re,cU as se,ab as T,cw as C,A as L,q as B,bR as j,dv as D,dw as oe,af as ue,cX as ce,K as ie,dh as ve,L as de,t as fe,di as me,z as k,R as he,dx as ge}from"./index-81fd8131.js";const pe=H({renderless:Boolean,...W()},"VVirtualScrollItem"),Ve=X()({name:"VVirtualScrollItem",inheritAttrs:!1,props:pe(),emits:{"update:height":l=>!0},setup(l,a){let{attrs:u,emit:r,slots:t}=a;const{resizeRef:o,contentRect:i}=K(void 0,"border");O(()=>{var c;return(c=i.value)==null?void 0:c.height},c=>{c!=null&&r("update:height",c)}),Y(()=>{var c,s;return l.renderless?S($,null,[(c=t.default)==null?void 0:c.call(t,{itemRef:o})]):S("div",re({ref:o,class:["v-virtual-scroll__item",l.class],style:l.style},u),[(s=t.default)==null?void 0:s.call(t)])})}}),Se=-1,ye=1,E=100,Re=H({itemHeight:{type:[Number,String],default:null},height:[Number,String]},"virtual");function Te(l,a){const u=se(),r=T(0);C(()=>{r.value=parseFloat(l.itemHeight||0)});const t=T(0),o=T(Math.ceil((parseInt(l.height)||u.height.value)/(r.value||16))||1),i=T(0),c=T(0),s=L(),f=L();let w=0;const{resizeRef:F,contentRect:x}=K();C(()=>{F.value=s.value});const y=B(()=>{var e;return s.value===document.documentElement?u.height.value:((e=x.value)==null?void 0:e.height)||parseInt(l.height)||0}),M=B(()=>!!(s.value&&f.value&&y.value&&r.value));let m=Array.from({length:a.value.length}),v=Array.from({length:a.value.length});const d=T(0);let h=-1;function P(e){return m[e]||r.value}const A=oe(()=>{const e=performance.now();v[0]=0;const n=a.value.length;for(let g=1;g<=n-1;g++)v[g]=(v[g-1]||0)+P(g-1);d.value=Math.max(d.value,performance.now()-e)},d),G=O(M,e=>{e&&(G(),w=f.value.offsetTop,A.immediate(),R(),~h&&ue(()=>{ce&&window.requestAnimationFrame(()=>{q(h),h=-1})}))});j(()=>{A.clear()});function J(e,n){const g=m[e],p=r.value;r.value=p?Math.min(r.value,n):n,(g!==n||p!==r.value)&&(m[e]=n,A())}function V(e){return e=D(e,0,a.value.length-1),v[e]||0}function N(e){return we(v,e)}let _=0,I=0,z=0;O(y,(e,n)=>{n&&(R(),e<n&&requestAnimationFrame(()=>{I=0,R()}))});function Q(){if(!s.value||!f.value)return;const e=s.value.scrollTop,n=performance.now();n-z>500?(I=Math.sign(e-_),w=f.value.offsetTop):I=e-_,_=e,z=n,R()}function Z(){!s.value||!f.value||(I=0,z=0,R())}let U=-1;function R(){cancelAnimationFrame(U),U=requestAnimationFrame(ee)}function ee(){if(!s.value||!y.value)return;const e=_-w,n=Math.sign(I),g=Math.max(0,e-E),p=D(N(g),0,a.value.length),le=e+y.value+E,b=D(N(le)+1,p+1,a.value.length);if((n!==Se||p<t.value)&&(n!==ye||b>o.value)){const ae=V(t.value)-V(p),ne=V(b)-V(o.value);Math.max(ae,ne)>E?(t.value=p,o.value=b):(p<=0&&(t.value=p),b>=a.value.length&&(o.value=b))}i.value=V(t.value),c.value=V(a.value.length)-V(o.value)}function q(e){const n=V(e);!s.value||e&&!n?h=e:s.value.scrollTop=n}const te=B(()=>a.value.slice(t.value,o.value).map((e,n)=>({raw:e,index:n+t.value})));return O(a,()=>{m=Array.from({length:a.value.length}),v=Array.from({length:a.value.length}),A.immediate(),R()},{deep:!0}),{calculateVisibleItems:R,containerRef:s,markerRef:f,computedItems:te,paddingTop:i,paddingBottom:c,scrollToIndex:q,handleScroll:Q,handleScrollend:Z,handleItemResize:J}}function we(l,a){let u=l.length-1,r=0,t=0,o=null,i=-1;if(l[u]<a)return u;for(;r<=u;)if(t=r+u>>1,o=l[t],o>a)u=t-1;else if(o<a)i=t,r=t+1;else return o===a?t:r;return i}const Ie=H({items:{type:Array,default:()=>[]},renderless:Boolean,...Re(),...W(),...ie()},"VVirtualScroll"),Pe=X()({name:"VVirtualScroll",props:Ie(),setup(l,a){let{slots:u}=a;const r=ve("VVirtualScroll"),{dimensionStyles:t}=de(l),{calculateVisibleItems:o,containerRef:i,markerRef:c,handleScroll:s,handleScrollend:f,handleItemResize:w,scrollToIndex:F,paddingTop:x,paddingBottom:y,computedItems:M}=Te(l,fe(l,"items"));return me(()=>l.renderless,()=>{function m(){var h,P;const d=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)?"addEventListener":"removeEventListener";i.value===document.documentElement?(document[d]("scroll",s,{passive:!0}),document[d]("scrollend",f)):((h=i.value)==null||h[d]("scroll",s,{passive:!0}),(P=i.value)==null||P[d]("scrollend",f))}he(()=>{i.value=ge(r.vnode.el,!0),m(!0)}),j(m)}),Y(()=>{const m=M.value.map(v=>S(Ve,{key:v.index,renderless:l.renderless,"onUpdate:height":d=>w(v.index,d)},{default:d=>{var h;return(h=u.default)==null?void 0:h.call(u,{item:v.raw,index:v.index,...d})}}));return l.renderless?S($,null,[S("div",{ref:c,class:"v-virtual-scroll__spacer",style:{paddingTop:k(x.value)}},null),m,S("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:k(y.value)}},null)]):S("div",{ref:i,class:["v-virtual-scroll",l.class],onScrollPassive:s,onScrollend:f,style:[t.value,l.style]},[S("div",{ref:c,class:"v-virtual-scroll__container",style:{paddingTop:k(x.value),paddingBottom:k(y.value)}},[m])])}),{calculateVisibleItems:o,scrollToIndex:F}}});export{Pe as V};
