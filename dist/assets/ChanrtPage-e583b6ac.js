import{K as zD,L as ZD,r as ta,M as QD,o as $D,a2 as pe,N as Wr,a0 as An,J as Us,P as Nn,Y as Ot,a7 as He,T as Ke,aa as qD,a9 as Ks,ab as Js,af as On,S as zs,a4 as jD,a5 as tv,O as ev,W as av,X as iv}from"./index-63e097ee.js";import{_ as rv}from"./refresh-9fe172ae.js";import{a as nv,_ as sv}from"./selef-8144ed19.js";import{c as ov}from"./_commonjsHelpers-de833af9.js";import{P as hv}from"./topWrap-1621febe.js";import{_ as lv}from"./_plugin-vue_export-helper-c27b6911.js";import{V as uv,a as fv}from"./VTabs-00f8c23d.js";import{V as Cv}from"./VSelect-9b77e662.js";/* empty css                                                                */import"./index-5b556264.js";import"./VTextField-457682c6.js";import"./VInput-cbdfb019.js";import"./VList-c4973cd4.js";import"./ssrBoot-444c5aa7.js";import"./VDivider-53a6d389.js";import"./VVirtualScroll-c3b80dbc.js";import"./VCheckboxBtn-4880a325.js";import"./VSelectionControl-ff3f1729.js";import"./VChip-b5fca4b6.js";var Zr={},th={},Dv=Math.ceil,vv=Math.floor,eh=function(r){return isNaN(r=+r)?0:(r>0?vv:Dv)(r)},ah=function(r){if(r==null)throw TypeError("Can't call method on  "+r);return r},cv=eh,Sv=ah,Tv=function(r){return function(n,e){var t=String(Sv(n)),a=cv(e),s=t.length,o,h;return a<0||a>=s?r?"":void 0:(o=t.charCodeAt(a),o<55296||o>56319||a+1===s||(h=t.charCodeAt(a+1))<56320||h>57343?r?t.charAt(a):o:r?t.slice(a,a+2):(o-55296<<10)+(h-56320)+65536)}},tf=!0,ef={exports:{}},dv=ef.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=dv);var ma=ef.exports,af={exports:{}},mv=af.exports={version:"2.6.12"};typeof __e=="number"&&(__e=mv);var _e=af.exports,on=function(r){if(typeof r!="function")throw TypeError(r+" is not a function!");return r},Iv=on,Mi=function(r,n,e){if(Iv(r),n===void 0)return r;switch(e){case 1:return function(t){return r.call(n,t)};case 2:return function(t,a){return r.call(n,t,a)};case 3:return function(t,a,s){return r.call(n,t,a,s)}}return function(){return r.apply(n,arguments)}},Ba={},oi=function(r){return typeof r=="object"?r!==null:typeof r=="function"},gv=oi,ci=function(r){if(!gv(r))throw TypeError(r+" is not an object!");return r},hn=function(r){try{return!!r()}catch{return!0}},Za=!hn(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),Nl=oi,Lo=ma.document,pv=Nl(Lo)&&Nl(Lo.createElement),ih=function(r){return pv?Lo.createElement(r):{}},rf=!Za&&!hn(function(){return Object.defineProperty(ih("div"),"a",{get:function(){return 7}}).a!=7}),Rn=oi,rh=function(r,n){if(!Rn(r))return r;var e,t;if(n&&typeof(e=r.toString)=="function"&&!Rn(t=e.call(r))||typeof(e=r.valueOf)=="function"&&!Rn(t=e.call(r))||!n&&typeof(e=r.toString)=="function"&&!Rn(t=e.call(r)))return t;throw TypeError("Can't convert object to primitive value")},Ol=ci,Fv=rf,Ev=rh,xv=Object.defineProperty;Ba.f=Za?Object.defineProperty:function(n,e,t){if(Ol(n),e=Ev(e,!0),Ol(t),Fv)try{return xv(n,e,t)}catch{}if("get"in t||"set"in t)throw TypeError("Accessors not supported!");return"value"in t&&(n[e]=t.value),n};var ln=function(r,n){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:n}},Lv=Ba,Mv=ln,Ai=Za?function(r,n,e){return Lv.f(r,n,Mv(1,e))}:function(r,n,e){return r[n]=e,r},Av={}.hasOwnProperty,$i=function(r,n){return Av.call(r,n)},yn=ma,Zs=_e,Rl=Mi,Nv=Ai,Ov=$i,Pn="prototype",ea=function(r,n,e){var t=r&ea.F,a=r&ea.G,s=r&ea.S,o=r&ea.P,h=r&ea.B,l=r&ea.W,u=a?Zs:Zs[n]||(Zs[n]={}),f=u[Pn],C=a?yn:s?yn[n]:(yn[n]||{})[Pn],D,v,S;a&&(e=n);for(D in e)v=!t&&C&&C[D]!==void 0,!(v&&Ov(u,D))&&(S=v?C[D]:e[D],u[D]=a&&typeof C[D]!="function"?e[D]:h&&v?Rl(S,yn):l&&C[D]==S?function(T){var I=function(F,E,M){if(this instanceof T){switch(arguments.length){case 0:return new T;case 1:return new T(F);case 2:return new T(F,E)}return new T(F,E,M)}return T.apply(this,arguments)};return I[Pn]=T[Pn],I}(S):o&&typeof S=="function"?Rl(Function.call,S):S,o&&((u.virtual||(u.virtual={}))[D]=S,r&ea.R&&f&&!f[D]&&Nv(f,D,S)))};ea.F=1;ea.G=2;ea.S=4;ea.P=8;ea.B=16;ea.W=32;ea.U=64;ea.R=128;var fa=ea,nf=Ai,un={},Rv={}.toString,fn=function(r){return Rv.call(r).slice(8,-1)},yv=fn,sf=Object("z").propertyIsEnumerable(0)?Object:function(r){return yv(r)=="String"?r.split(""):Object(r)},Pv=sf,wv=ah,Lr=function(r){return Pv(wv(r))},Bv=eh,bv=Math.min,ns=function(r){return r>0?bv(Bv(r),9007199254740991):0},Gv=eh,Vv=Math.max,Hv=Math.min,Yv=function(r,n){return r=Gv(r),r<0?Vv(r+n,0):Hv(r,n)},kv=Lr,Xv=ns,Wv=Yv,_v=function(r){return function(n,e,t){var a=kv(n),s=Xv(a.length),o=Wv(t,s),h;if(r&&e!=e){for(;s>o;)if(h=a[o++],h!=h)return!0}else for(;s>o;o++)if((r||o in a)&&a[o]===e)return r||o||0;return!r&&-1}},of={exports:{}},Uv=_e,yl=ma,Pl="__core-js_shared__",wl=yl[Pl]||(yl[Pl]={});(of.exports=function(r,n){return wl[r]||(wl[r]=n!==void 0?n:{})})("versions",[]).push({version:Uv.version,mode:"pure",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"});var nh=of.exports,Kv=0,Jv=Math.random(),ss=function(r){return"Symbol(".concat(r===void 0?"":r,")_",(++Kv+Jv).toString(36))},Bl=nh("keys"),zv=ss,sh=function(r){return Bl[r]||(Bl[r]=zv(r))},bl=$i,Zv=Lr,Qv=_v(!1),$v=sh("IE_PROTO"),hf=function(r,n){var e=Zv(r),t=0,a=[],s;for(s in e)s!=$v&&bl(e,s)&&a.push(s);for(;n.length>t;)bl(e,s=n[t++])&&(~Qv(a,s)||a.push(s));return a},oh="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),qv=hf,jv=oh,hh=Object.keys||function(n){return qv(n,jv)},Qs,Gl;function lf(){if(Gl)return Qs;Gl=1;var r=Ba,n=ci,e=hh;return Qs=Za?Object.defineProperties:function(a,s){n(a);for(var o=e(s),h=o.length,l=0,u;h>l;)r.f(a,u=o[l++],s[u]);return a},Qs}var Vl=ma.document,uf=Vl&&Vl.documentElement,tc=ci,ec=lf(),Hl=oh,ac=sh("IE_PROTO"),$s=function(){},Mo="prototype",Kn=function(){var r=ih("iframe"),n=Hl.length,e="<",t=">",a;for(r.style.display="none",uf.appendChild(r),r.src="javascript:",a=r.contentWindow.document,a.open(),a.write(e+"script"+t+"document.F=Object"+e+"/script"+t),a.close(),Kn=a.F;n--;)delete Kn[Mo][Hl[n]];return Kn()},os=Object.create||function(n,e){var t;return n!==null?($s[Mo]=tc(n),t=new $s,$s[Mo]=null,t[ac]=n):t=Kn(),e===void 0?t:ec(t,e)},ff={exports:{}},Ao=nh("wks"),ic=ss,No=ma.Symbol,Yl=typeof No=="function",rc=ff.exports=function(r){return Ao[r]||(Ao[r]=Yl&&No[r]||(Yl?No:ic)("Symbol."+r))};rc.store=Ao;var Ia=ff.exports,nc=Ba.f,sc=$i,kl=Ia("toStringTag"),Cn=function(r,n,e){r&&!sc(r=e?r:r.prototype,kl)&&nc(r,kl,{configurable:!0,value:n})},oc=os,hc=ln,lc=Cn,Cf={};Ai(Cf,Ia("iterator"),function(){return this});var uc=function(r,n,e){r.prototype=oc(Cf,{next:hc(1,e)}),lc(r,n+" Iterator")},fc=ah,hs=function(r){return Object(fc(r))},Cc=$i,Dc=hs,Xl=sh("IE_PROTO"),vc=Object.prototype,cc=Object.getPrototypeOf||function(r){return r=Dc(r),Cc(r,Xl)?r[Xl]:typeof r.constructor=="function"&&r instanceof r.constructor?r.constructor.prototype:r instanceof Object?vc:null},qs=fa,Sc=nf,Tc=Ai,Wl=un,dc=uc,mc=Cn,Ic=cc,js=Ia("iterator"),to=!([].keys&&"next"in[].keys()),gc="@@iterator",_l="keys",wn="values",pc=function(){return this},lh=function(r,n,e,t,a,s,o){dc(e,n,t);var h=function(M){if(!to&&M in C)return C[M];switch(M){case _l:return function(){return new e(this,M)};case wn:return function(){return new e(this,M)}}return function(){return new e(this,M)}},l=n+" Iterator",u=a==wn,f=!1,C=r.prototype,D=C[js]||C[gc]||a&&C[a],v=D||h(a),S=a?u?h("entries"):v:void 0,T=n=="Array"&&C.entries||D,I,F,E;if(T&&(E=Ic(T.call(new r)),E!==Object.prototype&&E.next&&mc(E,l,!0)),u&&D&&D.name!==wn&&(f=!0,v=function(){return D.call(this)}),o&&(to||f||!C[js])&&Tc(C,js,v),Wl[n]=v,Wl[l]=pc,a)if(I={values:u?v:h(wn),keys:s?v:h(_l),entries:S},o)for(F in I)F in C||Sc(C,F,I[F]);else qs(qs.P+qs.F*(to||f),n,I);return I},Fc=Tv(!0);lh(String,"String",function(r){this._t=String(r),this._i=0},function(){var r=this._t,n=this._i,e;return n>=r.length?{value:void 0,done:!0}:(e=Fc(r,n),this._i+=e.length,{value:e,done:!1})});var Df=function(r,n){return{value:n,done:!!r}},Bn=Df,Ul=un,Ec=Lr;lh(Array,"Array",function(r,n){this._t=Ec(r),this._i=0,this._k=n},function(){var r=this._t,n=this._k,e=this._i++;return!r||e>=r.length?(this._t=void 0,Bn(1)):n=="keys"?Bn(0,e):n=="values"?Bn(0,r[e]):Bn(0,[e,r[e]])},"values");Ul.Arguments=Ul.Array;var xc=ma,Lc=Ai,Kl=un,Jl=Ia("toStringTag"),zl="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(",");for(var eo=0;eo<zl.length;eo++){var ao=zl[eo],Zl=xc[ao],io=Zl&&Zl.prototype;io&&!io[Jl]&&Lc(io,Jl,ao),Kl[ao]=Kl.Array}var Oo=fn,Mc=Ia("toStringTag"),Ac=Oo(function(){return arguments}())=="Arguments",Nc=function(r,n){try{return r[n]}catch{}},uh=function(r){var n,e,t;return r===void 0?"Undefined":r===null?"Null":typeof(e=Nc(n=Object(r),Mc))=="string"?e:Ac?Oo(n):(t=Oo(n))=="Object"&&typeof n.callee=="function"?"Arguments":t},fh=function(r,n,e,t){if(!(r instanceof n)||t!==void 0&&t in r)throw TypeError(e+": incorrect invocation!");return r},vf={exports:{}},Ql=ci,cf=function(r,n,e,t){try{return t?n(Ql(e)[0],e[1]):n(e)}catch(s){var a=r.return;throw a!==void 0&&Ql(a.call(r)),s}},Oc=un,Rc=Ia("iterator"),yc=Array.prototype,Sf=function(r){return r!==void 0&&(Oc.Array===r||yc[Rc]===r)},Pc=uh,wc=Ia("iterator"),Bc=un,Ch=_e.getIteratorMethod=function(r){if(r!=null)return r[wc]||r["@@iterator"]||Bc[Pc(r)]},bc=Mi,Gc=cf,Vc=Sf,Hc=ci,Yc=ns,kc=Ch,Ro={},yo={},Tf=vf.exports=function(r,n,e,t,a){var s=a?function(){return r}:kc(r),o=bc(e,t,n?2:1),h=0,l,u,f,C;if(typeof s!="function")throw TypeError(r+" is not iterable!");if(Vc(s)){for(l=Yc(r.length);l>h;h++)if(C=n?o(Hc(u=r[h])[0],u[1]):o(r[h]),C===Ro||C===yo)return C}else for(f=s.call(r);!(u=f.next()).done;)if(C=Gc(f,o,u.value,n),C===Ro||C===yo)return C};Tf.BREAK=Ro;Tf.RETURN=yo;var Dn=vf.exports,$l=ci,Xc=on,Wc=Ia("species"),df=function(r,n){var e=$l(r).constructor,t;return e===void 0||(t=$l(e)[Wc])==null?n:Xc(t)},_c=function(r,n,e){var t=e===void 0;switch(n.length){case 0:return t?r():r.call(e);case 1:return t?r(n[0]):r.call(e,n[0]);case 2:return t?r(n[0],n[1]):r.call(e,n[0],n[1]);case 3:return t?r(n[0],n[1],n[2]):r.call(e,n[0],n[1],n[2]);case 4:return t?r(n[0],n[1],n[2],n[3]):r.call(e,n[0],n[1],n[2],n[3])}return r.apply(e,n)},bn=Mi,Uc=_c,ql=uf,jl=ih,Ci=ma,tu=Ci.process,Po=Ci.setImmediate,wo=Ci.clearImmediate,eu=Ci.MessageChannel,ro=Ci.Dispatch,no=0,Jr={},au="onreadystatechange",Yi,so,oo,Kr=function(){var r=+this;if(Jr.hasOwnProperty(r)){var n=Jr[r];delete Jr[r],n()}},iu=function(r){Kr.call(r.data)};(!Po||!wo)&&(Po=function(n){for(var e=[],t=1;arguments.length>t;)e.push(arguments[t++]);return Jr[++no]=function(){Uc(typeof n=="function"?n:Function(n),e)},Yi(no),no},wo=function(n){delete Jr[n]},fn(tu)=="process"?Yi=function(r){tu.nextTick(bn(Kr,r,1))}:ro&&ro.now?Yi=function(r){ro.now(bn(Kr,r,1))}:eu?(so=new eu,oo=so.port2,so.port1.onmessage=iu,Yi=bn(oo.postMessage,oo,1)):Ci.addEventListener&&typeof postMessage=="function"&&!Ci.importScripts?(Yi=function(r){Ci.postMessage(r+"","*")},Ci.addEventListener("message",iu,!1)):au in jl("script")?Yi=function(r){ql.appendChild(jl("script"))[au]=function(){ql.removeChild(this),Kr.call(r)}}:Yi=function(r){setTimeout(bn(Kr,r,1),0)});var mf={set:Po,clear:wo},_i=ma,Kc=mf.set,ru=_i.MutationObserver||_i.WebKitMutationObserver,Bo=_i.process,ho=_i.Promise,nu=fn(Bo)=="process",Jc=function(){var r,n,e,t=function(){var h,l;for(nu&&(h=Bo.domain)&&h.exit();r;){l=r.fn,r=r.next;try{l()}catch(u){throw r?e():n=void 0,u}}n=void 0,h&&h.enter()};if(nu)e=function(){Bo.nextTick(t)};else if(ru&&!(_i.navigator&&_i.navigator.standalone)){var a=!0,s=document.createTextNode("");new ru(t).observe(s,{characterData:!0}),e=function(){s.data=a=!a}}else if(ho&&ho.resolve){var o=ho.resolve(void 0);e=function(){o.then(t)}}else e=function(){Kc.call(_i,t)};return function(h){var l={fn:h,next:void 0};n&&(n.next=l),r||(r=l,e()),n=l}},ls={},su=on;function zc(r){var n,e;this.promise=new r(function(t,a){if(n!==void 0||e!==void 0)throw TypeError("Bad Promise constructor");n=t,e=a}),this.resolve=su(n),this.reject=su(e)}ls.f=function(r){return new zc(r)};var If=function(r){try{return{e:!1,v:r()}}catch(n){return{e:!0,v:n}}},Zc=ma,ou=Zc.navigator,Qc=ou&&ou.userAgent||"",$c=ci,qc=oi,jc=ls,gf=function(r,n){if($c(r),qc(n)&&n.constructor===r)return n;var e=jc.f(r),t=e.resolve;return t(n),e.promise},t0=Ai,Dh=function(r,n,e){for(var t in n)e&&r[t]?r[t]=n[t]:t0(r,t,n[t]);return r},e0=ma,hu=_e,a0=Ba,i0=Za,lu=Ia("species"),pf=function(r){var n=typeof hu[r]=="function"?hu[r]:e0[r];i0&&n&&!n[lu]&&a0.f(n,lu,{configurable:!0,get:function(){return this}})},lo,uu;function Ff(){if(uu)return lo;uu=1;var r=Ia("iterator"),n=!1;try{var e=[7][r]();e.return=function(){n=!0},Array.from(e,function(){throw 2})}catch{}return lo=function(t,a){if(!a&&!n)return!1;var s=!1;try{var o=[7],h=o[r]();h.next=function(){return{done:s=!0}},o[r]=function(){return h},t(o)}catch{}return s},lo}var r0=tf,xi=ma,fr=Mi,n0=uh,xa=fa,s0=oi,o0=on,h0=fh,fu=Dn,l0=df,Ef=mf.set,xf=Jc(),Lf=ls,bo=If,u0=Qc,f0=gf,Ni="Promise",Mf=xi.TypeError,Sr=xi.process,Cu=Sr&&Sr.versions,C0=Cu&&Cu.v8||"",si=xi[Ni],Qr=n0(Sr)=="process",Jn=function(){},Gn,Af,Du,vh,$r=Af=Lf.f,us=!!function(){try{var r=si.resolve(1),n=(r.constructor={})[Ia("species")]=function(e){e(Jn,Jn)};return(Qr||typeof PromiseRejectionEvent=="function")&&r.then(Jn)instanceof n&&C0.indexOf("6.6")!==0&&u0.indexOf("Chrome/66")===-1}catch{}}(),Nf=function(r){var n;return s0(r)&&typeof(n=r.then)=="function"?n:!1},ch=function(r,n){if(!r._n){r._n=!0;var e=r._c;xf(function(){for(var t=r._v,a=r._s==1,s=0,o=function(h){var l=a?h.ok:h.fail,u=h.resolve,f=h.reject,C=h.domain,D,v,S;try{l?(a||(r._h==2&&v0(r),r._h=1),l===!0?D=t:(C&&C.enter(),D=l(t),C&&(C.exit(),S=!0)),D===h.promise?f(Mf("Promise-chain cycle")):(v=Nf(D))?v.call(D,u,f):u(D)):f(t)}catch(T){C&&!S&&C.exit(),f(T)}};e.length>s;)o(e[s++]);r._c=[],r._n=!1,n&&!r._h&&D0(r)})}},D0=function(r){Ef.call(xi,function(){var n=r._v,e=vu(r),t,a,s;if(e&&(t=bo(function(){Qr?Sr.emit("unhandledRejection",n,r):(a=xi.onunhandledrejection)?a({promise:r,reason:n}):(s=xi.console)&&s.error&&s.error("Unhandled promise rejection",n)}),r._h=Qr||vu(r)?2:1),r._a=void 0,e&&t.e)throw t.v})},vu=function(r){return r._h!==1&&(r._a||r._c).length===0},v0=function(r){Ef.call(xi,function(){var n;Qr?Sr.emit("rejectionHandled",r):(n=xi.onrejectionhandled)&&n({promise:r,reason:r._v})})},Cr=function(r){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=r,n._s=2,n._a||(n._a=n._c.slice()),ch(n,!0))},Go=function(r){var n=this,e;if(!n._d){n._d=!0,n=n._w||n;try{if(n===r)throw Mf("Promise can't be resolved itself");(e=Nf(r))?xf(function(){var t={_w:n,_d:!1};try{e.call(r,fr(Go,t,1),fr(Cr,t,1))}catch(a){Cr.call(t,a)}}):(n._v=r,n._s=1,ch(n,!1))}catch(t){Cr.call({_w:n,_d:!1},t)}}};us||(si=function(n){h0(this,si,Ni,"_h"),o0(n),Gn.call(this);try{n(fr(Go,this,1),fr(Cr,this,1))}catch(e){Cr.call(this,e)}},Gn=function(n){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},Gn.prototype=Dh(si.prototype,{then:function(n,e){var t=$r(l0(this,si));return t.ok=typeof n=="function"?n:!0,t.fail=typeof e=="function"&&e,t.domain=Qr?Sr.domain:void 0,this._c.push(t),this._a&&this._a.push(t),this._s&&ch(this,!1),t.promise},catch:function(r){return this.then(void 0,r)}}),Du=function(){var r=new Gn;this.promise=r,this.resolve=fr(Go,r,1),this.reject=fr(Cr,r,1)},Lf.f=$r=function(r){return r===si||r===vh?new Du(r):Af(r)});xa(xa.G+xa.W+xa.F*!us,{Promise:si});Cn(si,Ni);pf(Ni);vh=_e[Ni];xa(xa.S+xa.F*!us,Ni,{reject:function(n){var e=$r(this),t=e.reject;return t(n),e.promise}});xa(xa.S+xa.F*r0,Ni,{resolve:function(n){return f0(this===vh?si:this,n)}});xa(xa.S+xa.F*!(us&&Ff()(function(r){si.all(r).catch(Jn)})),Ni,{all:function(n){var e=this,t=$r(e),a=t.resolve,s=t.reject,o=bo(function(){var h=[],l=0,u=1;fu(n,!1,function(f){var C=l++,D=!1;h.push(void 0),u++,e.resolve(f).then(function(v){D||(D=!0,h[C]=v,--u||a(h))},s)}),--u||a(h)});return o.e&&s(o.v),t.promise},race:function(n){var e=this,t=$r(e),a=t.reject,s=bo(function(){fu(n,!1,function(o){e.resolve(o).then(t.resolve,a)})});return s.e&&a(s.v),t.promise}});var uo=fa,c0=_e,S0=ma,T0=df,cu=gf;uo(uo.P+uo.R,"Promise",{finally:function(r){var n=T0(this,c0.Promise||S0.Promise),e=typeof r=="function";return this.then(e?function(t){return cu(n,r()).then(function(){return t})}:r,e?function(t){return cu(n,r()).then(function(){throw t})}:r)}});var Su=fa,d0=ls,m0=If;Su(Su.S,"Promise",{try:function(r){var n=d0.f(this),e=m0(r);return(e.e?n.reject:n.resolve)(e.v),n.promise}});var I0=_e.Promise,g0={default:I0,__esModule:!0},Tu=fa;Tu(Tu.S,"Math",{log10:function(n){return Math.log(n)*Math.LOG10E}});var p0=_e.Math.log10,F0={default:p0,__esModule:!0},fo=fa;fo(fo.S+fo.F*!Za,"Object",{defineProperties:lf()});var E0=_e.Object,x0=function(n,e){return E0.defineProperties(n,e)},L0={default:x0,__esModule:!0},du=fa;du(du.S,"Object",{create:os});var M0=_e.Object,A0=function(n,e){return M0.create(n,e)},N0={default:A0,__esModule:!0},O0=Ba,R0=ln,y0=function(r,n,e){n in r?O0.f(r,n,R0(0,e)):r[n]=e},P0=Mi,Co=fa,w0=hs,B0=cf,b0=Sf,G0=ns,mu=y0,V0=Ch;Co(Co.S+Co.F*!Ff()(function(r){Array.from(r)}),"Array",{from:function(n){var e=w0(n),t=typeof this=="function"?this:Array,a=arguments.length,s=a>1?arguments[1]:void 0,o=s!==void 0,h=0,l=V0(e),u,f,C,D;if(o&&(s=P0(s,a>2?arguments[2]:void 0,2)),l!=null&&!(t==Array&&b0(l)))for(D=l.call(e),f=new t;!(C=D.next()).done;h++)mu(f,h,o?B0(D,s,[C.value,h],!0):C.value);else for(u=G0(e.length),f=new t(u);u>h;h++)mu(f,h,o?s(e[h],h):e[h]);return f.length=h,f}});var H0=_e.Array.from,Y0={default:H0,__esModule:!0},Sh={},fs={};fs.f=Ia;var k0=fs.f("iterator"),X0={default:k0,__esModule:!0},Of={exports:{}},Ui=ss("meta"),W0=oi,Th=$i,_0=Ba.f,U0=0,Cs=Object.isExtensible||function(){return!0},K0=!hn(function(){return Cs(Object.preventExtensions({}))}),dh=function(r){_0(r,Ui,{value:{i:"O"+ ++U0,w:{}}})},J0=function(r,n){if(!W0(r))return typeof r=="symbol"?r:(typeof r=="string"?"S":"P")+r;if(!Th(r,Ui)){if(!Cs(r))return"F";if(!n)return"E";dh(r)}return r[Ui].i},z0=function(r,n){if(!Th(r,Ui)){if(!Cs(r))return!0;if(!n)return!1;dh(r)}return r[Ui].w},Z0=function(r){return K0&&Q0.NEED&&Cs(r)&&!Th(r,Ui)&&dh(r),r},Q0=Of.exports={KEY:Ui,NEED:!1,fastKey:J0,getWeak:z0,onFreeze:Z0},mh=Of.exports,Iu=_e,$0=fs,q0=Ba.f,Ih=function(r){var n=Iu.Symbol||(Iu.Symbol={});r.charAt(0)!="_"&&!(r in n)&&q0(n,r,{value:$0.f(r)})},gh={};gh.f=Object.getOwnPropertySymbols;var Ds={};Ds.f={}.propertyIsEnumerable;var j0=hh,tS=gh,eS=Ds,aS=function(r){var n=j0(r),e=tS.f;if(e)for(var t=e(r),a=eS.f,s=0,o;t.length>s;)a.call(r,o=t[s++])&&n.push(o);return n},iS=fn,Rf=Array.isArray||function(n){return iS(n)=="Array"},yf={},ph={},rS=hf,nS=oh.concat("length","prototype");ph.f=Object.getOwnPropertyNames||function(n){return rS(n,nS)};var sS=Lr,Pf=ph.f,oS={}.toString,wf=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],hS=function(r){try{return Pf(r)}catch{return wf.slice()}};yf.f=function(n){return wf&&oS.call(n)=="[object Window]"?hS(n):Pf(sS(n))};var Bf={},lS=Ds,uS=ln,fS=Lr,CS=rh,DS=$i,vS=rf,gu=Object.getOwnPropertyDescriptor;Bf.f=Za?gu:function(n,e){if(n=fS(n),e=CS(e,!0),vS)try{return gu(n,e)}catch{}if(DS(n,e))return uS(!lS.f.call(n,e),n[e])};var vs=ma,Xe=$i,Vo=Za,aa=fa,pu=nf,cS=mh.KEY,Fh=hn,Eh=nh,xh=Cn,SS=ss,vn=Ia,TS=fs,dS=Ih,mS=aS,IS=Rf,Ho=ci,gS=oi,pS=hs,cs=Lr,Lh=rh,Yo=ln,qr=os,bf=yf,Gf=Bf,Ss=gh,Vf=Ba,FS=hh,Hf=Gf.f,Xi=Vf.f,Yf=bf.f,da=vs.Symbol,zn=vs.JSON,Vn=zn&&zn.stringify,Li="prototype",Ta=vn("_hidden"),Fu=vn("toPrimitive"),ES={}.propertyIsEnumerable,_r=Eh("symbol-registry"),vi=Eh("symbols"),cn=Eh("op-symbols"),ya=Object[Li],Mr=typeof da=="function"&&!!Ss.f,Do=vs.QObject,ko=!Do||!Do[Li]||!Do[Li].findChild,Xo=Vo&&Fh(function(){return qr(Xi({},"a",{get:function(){return Xi(this,"a",{value:7}).a}})).a!=7})?function(r,n,e){var t=Hf(ya,n);t&&delete ya[n],Xi(r,n,e),t&&r!==ya&&Xi(ya,n,t)}:Xi,Eu=function(r){var n=vi[r]=qr(da[Li]);return n._k=r,n},Wo=Mr&&typeof da.iterator=="symbol"?function(r){return typeof r=="symbol"}:function(r){return r instanceof da},Ts=function(n,e,t){return n===ya&&Ts(cn,e,t),Ho(n),e=Lh(e,!0),Ho(t),Xe(vi,e)?(t.enumerable?(Xe(n,Ta)&&n[Ta][e]&&(n[Ta][e]=!1),t=qr(t,{enumerable:Yo(0,!1)})):(Xe(n,Ta)||Xi(n,Ta,Yo(1,{})),n[Ta][e]=!0),Xo(n,e,t)):Xi(n,e,t)},kf=function(n,e){Ho(n);for(var t=mS(e=cs(e)),a=0,s=t.length,o;s>a;)Ts(n,o=t[a++],e[o]);return n},xS=function(n,e){return e===void 0?qr(n):kf(qr(n),e)},xu=function(n){var e=ES.call(this,n=Lh(n,!0));return this===ya&&Xe(vi,n)&&!Xe(cn,n)?!1:e||!Xe(this,n)||!Xe(vi,n)||Xe(this,Ta)&&this[Ta][n]?e:!0},Xf=function(n,e){if(n=cs(n),e=Lh(e,!0),!(n===ya&&Xe(vi,e)&&!Xe(cn,e))){var t=Hf(n,e);return t&&Xe(vi,e)&&!(Xe(n,Ta)&&n[Ta][e])&&(t.enumerable=!0),t}},Wf=function(n){for(var e=Yf(cs(n)),t=[],a=0,s;e.length>a;)!Xe(vi,s=e[a++])&&s!=Ta&&s!=cS&&t.push(s);return t},_f=function(n){for(var e=n===ya,t=Yf(e?cn:cs(n)),a=[],s=0,o;t.length>s;)Xe(vi,o=t[s++])&&(!e||Xe(ya,o))&&a.push(vi[o]);return a};Mr||(da=function(){if(this instanceof da)throw TypeError("Symbol is not a constructor!");var n=SS(arguments.length>0?arguments[0]:void 0),e=function(t){this===ya&&e.call(cn,t),Xe(this,Ta)&&Xe(this[Ta],n)&&(this[Ta][n]=!1),Xo(this,n,Yo(1,t))};return Vo&&ko&&Xo(ya,n,{configurable:!0,set:e}),Eu(n)},pu(da[Li],"toString",function(){return this._k}),Gf.f=Xf,Vf.f=Ts,ph.f=bf.f=Wf,Ds.f=xu,Ss.f=_f,Vo&&!tf&&pu(ya,"propertyIsEnumerable",xu),TS.f=function(r){return Eu(vn(r))});aa(aa.G+aa.W+aa.F*!Mr,{Symbol:da});for(var Lu="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Mu=0;Lu.length>Mu;)vn(Lu[Mu++]);for(var Au=FS(vn.store),Nu=0;Au.length>Nu;)dS(Au[Nu++]);aa(aa.S+aa.F*!Mr,"Symbol",{for:function(r){return Xe(_r,r+="")?_r[r]:_r[r]=da(r)},keyFor:function(n){if(!Wo(n))throw TypeError(n+" is not a symbol!");for(var e in _r)if(_r[e]===n)return e},useSetter:function(){ko=!0},useSimple:function(){ko=!1}});aa(aa.S+aa.F*!Mr,"Object",{create:xS,defineProperty:Ts,defineProperties:kf,getOwnPropertyDescriptor:Xf,getOwnPropertyNames:Wf,getOwnPropertySymbols:_f});var LS=Fh(function(){Ss.f(1)});aa(aa.S+aa.F*LS,"Object",{getOwnPropertySymbols:function(n){return Ss.f(pS(n))}});zn&&aa(aa.S+aa.F*(!Mr||Fh(function(){var r=da();return Vn([r])!="[null]"||Vn({a:r})!="{}"||Vn(Object(r))!="{}"})),"JSON",{stringify:function(n){for(var e=[n],t=1,a,s;arguments.length>t;)e.push(arguments[t++]);if(s=a=e[1],!(!gS(a)&&n===void 0||Wo(n)))return IS(a)||(a=function(o,h){if(typeof s=="function"&&(h=s.call(this,o,h)),!Wo(h))return h}),e[1]=a,Vn.apply(zn,e)}});da[Li][Fu]||Ai(da[Li],Fu,da[Li].valueOf);xh(da,"Symbol");xh(Math,"Math",!0);xh(vs.JSON,"JSON",!0);Ih("asyncIterator");Ih("observable");var MS=_e.Symbol,AS={default:MS,__esModule:!0};Sh.__esModule=!0;var NS=X0,Uf=Kf(NS),OS=AS,pi=Kf(OS),vo=typeof pi.default=="function"&&typeof Uf.default=="symbol"?function(r){return typeof r}:function(r){return r&&typeof pi.default=="function"&&r.constructor===pi.default&&r!==pi.default.prototype?"symbol":typeof r};function Kf(r){return r&&r.__esModule?r:{default:r}}Sh.default=typeof pi.default=="function"&&vo(Uf.default)==="symbol"?function(r){return typeof r>"u"?"undefined":vo(r)}:function(r){return r&&typeof pi.default=="function"&&r.constructor===pi.default&&r!==pi.default.prototype?"symbol":typeof r>"u"?"undefined":vo(r)};var ds={},co=fa;co(co.S+co.F*!Za,"Object",{defineProperty:Ba.f});var RS=_e.Object,yS=function(n,e,t){return RS.defineProperty(n,e,t)},PS={default:yS,__esModule:!0};ds.__esModule=!0;var wS=PS,BS=bS(wS);function bS(r){return r&&r.__esModule?r:{default:r}}ds.default=function(r,n,e){return n in r?(0,BS.default)(r,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[n]=e,r};var GS=oi,Mh=function(r,n){if(!GS(r)||r._t!==n)throw TypeError("Incompatible receiver, "+n+" required!");return r},VS=Ba.f,HS=os,YS=Dh,kS=Mi,XS=fh,WS=Dn,_S=lh,Hn=Df,US=pf,Jf=Za,zf=mh.fastKey,ur=Mh,Ur=Jf?"_s":"size",Yn=function(r,n){var e=zf(n),t;if(e!=="F")return r._i[e];for(t=r._f;t;t=t.n)if(t.k==n)return t},Zf={getConstructor:function(r,n,e,t){var a=r(function(s,o){XS(s,a,n,"_i"),s._t=n,s._i=HS(null),s._f=void 0,s._l=void 0,s[Ur]=0,o!=null&&WS(o,e,s[t],s)});return YS(a.prototype,{clear:function(){for(var o=ur(this,n),h=o._i,l=o._f;l;l=l.n)l.r=!0,l.p&&(l.p=l.p.n=void 0),delete h[l.i];o._f=o._l=void 0,o[Ur]=0},delete:function(s){var o=ur(this,n),h=Yn(o,s);if(h){var l=h.n,u=h.p;delete o._i[h.i],h.r=!0,u&&(u.n=l),l&&(l.p=u),o._f==h&&(o._f=l),o._l==h&&(o._l=u),o[Ur]--}return!!h},forEach:function(o){ur(this,n);for(var h=kS(o,arguments.length>1?arguments[1]:void 0,3),l;l=l?l.n:this._f;)for(h(l.v,l.k,this);l&&l.r;)l=l.p},has:function(o){return!!Yn(ur(this,n),o)}}),Jf&&VS(a.prototype,"size",{get:function(){return ur(this,n)[Ur]}}),a},def:function(r,n,e){var t=Yn(r,n),a,s;return t?t.v=e:(r._l=t={i:s=zf(n,!0),k:n,v:e,p:a=r._l,n:void 0,r:!1},r._f||(r._f=t),a&&(a.n=t),r[Ur]++,s!=="F"&&(r._i[s]=t)),r},getEntry:Yn,setStrong:function(r,n,e){_S(r,n,function(t,a){this._t=ur(t,n),this._k=a,this._l=void 0},function(){for(var t=this,a=t._k,s=t._l;s&&s.r;)s=s.p;return!t._t||!(t._l=s=s?s.n:t._t._f)?(t._t=void 0,Hn(1)):a=="keys"?Hn(0,s.k):a=="values"?Hn(0,s.v):Hn(0,[s.k,s.v])},e?"entries":"values",!e,!0),US(n)}},KS=oi,Ou=Rf,JS=Ia("species"),zS=function(r){var n;return Ou(r)&&(n=r.constructor,typeof n=="function"&&(n===Array||Ou(n.prototype))&&(n=void 0),KS(n)&&(n=n[JS],n===null&&(n=void 0))),n===void 0?Array:n},ZS=zS,QS=function(r,n){return new(ZS(r))(n)},$S=Mi,qS=sf,jS=hs,tT=ns,eT=QS,aT=function(r,n){var e=r==1,t=r==2,a=r==3,s=r==4,o=r==6,h=r==5||o,l=n||eT;return function(u,f,C){for(var D=jS(u),v=qS(D),S=$S(f,C,3),T=tT(v.length),I=0,F=e?l(u,T):t?l(u,0):void 0,E,M;T>I;I++)if((h||I in v)&&(E=v[I],M=S(E,I,D),r)){if(e)F[I]=M;else if(M)switch(r){case 3:return!0;case 5:return E;case 6:return I;case 2:F.push(E)}else if(s)return!1}return o?-1:a||s?s:F}},iT=ma,kn=fa,rT=mh,nT=hn,sT=Ai,oT=Dh,hT=Dn,Ru=fh,lT=oi,uT=Cn,fT=Ba.f,CT=aT(0),DT=Za,Qf=function(r,n,e,t,a,s){var o=iT[r],h=o,l=a?"set":"add",u=h&&h.prototype,f={};return!DT||typeof h!="function"||!(s||u.forEach&&!nT(function(){new h().entries().next()}))?(h=t.getConstructor(n,r,a,l),oT(h.prototype,e),rT.NEED=!0):(h=n(function(C,D){Ru(C,h,r,"_c"),C._c=new o,D!=null&&hT(D,a,C[l],C)}),CT("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(C){var D=C=="add"||C=="set";C in u&&!(s&&C=="clear")&&sT(h.prototype,C,function(v,S){if(Ru(this,h,C),!D&&s&&!lT(v))return C=="get"?void 0:!1;var T=this._c[C](v===0?0:v,S);return D?this:T})}),s||fT(h.prototype,"size",{get:function(){return this._c.size}})),uT(h,r),f[r]=h,kn(kn.G+kn.W+kn.F,f),s||t.setStrong(h,r,a),h},yu=Zf,vT=Mh,Pu="Set";Qf(Pu,function(r){return function(){return r(this,arguments.length>0?arguments[0]:void 0)}},{add:function(n){return yu.def(vT(this,Pu),n=n===0?0:n,n)}},yu);var So,wu;function cT(){if(wu)return So;wu=1;var r=Dn;return So=function(n,e){var t=[];return r(n,!1,t.push,t,e),t},So}var To,Bu;function $f(){if(Bu)return To;Bu=1;var r=uh,n=cT();return To=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return n(this)}},To}var mo=fa;mo(mo.P+mo.R,"Set",{toJSON:$f()("Set")});var bu=fa,qf=function(r){bu(bu.S,r,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})};qf("Set");var Gu=fa,Vu=on,ST=Mi,Hu=Dn,jf=function(r){Gu(Gu.S,r,{from:function(e){var t=arguments[1],a,s,o,h;return Vu(this),a=t!==void 0,a&&Vu(t),e==null?new this:(s=[],a?(o=0,h=ST(t,arguments[2],2),Hu(e,!1,function(l){s.push(h(l,o++))})):Hu(e,!1,s.push,s),new this(s))}})};jf("Set");var TT=_e.Set,tC={default:TT,__esModule:!0},Yu=_e,ku=Yu.JSON||(Yu.JSON={stringify:JSON.stringify}),dT=function(n){return ku.stringify.apply(ku,arguments)},mT={default:dT,__esModule:!0},IT=ci,gT=Ch,pT=_e.getIterator=function(r){var n=gT(r);if(typeof n!="function")throw TypeError(r+" is not iterable!");return IT(n.call(r))},FT=pT,eC={default:FT,__esModule:!0},Io=Zf,Xu=Mh,go="Map";Qf(go,function(r){return function(){return r(this,arguments.length>0?arguments[0]:void 0)}},{get:function(n){var e=Io.getEntry(Xu(this,go),n);return e&&e.v},set:function(n,e){return Io.def(Xu(this,go),n===0?0:n,e)}},Io,!0);var po=fa;po(po.P+po.R,"Map",{toJSON:$f()("Map")});qf("Map");jf("Map");var ET=_e.Map,Ah={default:ET,__esModule:!0},aC={exports:{}};/*!
 * jQuery JavaScript Library v3.7.1
 * https://jquery.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2023-08-28T13:37Z
 */(function(r){(function(n,e){r.exports=n.document?e(n,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}})(typeof window<"u"?window:ov,function(n,e){var t=[],a=Object.getPrototypeOf,s=t.slice,o=t.flat?function(d){return t.flat.call(d)}:function(d){return t.concat.apply([],d)},h=t.push,l=t.indexOf,u={},f=u.toString,C=u.hasOwnProperty,D=C.toString,v=D.call(Object),S={},T=function(g){return typeof g=="function"&&typeof g.nodeType!="number"&&typeof g.item!="function"},I=function(g){return g!=null&&g===g.window},F=n.document,E={type:!0,src:!0,nonce:!0,noModule:!0};function M(d,g,A){A=A||F;var N,P,w=A.createElement("script");if(w.text=d,g)for(N in E)P=g[N]||g.getAttribute&&g.getAttribute(N),P&&w.setAttribute(N,P);A.head.appendChild(w).parentNode.removeChild(w)}function O(d){return d==null?d+"":typeof d=="object"||typeof d=="function"?u[f.call(d)]||"object":typeof d}var R="3.7.1",b=/HTML$/i,p=function(d,g){return new p.fn.init(d,g)};p.fn=p.prototype={jquery:R,constructor:p,length:0,toArray:function(){return s.call(this)},get:function(d){return d==null?s.call(this):d<0?this[d+this.length]:this[d]},pushStack:function(d){var g=p.merge(this.constructor(),d);return g.prevObject=this,g},each:function(d){return p.each(this,d)},map:function(d){return this.pushStack(p.map(this,function(g,A){return d.call(g,A,g)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(p.grep(this,function(d,g){return(g+1)%2}))},odd:function(){return this.pushStack(p.grep(this,function(d,g){return g%2}))},eq:function(d){var g=this.length,A=+d+(d<0?g:0);return this.pushStack(A>=0&&A<g?[this[A]]:[])},end:function(){return this.prevObject||this.constructor()},push:h,sort:t.sort,splice:t.splice},p.extend=p.fn.extend=function(){var d,g,A,N,P,w,H=arguments[0]||{},z=1,U=arguments.length,$=!1;for(typeof H=="boolean"&&($=H,H=arguments[z]||{},z++),typeof H!="object"&&!T(H)&&(H={}),z===U&&(H=this,z--);z<U;z++)if((d=arguments[z])!=null)for(g in d)N=d[g],!(g==="__proto__"||H===N)&&($&&N&&(p.isPlainObject(N)||(P=Array.isArray(N)))?(A=H[g],P&&!Array.isArray(A)?w=[]:!P&&!p.isPlainObject(A)?w={}:w=A,P=!1,H[g]=p.extend($,w,N)):N!==void 0&&(H[g]=N));return H},p.extend({expando:"jQuery"+(R+Math.random()).replace(/\D/g,""),isReady:!0,error:function(d){throw new Error(d)},noop:function(){},isPlainObject:function(d){var g,A;return!d||f.call(d)!=="[object Object]"?!1:(g=a(d),g?(A=C.call(g,"constructor")&&g.constructor,typeof A=="function"&&D.call(A)===v):!0)},isEmptyObject:function(d){var g;for(g in d)return!1;return!0},globalEval:function(d,g,A){M(d,{nonce:g&&g.nonce},A)},each:function(d,g){var A,N=0;if(G(d))for(A=d.length;N<A&&g.call(d[N],N,d[N])!==!1;N++);else for(N in d)if(g.call(d[N],N,d[N])===!1)break;return d},text:function(d){var g,A="",N=0,P=d.nodeType;if(!P)for(;g=d[N++];)A+=p.text(g);return P===1||P===11?d.textContent:P===9?d.documentElement.textContent:P===3||P===4?d.nodeValue:A},makeArray:function(d,g){var A=g||[];return d!=null&&(G(Object(d))?p.merge(A,typeof d=="string"?[d]:d):h.call(A,d)),A},inArray:function(d,g,A){return g==null?-1:l.call(g,d,A)},isXMLDoc:function(d){var g=d&&d.namespaceURI,A=d&&(d.ownerDocument||d).documentElement;return!b.test(g||A&&A.nodeName||"HTML")},merge:function(d,g){for(var A=+g.length,N=0,P=d.length;N<A;N++)d[P++]=g[N];return d.length=P,d},grep:function(d,g,A){for(var N,P=[],w=0,H=d.length,z=!A;w<H;w++)N=!g(d[w],w),N!==z&&P.push(d[w]);return P},map:function(d,g,A){var N,P,w=0,H=[];if(G(d))for(N=d.length;w<N;w++)P=g(d[w],w,A),P!=null&&H.push(P);else for(w in d)P=g(d[w],w,A),P!=null&&H.push(P);return o(H)},guid:1,support:S}),typeof Symbol=="function"&&(p.fn[Symbol.iterator]=t[Symbol.iterator]),p.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(d,g){u["[object "+g+"]"]=g.toLowerCase()});function G(d){var g=!!d&&"length"in d&&d.length,A=O(d);return T(d)||I(d)?!1:A==="array"||g===0||typeof g=="number"&&g>0&&g-1 in d}function Y(d,g){return d.nodeName&&d.nodeName.toLowerCase()===g.toLowerCase()}var Q=t.pop,ht=t.sort,Ct=t.splice,lt="[\\x20\\t\\r\\n\\f]",dt=new RegExp("^"+lt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+lt+"+$","g");p.contains=function(d,g){var A=g&&g.parentNode;return d===A||!!(A&&A.nodeType===1&&(d.contains?d.contains(A):d.compareDocumentPosition&&d.compareDocumentPosition(A)&16))};var Ut=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function Wt(d,g){return g?d==="\0"?"�":d.slice(0,-1)+"\\"+d.charCodeAt(d.length-1).toString(16)+" ":"\\"+d}p.escapeSelector=function(d){return(d+"").replace(Ut,Wt)};var Qt=F,ye=h;(function(){var d,g,A,N,P,w=ye,H,z,U,$,st,ft=p.expando,at=0,Tt=0,Yt=En(),le=En(),Jt=En(),Ue=En(),Ve=function(_,Z){return _===Z&&(P=!0),0},ti="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ei="(?:\\\\[\\da-fA-F]{1,6}"+lt+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",te="\\["+lt+"*("+ei+")(?:"+lt+"*([*^$|!~]?=)"+lt+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+ei+"))|)"+lt+"*\\]",Vi=":("+ei+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+te+")*)|.*)\\)|)",ve=new RegExp(lt+"+","g"),Re=new RegExp("^"+lt+"*,"+lt+"*"),Yr=new RegExp("^"+lt+"*([>+~]|"+lt+")"+lt+"*"),Vs=new RegExp(lt+"|>"),ai=new RegExp(Vi),kr=new RegExp("^"+ei+"$"),ii={ID:new RegExp("^#("+ei+")"),CLASS:new RegExp("^\\.("+ei+")"),TAG:new RegExp("^("+ei+"|[*])"),ATTR:new RegExp("^"+te),PSEUDO:new RegExp("^"+Vi),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+lt+"*(even|odd|(([+-]|)(\\d*)n|)"+lt+"*(?:([+-]|)"+lt+"*(\\d+)|))"+lt+"*\\)|)","i"),bool:new RegExp("^(?:"+ti+")$","i"),needsContext:new RegExp("^"+lt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+lt+"*((?:-\\d)?\\d*)"+lt+"*\\)|)(?=[^-]|$)","i")},mi=/^(?:input|select|textarea|button)$/i,Ii=/^h\d$/i,Oa=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Hs=/[+~]/,li=new RegExp("\\\\[\\da-fA-F]{1,6}"+lt+"?|\\\\([^\\r\\n\\f])","g"),ui=function(_,Z){var tt="0x"+_.slice(1)-65536;return Z||(tt<0?String.fromCharCode(tt+65536):String.fromCharCode(tt>>10|55296,tt&1023|56320))},kD=function(){gi()},XD=Ln(function(_){return _.disabled===!0&&Y(_,"fieldset")},{dir:"parentNode",next:"legend"});function WD(){try{return H.activeElement}catch{}}try{w.apply(t=s.call(Qt.childNodes),Qt.childNodes),t[Qt.childNodes.length].nodeType}catch{w={apply:function(Z,tt){ye.apply(Z,s.call(tt))},call:function(Z){ye.apply(Z,s.call(arguments,1))}}}function ge(_,Z,tt,nt){var ut,mt,pt,Nt,Ft,qt,Vt,Xt=Z&&Z.ownerDocument,jt=Z?Z.nodeType:9;if(tt=tt||[],typeof _!="string"||!_||jt!==1&&jt!==9&&jt!==11)return tt;if(!nt&&(gi(Z),Z=Z||H,U)){if(jt!==11&&(Ft=Oa.exec(_)))if(ut=Ft[1]){if(jt===9)if(pt=Z.getElementById(ut)){if(pt.id===ut)return w.call(tt,pt),tt}else return tt;else if(Xt&&(pt=Xt.getElementById(ut))&&ge.contains(Z,pt)&&pt.id===ut)return w.call(tt,pt),tt}else{if(Ft[2])return w.apply(tt,Z.getElementsByTagName(_)),tt;if((ut=Ft[3])&&Z.getElementsByClassName)return w.apply(tt,Z.getElementsByClassName(ut)),tt}if(!Ue[_+" "]&&(!$||!$.test(_))){if(Vt=_,Xt=Z,jt===1&&(Vs.test(_)||Yr.test(_))){for(Xt=Hs.test(_)&&Ys(Z.parentNode)||Z,(Xt!=Z||!S.scope)&&((Nt=Z.getAttribute("id"))?Nt=p.escapeSelector(Nt):Z.setAttribute("id",Nt=ft)),qt=Xr(_),mt=qt.length;mt--;)qt[mt]=(Nt?"#"+Nt:":scope")+" "+xn(qt[mt]);Vt=qt.join(",")}try{return w.apply(tt,Xt.querySelectorAll(Vt)),tt}catch{Ue(_,!0)}finally{Nt===ft&&Z.removeAttribute("id")}}}return Al(_.replace(dt,"$1"),Z,tt,nt)}function En(){var _=[];function Z(tt,nt){return _.push(tt+" ")>g.cacheLength&&delete Z[_.shift()],Z[tt+" "]=nt}return Z}function _a(_){return _[ft]=!0,_}function hr(_){var Z=H.createElement("fieldset");try{return!!_(Z)}catch{return!1}finally{Z.parentNode&&Z.parentNode.removeChild(Z),Z=null}}function _D(_){return function(Z){return Y(Z,"input")&&Z.type===_}}function UD(_){return function(Z){return(Y(Z,"input")||Y(Z,"button"))&&Z.type===_}}function Ll(_){return function(Z){return"form"in Z?Z.parentNode&&Z.disabled===!1?"label"in Z?"label"in Z.parentNode?Z.parentNode.disabled===_:Z.disabled===_:Z.isDisabled===_||Z.isDisabled!==!_&&XD(Z)===_:Z.disabled===_:"label"in Z?Z.disabled===_:!1}}function Hi(_){return _a(function(Z){return Z=+Z,_a(function(tt,nt){for(var ut,mt=_([],tt.length,Z),pt=mt.length;pt--;)tt[ut=mt[pt]]&&(tt[ut]=!(nt[ut]=tt[ut]))})})}function Ys(_){return _&&typeof _.getElementsByTagName<"u"&&_}function gi(_){var Z,tt=_?_.ownerDocument||_:Qt;return tt==H||tt.nodeType!==9||!tt.documentElement||(H=tt,z=H.documentElement,U=!p.isXMLDoc(H),st=z.matches||z.webkitMatchesSelector||z.msMatchesSelector,z.msMatchesSelector&&Qt!=H&&(Z=H.defaultView)&&Z.top!==Z&&Z.addEventListener("unload",kD),S.getById=hr(function(nt){return z.appendChild(nt).id=p.expando,!H.getElementsByName||!H.getElementsByName(p.expando).length}),S.disconnectedMatch=hr(function(nt){return st.call(nt,"*")}),S.scope=hr(function(){return H.querySelectorAll(":scope")}),S.cssHas=hr(function(){try{return H.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),S.getById?(g.filter.ID=function(nt){var ut=nt.replace(li,ui);return function(mt){return mt.getAttribute("id")===ut}},g.find.ID=function(nt,ut){if(typeof ut.getElementById<"u"&&U){var mt=ut.getElementById(nt);return mt?[mt]:[]}}):(g.filter.ID=function(nt){var ut=nt.replace(li,ui);return function(mt){var pt=typeof mt.getAttributeNode<"u"&&mt.getAttributeNode("id");return pt&&pt.value===ut}},g.find.ID=function(nt,ut){if(typeof ut.getElementById<"u"&&U){var mt,pt,Nt,Ft=ut.getElementById(nt);if(Ft){if(mt=Ft.getAttributeNode("id"),mt&&mt.value===nt)return[Ft];for(Nt=ut.getElementsByName(nt),pt=0;Ft=Nt[pt++];)if(mt=Ft.getAttributeNode("id"),mt&&mt.value===nt)return[Ft]}return[]}}),g.find.TAG=function(nt,ut){return typeof ut.getElementsByTagName<"u"?ut.getElementsByTagName(nt):ut.querySelectorAll(nt)},g.find.CLASS=function(nt,ut){if(typeof ut.getElementsByClassName<"u"&&U)return ut.getElementsByClassName(nt)},$=[],hr(function(nt){var ut;z.appendChild(nt).innerHTML="<a id='"+ft+"' href='' disabled='disabled'></a><select id='"+ft+"-\r\\' disabled='disabled'><option selected=''></option></select>",nt.querySelectorAll("[selected]").length||$.push("\\["+lt+"*(?:value|"+ti+")"),nt.querySelectorAll("[id~="+ft+"-]").length||$.push("~="),nt.querySelectorAll("a#"+ft+"+*").length||$.push(".#.+[+~]"),nt.querySelectorAll(":checked").length||$.push(":checked"),ut=H.createElement("input"),ut.setAttribute("type","hidden"),nt.appendChild(ut).setAttribute("name","D"),z.appendChild(nt).disabled=!0,nt.querySelectorAll(":disabled").length!==2&&$.push(":enabled",":disabled"),ut=H.createElement("input"),ut.setAttribute("name",""),nt.appendChild(ut),nt.querySelectorAll("[name='']").length||$.push("\\["+lt+"*name"+lt+"*="+lt+`*(?:''|"")`)}),S.cssHas||$.push(":has"),$=$.length&&new RegExp($.join("|")),Ve=function(nt,ut){if(nt===ut)return P=!0,0;var mt=!nt.compareDocumentPosition-!ut.compareDocumentPosition;return mt||(mt=(nt.ownerDocument||nt)==(ut.ownerDocument||ut)?nt.compareDocumentPosition(ut):1,mt&1||!S.sortDetached&&ut.compareDocumentPosition(nt)===mt?nt===H||nt.ownerDocument==Qt&&ge.contains(Qt,nt)?-1:ut===H||ut.ownerDocument==Qt&&ge.contains(Qt,ut)?1:N?l.call(N,nt)-l.call(N,ut):0:mt&4?-1:1)}),H}ge.matches=function(_,Z){return ge(_,null,null,Z)},ge.matchesSelector=function(_,Z){if(gi(_),U&&!Ue[Z+" "]&&(!$||!$.test(Z)))try{var tt=st.call(_,Z);if(tt||S.disconnectedMatch||_.document&&_.document.nodeType!==11)return tt}catch{Ue(Z,!0)}return ge(Z,H,null,[_]).length>0},ge.contains=function(_,Z){return(_.ownerDocument||_)!=H&&gi(_),p.contains(_,Z)},ge.attr=function(_,Z){(_.ownerDocument||_)!=H&&gi(_);var tt=g.attrHandle[Z.toLowerCase()],nt=tt&&C.call(g.attrHandle,Z.toLowerCase())?tt(_,Z,!U):void 0;return nt!==void 0?nt:_.getAttribute(Z)},ge.error=function(_){throw new Error("Syntax error, unrecognized expression: "+_)},p.uniqueSort=function(_){var Z,tt=[],nt=0,ut=0;if(P=!S.sortStable,N=!S.sortStable&&s.call(_,0),ht.call(_,Ve),P){for(;Z=_[ut++];)Z===_[ut]&&(nt=tt.push(ut));for(;nt--;)Ct.call(_,tt[nt],1)}return N=null,_},p.fn.uniqueSort=function(){return this.pushStack(p.uniqueSort(s.apply(this)))},g=p.expr={cacheLength:50,createPseudo:_a,match:ii,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(_){return _[1]=_[1].replace(li,ui),_[3]=(_[3]||_[4]||_[5]||"").replace(li,ui),_[2]==="~="&&(_[3]=" "+_[3]+" "),_.slice(0,4)},CHILD:function(_){return _[1]=_[1].toLowerCase(),_[1].slice(0,3)==="nth"?(_[3]||ge.error(_[0]),_[4]=+(_[4]?_[5]+(_[6]||1):2*(_[3]==="even"||_[3]==="odd")),_[5]=+(_[7]+_[8]||_[3]==="odd")):_[3]&&ge.error(_[0]),_},PSEUDO:function(_){var Z,tt=!_[6]&&_[2];return ii.CHILD.test(_[0])?null:(_[3]?_[2]=_[4]||_[5]||"":tt&&ai.test(tt)&&(Z=Xr(tt,!0))&&(Z=tt.indexOf(")",tt.length-Z)-tt.length)&&(_[0]=_[0].slice(0,Z),_[2]=tt.slice(0,Z)),_.slice(0,3))}},filter:{TAG:function(_){var Z=_.replace(li,ui).toLowerCase();return _==="*"?function(){return!0}:function(tt){return Y(tt,Z)}},CLASS:function(_){var Z=Yt[_+" "];return Z||(Z=new RegExp("(^|"+lt+")"+_+"("+lt+"|$)"))&&Yt(_,function(tt){return Z.test(typeof tt.className=="string"&&tt.className||typeof tt.getAttribute<"u"&&tt.getAttribute("class")||"")})},ATTR:function(_,Z,tt){return function(nt){var ut=ge.attr(nt,_);return ut==null?Z==="!=":Z?(ut+="",Z==="="?ut===tt:Z==="!="?ut!==tt:Z==="^="?tt&&ut.indexOf(tt)===0:Z==="*="?tt&&ut.indexOf(tt)>-1:Z==="$="?tt&&ut.slice(-tt.length)===tt:Z==="~="?(" "+ut.replace(ve," ")+" ").indexOf(tt)>-1:Z==="|="?ut===tt||ut.slice(0,tt.length+1)===tt+"-":!1):!0}},CHILD:function(_,Z,tt,nt,ut){var mt=_.slice(0,3)!=="nth",pt=_.slice(-4)!=="last",Nt=Z==="of-type";return nt===1&&ut===0?function(Ft){return!!Ft.parentNode}:function(Ft,qt,Vt){var Xt,jt,Bt,Le,ca,je=mt!==pt?"nextSibling":"previousSibling",Ra=Ft.parentNode,ri=Nt&&Ft.nodeName.toLowerCase(),lr=!Vt&&!Nt,la=!1;if(Ra){if(mt){for(;je;){for(Bt=Ft;Bt=Bt[je];)if(Nt?Y(Bt,ri):Bt.nodeType===1)return!1;ca=je=_==="only"&&!ca&&"nextSibling"}return!0}if(ca=[pt?Ra.firstChild:Ra.lastChild],pt&&lr){for(jt=Ra[ft]||(Ra[ft]={}),Xt=jt[_]||[],Le=Xt[0]===at&&Xt[1],la=Le&&Xt[2],Bt=Le&&Ra.childNodes[Le];Bt=++Le&&Bt&&Bt[je]||(la=Le=0)||ca.pop();)if(Bt.nodeType===1&&++la&&Bt===Ft){jt[_]=[at,Le,la];break}}else if(lr&&(jt=Ft[ft]||(Ft[ft]={}),Xt=jt[_]||[],Le=Xt[0]===at&&Xt[1],la=Le),la===!1)for(;(Bt=++Le&&Bt&&Bt[je]||(la=Le=0)||ca.pop())&&!((Nt?Y(Bt,ri):Bt.nodeType===1)&&++la&&(lr&&(jt=Bt[ft]||(Bt[ft]={}),jt[_]=[at,la]),Bt===Ft)););return la-=ut,la===nt||la%nt===0&&la/nt>=0}}},PSEUDO:function(_,Z){var tt,nt=g.pseudos[_]||g.setFilters[_.toLowerCase()]||ge.error("unsupported pseudo: "+_);return nt[ft]?nt(Z):nt.length>1?(tt=[_,_,"",Z],g.setFilters.hasOwnProperty(_.toLowerCase())?_a(function(ut,mt){for(var pt,Nt=nt(ut,Z),Ft=Nt.length;Ft--;)pt=l.call(ut,Nt[Ft]),ut[pt]=!(mt[pt]=Nt[Ft])}):function(ut){return nt(ut,0,tt)}):nt}},pseudos:{not:_a(function(_){var Z=[],tt=[],nt=_s(_.replace(dt,"$1"));return nt[ft]?_a(function(ut,mt,pt,Nt){for(var Ft,qt=nt(ut,null,Nt,[]),Vt=ut.length;Vt--;)(Ft=qt[Vt])&&(ut[Vt]=!(mt[Vt]=Ft))}):function(ut,mt,pt){return Z[0]=ut,nt(Z,null,pt,tt),Z[0]=null,!tt.pop()}}),has:_a(function(_){return function(Z){return ge(_,Z).length>0}}),contains:_a(function(_){return _=_.replace(li,ui),function(Z){return(Z.textContent||p.text(Z)).indexOf(_)>-1}}),lang:_a(function(_){return kr.test(_||"")||ge.error("unsupported lang: "+_),_=_.replace(li,ui).toLowerCase(),function(Z){var tt;do if(tt=U?Z.lang:Z.getAttribute("xml:lang")||Z.getAttribute("lang"))return tt=tt.toLowerCase(),tt===_||tt.indexOf(_+"-")===0;while((Z=Z.parentNode)&&Z.nodeType===1);return!1}}),target:function(_){var Z=n.location&&n.location.hash;return Z&&Z.slice(1)===_.id},root:function(_){return _===z},focus:function(_){return _===WD()&&H.hasFocus()&&!!(_.type||_.href||~_.tabIndex)},enabled:Ll(!1),disabled:Ll(!0),checked:function(_){return Y(_,"input")&&!!_.checked||Y(_,"option")&&!!_.selected},selected:function(_){return _.parentNode&&_.parentNode.selectedIndex,_.selected===!0},empty:function(_){for(_=_.firstChild;_;_=_.nextSibling)if(_.nodeType<6)return!1;return!0},parent:function(_){return!g.pseudos.empty(_)},header:function(_){return Ii.test(_.nodeName)},input:function(_){return mi.test(_.nodeName)},button:function(_){return Y(_,"input")&&_.type==="button"||Y(_,"button")},text:function(_){var Z;return Y(_,"input")&&_.type==="text"&&((Z=_.getAttribute("type"))==null||Z.toLowerCase()==="text")},first:Hi(function(){return[0]}),last:Hi(function(_,Z){return[Z-1]}),eq:Hi(function(_,Z,tt){return[tt<0?tt+Z:tt]}),even:Hi(function(_,Z){for(var tt=0;tt<Z;tt+=2)_.push(tt);return _}),odd:Hi(function(_,Z){for(var tt=1;tt<Z;tt+=2)_.push(tt);return _}),lt:Hi(function(_,Z,tt){var nt;for(tt<0?nt=tt+Z:tt>Z?nt=Z:nt=tt;--nt>=0;)_.push(nt);return _}),gt:Hi(function(_,Z,tt){for(var nt=tt<0?tt+Z:tt;++nt<Z;)_.push(nt);return _})}},g.pseudos.nth=g.pseudos.eq;for(d in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})g.pseudos[d]=_D(d);for(d in{submit:!0,reset:!0})g.pseudos[d]=UD(d);function Ml(){}Ml.prototype=g.filters=g.pseudos,g.setFilters=new Ml;function Xr(_,Z){var tt,nt,ut,mt,pt,Nt,Ft,qt=le[_+" "];if(qt)return Z?0:qt.slice(0);for(pt=_,Nt=[],Ft=g.preFilter;pt;){(!tt||(nt=Re.exec(pt)))&&(nt&&(pt=pt.slice(nt[0].length)||pt),Nt.push(ut=[])),tt=!1,(nt=Yr.exec(pt))&&(tt=nt.shift(),ut.push({value:tt,type:nt[0].replace(dt," ")}),pt=pt.slice(tt.length));for(mt in g.filter)(nt=ii[mt].exec(pt))&&(!Ft[mt]||(nt=Ft[mt](nt)))&&(tt=nt.shift(),ut.push({value:tt,type:mt,matches:nt}),pt=pt.slice(tt.length));if(!tt)break}return Z?pt.length:pt?ge.error(_):le(_,Nt).slice(0)}function xn(_){for(var Z=0,tt=_.length,nt="";Z<tt;Z++)nt+=_[Z].value;return nt}function Ln(_,Z,tt){var nt=Z.dir,ut=Z.next,mt=ut||nt,pt=tt&&mt==="parentNode",Nt=Tt++;return Z.first?function(Ft,qt,Vt){for(;Ft=Ft[nt];)if(Ft.nodeType===1||pt)return _(Ft,qt,Vt);return!1}:function(Ft,qt,Vt){var Xt,jt,Bt=[at,Nt];if(Vt){for(;Ft=Ft[nt];)if((Ft.nodeType===1||pt)&&_(Ft,qt,Vt))return!0}else for(;Ft=Ft[nt];)if(Ft.nodeType===1||pt)if(jt=Ft[ft]||(Ft[ft]={}),ut&&Y(Ft,ut))Ft=Ft[nt]||Ft;else{if((Xt=jt[mt])&&Xt[0]===at&&Xt[1]===Nt)return Bt[2]=Xt[2];if(jt[mt]=Bt,Bt[2]=_(Ft,qt,Vt))return!0}return!1}}function ks(_){return _.length>1?function(Z,tt,nt){for(var ut=_.length;ut--;)if(!_[ut](Z,tt,nt))return!1;return!0}:_[0]}function KD(_,Z,tt){for(var nt=0,ut=Z.length;nt<ut;nt++)ge(_,Z[nt],tt);return tt}function Mn(_,Z,tt,nt,ut){for(var mt,pt=[],Nt=0,Ft=_.length,qt=Z!=null;Nt<Ft;Nt++)(mt=_[Nt])&&(!tt||tt(mt,nt,ut))&&(pt.push(mt),qt&&Z.push(Nt));return pt}function Xs(_,Z,tt,nt,ut,mt){return nt&&!nt[ft]&&(nt=Xs(nt)),ut&&!ut[ft]&&(ut=Xs(ut,mt)),_a(function(pt,Nt,Ft,qt){var Vt,Xt,jt,Bt,Le=[],ca=[],je=Nt.length,Ra=pt||KD(Z||"*",Ft.nodeType?[Ft]:Ft,[]),ri=_&&(pt||!Z)?Mn(Ra,Le,_,Ft,qt):Ra;if(tt?(Bt=ut||(pt?_:je||nt)?[]:Nt,tt(ri,Bt,Ft,qt)):Bt=ri,nt)for(Vt=Mn(Bt,ca),nt(Vt,[],Ft,qt),Xt=Vt.length;Xt--;)(jt=Vt[Xt])&&(Bt[ca[Xt]]=!(ri[ca[Xt]]=jt));if(pt){if(ut||_){if(ut){for(Vt=[],Xt=Bt.length;Xt--;)(jt=Bt[Xt])&&Vt.push(ri[Xt]=jt);ut(null,Bt=[],Vt,qt)}for(Xt=Bt.length;Xt--;)(jt=Bt[Xt])&&(Vt=ut?l.call(pt,jt):Le[Xt])>-1&&(pt[Vt]=!(Nt[Vt]=jt))}}else Bt=Mn(Bt===Nt?Bt.splice(je,Bt.length):Bt),ut?ut(null,Nt,Bt,qt):w.apply(Nt,Bt)})}function Ws(_){for(var Z,tt,nt,ut=_.length,mt=g.relative[_[0].type],pt=mt||g.relative[" "],Nt=mt?1:0,Ft=Ln(function(Xt){return Xt===Z},pt,!0),qt=Ln(function(Xt){return l.call(Z,Xt)>-1},pt,!0),Vt=[function(Xt,jt,Bt){var Le=!mt&&(Bt||jt!=A)||((Z=jt).nodeType?Ft(Xt,jt,Bt):qt(Xt,jt,Bt));return Z=null,Le}];Nt<ut;Nt++)if(tt=g.relative[_[Nt].type])Vt=[Ln(ks(Vt),tt)];else{if(tt=g.filter[_[Nt].type].apply(null,_[Nt].matches),tt[ft]){for(nt=++Nt;nt<ut&&!g.relative[_[nt].type];nt++);return Xs(Nt>1&&ks(Vt),Nt>1&&xn(_.slice(0,Nt-1).concat({value:_[Nt-2].type===" "?"*":""})).replace(dt,"$1"),tt,Nt<nt&&Ws(_.slice(Nt,nt)),nt<ut&&Ws(_=_.slice(nt)),nt<ut&&xn(_))}Vt.push(tt)}return ks(Vt)}function JD(_,Z){var tt=Z.length>0,nt=_.length>0,ut=function(mt,pt,Nt,Ft,qt){var Vt,Xt,jt,Bt=0,Le="0",ca=mt&&[],je=[],Ra=A,ri=mt||nt&&g.find.TAG("*",qt),lr=at+=Ra==null?1:Math.random()||.1,la=ri.length;for(qt&&(A=pt==H||pt||qt);Le!==la&&(Vt=ri[Le])!=null;Le++){if(nt&&Vt){for(Xt=0,!pt&&Vt.ownerDocument!=H&&(gi(Vt),Nt=!U);jt=_[Xt++];)if(jt(Vt,pt||H,Nt)){w.call(Ft,Vt);break}qt&&(at=lr)}tt&&((Vt=!jt&&Vt)&&Bt--,mt&&ca.push(Vt))}if(Bt+=Le,tt&&Le!==Bt){for(Xt=0;jt=Z[Xt++];)jt(ca,je,pt,Nt);if(mt){if(Bt>0)for(;Le--;)ca[Le]||je[Le]||(je[Le]=Q.call(Ft));je=Mn(je)}w.apply(Ft,je),qt&&!mt&&je.length>0&&Bt+Z.length>1&&p.uniqueSort(Ft)}return qt&&(at=lr,A=Ra),ca};return tt?_a(ut):ut}function _s(_,Z){var tt,nt=[],ut=[],mt=Jt[_+" "];if(!mt){for(Z||(Z=Xr(_)),tt=Z.length;tt--;)mt=Ws(Z[tt]),mt[ft]?nt.push(mt):ut.push(mt);mt=Jt(_,JD(ut,nt)),mt.selector=_}return mt}function Al(_,Z,tt,nt){var ut,mt,pt,Nt,Ft,qt=typeof _=="function"&&_,Vt=!nt&&Xr(_=qt.selector||_);if(tt=tt||[],Vt.length===1){if(mt=Vt[0]=Vt[0].slice(0),mt.length>2&&(pt=mt[0]).type==="ID"&&Z.nodeType===9&&U&&g.relative[mt[1].type]){if(Z=(g.find.ID(pt.matches[0].replace(li,ui),Z)||[])[0],Z)qt&&(Z=Z.parentNode);else return tt;_=_.slice(mt.shift().value.length)}for(ut=ii.needsContext.test(_)?0:mt.length;ut--&&(pt=mt[ut],!g.relative[Nt=pt.type]);)if((Ft=g.find[Nt])&&(nt=Ft(pt.matches[0].replace(li,ui),Hs.test(mt[0].type)&&Ys(Z.parentNode)||Z))){if(mt.splice(ut,1),_=nt.length&&xn(mt),!_)return w.apply(tt,nt),tt;break}}return(qt||_s(_,Vt))(nt,Z,!U,tt,!Z||Hs.test(_)&&Ys(Z.parentNode)||Z),tt}S.sortStable=ft.split("").sort(Ve).join("")===ft,gi(),S.sortDetached=hr(function(_){return _.compareDocumentPosition(H.createElement("fieldset"))&1}),p.find=ge,p.expr[":"]=p.expr.pseudos,p.unique=p.uniqueSort,ge.compile=_s,ge.select=Al,ge.setDocument=gi,ge.tokenize=Xr,ge.escape=p.escapeSelector,ge.getText=p.text,ge.isXML=p.isXMLDoc,ge.selectors=p.expr,ge.support=p.support,ge.uniqueSort=p.uniqueSort})();var Ne=function(d,g,A){for(var N=[],P=A!==void 0;(d=d[g])&&d.nodeType!==9;)if(d.nodeType===1){if(P&&p(d).is(A))break;N.push(d)}return N},Kt=function(d,g){for(var A=[];d;d=d.nextSibling)d.nodeType===1&&d!==g&&A.push(d);return A},Oe=p.expr.match.needsContext,Ce=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function na(d,g,A){return T(g)?p.grep(d,function(N,P){return!!g.call(N,P,N)!==A}):g.nodeType?p.grep(d,function(N){return N===g!==A}):typeof g!="string"?p.grep(d,function(N){return l.call(g,N)>-1!==A}):p.filter(g,d,A)}p.filter=function(d,g,A){var N=g[0];return A&&(d=":not("+d+")"),g.length===1&&N.nodeType===1?p.find.matchesSelector(N,d)?[N]:[]:p.find.matches(d,p.grep(g,function(P){return P.nodeType===1}))},p.fn.extend({find:function(d){var g,A,N=this.length,P=this;if(typeof d!="string")return this.pushStack(p(d).filter(function(){for(g=0;g<N;g++)if(p.contains(P[g],this))return!0}));for(A=this.pushStack([]),g=0;g<N;g++)p.find(d,P[g],A);return N>1?p.uniqueSort(A):A},filter:function(d){return this.pushStack(na(this,d||[],!1))},not:function(d){return this.pushStack(na(this,d||[],!0))},is:function(d){return!!na(this,typeof d=="string"&&Oe.test(d)?p(d):d||[],!1).length}});var sa,pa=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Fa=p.fn.init=function(d,g,A){var N,P;if(!d)return this;if(A=A||sa,typeof d=="string")if(d[0]==="<"&&d[d.length-1]===">"&&d.length>=3?N=[null,d,null]:N=pa.exec(d),N&&(N[1]||!g))if(N[1]){if(g=g instanceof p?g[0]:g,p.merge(this,p.parseHTML(N[1],g&&g.nodeType?g.ownerDocument||g:F,!0)),Ce.test(N[1])&&p.isPlainObject(g))for(N in g)T(this[N])?this[N](g[N]):this.attr(N,g[N]);return this}else return P=F.getElementById(N[2]),P&&(this[0]=P,this.length=1),this;else return!g||g.jquery?(g||A).find(d):this.constructor(g).find(d);else{if(d.nodeType)return this[0]=d,this.length=1,this;if(T(d))return A.ready!==void 0?A.ready(d):d(p)}return p.makeArray(d,this)};Fa.prototype=p.fn,sa=p(F);var St=/^(?:parents|prev(?:Until|All))/,Mt={children:!0,contents:!0,next:!0,prev:!0};p.fn.extend({has:function(d){var g=p(d,this),A=g.length;return this.filter(function(){for(var N=0;N<A;N++)if(p.contains(this,g[N]))return!0})},closest:function(d,g){var A,N=0,P=this.length,w=[],H=typeof d!="string"&&p(d);if(!Oe.test(d)){for(;N<P;N++)for(A=this[N];A&&A!==g;A=A.parentNode)if(A.nodeType<11&&(H?H.index(A)>-1:A.nodeType===1&&p.find.matchesSelector(A,d))){w.push(A);break}}return this.pushStack(w.length>1?p.uniqueSort(w):w)},index:function(d){return d?typeof d=="string"?l.call(p(d),this[0]):l.call(this,d.jquery?d[0]:d):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(d,g){return this.pushStack(p.uniqueSort(p.merge(this.get(),p(d,g))))},addBack:function(d){return this.add(d==null?this.prevObject:this.prevObject.filter(d))}});function Pt(d,g){for(;(d=d[g])&&d.nodeType!==1;);return d}p.each({parent:function(d){var g=d.parentNode;return g&&g.nodeType!==11?g:null},parents:function(d){return Ne(d,"parentNode")},parentsUntil:function(d,g,A){return Ne(d,"parentNode",A)},next:function(d){return Pt(d,"nextSibling")},prev:function(d){return Pt(d,"previousSibling")},nextAll:function(d){return Ne(d,"nextSibling")},prevAll:function(d){return Ne(d,"previousSibling")},nextUntil:function(d,g,A){return Ne(d,"nextSibling",A)},prevUntil:function(d,g,A){return Ne(d,"previousSibling",A)},siblings:function(d){return Kt((d.parentNode||{}).firstChild,d)},children:function(d){return Kt(d.firstChild)},contents:function(d){return d.contentDocument!=null&&a(d.contentDocument)?d.contentDocument:(Y(d,"template")&&(d=d.content||d),p.merge([],d.childNodes))}},function(d,g){p.fn[d]=function(A,N){var P=p.map(this,g,A);return d.slice(-5)!=="Until"&&(N=A),N&&typeof N=="string"&&(P=p.filter(N,P)),this.length>1&&(Mt[d]||p.uniqueSort(P),St.test(d)&&P.reverse()),this.pushStack(P)}});var Et=/[^\x20\t\r\n\f]+/g;function ee(d){var g={};return p.each(d.match(Et)||[],function(A,N){g[N]=!0}),g}p.Callbacks=function(d){d=typeof d=="string"?ee(d):p.extend({},d);var g,A,N,P,w=[],H=[],z=-1,U=function(){for(P=P||d.once,N=g=!0;H.length;z=-1)for(A=H.shift();++z<w.length;)w[z].apply(A[0],A[1])===!1&&d.stopOnFalse&&(z=w.length,A=!1);d.memory||(A=!1),g=!1,P&&(A?w=[]:w="")},$={add:function(){return w&&(A&&!g&&(z=w.length-1,H.push(A)),function st(ft){p.each(ft,function(at,Tt){T(Tt)?(!d.unique||!$.has(Tt))&&w.push(Tt):Tt&&Tt.length&&O(Tt)!=="string"&&st(Tt)})}(arguments),A&&!g&&U()),this},remove:function(){return p.each(arguments,function(st,ft){for(var at;(at=p.inArray(ft,w,at))>-1;)w.splice(at,1),at<=z&&z--}),this},has:function(st){return st?p.inArray(st,w)>-1:w.length>0},empty:function(){return w&&(w=[]),this},disable:function(){return P=H=[],w=A="",this},disabled:function(){return!w},lock:function(){return P=H=[],!A&&!g&&(w=A=""),this},locked:function(){return!!P},fireWith:function(st,ft){return P||(ft=ft||[],ft=[st,ft.slice?ft.slice():ft],H.push(ft),g||U()),this},fire:function(){return $.fireWith(this,arguments),this},fired:function(){return!!N}};return $};function Fe(d){return d}function De(d){throw d}function Da(d,g,A,N){var P;try{d&&T(P=d.promise)?P.call(d).done(g).fail(A):d&&T(P=d.then)?P.call(d,g,A):g.apply(void 0,[d].slice(N))}catch(w){A.apply(void 0,[w])}}p.extend({Deferred:function(d){var g=[["notify","progress",p.Callbacks("memory"),p.Callbacks("memory"),2],["resolve","done",p.Callbacks("once memory"),p.Callbacks("once memory"),0,"resolved"],["reject","fail",p.Callbacks("once memory"),p.Callbacks("once memory"),1,"rejected"]],A="pending",N={state:function(){return A},always:function(){return P.done(arguments).fail(arguments),this},catch:function(w){return N.then(null,w)},pipe:function(){var w=arguments;return p.Deferred(function(H){p.each(g,function(z,U){var $=T(w[U[4]])&&w[U[4]];P[U[1]](function(){var st=$&&$.apply(this,arguments);st&&T(st.promise)?st.promise().progress(H.notify).done(H.resolve).fail(H.reject):H[U[0]+"With"](this,$?[st]:arguments)})}),w=null}).promise()},then:function(w,H,z){var U=0;function $(st,ft,at,Tt){return function(){var Yt=this,le=arguments,Jt=function(){var Ve,ti;if(!(st<U)){if(Ve=at.apply(Yt,le),Ve===ft.promise())throw new TypeError("Thenable self-resolution");ti=Ve&&(typeof Ve=="object"||typeof Ve=="function")&&Ve.then,T(ti)?Tt?ti.call(Ve,$(U,ft,Fe,Tt),$(U,ft,De,Tt)):(U++,ti.call(Ve,$(U,ft,Fe,Tt),$(U,ft,De,Tt),$(U,ft,Fe,ft.notifyWith))):(at!==Fe&&(Yt=void 0,le=[Ve]),(Tt||ft.resolveWith)(Yt,le))}},Ue=Tt?Jt:function(){try{Jt()}catch(Ve){p.Deferred.exceptionHook&&p.Deferred.exceptionHook(Ve,Ue.error),st+1>=U&&(at!==De&&(Yt=void 0,le=[Ve]),ft.rejectWith(Yt,le))}};st?Ue():(p.Deferred.getErrorHook?Ue.error=p.Deferred.getErrorHook():p.Deferred.getStackHook&&(Ue.error=p.Deferred.getStackHook()),n.setTimeout(Ue))}}return p.Deferred(function(st){g[0][3].add($(0,st,T(z)?z:Fe,st.notifyWith)),g[1][3].add($(0,st,T(w)?w:Fe)),g[2][3].add($(0,st,T(H)?H:De))}).promise()},promise:function(w){return w!=null?p.extend(w,N):N}},P={};return p.each(g,function(w,H){var z=H[2],U=H[5];N[H[1]]=z.add,U&&z.add(function(){A=U},g[3-w][2].disable,g[3-w][3].disable,g[0][2].lock,g[0][3].lock),z.add(H[3].fire),P[H[0]]=function(){return P[H[0]+"With"](this===P?void 0:this,arguments),this},P[H[0]+"With"]=z.fireWith}),N.promise(P),d&&d.call(P,P),P},when:function(d){var g=arguments.length,A=g,N=Array(A),P=s.call(arguments),w=p.Deferred(),H=function(z){return function(U){N[z]=this,P[z]=arguments.length>1?s.call(arguments):U,--g||w.resolveWith(N,P)}};if(g<=1&&(Da(d,w.done(H(A)).resolve,w.reject,!g),w.state()==="pending"||T(P[A]&&P[A].then)))return w.then();for(;A--;)Da(P[A],H(A),w.reject);return w.promise()}});var Va=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;p.Deferred.exceptionHook=function(d,g){n.console&&n.console.warn&&d&&Va.test(d.name)&&n.console.warn("jQuery.Deferred exception: "+d.message,d.stack,g)},p.readyException=function(d){n.setTimeout(function(){throw d})};var Ha=p.Deferred();p.fn.ready=function(d){return Ha.then(d).catch(function(g){p.readyException(g)}),this},p.extend({isReady:!1,readyWait:1,ready:function(d){(d===!0?--p.readyWait:p.isReady)||(p.isReady=!0,!(d!==!0&&--p.readyWait>0)&&Ha.resolveWith(F,[p]))}}),p.ready.then=Ha.then;function oa(){F.removeEventListener("DOMContentLoaded",oa),n.removeEventListener("load",oa),p.ready()}F.readyState==="complete"||F.readyState!=="loading"&&!F.documentElement.doScroll?n.setTimeout(p.ready):(F.addEventListener("DOMContentLoaded",oa),n.addEventListener("load",oa));var Gt=function(d,g,A,N,P,w,H){var z=0,U=d.length,$=A==null;if(O(A)==="object"){P=!0;for(z in A)Gt(d,g,z,A[z],!0,w,H)}else if(N!==void 0&&(P=!0,T(N)||(H=!0),$&&(H?(g.call(d,N),g=null):($=g,g=function(st,ft,at){return $.call(p(st),at)})),g))for(;z<U;z++)g(d[z],A,H?N:N.call(d[z],z,g(d[z],A)));return P?d:$?g.call(d):U?g(d[0],A):w},ji=/^-ms-/,ae=/-([a-z])/g;function Es(d,g){return g.toUpperCase()}function ha(d){return d.replace(ji,"ms-").replace(ae,Es)}var Oi=function(d){return d.nodeType===1||d.nodeType===9||!+d.nodeType};function Ri(){this.expando=p.expando+Ri.uid++}Ri.uid=1,Ri.prototype={cache:function(d){var g=d[this.expando];return g||(g={},Oi(d)&&(d.nodeType?d[this.expando]=g:Object.defineProperty(d,this.expando,{value:g,configurable:!0}))),g},set:function(d,g,A){var N,P=this.cache(d);if(typeof g=="string")P[ha(g)]=A;else for(N in g)P[ha(N)]=g[N];return P},get:function(d,g){return g===void 0?this.cache(d):d[this.expando]&&d[this.expando][ha(g)]},access:function(d,g,A){return g===void 0||g&&typeof g=="string"&&A===void 0?this.get(d,g):(this.set(d,g,A),A!==void 0?A:g)},remove:function(d,g){var A,N=d[this.expando];if(N!==void 0){if(g!==void 0)for(Array.isArray(g)?g=g.map(ha):(g=ha(g),g=g in N?[g]:g.match(Et)||[]),A=g.length;A--;)delete N[g[A]];(g===void 0||p.isEmptyObject(N))&&(d.nodeType?d[this.expando]=void 0:delete d[this.expando])}},hasData:function(d){var g=d[this.expando];return g!==void 0&&!p.isEmptyObject(g)}};var At=new Ri,$e=new Ri,tr=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,wr=/[A-Z]/g;function er(d){return d==="true"?!0:d==="false"?!1:d==="null"?null:d===+d+""?+d:tr.test(d)?JSON.parse(d):d}function ar(d,g,A){var N;if(A===void 0&&d.nodeType===1)if(N="data-"+g.replace(wr,"-$&").toLowerCase(),A=d.getAttribute(N),typeof A=="string"){try{A=er(A)}catch{}$e.set(d,g,A)}else A=void 0;return A}p.extend({hasData:function(d){return $e.hasData(d)||At.hasData(d)},data:function(d,g,A){return $e.access(d,g,A)},removeData:function(d,g){$e.remove(d,g)},_data:function(d,g,A){return At.access(d,g,A)},_removeData:function(d,g){At.remove(d,g)}}),p.fn.extend({data:function(d,g){var A,N,P,w=this[0],H=w&&w.attributes;if(d===void 0){if(this.length&&(P=$e.get(w),w.nodeType===1&&!At.get(w,"hasDataAttrs"))){for(A=H.length;A--;)H[A]&&(N=H[A].name,N.indexOf("data-")===0&&(N=ha(N.slice(5)),ar(w,N,P[N])));At.set(w,"hasDataAttrs",!0)}return P}return typeof d=="object"?this.each(function(){$e.set(this,d)}):Gt(this,function(z){var U;if(w&&z===void 0)return U=$e.get(w,d),U!==void 0||(U=ar(w,d),U!==void 0)?U:void 0;this.each(function(){$e.set(this,d,z)})},null,g,arguments.length>1,null,!0)},removeData:function(d){return this.each(function(){$e.remove(this,d)})}}),p.extend({queue:function(d,g,A){var N;if(d)return g=(g||"fx")+"queue",N=At.get(d,g),A&&(!N||Array.isArray(A)?N=At.access(d,g,p.makeArray(A)):N.push(A)),N||[]},dequeue:function(d,g){g=g||"fx";var A=p.queue(d,g),N=A.length,P=A.shift(),w=p._queueHooks(d,g),H=function(){p.dequeue(d,g)};P==="inprogress"&&(P=A.shift(),N--),P&&(g==="fx"&&A.unshift("inprogress"),delete w.stop,P.call(d,H,w)),!N&&w&&w.empty.fire()},_queueHooks:function(d,g){var A=g+"queueHooks";return At.get(d,A)||At.access(d,A,{empty:p.Callbacks("once memory").add(function(){At.remove(d,[g+"queue",A])})})}}),p.fn.extend({queue:function(d,g){var A=2;return typeof d!="string"&&(g=d,d="fx",A--),arguments.length<A?p.queue(this[0],d):g===void 0?this:this.each(function(){var N=p.queue(this,d,g);p._queueHooks(this,d),d==="fx"&&N[0]!=="inprogress"&&p.dequeue(this,d)})},dequeue:function(d){return this.each(function(){p.dequeue(this,d)})},clearQueue:function(d){return this.queue(d||"fx",[])},promise:function(d,g){var A,N=1,P=p.Deferred(),w=this,H=this.length,z=function(){--N||P.resolveWith(w,[w])};for(typeof d!="string"&&(g=d,d=void 0),d=d||"fx";H--;)A=At.get(w[H],d+"queueHooks"),A&&A.empty&&(N++,A.empty.add(z));return z(),P.promise(g)}});var yi=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,hi=new RegExp("^(?:([+-])=|)("+yi+")([a-z%]*)$","i"),Ya=["Top","Right","Bottom","Left"],ka=F.documentElement,Ti=function(d){return p.contains(d.ownerDocument,d)},Br={composed:!0};ka.getRootNode&&(Ti=function(d){return p.contains(d.ownerDocument,d)||d.getRootNode(Br)===d.ownerDocument});var ir=function(d,g){return d=g||d,d.style.display==="none"||d.style.display===""&&Ti(d)&&p.css(d,"display")==="none"};function Pi(d,g,A,N){var P,w,H=20,z=N?function(){return N.cur()}:function(){return p.css(d,g,"")},U=z(),$=A&&A[3]||(p.cssNumber[g]?"":"px"),st=d.nodeType&&(p.cssNumber[g]||$!=="px"&&+U)&&hi.exec(p.css(d,g));if(st&&st[3]!==$){for(U=U/2,$=$||st[3],st=+U||1;H--;)p.style(d,g,st+$),(1-w)*(1-(w=z()/U||.5))<=0&&(H=0),st=st/w;st=st*2,p.style(d,g,st+$),A=A||[]}return A&&(st=+st||+U||0,P=A[1]?st+(A[1]+1)*A[2]:+A[2],N&&(N.unit=$,N.start=st,N.end=P)),P}var mn={};function wi(d){var g,A=d.ownerDocument,N=d.nodeName,P=mn[N];return P||(g=A.body.appendChild(A.createElement(N)),P=p.css(g,"display"),g.parentNode.removeChild(g),P==="none"&&(P="block"),mn[N]=P,P)}function di(d,g){for(var A,N,P=[],w=0,H=d.length;w<H;w++)N=d[w],N.style&&(A=N.style.display,g?(A==="none"&&(P[w]=At.get(N,"display")||null,P[w]||(N.style.display="")),N.style.display===""&&ir(N)&&(P[w]=wi(N))):A!=="none"&&(P[w]="none",At.set(N,"display",A)));for(w=0;w<H;w++)P[w]!=null&&(d[w].style.display=P[w]);return d}p.fn.extend({show:function(){return di(this,!0)},hide:function(){return di(this)},toggle:function(d){return typeof d=="boolean"?d?this.show():this.hide():this.each(function(){ir(this)?p(this).show():p(this).hide()})}});var Xa=/^(?:checkbox|radio)$/i,Bi=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Na=/^$|^module$|\/(?:java|ecma)script/i;(function(){var d=F.createDocumentFragment(),g=d.appendChild(F.createElement("div")),A=F.createElement("input");A.setAttribute("type","radio"),A.setAttribute("checked","checked"),A.setAttribute("name","t"),g.appendChild(A),S.checkClone=g.cloneNode(!0).cloneNode(!0).lastChild.checked,g.innerHTML="<textarea>x</textarea>",S.noCloneChecked=!!g.cloneNode(!0).lastChild.defaultValue,g.innerHTML="<option></option>",S.option=!!g.lastChild})();var xe={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};xe.tbody=xe.tfoot=xe.colgroup=xe.caption=xe.thead,xe.th=xe.td,S.option||(xe.optgroup=xe.option=[1,"<select multiple='multiple'>","</select>"]);function qe(d,g){var A;return typeof d.getElementsByTagName<"u"?A=d.getElementsByTagName(g||"*"):typeof d.querySelectorAll<"u"?A=d.querySelectorAll(g||"*"):A=[],g===void 0||g&&Y(d,g)?p.merge([d],A):A}function Ea(d,g){for(var A=0,N=d.length;A<N;A++)At.set(d[A],"globalEval",!g||At.get(g[A],"globalEval"))}var oD=/<|&#?\w+;/;function el(d,g,A,N,P){for(var w,H,z,U,$,st,ft=g.createDocumentFragment(),at=[],Tt=0,Yt=d.length;Tt<Yt;Tt++)if(w=d[Tt],w||w===0)if(O(w)==="object")p.merge(at,w.nodeType?[w]:w);else if(!oD.test(w))at.push(g.createTextNode(w));else{for(H=H||ft.appendChild(g.createElement("div")),z=(Bi.exec(w)||["",""])[1].toLowerCase(),U=xe[z]||xe._default,H.innerHTML=U[1]+p.htmlPrefilter(w)+U[2],st=U[0];st--;)H=H.lastChild;p.merge(at,H.childNodes),H=ft.firstChild,H.textContent=""}for(ft.textContent="",Tt=0;w=at[Tt++];){if(N&&p.inArray(w,N)>-1){P&&P.push(w);continue}if($=Ti(w),H=qe(ft.appendChild(w),"script"),$&&Ea(H),A)for(st=0;w=H[st++];)Na.test(w.type||"")&&A.push(w)}return ft}var al=/^([^.]*)(?:\.(.+)|)/;function rr(){return!0}function nr(){return!1}function xs(d,g,A,N,P,w){var H,z;if(typeof g=="object"){typeof A!="string"&&(N=N||A,A=void 0);for(z in g)xs(d,z,A,N,g[z],w);return d}if(N==null&&P==null?(P=A,N=A=void 0):P==null&&(typeof A=="string"?(P=N,N=void 0):(P=N,N=A,A=void 0)),P===!1)P=nr;else if(!P)return d;return w===1&&(H=P,P=function(U){return p().off(U),H.apply(this,arguments)},P.guid=H.guid||(H.guid=p.guid++)),d.each(function(){p.event.add(this,g,P,N,A)})}p.event={global:{},add:function(d,g,A,N,P){var w,H,z,U,$,st,ft,at,Tt,Yt,le,Jt=At.get(d);if(Oi(d))for(A.handler&&(w=A,A=w.handler,P=w.selector),P&&p.find.matchesSelector(ka,P),A.guid||(A.guid=p.guid++),(U=Jt.events)||(U=Jt.events=Object.create(null)),(H=Jt.handle)||(H=Jt.handle=function(Ue){return typeof p<"u"&&p.event.triggered!==Ue.type?p.event.dispatch.apply(d,arguments):void 0}),g=(g||"").match(Et)||[""],$=g.length;$--;)z=al.exec(g[$])||[],Tt=le=z[1],Yt=(z[2]||"").split(".").sort(),Tt&&(ft=p.event.special[Tt]||{},Tt=(P?ft.delegateType:ft.bindType)||Tt,ft=p.event.special[Tt]||{},st=p.extend({type:Tt,origType:le,data:N,handler:A,guid:A.guid,selector:P,needsContext:P&&p.expr.match.needsContext.test(P),namespace:Yt.join(".")},w),(at=U[Tt])||(at=U[Tt]=[],at.delegateCount=0,(!ft.setup||ft.setup.call(d,N,Yt,H)===!1)&&d.addEventListener&&d.addEventListener(Tt,H)),ft.add&&(ft.add.call(d,st),st.handler.guid||(st.handler.guid=A.guid)),P?at.splice(at.delegateCount++,0,st):at.push(st),p.event.global[Tt]=!0)},remove:function(d,g,A,N,P){var w,H,z,U,$,st,ft,at,Tt,Yt,le,Jt=At.hasData(d)&&At.get(d);if(!(!Jt||!(U=Jt.events))){for(g=(g||"").match(Et)||[""],$=g.length;$--;){if(z=al.exec(g[$])||[],Tt=le=z[1],Yt=(z[2]||"").split(".").sort(),!Tt){for(Tt in U)p.event.remove(d,Tt+g[$],A,N,!0);continue}for(ft=p.event.special[Tt]||{},Tt=(N?ft.delegateType:ft.bindType)||Tt,at=U[Tt]||[],z=z[2]&&new RegExp("(^|\\.)"+Yt.join("\\.(?:.*\\.|)")+"(\\.|$)"),H=w=at.length;w--;)st=at[w],(P||le===st.origType)&&(!A||A.guid===st.guid)&&(!z||z.test(st.namespace))&&(!N||N===st.selector||N==="**"&&st.selector)&&(at.splice(w,1),st.selector&&at.delegateCount--,ft.remove&&ft.remove.call(d,st));H&&!at.length&&((!ft.teardown||ft.teardown.call(d,Yt,Jt.handle)===!1)&&p.removeEvent(d,Tt,Jt.handle),delete U[Tt])}p.isEmptyObject(U)&&At.remove(d,"handle events")}},dispatch:function(d){var g,A,N,P,w,H,z=new Array(arguments.length),U=p.event.fix(d),$=(At.get(this,"events")||Object.create(null))[U.type]||[],st=p.event.special[U.type]||{};for(z[0]=U,g=1;g<arguments.length;g++)z[g]=arguments[g];if(U.delegateTarget=this,!(st.preDispatch&&st.preDispatch.call(this,U)===!1)){for(H=p.event.handlers.call(this,U,$),g=0;(P=H[g++])&&!U.isPropagationStopped();)for(U.currentTarget=P.elem,A=0;(w=P.handlers[A++])&&!U.isImmediatePropagationStopped();)(!U.rnamespace||w.namespace===!1||U.rnamespace.test(w.namespace))&&(U.handleObj=w,U.data=w.data,N=((p.event.special[w.origType]||{}).handle||w.handler).apply(P.elem,z),N!==void 0&&(U.result=N)===!1&&(U.preventDefault(),U.stopPropagation()));return st.postDispatch&&st.postDispatch.call(this,U),U.result}},handlers:function(d,g){var A,N,P,w,H,z=[],U=g.delegateCount,$=d.target;if(U&&$.nodeType&&!(d.type==="click"&&d.button>=1)){for(;$!==this;$=$.parentNode||this)if($.nodeType===1&&!(d.type==="click"&&$.disabled===!0)){for(w=[],H={},A=0;A<U;A++)N=g[A],P=N.selector+" ",H[P]===void 0&&(H[P]=N.needsContext?p(P,this).index($)>-1:p.find(P,this,null,[$]).length),H[P]&&w.push(N);w.length&&z.push({elem:$,handlers:w})}}return $=this,U<g.length&&z.push({elem:$,handlers:g.slice(U)}),z},addProp:function(d,g){Object.defineProperty(p.Event.prototype,d,{enumerable:!0,configurable:!0,get:T(g)?function(){if(this.originalEvent)return g(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[d]},set:function(A){Object.defineProperty(this,d,{enumerable:!0,configurable:!0,writable:!0,value:A})}})},fix:function(d){return d[p.expando]?d:new p.Event(d)},special:{load:{noBubble:!0},click:{setup:function(d){var g=this||d;return Xa.test(g.type)&&g.click&&Y(g,"input")&&In(g,"click",!0),!1},trigger:function(d){var g=this||d;return Xa.test(g.type)&&g.click&&Y(g,"input")&&In(g,"click"),!0},_default:function(d){var g=d.target;return Xa.test(g.type)&&g.click&&Y(g,"input")&&At.get(g,"click")||Y(g,"a")}},beforeunload:{postDispatch:function(d){d.result!==void 0&&d.originalEvent&&(d.originalEvent.returnValue=d.result)}}}};function In(d,g,A){if(!A){At.get(d,g)===void 0&&p.event.add(d,g,rr);return}At.set(d,g,!1),p.event.add(d,g,{namespace:!1,handler:function(N){var P,w=At.get(this,g);if(N.isTrigger&1&&this[g]){if(w)(p.event.special[g]||{}).delegateType&&N.stopPropagation();else if(w=s.call(arguments),At.set(this,g,w),this[g](),P=At.get(this,g),At.set(this,g,!1),w!==P)return N.stopImmediatePropagation(),N.preventDefault(),P}else w&&(At.set(this,g,p.event.trigger(w[0],w.slice(1),this)),N.stopPropagation(),N.isImmediatePropagationStopped=rr)}})}p.removeEvent=function(d,g,A){d.removeEventListener&&d.removeEventListener(g,A)},p.Event=function(d,g){if(!(this instanceof p.Event))return new p.Event(d,g);d&&d.type?(this.originalEvent=d,this.type=d.type,this.isDefaultPrevented=d.defaultPrevented||d.defaultPrevented===void 0&&d.returnValue===!1?rr:nr,this.target=d.target&&d.target.nodeType===3?d.target.parentNode:d.target,this.currentTarget=d.currentTarget,this.relatedTarget=d.relatedTarget):this.type=d,g&&p.extend(this,g),this.timeStamp=d&&d.timeStamp||Date.now(),this[p.expando]=!0},p.Event.prototype={constructor:p.Event,isDefaultPrevented:nr,isPropagationStopped:nr,isImmediatePropagationStopped:nr,isSimulated:!1,preventDefault:function(){var d=this.originalEvent;this.isDefaultPrevented=rr,d&&!this.isSimulated&&d.preventDefault()},stopPropagation:function(){var d=this.originalEvent;this.isPropagationStopped=rr,d&&!this.isSimulated&&d.stopPropagation()},stopImmediatePropagation:function(){var d=this.originalEvent;this.isImmediatePropagationStopped=rr,d&&!this.isSimulated&&d.stopImmediatePropagation(),this.stopPropagation()}},p.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},p.event.addProp),p.each({focus:"focusin",blur:"focusout"},function(d,g){function A(N){if(F.documentMode){var P=At.get(this,"handle"),w=p.event.fix(N);w.type=N.type==="focusin"?"focus":"blur",w.isSimulated=!0,P(N),w.target===w.currentTarget&&P(w)}else p.event.simulate(g,N.target,p.event.fix(N))}p.event.special[d]={setup:function(){var N;if(In(this,d,!0),F.documentMode)N=At.get(this,g),N||this.addEventListener(g,A),At.set(this,g,(N||0)+1);else return!1},trigger:function(){return In(this,d),!0},teardown:function(){var N;if(F.documentMode)N=At.get(this,g)-1,N?At.set(this,g,N):(this.removeEventListener(g,A),At.remove(this,g));else return!1},_default:function(N){return At.get(N.target,d)},delegateType:g},p.event.special[g]={setup:function(){var N=this.ownerDocument||this.document||this,P=F.documentMode?this:N,w=At.get(P,g);w||(F.documentMode?this.addEventListener(g,A):N.addEventListener(d,A,!0)),At.set(P,g,(w||0)+1)},teardown:function(){var N=this.ownerDocument||this.document||this,P=F.documentMode?this:N,w=At.get(P,g)-1;w?At.set(P,g,w):(F.documentMode?this.removeEventListener(g,A):N.removeEventListener(d,A,!0),At.remove(P,g))}}}),p.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(d,g){p.event.special[d]={delegateType:g,bindType:g,handle:function(A){var N,P=this,w=A.relatedTarget,H=A.handleObj;return(!w||w!==P&&!p.contains(P,w))&&(A.type=H.origType,N=H.handler.apply(this,arguments),A.type=g),N}}}),p.fn.extend({on:function(d,g,A,N){return xs(this,d,g,A,N)},one:function(d,g,A,N){return xs(this,d,g,A,N,1)},off:function(d,g,A){var N,P;if(d&&d.preventDefault&&d.handleObj)return N=d.handleObj,p(d.delegateTarget).off(N.namespace?N.origType+"."+N.namespace:N.origType,N.selector,N.handler),this;if(typeof d=="object"){for(P in d)this.off(P,g,d[P]);return this}return(g===!1||typeof g=="function")&&(A=g,g=void 0),A===!1&&(A=nr),this.each(function(){p.event.remove(this,d,A,g)})}});var hD=/<script|<style|<link/i,lD=/checked\s*(?:[^=]|=\s*.checked.)/i,uD=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function il(d,g){return Y(d,"table")&&Y(g.nodeType!==11?g:g.firstChild,"tr")&&p(d).children("tbody")[0]||d}function fD(d){return d.type=(d.getAttribute("type")!==null)+"/"+d.type,d}function CD(d){return(d.type||"").slice(0,5)==="true/"?d.type=d.type.slice(5):d.removeAttribute("type"),d}function rl(d,g){var A,N,P,w,H,z,U;if(g.nodeType===1){if(At.hasData(d)&&(w=At.get(d),U=w.events,U)){At.remove(g,"handle events");for(P in U)for(A=0,N=U[P].length;A<N;A++)p.event.add(g,P,U[P][A])}$e.hasData(d)&&(H=$e.access(d),z=p.extend({},H),$e.set(g,z))}}function DD(d,g){var A=g.nodeName.toLowerCase();A==="input"&&Xa.test(d.type)?g.checked=d.checked:(A==="input"||A==="textarea")&&(g.defaultValue=d.defaultValue)}function sr(d,g,A,N){g=o(g);var P,w,H,z,U,$,st=0,ft=d.length,at=ft-1,Tt=g[0],Yt=T(Tt);if(Yt||ft>1&&typeof Tt=="string"&&!S.checkClone&&lD.test(Tt))return d.each(function(le){var Jt=d.eq(le);Yt&&(g[0]=Tt.call(this,le,Jt.html())),sr(Jt,g,A,N)});if(ft&&(P=el(g,d[0].ownerDocument,!1,d,N),w=P.firstChild,P.childNodes.length===1&&(P=w),w||N)){for(H=p.map(qe(P,"script"),fD),z=H.length;st<ft;st++)U=P,st!==at&&(U=p.clone(U,!0,!0),z&&p.merge(H,qe(U,"script"))),A.call(d[st],U,st);if(z)for($=H[H.length-1].ownerDocument,p.map(H,CD),st=0;st<z;st++)U=H[st],Na.test(U.type||"")&&!At.access(U,"globalEval")&&p.contains($,U)&&(U.src&&(U.type||"").toLowerCase()!=="module"?p._evalUrl&&!U.noModule&&p._evalUrl(U.src,{nonce:U.nonce||U.getAttribute("nonce")},$):M(U.textContent.replace(uD,""),U,$))}return d}function nl(d,g,A){for(var N,P=g?p.filter(g,d):d,w=0;(N=P[w])!=null;w++)!A&&N.nodeType===1&&p.cleanData(qe(N)),N.parentNode&&(A&&Ti(N)&&Ea(qe(N,"script")),N.parentNode.removeChild(N));return d}p.extend({htmlPrefilter:function(d){return d},clone:function(d,g,A){var N,P,w,H,z=d.cloneNode(!0),U=Ti(d);if(!S.noCloneChecked&&(d.nodeType===1||d.nodeType===11)&&!p.isXMLDoc(d))for(H=qe(z),w=qe(d),N=0,P=w.length;N<P;N++)DD(w[N],H[N]);if(g)if(A)for(w=w||qe(d),H=H||qe(z),N=0,P=w.length;N<P;N++)rl(w[N],H[N]);else rl(d,z);return H=qe(z,"script"),H.length>0&&Ea(H,!U&&qe(d,"script")),z},cleanData:function(d){for(var g,A,N,P=p.event.special,w=0;(A=d[w])!==void 0;w++)if(Oi(A)){if(g=A[At.expando]){if(g.events)for(N in g.events)P[N]?p.event.remove(A,N):p.removeEvent(A,N,g.handle);A[At.expando]=void 0}A[$e.expando]&&(A[$e.expando]=void 0)}}}),p.fn.extend({detach:function(d){return nl(this,d,!0)},remove:function(d){return nl(this,d)},text:function(d){return Gt(this,function(g){return g===void 0?p.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=g)})},null,d,arguments.length)},append:function(){return sr(this,arguments,function(d){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var g=il(this,d);g.appendChild(d)}})},prepend:function(){return sr(this,arguments,function(d){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var g=il(this,d);g.insertBefore(d,g.firstChild)}})},before:function(){return sr(this,arguments,function(d){this.parentNode&&this.parentNode.insertBefore(d,this)})},after:function(){return sr(this,arguments,function(d){this.parentNode&&this.parentNode.insertBefore(d,this.nextSibling)})},empty:function(){for(var d,g=0;(d=this[g])!=null;g++)d.nodeType===1&&(p.cleanData(qe(d,!1)),d.textContent="");return this},clone:function(d,g){return d=d??!1,g=g??d,this.map(function(){return p.clone(this,d,g)})},html:function(d){return Gt(this,function(g){var A=this[0]||{},N=0,P=this.length;if(g===void 0&&A.nodeType===1)return A.innerHTML;if(typeof g=="string"&&!hD.test(g)&&!xe[(Bi.exec(g)||["",""])[1].toLowerCase()]){g=p.htmlPrefilter(g);try{for(;N<P;N++)A=this[N]||{},A.nodeType===1&&(p.cleanData(qe(A,!1)),A.innerHTML=g);A=0}catch{}}A&&this.empty().append(g)},null,d,arguments.length)},replaceWith:function(){var d=[];return sr(this,arguments,function(g){var A=this.parentNode;p.inArray(this,d)<0&&(p.cleanData(qe(this)),A&&A.replaceChild(g,this))},d)}}),p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(d,g){p.fn[d]=function(A){for(var N,P=[],w=p(A),H=w.length-1,z=0;z<=H;z++)N=z===H?this:this.clone(!0),p(w[z])[g](N),h.apply(P,N.get());return this.pushStack(P)}});var Ls=new RegExp("^("+yi+")(?!px)[a-z%]+$","i"),Ms=/^--/,gn=function(d){var g=d.ownerDocument.defaultView;return(!g||!g.opener)&&(g=n),g.getComputedStyle(d)},sl=function(d,g,A){var N,P,w={};for(P in g)w[P]=d.style[P],d.style[P]=g[P];N=A.call(d);for(P in g)d.style[P]=w[P];return N},vD=new RegExp(Ya.join("|"),"i");(function(){function d(){if($){U.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",$.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ka.appendChild(U).appendChild($);var st=n.getComputedStyle($);A=st.top!=="1%",z=g(st.marginLeft)===12,$.style.right="60%",w=g(st.right)===36,N=g(st.width)===36,$.style.position="absolute",P=g($.offsetWidth/3)===12,ka.removeChild(U),$=null}}function g(st){return Math.round(parseFloat(st))}var A,N,P,w,H,z,U=F.createElement("div"),$=F.createElement("div");$.style&&($.style.backgroundClip="content-box",$.cloneNode(!0).style.backgroundClip="",S.clearCloneStyle=$.style.backgroundClip==="content-box",p.extend(S,{boxSizingReliable:function(){return d(),N},pixelBoxStyles:function(){return d(),w},pixelPosition:function(){return d(),A},reliableMarginLeft:function(){return d(),z},scrollboxSize:function(){return d(),P},reliableTrDimensions:function(){var st,ft,at,Tt;return H==null&&(st=F.createElement("table"),ft=F.createElement("tr"),at=F.createElement("div"),st.style.cssText="position:absolute;left:-11111px;border-collapse:separate",ft.style.cssText="box-sizing:content-box;border:1px solid",ft.style.height="1px",at.style.height="9px",at.style.display="block",ka.appendChild(st).appendChild(ft).appendChild(at),Tt=n.getComputedStyle(ft),H=parseInt(Tt.height,10)+parseInt(Tt.borderTopWidth,10)+parseInt(Tt.borderBottomWidth,10)===ft.offsetHeight,ka.removeChild(st)),H}}))})();function br(d,g,A){var N,P,w,H,z=Ms.test(g),U=d.style;return A=A||gn(d),A&&(H=A.getPropertyValue(g)||A[g],z&&H&&(H=H.replace(dt,"$1")||void 0),H===""&&!Ti(d)&&(H=p.style(d,g)),!S.pixelBoxStyles()&&Ls.test(H)&&vD.test(g)&&(N=U.width,P=U.minWidth,w=U.maxWidth,U.minWidth=U.maxWidth=U.width=H,H=A.width,U.width=N,U.minWidth=P,U.maxWidth=w)),H!==void 0?H+"":H}function ol(d,g){return{get:function(){if(d()){delete this.get;return}return(this.get=g).apply(this,arguments)}}}var hl=["Webkit","Moz","ms"],ll=F.createElement("div").style,ul={};function cD(d){for(var g=d[0].toUpperCase()+d.slice(1),A=hl.length;A--;)if(d=hl[A]+g,d in ll)return d}function As(d){var g=p.cssProps[d]||ul[d];return g||(d in ll?d:ul[d]=cD(d)||d)}var SD=/^(none|table(?!-c[ea]).+)/,TD={position:"absolute",visibility:"hidden",display:"block"},fl={letterSpacing:"0",fontWeight:"400"};function Cl(d,g,A){var N=hi.exec(g);return N?Math.max(0,N[2]-(A||0))+(N[3]||"px"):g}function Ns(d,g,A,N,P,w){var H=g==="width"?1:0,z=0,U=0,$=0;if(A===(N?"border":"content"))return 0;for(;H<4;H+=2)A==="margin"&&($+=p.css(d,A+Ya[H],!0,P)),N?(A==="content"&&(U-=p.css(d,"padding"+Ya[H],!0,P)),A!=="margin"&&(U-=p.css(d,"border"+Ya[H]+"Width",!0,P))):(U+=p.css(d,"padding"+Ya[H],!0,P),A!=="padding"?U+=p.css(d,"border"+Ya[H]+"Width",!0,P):z+=p.css(d,"border"+Ya[H]+"Width",!0,P));return!N&&w>=0&&(U+=Math.max(0,Math.ceil(d["offset"+g[0].toUpperCase()+g.slice(1)]-w-U-z-.5))||0),U+$}function Dl(d,g,A){var N=gn(d),P=!S.boxSizingReliable()||A,w=P&&p.css(d,"boxSizing",!1,N)==="border-box",H=w,z=br(d,g,N),U="offset"+g[0].toUpperCase()+g.slice(1);if(Ls.test(z)){if(!A)return z;z="auto"}return(!S.boxSizingReliable()&&w||!S.reliableTrDimensions()&&Y(d,"tr")||z==="auto"||!parseFloat(z)&&p.css(d,"display",!1,N)==="inline")&&d.getClientRects().length&&(w=p.css(d,"boxSizing",!1,N)==="border-box",H=U in d,H&&(z=d[U])),z=parseFloat(z)||0,z+Ns(d,g,A||(w?"border":"content"),H,N,z)+"px"}p.extend({cssHooks:{opacity:{get:function(d,g){if(g){var A=br(d,"opacity");return A===""?"1":A}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(d,g,A,N){if(!(!d||d.nodeType===3||d.nodeType===8||!d.style)){var P,w,H,z=ha(g),U=Ms.test(g),$=d.style;if(U||(g=As(z)),H=p.cssHooks[g]||p.cssHooks[z],A!==void 0){if(w=typeof A,w==="string"&&(P=hi.exec(A))&&P[1]&&(A=Pi(d,g,P),w="number"),A==null||A!==A)return;w==="number"&&!U&&(A+=P&&P[3]||(p.cssNumber[z]?"":"px")),!S.clearCloneStyle&&A===""&&g.indexOf("background")===0&&($[g]="inherit"),(!H||!("set"in H)||(A=H.set(d,A,N))!==void 0)&&(U?$.setProperty(g,A):$[g]=A)}else return H&&"get"in H&&(P=H.get(d,!1,N))!==void 0?P:$[g]}},css:function(d,g,A,N){var P,w,H,z=ha(g),U=Ms.test(g);return U||(g=As(z)),H=p.cssHooks[g]||p.cssHooks[z],H&&"get"in H&&(P=H.get(d,!0,A)),P===void 0&&(P=br(d,g,N)),P==="normal"&&g in fl&&(P=fl[g]),A===""||A?(w=parseFloat(P),A===!0||isFinite(w)?w||0:P):P}}),p.each(["height","width"],function(d,g){p.cssHooks[g]={get:function(A,N,P){if(N)return SD.test(p.css(A,"display"))&&(!A.getClientRects().length||!A.getBoundingClientRect().width)?sl(A,TD,function(){return Dl(A,g,P)}):Dl(A,g,P)},set:function(A,N,P){var w,H=gn(A),z=!S.scrollboxSize()&&H.position==="absolute",U=z||P,$=U&&p.css(A,"boxSizing",!1,H)==="border-box",st=P?Ns(A,g,P,$,H):0;return $&&z&&(st-=Math.ceil(A["offset"+g[0].toUpperCase()+g.slice(1)]-parseFloat(H[g])-Ns(A,g,"border",!1,H)-.5)),st&&(w=hi.exec(N))&&(w[3]||"px")!=="px"&&(A.style[g]=N,N=p.css(A,g)),Cl(A,N,st)}}}),p.cssHooks.marginLeft=ol(S.reliableMarginLeft,function(d,g){if(g)return(parseFloat(br(d,"marginLeft"))||d.getBoundingClientRect().left-sl(d,{marginLeft:0},function(){return d.getBoundingClientRect().left}))+"px"}),p.each({margin:"",padding:"",border:"Width"},function(d,g){p.cssHooks[d+g]={expand:function(A){for(var N=0,P={},w=typeof A=="string"?A.split(" "):[A];N<4;N++)P[d+Ya[N]+g]=w[N]||w[N-2]||w[0];return P}},d!=="margin"&&(p.cssHooks[d+g].set=Cl)}),p.fn.extend({css:function(d,g){return Gt(this,function(A,N,P){var w,H,z={},U=0;if(Array.isArray(N)){for(w=gn(A),H=N.length;U<H;U++)z[N[U]]=p.css(A,N[U],!1,w);return z}return P!==void 0?p.style(A,N,P):p.css(A,N)},d,g,arguments.length>1)}});function va(d,g,A,N,P){return new va.prototype.init(d,g,A,N,P)}p.Tween=va,va.prototype={constructor:va,init:function(d,g,A,N,P,w){this.elem=d,this.prop=A,this.easing=P||p.easing._default,this.options=g,this.start=this.now=this.cur(),this.end=N,this.unit=w||(p.cssNumber[A]?"":"px")},cur:function(){var d=va.propHooks[this.prop];return d&&d.get?d.get(this):va.propHooks._default.get(this)},run:function(d){var g,A=va.propHooks[this.prop];return this.options.duration?this.pos=g=p.easing[this.easing](d,this.options.duration*d,0,1,this.options.duration):this.pos=g=d,this.now=(this.end-this.start)*g+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),A&&A.set?A.set(this):va.propHooks._default.set(this),this}},va.prototype.init.prototype=va.prototype,va.propHooks={_default:{get:function(d){var g;return d.elem.nodeType!==1||d.elem[d.prop]!=null&&d.elem.style[d.prop]==null?d.elem[d.prop]:(g=p.css(d.elem,d.prop,""),!g||g==="auto"?0:g)},set:function(d){p.fx.step[d.prop]?p.fx.step[d.prop](d):d.elem.nodeType===1&&(p.cssHooks[d.prop]||d.elem.style[As(d.prop)]!=null)?p.style(d.elem,d.prop,d.now+d.unit):d.elem[d.prop]=d.now}}},va.propHooks.scrollTop=va.propHooks.scrollLeft={set:function(d){d.elem.nodeType&&d.elem.parentNode&&(d.elem[d.prop]=d.now)}},p.easing={linear:function(d){return d},swing:function(d){return .5-Math.cos(d*Math.PI)/2},_default:"swing"},p.fx=va.prototype.init,p.fx.step={};var or,pn,dD=/^(?:toggle|show|hide)$/,mD=/queueHooks$/;function Os(){pn&&(F.hidden===!1&&n.requestAnimationFrame?n.requestAnimationFrame(Os):n.setTimeout(Os,p.fx.interval),p.fx.tick())}function vl(){return n.setTimeout(function(){or=void 0}),or=Date.now()}function Fn(d,g){var A,N=0,P={height:d};for(g=g?1:0;N<4;N+=2-g)A=Ya[N],P["margin"+A]=P["padding"+A]=d;return g&&(P.opacity=P.width=d),P}function cl(d,g,A){for(var N,P=(Wa.tweeners[g]||[]).concat(Wa.tweeners["*"]),w=0,H=P.length;w<H;w++)if(N=P[w].call(A,g,d))return N}function ID(d,g,A){var N,P,w,H,z,U,$,st,ft="width"in g||"height"in g,at=this,Tt={},Yt=d.style,le=d.nodeType&&ir(d),Jt=At.get(d,"fxshow");A.queue||(H=p._queueHooks(d,"fx"),H.unqueued==null&&(H.unqueued=0,z=H.empty.fire,H.empty.fire=function(){H.unqueued||z()}),H.unqueued++,at.always(function(){at.always(function(){H.unqueued--,p.queue(d,"fx").length||H.empty.fire()})}));for(N in g)if(P=g[N],dD.test(P)){if(delete g[N],w=w||P==="toggle",P===(le?"hide":"show"))if(P==="show"&&Jt&&Jt[N]!==void 0)le=!0;else continue;Tt[N]=Jt&&Jt[N]||p.style(d,N)}if(U=!p.isEmptyObject(g),!(!U&&p.isEmptyObject(Tt))){ft&&d.nodeType===1&&(A.overflow=[Yt.overflow,Yt.overflowX,Yt.overflowY],$=Jt&&Jt.display,$==null&&($=At.get(d,"display")),st=p.css(d,"display"),st==="none"&&($?st=$:(di([d],!0),$=d.style.display||$,st=p.css(d,"display"),di([d]))),(st==="inline"||st==="inline-block"&&$!=null)&&p.css(d,"float")==="none"&&(U||(at.done(function(){Yt.display=$}),$==null&&(st=Yt.display,$=st==="none"?"":st)),Yt.display="inline-block")),A.overflow&&(Yt.overflow="hidden",at.always(function(){Yt.overflow=A.overflow[0],Yt.overflowX=A.overflow[1],Yt.overflowY=A.overflow[2]})),U=!1;for(N in Tt)U||(Jt?"hidden"in Jt&&(le=Jt.hidden):Jt=At.access(d,"fxshow",{display:$}),w&&(Jt.hidden=!le),le&&di([d],!0),at.done(function(){le||di([d]),At.remove(d,"fxshow");for(N in Tt)p.style(d,N,Tt[N])})),U=cl(le?Jt[N]:0,N,at),N in Jt||(Jt[N]=U.start,le&&(U.end=U.start,U.start=0))}}function gD(d,g){var A,N,P,w,H;for(A in d)if(N=ha(A),P=g[N],w=d[A],Array.isArray(w)&&(P=w[1],w=d[A]=w[0]),A!==N&&(d[N]=w,delete d[A]),H=p.cssHooks[N],H&&"expand"in H){w=H.expand(w),delete d[N];for(A in w)A in d||(d[A]=w[A],g[A]=P)}else g[N]=P}function Wa(d,g,A){var N,P,w=0,H=Wa.prefilters.length,z=p.Deferred().always(function(){delete U.elem}),U=function(){if(P)return!1;for(var ft=or||vl(),at=Math.max(0,$.startTime+$.duration-ft),Tt=at/$.duration||0,Yt=1-Tt,le=0,Jt=$.tweens.length;le<Jt;le++)$.tweens[le].run(Yt);return z.notifyWith(d,[$,Yt,at]),Yt<1&&Jt?at:(Jt||z.notifyWith(d,[$,1,0]),z.resolveWith(d,[$]),!1)},$=z.promise({elem:d,props:p.extend({},g),opts:p.extend(!0,{specialEasing:{},easing:p.easing._default},A),originalProperties:g,originalOptions:A,startTime:or||vl(),duration:A.duration,tweens:[],createTween:function(ft,at){var Tt=p.Tween(d,$.opts,ft,at,$.opts.specialEasing[ft]||$.opts.easing);return $.tweens.push(Tt),Tt},stop:function(ft){var at=0,Tt=ft?$.tweens.length:0;if(P)return this;for(P=!0;at<Tt;at++)$.tweens[at].run(1);return ft?(z.notifyWith(d,[$,1,0]),z.resolveWith(d,[$,ft])):z.rejectWith(d,[$,ft]),this}}),st=$.props;for(gD(st,$.opts.specialEasing);w<H;w++)if(N=Wa.prefilters[w].call($,d,st,$.opts),N)return T(N.stop)&&(p._queueHooks($.elem,$.opts.queue).stop=N.stop.bind(N)),N;return p.map(st,cl,$),T($.opts.start)&&$.opts.start.call(d,$),$.progress($.opts.progress).done($.opts.done,$.opts.complete).fail($.opts.fail).always($.opts.always),p.fx.timer(p.extend(U,{elem:d,anim:$,queue:$.opts.queue})),$}p.Animation=p.extend(Wa,{tweeners:{"*":[function(d,g){var A=this.createTween(d,g);return Pi(A.elem,d,hi.exec(g),A),A}]},tweener:function(d,g){T(d)?(g=d,d=["*"]):d=d.match(Et);for(var A,N=0,P=d.length;N<P;N++)A=d[N],Wa.tweeners[A]=Wa.tweeners[A]||[],Wa.tweeners[A].unshift(g)},prefilters:[ID],prefilter:function(d,g){g?Wa.prefilters.unshift(d):Wa.prefilters.push(d)}}),p.speed=function(d,g,A){var N=d&&typeof d=="object"?p.extend({},d):{complete:A||!A&&g||T(d)&&d,duration:d,easing:A&&g||g&&!T(g)&&g};return p.fx.off?N.duration=0:typeof N.duration!="number"&&(N.duration in p.fx.speeds?N.duration=p.fx.speeds[N.duration]:N.duration=p.fx.speeds._default),(N.queue==null||N.queue===!0)&&(N.queue="fx"),N.old=N.complete,N.complete=function(){T(N.old)&&N.old.call(this),N.queue&&p.dequeue(this,N.queue)},N},p.fn.extend({fadeTo:function(d,g,A,N){return this.filter(ir).css("opacity",0).show().end().animate({opacity:g},d,A,N)},animate:function(d,g,A,N){var P=p.isEmptyObject(d),w=p.speed(g,A,N),H=function(){var z=Wa(this,p.extend({},d),w);(P||At.get(this,"finish"))&&z.stop(!0)};return H.finish=H,P||w.queue===!1?this.each(H):this.queue(w.queue,H)},stop:function(d,g,A){var N=function(P){var w=P.stop;delete P.stop,w(A)};return typeof d!="string"&&(A=g,g=d,d=void 0),g&&this.queue(d||"fx",[]),this.each(function(){var P=!0,w=d!=null&&d+"queueHooks",H=p.timers,z=At.get(this);if(w)z[w]&&z[w].stop&&N(z[w]);else for(w in z)z[w]&&z[w].stop&&mD.test(w)&&N(z[w]);for(w=H.length;w--;)H[w].elem===this&&(d==null||H[w].queue===d)&&(H[w].anim.stop(A),P=!1,H.splice(w,1));(P||!A)&&p.dequeue(this,d)})},finish:function(d){return d!==!1&&(d=d||"fx"),this.each(function(){var g,A=At.get(this),N=A[d+"queue"],P=A[d+"queueHooks"],w=p.timers,H=N?N.length:0;for(A.finish=!0,p.queue(this,d,[]),P&&P.stop&&P.stop.call(this,!0),g=w.length;g--;)w[g].elem===this&&w[g].queue===d&&(w[g].anim.stop(!0),w.splice(g,1));for(g=0;g<H;g++)N[g]&&N[g].finish&&N[g].finish.call(this);delete A.finish})}}),p.each(["toggle","show","hide"],function(d,g){var A=p.fn[g];p.fn[g]=function(N,P,w){return N==null||typeof N=="boolean"?A.apply(this,arguments):this.animate(Fn(g,!0),N,P,w)}}),p.each({slideDown:Fn("show"),slideUp:Fn("hide"),slideToggle:Fn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(d,g){p.fn[d]=function(A,N,P){return this.animate(g,A,N,P)}}),p.timers=[],p.fx.tick=function(){var d,g=0,A=p.timers;for(or=Date.now();g<A.length;g++)d=A[g],!d()&&A[g]===d&&A.splice(g--,1);A.length||p.fx.stop(),or=void 0},p.fx.timer=function(d){p.timers.push(d),p.fx.start()},p.fx.interval=13,p.fx.start=function(){pn||(pn=!0,Os())},p.fx.stop=function(){pn=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fn.delay=function(d,g){return d=p.fx&&p.fx.speeds[d]||d,g=g||"fx",this.queue(g,function(A,N){var P=n.setTimeout(A,d);N.stop=function(){n.clearTimeout(P)}})},function(){var d=F.createElement("input"),g=F.createElement("select"),A=g.appendChild(F.createElement("option"));d.type="checkbox",S.checkOn=d.value!=="",S.optSelected=A.selected,d=F.createElement("input"),d.value="t",d.type="radio",S.radioValue=d.value==="t"}();var Sl,Gr=p.expr.attrHandle;p.fn.extend({attr:function(d,g){return Gt(this,p.attr,d,g,arguments.length>1)},removeAttr:function(d){return this.each(function(){p.removeAttr(this,d)})}}),p.extend({attr:function(d,g,A){var N,P,w=d.nodeType;if(!(w===3||w===8||w===2)){if(typeof d.getAttribute>"u")return p.prop(d,g,A);if((w!==1||!p.isXMLDoc(d))&&(P=p.attrHooks[g.toLowerCase()]||(p.expr.match.bool.test(g)?Sl:void 0)),A!==void 0){if(A===null){p.removeAttr(d,g);return}return P&&"set"in P&&(N=P.set(d,A,g))!==void 0?N:(d.setAttribute(g,A+""),A)}return P&&"get"in P&&(N=P.get(d,g))!==null?N:(N=p.find.attr(d,g),N??void 0)}},attrHooks:{type:{set:function(d,g){if(!S.radioValue&&g==="radio"&&Y(d,"input")){var A=d.value;return d.setAttribute("type",g),A&&(d.value=A),g}}}},removeAttr:function(d,g){var A,N=0,P=g&&g.match(Et);if(P&&d.nodeType===1)for(;A=P[N++];)d.removeAttribute(A)}}),Sl={set:function(d,g,A){return g===!1?p.removeAttr(d,A):d.setAttribute(A,A),A}},p.each(p.expr.match.bool.source.match(/\w+/g),function(d,g){var A=Gr[g]||p.find.attr;Gr[g]=function(N,P,w){var H,z,U=P.toLowerCase();return w||(z=Gr[U],Gr[U]=H,H=A(N,P,w)!=null?U:null,Gr[U]=z),H}});var pD=/^(?:input|select|textarea|button)$/i,FD=/^(?:a|area)$/i;p.fn.extend({prop:function(d,g){return Gt(this,p.prop,d,g,arguments.length>1)},removeProp:function(d){return this.each(function(){delete this[p.propFix[d]||d]})}}),p.extend({prop:function(d,g,A){var N,P,w=d.nodeType;if(!(w===3||w===8||w===2))return(w!==1||!p.isXMLDoc(d))&&(g=p.propFix[g]||g,P=p.propHooks[g]),A!==void 0?P&&"set"in P&&(N=P.set(d,A,g))!==void 0?N:d[g]=A:P&&"get"in P&&(N=P.get(d,g))!==null?N:d[g]},propHooks:{tabIndex:{get:function(d){var g=p.find.attr(d,"tabindex");return g?parseInt(g,10):pD.test(d.nodeName)||FD.test(d.nodeName)&&d.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),S.optSelected||(p.propHooks.selected={get:function(d){var g=d.parentNode;return g&&g.parentNode&&g.parentNode.selectedIndex,null},set:function(d){var g=d.parentNode;g&&(g.selectedIndex,g.parentNode&&g.parentNode.selectedIndex)}}),p.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){p.propFix[this.toLowerCase()]=this});function bi(d){var g=d.match(Et)||[];return g.join(" ")}function Gi(d){return d.getAttribute&&d.getAttribute("class")||""}function Rs(d){return Array.isArray(d)?d:typeof d=="string"?d.match(Et)||[]:[]}p.fn.extend({addClass:function(d){var g,A,N,P,w,H;return T(d)?this.each(function(z){p(this).addClass(d.call(this,z,Gi(this)))}):(g=Rs(d),g.length?this.each(function(){if(N=Gi(this),A=this.nodeType===1&&" "+bi(N)+" ",A){for(w=0;w<g.length;w++)P=g[w],A.indexOf(" "+P+" ")<0&&(A+=P+" ");H=bi(A),N!==H&&this.setAttribute("class",H)}}):this)},removeClass:function(d){var g,A,N,P,w,H;return T(d)?this.each(function(z){p(this).removeClass(d.call(this,z,Gi(this)))}):arguments.length?(g=Rs(d),g.length?this.each(function(){if(N=Gi(this),A=this.nodeType===1&&" "+bi(N)+" ",A){for(w=0;w<g.length;w++)for(P=g[w];A.indexOf(" "+P+" ")>-1;)A=A.replace(" "+P+" "," ");H=bi(A),N!==H&&this.setAttribute("class",H)}}):this):this.attr("class","")},toggleClass:function(d,g){var A,N,P,w,H=typeof d,z=H==="string"||Array.isArray(d);return T(d)?this.each(function(U){p(this).toggleClass(d.call(this,U,Gi(this),g),g)}):typeof g=="boolean"&&z?g?this.addClass(d):this.removeClass(d):(A=Rs(d),this.each(function(){if(z)for(w=p(this),P=0;P<A.length;P++)N=A[P],w.hasClass(N)?w.removeClass(N):w.addClass(N);else(d===void 0||H==="boolean")&&(N=Gi(this),N&&At.set(this,"__className__",N),this.setAttribute&&this.setAttribute("class",N||d===!1?"":At.get(this,"__className__")||""))}))},hasClass:function(d){var g,A,N=0;for(g=" "+d+" ";A=this[N++];)if(A.nodeType===1&&(" "+bi(Gi(A))+" ").indexOf(g)>-1)return!0;return!1}});var ED=/\r/g;p.fn.extend({val:function(d){var g,A,N,P=this[0];return arguments.length?(N=T(d),this.each(function(w){var H;this.nodeType===1&&(N?H=d.call(this,w,p(this).val()):H=d,H==null?H="":typeof H=="number"?H+="":Array.isArray(H)&&(H=p.map(H,function(z){return z==null?"":z+""})),g=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()],(!g||!("set"in g)||g.set(this,H,"value")===void 0)&&(this.value=H))})):P?(g=p.valHooks[P.type]||p.valHooks[P.nodeName.toLowerCase()],g&&"get"in g&&(A=g.get(P,"value"))!==void 0?A:(A=P.value,typeof A=="string"?A.replace(ED,""):A??"")):void 0}}),p.extend({valHooks:{option:{get:function(d){var g=p.find.attr(d,"value");return g??bi(p.text(d))}},select:{get:function(d){var g,A,N,P=d.options,w=d.selectedIndex,H=d.type==="select-one",z=H?null:[],U=H?w+1:P.length;for(w<0?N=U:N=H?w:0;N<U;N++)if(A=P[N],(A.selected||N===w)&&!A.disabled&&(!A.parentNode.disabled||!Y(A.parentNode,"optgroup"))){if(g=p(A).val(),H)return g;z.push(g)}return z},set:function(d,g){for(var A,N,P=d.options,w=p.makeArray(g),H=P.length;H--;)N=P[H],(N.selected=p.inArray(p.valHooks.option.get(N),w)>-1)&&(A=!0);return A||(d.selectedIndex=-1),w}}}}),p.each(["radio","checkbox"],function(){p.valHooks[this]={set:function(d,g){if(Array.isArray(g))return d.checked=p.inArray(p(d).val(),g)>-1}},S.checkOn||(p.valHooks[this].get=function(d){return d.getAttribute("value")===null?"on":d.value})});var Vr=n.location,Tl={guid:Date.now()},ys=/\?/;p.parseXML=function(d){var g,A;if(!d||typeof d!="string")return null;try{g=new n.DOMParser().parseFromString(d,"text/xml")}catch{}return A=g&&g.getElementsByTagName("parsererror")[0],(!g||A)&&p.error("Invalid XML: "+(A?p.map(A.childNodes,function(N){return N.textContent}).join(`
`):d)),g};var dl=/^(?:focusinfocus|focusoutblur)$/,ml=function(d){d.stopPropagation()};p.extend(p.event,{trigger:function(d,g,A,N){var P,w,H,z,U,$,st,ft,at=[A||F],Tt=C.call(d,"type")?d.type:d,Yt=C.call(d,"namespace")?d.namespace.split("."):[];if(w=ft=H=A=A||F,!(A.nodeType===3||A.nodeType===8)&&!dl.test(Tt+p.event.triggered)&&(Tt.indexOf(".")>-1&&(Yt=Tt.split("."),Tt=Yt.shift(),Yt.sort()),U=Tt.indexOf(":")<0&&"on"+Tt,d=d[p.expando]?d:new p.Event(Tt,typeof d=="object"&&d),d.isTrigger=N?2:3,d.namespace=Yt.join("."),d.rnamespace=d.namespace?new RegExp("(^|\\.)"+Yt.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,d.result=void 0,d.target||(d.target=A),g=g==null?[d]:p.makeArray(g,[d]),st=p.event.special[Tt]||{},!(!N&&st.trigger&&st.trigger.apply(A,g)===!1))){if(!N&&!st.noBubble&&!I(A)){for(z=st.delegateType||Tt,dl.test(z+Tt)||(w=w.parentNode);w;w=w.parentNode)at.push(w),H=w;H===(A.ownerDocument||F)&&at.push(H.defaultView||H.parentWindow||n)}for(P=0;(w=at[P++])&&!d.isPropagationStopped();)ft=w,d.type=P>1?z:st.bindType||Tt,$=(At.get(w,"events")||Object.create(null))[d.type]&&At.get(w,"handle"),$&&$.apply(w,g),$=U&&w[U],$&&$.apply&&Oi(w)&&(d.result=$.apply(w,g),d.result===!1&&d.preventDefault());return d.type=Tt,!N&&!d.isDefaultPrevented()&&(!st._default||st._default.apply(at.pop(),g)===!1)&&Oi(A)&&U&&T(A[Tt])&&!I(A)&&(H=A[U],H&&(A[U]=null),p.event.triggered=Tt,d.isPropagationStopped()&&ft.addEventListener(Tt,ml),A[Tt](),d.isPropagationStopped()&&ft.removeEventListener(Tt,ml),p.event.triggered=void 0,H&&(A[U]=H)),d.result}},simulate:function(d,g,A){var N=p.extend(new p.Event,A,{type:d,isSimulated:!0});p.event.trigger(N,null,g)}}),p.fn.extend({trigger:function(d,g){return this.each(function(){p.event.trigger(d,g,this)})},triggerHandler:function(d,g){var A=this[0];if(A)return p.event.trigger(d,g,A,!0)}});var xD=/\[\]$/,Il=/\r?\n/g,LD=/^(?:submit|button|image|reset|file)$/i,MD=/^(?:input|select|textarea|keygen)/i;function Ps(d,g,A,N){var P;if(Array.isArray(g))p.each(g,function(w,H){A||xD.test(d)?N(d,H):Ps(d+"["+(typeof H=="object"&&H!=null?w:"")+"]",H,A,N)});else if(!A&&O(g)==="object")for(P in g)Ps(d+"["+P+"]",g[P],A,N);else N(d,g)}p.param=function(d,g){var A,N=[],P=function(w,H){var z=T(H)?H():H;N[N.length]=encodeURIComponent(w)+"="+encodeURIComponent(z??"")};if(d==null)return"";if(Array.isArray(d)||d.jquery&&!p.isPlainObject(d))p.each(d,function(){P(this.name,this.value)});else for(A in d)Ps(A,d[A],g,P);return N.join("&")},p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var d=p.prop(this,"elements");return d?p.makeArray(d):this}).filter(function(){var d=this.type;return this.name&&!p(this).is(":disabled")&&MD.test(this.nodeName)&&!LD.test(d)&&(this.checked||!Xa.test(d))}).map(function(d,g){var A=p(this).val();return A==null?null:Array.isArray(A)?p.map(A,function(N){return{name:g.name,value:N.replace(Il,`\r
`)}}):{name:g.name,value:A.replace(Il,`\r
`)}}).get()}});var AD=/%20/g,ND=/#.*$/,OD=/([?&])_=[^&]*/,RD=/^(.*?):[ \t]*([^\r\n]*)$/mg,yD=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,PD=/^(?:GET|HEAD)$/,wD=/^\/\//,gl={},ws={},pl="*/".concat("*"),Bs=F.createElement("a");Bs.href=Vr.href;function Fl(d){return function(g,A){typeof g!="string"&&(A=g,g="*");var N,P=0,w=g.toLowerCase().match(Et)||[];if(T(A))for(;N=w[P++];)N[0]==="+"?(N=N.slice(1)||"*",(d[N]=d[N]||[]).unshift(A)):(d[N]=d[N]||[]).push(A)}}function El(d,g,A,N){var P={},w=d===ws;function H(z){var U;return P[z]=!0,p.each(d[z]||[],function($,st){var ft=st(g,A,N);if(typeof ft=="string"&&!w&&!P[ft])return g.dataTypes.unshift(ft),H(ft),!1;if(w)return!(U=ft)}),U}return H(g.dataTypes[0])||!P["*"]&&H("*")}function bs(d,g){var A,N,P=p.ajaxSettings.flatOptions||{};for(A in g)g[A]!==void 0&&((P[A]?d:N||(N={}))[A]=g[A]);return N&&p.extend(!0,d,N),d}function BD(d,g,A){for(var N,P,w,H,z=d.contents,U=d.dataTypes;U[0]==="*";)U.shift(),N===void 0&&(N=d.mimeType||g.getResponseHeader("Content-Type"));if(N){for(P in z)if(z[P]&&z[P].test(N)){U.unshift(P);break}}if(U[0]in A)w=U[0];else{for(P in A){if(!U[0]||d.converters[P+" "+U[0]]){w=P;break}H||(H=P)}w=w||H}if(w)return w!==U[0]&&U.unshift(w),A[w]}function bD(d,g,A,N){var P,w,H,z,U,$={},st=d.dataTypes.slice();if(st[1])for(H in d.converters)$[H.toLowerCase()]=d.converters[H];for(w=st.shift();w;)if(d.responseFields[w]&&(A[d.responseFields[w]]=g),!U&&N&&d.dataFilter&&(g=d.dataFilter(g,d.dataType)),U=w,w=st.shift(),w){if(w==="*")w=U;else if(U!=="*"&&U!==w){if(H=$[U+" "+w]||$["* "+w],!H){for(P in $)if(z=P.split(" "),z[1]===w&&(H=$[U+" "+z[0]]||$["* "+z[0]],H)){H===!0?H=$[P]:$[P]!==!0&&(w=z[0],st.unshift(z[1]));break}}if(H!==!0)if(H&&d.throws)g=H(g);else try{g=H(g)}catch(ft){return{state:"parsererror",error:H?ft:"No conversion from "+U+" to "+w}}}}return{state:"success",data:g}}p.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Vr.href,type:"GET",isLocal:yD.test(Vr.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":pl,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":p.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(d,g){return g?bs(bs(d,p.ajaxSettings),g):bs(p.ajaxSettings,d)},ajaxPrefilter:Fl(gl),ajaxTransport:Fl(ws),ajax:function(d,g){typeof d=="object"&&(g=d,d=void 0),g=g||{};var A,N,P,w,H,z,U,$,st,ft,at=p.ajaxSetup({},g),Tt=at.context||at,Yt=at.context&&(Tt.nodeType||Tt.jquery)?p(Tt):p.event,le=p.Deferred(),Jt=p.Callbacks("once memory"),Ue=at.statusCode||{},Ve={},ti={},ei="canceled",te={readyState:0,getResponseHeader:function(ve){var Re;if(U){if(!w)for(w={};Re=RD.exec(P);)w[Re[1].toLowerCase()+" "]=(w[Re[1].toLowerCase()+" "]||[]).concat(Re[2]);Re=w[ve.toLowerCase()+" "]}return Re==null?null:Re.join(", ")},getAllResponseHeaders:function(){return U?P:null},setRequestHeader:function(ve,Re){return U==null&&(ve=ti[ve.toLowerCase()]=ti[ve.toLowerCase()]||ve,Ve[ve]=Re),this},overrideMimeType:function(ve){return U==null&&(at.mimeType=ve),this},statusCode:function(ve){var Re;if(ve)if(U)te.always(ve[te.status]);else for(Re in ve)Ue[Re]=[Ue[Re],ve[Re]];return this},abort:function(ve){var Re=ve||ei;return A&&A.abort(Re),Vi(0,Re),this}};if(le.promise(te),at.url=((d||at.url||Vr.href)+"").replace(wD,Vr.protocol+"//"),at.type=g.method||g.type||at.method||at.type,at.dataTypes=(at.dataType||"*").toLowerCase().match(Et)||[""],at.crossDomain==null){z=F.createElement("a");try{z.href=at.url,z.href=z.href,at.crossDomain=Bs.protocol+"//"+Bs.host!=z.protocol+"//"+z.host}catch{at.crossDomain=!0}}if(at.data&&at.processData&&typeof at.data!="string"&&(at.data=p.param(at.data,at.traditional)),El(gl,at,g,te),U)return te;$=p.event&&at.global,$&&p.active++===0&&p.event.trigger("ajaxStart"),at.type=at.type.toUpperCase(),at.hasContent=!PD.test(at.type),N=at.url.replace(ND,""),at.hasContent?at.data&&at.processData&&(at.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(at.data=at.data.replace(AD,"+")):(ft=at.url.slice(N.length),at.data&&(at.processData||typeof at.data=="string")&&(N+=(ys.test(N)?"&":"?")+at.data,delete at.data),at.cache===!1&&(N=N.replace(OD,"$1"),ft=(ys.test(N)?"&":"?")+"_="+Tl.guid+++ft),at.url=N+ft),at.ifModified&&(p.lastModified[N]&&te.setRequestHeader("If-Modified-Since",p.lastModified[N]),p.etag[N]&&te.setRequestHeader("If-None-Match",p.etag[N])),(at.data&&at.hasContent&&at.contentType!==!1||g.contentType)&&te.setRequestHeader("Content-Type",at.contentType),te.setRequestHeader("Accept",at.dataTypes[0]&&at.accepts[at.dataTypes[0]]?at.accepts[at.dataTypes[0]]+(at.dataTypes[0]!=="*"?", "+pl+"; q=0.01":""):at.accepts["*"]);for(st in at.headers)te.setRequestHeader(st,at.headers[st]);if(at.beforeSend&&(at.beforeSend.call(Tt,te,at)===!1||U))return te.abort();if(ei="abort",Jt.add(at.complete),te.done(at.success),te.fail(at.error),A=El(ws,at,g,te),!A)Vi(-1,"No Transport");else{if(te.readyState=1,$&&Yt.trigger("ajaxSend",[te,at]),U)return te;at.async&&at.timeout>0&&(H=n.setTimeout(function(){te.abort("timeout")},at.timeout));try{U=!1,A.send(Ve,Vi)}catch(ve){if(U)throw ve;Vi(-1,ve)}}function Vi(ve,Re,Yr,Vs){var ai,kr,ii,mi,Ii,Oa=Re;U||(U=!0,H&&n.clearTimeout(H),A=void 0,P=Vs||"",te.readyState=ve>0?4:0,ai=ve>=200&&ve<300||ve===304,Yr&&(mi=BD(at,te,Yr)),!ai&&p.inArray("script",at.dataTypes)>-1&&p.inArray("json",at.dataTypes)<0&&(at.converters["text script"]=function(){}),mi=bD(at,mi,te,ai),ai?(at.ifModified&&(Ii=te.getResponseHeader("Last-Modified"),Ii&&(p.lastModified[N]=Ii),Ii=te.getResponseHeader("etag"),Ii&&(p.etag[N]=Ii)),ve===204||at.type==="HEAD"?Oa="nocontent":ve===304?Oa="notmodified":(Oa=mi.state,kr=mi.data,ii=mi.error,ai=!ii)):(ii=Oa,(ve||!Oa)&&(Oa="error",ve<0&&(ve=0))),te.status=ve,te.statusText=(Re||Oa)+"",ai?le.resolveWith(Tt,[kr,Oa,te]):le.rejectWith(Tt,[te,Oa,ii]),te.statusCode(Ue),Ue=void 0,$&&Yt.trigger(ai?"ajaxSuccess":"ajaxError",[te,at,ai?kr:ii]),Jt.fireWith(Tt,[te,Oa]),$&&(Yt.trigger("ajaxComplete",[te,at]),--p.active||p.event.trigger("ajaxStop")))}return te},getJSON:function(d,g,A){return p.get(d,g,A,"json")},getScript:function(d,g){return p.get(d,void 0,g,"script")}}),p.each(["get","post"],function(d,g){p[g]=function(A,N,P,w){return T(N)&&(w=w||P,P=N,N=void 0),p.ajax(p.extend({url:A,type:g,dataType:w,data:N,success:P},p.isPlainObject(A)&&A))}}),p.ajaxPrefilter(function(d){var g;for(g in d.headers)g.toLowerCase()==="content-type"&&(d.contentType=d.headers[g]||"")}),p._evalUrl=function(d,g,A){return p.ajax({url:d,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(N){p.globalEval(N,g,A)}})},p.fn.extend({wrapAll:function(d){var g;return this[0]&&(T(d)&&(d=d.call(this[0])),g=p(d,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&g.insertBefore(this[0]),g.map(function(){for(var A=this;A.firstElementChild;)A=A.firstElementChild;return A}).append(this)),this},wrapInner:function(d){return T(d)?this.each(function(g){p(this).wrapInner(d.call(this,g))}):this.each(function(){var g=p(this),A=g.contents();A.length?A.wrapAll(d):g.append(d)})},wrap:function(d){var g=T(d);return this.each(function(A){p(this).wrapAll(g?d.call(this,A):d)})},unwrap:function(d){return this.parent(d).not("body").each(function(){p(this).replaceWith(this.childNodes)}),this}}),p.expr.pseudos.hidden=function(d){return!p.expr.pseudos.visible(d)},p.expr.pseudos.visible=function(d){return!!(d.offsetWidth||d.offsetHeight||d.getClientRects().length)},p.ajaxSettings.xhr=function(){try{return new n.XMLHttpRequest}catch{}};var GD={0:200,1223:204},Hr=p.ajaxSettings.xhr();S.cors=!!Hr&&"withCredentials"in Hr,S.ajax=Hr=!!Hr,p.ajaxTransport(function(d){var g,A;if(S.cors||Hr&&!d.crossDomain)return{send:function(N,P){var w,H=d.xhr();if(H.open(d.type,d.url,d.async,d.username,d.password),d.xhrFields)for(w in d.xhrFields)H[w]=d.xhrFields[w];d.mimeType&&H.overrideMimeType&&H.overrideMimeType(d.mimeType),!d.crossDomain&&!N["X-Requested-With"]&&(N["X-Requested-With"]="XMLHttpRequest");for(w in N)H.setRequestHeader(w,N[w]);g=function(z){return function(){g&&(g=A=H.onload=H.onerror=H.onabort=H.ontimeout=H.onreadystatechange=null,z==="abort"?H.abort():z==="error"?typeof H.status!="number"?P(0,"error"):P(H.status,H.statusText):P(GD[H.status]||H.status,H.statusText,(H.responseType||"text")!=="text"||typeof H.responseText!="string"?{binary:H.response}:{text:H.responseText},H.getAllResponseHeaders()))}},H.onload=g(),A=H.onerror=H.ontimeout=g("error"),H.onabort!==void 0?H.onabort=A:H.onreadystatechange=function(){H.readyState===4&&n.setTimeout(function(){g&&A()})},g=g("abort");try{H.send(d.hasContent&&d.data||null)}catch(z){if(g)throw z}},abort:function(){g&&g()}}}),p.ajaxPrefilter(function(d){d.crossDomain&&(d.contents.script=!1)}),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(d){return p.globalEval(d),d}}}),p.ajaxPrefilter("script",function(d){d.cache===void 0&&(d.cache=!1),d.crossDomain&&(d.type="GET")}),p.ajaxTransport("script",function(d){if(d.crossDomain||d.scriptAttrs){var g,A;return{send:function(N,P){g=p("<script>").attr(d.scriptAttrs||{}).prop({charset:d.scriptCharset,src:d.url}).on("load error",A=function(w){g.remove(),A=null,w&&P(w.type==="error"?404:200,w.type)}),F.head.appendChild(g[0])},abort:function(){A&&A()}}}});var xl=[],Gs=/(=)\?(?=&|$)|\?\?/;p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var d=xl.pop()||p.expando+"_"+Tl.guid++;return this[d]=!0,d}}),p.ajaxPrefilter("json jsonp",function(d,g,A){var N,P,w,H=d.jsonp!==!1&&(Gs.test(d.url)?"url":typeof d.data=="string"&&(d.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Gs.test(d.data)&&"data");if(H||d.dataTypes[0]==="jsonp")return N=d.jsonpCallback=T(d.jsonpCallback)?d.jsonpCallback():d.jsonpCallback,H?d[H]=d[H].replace(Gs,"$1"+N):d.jsonp!==!1&&(d.url+=(ys.test(d.url)?"&":"?")+d.jsonp+"="+N),d.converters["script json"]=function(){return w||p.error(N+" was not called"),w[0]},d.dataTypes[0]="json",P=n[N],n[N]=function(){w=arguments},A.always(function(){P===void 0?p(n).removeProp(N):n[N]=P,d[N]&&(d.jsonpCallback=g.jsonpCallback,xl.push(N)),w&&T(P)&&P(w[0]),w=P=void 0}),"script"}),S.createHTMLDocument=function(){var d=F.implementation.createHTMLDocument("").body;return d.innerHTML="<form></form><form></form>",d.childNodes.length===2}(),p.parseHTML=function(d,g,A){if(typeof d!="string")return[];typeof g=="boolean"&&(A=g,g=!1);var N,P,w;return g||(S.createHTMLDocument?(g=F.implementation.createHTMLDocument(""),N=g.createElement("base"),N.href=F.location.href,g.head.appendChild(N)):g=F),P=Ce.exec(d),w=!A&&[],P?[g.createElement(P[1])]:(P=el([d],g,w),w&&w.length&&p(w).remove(),p.merge([],P.childNodes))},p.fn.load=function(d,g,A){var N,P,w,H=this,z=d.indexOf(" ");return z>-1&&(N=bi(d.slice(z)),d=d.slice(0,z)),T(g)?(A=g,g=void 0):g&&typeof g=="object"&&(P="POST"),H.length>0&&p.ajax({url:d,type:P||"GET",dataType:"html",data:g}).done(function(U){w=arguments,H.html(N?p("<div>").append(p.parseHTML(U)).find(N):U)}).always(A&&function(U,$){H.each(function(){A.apply(this,w||[U.responseText,$,U])})}),this},p.expr.pseudos.animated=function(d){return p.grep(p.timers,function(g){return d===g.elem}).length},p.offset={setOffset:function(d,g,A){var N,P,w,H,z,U,$,st=p.css(d,"position"),ft=p(d),at={};st==="static"&&(d.style.position="relative"),z=ft.offset(),w=p.css(d,"top"),U=p.css(d,"left"),$=(st==="absolute"||st==="fixed")&&(w+U).indexOf("auto")>-1,$?(N=ft.position(),H=N.top,P=N.left):(H=parseFloat(w)||0,P=parseFloat(U)||0),T(g)&&(g=g.call(d,A,p.extend({},z))),g.top!=null&&(at.top=g.top-z.top+H),g.left!=null&&(at.left=g.left-z.left+P),"using"in g?g.using.call(d,at):ft.css(at)}},p.fn.extend({offset:function(d){if(arguments.length)return d===void 0?this:this.each(function(P){p.offset.setOffset(this,d,P)});var g,A,N=this[0];if(N)return N.getClientRects().length?(g=N.getBoundingClientRect(),A=N.ownerDocument.defaultView,{top:g.top+A.pageYOffset,left:g.left+A.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var d,g,A,N=this[0],P={top:0,left:0};if(p.css(N,"position")==="fixed")g=N.getBoundingClientRect();else{for(g=this.offset(),A=N.ownerDocument,d=N.offsetParent||A.documentElement;d&&(d===A.body||d===A.documentElement)&&p.css(d,"position")==="static";)d=d.parentNode;d&&d!==N&&d.nodeType===1&&(P=p(d).offset(),P.top+=p.css(d,"borderTopWidth",!0),P.left+=p.css(d,"borderLeftWidth",!0))}return{top:g.top-P.top-p.css(N,"marginTop",!0),left:g.left-P.left-p.css(N,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var d=this.offsetParent;d&&p.css(d,"position")==="static";)d=d.offsetParent;return d||ka})}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(d,g){var A=g==="pageYOffset";p.fn[d]=function(N){return Gt(this,function(P,w,H){var z;if(I(P)?z=P:P.nodeType===9&&(z=P.defaultView),H===void 0)return z?z[g]:P[w];z?z.scrollTo(A?z.pageXOffset:H,A?H:z.pageYOffset):P[w]=H},d,N,arguments.length)}}),p.each(["top","left"],function(d,g){p.cssHooks[g]=ol(S.pixelPosition,function(A,N){if(N)return N=br(A,g),Ls.test(N)?p(A).position()[g]+"px":N})}),p.each({Height:"height",Width:"width"},function(d,g){p.each({padding:"inner"+d,content:g,"":"outer"+d},function(A,N){p.fn[N]=function(P,w){var H=arguments.length&&(A||typeof P!="boolean"),z=A||(P===!0||w===!0?"margin":"border");return Gt(this,function(U,$,st){var ft;return I(U)?N.indexOf("outer")===0?U["inner"+d]:U.document.documentElement["client"+d]:U.nodeType===9?(ft=U.documentElement,Math.max(U.body["scroll"+d],ft["scroll"+d],U.body["offset"+d],ft["offset"+d],ft["client"+d])):st===void 0?p.css(U,$,z):p.style(U,$,st,z)},g,H?P:void 0,H)}})}),p.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(d,g){p.fn[g]=function(A){return this.on(g,A)}}),p.fn.extend({bind:function(d,g,A){return this.on(d,null,g,A)},unbind:function(d,g){return this.off(d,null,g)},delegate:function(d,g,A,N){return this.on(g,d,A,N)},undelegate:function(d,g,A){return arguments.length===1?this.off(d,"**"):this.off(g,d||"**",A)},hover:function(d,g){return this.on("mouseenter",d).on("mouseleave",g||d)}}),p.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(d,g){p.fn[g]=function(A,N){return arguments.length>0?this.on(g,null,A,N):this.trigger(g)}});var VD=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;p.proxy=function(d,g){var A,N,P;if(typeof g=="string"&&(A=d[g],g=d,d=A),!!T(d))return N=s.call(arguments,2),P=function(){return d.apply(g||this,N.concat(s.call(arguments)))},P.guid=d.guid=d.guid||p.guid++,P},p.holdReady=function(d){d?p.readyWait++:p.ready(!0)},p.isArray=Array.isArray,p.parseJSON=JSON.parse,p.nodeName=Y,p.isFunction=T,p.isWindow=I,p.camelCase=ha,p.type=O,p.now=Date.now,p.isNumeric=function(d){var g=p.type(d);return(g==="number"||g==="string")&&!isNaN(d-parseFloat(d))},p.trim=function(d){return d==null?"":(d+"").replace(VD,"$1")};var HD=n.jQuery,YD=n.$;return p.noConflict=function(d){return n.$===p&&(n.$=YD),d&&n.jQuery===p&&(n.jQuery=HD),p},typeof e>"u"&&(n.jQuery=n.$=p),p})})(aC);var iC=aC.exports;Object.defineProperty(th,"__esModule",{value:!0});var xT=g0;ba(xT);var LT=F0,MT=ba(LT),AT=L0,NT=ba(AT),OT=N0,Wu=ba(OT),RT=Y0,Xn=ba(RT),yT=Sh,Wi=ba(yT),PT=ds,Se=ba(PT),wT=tC,Ee=ba(wT),BT=mT,jr=ba(BT),bT=eC,we=ba(bT),GT=Ah,Dt=ba(GT),me,VT=iC,q=ba(VT);function ba(r){return r&&r.__esModule?r:{default:r}}var X={Chart:{Log:console.log,Warn:console.warn},Complier:{Log:console.log,Warn:console.warn},JSTable:{Log:console.log,Warn:console.warn}};function Lt(){}Lt.HttpRequest=function(r){q.default.ajax({url:r.url,data:r.data,type:r.type,dataType:r.dataType,async:r.async,success:r.success,error:r.error})};var se={MINUTE_ID:101,MULTIDAY_MINUTE_ID:102,HISTORY_MINUTE_ID:103,KLINE_DAY_ID:0,KLINE_WEEK_ID:1,KLINE_TWOWEEK_ID:21,KLINE_MONTH_ID:2,KLINE_QUARTER_ID:9,KLINE_YEAR_ID:3,KLINE_MINUTE_ID:4,KLINE_5_MINUTE_ID:5,KLINE_15_MINUTE_ID:6,KLINE_30_MINUTE_ID:7,KLINE_60_MINUTE_ID:8};function HT(){this.DataMap=new Dt.default,this.Get=function(r){return this.DataMap.has(r)?this.DataMap.get(r):null},this.Add=function(r){this.DataMap.set(r.ID,r)}}var rC=new HT;function J(){this.DataMap=new Dt.default([["MA",this.MA],["均线",this.MA],["MA4",this.MA4],["MA5",this.MA5],["MA6",this.MA6],["MA7",this.MA7],["MA8",this.MA8],["BOLL",this.BOLL],["BOLL副图",this.BOLL2],["BBI",this.BBI],["DKX",this.DKX],["MIKE",this.MIKE],["PBX",this.PBX],["ENE",this.ENE],["MACD",this.MACD],["KDJ",this.KDJ],["MACD2",this.MACD2],["VOL",this.VOL],["VOL_OVERLAY",this.VOL_OVERLAY],["RSI",this.RSI],["BRAR",this.BRAR],["WR",this.WR],["BIAS",this.BIAS],["OBV",this.OBV],["DMI",this.DMI],["CR",this.CR],["PSY",this.PSY],["CCI",this.CCI],["DMA",this.DMA],["TRIX",this.TRIX],["VR",this.VR],["EMV",this.EMV],["ROC",this.ROC],["MTM",this.MTM],["FSL",this.FSL],["CYR",this.CYR],["MASS",this.MASS],["WAD",this.WAD],["CHO",this.CHO],["ADTM",this.ADTM],["HSL",this.HSL],["BIAS36",this.BIAS36],["BIAS_QL",this.BIAS_QL],["DPO",this.DPO],["OSC",this.OSC],["ATR",this.ATR],["NVI",this.NVI],["PVI",this.PVI],["UOS",this.UOS],["CYW",this.CYW],["LON",this.LON],["NDB",this.NDB],["SKDJ",this.SKDJ],["KD",this.KD],["FKX",this.FKX],["DKCOL",this.DKCOL],["UDL",this.UDL],["MFI",this.MFI],["LWR",this.LWR],["MARSI",this.MARSI],["CYD",this.CYD],["CYF",this.CYF],["TAPI",this.TAPI],["VMACD",this.VMACD],["QACD",this.QACD],["VPT",this.VPT],["WVAD",this.WVAD],["DBQR",this.DBQR],["JS",this.JS],["CYE",this.CYE],["QR",this.QR],["GDX",this.GDX],["JLHB",this.JLHB],["PCNT",this.PCNT],["BTX",this.BTX],["AMO",this.AMO],["VRSI",this.VRSI],["HSCOL",this.HSCOL],["DBQRV",this.DBQRV],["DBLB",this.DBLB],["ACD",this.ACD],["EXPMA",this.EXPMA],["EXPMA_S",this.EXPMA_S],["HMA",this.HMA],["LMA",this.LMA],["VMA",this.VMA],["AMV",this.AMV],["BBIBOLL",this.BBIBOLL],["ALLIGAT",this.ALLIGAT],["ZX",this.ZX],["XS",this.XS],["XS2",this.XS2],["SG-XDT",this.SG_XDT],["SG-SMX",this.SG_SMX],["SG-LB",this.SG_LB],["SG-PF",this.SG_PF],["RAD",this.RAD],["SHT",this.SHT],["ZLJC",this.ZLJC],["ZLMM",this.ZLMM],["SLZT",this.SLZT],["ADVOL",this.ADVOL],["CYC",this.CYC],["CYS",this.CYS],["CYQKL",this.CYQKL],["SCR",this.SCR],["ASR",this.ASR],["SAR",this.SAR],["TJCJL",this.TJCJL],["量比",this.VOLRate],["平均K线",this.HeikinAshi],["ADL",this.ADL],["SQJZ",this.SQJZ],["XT",this.XT],["CFJT",this.CFJT],["CYX",this.CYX],["WAVE",this.WAVE],["VOL-TDX",this.VOL_TDX],["EMPTY",this.EMPTY],["神奇九转",this.NineTurns],["EMA",this.EMA3],["EMA4",this.EMA4],["EMA5",this.EMA5],["EMA6",this.EMA6],["散户线",this.ShareholderCount],["NXTS",this.NXTS],["FKX",this.FKX],["两融资金",this.Margin4],["ZSDB",this.ZSDB],["CJL2",this.CJL],["ASI",this.ASI],["DC",this.DC],["DEMA",this.DEMA],["VWAP",this.VWAP],["飞龙四式",this.Dragon4_Main],["飞龙四式-附图",this.Dragon4_Fig],["资金分析",this.FundsAnalysis],["融资占比",this.MarginProportion],["负面新闻",this.NewsNegative],["涨跌趋势",this.UpDownAnalyze],["北上资金",this.HK2SHSZ],["股东人数",this.ShareHolder],["两融余额",this.Margin2],["两融余额2",this.Margin3],["Zealink-资金吸筹",this.Zealink_Index1],["Zealink-牛熊区间",this.Zealink_Index2],["Zealink-持仓信号",this.Zealink_Index3],["Zealink-增减持",this.Zealink_Index4],["Zealink-大宗交易",this.Zealink_Index5],["Zealink-信托持股",this.Zealink_Index6],["Zealink-官网新闻",this.Zealink_Index7],["Zealink-高管要闻",this.Zealink_Index8],["Zealink-股权质押",this.Zealink_Index9],["Zealink-操盘BS点",this.Zealink_Index10],["Zealink-操盘BS点2",this.Zealink_Index11],["放心股-操盘BS点",this.FXG_BSPoint],["放心股-涨停多空线",this.FXG_INDEX],["放心股-涨停吸筹区",this.FXG_INDEX2],["放心股-量能黄金点",this.FXG_INDEX3],["五彩K线-十字星",this.COLOR_KSTAR1],["五彩K线-早晨之星",this.COLOR_KSTAR2],["五彩K线-黄昏之星",this.COLOR_KSTAR3],["五彩K线-长十字",this.COLOR_SHI1],["五彩K线-身怀六甲",this.COLOR_K220],["五彩K线-三个白武士",this.COLOR_K300],["五彩K线-三只乌鸦",this.COLOR_K310],["五彩K线-光头阳线",this.COLOR_K380],["五彩K线-光脚阴线",this.COLOR_K390],["五彩K线-垂死十字",this.COLOR_K134],["五彩K线-早晨十字星",this.COLOR_K140],["五彩K线-黄昏十字星",this.COLOR_K150],["五彩K线-射击之星",this.COLOR_K160],["五彩K线-倒转锤头",this.COLOR_K165],["五彩K线-锤头",this.COLOR_K170],["五彩K线-吊颈",this.COLOR_K180],["五彩K线-穿头破脚",this.COLOR_K190],["五彩K线-出水芙蓉",this.COLOR_CSFR],["五彩K线-乌云盖顶",this.COLOR_WYGD],["五彩K线-曙光初现",this.COLOR_SGCJ],["五彩K线-十字胎",this.COLOR_SZTAI],["五彩K线-剑",this.COLOR_SWORD],["五彩K线-平顶",this.COLOR_PINGDING],["五彩K线-平底",this.COLOR_PINGDI],["五彩K线-大阳烛",this.COLOR_DAYANZHU],["五彩K线-大阴烛",this.COLOR_DAYINGZHU],["五彩K线-好友反攻",this.COLOR_HYFG],["五彩K线-跳空缺口",this.COLOR_TKQK],["五彩K线-双飞乌鸦",this.COLOR_SFWY],["五彩K线-上升三部曲",this.COLOR_SSSBQ],["五彩K线-下跌三部曲",this.COLOR_XDSBQ],["五彩K线-长下影",this.COLOR_CHXY],["五彩K线-长上影",this.COLOR_CHSY],["五彩K线-分离",this.COLOR_FENLI],["交易系统-BIAS",this.TRADE_BIAS],["交易系统-CCI",this.TRADE_CCI],["交易系统-DMI",this.TRADE_DMI],["交易系统-KD",this.TRADE_KD],["交易系统-BOLL",this.TRADE_BOLL],["交易系统-KDJ",this.TRADE_KDJ],["交易系统-MA",this.TRADE_MA],["交易系统-MACD",this.TRADE_MACD],["交易系统-MTM",this.TRADE_MTM],["交易系统-PSY",this.TRADE_PSY],["交易系统-ROC",this.TRADE_ROC],["交易系统-RSI",this.TRADE_RSI],["交易系统-VR",this.TRADE_VR],["交易系统-DPSJ",this.TRADE_DPSJ],["TEST",this.TEST]])}J.AddIndex=function(r){for(var n in r)rC.Add(r[n])};J.prototype.Get=function(r){var n=rC.Get(r);if(n)return n;var e=this.DataMap.get(r);return e?e():null};J.prototype.Search=function(r){var n=[],e=new RegExp(r,"i");return this.DataMap.forEach(function(t,a){a.indexOf("交易系统-")!=0&&a.indexOf("五彩K线-")!=0&&a.search(e)>=0&&n.push(a)}),n};J.prototype.MA=function(){var r={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"}],Script:`MA1:MA(CLOSE,M1);
MA2:MA(CLOSE,M2);
MA3:MA(CLOSE,M3);`};return r};J.prototype.MA4=function(){var r={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"}],Script:`MA1:MA(CLOSE,M1);
MA2:MA(CLOSE,M2);
MA3:MA(CLOSE,M3);
MA4:MA(CLOSE,M4);`};return r};J.prototype.MA5=function(){var r={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"}],Script:`MA1:MA(CLOSE,M1);
MA2:MA(CLOSE,M2);
MA3:MA(CLOSE,M3);
MA4:MA(CLOSE,M4);
MA5:MA(CLOSE,M5);`};return r};J.prototype.MA6=function(){var r={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"},{Name:"MA6",DynamicName:"MA{M6}"}],Script:`MA1:MA(CLOSE,M1);
MA2:MA(CLOSE,M2);
MA3:MA(CLOSE,M3);
MA4:MA(CLOSE,M4);
MA5:MA(CLOSE,M5);
MA6:MA(CLOSE,M6);`};return r};J.prototype.MA7=function(){var r={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0},{Name:"M7",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"},{Name:"MA6",DynamicName:"MA{M6}"},{Name:"MA7",DynamicName:"MA{M7}"}],Script:`MA1:MA(CLOSE,M1);
MA2:MA(CLOSE,M2);
MA3:MA(CLOSE,M3);
MA4:MA(CLOSE,M4);
MA5:MA(CLOSE,M5);
MA6:MA(CLOSE,M6);
MA7:MA(CLOSE,M7);`};return r};J.prototype.MA8=function(){var r={Name:"MA",Description:"均线",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0},{Name:"M7",Value:0},{Name:"M8",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"},{Name:"MA6",DynamicName:"MA{M6}"},{Name:"MA7",DynamicName:"MA{M7}"},{Name:"MA8",DynamicName:"MA{M8}"}],Script:`MA1:MA(CLOSE,M1);
MA2:MA(CLOSE,M2);
MA3:MA(CLOSE,M3);
MA4:MA(CLOSE,M4);
MA5:MA(CLOSE,M5);
MA6:MA(CLOSE,M6);
MA7:MA(CLOSE,M7);
MA8:MA(CLOSE,M8);`};return r};J.prototype.EMA3=function(){var r={Name:"EMA",Description:"指数移动平均值",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"}],Script:`MA1:EMA(CLOSE,M1);
MA2:EMA(CLOSE,M2);
MA3:EMA(CLOSE,M3);`};return r};J.prototype.EMA4=function(){var r={Name:"EMA",Description:"指数移动平均值",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"}],Script:`MA1:EMA(CLOSE,M1);
MA2:EMA(CLOSE,M2);
MA3:EMA(CLOSE,M3);
MA4:EMA(CLOSE,M4);`};return r};J.prototype.EMA5=function(){var r={Name:"EMA",Description:"指数移动平均值",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"}],Script:`MA1:EMA(CLOSE,M1);
MA2:EMA(CLOSE,M2);
MA3:EMA(CLOSE,M3);
MA4:EMA(CLOSE,M4);
MA5:EMA(CLOSE,M5);`};return r};J.prototype.EMA6=function(){var r={Name:"EMA",Description:"指数移动平均值",IsMainIndex:!0,StringFormat:2,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20},{Name:"M4",Value:60},{Name:"M5",Value:0},{Name:"M6",Value:0}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"},{Name:"MA3",DynamicName:"MA{M3}"},{Name:"MA4",DynamicName:"MA{M4}"},{Name:"MA5",DynamicName:"MA{M5}"},{Name:"MA6",DynamicName:"MA{M6}"}],Script:`MA1:EMA(CLOSE,M1);
MA2:EMA(CLOSE,M2);
MA3:EMA(CLOSE,M3);
MA4:EMA(CLOSE,M4);
MA5:EMA(CLOSE,M5);
MA6:EMA(CLOSE,M6);`};return r};J.prototype.BOLL=function(){var r={Name:"BOLL",Description:"布林线",IsMainIndex:!0,Args:[{Name:"M",Value:20}],Script:`BOLL:MA(CLOSE,M);
UB:BOLL+2*STD(CLOSE,M);
LB:BOLL-2*STD(CLOSE,M);`};return r};J.prototype.BOLL2=function(){var r={Name:"BOLL2",Description:"布林线",IsMainIndex:!1,KLineType:0,Args:[{Name:"M",Value:20}],Script:`BOLL:MA(CLOSE,M);
UB:BOLL+2*STD(CLOSE,M);
LB:BOLL-2*STD(CLOSE,M);`};return r};J.prototype.BBI=function(){var r={Name:"BBI",Description:"多空均线",IsMainIndex:!0,Args:[{Name:"M1",Value:3},{Name:"M2",Value:6},{Name:"M3",Value:12},{Name:"M4",Value:24}],Script:"BBI:(MA(CLOSE,M1)+MA(CLOSE,M2)+MA(CLOSE,M3)+MA(CLOSE,M4))/4;"};return r};J.prototype.DKX=function(){var r={Name:"DKX",Description:"多空线",IsMainIndex:!1,Args:[{Name:"M",Value:10}],Script:`MID:=(3*CLOSE+LOW+OPEN+HIGH)/6;
DKX:(20*MID+19*REF(MID,1)+18*REF(MID,2)+17*REF(MID,3)+
16*REF(MID,4)+15*REF(MID,5)+14*REF(MID,6)+
13*REF(MID,7)+12*REF(MID,8)+11*REF(MID,9)+
10*REF(MID,10)+9*REF(MID,11)+8*REF(MID,12)+
7*REF(MID,13)+6*REF(MID,14)+5*REF(MID,15)+
4*REF(MID,16)+3*REF(MID,17)+2*REF(MID,18)+REF(MID,20))/210;
MADKX:MA(DKX,M);`};return r};J.prototype.MIKE=function(){var r={Name:"MIKE",Description:"麦克支撑压力",IsMainIndex:!0,Args:[{Name:"N",Value:10}],Script:`HLC:=REF(MA((HIGH+LOW+CLOSE)/3,N),1);
HV:=EMA(HHV(HIGH,N),3);
LV:=EMA(LLV(LOW,N),3);
STOR:EMA(2*HV-LV,3);
MIDR:EMA(HLC+HV-LV,3);
WEKR:EMA(HLC*2-LV,3);
WEKS:EMA(HLC*2-HV,3);
MIDS:EMA(HLC-HV+LV,3);
STOS:EMA(2*LV-HV,3);`};return r};J.prototype.PBX=function(){var r={Name:"PBX",Description:"瀑布线",IsMainIndex:!0,Args:[{Name:"M1",Value:4},{Name:"M2",Value:6},{Name:"M3",Value:9},{Name:"M4",Value:13},{Name:"M5",Value:18},{Name:"M6",Value:24}],Script:`PBX1:(EMA(CLOSE,M1)+MA(CLOSE,M1*2)+MA(CLOSE,M1*4))/3;
PBX2:(EMA(CLOSE,M2)+MA(CLOSE,M2*2)+MA(CLOSE,M2*4))/3;
PBX3:(EMA(CLOSE,M3)+MA(CLOSE,M3*2)+MA(CLOSE,M3*4))/3;
PBX4:(EMA(CLOSE,M4)+MA(CLOSE,M4*2)+MA(CLOSE,M4*4))/3;
PBX5:(EMA(CLOSE,M5)+MA(CLOSE,M5*2)+MA(CLOSE,M5*4))/3;
PBX6:(EMA(CLOSE,M6)+MA(CLOSE,M6*2)+MA(CLOSE,M6*4))/3;`};return r};J.prototype.ENE=function(){var r={Name:"ENE",Description:"轨道线",IsMainIndex:!0,Args:[{Name:"N",Value:25},{Name:"M1",Value:6},{Name:"M2",Value:6}],Script:`UPPER:(1+M1/100)*MA(CLOSE,N);
LOWER:(1-M2/100)*MA(CLOSE,N);
ENE:(UPPER+LOWER)/2;`};return r};J.prototype.MACD=function(){var r={Name:"MACD",Description:"平滑异同平均",IsMainIndex:!1,Args:[{Name:"SHORT",Value:12},{Name:"LONG",Value:26},{Name:"MID",Value:9}],Script:`DIF:EMA(CLOSE,SHORT)-EMA(CLOSE,LONG);
DEA:EMA(DIF,MID);
MACD:(DIF-DEA)*2,COLORSTICK;`};return r};J.prototype.MACD2=function(){var r={Name:"MACD",Description:"平滑异同平均",IsMainIndex:!1,Args:[{Name:"SHORT",Value:12},{Name:"LONG",Value:26},{Name:"MID",Value:9}],Script:`DIF2:=EMA(CLOSE,SHORT)-EMA(CLOSE,LONG);
DEA2:=EMA(DIF2,MID);
MACD:(DIF2-DEA2)*2,COLORSTICK,LINETHICK50;
DIF:DIF2;
DEA:DEA2;`};return r};J.prototype.KDJ=function(){var r={Name:"KDJ",Description:"随机指标",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:`RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;
K:SMA(RSV,M1,1);
D:SMA(K,M2,1);
J:3*K-2*D;`};return r};J.prototype.VOL=function(){var r={Name:"VOL",Description:"成交量",IsMainIndex:!1,FloatPrecision:0,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10}],OutName:[{Name:"MA1",DynamicName:"MA{M1}"},{Name:"MA2",DynamicName:"MA{M2}"}],Script:`VOL:VOL,VOLSTICK;
MA1:MA(VOL,M1);
MA2:MA(VOL,M2);`};return r};J.prototype.VOL_OVERLAY=function(){var r={Name:"VOL",Description:"成交量",IsMainIndex:!1,FloatPrecision:0,Script:"VOL:VOL,VOLSTICK,UPCOLOR(RGBA(255,0,0,0.3)),DOWNCOLOR(RGBA(0,255,0,0.3));"};return r};J.prototype.VOL_TDX=function(){var r={Name:"VOL-TDX",Description:"成交量(虚拟)",IsMainIndex:!1,FloatPrecision:0,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10}],Script:`TOTAL:=IF(PERIOD=1,5,IF(PERIOD=2,15,IF(PERIOD=3,30,IF(PERIOD=4,60,IF(PERIOD=5,TOTALFZNUM,1)))));
MTIME:=MOD(FROMOPEN,TOTAL);
CTIME:=IF(MTIME<0.5,TOTAL,MTIME);
VVOL:IF((CURRBARSCOUNT=1 AND DYNAINFO(8)>1),VOL*(TOTAL+3)/(CTIME+3),DRAWNULL),NODRAW;
STICKLINE((CURRBARSCOUNT=1 AND DYNAINFO(8)>1),VVOL,0,-1,-1),COLORYELLOW;
VOLUME:VOL,VOLSTICK;
MAVOL1:MA(VOLUME,M1);
MAVOL2:MA(VOLUME,M2);`};return r};J.prototype.RSI=function(){var r={Name:"RSI",Description:"相对强弱指标",IsMainIndex:!1,Args:[{Name:"N1",Value:6},{Name:"N2",Value:12},{Name:"N3",Value:24}],Script:`LC:=REF(CLOSE,1);
RSI1:SMA(MAX(CLOSE-LC,0),N1,1)/SMA(ABS(CLOSE-LC),N1,1)*100;
RSI2:SMA(MAX(CLOSE-LC,0),N2,1)/SMA(ABS(CLOSE-LC),N2,1)*100;
RSI3:SMA(MAX(CLOSE-LC,0),N3,1)/SMA(ABS(CLOSE-LC),N3,1)*100;`};return r};J.prototype.BRAR=function(){var r={Name:"BRAR",Description:"情绪指标",IsMainIndex:!1,Args:[{Name:"N",Value:26}],Script:`BR:SUM(MAX(0,HIGH-REF(CLOSE,1)),N)/SUM(MAX(0,REF(CLOSE,1)-LOW),N)*100;
AR:SUM(HIGH-OPEN,N)/SUM(OPEN-LOW,N)*100;`};return r};J.prototype.WR=function(){var r={Name:"WR",Description:"威廉指标",IsMainIndex:!1,Args:[{Name:"N",Value:10},{Name:"N1",Value:6}],Script:`WR1:100*(HHV(HIGH,N)-CLOSE)/(HHV(HIGH,N)-LLV(LOW,N));
WR2:100*(HHV(HIGH,N1)-CLOSE)/(HHV(HIGH,N1)-LLV(LOW,N1));`};return r};J.prototype.BIAS=function(){var r={Name:"BIAS",Description:"乖离率",IsMainIndex:!1,Args:[{Name:"N1",Value:6},{Name:"N2",Value:12},{Name:"N3",Value:24}],Script:`BIAS1 :(CLOSE-MA(CLOSE,N1))/MA(CLOSE,N1)*100;
BIAS2 :(CLOSE-MA(CLOSE,N2))/MA(CLOSE,N2)*100;
BIAS3 :(CLOSE-MA(CLOSE,N3))/MA(CLOSE,N3)*100;`};return r};J.prototype.OBV=function(){var r={Name:"OBV",Description:"累积能量线",IsMainIndex:!1,Args:[{Name:"M",Value:30}],Script:`VA:=IF(CLOSE>REF(CLOSE,1),VOL,-VOL);
OBV:SUM(IF(CLOSE==REF(CLOSE,1),0,VA),0);
MAOBV:MA(OBV,M);`};return r};J.prototype.DMI=function(){var r={Name:"DMI",Description:"趋向指标",IsMainIndex:!1,Args:[{Name:"N",Value:14},{Name:"MM",Value:6}],Script:`MTR:=EXPMEMA(MAX(MAX(HIGH-LOW,ABS(HIGH-REF(CLOSE,1))),ABS(REF(CLOSE,1)-LOW)),N);
HD :=HIGH-REF(HIGH,1);
LD :=REF(LOW,1)-LOW;
DMP:=EXPMEMA(IF(HD>0&&HD>LD,HD,0),N);
DMM:=EXPMEMA(IF(LD>0&&LD>HD,LD,0),N);
PDI: DMP*100/MTR;
MDI: DMM*100/MTR;
ADX: EXPMEMA(ABS(MDI-PDI)/(MDI+PDI)*100,MM);
ADXR:EXPMEMA(ADX,MM);`};return r};J.prototype.CR=function(){var r={Name:"CR",Description:"带状能量线",IsMainIndex:!1,Args:[{Name:"N",Value:26},{Name:"M1",Value:10},{Name:"M2",Value:20},{Name:"M3",Value:40},{Name:"M4",Value:62}],Script:`MID:=REF(HIGH+LOW,1)/2;
CR:SUM(MAX(0,HIGH-MID),N)/SUM(MAX(0,MID-LOW),N)*100;
MA1:REF(MA(CR,M1),M1/2.5+1);
MA2:REF(MA(CR,M2),M2/2.5+1);
MA3:REF(MA(CR,M3),M3/2.5+1);
MA4:REF(MA(CR,M4),M4/2.5+1);`};return r};J.prototype.PSY=function(){var r={Name:"PSY",Description:"心理线",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:"PSY:COUNT(CLOSE>REF(CLOSE,1),N)/N*100;\rPSYMA:MA(PSY,M);"};return r};J.prototype.CCI=function(){var r={Name:"CCI",Description:"商品路径指标",IsMainIndex:!1,Args:[{Name:"N",Value:14}],Script:`TYP:=(HIGH+LOW+CLOSE)/3;
CCI:(TYP-MA(TYP,N))/(0.015*AVEDEV(TYP,N));`};return r};J.prototype.DMA=function(){var r={Name:"DMA",Description:"平均差",IsMainIndex:!1,Args:[{Name:"N1",Value:10},{Name:"N2",Value:50},{Name:"M",Value:10}],Script:`DIF:MA(CLOSE,N1)-MA(CLOSE,N2);
DIFMA:MA(DIF,M);`};return r};J.prototype.TRIX=function(){var r={Name:"TRIX",Description:"三重指数平均线",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:9}],Script:`MTR:=EMA(EMA(EMA(CLOSE,N),N),N);
TRIX:(MTR-REF(MTR,1))/REF(MTR,1)*100;
MATRIX:MA(TRIX,M) ;`};return r};J.prototype.VR=function(){var r={Name:"VR",Description:"成交量变异率",IsMainIndex:!1,Args:[{Name:"N",Value:26},{Name:"M",Value:6}],Script:`TH:=SUM(IF(CLOSE>REF(CLOSE,1),VOL,0),N);
TL:=SUM(IF(CLOSE<REF(CLOSE,1),VOL,0),N);
TQ:=SUM(IF(CLOSE==REF(CLOSE,1),VOL,0),N);
VR:100*(TH*2+TQ)/(TL*2+TQ);
MAVR:MA(VR,M);`};return r};J.prototype.EMV=function(){var r={Name:"EMV",Description:"简易波动指标",IsMainIndex:!1,Args:[{Name:"N",Value:14},{Name:"M",Value:9}],Script:`VOLUME:=MA(VOL,N)/VOL;
MID:=100*(HIGH+LOW-REF(HIGH+LOW,1))/(HIGH+LOW);
EMV:MA(MID*VOLUME*(HIGH-LOW)/MA(HIGH-LOW,N),N);
MAEMV:MA(EMV,M);`};return r};J.prototype.ROC=function(){var r={Name:"ROC",Description:"变动率指标",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:`ROC:100*(CLOSE-REF(CLOSE,N))/REF(CLOSE,N);
MAROC:MA(ROC,M);`};return r};J.prototype.MTM=function(){var r={Name:"MTM",Description:"动量线",IsMainIndex:!1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:`MTM:CLOSE-REF(CLOSE,N);
MAMTM:MA(MTM,M);`};return r};J.prototype.FSL=function(){var r={Name:"FSL",Description:"分水岭",IsMainIndex:!1,Args:[],Script:`SWL:(EMA(CLOSE,5)*7+EMA(CLOSE,10)*3)/10;
SWS:DMA(EMA(CLOSE,12),MAX(1,100*(SUM(VOL,5)/(3*CAPITAL))));`};return r};J.prototype.CYR=function(){var r={Name:"CYR",Description:"市场强弱",IsMainIndex:!1,Args:[{Name:"N",Value:13},{Name:"M",Value:5}],Script:`DIVE:=0.01*EMA(AMOUNT,N)/EMA(VOL,N);
CYR:(DIVE/REF(DIVE,1)-1)*100;
MACYR:MA(CYR,M);`};return r};J.prototype.MASS=function(){var r={Name:"MASS",Description:"市场强弱",IsMainIndex:!1,Args:[{Name:"N1",Value:9},{Name:"N2",Value:25},{Name:"M",Value:6}],Script:`MASS:SUM(MA(HIGH-LOW,N1)/MA(MA(HIGH-LOW,N1),N1),N2);
MAMASS:MA(MASS,M);`};return r};J.prototype.WAD=function(){var r={Name:"WAD",Description:"威廉多空力度线",IsMainIndex:!1,Args:[{Name:"M",Value:30}],Script:`MIDA:=CLOSE-MIN(REF(CLOSE,1),LOW);
MIDB:=IF(CLOSE<REF(CLOSE,1),CLOSE-MAX(REF(CLOSE,1),HIGH),0);
WAD:SUM(IF(CLOSE>REF(CLOSE,1),MIDA,MIDB),0);
MAWAD:MA(WAD,M);`};return r};J.prototype.CHO=function(){var r={Name:"CHO",Description:"佳庆指标",IsMainIndex:!1,Args:[{Name:"N1",Value:10},{Name:"N2",Value:20},{Name:"M",Value:6}],Script:`MID:=SUM(VOL*(2*CLOSE-HIGH-LOW)/(HIGH+LOW),0);
CHO:MA(MID,N1)-MA(MID,N2);
MACHO:MA(CHO,M);`};return r};J.prototype.ADTM=function(){var r={Name:"ADTM",Description:"动态买卖气指标",IsMainIndex:!1,Args:[{Name:"N",Value:23},{Name:"M",Value:8}],Script:`DTM:=IF(OPEN<=REF(OPEN,1),0,MAX((HIGH-OPEN),(OPEN-REF(OPEN,1))));
DBM:=IF(OPEN>=REF(OPEN,1),0,MAX((OPEN-LOW),(OPEN-REF(OPEN,1))));
STM:=SUM(DTM,N);
SBM:=SUM(DBM,N);
ADTM:IF(STM>SBM,(STM-SBM)/STM,IF(STM==SBM,0,(STM-SBM)/SBM));
MAADTM:MA(ADTM,M);`};return r};J.prototype.HSL=function(){var r={Name:"HSL",Description:"换手线",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:`HSL:IF((SETCODE==0||SETCODE==1),100*VOL,VOL)/(FINANCE(7)/100);
MAHSL:MA(HSL,N);`};return r};J.prototype.BIAS36=function(){var r={Name:"BIAS36",Description:"三六乖离",IsMainIndex:!1,Args:[{Name:"M",Value:6}],Script:`BIAS36:MA(CLOSE,3)-MA(CLOSE,6);
BIAS612:MA(CLOSE,6)-MA(CLOSE,12);
MABIAS:MA(BIAS36,M);`};return r};J.prototype.BIAS_QL=function(){var r={Name:"BIAS_QL",Description:"乖离率-传统版",IsMainIndex:!1,Args:[{Name:"N",Value:6},{Name:"M",Value:6}],Script:`BIAS :(CLOSE-MA(CLOSE,N))/MA(CLOSE,N)*100;
BIASMA :MA(BIAS,M);`};return r};J.prototype.DPO=function(){var r={Name:"DPO",Description:"区间震荡线",IsMainIndex:!1,Args:[{Name:"N",Value:20},{Name:"M",Value:6}],Script:`DPO:CLOSE-REF(MA(CLOSE,N),N/2+1);
MADPO:MA(DPO,M);`};return r};J.prototype.OSC=function(){var r={Name:"OSC",Description:"变动速率线",IsMainIndex:!1,Args:[{Name:"N",Value:20},{Name:"M",Value:6}],Script:`OSC:100*(CLOSE-MA(CLOSE,N));
MAOSC:EXPMEMA(OSC,M);`};return r};J.prototype.ATR=function(){var r={Name:"ATR",Description:"真实波幅",IsMainIndex:!1,Args:[{Name:"N",Value:14}],Script:`MTR:MAX(MAX((HIGH-LOW),ABS(REF(CLOSE,1)-HIGH)),ABS(REF(CLOSE,1)-LOW));
ATR:MA(MTR,N);`};return r};J.prototype.NVI=function(){var r={Name:"ATR",Description:"负成交量",IsMainIndex:!1,Args:[{Name:"N",Value:72}],Script:`NVI:100*MULAR(IF(V<REF(V,1),C/REF(C,1),1),0);
MANVI:MA(NVI,N);`};return r};J.prototype.PVI=function(){var r={Name:"PVI",Description:"正成交量",IsMainIndex:!1,Args:[{Name:"N",Value:72}],Script:`NVI:100*MULAR(IF(V>REF(V,1),C/REF(C,1),1),0);
MANVI:MA(NVI,N);`};return r};J.prototype.UOS=function(){var r={Name:"UOS",Description:"终极指标",IsMainIndex:!1,Args:[{Name:"N1",Value:7},{Name:"N2",Value:14},{Name:"N3",Value:28},{Name:"M",Value:6}],Script:`TH:=MAX(HIGH,REF(CLOSE,1));
TL:=MIN(LOW,REF(CLOSE,1));
ACC1:=SUM(CLOSE-TL,N1)/SUM(TH-TL,N1);
ACC2:=SUM(CLOSE-TL,N2)/SUM(TH-TL,N2);
ACC3:=SUM(CLOSE-TL,N3)/SUM(TH-TL,N3);
UOS:(ACC1*N2*N3+ACC2*N1*N3+ACC3*N1*N2)*100/(N1*N2+N1*N3+N2*N3);
MAUOS:EXPMEMA(UOS,M);`};return r};J.prototype.CYW=function(){var r={Name:"CYW",Description:"主力控盘",IsMainIndex:!1,Args:[],Script:`VAR1:=CLOSE-LOW;
VAR2:=HIGH-LOW;
VAR3:=CLOSE-HIGH;
VAR4:=IF(HIGH>LOW,(VAR1/VAR2+VAR3/VAR2)*VOL,0);
CYW: SUM(VAR4,10)/10000, COLORSTICK;`};return r};J.prototype.LON=function(){var r={Name:"LON",Description:"龙系长线",IsMainIndex:!1,Args:[{Name:"N",Value:10}],Script:`LC := REF(CLOSE,1);
VID := SUM(VOL,2)/(((HHV(HIGH,2)-LLV(LOW,2)))*100);
RC := (CLOSE-LC)*VID;
LONG := SUM(RC,0);
DIFF := SMA(LONG,10,1);
DEA := SMA(LONG,20,1);
LON : DIFF-DEA;
LONMA : MA(LON,10);
LONT : LON, COLORSTICK;`};return r};J.prototype.NDB=function(){var r={Name:"NDB",Description:"脑电波",IsMainIndex:!1,Args:[{Name:"P1",Value:5},{Name:"P2",Value:10}],Script:`HH:=IF(C/REF(C,1)>1.098 AND L>REF(H,1),2*C-REF(C,1)-H,2*C-H-L);
V1:= BARSCOUNT(C) - 1;
V2:= 2 * REF(C, V1) - REF(H, V1) - REF(L, V1);
DK: SUM(HH, 0) + V2;
MDK5: MA(DK, P1);
MDK10: MA(DK, P2);`};return r};J.prototype.SKDJ=function(){var r={Name:"SKDJ",Description:"慢速随机指标",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M",Value:3}],Script:`LOWV:=LLV(LOW,N);
HIGHV:=HHV(HIGH,N);
RSV:=EMA((CLOSE-LOWV)/(HIGHV-LOWV)*100,M);
K:EMA(RSV,M);
D:MA(K,M);`};return r};J.prototype.KD=function(){var r={Name:"KD",Description:"随机指标KD",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:`RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;
K:SMA(RSV,M1,1);
D:SMA(K,M2,1);`};return r};J.prototype.FKX=function(){var r={Name:"FKX",Description:"反K线",IsMainIndex:!0,Args:[],Script:"DRAWKLINE(-LOW, -OPEN, -HIGH, -CLOSE);"};return r};J.prototype.DKCOL=function(){var r={Name:"DKCOL",Description:"多空能量柱(适用于分时主图)",IsMainIndex:!0,Args:[{Name:"N",Value:5}],Script:`FF:=(C-REF(C,N))/REF(C,N);
STICKLINE(FF>0,DYNAINFO(3),DYNAINFO(3)*(1+FF),0.5,0),COLORRED;
STICKLINE(FF<0,DYNAINFO(3),DYNAINFO(3)*(1+FF),0.5,0),COLORGREEN;`};return r};J.prototype.UDL=function(){var r={Name:"UDL",Description:"引力线",IsMainIndex:!1,Args:[{Name:"N1",Value:3},{Name:"N2",Value:5},{Name:"N3",Value:10},{Name:"N4",Value:20},{Name:"M",Value:6}],Script:`UDL:(MA(CLOSE,N1)+MA(CLOSE,N2)+MA(CLOSE,N3)+MA(CLOSE,N4))/4;
MAUDL:MA(UDL,M);`};return r};J.prototype.MFI=function(){var r={Name:"MFI",Description:"资金流量指标",IsMainIndex:!1,Args:[{Name:"N",Value:14},{Name:"N2",Value:6}],Script:`TYP := (HIGH + LOW + CLOSE)/3;
V1:=SUM(IF(TYP>REF(TYP,1),TYP*VOL,0),N)/SUM(IF(TYP<REF(TYP,1),TYP*VOL,0),N);
MFI:100-(100/(1+V1));`};return r};J.prototype.LWR=function(){var r={Name:"LWR",Description:"LWR威廉指标",IsMainIndex:!1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:`RSV:= (HHV(HIGH,N)-CLOSE)/(HHV(HIGH,N)-LLV(LOW,N))*100;
LWR1:SMA(RSV,M1,1);
LWR2:SMA(LWR1,M2,1);`};return r};J.prototype.MARSI=function(){var r={Name:"MARSI",Description:"相对强弱平均线",IsMainIndex:!1,Args:[{Name:"M1",Value:10},{Name:"M2",Value:6}],Script:`DIF:=CLOSE-REF(CLOSE,1);
VU:=IF(DIF>=0,DIF,0);
VD:=IF(DIF<0,-DIF,0);
MAU1:=MEMA(VU,M1);
MAD1:=MEMA(VD,M1);
MAU2:=MEMA(VU,M2);
MAD2:=MEMA(VD,M2);
RSI10:MA(100*MAU1/(MAU1+MAD1),M1);
RSI6:MA(100*MAU2/(MAU2+MAD2),M2);`};return r};J.prototype.CYD=function(){var r={Name:"CYD",Description:"承接因子",IsMainIndex:!1,Args:[{Name:"N",Value:21}],Script:`CYDS:WINNER(CLOSE)/(VOL/CAPITAL);
CYDN:WINNER(CLOSE)/MA(VOL/CAPITAL,N);`};return r};J.prototype.CYF=function(){var r={Name:"CYF",Description:"市场能量",IsMainIndex:!1,Args:[{Name:"N",Value:21}],Script:"CYF:100-100/(1+EMA(HSL,N));"};return r};J.prototype.TAPI=function(){var r={Name:"TAPI",Description:"加权指数成交值",IsMainIndex:!1,Args:[{Name:"M",Value:6}],Script:`TAPI:AMOUNT/INDEXC;
MATAIP:MA(TAPI,M);`};return r};J.prototype.VMACD=function(){var r={Name:"VMACD",Description:"量平滑异同平均",IsMainIndex:!1,Args:[{Name:"SHORT",Value:12},{Name:"LONG",Value:26},{Name:"MID",Value:9}],Script:`DIF:EMA(VOL,SHORT)-EMA(VOL,LONG);
DEA:EMA(DIF,MID);
MACD:DIF-DEA,COLORSTICK;`};return r};J.prototype.QACD=function(){var r={Name:"QACD",Description:"快速异同平均",IsMainIndex:!1,Args:[{Name:"N1",Value:12},{Name:"N2",Value:26},{Name:"M",Value:9}],Script:`DIF:EMA(CLOSE,N1)-EMA(CLOSE,N2);
MACD:EMA(DIF,M);
DDIF:DIF-MACD;`};return r};J.prototype.VPT=function(){var r={Name:"VPT",Description:"量价曲线",IsMainIndex:!1,Args:[{Name:"N",Value:51},{Name:"M",Value:6}],Script:`VPT:SUM(VOL*(CLOSE-REF(CLOSE,1))/REF(CLOSE,1),N);
MAVPT:MA(VPT,M);`};return r};J.prototype.WVAD=function(){var r={Name:"WVAD",Description:"威廉变异离散量",IsMainIndex:!1,Args:[{Name:"N",Value:24},{Name:"M",Value:6}],Script:`WVAD:SUM((CLOSE-OPEN)/(HIGH-LOW)*VOL,N)/10000;
MAWVAD:MA(WVAD,M);`};return r};J.prototype.DBQR=function(){var r={Name:"WVAD",Description:"对比强弱",IsMainIndex:!1,Args:[{Name:"N",Value:5},{Name:"M1",Value:10},{Name:"M2",Value:20},{Name:"M3",Value:60}],Script:`ZS:(INDEXC-REF(INDEXC,N))/REF(INDEXC,N);
GG:(CLOSE-REF(CLOSE,N))/REF(CLOSE,N);
MADBQR1:MA(GG,M1);
MADBQR2:MA(GG,M2);
MADBQR3:MA(GG,M3);`};return r};J.prototype.JS=function(){var r={Name:"JS",Description:"加速线",IsMainIndex:!1,Args:[{Name:"N",Value:5},{Name:"M1",Value:5},{Name:"M2",Value:10},{Name:"M3",Value:20}],Script:`JS:100*(CLOSE-REF(CLOSE,N))/(N*REF(CLOSE,N));
MAJS1:MA(JS,M1);
MAJS2:MA(JS,M2);
MAJS3:MA(JS,M3);`};return r};J.prototype.CYE=function(){var r={Name:"CYE",Description:"市场趋势",IsMainIndex:!1,Args:[],Script:`MAL:=MA(CLOSE,5);
MAS:=MA(MA(CLOSE,20),5);
CYEL:(MAL-REF(MAL,1))/REF(MAL,1)*100;
CYES:(MAS-REF(MAS,1))/REF(MAS,1)*100;`};return r};J.prototype.QR=function(){var r={Name:"QR",Description:"强弱指标",IsMainIndex:!1,Args:[{Name:"N",Value:21}],Script:`个股: (CLOSE-REF(CLOSE,N))/REF(CLOSE,N)*100; 
大盘: (INDEXC-REF(INDEXC,N))/REF(INDEXC,N)*100; 
强弱值:EMA(个股-大盘,2),COLORSTICK;`};return r};J.prototype.GDX=function(){var r={Name:"GDX",Description:"轨道线",IsMainIndex:!1,Args:[{Name:"N",Value:30},{Name:"M",Value:9}],Script:`AA:=ABS((2*CLOSE+HIGH+LOW)/4-MA(CLOSE,N))/MA(CLOSE,N); 
轨道:DMA(CLOSE,AA);
压力线:(1+M/100)*轨道; 
支撑线:(1-M/100)*轨道;`};return r};J.prototype.JLHB=function(){var r={Name:"JLHB",Description:"绝路航标",IsMainIndex:!1,Args:[{Name:"N",Value:7},{Name:"M",Value:5}],Script:`VAR1:=(CLOSE-LLV(LOW,60))/(HHV(HIGH,60)-LLV(LOW,60))*80; 
B:SMA(VAR1,N,1); 
VAR2:SMA(B,M,1); 
绝路航标:IF(CROSS(B,VAR2) AND B<40,50,0);`};return r};J.prototype.PCNT=function(){var r={Name:"PCNT",Description:"幅度比",IsMainIndex:!1,Args:[{Name:"M",Value:5}],Script:`PCNT:(CLOSE-REF(CLOSE,1))/CLOSE*100;
MAPCNT:EXPMEMA(PCNT,M);`};return r};J.prototype.BTX=function(){var r={Name:"BTX",Description:"宝塔线",IsMainIndex:!1,Args:[],Script:`B1:=REF(C,1);
B2:= REF(C, 2);
SS:= IF(C > REF(C, 1) AND REF(C, 1) >= REF(C, 2), 1, IF(C < REF(C, 1) AND REF(C, 1) <= REF(C, 2), -1, IF(C > REF(C, 2) AND REF(C, 2) > REF(C, 1), 2, IF(C < REF(C, 2) AND REF(C, 2) < REF(C, 1), -2, 0))));
SM:= IF(REF(SS, 1) <> 0, REF(SS, 1), IF(REF(SS, 2) <> 0, REF(SS, 2), IF(REF(SS, 3) <> 0, REF(SS, 3), IF(REF(SS, 5) <> 0, REF(SS, 5), IF(REF(SS, 6) <> 0, REF(SS, 6), IF(REF(SS, 7) <> 0, REF(SS, 7), 0))))));
MC:= IF(REF(SS, 1) <> 0, B2, IF(SM > 0, MIN(B1, B2), MAX(B1, B2)));
TOW1:= IF(C > REF(C, 1), C, REF(C, 1));
TOW2:= IF((SS == -1 OR SS == -2) AND SM > 0, B2, TOW1);
TOWER:= IF(TOW1 > TOW2, TOW1, TOW2);
STICKLINE(SS == 1 OR SM >= 1 AND SS == 0, B1, C, 10, 1), COLORRED;
STICKLINE(SS == -1 OR SM <= -1 AND SS == 0, B1, C, 10, 0), COLORCYAN;
STICKLINE(SS == 2, B2, C, 10, 1), COLORRED;
STICKLINE(SS == -2, B2, C, 10, 0), COLORCYAN;
STICKLINE((SS == -1 OR SS == -2) AND SM > 0, B2, B1, 10, 1), COLORRED;
STICKLINE((SS == 1 OR SS == 2) AND SM < 0, B2, B1, 10, 0), COLORCYAN;`};return r};J.prototype.AMO=function(){var r={Name:"AMO",Description:"成交金额",IsMainIndex:!1,Args:[{Name:"M1",Value:5},{Name:"M2",Value:10}],Script:`AMOW:AMOUNT/10000.0,VOLSTICK;
AMO1:MA(AMOW,M1);
AMO2:MA(AMOW,M2);`};return r};J.prototype.VRSI=function(){var r={Name:"VRSI",Description:"相对强弱量",IsMainIndex:!1,Args:[{Name:"N1",Value:6},{Name:"N2",Value:12},{Name:"N3",Value:24}],Script:`LC:=REF(VOL,1);
RSI1:SMA(MAX(VOL-LC,0),N1,1)/SMA(ABS(VOL-LC),N1,1)*100;
RSI2:SMA(MAX(VOL-LC,0),N2,1)/SMA(ABS(VOL-LC),N2,1)*100;
RSI3:SMA(MAX(VOL-LC,0),N3,1)/SMA(ABS(VOL-LC),N3,1)*100;`};return r};J.prototype.HSCOL=function(){var r={Name:"HSCOL",Description:"换手柱",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:`HSCOL:IF((SETCODE==0||SETCODE==1),100*VOL,VOL)/(FINANCE(7)/100),VOLSTICK;
MAHSL:MA(HSCOL,N);`};return r};J.prototype.DBQRV=function(){var r={Name:"DBQRV",Description:"对比强弱量(需下载日线)",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:`ZS:(INDEXV-REF(INDEXV,N))/REF(INDEXV,N);
GG:(VOL-REF(VOL,N))/REF(VOL,N);`};return r};J.prototype.DBLB=function(){var r={Name:"DBLB",Description:"对比量比(需下载日线)",IsMainIndex:!1,Args:[{Name:"N",Value:5},{Name:"M",Value:5}],Script:`GG:=VOL/SUM(REF(VOL,1),N);
ZS:=INDEXV/SUM(REF(INDEXV,1),N);
DBLB:GG/ZS;
MADBLB:MA(DBLB,M);`};return r};J.prototype.ACD=function(){var r={Name:"ACD",Description:"升降线",IsMainIndex:!1,Args:[{Name:"M",Value:20}],Script:`LC:=REF(CLOSE,1);
DIF:=CLOSE-IF(CLOSE>LC,MIN(LOW,LC),MAX(HIGH,LC));
ACD:SUM(IF(CLOSE==LC,0,DIF),0);
MAACD:EXPMEMA(ACD,M);`};return r};J.prototype.EXPMA=function(){var r={Name:"EXPMA",Description:"指数平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:12},{Name:"M2",Value:50}],Script:`EXP1:EMA(CLOSE,M1);
EXP2:EMA(CLOSE,M2);`};return r};J.prototype.EXPMA_S=function(){var r={Name:"EXPMA_S",Description:"指数平均线-副图",IsMainIndex:!1,Args:[{Name:"M1",Value:12},{Name:"M2",Value:50}],Script:`EXP1:EMA(CLOSE,M1);
EXP2:EMA(CLOSE,M2);`};return r};J.prototype.HMA=function(){var r={Name:"HMA",Description:"高价平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:`HMA1:MA(HIGH,M1);
HMA2:MA(HIGH,M2);
HMA3:MA(HIGH,M3);
HMA4:MA(HIGH,M4);
HMA5:MA(HIGH,M5);`};return r};J.prototype.LMA=function(){var r={Name:"LMA",Description:"低价平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:`LMA1:MA(LOW,M1);
LMA2:MA(LOW,M2);
LMA3:MA(LOW,M3);
LMA4:MA(LOW,M4);
LMA5:MA(LOW,M5);`};return r};J.prototype.VMA=function(){var r={Name:"VMA",Description:"变异平均线",IsMainIndex:!0,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:`VV:=(HIGH+OPEN+LOW+CLOSE)/4;
VMA1:MA(VV,M1);
VMA2:MA(VV,M2);
VMA3:MA(VV,M3);
VMA4:MA(VV,M4);
VMA5:MA(VV,M5);`};return r};J.prototype.AMV=function(){var r={Name:"AMV",Description:"成本价均线",IsMainIndex:!1,Args:[{Name:"M1",Value:6},{Name:"M2",Value:12},{Name:"M3",Value:30},{Name:"M4",Value:72},{Name:"M5",Value:144}],Script:`AMOV:=VOL*(OPEN+CLOSE)/2;
AMV1:SUM(AMOV,M1)/SUM(VOL,M1);
AMV2:SUM(AMOV,M2)/SUM(VOL,M2);
AMV3:SUM(AMOV,M3)/SUM(VOL,M3);
AMV4:SUM(AMOV,M4)/SUM(VOL,M4);`};return r};J.prototype.BBIBOLL=function(){var r={Name:"BBIBOLL",Description:"多空布林线",IsMainIndex:!0,Args:[{Name:"N",Value:11},{Name:"M",Value:6}],Script:`CV:=CLOSE;
BBIBOLL:(MA(CV,3)+MA(CV,6)+MA(CV,12)+MA(CV,24))/4;
UPR:BBIBOLL+M*STD(BBIBOLL,N);
DWN:BBIBOLL-M*STD(BBIBOLL,N);`};return r};J.prototype.ALLIGAT=function(){var r={Name:"ALLIGAT",Description:"鳄鱼线",IsMainIndex:!0,Args:[],Script:`NN:=(H+L)/2;
上唇:REF(MA(NN,5),3),COLOR40FF40;
牙齿:REF(MA(NN,8),5),COLOR0000C0;
下颚:REF(MA(NN,13),8),COLORFF4040;`};return r};J.prototype.ZX=function(){var r={Name:"ZX",Description:"重心线",IsMainIndex:!1,Args:[],Script:"AV:0.01*AMOUNT/VOL;"};return r};J.prototype.XS=function(){var r={Name:"XS",Description:"薛斯通道",IsMainIndex:!0,Args:[{Name:"N",Value:13}],Script:`VAR2:=CLOSE*VOL;
VAR3:=EMA((EMA(VAR2,3)/EMA(VOL,3)+EMA(VAR2,6)/EMA(VOL,6)+EMA(VAR2,12)/EMA(VOL,12)+EMA(VAR2,24)/EMA(VOL,24))/4,N);
SUP:1.06*VAR3;
SDN:VAR3*0.94;
VAR4:=EMA(CLOSE,9);
LUP:EMA(VAR4*1.14,5);
LDN:EMA(VAR4*0.86,5);`};return r};J.prototype.XS2=function(){var r={Name:"XS2",Description:"薛斯通道II",IsMainIndex:!0,Args:[{Name:"N",Value:102},{Name:"M",Value:7}],Script:`AA:=MA((2*CLOSE+HIGH+LOW)/4,5); 
通道1:AA*N/100; 
通道2:AA*(200-N)/100; 
CC:=ABS((2*CLOSE+HIGH+LOW)/4-MA(CLOSE,20))/MA(CLOSE,20); 
DD:=DMA(CLOSE,CC); 
通道3:(1+M/100)*DD; 
通道4:(1-M/100)*DD;`};return r};J.prototype.SG_XDT=function(){var r={Name:"SG-XDT",Description:"心电图(需下载日线)",IsMainIndex:!1,Args:[{Name:"P1",Value:5},{Name:"P2",Value:10}],Script:`QR:CLOSE/INDEXC*1000;
MQR1:MA(QR,5);
MQR2:MA(QR,10);`};return r};J.prototype.SG_SMX=function(){var r={Name:"SG-SMX",Description:"生命线(需下载日线)",IsMainIndex:!1,Args:[{Name:"N",Value:50}],Script:`H1:=HHV(HIGH,N);
L1:=LLV(LOW,N);
H2:=HHV(INDEXH,N);
L2:=LLV(INDEXL,N);
ZY:=CLOSE/INDEXC*2000;
ZY1:EMA(ZY,3);
ZY2:EMA(ZY,17);
ZY3:EMA(ZY,34);`};return r};J.prototype.SG_LB=function(){var r={Name:"SG-LB",Description:"量比(需下载日线)",IsMainIndex:!1,Args:[],Script:`ZY2:=VOL/INDEXV*1000;
量比:ZY2;
MA5:MA(ZY2,5);
MA10:MA(ZY2,10);`};return r};J.prototype.SG_PF=function(){var r={Name:"SG-PF",Description:"强势股评分(需下载日线)",IsMainIndex:!1,Args:[],Script:`ZY1:=CLOSE/INDEXC*1000;
A1:=IF(ZY1>HHV(ZY1,3),10,0);
A2:=IF(ZY1>HHV(ZY1,5),15,0);
A3:=IF(ZY1>HHV(ZY1,10),20,0);
A4:=IF(ZY1>HHV(ZY1,2),10,0);
A5:=COUNT(ZY1>REF(ZY1,1) ,9)*5;
强势股评分:A1+A2+A3+A4+A5;`};return r};J.prototype.RAD=function(){var r={Name:"RAD",Description:"威力雷达(需下载日线)",IsMainIndex:!1,Args:[{Name:"D",Value:3},{Name:"S",Value:30},{Name:"M",Value:30}],Script:`SM:=(OPEN+HIGH+CLOSE+LOW)/4;
SMID:=MA(SM,D);
IM:=(INDEXO+INDEXH+INDEXL+INDEXC)/4;
IMID:=MA(IM,D);
SI1:=(SMID-REF(SMID,1))/SMID;
II:=(IMID-REF(IMID,1))/IMID;
RADER1:SUM((SI1-II)*2,S)*1000;
RADERMA:SMA(RADER1,M,1);`};return r};J.prototype.SHT=function(){var r={Name:"SHT",Description:"龙系短线",IsMainIndex:!1,Args:[{Name:"N",Value:5}],Script:`VAR1:=MA((VOL-REF(VOL,1))/REF(VOL,1),5);
VAR2:=(CLOSE-MA(CLOSE,24))/MA(CLOSE,24)*100;
MY: VAR2*(1+VAR1);
SHT: MY, COLORSTICK;
SHTMA: MA(SHT,N);`};return r};J.prototype.ZLJC=function(){var r={Name:"ZLJC",Description:"主力进出",IsMainIndex:!1,Args:[],Script:`VAR1:=(CLOSE+LOW+HIGH)/3; 
VAR2:=SUM(((VAR1-REF(LOW,1))-(HIGH-VAR1))*VOL/100000/(HIGH-LOW),0); 
VAR3:=EMA(VAR2,1); 
JCS:VAR3; 
JCM:MA(VAR3,12); 
JCL:MA(VAR3,26);`};return r};J.prototype.ZLMM=function(){var r={Name:"ZLMM",Description:"主力买卖",IsMainIndex:!1,Args:[],Script:`LC :=REF(CLOSE,1);
RSI2:=SMA(MAX(CLOSE-LC,0),12,1)/SMA(ABS(CLOSE-LC),12,1)*100;
RSI3:=SMA(MAX(CLOSE-LC,0),18,1)/SMA(ABS(CLOSE-LC),18,1)*100;
MMS:MA(3*RSI2-2*SMA(MAX(CLOSE-LC,0),16,1)/SMA(ABS(CLOSE-LC),16,1)*100,3);
MMM:EMA(MMS,8);
MML:MA(3*RSI3-2*SMA(MAX(CLOSE-LC,0),12,1)/SMA(ABS(CLOSE-LC),12,1)*100,5);`};return r};J.prototype.SLZT=function(){var r={Name:"SLZT",Description:"神龙在天",IsMainIndex:!1,Args:[],Script:`白龙: MA(CLOSE,125);
黄龙: 白龙+2*STD(CLOSE,170);
紫龙: 白龙-2*STD(CLOSE,145);
青龙: SAR(125,1,7), LINESTICK;
VAR2:=HHV(HIGH,70);
VAR3:=HHV(HIGH,20);
红龙: VAR2*0.83;
蓝龙: VAR3*0.91;`};return r};J.prototype.ADVOL=function(){var r={Name:"ADVOL",Description:"龙系离散量",IsMainIndex:!1,Args:[],Script:`A:=SUM(((CLOSE-LOW)-(HIGH-CLOSE))*VOL/10000/(HIGH-LOW),0);
ADVOL:A;
MA1:MA(A,30);
MA2:MA(MA1,100);`};return r};J.prototype.CYC=function(){var r={Name:"CYC",Description:"成本均线",IsMainIndex:!0,Args:[{Name:"P1",Value:5},{Name:"P2",Value:13},{Name:"P3",Value:34}],Script:`JJJ:=IF(DYNAINFO(8)>0.01,0.01*DYNAINFO(10)/DYNAINFO(8),DYNAINFO(3));
DDD:=(DYNAINFO(5)<0.01 || DYNAINFO(6)<0.01);
JJJT:=IF(DDD,1,(JJJ<(DYNAINFO(5)+0.01) && JJJ>(DYNAINFO(6)-0.01)));
CYC1:IF(JJJT,0.01*EMA(AMOUNT,P1)/EMA(VOL,P1),EMA((HIGH+LOW+CLOSE)/3,P1));
CYC2:IF(JJJT,0.01*EMA(AMOUNT,P2)/EMA(VOL,P2),EMA((HIGH+LOW+CLOSE)/3,P2));
CYC3:IF(JJJT,0.01*EMA(AMOUNT,P3)/EMA(VOL,P3),EMA((HIGH+LOW+CLOSE)/3,P3));
CYC4:IF(JJJT,DMA(AMOUNT/(100*VOL),100*VOL/FINANCE(7)),EMA((HIGH+LOW+CLOSE)/3,120));`};return r};J.prototype.CYS=function(){var r={Name:"CYS",Description:"市场盈亏",IsMainIndex:!1,Args:[],Script:`CYC13:EMA(AMOUNT,13)/EMA(VOL,13);
CYS:(CLOSE-CYC13)/CYC13*100;`};return r};J.prototype.CYQKL=function(){var r={Name:"CYQKL",Description:"博弈K线长度",IsMainIndex:!1,Args:[],Script:"KL:100*(WINNER(CLOSE)-WINNER(OPEN));"};return r};J.prototype.SCR=function(){var r={Name:"SCR",Description:"筹码集中度",IsMainIndex:!1,Args:[{Name:"P1",Value:90}],Script:`A:=P1+(100-P1)/2;
B:=(100-P1)/2;
CC:=COST(A);
DD:=COST(B);
SCR:(CC-DD)/(CC+DD)*100/2;`};return r};J.prototype.ASR=function(){var r={Name:"ASR",Description:"浮筹比例",IsMainIndex:!1,Args:[],Script:"ASR:(WINNER(C*1.1)-WINNER(C*0.9))/WINNER(HHV(H,0))*100;"};return r};J.prototype.SAR=function(){var r={Name:"SAR",Description:"抛物转向",IsMainIndex:!0,Args:[{Name:"P",Value:10},{Name:"STEP",Value:2},{Name:"MAXP",Value:20}],Script:"S:SAR(P,STEP,MAXP),UPDOWNDOT;"};return r};J.prototype.TJCJL=function(){var r={Name:"太极成交量",Description:"太极成交量",IsMainIndex:!0,Args:[],Script:`总手:VOL,NODRAW;
DRAWTEXT_FIX(ISLASTBAR,0,0,0,"说明: 红色柱为吸货量,绿色为出货量,黄色为天量,蓝色为地量"),COLORGRAY;
ZZ:=IF(REF(C,1)>REF(O,1) AND O>REF(C,1)*1.014 AND C<O*1.02,1,3);
V5:=MA(V,5);
V12:=MA(V,12);
V34:=MA(V,34);
C6:=MA(C,6);
STICKLINE(VOL,0,VOL,3,0),COLORLIGRAY;
STICKLINE(CROSS(C,C6) AND V>V5*1.2 AND V>V12*1.2 AND ZZ>2 AND C>H*0.975,0,VOL,3,0),COLORRED;
STICKLINE(CROSS(C6,C) AND V>V5*1.2 AND V>V12*1.2,0,VOL,3,0),COLORGREEN;
STICKLINE(VOL>MA(VOL,5)*2 AND V>V34*3 AND C<REF(C,1)*1.05,0,VOL,3,0),COLORYELLOW;
STICKLINE(VOL<MA(VOL,5)/2 AND V<V12/2,0,VOL,3,0),COLORBLUE;
STICKLINE(VOL>MA(VOL,5)*2 AND V>V34*3 AND C<REF(C,1)*1.05 AND CROSS(C,C6) AND V>V5*1.2 AND V>V12*1.2 AND ZZ>2 AND C>H*0.975,VOL*0.5,0,3,0),COLORRED;
STICKLINE(VOL>MA(VOL,5)*2 AND V>V34*3 AND C<REF(C,1)*1.05 AND CROSS(C6,C) AND V>V5*1.2 AND V>V12*1.2,VOL*0.5,0,3,0),COLORRED;`};return r};J.prototype.Dragon4_Main=function(){var r={Name:"飞龙四式",Description:"飞龙四式",IsMainIndex:!0,Args:[{Name:"N1",Value:5},{Name:"N2",Value:10},{Name:"N3",Value:50},{Name:"N4",Value:60}],Script:`蜻蜓点水:=EMA(CLOSE,N1),COLORGRAY;
魔界:=EMA(CLOSE,N2),COLORGREEN;
水:=EMA(CLOSE,N3),COLORRED;
DRAWKLINE(HIGH,OPEN,LOW,CLOSE);
生命线:MA(CLOSE,N4),COLORBLUE,LINETHICK2;
DRAWBAND(魔界,'RGB(186,225,250)',水,'RGB(253,194,124)');
DRAWBAND(蜻蜓点水,'RGB(128,138,135)',魔界,'RGB(0,0,255)');`};return r};J.prototype.Dragon4_Fig=function(){var r={Name:"飞龙四式",Description:"飞龙四式",IsMainIndex:!1,Args:[],Script:`倍:VOL>=REF(V,1)*1.90 AND C>REF(C,1),COLORYELLOW;
低:VOL<REF(LLV(VOL,13),1),COLORGREEN;
地:VOL<REF(LLV(VOL,100),1),COLORMAGENTA; 
平:=ABS(VOL-HHV(REF(VOL,1),5))/HHV(REF(VOL,1),5)<=0.03 OR ABS(VOL-REF(VOL,1))/REF(VOL,1)<=0.03,NODRAW,COLORWHITE;
倍缩:VOL<=REF(V,1)*0.5,COLORFF8000;
梯量:COUNT(V>REF(V,1),3)==3 AND COUNT(C>O,3)==3,COLORBROWN;
缩量涨:COUNT(C>REF(C,1),2)==2 AND COUNT(V<REF(V,1),2)==2,COLORBLUE;
STICKLINE(C>=REF(C,1),V,0,2,0),COLORRED;
STICKLINE(C<REF(C,1),V,0,2,0),COLORGREEN;
STICKLINE(倍,0,V,2,0),COLORYELLOW;
STICKLINE(低,0,V,2,0),COLORGREEN;
STICKLINE(地,0,V,2,0),COLORLIMAGENTA;
STICKLINE(平,0,V,2,0),COLORGRAY;
STICKLINE(倍缩,0,V,2,0),COLORFF8000;
STICKLINE(梯量,0,V,2,0),COLORBROWN;
STICKLINE(缩量涨,0,V,2,0),COLORBLUE;`};return r};J.prototype.FundsAnalysis=function(){var r={Name:"资金分析",Description:"资金分析",IsMainIndex:!1,Args:[{Name:"M",Value:55},{Name:"N",Value:34}],Script:`LC:=REF(CLOSE,1);
RSI:=((SMA(MAX((CLOSE - LC),0),3,1) / SMA(ABS((CLOSE - LC)),3,1)) * 100);
FF:=EMA(CLOSE,3);
MA15:=EMA(CLOSE,21); DRAWTEXT(CROSS(85,RSI),75,'▼'),COLORGREEN;
VAR1:=IF(YEAR>=2038 AND MONTH>=1,0,1);
VAR2:=REF(LOW,1)*VAR1;
VAR3:=SMA(ABS(LOW-VAR2),3,1)/SMA(MAX(LOW-VAR2,0),3,1)*100*VAR1;
VAR4:=EMA(IF(CLOSE*1.3,VAR3*10,VAR3/10),3)*VAR1;
VAR5:=LLV(LOW,30)*VAR1;
VAR6:=HHV(VAR4,30)*VAR1;
VAR7:=IF(MA(CLOSE,58),1,0)*VAR1;
VAR8:=EMA(IF(LOW<=VAR5,(VAR4+VAR6*2)/2,0),3)/618*VAR7*VAR1;
吸筹A:IF(VAR8>100,100,VAR8)*VAR1,COLORFB2F3B;
{吸筹B}STICKLINE(吸筹A>-150,0,吸筹A,8,0),COLORFB2F3B;

散户线: 100*(HHV(HIGH,M)-CLOSE)/(HHV(HIGH,M)-LLV(LOW,M)),COLORAA89BD,LINETHICK2;
RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;
K:=SMA(RSV,3,1);
D:=SMA(K,3,1);
J:=3*K-2*D;
主力线:EMA(J,5),COLORF39800,LINETHICK2;
DRAWICON(CROSS(主力线,散户线),主力线,1);
DRAWICON(CROSS(散户线,主力线),主力线,2);`};return r};J.prototype.MarginProportion=function(){var r={Name:"融资占比(%)",Description:"融资占比",IsMainIndex:!1,Condition:{Period:[se.KLINE_DAY_ID]},Args:[],Script:"占比:MARGIN(2);"};return r};J.prototype.Margin2=function(){var r={Name:"两融余额",Description:"融资融券余额",IsMainIndex:!1,Condition:{Period:[se.KLINE_DAY_ID]},Args:[{Name:"N",Value:5}],Script:`T1:MARGIN(1);
        T2:MA(MARGIN(1),N);`};return r};J.prototype.Margin3=function(){var r={Name:"两融余额",Description:"融资融券余额",IsMainIndex:!1,Condition:{Period:[se.KLINE_DAY_ID]},Args:[{Name:"N",Value:5}],Script:`T1:=MARGIN(1);
        T2:=MA(MARGIN(1),N);
        STICKLINE(T1-T2>=0,0,T1-T2,50,T1>T2),COLORRED;
        STICKLINE(T1-T2<0,T1-T2,0,50,T1>T2),COLORGREEN;`};return r};J.prototype.FXG_BSPoint=function(){var r={Name:"操盘BS点",Description:"操盘BS点",IsMainIndex:!0,Args:[],Script:`MA5:MA(CLOSE,5);
        MA13:MA(CLOSE,13);
        MA21:MA(CLOSE,21);
        MA34:MA(CLOSE,34);
        {MA55:MA(CLOSE,55),COLOR0000FF;}
        {MA120:=MA(CLOSE,120),COLORFFFF00;}
        天使:=EMA(C,2),COLOR000000;
        魔鬼:=EMA(SLOPE(C,21)*20+C,42),COLOR000000;
        买:=CROSS(天使,魔鬼);
        卖:=CROSS(魔鬼,天使);
        DRAWICON(买,L*0.97,13);
        DRAWICON(卖,H*1.03,14);
        DRAWKLINE_IF(天使>=魔鬼,HIGH,CLOSE,LOW,OPEN),COLORRED;
        DRAWKLINE_IF(天使<魔鬼,HIGH,CLOSE,LOW,OPEN),COLORBLUE;
        DRAWKLINE_IF(CROSS(天使,魔鬼),HIGH,CLOSE,LOW,OPEN),COLORYELLOW;
        DRAWKLINE_IF(CROSS(魔鬼,天使),HIGH,CLOSE,LOW,OPEN),COLORBLACK;`};return r};J.prototype.FXG_INDEX=function(){var r={Name:"涨停多空线",Description:"涨停多空线",IsMainIndex:!1,Args:[],Script:`做多能量线: SMA((CLOSE-LLV(LOW,9))/(HHV(HIGH,9)-LLV(LOW,9))*100,5,1)-8,COLORRED,LINETHICK3;
做空能量线: SMA((HHV(HIGH,36)-CLOSE)/(HHV(HIGH,36)-LLV(LOW,36))*100,2,1),COLORGREEN,LINETHICK3;
20,POINTDOT,COLORF00FF0;
50,POINTDOT,COLORGREEN;
80,POINTDOT,COLORLIBLUE;`};return r};J.prototype.FXG_INDEX2=function(){var r={Name:"涨停吸筹区",Description:"涨停吸筹区",IsMainIndex:!1,Args:[],Script:`VAR0:=EMA(HHV(HIGH,500),21); 
VAR1:=EMA(HHV(HIGH,250),21);
VAR2:=EMA(HHV(HIGH,90),21); 
VAR3:=EMA(LLV(LOW,500),21); 
VAR4:=EMA(LLV(LOW,250),21); 
VAR5:=EMA(LLV(LOW,90),21);

VAR6:=EMA((VAR3*0.96+VAR4*0.96+VAR5*0.96+VAR0*0.558+VAR1*0.558+VAR2*0.558)/6,21); 
VAR7:=EMA((VAR3*1.25+VAR4*1.23+VAR5*1.2+VAR0*0.55+VAR1*0.55+VAR2*0.65)/6,21); 
VAR8:=EMA((VAR3*1.3+VAR4*1.3+VAR5*1.3+VAR0*0.68+VAR1*0.68+VAR2*0.68)/6,21); 
VAR9:=EMA((VAR6*3+VAR7*2+VAR8)/6*1.738,21); 
VAR10:=REF(LOW,1); 
VAR11:=SMA(ABS(LOW-VAR10),3,1)/SMA(MAX(LOW-VAR10,0),3,1)*100; 
VAR12:=EMA(IFF(CLOSE*1.35<=VAR9,VAR11*10,VAR11/10),3); 
VAR13:=LLV(LOW,30); 
VAR14:=HHV(VAR12,30); 
VAR15:=IFF(MA(CLOSE,58),1,0); 
VAR16:=EMA(IFF(LOW<=VAR13,(VAR12+VAR14*2)/2,0),3)/618*VAR15;

资金入场:IFF(VAR16>0,VAR16,0),LINETHICK,LINETHICK2, COLORFF0000; 

A1:IFF(资金入场>0,资金入场*1.2,0),STICK,LINETHICK5, COLORFF0000;
A2:IFF(资金入场>0,资金入场*0.8,0),STICK,LINETHICK5, COLORFF6600;
A3:IFF(资金入场>0,资金入场*0.6,0),STICK,LINETHICK5, COLORFF9900;
A4:IFF(资金入场>0,资金入场*0.4,0) ,STICK,LINETHICK5,COLORFFCC00;
A5:IFF(资金入场>0,资金入场*0.2,0) ,STICK,LINETHICK5,COLORFFFF00;`};return r};J.prototype.FXG_INDEX3=function(){var r={Name:"量能黄金点",Description:"量能黄金点",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:`A:=IFF((CLOSE>126.32),VOL,VOL); 
主力:=MA(A,4),COLORRED;
游资:=MA(A,8),COLORYELLOW;
大户:=MA(A,16),COLORF0F000;
散户:=MA(A,32),COLOR00FF00;
主比:=ABS(((主力)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLORRED;
游比:=ABS(((游资)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLORYELLOW;
大比:=ABS(((大户)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLORF0F000;
散比:=ABS(((散户)/(主力 + 游资 + 大户 + 散户))*(100)),LINESTICK,COLOR00FF00;
警戒线:MA(A,180),COLORFF66FF;
STICKLINE((主力 > 0),0,主力,2.5,0),COLOR1020BB;
STICKLINE((主力 > 0),0,主力,0.7,0),COLORRED;
STICKLINE((游资 > 0),0,游资,2.5,0),COLOR009CFF;
STICKLINE((游资 > 0),0,游资,0.7,0),COLORYELLOW;
STICKLINE((大户 > 0),0,大户,2.5,0),COLORFF8800;
STICKLINE((大户 > 0),0,大户,0.7,0),COLORLIBLUE;
STICKLINE((散户 > 0),0,散户,2.5,0),COLOR00CA00;
STICKLINE((散户 > 0),0,散户,0.7,0),COLORGREEN;`};return r};J.prototype.NewsNegative=function(){var r={Name:"负面新闻",Description:"负面新闻统计",IsMainIndex:!1,FloatPrecision:0,Args:[{Name:"N",Value:5},{Name:"N2",Value:10}],Script:`负面:NEWS(1);
MA1:MA(负面,N);
MA2:MA(负面,N2);`};return r};J.prototype.UpDownAnalyze=function(){var r={Name:"涨跌趋势",Description:"涨跌趋势",IsMainIndex:!1,FloatPrecision:0,Condition:{Period:[se.MINUTE_ID,se.MULTIDAY_MINUTE_ID,se.KLINE_DAY_ID]},Args:[],Script:`上涨家数:UPCOUNT('CNA.CI'),COLORRED;
下跌家数:DOWNCOUNT('CNA.CI'),COLORGREEN;`};return r};J.prototype.HK2SHSZ=function(){var r={Name:"北上资金",Description:"北上资金",IsMainIndex:!1,FloatPrecision:0,Condition:{Period:[se.MINUTE_ID,se.MULTIDAY_MINUTE_ID,se.KLINE_DAY_ID]},Args:[],Script:"净流入:HK2SHSZ(1),COLORSTICK;"};return r};J.prototype.ShareHolder=function(){var r={Name:"股东人数",Description:"股东人数",IsMainIndex:!1,FloatPrecision:0,Condition:{Period:[se.KLINE_DAY_ID,se.KLINE_MONTH_ID,se.KLINE_WEEK_ID,se.KLINE_YEAR_ID]},Args:[],Script:"人数:FINANCE(100);"};return r};J.prototype.VOLRate=function(){var r={Name:"量比",Description:"量比",IsMainIndex:!1,Condition:{Period:[se.MINUTE_ID,se.MULTIDAY_MINUTE_ID]},Args:[],Script:"LIANGBI:VOLR;"};return r};J.prototype.COLOR_KSTAR1=function(){var r={Name:"十字星",Description:"十字星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:CLOSE==OPEN&&HIGH>LOW;"};return r};J.prototype.COLOR_KSTAR2=function(){var r={Name:"早晨之星",Description:"早晨之星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:(REF(CLOSE,2)/REF(OPEN,2)<0.95) && (REF(OPEN,1) < REF(CLOSE,2)) && (ABS(REF(OPEN,1)-REF(CLOSE,1))/REF(CLOSE,1)<0.03) && CLOSE/OPEN>1.05 && CLOSE>REF(CLOSE,2);"};return r};J.prototype.COLOR_KSTAR3=function(){var r={Name:"黄昏之星",Description:"黄昏之星",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:REF(CLOSE,2)/REF(OPEN,2)>1.05 && REF(OPEN,1)>REF(CLOSE,2) && ABS(REF(OPEN,1)-REF(CLOSE,1))/REF(CLOSE,1)<0.03 && CLOSE/OPEN<0.95 && CLOSE<REF(CLOSE,2);"};return r};J.prototype.COLOR_SHI1=function(){var r={Name:"长十字",Description:"长十字",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:CLOSE==OPEN&&HIGH/LOW>1.03;"};return r};J.prototype.COLOR_K220=function(){var r={Name:"身怀六甲",Description:"身怀六甲",IsMainIndex:!0,InstructionType:2,Script:`KSTAR:ABS(REF(CLOSE,1)-REF(OPEN,1))/REF(CLOSE,1)>0.04&&
            ABS(CLOSE-OPEN)/CLOSE<0.005&&
            MAX(CLOSE,OPEN)<MAX(REF(CLOSE,1),REF(OPEN,1))&&
            MIN(CLOSE,OPEN)>MIN(REF(CLOSE,1),REF(OPEN,1));`};return r};J.prototype.COLOR_K300=function(){var r={Name:"三个白武士",Description:"三个白武士",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:UPNDAY(CLOSE,3)&&NDAY(CLOSE,OPEN,3);"};return r};J.prototype.COLOR_K310=function(){var r={Name:"三只乌鸦",Description:"三只乌鸦",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:DOWNNDAY(CLOSE,3)&&NDAY(OPEN,CLOSE,3);"};return r};J.prototype.COLOR_K380=function(){var r={Name:"光头阳线",Description:"光头阳线",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:HIGH==CLOSE&&HIGH>LOW;"};return r};J.prototype.COLOR_K390=function(){var r={Name:"光脚阴线",Description:"光脚阴线",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:LOW==CLOSE&&HIGH>LOW;"};return r};J.prototype.COLOR_K134=function(){var r={Name:"垂死十字",Description:"垂死十字",IsMainIndex:!0,InstructionType:2,Script:"KSTAR:CLOSE==OPEN&&CLOSE==LOW&&CLOSE<HIGH;"};return r};J.prototype.COLOR_K140=function(){var r={Name:"早晨十字星",Description:"早晨十字星",IsMainIndex:!0,InstructionType:2,Script:`KSTAR:REF(CLOSE,2)/REF(OPEN,2)<0.95&&
REF(OPEN,1)<REF(CLOSE,2)&&
REF(OPEN,1)==REF(CLOSE,1)&&
CLOSE/OPEN>1.05&&CLOSE>REF(CLOSE,2);`};return r};J.prototype.COLOR_K150=function(){var r={Name:"黄昏十字星",Description:"黄昏十字星",IsMainIndex:!0,InstructionType:2,Script:`KSTAR:REF(CLOSE,2)/REF(OPEN,2)>1.05&&
REF(OPEN,1)>REF(CLOSE,2)&&
REF(OPEN,1)=REF(CLOSE,1)&&
CLOSE/OPEN<0.95&&CLOSE<REF(CLOSE,2);`};return r};J.prototype.COLOR_K160=function(){var r={Name:"射击之星",Description:"射击之星",IsMainIndex:!0,InstructionType:2,Script:`KSTAR:MIN(OPEN,CLOSE)==LOW&&
HIGH-LOW>3*(MAX(OPEN,CLOSE)-LOW)&&
CLOSE>MA(CLOSE,5);`};return r};J.prototype.COLOR_K165=function(){var r={Name:"倒转锤头",Description:"倒转锤头",IsMainIndex:!0,InstructionType:2,Script:`KSTAR:MIN(OPEN,CLOSE)==LOW&&
HIGH-LOW>3*(MAX(OPEN,CLOSE)-LOW)&&
CLOSE<MA(CLOSE,5);`};return r};J.prototype.COLOR_K170=function(){var r={Name:"锤头",Description:"锤头",IsMainIndex:!0,InstructionType:2,Script:`OUT:HIGH==MAX(OPEN,CLOSE)&&
HIGH-LOW>3*(HIGH-MIN(OPEN,CLOSE))&&
CLOSE<MA(CLOSE,5);`};return r};J.prototype.COLOR_K180=function(){var r={Name:"吊颈",Description:"吊颈",IsMainIndex:!0,InstructionType:2,Script:`OUT:HIGH==MAX(OPEN,CLOSE)&&
HIGH-LOW>3*(HIGH-MIN(OPEN,CLOSE))&&
CLOSE>MA(CLOSE,5);`};return r};J.prototype.COLOR_K190=function(){var r={Name:"穿头破脚",Description:"穿头破脚",IsMainIndex:!0,InstructionType:2,Script:`OUT:(REF(CLOSE,1)/REF(OPEN,1)>1.03&&
CLOSE/OPEN<0.96&&
CLOSE<REF(OPEN,1)&&OPEN>REF(CLOSE,1))||
(REF(CLOSE,1)/REF(OPEN,1)<0.97&&
CLOSE/OPEN>1.04&&
CLOSE>REF(OPEN,1)&&OPEN<REF(CLOSE,1));`};return r};J.prototype.COLOR_SWORD=function(){var r={Name:"剑",Description:"剑",IsMainIndex:!0,InstructionType:2,Script:`AA:=VOL>REF(VOL,1)||VOL>(CAPITAL*0.1);
BB:=OPEN>=(REF(HIGH,1))&&REF(HIGH,1)>(REF(HIGH,2)*1.06);
CC:=CLOSE>(REF(CLOSE,1))-(REF(CLOSE,1)*0.01);
DD:=CLOSE<(HIGH*0.965) && HIGH>(OPEN*1.05);
EE:=LOW<OPEN && LOW<CLOSE&&HIGH>(REF(CLOSE,1)*1.06);
FF:=(HIGH-(MAX(OPEN,CLOSE)))/2>(MIN(OPEN,CLOSE))-LOW;
GG:=(ABS(OPEN-CLOSE))/2<(MIN(OPEN,CLOSE)-LOW);
SWORDO:AA&&BB&&CC&&DD&&EE&&FF&&GG;`};return r};J.prototype.COLOR_CSFR=function(){var r={Name:"出水芙蓉",Description:"出水芙蓉",IsMainIndex:!0,InstructionType:2,Script:`A:=CLOSE>OPEN;
B:=A&&CLOSE>MA(CLOSE,S)&&CLOSE>MA(CLOSE,M)&&CLOSE>MA(CLOSE,LL);
CC:=B&&OPEN<MA(CLOSE,M)&&OPEN<MA(CLOSE,LL);
CSFRO:CC&&(CLOSE-OPEN)>0.0618*CLOSE;`};return r};J.prototype.COLOR_WYGD=function(){var r={Name:"乌云盖顶",Description:"乌云盖顶",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET( 
REF(CLOSE,1)/REF(OPEN,1)>1.03 AND 
CLOSE/OPEN<0.97 AND 
OPEN>REF(CLOSE,1) AND CLOSE<REF(CLOSE,1), 3);`};return r};J.prototype.COLOR_SGCJ=function(){var r={Name:"曙光初现",Description:"曙光初现",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET( 
REF(CLOSE,1)/REF(OPEN,1)<0.97 AND 
CLOSE/OPEN>1.03 AND 
OPEN<REF(CLOSE,1) AND CLOSE>REF(CLOSE,1), 3);`};return r};J.prototype.COLOR_SZTAI=function(){var r={Name:"十字胎",Description:"十字胎",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET( ABS(REF(CLOSE,1)-REF(OPEN,1))/REF(CLOSE,1) > 0.04 AND 
CLOSE==OPEN AND CLOSE < MAX(REF(CLOSE,1),REF(OPEN,1)) AND 
CLOSE > MIN(REF(CLOSE,1),REF(OPEN,1)), 2);`};return r};J.prototype.COLOR_PINGDING=function(){var r={Name:"平顶",Description:"平顶",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET(ABS(HIGH-REF(HIGH,1))/HIGH<0.001,2);"};return r};J.prototype.COLOR_PINGDI=function(){var r={Name:"平底",Description:"平底",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET((ABS(LOW-REF(LOW,1))/LOW<0.001 AND 
ABS(REF(LOW,1)-REF(LOW,2))/REF(LOW,1)<=0.001),2);`};return r};J.prototype.COLOR_DAYANZHU=function(){var r={Name:"大阳烛",Description:"大阳烛",IsMainIndex:!0,InstructionType:2,Script:"VAR1:CLOSE/OPEN>1.05 AND HIGH/LOW < CLOSE/OPEN+0.018;"};return r};J.prototype.COLOR_DAYINGZHU=function(){var r={Name:"大阴烛",Description:"大阴烛",IsMainIndex:!0,InstructionType:2,Script:"VAR1:OPEN/CLOSE > 1.05 AND HIGH/LOW < OPEN/CLOSE+0.018;"};return r};J.prototype.COLOR_HYFG=function(){var r={Name:"好友反攻",Description:"好友反攻",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET( (REF(CLOSE,1)<REF(OPEN,1) AND 
CLOSE>OPEN AND ABS(CLOSE-REF(CLOSE,1))/CLOSE<0.002),2);`};return r};J.prototype.COLOR_TKQK=function(){var r={Name:"跳空缺口",Description:"跳空缺口",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( HIGH<REF(LOW,1) OR LOW>REF(HIGH,1),2);"};return r};J.prototype.COLOR_SFWY=function(){var r={Name:"双飞乌鸦",Description:"双飞乌鸦",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( REF(CLOSE,1)<REF(OPEN,1) AND CLOSE<OPEN AND CLOSE/OPEN<0.98,1);"};return r};J.prototype.COLOR_SSSBQ=function(){var r={Name:"上升三部曲",Description:"上升三部曲",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET( 
REF(CLOSE,4)/REF(OPEN,4)>1.03 AND 
REF(CLOSE,3)<REF(OPEN,3) AND 
REF(CLOSE,2)<REF(OPEN,2) AND 
REF(CLOSE,1)<REF(OPEN,1) AND 
REF(LOW,4)<REF(LOW,3) AND 
REF(LOW,4)<REF(LOW,2) AND 
REF(LOW,4)<REF(LOW,1) AND 
REF(HIGH,4)>REF(HIGH,3) AND 
REF(HIGH,4)>REF(HIGH,2) AND 
REF(HIGH,4)>REF(HIGH,1) AND 
CLOSE/OPEN>1.03 AND 
CLOSE>REF(CLOSE,4), 5);`};return r};J.prototype.COLOR_XDSBQ=function(){var r={Name:"下跌三部曲",Description:"下跌三部曲",IsMainIndex:!0,InstructionType:2,Script:`VAR1:BACKSET( 
REF(CLOSE,4)/REF(OPEN,4)<0.97 AND 
REF(CLOSE,3)>REF(OPEN,3) AND 
REF(CLOSE,2)>REF(OPEN,2) AND 
REF(CLOSE,1)>REF(OPEN,1) AND 
REF(LOW,4)<REF(LOW,3) AND 
REF(LOW,4)<REF(LOW,2) AND 
REF(LOW,4)<REF(LOW,1) AND 
REF(HIGH,4)>REF(HIGH,3) AND 
REF(HIGH,4)>REF(HIGH,2) AND 
REF(HIGH,4)>REF(HIGH,1) AND 
CLOSE/OPEN<0.97 AND 
CLOSE<REF(CLOSE,4), 5);`};return r};J.prototype.COLOR_CHXY=function(){var r={Name:"长下影",Description:"长下影",IsMainIndex:!0,InstructionType:2,Script:"VAR2:(MIN(CLOSE,OPEN)-LOW)/(HIGH-LOW)>0.667;"};return r};J.prototype.COLOR_CHSY=function(){var r={Name:"长上影",Description:"长上影",IsMainIndex:!0,InstructionType:2,Script:"VAR2:(HIGH-MAX(CLOSE,OPEN))/(HIGH-LOW)>0.667,COLORBLUE;"};return r};J.prototype.COLOR_FENLI=function(){var r={Name:"分离",Description:"分离",IsMainIndex:!0,InstructionType:2,Script:"VAR1:BACKSET( OPEN==REF(OPEN,1) AND (CLOSE-OPEN)*(REF(CLOSE,1)-REF(OPEN,1))<0,2);"};return r};J.prototype.TRADE_BIAS=function(){var r={Name:"BIAS",Description:"乖离率专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:12},{Name:"LL",Value:6},{Name:"LH",Value:6}],Script:`BIAS:=(CLOSE-MA(CLOSE,N))/MA(CLOSE,N)*100;
ENTERLONG:CROSS(-LL,BIAS);
EXITLONG:CROSS(BIAS,LH);`};return r};J.prototype.TRADE_CCI=function(){var r={Name:"CCI",Description:"CCI专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:14}],Script:`TYP:=(HIGH+LOW+CLOSE)/3;
CCI:=(TYP-MA(TYP,N))/(0.015*AVEDEV(TYP,N));
INDEX:=CCI;
ENTERLONG:CROSS(INDEX,-100);
EXITLONG:CROSS(100,INDEX);`};return r};J.prototype.TRADE_DMI=function(){var r={Name:"DMI",Description:"趋向专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:14}],Script:`MTR:=SUM(MAX(MAX(HIGH-LOW,ABS(HIGH-REF(CLOSE,1))),ABS(LOW-REF(CLOSE,1))),N);
HD :=HIGH-REF(HIGH,1);
LD :=REF(LOW,1)-LOW;
PDM:=SUM(IF(HD>0&&HD>LD,HD,0),N);
MDM:=SUM(IF(LD>0&&LD>HD,LD,0),N);
PDI:=PDM*100/MTR;
MDI:=MDM*100/MTR;
ENTERLONG:CROSS(PDI,MDI);
EXITLONG:CROSS(MDI,PDI);`};return r};J.prototype.TRADE_KD=function(){var r={Name:"KD",Description:"KD指标专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3},{Name:"M2",Value:3}],Script:`WRSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;
WK:=SMA(WRSV,M1,1);
D:=SMA(WK,M2,1);
ENTERLONG:CROSS(WK,D)&&WK<20;
EXITLONG:CROSS(D,WK)&&WK>80;`};return r};J.prototype.TRADE_BOLL=function(){var r={Name:"BOLL",Description:"布林带专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:20}],Script:`MID :=MA(CLOSE,N);
UPPER:=MID+2*STD(CLOSE,N);
LOWER:=MID-2*STD(CLOSE,N);
ENTERLONG:CROSS(CLOSE,LOWER);
EXITLONG:CROSS(CLOSE,UPPER);`};return r};J.prototype.TRADE_KDJ=function(){var r={Name:"KDJ",Description:"KDJ专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:9},{Name:"M1",Value:3}],Script:`RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;
K:=SMA(RSV,M1,1);
D:=SMA(K,M1,1);
J:=3*K-2*D;
ENTERLONG:CROSS(J,0);
EXITLONG:CROSS(100,J);`};return r};J.prototype.TRADE_MA=function(){var r={Name:"MA",Description:"均线专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"SHORT",Value:5},{Name:"LONG",Value:20}],Script:`ENTERLONG:CROSS(MA(CLOSE,SHORT),MA(CLOSE,LONG));
EXITLONG:CROSS(MA(CLOSE,LONG),MA(CLOSE,SHORT));`};return r};J.prototype.TRADE_MACD=function(){var r={Name:"MACD",Description:"MACD专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"LONG",Value:26},{Name:"SHORT",Value:12},{Name:"M",Value:9}],Script:`DIFF:=EMA(CLOSE,SHORT) - EMA(CLOSE,LONG);
DEA  := EMA(DIFF,M);
MACD := 2*(DIFF-DEA);
ENTERLONG:CROSS(MACD,0);
EXITLONG:CROSS(0,MACD);`};return r};J.prototype.TRADE_MTM=function(){var r={Name:"MTM",Description:"动力指标专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:6}],Script:`WMTM:=C-REF(C,N);
ENTERLONG:CROSS(WMTM,0);
EXITLONG:CROSS(0,WMTM);`};return r};J.prototype.TRADE_PSY=function(){var r={Name:"PSY",Description:"PSY心理线专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:12},{Name:"LL",Value:10},{Name:"LH",Value:85}],Script:`MYPSY:=COUNT(CLOSE>REF(CLOSE,1),N)/N*100;
ENTERLONG:CROSS(LL,MYPSY);
EXITLONG:CROSS(MYPSY,LH);`};return r};J.prototype.TRADE_ROC=function(){var r={Name:"ROC",Description:"变动速率专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:12},{Name:"M",Value:6}],Script:`WROC:=MA(100*(CLOSE-REF(CLOSE,N))/REF(CLOSE,N),M);
ENTERLONG:CROSS(WROC,0);
EXITLONG:CROSS(0,WROC);`};return r};J.prototype.TRADE_RSI=function(){var r={Name:"RSI",Description:"相对强弱专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:6},{Name:"LL",Value:20},{Name:"LH",Value:80}],Script:`LC:=REF(CLOSE,1);
WRSI:=SMA(MAX(CLOSE-LC,0),N,1)/SMA(ABS(CLOSE-LC),N,1)*100;
ENTERLONG:CROSS(WRSI,LL);
EXITLONG:CROSS(LH,WRSI);`};return r};J.prototype.TRADE_VR=function(){var r={Name:"VR",Description:"VR容量比率专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N",Value:26},{Name:"LL",Value:70},{Name:"LH",Value:250}],Script:`WVR := SUM((IF(CLOSE>OPEN,VOL,0)+IF(CLOSE=OPEN,VOL/2,0)),N)/SUM((IF(CLOSE<OPEN,VOL,0)+IF(CLOSE=OPEN,VOL/2,0)),N)*100;
ENTERLONG:CROSS(LL,WVR);
EXITLONG:CROSS(WVR,LH);`};return r};J.prototype.TRADE_DPSJ=function(){var r={Name:"DPSJ",Description:"大盘随机专家系统",IsMainIndex:!0,InstructionType:1,Args:[{Name:"N1",Value:18},{Name:"N2",Value:12}],Script:`RSV:=(INDEXC-LLV(INDEXL,N1))/(HHV(INDEXH,N1)-LLV(INDEXL,N1))*100;
K:=SMA(RSV,N2,1);
HSL:VOL/100/(FINANCE(7));
ENTERLONG: CROSS(K,20);
EXITLONG: (CROSS(HSL,5) OR CROSS(K,80));`};return r};J.prototype.Zealink_Index1=function(){var r={Name:"资金吸筹",Description:"资金吸筹",IsMainIndex:!1,Args:[],Script:`VAR1:=REF((LOW+OPEN+CLOSE+HIGH)/4,1);  
VAR2:= SMA(ABS(LOW - VAR1), 13, 1) / SMA(MAX(LOW - VAR1, 0), 10, 1);
VAR3:= EMA(VAR2, 10);
VAR4:= LLV(LOW, 33);
VAR5:= EMA(IF(LOW <= VAR4, VAR3, 0), 3) * 0.2;
主力进场: IF(VAR5 > REF(VAR5, 1), VAR5,0), COLORRED, NODRAW;
洗盘: IF(VAR5 < REF(VAR5, 1),  VAR5,0), COLORYELLOW, NODRAW;
STICKLINE(VAR5> REF(VAR5, 1),0, VAR5, 20, 0), COLORRED;
STICKLINE(VAR5 < REF(VAR5, 1), 0, VAR5, 20, 0), COLORYELLOW;`};return r};J.prototype.Zealink_Index2=function(){var r={Name:"牛熊区间",Description:"牛熊区间",IsMainIndex:!1,YSpecificMaxMin:{Max:100,Min:1,Count:4},YSplitScale:[1,50,100],Args:[],Script:`短高H:=(20*H+19*REF(H,1)+18*REF(H,2)+17*REF(H,3)+16*REF(H,4)+15*REF(H,5)+14*REF(H,6)
+ 13 * REF(H, 7) + 12 * REF(H, 8) + 11 * REF(H, 9) + 10 * REF(H, 10) + 9 * REF(H, 11) + 8 * REF(H, 12)
+ 7 * REF(H, 13) + 6 * REF(H, 14) + 5 * REF(H, 15) + 4 * REF(H, 16) + 3 * REF(H, 17) + 2 * REF(H, 18) +
REF(H, 20))/ 210, COLORBLUE, LINETHICK1;
短低L:= (20 * L + 19 * REF(L, 1) + 18 * REF(L, 2) + 17 * REF(L, 3) + 16 * REF(L, 4) + 15 * REF(L, 5) + 14 * REF(L, 6)
+ 13 * REF(L, 7) + 12 * REF(L, 8) + 11 * REF(L, 9) + 10 * REF(L, 10) + 9 * REF(L, 11) + 8 * REF(L, 12)
+ 7 * REF(L, 13) + 6 * REF(L, 14) + 5 * REF(L, 15) + 4 * REF(L, 16) + 3 * REF(L, 17) + 2 * REF(L, 18) +
REF(L, 20)) / 210, COLORBLUE, LINETHICK1;
D90H:= EMA(短高H, 90), COLORRED, LINETHICK1;
D90L:= EMA(短低L, 90), COLORRED, LINETHICK1;
D90差:= D90H - D90L;
D90顶:= D90H + D90差 * 2, COLORRED, LINETHICK1;
D90底:= D90L - D90差 * 2, COLORRED, LINETHICK1;
高0:= (EMA(EMA(H, 25), 25) - EMA(EMA(L, 25), 25)) * 1 + EMA(EMA(H, 25), 25), LINETHICK1, COLORWHITE;
低0:= EMA(EMA(L, 25), 25) - (EMA(EMA(H, 25), 25) - EMA(EMA(L, 25), 25)) * 1, LINETHICK1, COLORWHITE;
多头定位:= 低0 >= D90底 AND 高0 >= D90顶;
空头定位:= 高0 <= D90顶 AND 低0 <= D90底;
震荡定位:= 低0 >= D90底 AND 高0 <= D90顶;
牛市: IF(多头定位 == 1, 100, 1), COLORRED, NODRAW;
熊市: IF(空头定位 == 1, 100, 1), COLORGREEN, NODRAW;
震荡: IF(震荡定位 == 1, 100, 1), COLORGRAY, NODRAW;
STICKLINE(多头定位 == 1, 100, 1, 100, 0), COLORRED;
STICKLINE(空头定位 == 1, 100, 1, 100, 0), COLORGREEN;
STICKLINE(震荡定位 == 1, 100, 1, 100, 0), COLORGRAY;`};return r};J.prototype.Zealink_Index3=function(){var r={Name:"持仓信号",Description:"持仓信号",IsMainIndex:!0,Args:[],Script:`买线:=EMA(C,2);
卖线:=EMA(SLOPE(C,30)*5+C,20); 
BU:=CROSS(买线,卖线);
SEL:=CROSS(卖线,买线);

STICKLINE(买线>=卖线 AND CLOSE>OPEN,LOW,HIGH,0,1),COLORRED;
STICKLINE(买线>=卖线 AND CLOSE<OPEN,LOW,HIGH,0,1),COLORRED;
STICKLINE(买线>=卖线 AND CLOSE>OPEN,CLOSE,OPEN,50,1),COLORRED;
STICKLINE(买线>=卖线 AND CLOSE<OPEN,CLOSE,OPEN,50,0),COLORRED;
STICKLINE(买线<卖线 AND CLOSE<OPEN,LOW,HIGH,0,1),COLORGREEN;
STICKLINE(买线<卖线 AND CLOSE>OPEN,LOW,HIGH,0,1),COLORGREEN;
STICKLINE(买线<卖线 AND CLOSE<OPEN,CLOSE,OPEN,50,0),COLORGREEN;
STICKLINE(买线<卖线 AND CLOSE>OPEN,CLOSE,OPEN,50,1),COLORGREEN;

HHJSJDA:=(3*CLOSE+OPEN+LOW+HIGH)/6;
HHJSJDB:(19*HHJSJDA+19*REF(HHJSJDA,1)+18*REF(HHJSJDA,2)+17*REF(HHJSJDA,3)+16*REF(HHJSJDA,4)+15*REF(HHJSJDA,5)+14*REF(HHJSJDA,6)
+13*REF(HHJSJDA,7)+12*REF(HHJSJDA,8)+11*REF(HHJSJDA,9)+10*REF(HHJSJDA,10)+9*REF(HHJSJDA,11)+8*REF(HHJSJDA,12)+7*REF(HHJSJDA,13)+6*REF(HHJSJDA,14)+5*REF(HHJSJDA,15)+4*REF(HHJSJDA,16)+3*REF(HHJSJDA,17)+2*REF
(HHJSJDA,20)+REF(HHJSJDA,19))/210,COLORYELLOW;
HHJSJDC:MA(HHJSJDB,5),COLORRED;

SVAR11:=HHV(HIGH,34);
SVAR14:=CLOSE-REF(CLOSE,1);
SVAR15:=MAX(SVAR14,0);
SVAR16:=ABS(SVAR14);
SVAR17:=SMA(SVAR15,7,1)/SMA(SVAR16,7,1)*100;
SVAR18:=SMA(SVAR15,13,1)/SMA(SVAR16,13,1)*100;
SVAR19:=BARSCOUNT(CLOSE);
SVAR20:=SMA(MAX(SVAR14,0),6,1)/SMA(ABS(SVAR14),6,1)*100;
SVAR21:=(-200)*(HHV(HIGH,60)-CLOSE)/(HHV(HIGH,60)-LLV(LOW,60))+100;
SVAR1A:=(CLOSE-LLV(LOW,15))/(HHV(HIGH,15)-LLV(LOW,15))*100;
SVAR1B:=SMA((SMA(SVAR1A,4,1)-50)*2,3,1);
SVAR1C:=(INDEXC-LLV(INDEXL,14))/(HHV(INDEXH,14)-LLV(INDEXL,14))*100;
SVAR1D:=SMA(SVAR1C,4,1);
SVAR1E:=SMA(SVAR1D,3,1);
SVAR1F:=(HHV(HIGH,30)-CLOSE)/CLOSE*100;
SVAR22:=SVAR20<=25 AND SVAR21<-95 AND SVAR1F>20 AND SVAR1B<-30 AND SVAR1E<30 AND SVAR11-CLOSE>=-0.25 AND SVAR17<22 AND SVAR18<28 AND SVAR19>50;
BUY3:=CROSS(SVAR22,0.5) AND COUNT(SVAR22==1,10)==1;

SVARF:=LOW*0.9;
SVAR10X:=100-3*SMA((OPEN-LLV(LOW,75))/(HHV(HIGH,75)-LLV(LOW,75))*100,20,1)+2*SMA(SMA((OPEN-LLV(LOW,75))/(HHV(HIGH,75)-LLV(LOW,75))*100,20,1),15,1);
SVAR11X:=SVARF<REF(SVAR10X,1) AND VOL>REF(VOL,1) AND CLOSE>REF(CLOSE,1);
BUY2:=SVAR11X AND COUNT(SVAR11X,30)==1;

VAR1:=(CLOSE+HIGH+LOW+OPEN)/4;
VAR2:=SUMBARS(VOL,CAPITAL);
VAR3:=HHV(VAR1,VAR2);
VAR4:=LLV(VAR1,VAR2);
VAR5:=(2*VAR1-VAR4-REF(VAR4,1))/(VAR3-VAR4);
VAR6:=(VAR1-VAR4)/(VAR3-VAR4);
VAR7:=IF(VAR1<=VAR4,VAR5*60,VAR6*60);
VAR8:=600*(EMA(CLOSE,3)-EMA(LOW,30))/EMA(LOW,30);
VAR9:=EMA(VAR8,7);
VARC:=HHV(HIGH,9)-LLV(LOW,9);
VARD:=HHV(HIGH,9)-CLOSE;
VARE:=CLOSE-LLV(LOW,9);
VARF:=VARD/VARC*100-70;
VAR10:=(CLOSE-LLV(LOW,60))/(HHV(HIGH,60)-LLV(LOW,60))*100;
VAR11:=(2*CLOSE+HIGH+LOW)/4;
VAR12:=SMA(VARE/VARC*100,3,1);
VAR13:=LLV(LOW,34);
VAR14:=SMA(VAR12,3,1)-SMA(VARF,9,1);
VAR15:=IF(VAR14>100,VAR14-100,0);
VAR16:=HHV(HIGH,34);
VAR17:=EMA((VAR11-VAR13)/(VAR16-VAR13)*100,8);
VAR18:=EMA(VAR17,5);
BUY:=STICKLINE(VAR17-VAR18>0,VAR17,VAR18,8,1),COLORRED;
SELL:=STICKLINE(VAR17-VAR18<0,VAR17,VAR18,8,1),COLORGREEN;
BUY1:=VAR17>VAR18 AND REF(VAR17,1)<REF(VAR18,1);
SELL1:=VAR17<VAR18 AND REF(VAR17,1)>REF(VAR18,1);

短高H:=(20*H+19*REF(H,1)+18*REF(H,2)+17*REF(H,3)+16*REF(H,4)+15*REF(H,5)+14*REF(H,6)
+13*REF(H,7)+12*REF(H,8)+11*REF(H,9)+10*REF(H,10)+9*REF(H,11)+8*REF(H,12)
+7*REF(H,13)+6*REF(H,14)+5*REF(H,15)+4*REF(H,16)+3*REF(H,17)+2*REF(H,18)+
REF(H,20))/210,COLORBLUE,LINETHICK1;
短低L:=(20*L+19*REF(L,1)+18*REF(L,2)+17*REF(L,3)+16*REF(L,4)+15*REF(L,5)+14*REF(L,6)
+13*REF(L,7)+12*REF(L,8)+11*REF(L,9)+10*REF(L,10)+9*REF(L,11)+8*REF(L,12)
+7*REF(L,13)+6*REF(L,14)+5*REF(L,15)+4*REF(L,16)+3*REF(L,17)+2*REF(L,18)+
REF(L,20))/210,COLORBLUE,LINETHICK1;
D90H:=EMA(短高H,90),COLORRED,LINETHICK1;
D90L:=EMA(短低L,90),COLORRED,LINETHICK1;
D90差:=D90H-D90L;
D90顶:=D90H+D90差*2,COLORRED,LINETHICK1;
D90底:=D90L-D90差*2,COLORRED,LINETHICK1;
高0:=(EMA(EMA(H,25),25)-EMA(EMA(L,25),25))*1+EMA(EMA(H,25),25),LINETHICK1,COLORWHITE;
低0:=EMA(EMA(L,25),25)-(EMA(EMA(H,25),25)-EMA(EMA(L,25),25))*1,LINETHICK1,COLORWHITE;
多头定位:=低0>=D90底 AND 高0>=D90顶;
空头定位:=高0<=D90顶 AND 低0<=D90底;
震荡定位:=低0>=D90底 AND 高0<=D90顶;

牛市:=多头定位==1;
熊市:=空头定位==1;
震荡:=震荡定位==1;

非牛市:=熊市 OR 震荡;
非熊市:=牛市 OR 震荡;

BUY11:=BUY1 AND 非熊市;
SELL11:=SELL1 AND 震荡定位==0;

BUY111:=BUY11 AND COUNT(BUY11,10)<2;
BUY0:=BUY111 AND COUNT(BUY111,21)==1;
SELL111:=SELL11 AND COUNT(SELL11,10)<2;
SELL0:=SELL111 AND COUNT(SELL111,10)==1;

XK1:=EMA(100*(CLOSE-LLV(LOW,34))/(HHV(HIGH,34)-LLV(LOW,34)),3)/4;
上穿:=REF(XK1,1)<5 AND XK1>=5;
BUY4:=上穿 AND COUNT(XK1<2,12)<1;

SELL2:=REF(XK1,1)<=22.5 AND XK1>22.5 AND COUNT(REF(XK1,1)>=22.5 AND XK1<22.5,5)>0;
SELL3:=REF(XK1,1)>=21.5 AND XK1<21.5 AND COUNT(REF(XK1,1)>=22.5 AND XK1<22.5,12)>1;
SELL4:=SELL2 OR SELL3 AND COUNT((SELL2 OR SELL3)==1,5)==1;

SUPERDRAWTEXT(BUY0,L,"机会",2,10),COLORRED;
SUPERDRAWTEXT(SELL0,H,"风险",1,10),COLORGREEN;
SUPERDRAWTEXT(BUY2,L,"机会",2,10),COLORRED;
SUPERDRAWTEXT(BUY4,L,"机会",2,10),COLORRED;
SUPERDRAWTEXT(SELL4,H,"风险",1,10),COLORGREEN;`};return r};J.prototype.Zealink_Index4=function(){var r={Name:"股东实际增减持",Description:"股东实际增减持",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:`增持:NEWS(4),NODRAW,COLORRED;
减持:NEWS(5),NODRAW,COLORGREEN;
STICKLINE(增持>0,0,增持,1,0),COLORRED;
STICKLINE(减持<0,0,减持,1,0),COLORGREEN;`};return r};J.prototype.Zealink_Index5=function(){var r={Name:"大宗交易",Description:"大宗交易",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"交易次数:NEWS(7);"};return r};J.prototype.Zealink_Index6=function(){var r={Name:"信托持股",Description:"信托持股",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"家数:NEWS(6);"};return r};J.prototype.Zealink_Index7=function(){var r={Name:"官网新闻",Description:"官网新闻",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"个数:NEWS(8);"};return r};J.prototype.Zealink_Index8=function(){var r={Name:"高管要闻",Description:"高管要闻",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"个数:NEWS(9);"};return r};J.prototype.Zealink_Index9=function(){var r={Name:"股权质押",Description:"股权质押",IsMainIndex:!1,FloatPrecision:0,Args:[],Script:"次数:NEWS(10);"};return r};J.prototype.Zealink_Index10=function(){var r={Name:"操盘BS点",Description:"操盘BS点",IsMainIndex:!0,FloatPrecision:0,Args:[],Script:`JJ:=(CLOSE+HIGH+LOW)/3; 
A:=EMA(JJ,10); 
B:=REF(A,1);
M1:=EMA(CLOSE,3);
M2:=EMA(CLOSE,8); 
M3:=EMA(M2,13); 
M4:=EMA(M2,55); 
B1:=A>B AND REF(A,1)<REF(B,1);
S1:=A<B AND REF(A,1)>REF(B,1);
INDEXCLOSE:INDEXC,EXDATA;
INDEXOPEN:INDEXO,EXDATA;
DRAWICON(REF(B1,1),L*0.97,13);
DRAWICON(REF(S1,1),H*1.03,14);`};return r};J.prototype.Zealink_Index11=function(){var r={Name:"操盘BS点",Description:"操盘BS点",IsMainIndex:!0,FloatPrecision:0,Args:[],Script:`JJ:=(CLOSE+HIGH+LOW)/3;
A:=EMA(JJ,10);
B:=REF(A,1);
M1:=EMA(CLOSE,3);
M2:=EMA(CLOSE,8); 
M3:=EMA(M2,13);
M4:=EMA(M2,55);
持股区域:=STICKLINE(A>B,A,B,2,0),COLORYELLOW; 
持币区域:=STICKLINE(A<B,A,B,2,0),COLORBLUE;

VR1:=(C+O+REF(C,1))/3;
VR3:=HHV(VR1,21);
VR4:=LLV(VR1,21);
VR5:=(2*VR1-VR4-REF(VR4,1))/(VR3-VR4);
VR6:=(VR1-VR4)/(VR3-VR4);
VR7:=IF(VR1<=VR4,VR5*60,VR6*60);
VR8:=600*(EMA(C,3)-EMA(L,30))/EMA(L,30);
VR9:=EMA(VR8,7);
VRA:=(WINNER(120*C/100)-WINNER(100*C/100))*100;
VRB:=(-100)*(WINNER(120*C/100)-WINNER(100*C/100))+5;
VRC:=HHV(H,9)-LLV(L,9);
VRD:=HHV(H,9)-C;
VRE:=C-LLV(L,9);
VRF:=VRD/VRC*100-70;
VR10:=(C-LLV(L,60))/(HHV(H,60)-LLV(L,60))*100;
VR11:=(2*C+H+L)/4;
VR12:=SMA(VRE/VRC*100,3,1);
VR13:=LLV(L,34);
VR14:=SMA(VR12,3,1)-SMA(VRF,9,1);
VR15:=IF(VR14>100,VR14-100,0);
VR16:=HHV(H,34);
VR17:=EMA((VR11-VR13)/(VR16-VR13)*100,8);
VR18:=EMA(VR17,5);

B1:=A>B AND REF(A,1)<REF(B,1);
S1:=A<B AND REF(A,1)>REF(B,1);

B9:=BARSLAST(REF(B1,1) AND (REF(VR17>VR18,1) OR MIN(VR17,VR18)>REF(MAX(VR17,VR18),1)));
S9:=BARSLAST(REF(S1,1) AND (REF(VR17<VR18,1) OR MAX(VR17,VR18)<REF(MIN(VR17,VR18),1)));

DRAWICON(REF(B1,1) AND (REF(VR17>VR18,1) OR MIN(VR17,VR18)>REF(MAX(VR17,VR18),1)) AND REF(B9,2)>=S9,L*0.97,13);
DRAWICON(REF(S1,1) AND (REF(VR17<VR18,1) OR MAX(VR17,VR18)<REF(MIN(VR17,VR18),1)) AND REF(S9,1)>=B9,H*1.03,14);

DRAWKLINE_IF(VR17>VR18,HIGH,CLOSE,LOW,OPEN),COLORRED;
DRAWKLINE_IF(VR17<VR18,HIGH,CLOSE,LOW,OPEN),COLORBLUE;

INDEXCLOSE:INDEXC,EXDATA;		//取指数的收盘价 回测的时候计算BATE系数用 `};return r};J.prototype.HeikinAshi=function(){var r={Name:"平均K线",Description:"Heikin-Ashi 平均K线",IsMainIndex:!0,KLineType:-1,Args:[],Script:`HCLOSE:(OPEN+HIGH+LOW+CLOSE)/4, NODRAW;
HOPEN:(REF(OPEN,1)+REF(CLOSE,1))/2,NODRAW;
HHIGH:MAX(HIGH,MAX(HOPEN,HCLOSE)),NODRAW;
HLOW:MIN(LOW,MIN(HOPEN,HCLOSE)),NODRAW;
DRAWKLINE(HHIGH,HOPEN,HLOW,HCLOSE);`};return r};J.prototype.ADL=function(){var r={Name:"腾落指标",Description:"腾落指标",IsMainIndex:!1,StringFormat:2,Condition:{Period:[se.KLINE_DAY_ID,se.KLINE_WEEK_ID,se.KLINE_TWOWEEK_ID,se.KLINE_MONTH_ID,se.KLINE_QUARTER_ID,se.KLINE_YEAR_ID],Include:["000001.SH","000003.SH","000016.SH","000300.SH","000905.SH","399001.SZ"," 399005.SZ","399006.SZ"]},Args:[{Name:"M",Value:7}],Script:`ADL:SUM(ADVANCE-DECLINE,0);
MAADL:MA(ADL,M);`};return r};J.prototype.EMPTY=function(){var r={Name:"",Description:"空指标",IsMainIndex:!0,Args:[],Script:"VAR2:=C;"};return r};J.prototype.CJL=function(){var r={Name:"CJL",Description:"期货持仓量",IsMainIndex:!1,Args:[],Script:`成交量:VOL,VOLSTICK;
持仓量:VOLINSTK,LINEOVERLAY;`};return r};J.prototype.ASI=function(){var r={Name:"ASI",Description:"振动升降指标",IsMainIndex:!1,Args:[{Name:"N1",Value:6}],Script:`X_1:=REF(CLOSE,1);
X_2:=ABS(HIGH-X_1);
X_3:=ABS(LOW-X_1);
X_4:=ABS(HIGH-REF(LOW,1));
X_5:=ABS(X_1-REF(OPEN,1));
X_6:=IF(X_2>X_3 AND X_2>X_4,X_2+X_3/2+X_5/4,IF(X_3>X_4 AND X_3>X_2,X_3+X_2/2+X_5/4,X_4+X_5/4));
X_7:=CLOSE-X_1+(CLOSE-OPEN)/2+X_1-REF(OPEN,1);
X_8:=8*X_7/X_6*MAX(X_2,X_3);
ASI:SUM(X_8,0),LINETHICK2;
MASI:MA(ASI,N1),LINETHICK2;`};return r};J.prototype.DC=function(){var r={Name:"DC",Description:"唐奇安通道",IsMainIndex:!0,Args:[{Name:"N1",Value:20}],Script:`UPPER:HHV(H,N1),COLORBLUE,LINETHICK2;
LOWER:LLV(L,N1),COLORBLUE,LINETHICK2;
MIDDLE:(UPPER+LOWER)/2,COLORRED,LINETHICK3;`};return r};J.prototype.DEMA=function(){var r={Name:"DEMA",Description:"双重指数移动均线",IsMainIndex:!0,Args:[{Name:"N1",Value:10}],Script:`ERR:=C-EMA(C,N1);
DEMA:EMA(C,10)+EMA(ERR,N1);`};return r};J.prototype.VWAP=function(){var r={Name:"VWAP",Description:"成交量加权平均价",IsMainIndex:!0,Args:[{Name:"N1",Value:10}],Script:`PRICE:=(H+L+C)/3;
T2:=VOL*PRICE;
VWAP:SUM(T2,0)/SUM(VOL,0);`};return r};J.prototype.SQJZ=function(){var r={Name:"SQJZ",Description:"神奇九转",IsMainIndex:!0,Script:`B:=C<REF(C,4);
N:=CURRBARSCOUNT;
B1:=(N=6 AND REFXV(COUNT(B,6),5)=6) OR (N=7 AND REFXV(COUNT(B,7),6)=7) OR (N=8 AND REFXV(COUNT(B,8),7)=8) OR (N>=9 AND REFXV(COUNT(B,9),8)=9);
DRAWNUMBER(B1 AND REF(B,1)=0,L,1),COLORMAGENTA;
B2:=(N=5 AND REFXV(COUNT(B,6),4)=6) OR (N=6 AND REFXV(COUNT(B,7),5)=7) OR (N=7 AND REFXV(COUNT(B,8),6)=8) OR (N>=8 AND REFXV(COUNT(B,9),7)=9);
DRAWNUMBER(B2 AND REF(B,2)=0,L,2),COLORMAGENTA;
B8:=(N=1 AND COUNT(B,8)=8) OR (N>=2 AND REFXV(COUNT(B,9),1)=9);
DRAWNUMBER(B8 AND REF(B,8)=0,L,8),COLORMAGENTA;
B9:=(N>=1 AND COUNT(B,9)=9);
DRAWNUMBER(B9 AND REF(B,9)=0,L,9),COLORBROWN;
S:=C>REF(C,4);
S1:=(N=6 AND REFXV(COUNT(S,6),5)=6) OR (N=7 AND REFXV(COUNT(S,7),6)=7) OR (N=8 AND REFXV(COUNT(S,8),7)=8) OR (N>=9 AND REFXV(COUNT(S,9),8)=9);
DRAWNUMBER(S1 AND REF(S,1)=0,H,1),COLORMAGENTA,DRAWABOVE;
S2:=(N=5 AND REFXV(COUNT(S,6),4)=6) OR (N=6 AND REFXV(COUNT(S,7),5)=7) OR (N=7 AND REFXV(COUNT(S,8),6)=8) OR (N>=8 AND REFXV(COUNT(S,9),7)=9);
DRAWNUMBER(S2 AND REF(S,2)=0,H,2),COLORMAGENTA,DRAWABOVE;
S8:=(N=1 AND COUNT(S,8)=8) OR (N>=2 AND REFXV(COUNT(S,9),1)=9);
DRAWNUMBER(S8 AND REF(S,8)=0,H,8),COLORMAGENTA,DRAWABOVE;
S9:=(N>=1 AND COUNT(S,9)=9);
DRAWNUMBER(S9 AND REF(S,9)=0,H,9),COLORGREEN,DRAWABOVE;`};return r};J.prototype.XT=function(){var r={Name:"XT",Description:"箱体",IsMainIndex:!0,Args:[{Name:"N",Value:10}],Script:`【箱顶】:PEAK(CLOSE,N,1)*0.98;
【箱底】:TROUGH(CLOSE,N,1)*1.02;
【箱高】:100*(【箱顶】-【箱底】)/【箱底】,NODRAW;`};return r};J.prototype.CFJT=function(){var r={Name:"CFJT",Description:"财富阶梯",IsMainIndex:!0,Script:`突破:=REF(EMA(C,14),1);
A1X:=(EMA(C,10)-突破)/突破*100;
多方:=IF(A1X>=0,REF(EMA(C,10),BARSLAST(CROSS(A1X,0))+1),DRAWNULL);
空方:=IF(A1X<0,REF(EMA(C,10),BARSLAST(CROSS(0,A1X))+1),DRAWNULL);
STICKLINE(A1X>=0,多方,突破,110,0),COLORRED;
STICKLINE(A1X<0,空方,突破,110,0),COLORGREEN;`};return r};J.prototype.CYX=function(){var r={Name:"CYX",Description:"撑压线",IsMainIndex:!0,Args:[{Name:"N",Value:7}],Script:`Z1:=STRCAT(HYBLOCK,' ');
Z2:=STRCAT(Z1,DYBLOCK);
Z3:=STRCAT(Z2,' ');
DRAWTEXT_FIX(ISLASTBAR,0,0,0,STRCAT(Z3,GNBLOCK)),COLOR00C0C0;
A1:=REF(H,N)=HHV(H,2*N+1);
B1:=FILTER(A1,N);
C1:=BACKSET(B1,N+1);
D1:=FILTER(C1,N);
A2:=REF(L,N)=LLV(L,2*N+1);
B2:=FILTER(A2,N);
C2:=BACKSET(B2,N+1);
D2:=FILTER(C2,N);
E1:=(REF(LLV(L,2*N),1)+REF(HHV(H,2*N),1))/2;
E2:=(H+L)/2;
H1:=(D1 AND NOT(D2 AND E1>=E2)) OR ISLASTBAR OR BARSCOUNT(C)=1;
L1:=(D2 AND NOT(D1 AND E1<E2));
H2:=D1 AND NOT(D2 AND E1>=E2);
X1:=REF(BARSLAST(H1),1)+1;
F1:=BACKSET(H1 AND COUNT(L1,X1)>0,LLVBARS(IF(L1,L,10000),X1));
G1:=F1>REF(F1,1);
I1:=BACKSET(G1,2);
LD:=I1>REF(I1,1);
L2:=LD OR ISLASTBAR OR BARSCOUNT(C)=1;
X2:=REF(BARSLAST(L2),1)+1;
F2:=BACKSET(L2 AND COUNT(H2,X2)>0,HHVBARS(IF(H2,H,0),X2));
G2:=F2>REF(F2,1);
I2:=BACKSET(G2,2);
HD:=I2>REF(I2,1);
R1:=BACKSET(ISLASTBAR,BARSLAST(HD)+1);
S1:=R1>REF(R1,1);
T1:=BACKSET(ISLASTBAR,BARSLAST(LD)+1);
U1:=T1>REF(T1,1);
R2:=BACKSET(S1,REF(BARSLAST(HD),1)+2);
S2:=R2>REF(R2,1);
T2:=BACKSET(U1,REF(BARSLAST(LD),1)+2);
U2:=T2>REF(T2,1);
DRAWLINE(S2,H,S1,H,1),LINETHICK2,COLORRED;
DRAWLINE(U2,L,U1,L,1),LINETHICK2,COLORGREEN;`};return r};J.prototype.WAVE=function(){var r={Name:"WAVE",Description:"波浪分析",IsMainIndex:!0,Args:[{Name:"N",Value:5}],Script:"ZIG(3,N);"};return r};J.prototype.ShareholderCount=function(){var r={Name:"散户线",Description:"散户线",IsMainIndex:!1,Script:"GPJYVALUE(1,1,1);"};return r};J.prototype.NXTS=function(){var r={Name:"NXTS",Description:"牛熊天数",IsMainIndex:!1,Args:[{Name:"N",Value:20}],Script:`Z:=ZIG(C,N);
高点:=Z>REF(Z,1) AND Z>REFX(Z,1);
低点:=Z<REF(Z,1) AND Z<REFX(Z,1);
NG:=BARSLAST(高点);
ND:=BARSLAST(低点);
D0:=DATETODAY(DATE)-DATETODAY(REF(DATE,BARSSINCE(C)));
DG:=DATETODAY(DATE)-DATETODAY(REF(DATE,NG));
DD:=DATETODAY(DATE)-DATETODAY(REF(DATE,ND));
N1:=(NG>ND OR COUNT(高点,0)=0) AND ND>0 AND (HHV(C,ND)-REF(C,ND))/REF(C,ND)>(N/100);
N2:=NG<ND AND NG>0 AND (LLV(C,NG)-REF(C,NG))/REF(C,NG)>=-(N/100);
N3:=NG<ND AND NG=0;
N4:=COUNT(低点 OR 高点,0)=0 AND (HHV(C,0)-REF(C,BARSSINCE(C)))/REF(C,BARSSINCE(C))>(N/100);
N5:=COUNT(低点,0)=0 AND NG>0 AND (LLV(C,NG)-REF(C,NG))/REF(C,NG)>=-(N/100);
N6:=COUNT(低点,0)=0 AND NG=0;
X1:=(NG<ND OR COUNT(低点,0)=0) AND NG>0 AND (LLV(C,NG)-REF(C,NG))/REF(C,NG)<-(N/100);
X2:=NG>ND AND ND>0 AND (HHV(C,ND)-REF(C,ND))/REF(C,ND)<=(N/100);
X3:=NG>ND AND ND=0;
X4:=COUNT(高点 OR 低点,0)=0 AND (LLV(C,0)-REF(C,BARSSINCE(C)))/REF(C,BARSSINCE(C))<-(N/100);
X5:=COUNT(高点,0)=0 AND ND>0 AND (HHV(C,ND)-REF(C,ND))/REF(C,ND)<=(N/100);
X6:=COUNT(高点,0)=0 AND ND=0;
牛市天数:IF(N4 OR N5 OR N6,D0,IF(N1 OR N2 OR N3,DD,0)),COLORRED;
熊市天数:IF(X4 OR X5 OR X6,D0,IF(X1 OR X2 OR X3,DG,0)),COLORGREEN;`};return r};J.prototype.FKX=function(){var r={Name:"FKX",Description:"反K线",IsMainIndex:!1,Script:"DRAWKLINE(-LOW, -OPEN, -HIGH, -CLOSE);"};return r};J.prototype.Margin4=function(){var r={Name:"两融资金",Description:"两融资金",IsMainIndex:!1,Script:`TMPV:=IF(FINANCE(3)==0,REF(SCJYVALUE(1,1,1),1),REF(GPJYVALUE(3,1,1),1));
TMPV1:=IF(FINANCE(3)==0,SCJYVALUE(1,1,0),GPJYVALUE(3,1,0));
两融:IF(TMPV==0 OR TMPV1==0,DRAWNULL,IF(FINANCE(3)==0,(SCJYVALUE(1,1,1)-REF(SCJYVALUE(1,1,1),1))/10000-(SCJYVALUE(1,2,1)-REF(SCJYVALUE(1,2,1),1))/10000,((GPJYVALUE(3,1,1)-REF(GPJYVALUE(3,1,1),1))-((GPJYVALUE(3,2,1)*C/10000-(REF(GPJYVALUE(3,2,1),1)*REF(C,1)/10000)))))),NODRAW;
STICKLINE(两融>0,0,两融,2,0),COLORRED;
STICKLINE(两融<0,0,两融,2,0),COLORCYAN;`};return r};J.prototype.ZSDB=function(){var r={Name:"ZSDB",Description:"指数对比(副图,需下载日线)",IsMainIndex:!1,Script:`A:=REF(INDEXC,1);
指数涨幅:IF(A>0,(INDEXC-A)*100/A,0),NODRAW;
DRAWKLINE(INDEXH,INDEXO,INDEXL,INDEXC);`};return r};J.prototype.NineTurns=function(){var r={Name:"神奇九转",Description:"九转指标",IsMainIndex:!0,Script:`A1:=C>REF(C,4);
A2:=C<REF(C,4);
T1:=A2 AND REF(A1,1);
T2:=A2 AND REF(T1,1);
T3:=A2 AND REF(T2,1);
T4:=A2 AND REF(T3,1);
T5:=A2 AND REF(T4,1);
T6:=A2 AND REF(T5,1);
T7:=A2 AND REF(T6,1);
T8:=A2 AND REF(T7,1);
T9:=A2 AND REF(T8,1);
T10:=A2 AND REF(T9,1);
T11:=A2 AND REF(T10,1);
T12:=A2 AND REF(T11,1);
T13:=A2 AND REF(T12,1);
T14:=A2 AND REF(T13,1);
DRAWTEXT(T1,L*0.98,'1'),COLORGREEN;
DRAWTEXT(T2,L*0.98,'2'),COLORGREEN;
DRAWTEXT(T3,L*0.98,'3'),COLORGREEN;
DRAWTEXT(T4,L*0.98,'4'),COLORGREEN;
DRAWTEXT(T5,L*0.98,'5'),COLORGREEN;
DRAWTEXT(T6,L*0.98,'6'),COLORGREEN;
DRAWTEXT(T7,L*0.98,'7'),COLORGREEN;
DRAWTEXT(T8,L*0.98,'8'),COLORGREEN;
DRAWTEXT(T9,L*0.98,'9'),COLORBLUE;
B1:=C<REF(C,4);
B2:=C>REF(C,4);
D1:=B2 AND REF(B1,1);
D2:=B2 AND REF(D1,1);
D3:=B2 AND REF(D2,1);
D4:=B2 AND REF(D3,1);
D5:=B2 AND REF(D4,1);
D6:=B2 AND REF(D5,1);
D7:=B2 AND REF(D6,1);
D8:=B2 AND REF(D7,1);
D9:=B2 AND REF(D8,1);
D10:=B2 AND REF(D9,1);
D11:=B2 AND REF(D10,1);
D12:=B2 AND REF(D11,1);
D13:=B2 AND REF(D12,1);
D14:=B2 AND REF(D13,1);
DRAWTEXT(D1,H*1.010,'1'),COLORBLUE;
DRAWTEXT(D2,H*1.010,'2'),COLORBLUE;
DRAWTEXT(D3,H*1.010,'3'),COLORBLUE;
DRAWTEXT(D4,H*1.010,'4'),COLORBLUE;
DRAWTEXT(D5,H*1.010,'5'),COLORBLUE;
DRAWTEXT(D6,H*1.010,'6'),COLORBLUE;
DRAWTEXT(D7,H*1.010,'7'),COLORBLUE;
DRAWTEXT(D8,H*1.010,'8'),COLORBLUE;
DRAWTEXT(D9,H*1.010,'9'),COLORGREEN;`};return r};J.prototype.TEST=function(){var r={Name:"TEST",Description:"测试脚本",IsMainIndex:!1,Args:[{Name:"N",Value:10}],Script:"DRAWCHANNEL(OPEN>C,H,L, 'RGB(255,94,102)', 2 ,'5,5','RGBA(58,20,62,0.3)' );"};return r};if(!X)var X={Chart:{Log:console.log,Warn:console.warn},Complier:{Log:console.log,Warn:console.warn}};function _t(r,n,e){this.DivElement=r,this.DivToolElement=null,this.JSChartContainer,this.CanvasElement=document.createElement("canvas"),this.CanvasElement.className="jschart-drawing",this.CanvasElement.id=oe(),this.CanvasElement.setAttribute("tabindex",0),this.CanvasElement.style&&(this.CanvasElement.style.outline="none"),r.hasChildNodes()&&X.Chart.Log("[JSChart::JSChart] divElement hasChildNodes",r.childNodes),r.appendChild(this.CanvasElement),this.OffscreenCanvasElement,n==!0&&(this.OffscreenCanvasElement=document.createElement("canvas")),this.CacheCanvasElement=null,e&&(this.CacheCanvasElement=document.createElement("canvas")),this.ModifyIndexDialog=new eI(r),this.ChangeIndexDialog=new aI(r),this.MinuteDialog=new iI(r),this.MapExtraCanvasElement=new Dt.default,this.CreateExtraCanvasElmement=function(t){if(this.MapExtraCanvasElement.has(t))return this.MapExtraCanvasElement.get(t);var a=document.createElement("canvas");a.className="jschart-drawing-extra",a.id=oe(),t==_t.CorssCursorCanvasKey?a.setAttribute("tabindex",5):a.setAttribute("tabindex",1),a.style&&(a.style.outline="none",a.style.position="absolute",a.style.left="0px",a.style.top="0px",a.style["pointer-events"]="none"),r.appendChild(a);var s={Element:a,Canvas:null};this.MapExtraCanvasElement.set(t,s)},this.GetExtraCanvas=function(t){if(!this.MapExtraCanvasElement.has(t))return null;var a=this.MapExtraCanvasElement.get(t);return a.Element?(a.Canvas||(a.Canvas=a.Element.getContext("2d")),a):null},this.OnSize=function(t){var a=parseInt(this.DivElement.style.height.replace("px",""));this.ToolElement&&(a-=this.ToolElement.style.height.replace("px","")),this.CanvasElement.height=a,this.CanvasElement.width=parseInt(this.DivElement.style.width.replace("px","")),this.CanvasElement.style.width=this.CanvasElement.width+"px",this.CanvasElement.style.height=this.CanvasElement.height+"px";var s=V();this.CanvasElement.height*=s,this.CanvasElement.width*=s,this.OffscreenCanvasElement&&(this.OffscreenCanvasElement.height=this.CanvasElement.height,this.OffscreenCanvasElement.width=this.CanvasElement.width),this.CacheCanvasElement&&(this.CacheCanvasElement.height=this.CanvasElement.height,this.CacheCanvasElement.width=this.CanvasElement.width);var o=!0,h=!1,l=void 0;try{for(var u=(0,we.default)(this.MapExtraCanvasElement),f;!(o=(f=u.next()).done);o=!0){var C=f.value,D=C[1],v=D.Element;v&&(v.height=this.CanvasElement.height,v.width=this.CanvasElement.width,v.style.width=this.CanvasElement.style.width,v.style.height=this.CanvasElement.style.height)}}catch(S){h=!0,l=S}finally{try{!o&&u.return&&u.return()}finally{if(h)throw l}}X.Chart.Log("[JSChart::OnSize] devicePixelRatio="+window.devicePixelRatio+", height="+this.CanvasElement.height+", width="+this.CanvasElement.width),!(t&&t.Redraw==!1)&&this.JSChartContainer&&(t&&t.XYSplit===!0&&this.JSChartContainer.ResetFrameXYSplit(),this.JSChartContainer.OnSize&&t&&t.Type==1?this.JSChartContainer.OnSize():(this.JSChartContainer.Frame&&this.JSChartContainer.Frame.SetSizeChage(!0),this.JSChartContainer.Draw()))},this.AdjustChartBorder=function(t){var a=V();if(t.Frame.ChartBorder.Left*=a,t.Frame.ChartBorder.Right*=a,t.Frame.ChartBorder.Top*=a,t.Frame.ChartBorder.Bottom*=a,t.Frame.AutoLeftBorder){var s=t.Frame.AutoLeftBorder;c.IsNumber(s.MinWidth)&&(s.MinWidth*=a),c.IsNumber(s.Blank)&&(s.Blank*=a)}if(t.Frame.AutoRightBorder){var s=t.Frame.AutoRightBorder;c.IsNumber(s.MinWidth)&&(s.MinWidth*=a),c.IsNumber(s.Blank)&&(s.Blank*=a)}},this.AdjustTitleHeight=function(t){for(var a=V(),s=0;s<t.Frame.SubFrame.length;++s)t.Frame.SubFrame[s].Frame.ChartBorder.TitleHeight*=a;t.ChartCorssCursor.TextHeight*=a},this.SetChartBorder=function(t,a){if(a.Border){var s=a.Border;c.IsNumber(a.Border.Left)?t.Frame.ChartBorder.Left=a.Border.Left:a.Border.Left=t.Frame.ChartBorder.Left,c.IsNumber(a.Border.Right)?t.Frame.ChartBorder.Right=a.Border.Right:a.Border.Right=t.Frame.ChartBorder.Right,c.IsNumber(a.Border.Top)?t.Frame.ChartBorder.Top=a.Border.Top:a.Border.Top=t.Frame.ChartBorder.Top,c.IsNumber(a.Border.Bottom)?t.Frame.ChartBorder.Bottom=a.Border.Bottom:a.Border.Bottom=t.Frame.ChartBorder.Bottom,s.AutoLeft&&(t.Frame.AutoLeftBorder={},c.IsNumber(s.AutoLeft.Blank)&&(t.Frame.AutoLeftBorder.Blank=s.AutoLeft.Blank),c.IsNumber(s.AutoLeft.MinWidth)&&(t.Frame.AutoLeftBorder.MinWidth=s.AutoLeft.MinWidth)),s.AutoRight&&(t.Frame.AutoRightBorder={},c.IsNumber(s.AutoRight.Blank)&&(t.Frame.AutoRightBorder.Blank=s.AutoRight.Blank),c.IsNumber(s.AutoRight.MinWidth)&&(t.Frame.AutoRightBorder.MinWidth=s.AutoRight.MinWidth))}},this.SetEventCallback=function(t,a){if(t&&c.IsNonEmptyArray(a))for(var s=0;s<a.length;++s){var o=a[s];t.AddEventCallback(o)}},this.CreateKLineChartContainer=function(t){var a=null;t.Type==="历史K线图横屏"?a=new jC(this.CanvasElement):a=new Te(this.CanvasElement,this.OffscreenCanvasElement,this.CacheCanvasElement);var s=this.GetExtraCanvas(_t.CorssCursorCanvasKey);if(s&&a.SetCorssCursorElement(s),t.EventCallback&&this.SetEventCallback(a,t.EventCallback),t.NetworkFilter&&(a.NetworkFilter=t.NetworkFilter),a.ModifyIndexDialog=this.ModifyIndexDialog,a.ChangeIndexDialog=this.ChangeIndexDialog,a.MinuteDialog=this.MinuteDialog,t.IsShowRightMenu==!0&&(a.RightMenu=new ts(this.DivElement)),t.ScriptError&&(a.ScriptErrorCallback=t.ScriptError),a.SelectRectRightMenu=new hI(this.DivElement),t.EnableScrollUpDown==!0&&(a.EnableScrollUpDown=t.EnableScrollUpDown),t.DisableMouse==!0&&(a.DisableMouse=t.DisableMouse),t.TouchMoveMinAngle&&(a.TouchMoveMinAngle=t.TouchMoveMinAngle),t.EnableZoomUpDown&&(a.EnableZoomUpDown=t.EnableZoomUpDown),c.IsString(t.SplashTitle)&&(a.LoadDataSplashTitle=t.SplashTitle),c.IsBool(t.EnableZoomIndexWindow)&&(a.EnableZoomIndexWindow=t.EnableZoomIndexWindow),c.IsBool(t.IsDrawPictureXY)&&(a.IsDrawPictureXY=t.IsDrawPictureXY),c.IsNumber(t.CtrlMoveStep)&&(a.CtrlMoveStep=t.CtrlMoveStep),c.IsBool(t.EnableIndexChartDrag)&&(a.EnableIndexChartDrag=t.EnableIndexChartDrag),c.IsBool(t.EnableVerifyRecvData)&&(a.EnableVerifyRecvData=t.EnableVerifyRecvData),t.EnableYDrag){var o=t.EnableYDrag;c.IsBool(o.Left)&&(a.EnableYDrag.Left=o.Left),c.IsBool(o.Right)&&(a.EnableYDrag.Right=o.Right)}if(t.KLine&&(t.KLine.DragMode>=0&&(a.DragMode=t.KLine.DragMode),t.KLine.Right>=0&&(a.Right=t.KLine.Right),t.KLine.Period>=0&&(a.Period=t.KLine.Period),t.KLine.MaxReqeustDataCount>0&&(a.MaxRequestDataCount=t.KLine.MaxReqeustDataCount),t.KLine.MaxRequestDataCount>0&&(a.MaxRequestDataCount=t.KLine.MaxRequestDataCount),t.KLine.Info&&t.KLine.Info.length>0&&a.SetKLineInfo(t.KLine.Info,!1),t.KLine.IndexTreeApiUrl&&(a.ChangeIndexDialog.IndexTreeApiUrl=t.KLine.IndexTreeApiUrl),t.KLine.KLineDoubleClick==!1&&(a.MinuteDialog=this.MinuteDialog=null),t.KLine.IndexTreeApiUrl!=null&&(a.ChangeIndexDialog.IndexTreeApiUrl=t.KLine.IndexTreeApiUrl),t.KLine.IsShowTooltip==!1&&(a.IsShowTooltip=!1),t.KLine.MaxRequestMinuteDayCount>0&&(a.MaxRequestMinuteDayCount=t.KLine.MaxRequestMinuteDayCount),t.KLine.DrawType&&(a.KLineDrawType=t.KLine.DrawType),t.KLine.FirstShowDate>19910101&&(a.CustomShow={Date:t.KLine.FirstShowDate,PageSize:t.KLine.PageSize}),t.KLine.RightSpaceCount>0&&(a.RightSpaceCount=t.KLine.RightSpaceCount),t.KLine.ZoomType>0&&(a.ZoomType=t.KLine.ZoomType),t.KLine.DataWidth>=1&&(a.KLineSize={DataWidth:t.KLine.DataWidth}),c.IsNumber(t.KLine.RightFormula)&&(a.RightFormula=t.KLine.RightFormula)),t.EnableFlowCapital){var o=t.EnableFlowCapital;o.BIT==!0&&(a.EnableFlowCapital.BIT=o.BIT)}if(c.IsBool(t.EnableBorderDrag)&&(a.EnableBorderDrag=t.EnableBorderDrag),t.Page&&(t.Page.Day&&t.Page.Day.Enable==!0&&(a.Page.Day.Enable=!0),t.Page.Minute&&t.Page.Minute.Enable==!0&&(a.Page.Minute.Enable=!0)),t.DragDownload&&(t.DragDownload.Day&&t.DragDownload.Day.Enable==!0&&(a.DragDownload.Day.Enable=!0),t.DragDownload.Minute&&t.DragDownload.Minute.Enable==!0&&(a.DragDownload.Minute.Enable=!0)),t.ZoomDownload&&(t.ZoomDownload.Day&&c.IsBool(t.ZoomDownload.Day.Enable)&&(a.ZoomDownload.Day.Enable=t.ZoomDownload.Day.Enable),t.ZoomDownload.Minute&&c.IsBool(t.ZoomDownload.Minute.Enable)&&(a.ZoomDownload.Minute.Enable=t.ZoomDownload.Minute.Enable)),t.Language){var h=gt.GetLanguageID(t.Language);c.IsNumber(h)&&(a.LanguageID=h)}if(t.SourceDatatLimit&&a.SetSourceDatatLimit(t.SourceDatatLimit),t.DrawPicture&&t.DrawPicture.StorageKey&&a.ChartDrawStorage&&a.ChartDrawStorage.Load(t.DrawPicture.StorageKey),t.DrawTool&&t.DrawTool.StorageKey&&a.ChartDrawStorage&&a.ChartDrawStorage.Load(t.DrawTool.StorageKey),c.IsNumber(t.StepPixel)&&(a.StepPixel=t.StepPixel),t.ZoomStepPixel>0&&(a.ZoomStepPixel=t.ZoomStepPixel),t.IsApiPeriod==!0&&(a.IsApiPeriod=t.IsApiPeriod),t.SelectedChart){var o=t.SelectedChart;c.IsBool(o.EnableSelected)&&(a.SelectedChart.EnableSelected=o.EnableSelected),c.IsBool(o.EnableMoveOn)&&(a.SelectedChart.EnableMoveOn=o.EnableMoveOn)}if(!t.Windows||t.Windows.length<=0)return null;if(c.IsNonEmptyArray(t.KLineCalcOption))for(var l=0;l<t.KLineCalcOption.length;++l){var o=t.KLineCalcOption[l];!o.ClassName||!o.Option||a.SetKLineCalcOption(o.ClassName,o.Option)}if(a.Create(t.Windows.length,t),this.SetChartBorder(a,t),this.AdjustChartBorder(a),t.KLine&&t.KLine.PageSize>0){var u=a.GetMaxMinPageSize();u.Max>10&&u.Max<t.KLine.PageSize?a.PageSize=u.Max:u.Min>10&&u.Min>t.KLine.PageSize?a.PageSize=u.Min:a.PageSize=t.KLine.PageSize}if(t.IsCorssOnlyDrawKLine===!0&&(a.ChartCorssCursor.IsOnlyDrawKLine=t.IsCorssOnlyDrawKLine),t.CorssCursorTouchEnd===!0&&(a.CorssCursorTouchEnd=t.CorssCursorTouchEnd),t.IsClickShowCorssCursor==!0&&(a.IsClickShowCorssCursor=t.IsClickShowCorssCursor),t.CorssCursorInfo){var o=t.CorssCursorInfo;isNaN(t.CorssCursorInfo.Left)||(a.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),isNaN(t.CorssCursorInfo.Right)||(a.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),isNaN(t.CorssCursorInfo.Bottom)||(a.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),t.CorssCursorInfo.IsShowCorss===!1&&(a.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),t.CorssCursorInfo.IsShowClose==!0&&(a.ChartCorssCursor.IsShowClose=t.CorssCursorInfo.IsShowClose),t.CorssCursorInfo.PressTime&&(a.PressTime=t.CorssCursorInfo.PressTime),c.IsNumber(t.CorssCursorInfo.HPenType)&&(a.ChartCorssCursor.HPenType=t.CorssCursorInfo.HPenType),t.CorssCursorInfo.VPenType>0&&(a.ChartCorssCursor.VPenType=t.CorssCursorInfo.VPenType),c.IsNumber(o.VLineType)&&(a.ChartCorssCursor.VLineType=o.VLineType),t.CorssCursorInfo.DateFormatType>0&&(a.ChartCorssCursor.StringFormatX.DateFormatType=t.CorssCursorInfo.DateFormatType),c.IsBool(o.IsDrawXRangeBG)&&(a.ChartCorssCursor.IsDrawXRangeBG=o.IsDrawXRangeBG),c.IsBool(t.CorssCursorInfo.IsFixXLastTime)&&(a.ChartCorssCursor.IsFixXLastTime=t.CorssCursorInfo.IsFixXLastTime),c.IsNumber(o.TextHeight)&&(a.ChartCorssCursor.TextHeight=o.TextHeight),o.RightButton&&c.IsBool(o.RightButton.Enable)&&(a.ChartCorssCursor.RightButton.Enable=o.RightButton.Enable),c.IsNumber(o.PriceFormatType)&&(a.ChartCorssCursor.StringFormatY.PriceFormatType=o.PriceFormatType),c.IsNumber(o.DataFormatType)&&(a.ChartCorssCursor.StringFormatY.DataFormatType=o.DataFormatType)}if(t.CorssCursor={},t.CorssCursor.TitleHeight=a.ChartCorssCursor.TextHeight,c.IsNumber(t.SplashTitlePosition)&&a.ChartSplashPaint&&(a.ChartSplashPaint.Position=t.SplashTitlePosition),t.Frame)for(var l=0;l<t.Frame.length;++l){var o=t.Frame[l];if(a.Frame.SubFrame[l]){var f=a.Frame.SubFrame[l].Frame;c.IsNumber(o.SplitCount)&&(a.Frame.SubFrame[l].Frame.YSplitOperator.SplitCount=o.SplitCount),o.StringFormat&&(a.Frame.SubFrame[l].Frame.YSplitOperator.StringFormat=o.StringFormat),c.IsNumber(o.FloatPrecision)&&(a.Frame.SubFrame[l].Frame.YSplitOperator.FloatPrecision=o.FloatPrecision),o.Custom&&(a.Frame.SubFrame[l].Frame.YSplitOperator.Custom=o.Custom),c.IsNumber(o.SplitType)&&(a.Frame.SubFrame[l].Frame.YSplitOperator.SplitType=o.SplitType,a.Frame.SubFrame[l].Frame.YSplitOperator.DefaultSplitType=o.SplitType),isNaN(o.Height)||(a.Frame.SubFrame[l].Height=o.Height),(o.IsShowLeftText===!1||o.IsShowLeftText===!0)&&(a.Frame.SubFrame[l].Frame.IsShowYText[0]=o.IsShowLeftText,a.Frame.SubFrame[l].Frame.YSplitOperator.IsShowLeftText=o.IsShowLeftText),(o.IsShowRightText===!1||o.IsShowRightText===!0)&&(a.Frame.SubFrame[l].Frame.IsShowYText[1]=o.IsShowRightText,a.Frame.SubFrame[l].Frame.YSplitOperator.IsShowRightText=o.IsShowRightText),o.TopSpace>=0&&(a.Frame.SubFrame[l].Frame.ChartBorder.TopSpace=o.TopSpace),o.BottomSpace>=0&&(a.Frame.SubFrame[l].Frame.ChartBorder.BottomSpace=o.BottomSpace),o.RightTextPosition>0&&(a.Frame.SubFrame[l].Frame.YTextPosition[1]=o.RightTextPosition),o.LeftTextPosition>0&&(a.Frame.SubFrame[l].Frame.YTextPosition[0]=o.LeftTextPosition),o.IsShowXLine==!1&&(a.Frame.SubFrame[l].Frame.IsShowXLine=o.IsShowXLine),o.IsShowYLine==!1&&(a.Frame.SubFrame[l].Frame.IsShowYLine=o.IsShowYLine),c.IsNumber(o.YTextBaseline)&&(a.Frame.SubFrame[l].Frame.YTextBaseline=o.YTextBaseline),o.YCoordinateType>0&&(a.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=o.YCoordinateType),o.IsYReverse==!0&&(a.Frame.SubFrame[0].Frame.CoordinateType=1),c.IsNumber(o.PercentageTextFormat)&&(f.YSplitOperator.PercentageTextFormat=o.PercentageTextFormat),o.DefaultYMaxMin&&(a.Frame.SubFrame[l].Frame.YSplitOperator.DefaultYMaxMin=o.DefaultYMaxMin),c.IsBool(o.EnableRemoveZero)&&(a.Frame.SubFrame[l].Frame.YSplitOperator.EnableRemoveZero=o.EnableRemoveZero),c.IsPlusNumber(o.MinYDistance)&&(a.Frame.SubFrame[l].Frame.MinYDistance=o.MinYDistance),c.IsNumber(o.BorderLine)&&(a.Frame.SubFrame[l].Frame.BorderLine=o.BorderLine),c.IsBool(o.IsShowIndexTitle)&&(a.Frame.SubFrame[l].Frame.IsShowIndexTitle=o.IsShowIndexTitle),c.IsBool(o.IsDrawTitleBottomLine)&&(f.IsDrawTitleBottomLine=o.IsDrawTitleBottomLine),c.IsBool(o.IsShowNameArrow)&&(a.Frame.SubFrame[l].Frame.IsShowNameArrow=o.IsShowNameArrow)}}if(t.KLine&&(t.KLine.ShowKLine==!1&&(a.ChartPaint[0].IsShow=!1),t.KLine.InfoPosition>0&&(a.ChartPaint[0].InfoPosition=t.KLine.InfoPosition),t.KLine.IsShowMaxMinPrice==!1&&(a.ChartPaint[0].IsShowMaxMinPrice=t.KLine.IsShowMaxMinPrice)),t.KLineTitle){var o=t.KLineTitle;t.KLineTitle.IsShowName==!1&&(a.TitlePaint[0].IsShowName=!1),t.KLineTitle.IsShowSettingInfo==!1&&(a.TitlePaint[0].IsShowSettingInfo=!1),t.KLineTitle.IsShow==!1&&(a.TitlePaint[0].IsShow=!1),c.IsBool(o.IsTitleShowLatestData)&&(a.IsTitleShowLatestData=o.IsTitleShowLatestData)}if(t.Overlay)for(var l=0;l<t.Overlay.length;++l){var o=t.Overlay[l];a.OverlaySymbol(o.Symbol,o)}if(t.ExtendChart)for(var l=0;l<t.ExtendChart.length;++l){var o=t.ExtendChart[l];a.CreateExtendChart(o.Name,o)}var C=new J;if(t.ColorIndex){var o=t.ColorIndex,D=C.Get(o.Index);D&&(D.ID=o.Index,a.ColorIndex=new de(D.Name,D.Script,D.Args,D))}if(t.TradeIndex){var o=t.TradeIndex,v=C.Get(o.Index);v&&(v.ID=o.Index,a.TradeIndex=new de(v.Name,v.Script,v.Args,v))}for(var l=0;l<t.Windows.length;++l){var o=t.Windows[l];if(o.Script)a.WindowIndex[l]=new de(o.Name,o.Script,o.Args,o);else if(o.JsonData)a.WindowIndex[l]=new Um(o.Name,o.Script,o.Args,o);else if(o.Local&&o.Local.Data)a.WindowIndex[l]=new LI(o.Local.Name,o.Local.Args,{JsonData:o.Local.Data});else if(o.API){var S=o.API;a.WindowIndex[l]=new Ma(S.Name,S.Script,S.Args,o)}else{var T=Ja.Get(o.Index);if(T)a.WindowIndex[l]=T.Create(o.Option),a.WindowIndex[l].SetArgs&&a.WindowIndex[l].SetArgs(o.Args),a.CreateWindowIndex(l);else{var I=C.Get(o.Index);if(!I)continue;o.Lock&&(I.Lock=o.Lock),I.ID=o.Index;var F=I.Args;o.Args&&(F=o.Args),o.IsShortTitle&&(I.IsShortTitle=o.IsShortTitle),o.TitleFont&&(I.TitleFont=o.TitleFont),c.IsBool(o.IsSync)&&(I.IsSync=o.IsSync),a.WindowIndex[l]=new de(I.Name,I.Script,F,I),o.StringFormat>0&&(a.WindowIndex[l].StringFormat=o.StringFormat),o.FloatPrecision>=0&&(a.WindowIndex[l].FloatPrecision=o.FloatPrecision)}}var E=a.Frame.SubFrame[l].Frame;c.IsBool(o.Modify)&&(E.ModifyIndex=o.Modify),c.IsBool(o.Change)&&(E.ChangeIndex=o.Change),c.IsBool(o.Close)&&(E.CloseIndex=o.Close),c.IsBool(o.Overlay)&&(E.OverlayIndex=o.Overlay),c.IsBool(o.Export)&&(E.ExportData=o.Export),c.IsBool(o.MaxMin)&&(a.Frame.SubFrame[l].Frame.MaxMinWindow=o.MaxMin),c.IsBool(o.TitleWindow)&&(a.Frame.SubFrame[l].Frame.TitleWindow=o.TitleWindow),o.IsDrawTitleBG==!0&&(a.Frame.SubFrame[l].Frame.IsDrawTitleBG=o.IsDrawTitleBG),c.IsBool(o.IsShowNameArrow)&&(a.Frame.SubFrame[l].Frame.IsShowNameArrow=o.IsShowNameArrow),c.IsNumber(o.TitleHeight)?a.Frame.SubFrame[l].Frame.ChartBorder.TitleHeight=o.TitleHeight:o.TitleHeight=a.Frame.SubFrame[l].Frame.ChartBorder.TitleHeight,o.IsShowTitleArraw==!1&&(a.Frame.SubFrame[l].Frame.IsShowTitleArraw=!1),o.IsShowIndexName==!1&&(a.Frame.SubFrame[l].Frame.IsShowIndexName=!1),o.IsShowOverlayIndexName==!1&&(a.Frame.SubFrame[l].Frame.IsShowOverlayIndexName=!1),c.IsNumber(o.IndexParamSpace)&&(a.Frame.SubFrame[l].Frame.IndexParamSpace=o.IndexParamSpace),c.IsNumber(o.IndexTitleSpace)&&(a.Frame.SubFrame[l].Frame.IndexTitleSpace=o.IndexTitleSpace),o.OverlayIndexType&&(c.IsNumber(o.OverlayIndexType.Position)&&(a.Frame.SubFrame[l].Frame.OverlayIndexType.Position=o.OverlayIndexType.Position),c.IsNumber(o.OverlayIndexType.LineSpace)&&(a.Frame.SubFrame[l].Frame.OverlayIndexType.LineSpace=o.OverlayIndexType.LineSpace))}if(t.OverlayIndexFrameWidth>40&&(a.OverlayIndexFrameWidth=t.OverlayIndexFrameWidth),c.IsNonEmptyArray(t.OverlayIndex))for(var l=0;l<t.OverlayIndex.length;++l){var o=t.OverlayIndex[l];if(!(o.Windows>=a.Frame.SubFrame.length)){var M=(0,jr.default)(o),O=JSON.parse(M);o.Index&&(O.IndexName=o.Index),o.Windows>=0&&(O.WindowIndex=o.Windows),a.CreateOverlayWindowsIndex(O)}}return this.AdjustTitleHeight(a),a},this.CreateCustomKLineChartContainer=function(t){var a=new Om(this.CanvasElement);if(a.ModifyIndexDialog=this.ModifyIndexDialog,a.ChangeIndexDialog=this.ChangeIndexDialog,a.MinuteDialog=this.MinuteDialog,t.IsShowRightMenu==!0&&(a.RightMenu=new ts(this.DivElement)),t.KLine&&(t.KLine.DragMode>=0&&(a.DragMode=t.KLine.DragMode),t.KLine.Right>=0&&(a.Right=t.KLine.Right),t.KLine.Period>=0&&(a.Period=t.KLine.Period),t.KLine.MaxRequestDataCount>0&&(a.MaxRequestDataCount=t.KLine.MaxRequestDataCount),t.KLine.Info&&t.KLine.Info.length>0&&a.SetKLineInfo(t.KLine.Info,!1),t.KLine.IndexTreeApiUrl&&(a.ChangeIndexDialog.IndexTreeApiUrl=t.KLine.IndexTreeApiUrl),t.KLine.KLineDoubleClick==!1&&(a.MinuteDialog=this.MinuteDialog=null),t.KLine.IndexTreeApiUrl!=null&&(a.ChangeIndexDialog.IndexTreeApiUrl=t.KLine.IndexTreeApiUrl),t.KLine.PageSize>0&&(a.PageSize=t.KLine.PageSize),t.KLine.IsShowTooltip==!1&&(a.IsShowTooltip=!1)),t.CustomStock&&(a.CustomStock=t.CustomStock),t.QueryDate&&(a.QueryDate=t.QueryDate),!t.Windows||t.Windows.length<=0)return null;if(a.Create(t.Windows.length),t.Border&&(isNaN(t.Border.Left)||(a.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(a.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(a.Frame.ChartBorder.Top=t.Border.Top)),t.IsShowCorssCursorInfo==!1&&(a.ChartCorssCursor.IsShowText=t.IsShowCorssCursorInfo),t.Frame)for(var s=0;s<t.Frame.length;++s){var o=t.Frame[s];o.SplitCount&&(a.Frame.SubFrame[s].Frame.YSplitOperator.SplitCount=o.SplitCount),o.StringFormat&&(a.Frame.SubFrame[s].Frame.YSplitOperator.StringFormat=o.StringFormat)}t.KLineTitle&&(t.KLineTitle.IsShowName==!1&&(a.TitlePaint[0].IsShowName=!1),t.KLineTitle.IsShowSettingInfo==!1&&(a.TitlePaint[0].IsShowSettingInfo=!1));for(var h=new J,s=0;s<t.Windows.length;++s){var o=t.Windows[s];if(o.Script)a.WindowIndex[s]=new de(o.Name,o.Script,o.Args,o);else{var l=Ja.Get(o.Index);if(l)a.WindowIndex[s]=l.Create(),a.CreateWindowIndex(s);else{var u=h.Get(o.Index);if(!u)continue;o.Lock&&(u.Lock=o.Lock),a.WindowIndex[s]=new de(u.Name,u.Script,u.Args,u)}}o.Modify!=null&&(a.Frame.SubFrame[s].Frame.ModifyIndex=o.Modify),o.Change!=null&&(a.Frame.SubFrame[s].Frame.ChangeIndex=o.Change),isNaN(o.TitleHeight)||(a.Frame.SubFrame[s].Frame.ChartBorder.TitleHeight=o.TitleHeight)}return a},this.CreateMinuteChartContainer=function(t){var a=null;t.Type==="分钟走势图横屏"?a=new Ju(this.CanvasElement):a=new re(this.CanvasElement,this.OffscreenCanvasElement,this.CacheCanvasElement),t.EventCallback&&this.SetEventCallback(a,t.EventCallback),t.NetworkFilter&&(a.NetworkFilter=t.NetworkFilter),a.ModifyIndexDialog=this.ModifyIndexDialog,a.ChangeIndexDialog=this.ChangeIndexDialog;var s=2;if(t.Windows&&t.Windows.length>0&&(s+=t.Windows.length),t.EnableScrollUpDown==!0&&(a.EnableScrollUpDown=t.EnableScrollUpDown),t.DisableMouse==!0&&(a.DisableMouse=t.DisableMouse),t.ScriptError&&(a.ScriptErrorCallback=t.ScriptError),c.IsString(t.SplashTitle)&&(a.LoadDataSplashTitle=t.SplashTitle),c.IsBool(t.EnableSelectRect)&&(a.EnableSelectRect=t.EnableSelectRect),c.IsBool(t.EnableZoomIndexWindow)&&(a.EnableZoomIndexWindow=t.EnableZoomIndexWindow),c.IsBool(t.IsDrawPictureXY)&&(a.IsDrawPictureXY=t.IsDrawPictureXY),c.IsBool(t.EnableNewIndex)&&(a.EnableNewIndex=t.EnableNewIndex),c.IsBool(t.EnableIndexChartDrag)&&(a.EnableIndexChartDrag=t.EnableIndexChartDrag),c.IsBool(t.EnableVerifyRecvData)&&(a.EnableVerifyRecvData=t.EnableVerifyRecvData),t.GlobalOption){var o=t.GlobalOption;c.IsBool(o.IsValueFullRange)&&(a.GlobalOption.IsValueFullRange=o.IsValueFullRange),c.IsNumber(o.XDateFormat)&&(a.GlobalOption.XDateFormat=o.XDateFormat)}if(t.DisplayLatest){var o=t.DisplayLatest;c.IsBool(o.Enable)&&(a.DisplayLatestOption.Enable=o.Enable),c.IsNumber(o.DelayTime)&&(a.DisplayLatestOption.DelayTime=o.DelayTime)}if(t.DrawDynamicInfo){var o=t.DrawDynamicInfo;c.IsBool(o.Enable)&&(a.DrawDynamicInfoOption.Enable=o.Enable),c.IsNumber(o.DelayTime)&&(a.DrawDynamicInfoOption.DelayTime=o.DelayTime)}if(a.SelectRectDialog=new rI(this.DivElement),t.Minute&&(t.Minute.IsShowTooltip==!1&&(a.IsShowTooltip=!1),t.Minute.DragMode>=0&&(a.DragMode=t.Minute.DragMode)),t.Language){var h=gt.GetLanguageID(t.Language);c.IsNumber(h)&&(a.LanguageID=h)}if(t.Info&&t.Info.length>0&&a.SetMinuteInfo(t.Info,!1),t.DrawTool&&t.DrawTool.StorageKey&&a.ChartDrawStorage&&a.ChartDrawStorage.Load(t.DrawTool.StorageKey),t.BeforeOpen){var o=t.BeforeOpen;c.IsBool(o.IsShow)&&(a.IsShowBeforeData=o.IsShow),c.IsNumber(o.Width)&&(a.ExtendWidth.Left=o.Width),c.IsBool(o.IsShowMultiDay)&&(a.IsShowMultiDayBeforeData=o.IsShowMultiDay),c.IsNumber(o.MulitiDayWidth)&&(a.MultiDayExtendWidth.Left=o.MulitiDayWidth)}if(t.AfterClose){var o=t.AfterClose;c.IsBool(o.IsShow)&&(a.IsShowAfterData=o.IsShow),c.IsNumber(o.ShareVol)&&(a.ShareAfterVol=o.ShareVol),c.IsNumber(o.Width)&&(a.ExtendWidth.Right=o.Width),c.IsBool(o.IsShowMultiDay)&&(a.IsShowMultiDayAfterData=o.IsShowMultiDay),c.IsNumber(o.MulitiDayWidth)&&(a.MultiDayExtendWidth.Right=o.MulitiDayWidth)}if(t.SelectedChart){var o=t.SelectedChart;c.IsBool(o.EnableSelected)&&(a.SelectedChart.EnableSelected=o.EnableSelected),c.IsBool(o.EnableMoveOn)&&(a.SelectedChart.EnableMoveOn=o.EnableMoveOn)}if(t.PageInfo&&a.SetPageInfo(t.PageInfo),a.Create(s,t),t.CorssCursorInfo){var o=t.CorssCursorInfo;isNaN(t.CorssCursorInfo.Left)||(a.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),isNaN(t.CorssCursorInfo.Right)||(a.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),isNaN(t.CorssCursorInfo.Bottom)||(a.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),t.CorssCursorInfo.IsShowCorss===!1&&(a.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),t.CorssCursorInfo.RightTextFormat>0&&(a.ChartCorssCursor.TextFormat.Right=t.CorssCursorInfo.RightTextFormat),t.CorssCursorInfo.IsOnlyDrawMinute==!0&&(a.ChartCorssCursor.IsOnlyDrawMinute=t.CorssCursorInfo.IsOnlyDrawMinute),c.IsBool(t.CorssCursorInfo.IsFixXLastTime)&&(a.ChartCorssCursor.IsFixXLastTime=t.CorssCursorInfo.IsFixXLastTime),o.RightButton&&c.IsBool(o.RightButton.Enable)&&(a.ChartCorssCursor.RightButton.Enable=o.RightButton.Enable),c.IsNumber(o.PriceFormatType)&&(a.ChartCorssCursor.StringFormatY.PriceFormatType=o.PriceFormatType),c.IsNumber(o.DataFormatType)&&(a.ChartCorssCursor.StringFormatY.DataFormatType=o.DataFormatType),c.IsNumber(o.HPenType)&&(a.ChartCorssCursor.HPenType=o.HPenType),c.IsNumber(o.VPenType)&&(a.ChartCorssCursor.VPenType=o.VPenType)}if(t.MinuteInfo&&a.CreateMinuteInfo(t.MinuteInfo),t.IsShowRightMenu==!0&&(a.RightMenu=new lI(this.DivElement)),c.IsNumber(t.DayCount)&&(a.DayCount=t.DayCount),this.SetChartBorder(a,t),t.SplashTitle&&(a.ChartSplashPaint.SplashTitle=t.SplashTitle),c.IsBool(t.EnableBorderDrag)&&(a.EnableBorderDrag=t.EnableBorderDrag),this.AdjustChartBorder(a),t.Frame){for(var l=0;l<t.Frame.length;++l){var o=t.Frame[l];a.Frame.SubFrame[l]&&(c.IsNumber(o.SplitCount)&&(a.Frame.SubFrame[l].Frame.YSplitOperator.SplitCount=o.SplitCount),o.StringFormat&&(a.Frame.SubFrame[l].Frame.YSplitOperator.StringFormat=o.StringFormat),c.IsNumber(o.SplitType)&&(a.Frame.SubFrame[l].Frame.YSplitOperator.SplitType=o.SplitType,a.Frame.SubFrame[l].Frame.YSplitOperator.DefaultSplitType=o.SplitType),o.IsShowLeftText==!1&&(a.Frame.SubFrame[l].Frame.IsShowYText[0]=o.IsShowLeftText,a.Frame.SubFrame[l].Frame.YSplitOperator.IsShowLeftText=o.IsShowLeftText),o.IsShowRightText==!1&&(a.Frame.SubFrame[l].Frame.IsShowYText[1]=o.IsShowRightText,a.Frame.SubFrame[l].Frame.YSplitOperator.IsShowRightText=o.IsShowRightText),o.Height>=0&&(a.Frame.SubFrame[l].Height=o.Height),o.Custom&&(a.Frame.SubFrame[l].Frame.YSplitOperator.Custom=o.Custom),o.RightTextFormat>0&&(a.Frame.SubFrame[l].Frame.YSplitOperator.RightTextFormat=o.RightTextFormat),c.IsNumber(o.TitleHeight)&&(a.Frame.SubFrame[l].Frame.ChartBorder.TitleHeight=o.TitleHeight),c.IsNumber(o.BorderLine)&&(a.Frame.SubFrame[l].Frame.BorderLine=o.BorderLine),c.IsBool(o.EnableRemoveZero)&&(a.Frame.SubFrame[l].Frame.YSplitOperator.EnableRemoveZero=o.EnableRemoveZero),c.IsNumber(o.FloatPrecision)&&(a.Frame.SubFrame[l].Frame.YSplitOperator.FloatPrecision=o.FloatPrecision),c.IsBool(o.IsShowXLine)&&(a.Frame.SubFrame[l].Frame.IsShowXLine=o.IsShowXLine),c.IsBool(o.IsShowYLine)&&(a.Frame.SubFrame[l].Frame.IsShowYLine=o.IsShowYLine),c.IsNumber(o.YTextBaseline)&&(a.Frame.SubFrame[l].Frame.YTextBaseline=o.YTextBaseline),o.TopSpace>=0&&(a.Frame.SubFrame[l].Frame.ChartBorder.TopSpace=o.TopSpace),o.BottomSpace>=0&&(a.Frame.SubFrame[l].Frame.ChartBorder.BottomSpace=o.BottomSpace))}a.UpdateXShowText()}if(t.ExtendChart)for(var l=0;l<t.ExtendChart.length;++l){var o=t.ExtendChart[l];a.CreateExtendChart(o.Name,o)}if(t.Overlay)for(var l=0;l<t.Overlay.length;++l){var o=t.Overlay[l];a.OverlaySymbol(o.Symbol,o)}if(t.MinuteLine){if(t.MinuteLine.IsDrawAreaPrice==!1&&(a.ChartPaint[0].IsDrawArea=!1),t.MinuteLine.IsShowLead==!1&&(a.IsShowLead=!1),t.MinuteLine.IsShowAveragePrice==!1){a.ChartPaint[1].IsShow=!1,a.TitlePaint[0].IsShowAveragePrice=!1;for(var l=0;l<a.ExtendChartPaint.length;++l){var o=a.ExtendChartPaint[l];o.ClassName=="MinuteTooltipPaint"&&(o.IsShowAveragePrice=!1)}}t.MinuteLine.SplitType>0&&(a.Frame.SubFrame[0].Frame.YSplitOperator.SplitType=t.MinuteLine.SplitType)}if(t.MinuteVol){var o=t.MinuteVol;c.IsNumber(o.BarColorType)&&(a.ChartPaint[2].BarColorType=o.BarColorType)}if(t.MinuteTitle){var o=t.MinuteTitle;c.IsBool(o.IsShowName)&&(a.TitlePaint[0].IsShowName=o.IsShowName),c.IsBool(o.IsShowDate)&&(a.TitlePaint[0].IsShowDate=o.IsShowDate),c.IsBool(o.IsShowTime)&&(a.TitlePaint[0].IsShowTime=o.IsShowTime),c.IsBool(o.IsTitleShowLatestData)&&(a.IsTitleShowLatestData=o.IsTitleShowLatestData),c.IsBool(o.IsAlwaysShowLastData)&&(a.TitlePaint[0].IsAlwaysShowLastData=o.IsAlwaysShowLastData),c.IsNumber(o.ShowLastDataFormat)&&(a.TitlePaint[0].ShowLastDataFormat=o.ShowLastDataFormat),o.TimeFormat&&(a.TitlePaint[0].TimeFormat=o.TimeFormat)}if(t.CorssCursorTouchEnd===!0&&(a.CorssCursorTouchEnd=t.CorssCursorTouchEnd),t.IsShowBeforeData===!0&&(a.IsShowBeforeData=t.IsShowBeforeData),c.IsNonEmptyArray(t.Windows))for(var u=new J,l=0;l<t.Windows.length;++l){var f=2+l,o=t.Windows[l];if(o.Script)a.WindowIndex[f]=new de(o.Name,o.Script,o.Args,o);else if(o.API){var C=o.API;a.WindowIndex[f]=new Ma(C.Name,C.Script,C.Args,o)}else{var D=Ja.Get(o.Index);if(D)a.WindowIndex[f]=D.Create(),a.CreateWindowIndex(f);else{var v=u.Get(o.Index);if(!v)continue;v.ID=o.Index;var S=v.Args;o.Args&&(S=o.Args),o.IsShortTitle&&(v.IsShortTitle=o.IsShortTitle),o.TitleFont&&(v.TitleFont=o.TitleFont),c.IsBool(o.IsSync)&&(v.IsSync=o.IsSync),a.WindowIndex[f]=new de(v.Name,v.Script,S,v),o.StringFormat>0&&(a.WindowIndex[f].StringFormat=o.StringFormat),o.FloatPrecision>=0&&(a.WindowIndex[f].FloatPrecision=o.FloatPrecision)}}var T=a.Frame.SubFrame[f].Frame;c.IsBool(o.Modify)&&(T.ModifyIndex=o.Modify),c.IsBool(o.Change)&&(T.ChangeIndex=o.Change),c.IsBool(o.Close)&&(T.CloseIndex=o.Close),c.IsBool(o.Overlay)&&(T.OverlayIndex=o.Overlay),c.IsBool(o.Export)&&(T.ExportData=o.Export),c.IsBool(o.MaxMin)&&(T.MaxMinWindow=o.MaxMin),c.IsBool(o.TitleWindow)&&(T.TitleWindow=o.TitleWindow),c.IsNumber(o.YSplitType)&&(a.Frame.SubFrame[f].Frame.YSplitOperator.SplitType=o.YSplitType),isNaN(o.TitleHeight)||(a.Frame.SubFrame[f].Frame.ChartBorder.TitleHeight=o.TitleHeight),c.IsBool(o.IsDrawTitleBG)&&(a.Frame.SubFrame[f].Frame.IsDrawTitleBG=o.IsDrawTitleBG),c.IsBool(o.IsShowNameArrow)&&(a.Frame.SubFrame[l].Frame.IsShowNameArrow=o.IsShowNameArrow),o.IsShowTitleArraw==!1&&(a.Frame.SubFrame[f].Frame.IsShowTitleArraw=!1),o.IsShowIndexName==!1&&(a.Frame.SubFrame[f].Frame.IsShowIndexName=!1),o.IsShowOverlayIndexName==!1&&(a.Frame.SubFrame[f].Frame.IsShowOverlayIndexName=!1)}if(this.AdjustTitleHeight(a),c.IsNonEmptyArray(t.OverlayIndex))for(var l=0;l<t.OverlayIndex.length;++l){var o=t.OverlayIndex[l];if(!(o.Windows>=a.Frame.SubFrame.length)){var I=(0,jr.default)(o),F=JSON.parse(I);o.Index&&(F.IndexName=o.Index),o.Windows>=0&&(F.WindowIndex=o.Windows),a.CreateOverlayWindowsIndex(F)}}return a},this.CreateMinMinuteChartContainer=function(t){var a=null;t.Type==="迷你分钟走势图横屏"?a=new Ju(this.CanvasElement):a=new re(this.CanvasElement),t.NetworkFilter&&(a.NetworkFilter=t.NetworkFilter);var s=2;if(t.BeforeOpen){var o=t.BeforeOpen;c.IsBool(o.IsShow)&&(a.IsShowBeforeData=o.IsShow),c.IsNumber(o.Width)&&(a.ExtendWidth.Left=o.Width),c.IsBool(o.IsShowMultiDay)&&(a.IsShowMultiDayBeforeData=o.IsShowMultiDay),c.IsNumber(o.MulitiDayWidth)&&(a.MultiDayExtendWidth.Left=o.MulitiDayWidth)}if(t.AfterClose){var o=t.AfterClose;c.IsBool(o.IsShow)&&(a.IsShowAfterData=o.IsShow),c.IsNumber(o.ShareVol)&&(a.ShareAfterVol=o.ShareVol),c.IsNumber(o.Width)&&(a.ExtendWidth.Right=o.Width),c.IsBool(o.IsShowMultiDay)&&(a.IsShowMultiDayAfterData=o.IsShowMultiDay),c.IsNumber(o.MulitiDayWidth)&&(a.MultiDayExtendWidth.Right=o.MulitiDayWidth)}if(t.Listener||(t.Listener={KeyDown:!1,Wheel:!1}),a.Create(s,t.Listener),t.CorssCursorInfo){var o=t.CorssCursorInfo;c.IsNumber(t.CorssCursorInfo.Left)&&(a.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),c.IsNumber(t.CorssCursorInfo.Right)&&(a.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),c.IsNumber(t.CorssCursorInfo.Bottom)&&(a.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),t.CorssCursorInfo.IsShowCorss===!1&&(a.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),t.CorssCursorInfo.RightTextFormat>0&&(a.ChartCorssCursor.TextFormat.Right=t.CorssCursorInfo.RightTextFormat),t.CorssCursorInfo.IsOnlyDrawMinute==!0&&(a.ChartCorssCursor.IsOnlyDrawMinute=t.CorssCursorInfo.IsOnlyDrawMinute),c.IsBool(t.CorssCursorInfo.IsFixXLastTime)&&(a.ChartCorssCursor.IsFixXLastTime=t.CorssCursorInfo.IsFixXLastTime),o.RightButton&&c.IsBool(o.RightButton.Enable)&&(a.ChartCorssCursor.RightButton.Enable=o.RightButton.Enable),c.IsNumber(o.PriceFormatType)&&(a.ChartCorssCursor.StringFormatY.PriceFormatType=o.PriceFormatType),c.IsNumber(o.DataFormatType)&&(a.ChartCorssCursor.StringFormatY.DataFormatType=o.DataFormatType),c.IsNumber(t.CorssCursorInfo.HPenType)&&(a.ChartCorssCursor.HPenType=t.CorssCursorInfo.HPenType),c.IsNumber(t.CorssCursorInfo.VPenType)&&(a.ChartCorssCursor.VPenType=t.CorssCursorInfo.VPenType)}c.IsNumber(t.DayCount)&&(a.DayCount=t.DayCount),this.SetChartBorder(a,t),t.SplashTitle&&(a.ChartSplashPaint.SplashTitle=t.SplashTitle),c.IsBool(t.EnableVerifyRecvData)&&(a.EnableVerifyRecvData=t.EnableVerifyRecvData),a.TitlePaint[0].IsShow=!1;var h=a.Frame.SubFrame[0];if(h.Frame.IsShowYText[0]=!1,h.Frame.IsShowYText[1]=!1,h.Frame.IsShowXLine=!1,h.Frame.IsShowYLine=!1,h.Frame.BorderLine=0,a.Frame.SubFrame[1].Height=0,a.EnableBorderDrag=!1,t.Frame)for(var l=0;l<t.Frame.length;++l){var o=t.Frame[l];a.Frame.SubFrame[l]&&(o.SplitCount&&(a.Frame.SubFrame[l].Frame.YSplitOperator.SplitCount=o.SplitCount),o.StringFormat&&(a.Frame.SubFrame[l].Frame.YSplitOperator.StringFormat=o.StringFormat),c.IsNumber(o.SplitType)&&(a.Frame.SubFrame[l].Frame.YSplitOperator.SplitType=o.SplitType,a.Frame.SubFrame[l].Frame.YSplitOperator.DefaultSplitType=o.SplitType),c.IsBool(o.IsShowLeftText)&&(a.Frame.SubFrame[l].Frame.IsShowYText[0]=o.IsShowLeftText,a.Frame.SubFrame[l].Frame.YSplitOperator.IsShowLeftText=o.IsShowLeftText),c.IsBool(o.IsShowRightText)&&(a.Frame.SubFrame[l].Frame.IsShowYText[1]=o.IsShowRightText,a.Frame.SubFrame[l].Frame.YSplitOperator.IsShowRightText=o.IsShowRightText),o.Height>=0&&(a.Frame.SubFrame[l].Height=o.Height),o.Custom&&(a.Frame.SubFrame[l].Frame.YSplitOperator.Custom=o.Custom),o.RightTextFormat>0&&(a.Frame.SubFrame[l].Frame.YSplitOperator.RightTextFormat=o.RightTextFormat),c.IsNumber(o.TitleHeight)&&(a.Frame.SubFrame[l].Frame.ChartBorder.TitleHeight=o.TitleHeight),c.IsNumber(o.BorderLine)&&(a.Frame.SubFrame[l].Frame.BorderLine=o.BorderLine),c.IsBool(o.EnableRemoveZero)&&(a.Frame.SubFrame[l].Frame.YSplitOperator.EnableRemoveZero=o.EnableRemoveZero),c.IsNumber(o.FloatPrecision)&&(a.Frame.SubFrame[l].Frame.YSplitOperator.FloatPrecision=o.FloatPrecision),c.IsBool(o.IsShowXLine)&&(a.Frame.SubFrame[l].Frame.IsShowXLine=o.IsShowXLine),c.IsBool(o.IsShowYLine)&&(a.Frame.SubFrame[l].Frame.IsShowYLine=o.IsShowYLine),c.IsNumber(o.YTextBaseline)&&(a.Frame.SubFrame[l].Frame.YTextBaseline=o.YTextBaseline))}if(a.UpdateXShowText(),t.MinuteLine){if(t.MinuteLine.IsDrawAreaPrice==!1&&(a.ChartPaint[0].IsDrawArea=!1),t.MinuteLine.IsShowLead==!1&&(a.IsShowLead=!1),t.MinuteLine.IsShowAveragePrice==!1){a.ChartPaint[1].IsShow=!1,a.TitlePaint[0].IsShowAveragePrice=!1;for(var l=0;l<a.ExtendChartPaint.length;++l){var o=a.ExtendChartPaint[l];o.ClassName=="MinuteTooltipPaint"&&(o.IsShowAveragePrice=!1)}}t.MinuteLine.SplitType>0&&(a.Frame.SubFrame[0].Frame.YSplitOperator.SplitType=t.MinuteLine.SplitType)}return this.AdjustTitleHeight(a),t.DisableMouseEvent===!0&&(this.CanvasElement.onmousemove=function(u){},this.CanvasElement.oncontextmenu=function(u){},this.CanvasElement.ondblclick=function(u){},this.CanvasElement.onmousedown=function(u){},this.CanvasElement.onmouseout=function(u){},this.CanvasElement.onmouseleave=function(u){}),a},this.CreateHistoryMinuteChartContainer=function(t){var a=new Kh(this.CanvasElement),s=2;t.Windows&&t.Windows.length>0&&(s+=t.Windows.length),a.Create(s),t.IsShowCorssCursorInfo==!1&&(a.ChartCorssCursor.IsShowText=t.IsShowCorssCursorInfo),t.Border&&(isNaN(t.Border.Left)||(a.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(a.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(a.Frame.ChartBorder.Top=t.Border.Top),isNaN(t.Border.Bottom)||(a.Frame.ChartBorder.Bottom=t.Border.Bottom));var o=new J;if(t.Windows)for(var h=0;h<t.Windows.length;++h){var l=t.Windows[h];if(l.Script)a.WindowIndex[2+parseInt(h)]=new de(l.Name,l.Script,l.Args);else{var u=Ja.Get(l.Index);if(u)a.WindowIndex[2+parseInt(h)]=u.Create(),a.CreateWindowIndex(2+parseInt(h));else{var f=o.Get(l.Index);if(!f)continue;a.WindowIndex[2+parseInt(h)]=new de(f.Name,f.Script,f.Args)}}isNaN(l.TitleHeight)||(a.Frame.SubFrame[2+parseInt(h)].Frame.ChartBorder.TitleHeight=l.TitleHeight)}return a.TradeDate=20181009,t.HistoryMinute.TradeDate&&(a.TradeDate=t.HistoryMinute.TradeDate),t.HistoryMinute.IsShowName!=null&&(a.TitlePaint[0].IsShowName=t.HistoryMinute.IsShowName),t.HistoryMinute.IsShowDate!=null&&(a.TitlePaint[0].IsShowDate=t.HistoryMinute.IsShowDate),a},this.CreateKLineTrainChartContainer=function(t){var a=!1;if(t.Type=="简单K线训练"||t.Type=="简单K线训练横屏"){var s=t.Type=="简单K线训练横屏",o=new Rm(this.CanvasElement,s);a=!0}else var s=t.Type=="K线训练横屏",o=new qC(this.CanvasElement,s);if(t.NetworkFilter&&(o.NetworkFilter=t.NetworkFilter),t.IsApiPeriod==!0&&(o.IsApiPeriod=t.IsApiPeriod),o.ModifyIndexDialog=this.ModifyIndexDialog,o.ChangeIndexDialog=this.ChangeIndexDialog,t.ScriptError&&(o.ScriptErrorCallback=t.ScriptError),t.KLine&&(t.KLine.Right>=0&&(o.Right=t.KLine.Right),t.KLine.Period>=0&&(o.Period=t.KLine.Period),t.KLine.MaxRequestDataCount>0&&(o.MaxRequestDataCount=t.KLine.MaxRequestDataCount),t.KLine.Info&&t.KLine.Info.length>0&&o.SetKLineInfo(t.KLine.Info,!1),t.KLine.PageSize>0&&(o.PageSize=t.KLine.PageSize),t.KLine.IsShowTooltip==!1&&(o.IsShowTooltip=!1),t.KLine.MaxRequestMinuteDayCount>0&&(o.MaxRequestMinuteDayCount=t.KLine.MaxRequestMinuteDayCount),t.KLine.DrawType&&(o.KLineDrawType=t.KLine.DrawType),c.IsNumber(t.KLine.RightSpaceCount)&&!a&&(o.RightSpaceCount=t.KLine.RightSpaceCount)),t.Train&&(t.Train.DataCount&&(o.TrainDataCount=t.Train.DataCount),t.Train.Callback&&(o.TrainCallback=t.Train.Callback),t.Train.StartDate&&(o.TrainStartDate=t.Train.StartDate)),!t.Windows||t.Windows.length<=0)return null;if(o.Create(t.Windows.length),this.SetChartBorder(o,t),this.AdjustChartBorder(o),t.IsShowCorssCursorInfo==!1&&(o.ChartCorssCursor.IsShowText=t.IsShowCorssCursorInfo),t.IsCorssOnlyDrawKLine===!0&&(o.ChartCorssCursor.IsOnlyDrawKLine=t.IsCorssOnlyDrawKLine),t.CorssCursorTouchEnd===!0&&(o.CorssCursorTouchEnd=t.CorssCursorTouchEnd),t.IsClickShowCorssCursor==!0&&(o.IsClickShowCorssCursor=t.IsClickShowCorssCursor),t.CorssCursorInfo&&(isNaN(t.CorssCursorInfo.Left)||(o.ChartCorssCursor.ShowTextMode.Left=t.CorssCursorInfo.Left),isNaN(t.CorssCursorInfo.Right)||(o.ChartCorssCursor.ShowTextMode.Right=t.CorssCursorInfo.Right),isNaN(t.CorssCursorInfo.Bottom)||(o.ChartCorssCursor.ShowTextMode.Bottom=t.CorssCursorInfo.Bottom),t.CorssCursorInfo.IsShowCorss===!1&&(o.ChartCorssCursor.IsShowCorss=t.CorssCursorInfo.IsShowCorss),t.CorssCursorInfo.IsShowClose==!0&&(o.ChartCorssCursor.IsShowClose=t.CorssCursorInfo.IsShowClose),t.CorssCursorInfo.PressTime&&(o.PressTime=t.CorssCursorInfo.PressTime),t.CorssCursorInfo.HPenType>0&&(o.ChartCorssCursor.HPenType=t.CorssCursorInfo.HPenType),t.CorssCursorInfo.VPenType>0&&(o.ChartCorssCursor.VPenType=t.CorssCursorInfo.VPenType)),t.CorssCursor={},t.CorssCursor.TitleHeight=o.ChartCorssCursor.TextHeight,t.Frame)for(var h=0;h<t.Frame.length;++h){var l=t.Frame[h];o.Frame.SubFrame[h]&&(l.SplitCount&&(o.Frame.SubFrame[h].Frame.YSplitOperator.SplitCount=l.SplitCount),l.StringFormat&&(o.Frame.SubFrame[h].Frame.YSplitOperator.StringFormat=l.StringFormat),c.IsNumber(l.FloatPrecision)&&(o.Frame.SubFrame[h].Frame.YSplitOperator.FloatPrecision=l.FloatPrecision),l.Custom&&(o.Frame.SubFrame[h].Frame.YSplitOperator.Custom=l.Custom),c.IsNumber(l.SplitType)&&(o.Frame.SubFrame[h].Frame.YSplitOperator.SplitType=l.SplitType),l.Height>0&&(o.Frame.SubFrame[h].Height=l.Height),l.IsShowLeftText==!1&&(o.Frame.SubFrame[h].Frame.YSplitOperator.IsShowLeftText=l.IsShowLeftText),l.IsShowRightText==!1&&(o.Frame.SubFrame[h].Frame.YSplitOperator.IsShowRightText=l.IsShowRightText))}if(t.KLine&&(t.KLine.ShowKLine==!1&&(o.ChartPaint[0].IsShow=!1),t.KLine.InfoPosition>0&&(o.ChartPaint[0].InfoPosition=t.KLine.InfoPosition),t.KLine.IsShowMaxMinPrice==!1&&(o.ChartPaint[0].IsShowMaxMinPrice=t.KLine.IsShowMaxMinPrice)),t.KLineTitle&&(t.KLineTitle.IsShowName==!1&&(o.TitlePaint[0].IsShowName=!1),t.KLineTitle.IsShowSettingInfo==!1&&(o.TitlePaint[0].IsShowSettingInfo=!1),t.KLineTitle.IsShow==!1&&(o.TitlePaint[0].IsShow=!1)),c.IsNonEmptyArray(t.Overlay))for(var h=0;h<t.Overlay.length;++h){var l=t.Overlay[h];o.OverlaySymbol(l.Symbol,l)}if(t.ExtendChart)for(var h=0;h<t.ExtendChart.length;++h){var l=t.ExtendChart[h];o.CreateExtendChart(l.Name,l)}if(c.IsNonEmptyArray(t.Windows))for(var u=new J,h=0;h<t.Windows.length;++h){var l=t.Windows[h];if(l.Script)o.WindowIndex[h]=new de(l.Name,l.Script,l.Args,l);else{var f=Ja.Get(l.Index);if(f)o.WindowIndex[h]=f.Create(),o.CreateWindowIndex(h);else{var C=u.Get(l.Index);if(!C)continue;l.Lock&&(C.Lock=l.Lock),o.WindowIndex[h]=new de(C.Name,C.Script,C.Args,C)}}l.Modify!=null&&(o.Frame.SubFrame[h].Frame.ModifyIndex=l.Modify),l.Change!=null&&(o.Frame.SubFrame[h].Frame.ChangeIndex=l.Change),l.Close!=null&&(o.Frame.SubFrame[h].Frame.CloseIndex=l.Close),l.Overlay!=null&&(frame.OverlayIndex=l.Overlay),c.IsBool(l.Export)&&(frame.ExportData=l.Export),c.IsBool(l.MaxMin)&&(o.Frame.SubFrame[h].Frame.MaxMinWindow=l.MaxMin),c.IsBool(l.TitleWindow)&&(o.Frame.SubFrame[h].Frame.TitleWindow=l.TitleWindow),c.IsBool(l.IsDrawTitleBG)&&(o.Frame.SubFrame[h].Frame.IsDrawTitleBG=l.IsDrawTitleBG),c.IsBool(l.IsShowNameArrow)&&(o.Frame.SubFrame[h].Frame.IsShowNameArrow=l.IsShowNameArrow),c.IsNumber(l.TitleHeight)&&(o.Frame.SubFrame[h].Frame.ChartBorder.TitleHeight=l.TitleHeight),l.IsShowTitleArraw==!1&&(o.Frame.SubFrame[h].Frame.IsShowTitleArraw=!1),l.IsShowIndexName==!1&&(o.Frame.SubFrame[h].Frame.IsShowIndexName=!1),l.IsShowOverlayIndexName==!1&&(o.Frame.SubFrame[h].Frame.IsShowOverlayIndexName=!1),c.IsNumber(l.IndexParamSpace)&&(o.Frame.SubFrame[h].Frame.IndexParamSpace=l.IndexParamSpace),c.IsNumber(l.IndexTitleSpace)&&(o.Frame.SubFrame[h].Frame.IndexTitleSpace=l.IndexTitleSpace)}return this.AdjustTitleHeight(o),o},this.CreateDepthChartContainer=function(t){var a=null;if(a=new ym(this.CanvasElement),t.NetworkFilter&&(a.NetworkFilter=t.NetworkFilter),t.EnableScrollUpDown==!0&&(a.EnableScrollUpDown=t.EnableScrollUpDown),c.IsPlusNumber(t.MaxVolRate)&&(a.MaxVolRate=t.MaxVolRate),t.ZoomStepPixel>0&&(a.ZoomStepPixel=t.ZoomStepPixel),c.IsString(t.SplashTitle)&&(a.LoadDataSplashTitle=t.SplashTitle),c.IsBool(t.EnableVerifyRecvData)&&(a.EnableVerifyRecvData=t.EnableVerifyRecvData),t.Language){var s=gt.GetLanguageID(t.Language);c.IsNumber(s)&&(a.LanguageID=s)}if(a.Create(t.Listener),t.Border&&(c.IsNumber(t.Border.Left)?a.Frame.ChartBorder.Left=t.Border.Left:t.Border.Left=a.Frame.ChartBorder.Left,c.IsNumber(t.Border.Right)?a.Frame.ChartBorder.Right=t.Border.Right:t.Border.Right=a.Frame.ChartBorder.Right,c.IsNumber(t.Border.Top)?a.Frame.ChartBorder.Top=t.Border.Top:t.Border.Top=a.Frame.ChartBorder.Top,c.IsNumber(t.Border.Bottom)?a.Frame.ChartBorder.Bottom=t.Border.Bottom:t.Border.Bottom=a.Frame.ChartBorder.Bottom),this.AdjustChartBorder(a),t.CorssCursorTouchEnd===!0&&(a.CorssCursorTouchEnd=t.CorssCursorTouchEnd),t.CorssCursorInfo){var o=t.CorssCursorInfo;c.IsNumber(o.HPenType)&&(a.ChartCorssCursor.HPenType=o.HPenType),c.IsNumber(o.VPenType)&&(a.ChartCorssCursor.VPenType=o.VPenType),c.IsBool(o.IsShowTooltip)&&(a.ChartCorssCursor.IsShowTooltip=o.IsShowTooltip)}if(t.Frame){var o=t.Frame;o.SplitCount&&(a.Frame.YSplitOperator.SplitCount=o.SplitCount),c.IsNumber(o.SplitType)&&(a.Frame.YSplitOperator.SplitType=o.SplitType),c.IsNumber(o.Height)&&(a.Frame.Height=o.Height),c.IsNumber(o.YLineType)&&(a.Frame.YSplitOperator.LineType=o.YLineType),c.IsNumber(o.XLineType)&&(a.Frame.XSplitOperator.LineType=o.XLineType),Array.isArray(o.IgnoreYValue)&&(a.Frame.YSplitOperator.IgnoreYValue=o.IgnoreYValue),(o.IsShowLeftText===!1||o.IsShowLeftText===!0)&&(a.Frame.IsShowYText[0]=o.IsShowLeftText,a.Frame.YSplitOperator.IsShowLeftText=o.IsShowLeftText),(o.IsShowRightText===!1||o.IsShowRightText===!0)&&(a.Frame.IsShowYText[1]=o.IsShowRightText,a.Frame.YSplitOperator.IsShowRightText=o.IsShowRightText),o.IsShowXLine==!1&&(a.Frame.IsShowXLine=o.IsShowXLine),o.IsShowYLine==!1&&(a.Frame.IsShowYLine=o.IsShowYLine),c.IsNumber(o.XSplitCount)&&(a.Frame.XSplitOperator.SplitCount=o.XSplitCount)}return a},this.SetOption=function(t){c.IsNumber(t.ToolbarButtonStyle)&&(m.ToolbarButtonStyle=t.ToolbarButtonStyle);var a=null;switch(t.Type){case"历史K线图":case"历史K线图横屏":a=this.CreateKLineChartContainer(t);break;case"自定义指数历史K线图":a=this.CreateCustomKLineChartContainer(t);break;case"分钟走势图":case"分钟走势图横屏":a=this.CreateMinuteChartContainer(t);break;case"迷你分钟走势图":a=this.CreateMinMinuteChartContainer(t);break;case"历史分钟走势图":a=this.CreateHistoryMinuteChartContainer(t);break;case"K线训练":case"K线训练横屏":case"简单K线训练":case"简单K线训练横屏":a=this.CreateKLineTrainChartContainer(t);break;case"深度图":a=this.CreateDepthChartContainer(t);break;case"简单图形":return this.CreateSimpleChart(t);case"饼图":case"雷达图":return this.CreatePieChart(t);case"地图":return this.CreateMapChart(t);default:return!1}if(!a)return!1;if(t.OnCreatedCallback&&t.OnCreatedCallback(a),t.IsAutoUpdate!=null&&(a.IsAutoUpdate=t.IsAutoUpdate),t.AutoUpdateFrequency>0&&(a.AutoUpdateFrequency=t.AutoUpdateFrequency),t.EventCallback)for(var s=0;s<t.EventCallback.length;++s){var o=t.EventCallback[s];a.AddEventCallback(o)}t.Symbol?(a.Draw(),a.ChangeSymbol(t.Symbol),this.JSChartContainer=a,this.DivElement.JSChart=this,this.JSChartContainer.Draw()):(a.DrawEmpty(),this.JSChartContainer=a,this.DivElement.JSChart=this),c.IsBool(t.CheckLatestVerion)&&t.CheckLatestVerion==!1||_t.LastVersion==null&&a&&typeof a.GetLatestVersion=="function"&&a.GetLatestVersion()},this.CreateSimpleChart=function(t){var a=new Pm(this.CanvasElement);t.MainDataControl&&(a.MainDataControl=t.MainDataControl),a.Create(),t.Border&&(isNaN(t.Border.Left)||(a.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(a.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(a.Frame.ChartBorder.Top=t.Border.Top)),a.Draw(),a.RequestData(),this.JSChartContainer=a,this.DivElement.JSChart=this,this.JSChartContainer.Draw()},this.CreatePieChart=function(t){var a=new wm(this.CanvasElement);t.MainDataControl&&(a.MainDataControl=t.MainDataControl),t.Radius&&(a.Radius=t.Radius),a.Create(),t.Border&&(isNaN(t.Border.Left)||(a.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(a.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(a.Frame.ChartBorder.Top=t.Border.Top)),this.AdjustChartBorder(a),t.Frame&&t.Frame[0].IsShowBorder==!1&&(a.Frame.IsShowBorder=t.Frame[0].IsShowBorder),a.Draw(),a.RequestData(),this.JSChartContainer=a,this.DivElement.JSChart=this,this.JSChartContainer.Draw()},this.CreateMapChart=function(t){var a=new Bm(this.CanvasElement);t.MainDataControl&&(a.MainDataControl=t.MainDataControl),a.Create(),t.Border&&(isNaN(t.Border.Left)||(a.Frame.ChartBorder.Left=t.Border.Left),isNaN(t.Border.Right)||(a.Frame.ChartBorder.Right=t.Border.Right),isNaN(t.Border.Top)||(a.Frame.ChartBorder.Top=t.Border.Top)),a.Draw(),a.RequestData(),this.JSChartContainer=a,this.DivElement.JSChart=this,this.JSChartContainer.Draw()},this.CreateToolbar=function(t){},this.CreateSettingDiv=function(t){},this.Focus=function(){this.CanvasElement&&this.CanvasElement.focus()},this.ChangeSymbol=function(t,a){this.JSChartContainer&&this.JSChartContainer.ChangeSymbol(t,a)},this.ChangeIndex=function(t,a,s){this.JSChartContainer&&typeof this.JSChartContainer.ChangeIndex=="function"&&this.JSChartContainer.ChangeIndex(t,a,s)},this.AddIndexWindow=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.AddIndexWindow=="function"&&this.JSChartContainer.AddIndexWindow(t,a)},this.AddScriptIndexWindow=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.AddScriptIndexWindow=="function"&&this.JSChartContainer.AddScriptIndexWindow(t,a)},this.AddAPIIndexWindow=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.AddAPIIndexWindow=="function"&&this.JSChartContainer.AddAPIIndexWindow(t,a)},this.RemoveIndexWindow=function(t){this.JSChartContainer&&typeof this.JSChartContainer.RemoveIndexWindow=="function"&&this.JSChartContainer.RemoveIndexWindow(t)},this.ChangeScriptIndex=function(t,a,s){this.JSChartContainer&&typeof this.JSChartContainer.ChangeScriptIndex=="function"&&this.JSChartContainer.ChangeScriptIndex(t,a,s)},this.ChangePyScriptIndex=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.ChangePyScriptIndex=="function"&&this.JSChartContainer.ChangePyScriptIndex(t,a)},this.GetIndexInfo=function(){return this.JSChartContainer&&typeof this.JSChartContainer.GetIndexInfo=="function"?this.JSChartContainer.GetIndexInfo():[]},this.ChangeInstructionIndex=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.ChangeInstructionIndex=="function"&&this.JSChartContainer.ChangeInstructionIndex(t,a)},this.ChangeInstructionScriptIndex=function(t){this.JSChartContainer&&typeof this.JSChartContainer.ChangeInstructionIndex=="function"&&this.JSChartContainer.ChangeInstructionScriptIndex(t)},this.CancelInstructionIndex=function(){this.JSChartContainer&&typeof this.JSChartContainer.CancelInstructionIndex=="function"&&this.JSChartContainer.CancelInstructionIndex()},this.ChangePeriod=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.ChangePeriod=="function"&&this.JSChartContainer.ChangePeriod(t,a)},this.ChangeRight=function(t){this.JSChartContainer&&typeof this.JSChartContainer.ChangeRight=="function"&&this.JSChartContainer.ChangeRight(t)},this.OverlaySymbol=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.OverlaySymbol=="function"&&this.JSChartContainer.OverlaySymbol(t,a)},this.DeleteOverlaySymbol=function(t){this.JSChartContainer&&typeof this.JSChartContainer.DeleteOverlaySymbol=="function"&&this.JSChartContainer.DeleteOverlaySymbol(t)},this.SetFirstShowDate=function(t){this.JSChartContainer&&typeof this.JSChartContainer.SetFirstShowDate=="function"&&this.JSChartContainer.SetFirstShowDate(t)},this.ChangeKLineDrawType=function(t,a,s){this.JSChartContainer&&typeof this.JSChartContainer.ChangeKLineDrawType=="function"&&this.JSChartContainer.ChangeKLineDrawType(t,a,s)},this.ChangeIndexWindowCount=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.ChangeIndexWindowCount=="function"&&this.JSChartContainer.ChangeIndexWindowCount(t,a)},this.ClearOverlaySymbol=function(){this.JSChartContainer&&typeof this.JSChartContainer.ClearOverlaySymbol=="function"&&this.JSChartContainer.ClearOverlaySymbol()},this.DeleteKLineInfo=function(t){this.JSChartContainer&&typeof this.JSChartContainer.DeleteKLineInfo=="function"&&this.JSChartContainer.DeleteKLineInfo(t)},this.ClearKLineInfo=function(){this.JSChartContainer&&typeof this.JSChartContainer.ClearKLineInfo=="function"&&this.JSChartContainer.ClearKLineInfo()},this.AddKLineInfo=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.AddKLineInfo=="function"&&this.JSChartContainer.AddKLineInfo(t,a)},this.ChangMainDataControl=function(t){this.JSChartContainer&&typeof this.JSChartContainer.SetMainDataConotrl=="function"&&this.JSChartContainer.SetMainDataConotrl(t)},this.AddOverlayIndex=function(t){this.JSChartContainer&&typeof this.JSChartContainer.AddOverlayIndex=="function"&&this.JSChartContainer.AddOverlayIndex(t)},this.MoveOverlayIndex=function(t,a,s){this.JSChartContainer&&typeof this.JSChartContainer.MoveOverlayIndex=="function"&&this.JSChartContainer.MoveOverlayIndex(t,a,s)},this.MoveOverlayIndexToNewWindow=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.MoveOverlayIndexToNewWindow=="function"&&this.JSChartContainer.MoveOverlayIndexToNewWindow(t,a)},this.DeleteOverlayWindowsIndex=function(t){this.JSChartContainer&&typeof this.JSChartContainer.DeleteOverlayWindowsIndex=="function"&&this.JSChartContainer.DeleteOverlayWindowsIndex(t)},this.StopAutoUpdate=function(){this.JSChartContainer&&typeof this.JSChartContainer.StopAutoUpdate=="function"&&this.JSChartContainer.StopAutoUpdate()},this.ChartDestroy=function(){this.JSChartContainer&&typeof this.JSChartContainer.ChartDestroy=="function"&&this.JSChartContainer.ChartDestroy()},this.ChartDestory=this.ChartDestroy,this.SetDepthMapData=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.SetDepthMapData=="function"&&this.JSChartContainer.SetDepthMapData(t,a)},this.ForceLandscape=function(t){this.JSChartContainer&&(X.Chart.Log("[JSChart::ForceLandscape] bForceLandscape="+t),this.JSChartContainer.IsForceLandscape=t)},this.LockIndex=function(t){this.JSChartContainer&&typeof this.JSChartContainer.LockIndex=="function"&&(X.Chart.Log("[JSChart:LockIndex] lockData",t),this.JSChartContainer.LockIndex(t))},this.ChangeTradeDate=function(t){this.JSChartContainer&&typeof this.JSChartContainer.ChangeTradeDate=="function"&&(X.Chart.Log("[JSChart:ChangeTradeDate] date",t),this.JSChartContainer.ChangeTradeDate(t))},this.ChangeDayCount=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.ChangeDayCount=="function"&&(X.Chart.Log("[JSChart:ChangeDayCount] count",t),this.JSChartContainer.ChangeDayCount(t,a))},this.ShowCallAuctionData=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.ShowCallAuctionData=="function"&&(X.Chart.Log("[JSChart:ShowCallAuctionData] obj, option ",t,a),this.JSChartContainer.ShowCallAuctionData(t,a))},this.StartAnimation=function(t){if(this.JSChartContainer&&typeof this.JSChartContainer.StartAnimation=="function")return X.Chart.Log("[JSChart:StartAnimation] start."),this.JSChartContainer.StartAnimation(t)},this.StopAnimation=function(){if(this.JSChartContainer&&typeof this.JSChartContainer.StopAnimation=="function")return X.Chart.Log("[JSChart:StopAnimation] start."),this.JSChartContainer.StopAnimation()},this.SaveToImage=function(t,a){if(this.JSChartContainer&&typeof this.JSChartContainer.SaveToImage=="function")return this.JSChartContainer.SaveToImage(t,a)},this.SaveToImageUrl=function(t,a){if(this.JSChartContainer&&typeof this.JSChartContainer.SaveToImageUrl=="function")return this.JSChartContainer.SaveToImageUrl(t,a)},this.AddEventCallback=function(t){this.JSChartContainer&&typeof this.JSChartContainer.AddEventCallback=="function"&&(X.Chart.Log("[JSChart:AddEventCallback] ",t),this.JSChartContainer.AddEventCallback(t))},this.SetLanguage=function(t){this.JSChartContainer&&typeof this.JSChartContainer.SetLanguage=="function"&&(X.Chart.Log("[JSChart:SetLanguage] ",t),this.JSChartContainer.SetLanguage(t))},this.ChangeIndexTemplate=function(t){this.JSChartContainer&&typeof this.JSChartContainer.ChangeIndexTemplate=="function"&&(X.Chart.Log("[JSChart:ChangeIndexTemplate] ",t),this.JSChartContainer.ChangeIndexTemplate(t))},this.SetChartDrawOption=function(t){this.JSChartContainer&&typeof this.JSChartContainer.SetChartDrawOption=="function"&&(X.Chart.Log("[JSChart:SetChartDrawOption] ",t),this.JSChartContainer.SetChartDrawOption(t))},this.CreateChartDrawPicture=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.CreateChartDrawPicture=="function"&&(X.Chart.Log("[JSChart:CreateChartDrawPicture] ",t),this.JSChartContainer.CreateChartDrawPicture(t,a))},this.AddChartDrawPicture=function(t){if(this.JSChartContainer&&typeof this.JSChartContainer.AddChartDrawPicture=="function")return X.Chart.Log("[JSChart:AddChartDrawPicture] ",t),this.JSChartContainer.AddChartDrawPicture(t)},this.ClearChartDrawPicture=function(t,a){this.JSChartContainer&&typeof this.JSChartContainer.ClearChartDrawPicture=="function"&&this.JSChartContainer.ClearChartDrawPicture(t,a)},this.PasteChartDrawPicture=function(t,a,s){if(this.JSChartContainer&&typeof this.JSChartContainer.PasteChartDrawPicture=="function")return X.Chart.Log("[JSChart:PasteChartDrawPicture] ",t,a,s),this.JSChartContainer.PasteChartDrawPicture(t,a,s)},this.ReloadResource=function(t){this.JSChartContainer&&typeof this.JSChartContainer.ReloadResource=="function"&&(X.Chart.Log("[JSChart:ReloadResource] "),this.JSChartContainer.ReloadResource(t))},this.EnableSplashScreen=function(t){this.JSChartContainer&&typeof this.JSChartContainer.EnableSplashScreen=="function"&&(X.Chart.Log("[JSChart:EnableSplashScreen] "),this.JSChartContainer.EnableSplashScreen(t))},this.Draw=function(){this.JSChartContainer&&typeof this.JSChartContainer.Draw=="function"&&(X.Chart.Log("[JSChart:Draw] "),this.JSChartContainer.Draw())},this.SetFocus=function(){this.JSChartContainer&&typeof this.JSChartContainer.SetFocus=="function"&&(X.Chart.Log("[JSChart:SetFocus] "),this.JSChartContainer.SetFocus())},this.ExportData=function(t){if(this.JSChartContainer&&typeof this.JSChartContainer.ExportData=="function")return X.Chart.Log("[JSChart:ExportData] "),this.JSChartContainer.ExportData(t)}}_t.LastVersion=null;_t.EnableCanvasWillReadFrequently=!1;_t.CorssCursorCanvasKey="hqchart_corsscursor";_t.Init=function(r,n,e){var t=new _t(r,n,e);return t.OnSize(),t};_t.SetDomain=function(r,n){r&&(m.Domain=r),n&&(m.CacheDomain=n)};_t.SetPyIndexDomain=function(r){r&&(m.PyIndexDomain=r)};_t.SetStyle=function(r){r&&m.SetStyle(r)};_t.SetTextResource=function(r,n){gt.SetTextResource(r,n)};_t.GetLocalization=function(){return gt};_t.GetDevicePixelRatio=function(){return V()};_t.CreateGuid=function(){return oe()};_t.GetResource=function(){return m};_t.GetMinuteTimeStringData=function(){return yr};_t.GetMinuteCoordinateData=function(){return Zh};_t.GetKLineZoom=function(){return ie};_t.GetDivTooltipDataFormat=function(){return ze};_t.GetKLineCustomCalulate=function(){return $C};_t.SetUSATimeType=function(r){Ki.TimeType=r,Ji.TimeType=r,zi.TimeType=r,Zi.TimeType=r};_t.GetChinaFuturesTimeData=function(){return Tn};_t.AddPeriodCallback=function(r){Ph.AddPeriodCallback(r)};_t.RemovePeriodCallback=function(r){Ph.RemovePeriodCallback(r)};_t.RegisterDrawPicture=function(r){return It.RegisterDrawPicture(r)};_t.RegisterDrawPictureIonFont=function(r){return It.RegisterIonFont(r)};_t.GetInternalTimeData=function(r){switch(r){case"NYMEXTimeData":return Ki;case"COMEXTimeData":return Ji;case"NYBOTTimeData":return zi;case"CBOTTimeData":return Zi;case"LMETimeData":return Fr;case"FuturesTimeData":return Tn;case"TOCOMTimeData":return Er;case"IPETimeData":return xr;default:return null}};_t.RegisterExtendChartClass=function(r,n){return Sn.Add(r,n)};_t.AddExtendCallbackDraw=function(r){return Sn.AddCallbackDrawClassName(r)};_t.RegisterChartPaintClass=function(r,n){return qn.Add(r,n)};_t.RegisterScriptIndexChart=function(r,n){return Qi.Add(r,n)};_t.RegisterDialogClass=function(r,n){return tD.Add(r,n)};_t.RegisterChartFrameClass=function(r,n){return Oh.Add(r,n)};_t.ToFixedPoint=function(r){return L(r)};_t.ToFixedPoint2=function(r,n){return he(r,n)};_t.ToFixedRect=function(r){return B(r)};var et={RECV_KLINE_MATCH:1,RECV_INDEX_DATA:2,RECV_HISTROY_DATA:3,RECV_TRAIN_MOVE_STEP:4,CHART_STATUS:5,BARRAGE_PLAY_END:6,RECV_OVERLAY_INDEX_DATA:7,DBCLICK_KLINE:8,RECV_START_AUTOUPDATE:9,RECV_STOP_AUTOUPDATE:10,ON_CONTEXT_MENU:11,ON_TITLE_DRAW:12,ON_SELECT_RECT:13,RECV_MINUTE_DATA:14,ON_CLICK_INDEXTITLE:15,RECV_KLINE_UPDATE_DATA:16,ON_CLICK_DRAWPICTURE:17,ON_FINISH_DRAWPICTURE:18,ON_INDEXTITLE_DRAW:19,ON_CUSTOM_VERTICAL_DRAW:20,RECV_KLINE_MANUAL_UPDATE_DATA:21,ON_ENABLE_SPLASH_DRAW:22,ON_CLICK_CHART_PAINT:23,ON_DRAW_MINUTE_LAST_POINT:24,ON_DRAW_DEPTH_TOOLTIP:25,ON_CLICK:26,ON_PHONE_TOUCH:27,ON_CLICKUP_CHART_PAINT:28,ON_SPLIT_YCOORDINATE:29,ON_DBCLICK:30,ON_SPLIT_XCOORDINATE:31,ON_KEYDOWN_SELECT_RECT:32,ON_DRAG_SELECT_RECT:33,ON_DRAG_SELECT_RECT_MOUSEUP:34,ON_DRAW_KLINE_LAST_POINT:35,ON_CLICK_CROSSCURSOR_RIGHT:36,ON_PLAY_SOUND:37,ON_CALCULATE_INDEX_OX:38,ON_LOAD_DRAWPICTURE:39,ON_DRAW_COUNTDOWN:41,ON_BIND_DRAWICON:42,ON_DRAW_DEAL_VOL_COLOR:43,ON_DRAW_DEAL_TEXT:44,ON_FILTER_DEAL_DATA:45,ON_FILTER_REPORT_DATA:46,ON_CLICK_REPORT_ROW:47,ON_REPORT_MARKET_STATUS:48,ON_DBCLICK_REPORT_ROW:49,ON_RCLICK_REPORT_ROW:50,ON_CLICK_REPORT_HEADER:51,ON_RCLICK_REPORT_HEADER:52,ON_REPORT_LOCAL_SORT:53,ON_DRAW_REPORT_NAME_COLOR:54,ON_DRAW_CUSTOM_TEXT:55,ON_CLICK_REPORT_TAB:56,ON_CLICK_REPORT_TABMENU:57,ON_DRAW_REPORT_FIXEDROW_TEXT:58,ON_CLICK_REPORT_FIXEDROW:59,ON_RCLICK_REPORT_FIXEDROW:60,ON_KEYDOWN_SELECT_RECT_FIRST:61,ON_CLICK_FRAME_TOOLBAR:62,ON_REPORT_DRAG_ROW:63,ON_MOUSE_MOVE:64,ON_MINUTE_PAGE_CHANGED:65,ON_DRAG_SUB_SELECT_RECT:66,ON_DRAG_SUB_SELECT_RECT_MOUSEUP:67,ON_KEYBOARD_SELECTED:68,ON_KEYBOARD_MOUSEUP:69,ON_CLICK_DRAWPICTURE_BUTTON:70,ON_FINISH_MOVE_DRAWPICTURE:71,ON_CLICK_EXTENDCHART_BUTTON:72,ON_SCROLLBAR_SLIDER_CHANGED:73,ON_DISPLAY_LATEST:74,ON_FORMAT_CORSSCURSOR_Y_TEXT:75,ON_FORMAT_INDEX_OUT_TEXT:76,ON_FORMAT_CORSSCURSOR_X_TEXT:77,ON_REPORT_MOUSE_MOVE:78,ON_REPORT_DRAG_HEADER_TOOLTIP:88,ON_REPORT_DRAW_CUSTOM_ICON:89,ON_REPORT_DRAW_KLINE:90,ON_DBCLICK_REPORT_DRAG_COLUMN_WIDTH:91,ON_REPORT_FORMAT_DRAW_INFO:92,ON_FORMAT_INDEX_Y_LABEL:93,ON_FORMAT_OVERLAY_INDEX_Y_LABEL:94,ON_CUSTOM_UNCHANGE_KLINE_COLOR:95,ON_CLICK_TITLE_BUTTON:96,ON_CUSTOM_LEFT_TOOLBAR:97,ON_CUSTOM_RIGHT_TOOLBAR:98,ON_REPORT_DRAG_COLUMN_WIDTH:99,ON_CUSTOM_UNCHANGE_KLINE_TITLE_COLOR:100,ON_CHANGE_KLINE_PERIOD:101,ON_MINUTE_TOUCH_ZOOM:102,ON_RELOAD_INDEX_CHART_RESOURCE:103,ON_RELOAD_OVERLAY_INDEX_CHART_RESOURCE:104,ON_CREATE_FRAME:105,ON_DELETE_FRAME:106,ON_SIZE_FRAME:107,ON_TOUCH_SCROLL_UP_DOWN:108},ce={OP_SCROLL_LEFT:1,OP_SCROLL_RIGHT:2,OP_ZOOM_OUT:3,OP_ZOOM_IN:4,OP_GOTO_HOME:5,OP_GOTO_END:6,OP_LEFT_ZOOM_OUT:7,OP_LEFT_ZOOM_IN:8,OP_RIGHT_ZOOM_OUT:9,OP_RIGHT_ZOOM_IN:10,OP_SCROLL_GOTO:11,OP_SET_SELECTRECT:12,OP_SET_SUB_SELECTRECT:13,OP_CORSSCURSOR_GOTO:14,OP_SCROOLBAR_SLIDER_CHANGED:15,OP_GOTO:16},be={DISABLE_DRAG_ID:0,CLICK_TOUCH_MODE_ID:3},xt={CLOSE_BEFOREOPEN_ID:1,CLOSE_OVERLAY_INDEX:2,MODIFY_INDEX_PARAM:3,CHANGE_INDEX:4,CLOSE_INDEX_WINDOW:5,OVERLAY_INDEX:6,MODIFY_OVERLAY_INDEX_PARAM:7,CHIP_DEFULT:8,CHIP_LONG:9,CHIP_RECENT:10,MAX_MIN_WINDOW:11,TITLE_WINDOW:12,DRAW_PICTURE_DELETE:13,DRAW_PICTURE_SETTING:14,EXTEND_CHART_BUTTON_ID:15,EXPORT_DATA:16,DRAW_PICTURE_BUTTON_1:17,DRAW_PICTURE_BUTTON_2:18,DRAW_PICTURE_BUTTON_3:19,DRAW_PICTURE_BUTTON_4:20,DRAW_PICTURE_BUTTON_5:21,DRAW_PICTURE_BUTTON_6:22,DRAW_PICTURE_BUTTON_7:23,DRAW_PICTURE_BUTTON_8:24,DRAW_PICTURE_BUTTON_9:25,DRAW_PICTURE_BUTTON_10:26,DRAW_PICTURE_BUTTON_11:27,DRAW_PICTURE_BUTTON_12:28,DRAW_PICTURE_BUTTON_13:29,DRAW_PICTURE_BUTTON_14:30,DRAW_PICTURE_BUTTON_15:31,DRAW_PICTURE_BUTTON_16:32,DRAW_PICTURE_BUTTON_17:33,DRAW_PICTURE_BUTTON_18:34,POP_MENU_1:40,POP_MENU_2:41,POP_MENU_3:42,INDEX_NAME_BUTTON:43},Ze={KLINE_ORDERFLOW:99,MINUTE_MULTI_DAY_EXTENDDATA:21,MINUTE_DAY_EXTENDDATA:21,MINUTE_BEFOREOPEN_EXTENDDATA:21,MINUTE_AFTERCLOSE_EXTENDDATA:21,KLINE_COLOR_DATA:66,KLINE_DAY_EXTENDDATA:25,KLINE_MINUTE_EXTENDDATA:25,KLINE_HEATMAP:67};function YT(){this.Start=[],this.Clear=function(){this.Start=[]},this.AddTouchStart=function(r,n,e){if(this.Start.length>0){var t=this.Start[this.Start.length-1],a=e-t.Time;a>0&&a<300?this.Start.push({X:r,Y:n,Time:e}):this.Start=[]}else this.Start.push({X:r,Y:n,Time:e})},this.IsVaildDBClick=function(){return this.Start.length==2},this.AddTouchEnd=function(r){if(!(this.Start.length<=0)){var n=this.Start[this.Start.length-1],e=r-n.Time;e>=0&&e<150||(this.Start=[])}}}function Ar(r,n,e){var t=this;if(this.ClassName="JSChartContainer",this.Frame,this.ChartPaint=new Array,this.ChartPaintEx=[],this.ChartInfo=new Array,this.ChartInfoPaint,this.ExtendChartPaint=new Array,this.TitlePaint=new Array,this.OverlayChartPaint=new Array,this.ChartDrawPicture=new Array,this.ChartDrawStorage,this.ChartDrawOption={IsLockScreen:!1,Zoom:1,Magnet:null},this.CurrentChartDrawPicture=null,this.SelectChartDrawPicture=null,this.MoveOnChartDrawPicture=null,this.IsDrawPictureXY=!1,this.EnableShowCorssCursor={DrawPicture:!0},this.ChartPictureMenu,this.ChartCorssCursor,this.IsClickShowCorssCursor=!1,this.ChartSplashPaint=null,this.LoadDataSplashTitle="数据加载中",this.CacheCanvas=null,this.CacheElement=null,e&&(this.CacheElement=e,this.CacheCanvas=e.getContext("2d")),n)this.Canvas=n.getContext("2d"),this.OffscreenCanvasElement=n,this.ShowCanvas=r.getContext("2d");else{if(_t.EnableCanvasWillReadFrequently===!0){var a={willReadFrequently:!0};this.Canvas=r.getContext("2d",a)}else this.Canvas=r.getContext("2d");this.ShowCanvas=null}this.CorssCursorElement,this.CorssCursorCanvas,this.UIElement=r,this.MouseDrag,this.PhoneTouchInfo,this.DragMode=1,this.EnableBorderDrag=!0,this.BorderDrag,this.YDrag,this.TouchStatus={CorssCursorShow:!1},this.DragTimer,this.EnableScrollUpDown=!1,this.ClickChartTimer=null,this.CursorIndex=0,this.LastPoint=new ot,this.IsForceLandscape=!1,this.CorssCursorTouchEnd=!1,this.IsTitleShowLatestData=!1,this.StepPixel=4,this.ZoomStepPixel=5,this.TouchMoveMinAngle=70,this.EnableAnimation=!1,this.Tooltip=document.createElement("div"),this.Tooltip.className="jschart-tooltip",this.Tooltip.style.background=m.TooltipBGColor,this.Tooltip.style.opacity=m.TooltipAlpha,this.Tooltip.style["pointer-events"]="none",this.Tooltip.id=oe(),r.parentNode.appendChild(this.Tooltip),this.IsShowTooltip=!0,this.SelectRect=document.createElement("div"),this.SelectRect.className="jschart-selectrect",this.SelectRect.style.background=m.SelectRectBGColor,this.SelectRect.style["pointer-events"]="none",this.SelectRect.id=oe(),this.SelectRect.oncontextmenu=function(){return!1},r.parentNode.appendChild(this.SelectRect),this.SelectRectRightMenu,this.FrameSplitData=new Dt.default,this.FrameSplitData.set("double",new ZC),this.FrameSplitData.set("price",new xm),this.mapEvent=new Dt.default,this.IsOnTouch=!1,this.TouchDrawCount=0,this.DisableMouse=!1,this.LanguageID=ke.LANGUAGE_CHINESE_ID,this.PressTime=500,this.NetworkFilter,this.LastMouseStatus={MouseOnToolbar:null},this.ClickDownPoint,this.IsDestroy=!1,this.EnableYDrag={Left:!1,Right:!1},this.EnableZoomIndexWindow=!1,this.EnableVerifyRecvData=!1,this.PhoneDBClick=new YT,this.SelectedChart={EnableSelected:!1,EnableMoveOn:!1,Selected:{Identify:null},MoveOn:{Identify:null}},this.IndexChartDrag,this.EnableIndexChartDrag=!1,this.GlobalOption={IsValueFullRange:!1,IsDisplayLatest:!1},this.VerticalDrag,this.EnableVerticalDrag=!1,this.ClickModel={IsShowCorssCursor:!1},this.EnableClickModel=!1,this.DisplayLatestOption={Timer:null,Enable:!1,DelayTime:60*1e3*3,LastPoint:null},this.DrawDynamicInfoOption={Timer:null,Enable:!1,DelayTime:10},this.SetCorssCursorElement=function(s){!s||!s.Element||!s.Canvas||(this.CorssCursorElement=s.Element,this.CorssCursorCanvas=s.Canvas)},this.StopDisplayLatest=function(){this.GlobalOption.IsDisplayLatest=!1,this.DisplayLatestOption.Timer&&(clearTimeout(this.DisplayLatestOption.Timer),this.DisplayLatestOption.Timer=null)},this.StartStopDisplayLatest=function(){var s=this;this.StopDisplayLatest(),this.DisplayLatestOption.Enable&&(this.DisplayLatestOption.Timer=setTimeout(function(){s.DisplayLatest&&(X.Chart.Log("[JSChartContainer:StartStopDisplayLatest] call this.DisplayLatest()"),s.DisplayLatest())},this.DisplayLatestOption.DelayTime))},this.StopDrawDynamicInfo=function(){this.DrawDynamicInfoOption.Timer&&(clearTimeout(this.DrawDynamicInfoOption.Timer),this.DrawDynamicInfoOption.Timer=null)},this.ChartDestroy=function(){this.IsDestroy=!0,this.StopAutoUpdate(),this.GetLatestVersionTimer!=null&&(clearTimeout(this.GetLatestVersionTimer),this.GetLatestVersionTimer=null)},this.ChartDestory=this.ChartDestroy,this.GetLatestVersionTimer=null,this.GetLatestVersion=function(){var s=this;this.GetLatestVersionTimer!=null&&(clearTimeout(this.GetLatestVersionTimer),this.GetLatestVersionTimer=null);var o=Math.floor(Math.random()*50),h=1e3*60*3+o*1e3,l="aHR0cHM6Ly9ocWNoYXJ0LnplYWxpbmsuY29tL2FwaS9HZXRWZXJzaW9u";X.Chart.Log("[JSChartContainer::GetLatestVersion] wait for get hqchart latest version. ",h),this.GetLatestVersionTimer=setTimeout(function(){var u=0,f=0;s.Frame&&s.Frame.ChartBorder&&(u=s.Frame.ChartBorder.GetChartWidth(),f=s.Frame.ChartBorder.GetChartHeight());var C=atob(l)+"?width="+u+"&height="+f+"&type=h5";_t.LastVersion==null&&Lt.HttpRequest({url:C,type:"get",dataType:"json",async:!0,success:function(v){X.Chart.Log("[JSChartContainer::GetLatestVersion] hqchart latest version. ",v),_t.LastVersion=v},error:function(v,S,T){X.Chart.Log("[JSChartContainer::GetLatestVersion] Get HQChart latest version failed.",v)}})},h)},this.SetFocus=function(){this.UIElement&&this.UIElement.focus()},this.AddEventCallback=function(s){if(!(!s||!s.event||!s.callback)){var o={Callback:s.callback,Source:s};this.mapEvent.set(s.event,o)}},this.RemoveEventCallback=function(s){this.mapEvent.has(s)&&this.mapEvent.delete(s)},this.GetEventCallback=function(s){if(!this.mapEvent.has(s))return null;var o=this.mapEvent.get(s);return o},this.GetIndexEvent=function(){return this.GetEventCallback(et.RECV_INDEX_DATA)},this.GetOverlayIndexEvent=function(){return this.GetEventCallback(et.RECV_OVERLAY_INDEX_DATA)},r.onmousemove=function(s){t.UIOnMouseMove(s)},r.oncontextmenu=function(s){return t.UIOnContextMenu(s)},r.ondblclick=function(s){t.UIOnDblClick(s)},r.onmousedown=function(s){t.UIOnMouseDown(s)},r.onmouseout=function(s){t.UIOnMounseOut(s)},r.onmouseleave=function(s){t.UIOnMouseleave(s)},this.UIOnMouseMove=function(s){var o=V(),h=(s.clientX-this.UIElement.getBoundingClientRect().left)*o,l=(s.clientY-this.UIElement.getBoundingClientRect().top)*o;if(this.StopDisplayLatest(),this.MoveOnChartDrawPicture=null,!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)&&this.DisableMouse!=!0&&!this.BorderDrag&&!this.YDrag&&!this.IndexChartDrag){s&&s.type=="mouseout"&&s.buttons==0&&(h=l=-1);var u={X:h,Y:l,IsInClient:this.IsMouseOnClient(h,l)};this.LastMouseStatus.OnMouseMove=u,this.LastMouseStatus.MoveOnPoint={X:h,Y:l};var f=this.GetEventCallback(et.ON_MOUSE_MOVE),C=this.TitlePaint[0];f&&C&&(C.OnMouseMoveEvent=f),this.MoveOnPoint={X:h,Y:l},this.OnMouseMove(h,l,s),C&&(C.OnMouseMoveEvent=null),this.StartStopDisplayLatest()}},this.IsMouseOnClient=function(s,o){var h={Left:this.Frame.ChartBorder.GetLeft(),Top:this.Frame.ChartBorder.GetTop(),Width:this.Frame.ChartBorder.GetWidth(),Height:this.Frame.ChartBorder.GetHeight()};return h.Right=h.Left+h.Width,h.Bottom=h.Top+h.Height,s>=h.Left&&s<=h.Right&&o>=h.Top&&o<=h.Bottom},this.UIOnContextMenu=function(s){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var o=s.clientX-this.UIElement.getBoundingClientRect().left,h=s.clientY-this.UIElement.getBoundingClientRect().top;return typeof this.OnRightMenu=="function"&&this.OnRightMenu(o,h,s),!1}},this.UIOnDblClick=function(s){var o=V(),h=(s.clientX-this.UIElement.getBoundingClientRect().left)*o,l=(s.clientY-this.UIElement.getBoundingClientRect().top)*o;this.OnDoubleClick(h,l,s)},this.TryYDrag=function(s,o){if(!this.EnableYDrag||!this.EnableYDrag.Left&&!this.EnableYDrag.Right||!this.Frame||!this.Frame.PtInFrameY)return null;var h=this.Frame.PtInFrameY(s,o);return!h||h.Index<0||h.IsOverlay==!0?null:h.Left&&this.EnableYDrag.Left&&this.Frame.IsEnableDragY(h.Index)||h.Right&&this.EnableYDrag.Right&&this.Frame.IsEnableDragY(h.Index)?h:null},this.TryUpDownDrag=function(s,o){var h=this.Frame.PtInFrame(s,o);if(h<0)return null;var l=this.Frame.SubFrame[h];if(!l||!l.Frame)return null;var u=l.Frame;return!u.YSplitOperator||!u.YSplitOperator.FixedYMaxMin?null:{Index:h,X:s,Y:o}},this.TryRectSelectDrag=function(s,o){var h=this.GetRectSelectPaint();if(!h||h.GetPointCount()<=0)return null;var l=h.PtInPaint(s,o);return{Item:l,X:s,Y:o}},this.TryClickCrossCursor=function(s,o,h){if(this.ChartCorssCursor){var l=this.ChartCorssCursor.PtInButton(s,o);if(!l)return!1;var u=this.GetEventCallback(et.ON_CLICK_CROSSCURSOR_RIGHT);if(u&&u.Callback){var f={Button:l,e:h};u.Callback(u,f,this)}return!0}},this.TryClickButton=function(s,o,h){var l=this.Frame.PtInButtons(s,o);return l&&this.ClickFrameButton?(this.ClickFrameButton(l,h),!0):(l=this.PtInExtendChartButtons(s,o),l&&this.ClickExtendChartButton?(this.ClickExtendChartButton(l,h),!0):(l=this.PtInDrawPictureButtons(s,o),l&&this.ClickDrawPictureButton?(this.ClickDrawPictureButton(l,h),!0):(l=this.PtInTitleButtons(s,o),l&&this.ClickTitleButton?(this.ClickTitleButton(l,h),!0):!1)))},this.UIOnMouseDown=function(s){var o=this;if(this.MoveOnChartDrawPicture=null,!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){this.ClickDownPoint={X:s.clientX,Y:s.clientY},this.IsOnTouch=!0,this.BorderDrag=null,this.YDrag=null,this.UpDownDrag=null,this.RectSelectDrag=null,this.IndexChartDrag=null;var h=V(),l=(s.clientX-this.UIElement.getBoundingClientRect().left)*h,u=(s.clientY-this.UIElement.getBoundingClientRect().top)*h;if(!this.TryClickButton(l,u,s)&&!this.TryClickCrossCursor(l,u,s)&&!(this.TryClickChartTooltipData&&this.TryClickChartTooltipData(l,u,s))&&!(this.TryClickLock&&this.TryClickLock(l,u))){this.HideSelectRect(),this.SelectRectRightMenu&&this.SelectRectRightMenu.Hide(),this.ChartPictureMenu&&this.ChartPictureMenu.Hide();var f=this.GetRectSelectPaint();if(f&&f.GetPointCount()>0){var C=f.PtInPaint(l,u);if(C)if(C.Type==4){this.UIElement.style.cursor="pointer";var D={X:s.clientX};this.GetXDataIndex(D)&&(this.RectSelectDrag={DataIndex:D.DataIndex,Type:C.Type,X:s.clientX},X.Chart.Log("[JSChartContainer::UIOnMouseDown] drag sub rect select ",D))}else this.UIElement.style.cursor="ew-resize",this.RectSelectDrag={Index:C.PointIndex,Type:C.Type},X.Chart.Log("[JSChartContainer::UIOnMouseDown] drag rect select ",C)}if(!this.RectSelectDrag&&this.ClearRectSelect(!1)&&this.Draw(),this.EnableBorderDrag&&this.Frame){var v=this.Frame.PtInFrameBorder(l,u);v&&v.Index>=0&&(this.UIElement.style.cursor="n-resize",this.BorderDrag={Index:v.Index},X.Chart.Log("[JSChartContainer::UIOnMouseDown] DragBorder ",v))}if(!this.BorderDrag){var S=this.TryYDrag(l,u);if(S)this.UIElement.style.cursor=S.Position==0?"n-resize":"row-resize",this.YDrag=S,X.Chart.Log("[JSChartContainer::UIOnMouseDown] dragY ",S);else{var T=this.TryUpDownDrag(l,u);T&&(this.UIElement.style.cursor="pointer",this.UpDownDrag=T,X.Chart.Log("[JSChartContainer::UIOnMouseDown] dragUpDown ",T))}}if(this.DragMode!=0){var I={Click:{},LastMove:{},CurrentMove:{}};I.Click.X=s.clientX,I.Click.Y=s.clientY,I.Click.IsInFrameBottom=this.Frame.PtInFrameBottom(l,u),I.LastMove.X=s.clientX,I.LastMove.Y=s.clientY,this.MouseDrag=I;var F=this.GetActiveDrawPicture(),E={Chart:this.SelectedChart.Selected.Chart,Identify:this.SelectedChart.Selected.Identify};if(this.SelectChartDrawPicture=null,!this.BorderDrag){if(!(this.YDrag||this.RectSelectDrag))if(this.CurrentChartDrawPicture){this.UpDownDrag=null;var M=this.CurrentChartDrawPicture;M.Status==2?this.SetChartDrawPictureThirdPoint(I.Click.X,I.Click.Y):(this.SetChartDrawPictureFirstPoint(I.Click.X,I.Click.Y),this.FinishChartDrawPicturePoint()&&(M.IsDrawMain?this.Draw():this.DrawDynamicInfo())),F.Select.Guid&&(!this.CurrentChartDrawPicture||F.Select.Guid!=this.CurrentChartDrawPicture.Guid)&&F.Select.Chart.IsDrawMain&&this.Draw()}else{var O={};if(O.X=(s.clientX-this.UIElement.getBoundingClientRect().left)*h,O.Y=(s.clientY-this.UIElement.getBoundingClientRect().top)*h,this.GetChartDrawPictureByPoint(O)){if(O.ChartDrawPicture.EnableMove==!0){this.UpDownDrag=null,this.CurrentChartDrawPicture=O.ChartDrawPicture,this.SelectChartDrawPicture=O.ChartDrawPicture;var R=!1;(F.Select.Guid&&F.Select.Chart&&F.Select.Chart.IsDrawMain||O.ChartDrawPicture.IsDrawMain)&&(R=!0),R&&this.Draw(),O.ChartDrawPicture.Status=20,O.ChartDrawPicture.ValueToPoint(),O.ChartDrawPicture.MovePointIndex=O.PointIndex,this.SelectChartDrawPicture.DragInfo={Click:{X:s.clientX,Y:s.clientY}}}else this.CurrentChartDrawPicture=null,this.SelectChartDrawPicture=null;var b=this.GetEventCallback(et.ON_CLICK_DRAWPICTURE);if(b&&b.Callback){var p={DrawPicture:O.ChartDrawPicture};b.Callback(b,p,this)}else this.OnSelectChartPicture(O.ChartDrawPicture)}else{this.ClickChartTimer!=null&&(clearTimeout(this.ClickChartTimer),this.ClickChartTimer=null);var G=this,Y={X:this.ClickDownPoint.X,Y:this.ClickDownPoint.Y};this.ClickChartTimer=setTimeout(function(){G.TryClickPaintEvent(et.ON_CLICK_CHART_PAINT,Y,s)},250);var Q=!1;if(this.SelectedChart.EnableSelected){var ht=this.PtInChart(l,u);ht?(this.SelectedChart.Selected.Identify!=ht.Identify&&(this.SelectedChart.Selected.Identify=ht.Identify,this.SelectedChart.Selected.Chart=ht.Chart,Q=!0),this.EnableIndexChartDrag&&(this.IndexChartDrag={SelectedChart:ht,LastMove:{X:l,Y:u},Click:{X:l,Y:u}},this.IndexChartDrag.Info=this.GetSelectedChartInfo(ht),this.IndexChartDrag.Info&&(this.IndexChartDrag.Info.FrameID=this.Frame.PtInFrame(l,u)))):this.SelectedChart.Selected.Identify&&(this.SelectedChart.Selected.Identify=null,this.SelectedChart.Selected.Chart=null,Q=!0)}else this.SelectedChart.Selected.Identify&&(this.SelectedChart.Selected.Identify=null,Q=!0);if(F.Select.Guid!=null&&this.SelectChartDrawPicture==null||Q){var Ct=0;if(F.Select.Guid&&F.Select.Chart&&F.Select.Chart.IsDrawMain&&(Ct=1),Q){var lt=E.Chart;lt&&lt.SetSelectedStatus&&(lt.SetSelectedStatus(0),Ct=1),lt=this.SelectedChart.Selected.Chart,lt&&lt.SetSelectedStatus&&(lt.SetSelectedStatus(1),Ct=1)}Ct==1?this.Draw():this.DrawDynamicInfo()}}}}document.onmousemove=function(dt){o.DocOnMouseMove(dt)},document.onmouseup=function(dt){o.DocOnMouseUp(dt)}}}}},this.DocOnMouseMove=function(s){if(!(this.ChartSplashPaint&&this.IsEnableSplash==!0)){var o=this.MouseDrag;if(o){var h=Math.abs(o.LastMove.X-s.clientX),l=Math.abs(o.LastMove.Y-s.clientY),u=this.RectSelectDrag&&this.RectSelectDrag.Index>=0,f=this.RectSelectDrag&&this.RectSelectDrag.Type==4;if(o.CurrentMove&&(o.CurrentMove.X=s.clientX,o.CurrentMove.Y=s.clientY),this.BorderDrag&&this.BorderDrag.Index>=0){if(Math.abs(o.LastMove.Y-s.clientY)<5)return;var C=s.clientY-o.LastMove.Y;this.OnMoveFromeBorder(this.BorderDrag.Index,C),o.LastMove.X=s.clientX,o.LastMove.Y=s.clientY}else if(this.YDrag&&this.YDrag.Index>=0){if(l<5)return;var C=s.clientY-o.LastMove.Y;X.Chart.Log("[JSChartContainer::DocOnMouseMove] YDrag ",this.YDrag,C),this.OnZoomUpDownFrameY(this.YDrag,C),o.LastMove.X=s.clientX,o.LastMove.Y=s.clientY}else if(this.IndexChartDrag&&this.IndexChartDrag.SelectedChart){if(Math.abs(o.LastMove.Y-s.clientY)<2&&Math.abs(o.LastMove.X-s.clientX)<2)return;var D=this.GetExtendChartByClassName("DragMovePaint");if(D&&D.Chart){var v=V(),S=(s.clientX-this.UIElement.getBoundingClientRect().left)*v,T=(s.clientY-this.UIElement.getBoundingClientRect().top)*v;D.Chart.Point={X:S,Y:T},D.Chart.IsShow=!0,D.Chart.Info=this.IndexChartDrag.Info,this.DrawDynamicInfo()}this.IndexChartDrag.LastMove.X=S,this.IndexChartDrag.LastMove.Y=T,o.LastMove.X=s.clientX,o.LastMove.Y=s.clientY}else if(this.CurrentChartDrawPicture){var I=this.CurrentChartDrawPicture;if(I.Status==1||I.Status==2){if(Math.abs(o.LastMove.X-s.clientX)<5&&Math.abs(o.LastMove.Y-s.clientY)<5)return;this.SetChartDrawPictureSecondPoint(s.clientX,s.clientY)&&this.DrawDynamicInfo()}else if(I.Status==3)this.SetChartDrawPictureThirdPoint(s.clientX,s.clientY)&&this.DrawDynamicInfo();else if(I.Status==20){if(Math.abs(o.LastMove.X-s.clientX)<5&&Math.abs(o.LastMove.Y-s.clientY)<1||this.SelectChartDrawPicture&&this.SelectChartDrawPicture.EnableCtrlMove&&!s.ctrlKey)return;this.SelectChartDrawPicture&&this.SelectChartDrawPicture.DragInfo&&(this.SelectChartDrawPicture.DragInfo.Move={X:s.clientX,Y:s.client}),this.MoveChartDrawPicture(s.clientX-o.LastMove.X,s.clientY-o.LastMove.Y,!1,o)&&this.DrawDynamicInfo()}o.LastMove.X=s.clientX,o.LastMove.Y=s.clientY}else if(this.DragMode==1||u||f)this.OnDragMode_One({X:h,Y:l},s);else if(this.DragMode==2){var F=Math.abs(o.LastMove.Y-s.clientY);if(h<5&&F<5)return;this.UIElement.style.cursor="default";var S=o.Click.X-r.getBoundingClientRect().left,T=o.Click.Y-r.getBoundingClientRect().top,E=s.clientX-r.getBoundingClientRect().left,M=s.clientY-r.getBoundingClientRect().top;this.ShowSelectRect(S,T,E,M),o.LastMove.X=s.clientX,o.LastMove.Y=s.clientY}}}},this.OnDragMode_One=function(s,o){var h=s.X,l=s.Y,u=this.MouseDrag;if(!(h<5&&l<5)){var f=!1,C=!1;if(l>=5&&this.UpDownDrag&&this.UpDownDrag.Index>=0){var D=o.clientY-u.LastMove.Y;X.Chart.Log("[JSChartContainer::OnDragMode_One] UpDownDrag ",this.UpDownDrag,D),this.UIElement.style.cursor="pointer",this.OnUpDonwFrameY(this.UpDownDrag,D)&&(f=!0,C=!0),u.LastMove.Y=o.clientY}if(h>=5){if(this.RectSelectDrag){if(this.RectSelectDrag.Index>=0){var v={X:o.clientX,Y:o.clientY,PointIndex:this.RectSelectDrag.Index,Name:"MoveRectSelectLine"};this.MoveRectSelectPoint(v)&&(f=!0)}else if(this.RectSelectDrag.Type===4){var v={X:o.clientX};if(!this.GetXDataIndex(v)||v.DataIndex==this.RectSelectDrag.DataIndex)return;var S=v.DataIndex-this.RectSelectDrag.DataIndex,T=!0;if(S>0&&(T=!1),!this.MoveSubRectSelect({Step:Math.abs(S),IsLeft:T,X:o.clientX,Y:o.clientY}))return;this.RectSelectDrag.DataIndex=v.DataIndex,this.RectSelectDrag.X=o.clientX,f=!0}}else{var T=!0;u.LastMove.X<o.clientX&&(T=!1);var I="pointer";u.Click.IsInFrameBottom&&(I="ew-resize");var F=this.GetMoveOneStepWidth();if(h<F){this.UIElement.style.cursor=I,f&&this.Draw();return}else u.Click&&u.Click.IsInFrameBottom?this.XCoordinateZoom(h,T)&&(this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),f=!0):this.DataMove(h,T)?(this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),f=!0):C||this.DragDownloadData&&this.DragDownloadData();this.UIElement.style.cursor=I}u.LastMove.X=o.clientX}f&&(this.Draw(),this.OnKLinePageChange("datamove"))}},this.GetXDataIndex=function(s){if(!this.ChartPaint[0]||!this.ChartPaint[0].Data)return!1;var o=this.ChartPaint[0].Data;if(!this.Frame.SubFrame[0])return!1;var h=this.Frame.SubFrame[0].Frame,l=V(),u=(s.X-r.getBoundingClientRect().left)*l,f=h.GetXData(u);f=parseInt(f.toFixed(0));var C=f+o.DataOffset;C>=o.Data.length&&(C=o.Data.length-1);var D=o.Data[C];return s.DataIndex=C,s.Item=D,!0},this.DocOnMouseUp=function(s){document.onmousemove=null,document.onmouseup=null;var o=this.ClassName=="MinuteChartContainer"||this.ClassName=="MinuteChartHScreenContainer",h=this.RectSelectDrag&&this.RectSelectDrag.Index>=0,l=this.RectSelectDrag&&this.RectSelectDrag.Type==4,u=!0;if(this.CurrentChartDrawPicture){var f=this.CurrentChartDrawPicture;f.Status==2||f.Status==1||f.Status==3?(f.PointStatus=f.Status,this.FinishChartDrawPicturePoint()?this.DrawDynamicInfo():u=!1):f.Status==20&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}else if(this.IndexChartDrag&&this.IndexChartDrag.SelectedChart){var C=this.GetExtendChartByClassName("DragMovePaint");C&&C.Chart&&C.Chart.Clear(),this.OnDragChart(this.IndexChartDrag)||this.DrawDynamicInfo(),this.UIElement.style.cursor="default"}else if(h)this.OnDragSelectRectMouseUp&&this.OnDragSelectRectMouseUp(s);else if(l)this.OnDragSubSelectRectMouseUp&&this.OnDragSubSelectRectMouseUp(s);else if(o)this.OnMinuteSelectRectMouseUp&&this.OnMinuteSelectRectMouseUp(s);else if(this.DragMode==2){var D=this.MouseDrag;D.LastMove.X=s.clientX,D.LastMove.Y=s.clientY;var v=new nC,S=V();if(v.XStart=(D.Click.X-r.getBoundingClientRect().left)*S,v.YStart=(D.Click.Y-r.getBoundingClientRect().top)*S,v.XEnd=(D.LastMove.X-r.getBoundingClientRect().left)*S,v.YEnd=(D.LastMove.Y-r.getBoundingClientRect().top)*S,v.JSChartContainer=this,v.Stock={Symbol:this.Symbol,Name:this.Name},!this.BorderDrag&&this.GetSelectRectData(v)){var T=this.GetEventCallback(et.ON_SELECT_RECT),I=this.GetRectSelectPaint(),F=!0;if(T&&T.Callback){var E={X:D.LastMove.X-r.getBoundingClientRect().left,Y:D.LastMove.Y-r.getBoundingClientRect().top,SelectData:v,RectSelectPaint:I,IsShowMenu:!0};T.Callback(T,E,this),F=E.IsShowMenu}o?(this.HideSelectRect(),this.UpdateSelectRect(v.Start,v.End)):F&&this.SelectRectRightMenu&&(s.data={Chart:this,X:D.LastMove.X-r.getBoundingClientRect().left,Y:D.LastMove.Y-r.getBoundingClientRect().top,SelectData:v,RectSelectPaint:I},this.SelectRectRightMenu.DoModal(s))}else this.TryClickPaintEvent(et.ON_CLICKUP_CHART_PAINT,this.ClickDownPoint,s)}else this.TryClickPaintEvent(et.ON_CLICKUP_CHART_PAINT,this.ClickDownPoint,s),this.ClickEvent(s);X.Chart.Log("[KLineChartContainer::document.onmouseup]",s),this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.DragInfo=null),this.UIElement.style.cursor="default",this.MouseDrag=null,this.ClickDownPoint=null,this.IsOnTouch=!1,this.BorderDrag&&this.BorderDrag.Index>=0&&this.Frame.SaveSubFrameHeightRate(),this.BorderDrag=null,this.YDrag=null,this.UpDownDrag=null,this.RectSelectDrag=null,this.IndexChartDrag=null,u===!0&&(this.CurrentChartDrawPicture=null)},this.UIOnMounseOut=function(s){X.Chart.Log("[KLineChartContainer::UIOnMounseOut]",s),this.UIOnMouseMove(s)},this.UIOnMouseleave=function(s){X.Chart.Log("[KLineChartContainer::UIOnMouseleave]",s)},this.OnDragChart=function(s){if(!s)return!1;var o=s.Info,h=s.LastMove,l=o.FrameID,u=this.Frame.PtInFrame(h.X,h.Y);return u<0?u==-3?this.MoveIndexToNewWindow({WindowIndex:l,IndexID:o.IndexID},{Operator:0}):!1:l==u?!1:this.MoveIndex({WindowIndex:l,IndexID:o.IndexID},{WindowIndex:u},{Operator:0})},this.GetSelectedChartInfo=function(s){if(!s)return null;var o={Type:0},h=s.Identify;if(h=="Main-KLine")o.Name=this.Name,o.Symbol=this.Symbol,o.Type=Ge.MAIN_KLINE;else if(h.indexOf("Overlay-KLine-")==0)o.Name=s.Chart.Title,o.Symbol=s.Chart.Symbol,o.Type=Ge.OVERLAY_KLINE;else if(h.indexOf("Overlay-Minute-")==0)o.Name=s.Chart.Title,o.Symbol=s.Chart.Symbol,o.Type=Ge.OVERLAY_MINUTE;else if(h=="Minute-Line")o.Name=this.Name,o.Symbol=this.Symbol,o.Type=Ge.MAIN_MINUTE;else if(h=="Minute-Average-Line")o.Name=this.Name,o.Symbol=this.Symbol,o.Type=Ge.MAIN_AVERAGE_MINUTE;else if(h=="Minute-Vol-Bar")o.Name=this.Name,o.Symbol=this.Symbol,o.Type=Ge.MAIN_MINUTE_VOL;else if(h.indexOf("guid")==0)for(var l=0;l<this.TitlePaint.length;++l){var u=this.TitlePaint[l];if(u.ClassName=="DynamicChartTitlePainting"){if(u.Identify==h){o.IndexName=u.Title,o.IndexID=h,o.Type=Ge.MAIN_INDEX;break}var f=!0,C=!1,D=void 0;try{for(var v=(0,we.default)(u.OverlayIndex),S;!(f=(S=v.next()).done);f=!0){var T=S.value;if(T[0]==h){o.IndexName=T[1].Title,o.IndexID=h,o.Type=Ge.OVERLAY_INDEX;break}}}catch(I){C=!0,D=I}finally{try{!f&&v.return&&v.return()}finally{if(C)throw D}}if(o.Type>0)break}}return o},this.ClickEvent=function(s){var o=this.GetEventCallback(et.ON_CLICK);if(!o||!o.Callback||this.ClickDownPoint.X!=s.clientX||this.ClickDownPoint.Y!=s.clientY)return!1;var h=V(),l=(s.clientX-r.getBoundingClientRect().left)*h,u=(s.clientY-r.getBoundingClientRect().top)*h,f={X:s.clientX,Y:s.clientY,FrameID:-1},C=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),C=this.Canvas.isPointInPath(l,u),C){var D={},v=this.Frame.GetYData(u,D);if(c.IsNumber(D.FrameID)&&D.FrameID>=0){var S=this.Frame.GetXData(l);f.FrameID=D.FrameID,f.Data={X:S,Y:v}}}return o.Callback(o,f,this),!0},this.DBClickEvent=function(s,o){var h=this.GetEventCallback(et.ON_DBCLICK);if(!h||!h.Callback)return!1;var l=V(),u=(o.clientX-r.getBoundingClientRect().left)*l,f=(o.clientY-r.getBoundingClientRect().top)*l,C={X:o.clientX,Y:o.clientY,FrameID:-1,ClientPos:-1},D=this.PtInClient(u,f);if(C.ClientPos=D,D>0){var v={},S=this.Frame.GetYData(f,v);if(c.IsNumber(v.FrameID)&&v.FrameID>=0){var T=this.Frame.GetXData(u);C.FrameID=v.FrameID,C.Data={X:T,Y:S},this.GetDataItem&&(C.Data.Item=this.GetDataItem({ClientPos:D,Index:T,Point:{X:u,Y:f}}))}}return s&&s.SelectedChart&&(C.SelectedChart=this.GetSelectedChartInfo(s.SelectedChart)),h.Callback(h,C,this),!0},this.PtInChartPaintTooltip=function(s,o,h){for(var l=0;l<this.ChartPaint.length;++l){var u=this.ChartPaint[l];if(u.GetTooltipData(s,o,h))return u}return null},this.PtInOverlayChartPaintTooltip=function(s,o,h){for(var l=0;l<this.OverlayChartPaint.length;++l){var u=this.OverlayChartPaint[l];if(u.GetTooltipData(s,o,h))return u}return null},this.TryClickPaintEvent=function(s,o,h){var l=this.GetEventCallback(s);if(l&&l.Callback&&o.X==h.clientX&&o.Y==h.clientY){var u=V(),f=(h.clientX-r.getBoundingClientRect().left)*u,C=(h.clientY-r.getBoundingClientRect().top)*u,D=new zr,v=null,S=this.PtInChartPaintTooltip(f,C,D);if(S&&(v={Symbol:this.Symbol,Name:this.Name}),S||(S=this.PtInOverlayChartPaintTooltip(f,C,D),S&&(v={Symbol:D.ChartPaint.Symbol,Name:D.ChartPaint.Title})),D.Data){var T={X:h.clientX,Y:h.clientY,Stock:v,Tooltip:D};return l.Callback(l,T,this),!0}}return!1},this.IsPhoneDragging=function(s){var o=s.changedTouches.length,h=s.touches.length;return o==1&&h==1},this.IsPhonePinching=function(s){var o=s.changedTouches.length,h=s.touches.length;return(o==1||o==2)&&h==2},this.PreventTouchEvent=function(s){s.cancelable&&s.preventDefault(),s.stopPropagation()},this.GetToucheData=function(s,o){for(var h=new Array,l=V(),u=0;u<s.touches.length;++u){var f=s.touches[u];o?h.push({clientX:f.clientY*l,clientY:f.clientX*l,pageX:f.pageY*l,pageY:f.pageX*l}):h.push({clientX:f.clientX*l,clientY:f.clientY*l,pageX:f.pageX*l,pageY:f.pageY*l})}return h},this.IsSingleTouch=function(s){var o=s.touches.length;return o==1},this.StopDragTimer=function(){c.IsNumber(this.DragTimer)&&(clearTimeout(this.DragTimer),this.DragTimer=null)},this.GetMoveAngle=function(s,o){var h=Math.abs(s.X-o.X),l=Math.abs(s.Y-o.Y),u=Math.atan(h/l)*180/Math.PI;return u},r.ontouchstart=function(s){t.OnTouchStart(s)},r.ontouchmove=function(s){t.OnTouchMove(s)},r.ontouchend=function(s){t.OnTouchEnd(s)},this.AddPhoneDBClickInfo=function(s,o,h){var l={X:s,Y:o,Time:h};this.PhoneDBClickInfo.Start.push(l)},this.ClearPhoneDBClickInfo=function(){this.PhoneDBClickInfo.Start=[]},this.IsShortPhoneClick=function(s,o,h){},this.OnTouchStart=function(s){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){this.IsOnTouch=!0,this.TouchDrawCount=0,this.PhonePinch=null,this.StopDragTimer();var o=this.IsSingleTouch(s);if((this.EnableScrollUpDown==!1||!o||this.DragMode==be.CLICK_TOUCH_MODE_ID&&this.TouchStatus.CorssCursorShow==!0)&&s.cancelable&&s.preventDefault(),this.IsPhoneDragging(s)){var h=this.GetToucheData(s,this.IsForceLandscape),l=this.PointAbsoluteToRelative(h[0].clientX,h[0].clientY,!0);if(this.TryClickLock||this.TryClickIndexTitle){var u=l.X,f=l.Y;if(this.TryClickLock&&this.TryClickLock(u,f)||this.TryClickIndexTitle&&this.TryClickIndexTitle(u,f))return}if(this.ClickFrameButton){var C=this.Frame.PtInButtons(l.X,l.Y);if(C){this.ClickFrameButton(C,s);return}}this.EnableVerticalDrag&&(this.VerticalDrag={IsDrag:!1},this.Frame.PtInFrameVertical(l.X,l.Y)&&(this.VerticalDrag.IsDrag=!0));var D=!0;this.ChartDrawOption.IsLockScreen?D=!1:this.DragMode==be.CLICK_TOUCH_MODE_ID?this.TouchStatus.CorssCursorShow==!0&&(D=!1):this.DragMode==be.DISABLE_DRAG_ID?D=!1:o||(D=!1),this.VerticalDrag&&(D=!1),this.EnableClickModel&&this.ClickModel.IsShowCorssCursor==!0&&(D=!1);var v={Click:{},LastMove:{}};if(v.Click.X=h[0].clientX,v.Click.Y=h[0].clientY,v.LastMove.X=h[0].clientX,v.LastMove.Y=h[0].clientY,this.MouseDrag=v,this.PhoneTouchInfo={Start:{X:h[0].clientX,Y:h[0].clientY},End:{X:h[0].clientX,Y:h[0].clientY}},this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.IsSelected=!1),this.SelectChartDrawPicture=null,this.CurrentChartDrawPicture){var S=this.CurrentChartDrawPicture;S.Status==2?this.SetChartDrawPictureThirdPoint(v.Click.X,v.Click.Y,!0):(this.SetChartDrawPictureFirstPoint(v.Click.X,v.Click.Y,!0),this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo({Corss:!1,Tooltip:!1})),s.cancelable&&s.preventDefault();return}else{var l=this.PointAbsoluteToRelative(h[0].clientX,h[0].clientY,!0),T={X:l.X,Y:l.Y};if(this.GetChartDrawPictureByPoint(T)){T.ChartDrawPicture.Status=20,T.ChartDrawPicture.ValueToPoint(),T.ChartDrawPicture.MovePointIndex=T.PointIndex,T.ChartDrawPicture.IsSelected=!0,this.CurrentChartDrawPicture=T.ChartDrawPicture,this.SelectChartDrawPicture=T.ChartDrawPicture;var I=this.GetEventCallback(et.ON_CLICK_DRAWPICTURE);if(I&&I.Callback){var F={DrawPicture:T.ChartDrawPicture};I.Callback(I,F,this)}s.cancelable&&s.preventDefault();return}}if(D){var E=this;this.DragTimer=setTimeout(function(){v.Click.X==v.LastMove.X&&v.Click.Y==v.LastMove.Y&&(E.MouseDrag,E.MouseDrag=null,E.DragMode==be.CLICK_TOUCH_MODE_ID&&(E.TouchStatus.CorssCursorShow=!0),E.EnableClickModel===!0&&(E.ClickModel.IsShowCorssCursor=!0),E.MoveCorssCursor(v.Click,s))},E.PressTime)}this.EnableZoomIndexWindow&&(this.PhoneDBClick.AddTouchStart(h[0].clientX,h[0].clientY,Date.now()),X.Chart.Log("[JSChartContainer::OnTouchStart] PhoneDBClick ",this.PhoneDBClick)),this.ChartDrawOption.IsLockScreen?this.MouseDrag=null:this.DragMode==be.CLICK_TOUCH_MODE_ID||(this.DragMode==be.DISABLE_DRAG_ID?(this.MouseDrag=null,this.MoveCorssCursor(v.Click,s)):this.EnableClickModel||(this.VerticalDrag?this.VerticalDrag.IsDrag||this.MoveCorssCursor(v.Click,s):this.IsClickShowCorssCursor&&this.MoveCorssCursor(v.Click,s))),this.TouchEvent({EventID:et.ON_PHONE_TOUCH,FunctionName:"OnTouchStart"},s)}else if(this.IsPhonePinching(s)){var M={Start:{},Last:{}},h=this.GetToucheData(s,this.IsForceLandscape);M.Start={X:h[0].pageX,Y:h[0].pageY,X2:h[1].pageX,Y2:h[1].pageY},M.Last={X:h[0].pageX,Y:h[0].pageY,X2:h[1].pageX,Y2:h[1].pageY},this.PhonePinch=M,this.SelectChartDrawPicture=null}}},this.OnTouchMove=function(s){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var o=this.GetToucheData(s,this.IsForceLandscape);if(this.IsPhoneDragging(s)){var h=this.MouseDrag;if(h==null)this.IsForceLandscape&&(y=r.getBoundingClientRect().width-o[0].clientY),this.ChartDrawOption.IsLockScreen||this.MoveCorssCursor({X:o[0].clientX,Y:o[0].clientY},s);else{var l=this.GetMoveAngle(h.LastMove,{X:o[0].clientX,Y:o[0].clientY}),u=Math.abs(h.LastMove.X-o[0].clientX),f=Math.abs(h.LastMove.Y-o[0].clientY);u=parseInt(u);var C=this.DragMode==be.CLICK_TOUCH_MODE_ID&&this.TouchStatus.CorssCursorShow==!0;if(this.VerticalDrag&&(this.VerticalDrag.IsDrag===!0?C=!1:C=!0),this.EnableClickModel&&(this.ClickModel.IsShowCorssCursor===!0?C=!0:C=!1),this.CurrentChartDrawPicture){var D=this.CurrentChartDrawPicture;if(D.Status==1||D.Status==2){if(u<5&&f<5)return;this.SetChartDrawPictureSecondPoint(o[0].clientX,o[0].clientY,!0)&&this.DrawDynamicInfo()}else if(D.Status==3)this.SetChartDrawPictureThirdPoint(o[0].clientX,o[0].clientY,!0)&&this.DrawDynamicInfo();else if(D.Status==20){if(u<5&&f<5)return;this.MoveChartDrawPicture(o[0].clientX-h.LastMove.X,o[0].clientY-h.LastMove.Y,!0)&&this.DrawDynamicInfo()}h.LastMove.X=o[0].clientX,h.LastMove.Y=o[0].clientY}else if(C)this.MouseDrag,this.MouseDrag=null,this.MoveCorssCursor(h.Click,s);else if(this.DragMode==1||C==!1){if((f>0&&u<=3||l<=this.TouchMoveMinAngle)&&this.EnableScrollUpDown==!0){this.StopDragTimer();return}if(u<5||l<=this.TouchMoveMinAngle){this.PreventTouchEvent(s);return}if(this.EnableVerticalDrag&&(!this.VerticalDrag||!this.VerticalDrag.IsDrag))return;var v=!0;h.LastMove.X<o[0].clientX&&(v=!1);var S=this.GetMoveOneStepWidth();if(u<S)return;this.DataMove(u,v)?(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw(),this.OnKLinePageChange("OnTouchMove")):this.DragDownloadData&&this.DragDownloadData(),h.LastMove.X=o[0].clientX,h.LastMove.Y=o[0].clientY}}this.PhoneTouchInfo&&(this.PhoneTouchInfo.End.X=o[0].clientX,this.PhoneTouchInfo.End.Y=o[0].clientY)}else if(this.IsPhonePinching(s)){if(this.DragMode==be.DISABLE_DRAG_ID)return;this.PreventTouchEvent(s);var T=this.PhonePinch;if(!T||this.EnableZoomUpDown&&this.EnableZoomUpDown.Touch===!1)return;var I=Math.abs(o[0].pageY-o[1].pageY),F=Math.abs(T.Last.Y-T.Last.Y2),E=I-F,M=Math.abs(o[0].pageX-o[1].pageX),O=Math.abs(T.Last.X-T.Last.X2),R=M-O,b=this.ZoomStepPixel;if(Math.abs(E)<b&&Math.abs(R)<b)return;var p=E;if(Math.abs(E)<b&&(p=R),p>0){var G={IsLockRight:this.IsZoomLockRight};if(G.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomUp(G))return;this.CursorIndex=G.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.StopDragTimer()}else{var G={IsLockRight:this.IsZoomLockRight};if(G.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomDown(G))return;this.CursorIndex=G.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.StopDragTimer()}T.Last={X:o[0].pageX,Y:o[0].pageY,X2:o[1].pageX,Y2:o[1].pageY}}this.PreventTouchEvent(s)}},this.OnTouchEnd=function(s){if(X.Chart.Log("[KLineChartContainer:OnTouchEnd]",s),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var o=!0;if(this.CurrentChartDrawPicture){var h=this.CurrentChartDrawPicture;h.Status==2||h.Status==1||h.Status==3?(h.PointStatus=h.Status,this.FinishChartDrawPicturePoint()?this.DrawDynamicInfo():o=!1):h.Status==20&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}if(this.EnableZoomIndexWindow){var l=Date.now();this.PhoneDBClick.AddTouchEnd(l),this.PhoneDBClick.IsVaildDBClick()&&(this.OnTouchDBClick(this.PhoneDBClick.Start),this.PhoneDBClick.Clear())}this.IsOnTouch=!1,this.VerticalDrag=null,o===!0&&(this.CurrentChartDrawPicture=null),this.StopDragTimer(),this.TouchEvent({EventID:et.ON_PHONE_TOUCH,FunctionName:"OnTouchEnd"},s),this.OnTouchFinished(),this.TouchDrawCount=0}},this.OnTouchDBClick=function(s){var o=this.PointAbsoluteToRelative(s[0].X,s[0].Y,!0),h=o.X,l=o.Y;X.Chart.Log("[KLineChartContainer:OnTouchDBClick] Phone dbclick absolute ["+h+","+l+"], soruce ["+s[0].X+","+s[0].Y+"]");var u=this.Frame.PtInFrame(h,l);if(X.Chart.Log("[KLineChartContainer::OnTouchDBClick] frameId",u),u>=this.Frame.ZoomStartWindowIndex&&this.ZoomIndexWindow(u,{X:h,Y:l}))return this.Frame.SetSizeChage(!0),this.Draw(),!0},this.TouchEvent=function(s,o){var h=s.EventID,l=this.GetEventCallback(h);if(!l||!l.Callback)return!1;var u=this.PhoneTouchInfo;if(!u||!u.Start||!u.End)return!1;var f=V(),C=u.End.X/f,D=u.End.Y/f,v=u.End.X-this.UIElement.getBoundingClientRect().left*f,S=u.End.Y-this.UIElement.getBoundingClientRect().top*f,T={X:C,Y:D,FrameID:-1,FunctionName:s.FunctionName,Drag:{Start:{X:u.Start.X/f,Y:u.Start.Y/f},End:{X:u.End.X/f,Y:u.End.Y/f}}},I=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),I=this.Canvas.isPointInPath(v,S),I)if(this.Frame&&this.Frame.IsHScreen){var F={},E=this.Frame.GetYData(v,F);if(c.IsNumber(F.FrameID)&&F.FrameID>=0){var M=this.Frame.GetXData(S);T.FrameID=F.FrameID,T.Data={X:M,Y:E}}}else{var F={},E=this.Frame.GetYData(S,F);if(c.IsNumber(F.FrameID)&&F.FrameID>=0){var M=this.Frame.GetXData(v);T.FrameID=F.FrameID,T.Data={X:M,Y:E}}}return l.Callback(l,T,this),!0},this.MoveCorssCursor=function(s,o){var h=V(),l=s.X-this.UIElement.getBoundingClientRect().left*h,u=s.Y-this.UIElement.getBoundingClientRect().top*h;this.DragMode==be.CLICK_TOUCH_MODE_ID&&(this.TouchStatus.CorssCursorShow=!0),this.OnMouseMove(l,u,o,!0)},this.DrawEmpty=function(){this.UIElement.width<=0||this.UIElement.height<=0||(this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.Frame&&(this.Frame.ScreenImageData=null,this.Frame.Draw()))},this.PtInChart=function(s,o){for(var h=null,l=0;l<this.ChartPaint.length;++l){var u=this.ChartPaint[l];if(u.PtInChart&&!u.IsHideScriptIndex()&&(h=u.PtInChart(s,o),h))return h}for(var l=0;l<this.OverlayChartPaint.length;++l){var u=this.OverlayChartPaint[l];if(u.PtInChart&&(h=u.PtInChart(s,o),h))return h}return this.Frame.PtInOveralyChart&&(h=this.Frame.PtInOveralyChart(s,o),h)?h:null},this.DrawSelectedStatus=function(){if(!(!this.SelectedChart.MoveOn.Identify&&!this.SelectedChart.Selected.Identify)){for(var s=0;s<this.ChartPaint.length;++s){var o=this.ChartPaint[s];o.Identify&&(o.Identify!=this.SelectedChart.MoveOn.Identify&&o.Identify!=this.SelectedChart.Selected.Identify||o.DrawSelectedStatus&&o.DrawSelectedStatus())}for(var s=0;s<this.OverlayChartPaint.length;++s){var o=this.OverlayChartPaint[s];o.Identify&&(o.Identify!=this.SelectedChart.MoveOn.Identify&&o.Identify!=this.SelectedChart.Selected.Identify||o.DrawSelectedStatus&&o.DrawSelectedStatus())}for(var s=0;s<this.OverlayChartPaint.length;++s){var o=this.OverlayChartPaint[s];o.Identify&&(o.Identify!=this.SelectedChart.MoveOn.Identify&&o.Identify!=this.SelectedChart.Selected.Identify||o.DrawSelectedStatus&&o.DrawSelectedStatus())}this.Frame.DrawOveralySelectedStatus&&this.Frame.DrawOveralySelectedStatus(this.SelectedChart)}},this.SetCanvas=function(s){if(this.Frame)for(var o=this.Frame.SubFrame,h=0;h<o.length;++h){var l=o[h];l.Frame.Canvas=s;for(var u=0;u<l.OverlayIndex.length;++u){var f=l.OverlayIndex[u];f.Frame.Canvas=s;for(var C=0;C<f.ChartPaint.length;++C){var D=f.ChartPaint[C];D.Canvas=s}}}for(var h=0;h<this.ChartDrawPicture.length;++h){var l=this.ChartDrawPicture[h];l.Canvas=s}for(var h=0;h<this.ChartPaint.length;++h){var l=this.ChartPaint[h];l.Canvas=s}for(var h=0;h<this.ChartPaintEx.length;++h){var l=this.ChartPaintEx[h];l.Canvas=s}for(var h=0;h<this.OverlayChartPaint.length;++h){var l=this.OverlayChartPaint[h];l.Canvas=s}for(var h=0;h<this.ExtendChartPaint.length;++h){var l=this.ExtendChartPaint[h];l.Canvas=s}},this.Draw=function(){var s=this;if(this.ChartCorssCursor&&(this.ChartCorssCursor.Status=0),!(this.UIElement.width<=0||this.UIElement.height<=0)){this.StopDrawDynamicInfo(),this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.CacheCanvas&&this.CacheCanvas.clearRect(0,0,this.UIElement.width,this.UIElement.height);var o=V();if(this.Canvas.lineWidth=o,this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash){this.Frame.ClearCoordinateText(),this.Frame.Draw({IsEnableSplash:this.ChartSplashPaint.IsEnableSplash}),this.ChartSplashPaint.Draw();return}if(this.CacheCanvas&&this.SetCanvas(this.CacheCanvas),this.Frame.SetBeforeDrawXYCallback&&this.Frame.SetBeforeDrawXYCallback(function(M){s.BeforeDrawXYCoordinate(M)}),this.Frame.Draw(),this.Frame.DrawCustomVertical){var h=this.GetEventCallback(et.ON_CUSTOM_VERTICAL_DRAW);this.Frame.DrawCustomVertical(h)}this.Frame.CalculateLock();for(var l=0;l<this.ChartDrawPicture.length;++l){var u=this.ChartDrawPicture[l];u.IsDrawMain&&u.IsDrawMain()&&u.MainDraw()}for(var l=0;l<this.ChartPaint.length;++l){var u=this.ChartPaint[l];u.IsDrawFirst&&u.Draw()}this.Frame.DrawOveraly&&this.Frame.DrawOveraly(!0);for(var l=0;l<this.ChartPaint.length;++l){var u=this.ChartPaint[l];u.IsDrawFirst||u.Draw()}for(var l=0;l<this.ChartPaintEx.length;++l){var u=this.ChartPaintEx[l];u.Draw()}for(var l=0;l<this.OverlayChartPaint.length;++l){var u=this.OverlayChartPaint[l];u.Draw()}this.Frame.DrawOveraly&&this.Frame.DrawOveraly(!1);for(var l=0;l<this.ExtendChartPaint.length;++l){var u=this.ExtendChartPaint[l];u.IsCallbackDraw||u.DrawAfterPicture||!u.IsDynamic&&u.IsAnimation==!1&&u.Draw()}this.Frame.DrawInsideHorizontal&&this.Frame.DrawInsideHorizontal(),this.KLineIncreaseCustomHorizontal(),this.Frame.DrawCustomHorizontal&&this.Frame.DrawCustomHorizontal(),this.Frame.DrawEx&&this.Frame.DrawEx({Symbol:this.Symbol}),this.ChartInfoPaint&&this.ChartInfoPaint.Draw(),this.Frame.DrawLock(),this.Frame.DrawLogo(),this.CacheCanvas?(this.Canvas.drawImage(this.CacheElement,0,0),this.SetCanvas(this.Canvas)):this.Frame.Snapshot(),this.Frame.DrawToolbar&&this.Frame.DrawToolbar(this.LastMouseStatus),this.DrawSelectedStatus();var f=null;this.LastMouseStatus&&this.LastMouseStatus.MoveOnPoint&&(f=this.LastMouseStatus.MoveOnPoint);for(var l=0;l<this.ExtendChartPaint.length;++l){var u=this.ExtendChartPaint[l];u.IsCallbackDraw||u.DrawAfterPicture||u.IsDynamic&&u.DrawAfterTitle===!1&&(u.Draw(),u.DrawToolbar&&u.DrawToolbar(f))}for(var l=0;l<this.ChartDrawPicture.length;++l){var u=this.ChartDrawPicture[l];u.IsDrawFirst&&u.Draw()}this.DrawDrawPictureXYCoordinate();var C=null;if(this.LastPoint.X!=null||this.LastPoint.Y!=null){if(this.ChartCorssCursor){this.ChartCorssCursor.LastPoint=this.LastPoint,this.ChartCorssCursor.CursorIndex=this.CursorIndex;var D=!1;this.CorssCursorCanvas&&(this.ChartCorssCursor.Canvas=this.CorssCursorCanvas,this.ChartCorssCursor.Canvas.clearRect(0,0,this.CorssCursorElement.width,this.CorssCursorElement.height),D=!0);var v=this.PtInButton(this.LastPoint.X,this.LastPoint.Y);v||(this.DragMode==be.CLICK_TOUCH_MODE_ID?this.TouchStatus.CorssCursorShow==!0&&this.ChartCorssCursor.Draw():this.EnableClickModel?this.ClickModel.IsShowCorssCursor===!0&&this.ChartCorssCursor.Draw():!(this.CorssCursorTouchEnd===!0&&this.MouseDrag)&&!(this.CorssCursorTouchEnd==!0&&this.IsOnTouch==!1)&&this.ChartCorssCursor.Draw()),D&&(this.ChartCorssCursor.Canvas=this.Canvas)}C=this.Frame.PtInFrame(this.LastPoint.X,this.LastPoint.Y)}var S=this.GetDrawStatus();S.DrawName="Draw";for(var T=this.GetEventCallback(et.ON_TITLE_DRAW),I=this.GetEventCallback(et.ON_INDEXTITLE_DRAW),l=0;l<this.TitlePaint.length;++l){var u=this.TitlePaint[l];u.IsDynamic&&(u.CursorIndex=this.CursorIndex,u.LastPoint=this.LastPoint,u.ClassName=="DynamicChartTitlePainting"?u.OnDrawEvent=I:u.OnDrawEvent=T,u.OnDrawEvent&&(u.OnDrawEvent.FunctionName="Draw",u.OnDrawEvent.PointPosition=C),u.DrawStatus=S,u.Draw(f,this.LastMouseStatus))}for(var l=0;l<this.ExtendChartPaint.length;++l){var u=this.ExtendChartPaint[l];u.IsCallbackDraw||u.DrawAfterPicture||u.IsDynamic&&u.DrawAfterTitle===!0&&u.IsAnimation==!1&&u.Draw()}if(this.EnableAnimation)for(var l=0;l<this.ExtendChartPaint.length;++l){var u=this.ExtendChartPaint[l];u.IsAnimation===!0&&u.Draw()}for(var l=0;l<this.ChartDrawPicture.length;++l){var u=this.ChartDrawPicture[l];u.IsDrawFirst||u.IsDrawMain&&u.IsDrawMain()||u.Draw()}this.CurrentChartDrawPicture&&this.CurrentChartDrawPicture.Status!=10&&this.CurrentChartDrawPicture.Draw();for(var l=0;l<this.ExtendChartPaint.length;++l){var u=this.ExtendChartPaint[l];u.DrawAfterPicture&&u.Draw()}if(this.OffscreenToShowCanvas(),typeof this.UpdateScrollBar=="function"&&this.UpdateScrollBar(),this.mapEvent.has(et.CHART_STATUS)){var F=this.mapEvent.get(et.CHART_STATUS),E={};typeof this.GetChartStatus=="function"&&(E=this.GetChartStatus()),F.Callback(F,E,this)}++this.TouchDrawCount}},this.PtInButton=function(s,o){var h=this.Frame.PtInButtons(s,o);return h?{Name:"FrameButton",Button:h}:(h=this.PtInExtendChartButtons(s,o),h?{Name:"ExtendChartButton",Button:h}:(h=this.PtInDrawPictureButtons(s,o),h?{Name:"DrawPictureButton",Button:h}:(h=this.PtInTitleButtons(s,o),h?{Name:"TitleButton",Button:h}:null)))},this.DrawDrawPictureXYCoordinate=function(){var s=null;this.CurrentChartDrawPicture?s=this.CurrentChartDrawPicture:this.SelectChartDrawPicture&&(s=this.SelectChartDrawPicture);for(var o={Symbol:this.Symbol,Period:this.Period},h=0;h<this.ChartDrawPicture.length;++h){var l=this.ChartDrawPicture[h];l&&(this.IsDrawPictureXY&&s&&(s==l||s.Guid==l.Guid)&&this.Frame.DrawPictureCoordinate(s,o)||l.IsShowYCoordinate&&l.Frame&&l.Frame.DrawPicturePointYCoordinate(l,o))}},this.BeforeDrawXYCoordinate=function(s){for(var o=0;o<this.ExtendChartPaint.length;++o){var h=this.ExtendChartPaint[o];h.IsCallbackDraw&&(["KLineYAxisBGPaint","DepthMapPaint","BackgroundPaint","MinuteBackgroundPaint"].includes(h.ClassName)?h.FrameID==s.Identify&&h.Draw():Sn.IsCallbackDraw(h.ClassName)&&h.FrameID==s.Identify&&h.Draw())}},this.KLineIncreaseCustomHorizontal=function(){if(!(!this.Frame||!this.Frame.SubFrame)){var s=this.Frame.SubFrame[0].Frame;if(s){var o=fe(this.Symbol),h=!1;s.YSplitOperator&&s.YSplitOperator.CoordinateType==1&&(h=!0);for(var l=!1,u=0;u<s.CustomHorizontalInfo.length;++u){var f=s.CustomHorizontalInfo[u];if(f.Type==4&&(l=!0),h&&f.Type==3||f.Type==2){var C=this.ChartPaint[0];if(!C)continue;var D=C.Data;if(!D||!c.IsNonEmptyArray(D.Data)||!c.IsNumber(C.DrawKRange.Start)||!c.IsNumber(C.DrawKRange.End))continue;var v=D.Data[C.DrawKRange.Start],S=D.Data[C.DrawKRange.End],T=(S.Close-v.Close)/v.Close*100;f.Value=S.Close,f.Type==2?(f.Message[1]=S.Close.toFixed(o),S.Close>S.Open?f.LineColor=m.FrameLatestPrice.UpBarColor:S.Close<S.Open?f.LineColor=m.FrameLatestPrice.DownBarColor:f.LineColor=m.FrameLatestPrice.UnchagneBarColor):f.Message[1]=T.toFixed(2)+"%",this.Name&&(f.Title=this.Name)}}if(l){var I=s.CustomHorizontalInfo.filter(function(F,E,M){return F.Type!=4});s.CustomHorizontalInfo=I}for(var u=0;u<this.OverlayChartPaint.length;++u){var C=this.OverlayChartPaint[u];if(C&&C.YInfoType==4){var D=C.Data;if(!(!D||!c.IsNonEmptyArray(D.Data))&&!(!c.IsNumber(C.DrawKRange.Start)||!c.IsNumber(C.DrawKRange.End))){var v=D.Data[C.DrawKRange.Start],S=D.Data[C.DrawKRange.End],T=(S.Close-v.Close)/v.Close*100,f=new Ht;f.Value=S.Close/C.ShowRange.FirstOverlayOpen*C.ShowRange.FirstOpen,f.Message[1]=T.toFixed(2)+"%",f.LineType=-1,f.Type=C.YInfoType,f.LineColor=C.Color,f.TextColor=m.FrameLatestPrice.OverlayTextColor,C.Title&&(f.Title=C.Title),s.CustomHorizontalInfo.push(f)}}}}}},this.OffscreenToShowCanvas=function(){this.ShowCanvas&&(this.ShowCanvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.ShowCanvas.drawImage(this.OffscreenCanvasElement,0,0))},this.GetDrawStatus=function(){var s={Point:{X:this.LastPoint.X,Y:this.LastPoint.Y},IsOnTouch:this.IsOnTouch,CorssCursorTouchEnd:this.CorssCursorTouchEnd,IsTitleShowLatestData:this.IsTitleShowLatestData,IsMinuteChart:this.ClassName=="MinuteChartContainer"||this.ClassName=="MinuteChartHScreenContainer"};return s.FrameID=this.Frame.PtInFrame(this.LastPoint.X,this.LastPoint.Y),s},this.DrawDynamicInfo=function(s){if(this.LastMouseStatus.MouseOnToolbar=null,!(this.Frame.ScreenImageData==null&&!this.CacheCanvas)){var o=!1;if(this.ChartCorssCursor&&(this.ChartCorssCursor.PointX!=null||this.ChartCorssCursor.PointY!=null)&&(o=!0),o=!0,o==!1)for(var h=0;h<this.ExtendChartPaint.length;++h){var l=this.ExtendChartPaint[h];if(!l.IsCallbackDraw&&l.IsDynamic&&l.IsEraseBG){o=!0;break}}o&&(this.Frame.ScreenImageData?this.Canvas.putImageData(this.Frame.ScreenImageData,0,0):this.CacheCanvas&&(this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.Canvas.drawImage(this.CacheElement,0,0))),this.Frame.DrawToolbar&&this.Frame.DrawToolbar(this.LastMouseStatus),this.DrawSelectedStatus();var u=null;this.LastMouseStatus&&this.LastMouseStatus.MoveOnPoint&&(u=this.LastMouseStatus.MoveOnPoint);for(var h=0;h<this.ExtendChartPaint.length;++h){var l=this.ExtendChartPaint[h];l.IsCallbackDraw||l.DrawAfterPicture||l.IsDynamic&&l.DrawAfterTitle===!1&&l.IsAnimation==!1&&(l.Draw(),l.DrawToolbar&&l.DrawToolbar(u,this.LastMouseStatus))}for(var h=0;h<this.ChartDrawPicture.length;++h){var l=this.ChartDrawPicture[h];l.IsDrawFirst&&l.Draw()}if(this.DrawDrawPictureXYCoordinate(),this.ChartCorssCursor){this.ChartCorssCursor.LastPoint=this.LastPoint,this.ChartCorssCursor.CursorIndex=this.CursorIndex;var f=!1;this.CorssCursorCanvas&&(this.ChartCorssCursor.Canvas=this.CorssCursorCanvas,this.ChartCorssCursor.Canvas.clearRect(0,0,this.CorssCursorElement.width,this.CorssCursorElement.height),f=!0),s&&s.Corss==!1||(this.DragMode==be.CLICK_TOUCH_MODE_ID?this.TouchStatus.CorssCursorShow==!0&&this.ChartCorssCursor.Draw():this.IsOnTouch===!1&&this.CurrentChartDrawPicture&&this.CurrentChartDrawPicture.IsShowCorssCursor===!0?this.ChartCorssCursor.Draw():!(this.IsOnTouch===!1&&this.CorssCursorTouchEnd===!0)&&!this.CurrentChartDrawPicture?this.ChartCorssCursor.Draw():this.IsOnTouch===!0&&this.CurrentChartDrawPicture&&this.EnableShowCorssCursor&&this.EnableShowCorssCursor.DrawPicture==!0&&this.ChartCorssCursor.Draw()),f&&(this.ChartCorssCursor.Canvas=this.Canvas)}var C=null;s&&s.Point&&(s.ParentFunction=="OnMouseMove"||s.ParentFunction=="MoveCorssCursorIndex")&&(C=this.Frame.PtInFrame(s.Point.X,s.Point.Y));var D=this.GetDrawStatus();D.DrawName="DrawDynamicInfo";for(var h=0;h<this.TitlePaint.length;++h){var l=this.TitlePaint[h];l.IsDynamic&&(l.CursorIndex=this.CursorIndex,l.LastPoint=this.LastPoint,l.OnDrawEvent&&(l.OnDrawEvent.FunctionName="DrawDynamicInfo",l.OnDrawEvent.PointPosition=C),l.DrawStatus=D,l.ClassName=="DynamicMinuteTitlePainting"&&(s&&c.IsNumber(s.ClientPos)&&s.Point?l.PointInfo={ClientPos:s.ClientPos,Point:{X:s.Point.X,Y:s.Point.Y}}:l.PointInfo=null),l.Draw(u,this.LastMouseStatus))}for(var h=0;h<this.ExtendChartPaint.length;++h){var l=this.ExtendChartPaint[h];if(!l.IsCallbackDraw&&!l.DrawAfterPicture){if(l.ClassName=="KLineTooltipPaint"&&s){if(s.Tooltip==!1)continue;s.Point&&(l.LatestPoint=s.Point)}else l.ClassName=="MinuteTooltipPaint"&&s&&s.Point&&(l.LatestPoint=s.Point);l.IsDynamic&&l.DrawAfterTitle===!0&&l.Draw()}}if(this.EnableAnimation)for(var h=0;h<this.ExtendChartPaint.length;++h){var l=this.ExtendChartPaint[h];l.IsAnimation===!0&&l.Draw()}for(var h=0;h<this.ChartDrawPicture.length;++h){var l=this.ChartDrawPicture[h];l.IsDrawFirst||l.IsDrawMain&&l.IsDrawMain()||l.Draw(u,this.LastMouseStatus)}this.CurrentChartDrawPicture&&this.CurrentChartDrawPicture.Status!=10&&this.CurrentChartDrawPicture.Draw();for(var h=0;h<this.ExtendChartPaint.length;++h){var l=this.ExtendChartPaint[h];l.DrawAfterPicture&&l.Draw()}if(this.LastMouseStatus.MouseOnToolbar){var v=this.LastMouseStatus.MouseOnToolbar.Frame;v&&v.DrawToolbarTooltip&&v.DrawToolbarTooltip(this.LastMouseStatus.MouseOnToolbar)}this.OffscreenToShowCanvas(),++this.TouchDrawCount}},this.DrawAnimation=function(){if(this.EnableAnimation){if(this.Frame.ScreenImageData&&!this.IsOnTouch){for(var s=0;s<this.ExtendChartPaint.length;++s){var o=this.ExtendChartPaint[s];o.IsAnimation===!0&&(o.IsMoveStep=!0)}this.DrawDynamicInfo()}var h=this;window.requestAnimationFrame(function(){h.DrawAnimation()})}},this.StartAnimation=function(s){for(var o=!1,h=null,l=0;l<this.ExtendChartPaint.length;++l){var u=this.ExtendChartPaint[l];if(u.ClassName==="BarragePaint"){o=!0,h=u.BarrageList;break}}if(!o){var f=new Ad;f.Canvas=this.Canvas,f.ChartBorder=this.Frame.ChartBorder,f.ChartFrame=this.Frame,f.HQChart=this,f.SetOption(s),this.ExtendChartPaint.push(f),h=f.BarrageList}this.EnableAnimation=!0;var C=this;return window.requestAnimationFrame(function(){C.DrawAnimation()}),h},this.StopAnimation=function(){this.EnableAnimation=!1,this.DrawDynamicInfo()},this.GetChartTooltipData=function(s,o,h){var l=new zr;if(this.ChartInfoPaint&&this.ChartInfoPaint.GetTooltipData(s,o,l)||this.PtInChartPaintTooltip(s,o,l))return l;if(c.IsNonEmptyArray(this.Frame.SubFrame))for(var u=0;u<this.Frame.SubFrame.length;++u)for(var f=this.Frame.SubFrame[u],C=0;C<f.OverlayIndex.length;++C)for(var D=f.OverlayIndex[C],v=0;v<D.ChartPaint.length;++v){var S=D.ChartPaint[v];if(S.GetTooltipData(s,o,l))return l}return this.PtInOverlayChartPaintTooltip(s,o,l)?l:null},this.PtInExtendChartButtons=function(s,o){for(var h=0;h<this.ExtendChartPaint.length;++h){var l=this.ExtendChartPaint[h];if(l.PtInButtons){var u=l.PtInButtons(s,o);if(u)return u.Chart=l,u}}return null},this.ClickExtendChartButton=function(s,o){var h=this.GetEventCallback(et.ON_CLICK_EXTENDCHART_BUTTON);if(h&&h.Callback){var l={Info:s,PreventDefault:!1};if(h.Callback(h,l,this),l.PreventDefault)return}},this.PtInDrawPictureButtons=function(s,o){for(var h=0;h<this.ChartDrawPicture.length;++h){var l=this.ChartDrawPicture[h];if(l.PtInButtons){var u=l.PtInButtons(s,o);if(u)return u.Chart=l,u}}return null},this.ClickDrawPictureButton=function(s,o){var h=this.GetEventCallback(et.ON_CLICK_DRAWPICTURE_BUTTON);if(h&&h.Callback){var l={Info:s,PreventDefault:!1};if(h.Callback(h,l,this),l.PreventDefault)return}s.ID==xt.DRAW_PICTURE_DELETE?(X.Chart.Log(s,"ClickDrawPictureButton"),this.ClearChartDrawPicture(s.Chart)):s.ID==xt.DRAW_PICTURE_SETTING},this.PtInTitleButtons=function(s,o){for(var h=0;h<this.TitlePaint.length;++h){var l=this.TitlePaint[h];if(l.PtInButtons){var u=l.PtInButtons(s,o);if(u)return u.Chart=l,u}}return null},this.OnMouseMove=function(s,o,h,l){var u=this;this.StopDrawDynamicInfo(),this.LastPoint.X=s,this.LastPoint.Y=o;var f=null,C=null,D=this.Frame.PtInFrame(s,o);if(c.IsNumber(D)&&D>=0&&(this.CursorIndex=this.Frame.GetXData(s)),this.EnableBorderDrag&&this.Frame&&!this.CurrentChartDrawPicture){var v=this.Frame.PtInFrameBorder(s,o);v&&v.Index>=0&&(f={Cursor:"n-resize",Name:"DragBorder"},X.Chart.Log("[JSChartContainer::OnMouseMove] drag border ",v))}if(this.EnableYDrag&&this.Frame&&!this.CurrentChartDrawPicture){var S=this.TryYDrag(s,o);S&&(f={Cursor:S.Position==0?"n-resize":"row-resize",Name:"DragY"},X.Chart.Log("[JSChartContainer::OnMouseMove] drag y ",S))}if(this.CurrentChartDrawPicture||(C=this.PtInButton(s,o),C&&(f={Cursor:"pointer",Name:C.Name},X.Chart.Log("[JSChartContainer::OnMouseMove] frame button ",C))),this.ChartCorssCursor){var T=this.ChartCorssCursor.PtInButton(s,o);T&&(f={Cursor:"pointer",Name:"CorssCursorButton"},X.Chart.Log("[JSChartContainer::OnMouseMove] cross cursor button ",T))}if(this.ClassName=="KLineChartContainer"&&this.Frame.PtInFrameBottom(s,o)&&(f={Cursor:"ew-resize",Name:"FrameButtom"},X.Chart.Log("[JSChartContainer::OnMouseMove] frame bottom ")),this.SelectedChart.EnableMoveOn&&this.PtInChart&&!this.CurrentChartDrawPicture){var I=this.PtInChart(s,o);I&&I.Identify?(f={Cursor:"pointer",Name:"PtInChart"},this.SelectedChart.MoveOn.Identify=I.Identify,this.SelectedChart.MoveOn.Identify=null,X.Chart.Log("[JSChartContainer::OnMouseMove] Point in chart ",I)):this.SelectedChart.MoveOn.Identify=null}else this.SelectedChart.MoveOn.Identify=null;var F=this.GetRectSelectPaint();if(F&&F.GetPointCount()>0){var E=F.PtInPaint(s,o);E&&(E.Type==4?f={Cursor:"pointer",Name:"DragRectSelect"}:f={Cursor:"ew-resize",Name:"DragRectSelect"},X.Chart.Log("[JSChartContainer::OnMouseMove] drag rect select ",E))}var M=!1;if(this.CurrentChartDrawPicture){var O=this.Frame.PtInChartFrame(s,o);if(this.CurrentChartDrawPicture.Status!=20){var R=!1;c.IsNumber(this.CurrentChartDrawPicture.LimitFrameID)?O>=0&&O==this.CurrentChartDrawPicture.LimitFrameID&&(R=!0):O>=0&&(R=!0),f={Cursor:R?"crosshair":"not-allowed",Name:"CurrentChartDrawPicture"}}this.CurrentChartDrawPicture.SetLastPoint&&this.CurrentChartDrawPicture.SetLastPoint({X:s,Y:o}),M=!0}else{var b={};b.X=s,b.Y=o,this.GetChartDrawPictureByPoint(b)&&b.ChartDrawPicture&&b.ChartDrawPicture.EnableMove==!0?(b.PointIndex===100?b.Cursor?this.UIElement.style.cursor=b.Cursor:this.UIElement.style.cursor="move":b.Cursor?this.UIElement.style.cursor=b.Cursor:this.UIElement.style.cursor="pointer",M=!0,this.MoveOnChartDrawPicture=b.ChartDrawPicture):this.MouseDrag||(this.UIElement.style.cursor="default")}var p=this.PtInClient(s,o),G={ParentFunction:"OnMouseMove",Point:{X:s,Y:o},IsPhone:l===!0,ClientPos:p};if((h&&(h.type=="mouseout"||h.type=="mouseleave")||C)&&(G.Corss=!1),this.SetCorssCursorIndex&&this.SetCorssCursorIndex(G),this.DrawDynamicInfoOption.Enable?this.DrawDynamicInfoOption.Timer=setTimeout(function(){u.DrawDynamicInfo(G)},this.DrawDynamicInfoOption.DelayTime):this.DrawDynamicInfo(G),f&&(this.UIElement.style.cursor=f.Cursor),this.IsShowTooltip&&M==!1){var Y=this.GetChartTooltipData(s,o);if(Y&&Y.Data){if(l===!0)var Q=h.touches[0],ht=Q.clientX-this.UIElement.getBoundingClientRect().left,Ct=Q.clientY-this.UIElement.getBoundingClientRect().top;else var ht=h.clientX-this.UIElement.getBoundingClientRect().left,Ct=h.clientY-this.UIElement.getBoundingClientRect().top;this.ShowTooltip(ht,Ct,Y)}else this.HideTooltip()}},this.OnKeyDown=function(s){var o=this;if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var h=s.keyCode?s.keyCode:s.which;switch(h){case 37:if(s.ctrlKey&&this.OnCustomKeyDown&&this.OnCustomKeyDown(h,s))break;if(this.CursorIndex<=.99999){if(!this.DataMoveLeft()){this.DragDownloadData&&this.DragDownloadData();break}this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("keydown")}else--this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo(),this.ShowTooltipByKeyDown();break;case 39:if(s.ctrlKey&&this.OnCustomKeyDown&&this.OnCustomKeyDown(h,s))break;var l=0;if(this.Frame.XPointCount?l=this.Frame.XPointCount:l=this.Frame.SubFrame[0].Frame.XPointCount,this.CursorIndex+1>=l){if(!this.DataMoveRight())break;this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("keydown")}else{var u=null;if(this.Frame.Data?u=this.Frame.Data:u=this.Frame.SubFrame[0].Frame.Data,!u||this.CursorIndex+u.DataOffset+1>=u.Data.length)break;++this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo(),this.ShowTooltipByKeyDown()}break;case 38:if(this.EnableZoomUpDown&&this.EnableZoomUpDown.Keyboard===!1)break;var f={ZoomType:this.ZoomType,IsLockRight:this.IsZoomLockRight};if(f.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomUp(f))break;this.CursorIndex=f.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("keydown");break;case 40:if(this.EnableZoomUpDown&&this.EnableZoomUpDown.Keyboard===!1)break;var f={ZoomType:this.ZoomType,IsLockRight:this.IsZoomLockRight};if(f.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomDown(f,{ZoomDownloadDataCallback:function(S){o.ZoomDownloadData(S)}}))break;this.CursorIndex=f.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("keydown");break;case 46:if(this.SelectChartDrawPicture){var C=this.SelectChartDrawPicture;X.Chart.Log("[JSChartContainer::OnKeyDown] delete draw picture."),this.SelectChartDrawPicture=null,this.ChartPictureMenu&&this.ChartPictureMenu.Hide(),this.ClearChartDrawPicture(C)}else if(this.SelectedChart&&this.SelectedChart.Selected.Identify){var D=this.GetSelectedChartInfo(this.SelectedChart.Selected);D&&(D.Type==Ge.OVERLAY_INDEX?this.DeleteOverlayWindowsIndex(D.IndexID):D.Type==Ge.OVERLAY_KLINE&&this.DeleteOverlaySymbol(D.Symbol))}break;case 32:this.OnMarkRectSelect(s);break;case 27:if(this.CurrentChartDrawPicture){var C=this.CurrentChartDrawPicture;C.Status!=20&&(this.CurrentChartDrawPicture=null)}break;default:return}s.preventDefault?s.preventDefault():s.returnValue=!1}},this.OnDoubleClick=function(s,o,h){},this.ZoomIndexWindow=function(s,o){return s<0||s>=this.Frame.SubFrame.length?!1:this.Frame.ZoomIndexWindow(s,o)},this.ShowIndexTitleOnly=function(s,o){return s<0||s>=this.Frame.SubFrame.length?!1:this.Frame.ShowIndexTitleOnly(s,o)},this.RemoveMinSizeWindows=function(){if(this.Frame.ZoomWindowsInfo){for(var s=[],o=[],h=0;h<this.Frame.SubFrame.length;++h){var l=this.Frame.SubFrame[h];l.Frame.ClearToolbar(),l.Frame.IsMinSize?s.push(h):o.push(h)}if(this.Frame.ZoomWindowsInfo=null,!(s.length<=0)){for(var h=0;h<s.length;++h)this.DeleteIndexPaint(s[h]);for(var u=[],f=[],C=[this.TitlePaint[0]],h=0;h<o.length;++h){var D=o[h];u[h]=this.Frame.SubFrame[D],f[h]=this.WindowIndex[D],C[h+1]=this.TitlePaint[D+1]}this.Frame.SubFrame=u,this.WindowIndex=f,this.TitlePaint=C;for(var h=0;h<this.Frame.SubFrame.length;++h){var l=this.Frame.SubFrame[h].Frame;h==this.Frame.SubFrame.length-1?l.XSplitOperator.ShowText=!0:l.XSplitOperator.ShowText=!1,l.Identify=h}if(c.IsNonEmptyArray(this.ChartDrawPicture)){for(var v=[],h=0;h<this.ChartDrawPicture.length;++h)for(var l=this.ChartDrawPicture[h],S=0;S<this.Frame.SubFrame.length;++S)if(l.Frame==this.Frame.SubFrame[S].Frame){v.push(l);break}this.ChartDrawPicture=v}}}},this.PtInClient=function(s,o){if(this.Canvas.beginPath(),this.Frame.IsHScreen===!0){var h=this.Frame.ChartBorder.GetHScreenBorder();if(h.DayBorder){for(var l=h.Right-h.Left,u=0;u<h.DayBorder.length;++u){var f=h.DayBorder[u];if(this.Canvas.beginPath(),this.Canvas.rect(h.Left,f.TopEx,l,f.BottomEx-f.TopEx),this.Canvas.isPointInPath(s,o))return 1;if(this.Canvas.beginPath(),this.Canvas.rect(h.Left,f.Top,l,f.TopEx-f.Top),this.Canvas.isPointInPath(s,o))return 200+parseInt(u);if(this.Canvas.beginPath(),this.Canvas.rect(h.Left,f.BottomEx,l,f.Bottom-f.BottomEx),this.Canvas.isPointInPath(s,o))return 300+parseInt(u)}return-1}this.Canvas.rect(h.Left,h.TopEx,h.Right-h.Left,h.BottomEx-h.TopEx)}else{var h=this.Frame.ChartBorder.GetBorder();if(h.DayBorder){for(var u=0;u<h.DayBorder.length;++u){var f=h.DayBorder[u];if(this.Canvas.beginPath(),this.Canvas.rect(f.LeftEx,h.TopEx,f.RightEx-f.LeftEx,h.BottomEx-h.TopEx),this.Canvas.isPointInPath(s,o))return 1;if(this.Canvas.beginPath(),this.Canvas.rect(f.Left,h.TopEx,f.LeftEx-f.Left,h.BottomEx-h.TopEx),this.Canvas.isPointInPath(s,o))return 200+parseInt(u);if(this.Canvas.beginPath(),this.Canvas.rect(f.RightEx,h.TopEx,f.Right-f.RightEx,h.BottomEx-h.TopEx),this.Canvas.isPointInPath(s,o))return 300+parseInt(u)}return-1}this.Canvas.rect(h.LeftEx,h.Top,h.RightEx-h.LeftEx,h.Bottom-h.Top)}return this.Canvas.isPointInPath(s,o)?1:this.Frame.ChartBorder.LeftExtendWidth>10&&(this.Canvas.beginPath(),this.Frame.IsHScreen===!0?this.Canvas.rect(h.Left,h.Top,h.Right-h.Left,h.TopEx-h.Top):this.Canvas.rect(h.Left,h.Top,h.LeftEx-h.Left,h.Bottom-h.Top),this.Canvas.isPointInPath(s,o))?2:this.Frame.ChartBorder.RightExtendWidth>10&&(this.Canvas.beginPath(),this.Frame.IsHScreen===!0?this.Canvas.rect(h.Left,h.BottomEx,h.Right-h.Left,h.Bottom-h.BottomEx):this.Canvas.rect(h.RightEx,h.Top,h.Right-h.RightEx,h.Bottom-h.Top),this.Canvas.isPointInPath(s,o))?3:-1},this.OnMoveFromeBorder=function(s,o){this.Frame&&this.Frame.OnMoveFromeBorder(s,o)&&(this.Frame.SetFrameBorderSizeChange(),this.Frame.ReDrawToolbar(),this.Draw())},this.OnZoomUpDownFrameY=function(s,o){this.Frame&&this.Frame.OnZoomUpDownFrameY(s,o)&&(this.Frame.SetSizeChage(!0),this.Draw())},this.OnUpDonwFrameY=function(s,o){return!this.Frame||!this.Frame.OnUpDonwFrameY(s,o)?!1:(this.Frame.SetSizeChage(!0),!0)},this.CancelZoomUpDownFrameY=function(s){this.Frame&&this.Frame.CancelZoomUpDownFrameY(s)&&(this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw())},this.IsKLineContainer=function(){return this.ClassName=="KLineChartContainer"||this.ClassName=="KLineChartHScreenContainer"||this.ClassName=="KLineTrainChartContainer"||this.ClassName=="CustomKLineChartContainer"},this.UpdatePointByCursorIndex=function(s){var o={X:null,Y:null};o.X=this.Frame.GetXFromIndex(this.CursorIndex);var h=Math.abs(this.CursorIndex-.5);this.IsKLineContainer()&&(h=this.CursorIndex);var l=this.Frame.Data;if(l.DataOffset+h<l.Data.length){var u=l.Data[l.DataOffset+h].Close;o.Y=this.Frame.GetYFromData(u)}if(s==1&&this.ChartCorssCursor){if(this.ChartCorssCursor.Status!=1){this.LastPoint.X=this.Frame.GetXFromIndex(this.CursorIndex);var h=Math.abs(this.CursorIndex-.5);h=parseInt(h.toFixed(0)),this.IsKLineContainer()&&(h=this.CursorIndex),this.LastPoint.Y=null}}else s==2&&this.ChartCorssCursor?(this.LastPoint.Y=null,this.LastPoint.X=null):(this.LastPoint.X=o.X,this.LastPoint.Y=o.Y)},this.ShowTooltipByKeyDown=function(){var s=Math.abs(this.CursorIndex-.5);s=parseInt(s.toFixed(0)),(this.ClassName=="KLineChartContainer"||this.ClassName=="KLineTrainChartContainer")&&(s=this.CursorIndex);var o=this.Frame.Data,h=new zr;h.Data=o.Data[o.DataOffset+s],h.ChartPaint=this.ChartPaint[0];var l=V();l===0&&(l=1),this.ShowTooltip(this.LastPoint.X/l,this.LastPoint.Y/l,h)},this.ShowTooltip=function(s,o,h){var l=this;if(this.IsShowTooltip){var u=V(),f=15/u;if(h.Type===0){tn();var C=s,D=o,v=ze.Create("HistoryDataStringFormat");if(v.Value=h,v.Symbol=this.Symbol,v.LanguageID=this.LanguageID,v.GetEventCallback=function(I){return l.GetEventCallback(I)},!v.Operator())return;var S=v.LineCount*25;v.Height>0&&(S=v.Height);var T=v.Width;this.Tooltip.style.width=T+"px",this.Tooltip.style.height=S+"px",this.Tooltip.style.position="absolute",C+T>this.UIElement.getBoundingClientRect().width?this.Tooltip.style.left=C-T+"px":this.Tooltip.style.left=C+"px",D+f+S>this.UIElement.getBoundingClientRect().height-5?this.Tooltip.style.top=D-S+"px":this.Tooltip.style.top=D+f+"px",this.Tooltip.className="jschart-tooltip",this.Tooltip.innerHTML=v.Text,this.Tooltip.style.display="block"}else if(h.Type===1){tn();var C=s,D=o,v=ze.Create("KLineInfoDataStringFormat");if(v.Value=h,v.Symbol=this.Symbol,v.LanguageID=this.LanguageID,!v.Operator())return;var T=v.Width;this.Tooltip.className="jchart-klineinfo-tooltip",this.Tooltip.style.position="absolute",C+T>this.UIElement.getBoundingClientRect().width?this.Tooltip.style.left=C-T+"px":this.Tooltip.style.left=C+"px",this.Tooltip.style.top=D+f+"px",this.Tooltip.style.width=T+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=v.Text,this.Tooltip.style.display="block"}else if(h.Type==2){var C=s,D=o,v=ze.Create("KLineTradeDataStringFormat");if(v.Value=h,v.Symbol=this.Symbol,v.LanguageID=this.LanguageID,!v.Operator())return;var T=v.Width;this.Tooltip.className="jchart-klinetrade-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=C+"px",this.Tooltip.style.top=D+f+"px",this.Tooltip.style.width=T+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=v.Text,this.Tooltip.style.display="block"}else if(h.Type==3){var C=s,D=o,v=ze.Create("MinuteInfoDataStringFormat");if(v.Value=h,v.Symbol=this.Symbol,v.LanguageID=this.LanguageID,!v.Operator())return;var T=v.Width;this.Tooltip.className="jchart-minuteinfo-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=C+"px",this.Tooltip.style.top=D+f+"px",this.Tooltip.style.width=T+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=v.Text,this.Tooltip.style.display="block"}else if(h.Type==4){var C=s,D=o,v=ze.Create("IconDataStringFormat");if(v.Value=h,v.Symbol=this.Symbol,v.LanguageID=this.LanguageID,!v.Operator())return;var T=v.Width;this.Tooltip.className="jchart-iconinfo-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=C+"px",this.Tooltip.style.top=D+f+"px",this.Tooltip.style.width=T+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=v.Text,this.Tooltip.style.display="block"}else if(h.Type==5){var C=s,D=o,v=ze.Create("ChartOXDataStringFormat");if(v.Value=h,v.Symbol=this.Symbol,v.Period=this.Period,v.LanguageID=this.LanguageID,!v.Operator())return;var T=v.Width;this.Tooltip.className="jchart-chartox-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=C+"px",this.Tooltip.style.top=D+f+"px",this.Tooltip.style.width=T+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=v.Text,this.Tooltip.style.display="block"}else if(h.Type==6){var C=s,D=o,v=ze.Create("ScatterPlotDataStringFormat");if(v.Value=h,v.Symbol=this.Symbol,v.Period=this.Period,v.LanguageID=this.LanguageID,!v.Operator())return;var T=v.Width;this.Tooltip.className="jchart-charscatterplot-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=C+"px",this.Tooltip.style.top=D+f+"px",this.Tooltip.style.width=T+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=v.Text,this.Tooltip.style.display="block"}else if(h.Type==7){var C=s,D=o,v=ze.Create("ChartDrawSVGDataStringFormat");if(v.Value=h,v.Symbol=this.Symbol,v.Period=this.Period,v.LanguageID=this.LanguageID,!v.Operator())return;var T=v.Width;this.Tooltip.className="jchart-chartdrawsvg-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=C+"px",this.Tooltip.style.top=D+f+"px",this.Tooltip.style.width=T+"px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=v.Text,this.Tooltip.style.display="block"}}},this.HideTooltip=function(){this.Tooltip.style.display!="none"&&(this.Tooltip.style.display="none")},this.ShowSelectRect=function(s,o,h,l){var u=s,f=o,C=this.Frame.ChartBorder.GetBorder(),D=C.Right,v=C.Left;s>D&&(s=D),h>D&&(h=D),s<v&&(s=v),h<v&&(h=v),s>h&&(u=h),o>l&&(f=l);var S=Math.abs(s-h),T=Math.abs(o-l);this.SelectRect.style.width=S+"px",this.SelectRect.style.height=T+"px",this.SelectRect.style.position="absolute",this.SelectRect.style.left=u+"px",this.SelectRect.style.top=f+"px",this.SelectRect.style.display="block"},this.UpdateSelectRect=function(s,o){if(this.ChartPaint[0].Data){var h=this.GetRectSelectPaint();if(h){var l=this.ChartPaint[0].Data,u=l.Data[s],f=l.Data[o];X.Chart.Log("[JSChartContainer::UpdateSelectRect]",u,f),h.SetPoint(u,{Index:0,DataIndex:s}),h.SetPoint(f,{Index:1,DataIndex:o}),this.Draw()}}},this.HideSelectRect=function(){this.SelectRect.style.display="none"},this.ResetFrameXYSplit=function(){typeof this.Frame.ResetXYSplit=="function"&&this.Frame.ResetXYSplit()},this.UpdateFrameMaxMin=function(){for(var s=new Array,o=new Array,h=0;h<this.ChartPaint.length;++h){var l=this.ChartPaint[h];l.IsShow!=!1&&o.push(this.ChartPaint[h])}for(var h=0;h<this.OverlayChartPaint.length;++h)o.push(this.OverlayChartPaint[h]);for(var u=[],h=0;h<o.length;++h){var f=o[h];if(f.NotSupportMessage){u.push(f);continue}var C=f.GetMaxMin();if(!(C==null||C.Max==null||C.Min==null)){for(var D=null,v=0;v<s.length;++v)if(s[v].Frame==f.ChartFrame){D=s[v];break}D?(D.Range.Max<C.Max&&(D.Range.Max=C.Max),D.Range.Min>C.Min&&(D.Range.Min=C.Min)):(D={OverlayFrame:[]},D.Frame=f.ChartFrame,D.Range=C,s.push(D))}}for(var h=0;h<u.length;++h){for(var f=u[h],C={Max:10,Min:1},D=null,v=0;v<s.length;++v)if(s[v].Frame==f.ChartFrame){D=s[v];break}D||(D={OverlayFrame:[]},D.Frame=f.ChartFrame,D.Range=C,s.push(D))}for(var S=new Dt.default,h=0;h<s.length;++h){var l=s[h];S.set(l.Frame.Identify,l)}for(var h=0;h<this.Frame.SubFrame.length;++h)for(var T=this.Frame.SubFrame[h],v=0;v<T.OverlayIndex.length;++v){var I=T.OverlayIndex[v],F=I.Frame;if(F.IsShareY==!0&&F.MainFrame&&S.has(F.MainFrame.Identify)){var D=S.get(F.MainFrame.Identify);if(D&&(D.OverlayFrame.push(F),F.IsCalculateYMaxMin!==!1))for(var E=0;E<I.ChartPaint.length;++E){var f=I.ChartPaint[E],C=f.GetMaxMin();C==null||C.Max==null||C.Min==null||(D.Range.Max<C.Max&&(D.Range.Max=C.Max),D.Range.Min>C.Min&&(D.Range.Min=C.Min))}}}for(var h=0;h<s.length;++h){var l=s[h];if(!(!l.Frame||!l.Range)&&!(l.Range.Max==null||l.Range.Min==null)){l.Frame.YSpecificMaxMin?(l.Frame.HorizontalMax=l.Frame.YSpecificMaxMin.Max,l.Frame.HorizontalMin=l.Frame.YSpecificMaxMin.Min):(l.Frame.HorizontalMax=l.Range.Max,l.Frame.HorizontalMin=l.Range.Min),l.Frame.XYSplit=!0;for(var v in l.OverlayFrame)l.OverlayFrame[v].XYSplit=!0}}for(var h=0;h<this.Frame.SubFrame.length;++h)for(var T=this.Frame.SubFrame[h],v=0;v<T.OverlayIndex.length;++v){var I=T.OverlayIndex[v];I.Frame.IsShareY!==!0&&I.UpdateFrameMaxMin()}},this.DataMoveLeft=function(){var s=null;return this.Frame.Data?s=this.Frame.SubFrame[0].Frame.Data:s=this.Frame.Data,!s||s.DataOffset<=0?!1:(--s.DataOffset,!0)},this.DataMoveRight=function(){var s=null;if(this.Frame.Data?s=this.Frame.SubFrame[0].Frame.Data:s=this.Frame.Data,!s)return!1;var o=0;return this.Frame.XPointCount?o=this.Frame.XPointCount:o=this.Frame.SubFrame[0].Frame.XPointCount,!o||o+s.DataOffset>=s.Data.length?!1:(++s.DataOffset,!0)},this.UpdataDataoffset=function(){var s=null;if(this.Frame.Data?s=this.Frame.Data:s=this.Frame.SubFrame[0].Frame.Data,!!s){for(var o in this.ChartPaint){var h=this.ChartPaint[o];h.Data&&(h.Data.DataOffset=s.DataOffset)}for(var o in this.OverlayChartPaint){var h=this.OverlayChartPaint[o];h.Data&&(h.Data.DataOffset=s.DataOffset)}for(var o in this.Frame.SubFrame){var l=this.Frame.SubFrame[o];for(var u in l.OverlayIndex){var f=l.OverlayIndex[u];for(var C in f.ChartPaint){var h=f.ChartPaint[C];h.Data&&(h.Data.DataOffset=s.DataOffset)}}}}},this.GetMoveOneStepWidth=function(){if(c.IsPlusNumber(this.StepPixel))return this.StepPixel;var s=V(),o=this.Frame.SubFrame[0].Frame,h=o.DataWidth,l=o.DistanceWidth,u=this.StepPixel,u=(h+l)/s;return u<1&&(u=1),u},this.DataMove=function(s,o){var h=this.GetMoveOneStepWidth(),l=s;if(s=parseInt(s/h),s<=0)return!1;var u=null;if(this.Frame.Data?u=this.Frame.SubFrame[0].Frame.Data:u=this.Frame.Data,!u)return!1;var f=0;if(this.Frame.XPointCount?f=this.Frame.XPointCount:f=this.Frame.SubFrame[0].Frame.XPointCount,!f)return!1;if(this.Frame.SubFrame&&this.Frame.SubFrame.length>0&&this.Frame.SubFrame[0].Frame){var C=this.Frame.SubFrame[0].Frame;(C.DataWidth<=1||C.DistanceWidth<=1)&&c.IsPlusNumber(this.StepPixel)&&(s=parseInt(l)*this.StepPixel)}if(o){if(this.RightSpaceCount>0){if(f+u.DataOffset>=u.Data.length+this.RightSpaceCount-1)return!1;u.DataOffset+=s,u.DataOffset+f>=u.Data.length+this.RightSpaceCount&&(u.DataOffset=u.Data.length-(f-this.RightSpaceCount))}else{if(f+u.DataOffset>=u.Data.length)return!1;u.DataOffset+=s,u.DataOffset+f>=u.Data.length&&(u.DataOffset=u.Data.length-f)}return!0}else return u.DataOffset<=0?!1:(u.DataOffset-=s,u.DataOffset<0&&(u.DataOffset=0),!0)},this.XCoordinateZoom=function(s,o){var h=this.GetMoveOneStepWidth();return s=parseInt(s/h),s<=0?!1:this.Frame.XCoordinateZoom(o)},this.GetSubFrameIndex=function(s,o){if(!this.Frame.SubFrame||this.Frame.SubFrame.length<=0)return-1;for(var h in this.Frame.SubFrame){var l=this.Frame.SubFrame[h].Frame,u=l.ChartBorder.GetLeft(),f=l.ChartBorder.GetTop(),C=l.ChartBorder.GetHeight(),D=l.ChartBorder.GetWidth();if(this.Canvas.beginPath(),this.Canvas.rect(u,f,D,C),this.Canvas.isPointInPath(s,o))return parseInt(h)}return 0},this.GetDataIndexByPoint=function(s){var o=this.Frame;this.Frame.SubFrame&&this.Frame.SubFrame.length>0&&(o=this.Frame.SubFrame[0].Frame);var h=null;if(this.Frame.Data?h=this.Frame.Data:h=this.Frame.SubFrame[0].Frame.Data,!(!h||!o)){var l=parseInt(o.GetXData(s));return h.DataOffset+l}},this.GetSelectRectData=function(s){if(Math.abs(s.XStart-s.XEnd)<5)return!1;this.PtInClient(s.XStart,s.YStart),this.PtInClient(s.XEnd,s.YEnd);var o=null;if(this.Frame.Data?o=this.Frame.Data:o=this.Frame.SubFrame[0].Frame.Data,!o)return!1;var h=this.GetDataIndexByPoint(s.XStart),l=this.GetDataIndexByPoint(s.XEnd);return Math.abs(h-l)<2?!1:(s.Data=o,h>l?(s.Start=l,s.End=h):(s.Start=h,s.End=l),!0)},this.GetChartDrawPictureByPoint=function(s){for(var o=0;o<this.ChartDrawPicture.length;++o){var h=this.ChartDrawPicture[o],l=h.IsPointIn(s.X,s.Y,this.ChartDrawOption);if(l!==!1&&l>=0)return s.ChartDrawPicture=h,s.PointIndex=l,h.GetCursorType&&(s.Cursor=h.GetCursorType(l)),!0}return!1},this.SaveToImage=function(s,o){if(this.UIElement.width<=0||this.UIElement.height<=0||this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash)return null;X.Chart.Log("[JSChartContainer::SaveToImage]",this.UIElement);var h="rgb(255,255,255)";o&&(h=o),this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height),this.Canvas.fillStyle=h,this.Canvas.fillRect(0,0,this.UIElement.width,this.UIElement.height);var l=V();this.Canvas.lineWidth=l,this.Frame.Draw();for(var u in this.ChartPaint){var f=this.ChartPaint[u];f.IsDrawFirst&&f.Draw()}for(var u in this.ChartPaint){var f=this.ChartPaint[u];f.IsDrawFirst||f.Draw()}for(var u in this.ChartPaintEx){var f=this.ChartPaintEx[u];f.Draw()}for(var u in this.OverlayChartPaint){var f=this.OverlayChartPaint[u];f.Draw()}for(var u in this.ExtendChartPaint){var f=this.ExtendChartPaint[u];!f.IsDynamic&&f.IsAnimation==!1&&f.Draw()}this.Frame.DrawInsideHorizontal&&this.Frame.DrawInsideHorizontal(),this.Frame.DrawLock();for(var u in this.ExtendChartPaint){var f=this.ExtendChartPaint[u];f.IsDynamic&&f.DrawAfterTitle===!1&&f.Draw()}(this.LastPoint.X!=null||this.LastPoint.Y!=null)&&this.ChartCorssCursor&&(this.ChartCorssCursor.LastPoint=this.LastPoint,this.ChartCorssCursor.CursorIndex=this.CursorIndex);for(var u in this.TitlePaint){var f=this.TitlePaint[u];f.IsDynamic&&(f.CursorIndex=this.CursorIndex,f.Draw())}for(var u in this.ExtendChartPaint){var f=this.ExtendChartPaint[u];f.IsDynamic&&f.DrawAfterTitle===!0&&f.IsAnimation==!1&&f.Draw()}if(this.EnableAnimation)for(var u in this.ExtendChartPaint){var f=this.ExtendChartPaint[u];f.IsAnimation===!0&&f.Draw()}for(var u in this.ChartDrawPicture){var f=this.ChartDrawPicture[u];f.Draw()}this.CurrentChartDrawPicture&&this.CurrentChartDrawPicture.Status!=10&&this.CurrentChartDrawPicture.Draw();var C=this.UIElement.toDataURL(s||"image/png",1);return X.Chart.Log("[JSChartContainer::SaveToImage] data= ",C),C},this.SaveToImageUrl=function(s,o){s||(s={Format:"image/png",ColorGB:"rgb(255,255,255)"});var h=this.SaveToImage(s.Format,s.ColorGB),l={Base64:h,BucketName:"downloadcache",Path:"hqchart/hq_snapshot"},u=m.Domain+"/API/FileUploadForBase64";Lt.HttpRequest({url:u,method:"POST",dataType:"json",data:l,success:function(C){X.Chart.Log("[JSChartContainer::SaveToImageUrl] recv data",C);var D={Path:C.relativeurl,Domain:"https://opensourcedownload.zealink.com"};D.Url=D.Domain+"/"+D.Path,o&&o(!0,D,"")},error:function(C){X.Chart.Log("[JSChartContainer::SaveToImageUrl] error ",C),o&&o(!1,null,"upload failed")}})},this.ExportDataToCSV=function(s){for(var o="",h="",l=0,u=0;u<s.length;++u){var f=s[u];h+='"'+f.Name+'"',u==s.length-1?h+=`\r
`:h+=",",c.IsNonEmptyArray(f.Data)&&(l=Math.max(l,f.Data.length))}o+=h;for(var u=0,C=0;u<l;++u){for(h="",C=0;C<s.length;++C){var f=s[C],D=null;f.Data&&u<f.Data.length&&(D=f.Data[u]),h+='"'+D+'"',C==s.length-1?h+=`\r
`:h+=","}o+=h}return o="\uFEFF"+o,o},this.SetLanguage=function(s){var o=gt.GetLanguageID(s);if(!c.IsNumber(o)){console.warn("[JSChartContainer::SetLanguage] language="+s+" error");return}if(this.LanguageID!=o){this.LanguageID=o,this.ChartCorssCursor&&this.ChartCorssCursor.StringFormatY&&(this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID);for(var h=0;h<this.TitlePaint.length;++h){var l=this.TitlePaint[h];l&&(l.LanguageID=this.LanguageID)}for(var h=0;h<this.ExtendChartPaint.length;++h){var l=this.ExtendChartPaint[h];l&&(l.LanguageID=this.LanguageID)}this.Frame&&this.Frame.SetLanguage&&this.Frame.SetLanguage(this.LanguageID),this.Frame.SetSizeChage(!0),this.Draw()}},this.ReloadTiltePaintResource=function(s){for(var o in this.TitlePaint){var h=this.TitlePaint[o];h.ReloadResource&&h.ReloadResource(s)}},this.ReloadExtendChartPaintResource=function(s){for(var o in this.ExtendChartPaint){var h=this.ExtendChartPaint[o];h.ReloadResource&&h.ReloadResource(s)}},this.ReloadChartDrawPictureResource=function(s){if(c.IsNonEmptyArray(this.ChartDrawPicture))for(var o=0;o<this.ChartDrawPicture.length;++o){var h=this.ChartDrawPicture[o];h.ReloadResource&&h.ReloadResource(s)}},this.ReloadResource=function(s){this.ReloadBorder(s),this.ReloadTiltePaintResource(s.Resource),this.ReloadChartPaint(s.Resource),this.ReloadFrame(s.Resource),this.ReloadExtendChartPaintResource(s.Resource),this.ReloadChartCorssCursor(s,s.Resource),this.ReloadChartDrawPictureResource(s.Resource),s.Update&&this.Update?this.Update({UpdateCursorIndexType:2}):s.Draw==!0&&this.Draw()},this.ReloadBorder=function(s){if(s){var o=V();if(s.Border){var h=s.Border;c.IsNumber(h.Left)&&(this.Frame.ChartBorder.Left=h.Left*o),c.IsNumber(h.Right)&&(this.Frame.ChartBorder.Right=h.Right*o),c.IsNumber(h.Top)&&(this.Frame.ChartBorder.Top=h.Top*o),c.IsNumber(h.Bottom)&&(this.Frame.ChartBorder.Bottom=h.Bottom*o)}for(var l in s.Windows){var h=s.Windows[l];if(!(l>=this.Frame.SubFrame.length)){var u=this.Frame.SubFrame[l],f=u.Frame.ChartBorder;c.IsNumber(h.TitleHeight)&&(f.TitleHeight=h.TitleHeight*o)}}for(var l in s.Frame){var h=s.Frame[l];if(!(l>=this.Frame.SubFrame.length)){var u=this.Frame.SubFrame[l],f=u.Frame.ChartBorder;h.TopSpace>=0&&(f.TopSpace=h.TopSpace*o),h.BottomSpace>=0&&(f.BottomSpace=h.BottomSpace*o)}}}},this.ReloadFrame=function(s){for(var o=0;o<this.Frame.SubFrame.length;++o){var h=this.Frame.SubFrame[o],l=h.Frame;l&&l.ReloadResource&&l.ReloadResource(s);for(var u=0;u<h.OverlayIndex.length;++u){var f=h.OverlayIndex[u];f.Frame&&f.Frame.ReloadResource&&f.Frame.ReloadResource(s)}}},this.ReloadChartPaint=function(s){for(var o=0;o<this.ChartPaint.length;++o){var h=this.ChartPaint[o];h&&h.ReloadResource&&h.ReloadResource(s)}},this.ReloadChartCorssCursor=function(s,o){var h=V();if(s&&s.CorssCursor){var l=s.CorssCursor;c.IsNumber(l.TitleHeight)&&(this.ChartCorssCursor.TextHeight=l.TitleHeight*h)}this.ChartCorssCursor.ReloadResource&&this.ChartCorssCursor.ReloadResource(o)},this.SetDepthMapData=function(s,o){for(var h=0;h<s.length;++h)for(var l=s[h],u=0;u<this.ExtendChartPaint.length;++u){var f=this.ExtendChartPaint[u];if(f.ID==l.ID){f.Data=l.Data;break}}o&&o.Draw==!0&&this.Draw()},this.PointAbsoluteToRelative=function(s,o,h){var l={X:s,Y:o},u=V(),f=this.UIElement.getBoundingClientRect();return h?(l.X=s-f.left*u,l.Y=o-f.top*u):(l.X=(s-f.left)*u,l.Y=(o-f.top)*u),l},this.SetChartDrawPictureFirstPoint=function(s,o,h){var l=this.CurrentChartDrawPicture;if(!l||!this.Frame.SubFrame||this.Frame.SubFrame.length<=0)return!1;for(var u=this.PointAbsoluteToRelative(s,o,h),f=u.X,C=u.Y,D=0;D<this.Frame.SubFrame.length;++D){var v=this.Frame.SubFrame[D].Frame,S=v.ChartBorder.GetLeft(),T=v.ChartBorder.GetTopEx(),I=v.ChartBorder.GetBottomEx(),F=I-T,E=v.ChartBorder.GetWidth();if(this.Canvas.beginPath(),this.Canvas.rect(S,T,E,F),this.Canvas.isPointInPath(f,C)){if(c.IsNumber(l.LimitFrameID)&&D!=l.LimitFrameID)return!1;l.Frame=v;break}}return l.Frame?(l.Point[0]=new ot,l.Point[0].X=f,l.Point[0].Y=C,l.Status=1,l.PointMagnetKLine(),!0):!1},this.SetChartDrawPictureSecondPoint=function(s,o,h){var l=this.CurrentChartDrawPicture;if(!l)return!1;var u=this.PointAbsoluteToRelative(s,o,h);return l.Point[1]=new ot,l.Point[1].X=u.X,l.Point[1].Y=u.Y,l.Status=2,!0},this.SetChartDrawPictureThirdPoint=function(s,o,h){var l=this.CurrentChartDrawPicture;if(!l)return!1;var u=this.PointAbsoluteToRelative(s,o,h);return l.Point[2]=new ot,l.Point[2].X=u.X,l.Point[2].Y=u.Y,l.Status=3,!0},this.MoveChartDrawPicture=function(s,o,h,l){var u=this.CurrentChartDrawPicture;if(!u)return!1;var f=V();h&&(f=1);var C=s*f,D=o*f;return u.Move(C,D,l),!0},this.FinishChartDrawPicturePoint=function(){var s=this.CurrentChartDrawPicture;if(!s||s.PointCount!=s.Point.length)return!1;if(s.ClassName=="ChartDrawRuler")return this.CurrentChartDrawPicture=null,!0;s.PointMagnetKLine(),s.Status=10,s.PointToValue(),this.ChartDrawPicture.push(s),this.CurrentChartDrawPicture=null;var o=this.GetEventCallback(et.ON_FINISH_DRAWPICTURE);if(o&&o.Callback){var h={DrawPicture:s};o.Callback(o,h,this)}else s.FinishedCallback&&s.FinishedCallback(s);return s.OnFinish&&s.OnFinish(),this.ChartDrawStorage&&this.ChartDrawStorage.SaveDrawData(s),!0},this.OnSelectChartPicture=function(s){if(X.Chart.Log("[JSChartContainer::OnSelectChartPicture]",s),this.ChartPictureMenu||(this.ChartPictureMenu=tD.Create("ChartPictureSettingMenu",this.UIElement.parentNode)),!!this.ChartPictureMenu){var o={data:{ChartPicture:s,HQChart:this}};this.ChartPictureMenu.DoModal(o)}},this.FinishMoveChartDrawPicture=function(){var s=this.CurrentChartDrawPicture;if(!s||s.PointCount!=s.Point.length)return!1;if(s.PointMagnetKLine(),s.Status=10,s.PointToValue(),this.ChartDrawStorage&&this.ChartDrawStorage.SaveDrawData(s),this.CurrentChartDrawPicture=null,this.SelectChartDrawPicture&&this.SelectChartDrawPicture.DragInfo){var o=this.SelectChartDrawPicture.DragInfo;if(o.Click&&o.Move&&(o.Click.X!=o.Move.X||o.Click.Y!=o.Move.Y)){var h=this.GetEventCallback(et.ON_FINISH_MOVE_DRAWPICTURE);if(h&&h.Callback){var l={DrawPicture:s};h.Callback(h,l,this)}s.OnMoveFinish&&s.OnMoveFinish()}}return!0},this.ClearChartDrawPicture=function(s,o){var h=!0;if(!s)this.ChartDrawPicture=[],this.ChartDrawStorage&&this.ChartDrawStorage.Clear(),o&&o.Draw==!1&&(h=!1),h&&this.Draw();else for(var l in this.ChartDrawPicture)this.ChartDrawPicture[l]==s&&(this.ChartDrawStorage&&this.ChartDrawStorage.DeleteDrawData(s),this.ChartDrawPicture.splice(l,1),o&&o.Draw==!1&&(h=!1),h&&this.Draw())},this.GetActiveDrawPicture=function(){var s={Move:{Guid:null},Select:{Guid:null},MoveOn:{Guid:null}};return this.CurrentChartDrawPicture&&(s.Move={Guid:this.CurrentChartDrawPicture.Guid}),this.SelectChartDrawPicture&&(s.Select={Guid:this.SelectChartDrawPicture.Guid,Chart:this.SelectChartDrawPicture}),this.MoveOnChartDrawPicture&&(s.MoveOn={Guid:this.MoveOnChartDrawPicture.Guid}),s},this.SetChartDrawOption=function(s){if(c.IsBool(s.IsLockScreen)&&(this.ChartDrawOption.IsLockScreen=s.IsLockScreen),c.IsNumber(s.Zoom)&&s.Zoom>=0&&(this.ChartDrawOption.Zoom=s.Zoom),s.Magnet){var o=s.Magnet;this.ChartDrawOption.Magnet||(this.ChartDrawOption.Magnet={Type:0,Distance:20*V(),Enable:!1}),c.IsBool(o.Enable)&&(this.ChartDrawOption.Magnet.Enable=o.Enable),c.IsNumber(o.Type)&&(this.ChartDrawOption.Magnet.Type=o.Type),c.IsNumber(o.Distance)&&(this.ChartDrawOption.Magnet.Distance=opitemion.Distance)}},this.EnableShowCorssCursorLine=function(s){this.ChartCorssCursor&&(this.ChartCorssCursor.IsShowCorss=s)},this.GetExtendChartByClassName=function(s){for(var o=0;o<this.ExtendChartPaint.length;++o){var h=this.ExtendChartPaint[o];if(h.ClassName==s)return{Index:o,Chart:h}}return null},this.GetExtendChartByClassNameV2=function(s){for(var o=[],h=0;h<this.ExtendChartPaint.length;++h){var l=this.ExtendChartPaint[h];l.ClassName==s&&o.push({Index:h,Chart:l})}return o.length<=0?null:o},this.GetExtendChartRightWidth=function(){for(var s=0,o=0;o<this.ExtendChartPaint.length;++o){var h=this.ExtendChartPaint[o];h&&(h.ClassName=="StockChip"||h.ClassName=="DrawToolsButton")&&c.IsNumber(h.Width)&&(s+=h.Width)}return s},this.DeleteExtendChart=function(s){s.Index>=this.ExtendChartPaint.length||this.ExtendChartPaint[s.Index]==s.Chart&&(typeof s.Chart.Clear=="function"&&s.Chart.Clear(),this.ExtendChartPaint.splice(s.Index,1))},this.EnableSplashScreen=function(s){this.ChartSplashPaint&&s&&(c.IsString(s.Title)&&this.ChartSplashPaint.SetTitle(s.Title),this.ChartSplashPaint.EnableSplash(!0),s.Draw!==!1&&this.Draw())},this.SetSubFrameAttribute=function(s,o,h){if(!(!s||!s.Frame)){var l=s.Frame;o&&(c.IsBool(o.Modify)&&(l.ModifyIndex=o.Modify),c.IsBool(o.Change)&&(l.ChangeIndex=o.Change),c.IsBool(o.Close)&&(l.CloseIndex=o.Close),c.IsBool(o.Overlay)&&(l.OverlayIndex=o.Overlay),c.IsBool(o.IsDrawTitleBG)&&(l.IsDrawTitleBG=o.IsDrawTitleBG),c.IsNumber(o.TitleHeight)?l.ChartBorder.TitleHeight=o.TitleHeight:o.TitleHeight=l.ChartBorder.TitleHeight,c.IsBool(o.IsShowTitleArraw)&&(l.IsShowTitleArraw=o.IsShowTitleArraw),c.IsBool(o.IsShowIndexName)&&(l.IsShowIndexName=o.IsShowIndexName),c.IsNumber(o.IndexParamSpace)&&(l.IndexParamSpace=o.IndexParamSpace),c.IsNumber(o.IndexTitleSpace)&&(l.IndexTitleSpace=o.IndexTitleSpace)),h&&(h.SplitCount&&(l.YSplitOperator.SplitCount=h.SplitCount),c.IsBool(h.IsShowXLine)&&(l.IsShowXLine=h.IsShowXLine),c.IsBool(h.IsShowYLine)&&(l.IsShowYLine=h.IsShowYLine),c.IsBool(h.IsShowLeftText)&&(l.IsShowYText[0]=h.IsShowLeftText,l.YSplitOperator.IsShowLeftText=h.IsShowLeftText),c.IsBool(h.IsShowRightText)&&(l.IsShowYText[1]=h.IsShowRightText,l.YSplitOperator.IsShowRightText=h.IsShowRightText),c.IsNumber(h.Height)&&h.Height>=0&&(s.Height=h.Height))}},this.SetSubFrameOption=function(s,o){if(o){if(o.Window){var h=o.Window;h.Modify!=null&&(s.Frame.ModifyIndex=h.Modify),h.Change!=null&&(s.Frame.ChangeIndex=h.Change),h.Close!=null&&(s.Frame.CloseIndex=h.Close),h.Overlay!=null&&(s.Frame.OverlayIndex=h.Overlay),h.IsDrawTitleBG==!0&&(s.Frame.IsDrawTitleBG=h.IsDrawTitleBG),c.IsBool(h.IsShowNameArrow)&&(s.Frame.IsShowNameArrow=h.IsShowNameArrow),h.OverlayIndexType&&(c.IsNumber(h.OverlayIndexType.Position)&&(s.Frame.OverlayIndexType.Position=h.OverlayIndexType.Position),c.IsNumber(h.OverlayIndexType.LineSpace)&&(s.Frame.OverlayIndexType.LineSpace=h.OverlayIndexType.LineSpace))}c.IsNumber(o.SplitCount)&&(s.Frame.YSplitOperator.SplitCount=o.SplitCount),c.IsNumber(o.TitleHeight)&&(s.Frame.ChartBorder.TitleHeight=o.TitleHeight),c.IsBool(o.IsShowTitleArraw)&&(s.Frame.IsShowTitleArraw=o.IsShowTitleArraw),c.IsBool(o.IsShowIndexName)&&(s.Frame.IsShowIndexName=o.IsShowIndexName),c.IsBool(o.IsShowOverlayIndexName)&&(s.Frame.IsShowOverlayIndexName=o.IsShowOverlayIndexName),c.IsNumber(o.IndexParamSpace)&&(s.Frame.IndexParamSpace=o.IndexParamSpace),c.IsBool(o.IsShowXLine)&&(s.Frame.IsShowXLine=o.IsShowXLine),c.IsBool(o.IsShowYLine)&&(s.Frame.IsShowYLine=o.IsShowYLine),c.IsBool(o.IsShowIndexTitle)&&(s.Frame.IsShowIndexTitle=o.IsShowIndexTitle),c.IsBool(o.IsShowLeftText)&&(s.Frame.IsShowYText[0]=o.IsShowLeftText,s.Frame.YSplitOperator.IsShowLeftText=o.IsShowLeftText),c.IsBool(o.IsShowRightText)&&(s.Frame.IsShowYText[1]=o.IsShowRightText,s.Frame.YSplitOperator.IsShowRightText=o.IsShowRightText)}},this.AddNewSubFrame=function(s){var o=this,h=this.Frame.SubFrame.length,l=this.CreateSubFrameItem(h),u=V();l.Frame.ChartBorder.TitleHeight*=u,this.Frame.SubFrame[h]=l;var f=new za;f.Frame=this.Frame.SubFrame[h].Frame,f.Canvas=this.Canvas,f.LanguageID=this.LanguageID,f.GetEventCallback=function(v){return o.GetEventCallback(v)},this.TitlePaint[h+1]=f,this.SetSubFrameOption(l,s);for(var C=0;C<this.Frame.SubFrame.length;++C){var D=this.Frame.SubFrame[C].Frame;C==this.Frame.SubFrame.length-1?D.XSplitOperator.ShowText=!0:D.XSplitOperator.ShowText=!1}return this.UpdataDataoffset(),this.Frame.SetSizeChage(!0),this.UpdateXShowText&&this.UpdateXShowText(),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw(),h},this.AddIndexWindow=function(s,o){var h=new J,l=h.Get(s);if(l){this.RemoveMinSizeWindows();var u=this.AddNewSubFrame(o),f={Name:l.Name,Script:l.Script,Args:l.Args,ID:s,KLineType:l.KLineType,YSpecificMaxMin:l.YSpecificMaxMin,YSplitScale:l.YSplitScale,FloatPrecision:l.FloatPrecision,Condition:l.Condition,StringFormat:l.StringFormat,OutName:l.OutName};if(o&&(o.FloatPrecision>=0&&(f.FloatPrecision=o.FloatPrecision),o.StringFormat>0&&(f.StringFormat=o.StringFormat),o.Args&&(f.Args=o.Args),o.Lock&&(f.Lock=o.Lock)),this.WindowIndex[u]=new de(f.Name,f.Script,f.Args,f),this.ClassName=="MinuteChartContainer"||this.ClassName=="MinuteChartHScreenContainer")var C=this.SourceData;else var C=this.ChartPaint[0].Data;this.BindIndexData(u,C)}},this.AddAPIIndexWindow=function(s,o){if(s.API){this.RemoveMinSizeWindows();var h=this.AddNewSubFrame(o),l=s.API;if(this.WindowIndex[h]=new Ma(l.Name,l.Script,l.Args,s),this.ClassName=="MinuteChartContainer"||this.ClassName=="MinuteChartHScreenContainer")var u=this.SourceData;else var u=this.ChartPaint[0].Data;this.BindIndexData(h,u)}},this.AddScriptIndexWindow=function(s,o){if(!(!s||!s.Script||!s.Name)){this.RemoveMinSizeWindows();var h=this.AddNewSubFrame(o),l={Name:s.Name,Script:s.Script,Args:s.Args,ID:s.Name,KLineType:s.KLineType,YSpecificMaxMin:s.YSpecificMaxMin,YSplitScale:s.YSplitScale,FloatPrecision:s.FloatPrecision,Condition:s.Condition,StringFormat:s.StringFormat,OutName:s.OutName};if(s.ID&&(l.ID=s.ID),this.WindowIndex[h]=new de(l.Name,l.Script,l.Args,l),this.ClassName=="MinuteChartContainer"||this.ClassName=="MinuteChartHScreenContainer")var u=this.SourceData;else var u=this.ChartPaint[0].Data;this.BindIndexData(h,u)}},this.GetRectSelectPaint=function(){for(var s=0;s<this.ExtendChartPaint.length;++s){var o=this.ExtendChartPaint[s];if(o.ClassName=="RectSelectPaint")return o}return null},this.SetRectSelectData=function(s,o){var h=this.GetRectSelectPaint();if(!h)return!1;if(h.GetPointCount()==2){if(!h.SpaceReselected)return!1;var l=h.PreventClose;h.PreventClose=!1,h.ClearPoint(),h.PreventClose=l}return h.SetPoint(s,{DataIndex:o})},this.MoveRectSelectPoint=function(s){var o=this.GetRectSelectPaint();if(!o||!this.ChartPaint[0]||!this.ChartPaint[0].Data)return!1;var h=this.ChartPaint[0].Data;if(!this.Frame.SubFrame[0])return!1;var l=this.Frame.SubFrame[0].Frame,u=V(),f=(s.X-r.getBoundingClientRect().left)*u,C=l.GetXData(f);C=parseInt(C.toFixed(0));var D=C+h.DataOffset;D>=h.Data.length&&(D=h.Data.length-1);var v=h.Data[D];if(X.Chart.Log("[KLineChartContainer::MoveRectSelectPoint] point, item",s.PointIndex,v),!o.SetPoint(v,{Index:s.PointIndex,DataIndex:D}))return!1;var S=this.GetEventCallback(et.ON_DRAG_SELECT_RECT);if(S){var T=o.GetSelectRectData(),I={X:s.X,Y:s.Y,SelectData:T,RectSelectPaint:o};S.Callback(S,I,this)}return!0},this.MoveSubRectSelect=function(s){var o=this.GetRectSelectPaint();if(!o||!o.MoveSubRect(s.Step,s.IsLeft))return!1;var h=this.GetEventCallback(et.ON_DRAG_SUB_SELECT_RECT);if(h){var l={Start:o.SubClient.FirstPoint,End:o.SubClient.SecondPoint},u={X:s.X,Y:s.Y,SubRectSelectData:l,RectSelectPaint:o};h.Callback(h,u,this)}return!0},this.ClearRectSelect=function(s){var o=this.GetRectSelectPaint();return o?(s&&(o.PreventClose=!1),o.ClearPoint()):!1},this.DeleteOverlayIndex=function(s,o){var h=null;if(c.IsNumber(o)){if(o>=0&&o<this.Frame.SubFrame.length)for(var l=this.Frame.SubFrame[o],u=0;u<l.OverlayIndex.length;++u){var f=l.OverlayIndex[u];if(f.Identify===s){for(var C=0;C<f.ChartPaint.length;++C){var D=f.ChartPaint[C];D&&D.OnDestroy&&D.OnDestroy()}l.OverlayIndex.splice(u,1),h=o;break}}}else for(var v=0;v<this.Frame.SubFrame.length;++v)for(var l=this.Frame.SubFrame[v],u=0;u<l.OverlayIndex.length;++u){var f=l.OverlayIndex[u];if(f.Identify===s){for(var C=0;C<f.ChartPaint.length;++C){var D=f.ChartPaint[C];D&&D.OnDestroy&&D.OnDestroy()}l.OverlayIndex.splice(u,1),h=v;break}}if(h==null)return console.warn("[JSChartContainer::DeleteOverlayIndex] can't find overlay index. [identify="+s+"]"),!1;var S=h+1,T=this.TitlePaint[S];return T.OverlayIndex.has(s)&&T.OverlayIndex.delete(s),T.OverlayDynamicTitle.has(s)&&T.OverlayDynamicTitle.delete(s),!0},this.FindScriptIndex=function(s,o){if(c.IsNumber(o)&&o>=0){if(o>=this.Frame.SubFrame.length)return null;var h=this.WindowIndex[o];if(h&&h.Guid==s)return{Type:0,Data:h,WindowIndex:o};for(var h=this.Frame.SubFrame[o],l=0;l<h.OverlayIndex.length;++l){var u=h.OverlayIndex[l];if(u.Identify===s)return{Type:1,Data:u,WindowIndex:o,OverlayIndex:l}}}else for(var l=0;l<this.Frame.SubFrame.length;++l){var h=this.WindowIndex[l];if(h&&h.Guid==s)return{Type:0,Data:h,WindowIndex:l};for(var h=this.Frame.SubFrame[l],f=0;f<h.OverlayIndex.length;++f){var u=h.OverlayIndex[f];if(u.Identify===s)return{Type:1,Data:u,WindowIndex:l,OverlayIndex:f}}}return null},this.MoveIndex=function(s,o,h){var l=this;if(!s||!o||!h||!c.IsNumber(s.WindowIndex)||s.WindowIndex<0||s.WindowIndex>=this.Frame.SubFrame.length||!c.IsNumber(o.WindowIndex)||o.WindowIndex<0||o.WindowIndex>=this.Frame.SubFrame.length)return!1;var u=this.FindScriptIndex(s.IndexID,s.WindowIndex);if(!u)return!1;var f=null,C=null;if(u.Type==0?f=u.Data:u.Type==1&&(C=u.Data),!C&&!f)return!1;var D=0,v=this.ClassName=="MinuteChartContainer"||this.ClassName=="MinuteChartHScreenContainer";if(v&&(D=2),o.WindowIndex>=D&&this.WindowIndex[o.WindowIndex]==null){f?this.WindowIndex[o.WindowIndex]=this.CreateMainScript(f):C&&(this.WindowIndex[o.WindowIndex]=this.CreateMainScript(C.Script)),h.Operator==0&&(C?this.DeleteOverlayIndex(C.Identify,s.WindowIndex):f&&this.DeleteMainIndex(f.Guid,s.WindowIndex));var S=this.GetMainData();this.BindIndexData(o.WindowIndex,S),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}else{var T=this.Frame.SubFrame[o.WindowIndex];T.Interval=this.OverlayIndexFrameWidth;var I=new Qn,F=this.CreateOverlayFrame();F.Canvas=this.Canvas,F.MainFrame=T.Frame,F.ChartBorder=T.Frame.ChartBorder,C&&(F.IsShow=C.Frame.IsShow),F.YSplitOperator=new Pa,F.YSplitOperator.LanguageID=this.LanguageID,F.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),F.YSplitOperator.Frame=F,F.YSplitOperator.ChartBorder=F.ChartBorder,F.YSplitOperator.SplitCount=T.Frame.YSplitOperator.SplitCount,F.YSplitOperator.GetEventCallback=function(R){return l.GetEventCallback(R)},I.Frame=F;var E;f?(E=this.CreateOverlayScript(f),E.OverlayIndex={IsOverlay:!0,Identify:I.Identify,WindowIndex:o.WindowIndex,Frame:I}):C&&(E=this.CreateOverlayScript(C.Script),E.OverlayIndex={IsOverlay:!0,Identify:I.Identify,WindowIndex:o.WindowIndex,Frame:I}),I.Script=E,T.OverlayIndex.push(I);var M=o.WindowIndex;if(h.Operator==0){if(C)this.DeleteOverlayIndex(C.Identify,s.WindowIndex);else if(f){this.DeleteMainIndex(f.Guid,s.WindowIndex);var u=this.FindScriptIndex(I.Identify);u&&(M=u.WindowIndex)}}var S=this.GetMainData();this.BindOverlayIndexData(I,M,S),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.MoveIndexToNewWindow=function(s,o){var h=this;if(!s||!o||!c.IsNumber(s.WindowIndex)||s.WindowIndex<0||s.WindowIndex>=this.Frame.SubFrame.length)return!1;var l=this.FindScriptIndex(s.IndexID,s.WindowIndex);if(!l)return!1;var u=null,f=null;if(l.Type==0?u=l.Data:l.Type==1&&(f=l.Data),!f&&!u||s.WindowIndex==this.Frame.SubFrame.length-1&&this.Frame.SubFrame[s.WindowIndex].OverlayIndex<=0)return!1;this.RemoveMinSizeWindows();var I=this.Frame.SubFrame.length,C=this.CreateSubFrameItem(I),D=V();C.Frame.ChartBorder.TitleHeight*=D,this.Frame.SubFrame[I]=C;var v=new za;v.Frame=this.Frame.SubFrame[I].Frame,v.Canvas=this.Canvas,v.LanguageID=this.LanguageID,v.SelectedChart=this.SelectedChart,v.GetEventCallback=function(E){return h.GetEventCallback(E)},this.TitlePaint[I+1]=v,this.SetSubFrameOption(C,o);for(var S=0;S<this.Frame.SubFrame.length;++S){var T=this.Frame.SubFrame[S].Frame;S==this.Frame.SubFrame.length-1?T.XSplitOperator.ShowText=!0:T.XSplitOperator.ShowText=!1}o.Operator==0&&(f?this.DeleteOverlayIndex(f.Identify,s.WindowIndex):u&&this.DeleteMainIndex(u.Guid,s.WindowIndex)),this.UpdataDataoffset(),this.Frame.SetSizeChage(!0),this.UpdateXShowText&&this.UpdateXShowText(),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw();var I=this.Frame.SubFrame.length-1;u?this.WindowIndex[I]=this.CreateMainScript(u):f&&(this.WindowIndex[I]=this.CreateMainScript(f.Script));var F=this.GetMainData();this.BindIndexData(I,F)},this.CreateOverlayScript=function(s){var o=null;switch(s.ClassName){case"ScriptIndex":o=new rn;break;case"APIScriptIndex":o=new Ma(null,null,null,null,!0);break;case"OverlayScriptIndex":o=new rn;break}return s.CopyTo(o),o},this.CreateMainScript=function(s){var o=null;switch(s.ClassName){case"ScriptIndex":case"OverlayScriptIndex":o=new de;break;case"APIScriptIndex":o=new Ma;break}return s.CopyTo(o),o},this.DeleteMainIndex=function(s,o){var h=this.WindowIndex[o];if(!h)return!1;var l=this.Frame.SubFrame[o];if(!l)return!1;if(!c.IsNonEmptyArray(l.OverlayIndex))this.RemoveIndexWindow(o,{DeleteMainIndex:!0});else{var u=l.OverlayIndex[0];this.DeleteOverlayIndex(u.Identify,o),this.WindowIndex[o]=this.CreateMainScript(u.Script);var f=this.GetMainData();this.BindIndexData(o,f)}},this.GetMainData=function(){switch(this.ClassName){case"MinuteChartContainer":case"MinuteChartHScreenContainer":return this.SourceData;case"KLineChartContainer":case"KLineChartHScreenContainer":return this.ChartPaint[0].Data}},this.CreateOverlayFrame=function(){switch(this.ClassName){case"KLineChartContainer":return new lC;case"KLineChartHScreenContainer":return new uC;case"MinuteChartContainer":return new _o;case"MinuteChartHScreenContainer":return new Uo}},this.ExportData=function(s){if(!this.ExportMainData||!this.ChartPaint[0])return null;var o=this.GetMainData();if(!o||!c.IsNonEmptyArray(o.Data))return null;var h=null,l=o.Data;s.Start&&s.End&&(h=o.GetDataRange(s.Start,s.End));var u=this.ExportMainData(o,h);if(!u)return null;for(var f=1;f<this.ChartPaint.length;++f){var C=this.ChartPaint[f];if(!(!C||!C.ExportData)){var D=C.ExportData(l,h);if(D&&c.IsNonEmptyArray(D))for(var v=0;v<D.length;++v){var S=D[v];C.IndexName?u.push({Name:S.Name+"("+C.IndexName+")",Data:S.Data}):u.push(S)}}}for(var f=0;f<this.OverlayChartPaint.length;++f){var C=this.OverlayChartPaint[f];if(!(!C.Data||!c.IsNonEmptyArray(F.Data.Data))){var D=this.ExportMainData(C.Data,{IsOverlay:!0});if(D&&c.IsNonEmptyArray(D))for(var v=0;v<D.length;++v){var S=D[v];u.push({Name:S.Name+"("+C.Symbol+")",Data:S.Data})}}}for(var f=0,v=0,T=0;f<this.Frame.SubFrame.length;++f){var C=this.Frame.SubFrame[f];for(v=0;v<C.OverlayIndex.length;++v){var I=C.OverlayIndex[v];if(c.IsNonEmptyArray(I.ChartPaint))for(T=0;T<I.ChartPaint.length;++T){var F=I.ChartPaint[T];if(!(!F||!F.ExportData)){var D=F.ExportData(l,h);if(D&&c.IsNonEmptyArray(D))for(var E=0;E<D.length;++E){var S=D[E];F.IndexName?u.push({Name:S.Name+"("+F.IndexName+")",Data:S.Data}):u.push(S)}}}}}return s&&s.Type=="CSV"?this.ExportDataToCSV(u):u}}function V(){return typeof window>"u"?1:window.devicePixelRatio||1}function Aa(r,n,e){if(!r)return null;n&&(r.font=n);var t="擎";c.IsString(e)&&(t=e);var a=r.measureText(t),s=a.fontBoundingBoxAscent+a.fontBoundingBoxDescent;return c.IsNumber(s)||(s=a.width+2*V()),s}function Nh(r){this.JSChartContainer&&this.JSChartContainer.OnKeyDown&&this.JSChartContainer.OnKeyDown(r)}function kT(r,n){var e=1;if(isNaN(r))return r;r<0&&(e=-1);var t=Math.pow(10,n),a=Math.round(Math.abs(r)*t)/t*e;if(/^(\d+(?:\.\d+)?)(e)([\-]?\d+)$/.test(a))var s=a.toFixed2(n);else var s=a.toString();var o=s.indexOf(".");for(o<0&&n>0&&(o=s.length,s+=".");s.length<=o+n;)s+="0";return s}Number.prototype.toFixed2=Number.prototype.toFixed;Number.prototype.toFixed=function(r){return kT(this,r)};function oe(){function r(){return((1+Math.random())*65536|0).toString(16).substring(1)}return"guid"+(r()+r()+"-"+r()+"-"+r()+"-"+r()+"-"+r()+r()+r())}function tn(){var r={},n=0,e=0;return document.documentElement&&document.documentElement.scrollTop?(n=document.documentElement.scrollTop,e=document.documentElement.scrollLeft):document.body&&(n=document.body.scrollTop,e=document.body.scrollLeft),r.Top=n,r.Left=e,r}function L(r){return parseInt(r)+.5}function he(r,n){var e=r%2===0?Math.floor(n):Math.floor(n)+.5;return e}function B(r){return .5+r<<0}function ne(r){if(!r)return null;var n=(0,jr.default)(r),e=JSON.parse(n);return e}function ot(){this.X,this.Y}function nC(){this.Data,this.JSChartContainer,this.Start,this.End,this.XStart,this.YStart,this.XEnd,this.YEnd}function Ht(){this.Value,this.Message=[],this.TextColor=m.FrameSplitTextColor,this.TextColor2,this.Font=m.FrameSplitTextFont,this.LineColor=m.FrameSplitPen,this.LineDash=null,this.LineType=1,this.LineWidth,this.ExtendData}function We(){this.UIElement,this.Left=50,this.Right=80,this.Top=50,this.Bottom=50,this.TitleHeight=24,this.TopSpace=0,this.BottomSpace=0,this.LeftExtendWidth=0,this.RightExtendWidth=0,this.MultiDayMinute={Count:1,Left:0,Right:0},this.IsShowTitleOnly=!1,this.GetBorder=function(){var r={Left:this.Left,LeftEx:this.Left+this.LeftExtendWidth,Right:this.UIElement.width-this.Right,RightEx:this.UIElement.width-this.Right-this.RightExtendWidth,Top:this.Top,TopEx:this.Top+this.TitleHeight+this.TopSpace,TopTitle:this.Top+this.TitleHeight,Bottom:this.UIElement.height-this.Bottom,BottomEx:this.UIElement.height-this.Bottom-this.BottomSpace,ChartWidth:this.UIElement.width,ChartHeight:this.UIElement.height};if(this.MultiDayMinute&&this.MultiDayMinute.Count>1&&(this.MultiDayMinute.Left>0||this.MultiDayMinute.Right>0)){for(var n=this.UIElement.width-this.Left-this.Right,e=n/this.MultiDayMinute.Count,t=[],a=0;a<this.MultiDayMinute.Count;++a){var s={Left:this.Left+e*a,Right:this.Left+e*(a+1)};s.LeftEx=s.Left+this.MultiDayMinute.Left,s.RightEx=s.Right-this.MultiDayMinute.Right,t.push(s)}r.DayBorder=t}return r},this.GetHScreenBorder=function(){var r={Left:this.Left,LeftEx:this.Left+this.BottomSpace,Right:this.UIElement.width-this.Right,RightEx:this.UIElement.width-this.Right-this.TitleHeight-this.TopSpace,RightTitle:this.UIElement.width-this.Right-this.TitleHeight,Top:this.Top,TopEx:this.Top+this.LeftExtendWidth,Bottom:this.UIElement.height-this.Bottom,BottomEx:this.UIElement.height-this.Bottom-this.RightExtendWidth,ChartWidth:this.UIElement.width,ChartHeight:this.UIElement.height};if(this.MultiDayMinute&&this.MultiDayMinute.Count>1&&(this.MultiDayMinute.Left>0||this.MultiDayMinute.Right>0)){for(var n=this.UIElement.height-this.Top-this.Bottom,e=n/this.MultiDayMinute.Count,t=[],a=0;a<this.MultiDayMinute.Count;++a){var s={Top:this.Top+e*a,Bottom:this.Top+e*(a+1)};s.TopEx=s.Top+this.MultiDayMinute.Left,s.BottomEx=s.Bottom-this.MultiDayMinute.Right,t.push(s)}r.DayBorder=t}return r},this.PtInClient=function(r,n,e,t){if(t){var a=this.GetHScreenBorder();e.rect(a.Left,a.TopEx,a.Right-a.Left,a.BottomEx-a.TopEx)}else{var a=this.GetBorder();if(a.DayBorder){for(var s=0;s<a.DayBorder.length;++s){var o=a.DayBorder[s];if(e.beginPath(),e.rect(o.LeftEx,a.TopEx,o.RightEx-o.LeftEx,a.BottomEx-a.TopEx),e.isPointInPath(r,n))return 1;if(e.beginPath(),e.rect(o.Left,a.TopEx,o.LeftEx-o.Left,a.BottomEx-a.TopEx),e.isPointInPath(r,n))return 200+parseInt(s);if(e.beginPath(),e.rect(o.RightEx,a.TopEx,o.Right-o.RightEx,a.BottomEx-a.TopEx),e.isPointInPath(r,n))return 300+parseInt(s)}return-1}e.rect(a.LeftEx,a.Top,a.RightEx-a.LeftEx,a.Bottom-a.Top)}return e.isPointInPath(r,n)?1:this.LeftExtendWidth>10&&(e.beginPath(),t===!0?e.rect(a.Left,a.Top,a.Right-a.Left,a.TopEx-a.Top):e.rect(a.Left,a.Top,a.LeftEx-a.Left,a.Bottom-a.Top),e.isPointInPath(r,n))?2:this.RightExtendWidth>10&&(e.beginPath(),t===!0?e.rect(a.Left,a.BottomEx,a.Right-a.Left,a.Bottom-a.BottomEx):e.rect(a.RightEx,a.Top,a.Right-a.RightEx,a.Bottom-a.Top),e.isPointInPath(r,n))?3:-1},this.GetChartWidth=function(){return this.UIElement.width},this.GetChartHeight=function(){return this.UIElement.height},this.GetLeft=function(){return this.Left+this.LeftExtendWidth},this.GetRight=function(){return this.UIElement.width-this.Right-this.RightExtendWidth},this.GetTop=function(){return this.Top},this.GetTopEx=function(){return this.Top+this.TitleHeight+this.TopSpace},this.GetTopTitle=function(){return this.Top+this.TitleHeight},this.GetBottom=function(){return this.UIElement.height-this.Bottom},this.GetBottomEx=function(){return this.UIElement.height-this.Bottom-this.BottomSpace},this.GetWidth=function(){return this.UIElement.width-this.Left-this.Right-this.LeftExtendWidth-this.RightExtendWidth},this.GetHeight=function(){return this.UIElement.height-this.Top-this.Bottom},this.GetHeightEx=function(){return this.UIElement.height-this.Top-this.Bottom-this.TitleHeight-this.TopSpace-this.BottomSpace},this.GetRightEx=function(){return this.UIElement.width-this.Right-this.TitleHeight-this.TopSpace},this.GetWidthEx=function(){return this.UIElement.width-this.Left-this.Right-this.TitleHeight-this.TopSpace-this.BottomSpace},this.GetLeftEx=function(){return this.Left+this.BottomSpace},this.GetRightTitle=function(){return this.UIElement.width-this.Right-this.TitleHeight},this.GetTitleHeight=function(){return this.TitleHeight}}function XT(){this.DataMap=new Dt.default([["KLineFrame",{Create:function(n){return new Tr}}],["KLineHScreenFrame",{Create:function(n){return new Rh}}]]),this.Create=function(r,n){if(!this.DataMap.has(r))return X.Warn("[ChartFrameFactory::Create] can't find class="+r+"."),null;var e=this.DataMap.get(r);return e.Create(n)},this.Add=function(r,n){var e=null;return this.DataMap.has(r)&&(e=this.DataMap.get(r)),this.DataMap.set(r,{Create:n.Create}),e}}var Oh=new XT;function sC(){this.HorizontalInfo=new Array,this.VerticalInfo=new Array,this.ClassName="IChartFramePainting",this.Canvas,this.Identify,this.Guid=oe(),this.ChartBorder,this.PenBorder=m.FrameBorderPen,this.TitleBGColor=m.FrameTitleBGColor,this.IsShow=!0,this.SizeChange=!0,this.XYSplit=!0,this.HorizontalMax,this.HorizontalMin,this.XPointCount=10,this.YSplitOperator,this.XSplitOperator,this.Data,this.IsLocked=!1,this.LockPaint=null,this.YSpecificMaxMin=null,this.IsShowBorder=!0,this.IsShowTitleArraw=!0,this.IsShowIndexName=!0,this.IsShowOverlayIndexName=!0,this.OverlayIndexType={Position:1,LineSpace:3},this.IndexParamSpace=2,this.IndexTitleSpace=0,this.IsShowIndexTitle=!0,this.IsDrawTitleBottomLine=!1,this.BorderLine=null,this.Buttons=[],this.LeftButtonWidth=0,this.IsMinSize=!1,this.LogoTextColor=m.FrameLogo.TextColor,this.LogoTextFont=m.FrameLogo.Font,this.GlobalOption,this.PtInButtons=function(r,n){for(var e=0;e<this.Buttons.length;++e){var t=this.Buttons[e];if(t.Rect){var a=t.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(a.Left,a.Top,a.Width,a.Height),this.Canvas.isPointInPath(r,n))return{ID:t.ID,Rect:a}}}return null},this.GetBorder=function(){return this.IsHScreen?this.ChartBorder.GetHScreenBorder():this.ChartBorder.GetBorder()},this.Draw=function(){this.Buttons=[],this.DrawFrame(),this.DrawBorder(),this.SizeChange=!1,this.XYSplit=!1},this.DrawFrame=function(){},this.ClearCoordinateText=function(r){if(c.IsNonEmptyArray(this.HorizontalInfo))for(var n=0;n<this.HorizontalInfo.length;++n){var e=this.HorizontalInfo[n];e&&e.Message&&Array.isArray(e.Message)&&(e.Message[0]=e.Message[1]=null)}if(c.IsNonEmptyArray(this.VerticalInfo))for(var n=0;n<this.VerticalInfo.length;++n){var e=this.VerticalInfo[n];e&&e.Message&&Array.isArray(e.Message)&&(e.Message[0]=e.Message[1]=null)}},this.DrawBorder=function(){if(this.IsShowBorder&&!this.IsMinSize){var r=this.IsHScreen==!0?this.ChartBorder.GetHScreenBorder():this.ChartBorder.GetBorder(),n=L(r.Left),e=L(r.Top),t=L(r.Right),a=L(r.Bottom),s=t-n,o=a-e;this.BorderLine==null?(this.Canvas.strokeStyle=this.PenBorder,this.Canvas.strokeRect(n,e,s,o)):c.IsPlusNumber(this.BorderLine)&&(this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),(this.BorderLine&1)>0&&(this.Canvas.moveTo(n,e),this.Canvas.lineTo(t,e)),(this.BorderLine&2)>0&&(this.Canvas.moveTo(n,a),this.Canvas.lineTo(t,a)),(this.BorderLine&4)>0&&(this.Canvas.moveTo(n,e),this.Canvas.lineTo(n,a)),(this.BorderLine&8)>0&&(this.Canvas.moveTo(t,e),this.Canvas.lineTo(t,a)),this.Canvas.stroke())}},this.DrawTitleBG=function(){if(!(this.ChartBorder.TitleHeight<=0)){var r=this.GetBorder(),n=L(r.Left),e=L(r.Top),t=L(r.Right),a=L(this.ChartBorder.GetTopTitle()),s=t-n,o=a-e;this.Canvas.fillStyle=this.TitleBGColor,this.Canvas.fillRect(n,e,s,o),this.IsDrawTitleBottomLine&&(this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(n,L(r.TopTitle)),this.Canvas.lineTo(t,L(r.TopTitle)),this.Canvas.stroke())}},this.DrawLock=function(){this.IsLocked&&(this.LockPaint==null&&(this.LockPaint=new Fo),this.LockPaint.Canvas=this.Canvas,this.LockPaint.ChartBorder=this.ChartBorder,this.LockPaint.ChartFrame=this,this.LockPaint.Draw(!0))},this.DrawLogo=function(){var r=this.GetBorder(),n=m.FrameLogo.Text;if(c.IsString(n))if(this.Canvas.fillStyle=this.LogoTextColor,this.Canvas.font=this.LogoTextFont,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.IsHScreen){var e=r.Left+5,t=r.Top+5;this.Canvas.save(),this.Canvas.translate(e,t),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(n,0,0),this.Canvas.restore()}else{var e=r.Left+5,t=r.Bottom-5;this.Canvas.fillText(n,e,t)}},this.CalculateLock=function(){this.IsLocked&&(this.LockPaint==null&&(this.LockPaint=new Fo),this.LockPaint.Canvas=this.Canvas,this.LockPaint.ChartBorder=this.ChartBorder,this.LockPaint.ChartFrame=this,this.LockPaint.Draw(!1))},this.SetLock=function(r){if(!r){this.IsLocked=!1;return}this.IsLocked=!0,this.LockPaint||(this.LockPaint=new Fo),r.Callback&&(this.LockPaint.Callback=r.Callback),r.IndexName&&(this.LockPaint.IndexName=r.IndexName),r.ID&&(this.LockPaint.LockID=r.ID),r.BG&&(this.LockPaint.BGColor=r.BG),r.Text&&(this.LockPaint.Title=r.Text),r.TextColor&&(this.LockPaint.TextColor=r.TextColor),r.Font&&(this.LockPaint.Font=r.Font),r.Count&&(this.LockPaint.LockCount=r.Count),r.MinWidth>0&&(this.LockPaint.MinWidth=r.MinWidth)},this.GetLockRect=function(){return!this.IsLocked||!this.LockPaint?null:this.LockPaint.LockRect},this.ReloadResource=function(r){r||(this.PenBorder=m.FrameBorderPen,this.TitleBGColor=m.FrameTitleBGColor);for(var n in this.HorizontalInfo){var e=this.HorizontalInfo[n];e.Font&&(e.Font=m.FrameSplitTextFont),e.TextColor&&(e.TextColor=m.FrameSplitTextColor),e.LineColor&&(e.LineColor=m.FrameSplitPen)}for(var n in this.VerticalInfo){var e=this.VerticalInfo[n];e.Font&&(e.Font=m.FrameSplitTextFont),e.TextColor&&(e.TextColor=m.FrameSplitTextColor),e.LineColor&&(e.LineColor=m.FrameSplitPen)}},this.GetFontHeight=function(r){return Aa(this.Canvas,r,"擎")},this.GetScaleTextWidth=function(){}}function oC(){this.newMethod=sC,this.newMethod(),delete this.newMethod,this.ClassName="NoneFrame",this.Snapshot=function(){},this.SetSizeChage=function(r){this.SizeChange=r,this.Position={X:this.ChartBorder.UIElement.offsetLeft,Y:this.ChartBorder.UIElement.offsetTop,W:this.ChartBorder.UIElement.clientWidth,H:this.ChartBorder.UIElement.clientHeight}}}function ms(){this.newMethod=sC,this.newMethod(),delete this.newMethod,this.ClassName="AverageWidthFrame",this.DataWidth=50*V(),this.DistanceWidth=10*V(),this.MinXDistance=30*V(),this.MinYDistance=12*V(),this.CoordinateType=0,this.IsShowYText=[!0,!0],this.XBottomOffset=m.Frame.XBottomOffset,this.YTextTopOffset=m.Frame.YTopOffset,this.YTextPosition=[0,0],this.YTextPadding=[m.Frame.YTextPadding[0],m.Frame.YTextPadding[1]],this.IsShowXLine=!0,this.IsShowYLine=!0,this.YInsideOffset=0,this.YTextBaseline=0,this.MultiTextFormat=0,this.RightTextMaxWidth=0,this.ShortYLineLength=5,this.ShortXLineLength=5,this.BeforeDrawXYCallback,this.GetEventCallback,this.ToolbarButtonStyle=m.ToolbarButtonStyle,this.CloseWindowButton=ne(m.Buttons.CloseWindow),this.OverlayIndexButton=ne(m.Buttons.OverlayIndex),this.ChangeIndexButton=ne(m.Buttons.ChangeIndex),this.ModifyIndexParamButton=ne(m.Buttons.ModifyIndexParam),this.MaxMinWindowButton=ne(m.Buttons.MaxMinWindow),this.TitleWindowButton=ne(m.Buttons.TitleWindow),this.ExportDataButton=ne(m.Buttons.ExportData),this.ButtonTooltip=ne(m.Buttons.Tooltip),this.DrawPicture={BGColor:m.DrawPicture.XYCoordinate.BGColor,TextBGColor:m.DrawPicture.XYCoordinate.TextBGColor,TextColor:m.DrawPicture.XYCoordinate.TextColor,Font:m.DrawPicture.XYCoordinate.Font},this.IChartFramePainting_ReloadResource=this.ReloadResource,this.ReloadResource=function(r){this.IChartFramePainting_ReloadResource(r),r||(this.ToolbarButtonStyle=m.ToolbarButtonStyle,this.CloseWindowButton=ne(m.Buttons.CloseWindow),this.OverlayIndexButton=ne(m.Buttons.OverlayIndex),this.ChangeIndexButton=ne(m.Buttons.ChangeIndex),this.ModifyIndexParamButton=ne(m.Buttons.ModifyIndexParam),this.MaxMinWindowButton=ne(m.Buttons.MaxMinWindow),this.TitleWindowButton=ne(m.Buttons.TitleWindow),this.ButtonTooltip=ne(m.Buttons.Tooltip))},this.DrawFrame=function(){if(this.XPointCount>0){var r=this.ChartBorder.GetWidth()/(6*this.XPointCount);this.DistanceWidth=2*r,this.DataWidth=4*r}this.DrawHorizontal(),this.DrawVertical()},this.DrawTitleButton=function(r,n,e){var t=this.GetBorder();if(this.IsHScreen){var a=t.Bottom-3,s=t.RightTitle+this.ChartBorder.TitleHeight/2;this.Canvas.save(),this.Canvas.translate(s,a),this.Canvas.rotate(90*Math.PI/180);for(var o=0,h=0,l=0,u=0;u<r.length;++u){var f=r[u],C=f.Style.Size,h=l-C-f.Style.MerginLeft,D=C+"px "+f.Style.Family,v=f.Style.Color;this.Canvas.fillStyle=v,this.Canvas.font=D,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(f.Style.Text,h,0);var S={Left:s-C/2,Right:s+C/2,Bottom:a,Width:C,Height:C+f.Style.MerginLeft};S.Top=S.Bottom-C-f.Style.MerginLeft,this.Buttons.push({ID:f.ID,Rect:S}),l=h,a=S.Top}this.Canvas.restore()}else{var T=t.Right-3;t.Left;for(var o=t.Top+this.ChartBorder.TitleHeight/2,u=0;u<r.length;++u){var f=r[u],C=f.Style.Size,I=T-C-f.Style.MerginLeft,D=C+"px "+f.Style.Family,S={Left:I,Top:o-C/2,Right:I+C+f.Style.MerginLeft,Bottom:o+C/2,Width:C+f.Style.MerginLeft,Height:C},v=f.Style.Color;n&&n.X>=S.Left&&n.X<S.Right&&n.Y>=S.Top&&n.Y<=S.Bottom&&(v=f.Style.MoveOnColor,e&&(e.MouseOnToolbar={Rect:S,Item:f,Frame:this,Point:{X:n.X,Y:n.Y}})),this.Canvas.fillStyle=v,this.Canvas.font=D,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(f.Style.Text,I,o),this.Buttons.push({ID:f.ID,Rect:S}),T=I}}},this.DrawToolbarTooltip=function(r){if(r){var n=this.GetBorder(),e=null;if(r.Item.TooltipText)e=r.Item.TooltipText;else{var t="Toolbar-"+r.Item.ID;e=gt.GetText(t,0)}if(e){var a=r.Rect.Left+r.Rect.Width/2;this.Canvas.font=this.ButtonTooltip.Font,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var s=this.Canvas.measureText(e).width+8,o=this.GetFontHeight(),h=o+10;if(r.ID=="TitleButton")var l=r.Point.X,u=r.Point.Y+20;else if(xt.CLOSE_BEFOREOPEN_ID==r.Item.ID)var l=r.Rect.Right+5,u=r.Rect.Top;else if(xt.DRAW_PICTURE_DELETE==r.Item.ID||xt.DRAW_PICTURE_SETTING==r.Item.ID||r.Item.ID>=xt.DRAW_PICTURE_BUTTON_1&&r.Item.ID<=xt.DRAW_PICTURE_BUTTON_18){var l=r.Point.X,u=r.Point.Y+20;l+s>=n.ChartWidth&&(l=n.ChartWidth-s-2)}else{var l=a-s/2,u=n.Top-h;u<0&&(u=n.TopEx+1),l+s>n.ChartWidth&&(l=n.ChartWidth-s-2)}this.Canvas.fillStyle=this.ButtonTooltip.ColorBG,this.Canvas.fillRect(l,u,s,h),this.Canvas.fillStyle=this.ButtonTooltip.Color,this.Canvas.fillText(e,l+4,u+h/2)}}},this.GetYFromData=function(r,n){if(this.Logarithmic&&this.GetYLogarithmicFromData)return this.GetYLogarithmicFromData(r,n);if(n===!1)if(this.CoordinateType==1){var e=this.ChartBorder.GetHeightEx()*(r-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetTopEx()+e}else{var e=this.ChartBorder.GetHeightEx()*(r-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetBottomEx()-e}else if(this.CoordinateType==1){if(r<=this.HorizontalMin)return this.ChartBorder.GetTopEx();if(r>=this.HorizontalMax)return this.ChartBorder.GetBottomEx();var e=this.ChartBorder.GetHeightEx()*(r-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetTopEx()+e}else{if(r<=this.HorizontalMin)return this.ChartBorder.GetBottomEx();if(r>=this.HorizontalMax)return this.ChartBorder.GetTopEx();var e=this.ChartBorder.GetHeightEx()*(r-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetBottomEx()-e}},this.DrawHorizontal=function(){if(this.RightTextMaxWidth=0,!!c.IsNonEmptyArray(this.HorizontalInfo)&&!this.ChartBorder.IsShowTitleOnly){for(var r=this.ChartBorder.GetBorder(),n=r.Left,e=r.Right,t=r.Bottom,a=this.ChartBorder.GetTop(),s=this.ChartBorder.Right,o=this.ChartBorder.Left,h=o>10&&this.IsShowYText[0]===!0&&this.YTextPosition[0]!=2,l=s>10&&this.IsShowYText[1]===!0&&this.YTextPosition[1]!=2,u=null,f=V(),C=(r.BottomEx-r.TopEx)/this.HorizontalInfo.length,D=[],v,S,T,I,F=0,E=this.HorizontalInfo.length-1;E>=0;--E){var M=this.HorizontalInfo[E],O=this.GetYFromData(M.Value);if(!(O!=null&&u!=null&&Math.abs(O-u)<this.MinYDistance)){var R=L(O);if(O!=t&&this.IsShowYLine){var b=!1;c.IsPlusNumber(M.LineWidth)&&(this.Canvas.lineWidth=M.LineWidth*f,b=!0),this.Canvas.strokeStyle=M.LineColor,M.LineType==2?(this.Canvas.save(),M.LineDash?this.Canvas.setLineDash(M.LineDash):this.Canvas.setLineDash([5*f,5*f]),this.Canvas.beginPath(),this.Canvas.moveTo(n,R),this.Canvas.lineTo(e,R),this.Canvas.stroke(),this.Canvas.setLineDash([]),this.Canvas.restore()):M.LineType==3||M.LineType==8||M.LineType==9||M.LineType>0&&(m.FrameYLineDash?(this.Canvas.save(),this.Canvas.setLineDash(m.FrameYLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(n,R),this.Canvas.lineTo(e,R),this.Canvas.stroke(),this.Canvas.setLineDash([]),this.Canvas.restore()):(this.Canvas.beginPath(),this.Canvas.moveTo(n,R),this.Canvas.lineTo(e,R),this.Canvas.stroke())),b&&(this.Canvas.lineWidth=f)}var p=O;if(O>=t-2?(this.Canvas.textBaseline="bottom",F=2):O<=a+2?(this.Canvas.textBaseline="top",p+=this.YTextTopOffset,F=0):(this.Canvas.textBaseline="middle",F=1),this.Canvas.strokeStyle=M.TextColor,this.Canvas.fillStyle=M.TextColor,M.Message[0]!=null&&h&&(M.Font!=null&&(this.Canvas.font=M.Font),T=this.GetTextTopBottom(F,p),(!I||T&&!this.IsTextTopBottomOverlap(T,I))&&(this.Canvas.textAlign="right",this.Canvas.fillText(M.Message[0],n-this.YTextPadding[0],p),I=T)),M.Message[1]!=null&&l){M.Font!=null&&(this.Canvas.font=M.Font);var G=e;if(M.LineType==3){var Y=this.ShortYLineLength*V();this.Canvas.beginPath(),this.Canvas.moveTo(G,R),this.Canvas.lineTo(G+Y,R),this.Canvas.stroke(),G+=Y}if(this.Canvas.textAlign="left",Array.isArray(M.Message[1]))if(this.MultiTextFormat==1){M.ExtendData&&M.ExtendData.Font&&(this.Canvas.font=M.ExtendData.Font);var Q={Text:[{Text:M.Message[1][0],Width:this.Canvas.measureText(M.Message[1][0]).width},{Text:M.Message[1][1],Width:this.Canvas.measureText(M.Message[1][1]).width}],X:G+2,Y:p,TextBaseline:this.Canvas.textBaseline,Item:M};D.push(Q)}else if(this.MultiTextFormat==2){this.Canvas.fillText(M.Message[1][0],G+this.YTextPadding[1],p);var ht=this.Canvas.measureText("M").width;C>ht*2&&this.Canvas.fillText(M.Message[1][1],G+this.YTextPadding[1],p+ht)}else this.Canvas.fillText(M.Message[1][0],G+this.YTextPadding[1],p);else S=this.GetTextTopBottom(F,p),(!v||S&&!this.IsTextTopBottomOverlap(S,v))&&(M.TextColor2&&(this.Canvas.fillStyle=M.TextColor2),this.Canvas.fillText(M.Message[1],G+this.YTextPadding[1],p),v=S)}u=O}}c.IsNonEmptyArray(D)&&this.MultiTextFormat==1&&this.DrawHorizontalMuText(D)}},this.IsTextTopBottomOverlap=function(r,n){return n.Top>=r.Top&&n.Top<=r.Bottom||n.Bottom>=r.Top&&n.Bottom<=r.Bottom},this.GetTextTopBottom=function(r,n){var e=null,t=this.Canvas.measureText("擎").width;return r==0?e={Top:n,Bottom:n+t}:r==1?(e={Top:n-t/2},e.Bottom=e.Top+t):r==2&&(e={Bottom:n},e.Top=e.Bottom-t),e},this.DrawHorizontalMuText=function(r){for(var n=[null,null],e=0;e<r.length;++e){var t=r[e],a=t.Text[0].Width;c.IsNumber(n[0])?n[0]<a&&(n[0]=a):n[0]=a,a=t.Text[1].Width,c.IsNumber(n[1])?n[1]<a&&(n[1]=a):n[1]=a}for(var e=0;e<r.length;++e){var t=r[e],s=t.Item;this.Canvas.textBaseline=s.TextBaseline,s.ExtendData&&s.ExtendData.Font?this.Canvas.font=s.ExtendData.Font:s.Font&&(this.Canvas.font=s.Font),s.ExtendData&&s.ExtendData.PriceColor?this.Canvas.fillStyle=s.ExtendData.PriceColor:this.Canvas.fillStyle=s.TextColor,this.Canvas.textAlign="right";var h=t.X+n[1];this.Canvas.fillText(t.Text[1].Text,h,t.Y),s.ExtendData&&s.ExtendData.SplitColor?this.Canvas.fillStyle=s.ExtendData.SplitColor:this.Canvas.fillStyle=s.TextColor,this.Canvas.textAlign="left";var o=this.Canvas.measureText("/").width;this.Canvas.fillText("/",h,t.Y),s.ExtendData&&s.ExtendData.PercentageColor?this.Canvas.fillStyle=s.ExtendData.PercentageColor:this.Canvas.fillStyle=s.TextColor,this.Canvas.textAlign="right";var h=t.X+n[1]+n[0]+o;this.Canvas.fillText(t.Text[0].Text,h,t.Y);var l=n[1]+n[0]+o*4;this.RightTextMaxWidth<l&&(this.RightTextMaxWidth=l)}},this.DrawInsideClientHorizontal=function(){var r=this.GetBorder();if(r.DayBorder&&c.IsNonEmptyArray(r.DayBorder))var e=r.DayBorder[0],n=e.LeftEx,e=r.DayBorder[r.DayBorder.length-1],t=e.RightEx,a=r.Bottom,s=r.TopTitle;else var n=r.LeftEx,t=r.RightEx,a=r.Bottom,s=r.TopTitle;for(var o=V(),h=null,l=null,u=this.HorizontalInfo.length-1;u>=0;--u){var e=this.HorizontalInfo[u],f=this.GetYFromData(e.Value);if(!(f!=null&&h!=null&&Math.abs(f-h)<this.MinYDistance)){if(e.Message[2]){e.Font!=null&&(this.Canvas.font=e.Font),this.Canvas.fillStyle=e.TextColor,this.Canvas.textAlign="left";var C=f;f>=a-2?this.Canvas.textBaseline="bottom":f<=s+2?(this.Canvas.textBaseline="top",C+=this.YTextTopOffset):this.Canvas.textBaseline="middle";var D={X:n,Y:C,Text:{BaseLine:this.Canvas.textBaseline,TextAlign:this.Canvas.textAlign,Font:this.Canvas.font,Value:e.Message[0]}};(!this.IsOverlayMaxMin||!this.IsOverlayMaxMin(D))&&(this.Canvas.fillText(e.Message[2],n+1*o,C),(l==null||l>C)&&(this.YInsideOffset=this.Canvas.measureText(e.Message[2]).width+4*V(),l=C))}if(e.Message[3]){e.Font!=null&&(this.Canvas.font=e.Font),this.Canvas.fillStyle=e.TextColor,this.Canvas.textAlign="right";var C=f;f>=a-2?this.Canvas.textBaseline="bottom":f<=s+2?(this.Canvas.textBaseline="top",C+=this.YTextTopOffset):this.Canvas.textBaseline="middle";var v=this.Canvas.measureText(e.Message[3]).width,D={X:t-v,Y:C,Text:{BaseLine:this.Canvas.textBaseline,TextAlign:this.Canvas.textAlign,Font:this.Canvas.font,Value:e.Message[1]}};(!this.IsOverlayMaxMin||!this.IsOverlayMaxMin(D))&&this.Canvas.fillText(e.Message[3],t-1*o,C)}h=f}}},this.DrawInsideHorizontal=function(){if(this.IsHScreen!==!0&&!this.IsMinSize&&!this.ChartBorder.IsShowTitleOnly&&!(this.IsShowYText[0]===!1&&this.IsShowYText[1]===!1)){this.DrawInsideClientHorizontal();var r=this.ChartBorder.GetBorder(),n=r.Left,e=r.Right,t=r.Bottom,a=r.TopTitle,s=this.ChartBorder.Right,o=this.ChartBorder.Left;this.ChartBorder.TitleHeight;var h=(o<10||this.YTextPosition[0]==2)&&this.IsShowYText[0]===!0,l=(s<10||this.YTextPosition[1]==2)&&this.IsShowYText[1]===!0;if(h||l)for(var u=V(),f=null,C=null,D=this.HorizontalInfo.length-1;D>=0;--D){var v=this.HorizontalInfo[D],S=this.GetYFromData(v.Value);if(!(S!=null&&f!=null&&Math.abs(S-f)<this.MinYDistance)){if(v.Message[0]!=null&&h){v.Font!=null&&(this.Canvas.font=v.Font),this.Canvas.fillStyle=v.TextColor,this.Canvas.textAlign="left";var T=S;S>=t-2?this.Canvas.textBaseline="bottom":S<=a+2?(this.Canvas.textBaseline="top",T+=this.YTextTopOffset):this.YTextBaseline==1?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle";var I={X:n,Y:T,Text:{BaseLine:this.Canvas.textBaseline,TextAlign:this.Canvas.textAlign,Font:this.Canvas.font,Value:v.Message[0]}};(!this.IsOverlayMaxMin||!this.IsOverlayMaxMin(I))&&(this.Canvas.fillText(v.Message[0],n+1*u,T),(C==null||C>T)&&(this.YInsideOffset=this.Canvas.measureText(v.Message[0]).width+4*V(),C=T))}if(v.Message[1]!=null&&l){v.Font!=null&&(this.Canvas.font=v.Font),this.Canvas.fillStyle=v.TextColor,this.Canvas.textAlign="right";var T=S;if(S>=t-2?this.Canvas.textBaseline="bottom":S<=a+2?(this.Canvas.textBaseline="top",T+=this.YTextTopOffset):this.YTextBaseline==1?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",Array.isArray(v.Message[1]))var F=v.Message[1][0];else var F=v.Message[1];var E=this.Canvas.measureText(F).width,I={X:e-E,Y:T,Text:{BaseLine:this.Canvas.textBaseline,TextAlign:this.Canvas.textAlign,Font:this.Canvas.font,Value:v.Message[1]}};(!this.IsOverlayMaxMin||!this.IsOverlayMaxMin(I))&&this.Canvas.fillText(F,e-1*u,T)}f=S}}}},this.GetXFromIndex=function(r){var n=this.XPointCount;if(n==1)return r==0?this.ChartBorder.GetLeft():this.ChartBorder.GetRight();if(n<=0)return this.ChartBorder.GetLeft();if(r>=n)return this.ChartBorder.GetRight();var e=this.ChartBorder.GetLeft()+this.ChartBorder.GetWidth()*r/n;return e},this.DrawVertical=function(){var r=this.GetBorder(),n=r.TopTitle,e=r.Bottom,t=r.RightEx,a=V();if(!(this.ChartBorder.Bottom<=5*V()))for(var s=null,o=null,h=0;h<this.VerticalInfo.length;++h){var l=this.GetXFromIndex(this.VerticalInfo[h].Value);if(l>t)break;if(!(s!=null&&Math.abs(l-s)<this.MinXDistance)){var u=this.VerticalInfo[h],f=L(l);if(this.IsShowXLine&&(u.LineType==2?(this.Canvas.strokeStyle=this.VerticalInfo[h].LineColor,u.LineDash?this.Canvas.setLineDash(u.LineDash):this.Canvas.setLineDash([5*a,5*a]),this.Canvas.beginPath(),this.Canvas.moveTo(f,n),this.Canvas.lineTo(f,e),this.Canvas.stroke(),this.Canvas.setLineDash([])):u.LineType==3||u.LineType>0&&(m.FrameXLineDash?(this.Canvas.strokeStyle=this.VerticalInfo[h].LineColor,this.Canvas.setLineDash(m.FrameXLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(f,n),this.Canvas.lineTo(f,e),this.Canvas.stroke(),this.Canvas.setLineDash([])):(this.Canvas.strokeStyle=this.VerticalInfo[h].LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(f,n),this.Canvas.lineTo(f,e),this.Canvas.stroke()))),u.BG&&u.BG.Color){var C=u.BG;this.Canvas.fillStyle=C.Color;var D=this.GetXFromIndex(C.Index.Start),v=this.GetXFromIndex(C.Index.End),S=this.ChartBorder.Bottom;c.IsNumber(C.Height)&&(S=C.Height);var T={Left:D,Width:v-D,Top:r.Bottom,Height:S};this.Canvas.fillRect(T.Left,T.Top,T.Width,T.Height)}if(this.VerticalInfo[h].Message[0]!=null){this.VerticalInfo[h].Font!=null&&(this.Canvas.font=this.VerticalInfo[h].Font);var I=0;this.Canvas.fillStyle=u.TextColor,this.Canvas.strokeStyle=u.TextColor;var F=this.Canvas.measureText(this.VerticalInfo[h].Message[0]).width;if(l<F/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",I=l):l+F/2>=this.ChartBorder.GetChartWidth()?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top",I=l-F):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top",I=l-F/2),o==null||I>o){var E=e;if(u.LineType==3){var M=this.ShortXLineLength*a;this.Canvas.beginPath(),this.Canvas.moveTo(f,E),this.Canvas.lineTo(f,E+M),this.Canvas.stroke(),E+=M+2*a}this.Canvas.fillText(this.VerticalInfo[h].Message[0],l,E+this.XBottomOffset),o=I+F}}s=l}}},this.GetYData=function(r,n){return this.Logarithmic&&this.GetYLogarithmicFromData?this.GetYLogarithmicData(r):this.CoordinateType==1?n==!1?(r-this.ChartBorder.GetTopEx())/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin:r<this.ChartBorder.GetTopEx()?this.HorizontalMin:r>this.ChartBorder.GetBottomEx()?this.HorizontalMax:(r-this.ChartBorder.GetTopEx())/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin:n==!1?(this.ChartBorder.GetBottomEx()-r)/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin:r<this.ChartBorder.GetTopEx()?this.HorizontalMax:r>this.ChartBorder.GetBottomEx()?this.HorizontalMin:(this.ChartBorder.GetBottomEx()-r)/this.ChartBorder.GetHeightEx()*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin},this.GetXData=function(r){return r<=this.ChartBorder.GetLeft()?0:r>=this.ChartBorder.GetRight()?this.XPointCount:(r-this.ChartBorder.GetLeft())*(this.XPointCount*1/this.ChartBorder.GetWidth())},this.DrawPictureXCoordinate=function(r,n,e){if(!this.IsHScreen&&n&&c.IsNonEmptyArray(n.Points)){var t=this.GetBorder(),a=t.Left,s=t.Right;this.Canvas.font=this.DrawPicture.Font;var o=this.GetFontHeight();if(n.X){var h=n.X,l=h.Min.X,u=h.Max.X;l<a&&(l=a),u>s&&(u=s),this.Canvas.fillStyle=this.DrawPicture.BGColor,this.Canvas.fillRect(l,t.Bottom,u-l,o)}for(var f=0;f<n.Points.length;++f){var C=n.Points[f];if(!(C.X<a||C.X>s)){var D=this.GetXData(C.X,!1),D=Math.round(D),v=this.GetKItem(D);if(v){var S=c.FormatDateString(v.Date,null);k.IsMinutePeriod(e.Period)&&(S+=" "+c.FormatTimeString(v.Time,"HH:MM"));var T=this.Canvas.measureText(S).width+2,I=C.X-T/2;I<a&&(I=a),this.Canvas.fillStyle=this.DrawPicture.TextBGColor,this.Canvas.fillRect(I,t.Bottom,T,o),this.Canvas.fillStyle=this.DrawPicture.TextColor;var F=t.Bottom+o;this.Canvas.fillText(S,I+1,F)}}}}},this.GetKItem=function(r){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return null;var n=this.Data.DataOffset+r;return this.Data.Data[n]},this.DrawPictureYCoordinate=function(r,n,e){if(!this.IsHScreen&&n&&c.IsNonEmptyArray(n.Points)){var t=this.GetBorder(),a=t.TopEx,s=t.BottomEx,o=t.Right;this.Canvas.font=this.DrawPicture.Font;var h=this.GetFontHeight();this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var l=2;e&&e.Symbol&&(l=fe(e.Symbol));for(var u=0,f=0;f<n.Points.length;++f){var C=n.Points[f],D=this.GetYData(C.Y),v=D.toFixed(l),S=this.Canvas.measureText(v).width;u<S&&(u=S),n.Points[f].Text=v}if(u+=this.YTextPadding[1]+2,n.Y){var T=n.Y,I=T.Min.Y,F=T.Max.Y;T.Min.Y<a&&(I=a),T.Max.Y>s&&(F=s),this.Canvas.fillStyle=this.DrawPicture.BGColor,this.Canvas.fillRect(o,I,u+5,F-I)}for(var f=0;f<n.Points.length;++f){var C=n.Points[f];if(!(C.Y<a||C.Y>s)){this.Canvas.fillStyle=this.DrawPicture.TextBGColor,this.Canvas.fillRect(o,C.Y-h/2,u,h),this.Canvas.fillStyle=this.DrawPicture.TextColor;var E=C.Y+h/2;this.Canvas.fillText(C.Text,o+this.YTextPadding[1],E)}}}},this.DrawPicturePointYCoordinate=function(r,n){if(!this.IsHScreen&&r.GetYCoordinatePoint){var e=r.GetYCoordinatePoint();if(c.IsNonEmptyArray(e)){var t=this.GetBorder(),a=t.TopEx,s=t.BottomEx,o=t.Right;this.Canvas.font=this.DrawPicture.Font;var h=this.GetFontHeight();this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var l=2;n&&n.Symbol&&(l=fe(n.Symbol));for(var u=0;u<e.length;++u){var f=e[u];if(f&&!(f.Y<a||f.Y>s)){var C=f.YValue.toFixed(l),D=this.Canvas.measureText(C).width+2;D+=this.YTextPadding[1],this.Canvas.fillStyle=this.DrawPicture.TextBGColor,this.Canvas.fillRect(o,f.Y-h/2,D,h),this.Canvas.fillStyle=this.DrawPicture.TextColor;var v=f.Y+h/2;this.Canvas.fillText(C,o+this.YTextPadding[1],v)}}}}},this.GetCustomItemTextInfo=function(r,n,e){var t=n?r.Message[0]:r.Message[1],a=[],s=0;if(Array.isArray(t)){for(var o=0;o<t.length;++o){var r=t[o];if(r.Type===1)a.push({Type:r.Type});else{var h=this.Canvas.measureText(t[o].Text).width;h>s&&(s=h),a.push({Text:t[o].Text,Width:h+2*e})}}s>0&&(s+=2*e)}else s=this.Canvas.measureText(t).width+2*e,a.push({Text:t,Width:s});return{MaxWidth:s,Text:a}},this.DrawCustomItem=function(r,n){if(!(!r.Message[1]&&!r.Message[0])){if(r.Value>this.HorizontalMax||r.Value<this.HorizontalMin){this.SendDrawCountDownEvent({IsShow:!1});return}var e=this.GetBorder(),t=e.Left,a=e.Right,s=e.Bottom,o=e.Top,h=this.ChartBorder.Right,l=this.ChartBorder.Left;this.ChartBorder.TitleHeight,this.IsHScreen&&(l=this.ChartBorder.Top,h=this.ChartBorder.Bottom,o=e.Top,s=e.Bottom);var u=V(),f=18*u,C=f,D=this.GetYFromData(r.Value),v=0,S;if(r.ExtendData&&r.ExtendData.Custom){var T=r.ExtendData.Custom;c.IsNumber(T.Position)&&(v=T.Position),T.EmptyBGColor&&(S=T.EmptyBGColor)}if(r.Message[0])if(l<10||v==1){r.Font!=null&&(this.Canvas.font=r.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(r,!0,u),F=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;var M=r.LineColor,O=this.RGBToStruct(r.LineColor);O&&(M="rgba("+O.R+", "+O.G+", "+O.B+", "+m.FrameLatestPrice.BGAlpha+")");for(var R=D,b=0;b<I.Text.length;++b){var p=I.Text[b];if(this.IsHScreen){var G=o,Y=R-C/2-1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,C,p.Width),this.DrawHScreenText({X:R,Y:G},{Text:p.Text,Color:r.TextColor,XOffset:1*u,YOffset:2*u}),b==0&&this.DrawLine(G+p.Width,s,R,r.LineColor,r.LineType,r),R-=C+1*u}else if(p.Type!==1){var G=R-C/2-1*u,Y=t+1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,p.Width,C),this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(p.Text,Y+1*u,R),b==0&&this.DrawLine(Y+p.Width,a,R,r.LineColor,r.LineType,r),R+=C+1*u}}}else{r.Font!=null&&(this.Canvas.font=r.Font),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(r,!0,u),F=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;for(var R=D,b=0;b<I.Text.length;++b){var p=I.Text[b];if(this.IsHScreen){if(b==0)var G=o-p.Width;else var G=o-F;var Y=R-C/2-1*u;this.Canvas.fillStyle=r.LineColor,this.Canvas.fillRect(Y,G,C,p.Width),this.DrawHScreenText({X:R,Y:G},{Text:p.Text,Color:r.TextColor,XOffset:1*u,YOffset:2*u}),b==0&&this.DrawLine(G+p.Width,s,R,r.LineColor,r.LineType,r),R-=C+1*u}else{var G=R-C/2-1*u;if(b==0)var Q=t-p.Width,Y=t;else var Q=t-F,Y=t-(F-p.Width);S?(this.Canvas.fillStyle=S,this.Canvas.fillRect(Q-1,G,p.Width+1,C),this.Canvas.strokeStyle=r.LineColor,this.Canvas.strokeRect(L(Q-1),L(G),L(p.Width+1),L(C)),this.Canvas.fillStyle=r.LineColor,this.Canvas.fillText(p.Text,Y-1*u,R)):(this.Canvas.fillStyle=r.LineColor,this.Canvas.fillRect(Q,G,p.Width,C),this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(p.Text,Y-1*u,R)),b==0&&this.DrawLine(t,a,R,r.LineColor,r.LineType,r),R+=C+1*u}}}else if(r.Message[1])if(h<10||v==1){r.Font!=null&&(this.Canvas.font=r.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(r,!1,u),F=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;var M=r.LineColor,O=this.RGBToStruct(r.LineColor);O&&(M="rgba("+O.R+", "+O.G+", "+O.B+", "+m.FrameLatestPrice.BGAlpha+")");for(var R=D,b=0;b<I.Text.length;++b){var p=I.Text[b];if(this.IsHScreen){var G=s-p.Width,Y=R-C/2-1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,C,p.Width),this.DrawHScreenText({X:R,Y:G},{Text:p.Text,Color:r.TextColor,XOffset:1*u,YOffset:2*u}),b==0&&this.DrawLine(o,G,R,r.LineColor,r.LineType,r),R-=C+1*u}else if(p.Type===1){if(this.GetEventCallback){var G=R-C/2-1*u,ht={Top:G,Right:a,Height:null,IsShow:!0,BGColor:r.LineColor,TextColor:r.TextColor,PixelTatio:u,Position:"Right",IsInside:!0};this.SendDrawCountDownEvent(ht)&&c.IsPlusNumber(ht.Height)&&(R+=C+1*u)}}else{var G=R-C/2-1*u,Y=a-p.Width;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,p.Width,C),this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(p.Text,Y+1*u,R),b==0&&this.DrawLine(t,Y,R,r.LineColor,r.LineType,r),R+=C+1*u}}if((r.Type==3||r.Type==4)&&r.Title){var Ct=this.Canvas.measureText(r.Title).width+2*u;if(this.IsHScreen){var G=s-p.Width-Ct,Y=D-C/2-1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,C,Ct),this.DrawHScreenText({X:D,Y:G},{Text:r.Title,Color:r.TextColor,XOffset:1*u,YOffset:2*u})}else{var G=D-C/2-1*u,Y=a-F-Ct-1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,Ct,C),this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(r.Title,Y+1*u,D)}}}else{r.Font!=null&&(this.Canvas.font=r.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(r,!1,u),F=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;var lt=null;n&&n.has(3)&&(lt=n.get(3));for(var R=D,dt={},b=0;b<I.Text.length;++b){var p=I.Text[b];if(this.IsHScreen){var G=s,Y=R-C/2-1*u;this.Canvas.fillStyle=r.LineColor,this.Canvas.fillRect(Y,G,C,p.Width),this.DrawHScreenText({X:R,Y:G},{Text:p.Text,Color:r.TextColor,XOffset:1*u,YOffset:2*u}),b==0&&this.DrawLine(o,G,R,r.LineColor,r.LineType,r),R-=C+1*u}else if(p.Type===1){if(this.GetEventCallback){var G=R-C/2-1*u,ht={Top:G,Left:a,Right:this.ChartBorder.GetChartWidth(),Height:null,IsShow:!0,BGColor:r.LineColor,TextColor:r.TextColor,PixelTatio:u,Position:"Right",IsInside:!1};this.SendDrawCountDownEvent(ht)&&c.IsPlusNumber(ht.Height)&&(R+=C+1*u)}}else{var G=R-C/2-1*u;if(b==0){var Y=a;dt.Left=Y,lt&&G<lt.Rect.Bottom&&(R=lt.Rect.Bottom,G=R-C/2-1*u)}else var Y=a+F-p.Width;S?(this.Canvas.fillStyle=S,this.Canvas.fillRect(Y,G,p.Width+1,C),this.Canvas.strokeStyle=r.LineColor,this.Canvas.strokeRect(L(Y),L(G),B(p.Width+1),B(C)),this.Canvas.fillStyle=r.LineColor,this.Canvas.fillText(p.Text,Y+2*u,R)):(this.Canvas.fillStyle=r.LineColor,this.Canvas.fillRect(Y,G,p.Width,C),this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(p.Text,Y+1*u,R)),b==0&&this.DrawLine(t,a,D,r.LineColor,r.LineType,r),R+=C+1*u,dt.Bottom=R}}if(n&&c.IsNumber(dt.Left)&&c.IsNumber(dt.Bottom)&&n.set(3,{Rect:dt,Item:r}),(r.Type==3||r.Type==4)&&r.Title){var M=r.LineColor,O=this.RGBToStruct(r.LineColor);O&&(M="rgba("+O.R+", "+O.G+", "+O.B+", "+m.FrameLatestPrice.BGAlpha+")");var Ct=this.Canvas.measureText(r.Title).width+2*u;if(this.IsHScreen){var G=s-Ct,Y=D-C/2-1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,C,Ct),this.DrawHScreenText({X:D,Y:G},{Text:r.Title,Color:r.TextColor,XOffset:1*u,YOffset:2*u})}else{var G=D-C/2-1*u,Y=a-Ct-1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,Ct,C),this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(r.Title,Y+1*u,D)}}}}},this.SendDrawCountDownEvent=function(r){if(!this.GetEventCallback)return!1;var n=this.GetEventCallback(et.ON_DRAW_COUNTDOWN);return!n||!n.Callback?!1:(n.Callback(n,r,this),!0)},this.DrawDotLine=function(r,n,e,t,a){var s=V();this.Canvas.save(),this.Canvas.strokeStyle=t,a&&c.IsPlusNumber(a.LineWidth)&&(this.Canvas.lineWidth=a.LineWidth*s),a.LineDash?this.Canvas.setLineDash(a.LineDash):this.Canvas.setLineDash([5*s,5*s]),this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(L(e),r),this.Canvas.lineTo(L(e),n)):(this.Canvas.moveTo(r,L(e)),this.Canvas.lineTo(n,L(e))),this.Canvas.stroke(),this.Canvas.restore()},this.DrawLine=function(r,n,e,t,a,s){if(a!=-1)if(a==0){var o=V();this.Canvas.strokeStyle=t;var h=!1;s&&c.IsPlusNumber(s.LineWidth)&&(this.Canvas.lineWidth=s.LineWidth*o,h=!0),this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(L(e),r),this.Canvas.lineTo(L(e),n)):(this.Canvas.moveTo(r,L(e)),this.Canvas.lineTo(n,L(e))),this.Canvas.stroke(),h&&(this.Canvas.lineWidth=o)}else this.DrawDotLine(r,n,e,t,s)},this.DrawHScreenText=function(r,n){this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=n.Color,this.Canvas.save(),this.Canvas.translate(r.X,r.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(n.Text,n.XOffset,n.YOffset),this.Canvas.restore()},this.RGBToStruct=function(r){if(/^(rgb|RGB)/.test(r)){var n=r.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),e={};return n.length!=3?null:(e.R=Number(n[0]),e.G=Number(n[1]),e.B=Number(n[2]),e)}return null},this.GetScaleTextWidth=function(){this.ChartBorder.GetBorder();var r=V();if(this.IsHScreen)var n=this.ChartBorder.Top,e=this.ChartBorder.Bottom,t=n>10*r&&this.IsShowYText[0]===!0&&this.YTextPosition[0]!=2,a=e>10*r&&this.IsShowYText[1]===!0&&this.YTextPosition[1]!=2;else var s=this.ChartBorder.Right,o=this.ChartBorder.Left,t=o>10&&this.IsShowYText[0]===!0&&this.YTextPosition[0]!=2,a=s>10&&this.IsShowYText[1]===!0&&this.YTextPosition[1]!=2;if(!a&&!t)return null;var h={Left:null,Right:null},l=0,u=!1;this.YSplitOperator&&this.YSplitOperator.CoordinateType==1&&(u=!0);for(var f=0;f<this.HorizontalInfo.length;++f){var C=null,D=this.HorizontalInfo[f];if(D&&(D.Font!=null&&(this.Canvas.font=D.Font),D.Message[0]!=null&&t&&(C=this.Canvas.measureText(D.Message[0]).width,(h.Left==null||h.Left<C)&&(h.Left=C)),D.Message[1]!=null&&a)){if(D.Font!=null&&(this.Canvas.font=D.Font),Array.isArray(D.Message[1])){if(this.MultiTextFormat==1){if(D.ExtendData){D.ExtendData.Font&&(this.Canvas.font=D.ExtendData.Font);var v=this.Canvas.measureText(D.Message[1][0]).width,S=this.Canvas.measureText(D.Message[1][1]).width,T=this.Canvas.measureText("/").width;C=v+T,l<S&&(l=S)}}else if(this.MultiTextFormat==2){C=this.Canvas.measureText(D.Message[1][0]).width;var I=this.Canvas.measureText(D.Message[1][1]).width;C<I&&(C=I)}else if(C=this.Canvas.measureText(D.Message[1][0]).width,u){var F=this.Canvas.measureText("-00.00%").width;F>C&&(C=F)}}else C=this.Canvas.measureText(D.Message[1]).width;(h.Right==null||h.Right<C)&&(h.Right=C)}}return c.IsNumber(h.Right)&&(h.Right+=l),c.IsNumber(h.Left)&&(h.Left+=this.YTextPadding[0]),c.IsNumber(h.Right)&&(h.Right+=this.YTextPadding[1]),{TextWidth:h}},this.ClearToolbar=function(){if(this.ToolbarID){var r=document.getElementById(this.ToolbarID);r&&(this.ChartBorder.UIElement.parentNode.removeChild(r),this.ToolbarRect=null)}},this.HideToolbar=function(){if(this.ToolbarID){this.ToolbarRect=null;var r=document.getElementById(this.ToolbarID);r&&r.style.display!="none"&&(r.style.display="none")}}}function Zn(){this.newMethod=ms,this.newMethod(),delete this.newMethod,this.ClassName="MinuteFrame",this.DataWidth=1*V(),this.DistanceWidth=1*V(),this.MinuteCount=243,this.BeforeBGColor=m.Minute.Before.BGColor,this.AfterBGColor=m.Minute.After.BGColor,this.MultiDayBorderPen=m.MultiDayBorderPen,this.CustomHorizontalInfo=[],this.RightFrame=null,this.ToolbarID=oe(),this.ReDrawToolbar=!1,this.DayCount=1,this.ModifyIndex=m.MinuteToolbar.ModifyIndex,this.ChangeIndex=m.MinuteToolbar.ChangeIndex,this.CloseIndex=m.MinuteToolbar.CloseIndex,this.MaxMinWindow=m.MinuteToolbar.MaxMinWindow,this.TitleWindow=m.MinuteToolbar.TitleWindow,this.ExportData=m.MinuteToolbar.ExportData,this.OverlayIndex=m.MinuteToolbar.OverlayIndex,this.ModifyIndexEvent,this.ChangeIndexEvent,this.ToolbarRect=null,this.IsShowPositionTitle=!1,this.LastCalculateStatus={Width:0,XPointCount:0},this.BeforeCloseIcon=ne(m.Minute.Before.CloseIcon),this.IsShowCloseButton=!0,this.BeforeOpenVerticalInfo=[],this.AfterCloseVerticalInfo=[],this.DrawFrame=function(){this.IsMinSize||(this.SplitXYCoordinate(),this.DrawBeforeDataBG(),this.YInsideOffset=0,this.BeforeDrawXYCallback&&this.BeforeDrawXYCallback(this),this.DrawTitleBG(),this.DrawHorizontal(),this.DrawVertical()),(this.SizeChange==!0||this.ReDrawToolbar==!0)&&(this.DrawToolbar(),this.ReDrawToolbar=!1)},this.SuperDrawBorder=this.DrawBorder,this.DrawBorder=function(){if(this.IsShowBorder&&!this.IsMinSize&&(this.SuperDrawBorder(),this.Identify==1)){var r=this.ChartBorder.GetBorder(),n=L(r.Left),e=L(r.Top),t=L(r.Right);this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(n,e),this.Canvas.lineTo(t,e),this.Canvas.save(),this.Canvas.lineWidth=2*V(),this.Canvas.stroke(),this.Canvas.restore()}},this.DrawVolTitle=function(r){if(W.IsShowMinuteVolTitle(r)&&this.Identify==1){var n=V(),e=this.ChartBorder.GetLeft()+2*n+this.YInsideOffset,t=this.ChartBorder.GetTopEx()+2*n;if(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",m.Minute.VolBarColor||m.Minute.VolTitleColor){m.Minute.VolBarColor?this.Canvas.fillStyle=m.Minute.VolBarColor:this.Canvas.fillStyle=m.Minute.VolTitleColor;var a=this.YSplitOperator.LanguageID,s=gt.GetText("MVol-Vol",a);this.Canvas.fillText(s,e,t),e+=this.Canvas.measureText(s).width,e+=6*V()}this.IsShowPositionTitle&&(s=gt.GetText("MVol-Position",a),this.Canvas.fillStyle=m.Minute.PositionColor,this.Canvas.fillText(s,e,t))}},this.DrawToolbar=function(){if(this.ToolbarButtonStyle!=1&&m.IsDOMFrameToolbar!==!0&&!(typeof q.default>"u")&&!(this.Identify<2)&&this.ChartBorder.UIElement){var r=document.getElementById(this.ToolbarID);if(!(r&&this.SizeChange==!1&&this.ReDrawToolbar==!1)){if(r||(r=document.createElement("div"),r.className="klineframe-toolbar",r.id=this.ToolbarID,r.oncontextmenu=function(){return!1},r.setAttribute("identify",this.Identify.toString()),this.ChartBorder.UIElement.parentNode.appendChild(r)),!this.ModifyIndex&&!this.ChangeIndex&&!this.OverlayIndex&&!this.CloseIndex){r.style.display!="none"&&(r.style.display="none");return}var n=V(),e=parseInt(this.ChartBorder.UIElement.parentElement.style.width.replace("px",""));parseInt(this.ChartBorder.UIElement.parentElement.style.height.replace("px",""));var t=100,a=this.ChartBorder.GetTitleHeight(),s=e-this.ChartBorder.Right/n-t,o=this.ChartBorder.GetTop()/n;if(!(this.ToolbarRect&&this.ToolbarRect.Left==s&&this.ToolbarRect.Top==o&&this.ToolbarRect.Width==t&&this.ToolbarRect.Height==a/n)){this.ToolbarRect={Left:s,Top:o,Width:t,Height:a/n};var h="<span class='index_param icon iconfont icon-index_param' id='modifyindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='调整指标参数'></span>",l="<span class='index_change icon iconfont icon-change_index' id='changeindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='切换指标'></span>",u="<span class='index_close icon iconfont icon-close' id='closeindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='关闭指标窗口'></span>",f=h+l;this.CloseIndex&&(f+=u),r.style.left=s+"px",r.style.top=o+"px",r.style.width=t+"px",r.style.height=a/n+"px",r.innerHTML=f,this.ChartBorder.UIElement.JSChartContainer,this.Identify,this.ModifyIndex?typeof this.ModifyIndexEvent=="function"&&(0,q.default)("#"+r.id+" .index_param").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},this.ModifyIndexEvent):(0,q.default)("#"+r.id+" .index_param").hide(),this.ChangeIndex?typeof this.ChangeIndexEvent=="function"&&(0,q.default)("#"+r.id+" .index_change").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,IsOverlay:!1},this.ChangeIndexEvent):(0,q.default)("#"+r.id+" .index_change").hide(),(0,q.default)("#"+r.id+" .index_close").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},function(C){var D=C.data.Chart,v=C.data.Identify;D.RemoveIndexWindow(v)}),r.style.display="block"}}}},this.DrawToolbarV2=function(r,n){if(m.IsDOMFrameToolbar!==!0&&(this.Identify==0&&this.IsShowCloseButton&&this.DrawCloseBeforeButton(r,n),!(this.ChartBorder.TitleHeight<5)&&!(this.Identify==0||this.Identify==1))){var e=[];if(this.CloseIndex&&e.push({ID:xt.CLOSE_INDEX_WINDOW,Style:this.CloseWindowButton}),this.MaxMinWindow&&e.push({ID:xt.MAX_MIN_WINDOW,Style:this.MaxMinWindowButton}),this.TitleWindow&&e.push({ID:xt.TITLE_WINDOW,Style:this.TitleWindowButton}),this.ExportData&&e.push({ID:xt.EXPORT_DATA,Style:this.ExportDataButton}),this.OverlayIndex&&e.push({ID:xt.OVERLAY_INDEX,Style:this.OverlayIndexButton}),this.ChangeIndex&&e.push({ID:xt.CHANGE_INDEX,Style:this.ChangeIndexButton}),this.ModifyIndex&&e.push({ID:xt.MODIFY_INDEX_PARAM,Style:this.ModifyIndexParamButton}),c.IsNonEmptyArray(this.CustomToolbar))for(var t=0;t<this.CustomToolbar.length;++t){var a=this.CustomToolbar[t];a.ID&&a.Style&&e.push({ID:a.ID,Style:a.Style,TooltipText:a.TooltipText})}this.DrawTitleButton(e,r,n)}},this.DrawCloseBeforeButton=function(r,n){if(this.Identify==0){var e=this.ChartBorder.GetBorder();if(!e.DayBorder&&!(this.ChartBorder.LeftExtendWidth<10)){var t={Left:e.Left,Top:e.TopEx,Width:this.BeforeCloseIcon.Size,Height:this.BeforeCloseIcon.Size};t.Right=t.Left+this.BeforeCloseIcon.Size,t.Bottom=t.Top+this.BeforeCloseIcon.Size;var a={Rect:t,Name:"集合竞价关闭按钮",ID:xt.CLOSE_BEFOREOPEN_ID},s=this.BeforeCloseIcon.Color;r&&r.X>=t.Left&&r.X<t.Right&&r.Y>=t.Top&&r.Y<=t.Bottom&&(s=this.BeforeCloseIcon.MoveOnColor,n&&(n.MouseOnToolbar={Rect:t,Item:a,Frame:this,Point:{X:r.X,Y:r.Y}}));var o=this.BeforeCloseIcon.Size+"px "+this.BeforeCloseIcon.Family;this.Canvas.font=o,this.Canvas.fillStyle=s,this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.fillText(this.BeforeCloseIcon.Text,e.Left,e.TopEx),this.Buttons.push(a)}}},this.DrawMultiDayBeforeDataBG=function(r){var n=r.DayBorder,e=L(r.Top),t=L(r.Bottom),a=t-e;this.Canvas.strokeStyle=this.MultiDayBorderPen;for(var s=0;s<n.length;++s){var o=0,h=n[s],l=L(h.Left),u=L(h.LeftEx),f=u-l;f>3&&(this.Canvas.fillStyle=this.BeforeBGColor,this.Canvas.fillRect(l,e,f,a),++o);var l=L(h.RightEx),u=L(h.Right),f=u-l;f>3&&(this.Canvas.fillStyle=this.AfterBGColor,this.Canvas.fillRect(l,e,f,a),++o),o==2&&s!=n.length-1&&(this.Canvas.beginPath(),this.Canvas.moveTo(u,e),this.Canvas.lineTo(u,t),this.Canvas.stroke())}},this.DrawCallAuctionVertical=function(r,n,e,t){if(n){var a=e.TopTitle,s=e.Bottom;e.Left;var o=e.LeftEx,h=V(),l=null,u=null;for(var f in r){var C=r[f],D=this.GetLeftExtendXFromIndex(C.Value,n);if(D>o)break;if(!(l!=null&&Math.abs(D-l)<this.MinXDistance)){var v=L(D);if(this.IsShowXLine&&(C.LineType==2?(this.Canvas.strokeStyle=C.LineColor,this.Canvas.setLineDash([5*h,5*h]),this.Canvas.beginPath(),this.Canvas.moveTo(v,a),this.Canvas.lineTo(v,s),this.Canvas.stroke(),this.Canvas.setLineDash([])):C.LineType==3||C.LineType>0&&(m.FrameXLineDash?(this.Canvas.strokeStyle=C.LineColor,this.Canvas.setLineDash(m.FrameXLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(v,a),this.Canvas.lineTo(v,s),this.Canvas.stroke(),this.Canvas.setLineDash([])):(this.Canvas.strokeStyle=C.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(v,a),this.Canvas.lineTo(v,s),this.Canvas.stroke()))),C.Message[0]!=null&&this.ChartBorder.Bottom>5*h){C.Font!=null&&(this.Canvas.font=C.Font);var S=0;this.Canvas.fillStyle=C.TextColor,this.Canvas.strokeStyle=C.TextColor;var T=this.Canvas.measureText(C.Message[0]).width;if(D<T/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",S=D):D+T/2>=e.ChartWidth?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top",S=D-T):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top",S=D-T/2),u==null||S>u){var I=s;if(C.LineType==3){var F=this.ShortXLineLength*h;this.Canvas.beginPath(),this.Canvas.moveTo(v,I),this.Canvas.lineTo(v,I+F),this.Canvas.stroke(),I+=F+2*h}this.Canvas.fillText(C.Message[0],D,I+this.XBottomOffset),u=S+T}}l=D}}}},this.DrawBeforeDataBG=function(){var r=this.ChartBorder.GetBorder();if(r.DayBorder){this.DrawMultiDayBeforeDataBG(r);return}if(!(this.ChartBorder.LeftExtendWidth<10&&this.ChartBorder.RightExtendWidth<10)){var n=L(r.Top),e=L(r.Bottom);if(this.Canvas.fillStyle=this.BeforeBGColor,this.ChartBorder.LeftExtendWidth>10){var t=L(r.Left),a=L(this.ChartBorder.GetLeft()),s=a-t,o=e-n;this.Canvas.fillRect(t,n,s,o),this.DrawCallAuctionVertical(this.BeforeOpenVerticalInfo,this.YSplitOperator.BeforeOpenData,r,!0)}if(this.ChartBorder.RightExtendWidth>10){this.Canvas.fillStyle=this.AfterBGColor;var t=L(this.ChartBorder.GetRight()),a=L(r.Right),s=a-t,o=e-n;this.Canvas.fillRect(t,n,s,o)}}},this.DrawPictureXCoordinate=function(r,n,e){if(!this.IsHScreen&&n&&c.IsNonEmptyArray(n.Points)){var t=this.GetBorder(),a=t.Left,s=t.Right;this.Canvas.font=this.DrawPicture.Font;var o=this.GetFontHeight();if(n.X){var h=n.X,l=h.Min.X,u=h.Max.X;l<a&&(l=a),u>s&&(u=s),this.Canvas.fillStyle=this.DrawPicture.BGColor,this.Canvas.fillRect(l,t.Bottom,u-l,o)}for(var f=0;f<n.Points.length;++f){var C=n.Points[f];if(!(C.X<a||C.X>s)){var D=parseInt(this.GetXData(C.X)),v=this.GetKItem(D,e);if(v){var S=c.FormatTimeString(v.Time,"HH:MM"),T=this.Canvas.measureText(S).width+2,I=C.X-T/2;I<a&&(I=a),this.Canvas.fillStyle=this.DrawPicture.TextBGColor,this.Canvas.fillRect(I,t.Bottom,T,o),this.Canvas.fillStyle=this.DrawPicture.TextColor;var F=t.Bottom+o;this.Canvas.fillText(S,I+1,F)}}}}},this.GetKItem=function(r,n){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return null;if(r<this.Data.Data.length)return this.Data.Data[r];var e=this.Data.Data[this.Data.Data.length-1],t=yr.GetTimeData(n.Symbol),a=r%t.length,s=t[a];return{Date:e.Date,Time:s}},this.SplitXYCoordinate=function(){this.XYSplit!=!1&&(this.XSplitOperator!=null&&this.XSplitOperator.Operator(),this.YSplitOperator!=null&&this.YSplitOperator.Operator())},this.GetMultiDayXFromIndex=function(r,n){var e=n.DayBorder,t=r%this.MinuteCount,a=parseInt(r/this.MinuteCount);a>=e.length&&(a=e.length-1);var s=e[a],o=this.MinuteCount-1;if(t>=o)return s.RightEx;var h=s.RightEx-s.LeftEx,l=s.LeftEx+h*t/o;return l},this.GetXFromIndex=function(r){var n=this.XPointCount-1,e=this.ChartBorder.GetBorder();if(e.DayBorder)return this.GetMultiDayXFromIndex(r,e);if(n==1)return r==0?e.LeftEx:e.RightEx;if(n<=0)return e.LeftEx;if(r>=n)return e.RightEx;var t=e.RightEx-e.LeftEx,a=e.LeftEx+t*r/n;return a},this.GetMultiDayXData=function(r,n){for(var e=n.DayBorder,t=0;t<e.length;++t){var a=e[t];if(r>=a.Left&&r<=a.Right){var s=this.MinuteCount-1,o=this.MinuteCount*t;if(r<=a.LeftEx)return 0+o;if(r>=a.RightEx)return s+o;var h=a.RightEx-a.LeftEx;return(r-a.LeftEx)*(s*1/h)+o}}},this.GetXData=function(r){var n=this.XPointCount-1;n<0&&(n=0);var e=this.ChartBorder.GetBorder();if(e.DayBorder)return this.GetMultiDayXData(r,e);if(r<=e.LeftEx)return 0;if(r>=e.RightEx)return n;var t=e.RightEx-e.LeftEx;return(r-e.LeftEx)*(n*1/t)},this.DrawCustomHorizontal=function(){if(!this.IsMinSize)for(var r in this.CustomHorizontalInfo){var n=this.CustomHorizontalInfo[r];switch(n.Type){case 0:case 1:this.DrawCustomItem(n);break}}},this.GetLeftExtendXFromIndex=function(r,n){var e=n.TotalCount-1,t=this.ChartBorder.GetBorder();if(t.DayBorder)return this.GetLeftExtendMultiDayXFromIndex(r,n,t);var a=t.Left,s=this.ChartBorder.LeftExtendWidth,o=a+s*r/e;return o},this.GetLeftExtendMultiDayXFromIndex=function(r,n,e){var t=e.DayBorder,a=t[n.Index],s=n.TotalCount-1,o=a.Left,h=a.LeftEx,l=h-o,u=o+l*r/s;return u},this.GetLeftExtendMultiDayXData=function(r,n,e){for(var t=e.DayBorder,a=0;a<t.length;++a){var s=t[a];if(r>=s.Left&&r<=s.LeftEx){if(!n[a])return null;var o=n[a].TotalCount-1,h=s.Left,l=s.LeftEx,u=l-h,f=(r-h)*(o*1/u);return{DayIndex:parseInt(a),DataIndex:f}}}},this.GetLeftExtendXData=function(r,n){var e=this.ChartBorder.GetBorder();if(e.DayBorder)return this.GetLeftExtendMultiDayXData(r,n,e);var t=n.TotalCount-1;t<0&&(t=0);var a=e.Left,s=e.LeftEx;if(r<=a)return 0;if(r>=s)return t;var o=s-a;return(r-a)*(t*1/o)},this.MoveXIndexLeft=function(r,n){if(X.Chart.Log("[MinuteFrame::MoveXIndexLeft] obj ",n),n.DataType==2){var e=n.IndexData.DayIndex,t=n.IndexData.DataIndex-r,a=-1;if(n.IndexData.Type==20)a=0;else if(n.IndexData.Type==10)a=1;else if(n.IndexData.Type==30)a=2;else return!1;for(var s=e,o=a;s>=0;--s){for(var h=n.Data[s];o>=0;--o){var l=h[o];if(!(!l.DayItem||!l.DayItem.Data)){for(t==null&&(t=l.DayItem.Data.length-1);t>=0;--t){var u=l.DayItem.Data[t];if(u){if(l.Type==10){var f=this.MinuteCount*s+t;return n.Point.X=this.GetXFromIndex(f),n.Point.Y=this.GetYFromData(u.Close),n.IndexData.CursorIndex=f,n.IndexData.DayIndex=s,n.IndexData.DataIndex=t,n.IndexData.Type=l.Type,!0}else if(l.Type==20){if(!c.IsNumber(u.Price))continue;return n.Point.X=this.GetLeftExtendXFromIndex(t,l.DayItem),n.Point.Y=this.GetLeftExtendYFromData(u.Price),n.IndexData.CursorIndex=-1,n.IndexData.DayIndex=s,n.IndexData.DataIndex=t,n.IndexData.Type=l.Type,!0}else if(l.Type==30){if(!c.IsNumber(u.Price))continue;return n.Point.X=this.GetRightExtendXFromIndex(t,l.DayItem),n.Point.Y=this.GetRightExtendYFromData(u.Price),n.IndexData.CursorIndex=-1,n.IndexData.DayIndex=s,n.IndexData.DataIndex=t,n.IndexData.Type=l.Type,!0}}}t=null}}o=2}return!1}else if(n.DataType==1){var e=n.IndexData.DayIndex,t=n.IndexData.DataIndex-r,a=-1;if(n.IndexData.Type==2)a=0;else if(n.IndexData.Type==1)a=1;else if(n.IndexData.Type==3)a=2;else return!1;for(var s=a;s>=0;--s){var l=n.Data[s];if(!(!l||!l.DayItem||!l.DayItem.Data)){for(t==null&&(t=l.DayItem.Data.length-1);t>=0;--t)if(l.Type==1){var C=l.DayItem.DataOffset,u=l.DayItem.Data[t+C];if(!u)continue;var f=t;return n.Point.X=this.GetXFromIndex(f),n.Point.Y=this.GetYFromData(u.Close),n.IndexData.CursorIndex=f,n.IndexData.DayIndex=0,n.IndexData.DataIndex=t,n.IndexData.Type=l.Type,!0}else if(l.Type==2){var u=l.DayItem.Data[t];if(!u||!c.IsNumber(u.Price))continue;return n.Point.X=this.GetLeftExtendXFromIndex(t,l.DayItem),n.Point.Y=this.GetLeftExtendYFromData(u.Price),n.IndexData.CursorIndex=-1,n.IndexData.DayIndex=0,n.IndexData.DataIndex=t,n.IndexData.Type=l.Type,!0}else if(l.Type==3){var u=l.DayItem.Data[t];if(!u||!c.IsNumber(u.Price))continue;return n.Point.X=this.GetRightExtendXFromIndex(t,l.DayItem),n.Point.Y=this.GetRightExtendYFromData(u.Price),n.IndexData.CursorIndex=-1,n.IndexData.DayIndex=0,n.IndexData.DataIndex=t,n.IndexData.Type=l.Type,!0}t=null}}}},this.MoveXIndexRight=function(r,n){if(X.Chart.Log("[MinuteFrame::MoveXIndexRight] obj ",n),n.DataType==2){var e=n.IndexData.DayIndex,t=n.IndexData.DataIndex+r,a=-1;if(n.IndexData.Type==20)a=0;else if(n.IndexData.Type==10)a=1;else if(n.IndexData.Type==30)a=2;else return!1;for(var s=e,o=a;s<n.Data.length;++s){for(var h=n.Data[s];o<3;++o){var l=h[o];if(!(!l.DayItem||!l.DayItem.Data)){for(t==null&&(t=0);t<l.DayItem.Data.length;++t){var u=l.DayItem.Data[t];if(u){if(l.Type==10){var f=this.MinuteCount*s+t;return n.Point.X=this.GetXFromIndex(f),n.Point.Y=this.GetYFromData(u.Close),n.IndexData.CursorIndex=f,n.IndexData.DayIndex=s,n.IndexData.DataIndex=t,n.IndexData.Type=l.Type,!0}else if(l.Type==20){if(!c.IsNumber(u.Price))continue;return n.Point.X=this.GetLeftExtendXFromIndex(t,l.DayItem),n.Point.Y=this.GetLeftExtendYFromData(u.Price),n.IndexData.CursorIndex=-1,n.IndexData.DayIndex=s,n.IndexData.DataIndex=t,n.IndexData.Type=l.Type,!0}else if(l.Type==30){if(!c.IsNumber(u.Price))continue;return n.Point.X=this.GetRightExtendXFromIndex(t,l.DayItem),n.Point.Y=this.GetRightExtendYFromData(u.Price),n.IndexData.CursorIndex=-1,n.IndexData.DayIndex=s,n.IndexData.DataIndex=t,n.IndexData.Type=l.Type,!0}}}t=null}}o=0}return!1}else if(n.DataType==1){var e=n.IndexData.DayIndex,t=n.IndexData.DataIndex+r,a=-1;if(n.IndexData.Type==2)a=0;else if(n.IndexData.Type==1)a=1;else if(n.IndexData.Type==3)a=2;else return!1;for(var s=a;s<n.Data.length;++s){var l=n.Data[s];if(!(!l.DayItem||!l.DayItem.Data)){for(t==null&&(t=0);t<l.DayItem.Data.length;++t)if(l.Type==1){if(t>=this.XPointCount)break;var C=l.DayItem.DataOffset,u=l.DayItem.Data[t+C];if(!u)continue;var f=t;return n.Point.X=this.GetXFromIndex(f),n.Point.Y=this.GetYFromData(u.Close),n.IndexData.CursorIndex=f,n.IndexData.DayIndex=0,n.IndexData.DataIndex=t,n.IndexData.Type=l.Type,!0}else if(l.Type==2){var u=l.DayItem.Data[t];if(!u||!c.IsNumber(u.Price))continue;return n.Point.X=this.GetLeftExtendXFromIndex(t,l.DayItem),n.Point.Y=this.GetLeftExtendYFromData(u.Price),n.IndexData.CursorIndex=-1,n.IndexData.DayIndex=0,n.IndexData.DataIndex=t,n.IndexData.Type=l.Type,!0}else if(l.Type==3){var u=l.DayItem.Data[t];if(!u||!c.IsNumber(u.Price))continue;return n.Point.X=this.GetRightExtendXFromIndex(t,l.DayItem),n.Point.Y=this.GetRightExtendYFromData(u.Price),n.IndexData.CursorIndex=-1,n.IndexData.DayIndex=0,n.IndexData.DataIndex=t,n.IndexData.Type=l.Type,!0}t=null}}}},this.GetLeftExtendXValidData=function(r,n){var e=this.ChartBorder.GetBorder();if(e.DayBorder){var t=this.GetLeftExtendXData(r,n.Data);if(!t)return!1;var a=parseInt(t.DataIndex.toFixed(0)),s=n.Data[t.DayIndex];if(a>=0&&a<s.Data.length){var o=s.Data[a];if(c.IsNumber(o.Price))return n.IndexData.DataIndex=a,!0}a<0?a=0:a>=s.Data.length&&(a=s.Data.length-1);for(var h=-1,l=a;l>=0;--l){var o=s.Data[l];if(o&&c.IsNumber(o.Price)){h=l;break}}return h<0?!1:(n.IndexData.DataIndex=h,n.IndexData.Point.X=this.GetLeftExtendXFromIndex(h,s),X.Chart.Log("[MinuteFrame::GetLeftExtendXValidData] DayIndex:"+n.IndexData.DayIndex+", Type:"+n.IndexData.Type+", x:"+r+"=>"+n.IndexData.Point.X+", index:"+a+"=>"+h),!0)}else{var a=this.GetLeftExtendXData(r,n.Data);if(a=parseInt(a.toFixed(0)),a>=0&&a<n.Data.Data.length){var o=n.Data.Data[a];if(c.IsNumber(o.Price))return n.IndexData.DataIndex=a,!0}a<0?a=0:a>=n.Data.Data.length&&(a=n.Data.Data.length-1);for(var h=-1,l=a;l>=0;--l){var o=n.Data.Data[l];if(c.IsNumber(o.Price)){h=l;break}}if(h<0)for(var l=a+1;l<n.Data.Data.length;++l){var o=n.Data.Data[l];if(c.IsNumber(o.Price)){h=l;break}}return h<0?!1:(n.IndexData.DataIndex=h,n.IndexData.Point.X=this.GetLeftExtendXFromIndex(h,n.Data),X.Chart.Log("[MinuteFrame::GetLeftExtendXValidData] DayIndex:"+n.IndexData.DayIndex+", Type:"+n.IndexData.Type+", x:"+r+"=>"+n.IndexData.Point.X+", index:"+a+"=>"+h),!0)}},this.GetRightExtendXValidData=function(r,n){var e=this.ChartBorder.GetBorder();if(e.DayBorder){var t=this.GetRightExtendXData(r,n.Data);if(!t)return!1;var a=parseInt(t.DataIndex.toFixed(0)),s=n.Data[t.DayIndex];if(a>=0&&a<s.Data.length){var o=s.Data[a];if(c.IsNumber(o.Price))return n.IndexData.DataIndex=a,!0}a<0?a=0:a>=s.Data.length&&(a=s.Data.length-1);for(var h=-1,l=a;l>=0;--l){var o=s.Data[l];if(o&&c.IsNumber(o.Price)){h=l;break}}return h<0?!1:(n.IndexData.DataIndex=h,n.IndexData.Point.X=this.GetRightExtendXFromIndex(h,s),X.Chart.Log("[MinuteFrame::GetRightExtendXValidData] DayIndex:"+n.IndexData.DayIndex+", Type:"+n.IndexData.Type+", x:"+r+"=>"+n.IndexData.Point.X+", index:"+a+"=>"+h),!0)}else{if(!n||!n.Data)return!1;var a=this.GetRightExtendXData(r,n.Data);if(a=parseInt(a.toFixed(0)),a>=0&&a<n.Data.Data.length){var o=n.Data.Data[a];if(c.IsNumber(o.Price))return n.IndexData.DataIndex=a,!0}a<0?a=0:a>=n.Data.Data.length&&(a=n.Data.Data.length-1);for(var h=-1,l=a;l>=0;--l){var o=n.Data.Data[l];if(c.IsNumber(o.Price)){h=l;break}}if(h<0)for(var l=a+1;l<n.Data.Data.length;++l){var o=n.Data.Data[l];if(c.IsNumber(o.Price)){h=l;break}}return h<0?!1:(n.IndexData.DataIndex=h,n.IndexData.Point.X=this.GetRightExtendXFromIndex(h,n.Data),X.Chart.Log("[MinuteFrame::GetRightExtendXValidData] DayIndex:"+n.IndexData.DayIndex+", Type:"+n.IndexData.Type+", x:"+r+"=>"+n.IndexData.Point.X+", index:"+a+"=>"+h),!0)}},this.GetLeftExtendYFromData=function(r,n,e){if(!e||!e.Range)return this.GetYFromData(r,n);var t=e.Range,a=this.ChartBorder.GetBorder(),s=a.BottomEx-a.TopEx,o=s*(r-t.Min)/(t.Max-t.Min);return a.BottomEx-o},this.GetLeftExtendYData=function(r,n,e){if(!e||!e.Range)return this.GetYData(r,n);var t=e.Range,a=this.ChartBorder.GetBorder(),s=a.BottomEx-a.TopEx;return(a.BottomEx-r)/s*(t.Max-t.Min)+t.Min},this.GetRightExtendMultiDayXFromIndex=function(r,n,e){var t=e.DayBorder,a=t[n.Index],s=n.TotalCount-1,o=a.RightEx,h=a.Right,l=h-o,u=o+l*r/s;return u},this.GetRightExtendXFromIndex=function(r,n){var e=n.TotalCount-1,t=this.ChartBorder.GetBorder();if(t.DayBorder)return this.GetRightExtendMultiDayXFromIndex(r,n,t);var a=t.RightEx,s=this.ChartBorder.RightExtendWidth,o=a+s*r/e;return o},this.GetRightExtendYFromData=function(r,n,e){return this.GetLeftExtendYFromData(r,n,e)},this.GetRightExtendYData=function(r,n,e){return!e||!e.Range?this.GetYData(r,n):this.GetLeftExtendYData(r,n,e)},this.GetRightExtendMultiDayXData=function(r,n,e){for(var t=e.DayBorder,a=0;a<t.length;++a){var s=t[a];if(r>=s.RightEx&&r<=s.Right){if(!n[a])return null;var o=n[a].TotalCount-1,h=s.RightEx,l=s.Right,u=l-h,f=(r-h)*(o*1/u);return{DayIndex:parseInt(a),DataIndex:f}}}return null},this.GetRightExtendXData=function(r,n){var e=this.ChartBorder.GetBorder();if(e.DayBorder)return this.GetRightExtendMultiDayXData(r,n,e);var t=n.TotalCount-1;t<0&&(t=0);var a=e.RightEx,s=e.Right;if(r<=a)return 0;if(r>=s)return t;var o=s-a;return(r-a)*(t*1/o)}}function hC(){this.newMethod=Zn,this.newMethod(),delete this.newMethod,this.ClassName="MinuteHScreenFrame",this.IsHScreen=!0,this.DrawTitleBG=function(){if(!(this.ChartBorder.TitleHeight<=0)){var r=this.ChartBorder.GetHScreenBorder(),n=L(r.RightEx),e=L(r.Top),t=L(r.Bottom),a=this.ChartBorder.TitleHeight,s=t-e;this.Canvas.fillStyle=this.TitleBGColor,this.Canvas.fillRect(n,e,a,s)}},this.DrawToolbar=function(){},this.DrawBeforeDataBG=function(){var r=this.ChartBorder.GetHScreenBorder();if(r.DayBorder){this.DrawMultiDayBeforeDataBG(r);return}if(!(this.ChartBorder.LeftExtendWidth<10&&this.ChartBorder.RightExtendWidth<10)){var n=L(r.Left),e=L(r.Right);if(this.Canvas.fillStyle=this.BeforeBGColor,this.ChartBorder.LeftExtendWidth>10){var t=L(r.Top),a=L(r.TopEx),s=e-n,o=a-t;this.Canvas.fillRect(n,t,s,o)}if(this.ChartBorder.RightExtendWidth>10){var t=r.BottomEx,a=r.Bottom,s=e-n,o=a-t;this.Canvas.fillRect(n,t,s,o)}}},this.DrawMultiDayBeforeDataBG=function(r){var n=r.DayBorder,e=L(r.Left),t=L(r.Right),a=t-e;this.Canvas.strokeStyle=this.MultiDayBorderPen;for(var s=0;s<n.length;++s){var o=0,h=n[s],l=L(h.Top),u=L(h.TopEx),f=u-l;f>3&&(this.Canvas.fillStyle=this.BeforeBGColor,this.Canvas.fillRect(e,l,a,f),++o);var l=L(h.BottomEx),u=L(h.Bottom),f=u-l;f>3&&(this.Canvas.fillStyle=this.AfterBGColor,this.Canvas.fillRect(e,l,a,f),++o),o==2&&s!=n.length-1&&(this.Canvas.beginPath(),this.Canvas.moveTo(e,u),this.Canvas.lineTo(t,u),this.Canvas.stroke())}},this.GetYData=function(r){var n=this.ChartBorder.GetHScreenBorder();if(r<n.LeftEx)return this.HorizontalMin;if(r>n.RightEx)return this.HorizontalMax;var e=n.RightEx-n.LeftEx;return(r-n.LeftEx)/e*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin},this.GetMultiDayXData=function(r,n){for(var e=n.DayBorder,t=0;t<e.length;++t){var a=e[t];if(r>=a.Top&&r<=a.Bottom){var s=this.MinuteCount-1,o=this.MinuteCount*t;if(r<=a.TopEx)return 0+o;if(r>=a.BottomEx)return s+o;var h=a.BottomEx-a.TopEx;return(r-a.TopEx)*(s*1/h)+o}}},this.GetXData=function(r){var n=this.XPointCount-1;n<0&&(n=0);var e=this.ChartBorder.GetHScreenBorder();if(e.DayBorder)return this.GetMultiDayXData(r,e);if(r<=e.TopEx)return 0;if(r>=e.BottomEx)return n;var t=e.BottomEx-e.TopEx;return(r-e.TopEx)*(n*1/t)},this.GetMultiDayXFromIndex=function(r,n){var e=n.DayBorder,t=r%this.MinuteCount,a=parseInt(r/this.MinuteCount);a>=e.length&&(a=e.length-1);var s=e[a],o=this.MinuteCount-1;if(t>=o)return s.BottomEx;var h=s.BottomEx-s.TopEx,l=s.TopEx+h*t/o;return l},this.GetXFromIndex=function(r){var n=this.XPointCount-1,e=this.ChartBorder.GetHScreenBorder();if(e.DayBorder)return this.GetMultiDayXFromIndex(r,e);if(n==1)return r==0?e.TopEx:e.BottomEx;if(n<=0)return e.TopEx;if(r>=n)return e.BottomEx;var t=e.BottomEx-e.TopEx,a=e.TopEx+t*r/n;return a},this.GetYFromData=function(r){var n=this.ChartBorder.GetHScreenBorder();if(r<=this.HorizontalMin)return n.LeftEx;if(r>=this.HorizontalMax)return n.RightEx;var e=(n.RightEx-n.LeftEx)*(r-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return n.LeftEx+e},this.DrawVolTitle=function(r){if(W.IsShowMinuteVolTitle(r)&&this.Identify==1){var n=V(),e=this.ChartBorder.GetRight()-2*n,t=this.ChartBorder.GetTopEx()+2*n,a=e,s=t;this.Canvas.save(),this.Canvas.translate(a,s),this.Canvas.rotate(90*Math.PI/180);var o=this.YInsideOffset,h=0;if(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",m.Minute.VolBarColor||m.Minute.VolTitleColor){m.Minute.VolBarColor?this.Canvas.fillStyle=m.Minute.VolBarColor:this.Canvas.fillStyle=m.Minute.VolTitleColor;var l=this.YSplitOperator.LanguageID,u=gt.GetText("MVol-Vol",l);this.Canvas.fillText(u,o,h),o+=this.Canvas.measureText(u).width,o+=6*V()}this.IsShowPositionTitle&&(u=gt.GetText("MVol-Position",l),this.Canvas.fillStyle=m.Minute.PositionColor,this.Canvas.fillText(u,o,h)),this.Canvas.restore()}},this.DrawHorizontal=function(){for(var r=this.ChartBorder.GetHScreenBorder(),n=r.Top,e=r.Bottom,t=r.Left,a=r.Right,s=this.ChartBorder.Top,o=this.ChartBorder.Bottom,h=null,l=this.HorizontalInfo.length-1;l>=0;--l){var u=this.HorizontalInfo[l],f=this.GetYFromData(u.Value);if(!(f!=null&&Math.abs(f-h)<this.MinYDistance)){if(this.Canvas.strokeStyle=u.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(f),n),this.Canvas.lineTo(L(f),e),this.Canvas.stroke(),f>=a-2)this.Canvas.textBaseline="top",f=a;else if(f<=t+2){if(this.Canvas.textBaseline="bottom",f=t,f!=null&&Math.abs(f-h)<2*this.MinYDistance)continue}else this.Canvas.textBaseline="middle";if(u.Message[0]!=null&&s>10){u.Font!=null&&(this.Canvas.font=u.Font),this.Canvas.fillStyle=u.TextColor,this.Canvas.textAlign="right";var C=f,D=n;this.Canvas.save(),this.Canvas.translate(C,D),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(u.Message[0],-2,0),this.Canvas.restore()}if(u.Message[1]!=null&&o>10){u.Font!=null&&(this.Canvas.font=u.Font),this.Canvas.fillStyle=u.TextColor,this.Canvas.textAlign="left";var C=f,D=e;this.Canvas.save(),this.Canvas.translate(C,D),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(u.Message[1],2,0),this.Canvas.restore()}h=f}}},this.DrawInsideClientHorizontal=function(){for(var r=this.GetBorder(),n=r.Left,e=r.Right,t=r.BottomEx,a=r.TopEx,s=null,o=this.HorizontalInfo.length-1;o>=0;--o){var h=this.HorizontalInfo[o];if(!(!h||!h.Message[2]||!h.Message[3])){var l=this.GetYFromData(h.Value);if(!(l!=null&&s!=null&&Math.abs(l-s)<this.MinYDistance)){if(l>=e-2)this.Canvas.textBaseline="top",l=e;else if(l<=n+2){if(this.Canvas.textBaseline="bottom",l=n,l!=null&&Math.abs(l-s)<2*this.MinYDistance)continue}else this.Canvas.textBaseline="middle";if(h.Message[2]){h.Font!=null&&(this.Canvas.font=h.Font),this.Canvas.fillStyle=h.TextColor,this.Canvas.textAlign="left";var u=l,f=a;this.Canvas.save(),this.Canvas.translate(u,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(h.Message[2],2,0),this.Canvas.restore()}if(h.Message[3]){h.Font!=null&&(this.Canvas.font=h.Font),this.Canvas.fillStyle=h.TextColor,this.Canvas.textAlign="right";var u=l,f=t;this.Canvas.save(),this.Canvas.translate(u,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(h.Message[3],-2,0),this.Canvas.restore()}s=l}}}},this.DrawVertical=function(){var r=this.ChartBorder.GetHScreenBorder(),n=r.Left,e=r.Right,t=r.Bottom,a=null;for(var s in this.VerticalInfo){var o=this.GetXFromIndex(this.VerticalInfo[s].Value);if(o>t)break;if(!(a!=null&&Math.abs(o-a)<this.MinXDistance)){if(this.Canvas.strokeStyle=this.VerticalInfo[s].LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(n,L(o)),this.Canvas.lineTo(e,L(o)),this.Canvas.stroke(),this.VerticalInfo[s].Message[0]!=null){this.VerticalInfo[s].Font!=null&&(this.Canvas.font=this.VerticalInfo[s].Font),this.Canvas.fillStyle=this.VerticalInfo[s].TextColor;var h=this.Canvas.measureText(this.VerticalInfo[s].Message[0]).width;o<h/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top"):o+h/2>=this.ChartBorder.GetChartHeight()?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top"):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top");var l=n,u=o;this.Canvas.save(),this.Canvas.translate(l,u),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.VerticalInfo[s].Message[0],0,0),this.Canvas.restore()}a=o}}},this.DrawInsideHorizontal=function(){if(!this.IsMinSize&&!(this.IsShowYText[0]===!1&&this.IsShowYText[1]===!1)){this.DrawInsideClientHorizontal();var r=this.ChartBorder.GetHScreenBorder(),n=r.Left,e=r.RightEx,t=r.Top,a=r.Bottom,s=this.ChartBorder.Top,o=this.ChartBorder.Bottom;this.ChartBorder.TitleHeight;var h=V();if(s<10*h&&this.IsShowYText[0]===!0||o<10*h&&this.IsShowYText[1]===!0)for(var h=V(),l=null,u=null,f=this.HorizontalInfo.length-1;f>=0;--f){var C=this.HorizontalInfo[f],D=this.GetYFromData(C.Value);if(!(D!=null&&l!=null&&Math.abs(D-l)<this.MinYDistance)){if(C.Message[0]!=null&&s<10*h&&this.IsShowYText[0]===!0){C.Font!=null&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="left",D>=e-2?this.Canvas.textBaseline="top":D<=n+2?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,C.Message[0];var v=D,S=t;this.Canvas.save(),this.Canvas.translate(v,S),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(C.Message[0],2*h,0),this.Canvas.restore(),(u==null||u<v)&&(this.YInsideOffset=this.Canvas.measureText(C.Message[0]).width+4*V(),u=v)}if(C.Message[1]!=null&&o<10*h&&this.IsShowYText[1]===!0){C.Font!=null&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="right",D>=e-2?this.Canvas.textBaseline="top":D<=n+2?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle";var T=this.Canvas.measureText(C.Message[1]).width;e-T,this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,C.Message[1];var v=D,S=a;this.Canvas.save(),this.Canvas.translate(v,S),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(C.Message[1],-2*h,0),this.Canvas.restore()}l=D}}}},this.GetLeftExtendXFromIndex=function(r,n){var e=n.TotalCount-1,t=this.ChartBorder.GetHScreenBorder();if(t.DayBorder)return this.GetLeftExtendMultiDayXFromIndex(r,n,t);var a=t.Top,s=this.ChartBorder.LeftExtendWidth,o=a+s*r/e;return o},this.GetLeftExtendMultiDayXFromIndex=function(r,n,e){var t=e.DayBorder,a=t[n.Index],s=n.TotalCount-1,o=a.Top,h=a.TopEx,l=h-o,u=o+l*r/s;return u},this.GetLeftExtendMultiDayXData=function(r,n,e){for(var t=e.DayBorder,a=0;a<t.length;++a){var s=t[a];if(r>=s.Top&&r<=s.TopEx){if(!n[a])return null;var o=n[a].TotalCount-1,h=s.Top,l=s.TopEx,u=l-h,f=(r-h)*(o*1/u);return{DayIndex:parseInt(a),DataIndex:f}}}return null},this.GetLeftExtendXData=function(r,n){var e=this.ChartBorder.GetHScreenBorder();if(e.DayBorder)return this.GetLeftExtendMultiDayXData(r,n,e);var t=n.TotalCount-1;t<0&&(t=0);var a=e.Top,s=e.TopEx;if(r<=a)return 0;if(r>=s)return t;var o=s-a;return(r-a)*(t*1/o)},this.GetLeftExtendYFromData=function(r,n,e){if(!e||!e.Range)return this.GetYFromData(r,n);var t=e.Range,a=this.ChartBorder.GetHScreenBorder(),s=a.RightEx-a.LeftEx,o=s*(r-t.Min)/(t.Max-t.Min);return a.LeftEx+o},this.GetLeftExtendYData=function(r,n,e){if(!e||!e.Range)return this.GetYData(y,n);var t=e.Range,a=this.ChartBorder.GetHScreenBorder(),s=a.RightEx-a.LeftEx;return(r-a.LeftEx)/s*(t.Max-t.Min)+t.Min},this.GetRightExtendMultiDayXFromIndex=function(r,n,e){var t=e.DayBorder,a=t[n.Index],s=n.TotalCount-1,o=a.BottomEx,h=a.Bottom,l=h-o,u=o+l*r/s;return u},this.GetRightExtendXFromIndex=function(r,n){var e=n.TotalCount-1,t=this.ChartBorder.GetHScreenBorder();if(t.DayBorder)return this.GetRightExtendMultiDayXFromIndex(r,n,t);var a=t.BottomEx,s=this.ChartBorder.RightExtendWidth,o=a+s*r/e;return o},this.GetRightExtendMultiDayXData=function(r,n,e){for(var t=e.DayBorder,a=0;a<t.length;++a){var s=t[a];if(r>=s.BottomEx&&r<=s.Bottom){if(!n[a])return null;var o=n[a].TotalCount-1,h=s.BottomEx,l=s.Bottom,u=l-h,f=(r-h)*(o*1/u);return{DayIndex:parseInt(a),DataIndex:f}}}return null},this.GetRightExtendXData=function(r,n){var e=this.ChartBorder.GetHScreenBorder();if(e.DayBorder)return this.GetRightExtendMultiDayXData(r,n,e);var t=n.TotalCount-1;t<0&&(t=0);var a=e.BottomEx,s=e.Bottom;if(r<=a)return 0;if(r>=s)return t;var o=s-a;return(r-a)*(t*1/o)},this.GetRightExtendYFromData=function(r,n,e){return!e||!e.Range?this.GetYFromData(r,n):this.GetLeftExtendYFromData(r,n,e)}}function _o(){this.newMethod=Zn,this.newMethod(),delete this.newMethod,this.ClassName="OverlayMinuteFrame",this.IsShow=!0,this.IsShareY=!1,this.IsCalculateYMaxMin=!0,this.Draw=function(){this.SplitXYCoordinate(),this.IsShow,this.SizeChange=!1,this.XYSplit=!1},this.DrawToolbar=function(){},this.GetScaleTextWidth=function(){return{TextWidth:0}},this.SplitXYCoordinate=function(){if(this.XYSplit!=!1)if(this.IsShareY){this.HorizontalMax=this.MainFrame.HorizontalMax,this.HorizontalMin=this.MainFrame.HorizontalMin,this.HorizontalInfo=[];for(var r in this.MainFrame.HorizontalInfo){var n=this.MainFrame.HorizontalInfo[r];this.HorizontalInfo.push(n)}}else this.YSplitOperator!=null&&this.YSplitOperator.Operator()}}function Uo(){this.newMethod=hC,this.newMethod(),delete this.newMethod,this.ClassName="OverlayMinuteHScreenFrame",this.IsShow=!0,this.Draw=function(){this.SplitXYCoordinate(),this.IsShow,this.SizeChange=!1,this.XYSplit=!1},this.SplitXYCoordinate=function(){if(this.XYSplit!=!1)if(this.IsShareY){this.HorizontalMax=this.MainFrame.HorizontalMax,this.HorizontalMin=this.MainFrame.HorizontalMin,this.HorizontalInfo=[];for(var r in this.MainFrame.HorizontalInfo){var n=this.MainFrame.HorizontalInfo[r];this.HorizontalInfo.push(n)}}else this.YSplitOperator!=null&&this.YSplitOperator.Operator()}}function Tr(){this.newMethod=ms,this.newMethod(),delete this.newMethod,this.ClassName="KLineFrame",this.ToolbarID=oe(),this.ModifyIndex=m.KLineToolbar.ModifyIndex,this.ChangeIndex=m.KLineToolbar.ChangeIndex,this.CloseIndex=m.KLineToolbar.CloseIndex,this.OverlayIndex=m.KLineToolbar.OverlayIndex,this.MaxMinWindow=m.KLineToolbar.MaxMinWindow,this.TitleWindow=m.KLineToolbar.TitleWindow,this.ExportData=m.KLineToolbar.ExportData,this.ModifyIndexEvent,this.ChangeIndexEvent,this.ToolbarRect=null,this.ReDrawToolbar=!1,this.LastCalculateStatus={Width:0,XPointCount:0},this.CustomHorizontalInfo=[],this.IsDrawTitleBG=!1,this.IsShowNameArrow=!1,this.CustomVerticalInfo=[],this.DrawCustomVerticalEvent,this.RightSpaceCount=0,this.Logarithmic=null,this.CustomToolbar=[],this.ToolbarType=0,this.DrawToolbar=function(){if(this.ToolbarButtonStyle!=1&&m.IsDOMFrameToolbar!==!0&&!(typeof q.default>"u")&&!(!this.ChartBorder.UIElement||!this.ChartBorder.UIElement.parentNode)){var r=document.getElementById(this.ToolbarID);if(!(r&&this.SizeChange==!1&&this.ReDrawToolbar==!1)){if(r||(r=document.createElement("div"),r.className="klineframe-toolbar",r.id=this.ToolbarID,r.oncontextmenu=function(){return!1},r.setAttribute("identify",this.Identify.toString()),this.ChartBorder.UIElement.parentNode.appendChild(r)),!this.ModifyIndex&&!this.ChangeIndex&&!this.OverlayIndex&&!this.CloseIndex&&!c.IsNonEmptyArray(this.CustomToolbar)){r.style.display!="none"&&(r.style.display="none");return}var n=V(),e=parseInt(this.ChartBorder.UIElement.parentElement.style.width.replace("px",""));parseInt(this.ChartBorder.UIElement.parentElement.style.height.replace("px",""));var t=100,a=this.ChartBorder.GetTitleHeight(),s=e-this.ChartBorder.Right/n-t,o=this.ChartBorder.GetTop()/n;if(!(this.ToolbarRect&&this.ToolbarRect.Left==s&&this.ToolbarRect.Top==o&&this.ToolbarRect.Width==t&&this.ToolbarRect.Height==a/n)){this.ToolbarRect={Left:s,Top:o,Width:t,Height:a/n};var h="<span class='index_param icon iconfont icon-index_param' id='modifyindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='调整指标参数'></span>",l="<span class='index_change icon iconfont icon-change_index' id='changeindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='切换指标'></span>",u="<span class='index_overlay icon iconfont icon-overlay_index' id='overlayindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='叠加指标'></span>",f="<span class='index_close icon iconfont icon-close' id='closeindex' style='cursor:pointer;margin-left:2px;margin-right:2px;' title='关闭指标窗口'></span>",C=h+l+u;if(this.Identify!==0&&this.CloseIndex&&(C+=f),c.IsNonEmptyArray(this.CustomToolbar))for(var D=0;D<this.CustomToolbar.length;++D){var v=this.CustomToolbar[D];C+=v.Html}if(r.style.left=s+"px",r.style.top=o+"px",r.style.width=t+"px",r.style.height=a/n+"px",r.innerHTML=C,this.ChartBorder.UIElement.JSChartContainer,this.Identify,this.ModifyIndex?typeof this.ModifyIndexEvent=="function"&&(0,q.default)("#"+r.id+" .index_param").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},this.ModifyIndexEvent):(0,q.default)("#"+r.id+" .index_param").hide(),this.ChangeIndex?typeof this.ChangeIndexEvent=="function"&&(0,q.default)("#"+r.id+" .index_change").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,IsOverlay:!1},this.ChangeIndexEvent):(0,q.default)("#"+r.id+" .index_change").hide(),this.OverlayIndex?(0,q.default)("#"+r.id+" .index_overlay").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,IsOverlay:!0},this.ChangeIndexEvent):(0,q.default)("#"+r.id+" .index_overlay").hide(),(0,q.default)("#"+r.id+" .index_close").click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify},function(S){var T=S.data.Chart,I=S.data.Identify;T.RemoveIndexWindow(I)}),c.IsNonEmptyArray(this.CustomToolbar))for(var D=0;D<this.CustomToolbar.length;++D){var v=this.CustomToolbar[D];(0,q.default)("#"+v.ID).click({Chart:this.ChartBorder.UIElement.JSChartContainer,Identify:this.Identify,ID:v.ID},v.Click)}r.style.display="block"}}}},this.DrawToolbarV2=function(r,n){if(m.IsDOMFrameToolbar!==!0&&(this.Buttons=[],this.LeftButtonWidth=0,this.IsMinSize!=!0&&!(this.ChartBorder.TitleHeight<5))){var e=[];if(this.CloseIndex&&this.Identify!==0&&e.push({ID:xt.CLOSE_INDEX_WINDOW,Style:this.CloseWindowButton}),this.MaxMinWindow&&this.Identify!=0&&e.push({ID:xt.MAX_MIN_WINDOW,Style:this.MaxMinWindowButton}),this.TitleWindow&&this.Identify!=0&&e.push({ID:xt.TITLE_WINDOW,Style:this.TitleWindowButton}),this.ExportData&&e.push({ID:xt.EXPORT_DATA,Style:this.ExportDataButton}),this.OverlayIndex&&e.push({ID:xt.OVERLAY_INDEX,Style:this.OverlayIndexButton}),this.ChangeIndex&&e.push({ID:xt.CHANGE_INDEX,Style:this.ChangeIndexButton}),this.ModifyIndex&&e.push({ID:xt.MODIFY_INDEX_PARAM,Style:this.ModifyIndexParamButton}),c.IsNonEmptyArray(this.CustomToolbar))for(var t=0;t<this.CustomToolbar.length;++t){var a=this.CustomToolbar[t];if(a.ID&&a.Style){var s={ID:a.ID,Style:a.Style,TooltipText:a.TooltipText};a.IsLeft===!0||e.push(s)}}if(this.GetEventCallback){var o=this.GetEventCallback(et.ON_CUSTOM_RIGHT_TOOLBAR);if(o&&o.Callback){var h={PreventDefault:!1,DefaultButton:e,AryButton:null,FrameID:this.Identify};if(o.Callback(o,h,this),h.PreventDefault){this.DrawTitleButton(h.AryButton,r,n);return}}}this.DrawTitleButton(e,r,n)}},this.GetLeftToolbar=function(r){if(this.GetEventCallback){var n=this.GetEventCallback(et.ON_CUSTOM_LEFT_TOOLBAR);if(n&&n.Callback){var e={PreventDefault:!1,AryButton:null,FrameID:this.Identify};if(r&&(r.Overlay&&(e.Title=r.Overlay.Title),r.OverlayID&&(e.OverlayID=r.OverlayID)),n.Callback(n,e,this),e.PreventDefault)return e.AryButton}}if(!c.IsNonEmptyArray(this.CustomToolbar))return null;for(var t=[],a=0;a<this.CustomToolbar.length;++a){var s=this.CustomToolbar[a];if(s.ID&&s.Style){var o={ID:s.ID,Style:s.Style,TooltipText:s.TooltipText};s.IsLeft===!0&&t.push(o)}}return t},this.DrawFrame=function(){this.IsMinSize||(this.SplitXYCoordinate(),this.SizeChange==!0&&(this.CalculateDataWidth(),this.Logarithmic&&this.SplitLogarithmicXYCoordinate()),this.BeforeDrawXYCallback&&this.BeforeDrawXYCallback(this),this.DrawTitleBG(),this.DrawHorizontal(),this.DrawVertical()),(this.SizeChange==!0||this.ReDrawToolbar==!0)&&(this.DrawToolbar(),this.ReDrawToolbar=!1)},this.GetXFromIndex=function(r,n){if(n===!1)if(r>=0)for(var e=this.ChartBorder.GetLeft()+m.FrameLeftMargin+this.DistanceWidth/2+this.DataWidth/2,t=1;t<=r;++t)e+=this.DistanceWidth+this.DataWidth;else for(var e=this.ChartBorder.GetLeft()-(this.DistanceWidth/2+this.DataWidth+this.DistanceWidth),a=Math.abs(r),t=1;t<a;++t)e-=this.DistanceWidth+this.DataWidth;else{r<0&&(r=0),r>this.xPointCount-1&&(r=this.xPointCount-1);for(var e=this.ChartBorder.GetLeft()+m.FrameLeftMargin+this.DistanceWidth/2+this.DataWidth/2,t=1;t<=r;++t)e+=this.DistanceWidth+this.DataWidth}return e},this.GetXData=function(r,n){var e=this.DistanceWidth,t=this.DataWidth,a=this.ChartBorder.GetLeft()+m.FrameLeftMargin;if(n==!1)if(r<this.ChartBorder.GetLeft()){for(var s=-1,o=this.ChartBorder.GetLeft()-(e/2+t+e);s>-1e4&&!(o<=r);)o-=t+e,--s;return s}else{for(var s=0,o=a+e/2+t+e;s<1e4&&!(o>=r);)o+=t+e,++s;return s}else{if(r<=this.ChartBorder.GetLeft())return 0;if(r>=this.ChartBorder.GetRight())return this.XPointCount-1;for(var h=this.ChartBorder.GetRight()-m.FrameRightMargin,s=0,o=a+e/2+t+e;o<h&&s<1e4&&s+1<this.XPointCount&&!(o>=r);)o+=t+e,++s;return s}},this.CalculateDataWidth=function(){if(!(this.XPointCount<2)){var r=this.GetFrameWidth()-m.FrameMargin;if(this.ZoomIndex>=0&&this.LastCalculateStatus.Width==r&&this.LastCalculateStatus.XPointCount==this.XPointCount){var n=this.DistanceWidth/2+m.FrameLeftMargin+(this.DataWidth+this.DistanceWidth)*(this.XPointCount-1);if((this.DataWidth+this.DistanceWidth)*this.XPointCount,n<=r)return}this.LastCalculateStatus.Width=r,this.LastCalculateStatus.XPointCount=this.XPointCount;for(var e=0;e<ie.length;++e)if((ie[e][0]+ie[e][1])*this.XPointCount<r){this.ZoomIndex=e,this.DataWidth=ie[e][0],this.DistanceWidth=ie[e][1],this.TrimKLineDataWidth(r),X.Chart.Log("[KLineFrame::CalculateDataWidth] ZOOM_SEED, DataWidth, DistanceWidth, XPointCount",ie[this.ZoomIndex],this.DataWidth,this.DistanceWidth,this.XPointCount);return}this.ZoomIndex=ie.length-1,this.DataWidth=r/this.XPointCount,this.DistanceWidth=0}},this.OnSize=function(r){for(var n=this.GetFrameWidth()-m.FrameMargin,e=0,t=this.DistanceWidth/2+m.FrameLeftMargin+(this.DataWidth+this.DistanceWidth);t<n;t+=this.DataWidth+this.DistanceWidth,++e);return r.CurCount=this.XPointCount,r.CalcCount=e,r.DataWidth=this.DataWidth,r.DistanceWidth=this.DistanceWidth,r.Changed=!1,this.LastCalculateStatus.Width=n,r.CurCount==r.CalcCount||(this.XPointCount=e,this.LastCalculateStatus.XPointCount=this.XPointCount,this.Data&&(this.Data.DataOffset+=r.CurCount-r.CalcCount,this.Data.DataOffset<0&&(this.Data.DataOffset=0),r.Changed=!0)),r},this.SetDataWidth=function(r){var n=ie.length-1;for(var e in ie){var t=ie[e];if(t[0]<=r){n=parseInt(e)-1;break}}this.ZoomIndex=n,this.DataWidth=ie[this.ZoomIndex][0],this.DistanceWidth=ie[this.ZoomIndex][1];for(var a=this.GetFrameWidth()-m.FrameMargin,s=0,o=this.DistanceWidth/2+m.FrameLeftMargin+(this.DataWidth+this.DistanceWidth);o<=a;o+=this.DataWidth+this.DistanceWidth,++s);this.XPointCount=s,this.LastCalculateStatus.XPointCount=this.XPointCount,this.LastCalculateStatus.Width=a;var h={XPointCount:this.XPointCount,DataWidth:this.DataWidth,DistanceWidth:this.DistanceWidth};return h},this.TrimKLineDataWidth=function(r){var n=ie[this.ZoomIndex][0],e=ie[this.ZoomIndex][1];if(n==1&&e==0){this.DataWidth=r/this.XPointCount;return}for(;;){if((this.DistanceWidth+this.DataWidth)*this.XPointCount+this.DistanceWidth>r){this.DistanceWidth-=.01;break}this.DistanceWidth+=.01}},this.IsOverlayMaxMin=function(r){if(!this.ChartKLine||!this.ChartKLine.Max||!this.ChartKLine.Min)return!1;var n=this.Canvas.measureText(r.Text.Value).width+4;r.Text.TextAlign==="right"&&(r.X-=n);var e=this.ChartKLine.Max,t=this.ChartKLine.Min,a=!1,s=!1,o=20;if(e.X>=r.X&&e.X<=r.X+n){var h=e.Y+o,l=e.Y-o;(h>=r.Y-o&&h<=r.Y+o||l>=r.Y-o&&l<=r.Y+o)&&(a=!0)}if(a==!0)return!0;if(t.X>=r.X&&t.X<=r.X+n){var h=t.Y+o,l=t.Y-o;(h>=r.Y-o&&h<=r.Y+o||l>=r.Y-o&&l<=r.Y+o)&&(s=!0)}return a||s},this.SplitXYCoordinate=function(){this.XYSplit!=!1&&(this.YSplitOperator!=null&&this.YSplitOperator.Operator(),this.XSplitOperator!=null&&this.XSplitOperator.Operator(),this.Logarithmic&&this.SplitLogarithmicXYCoordinate())},this.SplitLogarithmicXYCoordinate=function(){for(var r=this.Logarithmic.Up,n=this.Logarithmic.Down,e=0,t=0,a=Math.max(r.length,n.length),s=[],o=0;o<a;++o)s[o]=o*2;for(var o=0,h=s.length-1;o<r.length;++o,--h){var l=r[o];l.LogHeight=s[h],e+=l.LogHeight,++t}for(var o=0,h=s.length-1;o<n.length;++o,--h){var l=n[o];l.LogHeight=s[h],e+=l.LogHeight,++t}var u=2*V(),f=this.ChartBorder.GetTopEx(),C=this.ChartBorder.GetBottomEx(),D=C-f,v=(D-e*u)/t;if(v<0&&(v=0,u=D/e),this.CoordinateType==1){for(var S=f,o=n.length-1;o>=0;--o){var l=n[o];l.Height=v+u*l.LogHeight,l.Top=S,l.Bottom=l.Top+l.Height,S=l.Bottom}for(var T=C,o=r.length-1;o>=0;--o){var l=r[o];l.Height=v+u*l.LogHeight,l.Bottom=T,l.Top=T-l.Height,T=l.Top}}else{for(var S=f,o=r.length-1;o>=0;--o){var l=r[o];l.Height=v+u*l.LogHeight,l.Top=S,l.Bottom=l.Top+l.Height,S=l.Bottom}for(var T=C,o=n.length-1;o>=0;--o){var l=n[o];l.Height=v+u*l.LogHeight,l.Bottom=T,l.Top=T-l.Height,T=l.Top}}X.Chart.Log("[KLineFrame::SplitLogarithmicXYCoordinate]",this.Logarithmic)},this.GetYLogarithmicFromData=function(r,n){if(this.CoordinateType==1){if(r<=this.HorizontalMin)return this.ChartBorder.GetTopEx();if(r>=this.HorizontalMax)return this.ChartBorder.GetBottomEx();if(r>this.Logarithmic.OpenPrice){var e=this.Logarithmic.Up;for(var t in e){var a=e[t];if(r>=a.Start&&r<=a.End){var s=a.Bottom-a.Top,o=s*(r-a.Start)/(a.End-a.Start);return a.Top+o}}}else{var h=this.Logarithmic.Down;for(var t in h){var a=h[t];if(r>=a.Start&&r<=a.End){var s=a.Bottom-a.Top,o=s*(r-a.Start)/(a.End-a.Start);return a.Top+o}}}}else{if(r<=this.HorizontalMin)return this.ChartBorder.GetBottomEx();if(r>=this.HorizontalMax)return this.ChartBorder.GetTopEx();if(r>this.Logarithmic.OpenPrice){var e=this.Logarithmic.Up;for(var t in e){var a=e[t];if(r>=a.Start&&r<=a.End){var s=a.Bottom-a.Top,o=s*(r-a.Start)/(a.End-a.Start);return a.Bottom-o}}}else{var h=this.Logarithmic.Down;for(var t in h){var a=h[t];if(r>=a.Start&&r<=a.End){var s=a.Bottom-a.Top,o=s*(r-a.Start)/(a.End-a.Start);return a.Bottom-o}}}}},this.GetYLogarithmicData=function(r){if(this.CoordinateType==1){if(r<this.ChartBorder.GetTopEx())return this.HorizontalMin;if(r>this.ChartBorder.GetBottomEx())return this.HorizontalMax;var n=this.Logarithmic.Up;for(var e in n){var t=n[e];if(r>=t.Top&&r<=t.Bottom)return(r-t.Top)/t.Height*(t.End-t.Start)+t.Start}var a=this.Logarithmic.Down;for(var e in a){var t=a[e];if(r>=t.Top&&r<=t.Bottom)return(r-t.Top)/t.Height*(t.End-t.Start)+t.Start}}else{if(r<this.ChartBorder.GetTopEx())return this.HorizontalMax;if(r>this.ChartBorder.GetBottomEx())return this.HorizontalMin;var n=this.Logarithmic.Up;for(var e in n){var t=n[e];if(r>=t.Top&&r<=t.Bottom)return(t.Bottom-r)/t.Height*(t.End-t.Start)+t.Start}var a=this.Logarithmic.Down;for(var e in a){var t=a[e];if(r>=t.Top&&r<=t.Bottom)return(t.Bottom-r)/t.Height*(t.End-t.Start)+t.Start}}},this.CalculateCount=function(r){var n=ie[r][0],e=ie[r][1],t=this.GetFrameWidth()-m.FrameMargin-e/2;return parseInt(t/(n+e))},this.ZoomUp=function(r){if(this.ZoomIndex<=0||this.Data.DataOffset<0)return!1;var n=this.Data.Data.length,e=n+this.RightSpaceCount,t=0,a=this.Data.DataOffset+this.XPointCount-1,s=this.Data.DataOffset+r.Index;a>=n&&(t=a-(this.Data.Data.length-1),a=this.Data.Data.length-1,t>this.RightSpaceCount&&(t=this.RightSpaceCount));var o=this.CalculateCount(this.ZoomIndex-1);X.Chart.Log("[KLineFrame::ZoomUp] old status. XPointCount="+o+" ZoomIndex="+this.ZoomIndex+" DataCount= "+this.Data.Data.length+" rightSpaceCount="+t);var h=!1;if(--this.ZoomIndex,r.IsLockRight==!0){var l=this.Data.DataOffset+this.XPointCount;if(o>l)o=l,this.XPointCount=o,this.Data.DataOffset=0;else{var u=a-(o-t)+1;this.XPointCount=o,this.Data.DataOffset=u,this.Data.DataOffset<0&&(this.Data.DataOffset=0)}}else if(o>=e)this.Data.DataOffset=0,this.XPointCount=o,h=!0,X.Chart.Log("[KLineFrame::ZoomUp] Show all data. XPointCount="+o+" ZoomIndex="+this.ZoomIndex+" DataCount= "+n);else{var u=a-(o-t)+1;if(r.ZoomType==1){var f=this.XPointCount-o+1,C=parseInt(r.Index/this.XPointCount*f),D=this.Data.DataOffset+C;D<n&&(u=this.Data.DataOffset+C)}this.XPointCount=o,this.Data.DataOffset=u,this.Data.DataOffset<0&&(this.Data.DataOffset=0),X.Chart.Log("[KLineFrame::ZoomUp] calculate. XPointCount="+o+" ZoomIndex="+this.ZoomIndex+" DataCount= "+n+" DataOffset="+this.Data.DataOffset)}if(this.DataWidth=ie[this.ZoomIndex][0],this.DistanceWidth=ie[this.ZoomIndex][1],!h){var v=this.GetFrameWidth()-m.FrameMargin;this.TrimKLineDataWidth(v)}return this.LastCalculateStatus.XPointCount=this.XPointCount,r.Index=s-this.Data.DataOffset,!0},this.SetXShowCount=function(r){for(var n=-1,e=this.GetFrameWidth()-m.FrameMargin,t=0;t<ie.length;++t){var a=ie[t],s=a[0],o=a[1],e=this.GetFrameWidth()-m.FrameMargin-o/2,h=parseInt((e-o/2)/(s+o));if(h>=r){n=t,this.XPointCount=r,this.ZoomIndex=n,this.DataWidth=s,this.DistanceWidth=o,s==1&&o==0&&(this.DataWidth=e/this.XPointCount),this.LastCalculateStatus.XPointCount=this.XPointCount,this.LastCalculateStatus.Width=e;return}}this.XPointCount=r,this.ZoomIndex=ie.length-1,this.DataWidth=e/this.XPointCount,this.DistanceWidth=0,this.LastCalculateStatus.XPointCount=this.XPointCount,this.LastCalculateStatus.Width=e},this.XCoordinateZoom=function(r){var n=this.XPointCount;if(r){if(this.ZoomIndex<=0||this.Data.DataOffset<0)return!1;var e=this.ZoomIndex-1,t=this.CalculateCount(e),a=this.Data.Data.length,s=n-t;if(s<=0)return!1;this.Data.DataOffset+=s,this.Data.DataOffset>a&&(this.Data.DataOffset=0)}else{if(this.ZoomIndex+1>=ie.length||this.Data.DataOffset<0)return!1;var e=this.ZoomIndex+1,t=this.CalculateCount(e),s=t-n;this.Data.DataOffset-=s,this.Data.DataOffset<0&&(this.Data.DataOffset=0)}this.XPointCount=t,this.ZoomIndex=e,this.DataWidth=ie[this.ZoomIndex][0],this.DistanceWidth=ie[this.ZoomIndex][1];var o=this.GetFrameWidth()-m.FrameMargin;return this.TrimKLineDataWidth(o),this.LastCalculateStatus.XPointCount=this.XPointCount,!0},this.ZoomDown=function(r,n){if(this.ZoomIndex+1>=ie.length||this.Data.DataOffset<0||this.Data.DataOffset<=0&&r.IsLockRight==!0)return!1;var e=this.Data.Data.length,t=e+this.RightSpaceCount,a=0,s=this.Data.DataOffset+this.XPointCount-1;s>=this.Data.Data.length&&(a=s-(this.Data.Data.length-1),s=this.Data.Data.length-1,a>this.RightSpaceCount&&(a=this.RightSpaceCount));var o=this.CalculateCount(this.ZoomIndex+1),h=this.Data.DataOffset+r.Index;if(X.Chart.Log("[KLineFrame::ZoomDown] old status. XPointCount="+o+" ZoomIndex="+this.ZoomIndex+" DataCount= "+this.Data.Data.length+" lastCursorIndex="+h+" rightSpaceCount="+a),++this.ZoomIndex,r.IsLockRight==!0){var l=this.Data.DataOffset+this.XPointCount;if(o>l)o=l,this.XPointCount=o,this.Data.DataOffset=0;else{var u=s-(o-a)+1;this.XPointCount=o,this.Data.DataOffset=u,this.Data.DataOffset<0&&(this.Data.DataOffset=0)}}else if(o>=t)this.XPointCount=o,this.Data.DataOffset=0,X.Chart.Log("[KLineFrame::ZoomDown] Show all data. XPointCount="+o+" ZoomIndex="+this.ZoomIndex+" DataCount= "+e),o-this.RightSpaceCount>e&&n&&n.ZoomDownloadDataCallback&&n.ZoomDownloadDataCallback({PageSize:o,DataCount:e,RightSpaceCount:this.RightSpaceCount,Count:o-e});else{var u=s-(o-a)+1;if(r.ZoomType==1){var f=o-this.XPointCount+1,C=parseInt(r.Index/this.XPointCount*f),u=this.Data.DataOffset-C;u+(o-this.RightSpaceCount)>=e&&(u=this.Data.DataOffset-f)}this.XPointCount=o,this.Data.DataOffset=u,this.Data.DataOffset<0&&(this.Data.DataOffset=0),X.Chart.Log("[KLineFrame::ZoomDown] calculate. XPointCount="+o+" ZoomIndex="+this.ZoomIndex+" DataCount= "+e+" DataOffset="+this.Data.DataOffset)}this.DataWidth=ie[this.ZoomIndex][0],this.DistanceWidth=ie[this.ZoomIndex][1];{var D=this.GetFrameWidth()-m.FrameMargin;this.TrimKLineDataWidth(D)}return this.LastCalculateStatus.XPointCount=this.XPointCount,r.Index=h-this.Data.DataOffset,!0},this.GetFrameWidth=function(){if(this.IsHScreen){var r=this.ChartBorder.GetHScreenBorder();return r.BottomEx-r.TopEx}else{var r=this.ChartBorder.GetBorder();return r.RightEx-r.LeftEx}},this.DrawCustomHorizontal=function(){if(!this.IsMinSize&&!this.ChartBorder.IsShowTitleOnly&&c.IsNonEmptyArray(this.CustomHorizontalInfo)){var r=this.CustomHorizontalInfo.slice();r.sort(function(a,s){return s.Value-a.Value});for(var n=new Dt.default,e=0;e<r.length;++e){var t=r[e];switch(t.Type){case 0:case 1:this.DrawCustomItem(t,n);break;case 2:case 3:case 4:this.DrawCustomItem(t,n);break}}}},this.DrawCustomVerticalItem=function(r){this.Canvas.save(),r.Data.Line.Type==1&&this.Canvas.setLineDash([5,5]),this.Canvas.strokeStyle=r.Data.Line.Color,this.Canvas.beginPath(),r.IsHScreen?(this.Canvas.moveTo(r.Top,L(r.X)),this.Canvas.lineTo(r.Bottom,L(r.X))):(this.Canvas.moveTo(L(r.X),r.Top),this.Canvas.lineTo(L(r.X),r.Bottom)),this.Canvas.stroke(),this.Canvas.restore()},this.DrawCustomVertical=function(){if(this.CustomVerticalInfo&&!(this.CustomVerticalInfo.length<=0)&&this.Data){var r=this.IsHScreen,n=this.ChartBorder.GetTopEx(),e=this.ChartBorder.GetBottomEx(),t=this.DataWidth,a=this.DistanceWidth,s=this.ChartBorder.GetLeft()+a/2+2;r&&(s=this.ChartBorder.GetTop()+a/2+2,n=this.ChartBorder.GetLeftEx(),e=this.ChartBorder.GetRightEx());for(var o=0,h=this.Data.DataOffset;h<this.Data.Data.length&&o<this.XPointCount;++h,++o,s+=t+a){var l=this.Data.Data[h];for(var u in this.CustomVerticalInfo){var f=this.CustomVerticalInfo[u];if(f.Type==0){if(c.IsNumber(f.Time)){if(l.Date!=f.Date||l.Time!=f.Time)continue}else if(l.Date!=f.Date)continue;var C=s,D=s+t,v=C+(D-C)/2,S={X:v,Top:n,Bottom:e,Data:f,IsHScreen:r};this.DrawCustomVerticalItem(S),this.DrawCustomVerticalEvent&&this.DrawCustomVerticalEvent.Callback(this.DrawCustomVerticalEvent,S,this);break}}}for(var h=1;o<this.XPointCount;++h,++o,s+=t+a)for(var u in this.CustomVerticalInfo){var f=this.CustomVerticalInfo[u];if(f.Type==1&&f.Space==h){var C=s,D=s+t,v=C+(D-C)/2,S={X:v,Top:n,Bottom:e,Data:f,IsHScreen:r};this.DrawCustomVerticalItem(S),this.DrawCustomVerticalEvent&&this.DrawCustomVerticalEvent.Callback(this.DrawCustomVerticalEvent,S,this);break}}}}}function lC(){this.newMethod=Tr,this.newMethod(),delete this.newMethod,this.ClassName="OverlayKLineFrame",this.MainFrame=null,this.IsShareY=!1,this.IsCalculateYMaxMin=!0,this.RightOffset=50,this.PenBorder=m.OverlayFrame.BolderPen,this.IsShow=m.KLineToolbar.IsShowOverlayFrame,this.IsShowToolbar=m.KLineToolbar.IsShowOverlayToolbar,this.Title=null,this.TitleColor=m.OverlayFrame.TitleColor,this.TitleFont=m.OverlayFrame.TitleFont,this.IsYDrawMainFrame=!1,this.Buttons=[],this.CloseButton=ne(m.Buttons.CloseOverlayIndex),this.ModifyIndexParamButton=ne(m.Buttons.ModifyIndexParam),this.KLineFrame_ReloadResource=this.ReloadResource,this.ReloadResource=function(r){this.KLineFrame_ReloadResource(r),r||(this.CloseButton=ne(m.Buttons.CloseOverlayIndex),this.ModifyIndexParamButton=ne(m.Buttons.ModifyIndexParam),this.PenBorder=m.OverlayFrame.BolderPen,this.TitleColor=m.OverlayFrame.TitleColor,this.TitleFont=m.OverlayFrame.TitleFont)},this.Draw=function(){this.Buttons=[],!this.ChartBorder.IsShowTitleOnly&&(this.SplitXYCoordinate(),this.IsShow&&(this.DrawVertical(),this.DrawHorizontal(),this.DrawTitle()),this.SizeChange=!1,this.XYSplit=!1)},this.DrawTitle=function(){if(this.Title){var r=this.ChartBorder.GetBorder(),n=this.ChartBorder.GetTopTitle(),e=r.Bottom,t=r.Right;t+=this.RightOffset,this.Canvas.fillStyle=this.TitleColor,this.Canvas.font=this.TitleFont,this.Canvas.textAlign="center",this.Canvas.textBaseline="top";var a=t-2,s=n+(e-n)/2;this.Canvas.save(),this.Canvas.translate(a,s),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.Title,0,0),this.Canvas.restore()}},this.GetScaleTextWidth=function(){if(!this.IsShow)return null;this.ChartBorder.GetBorder();var r=V();if(this.IsHScreen)var n=this.ChartBorder.Bottom,e=n>10*r&&this.IsShowYText[1]===!0&&this.YTextPosition[1]!=2;else var t=this.ChartBorder.Right,e=t>10&&this.IsShowYText[1]===!0&&this.YTextPosition[1]!=2;if(!e)return null;for(var a={Left:null,Right:0},s=0;s<this.HorizontalInfo.length;++s){var o=null,h=this.HorizontalInfo[s];h&&h.Message[1]!=null&&e&&(h.Font!=null&&(this.Canvas.font=h.Font),o=this.Canvas.measureText(h.Message[1]).width,a.Right<o&&(a.Right=o))}return{TextWidth:a}},this.SplitXYCoordinate=function(){if(this.XYSplit!=!1)if(this.IsShareY){this.HorizontalMax=this.MainFrame.HorizontalMax,this.HorizontalMin=this.MainFrame.HorizontalMin,this.HorizontalInfo=[];for(var r in this.MainFrame.HorizontalInfo){var n=this.MainFrame.HorizontalInfo[r];this.HorizontalInfo.push(n)}this.CoordinateType=this.MainFrame.CoordinateType}else this.YSplitOperator!=null&&this.YSplitOperator.Operator()},this.DrawHorizontal=function(){var r=this.ChartBorder.GetBorder();r.Left;var n=r.Right,e=r.Bottom,t=this.ChartBorder.GetTopTitle(),a=this.ChartBorder.Right;n+=this.RightOffset;for(var s=null,o=this.HorizontalInfo.length-1;o>=0;--o){var h=this.HorizontalInfo[o],l=this.GetYFromData(h.Value);if(!(l!=null&&Math.abs(l-s)<this.MinYDistance)){if(l>=e-2?this.Canvas.textBaseline="bottom":l<=t+2?this.Canvas.textBaseline="top":this.Canvas.textBaseline="middle",this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(n-2,L(l)),this.Canvas.lineTo(n,L(l)),this.Canvas.stroke(),h.Message[1]!=null&&a>10){h.Font!=null&&(this.Canvas.font=h.Font);var u=h.Message[1];Array.isArray(h.Message[1])&&(u=h.Message[1][0]),this.Canvas.fillStyle=h.TextColor,this.Canvas.textAlign="left",this.Canvas.fillText(u,n+2,l)}s=l}}},this.DrawVertical=function(){var r=this.ChartBorder.GetBorder(),n=r.TopEx,e=r.Right,t=r.BottomEx;e+=this.RightOffset,this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),this.Canvas.moveTo(L(e),L(n)),this.Canvas.lineTo(L(e),L(t)),this.Canvas.stroke()},this.DrawToolbar=function(r,n,e){if(this.Buttons=[],n!=!0&&!this.ChartBorder.IsShowTitleOnly&&!(this.ChartBorder.TitleHeight<5)&&this.IsShowToolbar){var t=this.ChartBorder.GetBorder(),a=t.Top+this.ChartBorder.TitleHeight/2,s=t.Right+this.RightOffset+this.CloseButton.MerginLeft,o=[];o.push({ID:xt.MODIFY_OVERLAY_INDEX_PARAM,Style:this.ModifyIndexParamButton}),o.push({ID:xt.CLOSE_OVERLAY_INDEX,Style:this.CloseWindowButton});for(var h=0;h<o.length;++h){var l=o[h],u=l.Style.Size,f=u+"px "+l.Style.Family,C={Left:s,Top:a-u/2,Right:s+u+l.Style.MerginLeft,Bottom:a+u/2,Width:u+l.Style.MerginLeft,Height:u},D=this.CloseButton.Color;r&&r.X>=C.Left&&r.X<C.Right&&r.Y>=C.Top&&r.Y<=C.Bottom&&(D=l.Style.MoveOnColor,e&&(e.MouseOnToolbar={Rect:C,Item:l,Frame:this,Point:{X:r.X,Y:r.Y}})),this.Canvas.fillStyle=D,this.Canvas.font=f,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(l.Style.Text,s,a),this.Buttons.push({ID:l.ID,Rect:C}),s=C.Right}}},this.DrawCustomItem=function(r,n){if(!(!this.IsShow&&!this.IsYDrawMainFrame)&&!(!r.Message[1]&&!r.Message[0])){if(r.Value>this.HorizontalMax||r.Value<this.HorizontalMin){this.SendDrawCountDownEvent({IsShow:!1});return}var e=this.GetBorder(),t=e.Left,a=e.Right+this.RightOffset;this.IsYDrawMainFrame&&(a=e.Right);var s=e.Bottom,o=e.Top,h=this.ChartBorder.Right,l=this.ChartBorder.Left;this.ChartBorder.TitleHeight,this.IsHScreen&&(l=this.ChartBorder.Top,h=this.ChartBorder.Bottom,o=e.Top,s=e.Bottom);var u=V(),f=18*u,C=f,D=this.GetYFromData(r.Value),v=0,S;if(r.ExtendData&&r.ExtendData.Custom){var T=r.ExtendData.Custom;c.IsNumber(T.Position)&&(v=T.Position),T.EmptyBGColor&&(S=T.EmptyBGColor)}if(r.Message[0])if(l<10||v==1){r.Font!=null&&(this.Canvas.font=r.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(r,!0,u),F=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;var M=r.LineColor,O=this.RGBToStruct(r.LineColor);O&&(M="rgba("+O.R+", "+O.G+", "+O.B+", "+m.FrameLatestPrice.BGAlpha+")");for(var R=D,b=0;b<I.Text.length;++b){var p=I.Text[b];if(this.IsHScreen){var G=o,Y=R-C/2-1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,C,p.Width),this.DrawHScreenText({X:R,Y:G},{Text:p.Text,Color:r.TextColor,XOffset:1*u,YOffset:2*u}),b==0&&this.DrawLine(G+p.Width,s,R,r.LineColor,r.LineType,r),R-=C+1*u}else if(p.Type!==1){var G=R-C/2-1*u,Y=t+1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,p.Width,C),this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(p.Text,Y+1*u,R),b==0&&this.DrawLine(Y+p.Width,a,R,r.LineColor,r.LineType,r),R+=C+1*u}}}else{r.Font!=null&&(this.Canvas.font=r.Font),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(r,!0,u),F=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;for(var R=D,b=0;b<I.Text.length;++b){var p=I.Text[b];if(this.IsHScreen){if(b==0)var G=o-p.Width;else var G=o-F;var Y=R-C/2-1*u;this.Canvas.fillStyle=r.LineColor,this.Canvas.fillRect(Y,G,C,p.Width),this.DrawHScreenText({X:R,Y:G},{Text:p.Text,Color:r.TextColor,XOffset:1*u,YOffset:2*u}),b==0&&this.DrawLine(G+p.Width,s,R,r.LineColor,r.LineType,r),R-=C+1*u}else{var G=R-C/2-1*u;if(b==0)var Q=t-p.Width,Y=t;else var Q=t-F,Y=t-(F-p.Width);S?(this.Canvas.fillStyle=S,this.Canvas.fillRect(Q-1,G,p.Width+1,C),this.Canvas.strokeStyle=r.LineColor,this.Canvas.strokeRect(L(Q-1),L(G),L(p.Width+1),L(C)),this.Canvas.fillStyle=r.LineColor,this.Canvas.fillText(p.Text,Y-1*u,R)):(this.Canvas.fillStyle=r.LineColor,this.Canvas.fillRect(Q,G,p.Width,C),this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(p.Text,Y-1*u,R)),b==0&&this.DrawLine(t,a,R,r.LineColor,r.LineType,r),R+=C+1*u}}}else if(r.Message[1])if(h<10||v==1){r.Font!=null&&(this.Canvas.font=r.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(r,!1,u),F=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;var M=r.LineColor,O=this.RGBToStruct(r.LineColor);O&&(M="rgba("+O.R+", "+O.G+", "+O.B+", "+m.FrameLatestPrice.BGAlpha+")");for(var R=D,b=0;b<I.Text.length;++b){var p=I.Text[b];if(this.IsHScreen){var G=s-p.Width,Y=R-C/2-1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,C,F),this.DrawHScreenText({X:R,Y:G},{Text:p.Text,Color:r.TextColor,XOffset:1*u,YOffset:2*u}),b==0&&this.DrawLine(o,G,R,r.LineColor,r.LineType,r),R-=C+1*u}else if(p.Type===1){if(this.GetEventCallback){var G=R-C/2-1*u,ht={Top:G,Right:a,Height:null,IsShow:!0,BGColor:r.LineColor,TextColor:r.TextColor,PixelTatio:u,Position:"Right",IsInside:!0};this.SendDrawCountDownEvent(ht)&&c.IsPlusNumber(ht.Height)&&(R+=C+1*u)}}else{var G=R-C/2-1*u,Y=a-p.Width;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,F,C),this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(p.Text,Y+1*u,R),b==0&&this.DrawLine(t,Y,R,r.LineColor,r.LineType,r),R+=C+1*u}}if((r.Type==3||r.Type==4)&&r.Title){var Ct=this.Canvas.measureText(r.Title).width+2*u;if(this.IsHScreen){var G=s-p.Width-Ct,Y=D-C/2-1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,C,Ct),this.DrawHScreenText({X:D,Y:G},{Text:r.Title,Color:r.TextColor,XOffset:1*u,YOffset:2*u})}else{var G=D-C/2-1*u,Y=a-F-Ct-1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,Ct,C),this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(r.Title,Y+1*u,D)}}}else{r.Font!=null&&(this.Canvas.font=r.Font),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var I=this.GetCustomItemTextInfo(r,!1,u),F=I.MaxWidth,E=this.GetFontHeight();C=E>f?E:f;var lt=null;n&&n.has(3)&&(lt=n.get(3));for(var R=D,dt={},b=0;b<I.Text.length;++b){var p=I.Text[b];if(this.IsHScreen){var G=s,Y=R-C/2-1*u;this.Canvas.fillStyle=r.LineColor,this.Canvas.fillRect(Y,G,C,p.Width),this.DrawHScreenText({X:R,Y:G},{Text:p.Text,Color:r.TextColor,XOffset:1*u,YOffset:2*u}),b==0&&this.DrawLine(o,G,R,r.LineColor,r.LineType,r),R-=C+1*u}else if(p.Type===1){if(this.GetEventCallback){var G=R-C/2-1*u,ht={Top:G,Left:a,Right:this.ChartBorder.GetChartWidth(),Height:null,IsShow:!0,BGColor:r.LineColor,TextColor:r.TextColor,PixelTatio:u,Position:"Right",IsInside:!1};this.SendDrawCountDownEvent(ht)&&c.IsPlusNumber(ht.Height)&&(R+=C+1*u)}}else{var G=R-C/2-1*u;if(b==0){var Y=a;dt.Left=Y,lt&&G<lt.Rect.Bottom&&(R=lt.Rect.Bottom,G=R-C/2-1*u)}else var Y=a+F-p.Width;S?(this.Canvas.fillStyle=S,this.Canvas.fillRect(Y,G,p.Width+1,C),this.Canvas.strokeStyle=r.LineColor,this.Canvas.strokeRect(L(Y),L(G),B(p.Width+1),B(C)),this.Canvas.fillStyle=r.LineColor,this.Canvas.fillText(p.Text,Y+2*u,R)):(this.Canvas.fillStyle=r.LineColor,this.Canvas.fillRect(Y,G,p.Width,C),this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(p.Text,Y+1*u,R)),b==0&&this.DrawLine(t,a,D,r.LineColor,r.LineType,r),R+=C+1*u,dt.Bottom=R}}if(n&&c.IsNumber(dt.Left)&&c.IsNumber(dt.Bottom)&&n.set(3,{Rect:dt,Item:r}),(r.Type==3||r.Type==4)&&r.Title){var M=r.LineColor,O=this.RGBToStruct(r.LineColor);O&&(M="rgba("+O.R+", "+O.G+", "+O.B+", "+m.FrameLatestPrice.BGAlpha+")");var Ct=this.Canvas.measureText(r.Title).width+2*u;if(this.IsHScreen){var G=s-Ct,Y=D-C/2-1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,C,Ct),this.DrawHScreenText({X:D,Y:G},{Text:r.Title,Color:r.TextColor,XOffset:1*u,YOffset:2*u})}else{var G=D-C/2-1*u,Y=a-Ct-1*u;this.Canvas.fillStyle=M,this.Canvas.fillRect(Y,G,Ct,C),this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(r.Title,Y+1*u,D)}}}}}}function Rh(){this.newMethod=Tr,this.newMethod(),delete this.newMethod,this.ClassName="KLineHScreenFrame",this.IsHScreen=!0,this.DrawTitleBG=function(){if(!(this.ChartBorder.TitleHeight<=0)){var r=this.ChartBorder.GetHScreenBorder(),n=L(r.RightTitle),e=L(r.Top),t=L(r.Bottom),a=this.ChartBorder.TitleHeight,s=t-e;this.Canvas.fillStyle=this.TitleBGColor,this.Canvas.fillRect(n,e,a,s)}},this.DrawToolbar=function(){},this.GetYFromData=function(r,n){var e=this.ChartBorder.GetHScreenBorder();if(n===!1){var t=(e.RightEx-e.LeftEx)*(r-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return e.LeftEx+t}else{if(r<=this.HorizontalMin)return e.LeftEx;if(r>=this.HorizontalMax)return e.RightEx;var t=(e.RightEx-e.LeftEx)*(r-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return e.LeftEx+t}},this.DrawHorizontal=function(){var r=this.ChartBorder.GetHScreenBorder(),n=r.Top,e=r.Bottom,t=this.ChartBorder.Top,a=this.ChartBorder.Bottom,s=r.Left;r.Right;for(var o=null,h=V(),l=t>10*h&&this.IsShowYText[0]===!0&&this.YTextPosition[0]!=2,u=a>10*h&&this.IsShowYText[1]===!0&&this.YTextPosition[1]!=2,f=this.HorizontalInfo.length-1;f>=0;--f){var C=this.HorizontalInfo[f],D=this.GetYFromData(C.Value);if(!(D!=null&&Math.abs(D-o)<this.MinYDistance)){if(D!=s&&(C.LineType==2?(this.Canvas.strokeStyle=C.LineColor,this.Canvas.setLineDash([5*h,5*h]),this.Canvas.beginPath(),this.Canvas.moveTo(L(D),n),this.Canvas.lineTo(L(D),e),this.Canvas.stroke(),this.Canvas.setLineDash([])):C.LineType>0&&(this.Canvas.strokeStyle=C.LineColor,m.FrameYLineDash?(this.Canvas.setLineDash(m.FrameYLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(L(D),n),this.Canvas.lineTo(L(D),e),this.Canvas.stroke(),this.Canvas.setLineDash([])):(this.Canvas.beginPath(),this.Canvas.moveTo(L(D),n),this.Canvas.lineTo(L(D),e),this.Canvas.stroke()))),C.Message[0]!=null&&l){C.Font!=null&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="right",this.Canvas.textBaseline="middle";var v=D,S=n;this.Canvas.save(),this.Canvas.translate(v,S),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(C.Message[0],-2,0),this.Canvas.restore()}if(C.Message[1]!=null&&u){C.Font!=null&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var T;Array.isArray(C.Message[1])?T=C.Message[1][0]:T=C.Message[1];var v=D,S=e;this.Canvas.save(),this.Canvas.translate(v,S),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(T,2,0),this.Canvas.restore()}o=D}}},this.DrawInsideHorizontal=function(){if(!this.IsMinSize&&!(this.IsShowYText[0]===!1&&this.IsShowYText[1]===!1)){var r=this.ChartBorder.GetLeft(),n=this.ChartBorder.GetRightEx(),e=this.ChartBorder.GetTop(),t=this.ChartBorder.GetBottom(),a=this.ChartBorder.Top,s=this.ChartBorder.Bottom;this.ChartBorder.TitleHeight;var o=V(),h=(a<10*o||this.YTextPosition[0]==2)&&this.IsShowYText[0]===!0,l=(s<10*o||this.YTextPosition[1]==2)&&this.IsShowYText[1]===!0;if(h||l)for(var o=V(),u=null,f=this.HorizontalInfo.length-1;f>=0;--f){var C=this.HorizontalInfo[f],D=this.GetYFromData(C.Value);if(!(D!=null&&u!=null&&Math.abs(D-u)<this.MinYDistance)){if(C.Message[0]!=null&&h){C.Font!=null&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="left",D>=n-2?this.Canvas.textBaseline="top":D<=r+2?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font,C.Message[0];var v=D,S=e;this.Canvas.save(),this.Canvas.translate(v,S),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(C.Message[0],-2,0),this.Canvas.restore()}if(C.Message[1]!=null&&l){if(C.Font!=null&&(this.Canvas.font=C.Font),this.Canvas.fillStyle=C.TextColor,this.Canvas.textAlign="right",D>=n-2?this.Canvas.textBaseline="top":D<=r+2?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",Array.isArray(C.Message[1]))var T=C.Message[1][0];else var T=C.Message[1];var I=this.Canvas.measureText(T).width;n-I,this.Canvas.textBaseline,this.Canvas.textAlign,this.Canvas.font;var v=D,S=t;this.Canvas.save(),this.Canvas.translate(v,S),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(T,-2,0),this.Canvas.restore()}u=D}}}},this.GetXFromIndex=function(r,n){if(n===!1){var e=this.ChartBorder.GetHScreenBorder();if(r>=0)for(var t=e.TopEx+m.FrameLeftMargin+this.DistanceWidth/2+this.DataWidth/2,a=1;a<=r;++a)t+=this.DistanceWidth+this.DataWidth;else for(var t=e.TopEx-(this.DistanceWidth/2+this.DataWidth+this.DistanceWidth),s=Math.abs(r),a=1;a<s;++a)t-=this.DistanceWidth+this.DataWidth}else{r<0&&(r=0),r>this.xPointCount-1&&(r=this.xPointCount-1);for(var e=this.ChartBorder.GetHScreenBorder(),t=e.TopEx+m.FrameLeftMargin+this.DistanceWidth/2+this.DataWidth/2,a=1;a<=r;++a)t+=this.DistanceWidth+this.DataWidth}return t},this.DrawVertical=function(){var r=this.ChartBorder.GetHScreenBorder(),n=r.Left,e=r.RightTitle,t=r.Bottom,a=V(),s=null;for(var o in this.VerticalInfo){var h=this.GetXFromIndex(this.VerticalInfo[o].Value);if(h>=t)break;if(!(s!=null&&Math.abs(h-s)<80)){var l=this.VerticalInfo[o];if(l.LineType==2?(this.Canvas.strokeStyle=this.VerticalInfo[o].LineColor,this.Canvas.setLineDash([5*a,5*a]),this.Canvas.beginPath(),this.Canvas.moveTo(n,L(h)),this.Canvas.lineTo(e,L(h)),this.Canvas.stroke(),this.Canvas.setLineDash([])):l.LineType>0&&(this.Canvas.strokeStyle=this.VerticalInfo[o].LineColor,m.FrameXLineDash?(this.Canvas.setLineDash(m.FrameXLineDash),this.Canvas.beginPath(),this.Canvas.moveTo(n,L(h)),this.Canvas.lineTo(e,L(h)),this.Canvas.stroke(),this.Canvas.setLineDash([])):(this.Canvas.beginPath(),this.Canvas.moveTo(n,L(h)),this.Canvas.lineTo(e,L(h)),this.Canvas.stroke())),this.VerticalInfo[o].Message[0]!=null){this.VerticalInfo[o].Font!=null&&(this.Canvas.font=this.VerticalInfo[o].Font),this.Canvas.fillStyle=this.VerticalInfo[o].TextColor;var u=this.Canvas.measureText(this.VerticalInfo[o].Message[0]).width;h<u/2?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top"):(this.Canvas.textAlign="center",this.Canvas.textBaseline="top");var f=n,C=h;this.Canvas.save(),this.Canvas.translate(f,C),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.VerticalInfo[o].Message[0],0,this.XBottomOffset),this.Canvas.restore()}s=h}}},this.GetYData=function(r,n){var e=this.ChartBorder.GetHScreenBorder();if(n===!1){var t=e.RightEx-e.LeftEx;return(r-e.LeftEx)/t*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin}else{if(r<e.LeftEx)return this.HorizontalMin;if(r>e.RightEx)return this.HorizontalMax;var t=e.RightEx-e.LeftEx;return(r-e.LeftEx)/t*(this.HorizontalMax-this.HorizontalMin)+this.HorizontalMin}},this.GetXData=function(r,n){var e=this.ChartBorder.GetHScreenBorder(),t=e.TopEx+m.FrameLeftMargin,a=e.BottomEx,s=this.DistanceWidth,o=this.DataWidth;if(n==!1)if(r<t){for(var h=-1,l=t-(s/2+o+s);h>-1e4&&!(l<=r);)l-=o+s,--h;return h}else{for(var h=0,l=t+s/2+o+s;h<1e4&&!(l>=r);)l+=o+s,++h;return h}else{if(r<=e.TopEx)return 0;if(r>=e.BottomEx)return this.XPointCount-1;for(var h=0,l=t+s/2+o+s;l<a&&h<1e4&&h+1<this.XPointCount&&!(l>r);)l+=o+s,++h;return h}},this.DrawBottons=function(){}}function uC(){this.newMethod=Rh,this.newMethod(),delete this.newMethod,this.ClassName="OverlayKLineHScreenFrame",this.MainFrame=null,this.IsShareY=!1,this.IsCalculateYMaxMin=!0,this.RightOffset=50,this.PenBorder=m.OverlayFrame.BolderPen,this.IsShow=!0,this.Title=null,this.TitleColor=m.OverlayFrame.TitleColor,this.TitleFont=m.OverlayFrame.TitleFont,this.Draw=function(){this.SplitXYCoordinate(),this.IsShow&&(this.DrawVertical(),this.DrawHorizontal(),this.DrawTitle()),this.SizeChange=!1,this.XYSplit=!1},this.DrawTitle=function(){},this.SplitXYCoordinate=function(){if(this.XYSplit!=!1)if(this.IsShareY){this.HorizontalMax=this.MainFrame.HorizontalMax,this.HorizontalMin=this.MainFrame.HorizontalMin,this.HorizontalInfo=[];for(var r in this.MainFrame.HorizontalInfo){var n=this.MainFrame.HorizontalInfo[r];this.HorizontalInfo.push(n)}}else this.YSplitOperator!=null&&this.YSplitOperator.Operator()},this.DrawHorizontal=function(){},this.DrawVertical=function(){},this.GetScaleTextWidth=function(){return{TextWidth:0}}}function dr(){this.Frame,this.Height,this.OverlayIndex=[],this.Interval=60}function Qn(){this.Frame,this.ChartPaint=[],this.Identify=oe(),this.Scprit,this.UpdateFrameMaxMin=function(){var r={Max:null,Min:null};if(this.Frame.IsShareY){this.Frame.XYSplit=!0;return}if(this.Frame.YSpecificMaxMin)r.Max=this.Frame.YSpecificMaxMin.Max,r.Min=this.Frame.YSpecificMaxMin.Min;else for(var n in this.ChartPaint){var e=this.ChartPaint[n],t=e.GetMaxMin();c.IsNumber(t.Max)&&(r.Max==null||r.Max<t.Max)&&(r.Max=t.Max),c.IsNumber(t.Min)&&(r.Min==null||r.Min>t.Min)&&(r.Min=t.Min)}r.Max!=null&&r.Min!=null&&(this.Frame.HorizontalMax=r.Max,this.Frame.HorizontalMin=r.Min,this.Frame.XYSplit=!0)}}function yh(){this.SubFrame=new Array,this.SizeChange=!0,this.ChartBorder,this.Canvas,this.ScreenImageData,this.Data,this.Position,this.SizeChange=!0,this.MinSubFrameHeight=m.DragSubFrameBorder.MinFrameHeight,this.DragBorderHeight=m.DragSubFrameBorder.TopBorderHeight,this.AutoLeftBorder=null,this.AutoRightBorder=null,this.OverlayBlankWidth=40,this.AuotRightWidth,this.ZoomWindowsInfo=null,this.ZoomStartWindowIndex=1,this.GetExtendChartByClassName,this.GetEventCallback,this.OnMoveFromeBorder=function(r,n){if(this.SubFrame.length<=0)return!1;for(var e=this.SubFrame[r],t=null,a=r+1;a<this.SubFrame.length;++a){var s=this.SubFrame[a];if(s.Height>0){t=s;break}}if(!e||!t)return!1;var o=e.Frame.ChartBorder.Bottom,h=t.Frame.ChartBorder.Top;e.Frame.ChartBorder.Bottom-=n,t.Frame.ChartBorder.Top+=n;var l=e.Frame.ChartBorder.GetHeightEx(),u=t.Frame.ChartBorder.GetHeightEx();return l<this.MinSubFrameHeight&&n<0||u<this.MinSubFrameHeight&&n>0?(e.Frame.ChartBorder.Bottom=o,t.Frame.ChartBorder.Top=h,!1):!0},this.ReDrawToolbar=function(){for(var r in this.SubFrame)this.SubFrame[r].Frame.ReDrawToolbar=!0},this.SetFrameBorderSizeChange=function(){var r=this.SubFrame[0];if(!(!r||!r.Frame)){var n=r.Frame.YSplitOperator;n&&n.CoordinateType==2&&(r.Frame.XYSplit=!0)}},this.CancelZoomUpDownFrameY=function(r){var n=r.Index;if(this.SubFrame.length<=0||!this.SubFrame[n])return!1;var e=this.SubFrame[n],t=e.Frame,a=t.YSplitOperator;if(a.FixedYMaxMin){a.FixedYMaxMin=null,a.EnableZoomUpDown=!1,t.XYSplit=!0;for(var s in e.OverlayIndex){var o=e.OverlayIndex[s];o.Frame.IsShareY&&(o.Frame.XYSplit=!0)}return X.Chart.Log("[HQTradeFrame::CancelZoomUpDownFrameY]"),!0}return!1},this.OnZoomUpDownFrameY=function(r,n){var e=r.Index;if(this.SubFrame.length<=0||!this.SubFrame[e])return!1;var t=this.SubFrame[e],a=t.Frame,s=a.ChartBorder.GetTopEx(),o=a.ChartBorder.GetBottomEx(),h=a.HorizontalMax,l=a.HorizontalMin,u=(h-l)*Math.abs(n)/(o-s),f=a.YSplitOperator,C={Max:h,Min:l};if(r.Position==1){var D=n>0?-u:u;C.Max+=D}else if(r.Position==2){var D=n>0?-u:u;C.Min+=D}else if(r.Position==0){var D=n>0?u:-u;C.Max+=D,C.Min-=D}else return!1;if(C.Max>C.Min){f.FixedYMaxMin=C,f.EnableZoomUpDown=!0,a.XYSplit=!0;for(var v in t.OverlayIndex){var S=t.OverlayIndex[v];S.Frame.IsShareY&&(S.Frame.XYSplit=!0)}return X.Chart.Log("[HQTradeFrame::OnZoomUpDownFrameY] Max="+C.Max+", Min="+C.Min),!0}return!1},this.OnUpDonwFrameY=function(r,n){var e=r.Index;if(this.SubFrame.length<=0||!this.SubFrame[e])return!1;var t=this.SubFrame[e],a=t.Frame,s=a.ChartBorder.GetTopEx(),o=a.ChartBorder.GetBottomEx(),h=a.YSplitOperator;if(!h)return!1;var l=a.HorizontalMax,u=a.HorizontalMin,f=(l-u)*Math.abs(n)/(o-s),C=n>0?-f:f,D={Max:l,Min:u};D.Max-=C,D.Min-=C,h.FixedYMaxMin=D,h.EnableZoomUpDown=!0,a.XYSplit=!0;for(var v in t.OverlayIndex){var S=t.OverlayIndex[v];S.Frame.IsShareY&&(S.Frame.XYSplit=!0)}return X.Chart.Log("[HQTradeFrame::OnUpDonwFrameY] Max="+D.Max+", Min="+D.Min+", yMove="+n+", moveStep="+f),!0},this.ClearUpDonwFrameYData=function(r){if(!(this.SubFrame.length<=0))if(r){var n=r.Index;if(n<0||n>=this.SubFrame.length)return;var e=this.SubFrame[n];if(!e||!e.Frame||!e.Frame.YSplitOperator)return;var t=e.Frame.YSplitOperator;t.EnableZoomUpDown==!0&&(t.FixedYMaxMin=null)}else for(var a=0;a<this.SubFrame.length;++a){var e=this.SubFrame[a];if(!(!e||!e.Frame||!e.Frame.YSplitOperator)){var t=e.Frame.YSplitOperator;t.EnableZoomUpDown==!0&&(t.FixedYMaxMin=null)}}},this.ClearCoordinateText=function(r){for(var n=0;n<this.SubFrame.length;++n){var e=this.SubFrame[n];e.Frame&&e.Frame.ClearCoordinateText(r)}},this.RestoreIndexWindows=function(){if(!this.ZoomWindowsInfo)return!1;this.SubFrame[this.ZoomWindowsInfo.FrameID];for(var r=this.ZoomStartWindowIndex;r<this.ZoomWindowsInfo.Data.length;++r){var n=this.ZoomWindowsInfo.Data[r],e=this.SubFrame[r];e.Height=n.Height,e.Frame.IsMinSize=!1,e.Frame.ReDrawToolbar=!0,e.Frame.XSplitOperator.ShowText=n.ShowXText,e.Frame.XYSplit=!0;for(var t=0;t<e.OverlayIndex.length;++t){var a=e.OverlayIndex[t];a.Frame.IsMinSize=!1}}return this.ZoomWindowsInfo=null,!0},this.ZoomIndexWindow=function(r,n){var e=this.SubFrame[r];if(!e)return!1;if(e.Frame.ChartBorder.IsShowTitleOnly=!1,this.ZoomWindowsInfo)return this.RestoreIndexWindows();for(var t={FrameID:r,Data:[]},a=0;a<this.SubFrame.length;++a){var s=this.SubFrame[a];t.Data[a]={Height:s.Height,ShowXText:s.Frame.XSplitOperator.ShowText}}this.ZoomWindowsInfo=t;for(var o=0,a=this.ZoomStartWindowIndex;a<this.SubFrame.length;++a){var s=this.SubFrame[a],h=s.Frame;if(h.XYSplit=!0,o+=s.Height,a!=r){s.Height=0,h.IsMinSize=!0,h.HideToolbar(),h.XSplitOperator.ShowText=!1;for(var l=0;l<s.OverlayIndex.length;++l){var u=s.OverlayIndex[l];u.Frame.IsMinSize=!0}}}return e.Height=o,e.Frame.XSplitOperator.ShowText=!0,!0},this.SaveSubFrameHeightRate=function(){for(var r=this.ChartBorder.GetHeight(),n=0;n<this.SubFrame.length;++n){var e=this.SubFrame[n],t=e.Frame.ChartBorder.GetHeight(),a=t/r*100;e.Height=a}},this.ShowIndexTitleOnly=function(r,n){var e=this.SubFrame[r];if(!e&&!e.Frame)return!1;var t=e.Frame;if(!t.ChartBorder)return!1;var a=t.ChartBorder;return a.TitleHeight<10?!1:(this.RestoreIndexWindows(),a.IsShowTitleOnly?a.IsShowTitleOnly=!1:a.IsShowTitleOnly=!0,!0)},this.CalculateChartBorder=function(){if(!(this.SubFrame.length<=0)){for(var r=this.ChartBorder.GetTop(),n=this.ChartBorder.GetHeight(),e=0,t=0,a=0;a<this.SubFrame.length;++a){var s=this.SubFrame[a],o=s.Frame;o&&o.ChartBorder&&o.ChartBorder.IsShowTitleOnly&&s.Height>0?t+=o.ChartBorder.TitleHeight:e+=s.Height}n-=t;for(var a=0;a<this.SubFrame.length;++a){var s=this.SubFrame[a],o=s.Frame;if(s.Frame.ChartBorder.Top=r,s.Frame.ChartBorder.Left=this.ChartBorder.Left,s.Frame.ChartBorder.Right=this.ChartBorder.Right,s.Frame.ChartBorder.LeftExtendWidth=this.ChartBorder.LeftExtendWidth,s.Frame.ChartBorder.RightExtendWidth=this.ChartBorder.RightExtendWidth,o&&o.ChartBorder&&o.ChartBorder.IsShowTitleOnly&&s.Height>0){var h=s.Frame.ChartBorder.Top+o.ChartBorder.TitleHeight;s.Frame.ChartBorder.Bottom=this.ChartBorder.GetChartHeight()-h,r=h}else{var h=n*(s.Height/e)+r;s.Frame.ChartBorder.Bottom=this.ChartBorder.GetChartHeight()-h,r=h}}if(this.GetEventCallback){var l=this.GetEventCallback(et.ON_SIZE_FRAME);if(l&&l.Callback){var u={SubFrame:this.SubFrame};l.Callback(l,u,this)}}}},this.SetExtendWidth=function(r){if(r){var n=null,e=null;c.IsNumber(r.Left)&&(n=r.Left,this.ChartBorder.LeftExtendWidth=n),c.IsNumber(r.Right)&&(e=r.Right,this.ChartBorder.RightExtendWidth=e);for(var t in this.SubFrame){var a=this.SubFrame[t];n!=null&&(a.Frame.ChartBorder.LeftExtendWidth=n),e!=null&&(a.Frame.ChartBorder.RightExtendWidth=e)}}},this.CalculateChartBorder2=function(){if(!(this.SubFrame.length<=0)){var r=this.ChartBorder.Top,n=this.ChartBorder.Bottom,e=this.ChartBorder.GetHeight(),t=0;for(var a in this.SubFrame){var s=this.SubFrame[a];t+=s.Height}var o=0;for(var a in this.SubFrame){var s=this.SubFrame[a];s.Frame.ChartBorder.Top=r,s.Frame.ChartBorder.Left=this.ChartBorder.Left,s.Frame.ChartBorder.Right=this.ChartBorder.Right,s.Frame.ChartBorder.X=this.ChartBorder.X,s.Frame.ChartBorder.Y=this.ChartBorder.Y,s.Frame.ChartBorder.Width=this.ChartBorder.Width,s.Frame.ChartBorder.Height=this.ChartBorder.Height;var h=e*(s.Height/t);o+=h,n=this.ChartBorder.Bottom+(e-o),s.Frame.ChartBorder.Bottom=n,r+=h}}},this.GetScaleTextWidth=function(){for(var r={Left:null,Right:null,OverlayRight:0},n=[],e=0;e<this.SubFrame.length;++e){var t=this.SubFrame[e];if(!(t.Height<=0)){var a=t.Frame;if(a&&a.XSplitOperator){var s=a.HorizontalMax,o=a.HorizontalMin;a.YSplitOperator.Operator();var h=a.GetScaleTextWidth();if(a.HorizontalMax=s,a.HorizontalMin=o,h&&h.TextWidth){var l=h.TextWidth;c.IsNumber(l.Left)&&(r.Left==null||r.Left<l.Left)&&(r.Left=l.Left),c.IsNumber(l.Right)&&(r.Right==null||r.Right<l.Right)&&(r.Right=l.Right)}if(c.IsNonEmptyArray(t.OverlayIndex))for(var u=0,f=0;u<t.OverlayIndex.length;++u){var C=t.OverlayIndex[u];if(C.Frame){var s=C.Frame.HorizontalMax,o=C.Frame.HorizontalMin;C.Frame.YSplitOperator.Operator();var h=C.Frame.GetScaleTextWidth();if(C.Frame.HorizontalMax=s,C.Frame.HorizontalMin=o,C.RightWidth={Index:-1,Width:0},!(!h||!h.TextWidth)){var l=h.TextWidth;c.IsNumber(l.Right)&&(C.RightWidth.Index=f,C.RightWidth.Width=l.Right,n[f]||(n[f]=[]),n[f][e]=C.RightWidth,++f)}}}}}}for(var D=[],e=0;e<n.length;++e){for(var v=n[e],S=0,u=0;u<v.length;++u)if(v[u]){var t=v[u].Width;S<t&&(S=t)}S>0&&(S+=this.OverlayBlankWidth);for(var u=0;u<v.length;++u)v[u]&&(v[u].Width=S);D[e]=S}for(var e=0;e<D.length;++e){var h=D[e];c.IsNumber(h)&&(r.OverlayRight+=h)}return r},this.IsFrameXYSplit=function(){for(var r in this.SubFrame){var n=this.SubFrame[r];if(n.Frame.XYSplit)return!0;for(var e=0;e<n.OverlayIndex.length;++e){var t=n.OverlayIndex[e];if(t.Frame.XYSplit)return!0}}return!1},this.Draw=function(r){this.SizeChange===!0&&this.CalculateChartBorder();var n=!1;if(r&&r.IsEnableSplash===!0&&(n=!0),n==!1&&(this.AutoLeftBorder||this.AutoRightBorder)&&this.IsFrameXYSplit()){this.AutoRightOverlayWidth=[];var e=this.GetScaleTextWidth();if(c.IsNumber(e.Left)&&this.AutoLeftBorder){var t=0;c.IsNumber(this.AutoLeftBorder.Blank)&&(t=this.AutoLeftBorder.Blank);var a=e.Left+t;c.IsNumber(this.AutoLeftBorder.MinWidth)&&this.AutoLeftBorder.MinWidth>a&&(a=this.AutoLeftBorder.MinWidth),this.IsHScreen?this.ChartBorder.Top=a:this.ChartBorder.Left=a;for(var s=0;s<this.SubFrame.length;++s){var o=this.SubFrame[s];this.IsHScreen?o.Frame.ChartBorder.Top=a:o.Frame.ChartBorder.Left=a}}if(c.IsNumber(e.Right)&&this.AutoRightBorder){var t=0;c.IsNumber(this.AutoRightBorder.Blank)&&(t=this.AutoRightBorder.Blank);var a=e.Right+t;if(c.IsNumber(this.AutoRightBorder.MinWidth)&&this.AutoRightBorder.MinWidth>a&&(a=this.AutoRightBorder.MinWidth),this.AuotRightWidth=a,c.IsPlusNumber(e.OverlayRight)&&(a+=this.OverlayBlankWidth,this.AuotRightWidth=a,a+=e.OverlayRight),this.GetExtendChartRightWidth){var h=this.GetExtendChartRightWidth();if(this.GetExtendChartByClassName){var l=this.GetExtendChartByClassName("StockChip");l&&l.Chart&&(l.Chart.Left=a)}a+=h}this.IsHScreen?(this.ChartBorder.Bottom!=a,this.ChartBorder.Bottom=a):(this.ChartBorder.Right!=a,this.ChartBorder.Right=a);for(var s=0;s<this.SubFrame.length;++s){var o=this.SubFrame[s];this.IsHScreen?o.Frame.ChartBorder.Bottom=a:o.Frame.ChartBorder.Right=a,o.Frame.ReDrawToolbar=!0,o.Interval=this.AuotRightWidth}}this.SetSizeChage(!0)}for(var s=0;s<this.SubFrame.length;++s){var o=this.SubFrame[s];if(!(o.Height<=0))if(o.Frame.Draw(),this.AutoRightBorder)for(var u=this.AuotRightWidth,f=0;f<o.OverlayIndex.length;++f){var C=o.OverlayIndex[f];C.Frame.DataWidth=o.Frame.DataWidth,C.Frame.DistanceWidth=o.Frame.DistanceWidth,C.Frame.XPointCount=o.Frame.XPointCount,C.ChartPaint.length>0&&C.Frame&&(C.Frame.RightOffset=u,C.Frame.Draw(),u+=C.RightWidth.Width)}else{var u=o.Interval;o.Frame.RightTextMaxWidth>u&&(u=o.Frame.RightTextMaxWidth);for(var f in o.OverlayIndex){var C=o.OverlayIndex[f];C.Frame.DataWidth=o.Frame.DataWidth,C.Frame.DistanceWidth=o.Frame.DistanceWidth,C.Frame.XPointCount=o.Frame.XPointCount,C.ChartPaint.length>0&&C.Frame&&(C.Frame.RightOffset=u,C.Frame.Draw(),C.Frame.IsShow&&(u+=o.Interval))}}}this.SizeChange=!1},this.DrawOveraly=function(r){for(var n=0;n<this.SubFrame.length;++n){var e=this.SubFrame[n];if(!(e.Height<=0))for(var t=0;t<e.OverlayIndex.length;++t)for(var a=e.OverlayIndex[t],s=0;s<a.ChartPaint.length;++s){var o=a.ChartPaint[s];o.IsShow&&(r?o.IsDrawFirst&&o.Draw():o.IsDrawFirst||o.Draw())}}},this.DrawOveralySelectedStatus=function(r){if(!(!r.MoveOn.Identify&&!r.Selected.Identify))for(var n in this.SubFrame){var e=this.SubFrame[n];for(var t in e.OverlayIndex){var a=e.OverlayIndex[t];for(var s in a.ChartPaint){var o=a.ChartPaint[s];o.IsShow&&o.Identify&&(o.Identify!=r.MoveOn.Identify&&o.Identify!=r.Selected.Identify||o.DrawSelectedStatus&&o.DrawSelectedStatus())}}}},this.PtInOveralyChart=function(r,n){var e=null;for(var t in this.SubFrame){var a=this.SubFrame[t];for(var s in a.OverlayIndex){var o=a.OverlayIndex[s];for(var h in o.ChartPaint){var l=o.ChartPaint[h];if(l.IsShow&&!l.IsHideScriptIndex()&&l.PtInChart&&(e=l.PtInChart(r,n),e))return e}}}return null},this.DrawPictureCoordinate=function(r,n){if(!r||!r.Frame||!c.IsNonEmptyArray(r.Point)||!r.GetXYCoordinate)return!1;var e=r.GetXYCoordinate();r.Frame.DrawPictureYCoordinate(r,e,n);for(var t=0;t<this.SubFrame.length;++t){var a=this.SubFrame[t];if(!(!a||!a.Frame)&&a.Frame.XSplitOperator.ShowText){a.Frame.DrawPictureXCoordinate(r,e,n);break}}return!0},this.DrawLock=function(){for(var r in this.SubFrame){var n=this.SubFrame[r];n.Frame.DrawLock()}},this.DrawLogo=function(){for(var r=0;r<this.SubFrame.length;++r){var n=this.SubFrame[r];if(n.Frame.DrawLogo){n.Frame.DrawLogo();break}}},this.CalculateLock=function(){for(var r in this.SubFrame){var n=this.SubFrame[r];n.Frame.CalculateLock()}},this.DrawInsideHorizontal=function(){for(var r in this.SubFrame){var n=this.SubFrame[r];n.Frame.DrawInsideHorizontal&&n.Frame.DrawInsideHorizontal()}},this.DrawCustomHorizontal=function(){for(var r in this.SubFrame){var n=this.SubFrame[r];n.Frame.DrawCustomHorizontal&&n.Frame.DrawCustomHorizontal();for(var e=0;e<n.OverlayIndex.length;++e){var t=n.OverlayIndex[e];t.Frame&&t.Frame.DrawCustomHorizontal&&t.Frame.DrawCustomHorizontal()}}},this.DrawEx=function(r){for(var n in this.SubFrame){var e=this.SubFrame[n];(e.Frame.ClassName=="MinuteFrame"||e.Frame.ClassName=="MinuteHScreenFrame")&&n==1&&e.Frame.DrawVolTitle(r.Symbol)}},this.DrawCustomVertical=function(r){for(var n=0;n<this.SubFrame.length;++n){var e=this.SubFrame[n];e.Frame.DrawCustomVerticalEvent=r,e.Frame.DrawCustomVertical&&e.Frame.DrawCustomVertical()}},this.DrawToolbar=function(r){var n=null;r&&r.MoveOnPoint&&(n=r.MoveOnPoint);for(var e=0;e<this.SubFrame.length;++e){var t=this.SubFrame[e];if(!(t.Height<=0)){var a=t.Frame;if(a){a.ToolbarButtonStyle==1&&a.DrawToolbarV2&&a.DrawToolbarV2(n,r);for(var s=0;s<t.OverlayIndex.length;++s){var o=t.OverlayIndex[s],h=o.Frame;h.DrawToolbar&&h.DrawToolbar(n,a.IsMinSize,r)}}}}},this.SetSizeChage=function(r){this.SizeChange=r;for(var n in this.SubFrame){var e=this.SubFrame[n];e.Frame.SizeChange=r;for(var t in e.OverlayIndex){var a=e.OverlayIndex[t];a.Frame&&(a.Frame.SizeChange=r)}}this.ChartBorder.UIElement&&(this.Position={X:this.ChartBorder.UIElement.offsetLeft,Y:this.ChartBorder.UIElement.offsetTop,W:this.ChartBorder.UIElement.clientWidth,H:this.ChartBorder.UIElement.clientHeight})},this.SetBeforeDrawXYCallback=function(r){for(var n=0;n<this.SubFrame.length;++n){var e=this.SubFrame[n];e.Frame.BeforeDrawXYCallback=r}},this.Snapshot=function(){this.ScreenImageData=this.Canvas.getImageData(0,0,this.ChartBorder.GetChartWidth(),this.ChartBorder.GetChartHeight())},this.GetXData=function(r){return this.SubFrame[0].Frame.GetXData(r)},this.GetYData=function(r,n){for(var e,t=0;t<this.SubFrame.length;++t){var a=this.SubFrame[t],s=a.Frame.ChartBorder.GetLeft(),o=a.Frame.ChartBorder.GetTopEx(),h=a.Frame.ChartBorder.GetWidth(),l=a.Frame.ChartBorder.GetHeightEx();if(a.Frame.Canvas.beginPath(),a.Frame.Canvas.rect(s,o,h,l),a.Frame.Canvas.isPointInPath(s,r)){e=a.Frame,n&&(n.FrameID=t);break}}if(e!=null){e.RightFrame&&(n.RightYValue=e.RightFrame.GetYData(r));var u=e.GetYData(r);if(e.YSplitOperator.CoordinateType==1){var f=e.YSplitOperator.GetFirstOpenPrice();n.RightYValue=((u-f)/f*100).toFixed(2)+"%"}return u}},this.PtInFrame=function(r,n){for(var e=0;e<this.SubFrame.length;++e){var t=this.SubFrame[e],u=t.Frame.ChartBorder.GetLeft(),a=t.Frame.ChartBorder.GetTop(),s=t.Frame.ChartBorder.GetWidth(),o=t.Frame.ChartBorder.GetHeight();if(t.Frame.Canvas.beginPath(),t.Frame.Canvas.rect(u,a,s,o),t.Frame.Canvas.isPointInPath(r,n))return e}var h=this.ChartBorder.GetBottom(),l=this.ChartBorder.GetChartHeight(),u=this.ChartBorder.GetLeft(),f=this.ChartBorder.GetRight();return r>=u&&r<=f&&n>h&&n<l?-3:-1},this.PtInChartFrame=function(r,n){for(var e=0;e<this.SubFrame.length;++e){var t=this.SubFrame[e],a=t.Frame.ChartBorder.GetLeft(),s=t.Frame.ChartBorder.GetTopEx(),o=t.Frame.ChartBorder.GetWidth(),h=t.Frame.ChartBorder.GetHeightEx();if(t.Frame.Canvas.beginPath(),t.Frame.Canvas.rect(a,s,o,h),t.Frame.Canvas.isPointInPath(r,n))return e}return-1},this.PtInButtons=function(r,n){for(var e=0;e<this.SubFrame.length;++e){var t=this.SubFrame[e];if(!(t.Height<=0)){var a=t.Frame.PtInButtons(r,n);if(a)return a.Frame=t.Frame,a.FrameID=e,a;for(var s=0;s<t.OverlayIndex.length;++s){var o=t.OverlayIndex[s],h=o.Frame;if(!(!h||!h.PtInButtons)){var a=h.PtInButtons(r,n);if(a)return a.IndexID=o.Identify,a.FrameID=e,a.OverlayFrame=h,a.Frame=t.Frame,a}}}}return null},this.PtInFrameBottom=function(r,n){var e=this.ChartBorder.GetLeft(),t=this.ChartBorder.GetBottom(),a=this.ChartBorder.GetWidth(),s=this.ChartBorder.Bottom;return this.Canvas.beginPath(),this.Canvas.rect(e,t,a,s),!!this.Canvas.isPointInPath(r,n)},this.PtInFrameVertical=function(r,n){for(var e=0;e<this.SubFrame.length;++e){var t=this.SubFrame[e];if(!(t.Height<=0)&&t.Frame.PtInVertical&&t.Frame.PtInVertical(r,n))return{Frame:t.Frame}}return null},this.GetXFromIndex=function(r){return this.SubFrame[0].Frame.GetXFromIndex(r)},this.GetYFromData=function(r){return this.SubFrame[0].Frame.GetYFromData(r)},this.ZoomUp=function(r){var n=this.SubFrame[0].Frame.ZoomUp(r);return this.UpdateAllFrame(),n},this.ZoomDown=function(r,n){var e=this.SubFrame[0].Frame.ZoomDown(r,n);return this.UpdateAllFrame(),e},this.SetXShowCount=function(r){var n=this.SubFrame[0].Frame.SetXShowCount(r);return this.UpdateAllFrame(),n},this.XCoordinateZoom=function(r,n){var e=this.SubFrame[0].Frame.XCoordinateZoom(r,n);return this.UpdateAllFrame(),e},this.ResetXYSplit=function(){for(var r in this.SubFrame)this.SubFrame[r].Frame.XYSplit=!0},this.SetLanguage=function(r){for(var n in this.SubFrame){var e=this.SubFrame[n];e&&e.Frame&&(e.Frame.YSplitOperator&&(e.Frame.YSplitOperator.LanguageID=r),e.Frame.XSplitOperator&&(e.Frame.XSplitOperator.LanguageID=r))}},this.GetCurrentPageSize=function(){if(this.SubFrame.length<=0)return null;var r=this.SubFrame[0];return!r||!r.Frame?null:r.Frame.XPointCount},this.OnSize=function(){var r={};return this.SubFrame[0].Frame.OnSize(r),this.UpdateAllFrame(),r},this.SetDataWidth=function(r){var n=this.SubFrame[0].Frame.SetDataWidth(r);return this.UpdateAllFrame(),n},this.UpdateAllFrame=function(){for(var r=this.SubFrame[0].Frame,n=0;n<this.SubFrame.length;++n){var e=this.SubFrame[n];n>0&&(e.Frame.XPointCount=r.XPointCount,e.Frame.ZoomIndex=r.ZoomIndex,e.Frame.DataWidth=r.DataWidth,e.Frame.DistanceWidth=r.DistanceWidth,e.Frame.LastCalculateStatus.Width=r.LastCalculateStatus.Width,e.Frame.LastCalculateStatus.XPointCount=r.LastCalculateStatus.XPointCount);for(var t in e.OverlayIndex){var a=this.SubFrame[n].OverlayIndex[t];a.Frame.XPointCount=r.XPointCount,a.Frame.ZoomIndex=r.ZoomIndex,a.Frame.DataWidth=r.DataWidth,a.Frame.DistanceWidth=r.DistanceWidth,a.Frame.LastCalculateStatus.Width=r.LastCalculateStatus.Width,a.Frame.LastCalculateStatus.XPointCount=r.LastCalculateStatus.XPointCount}}},this.PtInFrameBorder=function(r,n){for(var e=this.DragBorderHeight,t=0;t<this.SubFrame.length-1;++t){var a=this.SubFrame[t];if(!(a.Frame.Heigh<=0)){var s=a.Frame.ChartBorder.GetBottom(),o=a.Frame.ChartBorder.GetLeft(),h=a.Frame.ChartBorder.GetRight();if(a.Frame.Canvas.beginPath(),a.Frame.Canvas.rect(o,s-e/2,h-o,e),a.Frame.Canvas.isPointInPath(r,n))return{Index:t,Bottom:!0}}}return null},this.IsEnableDragY=function(r){if(!this.SubFrame)return!1;var n=this.SubFrame[r];if(!n||!n.Frame||!n.Frame.YSplitOperator)return!1;var e=n.Frame.YSplitOperator;return typeof e.IsEnableDragY!="function"?!1:e.IsEnableDragY()},this.PtInFrameY=function(r,n){var e=0;if(this.GetExtendChartByClassName){var t=this.GetExtendChartByClassName("StockChip");t&&t.Chart&&(e=t.Chart.Width)}for(var a=0;a<this.SubFrame.length;++a){var s=this.SubFrame[a];if(!(s.Frame.Heigh<=0)){var o=s.Frame.ChartBorder.Right;o-=e;var h=s.Frame.ChartBorder.GetBorder(),l=h.Bottom,u=h.TopTitle;h.Left;var f=h.Right,C=30,D=l-u;if(D/3>C)var v=u+C,S=l-C;else var T=D/3,v=u+T,S=l-T;var I=0;if(n<v?I=1:n>S&&(I=2),o>=10){if(c.IsNonEmptyArray(s.OverlayIndex)){var F=s.OverlayIndex[0],E=F.Frame.RightOffset;if(s.Frame.Canvas.beginPath(),s.Frame.Canvas.rect(f,u,E,l-u),s.Frame.Canvas.isPointInPath(r,n))return{Index:a,Right:!0,Left:!1,Position:I,IsOverlay:!1};for(var M=f+E,O=0;O<s.OverlayIndex.length;++O){var F=s.OverlayIndex[O];if(!(!F.RightWidth||!c.IsNumber(F.RightWidth.Width))){var R=F.RightWidth.Width;if(s.Frame.Canvas.beginPath(),s.Frame.Canvas.rect(M,u,R,l-u),s.Frame.Canvas.isPointInPath(r,n))return{Index:a,Right:!0,Left:!1,Position:I,IsOverlay:!0,OverlayIndex:O};M+=R}}}else if(s.Frame.Canvas.beginPath(),s.Frame.Canvas.rect(f,u,o,l-u),s.Frame.Canvas.isPointInPath(r,n))return{Index:a,Right:!0,Left:!1,Position:I,IsOverlay:!1}}var b=s.Frame.ChartBorder.Left;if(b>=10&&(s.Frame.Canvas.beginPath(),s.Frame.Canvas.rect(0,u,b,l-u),s.Frame.Canvas.isPointInPath(r,n)))return{Index:a,Right:!1,Left:!0,Position:I,IsOverlay:!1}}}return null},this.SetDayCount=function(r){this.ChartBorder.MultiDayMinute.Count=r;for(var n=0;n<this.SubFrame.length;++n){var e=this.SubFrame[n];e.Frame&&(e.Frame.DayCount=r,e.Frame.ChartBorder.MultiDayMinute.Count=r)}},this.SetMultiDayMinuteWidth=function(r){if(r){c.IsNumber(r.Left)&&(this.ChartBorder.MultiDayMinute.Left=r.Left),c.IsNumber(r.Right)&&(this.ChartBorder.MultiDayMinute.Right=r.Right);for(var n=0;n<this.SubFrame.length;++n){var e=this.SubFrame[n];e.Frame&&(c.IsNumber(r.Left)&&(e.Frame.ChartBorder.MultiDayMinute.Left=r.Left),c.IsNumber(r.Right)&&(e.Frame.ChartBorder.MultiDayMinute.Right=r.Right))}}}}function fC(){this.newMethod=yh,this.newMethod(),delete this.newMethod,this.IsHScreen=!0,this.CalculateChartBorder=function(){if(!(this.SubFrame.length<=0)){for(var r=this.ChartBorder.GetHScreenBorder(),n=this.ChartBorder.Right,e=r.Right,t=r.Right-r.Left,a=0,s=0,o=0;o<this.SubFrame.length;++o){var h=this.SubFrame[o],l=h.Frame;l&&l.ChartBorder&&l.ChartBorder.IsShowTitleOnly&&h.Height>0?s+=l.ChartBorder.TitleHeight:a+=h.Height}t-=s;for(var o=0;o<this.SubFrame.length;++o){var h=this.SubFrame[o],l=h.Frame;if(h.Frame.ChartBorder.Top=this.ChartBorder.Top,h.Frame.ChartBorder.Bottom=this.ChartBorder.Bottom,h.Frame.ChartBorder.LeftExtendWidth=this.ChartBorder.LeftExtendWidth,h.Frame.ChartBorder.RightExtendWidth=this.ChartBorder.RightExtendWidth,l&&l.ChartBorder&&l.ChartBorder.IsShowTitleOnly&&h.Height>0){var u=l.ChartBorder.TitleHeight;h.Frame.ChartBorder.Right=n,h.Frame.ChartBorder.Left=e-u,n+=u,e-=u}else{var u=t*(h.Height/a);h.Frame.ChartBorder.Right=n,h.Frame.ChartBorder.Left=e-u,n+=u,e-=u}}}},this.GetYData=function(r,n){for(var e,t=0;t<this.SubFrame.length;++t){var a=this.SubFrame[t],s=a.Frame.ChartBorder.GetLeftEx(),o=a.Frame.ChartBorder.GetTop(),h=a.Frame.ChartBorder.GetWidthEx(),l=a.Frame.ChartBorder.GetHeight();if(a.Frame.Canvas.beginPath(),a.Frame.Canvas.rect(s,o,h,l),a.Frame.Canvas.isPointInPath(r,o)){e=a.Frame,n&&(n.FrameID=t);break}}if(e!=null)return e.GetYData(r)}}function WT(){this.newMethod=ms,this.newMethod(),delete this.newMethod,this.ScreenImageData,this.Position,this.ClassName="DepthChartFrame",this.VerticalRange={Max:88,Min:8,Center:null,MaxDiffer:null,Differ:null,Step:.05},this.AskPrice,this.BidPrice,this.MinZoom=.05,this.SetPriceList=function(r,n){this.AskPrice=r,this.BidPrice=n},this.DrawFrame=function(){this.SplitXYCoordinate(),this.DrawHorizontal(),this.DrawVertical()},this.GetXFromIndex=function(r){var n=this.ChartBorder.GetLeft();this.ChartBorder.GetRight();var e=this.ChartBorder.GetWidth(),t=e*(r-this.VerticalRange.Min)/(this.VerticalRange.Max-this.VerticalRange.Min);return n+t},this.GetXData=function(r){var n=this.ChartBorder.GetLeft();this.ChartBorder.GetRight();var e=this.ChartBorder.GetWidth();return(r-n)/e*(this.VerticalRange.Max-this.VerticalRange.Min)+this.VerticalRange.Min},this.GetXFromPrice=function(r){var n=!1,e=this.GetPrice(this.BidPrice,r);if(e==null&&(e=this.GetPrice(this.AskPrice,r),n=!0),e==null&&this.BidPrice&&Array.isArray(this.BidPrice)&&this.BidPrice.length>0){var t=this.BidPrice[0];r<t&&(n=!1,e=t)}if(e==null&&this.AskPrice&&Array.isArray(this.AskPrice)&&this.AskPrice.length>0){var a=this.AskPrice[this.AskPrice.length-1];r>a&&(n=!0,e=a)}if(e==null)return null;var s=this.GetXFromIndex(e);return{X:s,Price:e,IsAsk:n}},this.GetPrice=function(r,n){if(!r||!Array.isArray(r)||r.length<=0||n<r[0]||n>r[r.length-1])return null;var e=null;for(var t in r){var a=r[t];if(n==a)return a;if(n<a)return e;e=a}},this.SplitXYCoordinate=function(){this.XYSplit!=!1&&(this.YSplitOperator!=null&&this.YSplitOperator.Operator(),this.XSplitOperator!=null&&this.XSplitOperator.Operator())},this.Snapshot=function(){this.ScreenImageData=this.Canvas.getImageData(0,0,this.ChartBorder.GetChartWidth(),this.ChartBorder.GetChartHeight())},this.SetSizeChage=function(r){this.SizeChange=r,this.Position={X:this.ChartBorder.UIElement.offsetLeft,Y:this.ChartBorder.UIElement.offsetTop,W:this.ChartBorder.UIElement.clientWidth,H:this.ChartBorder.UIElement.clientHeight}},this.PtInFrame=function(r,n){var e=this.ChartBorder.GetLeft(),t=this.ChartBorder.GetTop(),a=this.ChartBorder.GetWidth(),s=this.ChartBorder.GetHeight();return this.Canvas.beginPath(),this.Canvas.rect(e,t,a,s),this.Canvas.isPointInPath(r,n)?0:-1},this.PtInFrameBorder=function(r,n){return null},this.ZoomUp=function(){var r=this.VerticalRange,n=r.Differ,e=r.MaxDiffer*this.MinZoom;if(n<e)return!1;var t=r.Differ*r.Step;return n-=t,r.Differ=n,r.Min=r.Center-r.Differ,r.Max=r.Center+r.Differ,!0},this.ZoomDown=function(){var r=this.VerticalRange,n=r.Differ;if(n==r.MaxDiffer)return!1;var e=r.Differ*r.Step;return n+=e,n>r.MaxDiffer&&(n=r.MaxDiffer),r.Differ=n,r.Min=r.Center-r.Differ,r.Max=r.Center+r.Differ,!0}}function _T(){this.newMethod=ms,this.newMethod(),delete this.newMethod,this.ScreenImageData,this.Position,this.DrawFrame=function(){if(this.XPointCount>0){var r=this.ChartBorder.GetWidth()/(6*this.XPointCount);this.DistanceWidth=2*r,this.DataWidth=4*r}this.SplitXYCoordinate(),this.DrawHorizontal(),this.DrawVertical()},this.GetXFromIndex=function(r){r<0&&(r=0),r>this.xPointCount-1&&(r=this.xPointCount-1);for(var n=this.ChartBorder.GetLeft()+2+this.DistanceWidth/2+this.DataWidth/2,e=1;e<=r;++e)n+=this.DistanceWidth+this.DataWidth;return n},this.SplitXYCoordinate=function(){this.XYSplit!=!1&&(this.YSplitOperator!=null&&this.YSplitOperator.Operator(),this.XSplitOperator!=null&&this.XSplitOperator.Operator())},this.Snapshot=function(){this.ScreenImageData=this.Canvas.getImageData(0,0,this.ChartBorder.GetChartWidth(),this.ChartBorder.GetChartHeight())},this.SetSizeChage=function(r){this.SizeChange=r,this.Position={X:this.ChartBorder.UIElement.offsetLeft,Y:this.ChartBorder.UIElement.offsetTop,W:this.ChartBorder.UIElement.clientWidth,H:this.ChartBorder.UIElement.clientHeight}},this.PtInFrame=function(r,n){var e=this.ChartBorder.GetLeft(),t=this.ChartBorder.GetTop(),a=this.ChartBorder.GetWidth(),s=this.ChartBorder.GetHeight();return this.Canvas.beginPath(),this.Canvas.rect(e,t,a,s),this.Canvas.isPointInPath(r,n)?0:-1},this.PtInFrameBorder=function(r,n){return null}}function Rt(){this.Date,this.YClose,this.Open,this.Close,this.High,this.Low,this.Vol,this.Amount,this.Time,this.FlowCapital=null,this.Position=null,this.IsVirtual=!1,this.IsNonTrade=!1,this.YFClose=null,this.FClose=null,this.Stop,this.Up,this.Down,this.Unchanged,this.ExtendData,this.BFactor,this.AFactor,this.OrderFlow,this.ColorData,this.HeatMap}Rt.Copy=function(r){var n=new Rt;return n.Date=r.Date,c.IsNumber(r.Time)&&(n.Time=r.Time),n.YClose=r.YClose,n.Open=r.Open,n.Close=r.Close,n.High=r.High,n.Low=r.Low,n.Vol=r.Vol,n.Amount=r.Amount,c.IsNumber(r.FlowCapital)&&(n.FlowCapital=r.FlowCapital),c.IsNumber(r.Position)&&(n.Position=r.Position),c.IsNumber(r.YFClose)&&(n.YFClose=r.YFClose),c.IsNumber(r.FClose)&&(n.FClose=r.FClose),c.IsNumber(r.Stop)&&(n.Stop=r.Stop),c.IsNumber(r.Up)&&(n.Up=r.Up),c.IsNumber(r.Down)&&(n.Down=r.Down),c.IsNumber(r.Unchanged)&&(n.Unchanged=r.Unchanged),c.IsNumber(r.BFactor)&&(n.BFactor=r.BFactor),c.IsNumber(r.AFactor)&&(n.AFactor=r.AFactor),c.IsBool(r.IsVirtual)&&(n.IsVirtual=r.IsVirtual),c.IsBool(r.IsNonTrade)&&(n.IsNonTrade=r.IsNonTrade),r.OrderFlow&&(n.OrderFlow=r.OrderFlow),r.ColorData&&(n.ColorData=r.ColorData),r.ExtendData&&(n.ExtendData=r.ExtendData),r.HeatMap&&(n.HeatMap=r.HeatMap),n};Rt.CopyTo=function(r,n){r.Date=n.Date,c.IsNumber(n.Time)&&(r.Time=n.Time),r.YClose=n.YClose,r.Open=n.Open,r.Close=n.Close,r.High=n.High,r.Low=n.Low,r.Vol=n.Vol,r.Amount=n.Amount,c.IsNumber(n.FlowCapital)&&(r.FlowCapital=n.FlowCapital),c.IsNumber(n.Position)&&(r.Position=n.Position),c.IsNumber(n.YFClose)&&(r.YFClose=n.YFClose),c.IsNumber(n.FClose)&&(r.FClose=n.FClose),c.IsNumber(n.Stop)&&(r.Stop=n.Stop),c.IsNumber(n.Up)&&(r.Up=n.Up),c.IsNumber(n.Down)&&(r.Down=n.Down),c.IsNumber(n.Unchanged)&&(r.Unchanged=n.Unchanged),c.IsNumber(n.BFactor)&&(r.BFactor=n.BFactor),c.IsNumber(n.AFactor)&&(r.AFactor=n.AFactor),c.IsBool(n.IsVirtual)&&(r.IsVirtual=n.IsVirtual),c.IsBool(n.IsNonTrade)&&(r.IsNonTrade=n.IsNonTrade),n.OrderFlow&&(r.OrderFlow=n.OrderFlow),n.ColorData&&(r.ColorData=n.ColorData),n.HeatMap&&(r.HeatMap=n.HeatMap),n.ExtendData&&(r.ExtendData=n.ExtendData)};Rt.CopyRight=function(r,n){var e=new Rt;return e.Date=r.Date,c.IsNumber(r.Time)&&(e.Time=r.Time),e.YClose=r.YClose*n,e.Open=r.Open*n,e.Close=r.Close*n,e.High=r.High*n,e.Low=r.Low*n,e.Vol=r.Vol,e.Amount=r.Amount,e.FlowCapital=r.FlowCapital,e.Position=r.Position,e.YFClose=r.YFClose,e.FClose=r.FClose,r.ColorData&&(e.ColorData=r.ColorData),r.ExtendData&&(e.ExtendData=r.ExtendData),e};function mr(){this.Close,this.Open,this.High,this.Low,this.Vol,this.Amount,this.DateTime,this.Increase,this.Risefall,this.AvPrice,this.Lead=null,this.Time,this.Date,this.Position=null,this.YClearing,this.ExtendData}function Dr(){this.Time,this.Date,this.Price,this.AvPrice,this.Vol=[],this.ColorID}function vr(){this.Time,this.Date,this.Price,this.AvPrice,this.Vol=[],this.ColorID}function yt(){this.Date,this.Time,this.Value}var $t={INVESTOR:1,ANNOUNCEMENT:2,PFORECAST:3,ANNOUNCEMENT_QUARTER_1:4,ANNOUNCEMENT_QUARTER_2:5,ANNOUNCEMENT_QUARTER_3:6,ANNOUNCEMENT_QUARTER_4:7,RESEARCH:8,BLOCKTRADING:9,TRADEDETAIL:10,ANNOUNCEMENT_EX_START:100,ANNOUNCEMENT_EX_END:200};function Nr(){this.ID,this.Date,this.Time,this.Title,this.InfoType,this.ExtendData}function UT(){this.PeriodCallback=new Dt.default,this.GetPeriodCallback=function(r){return this.PeriodCallback.has(r)?this.PeriodCallback.get(r):null},this.AddPeriodCallback=function(r){if(!(!c.IsNumber(r.Period)||!r.Callback)){var n={Period:r.Period,Callback:r.Callback};this.PeriodCallback.set(r.Period,n)}},this.RemovePeriodCallback=function(r){this.PeriodCallback.has(r.ID)&&this.PeriodCallback.delete(r.ID)}}var Ph=new UT;function k(){this.Data=new Array,this.DataOffset=0,this.Period=0,this.Right=0,this.Symbol,this.Data2=new Array,this.GetCloseMA=function(r){for(var n=new Array,e=0,t=this.Data.length;e<t;e++){if(e<r){n[e]=null;continue}for(var a=0,s=0;s<r;s++)a+=this.Data[e-s].Close;n[e]=a/r}return n},this.GetVolMA=function(r){for(var n=new Array,e=0,t=this.Data.length;e<t;e++){if(e<r){n[e]=null;continue}for(var a=0,s=0;s<r;s++)a+=this.Data[e-s].Vol;n[e]=a/r}return n},this.GetAmountMA=function(r){for(var n=new Array,e=0,t=this.Data.length;e<t;e++){if(e<r){n[e]=null;continue}for(var a=0,s=0;s<r;s++)a+=this.Data[e-s].Amount;n[e]=a/r}return n},this.GetClose=function(){var r=new Array;for(var n in this.Data)r[n]=this.Data[n].Close;return r},this.GetYClose=function(){var r=new Array;for(var n in this.Data)r[n]=this.Data[n].YClose;return r},this.GetHigh=function(){var r=new Array;for(var n in this.Data)r[n]=this.Data[n].High;return r},this.GetLow=function(){var r=new Array;for(var n in this.Data)r[n]=this.Data[n].Low;return r},this.GetOpen=function(){var r=new Array;for(var n in this.Data)r[n]=this.Data[n].Open;return r},this.GetVol=function(r){var n=1;c.IsNumber(r)&&(n=r);var e=new Array;for(var t in this.Data)e[t]=this.Data[t].Vol/n;return e},this.GetAmount=function(){var r=new Array;for(var n in this.Data)r[n]=this.Data[n].Amount;return r},this.GetPosition=function(){var r=new Array;for(var n in this.Data)r[n]=this.Data[n].Position;return r},this.GetSettlementPrice=function(){var r=new Array;for(var n in this.Data)r[n]=this.Data[n].FClose;return r},this.GetIsEqual=function(){var r=[];for(var n in this.Data){var e=this.Data[n];r[n]=e.Close==e.Open?1:0}return r},this.GetIsUp=function(){var r=[];for(var n in this.Data){var e=this.Data[n];r[n]=e.Close>e.Open?1:0}return r},this.GetIsDown=function(){var r=[];for(var n in this.Data){var e=this.Data[n];r[n]=e.Close<e.Open?1:0}return r},this.GetLead=function(){var r=new Array;for(var n in this.Data)r[n]=this.Data[n].Lead;return r},this.GetDate=function(){var r=new Array;for(var n in this.Data)r[n]=this.Data[n].Date;return r},this.GetTime=function(){var r=new Array;for(var n in this.Data)r[n]=this.Data[n].Time;return r},this.GetUp=function(){var r=[];for(var n in this.Data)r[n]=this.Data[n].Up;return r},this.GetDown=function(){var r=[];for(var n in this.Data)r[n]=this.Data[n].Down;return r},this.GetYear=function(){var r=new Array;for(var n in this.Data)r[n]=parseInt(this.Data[n].Date/1e4);return r},this.GetMonth=function(){var r=new Array;for(var n in this.Data)r[n]=parseInt(this.Data[n].Date%1e4/100);return r},this.GetAvPrice=function(){var r=new Array;for(var n in this.Data){var e=this.Data[n].AvPrice;c.IsNumber(e)?r[n]=e:r[n]=0}return r},this.GetDateRange=function(){if(!this.Data||this.Data.length<=0)return null;var r=this.Data[0],n=this.Data[this.Data.length-1],e={Start:{Date:r.Date},End:{Date:n.Date}};return c.IsNumber(r.Time)&&(e.Start.Time=r.Time),c.IsNumber(n.Time)&&(e.End.Time=n.Time),e},this.GetDateList=function(){if(!this.Data||this.Data.length<=0)return null;for(var r=[],n=new Ee.default,e=0;e<this.Data.length;++e){var t=this.Data[e];c.IsNumber(t.Date)&&(n.has(t.Date)||(n.add(t.Date),r.push(t.Date)))}return r},this.GetMinutePeriodData=function(r){var n=new Array,e=5;if(r==5)e=5;else if(r==6)e=15;else if(r==7)e=30;else if(r==8)e=60;else if(r==11)e=120;else if(r==12)e=240;else return r>fi&&r<=cr?(e=r-fi,this.GetMinuteCustomPeriodData(e)):this.Data;for(var t=!1,a=null,s=null,o=0;o<this.Data.length;){t=!0;for(var h=0;h<e&&o<this.Data.length;++o){t&&(a=new Rt,n.push(a),t=!1);var l=this.Data[o];if(l==null){++h;continue}if(l.Time==925&&(s==null||s!=924)||l.Time==930&&(s==null||s!=929)||l.Time==1300&&(s==null||s!=1259)||++h,a.Date=l.Date,a.Time=l.Time,s=a.Time,!(l.Open==null||l.Close==null)&&(a.Open==null||a.Close==null?(a.Open=l.Open,a.High=l.High,a.Low=l.Low,a.YClose=l.YClose,a.Close=l.Close,a.Vol=l.Vol,a.Amount=l.Amount,a.FlowCapital=l.FlowCapital,a.Position=l.Position,a.YFClose=l.YFClose,a.FClose=l.FClose):(a.High<l.High&&(a.High=l.High),a.Low>l.Low&&(a.Low=l.Low),a.Close=l.Close,a.Vol+=l.Vol,l.Amount!=null&&(a.Amount+=l.Amount),a.Position=l.Position,a.FlowCapital=l.FlowCapital,a.FClose=l.FClose),o+1<this.Data.length)){var u=this.Data[o+1];if(u&&u.Date!=l.Date){++o;break}}}}return n},this.GetMinuteCustomPeriodData=function(r){for(var n=new Array,e=r,t=!1,a=null,s=0;s<this.Data.length;){t=!0;for(var o=0;o<e&&s<this.Data.length;++s,++o){t&&(a=new Rt,n.push(a),t=!1);var h=this.Data[s];h!=null&&(a.Date=h.Date,a.Time=h.Time,!(h.Open==null||h.Close==null)&&(a.Open==null||a.Close==null?(a.Open=h.Open,a.High=h.High,a.Low=h.Low,a.YClose=h.YClose,a.Close=h.Close,a.Vol=h.Vol,a.Amount=h.Amount,a.FlowCapital=h.FlowCapital,a.Position=h.Position,a.YFClose=h.YFClose,a.FClose=h.FClose):(a.High<h.High&&(a.High=h.High),a.Low>h.Low&&(a.Low=h.Low),a.Close=h.Close,a.Vol+=h.Vol,h.Amount!=null&&(a.Amount+=h.Amount),a.Position=h.Position,a.FlowCapital=h.FlowCapital,a.FClose=h.FClose)))}}return n},this.GetDayPeriodData=function(r){if(r>Ir&&r<=Is)return this.GetDayCustomPeriodData(r-Ir);var n=W.IsBIT(this.Symbol),e=new Array,t=0,a=2,s=null;for(var o in this.Data){var h=!1,l=this.Data[o];switch(r){case 1:if(n)var u=k.GetSunday(l.Date);else var u=k.GetFirday(l.Date);u!=t&&(h=!0,t=u);break;case 21:if(n)var u=k.GetSunday(l.Date);else var u=k.GetFirday(l.Date);u!=t&&(++a,a>=2&&(h=!0,a=0),t=u);break;case 2:parseInt(l.Date/100)!=parseInt(t/100)&&(h=!0,t=l.Date);break;case 3:parseInt(l.Date/1e4)!=parseInt(t/1e4)&&(h=!0,t=l.Date);break;case 22:var f=k.GetHalfYear(l.Date);f!=t&&(h=!0,t=f);break;case 9:var C=k.GetQuarter(l.Date);C=parseInt(l.Date/1e4)*10+C;var D=k.GetQuarter(t);D=parseInt(t/1e4)*10+D,C!=D&&(h=!0,t=l.Date);break}if(h){if(s=new Rt,s.Date=l.Date,e.push(s),l.Open==null||l.Close==null)continue;s.Open=l.Open,s.High=l.High,s.Low=l.Low,s.YClose=l.YClose,s.Close=l.Close,s.Vol=l.Vol,s.Amount=l.Amount,s.FlowCapital=l.FlowCapital,s.Position=l.Position,s.YFClose=l.YFClose,s.FClose=l.FClose}else{if(s==null||l.Open==null||l.Close==null)continue;s.Open==null||s.Close==null?(s.Open=l.Open,s.High=l.High,s.Low=l.Low,s.YClose=l.YClose,s.Close=l.Close,s.Vol=l.Vol,s.Amount=l.Amount,s.FlowCapital=l.FlowCapital,s.Position=l.Position,s.YFClose=l.YFClose,s.FClose=l.FClose):(s.High<l.High&&(s.High=l.High),s.Low>l.Low&&(s.Low=l.Low),s.Close=l.Close,s.Vol+=l.Vol,l.Amount!=null&&(s.Amount+=l.Amount),s.Position=l.Position,s.FlowCapital=l.FlowCapital,s.Date=l.Date,s.FClose=l.FClose)}}return e},this.GetDayCustomPeriodData=function(r){for(var n=[],e=r,t=!1,a=null,s=0;s<this.Data.length;){t=!0;for(var o=0;o<e&&s<this.Data.length;++s,++o){t&&(a=new Rt,n.push(a),t=!1);var h=this.Data[s];h!=null&&(a.Date=h.Date,!(h.Open==null||h.Close==null)&&(a.Open==null||a.Close==null?(a.Open=h.Open,a.High=h.High,a.Low=h.Low,a.YClose=h.YClose,a.Close=h.Close,a.Vol=h.Vol,a.Amount=h.Amount,a.FlowCapital=h.FlowCapital,a.Position=h.Position,a.YFClose=h.YFClose,a.FClose=h.FClose):(a.High<h.High&&(a.High=h.High),a.Low>h.Low&&(a.Low=h.Low),a.Close=h.Close,a.Vol+=h.Vol,h.Amount!=null&&(a.Amount+=h.Amount),a.Position=h.Position,a.FlowCapital=h.FlowCapital,a.FClose=h.FClose)))}}return n},this.GetPeriodData=function(r){var n=Ph.GetPeriodCallback(r);if(n)return n.Callback(r,this.Data,this);if(W.IsBIT(this.Symbol)&&(r==5||r==6||r==7||r==8||r>fi&&r<=cr)){var e=5;return r==5?e=5:r==6?e=15:r==7?e=30:r==8?e=60:r==11?e=120:r==12?e=240:r>fi&&r<=cr&&(e=r-fi),this.GetMinuteCustomPeriodData(e)}if(k.IsDayPeriod(r,!1))return this.GetDayPeriodData(r);if(k.IsMinutePeriod(r,!1))return this.GetMinutePeriodData(r)},this.GetRightData=function(r,n){var e=[];if(this.Data.length<=0)return e;if(n&&n.AlgorithmType==1){for(var t=0;t<this.Data.length;++t){var a=this.Data[t],s=r==1?a.BFactor:a.AFactor;e[t]=Rt.CopyRight(a,s)}return e}if(r==1){var o=this.Data.length-1,s=1,h=this.Data[o].YClose;for(e[o]=Rt.Copy(this.Data[o]),--o;o>=0&&h==this.Data[o].Close;--o)e[o]=Rt.Copy(this.Data[o]),h=this.Data[o].YClose;for(;o>=0;--o){var l=this.Data[o].Close;h!=l&&l!=0&&(s*=h/l),e[o]=Rt.CopyRight(this.Data[o],s),h=this.Data[o].YClose}}else if(r==2){var o=0,s=1,u=this.Data[o].Close;for(e[o]=Rt.Copy(this.Data[o]),++o;o<this.Data.length&&u==this.Data[o].YClose;++o)e[o]=Rt.Copy(this.Data[o]),u=this.Data[o].Close;for(;o<this.Data.length;++o)u!=this.Data[o].YClose&&(s*=u/this.Data[o].YClose),e[o]=Rt.CopyRight(this.Data[o],s),u=this.Data[o].Close}return e},this.GetRightDate=this.GetRightData,this.GetOverlayData=function(r,n){for(var e=[],t=0,a=0;t<this.Data.length;){var s=this.Data[t].Date;if(a>=r.length){e[t]=new Rt,e[t].Date=s,++t;continue}var o=r[a].Date;o==s?(e[t]=new Rt,e[t].Date=r[a].Date,e[t].YClose=r[a].YClose,e[t].Open=r[a].Open,e[t].High=r[a].High,e[t].Low=r[a].Low,e[t].Close=r[a].Close,e[t].Vol=r[a].Vol,e[t].Amount=r[a].Amount,e[t].Stop=r[a].Stop,e[t].Up=r[a].Up,e[t].Down=r[a].Down,e[t].Unchanged=r[a].Unchanged,++a,++t):o<s?++a:(e[t]=new Rt,e[t].Date=s,++t)}return e},this.GetOverlayMinuteData=function(r,n){for(var e=[],t=0,a=0;t<this.Data.length;){var s=this.Data[t].Date,o=this.Data[t].Time;if(a>=r.length){e[t]=new Rt,e[t].Date=s,e[t].Time=o,++t;continue}var h=r[a].Date,l=r[a].Time;h==s&&l==o?(e[t]=new Rt,e[t].Date=r[a].Date,e[t].Time=r[a].Time,e[t].YClose=r[a].YClose,e[t].Open=r[a].Open,e[t].High=r[a].High,e[t].Low=r[a].Low,e[t].Close=r[a].Close,e[t].Vol=r[a].Vol,e[t].Amount=r[a].Amount,e[t].Stop=r[a].Stop,e[t].Up=r[a].Up,e[t].Down=r[a].Down,e[t].Unchanged=r[a].Unchanged,++a,++t):h<s||h==s&&l<o?++a:(e[t]=new Rt,e[t].Date=s,e[t].Time=o,++t)}return e},this.GetFittingData=function(r){for(var n=new Array,e=0,t=0;e<this.Data.length;){var a=this.Data[e].Date;if(t>=r.length){n[e]=null,++e;continue}var s=r[t].Date;if(s==a){var o=new yt;o.Date=r[t].Date,o.Value=r[t].Value,n[e]=o,++t,++e}else s<a?++t:(n[e]=new yt,n[e].Date=a,++e)}return n},this.GetFittingData2=function(r,n){for(var e=new Array,t=0,a=0;t<this.Data.length;){var s=this.Data[t].Date;if(a>=r.length){e[t]=new yt,e[t].Date=s,e[t].Value=n,++t;continue}var o=r[a].Date;if(o==s){var h=new yt;h.Date=r[a].Date,h.Value=r[a].Value,e[t]=h,++a,++t}else o<s?++a:(e[t]=new yt,e[t].Date=s,e[t].Value=n,++t)}return e},this.GetDateIndex=function(r){for(var n=0,e=0;n<this.Data.length;){var t=this.Data[n].Date;if(e>=r.length)break;var a=r[e];a.Date==t?(a.Index=n,++e):a.Date<t?++e:++n}},this.GetDateTimeIndex=function(r){for(var n=0,e=0;n<this.Data.length;){var t=this.Data[n].Date,a=this.Data[n].Time;if(e>=r.length)break;var s=r[e];s.Date==t&&s.Time==a?(s.Index=n,++e):s.Date<t||s.Date==t&&s.Time<a?++e:++n}},this.GetMinuteFittingData=function(r){for(var n=[],e=0,t=0;e<this.Data.length;){var a=this.Data[e].Date,s=this.Data[e].Time;if(t>=r.length){n[e]=null,++e;continue}var o=r[t].Date,h=r[t].Time,l=r[t];if(o==a&&h==s){var u=new yt;u.Date=l.Date,u.Time=l.Time,u.Value=l.Value,n[e]=u,++t,++e}else if(o<a||o==a&&h<s)++t;else{var u=new yt;u.Date=a,u.Time=s,n[e]=u,++e}}return n},this.GetMinuteFittingDataV2=function(r){for(var n=[],e=null,t=0,a=0;t<this.Data.length;){var s=this.Data[t].Date,o=this.Data[t].Time;if(a>=r.length){n[t]=null,++t;continue}var h=r[a].Date,l=r[a].Time,u=r[a];if(h==s&&l==o){var f=new yt;f.Date=u.Date,f.Time=u.Time,f.Value=u.Value,n[t]=f,e=u,++a,++t}else if(h<s||h==s&&l<o){var C=n.length-1;if(C>=0){var f=n[C];f&&(h<f.Date||h==f.Date&&l<f.Time)&&(f.Value=u.Value)}e=u,++a}else{var f=new yt;f.Date=s,f.Time=o,e&&(f.Value=e.Value),n[t]=f,++t}}return n},this.GetFittingFinanceData=function(r){for(var n=[],e=0,t=0;e<this.Data.length;){var a=this.Data[e].Date;if(t<r.length){var s=r[t].Date;if(a<s){++e;continue}}if(t+1<r.length&&r[t].Date<a&&r[t+1].Date<=a){++t;continue}var o=new yt;o.Date=a,t<r.length?(o.Value=r[t].Value,o.FinanceDate=r[t].Date):(o.Value=null,o.FinanceDate=null),n[e]=o,++e}return n},this.GetMinuteFittingFinanceData=function(r){var n=[];if(!Array.isArray(r)||r.length<=0)return n;var e=0,t=r[0];for(e=0;e<this.Data.length;++e){var a=this.Data[e].Date,s=this.Data[e].Time;if(a>t.Date||a==t.Date&&s>=t.Time)break}for(var o=0;e<this.Data.length;){var a=this.Data[e].Date,s=this.Data[e].Time;if(o+1<r.length&&(r[o].Date<a&&r[o+1].Date<=a||r[o].Date==a&&r[o].Time<s&&r[o+1].Time<=s)){++o;continue}var h=new yt;h.Date=a,h.Time=s,o<r.length?(h.Value=r[o].Value,h.FinanceDate=r[o].Date,h.FinanceTime=r[o].Time):(h.Value=null,h.FinanceDate=null,h.FinanceTime=null),n[e]=h,++e}return n},this.GetFittingTradeData=function(r,n,e){for(var t=[],a=!1,s=0,o=0;s<this.Data.length;){var h=this.Data[s].Date;if(o<r.length&&r[o].Date>h){var l=new yt;l.Date=h,l.Value=n,t[s]=l,++s;continue}if(o+1<r.length&&r[o].Date<h&&r[o+1].Date<=h){++o,a=!1;continue}var l=new yt;if(l.Date=h,l.Value=n,l.FinanceDate=null,o<r.length){var u=r[o];this.Period==0&&e===!0?u.Date==l.Date&&(l.Value=u.Value,l.FinanceDate=u.Date,a=!0):a==!1&&(l.Value=u.Value,l.FinanceDate=u.Date,a=!0)}t[s]=l,++s}return t},this.GetMinuteFittingTradeData=function(r,n,e){for(var t=[],a=!1,s=0,o=0;s<this.Data.length;){var h=this.Data[s].Date,l=this.Data[s].Time;if(o<r.length&&(r[o].Date>h||r[o].Date==h&&r[o].Time>l)){var u=new yt;u.Date=h,u.Time=l,u.Value=n,t[s]=u,++s;continue}if(o+1<r.length&&(r[o].Date<h&&r[o+1].Date<=h||r[o].Date==h&&r[o].Time<l&&r[o+1].Time<=l)){++o,a=!1;continue}var u=new yt;if(u.Date=h,u.FinanceDate=null,u.Time=l,u.Value=n,o<r.length){var f=r[o];this.Period==4&&e===!0?f.Date==u.Date&&f.Time==u.Time&&(u.Value=f.Value,u.FinanceDate=f.Date,u.FinanceTime=f.Time,a=!0):a==!1&&(u.Value=f.Value,u.FinanceDate=f.Date,u.FinanceTime=f.Time,a=!0)}t[s]=u,++s}return t},this.GetFittingMarketValueData=function(r){for(var n=[],e=0,t=0;e<this.Data.length;){var a=this.Data[e].Date,s=this.Data[e].Close;if(t+1<r.length&&r[t].Date<a&&r[t+1].Date<=a){++t;continue}var o=new yt;o.Date=a,o.Value=r[t].Value*s,o.FinanceDate=r[t].Date,n[e]=o,++e}return n},this.GetFittingMonthData=function(r){for(var n=new Array,e=null,t=0,a=0;t<this.Data.length;){var s=this.Data[t].Date;if(a>=r.length){n[t]=null,++t;continue}var o=r[a].Date;if(o==s){var h=new yt;h.Date=r[a].Date,h.Value=r[a].Value,h.Text=r[a].Text,n[t]=h,++a,++t}else if(e!=null&&e<o&&s>o){var h=new yt;h.Date=s,h.OverlayDate=r[a].Date,h.Value=r[a].Value,h.Text=r[a].Text,n[t]=h,++a,++t}else o<s?++a:(n[t]=new yt,n[t].Date=s,++t);e=s}return n},this.GetValue=function(){var r=[];for(var n in this.Data)if(this.Data[n]&&this.Data[n].Value!=null){var e=this.Data[n].Value;isNaN(e)?e instanceof Array?r[n]=e:r[n]=null:r[n]=e}else r[n]=null;return r},this.GetObject=function(){var r=[];for(var n in this.Data)if(this.Data[n]&&this.Data[n].Value){var e=this.Data[n].Value;r[n]=e}else r[n]=null;return r},this.GetPeriodSingleData=function(r){var n=new Array,e=0,t=2,a=null;for(var s in this.Data){var o=!1,h=this.Data[s];if(!(h==null||h.Date==null)){switch(r){case 1:var l=k.GetFirday(h.Date);l!=e&&(o=!0,e=l);break;case 21:var l=k.GetFirday(h.Date);l!=e&&(++t,t>=2&&(o=!0,t=0),e=l);break;case 2:parseInt(h.Date/100)!=parseInt(e/100)&&(o=!0,e=h.Date);break;case 3:parseInt(h.Date/1e4)!=parseInt(e/1e4)&&(o=!0,e=h.Date);break;case 9:var u=k.GetQuarter(h.Date);u=parseInt(h.Date/1e4)*10+u;var f=k.GetQuarter(e);f=parseInt(e/1e4)*10+f,u!=f&&(o=!0,e=h.Date);break}if(o)a=new yt,a.Date=h.Date,a.Value=h.Value,n.push(a);else{if(a==null||h.Value==null||isNaN(h.Value))continue;(a.Value==null||isNaN(a.Value))&&(a.Value=h.Value)}}}return n},this.GetMinuteAvPrice=function(){var r=new Array;for(var n in this.Data)r[n]=this.Data[n].AvPrice;return r},this.MergeMinuteData=function(r){if(!this.Data||this.Data.length<=0)return this.Data=r,!0;for(var n=this.Data[0],e=0,t=null,f=0;f<r.length;++f){var a=r[f];if(a.Date>n.Date){e=f,t=a;break}if(a.Date==n.Date&&a.Time>=n.Time){e=f,t=a;break}}if(t==null)return!1;for(var s=null,o=!1,f=this.Data.length-1;f>=0;--f){var h=this.Data[f].Date,l=this.Data[f].Time;if(t.Date>h||t.Date==h&&t.Time>=l){s=f,t.Date==h&&t.Time==l&&(o=!0);break}}if(s==null)return!1;var u=s,f=e;if(o==!0){var a=r[f];if(u-1>0){var C=this.Data[u-1];a.YClose||(a.YClose=C.Close),!c.IsNumber(a.FlowCapital)&&c.IsNumber(C.FlowCapital)&&(a.FlowCapital=C.FlowCapital)}var D=Rt.Copy(a);this.Data[u]=D,++u,++f}else++u;for(;f<r.length;){var a=r[f];if(u>=this.Data.length-1){if(u-1>0){var C=this.Data[u-1];a.YClose||(a.YClose=C.Close),!c.IsNumber(a.FlowCapital)&&c.IsNumber(C.FlowCapital)&&(a.FlowCapital=C.FlowCapital)}var D=Rt.Copy(a);this.Data[u]=D,++u,++f}else{var v=this.Data[u];v.Date==a.Date&&v.Time==a.Time?(Rt.CopyTo(v,a),++u,++f):++u}}return!0},this.ConverPeriod=function(r,n,e){for(var t=[],a=null,s=k.IsMinutePeriod(n,!0),o=k.IsMinutePeriod(e,!0),h=s&&o,l=s&&!o,u=!s&&!o,f=0,C=0;f<this.Data.length;++f){for(var D=this.Data[f];C<r.length;++C){var v=r[C];if(h){if(v.Date>D.Date||v.Date==D.Date&&v.Time>=D.Time){a=v;break}}else if((l||u)&&v.Date>=D.Date){a=v;break}}var S=null;a?(S=Rt.Copy(a),S.PDate=a.Date,S.PTime=a.Time):S=new Rt,S.Date=D.Date,(h||l)&&(S.Time=D.Time),t.push(S)}return X.Chart.Log("[ChartData::ConverPeriod] result",t),t},this.GetRef=function(r){for(var n=[],e=0;e<this.Data.length;++e){n[e]=null;var t=this.Data[e];if(e-r<0){var s=new Rt;s.Date=t.Date,s.Time=t.Time,n[e]=s;continue}var a=this.Data[e-r],s=Rt.Copy(a);s.Date=t.Date,s.Time=t.Time,n[e]=s}return n},this.FitKLineIndex=function(r,n,e,t){for(var a=this.Data.length,s=r.length,o=[k.IsMinutePeriod(e,!0),k.IsMinutePeriod(t,!0)],h=[k.IsDayPeriod(e,!0),k.IsDayPeriod(t,!0)],l=k.GetKLineDataTime(this.Data[0]),u=[],f=s,C=0;C<s;++C){var D=k.GetKLineDataTime(r[C]);if(h[0]&&h[1]||o[0]&&h[1]){if(D.Date>=l.Date){f=C;break}}else if(o[0]&&o[1]){if(D.Date>l.Date){f=C;break}if(D.Date==l.Date&&D.Time>=l.Time){f=C;break}}}for(var C=0,v=f;C<a;){var D=k.GetKLineDataTime(this.Data[C]);if(v>=s){var S={Date:D.Date,Time:D.Time,Index:-1};u[C]=S,++C;continue}var T=k.GetKLineDataTime(r[v]);if(h[0]&&h[1]||o[0]&&h[1])if(T.Date==D.Date){var S={Date:D.Date,Time:D.Time,Index:v,Data2:T.Date,Time2:T.Time};u[C]=S,++C}else if(v+1<s){var I=k.GetKLineDataTime(r[v+1]);if(T.Date<=D.Date&&I.Date>D.Date){var S={Date:D.Date,Time:D.Time,Index:v+1,Data2:I.Date,Time2:I.Time};u[C]=S,++C}else if(I.Date<=D.Date)++v;else{var S={Date:D.Date,Time:D.Time,Index:-1};u[C]=S,++C}}else++v;else if(o[0]&&o[1])if(T.Date==D.Date&&T.Time==D.Time){var S={Date:D.Date,Time:D.Time,Index:v,Data2:T.Date,Time2:T.Time};u[C]=S,++C}else if(v+1<s){var I=k.GetKLineDataTime(r[v+1]);if(T.Date<D.Date&&I.Date>D.Date||T.Date==D.Date&&T.Time<D.Time&&I.Date==D.Date&&I.Time>D.Time||T.Date==D.Date&&T.Time<D.Time&&I.Date>D.Date||T.Date<D.Date&&I.Date==D.Date&&I.Time>D.Time){var S={Date:D.Date,Time:D.Time,Index:v+1,Data2:I.Date,Time2:I.Time};u[C]=S,++C}else if(I.Date<D.Date||I.Date==D.Date&&I.Time<=D.Time)++v;else{var S={Date:D.Date,Time:D.Time,Index:-1};u[C]=S,++C}}else++v}var F=[];for(var C in n){var D=n[C];if(Array.isArray(D.Data)){var E=[];F[C]={Data:E,Name:D.Name};for(var v=0;v<u.length;++v){var M=u[v];E[v]=null,M&&M.Index>=0&&M.Index<D.Data.length&&(E[v]=D.Data[M.Index])}}else F[C]={Data:D.Data,Name:D.Name}}return F},this.FindDataIndexByDateTime=function(r){var n=0;for(var e in r)r[e].Index=-1;for(var e in this.Data){var t=this.Data[e];for(var a in r){var s=r[a];if(!(s.Index>=0)){if(c.IsNumber(s.Time)){if(s.Date==t.Date&&s.Time==t.Time){s.Index=parseInt(e),++n;break}}else if(s.Date==t.Date){s.Index=parseInt(e),++n;break}if(n>=r.length)break}}}},this.CloneData=function(r){var n=[];if(r=="HistoryData")for(var e in this.Data){var t=this.Data[e],a=Rt.Copy(t);n.push(a)}return n},this.GetAPIDataIndex=function(r,n){var e=[];if(r&&n){for(var t=this.Data.length,a=r.length,s=k.GetKLineDataTime(this.Data[0]),o=a,o=a,h=0;h<a;++h){var l=r[h],u=n[h];if(l>s.Date||l==s.Date&&u>=s.Time){o=h;break}}for(var h=0,f=o;h<t;){var C=this.Data[h];if(f>=a){var D={KDate:C.Date,KTime:C.Time,KIndex:h,Index:-1};e[h]=D,++h;continue}var l=r[f],u=n[f];if(l==C.Date&&u==C.Time){var D={KDate:C.Date,KTime:C.Time,KIndex:h,Index:f,Data:l,Time:u};e[h]=D,++h}else if(f+1<a){var v=r[f+1],S=n[f+1];if(l<C.Date&&v>C.Date||l==C.Date&&u<C.Time&&v==C.Date&&S>C.Time||l==C.Date&&u<C.Time&&v>C.Date||l<C.Date&&v==C.Date&&S>C.Time){var D={KDate:C.Date,KTime:C.Time,KIndex:h,Index:f,Data:l,Time:u};e[h]=D,++h}else if(v<C.Date||v==C.Date&&S<=C.Time)++f;else{var D={KDate:C.Date,KTime:C.Time,KIndex:h,Index:-1};e[h]=D,++h}}else++f}}else if(r){for(var t=this.Data.length,a=r.length,s=k.GetKLineDataTime(this.Data[0]),o=a,h=0;h<a;++h){var C=r[h];if(C>=s.Date){o=h;break}}for(var h=0,f=o;h<t;){var C=this.Data[h];if(f>=a){var D={KDate:C.Date,KIndex:h,Index:-1};e[h]=D,++h;continue}var T=r[f];if(T==C.Date){var D={KDate:C.Date,KIndex:h,Index:f,Data:T};e[h]=D,++h}else if(f+1<a){var I=r[f+1];if(T<=C.Date&&I>C.Date){var D={KDate:C.Date,KIndex:h,Index:f,Data:T};e[h]=D,++h}else if(I<=C.Date)++f;else{var D={KDate:C.Date,KIndex:h,Index:-1};e[h]=D,++h}}else++f}}return e},this.FixKData=function(r,n){return k.IsDayPeriod(n,!0)?this.FixKData_Day(r):k.IsMinutePeriod(n,!0)?this.FixKData_Minute(r):null},this.FixKData_Day=function(r){for(var n=[],e=r.length,t=0,a=0;t<this.Data.length;){var s=this.Data[t];if(a<e){var u=r[a];if(u.Date>s.Date){++t;continue}}if(a+1<e){var u=r[a],o=r[a+1];if(u.Date<s.Date&&o.Date<=s.Date){++a;continue}}var h=new Rt;h.Date=s.Date;var l=a<e?a:e-1,u=r[l];h.Close=u.Close,h.High=u.High,h.Low=u.Low,h.Open=u.Open,h.YClose=u.YClose,h.Amount=u.Amount,h.Vol=u.Vol,h.ExDate=u.Date,n[t]=h,++t}return n},this.FixKData_Minute=function(r){for(var n=[],e=r.length,t=0,a=0;t<this.Data.length;){var s=this.Data[t],o=k.DateTimeToNumber(s);if(a<e){var D=r[a],h=k.DateTimeToNumber(D);if(h>o){++t;continue}}if(a+1<e){var D=r[a],l=r[a+1],h=k.DateTimeToNumber(D),u=k.DateTimeToNumber(l);if(h<o&&u<=o){++a;continue}}var f=new Rt;f.Date=s.Date,f.Time=s.Time;var C=a<e?a:e-1,D=r[C];f.Close=D.Close,f.High=D.High,f.Low=D.Low,f.Open=D.Open,f.YClose=D.YClose,f.Amount=D.Amount,f.Vol=D.Vol,f.ExDate=D.Date,f.ExTime=D.Time,n[t]=f,++t}return n},this.GetDataRange=function(r,n){if(!c.IsNonEmptyArray(this.Data))return null;for(var e={},t=0;t<this.Data.length;++t){var a=this.Data[t];if(a.Date==r.Date&&(c.IsNumber(r.Time)?a.Time==r.Time&&(e.Start={Index:t,Date:a.Date,Time:a.Time}):e.Start={Index:t,Date:a.Date}),(a.Date=n.Date)&&(c.IsNumber(n.Time)?a.Time==n.Time&&(e.End={Index:t,Date:a.Date,Time:a.Time}):e.End={Index:t,Date:a.Date}),e.Start&&e.End)return e}return null},this.ExportArrayData=function(r,n){if(!c.IsNonEmptyArray(this.Data))return null;var e=0,t=this.Data.length-1;n&&n.Start&&n.End&&c.IsNumber(n.Start.Index)&&c.IsNumber(n.End.Index)&&(e=n.Start.Index,t=n.End.Index);for(var a=[],s=e;s<=t&&s<this.Data.length;++s)a[s]=this.Data[s];return a},this.ExportBoolData=function(r,n){if(!c.IsNonEmptyArray(this.Data))return null;var e=0,t=this.Data.length-1;n&&n.Start&&n.End&&c.IsNumber(n.Start.Index)&&c.IsNumber(n.End.Index)&&(e=n.Start.Index,t=n.End.Index);for(var a=[],s=e;s<=t&&s<this.Data.length;++s){var o=this.Data[s];a[s]=!1,c.IsPlusNumber(o)&&(a[s]=!0)}return a},this.ExportKLineData=function(r){if(!c.IsNonEmptyArray(this.Data))return null;var n=0,e=this.Data.length-1;r&&r.Start&&r.End&&c.IsNumber(r.Start.Index)&&c.IsNumber(r.End.Index)&&(n=r.Start.Index,e=r.End.Index);for(var t=[],a=[],s=[],o=[],h=[],l=[],u=[],f=[],C=n;C<=e&&C<this.Data.length;++C){var D=this.Data[C];t[C]=D.Date,a[C]=D.Open,s[C]=D.High,o[C]=D.Low,u[C]=D.Close,h[C]=D.Vol,l[C]=D.Amount,f[C]=D.Time}if(r&&r.IsOverlay){var v=[{Name:"Open",Data:a},{Name:"High",Data:s},{Name:"Low",Data:o},{Name:"Close",Data:u},{Name:"Vol",Data:h},{Name:"Amount",Data:l}];return v}var v=[{Name:"Date",Data:t}];return(k.IsMinutePeriod(this.Period,!0)||k.IsSecondPeriod(this.Period))&&v.push({Name:"Time",Data:f}),v.push({Name:"Open",Data:a},{Name:"High",Data:s},{Name:"Low",Data:o},{Name:"Close",Data:u},{Name:"Vol",Data:h},{Name:"Amount",Data:l}),v},this.ExportMinuteData=function(r){if(!c.IsNonEmptyArray(this.Data))return null;var n=[],e=[],t=[],a=[],s=[],o=[],h=[],l=[],u=[],f=[],C=0,D=this.Data.length-1;r&&r.Start&&r.End&&c.IsNumber(r.Start.Index)&&c.IsNumber(r.End.Index)&&(C=r.Start.Index,D=r.End.Index);for(var v=C;v<=D&&v<this.Data.length;++v){var S=this.Data[v];n[v]=S.Date,e[v]=S.Open,t[v]=S.High,a[v]=S.Low,h[v]=S.Close,s[v]=S.Vol,o[v]=S.Amount,l[v]=S.Time,f[v]=S.AvPrice,u[v]=S.Position}var T=[{Name:"Open",Data:e},{Name:"High",Data:t},{Name:"Low",Data:a},{Name:"Close",Data:h},{Name:"Vol",Data:s},{Name:"Amount",Data:o},{Name:"AvPrice",Data:f},{Name:"Position",Data:u}];return r&&r.IsOverlay||T.splice(0,0,{Name:"Date",Data:n},{Name:"Time",Data:l}),T}}k.DateTimeToNumber=function(r){return r.Date*1e4+r.Time};k.GetKLineDataTime=function(r){var n={Date:r.Date,Time:0};return c.IsNumber(r.Time)&&(n.Time=r.Time),n};k.GetFirday=function(r){var n=new Date(parseInt(r/1e4),r/100%100-1,r%100),e=n.getDay();if(e==5)return r;var t=n.getTime();if(e<5){var a=864e5*(5-e);t+=a}else{var a=864e5*(e-5);t-=a}n.setTime(t);var s=n.getFullYear()*1e4+(n.getMonth()+1)*100+n.getDate();return n.getDay(),s};k.GetSunday=function(r){var n=new Date(parseInt(r/1e4),r/100%100-1,r%100),e=n.getDay();if(e==0)return r;var t=n.getTime();if(e>0){var a=864e5*(7-e);t+=a}n.setTime(t);var s=n.getFullYear()*1e4+(n.getMonth()+1)*100+n.getDate();return n.getDay(),s};k.GetQuarter=function(r){var n=parseInt(r%1e4/100);return n==1||n==2||n==3?1:n==4||n==5||n==6?2:n==7||n==8||n==9?3:n==10||n==11||n==12?4:0};k.GetHalfYear=function(r){var n=parseInt(r/1e4),e=r%1e4;return e<=630?n*1e4+630:n*1e4+1231};var Ir=4e4,Is=49999;k.IsDayPeriod=function(r,n){return r==1||r==2||r==3||r==9||r==21||r==22||r>Ir&&r<=Is||r==0&&n==!0};var fi=2e4,cr=29999;k.IsMinutePeriod=function(r,n){return r==5||r==6||r==7||r==8||r==11||r==12||r>fi&&r<=cr||r==4&&n==!0};var $n=3e4,wh=32e3;k.IsSecondPeriod=function(r){return r>$n&&r<=wh};k.IsTickPeriod=function(r){return r==10};k.GetPeriodName=function(r){var n=new Dt.default([[0,"日线"],[1,"周线"],[2,"月线"],[3,"年线"],[9,"季线"],[21,"双周"],[22,"半年"],[4,"1分"],[5,"5分"],[6,"15分"],[7,"30分"],[8,"60分"],[11,"2小时"],[12,"4小时"],[10,"分笔"]]);return n.has(r)?n.get(r):""};function zr(){this.ChartPaint,this.Data,this.Type=0}function Sa(r,n,e,t){this.X=r,this.Y=n,this.Width=e,this.Height=t}function KT(){this.DataMap=new Dt.default([["ChartKLine",{Create:function(n){return new gr}}],["ChartMinuteVolumBar",{Create:function(n){return new Bh}}],["ChartMinutePriceLine",{Create:function(n){return new Hh}}]]),this.Create=function(r,n){if(!this.DataMap.has(r))return X.Warn("[ChartPaintFactory::Create] can't find class="+r+"."),null;var e=this.DataMap.get(r);return e.Create(n)},this.Add=function(r,n){this.DataMap.set(r,{Create:n.Create})}}var qn=new KT;function bt(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="IChartPainting",this.Data=new k,this.Script,this.NotSupportMessage=null,this.MessageFont=m.Index.NotSupport.Font,this.MessageColor=m.Index.NotSupport.TextColor,this.IsDrawFirst=!1,this.IsShow=!0,this.GetEventCallback,this.SelectedLineWidth=m.SelectedChart.LineWidth,this.SelectedLineColor=m.SelectedChart.LineColor,this.SelectedRadius=m.SelectedChart.Radius,this.SelectedPointMinSpace=m.SelectedChart.MinSpace,this.SelectedBGColor=m.SelectedChart.BGColor,this.DrawSelectedStatus,this.PtInChart,this.Draw=function(){},this.GetBorder=function(){return this.ChartFrame.IsHScreen?this.ChartBorder.GetHScreenBorder():this.ChartBorder.GetBorder()},this.ClipClient=function(r){if(r==!0)var n=this.ChartBorder.GetLeftEx(),e=this.ChartBorder.GetRightEx(),t=this.ChartBorder.GetTop(),a=this.ChartBorder.GetBottom();else var n=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRight(),t=this.ChartBorder.GetTopEx(),a=this.ChartBorder.GetBottomEx();this.Canvas.beginPath(),this.Canvas.rect(n,t,e-n,a-t),this.Canvas.clip()},this.GetYFromData=function(r,n){return this.ChartFrame.GetYFromData(r,n)},this.IsMinuteFrame=function(){var r=this.ChartFrame.ClassName=="MinuteFrame"||this.ChartFrame.ClassName=="MinuteHScreenFrame"||this.ChartFrame.ClassName=="OverlayMinuteFrame"||this.ChartFrame.ClassName=="OverlayMinuteHScreenFrame";return r},this.DrawNotSupportmessage=function(){this.Canvas.font=this.MessageFont,this.Canvas.fillStyle=this.MessageColor;var r=this.ChartBorder.GetLeft(),n=this.ChartBorder.GetWidth(),e=this.ChartBorder.GetTopEx(),t=this.ChartBorder.GetHeightEx(),a=r+n/2,s=e+t/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.NotSupportMessage,a,s)},this.GetTooltipData=function(r,n,e){return!1},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n=this.Data.DataOffset;this.ChartFrame.GlobalOption&&this.ChartFrame.GlobalOption.IsValueFullRange&&(n=0,r=this.Data.Data.length);var e={};if(e.Min=null,e.Max=null,!this.Data||!this.Data.Data)return e;for(var t=n,a=0;t<this.Data.Data.length&&a<r;++t,++a){var s=this.Data.Data[t];s==null||isNaN(s)||(e.Max==null&&(e.Max=s),e.Min==null&&(e.Min=s),e.Max<s&&(e.Max=s),e.Min>s&&(e.Min=s))}return e},this.GetDynamicFont=function(r,n,e,t,a,s){var o=V();if(e*=o,t*=o,e==t){var l=e.toFixed(0)+"px "+s;return l}var h=r+n;a&&(a.Type==0?a.Value>0&&(h=r*a.Value):a.Type==1?a.Value>0&&(h=(r+n)*a.Value):a.Type==2&&c.IsNumber(a.Value)&&(h=r+n+2*a.Value*o)),h<t?h=t:h>e&&(h=e);var l=h.toFixed(0)+"px "+s;return l},this.GetLockRect=function(){return this.ChartFrame.GetLockRect()},this.SetFillStyle=function(r,n,e,t,a){if(Array.isArray(r)){var s=this.Canvas.createLinearGradient(n,e,t,a),o=1/r.length;for(var h in r)s.addColorStop(h*o,r[h]);this.Canvas.fillStyle=s}else this.Canvas.fillStyle=r},this.GetDynamicIconSize=function(r,n,e,t,a){var s=V();if(e*=s,t*=s,e==t)return e;var o=r+n-2*s;return a&&(a.Type==0?a.Value>0&&(o=r*a.Value):a.Type==1?a.Value>0&&(o=(r+n)*a.Value):a.Type==2&&c.IsNumber(a.Value)&&(o=r+n+2*a.Value*s)),o<t?o=t:o>e&&(o=e),o},this.GetFontHeight=function(r){return Aa(this.Canvas,r,"擎")},this.DrawLinePoint=function(r){var n=this.ChartFrame.IsHScreen===!0;if(!n&&this.IsShow){var e=this.IsMinuteFrame(),t=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth,s=this.ChartFrame.XPointCount;if(n)var o=this.ChartBorder.GetHScreenBorder(),h=o.BottomEx,l=o.TopEx+a/2+m.FrameLeftMargin;else var o=this.ChartBorder.GetBorder(),l=o.LeftEx+a/2+m.FrameLeftMargin,h=o.RightEx;var u=this.GetLockRect();u&&(n?h=u.Top:h=u.Left);var f=V();this.Canvas.save(),this.ClipClient(n),this.Canvas.lineWidth=this.SelectedLineWidth*f,this.Canvas.strokeStyle=this.SelectedLineColor,this.SelectedBGColor&&(this.Canvas.fillStyle=this.SelectedBGColor);var C=this.SelectedRadius,D=Math.ceil(this.SelectedPointMinSpace/(t+a));if(D<=0&&(D=1),e){var v=(o.Right-o.Left)/s;D=Math.ceil(this.SelectedPointMinSpace/v)}var S=0,T=null,I=null;r&&(r.KLineClose?S=1:r.MinuteVolBar?S=2:r.MinuteOverlayPrice?r.OverlayType==1?S=1:S=3:r.OverlayKLine?(S=4,T=this.GetFirstOpen()):r.StackedBar&&(S=5));for(var F=this.Data.DataOffset,E=0,M=0;F<this.Data.Data.length&&E<s;++F,++E,++M,l+=t+a){var O=null;if(S==1){var R=this.Data.Data[F];c.IsNumber(R.Close)&&(O=R.Close)}else if(S==2){var R=this.Data.Data[F];c.IsNumber(R.Vol)&&(O=R.Vol)}else if(S==3){var b=this.Data.Data[F].Close;if(b==null)continue;O=b/this.YClose*this.MainYClose}else if(S==4){var p=this.Data.Data[F];I==null&&(I=p.Open),O=p.Close/I*T}else if(S==5){var G=this.Data.Data[F];if(!c.IsNonEmptyArray(G))continue;for(var Y=0,Q=0,M=0;M<G.length;++M){var ht=G[M];c.IsNumber(ht)&&ht!=0&&(ht>0?Y+=ht:ht<0&&(Q+=ht))}O=(Y+Q)/2}else O=this.Data.Data[F];if(O!=null&&!(M<D)){if(M=0,e)var Ct=this.ChartFrame.GetXFromIndex(E);else{var lt=l,dt=l+t;if(dt>h)break;var Ct=lt+(dt-lt)/2}var Ut=this.GetYFromData(O,!1);if(Ct>h)break;this.Canvas.beginPath(),this.Canvas.arc(Ct,Ut,C,0,360,!1),this.Canvas.closePath(),this.SelectedBGColor&&this.Canvas.fill(),this.Canvas.stroke()}}this.Canvas.restore()}},this.PtInLine=function(r,n,e){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){var t=this.ChartFrame.IsHScreen===!0;if(!t){var a=this.IsMinuteFrame(),s=this.ChartFrame.DataWidth,o=this.ChartFrame.DistanceWidth,h=this.ChartFrame.XPointCount;if(t)var l=this.ChartBorder.GetHScreenBorder(),u=l.BottomEx,f=l.TopEx+o/2+m.FrameLeftMargin;else var l=this.ChartBorder.GetBorder(),f=l.LeftEx+o/2+m.FrameLeftMargin,u=l.RightEx;var C=this.GetLockRect();if(C&&(t?u=C.Top:u=C.Left),r<f||r>u||n>l.BottomEx||n<l.TopEx)return null;var D={},v={},S=0;e&&(e.KLineClose?S=1:e.MinuteOverlayPrice&&(e.OverlayType==1?S=1:S=3));for(var T=this.Data.DataOffset,I=0;T<this.Data.Data.length&&I<h;++T,++I,f+=s+o){var F=null;if(S==1){var E=this.Data.Data[T];c.IsNumber(E.Close)&&(F=E.Close)}else if(S==3){var M=this.Data.Data[T].Close;if(M==null)continue;var F=M/this.YClose*this.MainYClose}else F=this.Data.Data[T];if(F!=null){if(a)var O=this.ChartFrame.GetXFromIndex(I);else{var R=f,b=f+s;if(b>u)break;var O=R+(b-R)/2}var p=this.GetYFromData(F,!1);if(O<r)D.X=O,D.Y=p;else if(O==r){D.X=v.X=O,D.Y=v.Y=p;break}else{v.X=O,v.Y=p;break}if(r>u)break}}if(!c.IsNumber(D.X)||!c.IsNumber(D.Y)||!c.IsNumber(v.X)||!c.IsNumber(v.Y))return null;if(r==D.X||n==D.Y)return{Identify:this.Identify,Chart:this};if(r==v.X||n==v.Y)return{Identify:this.Identify,Chart:this};var G=5;return this.Canvas.beginPath(),D.X==v.X?(this.Canvas.moveTo(D.X-G,D.Y),this.Canvas.lineTo(D.X+G,D.Y),this.Canvas.lineTo(v.X+G,v.Y),this.Canvas.lineTo(v.X-G,v.Y)):(this.Canvas.moveTo(D.X,D.Y+G),this.Canvas.lineTo(D.X,D.Y-G),this.Canvas.lineTo(v.X,v.Y-G),this.Canvas.lineTo(v.X,v.Y+G)),this.Canvas.closePath(),this.Canvas.isPointInPath(r,n)?{Identify:this.Identify,Chart:this}:null}}},this.PtInBar=function(r,n,e){if(!this.IsShow||this.ChartFrame.IsMinSize)return null;var t=this.ChartFrame.IsHScreen===!0;if(t)return null;var a=this.ChartFrame.DataWidth,s=this.ChartFrame.DistanceWidth,o=this.ChartBorder.GetBorder(),h=o.LeftEx+s/2+m.FrameLeftMargin,l=o.RightEx,u=this.ChartFrame.XPointCount,f=this.GetLockRect();if(f&&(l=f.Left),r<h||r>l||n>o.BottomEx||n<o.TopEx)return null;var C=this.IsMinuteFrame(),D=this.ChartFrame.GetYFromData(0),v=null,S=!1,T=!1;e&&(e.BarWidth>0&&(v=e.BarWidth),e.MinuteVolBar==!0?(S=!0,v=4):e.StackedBar==!0&&(T=!0));for(var I=this.Data.DataOffset,F=0;I<this.Data.Data.length&&F<u;++I,++F,h+=a+s){var E=this.Data.Data[I];if(E!=null){if(C)var M=this.ChartFrame.GetXFromIndex(F),O=M-v/2,R=O+v;else{var O=h,R=h+a;if(R>l)break}if(S){if(!c.IsNumber(E.Vol))continue;var b=this.ChartFrame.GetYFromData(E.Vol),p=b,G=D}else if(T){var Y=0,Q=0;if(!c.IsNonEmptyArray(E))continue;for(var ht=0;ht<E.length;++ht){var Ct=E[ht];c.IsNumber(Ct)&&Ct!=0&&(Ct>0?Y+=Ct:Ct<0&&(Q+=Ct))}var p=this.ChartFrame.GetYFromData(Y),G=this.ChartFrame.GetYFromData(Q)}else var b=this.ChartFrame.GetYFromData(E),p=b,G=D;p>G&&(p=D,G=b);var lt=O,dt=R;if(v>0&&(lt=O+(R-O)/2-v/2,dt=lt+v),r>=lt&&r<=dt&&n>=p&&n<=G)return{Identify:this.Identify,Chart:this};if(R>r)break}}return null},this.PtInKBar=function(r,n,e){if(!this.IsShow||this.ChartFrame.IsMinSize)return null;var t=this.ChartFrame.IsHScreen===!0;if(t)return null;var a=this.ChartFrame.DataWidth,s=this.ChartFrame.DistanceWidth,o=this.ChartBorder.GetBorder(),h=o.LeftEx+s/2+m.FrameLeftMargin,l=o.RightEx,u=this.ChartFrame.XPointCount;if(t){var o=this.ChartBorder.GetHScreenBorder();h=o.TopEx+s/2+m.FrameLeftMargin,l=o.BottomEx}if(r<h||r>l||n>o.BottomEx||n<o.TopEx)return null;var f=null,C=0,D=null;e&&e.OverlayKLine&&(C=1,D=this.GetFirstOpen());for(var v=this.Data.DataOffset,S=0;v<this.Data.Data.length&&S<u;++v,++S,h+=a+s){var T=this.Data.Data[v];if(!(T.Open==null||T.High==null||T.Low==null||T.Close==null)){f==null&&(f=T.Open);var I=h,F=h+a;if(F>l)break;if(r>=I&&r<=F){if(C==1)var E=this.GetYFromData(T.Low/f*D,!1),M=this.GetYFromData(T.High/f*D,!1);else var E=this.GetYFromData(T.Low,!1),M=this.GetYFromData(T.High,!1);if(n<=E&&n>=M)return{Identify:this.Identify,Chart:this}}if(F>r)break}}},this.IsShowIndexTitleOnly=function(){return!!(this.ChartFrame&&this.ChartFrame.ChartBorder&&this.ChartFrame.ChartBorder.IsShowTitleOnly)},this.IsHideScriptIndex=function(){return!!(this.Script&&this.Script.IsShow==!1)},this.ExportArrayData=function(r,n){var e=this.Data.ExportArrayData(r,n);return[{Name:this.Name,Data:e}]},this.ExportBoolData=function(r,n){var e=this.Data.ExportBoolData(r,n);return[{Name:this.Name,Data:e}]},this.GetArrayItemData=function(r){if(!r||!c.IsNumber(r.Index)||!this.Data||!c.IsNonEmptyArray(this.Data.Data))return null;var n=r.Index;if(n<0||n>=this.Data.Data.length)return null;var e=this.Data.Data[n];return[{Value:e,Color:this.Color,Name:this.Name}]}}var ie=[[48,10],[44,10],[40,9],[36,9],[32,8],[28,8],[24,7],[20,7],[18,6],[16,6],[15,5],[13,5],[9,4],[7,4],[5,4],[3,3],[3,1],[2,1],[1,1],[1,0]];function gr(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartKLine",this.Symbol,this.DrawType=0,this.CloseLineColor=m.CloseLineColor,this.CloseLineAreaColor=m.CloseLineAreaColor,this.CloseLineWidth=m.CloseLineWidth,this.UpColor=m.UpBarColor,this.DownColor=m.DownBarColor,this.UnchagneColor=m.UnchagneBarColor,this.ColorData,this.TradeData,this.TradeIcon=m.KLine.TradeIcon,this.TooltipRect=[],this.InfoTooltipRect=[],this.TradeIconTooltipRect=[],this.IsShowMaxMinPrice=!0,this.IsShowKTooltip=!0,this.TextFont=m.KLine.MaxMin.Font,this.TextColor=m.KLine.MaxMin.Color,this.InfoData,this.InfoPosition=0,this.PtMax,this.PtMin,this.TickSymbol="╳",this.TickFontName="arial",this.Period,this.ShowRange={},this.CustomKLine,this.DrawKRange={Start:null,End:null},this.IsThinAKBar=!0,this.HighLowBarColor=m.HighLowBarColor,this.HLCAreaConfig={HighLineColor:m.HLCArea.HighLineColor,LowLineColor:m.HLCArea.LowLineColor,CloseLineColor:m.HLCArea.CloseLineColor,LineWidth:m.HLCArea.LineWidth,UpAreaColor:m.HLCArea.UpAreaColor,DownAreaColor:m.HLCArea.DownAreaColor},this.VirtualBarConfig={Color:m.VirtualKLine.Color,LineDash:m.VirtualKLine.LineDash},this.FFKChart,this.OrderFlow={UpColor:{BG:m.OrderFlow.UpColor.BG,Border:m.OrderFlow.UpColor.Border},DownColor:{BG:m.OrderFlow.DownColor.BG,Border:m.OrderFlow.DownColor.Border},UnchagneColor:{BG:m.OrderFlow.UnchagneColor.BG,Border:m.OrderFlow.UnchagneColor.Border},Text:{Color:m.OrderFlow.Text.Color,Family:m.OrderFlow.Text.Family,FontMaxSize:m.OrderFlow.Text.FontMaxSize,MaxValue:m.OrderFlow.Text.MaxValue},Line:{UpDownColor:m.OrderFlow.Line.UpDownColor,MiddleColor:m.OrderFlow.Line.MiddleColor},POCGBColor:m.OrderFlow.POCGBColor,ShowType:0,AskBarColor:m.OrderFlow.AskBarColor,BidBarColor:m.OrderFlow.BidBarColor,AlwaysShowOrderText:m.OrderFlow.AlwaysShowOrderText,IsShowAskText:!0,IsShowAskBar:!1,IsShowBidText:!0,IsShowBidBar:!1,IsShowPOCBG:!0},this.OrderFlow_Style2={BarWidth:m.OrderFlow_Style2.BarWidth,UpColor:m.OrderFlow_Style2.UpColor,DownColor:m.OrderFlow_Style2.DownColor,UnchagneColor:m.OrderFlow_Style2.UnchagneColor},this.OrderFlow_Style3={BarWidth:m.OrderFlow_Style3.BarWidth,UpColor:m.OrderFlow_Style3.UpColor,DownColor:m.OrderFlow_Style3.DownColor,UnchagneColor:m.OrderFlow_Style3.UnchagneColor},this.IsShowOrderText=!1,this.AryOrderFlowBorder=[],this.ChartHeatMap,this.ReloadResource=function(r){this.TextFont=m.KLine.MaxMin.Font,this.TextColor=m.KLine.MaxMin.Color,this.CloseLineColor=m.CloseLineColor,this.CloseLineAreaColor=m.CloseLineAreaColor,this.CloseLineWidth=m.CloseLineWidth,this.UpColor=m.UpBarColor,this.DownColor=m.DownBarColor,this.UnchagneColor=m.UnchagneBarColor,this.HighLowBarColor=m.HighLowBarColor,this.OrderFlow.UpColor={BG:m.OrderFlow.UpColor.BG,Border:m.OrderFlow.UpColor.Border},this.OrderFlow.DownColor={BG:m.OrderFlow.DownColor.BG,Border:m.OrderFlow.DownColor.Border},this.OrderFlow.UnchagneColor={BG:m.OrderFlow.UnchagneColor.BG,Border:m.OrderFlow.UnchagneColor.Border},this.OrderFlow.Text={Color:m.OrderFlow.Text.Color,Family:m.OrderFlow.Text.Family,FontMaxSize:m.OrderFlow.Text.FontMaxSize,MaxValue:m.OrderFlow.Text.MaxValue},this.OrderFlow.Line={UpDownColor:m.OrderFlow.Line.UpDownColor,MiddleColor:m.OrderFlow.Line.MiddleColor}},this.ClearCustomKLine=function(){this.CustomKLine=null},this.GetCustomKLine=function(r){if(!this.CustomKLine||!r)return null;var n=r.Date*1e6;if(c.IsNumber(r.Time)&&(n+=r.Time),!this.CustomKLine.has(n))return null;var e=this.CustomKLine.get(n);return e},this.DrawHeatMap=function(){this.ChartHeatMap&&(this.ChartHeatMap.Canvas=this.Canvas,this.ChartHeatMap.ChartBorder=this.ChartBorder,this.ChartHeatMap.ChartFrame=this.ChartFrame,this.ChartHeatMap.Data=this.Data,this.ChartHeatMap.Draw())},this.ClearHeatMap=function(){this.ChartHeatMap=null},this.CreateHeatMap=function(){this.ChartHeatMap=new JT},this.DrawAKLine=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount;if(r)var a=this.ChartBorder.GetHScreenBorder(),s=a.TopEx+e/2+m.FrameLeftMargin,o=a.BottomEx;else var a=this.ChartBorder.GetBorder(),s=a.LeftEx+e/2+m.FrameLeftMargin,o=a.RightEx;var h=this.UpColor,l=this.DownColor,u=this.UnchagneColor,f={X:null,Y:null,Value:null,Align:"left"},C={X:null,Y:null,Value:null,Align:"left"};this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset;var D=null;this.GetEventCallback&&(D=this.GetEventCallback(et.ON_CUSTOM_UNCHANGE_KLINE_COLOR));for(var v=this.Data.DataOffset,S=0;v<this.Data.Data.length&&S<t;++v,++S,s+=n+e,++this.ShowRange.DataCount){var T=this.Data.Data[v];if(this.ShowRange.End=v,!(T.Open==null||T.High==null||T.Low==null||T.Close==null)){var I=s,F=s+n;if(F>o)break;var E=I+(F-I)/2,M=this.GetYFromData(T.Low,!1),O=this.GetYFromData(T.High,!1),R=this.GetYFromData(T.Open,!1),b=this.GetYFromData(T.Close,!1);if(this.DrawKRange.End=v,(f.Value==null||f.Value<T.High)&&(f.X=E,f.Y=O,f.Value=T.High,f.Align=S<t/2?"left":"right"),(C.Value==null||C.Value>T.Low)&&(C.X=E,C.Y=M,C.Value=T.Low,C.Align=S<t/2?"left":"right"),u=this.UnchagneColor,T.Open<T.Close)this.Canvas.strokeStyle=this.UpColor;else if(T.Open>T.Close)this.Canvas.strokeStyle=this.DownColor;else{if(D&&D.Callback){var p={KItem:T,DataIndex:v,DefaultColor:u,BarColor:null};D.Callback(D,p,this),p.BarColor&&(u=p.BarColor)}this.Canvas.strokeStyle=u}if(this.ColorData&&(v<this.ColorData.length?h=l=u=this.ColorData[v]>0?this.UpColor:this.DownColor:h=l=u=this.DownColor),this.IsThinAKBar==!1&&n>=9){var G={YLow:M,YHigh:O,YOpen:R,YClose:b,X:E,Left:I,Right:F},Y={UpColor:h,DownColor:l,UnchangeColor:u};this.DrawAKBar(T,n,r,G,Y)}else this.Canvas.beginPath(),r?T.High==T.Low&&n<4?(this.Canvas.moveTo(O,L(E)),this.Canvas.lineTo(M-1,L(E))):(this.Canvas.moveTo(O,L(E)),this.Canvas.lineTo(M,L(E))):T.High==T.Low&&n<4?(this.Canvas.moveTo(L(E),O),this.Canvas.lineTo(L(E),M+1)):(this.Canvas.moveTo(L(E),O),this.Canvas.lineTo(L(E),M)),this.Canvas.stroke(),n>=4&&(this.Canvas.beginPath(),r?(this.Canvas.moveTo(L(R),I),this.Canvas.lineTo(L(R),E)):(this.Canvas.moveTo(I,L(R)),this.Canvas.lineTo(E,L(R))),this.Canvas.stroke(),this.Canvas.beginPath(),r?(this.Canvas.moveTo(L(b),F),this.Canvas.lineTo(L(b),E)):(this.Canvas.moveTo(F,L(b)),this.Canvas.lineTo(E,L(b))),this.Canvas.stroke());if(this.Data.DataType==0){var Q={Xleft:I,XRight:F,YMax:O,XCenter:E,YMin:M,DayData:T,Index:S};this.DrawInfo(Q)}}}this.PtMax=f,this.PtMin=C},this.DrawAKBar=function(r,n,e,t,a){var s=n/3,o=B(t.Left),h=[o,B(o+s),B(o+s*2),B(o+s*3)],l=t.YHigh,u=t.YLow,f=t.YOpen,C=t.YClose;if(r.Open<r.Close?(this.Canvas.strokeStyle=a.UpColor,this.Canvas.fillStyle=a.UpColor):r.Open>r.Close?(this.Canvas.strokeStyle=a.DownColor,this.Canvas.fillStyle=a.DownColor):(this.Canvas.strokeStyle=a.UnchangeColor,this.Canvas.fillStyle=a.UnchangeColor),e)if(r.High==r.Low){var D=l-s/2;this.Canvas.fillRect(D,h[1],s,h[2]-h[1])}else this.Canvas.fillRect(l,h[1],u-l,h[2]-h[1]);else if(r.High==r.Low){var D=l-s/2;this.Canvas.fillRect(h[1],D,h[2]-h[1],s)}else this.Canvas.fillRect(h[1],l,h[2]-h[1],u-l);var D=f-s/2;e?this.Canvas.fillRect(D,h[0],s,h[1]-h[0]):this.Canvas.fillRect(h[0],D,h[1]-h[0],s);var D=C-s/2;e?this.Canvas.fillRect(D,h[2],s,h[3]-h[2]):this.Canvas.fillRect(h[2],D,h[3]-h[2],s)},this.DrawCloseArea=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount;if(r)var a=this.ChartBorder.GetHScreenBorder(),s=a.TopEx+e/2+m.FrameLeftMargin,o=a.BottomEx,h=a.TopEx;else var a=this.ChartBorder.GetBorder(),s=a.LeftEx+e/2+m.FrameLeftMargin,o=a.RightEx,h=a.LeftEx;var l=!0,u=null;this.Canvas.beginPath(),this.Canvas.strokeStyle=this.CloseLineColor,c.IsNumber(this.CloseLineWidth)&&(this.Canvas.lineWidth=this.CloseLineWidth);var f=null;if(this.Data.DataOffset>0){var C=this.Data.Data[this.Data.DataOffset-1];if(C&&c.IsNumber(C.Close)){var D=h,v=this.GetYFromData(C.Close,!1);r?(this.Canvas.moveTo(v,D),u={X:v,Y:D}):(this.Canvas.moveTo(D,v),u={X:D,Y:v}),l=!1}}this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset;for(var S=this.Data.DataOffset,T=0;S<this.Data.Data.length&&T<t;++S,++T,s+=n+e,++this.ShowRange.DataCount){var C=this.Data.Data[S];if(this.ShowRange.End=S,!(C.Open==null||C.High==null||C.Low==null||C.Close==null)){var I=s,F=s+n;if(F>o)break;var D=I+(F-I)/2,v=this.GetYFromData(C.Close,!1);this.DrawKRange.End=S,l?(r?(this.Canvas.moveTo(v,D),u={X:v,Y:D}):(this.Canvas.moveTo(D,v),u={X:D,Y:v}),l=!1):r?this.Canvas.lineTo(v,D):this.Canvas.lineTo(D,v),S==this.Data.Data.length-1&&(f={X:D,Y:v,XLeft:I,XRight:F,KItem:C,ChartRight:o})}}if(this.DrawLastPointEvent(f),!l){if(this.Canvas.stroke(),r?(this.Canvas.lineTo(a.Left,D),this.Canvas.lineTo(a.Left,u.Y)):(this.Canvas.lineTo(D,a.Bottom),this.Canvas.lineTo(u.X,a.Bottom)),this.Canvas.closePath(),Array.isArray(this.CloseLineAreaColor))if(r){var E=this.Canvas.createLinearGradient(this.ChartBorder.GetRightEx(),this.ChartBorder.GetTop(),this.ChartBorder.GetLeft(),this.ChartBorder.GetTop());E.addColorStop(0,this.CloseLineAreaColor[0]),E.addColorStop(1,this.CloseLineAreaColor[1]),this.Canvas.fillStyle=E}else{var M=this.Canvas.createLinearGradient(u.X,this.ChartBorder.GetTopEx(),u.X,this.ChartBorder.GetBottom());M.addColorStop(0,this.CloseLineAreaColor[0]),M.addColorStop(1,this.CloseLineAreaColor[1]),this.Canvas.fillStyle=M}else this.Canvas.fillStyle=this.CloseLineAreaColor;this.Canvas.fill()}},this.DrawCloseLine=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount;if(r)var a=this.ChartBorder.GetHScreenBorder(),s=a.TopEx+e/2+m.FrameLeftMargin,o=a.BottomEx;else var a=this.ChartBorder.GetBorder(),s=a.LeftEx+e/2+m.FrameLeftMargin,o=a.RightEx;var h=!0;this.Canvas.beginPath(),this.Canvas.strokeStyle=this.CloseLineColor,c.IsNumber(this.CloseLineWidth)&&(this.Canvas.lineWidth=this.CloseLineWidth),this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset;for(var l=this.Data.DataOffset,u=0;l<this.Data.Data.length&&u<t;++l,++u,s+=n+e,++this.ShowRange.DataCount){var f=this.Data.Data[l];if(this.ShowRange.End=l,!(f.Open==null||f.High==null||f.Low==null||f.Close==null)){var C=s,D=s+n;if(D>o)break;var v=C+(D-C)/2,S=this.GetYFromData(f.Close,!1);this.DrawKRange.End=l,h?(r?this.Canvas.moveTo(S,v):this.Canvas.moveTo(v,S),h=!1):r?this.Canvas.lineTo(S,v):this.Canvas.lineTo(v,S)}}h==!1&&this.Canvas.stroke()},this.DrawKBar=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetBorder(),a=t.LeftEx+e/2+m.FrameLeftMargin,s=t.RightEx,o=this.ChartFrame.XPointCount;if(r){var t=this.ChartBorder.GetHScreenBorder();a=t.TopEx+e/2+m.FrameLeftMargin,s=t.BottomEx}var h={X:null,Y:null,Value:null,Align:"left"},l={X:null,Y:null,Value:null,Align:"left"},u=this.UpColor,f=this.DownColor,C=this.UnchagneColor;this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o;var D=null;this.DrawKRange.Start=this.Data.DataOffset;var v=null;this.GetEventCallback&&(v=this.GetEventCallback(et.ON_CUSTOM_UNCHANGE_KLINE_COLOR));for(var S=this.Data.DataOffset,T=0;S<this.Data.Data.length&&T<o;++S,++T,a+=n+e,++this.ShowRange.DataCount){var I=this.Data.Data[S];if(this.ShowRange.End=S,!(I.Open==null||I.High==null||I.Low==null||I.Close==null)){var F=a,E=a+n;if(E>s)break;var M=F+(E-F)/2,O=this.GetYFromData(I.Low,!1),R=this.GetYFromData(I.High,!1),b=this.GetYFromData(I.Open,!1),p=this.GetYFromData(I.Close,!1),G=R;this.DrawKRange.End=S,(h.Value==null||h.Value<I.High)&&(h.X=M,h.Y=R,h.Value=I.High,h.Align=T<o/2?"left":"right"),(l.Value==null||l.Value>I.Low)&&(l.X=M,l.Y=O,l.Value=I.Low,l.Align=T<o/2?"left":"right"),this.ColorData&&(S<this.ColorData.length?u=f=C=this.ColorData[S]>0?this.UpColor:this.DownColor:u=f=C=this.DownColor);var Y=this.GetCustomKLine(I);if(I.IsNonTrade)this.DrawVirtualBar(I,n,M,G,F,E,O,R,b,p,r);else if(Y){var Q=Y.Color;Q||(I.Open<I.Close?Q=u:I.Open>I.Close?Q=f:Q=C);var ht=this.DrawType;c.IsNumber(Y.DrawType)&&(ht=Y.DrawType),this.DrawKBar_Custom(I,n,Q,ht,Y,M,G,F,E,O,R,b,p,t,r)}else if(this.DrawType==9&&I.ColorData)this.DrawColorKBar(I,I.ColorData,n,M,G,F,E,O,R,b,p,r);else if(I.Open<I.Close)this.DrawKBar_Up(I,n,u,this.DrawType,M,G,F,E,O,R,b,p,r);else if(I.Open>I.Close)this.DrawKBar_Down(I,n,f,this.DrawType,M,G,F,E,O,R,b,p,r);else{var Q=C;if(v&&v.Callback){var Ct={KItem:I,DataIndex:S,DefaultColor:Q,BarColor:null};v.Callback(v,Ct,this),Ct.BarColor&&(Q=Ct.BarColor)}this.DrawKBar_Unchagne(I,n,Q,this.DrawType,M,G,F,E,O,R,b,p,r)}if(this.IsShowKTooltip&&!r){var lt=Math.min(b,p),dt=Math.max(b,p);Math.abs(b-p)<5&&(lt=Math.min(R,lt-5),dt=Math.max(O,dt+5)),I.IsNonTrade&&(lt=R,dt=O);var Ut=new Sa(F,lt,n,dt-lt);this.TooltipRect.push([S,Ut])}if(this.Data.DataType==0||this.Data.DataType==1){var Wt={Xleft:F,XRight:E,XCenter:M,YMax:R,YMin:O,DayData:I,Index:T};this.DrawInfo(Wt)}S==this.Data.Data.length-1&&(D={X:M,Y:p,XLeft:F,XRight:E,KItem:I,ChartRight:s})}}this.DrawLastPointEvent(D),this.PtMax=h,this.PtMin=l},this.DrawKBar_Up=function(r,n,e,t,a,s,o,h,l,u,f,C,D){var v=t==3||t==6;if(n>=4){if(v&&n%2!=0&&(n-=1),this.Canvas.strokeStyle=e,r.High>r.Close){if(this.Canvas.beginPath(),D)this.Canvas.moveTo(L(s),L(a)),this.Canvas.lineTo(L(t==3?Math.max(C,f):C),L(a));else if(v){var S=o+n/2;this.Canvas.moveTo(L(S),L(s)),this.Canvas.lineTo(L(S),L(Math.min(C,f)))}else this.Canvas.moveTo(L(a),L(s)),this.Canvas.lineTo(L(a),L(C));this.Canvas.stroke(),s=C}else s=C;if(this.Canvas.fillStyle=e,D?Math.abs(f-s)<1?this.Canvas.fillRect(B(s),B(o),1,B(n)):v?(this.Canvas.beginPath(),this.Canvas.rect(L(s),L(o),B(f-s),B(n)),this.Canvas.stroke()):this.Canvas.fillRect(B(s),B(o),B(f-s),B(n)):Math.abs(f-s)<1?this.Canvas.fillRect(B(o),B(s),B(n),1):v?(this.Canvas.beginPath(),this.Canvas.rect(L(o),L(s),B(n),B(f-s)),this.Canvas.stroke()):this.Canvas.fillRect(B(o),B(Math.min(s,f)),B(n),B(Math.abs(f-s))),r.Open>r.Low){if(this.Canvas.beginPath(),D)this.Canvas.moveTo(L(t==3?Math.min(C,f):s),L(a)),this.Canvas.lineTo(L(l),L(a));else if(v){var S=o+n/2;this.Canvas.moveTo(L(S),L(Math.max(C,f))),this.Canvas.lineTo(L(S),L(l))}else this.Canvas.moveTo(L(a),L(s)),this.Canvas.lineTo(L(a),L(l));this.Canvas.stroke()}}else this.Canvas.beginPath(),D?(this.Canvas.moveTo(u,L(a)),this.Canvas.lineTo(l,L(a))):(this.Canvas.moveTo(L(a),u),this.Canvas.lineTo(L(a),l)),this.Canvas.strokeStyle=e,this.Canvas.stroke()},this.DrawKBar_Down=function(r,n,e,t,a,s,o,h,l,u,f,C,D){var v=t==6;if(n>=4){if(v&&n%2!=0&&(n-=1),this.Canvas.strokeStyle=e,r.High>r.Close){if(this.Canvas.beginPath(),D)this.Canvas.moveTo(L(s),L(a)),this.Canvas.lineTo(L(f),L(a));else if(v){var S=o+n/2;this.Canvas.moveTo(L(S),L(s)),this.Canvas.lineTo(L(S),L(Math.min(C,f)))}else this.Canvas.moveTo(L(a),L(s)),this.Canvas.lineTo(L(a),L(f));this.Canvas.stroke(),s=f}else s=f;if(this.Canvas.fillStyle=e,D?Math.abs(C-s)<1?this.Canvas.fillRect(B(s),B(o),1,B(n)):this.Canvas.fillRect(B(s),B(o),B(C-s),B(n)):Math.abs(C-s)<1?this.Canvas.fillRect(B(o),B(s),B(n),1):v?(this.Canvas.beginPath(),this.Canvas.rect(L(o),L(Math.min(s,C)),B(n),B(Math.abs(C-s))),this.Canvas.stroke()):this.Canvas.fillRect(B(o),B(Math.min(s,C)),B(n),B(Math.abs(C-s))),r.Open>r.Low){if(this.Canvas.beginPath(),D)this.Canvas.moveTo(L(s),L(a)),this.Canvas.lineTo(L(l),L(a));else if(v){var S=o+n/2;this.Canvas.moveTo(L(S),L(Math.max(C,f))),this.Canvas.lineTo(L(S),L(l))}else this.Canvas.moveTo(L(a),L(s)),this.Canvas.lineTo(L(a),L(l));this.Canvas.stroke()}}else this.Canvas.beginPath(),D?(this.Canvas.moveTo(u,L(a)),this.Canvas.lineTo(l,L(a))):(this.Canvas.moveTo(L(a),u),this.Canvas.lineTo(L(a),l)),this.Canvas.strokeStyle=e,this.Canvas.stroke()},this.DrawKBar_Unchagne=function(r,n,e,t,a,s,o,h,l,u,f,C,D){if(n>=4){if(n%2!=0&&(n-=1),this.Canvas.strokeStyle=e,this.Canvas.beginPath(),r.High>r.Close){if(D)this.Canvas.moveTo(s,L(a)),this.Canvas.lineTo(f,L(a));else{var v=L(o+n/2);this.Canvas.moveTo(v,s),this.Canvas.lineTo(v,f)}s=f}else s=f;if(D?(this.Canvas.moveTo(L(s),L(o)),this.Canvas.lineTo(L(s),L(h))):(this.Canvas.moveTo(L(o),L(s)),this.Canvas.lineTo(L(o+n),L(s))),r.Open>r.Low)if(D)this.Canvas.moveTo(L(s),L(a)),this.Canvas.lineTo(L(l),L(a));else{var v=L(o+n/2);this.Canvas.moveTo(v,L(s)),this.Canvas.lineTo(v,L(l))}this.Canvas.stroke()}else this.Canvas.beginPath(),D?r.High==r.Low?(this.Canvas.moveTo(u,L(a)),this.Canvas.lineTo(l-1,L(a))):(this.Canvas.moveTo(u,L(a)),this.Canvas.lineTo(l,L(a))):r.High==r.Low?(this.Canvas.moveTo(L(a),u),this.Canvas.lineTo(L(a),l+1)):(this.Canvas.moveTo(L(a),u),this.Canvas.lineTo(L(a),l)),this.Canvas.strokeStyle=e,this.Canvas.stroke()},this.DrawKBar_Custom=function(r,n,e,t,a,s,o,h,l,u,f,C,D,v,S){if(a.BGColor){this.Canvas.fillStyle=a.BGColor;var T=this.ChartFrame.DistanceWidth;if(S){var I=h-T/2,F=l+T/2,E=v.RightEx,M=v.LeftEx;this.Canvas.fillRect(B(M),B(I),B(E-M),B(F-I))}else{var O=h-T/2,R=l+T/2,b=v.TopEx,p=v.BottomEx;this.Canvas.fillRect(B(O),B(b),B(R-O),B(p-b))}}n>=4?(this.Canvas.strokeStyle=e,r.High>r.Close&&(this.Canvas.beginPath(),S?(this.Canvas.moveTo(L(o),L(s)),this.Canvas.lineTo(L(t==3?Math.max(D,C):D),L(s))):(this.Canvas.moveTo(L(s),L(o)),this.Canvas.lineTo(L(s),L(t==3?Math.min(D,C):D))),this.Canvas.stroke()),o=D,this.Canvas.fillStyle=e,S?Math.abs(C-o)<1?this.Canvas.fillRect(B(o),B(h),1,B(n)):t==3?(this.Canvas.beginPath(),this.Canvas.rect(L(o),L(h),B(C-o),B(n)),this.Canvas.stroke()):this.Canvas.fillRect(B(o),B(h),B(C-o),B(n)):Math.abs(C-o)<1?this.Canvas.fillRect(B(h),B(o),B(n),1):t==3?(this.Canvas.beginPath(),this.Canvas.rect(L(h),L(o),B(n),B(C-o)),this.Canvas.stroke()):this.Canvas.fillRect(B(h),B(Math.min(o,C)),B(n),B(Math.abs(C-o))),r.Open>r.Low&&(this.Canvas.beginPath(),S?(this.Canvas.moveTo(L(t==3?Math.min(D,C):o),L(s)),this.Canvas.lineTo(L(u),L(s))):(this.Canvas.moveTo(L(s),L(t==3?Math.max(D,C):o)),this.Canvas.lineTo(L(s),L(u))),this.Canvas.stroke())):(this.Canvas.beginPath(),S?(this.Canvas.moveTo(f,L(s)),this.Canvas.lineTo(u,L(s))):(this.Canvas.moveTo(L(s),f),this.Canvas.lineTo(L(s),u)),this.Canvas.strokeStyle=e,this.Canvas.stroke())},this.DrawColorKBar=function(r,n,e,t,a,s,o,h,l,u,f,C){Math.abs(f-a)<1?this.DrawColorKBar_Line(r,n,e,t,a,s,o,h,l,u,f,C):n.Border||n.Type===0?this.DrawColorKBar_Border(r,n,e,t,a,s,o,h,l,u,f,C):this.DrawColorKBar_NoBorder(r,n,e,t,a,s,o,h,l,u,f,C)},this.DrawColorKBar_Border=function(r,n,e,t,a,s,o,h,l,u,f,C){if(e>=4){e%2!=0&&(e-=1);var D=Math.max(r.Close,r.Open),v=Math.min(r.Close,r.Open);if(C)var S=Math.max(f,u),T=Math.min(f,u);else var S=Math.min(f,u),T=Math.max(f,u);var I=Math.abs(f-u);if(r.High>D&&n.Line){if(this.Canvas.strokeStyle=n.Line.Color,this.Canvas.beginPath(),C)this.Canvas.moveTo(L(l),L(t)),this.Canvas.lineTo(L(S),L(t));else{var F=s+e/2;this.Canvas.moveTo(L(F),L(l)),this.Canvas.lineTo(L(F),L(S))}this.Canvas.stroke()}if(v>r.Low&&n.Line){if(this.Canvas.strokeStyle=n.Line.Color,this.Canvas.beginPath(),C)this.Canvas.moveTo(L(T),L(t)),this.Canvas.lineTo(L(h),L(t));else{var F=s+e/2;this.Canvas.moveTo(L(F),L(T)),this.Canvas.lineTo(L(F),L(h))}this.Canvas.stroke()}if(C){var E=new Path2D;E.rect(L(T),L(s),B(I),B(e))}else{var E=new Path2D;E.rect(L(s),L(S),B(e),B(I))}n.Type==0?(n.BarColor&&(this.Canvas.strokeStyle=n.BarColor,this.Canvas.stroke(E)),n.Border&&(this.Canvas.strokeStyle=n.Border.Color,this.Canvas.stroke(E))):n.Type==1&&(n.BarColor&&(this.Canvas.fillStyle=n.BarColor,this.Canvas.fill(E)),n.Border&&(this.Canvas.strokeStyle=n.Border.Color,this.Canvas.stroke(E)))}else this.DrawColorKBar_MinBar(r,n,e,t,a,s,o,h,l,u,f,C)},this.DrawColorKBar_NoBorder=function(r,n,e,t,a,s,o,h,l,u,f,C){if(e>=4){var D=Math.max(r.Close,r.Open),v=Math.min(r.Close,r.Open);if(C)var S=Math.max(f,u),T=Math.min(f,u);else var S=Math.min(f,u),T=Math.max(f,u);var I=Math.abs(f-u);if(r.High>D&&n.Line){if(this.Canvas.strokeStyle=n.Line.Color,this.Canvas.beginPath(),C)this.Canvas.moveTo(L(l),L(t)),this.Canvas.lineTo(L(S),L(t));else{var F=s+e/2;this.Canvas.moveTo(L(F),L(l)),this.Canvas.lineTo(L(F),L(S))}this.Canvas.stroke()}if(v>r.Low&&n.Line){if(this.Canvas.strokeStyle=n.Line.Color,this.Canvas.beginPath(),C)this.Canvas.moveTo(L(T),L(t)),this.Canvas.lineTo(L(h),L(t));else{var F=s+e/2;this.Canvas.moveTo(L(F),L(T)),this.Canvas.lineTo(L(F),L(h))}this.Canvas.stroke()}if(C){var E=new Path2D;E.rect(B(T),B(s),B(I),B(e))}else{var E=new Path2D;E.rect(B(s),B(S),B(e),B(I))}n.Type==1&&n.BarColor&&(this.Canvas.fillStyle=n.BarColor,this.Canvas.fill(E))}else this.DrawColorKBar_MinBar(r,n,e,t,a,s,o,h,l,u,f,C)},this.DrawColorKBar_MinBar=function(r,n,e,t,a,s,o,h,l,u,f,C){n.Line&&(this.Canvas.strokeStyle=n.Line.Color,this.Canvas.beginPath(),C?(this.Canvas.moveTo(L(l),L(t)),this.Canvas.lineTo(L(h),L(t))):(this.Canvas.moveTo(L(t),L(l)),this.Canvas.lineTo(L(t),L(h))),this.Canvas.stroke())},this.DrawColorKBar_Line=function(r,n,e,t,a,s,o,h,l,u,f,C){if(e>=4){n.Line&&(this.Canvas.strokeStyle=n.Line.Color,this.Canvas.beginPath(),C?(this.Canvas.moveTo(L(l),L(t)),this.Canvas.lineTo(L(h),L(t))):(this.Canvas.moveTo(L(t),L(l)),this.Canvas.lineTo(L(t),L(h))),this.Canvas.stroke());var D;(n.Type==0||n.Type==1)&&(n.Border?D=n.Border.Color:n.BarColor&&(D=n.BarColor)),D&&(this.Canvas.strokeStyle=D,this.Canvas.beginPath(),C?(this.Canvas.moveTo(L(u),L(s)),this.Canvas.lineTo(L(u),L(o))):(this.Canvas.moveTo(L(s),L(u)),this.Canvas.lineTo(L(o),L(u))),this.Canvas.stroke())}else n.Line&&(this.Canvas.strokeStyle=n.Line.Color,this.Canvas.beginPath(),C?(this.Canvas.moveTo(L(l),L(t)),this.Canvas.lineTo(L(h),L(t))):(this.Canvas.moveTo(L(t),L(l)),this.Canvas.lineTo(L(t),L(h))),this.Canvas.stroke())},this.DrawVirtualBar=function(r,n,e,t,a,s,o,h,l,u,f){var C=Math.min(h,o),D=Math.max(h,o);this.Canvas.strokeStyle=this.VirtualBarConfig.Color,this.Canvas.setLineDash(this.VirtualBarConfig.LineDash),f?n>=4?this.Canvas.strokeRect(L(C),L(a),B(D-C),B(n)):(this.Canvas.beginPath(),this.Canvas.moveTo(C,L(e)),this.Canvas.lineTo(D,L(e)),this.Canvas.stroke()):n>=4?this.Canvas.strokeRect(L(a),L(C),B(n),B(D-C)):(this.Canvas.beginPath(),this.Canvas.moveTo(L(e),C),this.Canvas.lineTo(L(e),D),this.Canvas.stroke()),this.Canvas.setLineDash([])},this.DrawRenkoCandle=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount;if(r)var a=this.ChartBorder.GetHScreenBorder(),s=a.TopEx+e/2+m.FrameLeftMargin,o=a.BottomEx;else var a=this.ChartBorder.GetBorder(),s=a.LeftEx+e/2+m.FrameLeftMargin,o=a.RightEx;var h={X:null,Y:null,Value:null,Align:"left"},l={X:null,Y:null,Value:null,Align:"left"};this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset;for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<t;++u,++f,s+=n+e,++this.ShowRange.DataCount){var C=this.Data.Data[u];if(this.ShowRange.End=u,!(C.Open==null||C.High==null||C.Low==null||C.Close==null)){var D=s,v=s+n;if(v>o)break;var S=D+(v-D)/2,T=this.GetYFromData(C.Low,!1),I=this.GetYFromData(C.High,!1);this.DrawKRange.End=u,(h.Value==null||h.Value<C.High)&&(h.X=S,h.Y=I,h.Value=C.High,h.Align=f<t/2?"left":"right"),(l.Value==null||l.Value>C.Low)&&(l.X=S,l.Y=T,l.Value=C.Low,l.Align=f<t/2?"left":"right"),C.YClose<C.Close?(this.Canvas.strokeStyle=this.UpColor,this.Canvas.fillStyle=this.UpColor):C.YClose>C.Close&&(this.Canvas.strokeStyle=this.DownColor,this.Canvas.fillStyle=this.DownColor),n>=4?r?this.Canvas.fillRect(B(T),B(D),B(Math.abs(T-I)),B(n)):this.Canvas.fillRect(B(D),B(I),B(n),B(Math.abs(T-I))):(this.Canvas.beginPath(),r?(this.Canvas.moveTo(I,L(S)),this.Canvas.lineTo(T,L(S))):(this.Canvas.moveTo(L(S),I),this.Canvas.lineTo(L(S),T)),this.Canvas.stroke())}}this.PtMax=h,this.PtMin=l},this.DrawLineBreak=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount,a=e/2;if(r)var s=this.ChartBorder.GetHScreenBorder(),o=s.TopEx+e/2+m.FrameLeftMargin-a,h=s.BottomEx;else var s=this.ChartBorder.GetBorder(),o=s.LeftEx+e/2+m.FrameLeftMargin-a,h=s.RightEx;var l={X:null,Y:null,Value:null,Align:"left"},u={X:null,Y:null,Value:null,Align:"left"};this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset;for(var f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<t;++f,++C,o+=n+e,++this.ShowRange.DataCount){var D=this.Data.Data[f];if(this.ShowRange.End=f,!(D.Open==null||D.High==null||D.Low==null||D.Close==null)){var v=o,S=o+n+e;if(S>h)break;var T=v+(S-v)/2,I=this.GetYFromData(D.Low,!1),F=this.GetYFromData(D.High,!1);this.DrawKRange.End=f,(l.Value==null||l.Value<D.High)&&(l.X=T,l.Y=F,l.Value=D.High,l.Align=C<t/2?"left":"right"),(u.Value==null||u.Value>D.Low)&&(u.X=T,u.Y=I,u.Value=D.Low,u.Align=C<t/2?"left":"right"),D.YClose<D.Close?(this.Canvas.strokeStyle=this.UpColor,this.Canvas.fillStyle=this.UpColor):D.YClose>D.Close&&(this.Canvas.strokeStyle=this.DownColor,this.Canvas.fillStyle=this.DownColor),n>=4?r?this.Canvas.fillRect(B(I),B(v),B(Math.abs(I-F)),B(n+e)):this.Canvas.fillRect(B(v),B(F),B(n+e),B(Math.abs(I-F))):(this.Canvas.beginPath(),r?(this.Canvas.moveTo(F,L(T)),this.Canvas.lineTo(I,L(T))):(this.Canvas.moveTo(L(T),F),this.Canvas.lineTo(L(T),I)),this.Canvas.stroke())}}this.PtMax=l,this.PtMin=u},this.DrawTrade=function(){if(this.TradeData){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetLeft()+e/2+2,a=this.ChartBorder.GetRight(),s=this.ChartFrame.XPointCount;r&&(t=this.ChartBorder.GetTop()+e/2+2,a=this.ChartBorder.GetBottom());var o=this.TradeData.Sell,h=this.TradeData.Buy,l=n;l>10&&(l=10);for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<s;++u,++f,t+=n+e){var C=this.Data.Data[u];if(!(C.Open==null||C.High==null||C.Low==null||C.Close==null)){var D=!1,v=!1;if(o&&u<o.length&&(v=o[u]>0),h&&u<h.length&&(D=h[u]>0),!(!v&&!D)){var S=t,T=t+n;if(T>a)break;var I=S+(T-S)/2,F=this.GetYFromData(C.Low,!1),E=this.GetYFromData(C.High,!1);this.GetYFromData(C.Open,!1),this.GetYFromData(C.Close,!1),D&&(this.Canvas.fillStyle=this.UpColor,this.Canvas.strokeStyle=this.UnchagneColor,this.Canvas.beginPath(),r?(this.Canvas.moveTo(F-1,I),this.Canvas.lineTo(F-l-1,I-l/2),this.Canvas.lineTo(F-l-1,I+l/2)):(this.Canvas.moveTo(I,F+1),this.Canvas.lineTo(I-l/2,F+l+1),this.Canvas.lineTo(I+l/2,F+l+1)),this.Canvas.closePath(),this.Canvas.fill(),this.Canvas.stroke()),v&&(this.Canvas.fillStyle=this.DownColor,this.Canvas.strokeStyle=this.UnchagneColor,this.Canvas.beginPath(),r?(this.Canvas.moveTo(E+1,I),this.Canvas.lineTo(E+l+1,I-l/2),this.Canvas.lineTo(E+l+1,I+l/2)):(this.Canvas.moveTo(I,E-1),this.Canvas.lineTo(I-l/2,E-l-1),this.Canvas.lineTo(I+l/2,E-l-1)),this.Canvas.closePath(),this.Canvas.fill(),this.Canvas.stroke())}}}}},this.DrawTick=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetLeft()+e/2+2;r&&(t=this.ChartBorder.GetTop()+e/2+2);var a=this.ChartBorder.GetRight();r&&(a=this.ChartBorder.GetBottom());var s=this.ChartFrame.XPointCount,o=parseInt(n);o<=1?o=2:o>=18&&(o=18);var h=V(),l=o*h;this.Canvas.beginPath(),this.Canvas.font=o*h+"px "+this.TickFontName,this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=s,this.DrawKRange.Start=this.Data.DataOffset;for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<s;++u,++f,t+=n+e){var C=this.Data.Data[u];if(this.ShowRange.End=u,!(C.Open==null||C.High==null||C.Low==null||C.Close==null)){var D=t,v=t+n;if(v>a)break;var S=D+(v-D)/2,T=this.ChartFrame.GetYFromData(C.Close,!1);if(this.DrawKRange.End=u,C.Flag===0?this.Canvas.fillStyle=this.UpColor:C.Flag==1?this.Canvas.fillStyle=this.DownColor:this.Canvas.fillStyle=this.UnchagneColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",r?this.Canvas.fillText(this.TickSymbol,T,S):this.Canvas.fillText(this.TickSymbol,S,T),this.IsShowKTooltip&&!r){var I=new Sa(S-l/2,T-l/2,l,l);this.TooltipRect.push([u,I])}}}},this.DrawHLCArea=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount;if(r)var a=this.ChartBorder.GetHScreenBorder(),s=a.TopEx+e/2+m.FrameLeftMargin,o=a.BottomEx,h=a.TopEx;else var a=this.ChartBorder.GetBorder(),s=a.LeftEx+e/2+m.FrameLeftMargin,o=a.RightEx,h=a.LeftEx;var l=new Path2D,u=new Path2D,f=new Path2D,C=new Path2D,D=new Path2D,v=[],S=!0;if(this.Data.DataOffset>0){var T=this.Data.Data[this.Data.DataOffset-1];if(T&&c.IsNumber(T.Close)&&c.IsNumber(T.High)&&c.IsNumber(T.Low)){var I=h,F=this.GetYFromData(T.Close,!1),E=this.GetYFromData(T.High,!1),M=this.GetYFromData(T.Low,!1);r?(f.moveTo(F,I),u.moveTo(E,I),l.moveTo(M,I),C.moveTo(E,I),D.moveTo(M,I),v.push({X:F,Y:I})):(f.moveTo(I,F),u.moveTo(I,E),l.moveTo(I,M),C.moveTo(I,E),D.moveTo(I,M),v.push({X:I,Y:F})),S=!1}}this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset;for(var O=this.Data.DataOffset,R=0;O<this.Data.Data.length&&R<t;++O,++R,s+=n+e,++this.ShowRange.DataCount){var T=this.Data.Data[O];if(this.ShowRange.End=O,!(!T||!c.IsNumber(T.Close)||!c.IsNumber(T.High)||!c.IsNumber(T.Low))){var b=s,p=s+n;if(p>o)break;var I=b+(p-b)/2,F=this.GetYFromData(T.Close,!1),E=this.GetYFromData(T.High,!1),M=this.GetYFromData(T.Low,!1);this.DrawKRange.End=O,S?(r?(f.moveTo(F,I),u.moveTo(E,I),l.moveTo(M,I),C.moveTo(E,I),D.moveTo(M,I)):(f.moveTo(I,F),u.moveTo(I,E),l.moveTo(I,M),C.moveTo(I,E),D.moveTo(I,M)),S=!1):r?(f.lineTo(F,I),u.lineTo(E,I),l.lineTo(M,I),C.lineTo(E,I),D.lineTo(M,I)):(f.lineTo(I,F),u.lineTo(I,E),l.lineTo(I,M),C.lineTo(I,E),D.lineTo(I,M)),r?v.push({X:F,Y:I}):v.push({X:I,Y:F})}}if(!S){for(var O=v.length-1;O>=0;--O){var G=v[O];C.lineTo(G.X,G.Y),D.lineTo(G.X,G.Y)}C.closePath(),D.closePath(),this.Canvas.fillStyle=this.HLCAreaConfig.UpAreaColor,this.Canvas.fill(C),this.Canvas.fillStyle=this.HLCAreaConfig.DownAreaColor,this.Canvas.fill(D),c.IsNumber(this.HLCAreaConfig.LineWidth)&&(this.Canvas.lineWidth=this.HLCAreaConfig.LineWidth),this.Canvas.strokeStyle=this.HLCAreaConfig.CloseLineColor,this.Canvas.stroke(f),this.Canvas.strokeStyle=this.HLCAreaConfig.HighLineColor,this.Canvas.stroke(u),this.Canvas.strokeStyle=this.HLCAreaConfig.LowLineColor,this.Canvas.stroke(l)}},this.ClipTickClient=function(r){var n=this.GetBorder();if(r==!0)var e=this.ChartBorder.GetLeftEx(),t=this.ChartBorder.GetRightEx(),a=this.ChartBorder.GetTop(),s=this.ChartBorder.GetBottom();else var e=n.Left,t=n.Right,a=n.TopTitle,s=n.Bottom;this.Canvas.beginPath(),this.Canvas.rect(e,a,t-e,s-a),this.Canvas.clip()},this.ClipWindow=function(r){if(r==!0)var n=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRightEx(),t=this.ChartBorder.GetTop(),a=this.ChartBorder.GetBottom();else var n=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRight(),t=this.ChartBorder.GetTopEx(),a=this.ChartBorder.GetBottom();this.Canvas.beginPath(),this.Canvas.rect(n,t,e-n,a-t),this.Canvas.clip()},this.ClipClient=function(r){if(r==!0)var n=this.ChartBorder.GetLeftEx(),e=this.ChartBorder.GetRightEx(),t=this.ChartBorder.GetTop(),a=this.ChartBorder.GetBottom();else{var n=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRight(),t=this.ChartBorder.GetTopEx(),a=this.ChartBorder.GetBottomEx();this.ChartBorder.BottomSpace>0&&(a+=1)}this.Canvas.beginPath(),this.Canvas.rect(n,t,e-n,a-t),this.Canvas.clip()},this.Draw=function(){if(this.IsShowOrderText=!1,this.TooltipRect=[],this.InfoTooltipRect=[],this.TradeIconTooltipRect=[],this.PtMax={X:null,Y:null,Value:null,Align:"left"},this.PtMin={X:null,Y:null,Value:null,Align:"left"},this.DrawKRange={Start:null,End:null},this.ChartFrame.ChartKLine={Max:null,Min:null},this.DrawHeatMap(),!!this.IsShow&&!(this.ChartFrame.IsMinSize&&this.Name=="Self Kline")){if(k.IsTickPeriod(this.Period)){this.Canvas.save(),this.DrawType==1?(this.ClipClient(this.ChartFrame.IsHScreen),this.DrawCloseLine()):this.DrawType==4?(this.ClipClient(this.ChartFrame.IsHScreen),this.DrawCloseArea()):(this.ClipTickClient(this.ChartFrame.IsHScreen),this.DrawTick()),this.Canvas.restore();return}if(this.Canvas.save(),this.ClipClient(this.ChartFrame.IsHScreen),this.DrawType==1){this.DrawCloseLine(),this.Canvas.restore();return}else this.DrawType==2?this.DrawAKLine():this.DrawType==4?this.DrawCloseArea():this.DrawType==5?this.DrawOrderFlow():this.DrawType==7?this.DrawOrderFlow_Style2():this.DrawType==8?this.DrawOrderFlow_Style3():this.DrawType==9?this.DrawKBar():this.DrawType==10?this.DrawRenkoCandle():this.DrawType==12?this.DrawLineBreak():this.DrawType==13?this.DrawHighLow():this.DrawType==14?this.FFKChart&&this.FFKChart.Draw&&this.FFKChart.Draw(this):this.DrawType==15?this.DrawHLCArea():this.DrawKBar();this.TradeIcon?this.DrawTradeIcon():this.DrawTrade(),this.Canvas.restore(),this.IsShowMaxMinPrice&&(this.ChartFrame.IsHScreen===!0?this.HScreenDrawMaxMinPrice(this.PtMax,this.PtMin):this.DrawMaxMinPrice(this.PtMax,this.PtMin))}},this.DrawMaxMinPrice=function(r,n){if(!(r.X==null||r.Y==null||r.Value==null)&&!(n.X==null||n.Y==null||n.Value==null)){var e=m.KLine.MaxMin.LeftArrow,t=m.KLine.MaxMin.RightArrow,a=m.KLine.MaxMin.HighYOffset,s=m.KLine.MaxMin.LowYOffset,o=fe(this.Symbol);this.Canvas.font=this.TextFont,this.Canvas.fillStyle=this.TextColor;var h=this.ChartBorder.GetTopEx(),l=this.ChartBorder.GetBottomEx(),u=r;this.ChartFrame.CoordinateType==1?(r.Y<n.Y&&(u=n),this.Canvas.textBaseline="top"):(r.Y>n.Y&&(u=n),this.Canvas.textBaseline="bottom"),this.Canvas.textAlign=u.Align;var C=(u.Align=="left",u.X);c.IsNumber(a)&&(u.Y+=a);var D=u.Value.toFixed(o);u.Align=="left"?D=e+D:D=D+t,u.Y>h-2&&(this.Canvas.fillText(D,C,u.Y),this.ChartFrame.ChartKLine.Max={X:C,Y:u.Y,Text:{BaseLine:"bottom"}});var f=n;this.ChartFrame.CoordinateType==1?(n.Y>r.Y&&(f=r),this.Canvas.textBaseline="bottom"):(r.Y>n.Y&&(u=n),this.Canvas.textBaseline="top"),this.Canvas.textAlign=f.Align;var C=(f.Align=="left",f.X);c.IsNumber(s)&&(f.Y+=s);var D=n.Value.toFixed(o);f.Align=="left"?D=e+D:D=D+t,f.Y<l+1&&(this.Canvas.fillText(D,C,f.Y),this.ChartFrame.ChartKLine.Min={X:C,Y:f.Y,Text:{BaseLine:"top"}})}},this.HScreenDrawMaxMinPrice=function(r,n){if(!(r.X==null||r.Y==null||r.Value==null)&&!(n.X==null||n.Y==null||n.Value==null)){var e=m.KLine.MaxMin.LeftArrow,t=m.KLine.MaxMin.RightArrow,a=m.KLine.MaxMin.HighYOffset,s=m.KLine.MaxMin.LowYOffset,o=fe(this.Symbol),h=r.Y,l=r.X;c.IsNumber(a)&&(h+=a),this.Canvas.save(),this.Canvas.translate(h,l),this.Canvas.rotate(90*Math.PI/180),this.Canvas.font=this.TextFont,this.Canvas.fillStyle=this.TextColor,this.Canvas.textAlign=r.Align,this.Canvas.textBaseline="bottom";var u=r.Value.toFixed(o);r.Align=="left"?u=e+u:u=u+t,this.Canvas.fillText(u,0,0),this.Canvas.restore();var h=n.Y,l=n.X;c.IsNumber(s)&&(h+=s),this.Canvas.save(),this.Canvas.translate(h,l),this.Canvas.rotate(90*Math.PI/180),this.Canvas.font=this.TextFont,this.Canvas.fillStyle=this.TextColor,this.Canvas.textAlign=n.Align,this.Canvas.textBaseline="top";var u=n.Value.toFixed(o);n.Align=="left"?u=e+u:u=u+t,this.Canvas.fillText(u,0,0),this.Canvas.restore()}},this.DrawInfo=function(r){if(!(!this.InfoData||this.InfoData.size<=0)){var n=this.ChartFrame.IsHScreen===!0,e=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetBottom(),s=this.ChartBorder.GetTop(),o=""+r.DayData.Date;if(this.Data.DataType==1&&(o=r.DayData.Date+"-"+r.DayData.Time),!!this.InfoData.has(o)){var h=this.InfoData.get(o);if(!(!h||h.Data.length<=0)){this.Canvas.restore(),this.Canvas.save(),this.ClipWindow(n);var l=V(),u=e+t,f=18*l,C=!0;u<=15&&(C=!1),u<f&&(u=f);var D="",v=new Dt.default,S=r.YMax+1*l,T=r.YMin+1*l+u,I=!0,F=0;for(var E in h.Data){var M=h.Data[E],O=v.get(M.InfoType);if(O)O.Data.push(M);else{var R=La.GetIconFont(M.InfoType);if(this.Canvas.fillStyle=R.Color,this.Canvas.font=u+"px "+R.Family,n){this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.fillText(R.HScreenText,S,r.XCenter,u);var b=new Sa(r.XCenter-u/2,S-u,u,u),p={Data:new Array(M),Rect:b,Type:M.InfoType,TextRect:{X:S,Y:r.XCenter}};v.set(M.InfoType,p),S+=u}else if(this.Canvas.textBaseline="bottom",this.Canvas.textAlign="center",this.InfoPosition===1){var G=a+F;this.Canvas.fillText(R.Text,r.XCenter,G,u);var b=new Sa(r.XCenter-u/2,G-u,u,u),p={Data:new Array(M),Rect:b,Type:M.InfoType,TextRect:{X:r.XCenter,Y:G}};v.set(M.InfoType,p),F-=u}else if(I){this.Canvas.fillText(R.Text,r.XCenter,S,u);var b=new Sa(r.XCenter-u/2,S-u,u,u),p={Data:new Array(M),Rect:b,Type:M.InfoType,TextRect:{X:r.XCenter,Y:S}};v.set(M.InfoType,p),S-=u,S-u<s&&(I=!1)}else{this.Canvas.fillText(R.Text,r.XCenter,T,u);var b=new Sa(r.XCenter-u/2,T-u,u,u),p={Data:new Array(M),Rect:b,Type:M.InfoType,TextRect:{X:r.XCenter,Y:T}};v.set(M.InfoType,p),T+=u}}}var Y;m.KLine.NumIcon&&(n?Y=m.KLine.NumIcon.HScreenText:Y=m.KLine.NumIcon.Text);var Q=!0,ht=!1,Ct=void 0;try{for(var lt=(0,we.default)(v),dt;!(Q=(dt=lt.next()).done);Q=!0){var r=dt.value,Ut=r[1];if(Ut.Data.length>=2&&Y&&C){var Wt=Ut.Data.length;Wt>=Y.length&&(Wt=0),this.Canvas.fillStyle=m.KLine.NumIcon.Color;var D=Y[Wt];this.Canvas.fillText(D,Ut.TextRect.X,Ut.TextRect.Y,u)}n||this.InfoTooltipRect.push(Ut)}}catch(Qt){ht=!0,Ct=Qt}finally{try{!Q&&lt.return&&lt.return()}finally{if(ht)throw Ct}}this.Canvas.restore(),this.Canvas.save(),this.ClipClient(n)}}}},this.DrawTradeIcon=function(){if(this.TradeData){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetLeft()+e/2+2,a=this.ChartBorder.GetRight(),s=this.ChartFrame.XPointCount;r&&(t=this.ChartBorder.GetTop()+e/2+2,a=this.ChartBorder.GetBottom());var o=this.TradeData.Sell,h=this.TradeData.Buy,l=n+e,u=V(),f=24*u,C=12*u;l<C?l=C:l>f&&(l=f),this.Canvas.font=l+"px "+this.TradeIcon.Family;for(var D=this.Data.DataOffset,v=0;D<this.Data.Data.length&&v<s;++D,++v,t+=n+e){var S=this.Data.Data[D];if(!(S.Open==null||S.High==null||S.Low==null||S.Close==null)){var T=!1,I=!1;if(o&&D<o.length&&(I=o[D]>0),h&&D<h.length&&(T=h[D]>0),!(!I&&!T)){var F=t,E=t+n;if(E>a)break;var M=F+(E-F)/2,O=this.GetYFromData(S.Low,!1),R=this.GetYFromData(S.High,!1);if(this.GetYFromData(S.Open,!1),this.GetYFromData(S.Close,!1),T)if(this.Canvas.fillStyle=this.TradeIcon.Buy.Color,r)this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.TradeIcon.Buy.HScreenText,O,M);else{this.Canvas.textAlign="center",this.Canvas.textBaseline="top",this.Canvas.fillText(this.TradeIcon.Buy.Text,M,O);var b=new Sa(M-l/2,O,l,l),p={Data:{Type:1,KData:S,Name:this.TradeData.Name,Param:this.TradeData.Param},Rect:b,TextRect:{X:M,Y:O}};this.TradeIconTooltipRect.push(p)}if(I)if(this.Canvas.fillStyle=this.TradeIcon.Sell.Color,r)this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.TradeIcon.Sell.HScreenText,R,M);else{this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.Canvas.fillText(this.TradeIcon.Sell.Text,M,R);var b=new Sa(M-l/2,R-l,l,l),p={Data:{Type:2,KData:S,Name:this.TradeData.Name,Param:this.TradeData.Param},Rect:b,TextRect:{X:M,Y:R}};this.TradeIconTooltipRect.push(p)}}}}}},this.GetTooltipData=function(r,n,e){if(!this.IsShow)return!1;for(var t in this.TradeIconTooltipRect){var a=this.TradeIconTooltipRect[t];if(a.Rect){var s=a.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(s.X,s.Y,s.Width,s.Height),this.Canvas.isPointInPath(r,n))return X.Chart.Log("[ChartKLine::GetTooltipData] trade icon ",a),e.Data=a,e.ChartPaint=this,e.Type=2,!0}}for(var t in this.InfoTooltipRect){var a=this.InfoTooltipRect[t];if(a.Rect){var s=a.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(s.X,s.Y,s.Width,s.Height),this.Canvas.isPointInPath(r,n))return e.Data=a,e.ChartPaint=this,e.Type=1,!0}}for(var t in this.TooltipRect){var s=this.TooltipRect[t][1];if(this.Canvas.beginPath(),this.Canvas.rect(s.X,s.Y,s.Width,s.Height),this.Canvas.isPointInPath(r,n)){var o=this.TooltipRect[t][0];return e.Data=this.Data.Data[o],e.ChartPaint=this,e.Type=0,!0}}return!1},this.GetMaxMin=function(){if(this.DrawType==14&&this.FFKChart&&this.FFKChart.GetMaxMin)return this.FFKChart.GetMaxMin(this);var r=this.ChartFrame.XPointCount,n={};if(n.Max=null,n.Min=null,this.DrawType==1||this.DrawType==4)for(var e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];c.IsNumber(a.Close)&&(n.Max==null&&(n.Max=a.Close),n.Min==null&&(n.Min=a.Close),n.Max<a.Close&&(n.Max=a.Close),n.Min>a.Close&&(n.Min=a.Close))}else for(var e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];if(!(a.Open==null||a.High==null||a.Low==null||a.Close==null))if(this.DrawType==5&&a.OrderFlow&&c.IsNumber(a.OrderFlow.PriceOffset)){var s=a.High,o=a.Low;if(c.IsNonEmptyArray(a.OrderFlow.High))for(var h=0;h<a.OrderFlow.High.length;++h){var l=a.OrderFlow.High[h];s<l.Price&&(s=l.Price)}if(c.IsNonEmptyArray(a.OrderFlow.Low))for(var h=0;h<a.OrderFlow.Low.length;++h){var l=a.OrderFlow.Low[h];o>l.Price&&(o=l.Price)}s+=a.OrderFlow.PriceOffset,o-=a.OrderFlow.PriceOffset,n.Max==null&&(n.Max=s),n.Min==null&&(n.Min=o),n.Max<s&&(n.Max=s),n.Min>o&&(n.Min=o)}else n.Max==null&&(n.Max=a.High),n.Min==null&&(n.Min=a.Low),n.Max<a.High&&(n.Max=a.High),n.Min>a.Low&&(n.Min=a.Low)}return n},this.GetAllPrice=function(){for(var r=this.ChartFrame.XPointCount,n=new Ee.default,e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];if(!(a.Open==null||a.High==null||a.Low==null||a.Close==null)){var s=a.Close;n.add(s)}}var o=[],h=!0,l=!1,u=void 0;try{for(var f=(0,we.default)(n),C;!(h=(C=f.next()).done);h=!0){var D=C.value;o.push(D)}}catch(v){l=!0,u=v}finally{try{!h&&f.return&&f.return()}finally{if(l)throw u}}return o.sort(function(v,S){return v-S}),o},this.DrawLastPointEvent=function(r){if(this.GetEventCallback){var n=this.GetEventCallback(et.ON_DRAW_KLINE_LAST_POINT);if(n){var e={Data:this.ChartFrame.DataWidth,Distance:this.ChartFrame.DistanceWidth};if(r)var t={LastPoint:{X:r.X,Y:r.Y,XLeft:r.XLeft,XRight:r.XRight},KItem:r.KItem,DrawType:this.DrawType,KWidth:e,ChartRight:r.ChartRight};else var t={LastPoint:null,KItem:null,KWidth:e};n.Callback(n,t,this)}}},this.DrawOrderFlow=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetBorder(),a=t.LeftEx+e/2+m.FrameLeftMargin,s=t.RightEx,o=this.ChartFrame.XPointCount;if(r){var t=this.ChartBorder.GetHScreenBorder();a=t.TopEx+e/2+m.FrameLeftMargin,s=t.BottomEx}this.UpColor,this.DownColor,this.UnchagneColor,this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.DrawKRange.Start=this.Data.DataOffset,this.DrawOrderFlowHBar();for(var h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<o;++h,++l,a+=n+e,++this.ShowRange.DataCount){var u=this.Data.Data[h];if(this.ShowRange.End=h,!(u.Open==null||u.High==null||u.Low==null||u.Close==null)){var f=a,C=a+n;if(C>s)break;var D=f+(C-f)/2,v=this.GetYFromData(u.Low,!1),S=this.GetYFromData(u.High,!1),T=this.GetYFromData(u.Open,!1),I=this.GetYFromData(u.Close,!1);this.DrawKRange.End=h;var F={Low:v,High:S,Open:T,Close:I},E={Left:f,Center:D,Right:C,DataWidth:n};if(this.DrawOrderFlowBar(u.OrderFlow,u,E,F,r),this.IsShowKTooltip&&!r){var M=Math.min(T,I),O=Math.max(T,I);Math.abs(T-I)<5&&(M=Math.min(S,M-5),O=Math.max(v,O+5));var R=new Sa(f,M,n,O-M);this.TooltipRect.push([h,R])}if(this.Data.DataType==0){var b={Xleft:f,XRight:C,XCenter:D,YMax:S,YMin:v,DayData:u,Index:l};this.DrawInfo(b)}h==this.Data.Data.length-1}}},this.DrawOrderFlowBar=function(r,n,e,t,a){var s=Math.min(t.Open,t.Close),o=Math.max(t.Open,t.Close),h=Math.abs(t.Open-t.Close),l=0;r&&c.IsNumber(r.PriceOffset)&&(l=this.GetPriceYOffset(r.PriceOffset));var Y=this.GetDynamicOrderFlowFont(l,e.DataWidth/2);this.IsShowOrderText=l>5&&e.DataWidth>10,this.OrderFlow.AlwaysShowOrderText&&(this.IsShowOrderText=!0);var u;n.Open<n.Close?u=this.OrderFlow.UpColor:n.Open>n.Close?u=this.OrderFlow.DownColor:u=this.OrderFlow.UnchagneColor;var f=e.DataWidth<4;f?(this.Canvas.strokeStyle=u.Border,this.Canvas.beginPath(),this.Canvas.moveTo(L(e.Center),s-l/2),this.Canvas.lineTo(L(e.Center),o+l/2),this.Canvas.stroke()):(this.Canvas.fillStyle=u.BG,this.Canvas.fillRect(B(e.Left),B(s-l/2),B(e.DataWidth),B(h+l))),this.Canvas.textBaseline="middle",this.Canvas.textAlign="center",this.Canvas.font=Y;var C=e.DataWidth/2,D=C/2;if(r&&c.IsNonEmptyArray(r.Order)){var v=0,S=0,T=null;if(this.OrderFlow.IsShowAskBar||this.OrderFlow.IsShowBidBar||this.OrderFlow.IsShowPOCBG)for(var I=0,F=0,E=0;E<r.Order.length;++E){var M=r.Order[E];F=0,M.Ask&&c.IsNumber(M.Ask.Value)&&(v+=M.Ask.Value,F+=M.Ask.Value),M.Bid&&c.IsNumber(M.Bid.Value)&&(S+=M.Bid.Value,F+=M.Bid.Value),I<F&&(I=F,T=E)}for(var E=0;E<r.Order.length;++E){var M=r.Order[E],O=this.GetYFromData(M.Price,!1),p={Left:e.Left,Right:e.Center,Bottom:O+l/2,Top:O-l/2};if(p.Width=p.Right-p.Left,p.Height=p.Bottom-p.Top,M.Ask.BG&&(this.Canvas.fillStyle=M.Ask.BG,this.Canvas.fillRect(B(p.Left),B(p.Top),B(p.Width),B(p.Height))),this.OrderFlow.IsShowPOCBG&&T==E&&(this.Canvas.fillStyle=this.OrderFlow.POCGBColor,this.Canvas.fillRect(B(p.Left),B(p.Top),B(p.Width),B(p.Height))),this.OrderFlow.IsShowAskBar&&c.IsNumber(M.Ask.Value)&&v>0){var R=p.Width*(M.Ask.Value/v);R<1&&(R=1),this.Canvas.fillStyle=this.OrderFlow.AskBarColor,this.Canvas.fillRect(B(p.Right),B(p.Top),B(-R),B(p.Height))}var G=null;if(c.IsString(M.Ask.Text)?G=M.Ask.Text:c.IsNumber(M.Ask.Value)&&(G=M.Ask.Value.toString()),G&&this.IsShowOrderText&&this.OrderFlow.IsShowAskText)if(M.Ask.Color?this.Canvas.fillStyle=M.Ask.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color,M.Ask.Font){var b=this.GetDynamicOrderFlowFont(l,e.DataWidth/2,M.Ask.Font);this.Canvas.font=b,this.Canvas.fillText(G,e.Left+D,O),this.Canvas.font=Y}else this.Canvas.fillText(G,e.Left+D,O);var p={Left:e.Center,Right:e.Right,Bottom:O+l/2,Top:O-l/2};if(p.Width=p.Right-p.Left,p.Height=p.Bottom-p.Top,M.Bid.BG&&(this.Canvas.fillStyle=M.Bid.BG,this.Canvas.fillRect(B(p.Left),B(p.Top),B(p.Width),B(p.Height))),this.OrderFlow.IsShowPOCBG&&T==E&&(this.Canvas.fillStyle=this.OrderFlow.POCGBColor,this.Canvas.fillRect(B(p.Left),B(p.Top),B(p.Width),B(p.Height))),this.OrderFlow.IsShowBidBar&&c.IsNumber(M.Bid.Value)&&S>0){var R=p.Width*(M.Bid.Value/S);R<1&&(R=1),this.Canvas.fillStyle=this.OrderFlow.BidBarColor,this.Canvas.fillRect(B(p.Left),B(p.Top),B(R),B(p.Height))}var G=null;if(c.IsString(M.Bid.Text)?G=M.Bid.Text:c.IsNumber(M.Bid.Value)&&(G=M.Bid.Value.toString()),G&&this.IsShowOrderText&&this.OrderFlow.IsShowBidText)if(M.Bid.Color?this.Canvas.fillStyle=M.Bid.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color,M.Bid.Font){var b=this.GetDynamicOrderFlowFont(l,e.DataWidth/2,M.Bid.Font);this.Canvas.font=b,this.Canvas.fillText(G,e.Center+D,O),this.Canvas.font=Y}else this.Canvas.fillText(G,e.Center+D,O)}}(t.High<s||t.Low>o)&&(this.Canvas.strokeStyle=this.OrderFlow.Line.UpDownColor,t.High<s&&(this.Canvas.beginPath(),this.Canvas.moveTo(L(e.Center),t.High-l/2),this.Canvas.lineTo(L(e.Center),s-l/2),this.Canvas.stroke()),t.Low>o&&(this.Canvas.beginPath(),this.Canvas.moveTo(L(e.Center),t.Low+l/2),this.Canvas.lineTo(L(e.Center),o+l/2),this.Canvas.stroke())),!f&&Math.abs(t.Open-t.Close)>1&&(this.Canvas.strokeStyle=this.OrderFlow.Line.MiddleColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(e.Center),s-l/2),this.Canvas.lineTo(L(e.Center),o+l/2),this.Canvas.stroke()),f||(this.Canvas.beginPath(),this.Canvas.strokeStyle=u.Border,this.Canvas.rect(L(e.Left),L(s-l/2),B(e.DataWidth),B(h+l)),this.Canvas.stroke());var Y=this.GetDynamicOrderFlowFont(l,e.DataWidth);if(r&&c.IsNonEmptyArray(r.High)&&this.IsShowOrderText)for(var E=0;E<r.High.length;++E){var M=r.High[E],G;if(c.IsString(M.Text)?G=M.Text:c.IsNumber(M.Value)&&(G=M.Value.toString()),!!G){M.Color?this.Canvas.fillStyle=M.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color;var O=this.GetYFromData(M.Price,!1);if(M.Font){var b=this.GetDynamicOrderFlowFont(l,e.DataWidth,M.Font);this.Canvas.font=b,this.Canvas.fillText(G,e.Center,O),this.Canvas.font=Y}else this.Canvas.fillText(G,e.Center,O)}}if(r&&c.IsNonEmptyArray(r.Low)&&this.IsShowOrderText)for(var E=0;E<r.Low.length;++E){var M=r.Low[E],G;if(c.IsString(M.Text)?G=M.Text:c.IsNumber(M.Value)&&(G=M.Value.toString()),!!G){M.Color?this.Canvas.fillStyle=M.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color;var O=this.GetYFromData(M.Price,!1);if(M.Font){var b=this.GetDynamicOrderFlowFont(l,e.DataWidth,M.Font);this.Canvas.font=b,this.Canvas.fillText(G,e.Center,O),this.Canvas.font=Y}else this.Canvas.fillText(G,e.Center,O)}}},this.GetPriceYOffset=function(r){var n=this.ChartFrame,e=n.ChartBorder.GetHeightEx()*r/(n.HorizontalMax-n.HorizontalMin);return e},this.GetDynamicOrderFlowFont=function(r,n,e){var t=parseInt(r)-2;r<5&&(t=parseInt(r)),t>this.OrderFlow.Text.FontMaxSize?t=this.OrderFlow.Text.FontMaxSize:t<=0&&(t=1);for(var a=this.FormatFontString(t,this.OrderFlow.Text.Family,e),s=t;s>0;s-=2){var a=this.FormatFontString(s,this.OrderFlow.Text.Family,e);this.Canvas.font=a;var o=this.Canvas.measureText(this.OrderFlow.Text.MaxValue).width+2;if(o<n)break}return a},this.FormatFontString=function(r,n,e){var t;return e?e.Weight&&(t=e.Weight+" "+r+"px "+n):t=r+"px "+n,t},this.DrawOrderFlowHBar=function(){for(var r=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,e=this.ChartFrame.XPointCount,t=this.ChartFrame.HorizontalMax,a=this.ChartFrame.HorizontalMin,s=this.Data.DataOffset,o=this.Data.DataOffset+e,h=0;h<this.Data.Data.length;++h){var l=this.Data.Data[h];if(!(!l||!l.OrderFlow)&&c.IsNonEmptyArray(l.OrderFlow.Order))for(var u=0;u<l.OrderFlow.Order.length;++u){var f=l.OrderFlow.Order[u];if(f.HBar&&c.IsNumber(f.HBar.Width)&&c.IsNumber(f.Price)&&!(f.Price>t||f.Price<a)){var C=Math.ceil(h+f.HBar.Width),D=Math.min(h,C),v=Math.max(h,C);v<s||D>o||this.DrawOrderFlowHBarItem(h,l.OrderFlow,f,r,n)}}}},this.DrawOrderFlowHBarItem=function(r,n,e,t,a){var s=this.ShowRange.Start;this.ShowRange.Start+this.ShowRange.ShowCount;var o=this.GetYFromData(e.Price,!1),h=parseInt(r+e.HBar.Width),l=r-s,u=h-s;if(l<0&&(l=0),u<0&&(u=0),l<=u){this.ChartBorder.GetRight(),this.ChartFrame.XPointCount;var f=s,C=this.GetPriceYOffset(n.PriceOffset),D=this.ChartFrame.GetXFromIndex(l)-t/2;if(e.HBar.Type==1)for(var v=0,S=r+1;v<e.HBar.Width&&S<this.Data.Data.length;++v,++S){var T=this.Data.Data[S];if(T.Close<e.Price){u=S-1-f;break}}else if(e.HBar.Type==2)for(var v=0,S=r+1;v<e.HBar.Width&&S<this.Data.Data.length;++v,++S){var T=this.Data.Data[S];if(T.Close>e.Price){u=S-1-f;break}}if(u<0)return;var I=this.ChartFrame.GetXFromIndex(u)+t/2,F=o-C/2,E=C+.5;c.IsNumber(e.HBar.Height)&&(E=e.HBar.Height*C+.1);var M=e.HBar.Width-parseInt(e.HBar.Width);M>1e-6&&(I+=(t+a)*M),this.Canvas.fillStyle=e.HBar.Color,this.Canvas.fillRect(B(D),B(F),B(I-D),B(E))}},this.PtInChart=function(r,n){return this.DrawType==1||this.DrawType==4?this.PtInLine(r,n,{KLineClose:!0}):this.PtInKBar(r,n)},this.DrawSelectedStatus=function(){this.DrawLinePoint({KLineClose:!0})},this.DrawOrderFlow_Style2=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetBorder(),a=t.LeftEx+e/2+m.FrameLeftMargin,s=t.RightEx,o=this.ChartFrame.XPointCount;if(this.AryOrderFlowBorder=[],r){var t=this.ChartBorder.GetHScreenBorder();a=t.TopEx+e/2+m.FrameLeftMargin,s=t.BottomEx}var h=this.OrderFlow_Style2.UpColor,l=this.OrderFlow_Style2.DownColor,u=this.OrderFlow_Style2.UnchagneColor,f=B(this.OrderFlow_Style2.BarWidth),C=n-f;C/7<f&&(f=C/7),f<=1&&(f=2),this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.DrawKRange.Start=this.Data.DataOffset,this.DrawOrderFlowHBar();for(var D=this.Data.DataOffset,v=0;D<this.Data.Data.length&&v<o;++D,++v,a+=n+e,++this.ShowRange.DataCount){var S=this.Data.Data[D];if(this.ShowRange.End=D,!(S.Open==null||S.High==null||S.Low==null||S.Close==null)){var T=a,I=a+n;if(I>s)break;var F=T+(I-T)/2,E=this.GetYFromData(S.Low,!1),M=this.GetYFromData(S.High,!1),O=this.GetYFromData(S.Open,!1),R=this.GetYFromData(S.Close,!1);this.DrawKRange.End=D;var b=Math.min(O,R),p=Math.max(O,R),G=B(T),Y=G+f;S.Open<S.Close?this.Canvas.fillStyle=h:S.Open>S.Close?this.Canvas.fillStyle=l:this.Canvas.fillStyle=u;var Q=0;S.OrderFlow&&c.IsNumber(S.OrderFlow.PriceOffset)&&(Q=this.GetPriceYOffset(S.OrderFlow.PriceOffset)),this.Canvas.fillRect(G,B(b-Q/2),f,B(p-b+Q));var ht={Low:E,High:M,Open:O,Close:R},Ct={Left:Y,Center:F,Right:I,DataWidth:I-Y};Ct.Center=Ct.Left+Ct.DataWidth/2,this.DrawOrderFlowBar_Style2(S.OrderFlow,S,Ct,ht,r)}}if(n-f>5)for(var D=0;D<this.AryOrderFlowBorder.length;++D){var lt=this.AryOrderFlowBorder[D];if(!(!lt||!lt.Rect||!lt.Color)){var dt=lt.Rect;this.Canvas.strokeStyle=lt.Color,this.Canvas.beginPath(),this.Canvas.rect(L(dt.Left),L(dt.Top),B(dt.Width),B(dt.Height)),this.Canvas.stroke()}}this.AryOrderFlowBorder=[]},this.DrawOrderFlow_Style3=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetBorder(),a=t.LeftEx+e/2+m.FrameLeftMargin,s=t.RightEx,o=this.ChartFrame.XPointCount;if(this.AryOrderFlowBorder=[],r){var t=this.ChartBorder.GetHScreenBorder();a=t.TopEx+e/2+m.FrameLeftMargin,s=t.BottomEx}var h=this.OrderFlow_Style3.UpColor,l=this.OrderFlow_Style3.DownColor,u=this.OrderFlow_Style3.UnchagneColor,f=B(this.OrderFlow_Style3.BarWidth);n/4<f&&(f=n/4),f<=1&&(f=2),this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.DrawKRange.Start=this.Data.DataOffset,this.DrawOrderFlowHBar();for(var C=this.Data.DataOffset,D=0;C<this.Data.Data.length&&D<o;++C,++D,a+=n+e,++this.ShowRange.DataCount){var v=this.Data.Data[C];if(this.ShowRange.End=C,!(v.Open==null||v.High==null||v.Low==null||v.Close==null)){var S=a,T=a+n;if(T>s)break;var I=this.GetYFromData(v.Low,!1),F=this.GetYFromData(v.High,!1),E=this.GetYFromData(v.Open,!1),M=this.GetYFromData(v.Close,!1);this.DrawKRange.End=C;var O=Math.min(E,M),R=Math.max(E,M),b=B(S),p=b+f;v.Open<v.Close?this.Canvas.fillStyle=h:v.Open>v.Close?this.Canvas.fillStyle=l:this.Canvas.fillStyle=u;var G=0;v.OrderFlow&&c.IsNumber(v.OrderFlow.PriceOffset)&&(G=this.GetPriceYOffset(v.OrderFlow.PriceOffset)),this.Canvas.fillRect(b,B(O-G/2),f,B(R-O+G));var Y={Low:I,High:F,Open:E,Close:M},Q={Left:p,Right:T,DataWidth:T-p};this.DrawOrderFlowBar_Style3(v.OrderFlow,v,Q,Y,r)}}if(n-f>5)for(var C=0;C<this.AryOrderFlowBorder.length;++C){var ht=this.AryOrderFlowBorder[C];if(!(!ht||!ht.Rect||!ht.Color)){var Ct=ht.Rect;this.Canvas.strokeStyle=ht.Color,this.Canvas.beginPath(),this.Canvas.rect(L(Ct.Left),L(Ct.Top),B(Ct.Width),B(Ct.Height)),this.Canvas.stroke()}}this.AryOrderFlowBorder=[]},this.DrawOrderFlowBar_Style2=function(r,n,e,t,a){Math.min(t.Open,t.Close),Math.max(t.Open,t.Close),Math.abs(t.Open-t.Close);var s=0;r&&c.IsNumber(r.PriceOffset)&&(s=this.GetPriceYOffset(r.PriceOffset));var o=this.GetDynamicOrderFlowFont(s,e.DataWidth/2);this.IsShowOrderText=s>5&&e.DataWidth>10,this.OrderFlow.AlwaysShowOrderText&&(this.IsShowOrderText=!0),this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.font=o,e.DataWidth/2;var h=2;if(r&&c.IsNonEmptyArray(r.Order))for(var l=0;l<r.Order.length;++l){var u=r.Order[l],f=this.GetYFromData(u.Price,!1),v={Left:e.Left,Right:e.Center,Bottom:f+s/2,Top:f-s/2};if(v.Width=v.Right-v.Left,v.Height=v.Bottom-v.Top,u.Ask.BG&&(this.Canvas.fillStyle=u.Ask.BG,this.Canvas.fillRect(B(v.Left),B(v.Top),B(v.Width),B(v.Height))),u.Ask.BorderColor){var C={Rect:v,Color:u.Ask.BorderColor};this.AryOrderFlowBorder.push(C)}var S=null;if(c.IsString(u.Ask.Text)?S=u.Ask.Text:c.IsNumber(u.Ask.Value)&&(S=u.Ask.Value.toString()),S&&this.IsShowOrderText)if(u.Ask.Color?this.Canvas.fillStyle=u.Ask.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color,u.Ask.Font){var D=this.GetDynamicOrderFlowFont(s,e.DataWidth/2,u.Ask.Font);this.Canvas.font=D,this.Canvas.fillText(S,e.Left+h,f),this.Canvas.font=o}else this.Canvas.fillText(S,e.Left+h,f);var v={Left:e.Center,Right:e.Right,Bottom:f+s/2,Top:f-s/2};if(v.Width=v.Right-v.Left,v.Height=v.Bottom-v.Top,u.Bid.BG&&(this.Canvas.fillStyle=u.Bid.BG,this.Canvas.fillRect(B(v.Left),B(v.Top),B(v.Width),B(v.Height))),u.Bid.BorderColor){var C={Rect:v,Color:u.Bid.BorderColor};this.AryOrderFlowBorder.push(C)}var S=null;if(c.IsString(u.Bid.Text)?S=u.Bid.Text:c.IsNumber(u.Bid.Value)&&(S=u.Bid.Value.toString()),S&&this.IsShowOrderText)if(u.Bid.Color?this.Canvas.fillStyle=u.Bid.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color,u.Bid.Font){var D=this.GetDynamicOrderFlowFont(s,e.DataWidth/2,u.Bid.Font);this.Canvas.font=D,this.Canvas.fillText(S,e.Center+h,f),this.Canvas.font=o}else this.Canvas.fillText(S,e.Center+h,f)}},this.DrawOrderFlowBar_Style3=function(r,n,e,t,a){Math.min(t.Open,t.Close),Math.max(t.Open,t.Close),Math.abs(t.Open-t.Close);var s=e.DataWidth-4,o=0;r&&c.IsNumber(r.PriceOffset)&&(o=this.GetPriceYOffset(r.PriceOffset));var h=this.GetDynamicOrderFlowFont(o,s);this.IsShowOrderText=o>5&&e.DataWidth>10,this.OrderFlow.AlwaysShowOrderText&&(this.IsShowOrderText=!0),this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.font=h;var l=2;if(r&&c.IsNonEmptyArray(r.Order))for(var u=0;u<r.Order.length;++u){var f=r.Order[u],C=this.GetYFromData(f.Price,!1),D={Left:e.Left,Right:e.Right,Bottom:C+o/2,Top:C-o/2};if(D.Width=D.Right-D.Left,D.Height=D.Bottom-D.Top,f.Item.BG&&(this.Canvas.fillStyle=f.Item.BG,this.Canvas.fillRect(B(D.Left),B(D.Top),B(D.Width),B(D.Height))),f.Item.BorderColor){var v={Rect:D,Color:f.Item.BorderColor};this.AryOrderFlowBorder.push(v)}var S=null;if(c.IsString(f.Item.Text)?S=f.Item.Text:c.IsNumber(f.Item.Value)&&(S=f.Item.Value.toString()),S&&this.IsShowOrderText)if(f.Item.Color?this.Canvas.fillStyle=f.Item.Color:this.Canvas.fillStyle=this.OrderFlow.Text.Color,f.Item.Font){var T=this.GetDynamicOrderFlowFont(o,s,f.Item.Font);this.Canvas.font=T,this.Canvas.fillText(S,e.Left+l,C),this.Canvas.font=h}else this.Canvas.fillText(S,e.Left+l,C)}},this.DrawHighLow=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount;if(r)var a=this.ChartBorder.GetHScreenBorder(),s=a.TopEx+e/2+m.FrameLeftMargin,o=a.BottomEx;else var a=this.ChartBorder.GetBorder(),s=a.LeftEx+e/2+m.FrameLeftMargin,o=a.RightEx;this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=t,this.DrawKRange.Start=this.Data.DataOffset,this.Canvas.fillStyle=this.HighLowBarColor,this.Canvas.strokeStyle=this.HighLowBarColor;for(var h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<t;++h,++l,s+=n+e,++this.ShowRange.DataCount){var u=this.Data.Data[h];if(this.ShowRange.End=h,!(u.Open==null||u.High==null)){var f=s,C=s+n;if(C>o)break;var D=f+(C-f)/2,v=this.GetYFromData(u.Low,!1),S=this.GetYFromData(u.High,!1);this.DrawKRange.End=h;var T=v,I=S-v;if(Math.abs(I)<1&&(I=1),n>=4)r?this.Canvas.fillRect(B(T),B(f),B(I),B(n)):this.Canvas.fillRect(B(f),B(T),B(n),B(I));else{var D=f+(C-f)/2;this.Canvas.beginPath(),r?(this.Canvas.moveTo(L(v),L(D)),this.Canvas.lineTo(L(S),L(D))):(this.Canvas.moveTo(L(D),L(v)),this.Canvas.lineTo(L(D),L(S))),this.Canvas.stroke()}if(this.IsShowKTooltip&&!r){var F=Math.min(v,S),E=Math.max(v,S);Math.abs(F-E)<5&&(F=Math.min(S,F-5),E=Math.max(v,E+5));var M=new Sa(f,F,n,E-F);this.TooltipRect.push([h,M])}}}}}function _u(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartColorKline",this.Symbol,this.Color="rgb(0,255,44)",this.IsEmptyBar=!1,this.DrawType=0,this.KLineColor,this.DrawName,this.Draw=function(){if(this.IsShow)if(this.DrawName=="DRAWCOLORKLINE")this.DrawColorBar();else{if(!this.KLineColor)return;this.DrawBar()}},this.DrawUpBarItem=function(r,n,e,t){var a=this.ChartFrame.IsHScreen===!0,s=n,o=n+e,h=s+(o-s)/2,l=this.ChartFrame.GetYFromData(r.Low),u=this.ChartFrame.GetYFromData(r.High),f=this.ChartFrame.GetYFromData(r.Open),C=this.ChartFrame.GetYFromData(r.Close),D=u;e>=4?(r.High>r.Close&&(this.Canvas.beginPath(),a?(this.Canvas.moveTo(L(D),L(h)),this.Canvas.lineTo(L(this.DrawType==3?Math.max(C,f):C),L(h))):(this.Canvas.moveTo(L(h),L(D)),this.Canvas.lineTo(L(h),L(this.DrawType==3?Math.min(C,f):C))),this.Canvas.stroke()),D=C,a?Math.abs(f-D)<1?this.Canvas.fillRect(B(D),B(s),1,B(e)):this.DrawType==3?(this.Canvas.beginPath(),this.Canvas.rect(L(D),L(s),B(f-D),B(e)),this.Canvas.stroke()):this.Canvas.fillRect(B(D),B(s),B(f-D),B(e)):Math.abs(f-D)<1?this.Canvas.fillRect(B(s),B(D),B(e),1):this.DrawType==3?(this.Canvas.beginPath(),this.Canvas.rect(L(s),L(D),B(e),B(f-D)),this.Canvas.stroke()):this.Canvas.fillRect(B(s),B(Math.min(D,f)),B(e),B(Math.abs(f-D))),r.Open>r.Low&&(this.Canvas.beginPath(),a?(this.Canvas.moveTo(L(this.DrawType==3?Math.min(C,f):D),L(h)),this.Canvas.lineTo(L(l),L(h))):(this.Canvas.moveTo(L(h),L(this.DrawType==3?Math.max(C,f):D)),this.Canvas.lineTo(L(h),L(l))),this.Canvas.stroke())):(this.Canvas.beginPath(),a?(this.Canvas.moveTo(u,L(h)),this.Canvas.lineTo(l,L(h))):(this.Canvas.moveTo(L(h),u),this.Canvas.lineTo(L(h),l)),this.Canvas.stroke())},this.DrawDownBarItem=function(r,n,e,t){var a=this.ChartFrame.IsHScreen===!0,s=n,o=n+e,h=s+(o-s)/2,l=this.ChartFrame.GetYFromData(r.Low),u=this.ChartFrame.GetYFromData(r.High),f=this.ChartFrame.GetYFromData(r.Open),C=this.ChartFrame.GetYFromData(r.Close),D=u;e>=4?(r.High>r.Close&&(this.Canvas.beginPath(),a?(this.Canvas.moveTo(L(D),L(h)),this.Canvas.lineTo(L(f),L(h))):(this.Canvas.moveTo(L(h),L(D)),this.Canvas.lineTo(L(h),L(f))),this.Canvas.stroke()),D=f,a?Math.abs(C-D)<1?this.Canvas.fillRect(B(D),B(s),1,B(e)):this.Canvas.fillRect(B(D),B(s),B(C-D),B(e)):Math.abs(C-D)<1?this.Canvas.fillRect(B(s),B(D),B(e),1):this.Canvas.fillRect(B(s),B(Math.min(D,C)),B(e),B(Math.abs(C-D))),r.Open>r.Low&&(this.Canvas.beginPath(),a?(this.Canvas.moveTo(L(D),L(h)),this.Canvas.lineTo(L(l),L(h))):(this.Canvas.moveTo(L(h),L(D)),this.Canvas.lineTo(L(h),L(l))),this.Canvas.stroke())):(this.Canvas.beginPath(),a?(this.Canvas.moveTo(u,L(h)),this.Canvas.lineTo(l,L(h))):(this.Canvas.moveTo(L(h),u),this.Canvas.lineTo(L(h),l)),this.Canvas.stroke())},this.DrawUnChangeBarItem=function(r,n,e,t){var a=this.ChartFrame.IsHScreen===!0,s=n,o=n+e,h=s+(o-s)/2,l=this.ChartFrame.GetYFromData(r.Low),u=this.ChartFrame.GetYFromData(r.High),f=this.ChartFrame.GetYFromData(r.Open);this.ChartFrame.GetYFromData(r.Close);var C=u;e>=4?(this.Canvas.beginPath(),r.High>r.Close&&(a?(this.Canvas.moveTo(C,L(h)),this.Canvas.lineTo(f,L(h))):(this.Canvas.moveTo(L(h),C),this.Canvas.lineTo(L(h),f))),C=f,a?(this.Canvas.moveTo(L(C),L(s)),this.Canvas.lineTo(L(C),L(o))):(this.Canvas.moveTo(L(s),L(C)),this.Canvas.lineTo(L(o),L(C))),r.Open>r.Low&&(a?(this.Canvas.moveTo(L(C),L(h)),this.Canvas.lineTo(L(l),L(h))):(this.Canvas.moveTo(L(h),L(C)),this.Canvas.lineTo(L(h),L(l)))),this.Canvas.stroke()):(this.Canvas.beginPath(),a?(this.Canvas.moveTo(u,L(h)),this.Canvas.lineTo(l,L(h))):(this.Canvas.moveTo(L(h),u),this.Canvas.lineTo(L(h),l)),this.Canvas.stroke())},this.DrawBar=function(){var r=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,e=this.ChartBorder.GetLeft()+n/2+2,t=this.ChartBorder.GetRight(),a=this.ChartFrame.XPointCount;this.IsHScreen&&(e=this.ChartBorder.GetTop()+n/2+2,t=this.ChartBorder.GetBottom());for(var s=this.Data.DataOffset,o=0;s<this.Data.Data.length&&o<a;++s,++o,e+=r+n){var h=this.Data.Data[s];if(!(h.Open==null||h.High==null||h.Low==null||h.Close==null)&&this.KLineColor.has(s)){var l=this.KLineColor.get(s),u=e+r;if(u>t)break;l.Color?(this.Canvas.strokeStyle=l.Color,this.Canvas.fillStyle=l.Color):(this.Canvas.strokeStyle=this.Color,this.Canvas.fillStyle=this.Color),h.Open<h.Close?this.DrawUpBarItem(h,e,r,l):h.Open>h.Close?this.DrawDownBarItem(h,e,r,l):this.DrawUnChangeBarItem(h,e,r,l)}}},this.DrawColorBar=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetBorder(),a=t.LeftEx+e/2+m.FrameLeftMargin,s=t.RightEx,o=this.ChartFrame.XPointCount;if(r){var t=this.ChartBorder.GetHScreenBorder();a=t.TopEx+e/2+m.FrameLeftMargin,s=t.BottomEx}for(var h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<o;++h,++l,a+=n+e){var u=this.Data.Data[h];if(u&&!(!c.IsNumber(u.Open)||!c.IsNumber(u.High)||!c.IsNumber(u.Low)||!c.IsNumber(u.Close))){var f=a,C=a+n;if(C>s)break;var D=f+(C-f)/2,v=this.GetYFromData(u.Low,!1),S=this.GetYFromData(u.High,!1),T=this.GetYFromData(u.Open,!1),I=this.GetYFromData(u.Close,!1),F=S;u.Open==u.Close?this.DrawKBar_Unchagne(u,n,this.Color,this.IsEmptyBar,D,F,f,C,v,S,T,I,r):this.DrawKBar_Custom(u,n,this.Color,this.IsEmptyBar,D,F,f,C,v,S,T,I,r)}}},this.DrawKBar_Unchagne=function(r,n,e,t,a,s,o,h,l,u,f,C,D){if(n>=4){if(n%2!=0&&(n-=1),this.Canvas.strokeStyle=e,this.Canvas.beginPath(),r.High>r.Close){if(D)this.Canvas.moveTo(s,L(a)),this.Canvas.lineTo(f,L(a));else{var v=L(o+n/2);this.Canvas.moveTo(v,s),this.Canvas.lineTo(v,f)}s=f}else s=f;if(D?(this.Canvas.moveTo(L(s),L(o)),this.Canvas.lineTo(L(s),L(h))):(this.Canvas.moveTo(L(o),L(s)),this.Canvas.lineTo(L(o+n),L(s))),r.Open>r.Low)if(D)this.Canvas.moveTo(L(s),L(a)),this.Canvas.lineTo(L(l),L(a));else{var v=L(o+n/2);this.Canvas.moveTo(v,L(s)),this.Canvas.lineTo(v,L(l))}this.Canvas.stroke()}else this.Canvas.beginPath(),D?(this.Canvas.moveTo(u,L(a)),this.Canvas.lineTo(l,L(a))):(this.Canvas.moveTo(L(a),u),this.Canvas.lineTo(L(a),l)),this.Canvas.strokeStyle=e,this.Canvas.stroke()},this.DrawKBar_Custom=function(r,n,e,t,a,s,o,h,l,u,f,C,D){if(t&&n%2!=0&&(n-=1),n>=4){if(this.Canvas.strokeStyle=e,r.High>r.Close){if(this.Canvas.beginPath(),D)this.Canvas.moveTo(L(s),L(a)),this.Canvas.lineTo(L(t?Math.max(C,f):C),L(a));else if(t){var v=o+n/2;this.Canvas.moveTo(L(v),L(s)),this.Canvas.lineTo(L(v),L(Math.min(C,f)))}else this.Canvas.moveTo(L(a),L(s)),this.Canvas.lineTo(L(a),L(C));this.Canvas.stroke(),s=C}else s=C;if(this.Canvas.fillStyle=e,D?Math.abs(f-s)<1?this.Canvas.fillRect(B(s),B(o),1,B(n)):t?(this.Canvas.beginPath(),this.Canvas.rect(L(s),L(o),B(f-s),B(n)),this.Canvas.stroke()):this.Canvas.fillRect(B(s),B(o),B(f-s),B(n)):Math.abs(f-s)<1?this.Canvas.fillRect(B(o),B(s),B(n),1):t?(this.Canvas.beginPath(),this.Canvas.rect(L(o),L(s),B(n),B(f-s)),this.Canvas.stroke()):this.Canvas.fillRect(B(o),B(Math.min(s,f)),B(n),B(Math.abs(f-s))),r.Open>r.Low){if(this.Canvas.beginPath(),D)this.Canvas.moveTo(L(t?Math.min(C,f):s),L(a)),this.Canvas.lineTo(L(l),L(a));else if(t){var v=o+n/2;this.Canvas.moveTo(L(v),L(Math.max(C,f))),this.Canvas.lineTo(L(v),L(l))}else this.Canvas.moveTo(L(a),L(s)),this.Canvas.lineTo(L(a),L(l));this.Canvas.stroke()}}else this.Canvas.beginPath(),D?(this.Canvas.moveTo(u,L(a)),this.Canvas.lineTo(l,L(a))):(this.Canvas.moveTo(L(a),u),this.Canvas.lineTo(L(a),l)),this.Canvas.strokeStyle=e,this.Canvas.stroke()},this.GetMaxMin=function(){var r={Max:null,Min:null};if(this.DrawName=="DRAWCOLORKLINE")for(var n=this.ChartFrame.XPointCount,e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<n;++e,++t){var a=this.Data.Data[e];a&&(a.Open==null||a.High==null||a.Low==null||a.Close==null||(r.Max==null&&(r.Max=a.High),r.Min==null&&(r.Min=a.Low),r.Max<a.High&&(r.Max=a.High),r.Min>a.Low&&(r.Min=a.Low)))}return r}}function JT(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartHeatMap",this.Draw=function(){if(this.IsShow&&!this.ChartFrame.IsMinSize){this.ChartFrame.IsHScreen;for(var r=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,e=this.ChartBorder.GetBorder(),t=e.LeftEx+m.FrameLeftMargin,a=e.RightEx,s=this.ChartFrame.XPointCount,o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<s;++o,++h,t+=r+n){var l=this.Data.Data[o];if(l.HeatMap){var u=t,f=t+r;if(f>a)break;this.DrawHeatMap(u,f+n,l.HeatMap)}}}},this.DrawHeatMap=function(r,n,e){if(c.IsNonEmptyArray(e.Order)){var t=this.ChartFrame.HorizontalMax,a=this.ChartFrame.HorizontalMin,s=0;c.IsNumber(e.PriceOffset)&&(s=this.GetPriceYOffset(e.PriceOffset));for(var o=0;o<e.Order.length;++o){var h=e.Order[o];if(c.IsNumber(h.Price)&&h.Color&&!(h.Price>t||h.Price<a)){var l=this.GetYFromData(h.Price,!1),u={Left:r,Right:n,Bottom:l+s/2,Top:l-s/2};u.Width=u.Right-u.Left,u.Height=u.Bottom-u.Top,this.Canvas.fillStyle=h.Color,this.Canvas.fillRect(u.Left,u.Top,u.Width,u.Height)}}}},this.GetPriceYOffset=function(r){var n=this.ChartFrame,e=n.ChartBorder.GetHeightEx()*r/(n.HorizontalMax-n.HorizontalMin);return e}}var Ie={STATUS_NONE_ID:0,STATUS_REQUESTDATA_ID:1,STATUS_RECVDATA_ID:2,STATUS_FINISHED_ID:3};function zT(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartOverlayKLine",this.Color="rgb(65,105,225)",this.MainData,this.SourceData,this.Title,this.DrawType=0,this.CustomDrawType=null,this.Status=Ie.STATUS_NONE_ID,this.IsDelete=!1,this.CloseLineWidth=m.CloseLineWidth,this.ShowRange={},this.DrawKRange={Start:null,End:null},this.YInfoType=4,this.SetOption=function(r){r&&(c.IsNumber(r.DrawType)&&(this.CustomDrawType=r.DrawType),c.IsNumber(r.YInfoType)&&(this.YInfoType=r.YInfoType))},this.DrawKBar=function(r){var n=this.ChartFrame.IsHScreen===!0,e=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetLeft()+t/2+2;n&&(a=this.ChartBorder.GetTop()+t/2+2);var s=this.ChartBorder.GetRight();n&&(s=this.ChartBorder.GetBottom());var o=this.ChartFrame.XPointCount,h=this.DrawType;this.CustomDrawType!=null&&(h=this.CustomDrawType);var l=!0,u=null;this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.ShowRange.FirstOpen=r,this.DrawKRange.Start=this.Data.DataOffset;for(var f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<o;++f,++C,a+=e+t,++this.ShowRange.DataCount){var D=this.Data.Data[f];if(!(!D||D.Open==null||D.High==null||D.Low==null||D.Close==null)){u==null&&(u=D.Open,this.ShowRange.FirstOverlayOpen=D.Open),l&&(this.Canvas.strokeStyle=this.Color,this.Canvas.fillStyle=this.Color,this.Canvas.beginPath(),l=!1);var v=a,S=a+e;if(S>s)break;var T=v+(S-v)/2,I=this.GetYFromData(D.Low/u*r,!1),F=this.GetYFromData(D.High/u*r,!1),E=this.GetYFromData(D.Open/u*r,!1),M=this.GetYFromData(D.Close/u*r,!1),O=F;this.DrawKRange.End=f,D.Open<D.Close?e>=4?(D.High>D.Close&&(n?(this.Canvas.moveTo(L(O),L(T)),this.Canvas.lineTo(L(this.DrawType==3?Math.max(M,E):M),L(T))):(this.Canvas.moveTo(L(T),L(O)),this.Canvas.lineTo(L(T),L(this.DrawType==3?Math.min(M,E):M)))),O=M,n?Math.abs(E-O)<1?this.Canvas.fillRect(B(O),B(v),1,B(e)):h==3?this.Canvas.rect(L(O),L(v),B(E-O),B(e)):this.Canvas.fillRect(B(O),B(v),B(E-O),B(e)):Math.abs(E-O)<1?this.Canvas.fillRect(B(v),B(O),B(e),1):h==3?this.Canvas.rect(L(v),L(O),B(e),B(E-O)):this.Canvas.fillRect(B(v),B(O),B(e),B(E-O)),D.Open>D.Low&&(n?(this.Canvas.moveTo(L(this.DrawType==3?Math.min(M,E):O),L(T)),this.Canvas.lineTo(L(I),L(T))):(this.Canvas.moveTo(L(T),L(this.DrawType==3?Math.max(M,E):O)),this.Canvas.lineTo(L(T),L(I))))):n?(this.Canvas.moveTo(F,L(T)),this.Canvas.lineTo(I,L(T))):(this.Canvas.moveTo(L(T),F),this.Canvas.lineTo(L(T),I)):D.Open>D.Close?e>=4?(D.High>D.Close&&(n?(this.Canvas.moveTo(L(O),L(T)),this.Canvas.lineTo(L(E),L(T))):(this.Canvas.moveTo(L(T),L(O)),this.Canvas.lineTo(L(T),L(E)))),O=E,n?Math.abs(M-O)<1?this.Canvas.fillRect(B(O),B(v),1,B(e)):this.Canvas.fillRect(B(O),B(v),B(M-O),B(e)):Math.abs(M-O)<1?this.Canvas.fillRect(B(v),B(O),B(e),1):this.Canvas.fillRect(B(v),B(O),B(e),B(M-O)),D.Open>D.Low&&(n?(this.Canvas.moveTo(L(O),L(T)),this.Canvas.lineTo(L(I),L(T))):(this.Canvas.moveTo(L(T),L(O)),this.Canvas.lineTo(L(T),L(I))))):n?(this.Canvas.moveTo(F,L(T)),this.Canvas.lineTo(I,L(T))):(this.Canvas.moveTo(L(T),F),this.Canvas.lineTo(L(T),I)):e>=4?(D.High>D.Close&&(n?(this.Canvas.moveTo(O,L(T)),this.Canvas.lineTo(E,L(T))):(this.Canvas.moveTo(L(T),O),this.Canvas.lineTo(L(T),E))),O=E,n?(this.Canvas.moveTo(L(O),L(v)),this.Canvas.lineTo(L(O),L(S))):(this.Canvas.moveTo(L(v),L(O)),this.Canvas.lineTo(L(S),L(O))),D.Open>D.Low&&(n?(this.Canvas.moveTo(L(O),L(T)),this.Canvas.lineTo(L(I),L(T))):(this.Canvas.moveTo(L(T),L(O)),this.Canvas.lineTo(L(T),L(I))))):n?(this.Canvas.moveTo(F,L(T)),this.Canvas.lineTo(I,L(T))):(this.Canvas.moveTo(L(T),F),this.Canvas.lineTo(L(T),I));{var R=Math.min(I,F,E,M),b=Math.max(I,F,E,M),p=new Sa(v,R,e,b-R);this.TooltipRect.push([f,p])}}}l==!1&&this.Canvas.stroke()},this.DrawAKLine=function(r){var n=this.ChartFrame.IsHScreen===!0,e=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetLeft()+t/2+2;n&&(a=this.ChartBorder.GetTop()+t/2+2);var s=this.ChartBorder.GetRight();n&&(s=this.ChartBorder.GetBottom());var o=this.ChartFrame.XPointCount,h=null;this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.ShowRange.FirstOpen=r,this.DrawKRange.Start=this.Data.DataOffset,this.Canvas.strokeStyle=this.Color;for(var l=this.Data.DataOffset,u=0;l<this.Data.Data.length&&u<o;++l,++u,a+=e+t,++this.ShowRange.DataCount){var f=this.Data.Data[l];if(!(f.Open==null||f.High==null||f.Low==null||f.Close==null)){h==null&&(h=f.Open,this.ShowRange.FirstOverlayOpen=f.Open);var C=a,D=a+e;if(D>s)break;var v=C+(D-C)/2,S=this.GetYFromData(f.Low/h*r,!1),T=this.GetYFromData(f.High/h*r,!1),I=this.GetYFromData(f.Open/h*r,!1),F=this.GetYFromData(f.Close/h*r,!1);this.DrawKRange.End=l,this.Canvas.beginPath(),n?(this.Canvas.moveTo(T,L(v)),this.Canvas.lineTo(S,L(v))):(this.Canvas.moveTo(L(v),T),this.Canvas.lineTo(L(v),S)),this.Canvas.stroke(),e>=4&&(this.Canvas.beginPath(),n?(this.Canvas.moveTo(L(I),C),this.Canvas.lineTo(L(I),v)):(this.Canvas.moveTo(C,L(I)),this.Canvas.lineTo(v,L(I))),this.Canvas.stroke(),this.Canvas.beginPath(),n?(this.Canvas.moveTo(L(F),D),this.Canvas.lineTo(L(F),v)):(this.Canvas.moveTo(D,L(F)),this.Canvas.lineTo(v,L(F))),this.Canvas.stroke())}}},this.DrawCloseLine=function(r){var n=this.ChartFrame.IsHScreen===!0,e=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetLeft()+t/2+2;n&&(a=this.ChartBorder.GetTop()+t/2+2);var s=this.ChartBorder.GetRight();n&&(s=this.ChartBorder.GetBottom());var o=this.ChartFrame.XPointCount,h=null,l=!0;this.Canvas.strokeStyle=this.Color,c.IsNumber(this.CloseLineWidth)&&(this.Canvas.lineWidth=this.CloseLineWidth),this.ShowRange.Start=this.Data.DataOffset,this.ShowRange.End=this.ShowRange.Start,this.ShowRange.DataCount=0,this.ShowRange.ShowCount=o,this.ShowRange.FirstOpen=r,this.DrawKRange.Start=this.Data.DataOffset,this.Canvas.beginPath();for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<o;++u,++f,a+=e+t,++this.ShowRange.DataCount){var C=this.Data.Data[u];if(!(C.Open==null||C.High==null||C.Low==null||C.Close==null)){h==null&&(h=C.Open,this.ShowRange.FirstOverlayOpen=C.Open);var D=a,v=a+e;if(v>s)break;var S=D+(v-D)/2,T=this.GetYFromData(C.Close/h*r,!1);this.DrawKRange.End=u,l?(n?this.Canvas.moveTo(T,S):this.Canvas.moveTo(S,T),l=!1):n?this.Canvas.lineTo(T,S):this.Canvas.lineTo(S,T)}}l==!1&&this.Canvas.stroke()},this.GetFirstOpen=function(){if(!this.MainData||!this.Data)return null;for(var r=this.ChartFrame.XPointCount,n=this.Data.DataOffset,e=0;n<this.MainData.Data.length&&e<r;++n,++e){var t=this.MainData.Data[n];if(!(t.Open==null||t.High==null||t.Low==null||t.Close==null))return t.Open}return null},this.Draw=function(){if(this.TooltipRect=[],this.InfoTooltipRect=[],this.DrawKRange={Start:null,End:null},!(!this.MainData||!this.Data)){this.ChartFrame.XPointCount;var r=this.GetFirstOpen();if(r!=null){var n=this.DrawType;this.CustomDrawType!=null&&(n=this.CustomDrawType),this.Canvas.save(),this.ClipClient(this.ChartFrame.IsHScreen),n==1?this.DrawCloseLine(r):n==2?this.DrawAKLine(r):this.DrawKBar(r),this.Canvas.restore()}}},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n={};if(n.Max=null,n.Min=null,!this.MainData||!this.Data)return n;for(var e=null,t=this.Data.DataOffset,a=0;t<this.MainData.Data.length&&a<r;++t,++a){var s=this.MainData.Data[t];if(!(s.Open==null||s.High==null||s.Low==null||s.Close==null)){e=s.Close;break}}if(e==null)return n;for(var o=null,h,l,t=this.Data.DataOffset,a=0;t<this.Data.Data.length&&a<r;++t,++a){var s=this.Data.Data[t];!s||s.Open==null||s.High==null||s.Low==null||s.Close==null||(o==null&&(o=s.Open),h=s.High/o*e,l=s.Low/o*e,n.Max==null&&(n.Max=h),n.Min==null&&(n.Min=l),n.Max<h&&(n.Max=h),n.Min>l&&(n.Min=l))}return n},this.GetTooltipData=function(r,n,e){for(var t in this.TooltipRect){var a=this.TooltipRect[t][1];if(this.Canvas.beginPath(),this.Canvas.rect(a.X,a.Y,a.Width,a.Height),this.Canvas.isPointInPath(r,n)){var s=this.TooltipRect[t][0];return e.Data=this.Data.Data[s],e.ChartPaint=this,!0}}return!1},this.PtInChart=function(r,n){var e=this.DrawType;return c.IsNumber(this.CustomDrawType)&&(e=this.CustomDrawType),e==1||e==4?null:this.PtInKBar(r,n,{OverlayKLine:!0})},this.DrawSelectedStatus=function(){this.DrawLinePoint({OverlayKLine:!0})}}function ZT(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartKlineTable",this.Data,this.RowName,this.IsShowRowName=!1,this.BGColor,this.RowCount=5,this.RowHeight=10,this.TextFontConfig=ne(m.ChartKLineTable.TextFont),this.ItemMergin=ne(m.ChartKLineTable.ItemMergin),this.TextFont,this.TextColor="rgb(0,0,0)",this.NameColor="rgb(0,0,0)",this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){var r=this.ChartFrame.IsHScreen===!0;if(!r&&!(this.RowCount<=0)){var n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount,a=this.ChartFrame.GetBorder(),s=a.Bottom-a.TopTitle;this.RowHeight=s/this.RowCount;var o=a.LeftEx+m.FrameLeftMargin,h=a.RightEx,l=a.TopTitle,u=a.Bottom;if(this.BGColor){this.Canvas.fillStyle=this.BGColor;var f=a.LeftEx,C=a.RightEx-a.LeftEx,s=u-l;this.Canvas.fillRect(f,l,C,s)}var D=this.RowHeight,v=n+e;D-this.ItemMergin.Top-this.ItemMergin.Bottom>0&&(D=D-this.ItemMergin.Left-this.ItemMergin.Right),v-this.ItemMergin.Left-this.ItemMergin.Right>0&&(v=v-this.ItemMergin.Left-this.ItemMergin.Right);var S=this.GetDynamicTextFont(D,v);this.TextFont=S,this.Canvas.font=this.TextFont;for(var T=this.Data.DataOffset,I=0;T<this.Data.Data.length&&I<t;++T,++I,o+=n+e){var F=this.Data.Data[T];if(F){var f=o,E=o+n+e;if(E>h)break;var M=f+(E-f)/2;if(M>h)break;I==0&&this.IsShowRowName?this.DrawRowName(l,u,f,E):this.DrawRow(F,l,u,f,E)}}}}}},this.DrawRowName=function(r,n,e,t){if(c.IsNonEmptyArray(this.RowName))for(var a=e,s=r,o=t-e,h=0;h<this.RowName.length;++h){var l=this.RowName[h],u={Left:a,Top:s,Right:t,Height:this.RowHeight,Width:o};u.Bottom=u.Top+this.RowHeight,l.Name&&u.Width>10&&(this.Canvas.fillStyle=l.Color?l.Color:this.TextColor,this.Canvas.textBaseline="middle",l.TextAlign=="right"?(this.Canvas.textAlign="right",this.Canvas.fillText(l.Name,u.Right-2,u.Top+this.RowHeight/2,o-4)):l.TextAlign=="center"?(this.Canvas.textAlign="center",this.Canvas.fillText(l.Name,u.Left+u.Width/2,u.Top+this.RowHeight/2,o-4)):(this.Canvas.textAlign="left",this.Canvas.fillText(l.Name,u.Left+2,u.Top+this.RowHeight/2,o-4))),s+=this.RowHeight}},this.DrawRow=function(r,n,e,t,a){for(var s=t,o=n,h=a-t,l=0;l<r.length;++l){var u=r[l],f={Left:s,Top:o,Right:a,Height:this.RowHeight,Width:h};f.Bottom=f.Top+this.RowHeight,u.BGColor&&(this.Canvas.fillStyle=u.BGColor,this.Canvas.fillRect(f.Left,f.Top,f.Width,f.Height)),u.Color&&f.Width>10&&(this.Canvas.fillStyle=u.Color,this.Canvas.textBaseline="middle",u.TextAlign=="right"?(this.Canvas.textAlign="right",this.Canvas.fillText(u.Text,f.Right-2,f.Top+this.RowHeight/2,h-4)):u.TextAlign=="center"?(this.Canvas.textAlign="center",this.Canvas.fillText(u.Text,f.Left+f.Width/2,f.Top+this.RowHeight/2,h-4)):(this.Canvas.textAlign="left",this.Canvas.fillText(u.Text,f.Left+2,f.Top+this.RowHeight/2,h-4))),o+=this.RowHeight}},this.GetDynamicTextFont=function(r,n,e){var t=parseInt(r)-2;r<5&&(t=parseInt(r)),t>this.TextFontConfig.FontMaxSize?t=this.TextFontConfig.FontMaxSize:t<=0&&(t=1);var a=this.FormatFontString(t,this.TextFontConfig.Family,e);return a},this.FormatFontString=function(r,n,e){var t;return e?e.Weight&&(t=e.Weight+" "+r+"px "+n):t=r+"px "+n,t},this.GetMaxMin=function(){return{Min:0,Max:this.RowCount}}}function Bh(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinuteVolumBar",this.UpColor=m.UpBarColor,this.DownColor=m.DownBarColor,this.UnchangeColor=m.UnchagneBarColor,this.BarColorType=1,this.CustomColor=m.Minute.VolBarColor,this.YClose,this.Symbol,this.BeforeOpenData,this.AfterCloseData,this.BeforeVolColor=m.Minute.Before.VolColor,this.ShareAfterVol=0,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.PtInChart=function(r,n){var e={MinuteVolBar:!0};return this.PtInBar(r,n,e)},this.DrawSelectedStatus=function(){return this.DrawLinePoint({MinuteVolBar:!0})},this.Draw=function(){var r=this.ChartFrame.IsHScreen===!0;if(r)var n=this.ChartBorder.GetHScreenBorder(),e=n.BottomEx;else var n=this.ChartBorder.GetBorder(),e=n.RightEx;this.DrawBeforeOpen(),this.DrawMultiDayBeforeOpen();var t=this.ChartFrame.XPointCount,a=this.ChartFrame.GetYFromData(0),s=this.YClose,o=this.Data,h=W.IsShowMinuteColorVolBar(this.Symbol);h&&(this.Canvas.strokeStyle=this.CustomColor);for(var l=o.DataOffset,u=0;l<o.Data.length&&u<t;++l,++u){var f=o.Data[l],C=null;if(f){var D=null;if(C=f.Vol,D=f.Close,!!C){var v=this.ChartFrame.GetYFromData(C),S=this.ChartFrame.GetXFromIndex(u);if(S>e)break;h||(this.Canvas.strokeStyle=this.GetMinuteBarColor(D,s)),this.Canvas.beginPath(),r?(this.Canvas.moveTo(v,L(S)),this.Canvas.lineTo(a,L(S))):(this.Canvas.moveTo(L(S),v),this.Canvas.lineTo(L(S),a)),this.Canvas.stroke(),D&&(s=D)}}}this.DrawAfterClose(),this.DrawMultiDayAfterClose()},this.GetMinuteBarColor=function(r,n){return this.BarColorType==1?r>n?this.UpColor:r<n?this.DownColor:this.UnchangeColor:r>=n?this.UpColor:this.DownColor},this.DrawBeforeOpen=function(){this.ChartBorder.LeftExtendWidth<10||this.BeforeOpenData&&this.DrawCallAuction(-1,this.BeforeOpenData,!0)},this.DrawAfterClose=function(){this.ChartBorder.RightExtendWidth<10||this.AfterCloseData&&this.DrawCallAuction(-1,this.AfterCloseData,!1)},this.DrawMultiDayBeforeOpen=function(){if(!(this.ChartBorder.MultiDayMinute.Count<=1||this.ChartBorder.MultiDayMinute.Left<=0)&&this.MultiDayBeforeOpenData){var r=0,n=this.MultiDayBeforeOpenData.length;this.DayOffset&&(c.IsNumber(this.DayOffset.Offset)&&(r=this.DayOffset.Offset),c.IsNumber(this.DayOffset.ShowDayCount)&&(n=this.DayOffset.ShowDayCount));for(var e=r,t=0;e<this.MultiDayBeforeOpenData.length&&t<n;++e,++t){var a=this.MultiDayBeforeOpenData[e];this.DrawCallAuction(t,a,!0)}}},this.DrawMultiDayAfterClose=function(){if(!(this.ChartBorder.MultiDayMinute.Count<=1||this.ChartBorder.MultiDayMinute.Right<=0)&&this.MultiDayAfterCloseData){var r=0,n=this.MultiDayAfterCloseData.length;this.DayOffset&&(c.IsNumber(this.DayOffset.Offset)&&(r=this.DayOffset.Offset),c.IsNumber(this.DayOffset.ShowDayCount)&&(n=this.DayOffset.ShowDayCount));for(var e=r,t=0;e<this.MultiDayAfterCloseData.length&&t<n;++e,++t){var a=this.MultiDayAfterCloseData[e];this.DrawCallAuction(t,a,!1)}}},this.DrawCallAuction=function(r,n,e){if(n){n.Index=r;var t=this.GetBorder(),a=this.ChartFrame.IsHScreen===!0,s=this.YClose,o=this.ChartFrame.GetYFromData(0);if(n.Ver==1)for(var h in n.Data){var l=n.Data[h];if(!(!l||!c.IsNumber(l.Vol[0]))){if(e)var u=this.ChartFrame.GetLeftExtendXFromIndex(h,n),f=this.ChartFrame.GetLeftExtendYFromData(l.Vol[0]);else var u=this.ChartFrame.GetRightExtendXFromIndex(h,n),f=this.ChartFrame.GetRightExtendYFromData(l.Vol[0]);this.Canvas.strokeStyle=l.Price>=s?this.UpColor:this.DownColor,this.Canvas.beginPath(),a?(this.Canvas.moveTo(f,L(u)),this.Canvas.lineTo(o,L(u))):(this.Canvas.moveTo(L(u),f),this.Canvas.lineTo(L(u),o)),this.Canvas.stroke(),l.Price&&(s=l.Price)}}else if(n.Ver==2||n.Ver==3){var C={Max:n.VolMax,Min:n.VolMin};for(var h in n.Data){var l=n.Data[h];if(l){if(c.IsPlusNumber(l.Vol[0])){if(e)var u=this.ChartFrame.GetLeftExtendXFromIndex(h,n),f=this.ChartFrame.GetLeftExtendYFromData(l.Vol[0],!1,{Range:C});else{var u=this.ChartFrame.GetRightExtendXFromIndex(h,n);if(this.ShareAfterVol==1)var f=this.ChartFrame.GetYFromData(l.Vol[0]);else var f=this.ChartFrame.GetRightExtendYFromData(l.Vol[0],!1,{Range:C})}this.Canvas.strokeStyle=this.GetBarColor(l.ColorID),this.Canvas.beginPath(),a?(this.Canvas.moveTo(f,L(u)),this.Canvas.lineTo(o,L(u))):(this.Canvas.moveTo(L(u),f),this.Canvas.lineTo(L(u),o)),this.Canvas.stroke()}if(c.IsPlusNumber(l.Vol[1])){if(e)var u=this.ChartFrame.GetLeftExtendXFromIndex(h,n),f=this.ChartFrame.GetLeftExtendYFromData(l.Vol[1],!1,{Range:C});else{var u=this.ChartFrame.GetRightExtendXFromIndex(h,n);if(this.ShareAfterVol==1)var f=this.ChartFrame.GetYFromData(l.Vol[1]);else var f=this.ChartFrame.GetRightExtendYFromData(l.Vol[1],!1,{Range:C})}this.Canvas.strokeStyle=this.GetBarColor(l.ColorID),this.Canvas.beginPath(),a?(f-=o,f=t.RightEx-f,this.Canvas.moveTo(f,L(u)),this.Canvas.lineTo(t.RightEx,L(u))):(f-=o,f=t.TopEx-f,this.Canvas.moveTo(L(u),f),this.Canvas.lineTo(L(u),t.TopEx)),this.Canvas.stroke()}}}}}},this.GetBarColor=function(r){switch(r){case 0:return this.UnchangeColor;case 1:return this.UpColor;case 2:return this.DownColor}if(this.BeforeVolColor&&Array.isArray(this.BeforeVolColor)){var n=r-3;if(n>=0&&n<this.BeforeVolColor.length)return this.BeforeVolColor[n]}return this.UnchangeColor},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n=this.Data.DataOffset;this.ChartFrame.GlobalOption&&this.ChartFrame.GlobalOption.IsValueFullRange===!0&&(r=this.Data.Data.length,n=0);var e={};e.Min=0,e.Max=null;for(var t=n,a=0;t<this.Data.Data.length&&a<r;++t,++a){var s=this.Data.Data[t];!s||!s.Vol||(e.Max==null&&(e.Max=s.Vol),e.Max<s.Vol&&(e.Max=s.Vol))}return this.ShareAfterVol==1&&(this.GetAfterCloseMaxMin(e),this.GetMultiDayAfterCloseMaxMin(e)),e},this.GetAfterCloseMaxMin=function(r){if(!(this.ChartBorder.RightExtendWidth<10)&&this.AfterCloseData){var n=this.AfterCloseData;(r.Max==null||r.Max<n.VolMax)&&(r.Max=n.VolMax)}},this.GetMultiDayAfterCloseMaxMin=function(r){if(!(this.ChartBorder.MultiDayMinute.Count<=1||this.ChartBorder.MultiDayMinute.Right<=0)&&this.MultiDayAfterCloseData)for(var n=0;n<this.MultiDayAfterCloseData.length;++n){var e=this.MultiDayAfterCloseData[n];(e.Ver==2||e.Ver==3)&&(r.Max==null||r.Max<e.VolMax)&&(r.Max=e.VolMax)}}}function QT(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartErrorMessage",this.Draw=function(){this.IsShow&&this.NotSupportMessage&&this.DrawNotSupportmessage()}}function Ye(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartLine",this.Color="rgb(255,193,37)",this.LineWidth,this.DrawType=0,this.IsDotLine=!1,this.BreakPoint,this.DrawSelectedStatus=this.DrawLinePoint,this.PtInChart=this.PtInLine,this.ExportData=this.ExportArrayData,this.GetItemData=this.GetArrayItemData,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data))switch(this.DrawType){case 0:return this.DrawLine();case 1:return this.DrawStraightLine();case 2:return this.DrawSectionLine()}}},this.DrawLine=function(){var r=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth;var n=this.ChartBorder.GetRight();r&&(n=this.ChartBorder.GetBottom());var e=this.ChartFrame.XPointCount;this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V()),this.IsDotLine&&this.Canvas.setLineDash(m.DOTLINE.LineDash);for(var t=!0,a=0,s=this.Data.DataOffset,o=0;s<this.Data.Data.length&&o<e;++s,++o){var h=this.Data.Data[s];if(h!=null){var l=this.ChartFrame.GetXFromIndex(o),u=this.GetYFromData(h);if(l>n)break;t?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),r?this.Canvas.moveTo(u,l):this.Canvas.moveTo(l,u),t=!1):r?this.Canvas.lineTo(u,l):this.Canvas.lineTo(l,u),++a}}a>0&&this.Canvas.stroke(),this.Canvas.restore()},this.DrawStraightLine=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.IsMinuteFrame(),e=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,a=this.ChartFrame.XPointCount;if(r)var s=this.ChartBorder.GetHScreenBorder(),o=s.BottomEx,h=s.TopEx+t/2+m.FrameLeftMargin;else var s=this.ChartBorder.GetBorder(),h=s.LeftEx+t/2+m.FrameLeftMargin,o=s.RightEx;var l=this.GetLockRect();l&&(r?o=l.Top:o=l.Left),this.Canvas.save(),this.ClipClient(r),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V()),this.Canvas.strokeStyle=this.Color,this.IsDotLine&&this.Canvas.setLineDash(m.DOTLINE.LineDash);for(var u=!0,f=null,C=0,D=this.Data.DataOffset,v=0;D<this.Data.Data.length&&v<a;++D,++v,h+=e+t){var S=this.Data.Data[D];if(S==null){C>0&&this.Canvas.stroke(),u=!0,C=0,f=null;continue}if(n)var T=this.ChartFrame.GetXFromIndex(v);else{var I=h,F=h+e;if(F>o)break;var T=I+(F-I)/2}var E=this.GetYFromData(S,!1);if(T>o)break;u?(this.Canvas.beginPath(),r?this.Canvas.moveTo(E,T):this.Canvas.moveTo(T,E),u=!1,f={X:T,Y:E}):r?this.Canvas.lineTo(E,T):this.Canvas.lineTo(T,E),++C}C>0&&(C==1&&f&&(r?this.Canvas.lineTo(f.Y,f.X+1*V()):this.Canvas.lineTo(f.X+1*V(),f.Y)),this.Canvas.stroke()),this.Canvas.restore()},this.DrawSectionLine=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.IsMinuteFrame(),e=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,a=this.ChartFrame.XPointCount;if(r)var s=this.ChartBorder.GetHScreenBorder(),o=s.BottomEx,h=s.TopEx+t/2+m.FrameLeftMargin;else var s=this.ChartBorder.GetBorder(),h=s.LeftEx+t/2+m.FrameLeftMargin,o=s.RightEx;var l=this.GetLockRect();l&&(r?o=l.Top:o=l.Left),this.Canvas.save(),this.ClipClient(r),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V()),this.Canvas.strokeStyle=this.Color,this.IsDotLine&&this.Canvas.setLineDash(m.DOTLINE.LineDash);for(var u=!0,f=null,C=0,D=this.Data.DataOffset,v=0;D<this.Data.Data.length&&v<a;++D,++v,h+=e+t){var S=this.Data.Data[D];if(S==null){C>0&&this.Canvas.stroke(),u=!0,C=0,f=null;continue}if(n)var T=this.ChartFrame.GetXFromIndex(v);else{var I=h,F=h+e;if(F>o)break;var T=I+(F-I)/2}var E=this.GetYFromData(S,!1);if(T>o)break;this.BreakPoint&&this.BreakPoint.has(D)&&(C>0&&this.Canvas.stroke(),u=!0,C=0,f=null),u?(this.Canvas.beginPath(),r?this.Canvas.moveTo(E,T):this.Canvas.moveTo(T,E),u=!1,f={X:T,Y:E}):r?this.Canvas.lineTo(E,T):this.Canvas.lineTo(T,E),++C}C>0&&(C==1&&f&&(r?this.Canvas.lineTo(f.Y,f.X+1*V()):this.Canvas.lineTo(f.X+1*V(),f.Y)),this.Canvas.stroke()),this.Canvas.restore()}}function $T(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartArea",this.Color="rgb(255,193,37)",this.AreaColor,this.LineWidth,this.LineDash,this.AreaDirection=0,this.DrawSelectedStatus=this.DrawLinePoint,this.PtInChart=this.PtInLine,this.ExportData=this.ExportArrayData,this.GetItemData=this.GetArrayItemData,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}!this.Data||!this.Data.Data||this.DrawArea()}},this.DrawArea=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.IsMinuteFrame(),e=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,a=this.ChartFrame.XPointCount;if(r)var s=this.ChartBorder.GetHScreenBorder(),o=s.BottomEx,h=s.TopEx+t/2+m.FrameLeftMargin;else var s=this.ChartBorder.GetBorder(),h=s.LeftEx+t/2+m.FrameLeftMargin,o=s.RightEx;var l=this.GetLockRect();l&&(r?o=l.Top:o=l.Left),this.Canvas.save(),this.ClipClient(r),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V()),this.Canvas.strokeStyle=this.Color,this.AreaColor?this.Canvas.fillStyle=this.AreaColor:this.Canvas.fillStyle=It.ColorToRGBA(this.Color,.6),c.IsNonEmptyArray(this.LineDash)&&this.Canvas.setLineDash(this.LineDas);for(var u=!0,f=null,C=null,D=0,v=this.Data.DataOffset,S=0;v<this.Data.Data.length&&S<a;++v,++S,h+=e+t){var T=this.Data.Data[v];if(!c.IsNumber(T)){D>0&&this.Canvas.stroke(),f&&C&&(r?(this.AreaDirection==1?(this.Canvas.lineTo(s.RightEx,C.X),this.Canvas.lineTo(s.RightEx,f.X)):(this.Canvas.lineTo(s.LeftEx,C.X),this.Canvas.lineTo(s.LeftEx,f.X)),this.Canvas.closePath(),this.Canvas.fill()):(this.AreaDirection==1?(this.Canvas.lineTo(C.X,s.TopEx),this.Canvas.lineTo(f.X,s.TopEx)):(this.Canvas.lineTo(C.X,s.BottomEx),this.Canvas.lineTo(f.X,s.BottomEx)),this.Canvas.closePath(),this.Canvas.fill())),u=!0,D=0,f=null,C=null;continue}if(n)var I=this.ChartFrame.GetXFromIndex(S);else{var F=h,E=h+e;if(E>o)break;var I=F+(E-F)/2}var M=this.GetYFromData(T,!1);if(I>o)break;u?(this.Canvas.beginPath(),r?this.Canvas.moveTo(M,I):this.Canvas.moveTo(I,M),u=!1,f={X:I,Y:M}):(r?this.Canvas.lineTo(M,I):this.Canvas.lineTo(I,M),C={X:I,Y:M}),++D}D>0&&(D==1&&f&&(r?this.Canvas.lineTo(f.Y,f.X+1*V()):this.Canvas.lineTo(f.X+1*V(),f.Y)),this.Canvas.stroke(),f&&C&&(r?(this.AreaDirection==1?(this.Canvas.lineTo(s.RightEx,C.X),this.Canvas.lineTo(s.RightEx,f.X)):(this.Canvas.lineTo(s.LeftEx,C.X),this.Canvas.lineTo(s.LeftEx,f.X)),this.Canvas.closePath(),this.Canvas.fill()):(this.AreaDirection==1?(this.Canvas.lineTo(C.X,s.TopEx),this.Canvas.lineTo(f.X,s.TopEx)):(this.Canvas.lineTo(C.X,s.BottomEx),this.Canvas.lineTo(f.X,s.BottomEx)),this.Canvas.closePath(),this.Canvas.fill()))),this.Canvas.restore()}}function qT(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartScatterPlot",this.Color="rgb(255,193,37)",this.Radius=3,this.TooltipData=[],this.Draw=function(){if(this.TooltipData=[],!(!this.IsShow||this.ChartFrame.IsMinSize)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}!this.Data||!this.Data.Data||this.DrawScatterPlot()}},this.DrawScatterPlot=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.IsMinuteFrame(),e=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,a=this.ChartFrame.XPointCount;if(r)var s=this.ChartBorder.GetHScreenBorder(),o=s.BottomEx,h=s.TopEx+t/2+m.FrameLeftMargin;else var s=this.ChartBorder.GetBorder(),h=s.LeftEx+t/2+m.FrameLeftMargin,o=s.RightEx;var l=this.GetLockRect();l&&(r?o=l.Top:o=l.Left),this.Canvas.save(),this.ClipClient(r);for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<a;++u,++f,h+=e+t){var C=this.Data.Data[u];if(C){if(n)var D=this.ChartFrame.GetXFromIndex(f);else{var v=h,S=h+e;if(S>o)break;var D=v+(S-v)/2}if(D>o)break;if(Array.isArray(C))for(var f=0;f<C.length;++f)this.DrawItem(C[f],D);else this.DrawItem(C,D)}}this.Canvas.restore()},this.DrawItem=function(r,n){if(r&&c.IsNumber(r.Value)){var e=this.GetYFromData(r.Value,!1),t=this.Radius;if(r.Radius&&(t=r.Radius),!!c.IsNumber(t)){this.Canvas.beginPath(),this.Canvas.arc(n,e,t,0,2*Math.PI);var a=this.Color;r.Color&&(a=r.Color),a&&(this.Canvas.fillStyle=a,this.Canvas.fill()),r.ColorBorder&&(this.Canvas.strokeStyle=r.ColorBorder,this.Canvas.stroke());var s={X:n,Y:e,Radius:t,Data:r};this.TooltipData.push(s)}}},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n=this.Data.DataOffset;this.ChartFrame.GlobalOption&&this.ChartFrame.GlobalOption.IsValueFullRange&&(n=0,r=this.Data.Data.length);var e={};if(e.Min=null,e.Max=null,!this.Data||!this.Data.Data)return e;for(var t=n,a=0;t<this.Data.Data.length&&a<r;++t,++a){var s=this.Data.Data[t];if(s)if(Array.isArray(s))for(var o=0;o<s.length;++o){var h=s[o];c.IsNumber(h.Value)&&(e.Max==null&&(e.Max=h.Value),e.Min==null&&(e.Min=h.Value),e.Max<h.Value&&(e.Max=h.Value),e.Min>h.Value&&(e.Min=h.Value))}else{if(!c.IsNumber(s.Value))continue;e.Max==null&&(e.Max=s.Value),e.Min==null&&(e.Min=s.Value),e.Max<s.Value&&(e.Max=s.Value),e.Min>s.Value&&(e.Min=s.Value)}}return e},this.GetTooltipData=function(r,n,e){if(!this.IsShow||!c.IsNonEmptyArray(this.TooltipData))return!1;for(var t=this.TooltipData.length-1;t>=0;--t){var a=this.TooltipData[t];if(this.Canvas.beginPath(),this.Canvas.arc(a.X,a.Y,a.Radius,0,2*Math.PI),this.Canvas.isPointInPath(r,n))return X.Chart.Log("[ChartScatterPlot::GetTooltipData] point",a),e.Data=a,e.ChartPaint=this,e.Type=6,!0}}}function CC(){this.newMethod=Ye,this.newMethod(),delete this.newMethod,this.ClassName="ChartSubLine",this.Color="rgb(255,193,37)",this.LineWidth,this.DrawType=0,this.IsDotLine=!1,this.SubFrame={Max:null,Min:null},this.Draw=function(){if(this.IsShow&&!(!this.Data||!this.Data.Data))switch(this.CalculateDataMaxMin(),this.DrawType){case 0:return this.DrawLine();case 1:return this.DrawStraightLine()}},this.GetYFromData=function(r){var n=this.ChartFrame.IsHScreen===!0;if(n){if(r<=this.SubFrame.Min)return this.ChartBorder.GetLeftEx();if(r>=this.SubFrame.Max)return this.ChartBorder.GetRightEx();var e=this.ChartBorder.GetWidthEx()*(r-this.SubFrame.Min)/(this.SubFrame.Max-this.SubFrame.Min);return this.ChartBorder.GetLeftEx()+e}else{if(r<=this.SubFrame.Min)return this.ChartBorder.GetBottomEx();if(r>=this.SubFrame.Max)return this.ChartBorder.GetTopEx();var t=this.ChartBorder.GetHeightEx()*(r-this.SubFrame.Min)/(this.SubFrame.Max-this.SubFrame.Min);return this.ChartBorder.GetBottomEx()-t}},this.CalculateDataMaxMin=function(){this.SubFrame={Max:null,Min:null};var r=this.ChartFrame.IsHScreen===!0,n=this.ChartBorder.GetRight();r&&(n=this.ChartBorder.GetBottom());for(var e=this.ChartFrame.XPointCount,t=this.Data.DataOffset,a=0;t<this.Data.Data.length&&a<e;++t,++a){var s=this.Data.Data[t];if(s!=null){var o=this.ChartFrame.GetXFromIndex(a);if(o>n)break;(this.SubFrame.Min==null||this.SubFrame.Min>s)&&(this.SubFrame.Min=s),(this.SubFrame.Max==null||this.SubFrame.Max<s)&&(this.SubFrame.Max=s)}}},this.GetMaxMin=function(){var r={Min:null,Max:null};return r}}function jT(){this.newMethod=Ye,this.newMethod(),delete this.newMethod,this.MainData=new k,this.Draw=function(){if(!(!this.Data||!this.Data.Data)&&!(!this.MainData||!this.MainData.Data))switch(this.DrawType){case 0:return this.DrawLine();case 1:return this.DrawStraightLine()}},this.GetFirstVaildIndex=function(){for(var r=this.Data.DataOffset,n=r,e=0;n<this.MainData.Data.length&&n<this.Data.Data.length;++n,++e){var t=this.MainData.Data[n],a=this.Data.Data[n];if(c.IsNumber(t)&&c.IsNumber(a))return{Index:e,DataOffset:n,OverlayValue:a,MainValue:t}}return null},this.DrawStraightLine=function(){var r=this.GetFirstVaildIndex();if(r){var n=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth;var e=this.ChartBorder.GetRight();n&&(e=this.ChartBorder.GetBottom());var t=this.ChartFrame.XPointCount,a=this.GetLockRect();a&&(n?e=a.Top:e=a.Left),this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V()),this.Canvas.strokeStyle=this.Color,this.IsDotLine&&this.Canvas.setLineDash([3,5]);for(var s=!0,o=0,h=0,l=r.DataOffset,u=r.Index;l<this.Data.Data.length&&u<t;++l,++u){var f=this.Data.Data[l];if(f==null){o>0&&this.Canvas.stroke(),s=!0,o=0;continue}var C=this.ChartFrame.GetXFromIndex(u),D=f-r.OverlayValue;r.OverlayValue!=0?h=1+D/Math.abs(r.OverlayValue):h=1+D;var v=r.MainValue*h,S=this.GetYFromData(v);if(C>e)break;s?(this.Canvas.beginPath(),n?this.Canvas.moveTo(S,C):this.Canvas.moveTo(C,S),s=!1):n?this.Canvas.lineTo(S,C):this.Canvas.lineTo(C,S),++o}o>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n={};n.Min=null,n.Max=null;var e=this.GetFirstVaildIndex();if(!e)return n;for(var t=e.DataOffset,a=e.Index;t<this.Data.Data.length&&a<r;++t,++a){var s=this.Data.Data[t];if(c.IsNumber(s)){var o=s-e.OverlayValue;e.OverlayValue!=0?rate=1+o/Math.abs(e.OverlayValue):rate=1+o;var h=e.MainValue*rate;n.Max==null&&(n.Max=h),n.Min==null&&(n.Min=h),n.Max<h&&(n.Max=h),n.Min>h&&(n.Min=h)}}return n}}function DC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartPartLine",this.LineWidth,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}!this.Data||!this.Data.Data||this.DrawLine()}},this.DrawLine=function(){var r=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth;var n=this.ChartBorder.GetRight();r&&(n=this.ChartBorder.GetBottom());var e=this.ChartFrame.XPointCount;this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V());for(var t=0,a,s={X:null,Y:null},o=!1,h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<e;++h,++l){var u=this.Data.Data[h];if(u==null||u.Value==null){s.X=null,s.Y=null,o=!0;continue}var f=u.Value,C=u.RGB,D=this.ChartFrame.GetXFromIndex(l),v=this.ChartFrame.GetYFromData(f);if(D>n)break;C!=a||o==!0?(a&&t>0&&this.Canvas.stroke(),t=0,a=C,this.Canvas.strokeStyle=C,this.Canvas.beginPath(),s.X!=null&&s.Y!=null?(r?this.Canvas.moveTo(s.Y,s.X):this.Canvas.moveTo(s.X,s.Y),r?this.Canvas.lineTo(v,D):this.Canvas.lineTo(D,v),++t):r?this.Canvas.moveTo(v,D):this.Canvas.moveTo(D,v)):(r?this.Canvas.lineTo(v,D):this.Canvas.lineTo(D,v),++t),s.X=D,s.Y=v,o=!1}t>0&&this.Canvas.stroke(),this.Canvas.restore()},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n={};n.Min=null,n.Max=null;for(var e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];!a||!a.Value||((n.Max==null||n.Max<a.Value)&&(n.Max=a.Value),(n.Min==null||n.Min>a.Value)&&(n.Min=a.Value))}return n},this.ExportData=function(r,n){var e=[],t=[];if(c.IsNonEmptyArray(this.Data.Data)){var a=0,s=this.Data.length-1;n&&n.Start&&n.End&&c.IsNumber(n.Start.Index)&&c.IsNumber(n.End.Index)&&(a=n.Start.Index,s=n.End.Index);for(var o=a;o<=s&&o<this.Data.Data.length;++o){var h=this.Data.Data[o];e[o]=null,t[o]=null,h&&c.IsNumber(h.Value)&&(e[o]=h.Value,t[o]=h.RGB)}}return[{Name:this.Name+"-Value",Data:e},{Name:this.Name+"-Color",Data:t}]}}function Ko(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartStepLine",this.LineWidth=1,this.DotLine,this.IsHScreen,this.IsDotLine=!1,this.PtInChart=function(r,n){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){var e=this.ChartFrame.IsHScreen===!0;if(!e){var t=this.IsMinuteFrame(),a=this.ChartFrame.DataWidth,s=this.ChartFrame.DistanceWidth,o=this.ChartFrame.XPointCount,h=this.GetLockRect();if(e){var l=this.ChartBorder.GetHScreenBorder(),u=l.BottomEx,f=l.TopEx+s/2+m.FrameLeftMargin;h&&(u=h.Top)}else{var l=this.ChartBorder.GetBorder(),f=l.LeftEx+s/2+m.FrameLeftMargin,u=l.RightEx;h&&(u=h.Left)}if(r<f||r>u||n>l.BottomEx||n<l.TopEx)return null;for(var C={},D={},v=this.Data.DataOffset;v>=0;--v){var S=this.Data.Data[v];if(c.IsNumber(S)){var T=this.GetYFromData(S,!1),I=null;t?I=this.ChartFrame.GetXFromIndex(0):I=f,C.Y=T,C.X=I}}for(var v=this.Data.DataOffset,F=0;v<this.Data.Data.length&&F<o;++v,++F,f+=a+s){var S=this.Data.Data[v];if(c.IsNumber(S)){if(t)var E=this.ChartFrame.GetXFromIndex(F);else{var M=f,O=f+a;if(O>u)break;var E=M+(O-M)/2}var R=this.GetYFromData(S,!1);if(E<r)C.X=E,C.Y=R;else if(E==r){C.X=D.X=E,C.Y=D.Y=R;break}else{D.X=E,D.Y=R;break}if(r>u)break}}return!c.IsNumber(C.X)||!c.IsNumber(C.Y)||!c.IsNumber(D.X)||!c.IsNumber(D.Y)?null:r==C.X||n==C.Y?{Identify:this.Identify,Chart:this}:r==D.X||n==D.Y?{Identify:this.Identify,Chart:this}:r>=C.X&&r<=D.X&&n>=C.Y-3&&n<=C.Y+3?{Identify:this.Identify,Chart:this}:r>=D.X-3&&r<=D.X+3&&n>=Math.min(C.Y,D.Y)&&n<Math.max(C.Y,D.Y)?{Identify:this.Identify,Chart:this}:null}}},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}!this.Data||!this.Data.Data||(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.Canvas.save(),this.ClipClient(this.IsHScreen),this.DrawLine(),this.Canvas.restore())}},this.DrawLine=function(){var r=this.IsMinuteFrame(),n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount,a=this.GetLockRect();if(this.IsHScreen){var s=this.ChartBorder.GetHScreenBorder(),o=s.BottomEx,h=s.TopEx+e/2+m.FrameLeftMargin;a&&(o=a.Top)}else{var s=this.ChartBorder.GetBorder(),h=s.LeftEx+e/2+m.FrameLeftMargin,o=s.RightEx;a&&(o=a.Left)}this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V()),this.IsDotLine&&this.Canvas.setLineDash(m.DOTLINE.LineDash),this.DotLine&&this.Canvas.setLineDash(this.DotLine),this.Canvas.strokeStyle=this.Color;for(var l=!0,u=0,f={X:null,Y:null},C=this.Data.DataOffset;C>=0;--C){var D=this.Data.Data[C];if(c.IsNumber(D)){var v=this.GetYFromData(D,!1),S=null;r?S=this.ChartFrame.GetXFromIndex(0):S=h,this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(v,S):this.Canvas.moveTo(S,v),l=!1,f.Y=v,f.X=S}}for(var C=this.Data.DataOffset,T=0;C<this.Data.Data.length&&T<t;++C,++T,h+=n+e){if(r)var S=this.ChartFrame.GetXFromIndex(T);else{var I=h,F=h+n;if(F>o)break;var S=I+(F-I)/2}if(S>o)break;var D=this.Data.Data[C];if(c.IsNumber(D)){var v=this.GetYFromData(D,!1);l?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(v,S):this.Canvas.moveTo(S,v),l=!1,f.X=S,f.Y=v):(this.IsHScreen?(this.Canvas.lineTo(f.Y,S),this.Canvas.lineTo(v,S)):(this.Canvas.lineTo(S,f.Y),this.Canvas.lineTo(S,v)),f.X=S,f.Y=v),++u}}u>0&&this.Canvas.stroke()},this.DrawSelectedStatus=function(){this.DrawLinePoint()}}function td(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartSlopeLine",this.Color="rgb(255,193,37)",this.IsDotLine=!1,this.LineWidth,this.Option,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){this.Canvas.save(),this.Canvas.strokeStyle=this.Color,this.IsDotLine&&this.Canvas.setLineDash(m.DOTLINE.LineDash);var r=this.ChartBorder.GetLeft(),n=this.ChartBorder.GetTopEx(),e=this.ChartBorder.GetRight(),t=this.ChartBorder.GetBottom(),a=this.ChartBorder.GetRight(),s=this.ChartFrame.XPointCount;this.Canvas.beginPath(),this.Canvas.rect(r,n,e-r,t-n),this.Canvas.clip();for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<s;++o,++h){var l=this.Data.Data[o];if(c.IsNumber(l)){var u=this.Option[o];if(u){var f=this.ChartFrame.GetXFromIndex(h),C=this.ChartFrame.GetYFromData(l),D=u.Length*m.DRAWSL.PixelWidth;if(f>a)break;var v=Math.sqrt(D*D/(1+u.Slope*u.Slope)),S=v*u.Slope;this.Canvas.beginPath(),u.Direct==2?(this.Canvas.moveTo(f-v,C+S),this.Canvas.lineTo(f+v,C-S)):u.Direct==1?(this.Canvas.moveTo(f,C),this.Canvas.lineTo(f-v,C+S)):(this.Canvas.moveTo(f,C),this.Canvas.lineTo(f+v,C-S)),this.Canvas.stroke()}}}this.Canvas.restore()}}}}function vC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartPointDot",this.Color="rgb(255,193,37)",this.Radius=1,this.EnableUpDownColor=!1,this.HistoryData,this.ExportData=this.ExportArrayData,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){var r=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth;var n=this.ChartBorder.GetRight();r===!0&&(n=this.ChartBorder.GetBottom());var e=this.ChartFrame.XPointCount;this.Canvas.save(),this.Canvas.fillStyle=this.Color;for(var t,a=this.Data.DataOffset,s=0;a<this.Data.Data.length&&s<e;++a,++s){var o=this.Data.Data[a];if(o!=null){var h=this.ChartFrame.GetXFromIndex(s),l=this.ChartFrame.GetYFromData(o);if(h>n)break;if(this.EnableUpDownColor){var u=this.HistoryData.Data[a];u.Close>o?t="rgb(255,61,61)":t="rgb(0,199,65)",this.Canvas.fillStyle=t}this.Canvas.beginPath(),r?this.Canvas.arc(l,h,this.Radius,0,Math.PI*2,!0):this.Canvas.arc(h,l,this.Radius,0,Math.PI*2,!0),this.Canvas.closePath(),this.Canvas.fill()}}this.Canvas.restore()}}}}function bh(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.Color="rgb(255,193,37)",this.LineWidth,this.ClassName="ChartStick",this.ExportData=this.ExportArrayData,this.DrawLine=function(){if(!(!this.Data||!this.Data.Data)){var r=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth;var n=this.ChartBorder.GetRight();r===!0&&(n=this.ChartBorder.GetBottom());var e=this.ChartFrame.XPointCount;this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V());for(var t=!0,a=0,s=this.Data.DataOffset,o=0;s<this.Data.Data.length&&o<e;++s,++o){var h=this.Data.Data[s];if(h!=null){var l=this.ChartFrame.GetXFromIndex(o),u=this.ChartFrame.GetYFromData(h);if(l>n)break;t?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),r?this.Canvas.moveTo(u,l):this.Canvas.moveTo(l,u),t=!1):r?this.Canvas.lineTo(u,l):this.Canvas.lineTo(l,u),++a}}a>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.DrawStick=function(){if(!(!this.Data||!this.Data.Data)){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartBorder.GetRight();r&&(n=this.ChartBorder.GetBottom());var e=this.ChartFrame.XPointCount,t=this.ChartBorder.GetBottom(),a=this.ChartBorder.GetLeft();this.Canvas.save(),this.Canvas.strokeStyle=this.Color,this.LineWidth&&(this.Canvas.lineWidth=this.LineWidth*V());for(var s=this.Canvas.lineWidth,o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<e;++o,++h){var l=this.Data.Data[o];if(l!=null){var u=this.ChartFrame.GetXFromIndex(h),f=this.ChartFrame.GetYFromData(l);if(u>n)break;if(this.Canvas.beginPath(),r)this.Canvas.moveTo(a,u),this.Canvas.lineTo(f,u),this.Canvas.stroke();else{var C=he(s,u);this.Canvas.moveTo(C,f),this.Canvas.lineTo(C,t)}this.Canvas.stroke()}}this.Canvas.restore()}},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}!this.Data||!this.Data.Data||this.DrawStick()}}}function cC(){this.newMethod=bh,this.newMethod(),delete this.newMethod,this.ClassName="ChartLineStick",this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}this.DrawStick(),this.DrawLine()}}}function Gh(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.UpColor=m.UpBarColor,this.DownColor=m.DownBarColor,this.HistoryData,this.KLineDrawType=0,this.ClassName="ChartVolStick",this.PtInChart=this.PtInBar,this.DrawSelectedStatus=this.DrawLinePoint,this.ExportData=this.ExportArrayData,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.ChartFrame.IsHScreen===!0){this.HScreenDraw();return}var r=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,e=this.ChartBorder.GetBorder(),t=e.LeftEx+n/2+m.FrameLeftMargin,a=e.RightEx,s=this.ChartFrame.XPointCount,o=this.GetLockRect();o&&(a=o.Left);var h=this.IsMinuteFrame(),l=this.ChartFrame.GetYFromData(0);if(r>=4){l=B(l);for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<s;++u,++f,t+=r+n){var C=this.Data.Data[u],D=this.HistoryData.Data[u];if(!(C==null||D==null)&&C!=0){var v=t,S=t+r;if(S>a)break;var T=this.ChartFrame.GetYFromData(C),I=this.GetBarColor(D),F=I.IsUp;this.Canvas.fillStyle=I.Color;var E=B(Math.abs(l-T)>=1?l-T:1);T=l-E,this.KLineDrawType==6?(this.Canvas.strokeStyle=I.Color,this.Canvas.beginPath(),this.Canvas.rect(L(v),L(T),B(r),E),this.Canvas.stroke()):F&&(this.KLineDrawType==1||this.KLineDrawType==2||this.KLineDrawType==3)?(this.Canvas.strokeStyle=this.UpColor,this.Canvas.beginPath(),this.Canvas.rect(L(v),L(T),B(r),E),this.Canvas.stroke()):this.Canvas.fillRect(B(v),T,B(r),E)}}}else for(var u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<s;++u,++f,t+=r+n){var C=this.Data.Data[u],D=this.HistoryData.Data[u];if(!(C==null||D==null)){var T=this.ChartFrame.GetYFromData(C);if(h)var M=this.ChartFrame.GetXFromIndex(f);else var v=t,S=t+r,M=v+(S-v)/2;if(M>a)break;var I=this.GetBarColor(D);this.Canvas.strokeStyle=I.Color,this.Canvas.beginPath(),this.Canvas.moveTo(L(M),T),this.Canvas.lineTo(L(M),l),this.Canvas.stroke()}}}},this.HScreenDraw=function(){var r=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,e=this.ChartBorder.GetHScreenBorder(),t=e.TopEx+n/2+m.FrameLeftMargin,a=e.BottomEx,s=this.ChartFrame.XPointCount,o=this.GetLockRect();o&&(a=o.Top);var h=this.ChartFrame.GetYFromData(0);if(r>=4){h=B(h);for(var l=this.Data.DataOffset,u=0;l<this.Data.Data.length&&u<s;++l,++u,t+=r+n){var f=this.Data.Data[l],C=this.HistoryData.Data[l];if(!(f==null||C==null)){var D=t,v=t+r;if(v>a)break;var S=this.ChartFrame.GetYFromData(f),T=this.GetBarColor(C),I=T.IsUp;this.Canvas.fillStyle=T.Color;var F=B(S-h);I&&(this.KLineDrawType==1||this.KLineDrawType==2||this.KLineDrawType==3)?(this.Canvas.strokeStyle=this.UpColor,this.Canvas.beginPath(),this.Canvas.rect(L(h),L(D),F,B(r)),this.Canvas.stroke()):this.Canvas.fillRect(h,B(D),F,B(r))}}}else for(var l=this.Data.DataOffset,u=0;l<this.Data.Data.length&&u<s;++l,++u,t+=r+n){var f=this.Data.Data[l],C=this.HistoryData.Data[l];if(!(f==null||C==null)){var S=this.ChartFrame.GetYFromData(f),E=this.ChartFrame.GetXFromIndex(u);if(E>a)break;var T=this.GetBarColor(C),I=T.IsUp;this.Canvas.strokeStyle=T.Color,this.Canvas.beginPath(),this.Canvas.moveTo(S,L(E)),this.Canvas.lineTo(h,L(E)),this.Canvas.stroke()}}},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n={};n.Min=null,n.Max=null;for(var e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];(!c.IsNumber(n.Max)||n.Max<a)&&(n.Max=a),(!c.IsNumber(n.Min)||n.Min>a)&&(n.Min=a)}return n.Max>0&&n.Min>0?n.Min=0:n.Max<0&&n.Min<0&&(n.Max=0),n},this.GetBarColor=function(r){return r.Close>=r.Open?{Color:this.UpColor,IsUp:!0}:{Color:this.DownColor,IsUp:!1}},this.GetItemData=function(r){if(!r||!c.IsNumber(r.Index)||!this.HistoryData||!c.IsNonEmptyArray(this.HistoryData.Data)||!this.Data||!c.IsNonEmptyArray(this.Data.Data))return null;var n=r.Index;if(n<0||n>=this.Data.Data.length||n>=this.HistoryData.Data.length)return null;var e=this.Data.Data[n],t=this.HistoryData.Data[n];return[{Value:e,Color:this.GetBarColor(t).Color,Name:this.Name}]}}function SC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartVericaltLine",this.LineWidth=2,this.LineCap,this.Draw=function(){if(!this.ChartFrame.IsMinSize){var r=this.ChartFrame.IsHScreen==!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.GetBorder(),a=this.ChartFrame.XPointCount;if(r)var s=t.RightEx,o=t.LeftEx,h=t.TopEx+e/2+m.FrameLeftMargin;else var s=t.TopEx,o=t.BottomEx,h=t.LeftEx+e/2+m.FrameLeftMargin;this.Canvas.save(),this.Canvas.strokeStyle=this.Color,this.LineType&&this.Canvas.setLineDash(this.LineType),this.LineCap&&(this.Canvas.lineCap=this.LineCap),this.Canvas.beginPath();var l=this.Canvas.lineWidth;this.LineWidth>0&&(l=this.LineWidth*V(),this.Canvas.lineWidth=l);for(var u=0,f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<a;++f,++C,h+=n+e){var D=this.Data.Data[f];if(D){var v=h+n/2;v=he(l,v),r?(this.Canvas.moveTo(s,v),this.Canvas.lineTo(o,v)):(this.Canvas.moveTo(v,s),this.Canvas.lineTo(v,o)),++u}}u>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.GetMaxMin=function(){return{Min:null,Max:null}}}function TC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartHorizontalLine",this.LineWidth=2,this.LineCap,this.ExtendType=0,this.Draw=function(){if(!this.ChartFrame.IsMinSize){var r=this.ChartFrame.IsHScreen==!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.GetBorder(),a=this.ChartFrame.XPointCount;if(r)var s=t.TopEx,o=t.BottomEx,h=t.TopEx+e/2+m.FrameLeftMargin;else var s=t.LeftEx,o=t.RightEx,h=t.LeftEx+e/2+m.FrameLeftMargin;this.Canvas.save(),this.Canvas.strokeStyle=this.Color,this.LineType&&this.Canvas.setLineDash(this.LineType),this.LineCap&&(this.Canvas.lineCap=this.LineCap),this.Canvas.beginPath();var l=this.Canvas.lineWidth;this.LineWidth>0&&(l=this.LineWidth*V(),this.Canvas.lineWidth=l);for(var u=0,f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<a;++f,++C,h+=n+e){var D=this.Data.Data[f];if(D&&c.IsNumber(D)){var v=this.ChartFrame.GetYFromData(D);v=he(l,v);var S=h+n/2;S=he(l,S),this.ExtendType==3?r?(this.Canvas.moveTo(v,s),this.Canvas.lineTo(v,o)):(this.Canvas.moveTo(s,v),this.Canvas.lineTo(o,v)):this.ExtendType==1?r?(this.Canvas.moveTo(v,s),this.Canvas.lineTo(v,S)):(this.Canvas.moveTo(s,v),this.Canvas.lineTo(S,v)):r?(this.Canvas.moveTo(v,S),this.Canvas.lineTo(v,o)):(this.Canvas.moveTo(S,v),this.Canvas.lineTo(o,v)),++u}}u>0&&this.Canvas.stroke(),this.Canvas.restore()}}}function dC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartLineMultiData",this.Color="rgb(255,193,37)",this.PointColor,this.PointRadius,this.LineWidth,this.Draw=function(){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){var r=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth;var n=this.ChartBorder.GetRight();r&&(n=this.ChartBorder.GetBottom());var e=this.ChartFrame.XPointCount;this.Canvas.save(),c.IsPlusNumber(this.LineWidth)&&(this.Canvas.lineWidth=this.LineWidth*V());for(var t=!0,a=0,s=[],o,h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<e;++h,++l){var u=this.Data.Data[h];if(u){var f=this.ChartFrame.GetXFromIndex(l);if(f>n)break;Array.isArray(u)?o=u:o=[u];for(var C=0;C<o.length;++C){var D=o[C];if(D){var v=D.Value,S=this.ChartFrame.GetYFromData(v);t?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),r?this.Canvas.moveTo(S,f):this.Canvas.moveTo(f,S),t=!1,D.Type===1&&s.push({X:f,Y:S})):(r?this.Canvas.lineTo(S,f):this.Canvas.lineTo(f,S),D.Type===1&&s.push({X:f,Y:S})),++a}}}}a>0&&this.Canvas.stroke(),this.DrawPoint(s),this.Canvas.restore()}},this.DrawPoint=function(r){if(this.PointColor&&c.IsPlusNumber(this.PointRadius))for(var n=this.PointRadius*V(),e=0;e<r.length;++e){var t=r[e];this.Canvas.beginPath(),this.Canvas.arc(t.X,t.Y,n,0,360,!1),this.Canvas.fillStyle=this.PointColor,this.Canvas.fill(),this.Canvas.closePath()}},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n={};if(n.Min=null,n.Max=null,!this.Data||!this.Data.Data)return n;for(var e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];if(a){var s;Array.isArray(a)?s=a:s=[a];for(var t=0;t<s.length;++t){var o=s[t].Value;c.IsNumber(o)&&(n.Max==null&&(n.Max=o),n.Min==null&&(n.Min=o),n.Max<o&&(n.Max=o),n.Min>o&&(n.Min=o))}}}return n}}function mC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartStickLine",this.Color="rgb(255,193,37)",this.BarType=0,this.LineDotted=[3,3],this.Width=0,this.SetEmptyBar=function(){if(this.BarType!=1&&this.BarType!=-1)return!1;this.Canvas.lineWidth=V(),this.Canvas.strokeStyle=this.Color;var r=m.EmptyBarBGColor;return r&&(this.Canvas.fillStyle=r),this.BarType==-1&&this.Canvas.setLineDash(this.LineDotted),!0},this.IsEmptyBar=function(){return this.BarType==1||this.BarType==-1},this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetRight();this.ChartFrame.ZoomIndex,r&&(t=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount,s=this.ChartBorder.GetLeft()+e/2+m.FrameLeftMargin;r&&(s=this.ChartBorder.GetTop()+e/2+m.FrameLeftMargin);var o=this.IsMinuteFrame();this.Canvas.save();var h=!1,l=!1,u=m.EmptyBarBGColor;if(o)this.Width>1?this.Canvas.lineWidth=2*V():this.Canvas.lineWidth=V(),this.Canvas.strokeStyle=this.Color;else if(this.Width==0)this.SetEmptyBar();else if(this.Width==3||this.Width==50)n>=4?(l=!0,this.SetEmptyBar(),this.IsEmptyBar()||(this.Canvas.fillStyle=this.Color),this.Canvas.strokeStyle=this.Color):(this.Canvas.lineWidth=V(),this.Canvas.strokeStyle=this.Color);else if(this.Width==101){var f=n+e+1*V();this.Canvas.lineWidth=f,this.Canvas.strokeStyle=this.Color}else if(this.Width<=3){var C=2*V(),D=n*(this.Width/3);D<C&&(D=C),this.SetEmptyBar(),this.IsEmptyBar()||(this.Canvas.fillStyle=this.Color),h=!0}else{var D=this.Width*V()+n;this.SetEmptyBar(),this.IsEmptyBar()||(this.Canvas.fillStyle=this.Color),h=!0}for(var v=this.Data.DataOffset,S=0;v<this.Data.Data.length&&S<a;++v,++S,s+=n+e){var T=this.Data.Data[v];if(T!=null){var I=T.Value,F=T.Value2;if(F==null&&(F=0),o)var E=this.ChartFrame.GetXFromIndex(S);else var M=s,O=s+n,E=M+(O-M)/2;var R=this.ChartFrame.GetYFromData(I),b=this.ChartFrame.GetYFromData(F);if(E>t)break;if(h)if(r){var M=E-D/2,p=D;this.IsEmptyBar()?(this.Canvas.beginPath(),this.Canvas.rect(L(Math.min(R,b)),L(M),B(Math.abs(R-b)),B(p)),this.Canvas.stroke()):this.Canvas.fillRect(B(Math.min(R,b)),B(M),B(Math.abs(R-b)),B(p))}else{var M=E-D/2,p=D;M+p>t&&(p=t-M),this.IsEmptyBar()?(u&&this.Canvas.fillRect(B(M),B(Math.min(R,b)),B(p),B(Math.abs(R-b))),this.Canvas.beginPath(),this.Canvas.rect(L(M),L(Math.min(R,b)),B(p),B(Math.abs(R-b))),this.Canvas.stroke()):this.Canvas.fillRect(B(M),B(Math.min(R,b)),B(p),B(Math.abs(R-b)))}else if(l)this.IsEmptyBar()?r?(this.Canvas.beginPath(),this.Canvas.rect(L(Math.min(R,b)),L(s),B(Math.abs(R-b)),B(n)),this.Canvas.stroke()):(u&&this.Canvas.fillRect(B(s),B(Math.min(R,b)),B(n),B(Math.abs(R-b))),this.Canvas.beginPath(),this.Canvas.rect(L(s),L(Math.min(R,b)),B(n),B(Math.abs(R-b))),this.Canvas.stroke()):r?this.Canvas.fillRect(B(Math.min(R,b)),B(s),B(Math.abs(R-b)),B(n)):this.Canvas.fillRect(B(s),B(Math.min(R,b)),B(n),B(Math.abs(R-b)));else if(r)this.Canvas.beginPath(),this.Canvas.moveTo(R,L(E)),this.Canvas.lineTo(b,L(E)),this.Canvas.stroke();else{var G=parseInt(E.toString())+.5;this.Canvas.beginPath(),this.Canvas.moveTo(G,R),this.Canvas.lineTo(G,b),this.Canvas.stroke()}}}this.Canvas.restore()}}},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n={};if(n.Min=null,n.Max=null,!this.Data||!this.Data.Data)return n;for(var e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];if(a!=null){var s=a.Value2;if(s==null&&(s=0),!(a==null||isNaN(a.Value)||isNaN(s))){var o=Math.max(a.Value,s),h=Math.min(a.Value,s);n.Max==null&&(n.Max=o),n.Min==null&&(n.Min=h),n.Max<o&&(n.Max=o),n.Min>h&&(n.Min=h)}}}return n}}function Fi(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartSingleText",this.Color="rgb(255,193,37)",this.TextFont="14px 微软雅黑",this.Text,this.TextAlign="left",this.TextBG,this.Direction=0,this.FixedFontSize=-1,this.YOffset=0,this.Position,this.ShowOffset={X:0,Y:0},this.IconFont,this.IconSize={Max:m.DRAWICON.Icon.MaxSize,Min:m.DRAWICON.Icon.MinSize,Zoom:{Type:m.DRAWICON.Icon.Zoom.Type,Value:m.DRAWICON.Icon.Zoom.Value},YOffset:m.DRAWICON.Icon.YOffset},this.TextSize={Max:m.DRAWICON.Text.MaxSize,Min:m.DRAWICON.Text.MinSize,Zoom:{Type:m.DRAWICON.Text.Zoom.Type,Value:m.DRAWICON.Text.Zoom.Value},FontName:m.DRAWICON.Text.FontName,YOffset:m.DRAWICON.Text.YOffset},this.Font={DRAWTEXT_FIX:m.DRAWTEXT_FIX.Font,DRAWNUMBER_FIX:m.DRAWNUMBER_FIX.Font},this.ExportData=this.ExportBoolData,this.ReloadResource=function(r){this.Name=="DRAWTEXT"?this.TextSize={Max:m.DRAWTEXT.MaxSize,Min:m.DRAWTEXT.MinSize,Zoom:{Type:m.DRAWTEXT.Zoom.Type,Value:m.DRAWTEXT.Zoom.Value},FontName:m.DRAWTEXT.FontName,YOffset:m.DRAWTEXT.YOffset}:this.Name=="DRAWNUMBER"?this.TextSize={Max:m.DRAWNUMBER.MaxSize,Min:m.DRAWNUMBER.MinSize,Zoom:{Type:m.DRAWNUMBER.Zoom.Type,Value:m.DRAWNUMBER.Zoom.Value},FontName:m.DRAWNUMBER.FontName,YOffset:m.DRAWNUMBER.YOffset}:this.Name=="DRAWTEXT_FIX"?this.Font.DRAWTEXT_FIX=m.DRAWTEXT_FIX.Font:this.Name=="DRAWNUMBER_FIX"&&(this.Font.DRAWNUMBER_FIX=m.DRAWNUMBER_FIX.Font)},this.SuperGetMaxMin=this.GetMaxMin,this.GetMaxMin=function(){return this.Name=="DRAWTEXT_FIX"||this.Name=="DRAWNUMBER_FIX"?{Min:null,Max:null}:this.Name=="DRAWTEXTREL"||this.Name=="DRAWTEXTABS"?{Min:null,Max:null}:this.SuperGetMaxMin()},this.DrawRectText=function(){if(this.DrawData){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.GetBorder();if(this.Name=="DRAWTEXTREL")if(r)var e=n.RightTitle-n.LeftEx,t=n.BottomEx-n.TopEx,a=this.DrawData.Point.X/1e3*t+n.TopEx,s=n.RightTitle-this.DrawData.Point.Y/1e3*t;else var t=n.RightEx-n.LeftEx,e=n.BottomEx-n.TopTitle,a=this.DrawData.Point.X/1e3*t+n.LeftEx,s=this.DrawData.Point.Y/1e3*e+n.TopTitle;else if(this.Name=="DRAWTEXTABS")if(r)var a=this.DrawData.Point.X+n.TopEx,s=n.RightTitle-this.DrawData.Point.Y;else var a=this.DrawData.Point.X+n.LeftEx,s=this.DrawData.Point.Y+n.TopTitle;else return;this.Direction==1?this.Canvas.textBaseline="bottom":this.Direction==2?this.Canvas.textBaseline="top":this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.font=this.TextFont,this.Canvas.fillStyle=this.Color,this.DrawText(this.DrawData.Text,a,s,r)}},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(this.Name=="DRAWTEXTREL"||this.Name=="DRAWTEXTABS"){this.DrawRectText();return}if(this.Position){this.DrawPosition();return}if(!(!this.Data||!this.Data.Data)){var r=this.ChartFrame.IsHScreen===!0,n=this.IsMinuteFrame(),e=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetLeft()+t/2+m.FrameLeftMargin,s=this.ChartBorder.GetRight(),o=this.ChartBorder.GetTopEx(),h=this.ChartBorder.GetBottomEx();r&&(s=this.ChartBorder.GetBottom(),o=this.ChartBorder.GetRightEx(),h=this.ChartBorder.GetLeftEx(),a=this.ChartBorder.GetTop()+t/2+m.FrameLeftMargin);var l=this.ChartFrame.XPointCount,u=Array.isArray(this.Text),f=V(),C={Text:{},Font:{}};if(this.Direction==1?(this.Canvas.textBaseline="bottom",C.Text={Baseline:"bottom"}):this.Direction==2?(this.Canvas.textBaseline="top",C.Text={Baseline:"top"}):(this.Canvas.textBaseline="middle",C.Text={Baseline:"middle"}),this.IconFont){if(this.Color=this.IconFont.Color,this.Text=this.IconFont.Text,this.FixedFontSize>0)var D=this.FixedFontSize;else var D=this.GetDynamicIconSize(e,t,this.IconSize.Max,this.IconSize.Min,this.IconSize.Zoom);this.Canvas.font=D+"px "+this.IconFont.Family}else this.FixedFontSize>0?this.TextFont=this.FixedFontSize+"px "+this.TextSize.FontName:this.TextFont=this.GetDynamicFont(e,t,this.TextSize.Max,this.TextSize.Min,this.TextSize.Zoom,this.TextSize.FontName),this.Canvas.font=this.TextFont;C.Font={Height:this.GetFontHeight()};for(var v=this.Data.DataOffset,S=0;v<this.Data.Data.length&&S<l;++v,++S,a+=e+t){var T=this.Data.Data[v];if(T!=null){if(n)var I=this.ChartFrame.GetXFromIndex(S);else{var F=a,E=a+e;if(E>s)break;var I=F+(E-F)/2}var M=this.ChartFrame.GetYFromData(T);if(I>s)break;if(M+=this.ShowOffset.Y,I+=this.ShowOffset.X,this.Canvas.textAlign=this.TextAlign,this.Canvas.fillStyle=this.Color,C.Text.Color=this.Color,C.Text.Align=this.TextAlign,C.X=I,C.Y=M,this.YOffset>0&&this.Direction>0){var O=M;this.Canvas.setLineDash([5,10]),this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),r?(this.Direction==1?(M=o-this.YOffset*f,O+=5*f):(M=h+this.YOffset*f,O-=5*f),this.Canvas.moveTo(L(O),L(I)),this.Canvas.lineTo(L(M),L(I))):(this.Direction==1?(M=o+this.YOffset*f,O+=5*f):(M=h-this.YOffset*f,O-=5*f),this.Canvas.moveTo(L(I),L(O)),this.Canvas.lineTo(L(I),L(M))),this.Canvas.stroke(),this.Canvas.setLineDash([])}if(u){var R=this.Text[v];if(!R)continue;this.Name=="DRAWNUMBER"&&(this.Direction==1?M-=m.DRAWABOVE.YOffset*f:this.Direction==2&&(M+=this.TextSize.YOffset*f)),this.Name=="DRAWTEXT"?this.DrawTextV2(R,C,r):this.DrawText(R,I,M,r)}else this.Name=="DRAWICON"?this.Direction==1?M-=m.DRAWABOVE.YOffset*f:this.Direction==2&&(this.IconFont?M+=this.IconSize.YOffset*f:M+=this.TextSize.YOffset*f):this.Name=="DRAWTEXT"&&(this.Direction==1?M-=m.DRAWABOVE.YOffset*f:this.Direction==2&&(M+=this.TextSize.YOffset*f)),this.Name=="DRAWTEXT"?this.DrawTextV2(this.Text,C,r):this.DrawText(this.Text,I,M,r)}}}}},this.DrawPosition=function(){if(this.Text){var r=this.ChartFrame.IsHScreen===!0;if(r)var n=this.ChartBorder.GetRightEx()-this.ChartBorder.GetWidthEx()*this.Position.Y,e=this.ChartBorder.GetTop()+this.ChartBorder.GetHeight()*this.Position.X;else var e=this.ChartBorder.GetLeft()+this.ChartBorder.GetWidth()*this.Position.X,n=this.ChartBorder.GetTopEx()+this.ChartBorder.GetHeightEx()*this.Position.Y;if(this.Canvas.fillStyle=this.Color,this.Name=="DRAWTEXT_FIX"?this.Canvas.font=this.Font.DRAWTEXT_FIX:this.Name=="DRAWNUMBER_FIX"&&(this.Canvas.font=this.Font.DRAWNUMBER_FIX),this.Position.Type==0?this.Canvas.textAlign="left":this.Position.Type==1?this.Canvas.textAlign="right":this.Canvas.textAlign="center",this.Direction==1?this.Canvas.textBaseline="bottom":this.Direction==2?this.Canvas.textBaseline="top":this.Canvas.textBaseline="middle",Array.isArray(this.Text)){if(!this.Data||!this.Data.Data)return;for(var t=this.ChartFrame.XPointCount,a=this.Data.DataOffset,s=0;a<this.Data.Data.length&&s<t;++a,++s){var o=this.Text[a];if(o){this.DrawText(o,e,n,r);break}}}else this.DrawText(this.Text,e,n,r)}},this.DrawText=function(r,n,e,t){t?(this.Canvas.save(),this.Canvas.translate(e,n),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(r,0,0),this.Canvas.restore()):this.Canvas.fillText(r,n,e)},this.DrawTextV2=function(r,n,e){var t=this.Canvas.measureText(r).width;if(e){var a=n.Y,s=n.X;if(n.Text.Align=="right"?s=s-t:n.Text.Align=="center"&&(s=s-t/2),n.Text.Baseline=="top"?a-=n.Font.Height:n.Text.Baseline=="middle"&&(a-=n.Font.Height/2),this.TextBG&&(this.TextBG.Color||this.TextBG.Border)){var o=this.TextBG.Margin,h=a-o[0],l=s-o[2],u=t+o[2]+o[3],f=n.Font.Height+o[0]+o[1];this.TextBG.Color&&(this.Canvas.fillStyle=this.TextBG.Color,this.Canvas.fillRect(h,l,f,u)),this.TextBG.Border&&(this.Canvas.strokeStyle=this.TextBG.Border,this.Canvas.strokeRect(L(h),L(l),B(f),B(u)))}this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.fillStyle=n.Text.Color,this.Canvas.save(),this.Canvas.translate(a,s),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(r,0,0),this.Canvas.restore()}else{var a=n.X,s=n.Y;if(n.Text.Align=="right"?a=a-t:n.Text.Align=="center"&&(a=a-t/2),n.Text.Baseline=="top"?s+=n.Font.Height:n.Text.Baseline=="middle"&&(s+=n.Font.Height/2),this.TextBG&&(this.TextBG.Color||this.TextBG.Border)){var o=this.TextBG.Margin,h=a-o[2],l=s-n.Font.Height-o[1],u=t+o[2]+o[3],f=n.Font.Height+o[0]+o[1];this.TextBG.Color&&(this.Canvas.fillStyle=this.TextBG.Color,this.Canvas.fillRect(h,l,u,f)),this.TextBG.Border&&(this.Canvas.strokeStyle=this.TextBG.Border,this.Canvas.strokeRect(L(h),L(l),B(u),B(f)))}this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.fillStyle=n.Text.Color,this.Canvas.fillText(r,a,s)}}}function Vh(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawText",this.Color="rgb(255,193,37)",this.TextFont="14px 微软雅黑",this.TextBaseline="middle",this.TextAlign="left",this.Text,this.TextBG,this.FixedFontSize=-1,this.YOffset=0,this.FixedPosition=-1,this.VerticalLine,this.ShowOffset={X:0,Y:0},this.ExportData=this.ExportBoolData,this.TextSize={Max:m.DRAWICON.Text.MaxSize,Min:m.DRAWICON.Text.MinSize,Zoom:{Type:m.DRAWICON.Text.Zoom.Type,Value:m.DRAWICON.Text.Zoom.Value},FontName:m.DRAWICON.Text.FontName,YOffset:m.DRAWICON.Text.YOffset},this.ReloadResource=function(r){this.TextSize={Max:m.DRAWTEXT.MaxSize,Min:m.DRAWTEXT.MinSize,Zoom:{Type:m.DRAWTEXT.Zoom.Type,Value:m.DRAWTEXT.Zoom.Value},FontName:m.DRAWTEXT.FontName,YOffset:m.DRAWTEXT.YOffset}},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){var r=this.ChartFrame.IsHScreen===!0,n=this.IsMinuteFrame(),e=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetLeft()+t/2+m.FrameLeftMargin,s=this.ChartBorder.GetRight(),o=this.ChartBorder.GetTopEx(),h=this.ChartBorder.GetBottomEx();r&&(s=this.ChartBorder.GetBottom(),o=this.ChartBorder.GetRightEx(),h=this.ChartBorder.GetLeftEx(),a=this.ChartBorder.GetTop()+t/2+m.FrameLeftMargin);var l=this.ChartFrame.XPointCount,u=Array.isArray(this.Text),f={Text:{Color:this.Color,Align:this.TextAlign,Baseline:this.TextBaseline},Font:{}};this.FixedFontSize>0?this.TextFont=this.FixedFontSize+"px "+this.TextSize.FontName:this.TextFont=this.GetDynamicFont(e,t,this.TextSize.Max,this.TextSize.Min,this.TextSize.Zoom,this.TextSize.FontName),this.Canvas.font=this.TextFont,f.Font={Height:this.GetFontHeight()};for(var C=this.Data.DataOffset,D=0;C<this.Data.Data.length&&D<l;++C,++D,a+=e+t){var v=this.Data.Data[C];if(v!=null){if(n)var S=this.ChartFrame.GetXFromIndex(D);else{var T=a,I=a+e;if(I>s)break;var S=T+(I-T)/2}var F;if(this.FixedPosition===1?F=o:this.FixedPosition===2?F=h:F=this.ChartFrame.GetYFromData(v),S>s)break;if(F+=this.ShowOffset.Y,S+=this.ShowOffset.X,f.X=S,f.Y=F,u){var E=this.Text[C];if(!E)continue;this.DrawText(E,f,r)}else this.DrawText(this.Text,f,r);this.DrawVerticalLine(C,f,r)}}}}},this.DrawText=function(r,n,e){var t=this.Canvas.measureText(r).width;if(e){var a=n.Y,s=n.X;if(n.Text.Align=="right"?s=s-t:n.Text.Align=="center"&&(s=s-t/2),n.Text.Baseline=="top"?a-=n.Font.Height:n.Text.Baseline=="middle"&&(a-=n.Font.Height/2),this.TextBG&&(this.TextBG.Color||this.TextBG.Border)){var o=this.TextBG.Margin,h=a-o[0],l=s-o[2],u=t+o[2]+o[3],f=n.Font.Height+o[0]+o[1];this.TextBG.Color&&(this.Canvas.fillStyle=this.TextBG.Color,this.Canvas.fillRect(h,l,f,u)),this.TextBG.Border&&(this.Canvas.strokeStyle=this.TextBG.Border,this.Canvas.strokeRect(L(h),L(l),B(f),B(u))),n.Rect={Bottom:h,Top:h+f}}else{var h=a,f=n.Font.Height;n.Rect={Bottom:h,Top:h+f}}this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.fillStyle=n.Text.Color,this.Canvas.save(),this.Canvas.translate(a,s),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(r,0,0),this.Canvas.restore()}else{var a=n.X,s=n.Y;if(n.Text.Align=="right"?a=a-t:n.Text.Align=="center"&&(a=a-t/2),n.Text.Baseline=="top"?s+=n.Font.Height:n.Text.Baseline=="middle"&&(s+=n.Font.Height/2),this.TextBG&&(this.TextBG.Color||this.TextBG.Border)){var o=this.TextBG.Margin,h=a-o[2],l=s-n.Font.Height-o[1],u=t+o[2]+o[3],f=n.Font.Height+o[0]+o[1];this.TextBG.Color&&(this.Canvas.fillStyle=this.TextBG.Color,this.Canvas.fillRect(h,l,u,f)),this.TextBG.Border&&(this.Canvas.strokeStyle=this.TextBG.Border,this.Canvas.strokeRect(L(h),L(l),B(u),B(f))),n.Rect={Top:l,Bottom:l+f}}else{var l=s-n.Font.Height,f=n.Font.Height;n.Rect={Top:l,Bottom:l+f}}this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.fillStyle=n.Text.Color,this.Canvas.fillText(r,a,s)}},this.DrawVerticalLine=function(r,n,e){if(this.VerticalLine){var t=this.VerticalLine.Data[r];if(t&&c.IsNumber(t.High)&&c.IsNumber(t.Low)){var a=this.ChartFrame.GetYFromData(t.High),s=this.ChartFrame.GetYFromData(t.Low),o,h;if(e)if(n.Rect.Bottom>a)o=n.Rect.Bottom-1,h=a+1;else if(n.Rect.Top<s)o=n.Rect.Top-1,h=s-1;else return;else if(n.Rect.Bottom<a)o=n.Rect.Bottom+1,h=a-1;else if(n.Rect.Top>s)o=n.Rect.Top-1,h=s+1;else return;this.Canvas.save();var l=V(),u=n.X;this.VerticalLine.LineType==1&&(this.VerticalLine.LineDotted?this.Canvas.setLineDash(this.VerticalLine.LineDotted):this.Canvas.setLineDash([5,10])),c.IsPlusNumber(this.VerticalLine.LineWidth)&&(this.Canvas.lineWidth=this.VerticalLine.LineWidth*l),this.Canvas.strokeStyle=this.VerticalLine.Color,this.Canvas.beginPath(),e?(this.Canvas.moveTo(L(o),L(u)),this.Canvas.lineTo(L(h),L(u))):(this.Canvas.moveTo(L(u),L(o)),this.Canvas.lineTo(L(u),L(h))),this.Canvas.stroke(),this.Canvas.restore()}}}}function ed(){this.newMethod=Vh,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawNumber",this.ReloadResource=function(r){this.TextSize={Max:m.DRAWNUMBER.MaxSize,Min:m.DRAWNUMBER.MinSize,Zoom:{Type:m.DRAWNUMBER.Zoom.Type,Value:m.DRAWNUMBER.Zoom.Value},FontName:m.DRAWNUMBER.FontName,YOffset:m.DRAWNUMBER.YOffset}}}function ad(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartStraightLine",this.Color="rgb(255,193,37)",this.Draw=function(){if(!(!this.Data||!this.Data.Data)&&this.Data.Data.length==1){this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight();var r=this.ChartFrame.XPointCount,n=this.Data.Data[0],e=this.ChartFrame.GetYFromData(n),t=this.ChartFrame.GetXFromIndex(0),a=this.ChartFrame.GetXFromIndex(r-1),s=parseInt(e.toString())+.5;this.Canvas.beginPath(),this.Canvas.moveTo(t,s),this.Canvas.lineTo(a,s),this.Canvas.strokeStyle=this.Color,this.Canvas.stroke()}},this.GetMaxMin=function(){this.ChartFrame.XPointCount;var r={};return r.Min=null,r.Max=null,!this.Data||!this.Data.Data||this.Data.Data.length!=1||(r.Min=this.Data.Data[0],r.Max=this.Data.Data[0]),r}}function IC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartStraightArea",this.Color="rgb(255,193,37)",this.Font="11px 微软雅黑",this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){if(this.ChartFrame.IsHScreen===!0){this.HScreenDraw();return}this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight(),this.ChartBorder.GetBottom();var r=this.ChartBorder.GetLeft(),n=this.ChartFrame.XPointCount,e=this.ChartFrame.GetXFromIndex(n-1);for(var t in this.Data.Data){var a=this.Data.Data[t];if(!(a==null||isNaN(a.Value)||isNaN(a.Value2))&&a.Color!=null){var s=Math.max(a.Value,a.Value2),o=Math.min(a.Value,a.Value2),h=this.ChartFrame.GetYFromData(s),l=this.ChartFrame.GetYFromData(o);if(this.Canvas.fillStyle=a.Color,this.Canvas.fillRect(B(r),B(h),B(e-r),B(l-h)),a.Title&&a.TitleColor){this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=a.TitleColor,this.Canvas.font=this.Font;var u=h+(l-h)/2;this.Canvas.fillText(a.Title,e,u)}}}}}},this.HScreenDraw=function(){var r=this.ChartBorder.GetBottom(),n=this.ChartBorder.GetTop(),e=this.ChartBorder.GetHeight();for(var t in this.Data.Data){var a=this.Data.Data[t];if(!(a==null||isNaN(a.Value)||isNaN(a.Value2))&&a.Color!=null){var s=Math.max(a.Value,a.Value2),o=Math.min(a.Value,a.Value2),h=this.ChartFrame.GetYFromData(s),l=this.ChartFrame.GetYFromData(o);if(this.Canvas.fillStyle=a.Color,this.Canvas.fillRect(B(l),B(n),B(h-l),B(e)),a.Title&&a.TitleColor){var u=h+(l-h)/2,f=r;this.Canvas.save(),this.Canvas.translate(u,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=a.TitleColor,this.Canvas.font=this.Font,this.Canvas.fillText(a.Title,0,-2),this.Canvas.restore()}}}},this.GetMaxMin=function(){this.ChartFrame.XPointCount;var r={};if(r.Min=null,r.Max=null,!this.Data||!this.Data.Data)return r;for(var n in this.Data.Data){var e=this.Data.Data[n];if(!(e==null||isNaN(e.Value)||isNaN(e.Value2))){var t=Math.max(e.Value,e.Value2),a=Math.min(e.Value,e.Value2);r.Max==null&&(r.Max=t),r.Min==null&&(r.Min=a),r.Max<t&&(r.Max=t),r.Min>a&&(r.Min=a)}}return r}}function Hh(){this.newMethod=Ye,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinutePriceLine",this.YClose,this.IsDrawArea=!0,this.AreaColor="rgba(0,191,255,0.1)",this.IsShowLead=!1,this.LeadData,this.UpColor=m.UpBarColor,this.DownColor=m.DownBarColor,this.BeforeOpenData,this.BeforeLineColor=m.Minute.Before.LineColor,this.BeforeAvPriceColor=m.Minute.Before.AvPriceColor,this.BeforePoint=ne(m.Minute.Before.Point),this.AfterCloseData,this.AfterLineColor=m.Minute.After.LineColor,this.AfterAvPriceColor=m.Minute.After.AvPriceColor,this.AfterPoint=ne(m.Minute.After.Point),this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.ColorLineData,this.Source,this.PtInChart=this.PtInLine,this.DrawSelectedStatus=this.DrawLinePoint,this.PtInChart=this.PtInLine,this.DrawSelectedStatus=this.DrawLinePoint,this.DayOffset,this.LastPoint={},this.FFMChart,this.DrawType=0,this.UpdateLastPoint=function(r,n,e,t){c.IsNumber(this.LastPoint.DateTime)&&this.LastPoint.DateTime>r||(this.LastPoint.DateTime=r,this.LastPoint.X=n,this.LastPoint.Y=e,this.LastPoint.Data=t,this.LastPoint.Value=t.Value)},this.Draw=function(){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(this.LastPoint={},!!this.IsShow){if(this.DrawType==14){this.FFMChart&&this.FFMChart.Draw&&this.FFMChart.Draw(this);return}var r=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight(),r===!0&&this.ChartBorder.GetBottom();var n=this.ChartFrame.XPointCount,e=this.ChartFrame.MinuteCount,t=this.ChartBorder.GetBottomEx(),a=this.ChartBorder.GetLeftEx(),s=this.Data;if(this.DrawBeforeOpen(),this.DrawMultiDayBeforeOpen(),this.IsShowLead&&this.DrawLead(),!!s){var o=!0,h={},l=0,u=0;this.Canvas.save(),c.IsPlusNumber(this.LineWidth>0)&&(this.Canvas.lineWidth=this.LineWidth);for(var f=s.DataOffset,C=0;f<s.Data.length&&C<n;++f,++C){var D=null;if(D=s.Data[f],++u,D!=null){var v=this.ChartFrame.GetXFromIndex(C),S=this.ChartFrame.GetYFromData(D);if(o?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),r?this.Canvas.moveTo(S,v):this.Canvas.moveTo(v,S),o=!1,h={X:v,Y:S}):r?this.Canvas.lineTo(S,v):this.Canvas.lineTo(v,S),this.Source){var T=this.Source.Data[f],I=T.Date*1e6+T.Time*100;this.UpdateLastPoint(I,v,S,{Value:D,Index:f,Date:T.Date,Time:T.Time,Type:0,Explain:"盘中"})}++l,u>=e&&(o=!0,this.Canvas.stroke(),this.IsDrawArea&&(r?(this.Canvas.lineTo(a,v),this.Canvas.lineTo(a,h.X),this.SetFillStyle(this.AreaColor,this.ChartBorder.GetRightEx(),t,this.ChartBorder.GetLeftEx(),t)):(this.Canvas.lineTo(v,t),this.Canvas.lineTo(h.X,t),this.SetFillStyle(this.AreaColor,a,this.ChartBorder.GetTopEx(),a,t)),this.Canvas.fill()),u=0,l=0)}}if(l>0&&(l==1?(this.Canvas.beginPath(),r?this.Canvas.arc(h.Y,h.X,1,0,360,!1):this.Canvas.arc(h.X,h.Y,1,0,360,!1),this.Canvas.closePath(),this.Canvas.fillStyle=this.Color,this.Canvas.fill()):(this.Canvas.stroke(),this.IsDrawArea&&(r?(this.Canvas.lineTo(a,v),this.Canvas.lineTo(a,h.X),this.SetFillStyle(this.AreaColor,this.ChartBorder.GetRightEx(),t,this.ChartBorder.GetLeftEx(),t)):(this.Canvas.lineTo(v,t),this.Canvas.lineTo(h.X,t),this.SetFillStyle(this.AreaColor,a,this.ChartBorder.GetTopEx(),a,t)),this.Canvas.fill()))),this.Canvas.restore(),this.DrawColorLine(),this.DrawAfterClose(),this.DrawMultiDayAfterClose(),this.GetEventCallback){var F=this.GetEventCallback(et.ON_DRAW_MINUTE_LAST_POINT);if(F){var s={LastPoint:{X:this.LastPoint.X,Y:this.LastPoint.Y},Price:this.LastPoint.Price,Data:this.LastPoint.Data};F.Callback(F,s,this)}}}}},this.DrawLead=function(){if(this.LeadData){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.XPointCount,e=this.ChartFrame.MinuteCount;this.ChartBorder.GetBottomEx();var t=this.ChartBorder.GetTopEx();if(r===!0&&(t=this.ChartBorder.GetRightEx()),!(n>e)){for(var a=[],s=null,o=null,h=this.ChartFrame.GetYFromData(this.YClose),l=(h-t)/3,u=this.LeadData,f=u.DataOffset,C=0;f<u.Data.length&&C<n;++f,++C){var D=u.Data[f];if(c.IsNumber(D)&&D!=0){var v=this.ChartFrame.GetXFromIndex(C);(s==null||s<D)&&(s=D),(o==null||o>D)&&(o=D),a.push({X:v,Value:D})}}if(!(a.length<=0)){var S=Math.max(Math.abs(s),Math.abs(o));for(var f in a){var T=a[f];T.Value>0?this.Canvas.strokeStyle=this.UpColor:this.Canvas.strokeStyle=this.DownColor;var I=h-T.Value*l/S,v=L(T.X);this.Canvas.beginPath(),r===!0?(this.Canvas.moveTo(h,v),this.Canvas.lineTo(I,v)):(this.Canvas.moveTo(v,h),this.Canvas.lineTo(v,I)),this.Canvas.stroke()}}}}},this.DrawBeforeOpen=function(){this.ChartBorder.LeftExtendWidth<10||this.BeforeOpenData&&this.DrawCallAuction(-1,this.BeforeOpenData,!0)},this.DrawAfterClose=function(){this.ChartBorder.RightExtendWidth<10||this.AfterCloseData&&this.DrawCallAuction(-1,this.AfterCloseData,!1)},this.DrawMultiDayBeforeOpen=function(){if(!(this.ChartBorder.MultiDayMinute.Count<=1||this.ChartBorder.MultiDayMinute.Left<=0)&&this.MultiDayBeforeOpenData){var r=0,n=this.MultiDayBeforeOpenData.length;this.DayOffset&&(c.IsNumber(this.DayOffset.Offset)&&(r=this.DayOffset.Offset),c.IsNumber(this.DayOffset.ShowDayCount)&&(n=this.DayOffset.ShowDayCount));for(var e=r,t=0;e<this.MultiDayBeforeOpenData.length&&t<n;++e,++t){var a=this.MultiDayBeforeOpenData[e];this.DrawCallAuction(t,a,!0)}}},this.DrawMultiDayAfterClose=function(){if(!(this.ChartBorder.MultiDayMinute.Count<=1||this.ChartBorder.MultiDayMinute.Right<=0)&&this.MultiDayAfterCloseData){var r=0,n=this.MultiDayAfterCloseData.length;this.DayOffset&&(c.IsNumber(this.DayOffset.Offset)&&(r=this.DayOffset.Offset),c.IsNumber(this.DayOffset.ShowDayCount)&&(n=this.DayOffset.ShowDayCount));for(var e=r,t=0;e<this.MultiDayAfterCloseData.length&&t<n;++e,++t){var a=this.MultiDayAfterCloseData[e];this.DrawCallAuction(t,a,!1)}}},this.DrawCallAuction=function(r,n,e){if(n){n.Index=r;var t=this.ChartFrame.IsHScreen===!0,l=!0,u=0;if(n.TotalCount,n.Ver==3){for(var a=0;a<n.Data.length;++a){var s=n.Data[a];if(!(!s||!c.IsNumber(s.AvPrice))){if(e)var o=this.ChartFrame.GetLeftExtendXFromIndex(a,n),h=this.ChartFrame.GetLeftExtendYFromData(s.AvPrice);else var o=this.ChartFrame.GetRightExtendXFromIndex(a,n),h=this.ChartFrame.GetRightExtendYFromData(s.AvPrice);l?(this.Canvas.strokeStyle=this.BeforeAvPriceColor,this.Canvas.beginPath(),t?this.Canvas.moveTo(h,o):this.Canvas.moveTo(o,h),l=!1):t?this.Canvas.lineTo(h,o):this.Canvas.lineTo(o,h),++u}}u>0&&this.Canvas.stroke()}for(var l=!0,u=0,f=[],a=0;a<n.Data.length;++a){var s=n.Data[a];if(!s||!c.IsNumber(s.Price)){if(a==0&&e&&c.IsNumber(this.YClose)){var o=this.ChartFrame.GetLeftExtendXFromIndex(a,n),h=this.ChartFrame.GetLeftExtendYFromData(this.YClose);this.Canvas.strokeStyle=this.BeforeLineColor,this.Canvas.beginPath(),t?this.Canvas.moveTo(h,o):this.Canvas.moveTo(o,h),l=!1}continue}if(e)var o=this.ChartFrame.GetLeftExtendXFromIndex(a,n),h=this.ChartFrame.GetLeftExtendYFromData(s.Price);else var o=this.ChartFrame.GetRightExtendXFromIndex(a,n),h=this.ChartFrame.GetRightExtendYFromData(s.Price);l?(this.Canvas.strokeStyle=e?this.BeforeLineColor:this.AfterLineColor,this.Canvas.beginPath(),t?this.Canvas.moveTo(h,o):this.Canvas.moveTo(o,h),l=!1,f.push({X:o,Y:h})):(t?this.Canvas.lineTo(h,o):this.Canvas.lineTo(o,h),f.push({X:o,Y:h}));var C=s.Date*1e6+s.Time;this.UpdateLastPoint(C,o,h,{Value:s.Price,Index:a,Date:s.Date,Time:s.Time,Type:e?1:2,Explain:e?"盘前":"盘后"}),++u}if(u>0&&this.Canvas.stroke(),n.Ver==2&&this.BeforePoint.Radius>0){this.Canvas.fillStyle=e?this.BeforePoint.Color:this.AfterPoint.Color;for(var a in f){var s=f[a];this.Canvas.beginPath(),t?this.Canvas.arc(s.Y,s.X,this.BeforePoint.Radius,0,2*Math.PI):this.Canvas.arc(s.X,s.Y,this.BeforePoint.Radius,0,2*Math.PI),this.Canvas.fill()}}}},this.FindColorLineItem=function(r){if(!r||!this.ColorLineData)return null;for(var n in this.ColorLineData){var e=this.ColorLineData[n];if(e.Date==r.Date&&r.Time>=e.Start&&r.Time<=e.End)return e}return null},this.DrawColorLine=function(){if(!(!this.ColorLineData||!this.Source||!this.Data)){var r=this.ChartFrame.IsHScreen===!0;this.ChartBorder.GetBorder();var n=this.ChartFrame.XPointCount;this.ChartFrame.MinuteCount;var e=this.Data,t=!0,a=0,s=null;this.Canvas.save();for(var o=e.DataOffset,h=0;o<e.Data.length&&h<n;++o,++h){var l=null;l=e.Data[o];var u=this.Source.Data[o];if(!(!l||!u)){var f=this.FindColorLineItem(u);if(!f){a>0&&(this.Canvas.stroke(),t=!0);continue}s&&s!=f.Color&&(this.Canvas.stroke(),t=!0);var C=this.ChartFrame.GetXFromIndex(h),D=this.ChartFrame.GetYFromData(l);t?(this.Canvas.strokeStyle=f.Color,c.IsNumber(f.LineWidth)&&(this.Canvas.lineWidth=f.LineWidth),this.Canvas.beginPath(),r?this.Canvas.moveTo(D,C):this.Canvas.moveTo(C,D),t=!1,s=f.Color):r?this.Canvas.lineTo(D,C):this.Canvas.lineTo(C,D),++a}}a>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.GetMaxMin=function(){if(this.DrawType==14&&this.FFMChart&&this.FFMChart.GetMaxMin)return this.FFMChart.GetMaxMin(this);var r=this.ChartFrame.XPointCount,n={};if(this.YClose==null||!this.IsShow)return n;if(n.Min=this.YClose,n.Max=this.YClose,this.ChartBorder.LeftExtendWidth>10&&this.BeforeOpenData)for(var e in this.BeforeOpenData.Data){var t=this.BeforeOpenData.Data[e];t&&(c.IsNumber(t.Price)&&(n.Max==null&&(n.Max=t.Price),n.Min==null&&(n.Min=t.Price),n.Max<t.Price&&(n.Max=t.Price),n.Min>t.Price&&(n.Min=t.Price)),this.BeforeOpenData.Ver==3&&c.IsNumber(t.AvPrice)&&(n.Max==null&&(n.Max=t.AvPrice),n.Min==null&&(n.Min=t.AvPrice),n.Max<t.AvPrice&&(n.Max=t.AvPrice),n.Min>t.AvPrice&&(n.Min=t.AvPrice)))}for(var a=this.Data,e=a.DataOffset,s=0;e<a.Data.length&&s<r;++e,++s){var o=null;o=a.Data[e],o!=null&&(n.Max==null&&(n.Max=o),n.Min==null&&(n.Min=o),n.Max<o&&(n.Max=o),n.Min>o&&(n.Min=o))}if(n.Max==this.YClose&&n.Min==this.YClose)return n.Max=this.YClose+this.YClose*.1,n.Min=this.YClose-this.YClose*.1,n;var h=Math.max(Math.abs(this.YClose-n.Max),Math.abs(this.YClose-n.Min));return n.Max=this.YClose+h,n.Min=this.YClose-h,n},this.GetTooltipData=function(r,n,e){var t=this.ChartFrame.IsHScreen===!0;if(t||!this.IsShow||!this.Data||!c.IsNonEmptyArray(this.Data.Data))return!1;var a=this.ChartBorder.PtInClient(r,n,this.Canvas,t);if(a!=1)return!1;var s=this.Data,o=this.ChartFrame.GetXData(r),h=Math.ceil(o),l=Math.floor(o);if(h>=s.Data.length||l>=s.Data.length)return!1;var u=5;if(h==l)s.Data[l];else{var f=s.Data[l],C=s.Data[h],D={X:this.ChartFrame.GetXFromIndex(l),Y:this.ChartFrame.GetYFromData(f)},v={X:this.ChartFrame.GetXFromIndex(h),Y:this.ChartFrame.GetYFromData(C)};if(this.Canvas.beginPath(),this.Canvas.moveTo(D.X,D.Y+u),this.Canvas.lineTo(D.X,D.Y-u),this.Canvas.lineTo(v.X,v.Y-u),this.Canvas.lineTo(v.X,v.Y+u),this.Canvas.closePath(),this.Canvas.isPointInPath(r,n))return e.Data={Index:o,Start:{Index:l,Item:s.Data[l]},End:{Index:h,Value:s.Data[h]}},e.ChartPaint=this,e.Type=5,!0}return!1}}function id(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.Color="rgb(65,105,225)",this.MainData,this.MainYClose,this.SourceData,this.ClassName="ChartOverlayMinutePriceLine",this.Title,this.Symbol,this.YClose,this.Status=Ie.STATUS_NONE_ID,this.OverlayType=0,this.IsCalcuateMaxMin=!0,this.SetOption=function(r){r&&(c.IsNumber(r.OverlayType)&&(this.OverlayType=r.OverlayType),c.IsBool(r.IsCalcuateMaxMin)&&(this.IsCalcuateMaxMin=r.IsCalcuateMaxMin))},this.PtInChart=function(r,n){var e={MinuteOverlayPrice:!0,YClose:this.YClose,MainYClose:this.MainYClose,OverlayType:this.OverlayType};return this.PtInLine(r,n,e)},this.DrawSelectedStatus=function(){var r={MinuteOverlayPrice:!0,YClose:this.YClose,MainYClose:this.MainYClose,OverlayType:this.OverlayType};this.DrawLinePoint(r)},this.Draw=function(){if(this.Data){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}var r=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight(),r===!0&&this.ChartBorder.GetBottom();var n=this.ChartFrame.XPointCount,e=this.ChartFrame.MinuteCount;this.Canvas.save(),this.ClipClient(r);for(var t=!0,a=0,s=0,o=0,h=this.Data.DataOffset+s,l=0;h<this.Data.Data.length&&l<n;++h,++l){var u=this.Data.Data[h].Close;if(u!=null){o=u,this.OverlayType==0&&(o=u/this.YClose*this.MainYClose);var f=this.ChartFrame.GetXFromIndex(l),C=this.ChartFrame.GetYFromData(o,!1);t?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),r?this.Canvas.moveTo(C,f):this.Canvas.moveTo(f,C),t=!1):r?this.Canvas.lineTo(C,f):this.Canvas.lineTo(f,C),++a,a>=e&&(t=!0,this.Canvas.stroke(),a=0)}}a>0&&this.Canvas.stroke(),this.Canvas.restore()}},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n={};if(!this.IsCalcuateMaxMin||this.YClose==null)return n;n.Min=this.MainYClose,n.Max=this.MainYClose;for(var e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e].Close;a!=null&&(this.OverlayType==0&&(a=a/this.YClose*this.MainYClose),n.Max==null&&(n.Max=a),n.Min==null&&(n.Min=a),n.Max<a&&(n.Max=a),n.Min>a&&(n.Min=a))}return n},this.GetTooltipData=function(r,n,e){var t=this.ChartFrame.IsHScreen===!0;if(t||!this.IsShow||!this.Data||!c.IsNonEmptyArray(this.Data.Data)||!c.IsNumber(this.YClose)||!c.IsNumber(this.MainYClose))return!1;var a=this.ChartBorder.PtInClient(r,n,this.Canvas,t);if(a!=1)return!1;var s=this.Data,o=this.ChartFrame.GetXData(r),h=Math.ceil(o),l=Math.floor(o);if(h>=s.Data.length||l>=s.Data.length)return!1;var u=5;if(h==l)s.Data[l];else{var f=s.Data[l].Close;f=f/this.YClose*this.MainYClose;var C=s.Data[h].Close;C=C/this.YClose*this.MainYClose;var D={X:this.ChartFrame.GetXFromIndex(l),Y:this.ChartFrame.GetYFromData(f)},v={X:this.ChartFrame.GetXFromIndex(h),Y:this.ChartFrame.GetYFromData(C)};if(this.Canvas.beginPath(),this.Canvas.moveTo(D.X,D.Y+u),this.Canvas.lineTo(D.X,D.Y-u),this.Canvas.lineTo(v.X,v.Y-u),this.Canvas.lineTo(v.X,v.Y+u),this.Canvas.closePath(),this.Canvas.isPointInPath(r,n))return e.Data={Index:o,Start:{Index:l,Item:s.Data[l]},End:{Index:h,Value:s.Data[h]}},e.ChartPaint=this,e.Type=6,!0}return!1}}function Uu(){this.newMethod=Ye,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinutePositionLine",this.Draw=function(){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(this.IsShow){var r=this.ChartFrame.IsHScreen===!0;this.ChartFrame.DataWidth,this.ChartFrame.DistanceWidth,this.ChartBorder.GetRight(),r===!0&&this.ChartBorder.GetBottom();var n=this.ChartFrame.XPointCount,e=this.ChartFrame.MinuteCount;this.ChartBorder.GetBottomEx(),this.ChartBorder.GetLeftEx();var t=this.Data;if(t){var a=!0,s={},o=0,h=0;this.Canvas.save(),c.IsPlusNumber(this.LineWidth>0)&&(this.Canvas.lineWidth=this.LineWidth),this.IsDotLine&&this.Canvas.setLineDash(m.DOTLINE.LineDash);for(var l=t.DataOffset,u=0;l<t.Data.length&&u<n;++l,++u){var f=null;if(f=t.Data[l],++h,f!=null){var C=this.ChartFrame.GetXFromIndex(u),D=this.ChartFrame.GetYFromData(f);a?(this.Canvas.strokeStyle=this.Color,this.Canvas.beginPath(),r?this.Canvas.moveTo(D,C):this.Canvas.moveTo(C,D),a=!1,s={X:C,Y:D}):r?this.Canvas.lineTo(D,C):this.Canvas.lineTo(C,D),++o,h>=e&&(a=!0,this.Canvas.stroke(),h=0,o=0)}}o>0&&(o==1?(this.Canvas.beginPath(),r?this.Canvas.arc(s.Y,s.X,1,0,360,!1):this.Canvas.arc(s.X,s.Y,1,0,360,!1),this.Canvas.closePath(),this.Canvas.fillStyle=this.Color,this.Canvas.fill()):this.Canvas.stroke()),this.Canvas.restore()}}}}function rd(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMinuteInfo",this.Data=new Dt.default,this.SourceData,this.ChartMinutePrice,this.YClose,this.HQChartBorder,this.TextColor=m.MinuteInfo.TextColor,this.Font=m.MinuteInfo.Font,this.PointColor=m.MinuteInfo.PointColor,this.LineColor=m.MinuteInfo.LineColor,this.TextBGColor=m.MinuteInfo.TextBGColor,this.PixelTatio=V(),this.TextHeight=20,this.TextRectCache=[],this.InfoDrawCache=[],this.FrameBottom,this.FrameTop,this.FrameLeft,this.FrameRight,this.YOffset=5,this.IsHScreen=!1,this.IsDrawFull=!1,this.TooltipRect=[],this.SetOption=function(r){r.TextColor&&(this.TextColor=r.TextColor),r.TextBGColor&&(this.TextBGColor=r.TextBGColor),r.Font&&(this.Font=r.Font),r.PointColor&&(this.PointColor=r.PointColor),r.LineColor&&(this.LineColor=r.LineColor),r.TextHeight>0&&(this.TextHeight=r.TextHeight),r.IsDrawFull==!0&&(this.IsDrawFull=!0)},this.Draw=function(){if(this.TooltipRect=[],!!this.ChartMinutePrice&&!(!this.Data||this.Data.size<=0)){this.TextRectCache=[],this.InfoDrawCache=[],this.PixelTatio=V(),this.YOffset=5*this.PixelTatio,this.IsHScreen=this.ChartFrame.IsHScreen===!0;var r=this.ChartFrame.XPointCount;this.ChartFrame.MinuteCount,this.FrameBottom=this.ChartBorder.GetBottom(),this.IsDrawFull&&this.HQChartBorder&&(this.FrameBottom=this.HQChartBorder.GetBottom()),this.FrameTop=this.ChartBorder.GetTop(),this.FrameLeft=this.ChartBorder.GetLeft(),this.FrameRight=this.ChartBorder.GetRight(),this.IsHScreen&&(this.FrameRight=this.ChartBorder.GetBottom(),this.FrameLeft=this.ChartBorder.GetTop(),this.FrameBottom=this.ChartBorder.GetLeft(),this.FrameTop=this.ChartBorder.GetRight()),this.YClose=this.ChartMinutePrice.YClose;for(var n=this.ChartMinutePrice.Source,e=n.DataOffset,t=0;e<n.Data.length&&t<r;++e,++t){var a=n.Data[e];if(a){var s=a.DateTime;this.Data.has(s)&&(this.IsHScreen?this.CalcuateInfoHScreenPosition(this.Data.get(s),t,a):this.CalcuateInfoPosition(this.Data.get(s),t,a))}}for(var e in this.InfoDrawCache){var a=this.InfoDrawCache[e];this.DrawInfoLines(a)}for(var e in this.InfoDrawCache){var a=this.InfoDrawCache[e];if(this.DrawInfoText(a),!this.IsHScreen){var o=a.Border,h=new Sa(o.X,o.Y,o.Width,o.Height),l={Data:{Item:a},Rect:h};this.TooltipRect.push(l)}}this.TextRectCache=[],this.InfoDrawCache=[]}},this.CalcuateInfoPosition=function(r,n,e){if(!(!r||!r.Data||r.Data.length<=0)){var t=r.Data[0];this.Canvas.font=this.Font;var a=this.Canvas.measureText(t.Title).width+4*this.PixelTatio,s=this.TextHeight*this.PixelTatio,o=this.ChartFrame.GetXFromIndex(n),h;c.IsNumber(t.Price)?h=this.ChartFrame.GetYFromData(t.Price):h=this.ChartFrame.GetYFromData(e.Close),o=L(o);var l=o<this.FrameLeft+Math.abs(this.FrameLeft-this.FrameRight)/2,u=[2,4,6,8,3,5,7],f=s+u[n%u.length]*this.PixelTatio,C={Y:[{Value:h+(s+this.YOffset),Offset:f},{Value:h-(2*s+this.YOffset),Offset:-f}]};e.Close<this.YClose&&(C.Y=C.Y.reverse());var D={X:o,Y:null,Width:a,Height:s};l||(D.X-=D.Width),this.FixTextRect(D,C);var v={Border:D,Start:{X:o,Y:h},IsLeft:l,Title:t.Title,Date:t.Date,Time:t.Time};t.Content&&(v.Content=t.Content),t.Link&&(v.Link=t.Link),t.Color&&(v.Color=t.Color),t.BGColor&&(v.BGColor=t.BGColor),this.InfoDrawCache.push(v),this.TextRectCache.push(D)}},this.CalcuateInfoHScreenPosition=function(r,n,e){if(!(!r||!r.Data||r.Data.length<=0)){var t=r.Data[0];this.Canvas.font=this.Font;var a=this.Canvas.measureText(t.Title).width+4*this.PixelTatio,s=this.TextHeight*this.PixelTatio,o=this.ChartFrame.GetXFromIndex(n),h;c.IsNumber(t.Price)?h=this.ChartFrame.GetYFromData(t.Price):h=this.ChartFrame.GetYFromData(e.Close),o=L(o);var l=o<this.FrameLeft+Math.abs(this.FrameLeft-this.FrameRight)/2,u=[2,4,6,8,3,5,7],f=s+u[n%u.length]*this.PixelTatio,C={X:[{Value:h+(s+this.YOffset),Offset:f},{Value:h-(2*s+this.YOffset),Offset:-f}]};e.Close>this.YClose&&(C.X=C.X.reverse());var D={X:null,Y:o,Width:s,Height:a};l||(D.Y-=D.Height),this.FixHScreenTextRect(D,C);var v={Border:D,Start:{X:h,Y:o},IsLeft:l,Title:t.Title};t.Content&&(v.Content=t.Content),t.Link&&(v.Link=t.Link),t.Color&&(v.Color=t.Color),t.BGColor&&(v.BGColor=t.BGColor),this.InfoDrawCache.push(v),this.TextRectCache.push(D)}},this.DrawInfoLines=function(r){var n=r.Border,e=r.IsLeft;this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(r.Start.X),r.Start.Y),e?this.Canvas.lineTo(L(r.Start.X),n.Y):this.IsHScreen?this.Canvas.lineTo(n.X,n.Y+n.Height):this.Canvas.lineTo(L(r.Start.X),n.Y),this.Canvas.stroke(),this.Canvas.fillStyle=this.PointColor,this.Canvas.beginPath(),this.Canvas.arc(r.Start.X,r.Start.Y,5,0,2*Math.PI),this.Canvas.closePath(),this.Canvas.fill()},this.DrawInfoText=function(r){var n=r.Border,e=n.X,t=n.Y;r.BGColor?this.Canvas.fillStyle=r.BGColor:this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(e,t,n.Width,n.Height),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.rect(e,t,n.Width,n.Height),this.Canvas.stroke(),this.IsHScreen&&(this.Canvas.save(),this.Canvas.translate(n.X,n.Y),this.Canvas.rotate(90*Math.PI/180),e=0,t=0),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",r.Color?this.Canvas.fillStyle=r.Color:this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.IsHScreen?this.Canvas.fillText(r.Title,e+2*this.PixelTatio,t-n.Width/2):this.Canvas.fillText(r.Title,e+2*this.PixelTatio,t+n.Height/2),this.IsHScreen&&this.Canvas.restore()},this.FixTextRect=function(r,n){for(var e in n.Y){var t=n.Y[e];r.Y=t.Value;for(var a,s=0;s<10;++s){var o=!1;for(var h in this.TextRectCache){var l=this.TextRectCache[h];if(this.IsOverlap(l,r)){o=!0;break}}if(o==!1)return;if(a=r.Y,a+=t.Offset,a+r.Height>this.FrameBottom||a<this.FrameTop)break;r.Y=a}}},this.FixHScreenTextRect=function(r,n){for(var e in n.X){var t=n.X[e];r.X=t.Value;for(var a,s=0;s<10;++s){var o=!1;for(var h in this.TextRectCache){var l=this.TextRectCache[h];if(this.IsOverlap(l,r)){o=!0;break}}if(o==!1)return;if(a=r.X,a+=t.Offset,a+r.Width<this.FrameBottom||a>this.FrameTop)break;r.X=a}}},this.IsOverlap=function(r,n){return r.X+r.Width>n.X&&n.X+n.Width>r.X&&r.Y+r.Height>n.Y&&n.Y+n.Height>r.Y},this.GetMaxMin=function(){var r={Min:null,Max:null};return r},this.GetTooltipData=function(r,n,e){for(var t in this.TooltipRect){var a=this.TooltipRect[t];if(a.Rect){var s=a.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(s.X,s.Y,s.Width,s.Height),this.Canvas.isPointInPath(r,n))return e.Data=a,e.ChartPaint=this,e.Type=3,!0}}return!1}}function Or(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMACD",this.UpColor=m.UpBarColor,this.DownColor=m.DownBarColor,this.LineWidth=1,this.DrawSelectedStatus=this.DrawLinePoint,this.ExportData=this.ExportArrayData,this.PtInChart=function(r,n){var e=this.ChartFrame.DataWidth,t=this.LineWidth*V();return this.barWidth==50?t=null:t>e&&(t=e),t<4&&(t=4),this.PtInBar(r,n,{BarWidth:t})},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!this.IsShowIndexTitleOnly()&&!this.IsHideScriptIndex()){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}if(this.ChartFrame.IsHScreen===!0){this.HScreenDraw();return}var r=this.IsMinuteFrame(),n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetBorder(),a=t.LeftEx+e/2+m.FrameLeftMargin,s=t.RightEx,o=this.ChartFrame.XPointCount,h=this.GetLockRect();h&&(s=h.Left);var l=this.ChartFrame.GetYFromData(0),u=this.LineWidth*V();(this.LineWidth==50||u>n)&&(u=n);var f=this.Canvas.lineWidth;this.Canvas.lineWidth=u;for(var C=this.Data.DataOffset,D=0;C<this.Data.Data.length&&D<o;++C,++D,a+=n+e){var v=this.Data.Data[C];if(v!=null){if(r)var S=this.ChartFrame.GetXFromIndex(D);else{var T=a,I=a+n;if(I>s)break;var S=T+(I-T)/2}var F=this.ChartFrame.GetYFromData(v);if(S>s)break;var E=he(u,S);this.Canvas.beginPath(),this.Canvas.moveTo(E,l),this.Canvas.lineTo(E,F),v>=0?this.Canvas.strokeStyle=this.UpColor:this.Canvas.strokeStyle=this.DownColor,this.Canvas.stroke(),this.Canvas.closePath()}}this.Canvas.lineWidth=f}},this.HScreenDraw=function(){var r=this.ChartFrame.DataWidth;this.ChartFrame.DistanceWidth;var n=this.ChartBorder.GetHScreenBorder(),e=n.BottomEx,t=this.ChartFrame.XPointCount,a=this.GetLockRect();a&&(e=a.Top);var s=this.ChartFrame.GetYFromData(0),o=this.LineWidth*V();(this.LineWidth==50||o>r)&&(o=r);var h=this.Canvas.lineWidth;this.Canvas.lineWidth=o;for(var l=this.Data.DataOffset,u=0;l<this.Data.Data.length&&u<t;++l,++u){var f=this.Data.Data[l];if(f!=null){var C=this.ChartFrame.GetXFromIndex(u),D=this.ChartFrame.GetYFromData(f);if(C>e)break;this.Canvas.beginPath(),this.Canvas.moveTo(s,L(C)),this.Canvas.lineTo(D,L(C)),f>=0?this.Canvas.strokeStyle=this.UpColor:this.Canvas.strokeStyle=this.DownColor,this.Canvas.stroke(),this.Canvas.closePath()}}this.Canvas.lineWidth=h},this.GetItemData=function(r){if(!r||!c.IsNumber(r.Index)||!this.Data||!c.IsNonEmptyArray(this.Data.Data))return null;var n=r.Index;if(n<0||n>=this.Data.Data.length)return null;var e=this.Data.Data[n];return[{Value:e,Color:e>0?this.UpColor:this.DownColor,Name:this.Name}]}}function nd(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartBar",this.UpBarColor=m.UpBarColor,this.DownBarColor=m.DownBarColor,this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}var r=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,e=this.ChartBorder.GetRight(),t=this.ChartFrame.XPointCount,a=this.ChartBorder.GetLeft()+n/2+2,s=this.ChartFrame.GetYFromData(0);if(r>=4){s=B(s);for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<t;++o,++h,a+=r+n){var l=this.Data.Data[o];if(!(l==null||l==0)){var u=a,f=a+r;if(f>e)break;var C=this.ChartFrame.GetXFromIndex(h),D=this.ChartFrame.GetYFromData(l);l>0?this.Canvas.fillStyle=this.UpBarColor:this.Canvas.fillStyle=this.DownBarColor;var v=B(Math.abs(s-D));s-D>0?D=s-v:D=s+v,this.Canvas.fillRect(B(u),D,B(r),v)}}}else for(var o=this.Data.DataOffset,h=0;o<this.Data.Data.length&&h<t;++o,++h,a+=r+n){var l=this.Data.Data[o];if(!(l==null||l==0)){var u=a,f=a+r;if(f>e)break;var C=this.ChartFrame.GetXFromIndex(h),D=this.ChartFrame.GetYFromData(l);l>0?this.Canvas.strokeStyle=this.UpBarColor:this.Canvas.strokeStyle=this.DownBarColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(C),D),this.Canvas.lineTo(L(C),s),this.Canvas.stroke()}}}},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n={};n.Min=0,n.Max=null;for(var e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];n.Max==null&&(n.Max=a),n.Max<a&&(n.Max=a)}return n}}function gC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.ClassName="ChartBand",this.FirstColor=m.Index.LineColor[0],this.SecondColor=m.Index.LineColor[1],this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}for(var r=this.ChartFrame.IsHScreen,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount,a=this.ChartBorder.GetLeft()+e/2+2,s=0,o=0,h=0,l=[],u=[],f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<t;++f,++C,a+=n+e){for(l=[],u=[];f<this.Data.Data.length&&C<t;++f,++C,a+=n+e){var D=this.Data.Data[f];if(D==null||D.Value==null||D.Value2==null)break;s=this.ChartFrame.GetXFromIndex(C),o=this.ChartFrame.GetYFromData(D.Value),h=this.ChartFrame.GetYFromData(D.Value2),r?(l.push({x:o,y:s}),u.push({x:h,y:s})):(l.push({x:s,y:o}),u.push({x:s,y:h}))}l.length>1&&u.length>1&&this.DrawBand(l,u)}}},this.ClipTop=function(r){var n=this.ChartFrame.IsHScreen;this.Canvas.beginPath();for(var e=0;e<r.length;++e)e==0?this.Canvas.moveTo(r[e].x,r[e].y):this.Canvas.lineTo(r[e].x,r[e].y);var t=r[0],a=r[r.length-1];if(n){var s=this.ChartBorder.GetRightEx();this.Canvas.lineTo(s,a.y),this.Canvas.lineTo(s,t.y)}else{var o=this.ChartBorder.GetTopEx();this.Canvas.lineTo(a.x,o),this.Canvas.lineTo(t.x,o)}this.Canvas.closePath(),this.Canvas.clip()},this.ClipBottom=function(r){var n=this.ChartFrame.IsHScreen;this.Canvas.beginPath();for(var e=0;e<r.length;++e)e==0?this.Canvas.moveTo(r[e].x,r[e].y):this.Canvas.lineTo(r[e].x,r[e].y);var t=r[0],a=r[r.length-1];if(n){var s=this.ChartBorder.GetLeftEx();this.Canvas.lineTo(s,a.y),this.Canvas.lineTo(s,t.y)}else{var o=this.ChartBorder.GetBottomEx();this.Canvas.lineTo(a.x,o),this.Canvas.lineTo(t.x,o)}this.Canvas.closePath(),this.Canvas.clip()},this.DrawArea=function(r,n,e){this.Canvas.beginPath();for(var t=0;t<r.length;++t)t==0?this.Canvas.moveTo(r[t].x,r[t].y):this.Canvas.lineTo(r[t].x,r[t].y);for(var t=n.length-1;t>=0;--t)this.Canvas.lineTo(n[t].x,n[t].y);this.Canvas.closePath(),this.Canvas.fillStyle=e,this.Canvas.fill()},this.DrawBand=function(r,n){this.FirstColor&&(this.Canvas.save(),this.ClipTop(r),this.DrawArea(r,n,this.FirstColor),this.Canvas.restore()),this.SecondColor&&(this.Canvas.save(),this.ClipBottom(r),this.DrawArea(r,n,this.SecondColor),this.Canvas.restore())},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n={};n.Min=null,n.Max=null;for(var e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];if(!(a==null||a.Value==null||a.Value2==null)){var s=a.Value>a.Value2?a.Value:a.Value2,o=a.Value<a.Value2?a.Value:a.Value2;(n.Max==null||n.Max<s)&&(n.Max=s),(n.Min==null||n.Min>o)&&(n.Min=o)}}return n}}function pC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.ClassName="ChartLineArea",this.Color="rgb(56,67,99)",this.IsHScreen=!1,this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){for(var r=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,e=this.ChartFrame.XPointCount,t=this.ChartBorder.GetLeft()+n/2+m.FrameLeftMargin,a=0,s=0,o=0,h=[],l=this.Data.DataOffset,u=0;l<this.Data.Data.length&&u<e;++l,++u,t+=r+n){var f=this.Data.Data[l];h[l]=null,!(f==null||f.Value==null||f.Value2==null)&&(a=this.ChartFrame.GetXFromIndex(u),s=this.ChartFrame.GetYFromData(f.Value),o=this.ChartFrame.GetYFromData(f.Value2),this.IsHScreen?h[l]={Line:{X:s,Y:a},Line2:{X:o,Y:a}}:h[l]={Line:{X:a,Y:s},Line2:{X:a,Y:o}})}this.Canvas.fillStyle=this.Color;var C=!0,D=0,v=[];for(var l in h){var S=h[l];if(!S){if(D>0){for(var u=v.length-1;u>=0;--u){var T=v[u];this.Canvas.lineTo(T.Line2.X,T.Line2.Y)}this.Canvas.closePath(),this.Canvas.fill()}C=!0,D=0,v=[];continue}C?(this.Canvas.beginPath(),this.Canvas.moveTo(S.Line.X,S.Line.Y),C=!1):this.Canvas.lineTo(S.Line.X,S.Line.Y),v.push(S),++D}if(D>0){for(var u=v.length-1;u>=0;--u){var T=v[u];this.Canvas.lineTo(T.Line2.X,T.Line2.Y)}this.Canvas.closePath(),this.Canvas.fill()}}}},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n={};n.Min=null,n.Max=null;for(var e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];if(!(!a||a.Value==null||a.Value2==null)){var s=a.Value>a.Value2?a.Value:a.Value2,o=a.Value<a.Value2?a.Value:a.Value2;(n.Max==null||n.Max<s)&&(n.Max=s),(n.Min==null||n.Min>o)&&(n.Min=o)}}return n}}function FC(){this.newMethod=pC,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.IsHScreen=!1,this.ClassName="ChartFillRGN",this.DrawRGB=function(r){var n=!0,e=0,t=[],a=null;for(var s in r){var o=r[s];if(!o||a&&o.Color!=a){if(e>0){for(var h=t.length-1;h>=0;--h){var l=t[h];this.Canvas.lineTo(l.Line2.X,l.Line2.Y)}this.Canvas.closePath(),this.Canvas.fillStyle=a,this.Canvas.fill()}n=!0,e=0,t=[],a=null}o&&(n?(this.Canvas.beginPath(),this.Canvas.moveTo(o.Line.X,o.Line.Y),n=!1,a=o.Color):this.Canvas.lineTo(o.Line.X,o.Line.Y),t.push(o),++e)}if(e>0){for(var h=t.length-1;h>=0;--h){var l=t[h];this.Canvas.lineTo(l.Line2.X,l.Line2.Y)}this.Canvas.closePath(),this.Canvas.fillStyle=a,this.Canvas.fill()}},this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){for(var r=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,e=this.ChartFrame.XPointCount,t=this.ChartBorder.GetLeft()+n/2+m.FrameLeftMargin,a=0,s=0,o=0,h=[],l=this.Data.DataOffset,u=0;l<this.Data.Data.length&&u<e;++l,++u,t+=r+n){var f=this.Data.Data[l];h[l]=null,!(f==null||f.Value==null||f.Value2==null||!f.Color)&&(a=this.ChartFrame.GetXFromIndex(u),s=this.ChartFrame.GetYFromData(f.Value),o=this.ChartFrame.GetYFromData(f.Value2),this.IsHScreen?h[l]={Line:{X:s,Y:a},Line2:{X:o,Y:a},Color:f.Color}:h[l]={Line:{X:a,Y:s},Line2:{X:a,Y:o},Color:f.Color})}this.DrawRGB(h)}}}}function sd(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!1,this.ClassName="ChartFLOATRGN",this.Color="rgb(56,67,99)",this.IsHScreen=!1,this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){for(var r=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,e=this.ChartFrame.XPointCount,t=this.ChartBorder.GetLeft()+n/2+m.FrameLeftMargin,a=0,s=0,o=0,h=[],l=this.Data.DataOffset,u=0;l<this.Data.Data.length&&u<e;++l,++u,t+=r+n){var f=this.Data.Data[l];h[l]=null,!(!f||!c.IsNumber(f.Value)||!c.IsNumber(f.Value2)||!f.Color)&&(a=this.ChartFrame.GetXFromIndex(u),s=this.ChartFrame.GetYFromData(f.Value),this.IsHScreen?h[l]={Line:{X:s,Y:a},Line2:{X:s+f.Value2*V(),Y:a},Color:f.Color}:h[l]={Line:{X:a,Y:s},Line2:{X:a,Y:s-f.Value2*V()},Color:f.Color})}var C=null;for(var l in h){var f=h[l];if(C&&f)if(this.IsHScreen){var D=f.Line.Y-C.Line.Y;a=C.Line.Y+D/2,s=C.Line.X+(f.Line.X-C.Line.X)/2,o=C.Line2.X+(f.Line2.X-C.Line2.X)/2,C.RightLine={X:s,Y:a},C.RightLine2={X:o,Y:a},f.LeftLine={X:s,Y:a},f.LeftLine2={X:o,Y:a}}else{var D=f.Line.X-C.Line.X;a=C.Line.X+D/2,s=C.Line.Y+(f.Line.Y-C.Line.Y)/2,o=C.Line2.Y+(f.Line2.Y-C.Line2.Y)/2,C.RightLine={X:a,Y:s},C.RightLine2={X:a,Y:o},f.LeftLine={X:a,Y:s},f.LeftLine2={X:a,Y:o}}C=f}this.DrawRGB(h)}}},this.DrawRGB=function(r){var n=!0,e=0,t=[],a=null;if(this.IsHScreen)var s=this.ChartBorder.GetLeftEx(),o=this.ChartBorder.GetRightEx(),h=this.ChartBorder.GetTop(),l=this.ChartBorder.GetBottom();else var s=this.ChartBorder.GetLeft(),o=this.ChartBorder.GetRight(),h=this.ChartBorder.GetTopEx(),l=this.ChartBorder.GetBottomEx();this.Canvas.save(),this.Canvas.beginPath(),this.Canvas.rect(s,h,o-s,l-h),this.Canvas.clip();for(var u in r){var f=r[u];if(!f||a&&f.Color!=a){if(e>0){var C=t[t.length-1],D=t[0];C.RightLine&&(this.Canvas.lineTo(C.RightLine.X,C.RightLine.Y),this.Canvas.lineTo(C.RightLine2.X,C.RightLine2.Y));for(var v=t.length-1;v>=0;--v){var S=t[v];this.Canvas.lineTo(S.Line2.X,S.Line2.Y)}D.LeftLine2&&this.Canvas.lineTo(D.LeftLine2.X,D.LeftLine2.Y),this.Canvas.closePath(),this.Canvas.fillStyle=a,this.Canvas.fill()}n=!0,e=0,t=[],a=null}f&&(n?(this.Canvas.beginPath(),f.LeftLine?(this.Canvas.moveTo(f.LeftLine.X,f.LeftLine.Y),this.Canvas.lineTo(f.Line.X,f.Line.Y)):this.Canvas.moveTo(f.Line.X,f.Line.Y),n=!1,a=f.Color):this.Canvas.lineTo(f.Line.X,f.Line.Y),t.push(f),++e)}if(e>0){var C=t[t.length-1],D=t[0];C.RightLine&&(this.Canvas.lineTo(C.RightLine.X,C.RightLine.Y),this.Canvas.lineTo(C.RightLine2.X,C.RightLine2.Y));for(var v=t.length-1;v>=0;--v){var S=t[v];this.Canvas.lineTo(S.Line2.X,S.Line2.Y)}D.LeftLine2&&this.Canvas.lineTo(D.LeftLine2.X,D.LeftLine2.Y),this.Canvas.closePath(),this.Canvas.fillStyle=a,this.Canvas.fill()}this.Canvas.restore()},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n={};n.Min=null,n.Max=null;for(var e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];if(!(!a||!c.IsNumber(a.Value))){var s=a.Value;(n.Max==null||n.Max<s)&&(n.Max=s),(n.Min==null||n.Min>s)&&(n.Min=s)}}return n}}function od(){this.newMethod=FC,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.IsHScreen=!1,this.ClassName="ChartFillBGRGN",this.DrawVerticalRGN=function(){for(var r=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,e=this.ChartFrame.XPointCount,t=this.ChartBorder.GetLeft()+n/2+m.FrameLeftMargin,a=this.ChartBorder.GetTopEx(),s=this.ChartBorder.GetBottomEx(),o=a,h=s,l=[],u=this.Data.DataOffset,f=0;u<this.Data.Data.length&&f<e;++u,++f,t+=r+n){var C=this.Data.Data[u];l[u]=null,!(!C||!C.Color)&&(x=this.ChartFrame.GetXFromIndex(f),this.IsHScreen?l[u]={Line:{X:o,Y:x},Line2:{X:h,Y:x},Color:C.Color}:l[u]={Line:{X:x,Y:o},Line2:{X:x,Y:h},Color:C.Color})}this.DrawRGB(l)},this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.Data||!this.Data.Data)){if(this.Name=="FILLVERTICALRGN"){this.DrawVerticalRGN();return}var r=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,e=this.ChartFrame.XPointCount,t=this.ChartBorder.GetLeft()+n/2+m.FrameLeftMargin,a=this.ChartBorder.GetTopEx(),s=this.ChartBorder.GetBottomEx(),o=0,h=0,l=a;this.Name=="FILLBOTTOMRGN"&&(l=s);for(var u=[],f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<e;++f,++C,t+=r+n){var D=this.Data.Data[f];u[f]=null,!(D==null||D.Value==null||!D.Color)&&(o=this.ChartFrame.GetXFromIndex(C),h=this.ChartFrame.GetYFromData(D.Value),this.IsHScreen?u[f]={Line:{X:h,Y:o},Line2:{X:l,Y:o},Color:D.Color}:u[f]={Line:{X:o,Y:h},Line2:{X:o,Y:l},Color:D.Color})}this.DrawRGB(u)}}},this.DrawRGB=function(r){var n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=(e+n)/2,a=!0,s=0,o=[],h=null;for(var l in r){var u=r[l];if(!u||h&&u.Color!=h){if(s>0){for(var f=o.length-1;f>=0;--f){var C=o[f];this.Canvas.lineTo(C.Line2.X+t,C.Line2.Y),this.Canvas.lineTo(C.Line2.X-t,C.Line2.Y)}this.Canvas.closePath(),this.Canvas.fillStyle=h,this.Canvas.fill()}a=!0,s=0,o=[],h=null}u&&(a?(this.Canvas.beginPath(),this.Canvas.moveTo(u.Line.X-t,u.Line.Y),this.Canvas.lineTo(u.Line.X+t,u.Line.Y),a=!1,h=u.Color):(this.Canvas.lineTo(u.Line.X-t,u.Line.Y),this.Canvas.lineTo(u.Line.X+t,u.Line.Y)),o.push(u),++s)}if(s>0){for(var f=o.length-1;f>=0;--f){var C=o[f];this.Canvas.lineTo(C.Line2.X+t,C.Line2.Y),this.Canvas.lineTo(C.Line2.X-t,C.Line2.Y)}this.Canvas.closePath(),this.Canvas.fillStyle=h,this.Canvas.fill()}},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n={};n.Min=null,n.Max=null;for(var e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];if(!(!a||a.Value==null)){var a=a.Value;(n.Max==null||n.Max<a)&&(n.Max=a),(n.Min==null||n.Min>a)&&(n.Min=a)}}return n}}function EC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.IsDrawFirst=!0,this.ClassName="ChartChannel",this.IsHScreen=!1,this.PointCount=0,this.DataWidth=0,this.DistanceWidth=0,this.ChartRight=0,this.LineColor="RGB(255,0,0)",this.LineDotted=[3,3],this.AreaColor="RGB(255,222,173)",this.LineWidth=1,this.CalculateData=function(){for(var r=[],n=[],e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<this.PointCount;++e,++t){var a=this.Data.Data[e];if(!a||!c.IsNumber(a.Value)||!c.IsNumber(a.Value2)){n.length>0&&(r.push(n),n=[]);continue}var s=this.ChartFrame.GetXFromIndex(t);if(s>this.ChartRight)break;var o=this.ChartFrame.GetYFromData(a.Value),h=this.ChartFrame.GetYFromData(a.Value2);n.push({X:s,Y:o,Y2:h})}return n.length>0&&r.push(n),r},this.DrawArea=function(r){if(!(r.length<=0)){this.Canvas.beginPath();var n=r[0];this.IsHScreen?this.Canvas.moveTo(n.Y,n.X):this.Canvas.moveTo(n.X,n.Y);for(var e=1;e<r.length;++e){var t=r[e];this.IsHScreen?this.Canvas.lineTo(t.Y,t.X):this.Canvas.lineTo(t.X,t.Y)}for(var e=r.length-1;e>=0;--e){var t=r[e];this.IsHScreen?this.Canvas.lineTo(t.Y2,t.X):this.Canvas.lineTo(t.X,t.Y2)}this.Canvas.closePath(),this.Canvas.fillStyle=this.AreaColor,this.Canvas.fill()}},this.DrawLine=function(r){this.Canvas.strokeStyle=this.LineColor;for(var n=0;n<2;++n){for(var e=!0,t=0,a=0;a<r.length;++a){var s=r[a];e?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(n===0?s.Y:s.Y2,s.X):this.Canvas.moveTo(s.X,n===0?s.Y:s.Y2),e=!1):this.IsHScreen?this.Canvas.lineTo(n===0?s.Y:s.Y2,s.X):this.Canvas.lineTo(s.X,n===0?s.Y:s.Y2),++t}t>0&&this.Canvas.stroke()}},this.Draw=function(){if(!this.ChartFrame.IsMinSize){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.PointCount=this.ChartFrame.XPointCount,this.DataWidth=this.ChartFrame.DataWidth,this.DistanceWidth=this.ChartFrame.DistanceWidth,this.IsHScreen?this.ChartRight=this.ChartBorder.GetBottom():this.ChartRight=this.ChartBorder.GetRight();var r=this.CalculateData();if(!(!r||r.length<=0)){this.Canvas.save(),this.Canvas.lineWidth=this.LineWidth*V(),this.Canvas.setLineDash(this.LineDotted);for(var n=0;n<r.length;++n){var e=r[n];this.DrawArea(e),this.DrawLine(e)}this.Canvas.restore()}}},this.GetMaxMin=function(){for(var r=this.ChartFrame.XPointCount,n={Min:null,Max:null},e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];if(!(a==null||a.Value==null||a.Value2==null)){var s=a.Value>a.Value2?a.Value:a.Value2,o=a.Value<a.Value2?a.Value:a.Value2;(n.Max==null||n.Max<s)&&(n.Max=s),(n.Min==null||n.Min>o)&&(n.Min=o)}}return n}}function xC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartBackground",this.Color=null,this.ColorAngle=0,this.IsDrawFirst=!0,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&this.Color&&!(this.Color.length<=0)){if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.Color.length==2){if(this.IsHScreen)if(this.ColorAngle==0)var r={X:this.ChartBorder.GetRight(),Y:this.ChartBorder.GetTopEx()},n={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()};else var r={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()},n={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetBottomEx()};else if(this.ColorAngle==0)var r={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()},n={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetBottomEx()};else var r={X:this.ChartBorder.GetLeft(),Y:this.ChartBorder.GetTopEx()},n={X:this.ChartBorder.GetRight(),Y:this.ChartBorder.GetTopEx()};var e=this.Canvas.createLinearGradient(r.X,r.Y,n.X,n.Y);e.addColorStop(0,this.Color[0]),e.addColorStop(1,this.Color[1]),this.Canvas.fillStyle=e}else if(this.Color.length==1)this.Canvas.fillStyle=this.Color[0];else return;if(this.Name=="DRAWGBK2"||this.Name=="KLINE_BG"){this.DrawRegion();return}if(this.IsHScreen)var t=this.ChartBorder.GetLeftEx(),a=this.ChartBorder.GetTop(),s=this.ChartBorder.GetWidthEx(),o=this.ChartBorder.GetHeight();else var t=this.ChartBorder.GetLeft(),a=this.ChartBorder.GetTopEx(),s=this.ChartBorder.GetWidth(),o=this.ChartBorder.GetHeightEx();this.Canvas.fillRect(t,a,s,o)}},this.DrawRegion=function(){var r=this.ChartFrame.XPointCount,n=this.ChartBorder.GetLeft()+t/2+m.FrameLeftMargin,e=this.ChartFrame.DataWidth,t=this.ChartFrame.DistanceWidth,a=this.ChartBorder.GetTopEx(),s=this.ChartBorder.GetBottomEx();this.IsHScreen&&(a=this.ChartBorder.GetRightEx(),s=this.ChartBorder.GetLeftEx());for(var o=[],h=this.Data.DataOffset,l=0;h<this.Data.Data.length&&l<r;++h,++l,n+=e+t){var u=this.Data.Data[h];if(o[h]=null,!(!c.IsNumber(u)||u<=0)){var f=this.ChartFrame.GetXFromIndex(l);this.ChartFrame.GetYFromData(u.Value),this.IsHScreen?o[h]={Line:{X:s,Y:f},Line2:{X:a,Y:f}}:o[h]={Line:{X:f,Y:a},Line2:{X:f,Y:s}}}}this.DrawBG(o)},this.DrawBG=function(r){var n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=(e+n)/2,a=!0,s=0,o=[],h=null;for(var l in r){var u=r[l];if(!u||h&&u.Color!=h){if(s>0){for(var f=o.length-1;f>=0;--f){var C=o[f];this.IsHScreen?(this.Canvas.lineTo(C.Line2.X,C.Line2.Y+t),this.Canvas.lineTo(C.Line2.X,C.Line2.Y-t)):(this.Canvas.lineTo(C.Line2.X+t,C.Line2.Y),this.Canvas.lineTo(C.Line2.X-t,C.Line2.Y))}this.Canvas.closePath(),this.Canvas.fill()}a=!0,s=0,o=[],h=null}u&&(a?(this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(u.Line.X,u.Line.Y-t),this.Canvas.lineTo(u.Line.X,u.Line.Y+t)):(this.Canvas.moveTo(u.Line.X-t,u.Line.Y),this.Canvas.lineTo(u.Line.X+t,u.Line.Y)),a=!1,h=u.Color):this.IsHScreen?(this.Canvas.lineTo(u.Line.X,u.Line.Y-t),this.Canvas.lineTo(u.Line.X,u.Line.Y+t)):(this.Canvas.lineTo(u.Line.X-t,u.Line.Y),this.Canvas.lineTo(u.Line.X+t,u.Line.Y)),o.push(u),++s)}if(s>0){for(var f=o.length-1;f>=0;--f){var C=o[f];this.IsHScreen?(this.Canvas.lineTo(C.Line2.X,C.Line2.Y+t),this.Canvas.lineTo(C.Line2.X,C.Line2.Y-t)):(this.Canvas.lineTo(C.Line2.X+t,C.Line2.Y),this.Canvas.lineTo(C.Line2.X-t,C.Line2.Y))}this.Canvas.closePath(),this.Canvas.fill()}},this.GetMaxMin=function(){return{Min:null,Max:null}}}function hd(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartBackgroundDiv",this.AryColor,this.ColorType=0,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&c.IsNonEmptyArray(this.AryColor)&&!(!this.Data||!this.Data.Data)){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartFrame.XPointCount,a,s,o,h,l;r?(a=this.ChartBorder.GetHScreenBorder(),s=a.TopEx+e/2+m.FrameLeftMargin,o=a.BottomEx,h=a.LeftEx,l=a.RightEx):(a=this.ChartBorder.GetBorder(),s=a.LeftEx+e/2+m.FrameLeftMargin,o=a.RightEx,h=a.TopEx,l=a.BottomEx);for(var u=null,f=this.Data.DataOffset,C=0;f<this.Data.Data.length&&C<t;++f,++C,s+=n+e){var D=this.Data.Data[f],v=s,S=s+n;if(S>o)break;if(!D)u&&this.DrawDiv(u,r),u=null;else{var T=h,I=l;if(c.IsNonEmptyArray(D.AryValue)){var F=this.ChartFrame.GetYFromData(D.AryValue[0]),E=this.ChartFrame.GetYFromData(D.AryValue[1]);T=Math.min(F,E),I=Math.max(F,E)}r?u?(u.Bottom=S,u.Left>T&&(u.Left=T),u.Right<I&&(u.Right=I)):u={Left:T,Right:I,Top:v,Bottom:S}:u?(u.Right=S,u.Top>T&&(u.Top=T),u.Bottom<I&&(u.Bottom=I)):u={Left:v,Right:S,Top:T,Bottom:I}}}}},this.DrawDiv=function(r,n){if(this.ColorType==2)this.Canvas.strokeStyle=this.AryColor[0],this.Canvas.strokeRect(L(r.Left),L(r.Top),B(r.Right-r.Left),B(r.Bottom-r.Top));else if(this.ColorType==3)this.Canvas.fillStyle=this.AryColor[1],this.Canvas.fillRect(B(r.Left),B(r.Top),B(r.Right-r.Left),B(r.Bottom-r.Top)),this.Canvas.strokeStyle=this.AryColor[0],this.Canvas.strokeRect(L(r.Left),L(r.Top),B(r.Right-r.Left),B(r.Bottom-r.Top));else if(this.ColorType==0||this.ColorType==1){var e=null;n?this.ColorType==0?e=this.Canvas.createLinearGradient(r.Left,r.Top,r.Right,r.Top):e=this.Canvas.createLinearGradient(r.Left,r.Top,r.Left,r.Bottom):this.ColorType==0?e=this.Canvas.createLinearGradient(r.Left,r.Top,r.Left,r.Bottom):e=this.Canvas.createLinearGradient(r.Left,r.Top,r.Right,r.Top),e.addColorStop(.5,this.AryColor[0]),e.addColorStop(1,this.AryColor[1]),this.Canvas.fillStyle=e,this.Canvas.fillRect(B(r.Left),B(r.Top),B(r.Right-r.Left),B(r.Bottom-r.Top))}else return}}function ld(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartRectangle",this.Color=[],this.Rect,this.BorderColor=m.FrameBorderPen,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Color||!this.Rect)&&!(this.Color.length<=0)){this.Canvas.strokeStyle=this.BorderColor;var r=!1;if(this.Color.length==2)this.Canvas.fillStyle=this.Color[0],r=!0;else if(this.Color.length==1)this.Color[0]&&(this.Canvas.fillStyle=this.Color[0],r=!0);else return;var n=this.ChartBorder.GetWidth(),e=this.ChartBorder.GetHeightEx(),t=this.Rect.Left/1e3*n,a=this.Rect.Top/1e3*e,s=this.Rect.Right/1e3*n,o=this.Rect.Bottom/1e3*e;t=this.ChartBorder.GetLeft()+t,a=this.ChartBorder.GetTopEx()+a,s=this.ChartBorder.GetLeft()+s,o=this.ChartBorder.GetTopEx()+o;var h=Math.abs(t-s),l=Math.abs(a-o);r&&this.Canvas.fillRect(t,a,h,l),this.Canvas.beginPath(),this.Canvas.rect(L(t),L(a),B(h),B(l)),this.Canvas.stroke()}}}function LC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartTextLine",this.Text,this.Line,this.Price,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Text||!this.Line||!c.IsNumber(this.Price))){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var r=this.ChartBorder.GetLeft(),n=this.ChartBorder.GetRight(),e=this.ChartBorder.GetBottomEx(),t=this.ChartBorder.GetTopEx(),a=this.ChartFrame.GetYFromData(this.Price),s=0;if(this.Text.Title){var o=r+2*V(),h=a;this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var l=8*V();a-l<t?(this.Canvas.textBaseline="top",h=t):a+l>e&&(this.Canvas.textBaseline="bottom",h=e),this.Canvas.fillStyle=this.Text.Color,this.Canvas.font=this.Text.Font,this.Canvas.fillText(this.Text.Title,o,h),s=this.Canvas.measureText(this.Text.Title).width+4*V()}if(this.Line.Type>0){this.Line.Type==2&&(this.Canvas.save(),this.Canvas.setLineDash([3,5]));var o=r+s;this.Canvas.strokeStyle=this.Line.Color,this.Canvas.beginPath(),this.Canvas.moveTo(o,L(a)),this.Canvas.lineTo(n,L(a)),this.Canvas.stroke(),this.Line.Type==2&&this.Canvas.restore()}}},this.GetMaxMin=function(){var r={Min:null,Max:null};return c.IsNumber(this.Price)&&(r.Min=this.Price,r.Max=this.Price),r}}function MC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiBar",this.Bars=[],this.IsHScreen=!1,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Data||this.Data.length<=0)){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var r=this.ChartFrame.XPointCount,n=this.Data.DataOffset,e=this.ChartFrame.DataWidth,t=V(),a=[];for(var s in this.Bars){var o=this.Bars[s],h={Point:[],Color:o.Color,Width:e,Type:0};o.Type>0&&(h.Type=o.Type),o.Width>0?(h.Width=o.Width*t,h.Width>e&&(h.Width=e)):h.Width<4&&(h.Width=1*t);for(var l in o.Point){var u=o.Point[l];if(c.IsNumber(u.Index)){var f=u.Index-n;if(f>=0&&f<r){var C=this.ChartFrame.GetXFromIndex(f),D=this.ChartFrame.GetYFromData(u.Value),v=this.ChartFrame.GetYFromData(u.Value2);h.Point.push({X:C,Y:D,Y2:v})}}}h.Point.length>0&&a.push(h)}for(var s in a){var o=a[s];o.Width>=4?o.Type==1?this.DrawHollowBar(o):this.DrawFillBar(o):this.DrawLineBar(o)}}},this.DrawLineBar=function(r){this.Canvas.strokeStyle=r.Color;var n=this.Canvas.lineWidth;this.Canvas.lineWidth=r.Width;for(var e in r.Point){var t=r.Point[e];this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(L(t.Y),L(t.X)),this.Canvas.lineTo(L(t.Y2),L(t.X))):(this.Canvas.moveTo(L(t.X),L(t.Y)),this.Canvas.lineTo(L(t.X),L(t.Y2))),this.Canvas.stroke()}this.Canvas.lineWidth=n},this.DrawFillBar=function(r){this.Canvas.fillStyle=r.Color;for(var n in r.Point){var e=r.Point[n],t=e.X-r.Width/2,a=Math.min(e.Y,e.Y2),s=r.Width,o=Math.abs(e.Y-e.Y2);this.IsHScreen?this.Canvas.fillRect(B(a),B(t),B(o),B(s)):this.Canvas.fillRect(B(t),B(a),B(s),B(o))}},this.DrawHollowBar=function(r){this.Canvas.strokeStyle=r.Color;var n=1;for(var e in r.Point){var t=r.Point[e],a=t.X-r.Width/2,s=Math.min(t.Y,t.Y2),o=r.Width,h=Math.abs(t.Y-t.Y2);this.Canvas.beginPath(),this.IsHScreen?this.Canvas.rect(L(s),L(a),B(h),B(o)):this.Canvas.rect(L(a),L(s),B(o),B(h)),this.Canvas.stroke()}this.Canvas.lineWidth=n},this.GetMaxMin=function(){var r={Min:null,Max:null},n=this.ChartFrame.XPointCount,e=this.Data.DataOffset,t=e+n;for(var a in this.Bars){var s=this.Bars[a];for(var o in s.Point){var h=s.Point[o];if(h.Index>=e&&h.Index<t){var l=Math.min(h.Value,h.Value2),u=Math.max(h.Value,h.Value2);(r.Max==null||r.Max<u)&&(r.Max=u),(r.Min==null||r.Min>l)&&(r.Min=l)}}}return r}}function AC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiLine",this.Lines=[],this.LineDash,this.LineWidth=1,this.IsHScreen=!1,this.ArrawAngle=35,this.ArrawLength=10,this.ArrawLineWidth=5,this.Arrow={Start:!1,End:!1},this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Data||this.Data.length<=0)){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var r=this.ChartFrame.XPointCount,n=this.Data.DataOffset,e=[],t=[];for(var a in this.Lines){var s=this.Lines[a],o={Point:[],Color:s.Color},h={Start:[],End:[]};s.BGColor&&(o.BGColor=s.BGColor);for(var l=0;l<s.Point.length;++l){var u=s.Point[l];if(c.IsNumber(u.Index)){var f=u.Index-n;if(f>=0&&f<r){var C=this.ChartFrame.GetXFromIndex(f),D=this.ChartFrame.GetYFromData(u.Value,!1),v={X:C,Y:D,End:!1};o.Point.push(v),(l==0||l==1)&&h.Start.push(v),(l==s.Point.length-1||l==s.Point.length-2)&&h.End.push(v)}else o.Point.length>0&&(o.Point[o.Point.length-1].End=!0)}}o.Point.length>=2&&(e.push(o),t.push(h))}var S=V();this.Canvas.save();for(var a in e){this.LineDash&&this.Canvas.setLineDash(this.LineDash),c.IsPlusNumber(this.LineWidth)?this.Canvas.lineWidth=this.LineWidth*S:this.Canvas.lineWidth=1*S;var T=e[a];this.DrawLine(T,t[a])}this.Canvas.restore()}},this.DrawLine=function(r,n){if(r.BGColor){this.Canvas.fillStyle=r.BGColor;for(var e in r.Point){var t=r.Point[e];e==0?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(t.Y,t.X):this.Canvas.moveTo(t.X,t.Y)):this.IsHScreen?this.Canvas.lineTo(t.Y,t.X):this.Canvas.lineTo(t.X,t.Y)}this.Canvas.closePath(),this.Canvas.fill()}this.Canvas.strokeStyle=r.Color;var a=0;for(var e in r.Point){var t=r.Point[e];a==0?(this.Canvas.beginPath(),this.IsHScreen?this.Canvas.moveTo(t.Y,t.X):this.Canvas.moveTo(t.X,t.Y),++a):(this.IsHScreen?this.Canvas.lineTo(t.Y,t.X):this.Canvas.lineTo(t.X,t.Y),++a),t.End==!0&&(a>0&&this.Canvas.stroke(),a=0)}a>0&&this.Canvas.stroke(),n.End.length==2&&this.Arrow.End==!0&&this.DrawArrow(n.End[0],n.End[1]),n.Start.length==2&&this.Arrow.Start==!0&&this.DrawArrow(n.Start[1],n.Start[0])},this.DrawArrow=function(r,n){var e=this.ArrawAngle,t=this.ArrawLength,a=Math.atan2(r.Y-n.Y,r.X-n.X)*180/Math.PI,s=(a+e)*Math.PI/180,o=(a-e)*Math.PI/180,h=t*Math.cos(s),l=t*Math.sin(s),u=t*Math.cos(o),f=t*Math.sin(o);this.Canvas.beginPath();var C=n.X+h,D=n.Y+l;this.Canvas.moveTo(C,D),this.Canvas.lineTo(n.X,n.Y),C=n.X+u,D=n.Y+f,this.Canvas.lineTo(C,D),this.Canvas.setLineDash([]),this.Canvas.lineWidth=this.ArrawLineWidth*V(),this.Canvas.stroke()},this.GetMaxMin=function(){var r={Min:null,Max:null},n=this.ChartFrame.XPointCount,e=this.Data.DataOffset,t=e+n;for(var a in this.Lines){var s=this.Lines[a];for(var o in s.Point){var h=s.Point[o];h.Index>=e&&h.Index<t&&((r.Max==null||r.Max<h.Value)&&(r.Max=h.Value),(r.Min==null||r.Min>h.Value)&&(r.Min=h.Value))}}return r}}function NC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiPoint",this.PointGroup=[],this.IsHScreen=!1,this.LineWidth=1,this.PointRadius=5,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Data||this.Data.length<=0)&&c.IsNonEmptyArray(this.PointGroup)){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var r=this.ChartFrame.XPointCount,n=this.Data.DataOffset,e=V();this.Canvas.save(),this.ClipClient(this.IsHScreen);for(var t=0;t<this.PointGroup.length;++t){var a=this.PointGroup[t],s=a.Color,o=a.BGColor,h=this.LineWidth,l=this.PointRadius;c.IsNumber(a.LineWidth)&&(h=a.LineWidth),c.IsNumber(a.PointRadius)&&(l=a.PointRadius);for(var u=new Path2D,f=0,C=0;C<a.Point.length;++C){var D=a.Point[C];if(c.IsNumber(D.Index)){var v=D.Index-n;if(v>=0&&v<r){var S=this.ChartFrame.GetXFromIndex(v),T=this.ChartFrame.GetYFromData(D.Value,!1),I=new Path2D;this.IsHScreen?I.arc(T,S,l*e,0,360,!1):I.arc(S,T,l*e,0,360,!1),u.addPath(I),++f}}}f>0&&(o||s)&&(this.Canvas.lineWidth=h*e,this.Canvas.fillStyle=o,this.Canvas.strokeStyle=s,o&&this.Canvas.fill(u),s&&this.Canvas.stroke(u))}this.Canvas.restore()}},this.GetMaxMin=function(){for(var r={Min:null,Max:null},n=this.ChartFrame.XPointCount,e=this.Data.DataOffset,t=e+n,a=0;a<this.PointGroup.length;++a){var s=this.PointGroup[a];if(c.IsNonEmptyArray(s.Point))for(var o=0;o<s.Point.length;++o){var h=s.Point[o];h.Index>=e&&h.Index<t&&((r.Max==null||r.Max<h.Value)&&(r.Max=h.Value),(r.Min==null||r.Min>h.Value)&&(r.Min=h.Value))}}return r}}function OC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiText",this.Texts=[],this.Font=m.DefaultTextFont,this.Color=m.DefaultTextColor,this.IsHScreen=!1,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Data||this.Data.length<=0)&&this.Texts){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var r=this.ChartFrame.XPointCount,n=this.Data.DataOffset,e=this.ChartBorder.GetLeft(),t=this.ChartBorder.GetRight(),a=this.ChartBorder.GetTopEx(),s=this.ChartBorder.GetBottomEx();this.IsHScreen&&(e=this.ChartBorder.GetTop(),t=this.ChartBorder.GetBottom());for(var o=0,h=0;h<this.Texts.length;++h){var l=this.Texts[h];if(l.Text&&c.IsNumber(l.Index)){var u=l.Index-n;if(u>=0&&u<r){var f=this.ChartFrame.GetXFromIndex(u);l.Value=="TOP"?o=a:l.Value=="BOTTOM"?o=s:o=this.ChartFrame.GetYFromData(l.Value),l.Color?this.Canvas.fillStyle=l.Color:this.Canvas.fillStyle=this.Color,l.Font?this.Canvas.font=l.Font:this.Canvas.font=this.Font;var C=this.Canvas.measureText(l.Text).width;if(this.Canvas.textAlign="center",f+C/2>=t?(this.Canvas.textAlign="right",f=t):f-C/2<e&&(this.Canvas.textAlign="left",f=e),l.Baseline==1?this.Canvas.textBaseline="top":l.Baseline==2?this.Canvas.textBaseline="bottom":this.Canvas.textBaseline="middle",this.IsHScreen?(this.Canvas.save(),this.Canvas.translate(o,f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(l.Text,0,0),this.Canvas.restore()):(c.IsNumber(l.YMove)&&(o+=l.YMove),this.Canvas.fillText(l.Text,f,o)),l.Line){var D=this.Data.Data[l.Index],v=l.Line.KData=="H"?D.High:D.Low,S=this.ChartFrame.GetYFromData(v),T=o;Array.isArray(l.Line.Offset)&&l.Line.Offset.length==2&&(T>S?(T-=l.Line.Offset[1],S+=l.Line.Offset[0]):T<S&&(T+=l.Line.Offset[1],S-=l.Line.Offset[0])),this.Canvas.save(),l.Line.Dash&&this.Canvas.setLineDash(l.Line.Dash),l.Line.Width>0&&(this.Canvas.lineWidth=l.Line.Width),this.Canvas.strokeStyle=l.Line.Color,this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(T,L(f)),this.Canvas.lineTo(S,L(f))):(this.Canvas.moveTo(L(f),T),this.Canvas.lineTo(L(f),S)),this.Canvas.stroke(),this.Canvas.restore()}}}}}},this.GetMaxMin=function(){var r={Min:null,Max:null};if(!this.Texts)return r;var n=this.ChartFrame.XPointCount,e=this.Data.DataOffset,t=e+n;for(var a in this.Texts){var s=this.Texts[a];s.Index>=e&&s.Index<t&&((r.Max==null||r.Max<s.Value)&&(r.Max=s.Value),(r.Min==null||r.Min>s.Value)&&(r.Min=s.Value))}return r}}function RC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiSVGIcon",this.Icon,this.IconSize={Max:m.DRAWICON.Icon.MaxSize,Min:m.DRAWICON.Icon.MinSize,Zoom:{Type:m.DRAWICON.Icon.Zoom.Type,Value:m.DRAWICON.Icon.Zoom.Value}},this.Family,this.Color=m.DefaultTextColor,this.IsHScreen=!1,this.IconRect=[],this.Draw=function(){if(this.IconRect=[],!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Data||this.Data.length<=0)&&!(!this.Family||!this.Icon)&&c.IsNonEmptyArray(this.Icon)){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var r=this.ChartFrame.XPointCount,n=this.Data.DataOffset;this.DataWidth=this.ChartFrame.DataWidth,this.DistanceWidth=this.ChartFrame.DistanceWidth;var e=this.GetBorder();if(this.IsHScreen)var t=e.TopEx,a=e.BottomEx;else var t=e.LeftEx,a=e.RightEx;var s=this.GetDynamicIconSize(this.DataWidth,this.DistanceWidth,this.IconSize.Max,this.IconSize.Min,this.IconSize.Zoom);this.Canvas.font=s+"px "+this.Family;for(var o=0;o<this.Icon.length;++o){var h=this.Icon[o];if(c.IsNumber(h.Index)){var l=h.Index-n;if(l>=0&&l<r){var u=this.ChartFrame.GetXFromIndex(l),f=this.ChartFrame.GetYFromData(h.Value);h.Color?this.Canvas.fillStyle=h.Color:this.Canvas.fillStyle=this.Color;var C=this.Canvas.measureText(h.Text).width;this.Canvas.textAlign="center";var D=new Sa(u-s/2,f-s/2,s,s);if(u+C/2>=a?(this.Canvas.textAlign="right",u+=this.DataWidth/2,D.X=u-s):u-C/2<t&&(this.Canvas.textAlign="left",u-=this.DataWidth/2,D.X=u),h.Baseline==1?(this.Canvas.textBaseline="top",D.Y=f):h.Baseline==2?(this.Canvas.textBaseline="bottom",D.Y=f-s):(this.Canvas.textBaseline="middle",D.Y=f-s/2),this.IsHScreen?(this.Canvas.save(),this.Canvas.translate(f,u),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(h.Symbol,0,0),this.Canvas.restore()):(c.IsNumber(h.YMove)&&(f+=h.YMove),this.Canvas.fillText(h.Symbol,u,f),h.Text&&this.IconRect.push({Index:o,Rect:D,Item:h})),h.Line){var v=this.Data.Data[h.Index],S=h.Line.KData=="H"?v.High:v.Low,T=this.ChartFrame.GetYFromData(S),I=f;Array.isArray(h.Line.Offset)&&h.Line.Offset.length==2&&(I>T?(I-=h.Line.Offset[1],T+=h.Line.Offset[0]):I<T&&(I+=h.Line.Offset[1],T-=h.Line.Offset[0])),this.Canvas.save(),h.Line.Dash&&this.Canvas.setLineDash(h.Line.Dash),h.Line.Width>0&&(this.Canvas.lineWidth=h.Line.Width),this.Canvas.strokeStyle=h.Line.Color,this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(I,L(u)),this.Canvas.lineTo(T,L(u))):(this.Canvas.moveTo(L(u),I),this.Canvas.lineTo(L(u),T)),this.Canvas.stroke(),this.Canvas.restore()}}}}}},this.GetTooltipData=function(r,n,e){if(!c.IsNonEmptyArray(this.IconRect))return!1;for(var t=0;t<this.IconRect.length;++t){var a=this.IconRect[t];if(a.Rect){var s=a.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(s.X,s.Y,s.Width,s.Height),this.Canvas.isPointInPath(r,n))return X.Chart.Log("[ChartMultiSVGIcon::GetTooltipData] icon ",a),e.Data=a,e.ChartPaint=this,e.Type=4,!0}}return!1},this.GetMaxMin=function(){var r={Min:null,Max:null},n=this.ChartFrame.XPointCount,e=this.Data.DataOffset,t=e+n;for(var a in this.Icon){var s=this.Icon[a];s.Index>=e&&s.Index<t&&((r.Max==null||r.Max<s.Value)&&(r.Max=s.Value),(r.Min==null||r.Min>s.Value)&&(r.Min=s.Value))}return r}}function yC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartMultiHtmlDom",this.Texts=[],this.IsHScreen=!1,this.DrawCallback,this.DrawItem=[],this.EnableDraw=!0,this.HQChart,this.IsDestroy=!1,this.Draw=function(){this.EnableDraw&&(this.IsDestroy||(this.DrawItem=[],this.DrawCallback&&this.DrawCallback(1,{Self:this}),this.DrawDom(),this.DrawCallback&&this.DrawCallback(2,{Self:this,DrawItem:this.DrawItem})))},this.OnDestroy=function(){this.IsDestroy=!0,this.DrawCallback&&this.DrawCallback(4,{Self:this})},this.DrawDom=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Data||this.Data.length<=0)){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var r=this.ChartFrame.XPointCount,n=this.Data.DataOffset,e=this.ChartBorder.GetTopEx(),t=this.ChartBorder.GetBottomEx(),a=V();if(this.HQChart)var s=this.HQChart.UIElement.getBoundingClientRect().left,o=this.HQChart.UIElement.getBoundingClientRect().top;else var s=null,o=null;for(var h in this.Texts){var l=this.Texts[h];if(l.Text&&c.IsNumber(l.Index)){var u=this.IsMinuteFrame(),f=l.Index-n,C=this.Data.Data[l.Index],D={KData:C,Item:l,IsShow:!1,Self:this};if(f>=0&&f<r){var v=this.ChartFrame.GetXFromIndex(f);if(l.Value=="Top")var S=e;else if(l.Value=="Bottom")var S=t;else var S=this.ChartFrame.GetYFromData(l.Value);D.X=v/a,D.Y=S/a,D.UIElement={Left:s,Top:o},D.IsShow=!0}if(this.DrawItem.push(D),this.DrawCallback&&this.DrawCallback(3,D),l.Line){if(u)var T=this.Data.Data[l.Index];else var C=this.Data.Data[l.Index],T=l.Line.KData=="H"?C.High:C.Low;var I=this.ChartFrame.GetYFromData(T),F=S;Array.isArray(l.Line.Offset)&&l.Line.Offset.length==2&&(F>I?(F-=l.Line.Offset[1],I+=l.Line.Offset[0]):F<I&&(F+=l.Line.Offset[1],I-=l.Line.Offset[0])),this.Canvas.save(),l.Line.Dash&&this.Canvas.setLineDash(l.Line.Dash);var E=V(),M=1*E;l.Line.Width>0&&(M=l.Line.Width*E),this.Canvas.lineWidth=M,this.Canvas.strokeStyle=l.Line.Color,this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(F,L(v)),this.Canvas.lineTo(I,L(v))):(this.Canvas.moveTo(he(M,v),F),this.Canvas.lineTo(he(M,v),I)),this.Canvas.stroke(),this.Canvas.restore()}}}}},this.GetMaxMin=function(){var r={Min:null,Max:null},n=this.ChartFrame.XPointCount,e=this.Data.DataOffset,t=e+n;for(var a in this.Texts){var s=this.Texts[a];c.IsNumber(s.Index)&&s.Index>=e&&s.Index<t&&((r.Max==null||r.Max<s.Value)&&(r.Max=s.Value),(r.Min==null||r.Min>s.Value)&&(r.Min=s.Value))}return r}}function Jo(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawSVG",this.Family,this.TextFont,this.Texts=[],this.IsHScreen=!1,this.IsDestroy=!1,this.EnableTooltip=!0,this.TooltipRect=[],this.Draw=function(){this.TooltipRect=[],!(!this.IsShow||this.ChartFrame.IsMinSize)&&(this.IsShowIndexTitleOnly()||this.IsHideScriptIndex()||this.DrawSVG())},this.DrawSVG=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Data||!c.IsNonEmptyArray(this.Data.Data))&&c.IsNonEmptyArray(this.Texts)&&this.Family){this.IsHScreen=this.ChartFrame.IsHScreen===!0;for(var r=this.ChartFrame.XPointCount,n=this.Data.DataOffset,e=this.ChartBorder.GetTopEx(),t=this.ChartBorder.GetBottomEx(),a=V(),s=0,o=0,h=0;h<this.Texts.length;++h){var l=this.Texts[h];if(!(!l.SVG||!l.SVG.Symbol)&&c.IsNumber(l.Index)){this.IsMinuteFrame();var u=l.Index-n,f=this.Data.Data[l.Index];if(!(u<0||u>=r)){s=this.ChartFrame.GetXFromIndex(u),l.Value=="Top"?o=e:l.Value=="Bottom"?o=t:o=this.ChartFrame.GetYFromData(l.Value),c.IsNumber(l.YOffset)&&(o+=l.YOffset);var C=l.SVG;c.IsNumber(C.YOffset)&&(o+=C.YOffset);var D=C.Size+"px "+this.Family;this.Canvas.font=D;var v=C.Size/2,S="bottom",T={Left:s-v,Right:s+v,Top:o-C.Size,Bottom:o,Height:C.Size,Width:C.Size};if(C.VAlign===0?(S="top",T.Top=o,T.Bottom=T.Top+C.Size):C.VAlign===1&&(S="middle",T.Top=o-C.Size/2,T.Bottom=T.Top+C.Size),T.Top<0&&(T.Top=0,T.Bottom=C.Size,o=T.Bottom),this.Canvas.textBaseline=S,this.Canvas.textAlign="center",this.Canvas.fillStyle=C.Color,this.Canvas.fillText(C.Symbol,s,o),this.EnableTooltip&&this.TooltipRect.push({Rect:T,Index:h}),l.Text&&l.Text.Content&&this.TextFont){var I=l.Text;this.Canvas.font=this.TextFont,this.Canvas.fillStyle=I.Color;var F=o;c.IsNumber(I.YOffset)&&(F+=I.YOffset),this.Canvas.fillText(I.Content,s,F)}if(l.Line){var E=l.Line,M,f=this.Data.Data[l.Index];switch(E.Value){case"C":M=f.Close;break;case"H":M=f.High;break;case"L":M=f.Low;break}if(!c.IsNumber(M))continue;var O=this.ChartFrame.GetYFromData(M);if(O>=T.Top&&O<=T.Bottom)continue;var F;O<T.Top?(F=T.Top,c.IsNumber(E.SVGBlank)&&(F-=E.SVGBlank)):(F=T.Bottom,c.IsNumber(E.SVGBlank)&&(F+=E.SVGBlank)),E.Dash&&this.Canvas.setLineDash(E.Dash);var R=1*a;E.Width>0&&(R=E.Width*a),this.Canvas.lineWidth=R,this.Canvas.strokeStyle=E.Color,this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(F,L(s)),this.Canvas.lineTo(O,L(s))):(this.Canvas.moveTo(he(R,s),F),this.Canvas.lineTo(he(R,s),O)),this.Canvas.stroke(),this.Canvas.setLineDash([])}}}}}},this.GetMaxMin=function(){var r={Min:null,Max:null},n=this.ChartFrame.XPointCount,e=this.Data.DataOffset,t=e+n;if(!c.IsNonEmptyArray(this.Texts))return r;for(var a=0;a<this.Texts.length;++a){var s=this.Texts[a];if(c.IsNumber(s.Index)&&s.Index>=e&&s.Index<t){if(!c.IsNumber(s.Value))continue;(r.Max==null||r.Max<s.Value)&&(r.Max=s.Value),(r.Min==null||r.Min>s.Value)&&(r.Min=s.Value)}}return r},this.GetTooltipData=function(r,n,e){if(!this.IsShow)return!1;for(var t=0;t<this.TooltipRect.length;++t){var a=this.TooltipRect[t];if(a.Rect){var s=a.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(s.Left,s.Top,s.Width,s.Height),this.Canvas.isPointInPath(r,n)){var o=this.Texts[a.Index];return X.Chart.Log("[ChartDrawSVG::GetTooltipData] svg icon.",a),e.Data={Rect:a.Rect,Item:o,Index:a.Index},e.ChartPaint=this,e.Type=7,!0}}}return!1}}function ud(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartOX",this.Font,this.Family=m.ChartOX.Family,this.Color=[m.ChartOX.Up.Color,m.ChartOX.Down.Color],this.Text=[m.ChartOX.Up.Text,m.ChartOX.Down.Text],this.IsHScreen=!1,this.SquareSize=10,this.OXData=null,this.SquareLineColor=m.ChartOX.SquareLineColor,this.TooltipData=[],this.CalcualteSquare=function(){if(this.IsHScreen)var r=this.ChartBorder.GetHScreenBorder(),n=r.LeftEx,e=r.RightEx;else var r=this.ChartBorder.GetBorder(),n=r.TopEx,e=r.BottomEx;this.SquareSize=(e-n)/(this.OXData.Max-this.OXData.Min)*this.OXData.BlockSize;var t=parseInt(this.SquareSize);this.Font=t+"px "+this.Family},this.DrawSquares=function(){if(this.Canvas.beginPath(),this.Canvas.strokeStyle=this.SquareLineColor,this.IsHScreen)var r=this.ChartBorder.GetHScreenBorder(),n=r.Top,e=r.Bottom;else var r=this.ChartBorder.GetBorder(),n=r.Left,e=r.Right,t=r.TopEx,a=r.BottomEx;for(var s=this.OXData.StartPrice;s<this.OXData.Max;s+=this.OXData.BlockSize){var o=this.ChartFrame.GetYFromData(s);this.IsHScreen?(this.Canvas.moveTo(L(o),r.Top),this.Canvas.lineTo(L(o),r.Bottom)):(this.Canvas.moveTo(n,L(o)),this.Canvas.lineTo(e,L(o)))}for(var s=this.OXData.StartPrice;s>this.OXData.Min;s-=this.OXData.BlockSize){var o=this.ChartFrame.GetYFromData(s);this.IsHScreen?(this.Canvas.moveTo(L(o),r.Top),this.Canvas.lineTo(L(o),r.Bottom)):(this.Canvas.moveTo(n,L(o)),this.Canvas.lineTo(e,L(o)))}for(var h=n+m.FrameLeftMargin,l=h;l<e;l+=this.SquareSize)this.IsHScreen?(this.Canvas.moveTo(r.LeftEx,L(l)),this.Canvas.lineTo(r.RightEx,L(l))):(this.Canvas.moveTo(L(l),t),this.Canvas.lineTo(L(l),a));this.Canvas.stroke()},this.Draw=function(){if(this.TooltipData=[],!this.ChartFrame.IsMinSize){if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.NotSupportMessage){this.DrawNotSupportmessage();return}if(!(!this.OXData||!this.OXData.Data))if(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.CalcualteSquare(),this.DrawSquares(),this.IsHScreen){var r=this.ChartBorder.GetTop(),n=this.ChartBorder.GetBottom(),e=r+m.FrameLeftMargin;this.Canvas.textBaseline="middle",this.Canvas.textAlign="center",this.Canvas.font=this.Font;for(var t=0;t<this.OXData.Data.length&&!(e>n);++t,e+=this.SquareSize){var a=this.OXData.Data[t];this.Canvas.fillStyle=this.Color[a.Type];var s=this.Text[a.Type];if(c.IsNonEmptyArray(a.Data))for(var o=0;o<a.Data.length;++o){var h=a.Data[o],l=this.ChartFrame.GetYFromData(h+this.OXData.BlockSize/2);this.Canvas.fillText(s,l,e+this.SquareSize/2)}}}else{var r=this.ChartBorder.GetLeft(),n=this.ChartBorder.GetRight(),e=r+m.FrameLeftMargin;this.Canvas.textBaseline="middle",this.Canvas.textAlign="center",this.Canvas.font=this.Font;for(var t=0;t<this.OXData.Data.length&&!(e>n);++t,e+=this.SquareSize){var a=this.OXData.Data[t];this.Canvas.fillStyle=this.Color[a.Type];var s=this.Text[a.Type],u={X:e,Width:this.SquareSize},f=null,C=null;if(c.IsNonEmptyArray(a.Data)){for(var o=0;o<a.Data.length;++o){var h=a.Data[o],l=this.ChartFrame.GetYFromData(h+this.OXData.BlockSize/2);this.Canvas.fillText(s,e+this.SquareSize/2,l),(f==null||f<h)&&(f=h),(C==null||C>h)&&(C=h)}u.Y=this.ChartFrame.GetYFromData(f+this.OXData.BlockSize),u.Height=this.ChartFrame.GetYFromData(C)-u.Y;var D={Data:a,Rect:u};this.TooltipData.push(D)}}}}},this.GetTooltipData=function(r,n,e){for(var t in this.TooltipData){var a=this.TooltipData[t];if(a.Rect){var s=a.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(s.X,s.Y,s.Width,s.Height),this.Canvas.isPointInPath(r,n))return X.Chart.Log("[ChartOX::GetTooltipData] item ",a),e.Data=a,e.ChartPaint=this,e.Type=5,!0}}return!1},this.GetMaxMin=function(){var r={Min:null,Max:null};return this.OXData&&(c.IsNumber(this.OXData.Max)&&(r.Max=this.OXData.Max),c.IsNumber(this.OXData.Min)&&(r.Min=this.OXData.Min)),r}}function fd(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartVolProfileVisibleRange",this.IsDrawFirst=!0,this.IsShowText=!0,this.VolType=0,this.BarPosition=1,this.BarWidthRate=.3,this.VolFont,this.HQChart,this.IsDestroy=!1,this.Data=null,this.MaxVol,this.MaxVolPrice,this.VolLineColor=m.ChartVolProfileVisibleRange.VolLineColor,this.VolLineFont=m.ChartVolProfileVisibleRange.VolLineFont,this.VolLineTextColor=m.ChartVolProfileVisibleRange.VolLineTextColor,this.VAHLineColor=m.ChartVolProfileVisibleRange.VAHLineColor,this.VAHTextColor=m.ChartVolProfileVisibleRange.VAHTextColor,this.VALLineColor=m.ChartVolProfileVisibleRange.VALLineColor,this.VALTextColor=m.ChartVolProfileVisibleRange.VALTextColor,this.VAFont=m.ChartVolProfileVisibleRange.VAFont,this.TextConfig=(0,Se.default)({Color:m.ChartVolProfileVisibleRange.Text.Color,Family:m.ChartVolProfileVisibleRange.Text.Family,FontMaxSize:m.ChartVolProfileVisibleRange.Text.FontMaxSize,FontMinSize:m.ChartVolProfileVisibleRange.Text.FontMinSize},"Color",m.ChartVolProfileVisibleRange.Text.Color),this.BarColor=[m.ChartVolProfileVisibleRange.UpVolColor,m.ChartVolProfileVisibleRange.DownVolColor,m.ChartVolProfileVisibleRange.AreaUpColor,m.ChartVolProfileVisibleRange.AreaDonwColor],this.MaxVolLine,this.OnDestroy=function(){this.IsDestroy=!0},this.SetOption=function(r){r&&(c.IsBool(r.IsShowText)&&(this.IsShowText=r.IsShowText),c.IsNumber(r.VolType)&&(this.IsShowText=r.VolType),c.IsNumber(r.BarPosition)&&(this.BarPosition=r.BarPosition),c.IsNumber(r.BarWidthRate)&&(this.IsShowText=r.BarWidthRate))},this.PtInChart=function(r,n){return this.MaxVolLine&&r>=this.MaxVolLine.Start.X&&r<=this.MaxVolLine.End.X&&n>=this.MaxVolLine.Start.Y-5&&n<this.MaxVolLine.Start.Y+5?{Identify:this.Identify,Chart:this}:null},this.SetSelectedStatus=function(r){r==0?this.IsDrawFirst=!0:this.IsDrawFirst=!1},this.DrawSelectedStatus=function(){var r=this.SelectedRadius,n=V();if(this.Canvas.save(),this.MaxVolLine){this.Canvas.lineWidth=this.SelectedLineWidth*n,this.Canvas.strokeStyle=this.SelectedLineColor,this.SelectedBGColor&&(this.Canvas.fillStyle=this.SelectedBGColor);for(var e=(this.MaxVolLine.End.X-this.MaxVolLine.Start.X)/6,t=[],a=this.MaxVolLine.Start.X+e;a<this.MaxVolLine.End.X;a+=e)t.push({X:a,Y:this.MaxVolLine.Start.Y});for(var s=0;s<t.length;++s){var o=t[s];this.Canvas.beginPath(),this.Canvas.arc(o.X,o.Y,r,0,360,!1),this.Canvas.closePath(),this.SelectedBGColor&&this.Canvas.fill(),this.Canvas.stroke()}}this.Canvas.restore()},this.Draw=function(){if(this.VolFont=null,this.MaxVolLine=null,this.IsHScreen=this.ChartFrame.IsHScreen===!0,!this.ChartFrame.IsMinSize){if(this.NotSupportMessage){this.DrawNotSupportmessage();return}!this.Data||!this.Data.Data||(this.Canvas.save(),this.DrawVolBar(),this.Canvas.restore())}},this.DrawPriceLine=function(){var r=this.ChartBorder.GetLeft(),n=this.ChartBorder.GetRight(),e=V(),t=[],a=this.MaxVolPrice;c.IsNumber(this.Data.MaxVolPrice)&&(a=this.Data.MaxVolPrice),a>=this.ChartFrame.HorizontalMin&&a<=this.ChartFrame.HorizontalMax&&t.push({Price:a,Font:this.VolLineFont,LineColor:this.VolLineColor,LineWidth:2,TextColor:this.VolLineTextColor,Type:1}),c.IsNumber(this.Data.VAHPrice)&&this.Data.VAHPrice>=this.ChartFrame.HorizontalMin&&this.Data.VAHPrice<=this.ChartFrame.HorizontalMax&&t.push({Price:this.Data.VAHPrice,Font:this.VAFont,LineColor:this.VAHLineColor,LineWidth:2,TextColor:this.VAHTextColor,Type:2}),c.IsNumber(this.Data.VALPrice)&&this.Data.VALPrice>=this.ChartFrame.HorizontalMin&&this.Data.VALPrice<=this.ChartFrame.HorizontalMax&&t.push({Price:this.Data.VALPrice,Font:this.VAFont,LineColor:this.VALLineColor,LineWidth:2,TextColor:this.VALTextColor,Type:3});for(var s=0;s<t.length;++s){var o=t[s],h=he(o.LineWidth,this.ChartFrame.GetYFromData(o.Price,!1));if(this.Canvas.lineWidth=o.LineWidth,this.Canvas.strokeStyle=o.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(r,h),this.Canvas.lineTo(n,h),this.Canvas.stroke(),o.Type==1&&(this.MaxVolLine={Start:{X:r,Y:h},End:{X:n,Y:h}}),this.ChartBorder.Right>10){var l=fe(this.HQChart.Symbol),u=o.Price.toFixed(l);this.Canvas.font=o.Font,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var f=this.GetFontHeight(),C=this.Canvas.measureText(u).width+2*e;this.Canvas.fillStyle=o.LineColor,this.Canvas.fillRect(n,h-f/2,C,f),this.Canvas.fillStyle=o.TextColor,this.Canvas.fillText(u,n+1*e,h)}}},this.DrawVolBar=function(){var r=this.GetPriceYOffset(this.Data.PriceOffset),n=this.ChartBorder.GetLeft(),e=this.ChartBorder.GetRight();this.ChartFrame.GetYFromData(this.Data.MaxPrice)-r/2,this.ChartFrame.GetYFromData(this.Data.MinPrice)+r/2;var t=e-n,a=t*this.BarWidthRate;this.IsShowText&&(this.VolFont=this.GetDynamicVolTextFont(r,a),this.VolFont&&(this.Canvas.font=this.VolFont));for(var s=0,o=0;s<this.Data.Data.length;++s){var h=this.Data.Data[s];h.Price<this.ChartFrame.HorizontalMin||h.Price>this.ChartFrame.HorizontalMax||this.DrawVolBarItem(h,n,e,a,r)}this.DrawPriceLine()},this.DrawVolBarItem=function(r,n,e,t,a){var s=n,o=e,h=this.ChartFrame.GetYFromData(r.Price)-a/2,l=a-1;if(l<1&&(l=1),this.VolType==1){if(!r.TotalVol||!c.IsNumber(r.TotalVol.Value))return;var u=r.TotalVol.Value*t/this.MaxVol,f;if(c.IsNumber(r.TotalVol.ColorID)?f=this.BarColor[r.TotalVol.ColorID]:r.TotalVol.Color&&(f=r.TotalVol.Color),this.Canvas.fillStyle=f,this.BarPosition==1?this.Canvas.fillRect(o,B(h),-u,B(l)):this.Canvas.fillRect(s,B(h),u,B(l)),this.IsShowText&&this.VolFont){var C=c.FormatVolString(r.TotalVol.Value,this.HQChart.LanguageID);this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextConfig.Color,this.BarPosition==1?(this.Canvas.textAlign="right",this.Canvas.fillText(C,e-5,h+a/2)):(this.Canvas.textAlign="left",this.Canvas.fillText(C,n+5,h+a/2))}}else{for(var C="",D=0;D<r.Vol.length;++D){var v=r.Vol[D];if(c.IsNumber(v.Value)){var f;if(c.IsNumber(v.ColorID)?f=this.BarColor[v.ColorID]:v.Color&&(f=v.Color),!!f){var u=v.Value*t/this.MaxVol;this.Canvas.fillStyle=f,this.BarPosition==1?(this.Canvas.fillRect(o,B(h),-u,B(l)),o-=u):(this.Canvas.fillRect(s,B(h),u,B(l)),s+=u);var S=c.FormatVolString(v.Value,this.HQChart.LanguageID);C.length>0&&(C+="x"),C+=S}}}this.IsShowText&&this.VolFont&&(this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextConfig.Color,this.BarPosition==1?(this.Canvas.textAlign="right",this.Canvas.fillText(C,e-5,h+a/2)):(this.Canvas.textAlign="left",this.Canvas.fillText(C,n+5,h+a/2)))}},this.GetPriceYOffset=function(r){var n=this.ChartFrame,e=n.ChartBorder.GetHeightEx()*r/(n.HorizontalMax-n.HorizontalMin);return e},this.GetDynamicVolTextFont=function(r,n,e){var t=parseInt(r)-2;if(r<5&&(t=parseInt(r)),t>this.TextConfig.FontMaxSize?t=this.TextConfig.FontMaxSize:t<=0&&(t=1),t<this.TextConfig.FontMinSize)return null;var a=this.FormatFontString(t,this.TextConfig.Family,e);return a},this.FormatFontString=function(r,n,e){var t;return e?e.Weight&&(t=e.Weight+" "+r+"px "+n):t=r+"px "+n,t},this.GetMaxMin=function(){var r={Min:null,Max:null};return r}}function PC(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartStackedBar",this.Data,this.BarName=[],this.BarColor=["rgb(255,165,0)","rgb(95,158,160)"],this.LineWidth=1,this.BarType=0,this.IsHScreen,this.Draw=function(){if(!(!this.IsShow||this.ChartFrame.IsMinSize)&&!(!this.Data||!c.IsNonEmptyArray(this.Data.Data))){this.IsHScreen=this.ChartFrame.IsHScreen===!0;var r=this.ChartFrame.DataWidth,n=this.ChartFrame.DistanceWidth,e=this.ChartFrame.XPointCount;if(this.IsHScreen)var t=this.ChartBorder.GetHScreenBorder(),a=t.TopEx+n/2+m.FrameLeftMargin,s=t.BottomEx,o=t.RightEx,h=t.LeftEx;else{var t=this.ChartFrame.GetBorder(),a=t.LeftEx+n/2+m.FrameLeftMargin,s=t.RightEx,o=t.TopEx,h=t.BottomEx,l=this.GetLockRect();l&&(s=l.Left)}var u=this.IsMinuteFrame();if(this.Canvas.save(),this.BarType!=1){this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V());var f=this.Canvas.lineWidth}for(var C=this.ChartFrame.GetYFromData(0),D=this.Data.DataOffset,v=0;D<this.Data.Data.length&&v<e;++D,++v,a+=r+n){var S=this.Data.Data[D];if(c.IsNonEmptyArray(S)){if(u)var T=this.ChartFrame.GetXFromIndex(v);else{var I=a,F=a+r;if(F>s)break;var T=I+(F-I)/2}if(T>s)break;this.BarType==1?r>=4?this.DrawKBarItem(S,T,I,F,o,h,C,r):this.DrawBarItem(S,T,o,h,C,f):this.DrawBarItem(S,T,o,h,C,f)}}this.Canvas.restore()}},this.DrawKBarItem=function(r,n,e,t,a,s,o,h){for(var l=0,u=o,f=0,C=o,D=0;D<r.length;++D){var v=r[D];if(c.IsNumber(v)&&v!=0){if(this.Canvas.fillStyle=this.BarColor[D],v>0){l+=v;var S=this.ChartFrame.GetYFromData(l),T={Left:e,Top:S,Width:h,Height:u-S};u=S}else{f+=v;var S=this.ChartFrame.GetYFromData(f),T={Left:e,Top:S,Width:h,Height:C-S};C=S}this.IsHScreen?this.Canvas.fillRect(T.Top,T.Left,T.Height,T.Width):this.Canvas.fillRect(T.Left,T.Top,T.Width,T.Height)}}},this.DrawBarItem=function(r,o,e,t,a,s){for(var o=he(s,o),h=0,l=a,u=0,f=a,C=0;C<r.length;++C){var D=r[C];if(c.IsNumber(D)&&D!=0){var v={};if(D>0){h+=D;var S=this.ChartFrame.GetYFromData(h),v={X:o,Y:l,X2:o,Y2:S};l=S}else{u+=D;var S=this.ChartFrame.GetYFromData(u),v={X:o,Y:f,X2:o,Y2:S};f=S}this.Canvas.beginPath(),this.IsHScreen?(this.Canvas.moveTo(v.Y,v.X),this.Canvas.lineTo(v.Y2,v.X2)):(this.Canvas.moveTo(v.X,v.Y),this.Canvas.lineTo(v.X2,v.Y2)),this.Canvas.strokeStyle=this.BarColor[C],this.Canvas.stroke()}}},this.GetMaxMin=function(){var r=this.ChartFrame.XPointCount,n={};if(n.Min=null,n.Max=null,!this.Data||!this.Data.Data)return n;for(var e=this.Data.DataOffset,t=0;e<this.Data.Data.length&&t<r;++e,++t){var a=this.Data.Data[e];if(!(!a||!c.IsNonEmptyArray(a))){for(var s=0,o=0,h=0;h<a.length;++h){var l=a[h];c.IsNumber(l)&&l!=0&&(l>0?s+=l:l<0&&(o+=l))}n.Max==null&&(n.Max=s,n.Min=o),n.Max<s&&(n.Max=s),n.Min>o&&(n.Min=o)}}return n},this.PtInChart=function(r,n){var e={StackedBar:!0};return this.BarType==0&&(e.BarWidth=4),this.PtInBar(r,n,e)},this.DrawSelectedStatus=function(){this.DrawLinePoint({StackedBar:!0})}}function Fo(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartLock",this.WidthDiv=.2,this.LockCount=20,this.BGColor=m.LockBGColor,this.TextColor=m.LockTextColor,this.Font=m.DefaultTextFont,this.Title="🔒开通权限",this.LockRect=null,this.LockID,this.Callback,this.IndexName,this.MinWidth=null,this.Draw=function(r){if(this.LockRect=null,this.NotSupportMessage){this.DrawNotSupportmessage();return}if(this.ChartFrame.IsHScreen===!0){this.HScreenDraw(r);return}var n=this.ChartBorder.GetRight(),e=0;if(this.ChartFrame.Data!=null){var t=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth;n=this.ChartBorder.GetLeft()+a/2+2;for(var s=this.ChartBorder.GetRight(),o=this.ChartFrame.XPointCount,h=this.ChartFrame.Data.DataOffset,l=0;h<this.ChartFrame.Data.Data.length&&l<o;++h,++l,n+=t+a){var u=this.ChartFrame.Data.Data[h];if(!(u.Open==null||u.High==null||u.Low==null||u.Close==null)){var f=n+t;if(f>s)break}}e=(t+a)*this.LockCount}e==0&&(e=(n-this.ChartBorder.GetLeft())*this.WidthDiv);var C=n-e;C<this.ChartBorder.GetLeft()&&(C=this.ChartBorder.GetLeft());var D=this.ChartBorder.GetBottom()-this.ChartBorder.GetTop(),v=this.ChartBorder.GetRight()-C;if(this.MinWidth>10&&v<this.MinWidth&&(v=this.MinWidth,C=this.ChartBorder.GetRight()-v,C<this.ChartBorder.GetLeft()&&(C=this.ChartBorder.GetLeft())),r){this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(C,this.ChartBorder.GetTop(),v,D);var S=C+v/2,T=this.ChartBorder.GetTop()+D/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.Title,S,T)}this.LockRect={Left:C,Top:this.ChartBorder.GetTop(),Width:v,Heigh:D}},this.HScreenDraw=function(r){var n=this.ChartBorder.GetBottom(),e=0;if(this.ChartFrame.Data!=null){var t=this.ChartFrame.DataWidth,a=this.ChartFrame.DistanceWidth;n=this.ChartBorder.GetTop()+a/2+2;for(var s=this.ChartBorder.GetBottom(),o=this.ChartFrame.XPointCount,h=this.ChartFrame.Data.DataOffset,l=0;h<this.ChartFrame.Data.Data.length&&l<o;++h,++l,n+=t+a){var u=this.ChartFrame.Data.Data[h];if(!(u.Open==null||u.High==null||u.Low==null||u.Close==null)){var f=n+t;if(f>s)break}}e=(t+a)*this.LockCount}e==0&&(e=(n-this.ChartBorder.GetTop())*this.WidthDiv);var C=n-e;C<this.ChartBorder.GetTop()&&(C=this.ChartBorder.GetTop());var D=this.ChartBorder.GetRight()-this.ChartBorder.GetLeft(),v=this.ChartBorder.GetBottom()-C;this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(this.ChartBorder.GetLeft(),C,D,v);var S=this.ChartBorder.GetLeft()+D/2,T=C+v/2;this.Canvas.save(),this.Canvas.translate(S,T),this.Canvas.rotate(90*Math.PI/180),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.Title,0,0),this.Canvas.restore(),this.LockRect={Left:this.ChartBorder.GetLeft(),Top:C,Width:D,Heigh:v}},this.GetTooltipData=function(r,n,e){return this.LockRect==null?!1:(this.Canvas.beginPath(),this.Canvas.rect(this.LockRect.Left,this.LockRect.Top,this.LockRect.Width,this.LockRect.Heigh),this.Canvas.isPointInPath(r,n)?(e.Data={ID:this.LockID,Callback:this.Callback,IndexName:this.IndexName},e.ChartPaint=this,!0):!1)}}function Cd(){this.newMethod=Fi,this.newMethod(),delete this.newMethod,this.ClassName="ChartBuySell",this.TextFont=m.KLineTrain.Font,this.LastDataIcon=m.KLineTrain.LastDataIcon,this.BuyIcon=m.KLineTrain.BuyIcon,this.SellIcon=m.KLineTrain.SellIcon,this.BuySellData=new Dt.default,this.IconFont=m.KLineTrain.IconFont,this.LastDataDrawType=0,this.LastDataIndex=-1,this.AddTradeItem=function(r){if(this.BuySellData.has(r.Key)){var n=this.BuySellData.get(r.Key);n.Data.push(r)}else this.BuySellData.set(r.Key,{Data:[r]})},this.ClearTradeData=function(){this.BuySellData=new Dt.default},this.Draw=function(){if(!(!this.Data||!this.Data.Data)){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.DataWidth,e=this.ChartFrame.DistanceWidth,t=this.ChartBorder.GetRight();r===!0&&(t=this.ChartBorder.GetBottom());var a=this.ChartFrame.XPointCount;if(this.IconFont){var s=V(),o=n+e,h=18*s;o<h&&(o=h),this.Canvas.font=o+"px "+this.IconFont.Family}else this.Canvas.font=this.TextFont;for(var l=this.Data.DataOffset,u=0;l<this.Data.Data.length&&u<a;++l,++u){var f=this.Data.Data[l];if(f!=null){var C=this.ChartFrame.GetXFromIndex(u);if(C>t)break;var D=!1;if(this.LastDataDrawType==1?l==this.LastDataIndex&&(D=!0):l==this.Data.Data.length-1&&(D=!0),D){var C=this.ChartFrame.GetXFromIndex(u),T=this.ChartFrame.GetYFromData(f.High);this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.IconFont?(this.Canvas.fillStyle=this.IconFont.Last.Color,this.DrawText(this.IconFont.Last.Text,C,T,r)):(this.Canvas.fillStyle=this.LastDataIcon.Color,this.Canvas.font=this.TextFont,this.DrawText(this.LastDataIcon.Text,C,T,r))}var v=l;if(this.BuySellData.has(v)){var S=this.BuySellData.get(v),T=this.ChartFrame.GetYFromData(f.High),I=this.ChartFrame.GetYFromData(f.Low),F=[!1,!1];for(var E in S.Data){if(F[0]==!0&&F[1]==!0)break;var M=S.Data[E];M.Op==0&&F[0]==!1?(this.Canvas.textAlign="center",this.Canvas.textBaseline="top",this.IconFont?(this.Canvas.fillStyle=this.IconFont.Buy.Color,this.DrawText(this.IconFont.Buy.Text,C,I,r)):(this.Canvas.fillStyle=this.BuyIcon.Color,this.DrawText(this.BuyIcon.Text,C,I,r)),F[0]=!0):M.Op==1&&F[1]==!1&&(this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.IconFont?(this.Canvas.fillStyle=this.IconFont.Sell.Color,this.DrawText(this.IconFont.Sell.Text,C,T,r)):(this.Canvas.fillStyle=this.SellIcon.Color,this.DrawText(this.SellIcon.Text,C,T,r)),F[1]=!0)}}}}}}}function Dd(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ClassName="ChartOrderbookDepth",this.Data=null,this.AskColor={Line:m.DepthChart.AskColor.Line,Area:m.DepthChart.AskColor.Area},this.BidColor={Line:m.DepthChart.BidColor.Line,Area:m.DepthChart.BidColor.Area},this.LineWidth=m.DepthChart.LineWidth,this.Draw=function(){if(this.Data){var r=this.Canvas.lineWidth;this.Canvas.lineWidth=this.LineWidth*V(),this.DrawArea(this.Data.Bids,this.BidColor.Line,this.BidColor.Area,!0),this.DrawArea(this.Data.Asks,this.AskColor.Line,this.AskColor.Area,!1),this.Canvas.lineWidth=r}},this.DrawArea=function(r,n,e,t){var a=this.ChartFrame.VerticalRange,s=[];for(var o in r){var h=r[o];if(t){if(h.Price<a.Min)break}else if(h.Price>a.Max)break;var l=this.ChartFrame.GetXFromIndex(h.Price),u=this.ChartFrame.GetYFromData(h.Vol);s.push({X:l,Y:u})}if(!(s.length<=1)){var f=this.ChartBorder.GetLeft(),C=this.ChartBorder.GetBottom(),D=this.ChartBorder.GetRight();this.Canvas.beginPath(),this.Canvas.moveTo(s[0].X,C);for(var o in s){var h=s[o];this.Canvas.lineTo(h.X,h.Y)}this.Canvas.lineTo(t?f:D,s[s.length-1].Y),this.Canvas.lineTo(t?f:D,C),this.Canvas.lineTo(s[0].X,C),this.Canvas.closePath(),this.Canvas.fillStyle=e,this.Canvas.fill(),this.Canvas.beginPath(),this.Canvas.moveTo(s[0].X,C);for(var o in s){var h=s[o];this.Canvas.lineTo(h.X,h.Y)}this.Canvas.lineTo(t?f:D,s[s.length-1].Y),this.Canvas.strokeStyle=n,this.Canvas.stroke()}},this.GetMaxMin=function(){var r={Min:null,Max:null,XMin:null,XMax:null},n=this.ChartFrame.VerticalRange;for(var e in this.Data.Asks){var t=this.Data.Asks[e];if(t.Price>n.Max)break;(r.XMin==null||r.XMin>t.Price)&&(r.XMin=t.Price),(r.XMax==null||r.XMax<t.Price)&&(r.XMax=t.Price),(r.Min==null||r.Min>t.Vol)&&(r.Min=t.Vol),(r.Max==null||r.Max<t.Vol)&&(r.Max=t.Vol)}for(var e in this.Data.Bids){var t=this.Data.Bids[e];if(t.Price<n.Min)break;(r.XMin==null||r.XMin>t.Price)&&(r.XMin=t.Price),(r.XMax==null||r.XMax<t.Price)&&(r.XMax=t.Price),(r.Min==null||r.Min>t.Vol)&&(r.Min=t.Vol),(r.Max==null||r.Max<t.Vol)&&(r.Max=t.Vol)}return r}}function vd(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.Radius=100,this.Distance=30,this.txtLine=20,this.paddingX=20/3,this.Draw=function(){if(!this.Data||!this.Data.Data||!(this.Data.Data.length>0))return this.DrawEmptyData();this.ChartBorder.GetLeft(),this.ChartBorder.GetRight(),this.ChartBorder.GetTop(),this.ChartBorder.GetBottom();var r=this.ChartBorder.GetWidth(),n=this.ChartBorder.GetHeight();if(isNaN(this.Radius)){var e=this.Radius.replace("%","");e=e/100,r>=n&&(this.Radius=e*n),r<n&&(this.Radius=e*r)}this.Canvas.save(),this.Canvas.translate(r/2,n/2);var t=0;for(var a in this.Data.Data)t+=this.Data.Data[a].Value;var s=0,o=0;for(var h in this.Data.Data){var l=this.Data.Data[h],u=(l.Value/t).toFixed(2);this.Canvas.beginPath(),this.Canvas.moveTo(0,0),o+=u*2*Math.PI,this.Canvas.strokeStyle="white",this.Canvas.fillStyle=l.Color,this.Canvas.arc(0,0,this.Radius,s,o),this.Canvas.fill(),this.Canvas.closePath(),this.Canvas.stroke(),this.Canvas.beginPath(),this.Canvas.strokeStyle=l.Color,this.Canvas.moveTo(0,0);var f=(this.Radius+this.Distance)*Math.cos(o-(o-s)/2),C=(this.Radius+this.Distance)*Math.sin(o-(o-s)/2);this.Canvas.lineTo(f,C);var D=this.txtLine,v=this.paddingX;if(this.Canvas.textAlign="left",o-(o-s)/2<1.5*Math.PI&&o-(o-s)/2>.5*Math.PI&&(D=-this.txtLine,v=-this.paddingX,this.Canvas.textAlign="right"),this.Canvas.lineTo(f+D,C),this.Canvas.stroke(),l.Text)this.Canvas.fillText(l.Text,f+D+v,C);else{var S=l.Name+":"+l.Value;this.Canvas.fillText(S,f+D+v,C)}s+=u*2*Math.PI}this.Canvas.restore()},this.DrawEmptyData=function(){X.Chart.Log("[ChartPie::DrawEmptyData]")}}function cd(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.BorderPoint=[],this.DataPoint=[],this.CenterPoint={},this.StartAngle=0,this.Color="rgb(198,198,198)",this.AreaColor="rgba(242,154,118,0.4)",this.AreaLineColor="rgb(242,154,118)",this.TitleFont=24*V()+"px 微软雅黑",this.TitleColor="rgb(102,102,102)",this.BGColor=["rgb(255,255,255)","rgb(224,224,224)"],this.DrawBorder=function(){if(!(this.BorderPoint.length<=0)){this.Canvas.font=this.TitleFont,this.Canvas.strokeStyle=this.Color;var r=[1,.8,.6,.4,.2];for(var n in r){var e=r[n],t=!0;for(var a in this.BorderPoint){var s=this.BorderPoint[a];s.X=this.CenterPoint.X+s.Radius*Math.cos(s.Angle*Math.PI/180)*e,s.Y=this.CenterPoint.Y+s.Radius*Math.sin(s.Angle*Math.PI/180)*e,t?(this.Canvas.beginPath(),this.Canvas.moveTo(s.X,s.Y),t=!1):this.Canvas.lineTo(s.X,s.Y)}this.Canvas.closePath(),this.Canvas.stroke(),this.Canvas.fillStyle=this.BGColor[n%2==0?0:1],this.Canvas.fill()}this.Canvas.beginPath();for(var o in this.BorderPoint){var s=this.BorderPoint[o];s.X=this.CenterPoint.X+s.Radius*Math.cos(s.Angle*Math.PI/180),s.Y=this.CenterPoint.Y+s.Radius*Math.sin(s.Angle*Math.PI/180),this.Canvas.moveTo(this.CenterPoint.X,this.CenterPoint.Y),this.Canvas.lineTo(s.X,s.Y),this.DrawText(s)}this.Canvas.stroke()}},this.DrawArea=function(){if(!(!this.DataPoint||this.DataPoint.length<=0)){this.Canvas.fillStyle=this.AreaColor,this.Canvas.strokeStyle=this.AreaLineColor,this.Canvas.beginPath();var r=!0;for(var n in this.DataPoint){var e=this.DataPoint[n];r?(this.Canvas.beginPath(),this.Canvas.moveTo(e.X,e.Y),r=!1):this.Canvas.lineTo(e.X,e.Y)}this.Canvas.closePath(),this.Canvas.fill(),this.Canvas.stroke()}},this.DrawText=function(r){if(r.Text){this.Canvas.fillStyle=this.TitleColor;var n=r.X,e=r.Y;r.Angle>0&&r.Angle<45?(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",n+=2):r.Angle>=0&&r.Angle<90?(this.Canvas.textAlign="left",this.Canvas.textBaseline="top",n+=2):r.Angle>=90&&r.Angle<135?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top",n-=2):r.Angle>=135&&r.Angle<180?(this.Canvas.textAlign="right",this.Canvas.textBaseline="top",n-=2):r.Angle>=180&&r.Angle<225?(this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",n-=2):r.Angle>=225&&r.Angle<=270?(this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom"):r.Angle>270&&r.Angle<315?(this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",n+=2):(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",n+=2),this.Canvas.fillText(r.Text,n,e)}},this.Draw=function(){this.BorderPoint=[],this.DataPoint=[],this.CenterPoint={},!this.Data||!this.Data.Data||!(this.Data.Data.length>0)?this.CalculatePoints(null):this.CalculatePoints(this.Data.Data),this.DrawBorder(),this.DrawArea()},this.CalculatePoints=function(r){var n=this.ChartBorder.GetLeft();this.ChartBorder.GetRight();var e=this.ChartBorder.GetTop();this.ChartBorder.GetBottom();for(var t=this.ChartBorder.GetWidth(),a=this.ChartBorder.GetHeight(),s={X:n+t/2,Y:e+a/2},o=Math.min(t/2,a/2)-2,h=Math.max(5,r?r.length:0),l=360/h,u=0;u<h;++u){var f={Index:u,Radius:o,Angle:u*l+this.StartAngle},C=f.Angle;if(r&&u<r.length){var D=r[u],v={Index:u,Text:D.Text};if(f.Text=D.Name,!D.Value)v.X=s.X,v.Y=s.Y;else{var S=D.Value;S>=1&&(S=1);var T=o*S;v.X=s.X+T*Math.cos(C*Math.PI/180),v.Y=s.Y+T*Math.sin(C*Math.PI/180)}this.DataPoint.push(v)}this.BorderPoint.push(f)}this.CenterPoint=s},this.DrawEmptyData=function(){X.Chart.Log("[ChartPie::DrawEmptyData]")}}function Sd(){this.newMethod=bt,this.newMethod(),delete this.newMethod,this.ImageData=null,this.Left,this.Top,this.Width,this.Height,this.ImageWidth,this.ImageHeight,this.DefaultColor=[217,222,239],this.Color=[{Name:"海南",Color:"rgb(217,222,223)"},{Name:"内蒙古",Color:"rgb(217,222,225)"},{Name:"新疆",Color:"rgb(217,222,226)"},{Name:"青海",Color:"rgb(217,222,227)"},{Name:"西藏",Color:"rgb(217,222,228)"},{Name:"云南",Color:"rgb(217,222,229)"},{Name:"黑龙江",Color:"rgb(217,222,230)"},{Name:"吉林",Color:"rgb(217,222,231)"},{Name:"辽宁",Color:"rgb(217,222,232)"},{Name:"河北",Color:"rgb(217,222,233)"},{Name:"山东",Color:"rgb(217,222,234)"},{Name:"江苏",Color:"rgb(217,222,235)"},{Name:"浙江",Color:"rgb(217,222,236)"},{Name:"福建",Color:"rgb(217,222,237)"},{Name:"广东",Color:"rgb(217,222,238)"},{Name:"广西",Color:"rgb(217,222,239)"},{Name:"贵州",Color:"rgb(217,222,240)"},{Name:"湖南",Color:"rgb(217,222,241)"},{Name:"江西",Color:"rgb(217,222,242)"},{Name:"安徽",Color:"rgb(217,222,243)"},{Name:"湖北",Color:"rgb(217,222,244)"},{Name:"重庆",Color:"rgb(217,222,245)"},{Name:"四川",Color:"rgb(217,222,246)"},{Name:"甘肃",Color:"rgb(217,222,247)"},{Name:"陕西",Color:"rgb(217,222,248)"},{Name:"山西",Color:"rgb(217,222,249)"},{Name:"河南",Color:"rgb(217,222,250)"}],this.Draw=function(){var r=this.ChartBorder.GetLeft()+1;this.ChartBorder.GetRight()-1;var n=this.ChartBorder.GetTop()+1;this.ChartBorder.GetBottom()-1;var e=this.ChartBorder.GetWidth()-2,t=this.ChartBorder.GetHeight()-2,a=CHINA_MAP_IMAGE.width,s=CHINA_MAP_IMAGE.height,o=a,h=s;if(t<h||e<o){this.ImageData=null;return}if((this.Left!=r||this.Top!=n||this.Width!=e||this.Height!=t||this.ImageWidth!=a||this.ImageHeight!=s)&&(this.ImageData=null,this.ImageWidth=a,this.ImageHeight=s,this.Left=r,this.Top=n,this.Width=e,this.Height=t,X.Chart.Log(a,s)),this.ImageData==null){this.Canvas.drawImage(CHINA_MAP_IMAGE,0,0,a,s,r,n,o,h),this.ImageData=this.Canvas.getImageData(r,n,o,h);var l=new Ee.default,u=new Dt.default,f=new Dt.default;if(this.Data.length>0)for(var C in this.Data){var D=this.Data[C];f.set(D.Name,D.Color)}X.Chart.Log(this.Data);for(var v in this.Color){var S=this.Color[v];f.has(S.Name)?u.set(S.Color,f.get(S.Name)):l.add(S.Color)}for(var T,I=0;I<this.ImageData.data.length;I+=4)if(T="rgb("+this.ImageData.data[I]+","+this.ImageData.data[I+1]+","+this.ImageData.data[I+2]+")",l.has(T))this.ImageData.data[I]=this.DefaultColor[0],this.ImageData.data[I+1]=this.DefaultColor[1],this.ImageData.data[I+2]=this.DefaultColor[2];else if(u.has(T)){var F=u.get(T);this.ImageData.data[I]=F[0],this.ImageData.data[I+1]=F[1],this.ImageData.data[I+2]=F[2]}this.Canvas.clearRect(r,n,o,h),this.Canvas.putImageData(this.ImageData,r,n,0,0,o,h)}else this.Canvas.putImageData(this.ImageData,r,n,0,0,o,h)}}function Td(){this.DataMap=new Dt.default([["FrameSplitPaint",{Create:function(){return new bC}}],["RectSelectPaint",{Create:function(){return new gd}}],["DragMovePaint",{Create:function(){return new Ld}}]]),this.SetCallbackDraw=new Ee.default,this.Create=function(r){if(!this.DataMap.has(r))return null;var n=this.DataMap.get(r);return n.Create()},this.Add=function(r,n){this.DataMap.set(r,{Create:n.Create})},this.AddCallbackDrawClassName=function(r){r&&this.SetCallbackDraw.add(r)},this.IsCallbackDraw=function(r){return this.SetCallbackDraw.has(r)}}var Sn=new Td;function ga(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.Data,this.IsDynamic=!1,this.IsAnimation=!1,this.ClassName="IExtendChartPainting",this.SizeChange=!0,this.IsEraseBG=!1,this.DrawAfterTitle=!1,this.DrawAfterPicture=!1,this.IsCallbackDraw=!1,this.Left=5,this.Right=5,this.Top=5,this.Bottom=5,this.Draw=function(){},this.SetOption=function(r){},this.GetFontHeight=function(r){return Aa(this.Canvas,r,"擎")}}function Yh(){this.newMethod=ga,this.newMethod(),delete this.newMethod,this.IsDynamic=!0,this.IsEraseBG=!0,this.DrawAfterTitle=!0,this.ClassName="KLineTooltipPaint",this.BorderColor=m.TooltipPaint.BorderColor,this.BGColor=m.TooltipPaint.BGColor,this.TitleColor=m.TooltipPaint.TitleColor,this.DateTimeColor=m.TooltipPaint.DateTimeColor,this.VolColor=m.TooltipPaint.VolColor,this.AmountColor=m.TooltipPaint.AmountColor,this.LatestPoint,this.ShowPosition=0,this.Left=1*V(),this.Top=5*V(),this.Width=50,this.Height=100,this.LineHeight=15*V(),this.LineSpace=2,this.Mergin={Left:2,Top:3,Bottom:5,Right:5},this.ExtendLineWidth=2,this.Font=[m.TooltipPaint.TitleFont],this.HQChart,this.KLineTitlePaint,this.IsHScreen=!1,this.LanguageID=ke.LANGUAGE_CHINESE_ID,this.ReloadResource=function(r){this.BorderColor=m.TooltipPaint.BorderColor,this.BGColor=m.TooltipPaint.BGColor,this.TitleColor=m.TooltipPaint.TitleColor,this.DateTimeColor=m.TooltipPaint.DateTimeColor,this.VolColor=m.TooltipPaint.VolColor,this.AmountColor=m.TooltipPaint.AmountColor},this.GetLeft=function(){return this.IsHScreen?this.ChartBorder.GetRightEx()-this.Height-this.Top:this.ShowPosition==0?this.ChartBorder.GetLeft()+this.Left:this.ChartBorder.GetRight()-this.Width-this.Left},this.GetTop=function(){return this.IsHScreen?this.ShowPosition==0?this.ChartBorder.GetTop()+this.Left:this.ChartBorder.GetBottom()-this.Width-this.Left:this.ChartBorder.GetTopEx()+this.Top},this.IsEnableDraw=function(){if(!this.HQChart||!this.HQChart.TitlePaint||!this.HQChart.TitlePaint[0])return!1;if(this.HQChart.DragMode==be.CLICK_TOUCH_MODE_ID){if(this.HQChart.TouchStatus.CorssCursorShow==!1)return!1}else if(this.HQChart.EnableClickModel){if(this.HQChart.ClickModel.IsShowCorssCursor===!1)return!1}else if(this.HQChart.VerticalDrag){if(this.HQChart.VerticalDrag.IsDrag)return!1}else if(!this.HQChart.IsOnTouch)return!1;return!this.HQChart.CurrentChartDrawPicture},this.Draw=function(){if(this.IsEnableDraw()){this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.KLineTitlePaint=this.HQChart.TitlePaint[0];var r=this.KLineTitlePaint.GetCurrentKLineData();if(r){var n=this.GetFormatTitle({Data:r});!n||!c.IsNonEmptyArray(n.AryText)||(this.CalculateTooltipSize(n),this.CalculateShowPosition(),this.DrawBG(),this.DrawTooltipData(n),this.DrawBorder())}}},this.CalculateTooltipSize=function(r){this.Canvas.font=this.Font[0],this.LineHeight=this.Canvas.measureText("擎").width;for(var n=V(),e=0,t=0,a=0,s=0,o=0;o<r.AryText.length;++o){var h=r.AryText[o];e>0&&(e+=this.LineSpace);var l=0;if(h.Title){var u=this.Canvas.measureText(h.Title).width+2;t<u&&(t=u),l+=u}if(h.Text){var u=this.Canvas.measureText(h.Text).width+2;a<u&&(a=u),l+=u}s<l&&(s=l),e+=this.LineHeight}return this.Height=e+(this.Mergin.Top+this.Mergin.Bottom)*n,this.Width=s+(this.Mergin.Left+this.Mergin.Right+this.ExtendLineWidth)*n,{Height:this.Height,Width:this.Width,MaxTitleWidth:t,MaxTextWidth:a}},this.CalculateShowPosition=function(){if(this.ShowPosition=0,!!this.LatestPoint)if(this.IsHScreen){var r=this.ChartBorder.GetTop(),n=this.ChartBorder.GetHeight(),e=r+n/2;this.LatestPoint.Y<e&&(this.ShowPosition=1)}else{var t=this.ChartBorder.GetLeft(),a=this.ChartBorder.GetWidth(),s=t+a/2;this.LatestPoint.X<s&&(this.ShowPosition=1)}},this.GetFormatTitle=function(r){if(!(!r||!r.Data)){var n=r.Data,e;this.HQChart.Symbol&&(e=this.HQChart.Symbol.toUpperCase());var t=fe(this.HQChart.Symbol),a=[],s={AryText:a},o,h,l;o=c.FormatDateString(n.Date),a.push({Text:o,Color:this.DateTimeColor});var u=this.HQChart.Period;if(k.IsMinutePeriod(u,!0)&&c.IsNumber(n.Time)?(o=c.FormatTimeString(n.Time),a.push({Text:o,Color:this.DateTimeColor})):k.IsSecondPeriod(u)&&c.IsNumber(n.Time)&&(o=c.FormatTimeString(n.Time,"HH:MM:SS"),a.push({Text:o,Color:this.DateTimeColor})),c.IsNumber(n.Open)&&(h=gt.GetText("Tooltip-Open",this.LanguageID),l=this.KLineTitlePaint.GetColor(n.Open,n.YClose),o=n.Open.toFixed(t),a.push({Title:h,TitleColor:this.TitleColor,Text:o,Color:l})),c.IsNumber(n.High)&&(h=gt.GetText("Tooltip-High",this.LanguageID),l=this.KLineTitlePaint.GetColor(n.High,n.YClose),o=n.High.toFixed(t),a.push({Title:h,TitleColor:this.TitleColor,Text:o,Color:l})),c.IsNumber(n.Low)&&(h=gt.GetText("Tooltip-Low",this.LanguageID),l=this.KLineTitlePaint.GetColor(n.Low,n.YClose),o=n.Low.toFixed(t),a.push({Title:h,TitleColor:this.TitleColor,Text:o,Color:l})),c.IsNumber(n.Close)&&(h=gt.GetText("Tooltip-Close",this.LanguageID),l=this.KLineTitlePaint.GetColor(n.Close,n.YClose),o=n.Close.toFixed(t),a.push({Title:h,TitleColor:this.TitleColor,Text:o,Color:l})),h=gt.GetText("Tooltip-Increase",this.LanguageID),n.YFClose!=0&&W.IsChinaFutures(e)){var f=(n.Close-n.YFClose)/n.YFClose*100;l=this.KLineTitlePaint.GetColor(f,0),o=f.toFixed(2)+"%"}else if(n.YClose!=0){var f=(n.Close-n.YClose)/n.YClose*100;l=this.KLineTitlePaint.GetColor(f,0),o=f.toFixed(2)+"%"}else o="--.--",l=this.KLineTitlePaint.GetColor(0,0);if(a.push({Title:h,TitleColor:this.TitleColor,Text:o,Color:l}),c.IsNumber(n.Vol)){h=gt.GetText("Tooltip-Vol",this.LanguageID);var C=n.Vol;e&&W.IsSHSZ(e)&&(C/=100),o=c.FromatIntegerString(C,2,this.LanguageID),a.push({Title:h,TitleColor:this.TitleColor,Text:o,Color:this.VolColor})}if(c.IsNumber(n.Amount)){h=gt.GetText("Tooltip-Amount",this.LanguageID);var o=c.FormatValueString(n.Amount,2,this.LanguageID);a.push({Title:h,TitleColor:this.TitleColor,Text:o,Color:this.AmountColor})}if(W.IsSHSZStockA(this.HQChart.Symbol)&&n.FlowCapital>0){h=gt.GetText("Tooltip-Exchange",this.LanguageID);var f=n.Vol/n.FlowCapital*100,o=f.toFixed(2)+"%";a.push({Title:h,TitleColor:this.TitleColor,Text:o,Color:this.TitleColor})}if(W.IsFutures(e)&&c.IsNumber(n.Position)){h=gt.GetText("Tooltip-Position",this.LanguageID);var o=c.FromatIntegerString(n.Position,2,this.LanguageID);a.push({Title:h,TitleColor:this.TitleColor,Text:o,Color:this.TitleColor})}return s}},this.DrawTooltipData=function(r){if(!(!r||!c.IsNonEmptyArray(r.AryText))){var n=V(),e=this.GetLeft()+2*n,t=this.GetTop()+3*n;if(this.IsHScreen){this.Canvas.save();var a=this.GetLeft()+this.Height,s=this.GetTop();this.Canvas.translate(a,s),this.Canvas.rotate(90*Math.PI/180),e=2*n,t=3*n}this.Canvas.textBaseline="top";var o=e+this.Width-this.Mergin.Right*n;e+=this.Mergin.Left*n,t+=this.Mergin.Top*n;for(var h=0;h<r.AryText.length;++h){var l=r.AryText[h];l.Title&&(this.Canvas.textAlign="left",this.Canvas.fillStyle=l.TitleColor,this.Canvas.fillText(l.Title,e,t)),l.Text&&(this.Canvas.textAlign="right",this.Canvas.fillStyle=l.Color,this.Canvas.fillText(l.Text,o,t)),t+=this.LineHeight+this.LineSpace}this.IsHScreen&&this.Canvas.restore()}},this.DrawBorder=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.GetLeft(),e=this.GetTop();this.Canvas.strokeStyle=this.BorderColor,r?this.Canvas.strokeRect(L(n),L(e),this.Height,this.Width):this.Canvas.strokeRect(L(n),L(e),B(this.Width),B(this.Height))},this.DrawBG=function(){var r=this.ChartFrame.IsHScreen===!0,n=this.GetLeft(),e=this.GetTop();this.Canvas.fillStyle=this.BGColor,r?this.Canvas.fillRect(n,e,this.Height,this.Width):this.Canvas.fillRect(n,e,this.Width,this.Height)},this.SetOption=function(r){r.LineHeight>0&&(this.LineHeight=r.LineHeight*V()),r.BGColor&&(this.BGColor=r.BGColor),r.LanguageID>0&&(this.LanguageID=r.LanguageID)}}function wC(){this.newMethod=Yh,this.newMethod(),delete this.newMethod,this.ClassName="MinuteTooltipPaint",this.Left=1*V(),this.Top=1*V(),this.YClose,this.IsShowAveragePrice=!0,this.TitlePaint,this.GetTop=function(){if(this.IsHScreen){var r=this.ChartBorder.GetHScreenBorder();return this.ShowPosition==0?r.TopEx+this.Left:r.BottomEx-this.Width-this.Left}else{var r=this.ChartBorder.GetBorder();return r.Top+this.Top}},this.GetLeft=function(){if(this.IsHScreen){var r=this.ChartBorder.GetHScreenBorder();return r.Right-this.Height-this.Top}else{var r=this.ChartBorder.GetBorder();return this.ShowPosition==0?r.LeftEx+this.Left:r.RightEx-this.Width-this.Left}},this.Draw=function(){if(this.IsEnableDraw()&&(this.IsHScreen=this.ChartFrame.IsHScreen===!0,this.TitlePaint=this.HQChart.TitlePaint[0],!!this.TitlePaint)){var r,n=this.TitlePaint.PointInfo;if(n&&(n.ClientPos==2||n.ClientPos==3||n.ClientPos>=200&&n.ClientPos<=299||n.ClientPos>=300&&n.ClientPos<=399)){var e=this.TitlePaint.GetCurrentAuctionData();if(!e)return;r={Type:1,Data:e}}else{var t=this.TitlePaint.GetCurrentKLineData();if(!t)return;r={Type:0,Data:t}}var a=this.GetFormatTitle(r);!a||!c.IsNonEmptyArray(a.AryText)||(this.CalculateTooltipSize(a),this.CalculateShowPosition(),this.DrawBG(),this.DrawTooltipData(a),this.DrawBorder())}},this.GetFormatTitle=function(r){if(!(!r||!r.Data)){var n,e,t,a;if(r.Type==0)n=r.Data,e=n.Close,t=n.Vol,a=n.Amount;else if(r.Type==1){if(n=r.Data.Data,!n)return;e=n.Price}var s;this.YClose=this.TitlePaint.YClose,this.HQChart.Symbol&&(s=this.HQChart.Symbol.toUpperCase());var o=fe(this.HQChart.Symbol),h=[],l={AryText:h},u,f,C;c.IsNumber(n.Date)&&(u=c.FormatDateString(n.Date),h.push({Text:u,Color:this.DateTimeColor})),c.IsNumber(n.Time)&&(u=c.FormatTimeString(n.Time),h.push({Text:u,Color:this.DateTimeColor})),c.IsNumber(e)&&(f=gt.GetText("Tooltip-Price",this.LanguageID),C=this.TitlePaint.GetColor(e,this.YClose),u=e.toFixed(o),h.push({Title:f,TitleColor:this.TitleColor,Text:u,Color:C}));var D=!0;if((W.IsForeignExchange(s)||W.IsET(s)&&!W.IsETShowAvPrice(s)||W.IsShowAvPrice&&!W.IsShowAvPrice(s))&&(D=!1),D&&c.IsNumber(n.AvPrice)&&this.IsShowAveragePrice){f=gt.GetText("Tooltip-AvPrice",this.LanguageID);var C=this.TitlePaint.GetColor(n.AvPrice,this.YClose);u=n.AvPrice.toFixed(o),h.push({Title:f,TitleColor:this.TitleColor,Text:u,Color:C})}if(c.IsNumber(e)&&c.IsNumber(this.YClose)){f=gt.GetText("Tooltip-Increase",this.LanguageID);var v=(e-this.YClose)/this.YClose*100;C=this.TitlePaint.GetColor(v,0),u=v.toFixed(2)+"%",h.push({Title:f,TitleColor:this.TitleColor,Text:u,Color:C})}if(c.IsNumber(t)){f=gt.GetText("Tooltip-Vol",this.LanguageID);var u=c.FromatIntegerString(t,2,this.LanguageID);h.push({Title:f,TitleColor:this.TitleColor,Text:u,Color:this.VolColor})}if(c.IsNumber(a)){f=gt.GetText("Tooltip-Amount",this.LanguageID);var u=c.FormatValueString(a,2,this.LanguageID);h.push({Title:f,TitleColor:this.TitleColor,Text:u,Color:this.AmountColor})}if(c.IsNumber(n.Position)){f=gt.GetText("Tooltip-Position",this.LanguageID);var u=c.FormatValueString(n.Position,2,this.LanguageID);h.push({Title:f,TitleColor:this.TitleColor,Text:u,Color:this.TitleColor})}return l}}}function dd(){this.newMethod=ga,this.newMethod(),delete this.newMethod,this.IsDynamic=!0,this.IsEraseBG=!0,this.DrawAfterTitle=!0,this.ClassName="MinuteLeftTooltipPaint",this.BorderColor=m.PCTooltipPaint.BorderColor,this.BGColor=m.PCTooltipPaint.BGColor,this.TitleColor=m.PCTooltipPaint.TitleColor,this.DateTimeColor=m.PCTooltipPaint.DateTimeColor,this.VolColor=m.PCTooltipPaint.VolColor,this.AmountColor=m.PCTooltipPaint.AmountColor,this.LanguageID=ke.LANGUAGE_CHINESE_ID,this.TitlePaint,this.UpColor=m.UpTextColor,this.DownColor=m.DownTextColor,this.UnchagneColor=m.UnchagneTextColor,this.YClose,this.Mergin={Left:2,Top:3,Bottom:2,Right:2},this.LineHeight=15,this.FixedWidth,this.Font=m.PCTooltipPaint.TitleFont,this.HQChart,this.SetOption=function(r){r.BGColor&&(this.BGColor=r.BGColor),r.LanguageID>0&&(this.LanguageID=r.LanguageID),c.IsNumber(r.FixedWidth)&&(this.FixedWidth=r.FixedWidth)},this.IsEnableDraw=function(){if(!this.HQChart||!this.HQChart.TitlePaint||!this.HQChart.TitlePaint[0])return!1;var r=this.HQChart.LastPoint;return r?this.HQChart.IsMouseOnClient(r.X,r.Y):!1},this.Draw=function(){if(this.IsEnableDraw()&&(this.TitlePaint=this.HQChart.TitlePaint[0],!!this.TitlePaint)){var r=this.TitlePaint.PointInfo,n;if(r&&(r.ClientPos==2||r.ClientPos==3||r.ClientPos>=200&&r.ClientPos<=299||r.ClientPos>=300&&r.ClientPos<=399)){var e=this.TitlePaint.GetCurrentAuctionData();if(!e)return;n={Type:1,Data:e}}else{var t=this.TitlePaint.GetCurrentKLineData();if(!t)return;n={Type:0,Data:t}}this.YClose=this.TitlePaint.YClose;var a=this.GetForamtTitle(n);if(c.IsNonEmptyArray(a)){this.Canvas.font=this.Font,this.Canvas.textBaseline="top",this.LineHeight=Aa(this.Canvas,null,"擎");var s=this.ChartBorder.GetBorder(),o=this.LineHeight*a.length*2,h={Left:1,Top:1,Right:s.Left};h.Bottom=h.Top+o,h.Width=h.Right-h.Left,h.Height=h.Bottom-h.Top,h.Height+=this.Mergin.Top+this.Mergin.Bottom,h.Bottom=h.Top+h.Height,c.IsNumber(this.FixedWidth)&&(h.Width=this.FixedWidth),this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(h.Left,h.Top,h.Width,h.Height),this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(L(h.Left),L(h.Top),B(h.Width),B(h.Height));var l=h.Left+h.Width-this.Mergin.Right,u=this.Mergin.Left+h.Left,f=this.Mergin.Top+h.Top,C={Left:u,Top:f,Right:l};C.Width=C.Right-C.Left;for(var D=0;D<a.length;++D){var v=a[D];this.DrawText(v,C)}}}},this.DrawText=function(r,n){this.Canvas.fillStyle=r.TitleColor,this.Canvas.textAlign="left",this.Canvas.fillText(r.Title,n.Left,n.Top),n.Top+=this.LineHeight,n.Bottom=n.Top+this.LineHeight,this.Canvas.textAlign="right",this.Canvas.fillStyle=r.TextColor,this.Canvas.fillText(r.Text,n.Right,n.Top),n.Top+=this.LineHeight,n.Bottom=n.Top+this.LineHeight},this.GetForamtTitle=function(r){if(!r||!r.Data)return null;var n=[],e;this.HQChart.Symbol&&(e=this.HQChart.Symbol.toUpperCase());var t=fe(e);if(r.Type==0){var a=r.Data,s=this.FormatDate(a.Date);s&&n.push(s);var s=this.ForamtTime(a.Time,"HH:MM","PCTooltip-Time");s&&n.push(s);var s=this.ForamtPrice(a.Close,t,"PCTooltip-Price");s&&n.push(s);var s=this.ForamtPrice(a.AvPrice,t,"PCTooltip-AvPrice");s&&n.push(s);var s=this.ForamtIncrease(a.Close,"PCTooltip-Increase");s&&n.push(s);var s=this.FormatVol(a.Vol,"PCTooltip-Vol");if(s&&n.push(s),c.IsNumber(a.Amount)){var s={Title:gt.GetText("PCTooltip-Amount",this.LanguageID),TitleColor:this.TitleColor,Text:c.FromatIntegerString(a.Amount,2,this.LanguageID),TextColor:this.AmountColor};n.push(s)}}else if(r.Type==1){var a=r.Data.Data;if(!a)return;var s=this.FormatDate(a.Date);s&&n.push(s);var o="HH:MM:SS";a.Ver===1&&(o="HH:MM");var s=this.ForamtTime(a.Time,o,"PCTooltip-Time");s&&n.push(s);var s=this.ForamtPrice(a.Price,t,"PCTooltip-AC-Price");s&&n.push(s);var s=this.ForamtIncrease(a.Price,"PCTooltip-AC-Increase");if(s&&n.push(s),c.IsNonEmptyArray(a.Vol)){var s=this.FormatVol(a.Vol[0],"PCTooltip-AC-Vol");s&&n.push(s);var s=this.FormatVol(a.Vol[1],"PCTooltip-AC-NotMatchVol");s&&n.push(s)}}return n},this.GetColor=function(r,n){return r>n?this.UpColor:r<n?this.DownColor:this.UnchagneColor},this.FormatDate=function(r){if(!c.IsNumber(r))return null;var n={Title:gt.GetText("PCTooltip-Date",this.LanguageID),TitleColor:this.TitleColor,Text:c.FormatDateString(r,"MM-DD",this.LanguageID),TextColor:this.DateTimeColor};return n},this.ForamtTime=function(r,n,e){if(!c.IsNumber(r))return null;var t={Title:gt.GetText(e,this.LanguageID),TitleColor:this.TitleColor,Text:c.FormatTimeString(r,n,this.LanguageID),TextColor:this.DateTimeColor};return t},this.ForamtPrice=function(r,n,e){if(!c.IsNumber(r))return null;var t={Title:gt.GetText(e,this.LanguageID),TitleColor:this.TitleColor,Text:r.toFixed(n),TextColor:this.GetColor(r,this.YClose)};return t},this.ForamtIncrease=function(r,n){if(!c.IsNumber(r)||r==0)return null;var e=(r-this.YClose)/this.YClose*100,t={Title:gt.GetText(n,this.LanguageID),TitleColor:this.TitleColor,Text:e.toFixed(2)+"%",TextColor:this.GetColor(e,0)};return t},this.FormatVol=function(r,n){if(!c.IsNumber(r))return null;var e={Title:gt.GetText(n,this.LanguageID),TitleColor:this.TitleColor,Text:c.FromatIntegerString(r,2,this.LanguageID),TextColor:this.VolColor};return e}}function md(){this.newMethod=ga,this.newMethod(),delete this.newMethod,this.Left=80,this.Right=1,this.Top=1,this.Bottom=1,this.BorderColor=m.FrameBorderPen,this.Symbol,this.Name,this.TitleFont=["14px 微软雅黑"],this.Draw=function(){var r=this.ChartBorder.GetRight()+this.Left,n=this.ChartBorder.GetChartWidth()-this.Right,e=this.Top+18,t=r+(n-r)/2;this.Symbol&&this.Name&&(this.Canvas.font=this.TitleFont[0],this.Canvas.textAlign="right",this.Canvas.textBaseline="bottom",this.Canvas.fillText(this.Symbol,t-2,e),this.Canvas.textAlign="left",this.Canvas.fillText(this.Name,t+2,e)),this.Canvas.strokeStyle=this.BorderColor,this.Canvas.moveTo(r,e),this.Canvas.lineTo(n,e),this.Canvas.stroke(),e+=30,this.DrawBorder()},this.DrawBorder=function(){var r=this.ChartBorder.GetRight()+this.Left,n=this.ChartBorder.GetChartWidth()-this.Right,e=this.Top,t=this.ChartBorder.GetChartHeight()-this.Bottom;this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(r,e,n-r,t-e)}}function Id(){this.newMethod=ga,this.newMethod(),delete this.newMethod,this.Name="筹码分布",this.ClassName="StockChip",this.HQChart,this.PenBorder=m.FrameBorderPen,this.ColorProfit="rgb(255,0,0)",this.ColorNoProfit="rgb(90,141,248)",this.ColorAveragePrice="rgb(0,139,0)",this.ColorBG="rgb(190,190,190)",this.PixelRatio=V(),this.ShowType=0,this.IsDynamic=!0,this.ClientRect={},this.Font=m.TitleFont,this.InfoColor=m.StockChip.InfoColor,this.DayInfoColor=m.StockChip.DayInfoColor,this.LineHeight=16,this.Left=50*this.PixelRatio,this.IsShowX=!1,this.ShowXCount=3,this.Width=150*this.PixelRatio,this.CalculateType=0,this.PriceZoom=100,this.NotSupportMessage="不支持筹码图",this.Buttons=[],this.DefaultButton=ne(m.StockChip.DefaultButton),this.LongButton=ne(m.StockChip.LongButton),this.RecentButton=ne(m.StockChip.RecentButton),this.ButtonTooltip=ne(m.Buttons.Tooltip),this.DAY_COLOR=[["rgb(255,0,0)","rgb(255,128,128)","rgb(255,0,128)","rgb(255,100,0)","rgb(192,128,0)","rgb(255,192,0)"],["rgb(120,80,225)","rgb(160,160,225)","rgb(80,80,255)","rgb(120,120,255)","rgb(32,64,192)","rgb(0,64,128)"]],this.SetOption=function(r){r&&(r.ShowType>0&&(this.ShowType=r.ShowType),r.IsShowX&&(this.IsShowX=r.IsShowX),r.ShowXCount>0&&(this.ShowXCount=r.ShowXCount),r.Width>100&&(this.Width=r.Width*V()),r.CalculateType>0&&(this.CalculateType=r.CalculateType),c.IsNumber(r.PriceZoom)&&(this.PriceZoom=r.PriceZoom))},this.ReloadResource=function(r){this.PenBorder=m.FrameBorderPen,this.Font=m.TitleFont,this.InfoColor=m.StockChip.InfoColor,this.DayInfoColor=m.StockChip.DayInfoColor,this.DefaultButton=ne(m.StockChip.DefaultButton),this.LongButton=ne(m.StockChip.LongButton),this.RecentButton=ne(m.StockChip.RecentButton),this.ButtonTooltip=ne(m.Buttons.Tooltip)},this.Draw=function(){this.PixelRatio=V();var r=L(this.ChartBorder.GetRight()+this.Left),n=L(this.ChartBorder.GetTop()),e=L(r+this.Width-1*this.PixelRatio),t=L(this.ChartBorder.GetBottom()),a=e-r,s=t-n;if(this.ClientRect={Left:r,Top:n,Width:a,Height:s},k.IsTickPeriod(this.HQChart.Period)){this.Canvas.font=this.Font,this.Canvas.fillStyle=this.InfoColor;var o=r+a/2,h=n+s/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillText(this.NotSupportMessage,o,h),this.DrawBorder();return}this.CalculateChip()?(this.DrawFrame(),this.DrawAllChip(),(this.ShowType==1||this.ShowType==2)&&this.DrawDayChip(),this.CalculateCast(),this.DrawChipInfo()):X.Chart.Log("[StockChip::Draw] no data"),this.DrawBorder(),this.SizeChange=!1},this.DrawChipInfo=function(){var r=this.ClientRect.Top+this.ClientRect.Height-1,n=this.ClientRect.Left+2,o=this.ClientRect.Left+this.ClientRect.Width;this.Canvas.font=this.Font,this.Canvas.fillStyle=this.InfoColor,this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left";var e=this.LineHeight*V(),t="70%成本价 --.--";c.IsNonEmptyArray(this.Data.Cast)&&(t="70%成本价"+this.Data.Cast[1].MinPrice.toFixed(2)+"-"+this.Data.Cast[1].MaxPrice.toFixed(2)+"集中"+this.Data.Cast[1].Rate.toFixed(2)+"%"),this.Canvas.fillText(t,n,r),r-=e,t="90%成本价 --.--",c.IsNonEmptyArray(this.Data.Cast)&&(t="90%成本价"+this.Data.Cast[0].MinPrice.toFixed(2)+"-"+this.Data.Cast[0].MaxPrice.toFixed(2)+"集中"+this.Data.Cast[0].Rate.toFixed(2)+"%"),this.Canvas.fillText(t,n,r),r-=e,t="平均成本："+this.Data.ChipInfo.AveragePrice.toFixed(2)+"元",this.Canvas.fillText(t,n,r),r-=e,t=+this.Data.YPrice.toFixed(2)+"处获利盘："+this.Data.ChipInfo.YProfitRate.toFixed(2)+"%",this.Canvas.fillText(t,n,r),r-=e,t="获利比例：",this.Canvas.fillText(t,n,r);var h=this.Canvas.measureText(t).width+2,a=n+h,s=o-5-a;if(this.Canvas.strokeStyle=this.ColorNoProfit,this.Canvas.strokeRect(a,r-e,s,e),this.Canvas.strokeStyle=this.ColorProfit,this.Canvas.strokeRect(a,r-e,s*(this.Data.ChipInfo.ProfitRate/100),e),t=this.Data.ChipInfo.ProfitRate.toFixed(2)+"%",this.Canvas.textAlign="center",this.Canvas.fillText(t,a+s/2,r),r-=e,this.Canvas.textAlign="left",t="成本分布,日期："+c.FormatDateString(this.Data.SelectData.Date),this.Data.SelectData.Time&&(t+=" "+c.FormatTimeString(this.Data.SelectData.Time)),this.Canvas.fillText(t,n,r),r-=e,!(this.ShowType!=1&&this.ShowType!=2)){var o=this.ClientRect.Left+this.ClientRect.Width-1;this.Canvas.textAlign="right";var h=50;this.Data.DayChip.sort(function(C,D){return D.Day-C.Day});for(var l in this.Data.DayChip){var u=this.Data.DayChip[l],f=0;this.Data.ChipInfo&&this.Data.ChipInfo.Vol>0&&(f=u.Vol/this.Data.ChipInfo.Vol*100),t=u.Day+"周期"+(this.ShowType==1?"前":"内")+"成本"+(c.IsNumber(f)?f.toFixed(2)+"%":"--.--%"),l==0&&(h=this.Canvas.measureText(t).width+8),this.Canvas.fillStyle=u.Color,this.Canvas.fillRect(o-h,r-e,h,e),this.Canvas.fillStyle=this.DayInfoColor,this.Canvas.fillText(t,o,r),r-=e}}},this.DrawDayChip=function(){var r=this.HQChart.Frame.SubFrame[0].Frame;for(var n in this.Data.DayChip){var e=[],t=this.Data.DayChip[n].Chip;if(t){for(var a=0,s=0;s<t.length;++s){var o=t[s];if(o){a+=o;var h=(s+this.Data.MinPrice)/100,l=r.GetYFromData(h),u=o/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;e.push({X:u,Y:l})}}this.Data.DayChip[n].Vol=a,this.DrawArea(e,this.Data.DayChip[n].Color)}}},this.DrawToolbar=function(r,n){this.Buttons=[],this.ClientRect.Left;for(var e=this.ClientRect.Left+this.ClientRect.Width,t=this.ClientRect.Top+this.ChartBorder.TitleHeight/2,a=[{ID:xt.CHIP_RECENT,Style:this.RecentButton,ShowType:2},{ID:xt.CHIP_LONG,Style:this.LongButton,ShowType:1},{ID:xt.CHIP_DEFULT,Style:this.DefaultButton,ShowType:0}],s=0;s<a.length;++s){var o=a[s],h=o.Style.Size,l=e-h-o.Style.MerginLeft,u=h+"px "+o.Style.Family,f={Left:l,Top:t-h/2,Right:l+h+o.Style.MerginLeft,Bottom:t+h/2,Width:h+o.Style.MerginLeft,Height:h},C=o.Style.Color,D={ID:o.ID,Rect:f};this.ShowType==o.ShowType?(C=o.Style.SelectedColor,n&&r&&r.X>=f.Left&&r.X<f.Right&&r.Y>=f.Top&&r.Y<=f.Bottom&&(n.MouseOnToolbar={Rect:f,Item:D,Frame:this,Point:{X:r.X,Y:r.Y}})):r&&r.X>=f.Left&&r.X<f.Right&&r.Y>=f.Top&&r.Y<=f.Bottom&&(C=o.Style.MoveOnColor,n&&(n.MouseOnToolbar={Rect:f,Item:D,Frame:this,Point:{X:r.X,Y:r.Y}})),this.Canvas.fillStyle=C,this.Canvas.font=u,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(o.Style.Text,l,t),this.Buttons.push(D),e=l}},this.DrawToolbarTooltip=function(r){if(r){this.ClientRect.Left;var n=this.ClientRect.Left+this.ClientRect.Width,e="Toolbar-"+r.Item.ID;if(text=gt.GetText(e,0),!!text){var t=r.Rect,a=t.Left+t.Width/2;this.Canvas.font=this.ButtonTooltip.Font,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";var s=this.Canvas.measureText(text).width+8,o=this.GetFontHeight(),h=o+8,l=a-s/2,u=t.Top-h;u<0&&(u=t.Bottom+1),l+s>n&&(l=n-s-2),this.Canvas.fillStyle=this.ButtonTooltip.ColorBG,this.Canvas.fillRect(l,u,s,h),this.Canvas.fillStyle=this.ButtonTooltip.Color,this.Canvas.fillText(text,l+4,u+h/2)}}},this.PtInButtons=function(r,n){for(var e=0;e<this.Buttons.length;++e){var t=this.Buttons[e];if(t.Rect){var a=t.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(a.Left,a.Top,a.Width,a.Height),this.Canvas.isPointInPath(r,n))return{ID:t.ID,Rect:a}}}return null},this.DrawAllChip=function(){for(var r=this.HQChart.Frame.SubFrame[0].Frame,n=this.Data.SelectData.Close,e=[],t=[],a=0,s=0,o=0,h=0,l=this.Data.YPrice,u=r.HorizontalMax,f=r.HorizontalMin,C=1,D=0;D<this.Data.AllChip.length;++D){var v=this.Data.AllChip[D];if(v){var S=(D+this.Data.MinPrice)/this.PriceZoom;a+=v,s+=S*v,S<l&&(h+=v),S<n&&(o+=v),S<=u&&S>=f&&C<v&&(C=v)}}this.Data.MaxVol=C;for(var D=0;D<this.Data.AllChip.length;++D){var v=this.Data.AllChip[D];if(v){var S=(D+this.Data.MinPrice)/this.PriceZoom;if(!(S>u||S<f)){var T=r.GetYFromData(S),I=v/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;S<n?e.push({X:I,Y:T}):t.push({X:I,Y:T})}}}if(this.Data.ChipInfo={Vol:a,AveragePrice:s/a,ProfitVol:o,ProfitRate:a>0?o/a*100:0,YProfitRate:a>0?h/a*100:0},this.ShowType==0){this.DrawLines(e,this.ColorProfit),this.DrawLines(t,this.ColorNoProfit);var F=this.Data.ChipInfo.AveragePrice;F>0&&F<=u&&F>=f&&(F=F.toFixed(2),this.DrawAveragePriceLine(e,t,r.GetYFromData(F),this.ColorAveragePrice))}else this.DrawLines(e,this.ColorBG),this.DrawLines(t,this.ColorBG)},this.CalculateCast=function(){if(!(!this.Data.ChipInfo||!this.Data.ChipInfo.Vol)){var r=[{Start:.05,End:.95,MaxPrice:0,MinPrice:0,Rate:0},{Start:.15,End:.85,MaxPrice:0,MinPrice:0,Rate:0}];this.Data.ChipInfo.AveragePrice;for(var n=this.Data.ChipInfo.ProfitVol,e=0,t=0,a=0;t<this.Data.AllChip.length&&a!=4;++t){var s=this.Data.AllChip[t];if(!(s<=0)){var o=(t+this.Data.MinPrice)/this.PriceZoom;e+=s;var h=e/n;for(var l in r){var u=r[l];u.MinPrice<=0&&h>u.Start&&(u.MinPrice=o,++a),u.MaxPrice<=0&&h>u.End&&(u.MaxPrice=o,++a)}}}for(var t in r){var f=r[t],C=f.MaxPrice+f.MinPrice;C&&(f.Rate=Math.abs(f.MaxPrice-f.MinPrice)/C*100)}this.Data.Cast=r}},this.DrawArea=function(r,n){if(!(r.length<=0)){this.Canvas.fillStyle=n,this.Canvas.beginPath(),this.Canvas.moveTo(this.ClientRect.Left,r[0].Y);for(var e in r){var t=r[e];this.Canvas.lineTo(t.X,t.Y)}this.Canvas.lineTo(this.ClientRect.Left,r[r.length-1].Y),this.Canvas.fill()}},this.DrawLines=function(r,n){if(!(r.length<=0)){this.Canvas.strokeStyle=n,this.Canvas.beginPath();for(var e in r){var t=r[e];this.Canvas.moveTo(this.ClientRect.Left,t.Y),this.Canvas.lineTo(t.X,t.Y)}this.Canvas.stroke()}},this.DrawAveragePriceLine=function(r,n,e,t){for(var a in r){var s=r[a];if(s.Y==e){this.Canvas.strokeStyle=t,this.Canvas.beginPath(),this.Canvas.moveTo(this.ClientRect.Left,s.Y),this.Canvas.lineTo(s.X,s.Y),this.Canvas.stroke();return}}for(var a in n){var s=n[a];if(s.Y==e){this.Canvas.strokeStyle=t,this.Canvas.beginPath(),this.Canvas.moveTo(this.ClientRect.Left,s.Y),this.Canvas.lineTo(s.X,s.Y),this.Canvas.stroke();return}}},this.DrawBorder=function(){this.Canvas.strokeStyle=this.PenBorder,this.Canvas.strokeRect(this.ClientRect.Left,this.ClientRect.Top,this.ClientRect.Width,this.ClientRect.Height)},this.EvenlyDistribute=function(r,n){var e=n.Low,t=n.High,a=n.MaxPrice,s=n.MinPrice,o=1;if(t-e!=0){for(var h=n.Vol/(t-e),l=e;l<=t&&l<=a;++l){var u=l-s;r[u]+=h,o<r[u]&&(o=r[u])}n.MaxVol=o}},this.TriangleDistribute=function(r,n){var e=n.Low,t=n.High;n.MaxPrice;for(var a=n.MinPrice,s=1,o=45,h=3.1415926535,l=(t-e)/2+e,u=0,f=[],C=e+1,D=1;C<=l;++C,++D){var v=Math.tan(o*h/180)*D;u+=v,f.push({Index:C-a,Value:v})}for(var C=t-1,D=1;C>l;--C,++D){var v=Math.tan(o*h/180)*D;u+=v,f.push({Index:C-a,Value:v})}if(u>0){for(var C=0;C<f.length;++C){var S=f[C];r[S.Index]+=S.Value*n.Vol/u,s<r[S.Index]&&(s=r[S.Index])}n.MaxVol=s}},this.CalculateDistribute=function(r,n){this.CalculateType==1?this.TriangleDistribute(r,n):this.EvenlyDistribute(r,n)},this.CalculateChip=function(){if(!this.HQChart||!this.HQChart.FlowCapitalReady)return!1;var r=this.HQChart.Symbol;if(!r||W.IsSHSZIndex(r))return!1;var n=this.HQChart.ChartPaint[0].Data,e=n.DataOffset+parseInt(this.HQChart.CursorIndex);e>=n.Data.length&&(e=n.Data.length-1);var t=n.Data[e],a=t.Close,s=this.HQChart.LastPoint.Y;s&&(a=this.HQChart.Frame.SubFrame[0].Frame.GetYData(s));for(var o=1,h=[],l=1,u,f,C,D=e;D>=0;--D){var v=n.Data[D],S=1;v.FlowCapital>0&&(S=v.Vol/v.FlowCapital),D==e?u=v.Vol*S:u=v.Vol*l;var T={Vol:u,High:v.High,Low:v.Low};h.push(T),l*=1-S*o,(!f||f<v.High)&&(f=v.High),(!C||C>v.Low)&&(C=v.Low)}if(!f||!C)return!0;var I=this.PriceZoom;f=parseInt(f*I),C=parseInt(C*I);for(var F=f-C,E=new Array,M=0;M<=F;++M)E.push(0);var O=[],R;if(this.ShowType==2){var O=[{Day:100,Color:this.DAY_COLOR[1][5]},{Day:60,Color:this.DAY_COLOR[1][4]},{Day:30,Color:this.DAY_COLOR[1][3]},{Day:20,Color:this.DAY_COLOR[1][2]},{Day:10,Color:this.DAY_COLOR[1][1]},{Day:5,Color:this.DAY_COLOR[1][0]}];for(var b in h){var v=h[b],p=parseInt(v.High*I),G=parseInt(v.Low*I),Y=v.Vol;if(p-G>0&&(Y=v.Vol/(p-G)),!(Y<=1e-9)){for(var Q=0;Q<O.length;++Q)if(b==O[Q].Day){O[Q].Chip=E.slice(0);break}R={Low:G,High:p,Vol:v.Vol,MaxPrice:f,MinPrice:C},this.CalculateDistribute(E,R)}}}else if(this.ShowType==1)for(var O=[{Day:5,Color:this.DAY_COLOR[0][0]},{Day:10,Color:this.DAY_COLOR[0][1]},{Day:20,Color:this.DAY_COLOR[0][2]},{Day:30,Color:this.DAY_COLOR[0][3]},{Day:60,Color:this.DAY_COLOR[0][4]},{Day:100,Color:this.DAY_COLOR[0][5]}],ht=h.length-1;ht>=0;--ht){var v=h[ht],p=parseInt(v.High*I),G=parseInt(v.Low*I),Y=v.Vol;if(p-G>0&&(Y=v.Vol/(p-G)),!(Y<=1e-9)){for(var Q=0;Q<O.length;++Q)if(ht==O[Q].Day){O[Q].Chip=E.slice(0);break}R={Low:G,High:p,Vol:v.Vol,MaxPrice:f,MinPrice:C},this.CalculateDistribute(E,R)}}else for(var Ct in h){var v=h[Ct],p=parseInt(v.High*I),G=parseInt(v.Low*I),Y=v.Vol;p-G>0&&(Y=v.Vol/(p-G)),!(Y<=1e-9)&&(R={Low:G,High:p,Vol:v.Vol,MaxPrice:f,MinPrice:C},this.CalculateDistribute(E,R))}return R?(this.Data={AllChip:E,MaxVol:R.MaxVol,MaxPrice:f,MinPrice:C,SelectData:t,DayChip:O,YPrice:a},!0):!1},this.DrawFrame=function(){if(this.IsShowX!=!1&&!(this.Data.MaxVol<=0)){var r=this.HQChart.Frame.SubFrame.length!==1,n=this.HQChart.Frame.SubFrame[0].Frame,e=n.ChartBorder,t=L(e.GetBottomEx()+1);r||(t=this.ClientRect.Top+this.ClientRect.Height);var a=this.ClientRect.Left,s=a+this.ClientRect.Width;this.Canvas.strokeStyle=this.PenBorder,this.Canvas.beginPath(),r&&(this.Canvas.moveTo(a,t),this.Canvas.lineTo(s,t));var o=this.ShowXCount,h=this.Data.MaxVol,l=Math.floor(h/o);this.Canvas.font=this.Font,this.Canvas.textBaseline="top",this.Canvas.fillStyle=this.InfoColor;for(var u=1;u<=o;++u){var f=l*u,C=f/this.Data.MaxVol*this.ClientRect.Width+this.ClientRect.Left;if(C=L(C),u==o){this.Canvas.textAlign="right";var D=c.FormatValueString(h,1);this.Canvas.fillText(D,C,t+2)}else{this.Canvas.moveTo(C,this.ClientRect.Top),this.Canvas.lineTo(C,t),this.Canvas.textAlign="center";var D=c.FormatValueString(f,1),v=this.Canvas.measureText(D).width;this.Canvas.fillText(D,Math.floor(C-v*.25),t+2)}}this.Canvas.stroke()}}}function BC(){this.newMethod=ga,this.newMethod(),delete this.newMethod,this.ClassName="DrawToolsButton",this.HQChart,this.ID=oe(),this.ToolsDiv,this.Color="#696969",this.Top=5*V(),this.Width=45*V(),this.SetOption=function(r){var n=V();r&&r.Width>10&&(this.Width=r.Width*n)},this.Clear=function(){this.ToolsDiv&&this.ChartBorder.UIElement.parentNode.removeChild(this.ToolsDiv)},this.Draw=function(){var r=this;if(this.SizeChange!=!1){var n=[[{HTML:{Title:"线段",IClass:"iconfont icon-draw_line",ID:"icon-segment"},Name:"线段"},{HTML:{Title:"尺子",IClass:"iconfont icon-ruler",ID:"icon_ruler"},Name:"尺子"},{HTML:{Title:"射线",IClass:"iconfont icon-draw_rays",ID:"icon-beam"},Name:"射线"},{HTML:{Title:"标价线",IClass:"iconfont icon-price_line",ID:"icon-price-line"},Name:"标价线"},{HTML:{Title:"垂直线",IClass:"iconfont icon-vertical_line",ID:"icon-vertical-line"},Name:"垂直线"},{HTML:{Title:"箭头",IClass:"iconfont icon-draw_rays",ID:"icon-beam2"},Name:"箭头"},{HTML:{Title:"趋势线",IClass:"iconfont icon-draw_trendline",ID:"icon-trendline"},Name:"趋势线"},{HTML:{Title:"水平线",IClass:"iconfont icon-draw_hline",ID:"icon-hline"},Name:"水平线"},{HTML:{Title:"水平线段",IClass:"iconfont icon-draw_hlinesegment",ID:"icon-hlineseg"},Name:"水平线段"},{HTML:{Title:"平行射线",IClass:"iconfont icon-draw_p_rays_lines",ID:"icon-rayslineseg"},Name:"平行射线"},{HTML:{Title:"平行线",IClass:"iconfont icon-draw_parallel_lines",ID:"icon-parallellines"},Name:"平行线"},{HTML:{Title:"平行通道",IClass:"iconfont icon-draw_parallelchannel",ID:"icon-parallelchannel"},Name:"平行通道"},{HTML:{Title:"价格通道线",IClass:"iconfont icon-draw_pricechannel",ID:"icon-pricechannel"},Name:"价格通道线"},{HTML:{Title:"M头W底",IClass:"iconfont icon-draw_wavemw",ID:"icon-wavemw"},Name:"M头W底"},{HTML:{Title:"头肩型",IClass:"iconfont icon-draw_head_shoulders_bt",ID:"icon-Head-Shoulders"},Name:"头肩型"},{HTML:{Title:"波浪尺",IClass:"iconfont icon-waveruler",ID:"icon-wave-ruler"},Name:"波浪尺"},{HTML:{Title:"AB波浪尺",IClass:"iconfont icon-waveruler",ID:"icon-wave-ruler"},Name:"AB波浪尺"},{HTML:{Title:"箱型线",IClass:"iconfont icon-draw_box",ID:"icon-drawbox"},Name:"箱型线"},{HTML:{Title:"涂鸦线段",IClass:"iconfont icon-draw_line",ID:"icon-segment2"},Name:"涂鸦线段"}],[{HTML:{Title:"圆弧",IClass:"iconfont icon-draw_arc",ID:"icon-arc"},Name:"圆弧线"},{HTML:{Title:"矩形",IClass:"iconfont icon-rectangle",ID:"icon-rect"},Name:"矩形"},{HTML:{Title:"平行四边形",IClass:"iconfont icon-draw_quadrangle",ID:"icon-quad"},Name:"平行四边形"},{HTML:{Title:"三角形",IClass:"iconfont icon-draw_triangle",ID:"icon-triangle"},Name:"三角形"},{HTML:{Title:"圆",IClass:"iconfont icon-draw_circle",ID:"icon-circle"},Name:"圆"},{HTML:{Title:"对称角度",IClass:"iconfont icon-draw_symangle",ID:"icon-symangle"},Name:"对称角度"}],[{HTML:{Title:"文本",IClass:"iconfont icon-draw_text",ID:"icon-text"},Name:"文本"},{HTML:{Title:"向上箭头",IClass:"iconfont icon-arrow_up",ID:"icon-arrowup"},Name:"icon-arrow_up"},{HTML:{Title:"向下箭头",IClass:"iconfont icon-arrow_down",ID:"icon-arrowdown"},Name:"icon-arrow_down"},{HTML:{Title:"向左箭头",IClass:"iconfont icon-arrow_left",ID:"icon-arrowleft"},Name:"icon-arrow_left"},{HTML:{Title:"向右箭头",IClass:"iconfont icon-arrow_right",ID:"icon-arrowright"},Name:"icon-arrow_right"}],[{HTML:{Title:"江恩角度线",IClass:"iconfont icon-draw_gannfan",ID:"icon-gannfan"},Name:"江恩角度线"},{HTML:{Title:"斐波那契周期线",IClass:"iconfont icon-draw_fibonacci",ID:"icon-fibonacci"},Name:"斐波那契周期线"},{HTML:{Title:"阻速线",IClass:"iconfont icon-draw_resline",ID:"icon-resline"},Name:"阻速线"},{HTML:{Title:"黄金分割",IClass:"iconfont icon-draw_goldensection",ID:"icon-goldensection"},Name:"黄金分割"},{HTML:{Title:"百分比线",IClass:"iconfont icon-draw_percentage",ID:"icon-percentage"},Name:"百分比线"},{HTML:{Title:"波段线",IClass:"iconfont icon-draw_waveband",ID:"icon-waveband"},Name:"波段线"},{HTML:{Title:"线形回归线",IClass:"iconfont icon-linear_3",ID:"icon-waveband2"},Name:"线形回归线"},{HTML:{Title:"线形回归带",IClass:"iconfont icon-linear_1",ID:"icon-waveband3"},Name:"线形回归带"},{HTML:{Title:"延长线形回归带",IClass:"iconfont icon-linear_2",ID:"icon-waveband5"},Name:"延长线形回归带"}],[{HTML:{Title:"全部删除",IClass:"iconfont icon-recycle_bin",ID:"icon-delete"},Name:"全部删除"}]],e=this.HQChart;if(!this.ToolsDiv){var t=document.createElement("div");t.className="drawtools",t.id=this.ID;var a="",s="",o=new Array;n.forEach(function(p,G){o.push(p[0])});for(var h=0;h<n.length;h++){for(var l=o[h],u=n[h],f="",C="",D=0;D<u.length;D++){var v=u[D],S=v.Name;S.indexOf("up")>-1?S="向上箭头":S.indexOf("down")>-1?S="向下箭头":S.indexOf("left")>-1?S="向左箭头":S.indexOf("right")>-1&&(S="向右箭头"),f+='<p class="menuTwoItem '+v.HTML.ID+'">'+S+'<i class="'+v.HTML.IClass+'" title="'+v.HTML.Title+'"></i></p>'}h!==n.length-1?(s='<div class="menuTwo">'+f+"</div>",C='<i class="contentArrow iconfont icon-menu_arraw_left"></i>'):(s="",C="");var T='<div class="icon-image first-'+l.HTML.ID+'"><i class="'+l.HTML.IClass+'" title="'+l.HTML.Title+'"></i>'+s+C+"</div>";a+=T}this.ChartBorder.UIElement.parentNode.appendChild(t),t.innerHTML=a,this.ToolsDiv=t;for(var h in n){var I=n[h][0];if((0,q.default)("#"+this.ID+" .first-"+I.HTML.ID).hover(function(){(0,q.default)(".drawtools").find(".contentArrow").hide(),(0,q.default)(this).find(".contentArrow").removeClass("trans").show()}),(0,q.default)("#"+this.ID+" .first-"+I.HTML.ID+" .contentArrow").click(function(G){G.stopPropagation(),(0,q.default)(".drawtools").find(".menuTwo").hide(),(0,q.default)(this).siblings(".menuTwo").show()}),(0,q.default)("#"+this.ID+" .first-"+I.HTML.ID+" .trans").click(function(){event.stopPropagation(),(0,q.default)(this).siblings(".menuTwo").hide()}),I.Name=="全部删除")(0,q.default)("#"+this.ID+" .first-icon-delete").click(function(){(0,q.default)(".drawtools").find(".menuTwo").hide(),(0,q.default)(this).siblings().removeClass("active"),(0,q.default)(this).addClass("active"),e.ClearChartDrawPicture(),(0,q.default)(".subTolls").css("display","none")});else{(0,q.default)("#"+this.ID+" .first-"+o[h].HTML.ID).click({CurrentIndex:h},function(G){(0,q.default)(".drawtools").find(".menuTwo").hide(),(0,q.default)(this).siblings().removeClass("active"),(0,q.default)(this).addClass("active"),e.CreateChartDrawPicture(o[G.data.CurrentIndex].Name)});var F=function(){E=n[h][D];var Y=E.HTML.IClass;(0,q.default)("#"+r.ID+" ."+E.HTML.ID).hover(function(Q){Q.stopPropagation(),(0,q.default)(this).closest(".icon-image").find(".contentArrow").addClass("trans")}),(0,q.default)("#"+r.ID+" ."+E.HTML.ID).click({DrawName:E.Name,CurrentIndex:h,CurrentData:E},function(Q){Q.stopPropagation(),(0,q.default)(this).closest(".icon-image").find(".contentArrow").hide(),(0,q.default)(this).siblings().removeClass("current"),(0,q.default)(this).addClass("current"),(0,q.default)(this).closest(".icon-image").children("i").eq(0).removeClass().addClass(Y,"active").attr("title",Q.data.CurrentData.HTML.Title),o.splice(Q.data.CurrentIndex,1,Q.data.CurrentData),(0,q.default)(this).parent().hide(),e.CreateChartDrawPicture(Q.data.DrawName)})};for(var D in n[h]){var E;F()}}}}var M=this.ID;(0,q.default)(document).click(function(p){!(0,q.default)("#"+M).is(p.target)&&(0,q.default)("#"+M).has(p.target).length===0&&((0,q.default)("#"+M+" .menuTwo").hide(),(0,q.default)("#"+M+" .contentArrow").hide())}),tn();var O=V(),R=L(this.ChartBorder.GetRight()+this.Left),b=this.ChartBorder.GetTop();this.ToolsDiv.style.left=R/O+"px",this.ToolsDiv.style.top=b/O+"px",this.ToolsDiv.style.width=(this.Width-5)/O+"px",this.ToolsDiv.style.height="auto",this.ToolsDiv.style.position="absolute",this.ToolsDiv.style.display="block",this.SizeChange==!0}}}function bC(){this.newMethod=ga,this.newMethod(),delete this.newMethod,this.ClassName="FrameSplitPaint",this.LineColor="rgb(255,0,0)",this.TextColor="rgb(255,0,0)",this.LineWidth=2,this.Font="bold "+18*V()+"px 微软雅黑",this.TextTopOffset=10*V(),this.SetOption=function(r){r&&(r.LineColor&&(this.LineColor=r.LineColor),r.TextColor&&(this.TextColor=r.TextColor),r.Font&&(this.Font=r.Font),c.IsNumber(r.LineWidth)&&(this.LineWidth=r.LineWidth),c.IsNumber(r.TextTopOffset)&&(this.TextTopOffset=r.TextTopOffset))},this.Draw=function(){if(this.HQChart&&!(this.HQChart.Period!=0&&this.HQChart.Period!=1)&&this.HQChart.ChartPaint[0]){var r=this.HQChart.ChartPaint[0].Data;if(r&&(this.Data=r,!(!this.ChartFrame||!this.ChartFrame.SubFrame))){var n=this.ChartFrame.SubFrame[0].Frame;if(n){var e=n.IsHScreen===!0,t=n.DataWidth,a=n.DistanceWidth,s=n.XPointCount,o=this.LineWidth*V();if(e)var h=this.ChartBorder.GetHScreenBorder(),l=h.TopEx+a/2+m.FrameLeftMargin,u=h.BottomEx;else var h=this.ChartBorder.GetBorder(),l=h.LeftEx+a/2+m.FrameLeftMargin,u=h.RightEx,f=h.ChartHeight-h.TopTitle-5*V();this.Canvas.save(),this.Canvas.lineWidth=o,this.Canvas.font=this.Font,this.Canvas.textAlign="center",this.Canvas.textBaseline="top";for(var C={Left:h.LeftEx,Top:he(o,h.TopTitle),Height:f,LineWidth:o},D=this.Data.DataOffset,v=0;D<this.Data.Data.length&&v<s;++D,++v,l+=t+a){var S=this.Data.Data[D];if(S){var T=this.GetQuarter(S.Date);if(T){var I=l,F=l+t;if(F>u)break;var E=I+(F-I)/2;if(!C.DateInfo)C.DateInfo=T,C.Right=E;else{var M=C.DateInfo;M.Year!=T.Year||M.Quarter!=T.Quarter?(C.Right=E,this.DrawQuarter(C),C.Left=E,C.Right=null,C.DateInfo=T):C.Right=E}}}}this.DrawQuarter(C),this.Canvas.restore()}}}},this.DrawQuarter=function(r){if(!(!c.IsNumber(r.Left)||!c.IsNumber(r.Right))){var n=he(r.LineWidth,r.Left),e=he(r.LineWidth,r.Right),t=e-n;this.Canvas.strokeStyle=this.LineColor,this.Canvas.strokeRect(n,r.Top,t,r.Height);var a=r.DateInfo,s=a.Year%100;if(s<10)var o="0"+s;else var o=s.toString();var h=o+"年"+a.Quarter+"季度",l=this.Canvas.measureText(h).width;if(l<t+5){var u=n+t/2,f=r.Top+this.TextTopOffset;this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(h,u,f)}}},this.GetQuarter=function(r){if(!c.IsNumber(r))return null;var n=parseInt(r/1e4),e=parseInt(r%1e4/100);switch(e){case 1:case 2:case 3:var t=1;break;case 4:case 5:case 6:var t=2;break;case 7:case 8:case 9:var t=3;break;case 10:case 11:case 12:var t=4;break;default:return null}return{Year:n,Month:e,Quarter:t}}}function gd(){this.newMethod=ga,this.newMethod(),delete this.newMethod,this.ClassName="RectSelectPaint",this.LineColor=m.RectSelect.LineColor,this.LineWidth=m.RectSelect.LineWidth,this.LineDotted=m.RectSelect.LineDotted,this.AreaColor=m.RectSelect.AreaColor,this.SubAreaColor=m.RectSelect.SubAreaColor,this.FirstPoint,this.SecondPoint,this.CenterPoint,this.PreventClose=!1,this.SpaceReselected=!1,this.SubClient={FirstPoint:null,SecondPoint:null,Start:null,End:null},this.StartDate,this.EndDate,this.CenterDate,this.HQChart,this.DragRect,this.ShowRangeText={Enable:!1,Position:0,Font:m.RectSelect.RangeTextFont,Color:m.RectSelect.RangeTextColor,BGColor:m.RectSelect.RangeTextBGColor,SubPosition:0,SubFont:m.RectSelect.RangeTextSubFont,SubColor:m.RectSelect.RangeTextSubColor,SubBGColor:m.RectSelect.RangeTextSubBGColor},this.BorderCache,this.SetOption=function(r){if(r&&(r.LineColor&&(this.LineColor=r.LineColor),r.AreaColor&&(this.AreaColor=r.AreaColor),c.IsBool(r.SpaceReselected)&&(this.SpaceReselected=r.SpaceReselected),r.ShowRangeText)){var n=r.ShowRangeText;c.IsBool(n.Enable)&&(this.ShowRangeText.Enable=n.Enable),c.IsNumber(n.Position)&&(this.ShowRangeText.Position=n.Position),c.IsNumber(n.SubPosition)&&(this.ShowRangeText.SubPosition=n.SubPosition)}},this.ReloadResource=function(r){this.LineColor=m.RectSelect.LineColor,this.LineWidth=m.RectSelect.LineWidth,this.LineDotted=m.RectSelect.LineDotted,this.AreaColor=m.RectSelect.AreaColor,this.ShowRangeText.Font=m.RectSelect.RangeTextFont,this.ShowRangeText.Color=m.RectSelect.RangeTextColor,this.ShowRangeText.BGColor=m.RectSelect.RangeTextBGColor},this.IsMinuteChart=function(){var r=this.HQChart.ClassName,n=r=="MinuteChartContainer"||r=="MinuteChartHScreenContainer";return n},this.GetKData=function(){if(!this.HQChart)return null;var r=this.IsMinuteChart(),n=null;if(r){if(!this.HQChart.SourceData)return null;n=this.HQChart.SourceData}else if(!this.HQChart.ChartPaint[0]||(n=this.HQChart.ChartPaint[0].Data,!n))return null;return n},this.GetPointCount=function(){var r=0;return this.FirstPoint&&++r,this.SecondPoint&&++r,r},this.DateToNumber=function(r,n){if(n)return c.IsNumber(r.Date)?r.Date*1e4+r.Time:r.Time;var e=this.HQChart.Period;return k.IsDayPeriod(e,!0)?r.Date:k.IsMinutePeriod(e,!0)?r.Date*1e4+r.Time:k.IsSecondPeriod(e)||k.IsTickPeriod(e)?r.Date*1e6+r.Time:null},this.GetSelectRectData=function(){if(!this.FirstPoint||!this.SecondPoint)return null;var r=this.GetKData();if(!r)return null;for(var n=this.IsMinuteChart(),e=this.DateToNumber(this.FirstPoint,n),t=this.DateToNumber(this.SecondPoint,n),a={Start:null,End:null,Data:r},s=0;s<r.Data.length;++s){var o=r.Data[s];if(o){var h=this.DateToNumber(o,n);if(e==h&&(a.Start=s),t==h&&(a.End=s),c.IsNumber(a.Start)&&c.IsNumber(a.End)){if(a.Start>a.End){var l=a.Start;a.Start=a.End,a.End=l}return a}}}return null},this.SortPoint=function(){var r=this.IsMinuteChart();if(this.CenterData=null,this.FirstPoint&&!this.SecondPoint)this.StartDate={Date:this.DateToNumber(this.FirstPoint,r),Index:0};else if(this.FirstPoint&&this.SecondPoint){var n=this.DateToNumber(this.FirstPoint,r),e=this.DateToNumber(this.SecondPoint,r);if(n<e?(this.StartDate={Date:n,Index:0},this.EndDate={Date:e,Index:1}):(this.StartDate={Date:e,Index:1},this.EndDate={Date:n,Index:0}),this.CenterPoint){var t=this.DateToNumber(this.CenterPoint,r);this.CenterDate={Date:t,Index:2}}if(this.SubClient.FirstPoint&&this.SubClient.SecondPoint){var n=this.DateToNumber(this.SubClient.FirstPoint,r),e=this.DateToNumber(this.SubClient.SecondPoint,r);n<e?(this.SubClient.Start={Date:n,Index:3},this.SubClient.End={Date:e,Index:4}):(this.SubClient.Start={Date:e,Index:4},this.SubClient.End={Date:n,Index:3}),this.SubClient.End.Date<=this.StartDate.Date||this.SubClient.Start.Date>=this.EndDate.Date?(this.SubClient.Start=null,this.SubClient.End=null):(this.SubClient.Start.Date<this.StartDate.Date&&(this.SubClient.Start.Date=this.StartDate.Date),this.SubClient.End.Date>this.EndDate.Date&&(this.SubClient.End.Date=this.EndDate.Date))}}},this.GetCenterPoint=function(){if(!this.FirstPoint||!this.SecondPoint||!c.IsNumber(this.FirstPoint.DataIndex)||!c.IsNumber(this.SecondPoint.DataIndex))return null;var r=this.FirstPoint.DataIndex-this.SecondPoint.DataIndex;if(Math.abs(r)<3)return null;var n=parseInt(this.FirstPoint.DataIndex+(this.SecondPoint.DataIndex-this.FirstPoint.DataIndex)/2);if(n<0)return null;var e=this.GetKData();if(!e||!e.Data)return null;var t=e.Data[n];return t?{Date:t.Date,Time:t.Time,DataIndex:n}:null},this.MovePoint=function(r){if(!this.FirstPoint||!this.SecondPoint)return!1;var n=this.GetKData();if(!n||!n.Data)return!1;var a=this.FirstPoint.DataIndex+r,s=n.Data[a];if(!s)return!1;var e={Date:s.Date,Time:s.Time,DataIndex:a},a=this.SecondPoint.DataIndex+r,s=n.Data[a];if(!s)return!1;var t={Date:s.Date,Time:s.Time,DataIndex:a},a=this.CenterPoint.DataIndex+r,s=n.Data[a];if(!s)return!1;var o={Date:s.Date,Time:s.Time,DataIndex:a};return this.FirstPoint=e,this.SecondPoint=t,this.CenterPoint=o,!0},this.MoveSubRect=function(r,n){if(!this.FirstPoint||!this.SecondPoint||!this.SubClient||!this.SubClient.FirstPoint||!this.SubClient.SecondPoint)return!1;var e=this.GetKData();if(!e||!e.Data)return!1;var t=Math.min(this.FirstPoint.DataIndex,this.SecondPoint.DataIndex),a=Math.max(this.FirstPoint.DataIndex,this.SecondPoint.DataIndex),s=this.SubClient.FirstPoint,o=this.SubClient.SecondPoint;if(this.SubClient.FirstPoint.DataIndex>this.SubClient.SecondPoint.DataIndex)var s=this.SubClient.SecondPoint,o=this.SubClient.FirstPoint;var h=s.DataIndex,l=o.DataIndex;if(n){if(h<=t)return!1;h-=r,l-=r}else{if(o.DataIndex>=a)return!1;h+=r,l+=r}var u=!1;if(h!=s.DataIndex){s.DataIndex=h;var f=e.Data[h];s.Date=f.Date,s.Time=f.Time,u=!0}if(l!=s.DataIndex){o.DataIndex=l;var f=e.Data[l];o.Date=f.Date,o.Time=f.Time,u=!0}return u},this.SetPoint=function(r,n){var e=null;if(n&&c.IsNumber(n.DataIndex)&&(e=n.DataIndex),n&&c.IsNumber(n.Index))switch(n.Index){case 0:return this.FirstPoint={Date:r.Date,Time:r.Time,DataIndex:e},this.CenterPoint=this.GetCenterPoint(),!0;case 1:return this.SecondPoint={Date:r.Date,Time:r.Time,DataIndex:e},this.CenterPoint=this.GetCenterPoint(),!0;case 2:var t=e-this.CenterPoint.DataIndex;return Math.abs(t)>0?this.MovePoint(t):!1;case 3:return this.SubClient.FirstPoint={Date:r.Date,Time:r.Time,DataIndex:e},!0;case 4:return this.SubClient.SecondPoint={Date:r.Date,Time:r.Time,DataIndex:e},!0;default:return!1}else return this.FirstPoint?this.SecondPoint?!1:(this.SecondPoint={Date:r.Date,Time:r.Time,DataIndex:e},this.CenterPoint=this.GetCenterPoint(),!0):(this.FirstPoint={Date:r.Date,Time:r.Time,DataIndex:e},!0)},this.ClearPoint=function(){if(this.PreventClose)return!1;var r=!1;return this.FirstPoint&&(this.FirstPoint=null,r=!0),this.SecondPoint&&(this.SecondPoint=null,r=!0),this.SubClient.FirstPoint=null,this.SubClient.SecondPoint=null,r},this.Draw=function(){if(this.BorderCache=null,this.StartDate=null,this.EndDate=null,this.CenterDate=null,this.DragRect=[],this.SubClient.Start=null,this.SubClient.End=null,!(!this.FirstPoint&&!this.SecondPoint)){this.SortPoint();var r=this.GetKData();if(r&&(this.Data=r,!(!this.ChartFrame||!this.ChartFrame.SubFrame))){var n=this.ChartFrame.SubFrame[0].Frame;if(n){var e=n.IsHScreen===!0,t=n.DataWidth,a=n.DistanceWidth,s=n.XPointCount;if(e){var o=n.GetBorder(),h=o.TopEx+a/2+m.FrameLeftMargin;o.BottomEx,this.BorderCache=o}else{var o=n.GetBorder(),h=o.LeftEx+a/2+m.FrameLeftMargin;o.RightEx,o.ChartHeight-o.TopTitle-5*V();var l=o.TopEx,u=o.BottomEx;this.BorderCache=o}this.Canvas.save(),k.IsDayPeriod(this.HQChart.Period,!0);for(var f=this.IsMinuteChart(),C=null,D=null,v=null,S=null,T=[],I=this.Data.DataOffset,F=0;I<this.Data.Data.length&&F<s;++I,++F,h+=t+a){var E=this.Data.Data[I];if(E){var M=h,O=h+t;if(f)var R=n.GetXFromIndex(F);else var R=M+(O-M)/2;var b=this.DateToNumber(E,f);if(this.StartDate&&b==this.StartDate.Date&&(C={XIndex:I,X:R,Top:l,Bottom:u,PointIndex:this.StartDate.Index,Type:0,Item:E},T.push(C)),this.EndDate&&b==this.EndDate.Date&&(D={XIndex:I,X:R,Top:l,Bottom:u,PointIndex:this.EndDate.Index,Type:1,Item:E},T.push(D)),this.CenterDate&&b==this.CenterDate.Date){var p={XIndex:I,X:R,Top:l,Bottom:u,PointIndex:this.CenterDate.Index,Type:2,Item:E};T.push(p)}if(this.SubClient&&this.SubClient.Start&&this.SubClient.End&&(b==this.SubClient.Start.Date&&(this.SubClient.Start.Point={Date:b,X:R,Top:l,Bottom:u,KItem:E}),b==this.SubClient.End.Date&&(this.SubClient.End.Point={Date:b,X:R,Top:l,Bottom:u,kItem:E})),v?(S.Date=b,S.X=R):(v={Date:b,X:R,Top:l,Bottom:u},S={Date:b,X:R,Top:l,Bottom:u}),C&&D)break}}if(this.DrawLines(T),this.DrawArea(C,D,v,S,this.AreaColor),this.SubClient&&this.SubClient.Start&&this.SubClient.End&&(this.DrawArea(this.SubClient.Start.Point,this.SubClient.End.Point,v,S,this.SubAreaColor,4),this.SubClient.Start.Point)){var E=this.SubClient.Start.Point,G={X:E.X,Top:E.Top,Bottom:E.Bottom,PointIndex:E.DataIndex,Type:3,Item:E.KItem};T.push(G)}this.DrawRangeText(T),this.Canvas.restore()}}}},this.DrawRangeText=function(r){if(this.ShowRangeText&&this.ShowRangeText.Enable!=!1)for(var n=this.BorderCache,e=this.IsMinuteChart(),t=this.HQChart.Period,a,s,o,h=0;h<r.length;++h){var l=r[h];if(l.Type===0||l.Type==1||l.Type==3){if(e){var u=c.FormatDateString(l.Item.Date,"YYYY-MM-DD"),f=c.FormatTimeString(l.Item.Time,"HH:MM");o=u+" "+f}else{var u=c.FormatDateString(l.Item.Date,"YYYY-MM-DD"),f=null;k.IsMinutePeriod(t,!0)?f=c.FormatTimeString(l.Item.Time,"HH:MM"):(k.IsSecondPeriod(t)||k.IsTickPeriod(t))&&(f=c.FormatTimeString(l.Item.Time,"HH:MM:SS")),f?o=u+" "+f:o=u}if(l.Type==3){var C=this.ShowRangeText.SubPosition,D=this.ShowRangeText.SubBGColor,v=this.ShowRangeText.SubColor;this.Canvas.font=this.ShowRangeText.SubFont;var S=this.GetFontHeight()}else{var C=this.ShowRangeText.Position,D=this.ShowRangeText.BGColor,v=this.ShowRangeText.Color;this.Canvas.font=this.ShowRangeText.Font;var S=this.GetFontHeight()}var T=this.Canvas.measureText(o).width+4,I={Height:S,Width:T};l.Type==0||l.Type==3?T>l.X?(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",a=l.X+2,I.X=l.X):(this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",a=l.X-2,I.X=l.X-T):l.Type==1&&(T>n.Right-l.X?(this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",a=l.X-2,I.X=l.X-T):(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",a=l.X+2,I.X=l.X)),C==1?(s=l.Top+(l.Bottom-l.Top)/2,l.Type==3&&(s+=S),I.Y=s-S/2):C==2?(s=l.Bottom,I.Y=s-S/2):(s=l.Top,I.Y=s-S/2),D&&(this.Canvas.fillStyle=D,this.Canvas.fillRect(L(I.X),L(I.Y),B(I.Width),B(I.Height))),v&&(this.Canvas.fillStyle=v,this.Canvas.fillText(o,a,s,T))}}},this.DrawLines=function(r){if(c.IsNonEmptyArray(r)){var n=this.LineWidth*V();this.Canvas.strokeStyle=this.LineColor,this.Canvas.lineWidth=n;for(var e=0;e<r.length;++e){var t=r[e],a=he(n,t.X);t.Type==0||t.Type==1?(this.LineDotted&&this.Canvas.setLineDash(this.LineDotted),this.Canvas.beginPath(),this.Canvas.moveTo(a,t.Top),this.Canvas.lineTo(a,t.Bottom),this.Canvas.stroke(),this.LineDotted&&this.Canvas.setLineDash([])):(this.Canvas.beginPath(),this.Canvas.moveTo(a,t.Top),this.Canvas.lineTo(a,t.Bottom),this.Canvas.stroke());var s=new Sa(a-3,t.Top,10,t.Bottom-t.Top);this.DragRect[e]={Rect:s,PointIndex:t.PointIndex,Type:t.Type}}}},this.PtInPaint=function(r,n){if(!c.IsNonEmptyArray(this.DragRect))return null;for(var e=0;e<this.DragRect.length;++e){var t=this.DragRect[e],a=t.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(a.X,a.Y,a.Width,a.Height),this.Canvas.isPointInPath(r,n))return(0,Se.default)({Index:e,PointIndex:t.PointIndex,Type:t.Type,Self:this},"Type",t.Type)}return null},this.DrawArea=function(r,n,e,t,a,s){if(!(!e||!t||!this.StartDate||!this.EndDate)){var o;if(r&&n?o=[r,n]:!r&&n?o=[e,n]:r&&!n?o=[r,t]:e.Date>this.StartDate.Date&&t.Date<this.EndDate.Date&&(o=[e,t]),o&&o.length==2){var h=o[0],l=o[1],u=L(h.X),f=L(l.X),C=f-u,D=h.Bottom-h.Top;this.Canvas.fillStyle=a,this.Canvas.fillRect(u,h.Top,C,D);var v={X:u,Y:h.Top,Right:f,Bottom:h.Top+D,Width:C,Height:D};c.IsNumber(s)&&this.DragRect.push({Rect:v,Type:s})}}}}function pd(){this.newMethod=ga,this.newMethod(),delete this.newMethod,this.ClassName="DepthMapPaint",this.LineColor=m.DepthMapPaint.LineColor,this.AreaColor=ne(m.DepthMapPaint.AreaColor),this.TextColor=m.DepthMapPaint.TextColor,this.TextBGColor=m.DepthMapPaint.TextBGColor,this.FrameID=0,this.ID=oe(),this.IsDynamic=!1,this.IsCallbackDraw=!0,this.YRange,this.WidthRate=.8,this.IsShow=!0,this.SetOption=function(r){r.FrameID>0&&(this.FrameID=r.FrameID),c.IsObjectExist(r.ID)&&(this.ID=r.ID),r.IsShowCorssCursor&&(this.IsShowCorssCursor=r.IsShowCorssCursor),c.IsNumber(r.WidthRate)&&(this.WidthRate=r.WidthRate)},this.Draw=function(){if(this.Data&&c.IsNonEmptyArray(this.Data)&&!(!this.ChartFrame||!this.ChartFrame.SubFrame||this.ChartFrame.SubFrame.length<=this.FrameID)){var r=this.ChartFrame.IsHScreen===!0,n=this.ChartFrame.SubFrame[this.FrameID].Frame,e=n.ChartBorder,t=e.GetHeightEx(),a=e.GetRight(),s=e.GetTopEx(),o=e.GetBottomEx(),h=this.ChartBorder.Right*this.WidthRate;if(r){a=e.GetBottom(),s=e.GetRight(),o=e.GetLeft();var h=this.Width;h>this.ChartBorder.Bottom&&(h=this.ChartBorder.Bottom)}var l={Left:a,Top:s,Right:a+h,Bottom:o,Height:t,Width:h};this.YRange={Max:null,Min:0};for(var u=0;u<this.Data.length;++u){var f=this.Data[u];this.CalculateYRange(f,this.YRange)}for(var u=0;u<this.Data.length;++u){var f=this.Data[u];f.Height>0&&f.Height<=1?l.Height=t*f.Height:l.Height=t,f.Type==1?(l.Top=s,l.Bottom=s+l.Height,this.DrawUpArea(f,l)):f.Type==2?(l.Bottom=o,l.Top=l.Bottom-l.Height,this.DrawDownArea(f,l)):(l.Top=s,l.Bottom=o,this.DrawDefaultArea(f,l))}}},this.CalculateYRange=function(r,n){for(var e in r.Data){var t=r.Data[e];(n.Max==null||n.Max<t.Y)&&(n.Max=t.Y),(n.Min==null||n.Min>t.Y)&&(n.Min=t.Y)}},this.GetXFromData=function(r,n,e){var t=n.Width*(r-e.Min)/(e.Max-e.Min);return n.Left+t},this.GetYFromData=function(r,n,e,t){if(t){var a=n.Height*(r-e.Min)/(e.Max-e.Min);return n.Bottom-a}else{var a=n.Height*(r-e.Min)/(e.Max-e.Min);return n.Top+a}},this.DrawDefaultArea=function(r,n){for(var e=this.ChartFrame.SubFrame[this.FrameID].Frame,t=r.Range&&r.Range.Y?r.Range.Y:this.YRange,a=[],s=0;s<r.Data.length;++s){var o=r.Data[s],h=this.GetXFromData(o.Y,n,t);if(!(o.X>e.HorizontalMax||o.X<e.HorizontalMin)){var l=e.GetYFromData(o.X);a.push({X:h,Y:l})}}var u=r.LineColor?r.LineColor:this.LineColor,f=r.AreaColor?r.AreaColor:this.AreaColor;a.length>0&&(r.DrawType==1?this.DrawHLine(a,u,n):this.DrawLine(a,u,f,n))},this.DrawUpArea=function(r,n){var e=[];for(var t in r.Data){var a=r.Data[t],s=this.GetXFromData(a.Y,n,r.Range.Y),o=this.GetYFromData(a.X,n,r.Range.X,r.IsASC);e.push({X:s,Y:o})}var h=r.LineColor?r.LineColor:this.LineColor,l=r.AreaColor?r.AreaColor:this.AreaColor;e.length>0&&this.DrawLine(e,h,l,n)},this.DrawDownArea=function(r,n){var e=[];for(var t in r.Data){var a=r.Data[t],s=this.GetXFromData(a.Y,n,r.Range.Y),o=this.GetYFromData(a.X,n,r.Range.X,r.IsASC);e.push({X:s,Y:o})}var h=r.LineColor?r.LineColor:this.LineColor,l=r.AreaColor?r.AreaColor:this.AreaColor;e.length>0&&this.DrawLine(e,h,l,n)},this.DrawHLine=function(r,n,e){var t=this.ChartFrame.IsHScreen===!0;this.Canvas.strokeStyle=n,this.Canvas.beginPath();for(var a=0,s=0;s<r.length;++s){var o=r[s];t||(this.Canvas.moveTo(e.Left,o.Y),this.Canvas.lineTo(o.X,o.Y)),++a}a>0&&this.Canvas.stroke()},this.DrawLine=function(r,n,e,t){var a=this.ChartFrame.IsHScreen===!0,s=!0,o=0;this.Canvas.strokeStyle=n;for(var h in r){var l=r[h];s?(this.Canvas.beginPath(),a?this.Canvas.moveTo(l.Y,l.X):this.Canvas.moveTo(l.X,l.Y),s=!1):a?this.Canvas.lineTo(l.Y,l.X):this.Canvas.lineTo(l.X,l.Y),++o}o>0&&this.Canvas.stroke();var u=r[0],f=r[r.length-1];if(a?(this.Canvas.lineTo(f.Y,t.Left),this.Canvas.lineTo(u.Y,t.Left)):(this.Canvas.lineTo(t.Left,f.Y),this.Canvas.lineTo(t.Left,u.Y)),this.Canvas.closePath(),Array.isArray(e))if(a){var C=this.Canvas.createLinearGradient(this.ChartBorder.GetRightEx(),this.ChartBorder.GetTop(),this.ChartBorder.GetLeft(),this.ChartBorder.GetTop());C.addColorStop(0,e[0]),C.addColorStop(1,e[1]),this.Canvas.fillStyle=C}else{for(var D=this.Canvas.createLinearGradient(t.Right,t.Top,t.Left,t.Top),v=1/e.length,h=0;h<e.length;++h)D.addColorStop(h*v,e[h]);this.Canvas.fillStyle=D}else this.Canvas.fillStyle=e;this.Canvas.fill()},this.GetYValueByXValue=function(r,n){for(var e=[],t=0,a=VC[n],s=0;s<this.Data.length;++s){var o=this.Data[s];if(!(o.Type!=0||!o.Data||o.Data.length<0||o.IsShowCorssCursor==!1)){for(var h=!1,l=0;l<o.Data.length;++l){var u=o.Data[l];if(t=parseInt(u.X*a),t==r){h=!0;var f={X:u.X,Y:u.Y,TextColor:o.TextColor?o.TextColor:this.TextColor,TextBGColor:o.TextBGColor?o.TextBGColor:this.TextBGColor};u.YText&&(f.YText=u.YText),e.push(f);break}}if(!h){var C=o.Data[0],D=o.Data[o.Data.length-1];r>C.X*a&&r<D.X*a&&e.push({X:null,Y:null,TextColor:o.TextColor?o.TextColor:this.TextColor,TextBGColor:o.TextBGColor?o.TextBGColor:this.TextBGColor})}}}return e}}function Fd(){this.newMethod=ga,this.newMethod(),delete this.newMethod,this.ClassName="KLineYAxisBGPaint",this.SplitData=[],this.Font=m.KLineYAxisBGPaint.Font,this.FrameID=0,this.ID=oe(),this.IsDynamic=!1,this.IsCallbackDraw=!0,this.IsShow=!0,this.BGWidth=50,this.LineColor=m.KLineYAxisBGPaint.LineColor,this.DiffValutTextColor=m.KLineYAxisBGPaint.DiffValutTextColor,this.DiffValueBGColor=m.KLineYAxisBGPaint.DiffValueBGColor,this.KLineFrame,this.KLineData,this.Range={Max:null,Min:null},this.SetOption=function(r){r&&c.IsNonEmptyArray(r.SplitData)&&(this.SplitData=r.SplitData)},this.Draw=function(){if(this.IsShow&&!(!this.ChartFrame||!this.ChartFrame.SubFrame||this.ChartFrame.SubFrame.length<=this.FrameID)){var r=this.HQChart.ChartPaint[0];if(r){var n=this.ChartFrame.IsHScreen===!0;if(!n){this.KLineFrame=this.ChartFrame.SubFrame[this.FrameID].Frame;var e=this.KLineFrame.ChartBorder,t=this.KLineFrame.DataWidth,a=this.KLineFrame.DistanceWidth,s=this.KLineFrame.XPointCount,o=e.GetBorder(),h=o.LeftEx+a/2+m.FrameLeftMargin,l=o.RightEx;this.KLineData=r.Data;for(var u=null,f=null,C=this.KLineData.DataOffset,D=0;C<this.KLineData.Data.length&&D<s;++C,++D,h+=t+a){var v=this.KLineData.Data[C];if(!(v.Open==null||v.High==null||v.Low==null||v.Close==null)){var S=h+t;if(S>l)break;(u==null||u<v.High)&&(u=v.High),(f==null||f>v.Low)&&(f=v.Low)}}!c.IsNumber(u)||!c.IsNumber(f)||(this.Range.Max=u,this.Range.Min=f,this.DrawBackground())}}}},this.DrawBackground=function(){var r=this.Range.Min,n=this.KLineFrame.ChartBorder.GetBorder(),e=this.KLineFrame.GetYFromData(r,!1),t=n.Right,a=t+this.BGWidth;this.Canvas.font=this.Font,this.Canvas.textBaseline="top",this.Canvas.textAlign="left";for(var s=0;s<this.SplitData.length;++s){var o=this.SplitData[s];if(o.Value+r>this.KLineFrame.HorizontalMax)break;var h=this.KLineFrame.GetYFromData(r+o.Value,!1);this.Canvas.fillStyle=o.Color,this.Canvas.fillRect(B(t),B(h),B(a-t),B(e-h)),o.Text&&o.TextColor&&(this.Canvas.fillStyle=o.TextColor,this.Canvas.fillText(o.Text,a+1,h)),e=h}var l=this.Range.Max-this.Range.Min,u=fe(this.HQChart.Symbol),f=l.toFixed(u),C=this.KLineFrame.GetYFromData(this.Range.Max,!1);this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(t),L(C)),this.Canvas.lineTo(L(a),L(C)),this.Canvas.stroke();var D=this.Canvas.measureText(f).width+4,v=this.Canvas.measureText("擎").width+2,S={Left:a+1,Top:C-v,Width:D,Height:v};this.DiffValueBGColor&&(this.Canvas.fillStyle=this.DiffValueBGColor,this.Canvas.fillRect(S.Left,S.Top,S.Width,S.Height)),this.Canvas.textBaseline="bottom",this.Canvas.fillStyle=this.DiffValutTextColor,this.Canvas.fillText(f,S.Left+1,C)}}function Ed(){this.newMethod=ga,this.newMethod(),delete this.newMethod,this.ClassName="BackgroundPaint",this.IsDynamic=!1,this.IsCallbackDraw=!0,this.FrameID=0,this.Data,this.ID=oe(),this.ChartSubFrame,this.ChartBorder,this.KData,this.Period,this.XPointCount=0,this.SetOption=function(r){r.FrameID>0&&(this.FrameID=r.FrameID),c.IsObjectExist(r.ID)&&(this.ID=r.ID)},this.Draw=function(){if(!(!this.Data||!this.HQChart)&&!(!this.ChartFrame||!this.ChartFrame.SubFrame||this.ChartFrame.SubFrame.length<=this.FrameID)){var r=this.HQChart.ChartPaint[0];if(!(!r||!r.Data)&&(this.ChartSubFrame=this.ChartFrame.SubFrame[this.FrameID].Frame,this.ChartBorder=this.ChartSubFrame.ChartBorder,this.KData=r.Data,this.Period=this.HQChart.Period,!(!this.KData||this.KData.Data.length<=0))){var n=this.ChartSubFrame.IsHScreen===!0;this.XPointCount=this.ChartSubFrame.XPointCount;var e=this.ChartSubFrame.XPointCount,t=this.KData.Data[this.KData.DataOffset],a=this.KData.DataOffset+e-1;a>=this.KData.Data.length&&(a=this.KData.Data.length-1);var s=this.KData.Data[a],o=this.GetShowData(t,s);if(!(!o||o.length<=0)){var h=this.BuildKLineMap(),l=this.ChartBorder.GetBottomEx(),u=this.ChartBorder.GetTopEx(),f=this.ChartBorder.GetHeightEx();n&&(u=this.ChartBorder.GetRightEx(),l=this.ChartBorder.GetLeftEx(),f=this.ChartBorder.GetWidthEx());for(var C in o){var D=o[C],v=this.GetBGCoordinate(D,h);if(v){if(Array.isArray(D.Color)){var S;n?S=this.Canvas.createLinearGradient(l,v.Left,u,v.Left):S=this.Canvas.createLinearGradient(v.Left,u,v.Left,l);var T=1/D.Color.length;for(var C in D.Color)S.addColorStop(C*T,D.Color[C]);this.Canvas.fillStyle=S}else this.Canvas.fillStyle=D.Color;n?this.Canvas.fillRect(B(l),B(v.Left),B(f),B(v.Width)):this.Canvas.fillRect(B(v.Left),B(u),B(v.Width),B(f))}}}}}},this.GetShowData=function(r,n){if(!c.IsNonEmptyArray(this.Data))return null;for(var e=[],t=0;t<this.Data.length;++t){var a=this.Data[t],s={};a.Start.Date>=r.Date&&a.Start.Date<=n.Date&&(s.Start=a.Start),a.End.Date>=r.Date&&a.End.Date<=n.Date&&(s.End=a.End),a.Start.Date<r.Date&&a.End.Date>n.Date&&(s.Start=r,s.End=n),(s.Start||s.End)&&(s.Color=a.Color,e.push(s))}return e},this.BuildKLineMap=function(){var r=this.ChartSubFrame.IsHScreen===!0,n=this.ChartSubFrame.DataWidth,e=this.ChartSubFrame.DistanceWidth,t=this.ChartBorder.GetLeft()+e/2+m.FrameLeftMargin;r&&(t=this.ChartBorder.GetTop()+e/2+m.FrameLeftMargin);var a=this.ChartBorder.GetRight();r&&(a=this.ChartBorder.GetBottom());for(var s={Data:new Dt.default,Start:null,End:null},o=this.KData.DataOffset,h=0;o<this.KData.Data.length&&h<this.XPointCount;++o,++h,t+=n+e){var l=this.KData.Data[o],u=t,f=t+n;if(f>a)break;var C=u+(f-u)/2;h==0&&(s.XLeft=u),s.XRight=f;var D={Index:o,ShowIndex:h,X:C,Right:f,Left:u,Date:l.Date};if(k.IsMinutePeriod(this.Period,!0)){var v="Date:"+l.Date+" Time:"+l.Time;D.Time=l.Time}else var v="Date:"+l.Date;s.Data.set(v,D),h==0&&(s.Start=D),s.End=D}return s},this.GetBGCoordinate=function(r,n){var e=null,t=null,a=k.IsMinutePeriod(this.Period,!0),s=!1;if(a?r.Start&&r.End&&r.Start.Date==r.End.Date&&r.Start.Time==r.End.Time&&(s=!0):r.Start&&r.End&&r.Start.Date==r.End.Date&&(s=!0),s){if(a)var o="Date:"+r.Start.Date+" Time:"+r.Start.Time;else var o="Date:"+r.Start.Date;if(!n.Data.has(o))return null;var h=n.Data.get(o);return e=h.Left,t=h.Right,{Left:e,Right:t,Width:t-e}}if(r.Start){if(a)var o="Date:"+r.Start.Date+" Time:"+r.Start.Time;else var o="Date:"+r.Start.Date;if(n.Data.has(o)){var h=n.Data.get(o);e=h.Left}else if(a)if(r.Start.Date<n.Start.Date||r.Start.Date==n.Start.Date&&r.Start.Time<=n.Start.Time)e=n.Start.Left;else{var l=!0,u=!1,f=void 0;try{for(var C=(0,we.default)(n.Data),D;!(l=(D=C.next()).done);l=!0){var v=D.value,S=v[1];if(S.Date>r.Start.Date||S.Date==r.Start.Date&&S.Time>r.Start.Time){e=S.Left;break}}}catch(Wt){u=!0,f=Wt}finally{try{!l&&C.return&&C.return()}finally{if(u)throw f}}}else if(r.Start.Date<=n.Start.Date)e=n.Start.Left;else{var T=!0,I=!1,F=void 0;try{for(var E=(0,we.default)(n.Data),M;!(T=(M=E.next()).done);T=!0){var v=M.value,S=v[1];if(S.Date>r.Start.Date){e=S.Left;break}}}catch(Wt){I=!0,F=Wt}finally{try{!T&&E.return&&E.return()}finally{if(I)throw F}}}}else e=n.XLeft;if(r.End){if(a)var o="Date:"+r.End.Date+" Time:"+r.End.Time;else var o="Date:"+r.End.Date;if(n.Data.has(o)){var h=n.Data.get(o);t=h.Right}else if(a){if(r.End.Date<n.Start.Date||r.End.Date==n.Start.Date&&r.End.Time<n.Start.Time)return null;if(r.End.Date<n.End.Date||r.End.Date==n.End.Date&&r.End.Time>=n.End.Time)t=n.End.Right;else{var O=null,R=!0,b=!1,p=void 0;try{for(var G=(0,we.default)(n.Data),Y;!(R=(Y=G.next()).done);R=!0){var v=Y.value,S=v[1];if(S.Date>r.End.Date||S.Date==r.End.Date&&S.Time>r.End.Time){t=O;break}O=S.Right}}catch(Wt){b=!0,p=Wt}finally{try{!R&&G.return&&G.return()}finally{if(b)throw p}}}}else{if(r.End.Date<n.Start.Date)return null;if(r.End.Date<=n.End.Date)t=n.End.Right;else{var O=null,Q=!0,ht=!1,Ct=void 0;try{for(var lt=(0,we.default)(n.Data),dt;!(Q=(dt=lt.next()).done);Q=!0){var v=dt.value,S=v[1];if(S.Date>r.End.Date){t=O;break}O=S.Right}}catch(Qt){ht=!0,Ct=Qt}finally{try{!Q&&lt.return&&lt.return()}finally{if(ht)throw Ct}}}}}else t=n.XRight;return e==null||t==null?null:{Left:e,Right:t,Width:t-e}}}function xd(){this.newMethod=ga,this.newMethod(),delete this.newMethod,this.ClassName="MinuteBackgroundPaint",this.IsDynamic=!0,this.IsCallbackDraw=!1,this.HQChart,this.Data,this.Font=m.DefaultTextFont,this.TextColor=m.DefaultTextColor,this.MerginTop=20,this.ID=oe(),this.FrameID=0,this.SetOption=function(r){r&&(r.Font&&(this.Font=r.Font),c.IsObjectExist(r.ID)&&(this.ID=r.ID),r.FrameID>0&&(this.FrameID=r.FrameID),r.MerginTop>0&&(this.MerginTop=r.MerginTop))},this.Draw=function(){if(!(!this.Data||!this.HQChart)&&!(!this.ChartFrame||!this.ChartFrame.SubFrame||this.ChartFrame.SubFrame.length<=this.FrameID)){var r=this.ChartFrame.SubFrame[this.FrameID];if(!(!r||!r.Frame)){var n=r.Frame,e=this.HQChart.SourceData;if(e){for(var t=n.XPointCount,a=0,s=null,o=new Dt.default,h=e.DataOffset,l=0;h<e.Data.length&&l<t;++h,++l){var u=e.Data[h];u&&u.Date!=a&&(a=u.Date,s?(s.Right=this.ChartFrame.GetXFromIndex(l-1),o.set(s.Date,s),s={Left:this.ChartFrame.GetXFromIndex(l),Date:u.Date}):s={Left:this.ChartFrame.GetXFromIndex(l),Date:u.Date})}s&&!s.Right&&(s.Right=this.ChartFrame.GetXFromIndex(t-1),o.set(s.Date,s)),this.Canvas.textAlign="center",this.Canvas.textBaseline="top";for(var f=n.ChartBorder.GetTopEx()+this.MerginTop,h=0;h<this.Data.length;++h){var u=this.Data[h];if(o.has(u.Date)){var s=o.get(u.Date),C=s.Left+(s.Right-s.Left)/2;u.Font?this.Canvas.font=u.Font:this.Canvas.font=this.Font,u.TextColor?this.Canvas.fillStyle=u.TextColor:this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(u.Text,C,f)}}}}}}}var Ge={MAIN_KLINE:1,OVERLAY_KLINE:2,MAIN_INDEX:3,OVERLAY_INDEX:4,OVERLAY_MINUTE:5,MAIN_MINUTE:6,MAIN_AVERAGE_MINUTE:7,MAIN_MINUTE_VOL:8};function Ld(){this.newMethod=ga,this.newMethod(),delete this.newMethod,this.ClassName="DragMovePaint",this.DrawAfterTitle=!0,this.IsDynamic=!0,this.Info,this.IsShow=!1,this.Point,this.TextColor=m.DragMovePaint.TextColor,this.Font=m.DragMovePaint.Font,this.ReloadResource=function(r){this.TextColor=m.DragMovePaint.TextColor,this.Font=m.DragMovePaint.Font},this.Clear=function(){this.Info=null,this.IsShow=!1,this.Point=null},this.Draw=function(){if(!(!this.Info||!this.IsShow||!this.Point)){var r,n=this.Info.FrameID+1;this.Info.Type==Ge.MAIN_KLINE?r="K线:"+this.Info.Name+", 窗口:"+n:this.Info.Type==Ge.OVERLAY_KLINE?r="叠加K线:"+this.Info.Name+", 窗口:"+n:this.Info.Type==Ge.MAIN_INDEX?r="指标:"+this.Info.IndexName+", 窗口:"+n:this.Info.Type==Ge.OVERLAY_INDEX?r="叠加指标:"+this.Info.IndexName+", 窗口:"+n:this.Info.Type==Ge.OVERLAY_MINUTE?r="走势图, 叠加价格线:"+this.Info.Name+", 窗口:"+n:this.Info.Type==Ge.MAIN_MINUTE?r="走势图, 价格线:"+this.Info.Name+", 窗口:"+n:this.Info.Type==Ge.MAIN_AVERAGE_MINUTE?r="走势图, 均线:"+this.Info.Name+", 窗口:"+n:this.Info.Type==Ge.MAIN_MINUTE_VOL&&(r="走势图, 成交量:"+this.Info.Name+", 窗口:"+n),r&&(this.Canvas.font=this.Font,this.Canvas.fillStyle=this.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.fillText(r,this.Point.X,this.Point.Y))}}}function Md(){this.PlayList=[],this.Cache=[],this.MinLineHeight=40*V(),this.Height,this.Step=1,this.GetPlayList=function(r){for(var n=r.Canves,e=r.Right,t=r.Left,a=e-t,s=r.IsMoveStep,o=[],h=0,l=0;l<this.PlayList.length;++l){var u=this.PlayList[l],f=this.MinLineHeight;u.Height>this.MinLineHeight&&(f=u.Height);for(var C=!0,D=!1,v=0;v<u.Data.length;++v){var S=u.Data[v],T={X:S.X,Y:h,Text:S.Text,Color:S.Color,Height:f,Font:S.Font,Info:S.Info};o.push(T),s&&(v==u.Data.length-1&&this.Cache.length>0?(C=!1,S.TextWidth||(S.Font&&S.Font.Name?n.font=S.Font.Name:n.font=r.Font,S.TextWidth=n.measureText(T.Text+"擎擎").width),S.X>=S.TextWidth&&(C=!0)):v==0&&(D=!1,S.TextWidth||(S.Font&&S.Font.Name?n.font=S.Font.Name:n.font=r.Font,S.TextWidth=n.measureText(T.Text+"擎擎").width),S.X>a+S.TextWidth&&(D=!0)),S.X+=this.Step)}if(s&&C&&this.Cache.length>0){var I=this.Cache.shift(),F={X:0,Text:I.Text,Color:I.Color,Font:I.Font,Info:I.Info};u.Data.push(F)}if(s&&D&&u.Data.length>0){var E=u.Data.shift();this.OnItemPlayEnd(r.HQChart,E)}h+=f}return o},this.CacluatePlayLine=function(r){this.Height=r;var n=parseInt(r/this.MinLineHeight);if(this.PlayList.length<n)for(var e=n-this.PlayList.length,t=0;t<e;++t)this.PlayList.push({Data:[]});else if(this.PlayList.length>n)for(var a=this.PlayList.length-n,t=0;t<a;++t)for(var s=this.PlayList.pop(),o=0;o<s.Data.length;++o){var h=s.Data[o],l={Text:h.Text,Color:h.Color,Font:h.Font,Info:h.Info};this.Cache.unshift(l)}X.Chart.Log("[BarrageList::CacluatePlayLine] LineCount="+this.PlayList.length+" Height="+this.Height)},this.AddBarrage=function(r){for(var n in r){var e=r[n];this.Cache.push(e)}},this.OnItemPlayEnd=function(r,n){if(r.mapEvent.has(et.BARRAGE_PLAY_END)){var e=r.mapEvent.get(et.BARRAGE_PLAY_END);e.Callback&&e.Callback(e,n,this)}},this.Count=function(){return this.Cache.length}}function Ad(){this.newMethod=ga,this.newMethod(),delete this.newMethod,this.ClassName="BarragePaint",this.IsAnimation=!0,this.IsEraseBG=!0,this.HQChart,this.Font=m.Barrage.Font,this.TextColor=m.Barrage.Color,this.FontHeight=m.Barrage.Height,this.BarrageList=new Md,this.IsMoveStep=!1,this.SetOption=function(r){r&&(r.Step>0&&(this.BarrageList.Step=r.Step),r.MinLineHeight&&(this.Barrage.MinLineHeight=r.MinLineHeight))},this.DrawHScreen=function(){var r=this.ChartBorder.GetWidth(),n=this.ChartBorder.GetTop(),e=this.ChartBorder.GetBottom(),t=this.ChartBorder.GetRightEx();this.ChartBorder.GetChartWidth(),r!=this.BarrageList.Height&&this.BarrageList.CacluatePlayLine(r),this.Canvas.textBaseline="middle",this.Canvas.textAlign="left";var a=this.BarrageList.GetPlayList({Canves:this.Canvas,Right:e,Left:n,Font:this.Font,IsMoveStep:this.IsMoveStep,HQChart:this.HQChart});if(this.IsMoveStep=!1,!!a){this.Canvas.save(),this.Canvas.translate(this.ChartBorder.GetChartHeight(),0),this.Canvas.rotate(90*Math.PI/180);for(var s=0;s<a.length;++s){var o=a[s];o.Color?this.Canvas.fillStyle=o.Color:this.Canvas.fillStyle=this.TextColor,o.Font?this.Canvas.font=o.Font.Name:this.Canvas.font=this.Font;var h=this.FontHeight;o.Font&&o.Font.Height>0&&(h=o.Font.Height);var l=o.Y+parseInt((o.Height-h)/2);this.Canvas.fillText(o.Text,e-o.X,t+l)}this.Canvas.restore()}},this.Draw=function(){if(this.ChartFrame.IsHScreen){this.DrawHScreen();return}var r=this.ChartBorder.GetLeft(),n=this.ChartBorder.GetRight(),e=this.ChartBorder.GetTopEx(),t=this.ChartBorder.GetHeight();t!=this.BarrageList.Height&&this.BarrageList.CacluatePlayLine(t),this.Canvas.textBaseline="middle",this.Canvas.textAlign="left";var a=this.BarrageList.GetPlayList({Canves:this.Canvas,Right:n,Left:r,Font:this.Font,IsMoveStep:this.IsMoveStep,HQChart:this.HQChart});if(this.IsMoveStep=!1,!!a)for(var s=0;s<a.length;++s){var o=a[s];o.Color?this.Canvas.fillStyle=o.Color:this.Canvas.fillStyle=this.TextColor,o.Font?this.Canvas.font=o.Font.Name:this.Canvas.font=this.Font;var h=this.FontHeight;o.Font&&o.Font.Height>0&&(h=o.Font.Height);var l=o.Y+parseInt((o.Height-h)/2);this.Canvas.fillText(o.Text,n-o.X,e+l)}}}var Ua={LATEST_VALUE_ID:0,FIXED_VALUE_ID:1,PAGE_LAST_PRICE_ID:2,PAGE_DATA_INCREASE:3,PAGE_LAST_INDEX_VALUE_ID:4,PAGE_LAST_OVERLAY_INDEX_VALUE_ID:5};function c(){this.ChartBorder,this.Frame,this.FrameSplitData,this.SplitCount=5,this.StringFormat=0,this.IsShowLeftText=!0,this.IsShowRightText=!0,this.LanguageID=ke.LANGUAGE_CHINESE_ID,this.GetEventCallback,this.GetKLineChartCallback,this.IntegerCoordinateSplit=function(r){var n=this.FrameSplitData.Find(r.Interval);if(!n)return!1;if(r.Interval==n.FixInterval)return!0;var e=r.Max,t=r.Min,a=r.Max/n.FixInterval,s=r.Min/n.FixInterval;c.IsFloat(a)&&(e=parseInt((a+.5).toFixed(0))*n.FixInterval),c.IsFloat(s)&&(t=parseInt((s-.5).toFixed(0))*n.FixInterval),r.Min==0&&(t=0),t<0&&r.Min>0&&(t=0);for(var o=0,h=t;h-e<1e-8;h+=n.FixInterval)++o;return r.Interval=n.FixInterval,r.Max=e,r.Min=t,r.Count=o,!0},this.Filter=function(r,n){if(this.SplitCount<=0||r.length<=0||r.length<=this.SplitCount)return r;var e=parseInt(r.length/this.SplitCount);e<=1&&(e=2);for(var t=[],a=0;a<r.length;a+=e)a+e>=r.length&&a!=r.length-1?t.push(r[r.length-1]):t.push(r[a]);if(this.SplitCount==2&&t.length>2)for(var a=1;a<t.length-1;++a){var s=t[a];s.Message[0]=null,s.Message[1]=null}if(n){for(var o=!1,a=0;a<t.length;++a){var s=t[a];if(Math.abs(s.Value)<1e-8){o=!0;break}}if(o==!1){var h=new Ht;h.Value=0,h.Message[0]=null,h.Message[1]=null,t.push(h)}}return t},this.RemoveZero=function(r){for(var n=[!0,!0,!0,!0],e=0;e<r.length;++e){var t=r[e],a=t.Message[0];this.IsDecimalZeroEnd(a)||(n[0]=!1);var a=t.Message[1];this.IsDecimalZeroEnd(a)||(n[1]=!1);var a=t.Message[2];this.IsDecimalZeroEnd(a)||(n[2]=!1);var a=t.Message[3];this.IsDecimalZeroEnd(a)||(n[3]=!1)}if(!(n[0]==!1&&n[1]==!1&&n[2]==!1&&n[3]==!1))for(var e=0;e<r.length;++e){var t=r[e];if(n[0]){var a=t.Message[0];a!=null&&(typeof a=="number"&&(a=a.toString()),t.Message[0]=a.replace(/[.][0]+/g,""))}if(n[1]){var a=t.Message[1];a!=null&&(typeof a=="number"&&(a=a.toString()),t.Message[1]=a.replace(/[.][0]+/g,""))}if(n[2]){var a=t.Message[2];a!=null&&(typeof a=="number"&&(a=a.toString()),t.Message[2]=a.replace(/[.][0]+/g,""))}if(n[3]){var a=t.Message[3];a!=null&&(typeof a=="number"&&(a=a.toString()),t.Message[3]=a.replace(/[.][0]+/g,""))}}},this.IsDecimalZeroEnd=function(r){if(r==null||(typeof r=="number"&&(r=r.toString()),r=="0"))return!0;var n=r.search(/[.]/);if(n<0)return!1;for(var e=n+1;e<r.length;++e){var t=r.charAt(e);if(t>="1"&&t<="9")return!1}return!0},this.GetKLinePageInfo=function(){if(!this.GetKLineChartCallback)return null;var r=this.GetKLineChartCallback();if(!r||!r.Data||!(r.Data.DataOffset>=0)||!c.IsNonEmptyArray(r.Data.Data))return null;var n=r.Data.Data,e=r.Data.DataOffset,t=r.Data.DataOffset+r.ChartFrame.XPointCount-1;t>=n.length&&(t=n.length-1);var a={Start:{Item:n[e],Index:e},End:{Item:n[t],Index:t},IsLast:t==n.length-1};return a},this.CustomLatestIndexDataCoordinate=function(r){var n=this.GetKLinePageInfo();if(n&&this.HQChart){var e=null;this.GetEventCallback&&(e=this.GetEventCallback(et.ON_FORMAT_INDEX_Y_LABEL));var t=n.End.Index,a=2;c.IsNumber(this.FloatPrecision)&&(a=this.FloatPrecision);for(var s=0,o=0;s<this.HQChart.ChartPaint.length;++s){var h=this.HQChart.ChartPaint[s];if(h.ChartFrame&&h.GetItemData&&(h.ChartFrame.Identify==this.Frame.Identify||h.ChartFrame==this.Frame)){var l=h.GetItemData({Index:t});if(!c.IsNonEmptyArray(l))continue;for(o=0;o<l.length;++o){var u=l[o],f=new Ht;f.Type=1,f.TextColor=m.FrameLatestPrice.TextColor,f.LineColor=u.Color,f.LineType=-1,f.IsLast=n.IsLast,c.IsNumber(r.LineType)&&(f.LineType=r.LineType),f.Value=u.Value;var C=c.FormatValueString(u.Value,a,this.LanguageID);if(r.Position=="left"?f.Message[0]=C:f.Message[1]=C,!n.IsLast){var D={};n.IsLast||(D.EmptyBGColor=m.FrameLatestPrice.EmptyBGColor),f.ExtendData={Custom:D}}if(e){var v={PreventDefault:!1,Label:f,Data:u,IndexName:h.IndexName,FrameID:this.Frame.Identify};if(e.Callback(e,v,this),v.PreventDefault)continue}this.Frame.CustomHorizontalInfo.push(f)}}}}},this.CustomLatestOverlayIndexDataCoordinate=function(r){var n=this.GetKLinePageInfo();if(n&&this.OverlayIndex&&c.IsNonEmptyArray(this.OverlayIndex.ChartPaint)){var e=null;this.GetEventCallback&&(e=this.GetEventCallback(et.ON_FORMAT_OVERLAY_INDEX_Y_LABEL));var t=n.End.Index,a=2;c.IsNumber(this.FloatPrecision)&&(a=this.FloatPrecision);for(var s=0,o=0;s<this.OverlayIndex.ChartPaint.length;++s){var h=this.OverlayIndex.ChartPaint[s];if(h.ChartFrame&&h.GetItemData){var l=h.GetItemData({Index:t});if(c.IsNonEmptyArray(l))for(o=0;o<l.length;++o){var u=l[o],f=new Ht;f.Type=1,f.TextColor=m.FrameLatestPrice.TextColor,f.LineColor=u.Color,f.LineType=-1,f.IsLast=n.IsLast,c.IsNumber(r.LineType)&&(f.LineType=r.LineType),f.Value=u.Value;var C=c.FormatValueString(u.Value,a,this.LanguageID);if(r.Position=="left"?f.Message[0]=C:f.Message[1]=C,!n.IsLast){var D={};n.IsLast||(D.EmptyBGColor=m.FrameLatestPrice.EmptyBGColor),f.ExtendData={Custom:D}}if(e){var v={PreventDefault:!1,Label:f,Data:u,IndexName:h.IndexName,OverlayIdentify:this.OverlayIndex.Identify};if(e.Callback(e,v,this),v.PreventDefault)continue}this.Frame.CustomHorizontalInfo.push(f)}}}}}}c.FormatValueThousandsString=function(r,n){if(r==null||isNaN(r)){if(n>0){for(var e="-.",t=0;t<n;++t)e+="-";return e}return"--"}var a="",s=r.toFixed(n);if(n>0){for(var o=s.split(".")[1],h=s.split(".")[0];h.length>3;)a=","+h.slice(-3)+a,h=h.slice(0,h.length-3);h&&(a=h+a+"."+o)}else{for(;s.length>3;)a=","+s.slice(-3)+a,s=s.slice(0,s.length-3);s&&(a=s+a)}return a};c.FormatValueString=function(r,n,e){if(r==null||isNaN(r)){if(n>0){for(var t="-.",a=0;a<n;++a)t+="-";return t}return"--"}if(r<1e-11&&r>-1e-11)return"0";var s=Math.abs(r);return e===ke.LANGUAGE_ENGLISH_ID?s<1e4?r.toFixed(n):s<1e6?(r/1e3).toFixed(n)+"K":s<1e9?(r/1e6).toFixed(n)+"M":s<1e12?(r/1e9).toFixed(n)+"B":(r/1e12).toFixed(n)+"T":e===ke.LANGUAGE_TRADITIONAL_CHINESE_ID?s<1e4?r.toFixed(n):s<1e8?(r/1e4).toFixed(n)+"萬":s<1e12?(r/1e8).toFixed(n)+"億":(r/1e12).toFixed(n)+"萬億":s<1e4?r.toFixed(n):s<1e6||s<1e8?(r/1e4).toFixed(n)+"万":s<1e12?(r/1e8).toFixed(n)+"亿":(r/1e12).toFixed(n)+"万亿"};c.FormatVolString=function(r,n){var e=Math.abs(r);return e<1e5?e.toFixed(0):e<1e7?(r/1e4).toFixed(1)+"万":e<1e8?(r/1e4).toFixed(0)+"万":e<1e9?(r/1e8).toFixed(2)+"亿":e<1e12?(r/1e8).toFixed(1)+"亿":(r/1e12).toFixed(1)+"万亿"};c.FromatIntegerString=function(r,n,e){return r<1e4&&c.IsInteger(r)&&(n=0),c.FormatValueString(r,n,e)};c.NumberToString=function(r){return r<10?"0"+r.toString():r.toString()};c.MillisecondToString=function(r){return r<10?"00"+r.toString():r<100?"0"+r.toString():r.toString()};c.FormatDateString=function(r,n,e){var t=parseInt(r/1e4),a=parseInt(r/100)%100,s=r%100;switch(n){case"MM-DD":return c.NumberToString(a)+"-"+c.NumberToString(s);case"MM/DD":return c.NumberToString(a)+"/"+c.NumberToString(s);case"MM/DD/W":var o=new Date(t,a-1,s),h=gt.GetText(Qo[o.getDay()],e);return c.NumberToString(a)+"/"+c.NumberToString(s)+"/"+h;case"YYYY-MM":return t+"-"+c.NumberToString(a);case"YYYY/MM/DD":return t.toString()+"/"+c.NumberToString(a)+"/"+c.NumberToString(s);case"YYYY/MM/DD/W":{var o=new Date(t,a-1,s),h=gt.GetText(Qo[o.getDay()],e);return t.toString()+"/"+c.NumberToString(a)+"/"+c.NumberToString(s)+"/"+h.toString()}case"DD/MM/YYYY":return c.NumberToString(s)+"/"+c.NumberToString(a)+"/"+t.toString();default:return t.toString()+"-"+c.NumberToString(a)+"-"+c.NumberToString(s)}};c.FormatTimeString=function(r,n){if(n=="HH:MM:SS"){var e=parseInt(r/1e4),t=parseInt(r%1e4/100),a=r%100;return c.NumberToString(e)+":"+c.NumberToString(t)+":"+c.NumberToString(a)}else if(n=="hh:mm"){var e=parseInt(r/1e4),t=parseInt(r%1e4/100),a=r%100;return c.NumberToString(e)+":"+c.NumberToString(t)}else if(n=="HH:MM"){var e=parseInt(r/100),t=r%100;return c.NumberToString(e)+":"+c.NumberToString(t)}else if(n=="HH:MM:SS.fff"){var s=r%1e3,o=parseInt(r/1e3),e=parseInt(o/1e4),t=parseInt(o%1e4/100),a=o%100;return c.NumberToString(e)+":"+c.NumberToString(t)+":"+c.NumberToString(a)+"."+c.MillisecondToString(s)}else if(r<1e4){var e=parseInt(r/100),t=r%100;return c.NumberToString(e)+":"+c.NumberToString(t)}else{var e=parseInt(r/1e4),t=parseInt(r%1e4/100),a=r%100;return c.NumberToString(e)+":"+c.NumberToString(t)+":"+c.NumberToString(a)}};c.FormatReportDateString=function(r){var n=parseInt(r/1e4),e=parseInt(r/100)%100,t;switch(e){case 3:t="一季度报";break;case 6:t="半年报";break;case 9:t="三季度报";break;case 12:t="年报";break}return n.toString()+t};c.FormatDateTimeString=function(r,n,e){var t=r.split(" ");if(t.length<2)return"";var a="";if(n){var s=parseInt(t[0]),o=parseInt(s/1e4),h=parseInt(s%1e4/100),l=s%100,u=o.toString()+"-"+(h<10?"0"+h.toString():h.toString())+"-"+(l<10?"0"+l.toString():l.toString());a+=u}if(e){var f=parseInt(t[1]);if(f<1e4){var C=f%100,D=parseInt(f/100),u=c.NumberToString(D)+":"+c.NumberToString(C);a.length>0&&(a+=" "),a+=u}else{var D=parseInt(f/1e4),C=parseInt(f%1e4/100),v=f%100,u=c.NumberToString(D)+":"+c.NumberToString(C)+":"+c.NumberToString(v);a.length>0&&(a+=" "),a+=u}}return a};c.FormatValueColor=function(r,n){return r!=null&&n==null?r==0?"PriceNull":r>0?"PriceUp":"PriceDown":r==null||n==null||r==n?"PriceNull":r>n?"PriceUp":"PriceDown"};c.IsNumber=function(r){return!(r==null||isNaN(r))};c.IsPlusNumber=function(r){return r==null||isNaN(r)?!1:r>0};c.IsInteger=function(r){return typeof r=="number"&&r%1===0};c.IsObjectExist=function(r){return!(r===void 0||r==null)};c.IsBool=function(r){return r===!0||r===!1};c.IsString=function(r){var n=typeof r>"u"?"undefined":(0,Wi.default)(r);return n=="string"};c.IsNonEmptyArray=function(r){return!r||!Array.isArray(r)?!1:r.length>0};c.IsFloat=function(r){return r===void 0||r==null||isNaN(r)?!1:r!=parseInt(r)};c.RemoveZero=function(r){for(;r.length>0;){var n=r.length-1,e=r[n];if(e=="0")r=r.substr(0,n);else if(e=="."){r=r.substr(0,n);break}else break}return r};function en(){this.newMethod=c,this.newMethod(),delete this.newMethod,this.CoordinateType=0,this.Symbol,this.Data,this.FrameSplitData2,this.FloatPrecision=null,this.Period,this.KLineChart,this.Custom=[],this.SplitType=0,this.DefaultSplitType=0,this.DefaultYMaxMin,this.FixedYMaxMin,this.EnableZoomUpDown=!1,this.LastMaxMin,this.PercentageTextFormat=0,this.IsEnableDragY=function(){return this.CoordinateType==0||this.CoordinateType==1},this.Operator=function(){var r={};r.Max=this.Frame.HorizontalMax,r.Min=this.Frame.HorizontalMin,r.Count=this.SplitCount,r.Max==r.Min&&(r.Max+=r.Max*.01,r.Min-=r.Min*.01);var n=this.FixedYMaxMin&&c.IsNumber(this.FixedYMaxMin.Max)&&c.IsNumber(this.FixedYMaxMin.Min);if(n)r.Max=this.FixedYMaxMin.Max,r.Min=this.FixedYMaxMin.Min;else if(this.DefaultYMaxMin){var e=this.DefaultYMaxMin;c.IsNumber(e.Max)&&(r.Min>e.Max?r.Min=e.Max:r.Max<e.Max&&(r.Max=e.Max)),c.IsNumber(e.Min)&&(r.Max<e.Min?r.Max=e.Min:r.Min>e.Min&&(r.Min=e.Min))}r.Interval=(r.Max-r.Min)/(r.Count-1);var t=V(),a=this.Frame.ChartBorder.GetChartWidth(),s=a<450*t,o=fe(this.Symbol);s&&W.IsSHSZIndex(this.Symbol)&&(o=0),this.FloatPrecision!=null&&(o=this.FloatPrecision),X.Chart.Log("[FrameSplitKLinePriceY::Operator] Max="+r.Max+" Min="+r.Min+" Count="+r.Count+" isPhoneModel="+s+" defaultfloatPrecision="+o+" "),this.Frame.Logarithmic=null,this.Frame.MultiTextFormat=0;var h=!0;if(r.IsFixedMaxMin=n,r.IsFilter=h,k.IsTickPeriod(this.Period))this.SplitTickData(r,o),h=r.IsFilter;else if(en.SplitCustom)en.SplitCustom(this,r,o),h=!1;else switch(this.CoordinateType){case 1:this.SplitPercentage(r,o,n)?(this.Frame.MultiTextFormat=this.PercentageTextFormat,h=!1):this.SplitDefault(r,o,n);break;case 3:this.SplitIncrease(r,o)?h=!1:this.SplitDefault(r,o);break;case 4:this.SplitAverage(r,o),h=!1;break;case 5:this.SplitGoldenSection(r,o),h=!1;break;case 2:this.SplitLogarithmic(r,o)?h=!1:this.SplitDefault(r,o);break;default:this.SplitType==1?(this.SplitFixed(r,o),h=!1):this.SplitType==2?(this.SplitFixedV2(r,o),h=!1):this.SplitDefault(r,o,n);break}if(this.CustomCoordinate(o),h&&(this.Frame.HorizontalInfo=this.Filter(this.Frame.HorizontalInfo,!1)),this.Frame.HorizontalMax=r.Max,this.Frame.HorizontalMin=r.Min,this.EnableZoomUpDown==!0&&!this.FixedYMaxMin&&(this.FixedYMaxMin={Max:r.Max,Min:r.Min}),X.Chart.Log("[FrameSplitKLinePriceY::Operator] fixed . Max="+r.Max+" Min="+r.Min+" Count="+r.Count),this.GetEventCallback){var l=this.GetEventCallback(et.ON_SPLIT_YCOORDINATE);if(l&&l.Callback){var u={ID:this.Frame.Identify,Frame:this.Frame};l.Callback(l,u,this)}}},this.SplitTickData=function(r,n){switch(this.CoordinateType){case 1:this.SplitPercentage(r,n,r.IsFixedMaxMin)?(this.Frame.MultiTextFormat=this.PercentageTextFormat,r.IsFilter=!1):this.SplitDefault(r,n,r.IsFixedMaxMin);break;default:this.SplitType==3?this.SplitTickPrice(r,n):this.SplitDefault(r,n,r.IsFixedMaxMin)}},this.SplitTickPrice=function(r,n){var e=this.KLineChart.GetAllPrice();this.Frame.HorizontalInfo=[];for(var t in e){var a=e[t];this.Frame.HorizontalInfo[t]=new Ht,this.Frame.HorizontalInfo[t].Value=a,this.IsShowLeftText&&(this.Frame.HorizontalInfo[t].Message[0]=a.toFixed(n)),this.IsShowRightText&&(this.Frame.HorizontalInfo[t].Message[1]=a.toFixed(n))}},this.SplitPercentage=function(r,n,e){var t=this.GetFirstOpenPrice();if(!c.IsNumber(t))return!1;r.Max=(r.Max-t)/t,r.Min=(r.Min-t)/t,r.Interval=(r.Max-r.Min)/(r.Count-1),e||this.IntegerCoordinateSplit2(r);var a=(1+r.Min)*t,s=(1+r.Max)*t,o;if(m.Frame&&m.Frame.PercentageText){var h=m.Frame.PercentageText;o={PriceColor:h.PriceColor,PercentageColor:h.PercentageColor,SplitColor:h.SplitColor,Font:h.Font}}for(var l=[],u=0;u<=r.Max;u+=r.Interval){var f=(u+1)*t,h=new Ht;if(h.Value=f,this.IsShowLeftText&&(h.Message[0]=f.toFixed(n)),this.IsShowRightText){var C=f.toFixed(n),D=(u*100).toFixed(2);D=c.RemoveZero(D),D+="%",h.Message[1]=[D,C],h.ExtendData=o}l.push(h)}for(var u=-r.Interval;u>=r.Min;u-=r.Interval){var f=(u+1)*t;if(!(f<a||f>s)){var h=new Ht;if(h.Value=f,this.IsShowLeftText&&(h.Message[0]=f.toFixed(n)),this.IsShowRightText){var C=f.toFixed(n),D=(u*100).toFixed(2);D=c.RemoveZero(D),D+="%",h.Message[1]=[D,C],h.ExtendData=o}l.push(h)}}return l.sort(function(v,S){return v.Value-S.Value}),this.Frame.HorizontalInfo=l,r.Min=a,r.Max=s,!0},this.SplitIncrease=function(r,n){var e=this.GetLast2ndClose();if(!c.IsNumber(e))return!1;this.IntegerCoordinateSplit(r),this.Frame.HorizontalInfo=[];for(var t=m.FrameSplitIncrease.Increase,a=[],s=e;s<r.Max;s=s*(1+t)){var o=new Ht;o.Value=s;var h=s.toFixed(n);this.IsShowLeftText&&(o.Message[0]=h),this.IsShowRightText&&(o.Message[1]=h),a.push(o)}for(var s=e*.9;s>r.Min;s=s*(1-t)){var o=new Ht;o.Value=s;var h=s.toFixed(n);this.IsShowLeftText&&(o.Message[0]=h),this.IsShowRightText&&(o.Message[1]=h),a.push(o)}return this.Frame.HorizontalInfo=a,!0},this.SplitAverage=function(r,n){var e=r.Max,t=r.Min;this.Frame.HorizontalInfo=[];for(var a=m.FrameSplitAverage.Count,s=(e-t)/a,o=0;o<=a;++o){var h=new Ht;h.Value=t+s*o;var l=h.Value.toFixed(n);this.IsShowLeftText&&(h.Message[0]=l),this.IsShowRightText&&(h.Message[1]=l),this.Frame.HorizontalInfo[o]=h}},this.SplitGoldenSection=function(r,n){var e=r.Max,t=r.Min;this.Frame.HorizontalInfo=[];var a=[],s=m.FrameGoldenSection.Golden;for(var o in s){var h=(e-t)*s[o]+t;item=new Ht,item.Value=h;var l=h.toFixed(n);this.IsShowLeftText&&(item.Message[0]=l),this.IsShowRightText&&(item.Message[1]=l),a.push(item)}this.Frame.HorizontalInfo=a},this.SplitLogarithmic=function(r,n){var e=m.FrameLogarithmic.MinInterval,t=this.GetFirstOpenPrice();if(!c.IsNumber(t))return!1;for(var a=this.ChartBorder.GetHeightEx(),s=[.01,.02,.04,.08,.1,.2],o=s[s.length-1],v=0;v<s.length;++v){var h=s[v],l=t*h*(a/(r.Max-r.Min));if(l>e){o=h;break}}var u=[],D=t,v=o;do{var T={Start:D};D=t*(1+v),T.End=D,u.push(T),v+=o}while(D<r.Max);var f=D,C=[],D=t,v=o;do{var T={End:D};D=t*(1-v),T.Start=D,C.push(T),v+=o}while(D>r.Min);var S=D;r.Max=f,r.Min=S,X.Chart.Log("[FrameSplitKLinePriceY::SplitLogarithmic] up, down",u,C),this.Frame.HorizontalInfo=[];var T=new Ht;T.Value=t,T.Font=m.FrameLogarithmic.OpenPriceFont;var I=T.Value.toFixed(n);this.IsShowLeftText&&(T.Message[0]=I),this.IsShowRightText&&(T.Message[1]=I),this.Frame.HorizontalInfo.push(T);for(var v in u){var T=new Ht;T.Value=u[v].End;var I=T.Value.toFixed(n);this.IsShowLeftText&&(T.Message[0]=I),this.IsShowRightText&&(T.Message[1]=I),this.Frame.HorizontalInfo.push(T)}for(var v in C){var T=new Ht;T.Value=C[v].End;var I=T.Value.toFixed(n);this.IsShowLeftText&&(T.Message[0]=I),this.IsShowRightText&&(T.Message[1]=I),this.Frame.HorizontalInfo.splice(0,0,T)}return this.Frame.Logarithmic={Up:u,Down:C,OpenPrice:t},!0},this.SplitDefault=function(r,n,e){e||this.IntegerCoordinateSplit(r),this.Frame.HorizontalInfo=[];for(var t=0,a=r.Min;t<r.Count;++t,a+=r.Interval)this.Frame.HorizontalInfo[t]=new Ht,this.Frame.HorizontalInfo[t].Value=a,this.IsShowLeftText&&(this.Frame.HorizontalInfo[t].Message[0]=a.toFixed(n)),this.IsShowRightText&&(this.Frame.HorizontalInfo[t].Message[1]=a.toFixed(n))},this.SplitFixed=function(r,n){this.Frame.HorizontalInfo=[];for(var e=0,t=r.Min;e<r.Count;++e,t+=r.Interval)this.Frame.HorizontalInfo[e]=new Ht,this.Frame.HorizontalInfo[e].Value=t,this.IsShowLeftText&&(this.Frame.HorizontalInfo[e].Message[0]=t.toFixed(n)),this.IsShowRightText&&(this.Frame.HorizontalInfo[e].Message[1]=t.toFixed(n))},this.SplitFixedV2=function(r,n){this.Frame.HorizontalInfo=[];for(var e=0,t=r.Min;e<r.Count;++e,t+=r.Interval)this.Frame.HorizontalInfo[e]=new Ht,this.Frame.HorizontalInfo[e].Value=t,this.IsShowLeftText&&(this.Frame.HorizontalInfo[e].Message[0]=t.toFixed(n)),this.IsShowRightText&&(this.Frame.HorizontalInfo[e].Message[1]=t.toFixed(n));r.IsFixedMaxMin||(n==0?(r.Max+=1,r.Min-=1):n==1?(r.Max+=.1,r.Min-=.1):n==2&&(r.Max+=.01,r.Min-=.01))},this.CustomCoordinate=function(r){this.Frame.CustomHorizontalInfo=[];for(var n,e,t=0;t<this.Custom.length;++t){var a=this.Custom[t];if(a.Type==Ua.LATEST_VALUE_ID||a.Type==Ua.PAGE_DATA_INCREASE||a.Type==Ua.PAGE_LAST_PRICE_ID){var s=r;c.IsNumber(a.FloatPrecision)&&a.FloatPrecision>=0&&(s=a.FloatPrecision);var o=this.GetLatestPrice(s,a);o&&(a.Type==Ua.LATEST_VALUE_ID?n=o:a.Type==Ua.PAGE_LAST_PRICE_ID?e=o:this.Frame.CustomHorizontalInfo.push(o))}else a.Type==Ua.FIXED_VALUE_ID?this.CustomFixedCoordinate(a):a.Type==Ua.PAGE_LAST_INDEX_VALUE_ID&&this.CustomLatestIndexDataCoordinate(a)}(n||e)&&(n&&e&&e.IsLast===!0?this.Frame.CustomHorizontalInfo.unshift(n):(n&&this.Frame.CustomHorizontalInfo.unshift(n),e&&this.Frame.CustomHorizontalInfo.push(e)))},this.GetLatestPrice=function(r,n){if(!this.Data||!this.Data.Data||this.Data.Data.length<=0)return null;var e=this.Data.Data[this.Data.Data.length-1],t=!0;if(n.Type==2){var a=this.GetKLinePageInfo();a&&(e=a.End.Item,t=a.IsLast)}var s=new Ht;s.Type=0,n&&c.IsNumber(n.Type)&&(s.Type=n.Type),s.Value=e.Close,s.TextColor=m.FrameLatestPrice.TextColor,s.LineType=2;var o=e.Close.toFixed(r);if(e.Close>e.Open?s.LineColor=m.FrameLatestPrice.UpBarColor:e.Close<e.Open?s.LineColor=m.FrameLatestPrice.DownBarColor:s.LineColor=m.FrameLatestPrice.UnchagneBarColor,n.Type==3){var a=this.GetKLinePageInfo();if(a&&c.IsNumber(a.Start.Item.YClose)){var h=(a.End.Item.Close-a.Start.Item.YClose)/a.Start.Item.YClose*100,o=h.toFixed(2)+"%";h>0?s.LineColor=m.FrameLatestPrice.UpBarColor:h<0?s.LineColor=m.FrameLatestPrice.DownBarColor:s.LineColor=m.FrameLatestPrice.UnchagneBarColor,s.Value=a.End.Item.Close,t=a.IsLast}}if(n.DateTime=="HH:MM"&&k.IsMinutePeriod(this.Period,!0)){var l=c.FormatTimeString(e.Time,n.DateTime),u=[{Text:o},{Text:l}];n.Position=="left"?s.Message[0]=u:s.Message[1]=u}else if(c.IsBool(n.CountDown)){var u=[{Text:o},{Type:1}];n.Position=="left"?s.Message[0]=u:s.Message[1]=u}else n.Position=="left"?s.Message[0]=o:s.Message[1]=o;if(c.IsNumber(n.LineType)&&(s.LineType=n.LineType),c.IsPlusNumber(n.LineWidth)&&(s.LineWidth=n.LineWidth),n.LineDash&&(s.LineDash=n.LineDash),n.IsShowLine==!1&&(s.LineType=-1),s.IsLast=t,!t||n.PositionEx===1){var f={};t||(f.EmptyBGColor=m.FrameLatestPrice.EmptyBGColor),n.PositionEx===1&&(f.Position=1),s.ExtendData={Custom:f}}return s},this.GetFirstOpenPrice=function(){if(!this.Data)return null;for(var r=this.Frame.XPointCount,n=this.Data.DataOffset,e=0;n<this.Data.Data.length&&e<r;++n,++e){var t=this.Data.Data[n];if(!(t.Open==null||t.High==null||t.Low==null||t.Close==null))return k.IsTickPeriod(this.Period)?t.YClose:t.Open}return null},this.GetLast2ndClose=function(){if(!this.Data||this.Data.Data.length<=0)return null;var r=this.Frame.XPointCount,n=this.Data.DataOffset+r-1;n>=this.Data.Data.length&&(n=this.Data.Data.length-1);for(var e=null,t=n,a=0;t>=0&&t<this.Data.Data.length;--t){var s=this.Data.Data[t];if(!(s.Open==null||s.High==null||s.Low==null||s.Close==null)&&(a==0?e=s.Open:a==1&&(e=s.Close),++a,a>=2))break}return e},this.CustomFixedCoordinate=function(r){var n=fe(this.Symbol);for(var e in r.Data){var t=r.Data[e],a=new Ht;a.Type=1,a.TextColor=t.TextColor,a.LineColor=t.Color,a.LineType=2,c.IsNumber(r.LineType)&&(a.LineType=r.LineType),c.IsPlusNumber(r.LineWidth)&&(a.LineWidth=r.LineWidth),r.LineDash&&(a.LineDash=r.LineDash),r.IsShowLine==!1&&(a.LineType=-1),a.Value=t.Value;var s;t.Text?s=t.Text:s=a.Value.toFixed(n),r.Position=="left"?a.Message[0]=s:a.Message[1]=s,r.PositionEx===1&&(a.ExtendData={Custom:{Position:1}}),this.Frame.CustomHorizontalInfo.push(a)}},this.IntegerCoordinateSplit2=function(r){var n=this.FrameSplitData2.Find(r.Interval);if(!n)return!1;if(r.Interval==n.FixInterval)return!0;var e=parseInt((r.Max/n.FixInterval+.5).toFixed(0))*n.FixInterval,t=parseInt((r.Min/n.FixInterval-.5).toFixed(0))*n.FixInterval;r.Min==0&&(t=0),t<0&&r.Min>0&&(t=0);for(var a=0,s=t;s-e<1e-8;s+=n.FixInterval)++a;return r.Interval=n.FixInterval,r.Max=e,r.Min=t,r.Count=a,!0}}function Pa(){this.newMethod=c,this.newMethod(),delete this.newMethod,this.SplitCount=3,this.FloatPrecision=2,this.FLOATPRECISION_RANGE=[1,.1,.01,.001,1e-4],this.SplitType=0,this.DefaultSplitType=0,this.Custom=[],this.DefaultYMaxMin,this.EnableRemoveZero=!0,this.LineType=null,this.IgnoreYValue=null,this.FixedYMaxMin,this.EnableZoomUpDown=!1,this.IsBeforeData=!1,this.BeforeOpenData,this.IsAfterData=!1,this.AfterCloseData,this.ShareAfterVol=0,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.OverlayIdentify,this.HQChart,this.OverlayIndex,this.IsEnableDragY=function(){return!0},this.GetFloatPrecision=function(r,n){if(r>this.FLOATPRECISION_RANGE[0])return n;if(n<0)return 2;for(;n<this.FLOATPRECISION_RANGE.length&&!(r>this.FLOATPRECISION_RANGE[n]);++n);return n},this.Operator=function(){var r={};r.Max=this.Frame.HorizontalMax,r.Min=this.Frame.HorizontalMin,r.Max==r.Min&&(r.Max==0?(r.Max=1,r.Min=-1):(r.Max+=r.Max*.01,r.Min-=r.Min*.01));var n=!1;if(this.FixedYMaxMin&&c.IsNumber(this.FixedYMaxMin.Max)&&c.IsNumber(this.FixedYMaxMin.Min)&&(n=!0),n)r.Max=this.FixedYMaxMin.Max,r.Min=this.FixedYMaxMin.Min;else if(this.DefaultYMaxMin){var e=this.DefaultYMaxMin;c.IsNumber(e.Max)&&(r.Min>e.Max?r.Min=e.Max:r.Max<e.Max&&(r.Max=e.Max)),c.IsNumber(e.Min)&&(r.Max<e.Min?r.Max=e.Min:r.Min>e.Min&&(r.Min=e.Min))}if(this.Frame.YSpecificMaxMin?(r.Count=this.Frame.YSpecificMaxMin.Count,r.Interval=(r.Max-r.Min)/(r.Count-1)):this.SplitType==1||n?(r.Count=this.SplitCount,r.Interval=(r.Max-r.Min)/(r.Count-1)):this.SplitType==2?(r.Max=100,r.Min=0,r.Count=this.SplitCount,r.Interval=(r.Max-r.Min)/(r.Count-1)):(r.Count=this.SplitCount,r.Interval=(r.Max-r.Min)/(r.Count-1),this.IntegerCoordinateSplit(r)),this.Frame.HorizontalMax=r.Max,this.Frame.HorizontalMin=r.Min,this.Frame.HorizontalInfo=[],this.Frame.YSplitScale)for(var t in this.Frame.YSplitScale){var a=this.Frame.YSplitScale[t],s=new Ht;s.Value=a,c.IsNumber(this.LineType)&&(s.LineType=this.LineType);var o=Math.abs(a);if(o<1e-10)s.Message[1]=0;else if(o<this.FLOATPRECISION_RANGE[this.FLOATPRECISION_RANGE.length-1])s.Message[1]=a.toExponential(2).toString();else{var h=this.GetFloatPrecision(o,this.FloatPrecision);s.Message[1]=c.FormatValueString(a,h,this.LanguageID)}s.Message[0]=s.Message[1],this.IsShowLeftText==!1&&(this.Frame.HorizontalInfo[t].Message[0]=null),this.IsShowRightText==!1&&(this.Frame.HorizontalInfo[t].Message[1]=null),this.Frame.HorizontalInfo.push(s)}else for(var t=0,a=r.Min;t<r.Count;++t,a+=r.Interval){var s=new Ht;this.Frame.HorizontalInfo[t]=s,s.Value=a,c.IsNumber(this.LineType)&&(s.LineType=this.LineType);var l=this.FormatValueString(a);this.Frame.HorizontalInfo[t].Message[0]=this.Frame.HorizontalInfo[t].Message[1]=l,this.IsShowLeftText==!1&&(this.Frame.HorizontalInfo[t].Message[0]=null),this.IsShowRightText==!1&&(this.Frame.HorizontalInfo[t].Message[1]=null)}if(this.FilterIgnoreYValue(),this.CustomCoordinate(),this.SplitType!=1&&(this.Frame.HorizontalInfo=this.Filter(this.Frame.HorizontalInfo,r.Max>0&&r.Min<0)),this.RightFrameSplitY(),this.CallAcutionSplitY(this.SplitCount,r),this.EnableRemoveZero&&this.RemoveZero(this.Frame.HorizontalInfo),this.DynamicMessageText(),this.Frame.HorizontalMax=r.Max,this.Frame.HorizontalMin=r.Min,this.EnableZoomUpDown==!0&&!this.FixedYMaxMin&&(this.FixedYMaxMin={Max:r.Max,Min:r.Min}),this.GetEventCallback){var u=this.GetEventCallback(et.ON_SPLIT_YCOORDINATE);if(u&&u.Callback){var f={ID:this.Frame.Identify,Frame:this.Frame};this.OverlayIdentify&&(f.OverlayIdentify=this.OverlayIdentify),u.Callback(u,f,this)}}},this.FormatValueString=function(r){var n;if(this.StringFormat==1){var e=this.FloatPrecision;c.IsNumber(r)&&Math.abs(r)>1e3&&(e=0),n=c.FormatValueString(r,e,this.LanguageID)}else{var t=Math.abs(r);if(t<1e-10)n=0;else if(t<this.FLOATPRECISION_RANGE[this.FLOATPRECISION_RANGE.length-1])n=r.toExponential(2).toString();else{var e=this.GetFloatPrecision(t,this.FloatPrecision);n=c.FormatValueString(r,e,this.LanguageID)}}return n},this.FilterIgnoreYValue=function(){if(!(!this.IgnoreYValue||this.IgnoreYValue.length<=0)){var r=new Ee.default(this.IgnoreYValue);this.Frame.HorizontalInfo=this.Frame.HorizontalInfo.filter(function(n){return!r.has(n.Value)})}},this.DynamicMessageText=function(){if(this.SplitType==2)for(var r=0;r<this.Frame.HorizontalInfo.length;++r){var n=this.Frame.HorizontalInfo[r];n.Message[0]&&(n.Message[0]+="%"),n.Message[1]&&(n.Message[1]+="%")}},this.CallAcutionSplitY=function(r,n){if(this.Frame.Identify!=1)return null;var e=this.GetCallAcutionSplitY(r,n);if(e){for(var t=0;t<this.Frame.HorizontalInfo.length;++t){var a=this.Frame.HorizontalInfo[t];e.IsBeforeData&&(a.Message[2]=a.Message[0],a.Message[0]=null),e.IsAfterData&&(this.ShareAfterVol==0||this.ShareAfterVol==2)&&(a.Message[3]=a.Message[1],a.Message[1]=null)}for(var t=0;t<e.HorizontalInfo.length;++t){var a=e.HorizontalInfo[t];this.Frame.HorizontalInfo.push(a)}}},this.GetCallAcutionSplitY=function(r,n){if(this.Frame.Identify!=1)return null;var e=this.IsBeforeData==!0&&this.BeforeOpenData&&(this.BeforeOpenData.Ver==2||this.BeforeOpenData.Ver==3),t=this.IsAfterData==!0&&this.AfterCloseData&&(this.AfterCloseData.Ver==2||this.AfterCloseData.Ver==3);if(e||t){var a=(n.Max-n.Min)/(r-1);if(e)var D=(this.BeforeOpenData.VolMax-this.BeforeOpenData.VolMin)/(r-1);if(t)var T=(this.AfterCloseData.VolMax-this.AfterCloseData.VolMin)/(r-1);for(var s=[],o=0;o<r;++o){var h=new Ht,l=a*o;if(h.Value=l,h.LineType=8,e){var u=D*o;h.Message[0]=this.FormatValueString(u)}if(t&&(this.ShareAfterVol==0||this.ShareAfterVol==2)){var f=T*o;h.Message[1]=this.FormatValueString(f)}s.push(h)}return{HorizontalInfo:s,IsBeforeData:e,IsAfterData:t}}var C=!1,D=null;if(this.MultiDayBeforeOpenData&&c.IsNonEmptyArray(this.MultiDayBeforeOpenData)){C=!0;var v=this.MultiDayBeforeOpenData[0];if(v.Ver==2||v.Ver==3)var D=(v.VolMax-v.VolMin)/(r-1)}var S=!1,T=null;if(this.MultiDayAfterCloseData&&c.IsNonEmptyArray(this.MultiDayAfterCloseData)){S=!0;var v=this.MultiDayAfterCloseData[0];if(v.Ver==2||v.Ver==3)var T=(v.VolMax-v.VolMin)/(r-1)}if(C||S){for(var a=(n.Max-n.Min)/(r-1),s=[],o=0;o<r;++o){var h=new Ht,l=a*o;h.Value=l,h.LineType=9;var I=!1;if(D!=null){var u=D*o;h.Message[0]=this.FormatValueString(u),I=!0}if(T!=null&&(this.ShareAfterVol==0||this.ShareAfterVol==2)){var f=T*o;h.Message[1]=this.FormatValueString(f),I=!0}I&&s.push(h)}if(c.IsNonEmptyArray(s))return{HorizontalInfo:s,IsBeforeData:C,IsAfterData:S}}return null},this.RightFrameSplitY=function(){if(this.Frame.RightFrame){var r=this.Frame.RightFrame;r.YSplitOperator&&r.YSplitOperator.Operator();for(var n=0;n<this.Frame.HorizontalInfo.length;++n){var e=this.Frame.HorizontalInfo[n],t=this.Frame.GetYFromData(e.Value),a=r.GetYData(t);e.Message[1]=c.FormatValueString(a,this.FloatPrecision,this.LanguageID)}}},this.CustomCoordinate=function(){if(this.Frame.CustomHorizontalInfo=[],!!c.IsNonEmptyArray(this.Custom))for(var r=0;r<this.Custom.length;++r){var n=this.Custom[r];n.Type==Ua.PAGE_LAST_INDEX_VALUE_ID?this.CustomLatestIndexDataCoordinate(n):n.Type==Ua.FIXED_VALUE_ID?this.CustomFixedCoordinate(n):n.Type==Ua.PAGE_LAST_OVERLAY_INDEX_VALUE_ID&&this.CustomLatestOverlayIndexDataCoordinate(n)}},this.CustomFixedCoordinate=function(r){if(c.IsNonEmptyArray(r.Data))for(var n=2,e=0;e<r.Data.length;++e){var t=r.Data[e],a=new Ht;a.Type=1,a.TextColor=t.TextColor,a.LineColor=t.Color,a.LineType=2,c.IsNumber(r.LineType)&&(a.LineType=r.LineType),r.IsShowLine==!1&&(a.LineType=-1),a.Value=t.Value;var s;t.Text?s=t.Text:s=a.Value.toFixed(n),r.Position=="left"?a.Message[0]=s:a.Message[1]=s,this.Frame.CustomHorizontalInfo.push(a)}}}function pr(){this.newMethod=c,this.newMethod(),delete this.newMethod,this.ShowText=!0,this.Period,this.Symbol,this.MinTextDistance=50*V(),this.MinBarDistance=5,this.SplitDateTime=function(){this.Frame.VerticalInfo=[];for(var r=this.Frame.DistanceWidth+this.Frame.DataWidth,n=this.Frame.Data.DataOffset,e=this.Frame.XPointCount,t=0,a=0,s=0,o=n;s<e&&o<this.Frame.Data.Data.length;++s,++o){t+=r,++a;var h=null;if(s==0){var l=c.FormatDateString(this.Frame.Data.Data[o].Date,"MM-DD");h={Value:o-n,Text:l}}else if(t>this.MinTextDistance&&a>=this.MinBarDistance){var u=c.FormatTimeString(this.Frame.Data.Data[o].Time);h={Value:o-n,Text:u}}if(h){var f=new Ht;f.Value=h.Value,this.ShowText&&(f.Message[0]=h.Text),f.Value==0&&(f.LineType=-1),this.Frame.VerticalInfo.push(f),t=0,a=0,s==0&&(t=-(this.MinTextDistance/2))}}},this.SplitSecond=function(){this.Frame.VerticalInfo=[];for(var r=this.Frame.DistanceWidth+this.Frame.DataWidth,n=this.Frame.Data.DataOffset,e=this.Frame.XPointCount,t=0,a=0,s=0,o=n;s<e&&o<this.Frame.Data.Data.length;++s,++o){t+=r,++a;var h=null;if(s==0){var l=c.FormatDateString(this.Frame.Data.Data[o].Date,"MM-DD");h={Value:o-n,Text:l}}else if(t>this.MinTextDistance&&a>=this.MinBarDistance){var u=c.FormatTimeString(this.Frame.Data.Data[o].Time,"HH:MM:SS");h={Value:o-n,Text:u}}if(h){var f=new Ht;f.Value=h.Value,this.ShowText&&(f.Message[0]=h.Text),this.Frame.VerticalInfo.push(f),t=0,a=0,s==0&&(t=-(this.MinTextDistance/2))}}},this.SplitDate=function(){this.Frame.VerticalInfo=[];for(var r=this.Frame.Data.DataOffset,n=this.Frame.XPointCount,e=null,t=null,a=12,s=0,o=0,h=r,l=a;o<n&&h<this.Frame.Data.Data.length;++o,++h){var u=parseInt(this.Frame.Data.Data[h].Date/1e4),f=parseInt(this.Frame.Data.Data[h].Date/100)%100;if(t!=f&&++s,l<a||e!=null&&e==u&&t!=null&&t==f){t=f,++l;continue}var C=new Ht;C.Value=h-r;var D;e==null||e!=u?D=u.toString():(t==null||t!=f)&&(D=f.toString()+"月",D=gt.GetText(D,this.LanguageID)),e=u,t=f,this.ShowText&&(C.Message[0]=D),C.Value==0&&(C.LineType=-1),this.Frame.VerticalInfo.push(C),l=0}this.Period==0&&s<=2&&this.SplitShortDate()},this.SplitShortDate=function(){this.Frame.VerticalInfo=[];for(var r=this.Frame.Data.DataOffset,n=this.Frame.XPointCount,e=12,t=!0,a=0,s=r,o=e;a<n&&s<this.Frame.Data.Data.length;++a,++s){var h=parseInt(this.Frame.Data.Data[s].Date/1e4);if(o<e){++o;continue}var l=new Ht;l.Value=s-r;var u;t?(u=h.toString(),t=!1):u=c.FormatDateString(this.Frame.Data.Data[s].Date,"MM-DD"),this.ShowText&&(l.Message[0]=u),l.Value==0&&(l.LineType=-1),this.Frame.VerticalInfo.push(l),o=0}if(this.Frame.VerticalInfo.length==1){var f=this.Frame.VerticalInfo[0],s=f.Value+r,C=this.Frame.Data.Data[s],u=c.FormatDateString(C.Date,"YYYY-MM");this.ShowText&&(f.Message[0]=u)}},this.Operator=function(){if(this.Frame.Data!=null&&(pr.SplitCustom?pr.SplitCustom(this):k.IsMinutePeriod(this.Period,!0)?this.SplitDateTime():k.IsSecondPeriod(this.Period)?this.SplitSecond():k.IsTickPeriod(this.Period)?this.SplitSecond():this.SplitDate(),this.GetEventCallback)){var r=this.GetEventCallback(et.ON_SPLIT_XCOORDINATE);if(r&&r.Callback){var n={ID:this.Frame.Identify,Frame:this.Frame};r.Callback(r,n,this)}}},this.CreateCoordinateInfo=function(){return new Ht}}function GC(){this.newMethod=c,this.newMethod(),delete this.newMethod,this.High=null,this.Low=null,this.YClose,this.Data,this.SourceData,this.OverlayChartPaint,this.SplitCount=7,this.Symbol,this.SplitType=0,this.DefaultSplitType=0,this.LimitPrice,this.Custom,this.RightTextFormat=0,this.BeforeOpenData,this.IsBeforeData=!1,this.AfterCloseData,this.IsAfterData=!1,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.DayOffset,this.AverageData,this.DayCount=1,this.GlobalOption,this.HQChart,this.IsEnableDragY=function(){return!1},this.Operator=function(){if(this.Frame.HorizontalInfo=[],this.Frame.CustomHorizontalInfo=[],!!this.Data){var r=this.GetMaxMin();if(this.Symbol&&W.IsUSA(this.Symbol.toUpperCase())?this.USASplit(r):this.SplitType==2?this.USASplit(r):this.DefaultSplit(r),this.CustomCoordinate(),this.GetEventCallback){var n=this.GetEventCallback(et.ON_SPLIT_YCOORDINATE);if(n&&n.Callback){var e={ID:this.Frame.Identify,Frame:this.Frame};n.Callback(n,e,this)}}}},this.CustomCoordinate=function(){if(this.Custom){var r=fe(this.Symbol);for(var n in this.Custom){var e=this.Custom[n];if(e.Type==1)this.CustomFixedCoordinate(e);else if(e.Type==0){var t=this.GetLatestPrice(r,e);t&&this.Frame.CustomHorizontalInfo.push(t)}}}},this.GetLatestPrice=function(r,n){if(!this.Data||!this.Data.Data||this.Data.Data.length<=0)return null;var e=this.Data.Data[this.Data.Data.length-1];if(!c.IsNumber(e)||!c.IsNumber(this.YClose))return null;var t=new Ht;t.Type=0,t.Value=e,t.TextColor=m.FrameLatestPrice.TextColor,t.LineType=2;var a=e.toFixed(r);if(n.DateTime=="HH:MM"){var s=this.Frame.Data.Data[this.Frame.Data.Data.length-1],o=c.FormatTimeString(s.Time,n.DateTime),h=[{Text:a},{Text:o}];n.Position=="left"?t.Message[0]=h:t.Message[1]=h}else n.Position=="left"?t.Message[0]=a:t.Message[1]=a;return e>this.YClose?t.LineColor=m.FrameLatestPrice.UpBarColor:e<this.YClose?t.LineColor=m.FrameLatestPrice.DownBarColor:t.LineColor=m.FrameLatestPrice.UnchagneBarColor,c.IsNumber(n.LineType)&&(t.LineType=n.LineType),c.IsPlusNumber(n.LineWidth)&&(t.LineWidth=n.LineWidth),n.LineDash&&(t.LineDash=n.LineDash),n.IsShowLine==!1&&(t.LineType=-1),n.PositionEx===1&&(t.ExtendData={Custom:{Position:1}}),t},this.CustomFixedCoordinate=function(r){for(var n=fe(this.Symbol),e=0;e<r.Data.length;++e){var t=r.Data[e],a=new Ht;if(a.Type=1,a.TextColor=t.TextColor,a.LineColor=t.Color,a.LineType=2,c.IsNumber(r.LineType)&&(a.LineType=r.LineType),c.IsPlusNumber(r.LineWidth)&&(a.LineWidth=r.LineWidth),r.LineDash&&(a.LineDash=r.LineDash),r.IsShowLine==!1&&(a.LineType=-1),r.PositionEx===1&&(a.ExtendData={Custom:{Position:1}}),c.IsNumber(t.Increase)){if(!c.IsNumber(this.YClose))continue;a.Value=this.YClose*(1+t.Increase)}else a.Value=t.Value;var s;t.Text?s=t.Text:s=a.Value.toFixed(n),r.Position=="left"?a.Message[0]=s:a.Message[1]=s,this.Frame.CustomHorizontalInfo.push(a)}},this.GetCallAuctionMaxMin=function(r,n){for(var e in r.Data){var t=r.Data[e];t&&(c.IsNumber(t.Price)&&(n.Max==null&&(n.Max=t.Price),n.Min==null&&(n.Min=t.Price),n.Max<t.Price&&(n.Max=t.Price),n.Min>t.Price&&(n.Min=t.Price)),r.Ver==3&&c.IsNumber(t.AvPrice)&&(n.Max==null&&(n.Max=t.AvPrice),n.Min==null&&(n.Min=t.AvPrice),n.Max<t.AvPrice&&(n.Max=t.AvPrice),n.Min>t.AvPrice&&(n.Min=t.AvPrice)))}},this.GetMultiDayBeforeOpenData=function(){if(!this.MultiDayBeforeOpenData||!c.IsNonEmptyArray(this.MultiDayBeforeOpenData))return null;if(!this.DayOffset)return this.MultiDayBeforeOpenData;if(!c.IsNumber(this.DayOffset.Offset)||!c.IsNumber(this.DayOffset.ShowDayCount))return null;if(this.GlobalOption&&this.GlobalOption.IsValueFullRange===!0)return this.MultiDayBeforeOpenData;var r=this.DayOffset.ShowDayCount,n=this.DayOffset.Offset,e=this.MultiDayBeforeOpenData.slice(n,n+r);return e},this.GetMultiDayAfterCloseData=function(){if(!this.MultiDayAfterCloseData||!c.IsNonEmptyArray(this.MultiDayAfterCloseData))return null;if(!this.DayOffset)return this.MultiDayAfterCloseData;if(!c.IsNumber(this.DayOffset.Offset)||!c.IsNumber(this.DayOffset.ShowDayCount))return null;if(this.GlobalOption&&this.GlobalOption.IsValueFullRange===!0)return this.MultiDayAfterCloseData;var r=this.DayOffset.ShowDayCount,n=this.DayOffset.Offset,e=this.MultiDayAfterCloseData.slice(n,n+r);return e},this.GetMaxMin=function(){var r=this.YClose,n=this.YClose,e=this.Data,t=!1;if(this.SourceData&&(e=this.SourceData,t=!0),this.DayCount>1){var a=this.DayOffset.DataOffset,s=this.DayOffset.ShowDataCount;this.GlobalOption&&this.GlobalOption.IsValueFullRange===!0&&(a=0,s=e.Data.length);for(var o=a,h=0;o<e.Data.length&&h<s;++o,++h){var l=null;if(t){var u=e.Data[o];u.Before?l=u.Before.Close:l=u.Close}else l=e.Data[o];l!=null&&(r<l&&(r=l),n>l&&(n=l))}if(this.AverageData)for(var o=a,h=0;o<this.AverageData.Data.length&&h<s;++o,++h)this.AverageData.Data[o]!=null&&(r<this.AverageData.Data[o]&&(r=this.AverageData.Data[o]),n>this.AverageData.Data[o]&&(n=this.AverageData.Data[o]))}else{for(var o=0;o<e.Data.length;++o){var l=null;if(t){var u=e.Data[o];u.Before?l=u.Before.Close:l=u.Close}else l=e.Data[o];l!=null&&(r<l&&(r=l),n>l&&(n=l))}if(this.AverageData)for(var o=0;o<this.AverageData.Data.length;++o)this.AverageData.Data[o]!=null&&(r<this.AverageData.Data[o]&&(r=this.AverageData.Data[o]),n>this.AverageData.Data[o]&&(n=this.AverageData.Data[o]))}for(var o in this.OverlayChartPaint){var u=this.OverlayChartPaint[o],f=u.GetMaxMin();f.Max&&f.Max>r&&(r=f.Max),f.Min&&f.Min<n&&(n=f.Min)}this.SplitType==1&&this.LimitPrice&&(r<this.LimitPrice.Max&&(r=this.LimitPrice.Max),n>this.LimitPrice.Min&&(n=this.LimitPrice.Min)),c.IsNumber(this.High)&&c.IsNumber(this.Low)&&(r<this.High&&(r=this.High),n>this.Low&&(n=this.Low));var f={Max:null,Min:null};this.IsAfterData&&this.AfterCloseData&&this.GetCallAuctionMaxMin(this.AfterCloseData,f),this.IsBeforeData&&this.BeforeOpenData&&this.GetCallAuctionMaxMin(this.BeforeOpenData,f);var C=this.GetMultiDayBeforeOpenData();if(C&&this.ChartBorder.MultiDayMinute.Count>1&&this.ChartBorder.MultiDayMinute.Left>0)for(var o=0;o<C.length;++o){var D=C[o];this.GetCallAuctionMaxMin(D,f)}var v=this.GetMultiDayAfterCloseData();if(v&&this.ChartBorder.MultiDayMinute.Count>1&&this.ChartBorder.MultiDayMinute.Right>0)for(var o=0;o<v.length;++o){var D=v[o];this.GetCallAuctionMaxMin(D,f)}c.IsNumber(f.Max)&&r<f.Max&&(r=f.Max),c.IsNumber(f.Min)&&n>f.Min&&(n=f.Min);var S=this.GetOverlayMaxMin();return S&&(c.IsNumber(S.Max)&&S.Max>r&&(r=S.Max),c.IsNumber(S.Min)&&S.Min<n&&(n=S.Min)),{Max:r,Min:n}},this.GetOverlayMaxMin=function(){if(!this.HQChart||!this.HQChart.Frame||!this.HQChart.Frame.SubFrame)return null;var r=this.HQChart.Frame.SubFrame[0];if(!r||!c.IsNonEmptyArray(r.OverlayIndex))return null;for(var n={Max:null,Min:null},e=0;e<r.OverlayIndex.length;++e){var t=r.OverlayIndex[e];if(!(!t||!t.Frame)){var a=t.Frame;if(a.IsShareY==!0&&a.IsCalculateYMaxMin!==!1)for(var s=0;s<t.ChartPaint.length;++s){var o=t.ChartPaint[s],h=o.GetMaxMin();h==null||h.Max==null||h.Min==null||((n.Max==null||n.Max<h.Max)&&(n.Max=h.Max),(n.Min==null||n.Min>h.Min)&&(n.Min=h.Min))}}}return n},this.USASplit=function(r){var n=r.Max,e=r.Min;if(n==e)n=n+n*.1,e=e-e*.1;else{var t=V(),a=this.Frame.ChartBorder.GetHeight(),s=5*t*(n-e)/a;n+=s,e-=s,e<0&&(e=r.Min)}var o=this.SplitCount,h=(n-e)/(o-1),l=[1,.1,.01,.001,1e-4],u=fe(this.Symbol);h<l[u]&&(h=l[u],n=e+h*o);for(var f=0;f<o;++f){var C=e+h*f;if(!(this.YClose&&C==this.YClose)){var D=new Ht;D.Value=C;var v=C.toFixed(u);if(this.IsShowLeftText&&(D.Message[0]=v),this.YClose){var S=(C/this.YClose-1)*100;S>0?D.TextColor=m.UpTextColor:S<0&&(D.TextColor=m.DownTextColor),this.IsShowRightText&&(this.RightTextFormat==1?D.Message[1]=v:D.Message[1]=c.FormatValueString(S,2)+"%")}this.Frame.HorizontalInfo.push(D)}}if(this.YClose>e&&this.YClose<n){var D=new Ht;D.Value=this.YClose,D.LineType=2,m.FrameDotSplitPen&&(D.LineColor=m.FrameDotSplitPen);var v=this.YClose.toFixed(u);this.IsShowLeftText&&(D.Message[0]=v),this.IsShowRightText&&(this.RightTextFormat==1?D.Message[1]=v:D.Message[1]="0.00%"),this.Frame.HorizontalInfo.push(D)}this.Frame.HorizontalInfo.sort(function(T,I){return T.Value-I.Value}),this.Frame.HorizontalMax=n,this.Frame.HorizontalMin=e},this.DefaultSplit=function(r){var n=r.Max,e=r.Min;if(this.YClose==n&&this.YClose==e)n=this.YClose+this.YClose*.1,e=this.YClose-this.YClose*.1;else{var t=Math.max(Math.abs(this.YClose-n),Math.abs(this.YClose-e));n=this.YClose+t,e=this.YClose-t,e<0&&(e=r.Min)}var a=V(),s=this.Frame.ChartBorder.GetChartWidth(),o=s<450*a;X.Chart.Log("[FrameSplitMinutePriceY]max="+n+" min="+e+" isPhoneModel="+o);var h=this.SplitCount,l=(n-e)/(h-1),u=[1,.1,.01,.001,1e-4],f=fe(this.Symbol);o&&W.IsSHSZIndex(this.Symbol)&&(f=0),l<u[f]&&(l=u[f],n=this.YClose+l*(h-1)/2,e=this.YClose-l*(h-1)/2);for(var C=0;C<h;++C){var D=e+l*C,v=new Ht;this.Frame.HorizontalInfo[C]=v,v.Value=D;var S=D.toFixed(f);if(this.IsShowLeftText&&(v.Message[0]=S),c.IsNumber(this.YClose)){var T=(D/this.YClose-1)*100;T>0?v.TextColor=m.UpTextColor:T<0&&(v.TextColor=m.DownTextColor),this.IsShowRightText&&(this.RightTextFormat==1?v.Message[1]=S:v.Message[1]=c.FormatValueString(T,2)+"%"),Math.abs(D-this.YClose)<1e-11&&(v.LineType=2,v.TextColor=m.UnchagneTextColor,m.FrameDotSplitPen&&(v.LineColor=m.FrameDotSplitPen))}}this.Frame.HorizontalMax=n,this.Frame.HorizontalMin=e}}function zo(){this.newMethod=c,this.newMethod(),delete this.newMethod,this.ShowText=!0,this.Symbol=null,this.DayCount=1,this.DateFormat=0,this.Operator=function(){this.Frame.VerticalInfo=[],this.Frame.XPointCount;var r=this.Frame.ChartBorder.GetWidth(),n=this.Frame.IsHScreen===!0;n&&(r=this.Frame.ChartBorder.GetHeight()),r=r/V();var e=Zh,t=e.GetCoordinateData(this.Symbol,r),a=t.Count,s=t.MiddleCount>0?t.MiddleCount:parseInt(a/2),o=t.Data;if(this.Frame.XPointCount=a*this.DayCount,this.Frame.MinuteCount=a,this.Frame.VerticalInfo=[],this.Frame.GlobalOption){var h=this.Frame.GlobalOption;c.IsNumber(h.XDateFormat)&&(this.DateFormat=h.XDateFormat)}if(this.DayCount<=1){this.DayOffset.DataOffset=0,this.DayOffset.ShowDataCount=a,this.DayOffset.PageInfo=null;for(var l=0;l<o.length;++l){var u=new Ht,h=o[l];m.Minute.FrameSplitTextColor&&(u.TextColor=m.Minute.FrameSplitTextColor),u.Value=h[0],this.ShowText&&(u.Message[0]=h[3]),h[4]&&(u.LineColor=h[4]),this.Frame.VerticalInfo[l]=u}}else{var f=0,C=this.DayData.length;this.DayOffset&&(c.IsNumber(this.DayOffset.Offset)&&(f=this.DayOffset.Offset),c.IsNumber(this.DayOffset.ShowDayCount)&&(C=this.DayOffset.ShowDayCount)),this.DayOffset.DataOffset=f*a,this.DayOffset.ShowDataCount=this.DayOffset.ShowDayCount*a,this.DayOffset.PageInfo={Day:[]};for(var l=this.DayData.length-1-f,D=0;l>=0&&D<C;--l,++D){var u=new Ht;u.Value=D*a+s,u.LineType=-1,this.ShowText&&(u.Message[0]=this.FormatDate(this.DayData[l].Date),u.BG={Index:{Start:D*a+1,End:(D+1)*a-1},Date:this.DayData[l].Date}),this.Frame.VerticalInfo.push(u);var u=new Ht;u.Value=(D+1)*a,this.Frame.VerticalInfo.push(u),this.DayOffset.PageInfo.Day.push({Date:this.DayData[l].Date,Index:l})}}if(this.GetEventCallback){var v=this.GetEventCallback(et.ON_SPLIT_XCOORDINATE);if(v&&v.Callback){var S={ID:this.Frame.Identify,Frame:this.Frame};v.Callback(v,S,this)}}},this.FormatDate=function(r){switch(this.DateFormat){case 1:return c.FormatDateString(r,"MM/DD");case 2:return c.FormatDateString(r,"MM/DD/W");default:return c.FormatDateString(r,"MM-DD")}}}function Nd(){this.newMethod=c,this.newMethod(),delete this.newMethod,this.ShowText=!0,this.Symbol,this.MinTextDistance=50*V(),this.MinBarDistance=5,this.Operator=function(){if(!(this.Frame.Data==null||this.Frame.XData==null)){this.Frame.VerticalInfo=[];for(var r=this.Frame.Data.DataOffset,n=this.Frame.XPointCount,e=0,t=r;e<n&&t<this.Frame.Data.Data.length;++e,++t){var a=new Ht;a.Value=t-r,this.ShowText&&(a.Message[0]=this.Frame.XData[e]),this.Frame.VerticalInfo.push(a),distance=0}}}}function Od(){this.newMethod=c,this.newMethod(),delete this.newMethod,this.ShowText=!0,this.SplitCount=3,this.Symbol,this.LineType=3,this.Operator=function(){var r=this.Frame.VerticalRange;if(r){this.Frame.VerticalInfo=[];var n=2;this.Symbol&&(n=fe(this.Symbol));var e=r.Max,t=r.Min;if(r.Bid)for(var a=(r.Bid.Max-t)/this.SplitCount,s=0;s<this.SplitCount;++s){var o=new Ht;o.Value=t+a*s,!(o.Value<=0)&&(c.IsNumber(this.LineType)&&(o.LineType=this.LineType),this.ShowText&&(o.Message[0]=o.Value.toFixed(n)),this.Frame.VerticalInfo.push(o))}var o=new Ht;if(o.Value=r.Center,this.Frame.VerticalInfo.push(o),r.Ask)for(var a=(e-r.Ask.Min)/this.SplitCount,s=1;s<=this.SplitCount;++s){var o=new Ht;o.Value=r.Ask.Min+a*s,c.IsNumber(this.LineType)&&(o.LineType=this.LineType),this.ShowText&&(o.Message[0]=o.Value.toFixed(n)),this.Frame.VerticalInfo.push(o)}if(this.GetEventCallback){var h=this.GetEventCallback(et.ON_SPLIT_XCOORDINATE);if(h&&h.Callback){var l={ID:this.Frame.Identify,Frame:this.Frame};h.Callback(h,l,this)}}}}}function Zo(){this.Frame,this.Value,this.Point,this.ClientPos,this.BeforOpeneData,this.AfterCloseData,this.X,this.Item,this.DataIndex,this.DayIndex,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.DayOffset,this.Operator=function(){return this.Item=null,this.DataIndex=null,this.DayIndex=null,this.ClientPos==2?this.GetBeforeOpenXIndex():this.ClientPos==3?this.GetAfterCloseXIndex():this.ClientPos>=200&&this.ClientPos<=299?this.GetMultiDayBeforeOpenXIndex():this.ClientPos>=300&&this.ClientPos<=399?this.GetMultiDayAfterCloseXIndex():!1},this.GetBeforeOpenXIndex=function(){if(!c.IsNumber(this.Value)||!this.BeforeOpenData||!this.BeforeOpenData.Data)return!1;var r=this.Frame.GetLeftExtendXData(this.Value,this.BeforeOpenData);if(r=parseInt(r.toFixed(0)),r>=0&&r<this.BeforeOpenData.Data.length){var n=this.BeforeOpenData.Data[r];if(c.IsNumber(n.Price))return this.Item=n,this.X=this.Value,this.DataIndex=r,!0}r<0?r=0:r>=this.BeforeOpenData.Data.length&&(r=this.BeforeOpenData.Data.length-1);for(var e=-1,t=r;t>=0;--t){var n=this.BeforeOpenData.Data[t];if(c.IsNumber(n.Price)){e=t;break}}if(e<0)for(var t=r+1;t<this.BeforeOpenData.Data.length;++t){var n=this.BeforeOpenData.Data[t];if(c.IsNumber(n.Price)){e=t;break}}return e<0?!1:(this.Item=n,this.DataIndex=e,this.X=this.Frame.GetLeftExtendXFromIndex(e,this.BeforeOpenData),!0)},this.GetMultiDayBeforeOpenData=function(){if(!this.MultiDayBeforeOpenData||!c.IsNonEmptyArray(this.MultiDayBeforeOpenData)||(this.DayOffset||this.MultiDayBeforeOpenData,!c.IsNumber(this.DayOffset.Offset)||!c.IsNumber(this.DayOffset.ShowDayCount)))return null;var r=this.DayOffset.ShowDayCount,n=this.DayOffset.Offset,e=this.MultiDayBeforeOpenData.slice(n,n+r);return e},this.GetMultiDayBeforeOpenXIndex=function(){var r=this.GetMultiDayBeforeOpenData();if(!r||!c.IsNonEmptyArray(r))return!1;var a=this.ClientPos-200;if(a<0||a>=r.length)return!1;var n=r[a],e=this.Frame.GetLeftExtendXData(this.Value,r);if(!e||!c.IsNumber(e.DataIndex))return!1;var t=parseInt(e.DataIndex.toFixed(0)),a=e.DayIndex;if(t>=0&&t<n.Data.length){var s=n.Data[t];if(c.IsNumber(s.Price))return this.Item=s,this.X=this.Value,this.DataIndex=t,this.DayIndex=a,!0}t<0?t=0:t>=n.Data.length&&(t=n.Data.length-1);for(var o=-1,h=t;h>=0;--h){var s=n.Data[h];if(s&&c.IsNumber(s.Price)){o=h;break}}return o<0?!1:(this.Item=s,this.DataIndex=o,this.DayIndex=a,this.X=this.Frame.GetLeftExtendXFromIndex(o,n),!0)},this.GetAfterCloseXIndex=function(){if(!c.IsNumber(this.Value)||!this.AfterCloseData||!this.AfterCloseData.Data)return!1;var r=this.Frame.GetRightExtendXData(this.Value,this.AfterCloseData);if(r=parseInt(r.toFixed(0)),r>=0&&r<this.AfterCloseData.Data.length){var n=this.AfterCloseData.Data[r];if(c.IsNumber(n.Price))return this.Item=n,this.X=this.Value,this.DataIndex=r,!0}r<0?r=0:r>=this.AfterCloseData.Data.length&&(r=this.AfterCloseData.Data.length-1);for(var e=-1,t=r;t>=0;--t){var n=this.AfterCloseData.Data[t];if(c.IsNumber(n.Price)){e=t;break}}if(e<0)for(var t=r+1;t<this.AfterCloseData.Data.length;++t){var n=this.AfterCloseData.Data[t];if(c.IsNumber(n.Price)){e=t;break}}return e<0?!1:(this.Item=n,this.DataIndex=e,this.X=this.Frame.GetRightExtendXFromIndex(e,this.AfterCloseData),!0)},this.GetMultiDayAfterCloseData=function(){if(!this.MultiDayAfterCloseData||!c.IsNonEmptyArray(this.MultiDayAfterCloseData)||(this.DayOffset||this.MultiDayAfterCloseData,!c.IsNumber(this.DayOffset.Offset)||!c.IsNumber(this.DayOffset.ShowDayCount)))return null;var r=this.DayOffset.ShowDayCount,n=this.DayOffset.Offset,e=this.MultiDayAfterCloseData.slice(n,n+r);return e},this.GetMultiDayAfterCloseXIndex=function(){var r=this.GetMultiDayAfterCloseData();if(!(!r||!c.IsNonEmptyArray(r))){var a=this.ClientPos-300;if(!(a<0||a>=r.length)){var n=r[a],e=this.Frame.GetRightExtendXData(this.Value,r);if(e){var t=parseInt(e.DataIndex.toFixed(0)),a=e.DayIndex;if(t>=0&&t<n.Data.length){var s=n.Data[t];if(c.IsNumber(s.Price))return this.Item=s,this.X=this.Value,this.DataIndex=t,this.DayIndex=a,!0}t<0?t=0:t>=n.Data.length&&(t=n.Data.length-1);for(var o=-1,h=t;h>=0;--h){var s=n.Data[h];if(s&&c.IsNumber(s.Price)){o=h;break}}return o<0?!1:(this.Item=s,this.DataIndex=o,this.DayIndex=a,this.X=this.Frame.GetRightExtendXFromIndex(o,n),!0)}}}}}function gs(){this.ClassName="ChartCorssCursor",this.Frame,this.Canvas,this.HPenColor=m.CorssCursorHPenColor,this.HPenType=0,this.VPenColor=m.CorssCursorVPenColor,this.VPenType=0,this.VLineType=0,this.Font=m.CorssCursorTextFont,this.TextColor=m.CorssCursorTextColor,this.TextBGColor=m.CorssCursorBGColor,this.BorderColor=m.CorssCursorBorderColor,this.XRangeBGColor=m.CorssCursorXRangeBGColor,this.TextHeight=20,this.LastPoint,this.CursorIndex,this.IsOnlyDrawKLine=!1,this.IsOnlyDrawMinute=!1,this.IsFixXLastTime=!1,this.IsDrawXRangeBG=!1,this.PointX,this.PointY,this.StringFormatX,this.StringFormatY,this.ShowTextMode={Left:1,Right:1,Bottom:1},this.TextFormat={Right:0},this.IsShowCorss=!0,this.IsShow=!0,this.IsShowClose=!1,this.ClientPos=-1,this.CallAcutionXOperator,this.RightButton={Enable:!1,Rect:null,BGColor:m.CorssCursor.RightButton.BGColor,PenColor:m.CorssCursor.RightButton.PenColor,Icon:m.CorssCursor.RightButton.Icon},this.Close=null,this.Status=0,this.ReloadResource=function(r){this.Font=m.CorssCursorTextFont,this.HPenColor=m.CorssCursorHPenColor,this.VPenColor=m.CorssCursorVPenColor,this.TextColor=m.CorssCursorTextColor,this.TextBGColor=m.CorssCursorBGColor,this.BorderColor=m.CorssCursorBorderColor,this.XRangeBGColor=m.CorssCursorXRangeBGColor},this.GetCloseYPoint=function(r){if(!this.StringFormatX.Data)return null;var n=this.StringFormatX.Data;if(!n.Data||n.Data.length<=0)return null;var e=n.DataOffset+r;if(e>=n.Data.length&&(e=n.Data.length-1),e<0)return null;var t=n.Data[e];if(!t)return null;this.Close=t.Close;var a=this.Frame.GetYFromData(this.Close);return a},this.GetMinuteCloseYPoint=function(r){if(!c.IsNumber(r)||(r=parseInt(r),!this.StringFormatX.Data))return null;var n=this.StringFormatX.Data;if(!n.Data||n.Data.length<=0)return null;var e=n.DataOffset+r;if(e>=n.Data.length&&(e=n.Data.length-1),e<0)return null;var t=n.Data[e];if(!c.IsNumber(r))return null;this.Close=t;var a=this.Frame.GetYFromData(this.Close);return a},this.GetDateTimeRange=function(r,n){if(!c.IsNumber(r))return null;r=parseInt(r);var e=this.StringFormatX.Data;if(!e.Data||e.Data.length<=0)return null;var t=e.DataOffset+r;if(t>=e.Data.length||t<0||!this.Frame||!this.Frame.SubFrame[0]||!this.Frame.SubFrame[0].Frame)return null;var a=this.Frame.SubFrame[0].Frame,s=a.DataWidth,o=a.DistanceWidth,h=a.XPointCount,l=e.Data[t];if(!l)return null;for(var u=l.Date*1e6,f=parseInt(l.Time/100)*100,C=u+f,D=u+f+59,v=t,S=t;S<e.Data.length;++S){var T=e.Data[S],I=T.Date*1e6+T.Time;if(I>D||S-e.DataOffset>=h)break;v=S}for(var F=t,S=t;S>=0&&S>=e.DataOffset;--S){var T=e.Data[S],I=T.Date*1e6+T.Time;if(I<C)break;F=S}var E={StartIndex:F,EndIndex:v};return E.XStart=this.Frame.GetXFromIndex(F-e.DataOffset),E.XEnd=this.Frame.GetXFromIndex(v-e.DataOffset),E.XStart-=(o+s)/2,E.XEnd+=(o+s)/2,E},this.FixMinuteLastTimeXPoint=function(r){if(!c.IsNumber(r)||(r=parseInt(r),!this.StringFormatX.Data))return null;var n=this.StringFormatX.Data;if(!n.Data||n.Data.length<=0)return null;var e=n.DataOffset+r;if(e<n.Data.length)return null;e=n.Data.length-1,e-=n.DataOffset;var t=this.Frame.GetXFromIndex(e);return{X:t,Index:e}},this.PtInClient=function(r,n){if(this.Canvas.beginPath(),this.Frame.IsHScreen===!0){var e=this.Frame.ChartBorder.GetHScreenBorder();this.Canvas.rect(e.Left,e.TopEx,e.Right-e.Left,e.BottomEx-e.TopEx)}else{var e=this.Frame.ChartBorder.GetBorder();this.Canvas.rect(e.LeftEx,e.Top,e.RightEx-e.LeftEx,e.Bottom-e.Top)}return this.Canvas.isPointInPath(r,n)?1:this.Frame.ChartBorder.LeftExtendWidth>10&&(this.Canvas.beginPath(),this.Frame.IsHScreen===!0?this.Canvas.rect(e.Left,e.Top,e.Right-e.Left,e.TopEx-e.Top):this.Canvas.rect(e.Left,e.Top,e.LeftEx-e.Left,e.Bottom-e.Top),this.Canvas.isPointInPath(r,n))?2:this.Frame.ChartBorder.RightExtendWidth>10&&(this.Canvas.beginPath(),this.Frame.IsHScreen===!0?this.Canvas.rect(e.Left,e.BottomEx,e.Right-e.Left,e.Bottom-e.BottomEx):this.Canvas.rect(e.RightEx,e.Top,e.Right-e.RightEx,e.Bottom-e.Top),this.Canvas.isPointInPath(r,n))?3:-1},this.GetFontHeight=function(r){return Aa(this.Canvas,r,"擎")},this.Draw=function(){if(this.Status=0,this.RightButton.Rect=null,!!this.LastPoint){this.Close=null;var r=this.LastPoint.X,n=this.LastPoint.Y,e=this.PtInClient(r,n);if(this.PointY=null,this.PointY==null,this.ClientPos=e,!(e<=0)){if(this.Frame.IsHScreen===!0){this.HScreenDraw();return}var t=this.Frame.ChartBorder.GetBorder(),a=t.Left,s=t.Right,o=t.TopTitle,h=t.Bottom,l=this.Frame.ChartBorder.Right,u=t.ChartWidth;if(this.IsOnlyDrawKLine){if(r=this.Frame.GetXFromIndex(this.CursorIndex),this.IsShowClose){var f=this.GetCloseYPoint(this.CursorIndex);f!=null&&(n=f)}}else if(this.IsOnlyDrawMinute){var f=this.GetMinuteCloseYPoint(this.CursorIndex);f!=null&&(n=f)}if(this.CallAcutionXOperator&&(this.CallAcutionXOperator.Value=r,this.CallAcutionXOperator.Point={X:r,Y:n},this.CallAcutionXOperator.ClientPos=e,this.CallAcutionXOperator.Operator()&&(r=this.CallAcutionXOperator.X)),this.IsFixXLastTime){var C=this.FixMinuteLastTimeXPoint(this.CursorIndex);C&&(r=C.X,this.CursorIndex=C.Index)}if(this.PointY=[[a,n],[s,n]],this.PointX=[[r,o],[r,h]],this.IsShowCorss){var D=null;this.IsDrawXRangeBG&&(D=this.GetDateTimeRange(this.CursorIndex));var v=V();if((this.HPenType==1||this.HPenType==0)&&(this.Canvas.strokeStyle=this.HPenColor,this.HPenType==0&&this.Canvas.setLineDash([3*v,2*v]),this.Canvas.beginPath(),this.Canvas.moveTo(a,L(n)),this.Canvas.lineTo(s,L(n)),this.Canvas.stroke(),this.HPenType==0&&this.Canvas.setLineDash([])),this.Canvas.save(),this.Canvas.strokeStyle=this.VPenColor,this.VPenType==0)this.Canvas.setLineDash([3*v,2*v]);else if(this.VPenType==2){var S=this.Frame.SubFrame[0].Frame.DataWidth;S>2*v&&(this.Canvas.lineWidth=S)}if(this.Canvas.beginPath(),this.VLineType==1)D&&(this.Canvas.fillStyle=this.XRangeBGColor,this.Canvas.fillRect(D.XStart,t.Top,D.XEnd-D.XStart,t.Bottom-t.Top)),this.Canvas.moveTo(L(r),t.Top),this.Canvas.lineTo(L(r),t.Bottom);else if(this.Frame.SubFrame.length>0)for(var T in this.Frame.SubFrame){var I=this.Frame.SubFrame[T].Frame,F=I.ChartBorder.GetBorder();o=F.TopTitle,h=F.Bottom,D&&(this.Canvas.fillStyle=this.XRangeBGColor,this.Canvas.fillRect(D.XStart,o,D.XEnd-D.XStart,h-o)),this.Canvas.moveTo(L(r),o),this.Canvas.lineTo(L(r),h)}else this.Canvas.moveTo(L(r),o),this.Canvas.lineTo(L(r),h);this.Canvas.stroke(),this.Canvas.restore()}this.Frame.GetXData(r);var E={},M=this.Frame.GetYData(n,E);(this.IsOnlyDrawMinute||this.IsShowClose)&&this.Close!=null&&(M=this.Close),this.StringFormatX.Value=this.CursorIndex,this.StringFormatX.Point={X:r,Y:n},this.StringFormatX.ClientPos=e,this.StringFormatY.Value=M,this.StringFormatY.RValue=E.RightYValue,this.StringFormatY.FrameID=E.FrameID,this.StringFormatY.Point={X:r,Y:n},this.StringFormatY.ClientPos=e,this.Canvas.font=this.Font;var O=this.GetFontHeight();if(O>this.TextHeight&&(this.TextHeight=O),(this.ShowTextMode.Left==1&&this.Frame.ChartBorder.Left>=30||this.ShowTextMode.Left==2||this.ShowTextMode.Right==1&&this.Frame.ChartBorder.Right>=30||this.ShowTextMode.Right==2)&&this.StringFormatY.Operator()){var R=this.StringFormatY.Text;this.Canvas.font=this.Font;var b=this.Canvas.measureText(R).width+4,p={Y:n,YValue:M,FrameID:E.FrameID};if(this.Frame.ChartBorder.Left>=30&&this.ShowTextMode.Left==1?a<b?(this.DrawTextBGRect(L(2),L(n-this.TextHeight/2),B(b),B(this.TextHeight)),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(R,2+2,n,b)):(this.DrawTextBGRect(a-2,n-this.TextHeight/2,-b,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(R,a-4,n,b)):this.ShowTextMode.Left==2&&(this.DrawTextBGRect(a,n-this.TextHeight/2,b,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(R,a+2,n,b)),this.StringFormatY.PercentageText&&this.TextFormat.Right==0&&(R=this.StringFormatY.PercentageText+"%",b=this.Canvas.measureText(R).width+4),this.StringFormatY.RText){R=this.StringFormatY.RText;var b=this.Canvas.measureText(R).width+4}var G=null;if(this.StringFormatY.RComplexText&&c.IsNonEmptyArray(this.StringFormatY.RComplexText.Text)){var b=0;G=this.StringFormatY.RComplexText;for(var T=0;T<G.Text.length;++T){var Y=G.Text[T],Q=this.Canvas.measureText(Y.Text).width+4;T>0&&c.IsNumber(G.Space)&&(b+=G.Space),b+=Q}}if(this.Frame.ChartBorder.Right>=30&&this.ShowTextMode.Right==1){var ht=!1,Ct=null;if(E.FrameID>=0){var I=this.Frame.SubFrame[E.FrameID];ht=I.OverlayIndex.length>0,Ct=I.Interval}if(ht&&b>Ct){var lt=s+Ct;lt>u&&(lt=u);var dt=lt-2-b;this.DrawTextBGRect(dt,n-this.TextHeight/2,b,this.TextHeight),G?this.DrawComplexText(dt,n,G):(this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(R,lt-4,n,b))}else if(l<b){var dt=u-2-b;this.DrawTextBGRect(dt,n-this.TextHeight/2,b,this.TextHeight),G?this.DrawComplexText(dt,n,G):(this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(R,u-4,n,b)),this.RightButton.Enable&&this.DrawRightButton(n-this.TextHeight/2,u-2-b,this.TextHeight,this.TextHeight,p)}else{var dt=s+2;this.DrawTextBGRect(dt,n-this.TextHeight/2,b,this.TextHeight),G?this.DrawComplexText(dt,n,G):(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(R,s+4,n,b)),this.RightButton.Enable&&this.DrawRightButton(n-this.TextHeight/2,s+2,this.TextHeight,this.TextHeight,p)}if(this.StringFormatY.RExtendText&&this.StringFormatY.RExtendText.length>0){var Ut=0;for(var T in this.StringFormatY.RExtendText){var Y=this.StringFormatY.RExtendText[T],Wt="--.--";Y.YText?Wt=Y.YText:c.IsNumber(Y.Y)&&(Wt=Y.Y.toFixed(0));var Qt=this.Canvas.measureText(Wt).width+4;l<Qt?(this.DrawTextBGRect(u-2-Qt,n+Ut+this.TextHeight/2,Qt,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=Y.TextColor,this.Canvas.fillText(Wt,u-4,n+Ut+this.TextHeight,Qt)):(this.DrawTextBGRect(s+2,n+Ut+this.TextHeight/2,Qt,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=Y.TextColor,this.Canvas.fillText(Wt,s+4,n+Ut+this.TextHeight,Qt)),Ut+=this.TextHeight}}}else if(this.ShowTextMode.Right==2){this.Canvas.fillStyle=this.TextBGColor;var ye=s-b;this.DrawTextBGRect(ye,n-this.TextHeight/2,b,this.TextHeight),G?this.DrawComplexText(ye,n,G):(this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(R,ye+2,n,b)),this.RightButton.Enable&&this.DrawRightButton(n-this.TextHeight/2,ye,this.TextHeight,this.TextHeight,p)}}if((this.ShowTextMode.Bottom==1||this.ShowTextMode.Bottom==2||this.ShowTextMode.Bottom==10)&&this.StringFormatX.Operator()){var R=this.StringFormatX.Text;this.Canvas.font=this.Font,this.Canvas.fillStyle=this.TextBGColor;var b=this.Canvas.measureText(R).width+4,Ne=h+2+this.TextHeight/2,Kt=h+2;if(this.ShowTextMode.Bottom==2)Ne=h-this.TextHeight/2-2,Kt=h-this.TextHeight-2;else if(this.ShowTextMode.Bottom==10){var I=this.Frame.SubFrame[0].Frame;if(I.GetCorssCursorTop){var C=I.GetCorssCursorTop();c.IsNumber(C)&&(Ne=C+this.TextHeight/2,Kt=C)}}r-b/2<3?(this.DrawTextBGRect(r-1,Kt,b,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(R,r+1,Ne,b)):r+b/2>=s?(this.DrawTextBGRect(s-b,Kt,b,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(R,s-2,Ne,b)):(this.DrawTextBGRect(r-b/2,Kt,b,this.TextHeight),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(R,r,Ne,b))}if(E.FrameID>=0){var I=this.Frame.SubFrame[E.FrameID],Oe=!1;this.Frame.AutoRightBorder&&(Oe=!0);var Ce=s;Oe&&(Ce=s+this.Frame.AuotRightWidth),this.Canvas.font=this.Font;for(var T in I.OverlayIndex){var Y=I.OverlayIndex[T];if(Y.Frame.IsShow!==!1){if(Oe||(Ce+=I.Interval),Ce+30>u)break;for(var M=Y.Frame.GetYData(n),T=2;T>=0;--T){var R=c.FormatValueString(M,T),b=this.Canvas.measureText(R).width+4;if(b<I.Interval)break}this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(Ce+2,n-this.TextHeight/2,b,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(R,Ce+4,n,b),Oe&&(Ce+=Y.RightWidth.Width)}}}this.Status=1}}},this.DrawComplexText=function(r,n,e){this.Canvas.textAlign="left",this.Canvas.textBaseline="middle";for(var t=r+2,a=0;a<e.Text.length;++a){var s=e.Text[a],o=this.Canvas.measureText(s.Text).width+4;s.Color?this.Canvas.fillStyle=s.Color:is.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(s.Text,t,n,o),a>0&&c.IsNumber(e.Space)&&(t+=e.Space),t+=o}},this.DrawRightButton=function(r,n,e,t,a){this.Canvas.fillStyle=this.RightButton.BGColor;var s={Left:n-e,Top:r,Width:e,Height:t};this.RightButton.Rect=s,this.RightButton.Data=a,this.Canvas.fillRect(L(s.Left+1),L(s.Top),B(s.Width),B(s.Height));var o=V(),h=3,l=s.Top+h+(s.Height-h*2)/2,u=s.Left+h+(s.Width-h*2)/2;if(this.RightButton.Icon){var f=this.RightButton.Icon;this.Canvas.font=f.Size*o+"px "+f.Family,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=f.Color,this.Canvas.fillText("",u,l)}else{this.Canvas.strokeStyle=this.RightButton.PenColor;var C=s.Left+h,D=s.Top+h;this.Canvas.save(),this.Canvas.linewidth=1*o,this.Canvas.beginPath(),this.Canvas.moveTo(L(C),L(l)),this.Canvas.lineTo(L(C+s.Width-h*2),L(l)),this.Canvas.moveTo(L(u),L(D)),this.Canvas.lineTo(L(u),L(D+s.Height-h*2)),this.Canvas.stroke(),this.Canvas.restore()}},this.PtInButton=function(r,n){if(!this.RightButton.Enable||!this.RightButton.Rect)return null;var e=this.RightButton.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(e.Left,e.Top,e.Width,e.Height),this.Canvas.isPointInPath(r,n))return{Data:this.RightButton.Data,Rect:e}},this.DrawTextBGRect=function(r,n,e,t){this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(L(r),L(n),B(e),B(t)),this.BorderColor&&(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(L(r),L(n),B(e),B(t)))},this.HScreenDraw=function(){var r=this.LastPoint.X,n=this.LastPoint.Y;this.IsOnlyDrawKLine&&(n=this.Frame.GetXFromIndex(this.CursorIndex));var e=this.Frame.ChartBorder.GetHScreenBorder(),t=e.Left,a=e.Right,s=e.Top,o=e.Bottom,h=this.Frame.ChartBorder.Bottom;if(this.CallAcutionXOperator&&(this.CallAcutionXOperator.Value=n,this.CallAcutionXOperator.Point={X:r,Y:n},this.CallAcutionXOperator.ClientPos=this.ClientPos,this.CallAcutionXOperator.Operator()&&(n=this.CallAcutionXOperator.X)),this.PointY=[[t,n],[a,n]],this.PointX=[[r,s],[r,o]],this.IsShowCorss){var l=V();if(this.Canvas.save(),this.Canvas.strokeStyle=this.HPenColor,this.HPenType==0&&this.Canvas.setLineDash([3*l,2*l]),this.Canvas.beginPath(),this.Canvas.moveTo(L(r),s),this.Canvas.lineTo(L(r),o),this.Canvas.stroke(),this.Canvas.restore(),this.Canvas.save(),this.Canvas.strokeStyle=this.VPenColor,this.VPenType==0)this.Canvas.setLineDash([3*l,2*l]);else if(this.VPenType==2){var u=this.Frame.SubFrame[0].Frame.DataWidth;u>2*l&&(this.Canvas.lineWidth=u)}if(this.Canvas.beginPath(),this.VLineType==1)this.Canvas.moveTo(t,L(n)),this.Canvas.lineTo(a,L(n));else if(this.Frame.SubFrame.length>0)for(var f in this.Frame.SubFrame){var C=this.Frame.SubFrame[f].Frame,D=C.ChartBorder.GetHScreenBorder();this.Canvas.moveTo(D.Left,L(n)),this.Canvas.lineTo(D.RightEx,L(n))}else this.Canvas.moveTo(t,L(n)),this.Canvas.lineTo(a,L(n));this.Canvas.stroke(),this.Canvas.restore()}var v=this.Frame.GetXData(n),S={},T=this.Frame.GetYData(r,S);this.StringFormatX.Value=v,this.StringFormatX.Point={X:r,Y:n},this.StringFormatX.ClientPos=this.ClientPos,this.StringFormatY.Value=T,this.StringFormatY.FrameID=S.FrameID,this.StringFormatY.Point={X:r,Y:n},this.StringFormatY.ClientPos=this.ClientPos,this.Canvas.font=this.Font;var I=this.GetFontHeight();if(I>this.TextHeight&&(this.TextHeight=I),(this.ShowTextMode.Left==1&&this.Frame.ChartBorder.Top>=30||this.ShowTextMode.Left==2||this.ShowTextMode.Right==1&&this.Frame.ChartBorder.Bottom>=30||this.ShowTextMode.Right==2)&&this.StringFormatY.Operator()){var F=this.StringFormatY.Text;this.Canvas.font=this.Font;var E=this.Canvas.measureText(F).width+4;if(this.Frame.ChartBorder.Top>=30&&this.ShowTextMode.Left==1){var M=r,O=s;this.Canvas.save(),this.Canvas.translate(M,O),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,s>=E?(this.Canvas.fillRect(0,-(this.TextHeight/2),-E,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(F,-2,0,E)):(this.Canvas.fillRect(E-s,-(this.TextHeight/2),-E,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(F,E-s-2,0,E)),this.Canvas.restore()}else if(this.ShowTextMode.Left==2){var M=r,O=s;this.Canvas.save(),this.Canvas.translate(M,O),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(0,-(this.TextHeight/2),E,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(F,2,0,E),this.Canvas.restore()}if(this.StringFormatY.RText){F=this.StringFormatY.RText;var E=this.Canvas.measureText(F).width+4}if(this.Frame.ChartBorder.Bottom>=30&&this.ShowTextMode.Right==1){var M=r,O=o;if(this.Canvas.save(),this.Canvas.translate(M,O),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,h>E?(this.Canvas.fillRect(0,-(this.TextHeight/2),E,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(F,2,0,E)):(this.Canvas.fillRect(h-E,-(this.TextHeight/2),E,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(F,h-E+2,0,E)),this.StringFormatY.RExtendText&&this.StringFormatY.RExtendText.length>0){var R=0;for(var f in this.StringFormatY.RExtendText){var b=this.StringFormatY.RExtendText[f],p="--.--";b.YText?p=b.YText:c.IsNumber(b.Y)&&(p=b.Y.toFixed(0));var G=this.Canvas.measureText(p).width+4;if(this.Canvas.fillStyle=b.TextBGColor,h>G)this.Canvas.fillRect(0,R+this.TextHeight/2,G,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=b.TextColor,this.Canvas.fillText(p,2,R+this.TextHeight,G);else{var Y=h-G;this.Canvas.fillRect(Y,R+this.TextHeight/2,G,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=b.TextColor,this.Canvas.fillText(p,Y+2,R+this.TextHeight,G)}R+=this.TextHeight}}this.Canvas.restore()}else if(this.ShowTextMode.Right==2){var M=r,O=o;this.Canvas.save(),this.Canvas.translate(M,O),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextBGColor,this.Canvas.fillRect(0,-(this.TextHeight/2),-E,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(F,-2,0,E),this.Canvas.restore()}}if((this.ShowTextMode.Bottom===1||this.ShowTextMode.Bottom==10)&&this.StringFormatX.Operator()){var F=this.StringFormatX.Text;this.Canvas.font=this.Font,this.Canvas.fillStyle=this.TextBGColor;var E=this.Canvas.measureText(F).width+4,M=t;if(this.ShowTextMode.Bottom==10){var C=this.Frame.SubFrame[0].Frame;if(C.GetCorssCursorTop){var Q=C.GetCorssCursorTop();c.IsNumber(Q)&&(M=Q)}}if(n-E/2<3){var O=n;this.Canvas.save(),this.Canvas.translate(M,O),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillRect(0,0,E,this.TextHeight),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(F,2,this.TextHeight/2,E),this.Canvas.restore()}else if(n+E/2>=o){var O=n;this.Canvas.save(),this.Canvas.translate(M,O),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillRect(-E,0,E,this.TextHeight),this.Canvas.textAlign="right",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(F,-2,this.TextHeight/2,E),this.Canvas.restore()}else{var O=n;this.Canvas.save(),this.Canvas.translate(M,O),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillRect(-E/2,0,E,this.TextHeight),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(F,0,this.TextHeight/2,E),this.Canvas.restore()}}this.Status=1}}function Rd(){this.Frame,this.HQChart,this.Canvas,this.Data,this.Symbol,this.HPenType=0,this.VPenType=0,this.LineDash=m.DepthCorss.LineDash,this.IsShowTooltip=!0,this.AskColor=m.DepthCorss.AskColor.Line,this.BidColor=m.DepthCorss.BidColor.Line,this.LineWidth=m.DepthCorss.LineWidth,this.ClassName="DepthChartCorssCursor",this.Tooltip={Border:{Top:m.DepthCorss.Tooltip.Border.Top,Left:m.DepthCorss.Tooltip.Border.Left,Right:m.DepthCorss.Tooltip.Border.Right,Bottom:m.DepthCorss.Tooltip.Border.Bottom,ItemSpace:m.DepthCorss.Tooltip.Border.ItemSpace},Font:m.DepthCorss.Tooltip.Font,TextColor:m.DepthCorss.Tooltip.TextColor,BGColor:m.DepthCorss.Tooltip.BGColor},this.Font=m.CorssCursorTextFont,this.TextColor=m.CorssCursorTextColor,this.TextBGColor=m.CorssCursorBGColor,this.TextHeight=20,this.LastPoint,this.PointX,this.PointY,this.StringFormatX,this.StringFormatY,this.IsShowCorss=!0,this.IsShow=!0,this.GetVol=function(r,n){if(!this.Data)return null;var e=n?this.Data.Asks:this.Data.Bids;if(!e||!Array.isArray(e)||e.length<=0)return null;for(var t in e){var a=e[t];if(a.Price==r)return a.Vol}return null},this.Draw=function(){if(this.Status=0,!!this.LastPoint&&this.Data&&this.IsShow){var r=this.LastPoint.X,n=this.LastPoint.Y,e=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),e=this.Canvas.isPointInPath(r,n),this.PointY=null,this.PointY==null,!!e&&this.Frame.IsHScreen!==!0){var t=this.Frame.ChartBorder.GetLeft(),a=this.Frame.ChartBorder.GetRight(),s=this.Frame.ChartBorder.GetTopTitle(),o=this.Frame.ChartBorder.GetBottom();this.Frame.ChartBorder.Right,this.Frame.ChartBorder.GetChartWidth();var h=this.Frame.GetXData(r),l=this.Frame.GetXFromPrice(h);if(l){var u=this.GetVol(l.Price,l.IsAsk);if(n=this.Frame.GetYFromData(u),l.Vol=u,l.Y=n,this.PointY=[[t,n],[a,n]],this.PointX=[[r,s],[r,o]],this.IsShowCorss){l.IsAsk?this.Canvas.strokeStyle=this.AskColor:this.Canvas.strokeStyle=this.BidColor;var f=this.Canvas.lineWidth,C=V();this.Canvas.lineWidth=this.LineWidth*C;var D=this.Canvas.lineWidth;if(this.HPenType==1||this.HPenType==0){this.HPenType==0&&this.Canvas.setLineDash(this.LineDash);var v=he(D,n);this.Canvas.beginPath(),this.Canvas.moveTo(t,v),this.Canvas.lineTo(a,v),this.Canvas.stroke(),this.HPenType==0&&this.Canvas.setLineDash([])}this.VPenType==0&&this.Canvas.setLineDash(this.LineDash);var S=he(D,l.X);this.Canvas.beginPath(),this.Canvas.moveTo(S,s),this.Canvas.lineTo(S,o),this.Canvas.stroke(),this.VPenType==0&&this.Canvas.setLineDash([]),this.Canvas.lineWidth=f}if(this.HQChart){var T=this.HQChart.GetEventCallback(et.ON_DRAW_DEPTH_TOOLTIP);T&&T.Callback(T,l,this)}if(this.IsShowTooltip){var I=this.GetFormatTooltip(l);this.DrawTooltip(I,l)}}}}},this.GetFormatTooltip=function(r){var n=[],e=2;this.Symbol&&(e=fe(this.Symbol));var t={Title:gt.GetText("Depth-Price",this.HQChart.LanguageID),TitleColor:this.Tooltip.TextColor,Text:r.Price.toFixed(e),Color:this.Tooltip.TextColor};n.push(t);var t={Title:gt.GetText("Depth-Sum",this.HQChart.LanguageID),TitleColor:this.Tooltip.TextColor,Text:r.Vol.toFixed(4),Color:this.Tooltip.TextColor};return n.push(t),n},this.DrawTooltip=function(r,n){if(c.IsNonEmptyArray(r)){this.Canvas.font=this.Tooltip.Font;for(var e=0,t=0,a=0,s=0;s<r.length;++s){var o=r[s];if(o){var h=!1;if(o.Title){var l=this.Canvas.measureText(o.Title).width;e<l&&(e=l),++t,h=!0}if(o.Text){var l=this.Canvas.measureText(o.Text).width;e<l&&(e=l),++t,h=!0}h&&++a}}if(!(e<=0||t<=0)){this.Tooltip.LineHeight=this.Canvas.measureText("擎").width+2;var u=V(),f=this.Tooltip.Border;this.Tooltip.Width=e+(f.Left+f.Right)*u,this.Tooltip.Height=this.Tooltip.LineHeight*t+(f.Top+f.Bottom)*u+f.ItemSpace*u*(a-1);var C=this.Frame.ChartBorder.GetRight(),D=this.Frame.ChartBorder.GetTop(),v=n.X,S=n.Y-this.Tooltip.Height;v+this.Tooltip.Width>=C&&(v=n.X-this.Tooltip.Width),S<D&&(S=n.Y),this.Canvas.fillStyle=this.Tooltip.BGColor,this.Canvas.fillRect(v,S,this.Tooltip.Width,this.Tooltip.Height),this.Canvas.textBaseline="top",this.Canvas.textAlign="left";for(var T=f.Left*u+v,I=f.Top*u+S,s=0;s<r.length;++s){var o=r[s],h=!1;o.Title&&(o.TitleColor?this.Canvas.fillStyle=o.TitleColor:this.Canvas.fillStyle=this.Tooltip.TextColor,this.Canvas.fillText(o.Title,T,I),I+=this.Tooltip.LineHeight,h=!0),o.Text&&(o.Color?this.Canvas.fillStyle=o.Color:this.Canvas.fillStyle=this.Tooltip.TextColor,this.Canvas.fillText(o.Text,T,I),I+=this.Tooltip.LineHeight,h=!0),h&&(I+=f.ItemSpace*u)}}}},this.PtInButton=function(r,n){return null}}function Qa(){this.Frame,this.Canvas,this.Font=m.DefaultTextFont,this.TextColor=m.DefaultTextColor,this.IsEnableSplash=!1,this.SplashTitle="数据加载中",this.HQChart,this.Position=0,this.EnableSplash=function(r){if(this.IsEnableSplash=r,this.HQChart){var n=this.HQChart.GetEventCallback(et.ON_ENABLE_SPLASH_DRAW);if(n){var e={Enable:r};n.Callback(n,e,this)}}},this.SetTitle=function(r){this.SplashTitle=r},this.Draw=function(){if(this.IsEnableSplash){if(this.Frame.IsHScreen===!0){this.HScreenDraw();return}var r=null,n=null;if(this.Position==1&&this.HQChart.Frame&&this.HQChart.Frame.SubFrame&&this.HQChart.Frame.SubFrame[0]){var e=this.HQChart.Frame.SubFrame[0].Frame;e&&(r=(e.ChartBorder.GetLeft()+e.ChartBorder.GetRight())/2,n=(e.ChartBorder.GetTop()+e.ChartBorder.GetBottom())/2)}if(!c.IsNumber(r)||!c.IsNumber(n))var r=(this.Frame.ChartBorder.GetLeft()+this.Frame.ChartBorder.GetRight())/2,n=(this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.GetBottom())/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.SplashTitle,r,n)}},this.HScreenDraw=function(){var r=(this.Frame.ChartBorder.GetLeft()+this.Frame.ChartBorder.GetRight())/2,n=(this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.GetBottom())/2;this.Canvas.save(),this.Canvas.translate(r,n),this.Canvas.rotate(90*Math.PI/180),this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.font=this.Font,this.Canvas.fillText(this.SplashTitle,0,0),this.Canvas.restore()}}function Ga(){this.Data,this.Value,this.Text,this.Operator=function(){return!1},this.GetMultiDayBeforeOpenData=function(){if(!this.MultiDayBeforeOpenData||!c.IsNonEmptyArray(this.MultiDayBeforeOpenData)||(this.DayOffset||this.MultiDayBeforeOpenData,!c.IsNumber(this.DayOffset.Offset)||!c.IsNumber(this.DayOffset.ShowDayCount)))return null;var r=this.DayOffset.ShowDayCount,n=this.DayOffset.Offset,e=this.MultiDayBeforeOpenData.slice(n,n+r);return e},this.GetMultiDayAfterCloseData=function(){if(!this.MultiDayAfterCloseData||!c.IsNonEmptyArray(this.MultiDayAfterCloseData)||(this.DayOffset||this.MultiDayAfterCloseData,!c.IsNumber(this.DayOffset.Offset)||!c.IsNumber(this.DayOffset.ShowDayCount)))return null;var r=this.DayOffset.ShowDayCount,n=this.DayOffset.Offset,e=this.MultiDayAfterCloseData.slice(n,n+r);return e}}var VC=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10];function HC(){this.newMethod=Ga,this.newMethod(),delete this.newMethod,this.Symbol,this.FrameID,this.Frame,this.LanguageID=ke.LANGUAGE_CHINESE_ID,this.YClose,this.PercentageText,this.RValue,this.RText,this.RComplexText,this.Point,this.ClientPos=-1,this.ExtendChartPaint,this.RExtendText=[],this.BeforeOpenData,this.AfterCloseData,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.ShareAfterVol=0,this.PriceFormatType=0,this.DataFormatType=0,this.GetEventCallback,this.GetBeforeOpen=function(){if(!this.Frame)return!1;var r=this.Frame.SubFrame[this.FrameID];if(!r||!r.Frame||!this.BeforeOpenData)return!1;var n={Max:this.BeforeOpenData.VolMax,Min:this.BeforeOpenData.VolMin},e=this.Frame.IsHScreen?this.Point.X:this.Point.Y,t=r.Frame.GetLeftExtendYData(e,!1,{Range:n}),a=2;c.IsNumber(t)&&(this.RText=this.Text=c.FormatValueString(t,a,this.LanguageID))},this.GetAfterClose=function(){if(!this.Frame)return!1;var r=this.Frame.SubFrame[this.FrameID];if(!r||!r.Frame||!this.AfterCloseData)return!1;var n={Max:this.AfterCloseData.VolMax,Min:this.AfterCloseData.VolMin},e=this.Frame.IsHScreen?this.Point.X:this.Point.Y,t=r.Frame.GetRightExtendYData(e,!1,{Range:n}),a=2;c.IsNumber(t)&&(this.RText=this.Text=c.FormatValueString(t,a,this.LanguageID))},this.GetMultiDayBeforeOpen=function(){if(!this.Frame)return!1;var r=this.Frame.SubFrame[this.FrameID];if(!r||!r.Frame)return!1;var n=this.GetMultiDayBeforeOpenData();if(!(!n||!c.IsNonEmptyArray(n))){var e=this.ClientPos-200;if(e<0||e>=n.length)return!1;var t=n[e],a={Max:t.VolMax,Min:t.VolMin},s=this.Frame.IsHScreen?this.Point.X:this.Point.Y,o=r.Frame.GetLeftExtendYData(s,!1,{Range:a}),h=2;c.IsNumber(o)&&(this.RText=this.Text=c.FormatValueString(o,h,this.LanguageID))}},this.GetMultiDayAfterClose=function(){if(!this.Frame)return!1;var r=this.Frame.SubFrame[this.FrameID];if(!r||!r.Frame)return!1;var n=this.GetMultiDayAfterCloseData();if(!(!n||!c.IsNonEmptyArray(n))){var e=this.ClientPos-300;if(e<0||e>=n.length)return!1;var t=n[e],a={Max:t.VolMax,Min:t.VolMin},s=this.Frame.IsHScreen?this.Point.X:this.Point.Y,o=r.Frame.GetRightExtendYData(s,!1,{Range:a}),h=2;c.IsNumber(o)&&(this.RText=this.Text=c.FormatValueString(o,h,this.LanguageID))}},this.Operator=function(){if(this.RText=null,this.RComplexText=null,this.RExtendText=[],c.IsString(this.RValue)&&(this.RText=this.RValue),!this.Value)return!1;this.PercentageText=null;var r=2;if(this.FrameID==0){var r=fe(this.Symbol);this.PriceFormatType==1?this.Text=c.FormatValueThousandsString(this.Value,r):this.Text=this.Value.toFixed(r),this.YClose>0&&(this.PercentageText=((this.Value-this.YClose)*100/this.YClose).toFixed(2)),this.GetExtendPaintData(r)}else this.FrameID==1?(this.DataFormatType==1?(this.Text=c.FormatValueThousandsString(this.Value,r),c.IsNumber(this.RValue)&&(this.RText=c.FormatValueString(this.RValue,r,this.LanguageID))):(this.Text=c.FormatValueString(this.Value,r,this.LanguageID),c.IsNumber(this.RValue)&&(this.RText=c.FormatValueString(this.RValue,r,this.LanguageID))),this.ClientPos==2?this.GetBeforeOpen():this.ClientPos==3?(this.ShareAfterVol==0||this.ShareAfterVol==2)&&this.GetAfterClose():this.ClientPos>=200&&this.ClientPos<=299?this.GetMultiDayBeforeOpen():this.ClientPos>=300&&this.ClientPos<=399&&(this.ShareAfterVol==0||this.ShareAfterVol==2)&&this.GetMultiDayAfterClose()):this.DataFormatType==1?this.Text=c.FormatValueThousandsString(this.Value,r):this.Text=c.FormatValueString(this.Value,r,this.LanguageID);if(this.GetEventCallback){var n=this.GetEventCallback(et.ON_FORMAT_CORSSCURSOR_Y_TEXT);if(n){var e={Value:this.Value,FrameID:this.FrameID};n.Callback(n,e,this)}}return!0},this.GetExtendPaintData=function(r){var n=parseInt(this.Value*VC[r]);for(var e in this.ExtendChartPaint){var t=this.ExtendChartPaint[e];if(t.ClassName=="DepthMapPaint"&&t.FrameID==this.FrameID){var a=t.GetYValueByXValue(n,r);for(var s in a)this.RExtendText.push(a[s])}}}}function YC(){this.newMethod=Ga,this.newMethod(),delete this.newMethod,this.DateFormatType=0,this.LanguageID=0,this.Operator=function(){if(!c.IsNumber(this.Value)||!this.Data)return!1;var r=this.Value;if(r=parseInt(r.toFixed(0)),this.Data.DataOffset+r>=this.Data.Data.length)return!1;var n=this.Data.Data[this.Data.DataOffset+r],e="YYYY-MM-DD";if(this.DateFormatType==1?e="YYYY/MM/DD":this.DateFormatType==2?e="YYYY/MM/DD/W":this.DateFormatType==3&&(e="DD/MM/YYYY"),this.Text=c.FormatDateString(n.Date,e,this.LanguageID),k.IsMinutePeriod(this.Data.Period,!0)){var t=c.FormatTimeString(n.Time);this.Text=this.Text+"  "+t}else if(k.IsSecondPeriod(this.Data.Period)){var t=c.FormatTimeString(n.Time,"HH:MM:SS");this.Text=this.Text+"  "+t}else if(k.IsTickPeriod(this.Data.Period)){var t=c.FormatTimeString(n.Time);this.Text=this.Text+"  "+t}if(this.GetEventCallback){var a=this.GetEventCallback(et.ON_FORMAT_CORSSCURSOR_X_TEXT);if(a){var s={Item:n,Period:this.Data.Period,Date:n.Date,Time:n.Time,Index:this.Data.DataOffset+r};a.Callback(a,s,this)}}return!0}}function kC(){this.newMethod=Ga,this.newMethod(),delete this.newMethod,this.Frame,this.Symbol,this.Point,this.ClientPos=-1,this.BeforeOpenData,this.AfterCloseData,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.GetEventCallback,this.GetBeforeOpen=function(){if(!this.BeforeOpenData||!this.BeforeOpenData.Data)return!1;var r=this.Frame.IsHScreen==!0?this.Point.Y:this.Point.X,n=this.Frame.GetLeftExtendXData(r,this.BeforeOpenData);if(n=parseInt(n.toFixed(0)),n>=this.BeforeOpenData.Data.length)return!1;var e=this.BeforeOpenData.Data[n];return this.Text=this.FormatCallAcutionDateTime(e,this.BeforeOpenData),!0},this.GetAfterClose=function(){if(!this.AfterCloseData||!this.AfterCloseData.Data)return!1;var r=this.Frame.IsHScreen==!0?this.Point.Y:this.Point.X,n=this.Frame.GetRightExtendXData(r,this.AfterCloseData);if(n=parseInt(n.toFixed(0)),n>=this.AfterCloseData.Data.length)return!1;var e=this.AfterCloseData.Data[n];return this.Text=this.FormatCallAcutionDateTime(e,this.AfterCloseData),!0},this.GetMultiDayBeforeOpen=function(){var r=this.GetMultiDayBeforeOpenData();if(!r||this.Frame.ChartBorder.MultiDayMinute.Count<=1||this.Frame.ChartBorder.MultiDayMinute.Left<=0)return!1;var n=this.Frame.IsHScreen==!0?this.Point.Y:this.Point.X,e=this.Frame.GetLeftExtendXData(n,r);if(!e||e.DayIndex>=r.length)return!1;var t=r[e.DayIndex];if(e.DataIndex=parseInt(e.DataIndex.toFixed(0)),e.DataIndex>=t.Data.length||e.DataIndex<0)return!1;var a=t.Data[e.DataIndex];return this.Text=this.FormatCallAcutionDateTime(a,t),!0},this.GetMultiDayAfterClose=function(){var r=this.GetMultiDayAfterCloseData();if(!r||this.Frame.ChartBorder.MultiDayMinute.Count<=1||this.Frame.ChartBorder.MultiDayMinute.Right<=0)return!1;var n=this.Frame.IsHScreen==!0?this.Point.Y:this.Point.X,e=this.Frame.GetRightExtendXData(n,r);if(!e||e.DayIndex>=r.length)return!1;var t=r[e.DayIndex];if(e.DataIndex=parseInt(e.DataIndex.toFixed(0)),e.DataIndex>=t.Data.length)return!1;var a=t.Data[e.DataIndex];return this.Text=this.FormatCallAcutionDateTime(a,t),!0},this.FormatCallAcutionDateTime=function(r,n){var e=r.Time;return n.Ver==1?c.FormatTimeString(e,"HH:MM"):c.FormatTimeString(e,"HH:MM:SS")},this.Operator=function(){if(this.ClientPos==2)return this.GetBeforeOpen();if(this.ClientPos==3)return this.GetAfterClose();if(this.ClientPos>=200&&this.ClientPos<=299)return this.GetMultiDayBeforeOpen();if(this.ClientPos>=300&&this.ClientPos<=399)return this.GetMultiDayAfterClose();if(!c.IsNumber(this.Value))return!1;var r=Math.abs(this.Value);r=parseInt(r.toFixed(0));var n=r;this.Frame&&this.Frame.MinuteCount&&(n=r%this.Frame.MinuteCount);var e=yr,t=e.GetTimeData(this.Symbol);if(!t)return!1;n<0?n=0:n>t.length&&(n=t.length-1),this.Frame&&r>=this.Frame.XPointCount&&(n=t.length-1);var a=t[n];if(this.Text=c.FormatTimeString(a),this.GetEventCallback){var s=this.GetEventCallback(et.ON_FORMAT_CORSSCURSOR_X_TEXT);if(s){var o={Time:a,Index:n};s.Callback(s,o,this)}}return!0}}var Qo=["日","一","二","三","四","五","六"];function yd(){this.newMethod=Ga,this.newMethod(),delete this.newMethod,this.ClassName="HistoryDataStringFormat",this.Symbol,this.UpColor=m.UpTextColor,this.DownColor=m.DownTextColor,this.UnchagneColor=m.UnchagneTextColor,this.VolColor=m.Title.VolColor,this.AmountColor=m.Title.AmountColor,this.TurnoverRateColor=m.Title.TurnoverRateColor,this.PositionColor=m.Title.PositionColor,this.LanguageID=ke.LANGUAGE_CHINESE_ID,this.LineCount=0,this.LineHeight=m.PCTooltip.LineHeight,this.Width=157,this.Height=this.LineHeight*5,this.Operator=function(){var r=this.Value.Data;if(!r)return!1;this.Width=157,this.LanguageID==ke.LANGUAGE_ENGLISH_ID&&(this.Width=180);var n=new Date(parseInt(r.Date/1e4),r.Date/100%100-1,r.Date%100),e=c.FormatDateString(r.Date),t=gt.GetText(Qo[n.getDay()],this.LanguageID),a=k.IsTickPeriod(this.Value.ChartPaint.Data.Period);k.IsMinutePeriod(this.Value.ChartPaint.Data.Period,!0)?t=c.FormatTimeString(r.Time):(k.IsSecondPeriod(this.Value.ChartPaint.Data.Period)||a)&&(t=c.FormatTimeString(r.Time,"HH:MM:SS"));var s=this.Symbol.toUpperCase(),o=fe(this.Symbol),h=null;if(r.YClose>0&&(h=(r.Close-r.YClose)/r.YClose*100),a){var l="<span class='tooltip-title'>"+e+"&nbsp&nbsp"+t+"</span><span class='tooltip-con'>"+gt.GetText("DivTooltip-Price",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.GetColor(r.Open,r.YClose)+";'>"+r.Open.toFixed(o)+"</span><br/><span class='tooltip-con'>"+gt.GetText("DivTooltip-Increase",this.LanguageID)+"</span>"+(h==null?"<span class='tooltip-num' style='color:"+this.GetColor(0,0)+";'>--</span><br/>":"<span class='tooltip-num' style='color:"+this.GetColor(h,0)+";'>"+h.toFixed(2)+"%</span><br/>");this.LineCount=4}else if(r.IsNonTrade){var l="<span class='tooltip-title'>"+e+"&nbsp&nbsp"+t+"</span>";this.LineCount=2}else{var u=r.Vol;s&&W.IsSHSZ(s)&&(u/=100);var f=null;this.GetEventCallback&&(f=this.GetEventCallback(et.ON_CUSTOM_UNCHANGE_KLINE_TITLE_COLOR));var l="<span class='tooltip-title'>"+e+"&nbsp&nbsp"+t+"</span><span class='tooltip-con'>"+gt.GetText("DivTooltip-Open",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.GetPriceColor("DivTooltip-Open",r.Open,r.YClose,r,f)+";'>"+(c.IsNumber(r.Open)?r.Open.toFixed(o):"--")+"</span><br/><span class='tooltip-con'>"+gt.GetText("DivTooltip-High",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.GetPriceColor("DivTooltip-High",r.High,r.YClose,r,f)+";'>"+(c.IsNumber(r.High)?r.High.toFixed(o):"--")+"</span><br/><span class='tooltip-con'>"+gt.GetText("DivTooltip-Low",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.GetPriceColor("DivTooltip-Low",r.Low,r.YClose,r,f)+";'>"+(c.IsNumber(r.Low)?r.Low.toFixed(o):"--")+"</span><br/><span class='tooltip-con'>"+gt.GetText("DivTooltip-Close",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.GetPriceColor("DivTooltip-Close",r.Close,r.YClose,r,f)+";'>"+(c.IsNumber(r.Close)?r.Close.toFixed(o):"--")+"</span><br/><span class='tooltip-con'>"+gt.GetText("DivTooltip-Vol",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.VolColor+";'>"+(c.IsNumber(u)?c.FormatValueString(u,2,this.LanguageID):"--")+"</span><br/><span class='tooltip-con'>"+gt.GetText("DivTooltip-Amount",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.AmountColor+";'>"+(c.IsNumber(r.Amount)?c.FormatValueString(r.Amount,2,this.LanguageID):"--")+"</span><br/><span class='tooltip-con'>"+gt.GetText("DivTooltip-Increase",this.LanguageID)+"</span>"+(h==null?"<span class='tooltip-num' style='color:"+this.GetColor(0,0)+";'>--</span><br/>":"<span class='tooltip-num' style='color:"+this.GetColor(h,0)+";'>"+h.toFixed(2)+"%</span><br/>");if(this.LineCount=8,W.IsSHSZStockA(this.Symbol)&&r.FlowCapital>0){var C=r.Vol/r.FlowCapital*100;l+="<span class='tooltip-con'>"+gt.GetText("DivTooltip-Exchange",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.TurnoverRateColor+";'>"+C.toFixed(2)+"%</span><br/>",++this.LineCount}if(W.IsFutures(s)&&c.IsNumber(r.Position)&&(l+="<span class='tooltip-con'>"+gt.GetText("DivTooltip-Position",this.LanguageID)+"</span><span class='tooltip-num' style='color:"+this.PositionColor+";'>"+r.Position+"</span><br/>",++this.LineCount),this.Value.ChartPaint.Name=="Overlay-KLine"){var D="<span style='color:rgb(0,0,0);font:微软雅黑;font-size:12px;text-align:center;display: block;'>"+this.Value.ChartPaint.Title+"</span>";l=D+l,++this.LineCount}}return this.Text=l,this.Height=this.LineCount*this.LineHeight,!0},this.GetColor=function(r,n){return r>n?this.UpColor:r<n?this.DownColor:this.UnchagneColor},this.GetPriceColor=function(r,n,e,t,a){var s=this.GetColor(n,e);if(n==e&&a&&a.Callback){var o={Item:t,TitleName:r,DefaultColor:s,TitleColor:null,ClassName:this.ClassName};a.Callback(a,o),o.TitleColor&&(s=o.TitleColor)}return s}}function Pd(){this.newMethod=Ga,this.newMethod(),delete this.newMethod,this.UpColor=m.UpTextColor,this.DownColor=m.DownTextColor,this.UnchagneColor=m.UnchagneTextColor,this.Width=500,this.Operator=function(){if(!this.Value)return!1;var r=this.Value.Data.Data,n=this.Value.Data.Type,e="";for(var t in r){var a=r[t],s="";switch(n){case $t.BLOCKTRADING:s=this.BlockTradingFormat(a);break;case $t.TRADEDETAIL:s=this.TradeDetailFormat(a);break;case $t.RESEARCH:s=this.ResearchFormat(a);break;case $t.PFORECAST:s=this.PerformanceForecastFormat(a);break;default:s=this.DefaultFormat(a);break}e+=s}var o="<div class='title-length'>"+e+"</div>";if(r.length>8){var h="<div class='total-list'>共"+r.length+"条</div>";o+=h}return this.Text=o,!0},this.DefaultFormat=function(r){var n=c.FormatDateString(r.Date);if(c.IsNumber(r.Time)){var e=c.FormatTimeString(r.Time);n+=" "+e}var t="<span>"+n+"&nbsp;&nbsp;&nbsp;"+r.Title+"</span>";return t},this.BlockTradingFormat=function(r){var n=r.ExtendData,e=c.FormatDateString(r.Date),t="<span><i class='date-tipbox'>"+e+"</i>&nbsp;&nbsp;<i class='tipBoxTitle'>成交价:&nbsp;"+n.Price.toFixed(2)+"</i><i class='tipBoxTitle'>收盘价:&nbsp;"+n.ClosePrice.toFixed(2)+"</i><br/><i class='rate-discount tipBoxTitle'>溢折价率:&nbsp;<strong style='color:"+this.GetColor(n.Premium.toFixed(2))+"'>"+n.Premium.toFixed(2)+"%</strong></i><i class='tipBoxTitle'>成交量(万股):&nbsp;"+n.Vol.toFixed(2)+"</i></span>";return t},this.TradeDetailFormat=function(r){var n=r.ExtendData.Detail,e=c.FormatDateString(r.Date),t=[];for(var a in n)t+="<i>"+n[a].TypeExplain+"</i><br/>";var s="<span><i class='trade-time'>"+e+"&nbsp;&nbsp;&nbsp;上榜原因:&nbsp;&nbsp;</i><i class='reason-list'>"+t+"</i><br/><i class='trade-detall'>一周后涨幅:&nbsp;<strong style='color:"+this.GetColor(r.ExtendData.FWeek.Week1.toFixed(2))+"'>"+r.ExtendData.FWeek.Week1.toFixed(2)+"%</strong>&nbsp;&nbsp;&nbsp;四周后涨幅:&nbsp;<strong style='color:"+this.GetColor(r.ExtendData.FWeek.Week4.toFixed(2))+";'>"+r.ExtendData.FWeek.Week4.toFixed(2)+"%</strong></i></span>";return s},this.ResearchFormat=function(r){var n=r.ExtendData.Level,e="";if(n.length==0)e="<i>一般调研</i>";else{for(var t in n)n[t]==0?e+="<i style='color:#00a0e9'>证券代表&nbsp;&nbsp;&nbsp;</i>":n[t]==1?e+="<i>董秘&nbsp;&nbsp;&nbsp;</i>":n[t]==2?e+="<i style='color:#00a0e9'>总经理&nbsp;&nbsp;&nbsp;</i>":n[t]==3&&(e+="<i style='color:#00a0e9'>董事长&nbsp;&nbsp;&nbsp;</i>");e="接待:&nbsp;&nbsp;&nbsp;"+e}var a="";r.ExtendData.Type&&r.ExtendData.Type!="其他"&&(a="&nbsp;&nbsp;&nbsp;<i>"+r.ExtendData.Type+"</i>",n.length==0&&(e=""));var s=c.FormatDateString(r.Date),o="<span>"+s+"&nbsp;&nbsp;&nbsp;"+a+e+"</span>";return o},this.PerformanceForecastFormat=function(r){var n=r.ExtendData.ReportDate,e=parseInt(n/1e4),t=n%1e4,a;t==1231?a="年报":t==331?a="一季度报":t==630?a="半年度报":t==930&&(a="三季度报");var s="";r.ExtendData.FWeek&&(r.ExtendData.FWeek.Week1!=null&&(s+="一周后涨幅:<i class='increase' style='color:"+this.GetColor(r.ExtendData.FWeek.Week1.toFixed(2))+"'>"+r.ExtendData.FWeek.Week1.toFixed(2)+"%</i>"),r.ExtendData.FWeek.Week4!=null&&(s+="&nbsp;四周后涨幅:<i class='increase' style='color:"+this.GetColor(r.ExtendData.FWeek.Week4.toFixed(2))+"'>"+r.ExtendData.FWeek.Week4.toFixed(2)+"%</i>"),s.length>0&&(s="<br/>&nbsp;&nbsp;<i class='prorecast-week'>"+s+"</i>"));var o=c.FormatDateString(r.Date),h="<span>"+o+"&nbsp;&nbsp;"+e+a+r.Title+"&nbsp;"+s+"</span>";return h},this.GetColor=function(r){return r>0?this.UpColor:r<0?this.DownColor:this.UnchagneColor}}function wd(){this.newMethod=Ga,this.newMethod(),delete this.newMethod,this.Width=120,this.Operator=function(){var r=this.Value.Data;if(!r)return!1;var n=r.Data,e="<span class='tooltip-index-name'>"+n.Name+n.Param+":</span>",t;return n.Type==1?t="<span class='tooltip-index-buy'>买入</span>":t="<span class='tooltip-index-sell'>卖出</span>",this.Text=e+t,!0}}function Bd(){this.newMethod=Ga,this.newMethod(),delete this.newMethod,this.Width=200,this.Operator=function(){var r=this.Value.Data;if(!r)return!1;var n=r.Data.Item,e=c.FormatTimeString(n.Time),t="<span class='tooltip-minuteinfo-time'>"+e+" </span>",a="<span class='tooltip-minuteinfo-content'>"+n.Title+"</span>";return n.Content&&(a="<span class='tooltip-minuteinfo-content'>"+n.Content+"</span>"),this.Text=t+a,!0}}function bd(){this.newMethod=Ga,this.newMethod(),delete this.newMethod,this.Width=200,this.Operator=function(){if(!this.Value||!this.Value.Data)return!1;var r=this.Value.Data;return!r.Item||!r.Item.Text?!1:(this.Text=r.Item.Text,!0)}}function Gd(){this.newMethod=Ga,this.newMethod(),delete this.newMethod,this.Width=200,this.Operator=function(){if(!this.Value||!this.Value.Data)return!1;var r=this.Value.Data;return!r.Item||!r.Item.Tooltip||!r.Item.Tooltip.Text?!1:(this.Text=r.Item.Tooltip.Text,!0)}}function Vd(){this.newMethod=Ga,this.newMethod(),delete this.newMethod,this.Width=200,this.Period=0,this.Operator=function(){var r=this.Value.Data;if(!r||!r.Data)return!1;if(k.IsDayPeriod(this.Period,!0)){var n=c.FormatDateString(r.Data.Start.Date),e=c.FormatDateString(r.Data.End.Date);if(n==e)return this.Text="<span class='tooltip-minuteinfo-content'>"+n+"</span>",!0;var t="<span class='tooltip-minuteinfo-content'>起始时间:"+n+"</span>",a="<span class='tooltip-minuteinfo-content'>结束时间:"+e+"</span>";return this.Text=t+"<br>"+a,!0}else if(k.IsMinutePeriod(this.Period,!0)){var n=c.FormatDateString(r.Data.Start.Date),s=c.FormatTimeString(r.Data.Start.Time,"HH:MM"),e=c.FormatDateString(r.Data.End.Date),o=c.FormatTimeString(r.Data.End.Time,"HH:MM"),t="<span class='tooltip-minuteinfo-content'>起始时间:"+n+" "+s+"</span>",a="<span class='tooltip-minuteinfo-content'>结束时间:"+e+" "+o+"</span>";return this.Text=t+"<br>"+a,!0}return!1}}function Hd(){this.newMethod=Ga,this.newMethod(),delete this.newMethod,this.Width=200,this.Operator=function(){var r=this.Value.Data;if(!r||!r.Data||!c.IsNonEmptyArray(r.Data.Tooltip))return!1;this.Text="";for(var n=0;n<r.Data.Tooltip.length;++n){var e=r.Data.Tooltip[n],t="<span class='tooltip-minuteinfo-content'>"+e+"</span>";this.Text+=t+"<br>"}return!0}}function Yd(){this.DataMap=new Dt.default([["KLineTradeDataStringFormat",{Create:function(){return new wd}}],["MinuteInfoDataStringFormat",{Create:function(){return new Bd}}],["HistoryDataStringFormat",{Create:function(){return new yd}}],["KLineInfoDataStringFormat",{Create:function(){return new Pd}}],["IconDataStringFormat",{Create:function(){return new bd}}],["ChartOXDataStringFormat",{Create:function(){return new Vd}}],["ScatterPlotDataStringFormat",{Create:function(){return new Hd}}],["ChartDrawSVGDataStringFormat",{Create:function(){return new Gd}}],["CorssCursor_XStringFormat",{Create:function(){return new YC}}],["CorssCursor_YStringFormat",{Create:function(){return new HC}}],["CorssCursor_Minute_XStringFormat",{Create:function(){return new kC}}]]),this.Create=function(r){if(!this.DataMap.has(r))return null;var n=this.DataMap.get(r);return n.Create()}}var ze=new Yd;function kh(){this.Frame,this.Data=new Array,this.Canvas,this.IsDynamic=!1,this.Position=0,this.CursorIndex,this.LastPoint,this.Font=m.TitleFont,this.Title,this.TitleColor=m.DefaultTextColor,this.ClassName="IChartTitlePainting",this.DrawStatus,this.GetEventCallback,this.GlobalOption,this.ReloadResource=function(){this.Font=m.TitleFont,this.TitleColor=m.DefaultTextColor}}var kd=["不复权","前复权","后复权"];function XC(){this.newMethod=kh,this.newMethod(),delete this.newMethod,this.ClassName="DynamicKLineTitlePainting",this.IsDynamic=!0,this.IsShow=!0,this.Period,this.UpColor=m.UpTextColor,this.DownColor=m.DownTextColor,this.UnchagneColor=m.UnchagneTextColor,this.VolColor=m.Title.VolColor,this.AmountColor=m.Title.AmountColor,this.DateTimeColor=m.Title.DateTimeColor,this.NameColor=m.Title.NameColor,this.SettingColor=m.Title.SettingColor,this.TurnoverRateColor=m.Title.TurnoverRateColor,this.PositionColor=m.Title.PositionColor,this.Symbol,this.Name,this.SpaceWidth=2*V(),this.OverlayChartPaint,this.IsShowName=!0,this.IsShowSettingInfo=!0,this.IsShowDateTime=!0,this.LanguageID=ke.LANGUAGE_CHINESE_ID,this.OnDrawEvent,this.OnMouseMoveEvent,this.HQChart,this.ReloadResource=function(){this.Font=m.TitleFont,this.TitleColor=m.DefaultTextColor,this.UpColor=m.UpTextColor,this.DownColor=m.DownTextColor,this.UnchagneColor=m.UnchagneTextColor,this.VolColor=m.Title.VolColor,this.AmountColor=m.Title.AmountColor,this.DateTimeColor=m.Title.DateTimeColor,this.NameColor=m.Title.NameColor,this.SettingColor=m.Title.SettingColor,this.TurnoverRateColor=m.Title.TurnoverRateColor,this.PositionColor=m.Title.PositionColor},this.GetCurrentKLineData=function(){if(this.CursorIndex==null||!this.Data||this.Data.length<=0)return null;var r=this.CursorIndex;r=parseInt(r.toFixed(0));var n=this.Data.DataOffset+r;if(n>=this.Data.Data.length&&(n=this.Data.Data.length-1),n<0)return null;var e=this.Data.Data[n];return e},this.GetFormatTitle=function(r){if(!(!r||!r.Data)){var n=fe(this.Symbol),e=this.Symbol.toUpperCase(),t=r.Data,a=[],s={AryText:a};if(this.IsShowName&&a.push({Text:this.Name,Color:this.NameColor}),this.IsShowSettingInfo){var o="";this.Data.Period>fi&&this.Data.Period<=cr?o=this.Data.Period-fi+gt.GetText("自定义分钟",this.LanguageID):this.Data.Period>Ir&&this.Data.Period<=Is?o=this.Data.Period-Ir+gt.GetText("自定义日线",this.LanguageID):this.Data.Period>$n&&this.Data.Period<=wh?o=this.Data.Period-$n+gt.GetText("自定义秒",this.LanguageID):o=gt.GetText(k.GetPeriodName(this.Data.Period),this.LanguageID);var h=gt.GetText(kd[this.Data.Right],this.LanguageID),l="("+o+" "+h+")";W.IsEnableRight(this.Data.Period,this.Symbol,this.HQChart.RightFormula)||(l="("+o+")"),a.push({Text:l,Color:this.SettingColor})}var l=this.GetKLineCalculateTitle();if(l&&a.push({Text:l,Color:this.NameColor}),this.IsShowDateTime){var l=c.FormatDateString(t.Date);a.push({Text:l,Color:this.DateTimeColor})}var u=k.IsTickPeriod(this.Period);if(k.IsMinutePeriod(this.Period,!0)&&c.IsNumber(t.Time)){var l=c.FormatTimeString(t.Time);a.push({Text:l,Color:this.DateTimeColor})}else if(k.IsSecondPeriod(this.Period)&&c.IsNumber(t.Time)){var l=c.FormatTimeString(t.Time,"HH:MM:SS");a.push({Text:l,Color:this.DateTimeColor})}else if(u){var l=c.FormatTimeString(t.Time,"HH:MM:SS");a.push({Text:l,Color:this.DateTimeColor})}if(u){var f=this.GetColor(t.Open,t.YClose),l=gt.GetText("KTitle-Price",this.LanguageID)+t.Open.toFixed(n);if(a.push({Text:l,Color:f}),c.IsNumber(t.YClose)&&t.YClose!=0){var C=(t.Close-t.YClose)/t.YClose*100,f=this.GetColor(C,0),l=gt.GetText("KTitle-Increase",this.LanguageID)+C.toFixed(2)+"%";a.push({Text:l,Color:f})}return s}if(t.IsNonTrade)return s;var D=null;if(this.GetEventCallback&&(D=this.GetEventCallback(et.ON_CUSTOM_UNCHANGE_KLINE_TITLE_COLOR)),c.IsNumber(t.Open)){var f=this.GetColor(t.Open,t.YClose),l=gt.GetText("KTitle-Open",this.LanguageID)+t.Open.toFixed(n);if(t.Open==t.YClose&&D){var v={Item:t,TitleName:"KTitle-Open",DefaultColor:f,TitleColor:null};this.OnUnchangeTitleColor(D,v)&&(f=v.TitleColor)}a.push({Text:l,Color:f})}if(c.IsNumber(t.High)){var f=this.GetColor(t.High,t.YClose),l=gt.GetText("KTitle-High",this.LanguageID)+t.High.toFixed(n);if(t.High==t.YClose&&D){var v={Item:t,TitleName:"KTitle-High",DefaultColor:f,TitleColor:null};this.OnUnchangeTitleColor(D,v)&&(f=v.TitleColor)}a.push({Text:l,Color:f})}if(c.IsNumber(t.Low)){var f=this.GetColor(t.Low,t.YClose),l=gt.GetText("KTitle-Low",this.LanguageID)+t.Low.toFixed(n);if(t.Low==t.YClose&&D){var v={Item:t,TitleName:"KTitle-Low",DefaultColor:f,TitleColor:null};this.OnUnchangeTitleColor(D,v)&&(f=v.TitleColor)}a.push({Text:l,Color:f})}if(c.IsNumber(t.Close)){var f=this.GetColor(t.Close,t.YClose),l=gt.GetText("KTitle-Close",this.LanguageID)+t.Close.toFixed(n);if(t.Close==t.YClose&&D){var v={Item:t,TitleName:"KTitle-Close",DefaultColor:f,TitleColor:null};this.OnUnchangeTitleColor(D,v)&&(f=v.TitleColor)}a.push({Text:l,Color:f})}if(t.YFClose>0&&W.IsChinaFutures(e)){var C=(t.Close-t.YFClose)/t.YFClose*100,f=this.GetColor(C,0),l=gt.GetText("KTitle-Increase",this.LanguageID)+C.toFixed(2)+"%";a.push({Text:l,Color:f})}else if(t.YClose>0){var C=(t.Close-t.YClose)/t.YClose*100,f=this.GetColor(C,0),l=gt.GetText("KTitle-Increase",this.LanguageID)+C.toFixed(2)+"%";a.push({Text:l,Color:f})}if(c.IsNumber(t.Vol)){var S=t.Vol;e&&W.IsSHSZ(e)&&(S/=100);var l=gt.GetText("KTitle-Vol",this.LanguageID)+c.FromatIntegerString(S,2,this.LanguageID);a.push({Text:l,Color:this.VolColor})}if(c.IsNumber(t.Amount)){var l=gt.GetText("KTitle-Amount",this.LanguageID)+c.FormatValueString(t.Amount,2,this.LanguageID);a.push({Text:l,Color:this.AmountColor})}if(W.IsSHSZStockA(this.Symbol)&&t.FlowCapital>0){var C=t.Vol/t.FlowCapital*100,l=gt.GetText("KTitle-Exchange",this.LanguageID)+c.FormatValueString(C,2,this.LanguageID)+"%";a.push({Text:l,Color:this.TurnoverRateColor})}if(W.IsFutures(e)&&c.IsNumber(t.Position)){var l=gt.GetText("KTitle-Position",this.LanguageID)+t.Position;a.push({Text:l,Color:this.PositionColor})}if(c.IsNonEmptyArray(this.OverlayChartPaint))for(var T=0;T<this.OverlayChartPaint.length;++T){var t=this.OverlayChartPaint[T];if(!(!t.Symbol||!t.Title)){var I=t.Color,l="["+t.Title+"]";a.push({Text:l,Color:I})}}return s}},this.DrawItem=function(r){var n=this.Frame.IsHScreen===!0,e=this.Frame.ChartBorder.GetLeft(),t=this.Frame.ChartBorder.GetTop()-this.Frame.ChartBorder.Top/2;this.Frame.ChartBorder.GetRight();var a=V();if(n){if(this.Frame.ChartBorder.Right<5*a)return;var e=2,t=this.Frame.ChartBorder.Right/2;this.Frame.ChartBorder.GetHeight();var s=this.Frame.ChartBorder.GetChartWidth(),o=this.Frame.ChartBorder.GetTop();this.Canvas.translate(s,o),this.Canvas.rotate(90*Math.PI/180)}else if(this.Frame.ChartBorder.Top<5*a)return;this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font;var h={Left:e,Bottom:t,IsHScreen:n},l=this.GetFormatTitle({Data:r});if(l&&c.IsNonEmptyArray(l.AryText))for(var u=0;u<l.AryText.length;++u){var r=l.AryText[u];if(!this.DrawText(r.Text,r.Color,h))break}},this.Draw=function(){if(this.IsShow){if(this.CursorIndex==null||!this.Data||this.Data.length<=0){this.OnDrawEventCallback(null);return}this.Canvas.font=this.Font,this.SpaceWidth=this.Canvas.measureText("0").width;var r=this.CursorIndex;r=parseInt(r.toFixed(0));var n=this.Data.DataOffset+r;if(n>=this.Data.Data.length&&(n=this.Data.Data.length-1),n<0){this.OnDrawEventCallback(null);return}this.IsShowLastData()&&(n=this.Data.Data.length-1);var e=this.Data.Data[n];this.OnDrawEventCallback(e),this.Canvas.save(),this.DrawItem(e),this.Canvas.restore()}},this.OnDrawEventCallback=function(r){var n=this.OnDrawEvent&&this.OnDrawEvent.Callback,e=this.OnMouseMoveEvent&&this.OnMouseMoveEvent.Callback;if(!(!n&&!e)){var t={Draw:r,Name:this.ClassName};if(this.Data&&this.Data.Data){var a=Math.abs(this.CursorIndex);a=parseInt(a.toFixed(0));var s=this.Data.DataOffset+a,o=this.Data.Data.length;t.DataIndex=s,t.DataCount=o}if(c.IsNonEmptyArray(this.OverlayChartPaint)){t.OverlayStock=[];for(var h=0;h<this.OverlayChartPaint.length;++h){var l=this.OverlayChartPaint[h];!l.Symbol||!l.Title||t.OverlayStock.push({Symbol:l.Symbol,Name:l.Title})}}n&&this.OnDrawEvent.Callback(this.OnDrawEvent,t,this),e&&this.OnMouseMoveEvent.Callback(this.OnMouseMoveEvent,t,this)}},this.GetColor=function(r,n){return r>n?this.UpColor:r<n?this.DownColor:this.UnchagneColor},this.OnUnchangeTitleColor=function(r,n){return!r||!r.Callback?!1:(n.ClassName=this.ClassName,r.Callback(r,n,this),!!(n&&n.TitleColor))},this.DrawText=function(r,n,e){if(!r)return!0;var t=this.Frame.IsHScreen===!0,a=this.Frame.ChartBorder.GetRight();t&&(a=this.Frame.ChartBorder.GetHeight()),this.Canvas.fillStyle=n;var s=this.Canvas.measureText(r).width;return e.Left+s>a?!1:(this.IsShow&&this.Canvas.fillText(r,e.Left,e.Bottom,s),e.Left+=s+this.SpaceWidth,!0)},this.GetKLineCalculateTitle=function(){if(!this.HQChart)return null;var r=this.HQChart.GetKLineCalulate();return!r||!r.GetTitle?null:r.GetTitle()},this.IsShowLastData=function(){var r=!1;if(this.DrawStatus&&this.DrawStatus.IsTitleShowLatestData){var n=this.DrawStatus;(!c.IsNumber(n.FrameID)||n.FrameID<0||n.CorssCursorTouchEnd&&n.IsOnTouch==!1)&&(r=!0)}return r}}function WC(){this.newMethod=XC,this.newMethod(),delete this.newMethod,this.ClassName="DynamicMinuteTitlePainting",this.SpaceWidth=1*V(),this.YClose,this.IsShowDate=!1,this.IsShowTime=!0,this.IsShowName=!0,this.IsShowAveragePrice=!0,this.OverlayChartPaint,this.LanguageID=ke.LANGUAGE_CHINESE_ID,this.LastShowData,this.OnDrawEvent,this.PointInfo=null,this.IsAlwaysShowLastData=!1,this.ShowLastDataFormat=0,this.MultiDayBeforeOpenData,this.MultiDayAfterCloseData,this.TitleBaseLine=1,this.TimeFormat,this.CallAuctionShowTitle=new Ee.default(["MTitle-AC-Price","MTitle-AC-Vol","MTitle-AC-NotMatchVol","MTitle-AC-Increase","MTitle-AC-AvPrice"]),this.GetCurrentKLineData=function(){if(this.LastShowData)return this.LastShowData;if(this.CursorIndex==null||!this.Data||this.Data.length<=0)return null;var r=Math.abs(this.CursorIndex);r=parseInt(r.toFixed(0));var n=this.Data.DataOffset+r;if(n>=this.Data.Data.length&&(n=this.Data.Data.length-1),n<0)return null;var e=this.Data.Data[n];return e},this.GetCurrentAuctionData=function(){var r=this.Frame.IsHScreen===!0,n={ClientPos:this.PointInfo.ClientPos,X:this.PointInfo.Point.X,Y:this.PointInfo.Point.Y};if(this.PointInfo.ClientPos==2){if(!this.BeforeOpenData||!this.CallAcutionXOperator||(this.CallAcutionXOperator.Value=r?this.PointInfo.Point.Y:this.PointInfo.Point.X,this.CallAcutionXOperator.Point={X:this.PointInfo.Point.X,Y:this.PointInfo.Point.Y},this.CallAcutionXOperator.ClientPos=this.PointInfo.ClientPos,!this.CallAcutionXOperator.Operator()))return n;var e={Explain:"BeforeOpen",Data:null,DataIndex:null,DataTotalCount:this.BeforeOpenData.TotalCount};return e.DataIndex=this.CallAcutionXOperator.DataIndex,e.Data=this.CallAcutionXOperator.Item,e.Ver=this.BeforeOpenData.Ver,e}else if(this.PointInfo.ClientPos==3){if(!this.AfterCloseData||!this.CallAcutionXOperator||(this.CallAcutionXOperator.Value=r?this.PointInfo.Point.Y:this.PointInfo.Point.X,this.CallAcutionXOperator.Point={X:this.PointInfo.Point.X,Y:this.PointInfo.Point.Y},this.CallAcutionXOperator.ClientPos=this.PointInfo.ClientPos,!this.CallAcutionXOperator.Operator()))return n;var e={Explain:"AfterClose",Data:null,DataIndex:null,DataTotalCount:this.AfterCloseData.TotalCount};return e.DataIndex=this.CallAcutionXOperator.DataIndex,e.Data=this.CallAcutionXOperator.Item,e.Ver=this.AfterCloseData.Ver,e}else if(this.PointInfo.ClientPos>=200&&this.PointInfo.ClientPos<=299){if(!this.MultiDayBeforeOpenData||!c.IsNonEmptyArray(this.MultiDayBeforeOpenData))return n;var t=this.Frame.IsHScreen==!0?this.PointInfo.Point.Y:this.PointInfo.Point.X;if(this.CallAcutionXOperator.Value=t,this.CallAcutionXOperator.Point={X:this.PointInfo.Point.X,Y:this.PointInfo.Point.Y},this.CallAcutionXOperator.ClientPos=this.PointInfo.ClientPos,!this.CallAcutionXOperator.Operator())return n;var a=this.MultiDayBeforeOpenData[this.CallAcutionXOperator.DayIndex],e={Explain:"MultiDayBeforeOpen",Data:null,DataIndex:null};return e.DataIndex=this.CallAcutionXOperator.DataIndex,e.DayIndex=this.CallAcutionXOperator.DayIndex,e.Data=this.CallAcutionXOperator.Item,e.Ver=a.Ver,e}else if(this.PointInfo.ClientPos>=300&&this.PointInfo.ClientPos<=399){if(!this.MultiDayAfterCloseData||!c.IsNonEmptyArray(this.MultiDayAfterCloseData))return n;var t=this.Frame.IsHScreen==!0?this.PointInfo.Point.Y:this.PointInfo.Point.X;if(this.CallAcutionXOperator.Value=t,this.CallAcutionXOperator.Point={X:this.PointInfo.Point.X,Y:this.PointInfo.Point.Y},this.CallAcutionXOperator.ClientPos=this.PointInfo.ClientPos,!this.CallAcutionXOperator.Operator())return n;var a=this.MultiDayAfterCloseData[this.CallAcutionXOperator.DayIndex],e={Explain:"MultiDayAfterClose",Data:null,DataIndex:null};return e.DataIndex=this.CallAcutionXOperator.DataIndex,e.DayIndex=this.CallAcutionXOperator.DayIndex,e.Data=this.CallAcutionXOperator.Item,e.Ver=a.Ver,e}return n},this.GetLatestKLineData=function(r){var n=null,e=1,t;if(c.IsNonEmptyArray(this.MultiDayBeforeOpenData)){var a=this.MultiDayBeforeOpenData[this.MultiDayBeforeOpenData.length-1];a&&c.IsNonEmptyArray(a.Data)&&(e=a.Ver,n=a.Data[a.Data.length-1],t="MultiDayBeforeOpen")}else this.BeforeOpenData&&c.IsNonEmptyArray(this.BeforeOpenData.Data)&&(n=this.BeforeOpenData.Data[this.BeforeOpenData.Data.length-1],e=this.BeforeOpenData.Ver,t="BeforeOpen");var s=null,o=1,h;if(c.IsNonEmptyArray(this.MultiDayAfterCloseData)){var a=this.MultiDayAfterCloseData[this.MultiDayAfterCloseData.length-1];a&&c.IsNonEmptyArray(a.Data)&&(o=a.Ver,s=a.Data[a.Data.length-1],h="MultiDayAfterClose",a.Data.length==a.TotalCount&&(s=null))}else this.AfterOpenData&&c.IsNonEmptyArray(this.AfterOpenData.Data)&&(s=this.AfterOpenData.Data[this.AfterOpenData.Data.length-1],o=this.AfterOpenData.Ver,h="AfterClose");var l=null;if(this.Data&&c.IsNonEmptyArray(this.Data.Data)){var u=this.Data.Data.length;l=this.Data.Data[u-1]}return!n&&!s&&!l?null:r?l?n&&l&&(n.Date>l.Date||n.Date==l.Date&&n.Time>l.Time&&o==1)?{Type:2,Data:n,Ver:e,Explain:t}:s&&l&&s.Date>=l.Date?{Type:1,Data:s,Ver:o,Explain:h}:{Type:0,Data:l}:{Type:1,Data:n,Ver:e,Explain:t}:{Type:0,Data:l}},this.GetFormatTitle=function(r){if(!(!r||!r.Data)){var n=fe(this.Symbol),e=r.Data,t=r.IsLastOne,a=[];if(this.IsShowName&&a.push({Text:this.Name,Color:this.NameColor}),this.IsShowDate||this.IsShowTime){var s=!1;if(t&&this.ShowLastDataFormat==1&&this.Data&&this.Data.UpdateTime&&c.IsNumber(this.Data.UpdateTime.Date)&&c.IsNumber(this.Data.UpdateTime.Time)){var o=c.FormatTimeString(this.Data.UpdateTime.Time,"HH:MM:SS");a.push({Text:o,Color:this.DateTimeColor}),s=!0}if(!s)if(this.TimeFormat){var h=null,l=null,o=null;this.IsShowDate&&(h=c.FormatDateString("YYYY-MM-DD",e.Date)),this.IsShowTime&&(l=c.FormatTimeString(e.Time,this.TimeFormat)),h&&l?o=h+" "+l:h?o=h:l&&(o=l),o&&a.push({Text:o,Color:this.DateTimeColor})}else{var o=c.FormatDateTimeString(e.DateTime,this.IsShowDate,this.IsShowTime);a.push({Text:o,Color:this.DateTimeColor})}}var u=e.Close,f=e.Increase,C=e.Vol,D=e.Amount;if(c.IsNumber(u)){var v=this.GetColor(u,this.YClose),o=gt.GetText("MTitle-Close",this.LanguageID)+u.toFixed(n);a.push({Text:o,Color:v})}if(c.IsNumber(f)){var v=this.GetColor(f,0),o=gt.GetText("MTitle-Increase",this.LanguageID)+f.toFixed(2)+"%";a.push({Text:o,Color:v})}var S=!0,T=this.Symbol.toUpperCase();if((W.IsET(T)&&!W.IsETShowAvPrice(T)||W.IsShowAvPrice&&!W.IsShowAvPrice(T))&&(S=!1),c.IsNumber(e.AvPrice)&&S&&this.IsShowAveragePrice){var v=this.GetColor(e.AvPrice,this.YClose),o=gt.GetText("MTitle-AvPrice",this.LanguageID)+e.AvPrice.toFixed(n);a.push({Text:o,Color:v})}if(c.IsNumber(C)){var o=gt.GetText("MTitle-Vol",this.LanguageID)+c.FromatIntegerString(C,2,this.LanguageID);a.push({Text:o,Color:this.VolColor})}if(c.IsNumber(D)){var o=gt.GetText("MTitle-Amount",this.LanguageID)+c.FormatValueString(D,2,this.LanguageID);a.push({Text:o,Color:this.AmountColor})}if(c.IsNumber(e.Position)){var o=gt.GetText("MTitle-Position",this.LanguageID)+c.FromatIntegerString(e.Position,2,this.LanguageID);a.push({Text:o,Color:this.VolColor})}if(t&&this.ShowLastDataFormat==0&&this.Data&&this.Data.UpdateTime&&c.IsNumber(this.Data.UpdateTime.Date)&&c.IsNumber(this.Data.UpdateTime.Time)){var o=gt.GetText("MTitle-UpdateTime",this.LanguageID)+c.FormatTimeString(this.Data.UpdateTime.Time,"HH:MM:SS");a.push({Text:o,Color:this.DateTimeColor})}if(c.IsNonEmptyArray(this.OverlayChartPaint))for(var I=0;I<this.OverlayChartPaint.length;++I){var e=this.OverlayChartPaint[I];if(!(!e.Symbol||!e.Title)){var F=e.Color,o="["+e.Title+"]";a.push({Text:o,Color:F})}}return{AryText:a}}},this.DrawItem=function(r,n){if(r){var e=V(),t=this.Frame.IsHScreen===!0,a=this.Frame.GetBorder(),s=a.Left,o=a.Top-this.Frame.ChartBorder.Top/2;if(fe(this.Symbol),this.Canvas.font=this.Font,t){if(this.Frame.ChartBorder.Right<5*e)return;var s=2,o=this.Frame.ChartBorder.Right/2,h=a.ChartWidth,l=a.Top;this.Canvas.translate(h,l),this.Canvas.rotate(90*Math.PI/180)}else if(this.Frame.ChartBorder.Top<5*e)return;if(this.Canvas.textAlign="left",this.TitleBaseLine==0)this.Canvas.textBaseline="top",o=2*e;else if(this.TitleBaseLine==2){this.Canvas.textBaseline="bottom";var o=a.Top}else this.Canvas.textBaseline="middle";var u={Left:s,Bottom:o,IsHScreen:t},f=this.GetFormatTitle({Data:r,IsLastOne:n});if(f&&c.IsNonEmptyArray(f.AryText))for(var C=0;C<f.AryText.length;++C){var r=f.AryText[C];if(!this.DrawText(r.Text,r.Color,u))break}}},this.FormatCallAuctionTitle=function(r){var n=[],e=fe(this.Symbol);if(this.IsShowName&&n.push({Text:this.Name,Color:this.NameColor}),r&&r.Data){var t=r.Data,a,s,o;if(o=c.FormatDateString(t.Date),r.Ver==1?s=c.FormatTimeString(t.Time,"HH:MM"):s=c.FormatTimeString(t.Time,"HH:MM:SS"),r.Explain=="MultiDayBeforeOpen"||r.Explain=="MultiDayAfterClose"?a=o+" "+s:a=s,n.push({Text:a,Color:this.DateTimeColor}),c.IsNumber(t.Price)&&this.CallAuctionShowTitle.has("MTitle-AC-Price")){var h=this.GetColor(t.Price,this.YClose),l="MTitle-AC-Price";r.Ver==1&&(l="MTitle-Close");var a=gt.GetText(l,this.LanguageID)+t.Price.toFixed(e);n.push({Text:a,Color:h})}if(c.IsPlusNumber(this.YClose)&&c.IsNumber(t.Price)&&this.CallAuctionShowTitle.has("MTitle-AC-Increase")){var u=(t.Price-this.YClose)/this.YClose*100,h=this.GetColor(u,0),l="MTitle-AC-Increase";r.Ver==1&&(l="MTitle-Increase");var a=gt.GetText(l,this.LanguageID)+u.toFixed(2)+"%";n.push({Text:a,Color:h})}if(c.IsNumber(t.AvPrice)&&this.CallAuctionShowTitle.has("MTitle-AC-AvPrice")){var h=this.GetColor(t.AvPrice,this.YClose),a=gt.GetText("MTitle-AC-AvPrice",this.LanguageID)+t.AvPrice.toFixed(e);n.push({Text:a,Color:h})}if(c.IsNumber(t.Vol[0])&&this.CallAuctionShowTitle.has("MTitle-AC-Vol")){var l="MTitle-AC-Vol";r.Ver==1&&(l="MTitle-Vol");var a=gt.GetText(l,this.LanguageID)+c.FromatIntegerString(t.Vol[0],2);n.push({Text:a,Color:this.VolColor})}if(c.IsNumber(t.Vol[1])&&this.CallAuctionShowTitle.has("MTitle-AC-NotMatchVol")){var a=gt.GetText("MTitle-AC-NotMatchVol",this.LanguageID)+c.FromatIntegerString(t.Vol[1],2);n.push({Text:a,Color:this.VolColor})}if(t.ExtendData&&c.IsNonEmptyArray(t.ExtendData.Amount)){var f=t.ExtendData.Amount;if(c.IsNumber(f[0])&&this.CallAuctionShowTitle.has("MTitle-AC-Amount")){var a=gt.GetText("MTitle-AC-Amount",this.LanguageID)+c.FromatIntegerString(f[0],2);n.push({Text:a,Color:this.AmountColor})}if(c.IsNumber(f[1])&&this.CallAuctionShowTitle.has("MTitle-AC-NotMatchAmount")){var a=gt.GetText("MTitle-AC-NotMatchAmount",this.LanguageID)+c.FromatIntegerString(f[1],2);n.push({Text:a,Color:this.AmountColor})}}}return{AryText:n}},this.DrawCallAuction=function(){var r=this.Frame.IsHScreen===!0,n=this.Frame.GetBorder(),e=V(),t=n.Left,a=n.Top-this.Frame.ChartBorder.Top/2,s=!0;if(r){if(this.Frame.ChartBorder.Right<5*e)return;var t=2,a=this.Frame.ChartBorder.Right/2,o=n.ChartWidth,h=n.Top;this.Canvas.translate(o,h),this.Canvas.rotate(90*Math.PI/180)}else this.Frame.ChartBorder.Top<5&&(s=!1);if(this.Canvas.textAlign="left",this.Canvas.font=this.Font,this.TitleBaseLine==0)this.Canvas.textBaseline="top",a=2*e;else if(this.TitleBaseLine==2){this.Canvas.textBaseline="bottom";var a=n.Top}else this.Canvas.textBaseline="middle";var l={Left:t,Bottom:a,IsHScreen:r},u=this.GetCurrentAuctionData(),f=this.FormatCallAuctionTitle(u);if(s&&f&&c.IsNonEmptyArray(f.AryText))for(var C=0;C<f.AryText.length;++C){var D=f.AryText[C];if(!this.DrawText(D.Text,D.Color,l))break}this.OnDrawCallAuctionEventCallback(u)},this.OnDrawCallAuctionEventCallback=function(r){if(this.OnDrawEvent&&this.OnDrawEvent.Callback){var n={Draw:r,Name:this.ClassName};this.OnDrawEvent.Callback(this.OnDrawEvent,n,this)}if(this.OnMouseMoveEvent&&this.OnMouseMoveEvent.Callback){var n={Draw:r,Name:this.ClassName};this.OnMouseMoveEvent.Callback(this.OnDrawEvent,n,this)}},this.DrawNone=function(){this.OnDrawEventCallback(null),this.IsAlwaysShowLastData&&(this.Canvas.save(),this.DrawLastDataItem(),this.Canvas.restore())},this.Draw=function(){if(this.LastShowData=null,this.GlobalOption=this.Frame.GlobalOption,!this.IsShow){var r=this.OnDrawEvent&&this.OnDrawEvent.Callback||this.OnMouseMoveEvent&&this.OnMouseMoveEvent.Callback;if(!r)return}if(this.PointInfo&&(this.PointInfo.ClientPos==2||this.PointInfo.ClientPos==3||this.PointInfo.ClientPos>=200&&this.PointInfo.ClientPos<=299||this.PointInfo.ClientPos>=300&&this.PointInfo.ClientPos<=399)){this.Canvas.save(),this.DrawCallAuction(),this.Canvas.restore();return}if(!this.Data||!this.Data.Data||this.Data.Data.length<=0){this.DrawNone();return}if(this.CursorIndex==null&&!(this.GlobalOption&&this.GlobalOption.IsDisplayLatest)){this.DrawNone();return}this.Canvas.font=this.Font,this.SpaceWidth=this.Canvas.measureText("0").width;var n=!1;if(this.DrawStatus&&this.DrawStatus.IsTitleShowLatestData){var e=this.DrawStatus;(!c.IsNumber(e.FrameID)||e.FrameID<0||e.CorssCursorTouchEnd&&e.IsOnTouch==!1)&&(n=!0)}else this.GlobalOption&&this.GlobalOption.IsDisplayLatest&&(n=!0);var t=!1;if(n){var a=null,s=this.GetLatestKLineData(!0);s&&s.Type==0&&(a=s.Data),t=!0}else{var o=this.CursorIndex;o=parseInt(o.toFixed(0));var h=o+this.Data.DataOffset;h>=this.Data.Data.length&&(h=this.Data.Data.length-1);var a=this.Data.Data[h];h==this.Data.Data.length-1&&(t=!0)}this.LastShowData=a,this.Canvas.save(),this.OnDrawEventCallback(a),this.IsAlwaysShowLastData?this.DrawLastDataItem():this.DrawItem(a,t),this.Canvas.restore()},this.DrawCallAuctionItem=function(r,n){if(r){var e=r.Data;r.Ver;var t=this.Frame.IsHScreen===!0,a=this.Frame.GetBorder(),s=a.Left,o=a.Top-this.Frame.ChartBorder.Top/2,h=!0;if(t){var s=2,o=this.Frame.ChartBorder.Right/2,l=a.ChartWidth,u=a.Top;this.Canvas.translate(l,u),this.Canvas.rotate(90*Math.PI/180)}else this.Frame.ChartBorder.Top<5&&(h=!1);if(this.Canvas.textAlign="left",this.Canvas.font=this.Font,this.TitleBaseLine==0)this.Canvas.textBaseline="top",o=2*V();else if(this.TitleBaseLine==2){this.Canvas.textBaseline="bottom";var o=a.Top}else this.Canvas.textBaseline="middle";var f={Left:s,Bottom:o,IsHScreen:t},C=this.FormatCallAuctionTitle(r);if(h&&C&&c.IsNonEmptyArray(C.AryText))for(var D=0;D<C.AryText.length;++D){var e=C.AryText[D];if(!this.DrawText(e.Text,e.Color,f))break}}},this.DrawLastDataItem=function(){var r=this.GetLatestKLineData(!0);r&&(r.Type==0?this.DrawItem(r.Data,!0):(r.Type==1||r.Type==2)&&this.DrawCallAuctionItem(r,!0))}}var wa={DEFAULT:1,ORIGINAL:2,INTEGER:3,THOUSANDS:21};function kt(r,n,e){this.Data=r,this.Name=n,this.Color=e,this.DataType,this.ChartClassName,this.StringFormat=wa.DEFAULT,this.FloatPrecision=2,this.IsShow=!0,this.Callback}function za(){this.newMethod=kh,this.newMethod(),delete this.newMethod,this.ClassName="DynamicChartTitlePainting",this.IsDynamic=!0,this.Data=[],this.Explain,this.ColorIndex,this.IsShowColorIndexTitle=!0,this.IsShowUpDownArrow=!0,this.IsShowIndexName=!0,this.IsShowIndexTitle=!0,this.IsShowNameArrow=!1,this.TradeIndex,this.IsShowTradeIndexTitle=!0,this.OverlayIndex=new Dt.default,this.IsShowOverlayIndexName=!0,this.OverlayIndexType={Position:0,LineSpace:5,BGColor:m.OverlayIndexTitleBGColor},this.LanguageID=ke.LANGUAGE_CHINESE_ID,this.TitleRect,this.IsDrawTitleBG=!1,this.BGColor=m.IndexTitleBGColor,this.BGBorderColor=m.IndexTitleBorderColor,this.BGBorderMoveOnColor=m.IndexTitleBorderMoveOnColor,this.BorderRoundRadius=2,this.OnDrawEvent,this.ParamSpace=2,this.TitleSpace=2,this.TitleColor=m.IndexTitleColor,this.SelectedColor=m.IndexTitleSelectedColor,this.IsKLineFrame=!1,this.Identify,this.SelectedChart,this.ArgumentsText,this.MerginLeft=m.IndexTitleMerginLeft,this.Buttons=[],this.DynamicTitle={OutName:null,OutValue:null},this.OverlayDynamicTitle=new Dt.default,this.ReloadResource=function(){this.Font=m.TitleFont,this.TitleColor=m.DefaultTextColor,this.OverlayIndexType.BGColor=m.OverlayIndexTitleBGColor},this.SetDynamicTitleData=function(r,n,e){e.OutName?e.OutName.clear():e.OutName=new Dt.default,e.OutValue?e.OutValue.clear():e.OutValue=new Dt.default;var t=new Dt.default;for(var a in n){var s=n[a];t.set("{"+s.Name+"}",s)}for(var a in r){var s=r[a];if(s.DynamicName){var o=s.DynamicName.match(/{\w*}/i);if(!o||o.length<=0)e.OutName.set(s.Name,s.DynamicName);else{for(var h=s.DynamicName,l=!0,u=0;u<o.length;++u){var f=o[u];if(t.has(f)){var C=t.get(f).Value;h=h.replace(f,C.toString())}else{l=!1;break}}l&&e.OutName.set(s.Name,h)}}s.DynamicValue&&e.OutValue.set(s.Name,s.DynamicValue)}},this.SetDynamicTitle=function(r,n,e){if(c.IsString(e)){var t=null;this.OverlayDynamicTitle.has(e)?t=this.OverlayDynamicTitle.get(e):(t={OutName:null,OutValue:null},this.OverlayDynamicTitle.set(e,t)),this.SetDynamicTitleData(r,n,t)}else this.SetDynamicTitleData(r,n,this.DynamicTitle)},this.GetDynamicOutName=function(r,n){if(c.IsString(n)){if(!this.OverlayDynamicTitle.has(n))return null;var e=this.OverlayDynamicTitle.get(n),t=e.OutName}else var t=this.DynamicTitle.OutName;return!t||t.size<=0||!t.has(r)?null:t.get(r)},this.GetDynamicOutValue=function(r,n){var e=this.DynamicTitle.OutValue;if(!e||e.size<=0||!e.has(r))return null;var t=e.get(r);return t=t.replace("{Value}",n),t},this.IsClickTitle=function(r,n){return this.TitleRect?r>this.TitleRect.Left&&r<this.TitleRect.Left+this.TitleRect.Width&&n>this.TitleRect.Top&&n<this.TitleRect.Top+this.TitleRect.Height:!1},this.FormatValue=function(r,n){if(n.StringFormat==wa.DEFAULT)return c.FormatValueString(r,n.FloatPrecision,this.LanguageID);if(n.StringFormat==wa.THOUSANDS)return c.FormatValueThousandsString(r,n.FloatPrecision);if(n.StringFormat==wa.ORIGINAL)return r.toFixed(n.FloatPrecision).toString();if(n.StringFormat==wa.INTEGER)return c.FromatIntegerString(r,n.FloatPrecision,this.LanguageID)},this.FormatMultiReport=function(r,n){var e="";for(var t in r){var a=r[t],s=a.Quarter,o=a.Year,h=a.Value;switch(e.length>0&&(e+=","),e+=o.toString(),s){case 1:e+="一季报 ";break;case 2:e+="半年报 ";break;case 3:e+="三季报 ";break;case 4:e+="年报 ";break}e+=this.FormatValue(h,n)}return e},this.FromatMultiDataLine=function(r,n){var e="";if(Array.isArray(r))for(var t=0;t<r.length;++t){var a=r[t];if(a.Type!=0&&c.IsNumber(a.Value)){var s=this.FormatValue(a.Value,n);e.length>0&&(e+=","),e+=s}}else r.Type!=0&&c.IsNumber(r.Value)&&(e=this.FormatValue(r.Value,n));return e.length<=0?null:e},this.FromatStackedBarTitle=function(r,n){if(!c.IsNonEmptyArray(r)||!c.IsNonEmptyArray(n.Color))return null;for(var e=[],t=0;t<r.length;++t){var a=r[t];if(c.IsNumber(a)){var s={Text:a.toFixed(2)};n.Name&&n.Name[t]&&(s.Name=n.Name[t]),s.Color=n.Color[t],e.push(s)}}return e.length<=0?null:e},this.ForamtMultiLineTitle=function(r,n){if(!c.IsNonEmptyArray(n.Lines))return null;for(var e=[],t=0;t<n.Lines.length;++t)for(var a=n.Lines[t],s=0;s<a.Point.length;++s){var o=a.Point[s];if(o.Index==r){var o={Text:o.Value.toFixed(2)};e.length==0&&(o.Name=n.Name),o.Color=a.Color,e.push(o);break}}return c.IsNonEmptyArray(e)?e:null},this.ForamtMultiPointTitle=function(r,n){if(!c.IsNonEmptyArray(n.PointGroup))return null;for(var e=[],t=0;t<n.PointGroup.length;++t)for(var a=n.PointGroup[t],s=0;s<a.Point.length;++s){var o=a.Point[s];if(o.Index==r){var o={Text:o.Value.toFixed(2)};e.length==0&&(o.Name=n.Name),o.Color=a.BGColor,e.push(o);break}}return c.IsNonEmptyArray(e)?e:null},this.FormatVPVRTitle=function(r,n){var e=n.Chart,t=[];if(e.VolType==0){var a={Text:" Up/Down ",Color:this.TitleColor};t.push(a)}else{var a={Text:" Total ",Color:this.TitleColor};t.push(a)}if(!c.IsNumber(r.Y))return t;var s=this.Frame.ChartBorder.GetTopEx(),o=this.Frame.ChartBorder.GetBottomEx();if(r.Y<s||r.Y>o)return t;for(var h=this.Frame.GetYData(r.Y),l=null,u=0;u<n.Data.Data.length;++u){var a=n.Data.Data[u];if(h>=a.Price-n.Data.PriceOffset/2&&h<a.Price+n.Data.PriceOffset/2){l=a;break}}if(!l)return null;if(e.VolType==0){for(var f=0,u=0;u<l.Vol.length;++u){var C=l.Vol[u];if(c.IsNumber(C.Value)){var a={Text:c.FormatVolString(C.Value,this.LanguageID)};f+=C.Value,c.IsNumber(C.ColorID)?a.Color=e.BarColor[C.ColorID]:C.Color&&(a.Color=C.Color),t.push(a)}}var a={Text:c.FormatVolString(f,this.LanguageID),Color:this.TitleColor};t.push(a)}else if(l.TotalVol&&c.IsNumber(l.TotalVol.Value)){var a={Text:c.FormatVolString(l.TotalVol.Value,this.LanguageID)};c.IsNumber(l.TotalVol.ColorID)?a.Color=e.BarColor[l.TotalVol.ColorID]:l.TotalVol.Color&&(a.Color=l.TotalVol.Color),t.push(a)}return t},this.IsShowLastData=function(){var r=!1;if(this.DrawStatus&&this.DrawStatus.IsTitleShowLatestData){var n=this.DrawStatus;(!c.IsNumber(n.FrameID)||n.FrameID<0||n.CorssCursorTouchEnd&&n.IsOnTouch==!1)&&(r=!0)}else this.GlobalOption&&this.GlobalOption.IsDisplayLatest&&(r=!0);return r},this.OnDrawTitleEvent=function(){var r=this.GetEventCallback(et.ON_INDEXTITLE_DRAW);if(r){var n={Index:null,Data:this.Data,Title:this.Title,Script:this.Script,FrameID:this.Frame.Identify,OverlayIndex:this.OverlayIndex,IsShowTitleOnly:!1};if(this.ArgumentsText&&(n.ArgumentsText=this.ArgumentsText),this.Frame&&this.Frame.ChartBorder&&(n.IsShowTitleOnly=this.Frame.ChartBorder.IsShowTitleOnly),c.IsNumber(this.CursorIndex)){var e=Math.abs(this.CursorIndex);e=parseInt(e.toFixed(0)),n.Index=e}var t=V(),a=this.Frame.GetBorder();n.Left=a.LeftEx/t,n.Top=a.Top/t,n.Right=a.RightEx/t,r.Callback(r,n,this)}},this.IsSelectedChart=function(r){return!r||!this.SelectedChart||!this.SelectedChart.Selected?!1:this.SelectedChart.Selected.Identify==r},this.Draw=function(r,n){if(this.Buttons=[],!this.Frame.IsMinSize&&(this.IsKLineFrame=this.Frame.ClassName=="KLineFrame"||this.Frame.ClassName=="KLineHScreenFrame",this.IsDrawTitleBG=this.Frame.IsDrawTitleBG,this.IsShowNameArrow=this.Frame.IsShowNameArrow,this.IsShowUpDownArrow=this.Frame.IsShowTitleArraw,this.IsShowIndexName=this.Frame.IsShowIndexName,this.IsShowOverlayIndexName=this.Frame.IsShowOverlayIndexName,this.OverlayIndexType.Position=this.Frame.OverlayIndexType.Position,this.OverlayIndexType.LineSpace=this.Frame.OverlayIndexType.LineSpace,this.ParamSpace=this.Frame.IndexParamSpace,this.TitleSpace=this.Frame.IndexTitleSpace,this.TitleRect=null,this.GlobalOption=this.Frame.GlobalOption,this.OnDrawTitleEvent(),this.Frame.IsShowIndexTitle!=!1&&m.IsDOMFrameTitle!==!0&&this.Data&&!(this.Frame.ChartBorder.TitleHeight<5)&&!(this.CursorIndex==null&&!(this.GlobalOption&&this.GlobalOption.IsDisplayLatest)))){if(this.Frame.IsHScreen===!0){this.Canvas.save(),this.HScreenDraw(),this.Canvas.restore();return}var e=this.Frame.ChartBorder.GetLeft()+this.MerginLeft,t=this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.TitleHeight/2,a=this.Frame.ChartBorder.GetRight(),s={Width:0,YCenter:t};this.DrawToolbar(s,r,n),e+=s.Width,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font;var o=V();if(this.Title&&this.IsShowIndexName)if(this.IsDrawTitleBG){var h={Left:e,YCenter:t,Width:0};this.DrawNameButton(h,r,n),this.Buttons.push({ID:xt.INDEX_NAME_BUTTON,Rect:h,FrameID:this.Frame.Identify,Type:2}),this.IsSelectedChart(this.Identify)&&this.DrawSelectedLine(e,t,l),this.TitleRect=h,e+=h.Width+3*o,e+=this.TitleSpace}else{var l=this.Canvas.measureText(this.Title).width+2;this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(this.Title,e,t,l),this.IsSelectedChart(this.Identify)&&this.DrawSelectedLine(e,t,l),e+=l,e+=this.TitleSpace}if(this.ArgumentsText&&this.IsShowIndexName){var l=this.Canvas.measureText(this.ArgumentsText).width+2;this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(this.ArgumentsText,e,t,l),e+=l,e+=this.TitleSpace}var u=this.IsShowLastData(),f=this.Frame.GetLockRect();if(f){var C=Math.abs(this.CursorIndex);this.IsKLineFrame&&(C=this.CursorIndex);var D=this.Frame.GetXFromIndex(C.toFixed(0));if(D>=f.Left||u)return}for(var v=0;v<this.Data.length;++v){var S=this.Data[v],T=this.GetTitleItem(S,u,v);if(T){var I=T.Text,F=T.ArrayText;if(F)for(var E,M=0;M<F.length;++M){var O=F[M];O.Name?E=O.Name+":"+O.Text:E=O.Text;var R=this.ParamSpace*V(),l=this.Canvas.measureText(E).width+R;if(e+l>a)break;if(O.BG){var b=this.Canvas.measureText("擎").width+2,l=this.Canvas.measureText(E).width+2,p={Left:e,Top:t-b/2,Width:l,Height:b};this.Canvas.fillStyle=O.BG,this.Canvas.fillRect(p.Left,p.Top-1,p.Width,p.Height),this.Canvas.fillStyle=O.Color,this.Canvas.fillText(E,p.Left+1,t,l),e+=l+R}else this.Canvas.fillStyle=O.Color,this.Canvas.fillText(E,e,t,l),e+=l}else{this.Canvas.fillStyle=S.Color;var E=I;if(S.Name){var G=this.GetDynamicOutName(S.Name);G?E=G+":"+I:E=S.Name+":"+I}var R=this.ParamSpace*V(),l=this.Canvas.measureText(E).width+R;if(e+l>a)break;this.Canvas.fillText(E,e,t,l),e+=l}}}if(this.Explain){this.Canvas.fillStyle=this.TitleColor;var E="说明:"+this.Explain,l=this.Canvas.measureText(E).width+2;e+l<a&&(this.Canvas.fillText(E,e,t,l),e+=l)}if(this.ColorIndex&&this.IsShowColorIndexTitle){this.Canvas.fillStyle=m.Title.ColorIndexColor;var Y=this.ColorIndex.Name+this.ColorIndex.Param,l=this.Canvas.measureText(Y).width+2;this.Canvas.fillText(Y,e,t,l),e+=l}if(this.TradeIndex&&this.IsShowTradeIndexTitle){this.Canvas.fillStyle=m.Title.TradeIndexColor;var Y=this.TradeIndex.Name+this.TradeIndex.Param,l=this.Canvas.measureText(Y).width+2;this.Canvas.fillText(Y,e,t,l),e+=l}this.OverlayIndexType.Position==1?this.Frame.ChartBorder.IsShowTitleOnly||this.DrawOverlayIndexSingleLine(r,n):this.DrawOverlayIndex(e+10*V())}},this.GetTitleItem=function(r,n,e){if(!r||!r.Data||!r.Data.Data||Array.isArray(r.Data.Data)&&r.Data.Data.length<=0||r.IsShow===!1)return null;var t=null,a=null,s=null,o=null;if(r.DataType=="StraightLine")s=r.Data.Data[0],t=this.FormatValue(s,r);else{if(r.ChartClassName=="ChartVolProfileVisibleRange")return a=this.FormatVPVRTitle(this.LastPoint,r),a?{Text:null,ArrayText:a}:null;if(n)var h=r.Data.Data.length-1;else{var l=Math.abs(this.CursorIndex);l=parseInt(l.toFixed(0)),this.IsKLineFrame&&(l=this.CursorIndex);var h=r.Data.DataOffset+l;if(h>=r.Data.Data.length&&(h=r.Data.Data.length-1),h<0)return null}if(r.DataType=="ChartMultiLine")return a=this.ForamtMultiLineTitle(h,r),a?{Text:null,ArrayText:a}:null;if(r.DataType=="ChartMultiPoint")return a=this.ForamtMultiPointTitle(h,r),a?{Text:null,ArrayText:a}:null;if(s=r.Data.Data[h],s==null&&r.ChartClassName=="ChartStepLine"){if(o=this.GetPreVaildItem(r.Data.Data,h),!o)return null;if(preText=this.FormatValue(o.Item,r),r.Name){var u=this.GetDynamicOutValue(r.Name,preText);u&&(preText=u)}return t="--("+preText+")",{Text:t,ArrayText:a}}if(s==null)return null;if(r.DataType=="HistoryData-Vol")s=s.Vol,t=this.FormatValue(s,r);else if(r.DataType=="MultiReport")t=this.FormatMultiReport(s,r);else if(r.DataType=="MULTI_POINT_LINE"){if(t=this.FromatMultiDataLine(s,r),!t)return null}else{if(r.DataType=="ChartStackedBar")return a=this.FromatStackedBarTitle(s,r),a?{Text:null,ArrayText:a}:null;if(Qi.Has(r.DataType)){var f=Qi.Get(r.DataType);if(f&&f.FormatTitleCallback)return f.FormatTitleCallback(s,r,h)}else{if(this.GetEventCallback){var C=this.GetEventCallback(et.ON_FORMAT_INDEX_OUT_TEXT);if(C){var D={Item:r,Index:e,Data:this.Data,FrameID:this.Frame.Identify,DataIndex:h,Value:s,Out:null};if(C.Callback(C,D,this),D.Out)return D.Out}}var v=null;if(this.IsShowUpDownArrow){var S=null;h-1>=0&&(S=r.Data.Data[h-1]),c.IsNumber(S)&&(S>s?v="↓":S<s?v="↑":v="→")}if(t=this.FormatValue(s,r),r.Name){var u=this.GetDynamicOutValue(r.Name,t);u&&(t=u)}v&&(t+=v)}}}return{Text:t,ArrayText:a}},this.GetPreVaildItem=function(r,n){for(var e=n;e>=0;--e){var t=r[e];if(t)return{Item:t,Index:e}}return null},this.DrawSelectedLine=function(r,n,e){this.Canvas.save();var t=this.GetFontHeight();this.Canvas.strokeStyle=this.SelectedColor;var a=4,s=he(a,n+t/2);this.Canvas.lineWidth=a,this.Canvas.beginPath(),this.Canvas.moveTo(r,s),this.Canvas.lineTo(r+e,s),this.Canvas.stroke(),this.Canvas.restore()},this.DrawOverlayIndexSingleLine=function(r,n){var e=V(),t=this.Frame.GetBorder();if(this.Frame.IsHScreen===!0)var a=1,s=2*e,o=this.Frame.ChartBorder.GetHeight(),h=this.Frame.ChartBorder.GetWidthEx();else var s=t.TopTitle+2*e,a=this.Frame.ChartBorder.GetLeft()+this.MerginLeft,o=t.Right,h=t.Bottom;var l=this.OverlayIndexType.LineSpace*e,u=a,f=s,C=Aa(this.Canvas,this.Font,"擎");f=s+C/2;var D=!0,v=!1,S=void 0;try{for(var T=(0,we.default)(this.OverlayIndex),I;!(D=(I=T.next()).done);D=!0){p=I.value;var F=p[1],E=p[0],M={Width:0,YCenter:f,ID:E};if(this.DrawOverlayToolbar(F,M,r,n),!!F.Frame.IsShowIndexTitle){if(u=a+M.Width,this.Canvas.font=this.Font,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",F.Title&&this.IsShowOverlayIndexName){var O=this.Canvas.measureText(F.Title).width+2;if(u+O<o){if(this.OverlayIndexType.BGColor){this.Canvas.fillStyle=this.OverlayIndexType.BGColor;var R={Left:u,Top:f-C/2,Width:O,Height:C+l};this.Canvas.fillRect(R.Left,R.Top,R.Width,R.Height)}this.IsSelectedChart(E)&&this.DrawSelectedLine(u,f,O,F.Title),this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(F.Title,u,f,O)}u+=O}for(var b=0;b<F.Data.length;++b){var p=F.Data[b];if(!(!p||!p.Data||!p.Data.Data||!p.Name)&&!(p.Data.Data.length<=0)){var G=null,Y=null,Q=null;if(p.DataType=="StraightLine")G=p.Data.Data[0],Y=this.FormatValue(G,p);else{var ht=Math.abs(this.CursorIndex-.5);ht=parseInt(ht.toFixed(0)),this.IsKLineFrame&&(ht=this.CursorIndex);var Ct=p.Data.DataOffset+ht;if(Ct>=p.Data.Data.length&&(Ct=p.Data.Data.length-1),Ct<0||(G=p.Data.Data[Ct],G==null))continue;if(p.DataType=="HistoryData-Vol")G=G.Vol,Y=this.FormatValue(G,p);else if(p.DataType=="MultiReport")Y=this.FormatMultiReport(G,p);else if(p.DataType=="ChartStackedBar"){if(Q=this.FromatStackedBarTitle(G,p),!Q)continue}else Y=this.FormatValue(G,p)}if(Q)for(var lt,dt=0;dt<Q.length;++dt){var Ut=Q[dt];Ut.Name?lt=Ut.Name+":"+Ut.Text:lt=Ut.Text;var O=this.Canvas.measureText(lt).width+2;if(u+O>o)break;if(this.OverlayIndexType.BGColor){this.Canvas.fillStyle=this.OverlayIndexType.BGColor;var R={Left:u,Top:f-C/2,Width:O,Height:C+l};this.Canvas.fillRect(R.Left,R.Top,R.Width,R.Height)}this.Canvas.fillStyle=Ut.Color,this.Canvas.fillText(lt,u,f,O),u+=O}else{var lt=Y;if(p.Name){var Wt=this.GetDynamicOutName(p.Name,E);Wt?lt=Wt+":"+Y:lt=p.Name+":"+Y}var O=this.Canvas.measureText(lt).width+2;if(u+O>o)break;if(this.OverlayIndexType.BGColor){this.Canvas.fillStyle=this.OverlayIndexType.BGColor;var R={Left:u,Top:f-C/2,Width:O,Height:C+l};this.Canvas.fillRect(R.Left,R.Top,R.Width,R.Height)}this.Canvas.fillStyle=p.Color,this.Canvas.fillText(lt,u,f,O),u+=O}}}if(f+=C+l,f+C+l>=h)break}}}catch(Qt){v=!0,S=Qt}finally{try{!D&&T.return&&T.return()}finally{if(v)throw S}}},this.DrawOverlayIndex=function(r){var n=this.Frame.ChartBorder.GetTop()+this.Frame.ChartBorder.TitleHeight/2,e=this.Frame.ChartBorder.GetRight();if(this.Frame.IsHScreen===!0&&(n=-this.Frame.ChartBorder.TitleHeight/2,e=this.Frame.ChartBorder.GetHeight()),!(r>e)){var t=5*V(),a=r,s=!0,o=!1,h=void 0;try{for(var l=(0,we.default)(this.OverlayIndex),u;!(s=(u=l.next()).done);s=!0){S=u.value,r+=t;var f=S[1],C=S[0];if(f.Title&&this.IsShowOverlayIndexName){this.Canvas.fillStyle=this.TitleColor;var D=this.Canvas.measureText(f.Title).width+2;if(a=r,r+=D,r>e)break;this.Canvas.fillText(f.Title,a,n,D),this.IsSelectedChart(C)&&this.DrawSelectedLine(a,n,D)}for(var v in f.Data){var S=f.Data[v];if(!(!S||!S.Data||!S.Data.Data||!S.Name)&&!(S.Data.Data.length<=0)){var T=null,I=null;if(S.DataType=="StraightLine")T=S.Data.Data[0],I=this.FormatValue(T,S);else{var F=Math.abs(this.CursorIndex-.5);F=parseInt(F.toFixed(0)),this.IsKLineFrame&&(F=this.CursorIndex);var E=S.Data.DataOffset+F;if(E>=S.Data.Data.length&&(E=S.Data.Data.length-1),E<0||(T=S.Data.Data[E],T==null))continue;S.DataType=="HistoryData-Vol"?(T=T.Vol,I=this.FormatValue(T,S)):S.DataType=="MultiReport"?I=this.FormatMultiReport(T,S):I=this.FormatValue(T,S)}this.Canvas.fillStyle=S.Color;var M=S.Name+":"+I,D=this.Canvas.measureText(M).width+2;if(a=r,r+=D,r>e)break;this.Canvas.fillText(M,a,n,D)}}if(r>e)break}}catch(O){o=!0,h=O}finally{try{!s&&l.return&&l.return()}finally{if(o)throw h}}}},this.HScreenDraw=function(){var r=this.Frame.ChartBorder.GetHScreenBorder(),n=this.Frame.ChartBorder.GetRightTitle(),e=r.TopEx;this.Canvas.translate(n,e),this.Canvas.rotate(90*Math.PI/180);var t=1,a=-this.Frame.ChartBorder.TitleHeight/2,s=this.Frame.ChartBorder.GetHeight();this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.font=this.Font;var o=V();if(this.Title&&this.IsShowIndexName){var h=this.Canvas.measureText(this.Title).width+2;if(this.IsDrawTitleBG){var l=this.Title;this.IsShowNameArrow&&(l+="▼");var h=this.Canvas.measureText(l).width,u=this.Canvas.measureText("擎").width+4*o,f=h+4*o;this.TitleRect={Top:r.Top,Left:this.Frame.ChartBorder.GetRightTitle()+this.Frame.ChartBorder.TitleHeight/2-u/2,Width:u,Height:f},this.Canvas.fillStyle=this.BGColor;var C={Left:t,Top:a-u/2,Width:f,Height:u};this.Canvas.fillRect(C.Left,C.Top,C.Width,C.Height),this.BGBorderColor&&(this.Canvas.strokeStyle=this.BGBorderColor,this.Canvas.strokeRect(L(C.Left),L(C.Top),B(C.Width),B(C.Height))),this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(l,t+2*o,a,h),t+=f+2*o,t+=this.TitleSpace}else this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(this.Title,t,a,h),t+=h,t+=this.TitleSpace}if(this.ArgumentsText&&this.IsShowIndexName){var h=this.Canvas.measureText(this.ArgumentsText).width+2;this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(this.ArgumentsText,t,a,h),t+=h,t+=this.TitleSpace}var D=this.IsShowLastData(),v=this.Frame.GetLockRect();if(v){var S=Math.abs(this.CursorIndex-.5);this.IsKLineFrame&&(S=this.CursorIndex);var T=this.Frame.GetXFromIndex(S.toFixed(0));if(T>=v.Top||D)return}for(var I in this.Data){var F=this.Data[I],E=this.GetTitleItem(F,D);if(E){var M=E.Text,O=E.ArrayText;if(O)for(var R,b=0;b<O.length;++b){var p=O[b];p.Name?R=p.Name+":"+p.Text:R=p.Text;var G=this.ParamSpace*V(),h=this.Canvas.measureText(R).width+G;if(t+h>s)break;this.Canvas.fillStyle=p.Color,this.Canvas.fillText(R,t,a,h),t+=h}else{this.Canvas.fillStyle=F.Color;var R=M;if(F.Name){var Y=this.GetDynamicOutName(F.Name);Y?R=Y+":"+M:R=F.Name+":"+M}var G=this.ParamSpace*V(),h=this.Canvas.measureText(R).width+G;if(t+h>s)break;this.Canvas.fillText(R,t,a,h),t+=h}}}if(this.Explain){this.Canvas.fillStyle=this.TitleColor;var R="说明:"+this.Explain,h=this.Canvas.measureText(R).width+2;t+h<s&&(this.Canvas.fillText(R,t,a,h),t+=h)}this.OverlayIndexType.Position==1?this.Frame.ChartBorder.IsShowTitleOnly||this.DrawOverlayIndexSingleLine():this.DrawOverlayIndex(t+5*V())},this.OnDrawEventCallback=function(r){if(!(!this.OnDrawEvent||!this.OnDrawEvent.Callback)){var n={Draw:r,Name:"DynamicChartTitlePainting"};this.OnDrawEvent.Callback(this.OnDrawEvent,n,this)}},this.GetFontHeight=function(r){return Aa(this.Canvas,r,"擎")},this.DrawNameButton=function(r,n,e){var t=V(),a=this.Title;this.IsShowNameArrow&&(a+="▼");var s=this.Canvas.measureText(a).width,o=this.Canvas.measureText("擎").width+4*t,h=this.BorderRoundRadius*t,l=s+4*t+h*2;r.Top=r.YCenter-o/2-1,r.Width=l,r.Height=o,r.Right=r.Left+r.Width,r.Bottom=r.Top+r.Height;var u=this.BGBorderColor;if(n&&n.X>=r.Left&&n.X<r.Right&&n.Y>=r.Top&&n.Y<=r.Bottom&&(this.BGBorderMoveOnColor&&(u=this.BGBorderMoveOnColor),e)){var f={ID:xt.INDEX_NAME_BUTTON};e.MouseOnToolbar={ID:"IndexNameButton",Rect:r,Item:f,Frame:this.Frame,Point:{X:n.X,Y:n.Y}}}this.Canvas.beginPath(),this.Canvas.roundRect(L(r.Left),L(r.Top),B(r.Width),B(r.Height),[h]),this.Canvas.closePath(),this.Canvas.fillStyle=this.BGColor,this.Canvas.fill(),u&&(this.Canvas.strokeStyle=u,this.Canvas.stroke()),this.Canvas.fillStyle=this.TitleColor,this.Canvas.fillText(a,r.Left+h+2*t,r.YCenter,s)},this.DrawButton=function(r,n,e,t){var a=r.Style.Size;c.IsNumber(r.Style.YMoveOffset)&&(n.YCenter+=r.Style.YMoveOffset);var s=a+"px "+r.Style.Family;n.Top=n.YCenter-a/2,n.Width=a+r.Style.MerginLeft,n.Height=a,n.Bottom=n.Top+n.Height,n.Right=n.Left+n.Width;var o=r.Style.Color;return e&&e.X>=n.Left&&e.X<n.Right&&e.Y>=n.Top&&e.Y<=n.Bottom&&(o=r.Style.MoveOnColor,t&&(t.MouseOnToolbar={ID:"TitleButton",Rect:n,Item:r,Frame:this.Frame,Point:{X:e.X,Y:e.Y}})),this.Canvas.fillStyle=o,this.Canvas.font=s,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(r.Style.Text,n.Left,n.YCenter),!0},this.DrawToolbar=function(r,n,e){if(r.Width=0,!(!this.Frame||!this.Frame.GetLeftToolbar)){var t=this.Frame.GetLeftToolbar();if(c.IsNonEmptyArray(t)&&this.Frame.IsHScreen!==!0){var a=this.Frame.GetBorder();a.Right-3;for(var s=a.Left+3,o=r.YCenter,h=0;h<t.length;++h){var l=t[h],u={Left:s,YCenter:o};this.DrawButton(l,u,n,e),this.Buttons.push({ID:l.ID,Rect:u,FrameID:this.Frame.Identify,Type:0}),s=u.Right,r.Width+=u.Width}r.Width>0&&(r.Width+=3)}}},this.DrawOverlayToolbar=function(r,n,e,t){if(n.Width=0,!(!r||!r.Frame||!r.Frame.GetLeftToolbar)){var a=r.Frame,s=a.GetLeftToolbar({Overlay:r,OverlayID:n.ID});if(c.IsNonEmptyArray(s)&&this.Frame.IsHScreen!==!0){var o=a.GetBorder();o.Right-3;for(var h=o.Left+3,l=n.YCenter,u=0;u<s.length;++u){var f=s[u],C={Left:h,YCenter:l};this.DrawButton(f,C,e,t),this.Buttons.push({ID:f.ID,Rect:C,FrameID:this.Frame.Identify,Type:1,OverlayID:n.ID,Title:r.Title}),h=C.Right,n.Width+=C.Width}n.Width>0&&(n.Width+=3)}}},this.PtInButtons=function(r,n){for(var e=0;e<this.Buttons.length;++e){var t=this.Buttons[e];if(t.Rect){var a=t.Rect;if(r>a.Left&&r<a.Right&&n>a.Top&&n<a.Bottom){var s={ID:t.ID,Rect:a,FrameID:t.FrameID,Type:t.Type};return t.Type==1&&(s.Title=t.Title,s.OverlayID=t.OverlayID),s}}}return null}}function It(){this.Frame,this.Canvas,this.Point=new Array,this.Value=new Array,this.LinePoint=[],this.PointCount=2,this.Status=0,this.PointStatus=0,this.MovePointIndex=null,this.ClassName="IChartDrawPicture",this.FinishedCallback,this.Guid=oe(),this.Symbol,this.Period,this.Right,this.IsSelected=!1,this.Option,this.EnableMove=!0,this.EnableSave=!0,this.EnableCtrlMove=!1,this.OnlyMoveXIndex=!1,this.IsSupportMagnet=!1,this.IsDrawFirst=!1,this.IsShowYCoordinate=!1,this.LineColor=m.DrawPicture.LineColor[0],this.LineWidth=2,this.BackupLineWidth=null,this.AreaColor="rgba(25,25,25,0.4)",this.PointColor=m.DrawPicture.PointColor[0],this.MoveOnPointColor=m.DrawPicture.PointColor[1],this.PointBGColor=m.DrawPicture.PointColor[2],this.PointRadius=5,this.SquareSize=8,this.PointType=m.DrawPicture.PointType,this.IsShowPoint=m.DrawPicture.IsShowPoint,this.LimitFrameID,this.SetLastPoint=null,this.Update=null,this.GetActiveDrawPicture=null,this.GetYCoordinatePoint=null,this.Draw=function(){},this.SetOption=function(r){r&&(r.LineColor&&(this.LineColor=r.LineColor),r.LineWidth>0&&(this.LineWidth=r.LineWidth),r.AreaColor&&(this.AreaColor=r.AreaColor),r.PointColor&&(this.PointColor=r.PointColor),r.MoveOnPointColor&&(this.SelectPointColor=r.PointColor),r.PointRadius&&(this.PointRadius=r.PointRadius),c.IsNumber(r.SquareSize)&&(this.SquareSize=r.SquareSize),c.IsBool(r.IsShowPoint)&&(this.IsShowPoint=r.IsShowPoint),c.IsNumber(r.LimitFrameID)&&(this.LimitFrameID=r.LimitFrameID),c.IsBool(r.EnableCtrlMove)&&(this.EnableCtrlMove=r.EnableCtrlMove),c.IsBool(r.IsShowYCoordinate)&&(this.IsShowYCoordinate=r.IsShowYCoordinate))},this.ReloadResource=function(r){r||(this.PointColor=m.DrawPicture.PointColor[0],this.MoveOnPointColor=m.DrawPicture.PointColor[1],this.PointBGColor=m.DrawPicture.PointColor[2])},this.SetLineWidth=function(){this.BackupLineWidth=null,this.LineWidth>0&&(this.BackupLineWidth=this.Canvas.lineWidth,this.Canvas.lineWidth=this.LineWidth*V())},this.GetFontHeight=function(r){return Aa(this.Canvas,r,"擎")},this.RestoreLineWidth=function(){this.BackupLineWidth!=null&&(this.Canvas.lineWidth=this.BackupLineWidth)},this.PointMagnetKLine=function(){if(!this.IsSupportMagnet||!this.Frame||this.Frame.ClassName=="MinuteFrame"||this.Frame.Class=="MinuteHScreenFrame"||this.Frame.Identify!=0)return!1;var r=-1;if(this.Status==2?r=1:this.Status==1?r=0:c.IsNumber(this.MovePointIndex)&&(r=this.MovePointIndex),r<0)return!1;if(this.Option&&this.Option.Magnet&&this.Option.Magnet.Enable){var n={IsFixedX:!1,Magnet:{Enable:!0,PointIndex:r,Distance:this.Option.Magnet.Distance,Type:this.Option.Magnet.Type}};return this.AdjustPoint(this.Point,n)}return!1},this.PointToValue=function(){return this.Frame?this.Frame.ClassName=="MinuteFrame"||this.Frame.Class=="MinuteHScreenFrame"?this.PointToValue_Minute():this.PointToValue_KLine():!1},this.PointToKLine=function(r){if(!this.Frame)return null;var n=this.Frame.Data;if(!n)return null;var e=[],t=this.Frame.IsHScreen;if(t)for(var a in r){var s=r[a],o=parseInt(this.Frame.GetXData(s.Y))+n.DataOffset,h=this.Frame.GetYData(s.X),l={XValue:o,YValue:h},u=n.Data[o];l.DateTime={Date:u.Date},c.IsNumber(u.Time)&&(l.DateTime.Time=u.Time),e[a]=l}else for(var a in r){var s=r[a],f=parseInt(this.Frame.GetXData(s.X,!1)),o=f+n.DataOffset;o<0?o=0:o>=n.Data.length&&(o=n.Data.length-1,f=o-n.DataOffset);var h=this.Frame.GetYData(s.Y,!1),l={XValue:o,YValue:h,XIndex:f},u=n.Data[o];l.DateTime={Date:u.Date},c.IsNumber(u.Time)&&(l.DateTime.Time=u.Time),e[a]=l}return e},this.PointToValue_KLine=function(){if(!this.Frame)return!1;var r=this.Frame.Data;if(!r)return!1;var n=this.Frame.IsHScreen;if(n)for(var e in this.Point){var t=this.Point[e],a=parseInt(this.Frame.GetXData(t.Y,!1))+r.DataOffset,s=this.Frame.GetYData(t.X,!1),o={XValue:a,YValue:s},h=r.Data[a];o.DateTime={Date:h.Date},c.IsNumber(h.Time)&&(o.DateTime.Time=h.Time),this.Value[e]=o}else for(var e in this.Point){var t=this.Point[e],a=parseInt(this.Frame.GetXData(t.X,!1))+r.DataOffset;a<0?a=0:a>=r.Data.length&&(a=r.Data.length-1);var s=this.Frame.GetYData(t.Y,!1),o={XValue:a,YValue:s},h=r.Data[a];o.DateTime={Date:h.Date},c.IsNumber(h.Time)&&(o.DateTime.Time=h.Time),this.Value[e]=o}return!0},this.PointToValue_Minute=function(){if(!this.Frame)return!1;var r=this.Frame.Data;if(!r)return!1;var n=this.Frame.IsHScreen;if(n)for(var e=0;e<this.Point.length;++e){var t=this.Point[e],a=parseInt(this.Frame.GetXData(t.Y)),s=this.Frame.GetYData(t.X),o={XValue:a,YValue:s},h=r.Data[a];o.DateTime={Date:h.Date,Time:h.Time},this.Value[e]=o}else for(var l=yr.GetTimeData(this.Symbol),e=0;e<this.Point.length;++e){var t=this.Point[e],a=parseInt(this.Frame.GetXData(t.X)),s=this.Frame.GetYData(t.Y);if(a>=r.Data.length){var u=a%l.length,f=r.Data.length-1,o={XValue:a,YValue:s},h=r.Data[f],C=l[u];o.DateTime={Date:h.Date,Time:C},this.Value[e]=o}else{var o={XValue:a,YValue:s},h=r.Data[a];o.DateTime={Date:h.Date,Time:h.Time},this.Value[e]=o}}return!0},this.IsPointIn=function(r,n,e){return!1},this.ValueToPoint=function(){if(!this.Frame)return!1;var r=this.Frame.Data;if(!r)return!1;var n=this.Frame.IsHScreen;this.Point=[];for(var e=0;e<this.Value.length;++e){var t=this.Value[e],a=new ot;n?(a.Y=this.Frame.GetXFromIndex(t.XValue-r.DataOffset,!1),a.X=this.Frame.GetYFromData(t.YValue,!1)):(a.X=this.Frame.GetXFromIndex(t.XValue-r.DataOffset,!1),a.Y=this.Frame.GetYFromData(t.YValue,!1)),this.Point[e]=a}},this.UpdateXValue=function(){if(!this.Frame)return!1;var r=this.Frame.Data;if(!r)return!1;for(var n=[],e=0;e<this.Value.length;++e){var t=this.Value[e];if(!t.DateTime)break;var a={Date:t.DateTime.Date};c.IsNumber(t.DateTime.Time)&&(a.Time=t.DateTime.Time),n[e]=a}r.FindDataIndexByDateTime(n);for(var e in n){var s=n[e],o=this.Value[e];s.Index>=0&&(o.XValue=s.Index)}},this.Move=function(r,n){if(this.Status!=20)return fasle;if(!this.Frame)return!1;var e=this.Frame.Data;if(!e||this.MovePointIndex==null)return!1;var t=parseInt(this.MovePointIndex);if(t===100)for(var a in this.Point)this.Point[a].X+=r,this.Point[a].Y+=n;else if(t===0||t===1||t===2||t===3||t===4||t===5)t<this.Point.length&&(this.Point[t].X+=r,this.Point[t].Y+=n);else return!1},this.ClipFrame=function(){if(this.Frame.IsHScreen)var r=this.Frame.ChartBorder.GetLeftEx(),n=this.Frame.ChartBorder.GetTop(),e=this.Frame.ChartBorder.GetWidthEx(),t=this.Frame.ChartBorder.GetHeight();else var r=this.Frame.ChartBorder.GetLeft(),n=this.Frame.ChartBorder.GetTopEx(),e=this.Frame.ChartBorder.GetWidth(),t=this.Frame.ChartBorder.GetHeightEx();this.Canvas.save(),this.Canvas.beginPath(),this.Canvas.rect(r,n,e,t),this.Canvas.clip()},this.CalculateDrawPoint=function(r){if(this.Status<2||!this.Point.length||!this.Frame)return null;var n=[];if(this.Status==10){var e=this.Frame.Data;if(!e)return null;for(var t=this.Frame.XPointCount,a=0,s=this.Frame.IsHScreen,o=0;o<this.Value.length;++o){var h=this.Value[o],l=h.XValue-e.DataOffset;(l<0||l>=t)&&++a;var u=new ot;s?(u.Y=this.Frame.GetXFromIndex(h.XValue-e.DataOffset,!1),u.X=this.Frame.GetYFromData(h.YValue,!1)):(u.X=this.Frame.GetXFromIndex(h.XValue-e.DataOffset,!1),u.Y=this.Frame.GetYFromData(h.YValue,!1)),n.push(u)}if(r&&r.IsCheckX===!0&&a==this.Value.length)return null}else{for(var o=0;o<this.Point.length;++o){var h=this.Point[o];n.push({X:h.X,Y:h.Y})}if(this.OnlyMoveXIndex){var r={IsFixedX:this.OnlyMoveXIndex};if(X.Chart.Log("[IChartDrawPicture::CalculateDrawPoint] Status="+this.Status+" MovePointIndex="+this.MovePointIndex+" Identify="+this.Frame.Identify),this.Option&&this.Option.Magnet&&this.Option.Magnet.Enable&&this.IsSupportMagnet&&this.Frame.Identify==0){var f=-1;this.Status==2&&(f=1),c.IsNumber(this.MovePointIndex)&&(f=this.MovePointIndex),f>=0&&(r.Magnet={Enable:!0,PointIndex:f,Distance:this.Option.Magnet.Distance,Type:this.Option.Magnet.Type})}this.AdjustPoint(n,r)}}return n},this.AdjustPoint=function(r,n){return!this.Frame||this.Frame.ClassName=="MinuteFrame"||this.Frame.Class=="MinuteHScreenFrame"?!1:this.AdjustPoint_KLine(r,n)},this.AdjustPoint_KLine=function(r,n){if(!n||!this.Frame)return!1;var e=this.Frame.Data;if(!e)return!1;var t=this.Frame.IsHScreen;if(t)for(var a=0;a<r.length;++a)var s=r[a],o=parseInt(this.Frame.GetXData(s.Y))+e.DataOffset;else for(var a=0;a<r.length;++a){var s=r[a],h=parseInt(this.Frame.GetXData(s.X,!1)),o=h+e.DataOffset;if(o<0?o=0:o>=e.Data.length&&(o=e.Data.length-1),n.IsFixedX&&(h=o-e.DataOffset,s.X=this.Frame.GetXFromIndex(h,!1)),n.Magnet&&n.Magnet.Enable&&a==n.Magnet.PointIndex){for(var l=e.Data[o],u=[l.Open,l.High,l.Low,l.Close],f=null,C=null,D=0;D<u.length;++D){var v=this.Frame.GetYFromData(u[D]),S=Math.abs(s.Y-v);(!c.IsNumber(f)||f>S)&&(f=S,C=v)}n.Magnet.Type==1?c.IsNumber(C)&&(s.Y=C):f<n.Magnet.Distance&&c.IsNumber(C)&&(s.Y=C)}}},this.IsYValueInFrame=function(r){return!(!this.Frame||r>this.Frame.HorizontalMax||r<this.Frame.HorizontalMin)},this.DrawPoint=function(r){if(c.IsNonEmptyArray(r)){var n=this.PointColor,e=!1;if(!this.IsShowPoint){if(this.GetActiveDrawPicture){var t=this.GetActiveDrawPicture();if(t.Move.Guid!=this.Guid&&t.Select.Guid!=this.Guid&&t.MoveOn.Guid!=this.Guid)return;t.Select.Guid!=this.Guid&&t.MoveOn.Guid==this.Guid&&(e=!0,n=this.MoveOnPointColor)}}this.ClipFrame();var a=V();this.Canvas.fillStyle=n,this.PointType==2&&(this.Canvas.fillStyle=this.PointBGColor,this.Canvas.strokeStyle=this.PointColor,e?this.Canvas.lineWidth=1*a:this.Canvas.lineWidth=2*a);for(var s=0;s<r.length;++s){var o=r[s];if(this.PointType==1){var h=this.SquareSize*a,l=o.X-h/2,u=o.Y-h/2;this.Canvas.fillRect(l,u,h,h)}else if(this.PointType==2){var f=new Path2D;f.arc(o.X,o.Y,this.PointRadius*a,0,360,!1),this.Canvas.fill(f),this.Canvas.stroke(f)}else this.Canvas.beginPath(),this.Canvas.arc(o.X,o.Y,this.PointRadius*a,0,360,!1),this.Canvas.fill(),this.Canvas.closePath()}this.Canvas.restore()}},this.CalculateExtendLinePoint=function(r,n){var e={};this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetRight();var t=this.Frame.ChartBorder.GetTopEx(),a=this.Frame.ChartBorder.GetBottom(),s=n.X-r.X,o=n.Y-r.Y;if(s>0){var l=a-r.Y,u=s*l/o,h=new ot;h.X=r.X+u,h.Y=a,e.End=h;var l=n.Y-t,u=s*l/o,f=new ot;f.Y=t,f.X=n.X-u,e.Start=f}else{var l=a-r.Y,u=Math.abs(s)*l/o,h=new ot;h.X=r.X-u,h.Y=a,e.End=h;var l=n.Y-t,u=Math.abs(s)*l/o,f=new ot;f.Y=t,f.X=n.X+u,e.Start=f}return e},this.CalculateExtendLineEndPoint=function(r){var n=this.Frame.ChartBorder.GetLeft(),e=this.Frame.ChartBorder.GetRight(),t=this.Frame.ChartBorder.GetBottomEx(),a=this.Frame.ChartBorder.GetTopEx(),s=r[1].X-r[0].X,o=r[1].Y-r[0].Y;if(s>0){var h=e-r[0].X,l=h*o/s,u=l+r[0].Y;if(u>=a&&u<=t){var f=new ot;return f.X=e,f.Y=u,f}if(o>0){var C=t-r[0].Y,D=s*C/o,v=D+r[0].X,S=new ot;return S.X=v,S.Y=t,S}else{var C=a-r[0].Y,D=s*C/o,v=D+r[0].X,S=new ot;return S.X=v,S.Y=a,S}}else{var h=r[0].X-n,l=h*o/Math.abs(s),u=l+r[0].Y;if(u>=a&&u<=t){var f=new ot;return f.X=n,f.Y=u,f}if(o>0){var C=t-r[0].Y,D=s*C/o,v=D+r[0].X,S=new ot;return S.X=v,S.Y=t,S}else{var C=a-r[0].Y,D=s*C/o,v=D+r[0].X,S=new ot;return S.X=v,S.Y=a,S}}},this.IsPointInXYValue=function(r,n,e){if(!this.Frame)return-1;var t=this.Frame.Data;if(!t||!this.Value)return-1;var a=5;e&&c.IsNumber(e.Zoom)?a+=e.Zoom:this.Option&&c.IsNumber(this.Option.Zoom)&&(a+=this.Option.Zoom);var s=this.Frame.IsHScreen;a*=V();for(var o=0;o<this.Value.length;++o){var h=this.Value[o],l=new ot;if(s?(l.Y=this.Frame.GetXFromIndex(h.XValue-t.DataOffset),l.X=this.Frame.GetYFromData(h.YValue)):(l.X=this.Frame.GetXFromIndex(h.XValue-t.DataOffset),l.Y=this.Frame.GetYFromData(h.YValue)),this.Canvas.beginPath(),this.Canvas.arc(l.X,l.Y,a,0,360),this.Canvas.isPointInPath(r,n))return o}return-1},this.IsPointInLine=function(r,n,e){if(!this.LinePoint)return-1;var t=5;e&&c.IsNumber(e.Zoom)?t+=e.Zoom:this.Option&&c.IsNumber(this.Option.Zoom)&&(t+=this.Option.Zoom);var a=V();t*=a;for(var s=0;s<this.LinePoint.length;++s){var o=this.LinePoint[s],h=o.Start,l=o.End;if(this.Canvas.beginPath(),h.X==l.X?(this.Canvas.moveTo(h.X-t,h.Y),this.Canvas.lineTo(h.X+t,h.Y),this.Canvas.lineTo(l.X+t,l.Y),this.Canvas.lineTo(l.X-t,l.Y)):(this.Canvas.moveTo(h.X,h.Y+t),this.Canvas.lineTo(h.X,h.Y-t),this.Canvas.lineTo(l.X,l.Y-t),this.Canvas.lineTo(l.X,l.Y+t)),this.Canvas.closePath(),this.Canvas.isPointInPath(r,n))return s}return-1},this.IsPointIn_XYValue_Line=function(r,n,e){if(this.Status!=10)return-1;var t=this.IsPointInXYValue(r,n,e);return t>=0?t:(t=this.IsPointInLine(r,n,e),t>=0?100:-1)},this.DrawLine=function(r,n,e){e&&this.Canvas.setLineDash([5,10]),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(r.X,r.Y),this.Canvas.lineTo(n.X,n.Y),this.Canvas.stroke(),e&&this.Canvas.setLineDash([])},this.CreateLineData=function(r,n){var e={Start:new ot,End:new ot};return e.Start.Y=r.Y,e.Start.X=r.X,e.End.Y=n.Y,e.End.X=n.X,e},this.ExportStorageData=function(){for(var r={ClassName:this.ClassName,Symbol:this.Symbol,Guid:this.Guid,Period:this.Period,Value:[],FrameID:this.Frame.Identify,LineColor:this.LineColor,AreaColor:this.AreaColor,LineWidth:this.LineWidth,Right:this.Right,EnableSave:this.EnableSave,IsShowYCoordinate:this.IsShowYCoordinate},n=0;n<this.Value.length;++n){var e=this.Value[n];r.Value.push({XValue:e.XValue,YValue:e.YValue,DateTime:e.DateTime})}return this.Text&&(r.Text=this.Text),this.FontOption&&(r.FontOption=this.FontOption),r},this.ExportBaseData=function(){var r={ClassName:this.ClassName,Guid:this.Guid,FrameID:this.Frame.Identify,Symbol:this.Symbol,Period:this.Period,Right:this.Right,LineColor:this.LineColor,LineWidth:this.LineWidth,EnableSave:this.EnableSave,IsShowYCoordinate:this.IsShowYCoordinate};return this.AreaColor&&(r.AreaColor=this.AreaColor),this.Text&&(r.Text=this.Text),this.FontOption&&(r.FontOption={},this.SetFont(r.FontOption,this.FontOption)),r},this.IsFrameMinSize=function(){return this.Frame&&this.Frame.IsMinSize},this.PointRange=function(r){if(!c.IsNonEmptyArray(r))return null;if(r.length==1){var n={Points:[{X:r[0].X,Y:r[0].Y}]};return n}else{for(var e=r[0].X,t=e,a=r[0].Y,s=a,o=[{X:r[0].X,Y:r[0].Y}],h=1;h<r.length;++h)e<r[h].X&&(e=r[h].X),t>r[h].X&&(t=r[h].X),a<r[h].Y&&(a=r[h].Y),s>r[h].Y&&(s=r[h].Y),o.push({X:r[h].X,Y:r[h].Y});var n={X:{Max:{X:e},Min:{X:t}},Y:{Max:{Y:a},Min:{Y:s}},Points:o};return n}},this.GetXYCoordinate_default=function(){if(this.IsFrameMinSize())return null;var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});return this.PointRange(r)},this.GetXYCoordinate=function(){return null},this.CopyData_default=function(){if(!this.Frame)return null;var r=this.ExportStorageData();if(!r)return null;var n=0;if(!(this.Frame.ClassName=="MinuteFrame"||this.Frame.Class=="MinuteHScreenFrame")){var e=this.Frame.Data;if(!e)return null;n=e.DataOffset}for(var t=this.Frame.ChartBorder.GetHeight(),a=this.Frame.ChartBorder.GetBottomEx()-this.Point[0].Y,s=0;s<r.Value.length;++s){var o=r.Value[s],h=this.Point[s];if(o.XIndex=o.XValue-n+1,s==0)o.XOffset=0,o.YOffset=0;else{var l=r.Value[s-1],u=this.Point[s-1];o.XOffset=o.XValue-l.XValue,o.YOffset=h.Y-u.Y}}return r.DataOffset=n,r.YFristScale=a/t,r.Height=t,r},this.SetFont=function(r,n){n&&r&&(n.Family&&(r.Family=n.Family),n.Weight&&(r.Weight=n.Weight),n.Style&&(r.Style=n.Style),c.IsNumber(n.Size)&&(r.Size=n.Size))},this.GetFontString=function(r){var n=16*V()+"px 微软雅黑";if(!r||!r.Family||!c.IsPlusNumber(r.Size))return n;var e="";return r.Color&&(e+=r.Color+" "),r.Style&&(e+=r.Style+" "),r.Weight&&(e+=r.Weight+" "),e+=r.Size*V()+"px ",e+=r.Family,e},this.GetMultiLineText=function(r,n,e,t){e&&(this.Canvas.font=e);var a=this.Canvas.measureText(r).width;if(a<=n)return{AryText:[{Text:r}]};for(var s=this.Canvas.measureText("擎").width,o=parseInt(n/s),h=0,l=[];h<r.length-1;){var u=o,f=h+u;f>=r.length&&(f=r.length-1,u=f-h);var C=r.slice(h,h+u),a=this.Canvas.measureText(C).width;if(a>n){for(var D=u;D>=0;--D)if(C=r.slice(h,h+D),a=this.Canvas.measureText(C).width,a<n){l.push({Text:C}),h+=D;break}}else if(a<n){for(var v=!1,D=u;D+h<=r.length;++D)if(C=r.slice(h,h+D),a=this.Canvas.measureText(C).width,a>n){C=r.slice(h,h+D-1),l.push({Text:C}),h+=D-1,v=!0;break}v||(l.push({Text:C}),h=r.length-1)}else l.push({Text:C}),h+=u}return{AryText:l}},this.CloneArrayText=function(r){if(!c.IsNonEmptyArray(r))return[];for(var n=[],e=0;e<r.length;++e){var t=r[e];t&&n.push({Text:t.Text})}return n},this.CalculateAngle=function(r,n,e,t){var a=Math.abs(r-e),s=Math.abs(n-t),o=Math.sqrt(Math.pow(a,2)+Math.pow(s,2)),h=a/o,l=Math.acos(h),u=180/(Math.PI/l);return e==r&&t<n?90:e==r&&t>n?270:e>r&&t==n?0:e<r&&t==n?180:e>r&&t>n?360-u:e<r&&t>n?180+u:e<r&&t<n?180-u:u}}It.ColorToRGBA=function(r,n){var e=/^(rgb|RGB)/;if(e.test(r)){for(var t="#",a=r.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),s=0;s<a.length;s++){var o=Number(a[s]).toString(16);o==="0"&&(o+=o),t+=o}r=t}return"rgba("+parseInt("0x"+r.slice(1,3))+","+parseInt("0x"+r.slice(3,5))+","+parseInt("0x"+r.slice(5,7))+","+n+")"};It.RGBToHex=function(r){var n=r.indexOf(",")>-1?",":" ";r=r.substr(4).split(")")[0].split(n);var e=(+r[0]).toString(16),t=(+r[1]).toString(16),a=(+r[2]).toString(16);return e.length==1&&(e="0"+e),t.length==1&&(t="0"+t),a.length==1&&(a="0"+a),"#"+e+t+a};It.ArrayDrawPricture=[{Name:"线段",ClassName:"ChartDrawPictureLine",Create:function(){return new Xd}},{Name:"射线",ClassName:"ChartDrawPictureHaflLine",Create:function(){return new Ud}},{Name:"箭头",ClassName:"ChartDrawArrowLine",Create:function(){return new _d}},{Name:"水平线",ClassName:"ChartDrawPictureHorizontalLine",Create:function(){return new Kd}},{Name:"趋势线",ClassName:"ChartDrawPictureTrendLine",Create:function(){return new zd}},{Name:"矩形",ClassName:"ChartDrawPictureRect",Create:function(){return new Zd}},{Name:"圆弧线",ClassName:"ChartDrawPictureArc",Create:function(){return new Qd}},{Name:"M头W底",ClassName:"ChartDrawPictureWaveMW",Create:function(){return new _C}},{Name:"头肩型",ClassName:"ChartDrawHeadShouldersBT",Create:function(){return new $d}},{Name:"平行线",ClassName:"ChartDrawPictureParallelLines",Create:function(){return new Xh}},{Name:"平行通道",ClassName:"ChartDrawPictureParallelChannel",Create:function(){return new em}},{Name:"价格通道线",ClassName:"ChartDrawPicturePriceChannel",Create:function(){return new tm}},{Name:"文本",ClassName:"ChartDrawPictureText",Create:function(){return new am}},{Name:"江恩角度线",ClassName:"ChartDrawPictureGannFan",Create:function(){return new KC}},{Name:"阻速线",ClassName:"ChartDrawPictureResistanceLine",Create:function(){return new im}},{Name:"黄金分割",ClassName:"ChartDrawPictureGoldenSection",Create:function(){return new _h}},{Name:"百分比线",ClassName:"ChartDrawPicturePercentage",Create:function(){return new rm}},{Name:"波段线",ClassName:"ChartDrawPictureWaveBand",Create:function(){return new nm}},{Name:"三角形",ClassName:"ChartDrawPictureTriangle",Create:function(){return new sm}},{Name:"对称角度",ClassName:"ChartDrawPictureSymmetryAngle",Create:function(){return new om}},{Name:"圆",ClassName:"ChartDrawPictureCircle",Create:function(){return new hm}},{Name:"平行四边形",ClassName:"ChartDrawPictureQuadrangle",Create:function(){return new lm}},{Name:"斐波那契周期线",ClassName:"ChartDrawPictureFibonacci",Create:function(){return new um}},{Name:"线形回归线",ClassName:"ChartDrawLinearRegression",Create:function(){return new Eo}},{Name:"线形回归带",ClassName:"ChartDrawLinearRegression",Create:function(){return new Eo({IsShowMaxMinLine:!0})}},{Name:"延长线形回归带",ClassName:"ChartDrawLinearRegression",Create:function(){return new Eo({IsShowMaxMinLine:!0,IsShowExtendLine:!0})}},{Name:"尺子",ClassName:"ChartDrawRuler",Create:function(){return new fm}},{Name:"标价线",ClassName:"ChartDrawPriceLine",Create:function(){return new Cm}},{Name:"标价线2",ClassName:"ChartDrawPriceLineV2",Create:function(){return new Dm}},{Name:"垂直线",ClassName:"ChartDrawVerticalLine",Create:function(){return new vm}},{Name:"波浪尺",ClassName:"ChartDrawWaveRuler",Create:function(){return new cm}},{Name:"AB波浪尺",ClassName:"ChartDrawWaveRuler2Point",Create:function(){return new Sm}},{Name:"箱型线",ClassName:"ChartDrawBox",Create:function(){return new Tm}},{Name:"2点画图例子",ClassName:"ChartDrawTwoPointDemo",Create:function(){return new Uh}},{Name:"3点画图例子",ClassName:"ChartDrawThreePointDemo",Create:function(){return new JC}},{Name:"水平线段",ClassName:"ChartDrawHLineSegment",Create:function(){return new dm}},{Name:"平行射线",ClassName:"ChartDrawParallelRaysLines",Create:function(){return new jd}},{ClassName:"ChartDrawPictureIconFont",Create:function(){return new Wh}},{Name:"涂鸦线段",ClassName:"ChartDrawGraffitiLine",Create:function(){return new Wd}},{Name:"固定范围成交量分布图",ClassName:"ChartDrawVolProfile",Create:function(){return new mm}},{Name:"DisjointChannel",ClassName:"ChartDrawDisjontChannel",Create:function(){return new qd}},{Name:"FlatTop",ClassName:"ChartDrawDisjontChannel",Create:function(){return new UC}},{Name:"水平线2",ClassName:"ChartDrawHLine",Create:function(){return new Jd}},{Name:"Note",ClassName:"ChartDrawNote",Create:function(){return new Im}},{Name:"AnchoredText",ClassName:"ChartDrawAnchoredText",Create:function(){return new gm}},{Name:"PriceLabel",ClassName:"ChartDrawPriceLabel",Create:function(){return new pm}},{Name:"PriceNote",ClassName:"ChartDrawPriceNote",Create:function(){return new Fm}},{Name:"FibWedge",ClassName:"ChartDrawFibWedge",Create:function(){return new Em}}];It.MapIonFont=new Dt.default([["icon-arrow_up",{Text:"",Color:"#318757",Family:"iconfont"}],["icon-arrow_down",{Text:"",Color:"#db563e",Family:"iconfont"}],["icon-arrow_right",{Text:"",Color:"#318757",Family:"iconfont"}],["icon-arrow_left",{Text:"",Color:"#318757",Family:"iconfont"}]]);It.GetDrawPictureByName=function(r){for(var n in It.ArrayDrawPricture){var e=It.ArrayDrawPricture[n];if(e.Name==r)return e}return null};It.GetDrawPictureByClassName=function(r){for(var n in It.ArrayDrawPricture){var e=It.ArrayDrawPricture[n];if(e.ClassName==r)return e}return null};It.RegisterDrawPicture=function(r){if(!r.Name||!r.ClassName||!r.Create)return!1;var n={Name:r.Name,ClassName:r.ClassName,Create:r.Create};return It.ArrayDrawPricture.push(n),X.Chart.Log("[IChartDrawPicture.RegisterDrawPicture] registered new draw picture class. item=",n),!0};It.RegisterIonFont=function(r){if(!r.Name||!r.Text||!r.Family)return!1;var n=It.MapIonFont.has(r.Name);return It.MapIonFont.set(r.Name,r),X.Chart.Log("[IChartDrawPicture.RegisterIonFont] registered new icon font, obj=, isOverwirte=",r,n),!0};It.CreateChartDrawPicture=function(r){var n=It.GetDrawPictureByClassName(r.ClassName);if(!n)return null;var e=n.Create();return r.Period>=0&&(e.Period=r.Period),r.Right>=0&&(e.Right=r.Right),r.Guid&&(e.Guid=r.Guid),r.Symbol&&(e.Symbol=r.Symbol),r.Value&&(e.Value=r.Value),r.Text&&(e.Text=r.Text),r.LineColor&&(e.LineColor=r.LineColor),r.AreaColor&&(e.AreaColor=r.AreaColor),r.FontOption&&(e.FontOption=r.FontOption),r.Label&&(e.Label=r.Label),r.LineWidth>0&&(e.LineWidth=r.LineWidth),r.EnableMove===!1&&(e.EnableMove=r.EnableMove),c.IsBool(r.EnableSave)&&(e.EnableSave=r.EnableSave),c.IsNumber(r.ChannelWidth)&&(e.ChannelWidth=r.ChannelWidth),c.IsBool(r.IsShowYCoordinate)&&(e.IsShowYCoordinate=r.IsShowYCoordinate),e.SetOption&&e.SetOption(r),e};function Xd(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.IsShowYCoordinate=!1,this.CopyData=this.CopyData_default,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r&&r.length==2){this.ClipFrame();var n=r[0],e=r[1];this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(n.X,n.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.stroke(),this.RestoreLineWidth();var t={Start:n,End:e};this.LinePoint.push(t),this.DrawPoint(r),this.Canvas.restore()}}},this.GetYCoordinatePoint=function(){if(this.IsFrameMinSize()||this.Status<2||!this.Point.length||!this.Frame||this.Status!=10)return null;for(var r=[],n=0;n<this.Value.length;++n){var e=this.Value[n],t=this.Frame.GetYFromData(e.YValue,!1);r.push({Y:t,YValue:e.YValue,Item:e,Color:this.PointColor})}return r}}function Wd(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawGraffitiLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=null,this.PointCount=2,this.PointToValue=function(){if(!this.Frame)return!1;var r=this.Frame.IsHScreen;if(r)for(var n=0;n<this.Point.length;++n){var e=this.Point[n],t=this.Frame.GetYData(e.X),a={XValue:e.Y,YValue:t};this.Value[n]=a}else for(var n=0;n<this.Point.length;++n){var e=this.Point[n],t=this.Frame.GetYData(e.Y),a={XValue:e.X,YValue:t};this.Value[n]=a}return!0},this.ValueToPoint=function(){if(!this.Frame)return!1;var r=this.Frame.IsHScreen;this.Point=[];for(var n in this.Value){var e=this.Value[n],t=new ot;r?(t.Y=e.XValue,t.X=this.Frame.GetYFromData(e.YValue)):(t.X=e.XValue,t.Y=this.Frame.GetYFromData(e.YValue,!1)),this.Point[n]=t}},this.UpdateXValue=function(){},this.CalculateDrawPoint=function(r){if(this.Status<2||!this.Point.length||!this.Frame)return null;var n=[];if(this.Status==10){var e=this.Frame.IsHScreen;for(var t in this.Value){var a=this.Value[t],s=new ot;e?(s.Y=a.XValue,s.X=this.Frame.GetYFromData(a.YValue,!1)):(s.X=a.XValue,s.Y=this.Frame.GetYFromData(a.YValue,!1)),n.push(s)}}else n=this.Point;return n},this.IsPointInXYValue=function(r,n,e){if(!this.Frame||!this.Value)return-1;var t=5;e&&c.IsNumber(e.Zoom)?t+=e.Zoom:this.Option&&c.IsNumber(this.Option.Zoom)&&(t+=this.Option.Zoom);var a=this.Frame.IsHScreen;t*=V();for(var s=0;s<this.Value.length;++s){var o=this.Value[s],h=new ot;if(a?(h.Y=o.XValue,h.X==this.Frame.GetYFromData(o.YValue)):(h.X=o.XValue,h.Y=this.Frame.GetYFromData(o.YValue)),this.Canvas.beginPath(),this.Canvas.arc(h.X,h.Y,t,0,360),this.Canvas.isPointInPath(r,n))return s}return-1},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r&&r.length==2){this.ClipFrame();var n=r[0],e=r[1];this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(n.X,n.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.stroke(),this.RestoreLineWidth();var t={Start:n,End:e};this.LinePoint.push(t),this.DrawPoint(r),this.Canvas.restore()}}}}function _d(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawArrowLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.ArrawLineWidth=5,this.ArrawLength=15,this.ArrawAngle=35,this.GetXYCoordinate=this.GetXYCoordinate_default,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r&&r.length==2){this.ClipFrame();var n=r[0],e=r[1],t=this.ArrawAngle,a=this.ArrawLength,s=Math.atan2(n.Y-e.Y,n.X-e.X)*180/Math.PI,o=(s+t)*Math.PI/180,h=(s-t)*Math.PI/180,l=a*Math.cos(o),u=a*Math.sin(o),f=a*Math.cos(h),C=a*Math.sin(h);this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(n.X,n.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.stroke(),this.Canvas.beginPath();var D=e.X+l,v=e.Y+u;this.Canvas.moveTo(D,v),this.Canvas.lineTo(e.X,e.Y),D=e.X+f,v=e.Y+C,this.Canvas.lineTo(D,v),this.Canvas.lineWidth=this.ArrawLineWidth*V(),this.Canvas.stroke(),this.RestoreLineWidth();var S={Start:n,End:e};this.LinePoint.push(S),this.DrawPoint([r[0]]),this.Canvas.restore()}}}}function Ud(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureHaflLine",this.GetXYCoordinate=this.GetXYCoordinate_default,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.FullLine,this.IsPointIn=function(r,n,e){var t=this.IsPointIn_XYValue_Line(r,n,e);if(t>=0||!this.FullLine)return t;var a=this.FullLine.Start,s=this.FullLine.End,o=V(),h=5*o;return this.Canvas.beginPath(),a.X==s.X?(this.Canvas.moveTo(a.X-h,a.Y),this.Canvas.lineTo(a.X+h,a.Y),this.Canvas.lineTo(s.X+h,s.Y),this.Canvas.lineTo(s.X-h,s.Y)):(this.Canvas.moveTo(a.X,a.Y+h),this.Canvas.lineTo(a.X,a.Y-h),this.Canvas.lineTo(s.X,s.Y-h),this.Canvas.lineTo(s.X,s.Y+h)),this.Canvas.closePath(),this.Canvas.isPointInPath(r,n)?100:t},this.Draw=function(){if(this.LinePoint=[],this.FullLine=null,!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!1});if(!(!r||r.length!=2)){var n=r[0],e=r[1];this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),this.Canvas.moveTo(r[0].X,r[0].Y),this.Canvas.lineTo(r[1].X,r[1].Y);var t=this.CalculateExtendLineEndPoint(r);this.Canvas.lineTo(t.X,t.Y),this.Canvas.stroke(),this.RestoreLineWidth();var a={Start:n,End:e};this.LinePoint.push(a),this.DrawPoint(r),this.Canvas.restore(),this.FullLine={Start:r[0],End:t}}}}}function Kd(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.Super_SetOption=this.SetOption,this.Super_ExportStorageData=this.ExportStorageData,this.Label,this.SetOption=function(r){this.Super_SetOption&&this.Super_SetOption(r),r&&r.Label&&(this.Label=r.Label)},this.ExportStorageData=function(){var r;return this.Super_ExportStorageData&&(r=this.Super_ExportStorageData(),this.Label&&(r.Label=this.Label)),r},this.PointCount=1,this.ClassName="ChartDrawPictureHorizontalLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Font=16*V()+"px 微软雅黑",this.GetXYCoordinate=function(){if(this.IsFrameMinSize())return null;var r=this.CalculateDrawPoint();return this.PointRange(r)},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint();if(!(!r||r.length!=1)&&this.Frame&&this.Value.length==1){if(!this.IsYValueInFrame(this.Value[0].YValue))return null;var n=this.Frame.IsHScreen,e=this.Frame.ChartBorder.GetLeft(),t=this.Frame.ChartBorder.GetRight();n&&(e=this.Frame.ChartBorder.GetTop(),t=this.Frame.ChartBorder.GetBottom()),this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),n?(this.Canvas.moveTo(r[0].X,e),this.Canvas.lineTo(r[0].X,t)):(this.Canvas.moveTo(e,r[0].Y),this.Canvas.lineTo(t,r[0].Y)),this.Canvas.stroke(),this.RestoreLineWidth();var a={Start:new ot,End:new ot};if(n?(a.Start.X=r[0].X,a.Start.Y=e,a.End.X=r[0].X,a.End.Y=t):(a.Start.X=e,a.Start.Y=r[0].Y,a.End.X=t,a.End.Y=r[0].Y),this.LinePoint.push(a),this.DrawPoint(r),this.Canvas.fillStyle=this.LineColor,this.Canvas.font=this.Font,n){this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var s=r[0].X,o=e;this.Canvas.translate(s,o),this.Canvas.rotate(90*Math.PI/180);var h=this.Frame.GetYData(r[0].X),l=h.toFixed(2);this.Label&&(this.Label.Position==0?l=this.Label.Text+h.toFixed(2):this.Label.Position==1&&(l=h.toFixed(2)+this.Label.Text)),this.Canvas.fillText(l,0,0)}else{this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var h=this.Frame.GetYData(r[0].Y),l=h.toFixed(2);this.Label&&(this.Label.Position==0?l=this.Label.Text+h.toFixed(2):this.Label.Position==1&&(l=h.toFixed(2)+this.Label.Text)),this.Canvas.fillText(l,e,r[0].Y)}this.Canvas.restore()}}}}function Jd(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.Super_SetOption=this.SetOption,this.Super_ExportStorageData=this.ExportStorageData,this.LineWidth=1,this.Precision=2,this.ValueTextColor="rgb(250,250,250)",this.IsShowCorssCursor=!0,this.GetLabelCallback,this.PointCount=1,this.ClassName="ChartDrawHLine",this.Font=14*V()+"px 微软雅黑",this.TextFont=12*V()+"px 微软雅黑",this.RightSpaceWidth=50,this.ButtonPosition=0,this.ButtonBGColor="rgb(190,190,190)",this.ButtonSpace=3,this.Button={CloseIcon:{Text:"",Color:"rgb(255,255,255)",Family:"iconfont",Size:16},SettingIcon:{Text:"",Color:"rgb(255,255,255)",Family:"iconfont",Size:16}},this.AryButton=[],this.ExtendData,this.ColseButtonSize=0,this.SettingButtonSize=0,this.ButtonBGWidth=0,this.SetOption=function(r){if(this.Super_SetOption&&this.Super_SetOption(r),r){if(r.GetLabelCallback&&(this.GetLabelCallback=r.GetLabelCallback),c.IsNumber(r.Precision)&&(this.Precision=r.Precision),c.IsNumber(r.Precision)&&(this.Precision=r.Precision),r.Font&&(this.Font=r.Font),r.ValueTextColor&&(this.ValueTextColor=r.ValueTextColor),c.IsNumber(r.ButtonPosition)&&(this.ButtonPosition=r.ButtonPosition),c.IsNumber(r.RightSpaceWidth)&&(this.RightSpaceWidth=r.RightSpaceWidth),r.Button){var n=r.Button;n.CloseIcon&&(this.Button.CloseIcon=ne(n.CloseIcon)),n.SettingIcon&&(this.Button.SettingIcon=ne(n.SettingIcon))}r.ExtendData&&(this.ExtendData=r.ExtendData)}},this.ExportStorageData=function(){var r;return this.Super_ExportStorageData&&(r=this.Super_ExportStorageData(),this.Label&&(r.Label=this.Label)),r},this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=function(){if(this.IsFrameMinSize())return null;var r=this.CalculateDrawPoint();return this.PointRange(r)},this.IsDrawMain=function(){if(!this.GetActiveDrawPicture)return!0;var r=this.GetActiveDrawPicture();return r.Select.Guid!=this.Guid},this.MainDraw=function(){this.Draw()},this.Draw=function(r,n){if(this.LinePoint=[],this.AryButton=[],this.ColseButtonSize=0,this.SettingButtonSize=0,this.ButtonBGWidth=0,!this.IsFrameMinSize()){var e=this.CalculateDrawPoint();if(!(!e||e.length!=1)&&this.Frame&&this.Value.length==1){if(!this.IsYValueInFrame(this.Value[0].YValue))return null;var t=this.Frame.IsHScreen,a=this.Frame.ChartBorder.GetLeft(),s=this.Frame.ChartBorder.GetRight();t&&(a=this.Frame.ChartBorder.GetTop(),s=this.Frame.ChartBorder.GetBottom()),this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),t?(this.Canvas.moveTo(e[0].X,a),this.Canvas.lineTo(e[0].X,s)):(this.Canvas.moveTo(a,L(e[0].Y)),this.Canvas.lineTo(s,L(e[0].Y))),this.Canvas.stroke(),this.RestoreLineWidth();var o={Start:new ot,End:new ot};t?(o.Start.X=e[0].X,o.Start.Y=a,o.End.X=e[0].X,o.End.Y=s):(o.Start.X=a,o.Start.Y=e[0].Y,o.End.X=s,o.End.Y=e[0].Y),this.LinePoint.push(o);var h;this.GetLabelCallback&&(h=this.GetLabelCallback(this)),h&&this.DrawLab(h,e[0].Y);var l=a+(s-a)/2,u={X:l,Y:e[0].Y};this.DrawPoint([u]),this.Canvas.restore();var f={};if(this.CalculateButtonSize(),this.DrawValueText(e[0].Y,f,h),h&&this.DrawRightLab(h,f),r&&n)for(var C=0;C<this.AryButton.length;++C){var D=this.AryButton[C],v=D.Rect;if(r.X>=v.Left&&r.X<v.Right&&r.Y>=v.Top&&r.Y<=v.Bottom){n.MouseOnToolbar={Rect:v,Item:D,Frame:this.Frame,Point:{X:r.X,Y:r.Y}};break}}}}},this.CalculateLabSize=function(r){this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.font=this.TextFont;var n=this.Canvas.measureText("擎").width+2,t=0,a=0,s=0,e=0;c.IsNumber(r.LineSpace)&&(e=r.LineSpace);for(var t=0,a=0,s=0,o=0,h=0;h<r.AryText.length;++h){var l=r.AryText[h];l.NameWidth=0,l.TextWidth=0,l.Name&&(l.NameWidth=this.Canvas.measureText(l.Name).width+2),l.Text&&(l.TextWidth=this.Canvas.measureText(l.Text).width+2),t<l.NameWidth&&(t=l.NameWidth),a<l.TextWidth&&(a=l.TextWidth);var u=l.NameWidth+l.TextWidth;o<u&&(o=u),++s}var f={Width:o,Height:s*(n+e)+e,NameWidth:t,TextWidth:a,LineHeight:n};return f},this.DrawLab=function(r,n){if(r&&c.IsNonEmptyArray(r.AryText)&&r.Position!==2){this.Frame.ChartBorder.GetLeft();var e=this.Frame.ChartBorder.GetRight(),t=this.CalculateLabSize(r),a=e-t.Width,s=n-t.Height-1;if(r.BGColor){this.Canvas.fillStyle=r.BGColor;var o=n-t.Height-4;this.Canvas.fillRect(B(a),B(o),B(e+a),B(n-o))}for(var h=s,l=0;l<r.AryText.length;++l){var u=r.AryText[l];u.Name&&(this.Canvas.fillStyle=u.NameColor,this.Canvas.fillText(u.Name,a+1,h+1)),u.Text&&(this.Canvas.fillStyle=u.TextColor,this.Canvas.fillText(u.Text,a+t.NameWidth+1,h+1)),h+=t.LineHeight}}},this.DrawRightLab=function(r,n){if(r&&c.IsNonEmptyArray(r.AryText)&&r.Position==2){var e=this.CalculateLabSize(r),t=n.Right-e.Width,a=n.Bottom,s=0;if(c.IsNumber(r.LineSpace)&&(s=r.LineSpace),r.BGColor){this.Canvas.fillStyle=r.BGColor;var o=a;this.Canvas.fillRect(B(t),B(o),B(e.Width),B(e.Height))}var h=a+1+s;this.Canvas.textBaseline="top";for(var l=0;l<r.AryText.length;++l){var u=r.AryText[l];u.Name&&(this.Canvas.textAlign="left",this.Canvas.fillStyle=u.NameColor,this.Canvas.fillText(u.Name,t+1,h+1)),u.Text&&(this.Canvas.textAlign="right",this.Canvas.fillStyle=u.TextColor,this.Canvas.fillText(u.Text,n.Right-1,h+1)),h+=e.LineHeight+s}}},this.DrawValueText=function(r,n,e){this.Frame.ChartBorder.GetLeft();var t=this.Frame.ChartBorder.GetRight();this.RightSpaceWidth>0&&(this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(t,L(r)),this.Canvas.lineTo(t+this.RightSpaceWidth,L(r)),this.Canvas.stroke());var a=this.Frame.GetYData(r),s=a.toFixed(this.Precision);e&&e.PriceSuffixText&&(s+=e.PriceSuffixText),this.Canvas.fillStyle=this.LineColor,this.Canvas.font=this.Font;var o=this.Canvas.measureText(s).width,h=this.GetFontHeight(),l={Left:t+this.RightSpaceWidth,Top:r-h/2,Width:o+4,Height:h};l.Right=l.Left+l.Width,l.Bottom=l.Top+l.Height,this.ButtonPosition==1?this.Canvas.fillRect(B(l.Left),B(l.Top),B(l.Width+this.ButtonBGWidth),B(l.Height)):this.Canvas.fillRect(B(l.Left),B(l.Top),B(l.Width),B(l.Height)),this.Canvas.fillStyle=this.ValueTextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(s,l.Left+2,r),n.Left=l.Left,n.Top=l.Top,n.Bottom=l.Bottom,n.Right=l.Right,this.DrawButton(l.Top,l.Right,h,n)},this.CalculateButtonSize=function(){var r=V();if(this.Button.SettingIcon){var n=this.Button.SettingIcon,e=n.Size*r+"px "+n.Family;this.Canvas.font=e;var t=this.Canvas.measureText(n.Text).width;this.SettingButtonSize=t}if(this.Button.CloseIcon){var n=this.Button.CloseIcon,e=n.Size*r+"px "+n.Family;this.Canvas.font=e;var t=this.Canvas.measureText(n.Text).width;this.ColseButtonSize=t}if(!(this.ColseButtonSize<=0&&this.SettingButtonSize<=0)){var a=0;this.SettingButtonSize>0&&(a+=this.SettingButtonSize),this.ColseButtonSize>0&&(a>0&&(a+=this.ButtonSpace),a+=this.ColseButtonSize),a+=4,this.ButtonBGWidth=a}},this.DrawButton=function(r,n,e,t){if(!(this.ColseButtonSize<=0&&this.SettingButtonSize<=0)){this.ButtonPosition==1&&(r-=e),this.Canvas.fillStyle=this.LineColor;var a=n,s={Left:n,Top:r,Width:this.ButtonBGWidth,Height:e};s.Right=s.Left+s.Width,s.Bottom=s.Top+s.Height,this.Canvas.fillStyle=this.ButtonBGColor,this.Canvas.fillRect(B(s.Left),B(s.Top),B(s.Width),B(s.Height)),a+=1;var o=V();if(this.Button.SettingIcon){var h={Left:a,Top:r,Width:this.SettingButtonSize,Height:e};h.Right=h.Left+h.Width,h.Bottom=h.Top+h.Height;var l=h.Top+h.Height/2,u=h.Left+h.Width/2,f=this.Button.SettingIcon;this.Canvas.font=f.Size*o+"px "+f.Family,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=f.Color,this.Canvas.fillText(this.Button.SettingIcon.Text,u,l),this.AryButton.push({Rect:h,ID:xt.DRAW_PICTURE_SETTING}),a=h.Right+this.ButtonSpace}if(this.Button.CloseIcon){var h={Left:a,Top:r,Width:this.ColseButtonSize,Height:e};h.Right=h.Left+h.Width,h.Bottom=h.Top+h.Height;var l=h.Top+h.Height/2,u=h.Left+h.Width/2,f=this.Button.CloseIcon;this.Canvas.font=f.Size*o+"px "+f.Family,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=f.Color,this.Canvas.fillText(this.Button.CloseIcon.Text,u,l),this.AryButton.push({Rect:h,ID:xt.DRAW_PICTURE_DELETE}),a=h.Right}t.Right=s.Right}},this.PtInButtons=function(r,n){for(var e=0;e<this.AryButton.length;++e){var t=this.AryButton[e];if(t.Rect){var a=t.Rect;if(this.Canvas.beginPath(),this.Canvas.rect(a.Left,a.Top,a.Width,a.Height),this.Canvas.isPointInPath(r,n))return{ID:t.ID,Rect:a}}}return null}}function zd(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureTrendLine",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!1});if(!(!r||r.length!=2)){var n=r[0],e=r[1],t=this.CalculateExtendLinePoint(n,e);this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),this.Canvas.moveTo(t.Start.X,t.Start.Y),this.Canvas.lineTo(t.End.X,t.End.Y),this.Canvas.stroke(),this.RestoreLineWidth();var a={Start:n,End:e};this.LinePoint.push(a),this.DrawPoint(r),this.Canvas.restore()}}}}function Zd(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureRect",this.GetXYCoordinate=this.GetXYCoordinate_default,this.Draw=function(){if(!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});!r||r.length!=2||(this.AreaColor=It.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.Canvas.strokeStyle=this.LineColor,this.SetLineWidth(),this.Canvas.beginPath(),this.Canvas.rect(r[0].X,r[0].Y,r[1].X-r[0].X,r[1].Y-r[0].Y),this.Canvas.stroke(),this.RestoreLineWidth(),this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.fillRect(r[0].X,r[0].Y,r[1].X-r[0].X,r[1].Y-r[0].Y),this.Canvas.restore(),this.DrawPoint(r))}},this.IsPointIn=function(r,n,e){if(this.IsFrameMinSize()||!this.Frame||this.Status!=10)return-1;var t=this.Frame.Data;if(!t)return-1;var a=this.IsPointInXYValue(r,n,e);if(a>=0)return a;var s=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!s||s.length!=2)return-1;var o=[{X:s[0].X,Y:s[0].Y},{X:s[1].X,Y:s[0].Y}];return this.IsPointInLine(o,r,n,e)||(o=[{X:s[1].X,Y:s[0].Y},{X:s[1].X,Y:s[1].Y}],this.IsPointInLine2(o,r,n,e))||(o=[{X:s[1].X,Y:s[1].Y},{X:s[0].X,Y:s[1].Y}],this.IsPointInLine(o,r,n,e))||(o=[{X:s[0].X,Y:s[1].Y},{X:s[0].X,Y:s[0].Y}],this.IsPointInLine2(o,r,n,e))?100:-1},this.IsPointInLine=function(r,n,e,t){var a=5;t&&c.IsNumber(t.Zoom)?a+=t.Zoom:this.Option&&c.IsNumber(this.Option.Zoom)&&(a+=this.Option.Zoom);var s=V();if(a*=s,this.Canvas.beginPath(),this.Canvas.moveTo(r[0].X,r[0].Y+a),this.Canvas.lineTo(r[0].X,r[0].Y-a),this.Canvas.lineTo(r[1].X,r[1].Y-a),this.Canvas.lineTo(r[1].X,r[1].Y+a),this.Canvas.closePath(),this.Canvas.isPointInPath(n,e))return!0},this.IsPointInLine2=function(r,n,e,t){var a=5;t&&c.IsNumber(t.Zoom)?a+=t.Zoom:this.Option&&c.IsNumber(this.Option.Zoom)&&(a+=this.Option.Zoom);var s=V();if(a*=s,this.Canvas.beginPath(),this.Canvas.moveTo(r[0].X-a,r[0].Y),this.Canvas.lineTo(r[0].X+a,r[0].Y),this.Canvas.lineTo(r[1].X+a,r[1].Y),this.Canvas.lineTo(r[1].X-a,r[1].Y),this.Canvas.closePath(),this.Canvas.isPointInPath(n,e))return!0}}function Qd(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureArc",this.Draw=function(){if(!this.IsFrameMinSize()){var r=this.CalculateDrawPoint();if(!(!r||r.length!=2)){if(this.ClipFrame(),this.SetLineWidth(),r[0].X<r[1].X&&r[0].Y>r[1].Y){var n=r[1].X-r[0].X,e=r[0].Y-r[1].Y,t=n>e?1/n:1/e,a=r[0].X,s=r[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(r[0].X,r[0].Y);for(var o=1.5*Math.PI;o<2*Math.PI;o+=t)this.Canvas.lineTo(a+n*Math.cos(o),s+e*Math.sin(o)*-1);for(var h=0;h<=.5*Math.PI;h+=t)this.Canvas.lineTo(a+n*Math.cos(h),s+e*Math.sin(h)*-1)}else if(r[0].X>r[1].X&&r[0].Y>r[1].Y){var n=r[0].X-r[1].X,e=r[0].Y-r[1].Y,t=n>e?1/n:1/e,a=r[1].X,s=r[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(r[0].X,r[0].Y);for(var o=0;o<=Math.PI;o+=t)this.Canvas.lineTo(a+n*Math.cos(o),s+e*Math.sin(o)*-1)}else if(r[0].X>r[1].X&&r[0].Y<r[1].Y){var n=r[0].X-r[1].X,e=r[1].Y-r[0].Y,t=n>e?1/n:1/e,a=r[0].X,s=r[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(r[0].X,r[0].Y);for(var o=.5*Math.PI;o<=1.5*Math.PI;o+=t)this.Canvas.lineTo(a+n*Math.cos(o),s+e*Math.sin(o)*-1)}else if(r[0].X<r[1].X&&r[0].Y<r[1].Y){var n=r[1].X-r[0].X,e=r[1].Y-r[0].Y,t=n>e?1/n:1/e,a=r[1].X,s=r[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(r[0].X,r[0].Y);for(var o=Math.PI;o<=2*Math.PI;o+=t)this.Canvas.lineTo(a+n*Math.cos(o),s+e*Math.sin(o)*-1)}this.Canvas.strokeStyle=this.LineColor,this.Canvas.stroke(),this.RestoreLineWidth(),this.Canvas.restore(),this.DrawPoint(r)}}},this.IsPointIn=function(r,n,e){if(this.IsFrameMinSize()||!this.Frame||this.Status!=10)return-1;var t=this.Frame.Data;if(!t)return-1;var a=this.IsPointInXYValue(r,n,e);if(a>=0)return a;var s=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!s||s.length!=2)return-1;var o=[{X:s[0].X,Y:s[0].Y},{X:s[1].X,Y:s[1].Y}];return this.IsPointInArc(o,r,n)?100:-1},this.IsPointInArc=function(r,n,e){if(r.length!=2)return!1;if(r[0].X<r[1].X&&r[0].Y>r[1].Y){var t=r[1].X-r[0].X,a=r[0].Y-r[1].Y,s=t>a?1/t:1/a,o=t*.8,h=a*.8,l=o>h?1/o:1/h,u=r[0].X,f=r[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(r[0].X,r[0].Y);for(var C=1.5*Math.PI;C<2*Math.PI;C+=s)this.Canvas.lineTo(u+t*Math.cos(C),f+a*Math.sin(C)*-1);for(var D=0;D<=.5*Math.PI;D+=s)this.Canvas.lineTo(u+t*Math.cos(D),f+a*Math.sin(D)*-1);for(var v=.5*Math.PI;v>=0;v-=l)this.Canvas.lineTo(u+o*Math.cos(v),f+h*Math.sin(D)*-1);for(var S=2*Math.PI;S>=1.5*Math.PI;S-=l)this.Canvas.lineTo(u+o*Math.cos(S),f+h*Math.sin(S)*-1);this.Canvas.closePath()}else if(r[0].X>r[1].X&&r[0].Y>r[1].Y){var t=r[0].X-r[1].X,a=r[0].Y-r[1].Y,s=t>a?1/t:1/a,o=t*.8,h=a*.8,l=o>h?1/o:1/h,u=r[1].X,f=r[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(r[0].X,r[0].Y);for(var C=0;C<=Math.PI;C+=s)this.Canvas.lineTo(u+t*Math.cos(C),f+a*Math.sin(C)*-1);for(var D=Math.PI;D>=0;D-=l)this.Canvas.lineTo(u+o*Math.cos(D),f+h*Math.sin(D)*-1);this.Canvas.closePath()}else if(r[0].X>r[1].X&&r[0].Y<r[1].Y){var t=r[0].X-r[1].X,a=r[1].Y-r[0].Y,s=t>a?1/t:1/a,o=t*.8,h=a*.8,l=o>h?1/o:1/h,u=r[0].X,f=r[1].Y;this.Canvas.beginPath(),this.Canvas.moveTo(r[0].X,r[0].Y);for(var C=.5*Math.PI;C<=1.5*Math.PI;C+=s)this.Canvas.lineTo(u+t*Math.cos(C),f+a*Math.sin(C)*-1);for(var D=1.5*Math.PI;D>=.5*Math.PI;D-=l)this.Canvas.lineTo(u+o*Math.cos(D),f+h*Math.sin(D)*-1);this.Canvas.closePath()}else if(r[0].X<r[1].X&&r[0].Y<r[1].Y){var t=r[1].X-r[0].X,a=r[1].Y-r[0].Y,s=t>a?1/t:1/a,o=t*.8,h=a*.8,l=o>h?1/o:1/h,u=r[1].X,f=r[0].Y;this.Canvas.beginPath(),this.Canvas.moveTo(r[0].X,r[0].Y);for(var C=Math.PI;C<=2*Math.PI;C+=s)this.Canvas.lineTo(u+t*Math.cos(C),f+a*Math.sin(C)*-1);for(var D=2*Math.PI;D>=Math.PI;D-=l)this.Canvas.lineTo(u+o*Math.cos(D),f+h*Math.sin(D)*-1);this.Canvas.closePath()}return!!this.Canvas.isPointInPath(n,e)}}function _C(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureWaveMW",this.PointCount=5,this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.IsHScreen=!1,this.Draw=function(){if(this.LinePoint=[],!!this.Frame&&!this.IsFrameMinSize()){this.IsHScreen=this.Frame.IsHScreen;var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r){this.AreaColor=It.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.CalculateLines(r),this.SetLineWidth();for(var n in this.LinePoint){var e=this.LinePoint[n];this.DrawLine(e.Start,e.End)}this.RestoreLineWidth(),this.DrawPoint(r),this.Canvas.restore()}}},this.CalculateLines=function(r){if(this.Frame&&!(r.length<2)){if(this.Status==2){var n={Start:new ot,End:new ot};n.Start.Y=r[0].Y,n.Start.X=r[0].X,n.End.Y=r[1].Y,n.End.X=r[1].X,this.LinePoint.push(n);var e=r[1].X-r[0].X,t=r[1].Y-r[0].Y;n={Start:new ot,End:new ot},this.IsHScreen?(n.Start.Y=r[1].Y,n.Start.X=r[1].X,n.End.Y=r[1].Y+t,n.End.X=r[0].X):(n.Start.Y=r[1].Y,n.Start.X=r[1].X,n.End.Y=r[0].Y,n.End.X=r[1].X+e),this.LinePoint.push(n);var a=n.End,s=new ot;s.X=a.X,s.Y=a.Y,this.Point[2]=s,n={Start:new ot,End:new ot},this.IsHScreen?(n.Start.Y=a.Y,n.Start.X=a.X,n.End.Y=a.Y+t,n.End.X=r[1].X):(n.Start.Y=a.Y,n.Start.X=a.X,n.End.Y=r[1].Y,n.End.X=a.X+e),this.LinePoint.push(n);var a=n.End,s=new ot;s.X=a.X,s.Y=a.Y,this.Point[3]=s,n={Start:new ot,End:new ot},this.IsHScreen?(n.Start.Y=a.Y,n.Start.X=a.X,n.End.Y=a.Y+t,n.End.X=r[0].X):(n.Start.Y=a.Y,n.Start.X=a.X,n.End.Y=r[0].Y,n.End.X=a.X+e),this.LinePoint.push(n);var a=n.End,s=new ot;s.X=a.X,s.Y=a.Y,this.Point[4]=s,this.PointCount=this.Point.length}else if(r.length==5){var n={Start:new ot,End:new ot};n.Start.Y=r[0].Y,n.Start.X=r[0].X,n.End.Y=r[1].Y,n.End.X=r[1].X,this.LinePoint.push(n);var n={Start:new ot,End:new ot};n.Start.Y=r[1].Y,n.Start.X=r[1].X,n.End.Y=r[2].Y,n.End.X=r[2].X,this.LinePoint.push(n);var n={Start:new ot,End:new ot};n.Start.Y=r[2].Y,n.Start.X=r[2].X,n.End.Y=r[3].Y,n.End.X=r[3].X,this.LinePoint.push(n);var n={Start:new ot,End:new ot};n.Start.Y=r[3].Y,n.Start.X=r[3].X,n.End.Y=r[4].Y,n.End.X=r[4].X,this.LinePoint.push(n)}}}}function $d(){this.newMethod=_C,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawHeadShouldersBT",this.CalculateLines_Backup=this.CalculateLines,this.CalculateLines=function(r){if(this.Frame&&!(r.length<2))if(this.Status==2){var n={Start:new ot,End:new ot};n.Start.Y=r[0].Y,n.Start.X=r[0].X,n.End.Y=r[1].Y,n.End.X=r[1].X,this.LinePoint.push(n);var e=r[1].X-r[0].X,t=r[1].Y-r[0].Y;n={Start:new ot,End:new ot},this.IsHScreen?(n.Start.Y=r[1].Y,n.Start.X=r[1].X,n.End.Y=r[1].Y+t,n.End.X=r[0].X-e):(n.Start.Y=r[1].Y,n.Start.X=r[1].X,n.End.Y=r[0].Y-t,n.End.X=r[1].X+e),this.LinePoint.push(n);var a=n.End,s=new ot;s.X=a.X,s.Y=a.Y,this.Point[2]=s,n={Start:new ot,End:new ot},this.IsHScreen?(n.Start.Y=a.Y,n.Start.X=a.X,n.End.Y=a.Y+t,n.End.X=r[1].X):(n.Start.Y=a.Y,n.Start.X=a.X,n.End.Y=r[1].Y,n.End.X=a.X+e),this.LinePoint.push(n);var a=n.End,s=new ot;s.X=a.X,s.Y=a.Y,this.Point[3]=s,n={Start:new ot,End:new ot},this.IsHScreen?(n.Start.Y=a.Y,n.Start.X=a.X,n.End.Y=a.Y+t,n.End.X=r[0].X):(n.Start.Y=a.Y,n.Start.X=a.X,n.End.Y=r[0].Y,n.End.X=a.X+e),this.LinePoint.push(n);var a=n.End,s=new ot;s.X=a.X,s.Y=a.Y,this.Point[4]=s,this.PointCount=this.Point.length}else return this.CalculateLines_Backup(r)}}function Xh(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureParallelLines",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.PointCount=3,this.LastPoint,this.CenterLine={LineDash:[2*V(),3*V()],Line:null,IsShow:!1},this.Super_SetOption=this.SetOption,this.Super_ExportStorageData=this.ExportStorageData,this.SetOption=function(r){if(this.Super_SetOption&&this.Super_SetOption(r),r&&r.CenterLine){var n=r.CenterLine;c.IsNonEmptyArray(n.LineDash)&&(this.CenterLine.LineDash=n.LineDash.slice(0)),c.IsBool(n.IsShow)&&(this.CenterLine.IsShow=n.IsShow)}},this.ExportStorageData=function(){var r;return this.Super_ExportStorageData&&(r=this.Super_ExportStorageData(),this.CenterLine&&(r.CenterLine={IsShow:this.CenterLine.IsShow,LineDash:this.CenterLine.LineDash.slice(0)})),r},this.Draw=function(){if(this.LinePoint=[],this.CenterLine.Line=null,!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!1});if(r){this.AreaColor=It.ColorToRGBA(this.LineColor,.3);var n=r.slice(0);this.CalculateLines(n),this.ClipFrame(),this.DrawArea();for(var e in this.LinePoint){var t=this.LinePoint[e];this.DrawLine(t.Start,t.End)}if(this.CenterLine.IsShow&&this.CenterLine.Line){var t=this.CenterLine.Line;this.Canvas.setLineDash(this.CenterLine.LineDash),this.DrawLine(t.Start,t.End),this.Canvas.setLineDash([])}this.DrawPoint(n),this.Canvas.restore()}}},this.SetLastPoint=function(r){this.LastPoint={X:r.X,Y:r.Y}},this.DrawArea=function(){this.LinePoint.length==2&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[1].Start.X,this.LinePoint[1].Start.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(r){if(this.PointStatus==2&&this.LastPoint){var n=new ot;n.X=this.LastPoint.X,n.Y=this.LastPoint.Y,r[2]=n}if(r.length==2){var e=this.CalculateExtendLinePoint(r[0],r[1]);this.LinePoint.push(e)}else if(r.length==3){var e=this.CalculateExtendLinePoint(r[0],r[1]);this.LinePoint.push(e);var t=r[2].X-r[1].X,a=r[2].Y-r[1].Y,s=new ot,o=new ot;s.X=r[0].X+t,s.Y=r[0].Y+a,o.X=r[1].X+t,o.Y=r[1].Y+a,e=this.CalculateExtendLinePoint(s,o),this.LinePoint.push(e);var s=new ot,o=new ot;s.X=r[0].X+t/2,s.Y=r[0].Y+a/2,o.X=r[1].X+t/2,o.Y=r[1].Y+a/2,e=this.CalculateExtendLinePoint(s,o),this.CenterLine.Line=e}}}function UC(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawFlatTop",this.IsPointIn=this.IsPointIn_XYValue_Line,this.PointCount=3,this.LastPoint,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r){this.AreaColor=It.ColorToRGBA(this.LineColor,.3);var n=r.slice(0);this.CalculateLines(n),this.ClipFrame();for(var e=0;e<this.LinePoint.length;++e){var t=this.LinePoint[e];this.DrawLine(t.Start,t.End)}this.DrawArea(),this.DrawPoint(n),this.Canvas.restore()}}},this.SetLastPoint=function(r){this.LastPoint={X:r.X,Y:r.Y}},this.DrawArea=function(){this.LinePoint.length==2&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[1].Start.X,this.LinePoint[1].Start.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(r){if(this.PointStatus==2&&this.LastPoint){var n=r[1],e=new ot;e.X=n.X,e.Y=this.LastPoint.Y,r[2]=e}if(r.length==2)this.LinePoint.push({Start:r[0],End:r[1]});else if(r.length==3){this.LinePoint.push({Start:r[0],End:r[1]});var t=r[2];t.X=r[1].X;var a={X:r[0].X,Y:t.Y},s={X:r[1].X,Y:t.Y};this.LinePoint.push({Start:a,End:s})}}}function qd(){this.newMethod=UC,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawDisjontChannel",this.IsPointIn=this.IsPointIn_XYValue_Line,this.PointCount=3,this.LastPoint}function jd(){this.newMethod=Xh,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawParallelRaysLines",this.DrawArea=function(){},this.CalculateLines=function(r){if(this.PointStatus==2&&this.LastPoint){var n=new ot;n.X=this.LastPoint.X,n.Y=this.LastPoint.Y,r[2]=n}if(r.length==2){var e=this.CalculateExtendLineEndPoint([r[0],r[1]]);this.LinePoint.push({Start:r[0],End:e})}else if(r.length==3){var e=this.CalculateExtendLineEndPoint([r[0],r[1]]);this.LinePoint.push({Start:r[0],End:e});var t=r[2].X-r[1].X,a=r[2].Y-r[1].Y,s=new ot,o=new ot;s.X=r[0].X+t,s.Y=r[0].Y+a,o.X=r[1].X+t,o.Y=r[1].Y+a,e=this.CalculateExtendLineEndPoint([s,o]),this.LinePoint.push({Start:r[2],End:e})}}}function tm(){this.newMethod=Xh,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPicturePriceChannel",this.CalculateLines=function(r){if(this.PointStatus==2&&this.LastPoint){var n=new ot;n.X=this.LastPoint.X,n.Y=this.LastPoint.Y,r[2]=n}if(r.length==2){var e=this.CalculateExtendLinePoint(r[0],r[1]);this.LinePoint.push(e)}else if(r.length==3){var e=this.CalculateExtendLinePoint(r[0],r[1]);this.LinePoint.push(e);var t=r[2].X-r[1].X,a=r[2].Y-r[1].Y,s=new ot,o=new ot;s.X=r[0].X+t,s.Y=r[0].Y+a,o.X=r[1].X+t,o.Y=r[1].Y+a,e=this.CalculateExtendLinePoint(s,o),this.LinePoint.push(e);var s=new ot,o=new ot;s.X=r[0].X-t,s.Y=r[0].Y-a,o.X=r[1].X-t,o.Y=r[1].Y-a,e=this.CalculateExtendLinePoint(s,o),this.LinePoint.push(e)}},this.DrawArea=function(){this.LinePoint.length==3&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[1].Start.X,this.LinePoint[1].Start.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[2].End.X,this.LinePoint[2].End.Y),this.Canvas.lineTo(this.LinePoint[2].Start.X,this.LinePoint[2].Start.Y),this.Canvas.closePath(),this.Canvas.fill())}}function em(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureParallelChannel",this.ChannelWidth=50,this.AreaColor="rgba(25,25,25,0.4)",this.LinePoint=[],this.CenterLine={LineDash:[2*V(),3*V()],Line:null,IsShow:!1},this.Super_SetOption=this.SetOption,this.ExportStorageData=function(){var r=this.ExportBaseData();r.ChannelWidth=this.ChannelWidth,r.Value=[];for(var n=0;n<this.Value.length&&n<2;++n){var e=this.Value[n];r.Value.push({XValue:e.XValue,YValue:e.YValue,DateTime:e.DateTime})}return this.CenterLine&&(r.CenterLine={IsShow:this.CenterLine.IsShow,LineDash:this.CenterLine.LineDash.slice(0)}),r},this.SetOption=function(r){if(this.Super_SetOption&&this.Super_SetOption(r),r&&(c.IsNumber(r.ChannelWidth)&&(this.ChannelWidth=r.ChannelWidth),r.CenterLine)){var n=r.CenterLine;c.IsNonEmptyArray(n.LineDash)&&(this.CenterLine.LineDash=n.LineDash.slice(0)),c.IsBool(n.IsShow)&&(this.CenterLine.IsShow=n.IsShow)}},this.CalculateDrawPoint=function(){if(this.Status<2||!this.Point.length||!this.Frame)return null;var r=this.Frame.Data;if(!r)return null;var n=[];if(this.Status==10)for(var e=0;e<2;++e){var t=this.Value[e],a=new ot;a.X=this.Frame.GetXFromIndex(t.XValue-r.DataOffset,!1),a.Y=this.Frame.GetYFromData(t.YValue,!1),n.push(a)}else for(var e=0;e<this.Point.length;++e){var t=this.Point[e],a=new ot;a.X=t.X,a.Y=t.Y,n.push(a)}if(n.length>=2){var s={Start:new ot,End:new ot};if(s.Start.X=n[0].X,s.Start.Y=n[0].Y,s.End.X=n[1].X,s.End.Y=n[1].Y,this.LinePoint.push(s),n.length==3||this.Status==10){var o=s.End.X-s.Start.X,h=s.End.Y-s.Start.Y,l=Math.atan(Math.abs(o/h)),u=this.ChannelWidth/Math.sin(l);s={Start:new ot,End:new ot},s.Start.X=n[0].X,s.Start.Y=n[0].Y-u,s.End.X=n[1].X,s.End.Y=n[1].Y-u,this.LinePoint.push(s);var f=new ot;f.X=s.Start.X+(s.End.X-s.Start.X)/2,f.Y=s.Start.Y+(s.End.Y-s.Start.Y)/2,n[3]=f,this.Point[2]=f;var C=parseInt(this.Frame.GetXData(f.X))+r.DataOffset,D=this.Frame.GetYData(f.Y);this.Value[2]={XValue:C,YValue:D},this.PointCount=this.Point.length,s={Start:new ot,End:new ot},s.Start.X=n[0].X,s.Start.Y=n[0].Y-u/2,s.End.X=n[1].X,s.End.Y=n[1].Y-u/2,this.CenterLine.Line=s}}return n},this.DrawArea=function(r,n,e,t){this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(r.X,r.Y),this.Canvas.lineTo(n.X,n.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.lineTo(t.X,t.Y),this.Canvas.closePath(),this.Canvas.fill()},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint();if(r){this.AreaColor=It.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.LinePoint.length==2&&this.DrawArea(this.LinePoint[0].Start,this.LinePoint[0].End,this.LinePoint[1].End,this.LinePoint[1].Start);for(var n=0;n<this.LinePoint.length;++n){var e=this.LinePoint[n];this.DrawLine(e.Start,e.End)}if(this.CenterLine.IsShow&&this.CenterLine.Line){var e=this.CenterLine.Line;this.Canvas.setLineDash(this.CenterLine.LineDash),this.DrawLine(e.Start,e.End),this.Canvas.setLineDash([])}this.Canvas.restore(),this.DrawPoint(r)}}},this.Move=function(r,n){if(this.Status!=20)return fasle;if(!this.Frame)return!1;var e=this.Frame.Data;if(!e)return!1;if(this.MovePointIndex==100)for(var t=0;t<this.Point.length;++t)this.Point[t].X+=r,this.Point[t].Y+=n;else if(this.MovePointIndex==0||this.MovePointIndex==1)this.MovePointIndex<this.Point.length&&(this.Point[this.MovePointIndex].X+=r,this.Point[this.MovePointIndex].Y+=n);else if(this.MovePointIndex==2){this.Point[this.MovePointIndex].X+=r,this.Point[this.MovePointIndex].Y+=n;var a=this.Point[1].X-this.Point[0].X,s=this.Point[1].Y-this.Point[0].Y,o=Math.atan(Math.abs(a/s)),h=this.ChannelWidth/Math.sin(o)-n;this.ChannelWidth=Math.sin(o)*h}},this.IsPointIn=function(r,n){if(!this.Frame||this.Status!=10)return-1;var e=this.Frame.Data;if(!e)return-1;for(var t=0;t<this.Value.length;++t){var a=this.Value[t],s=new ot;if(t<2)s.X=this.Frame.GetXFromIndex(a.XValue-e.DataOffset),s.Y=this.Frame.GetYFromData(a.YValue);else{if(t>=this.Point.length)continue;s.X=this.Point[t].X,s.Y=this.Point[t].Y}if(this.Canvas.beginPath(),this.Canvas.arc(s.X,s.Y,5,0,360),this.Canvas.isPointInPath(r,n))return t}for(var t in this.LinePoint){var a=this.LinePoint[t],o=a.Start,h=a.End;if(this.Canvas.beginPath(),this.Canvas.moveTo(o.X,o.Y+5),this.Canvas.lineTo(o.X,o.Y-5),this.Canvas.lineTo(h.X,h.Y-5),this.Canvas.lineTo(h.X,h.Y+5),this.Canvas.closePath(),this.Canvas.isPointInPath(r,n))return 100}return-1}}function am(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureText",this.Text="文本",this.PointCount=1,this.FontOption={Family:"微软雅黑",Size:20,Weight:null,Style:null},this.TextRect=null,this.IsInitialized=!1,this.SettingMenu,this.HQChart,this.SetOption=function(r){r&&(r.LineColor&&(this.LineColor=r.LineColor),r.Text&&(this.Text=r.Text),r.FontOption&&(this.FontOption=r.FontOption))},this.Draw=function(r){if(this.TextRect=null,!this.IsFrameMinSize()){var n=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!(!n||n.length!=1)){this.ClipFrame(),this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.Canvas.font=this.GetTextFont(),this.Canvas.fillText(this.Text,n[0].X,n[0].Y);var e=this.Canvas.measureText(this.Text).width,t=this.FontOption.Size*V();this.TextRect={},this.TextRect.Left=n[0].X-e/2,this.TextRect.Top=n[0].Y-t,this.TextRect.Width=e,this.TextRect.Height=t,this.Canvas.restore(),this.IsInitialized===!1&&(this.SetTextOption(),this.IsInitialized=!0)}}},this.GetTextFont=function(){var r=16*V()+"px 微软雅黑";if(!this.FontOption||!this.FontOption.Family||this.FontOption.Size<=0)return r;var n="";return this.FontOption.Color&&(n+=this.FontOption.Color+" "),this.FontOption.Style&&(n+=this.FontOption.Style+" "),this.FontOption.Weight&&(n+=this.FontOption.Weight+" "),this.FontOption.Size>=0&&(n+=this.FontOption.Size*V()+"px "),n+=this.FontOption.Family,n},this.SetTextOption=function(){X.Chart.Log("[ChartDrawPictureText::SetTextOption]"),this.SettingMenu||(this.SettingMenu=new zh(this.Frame.ChartBorder.UIElement.parentNode)),this.SettingMenu.ChartPicture=this,this.SettingMenu.HQChart=this.HQChart,this.SettingMenu.Position={Left:this.TextRect.Left+this.TextRect.Width,Top:this.TextRect.Top},this.SettingMenu.DoModal()},this.IsPointIn=function(r,n){if(!this.Frame||this.Status!=10)return-1;var e=this.Frame.Data;return!e||!this.TextRect?-1:(this.Canvas.beginPath(),this.Canvas.rect(this.TextRect.Left,this.TextRect.Top,this.TextRect.Width,this.TextRect.Height),this.Canvas.isPointInPath(r,n)?100:-1)}}function Wh(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureIconFont",this.PointCount=1,this.Text="",this.FontOption={Family:"iconfont",Size:24},this.TextRect=null,this.SettingMenu,this.Angle=0,this.SetOption=function(r){r&&(r.LineColor&&(this.LineColor=r.LineColor),r.FontOption&&r.FontOption.Size>0&&(this.FontOption.Size=r.FontOption.Size),c.IsNumber(r.Angle)&&(this.Angle=r.Angle))},this.Draw=function(){if(this.TextRect=null,!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!(!r||r.length!=1)){var n=this.GetTextFont();if(n){this.ClipFrame();var e=this.Frame.IsHScreen,t=V();this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.font=n,e?(this.Canvas.translate(r[0].X,r[0].Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.Text,0,0)):this.Angle!=0?(this.Canvas.translate(r[0].X,r[0].Y),this.Canvas.rotate(this.Angle*(Math.PI/180)),this.Canvas.fillText(this.Text,0,0)):this.Canvas.fillText(this.Text,r[0].X,r[0].Y);var a=this.Canvas.measureText(this.Text).width;this.TextRect={},this.TextRect.Left=r[0].X-a/2,this.TextRect.Top=r[0].Y-this.FontOption.Size*t,this.TextRect.Width=a,this.TextRect.Height=this.FontOption.Size*t,this.Canvas.restore()}}}},this.GetTextFont=function(){if(!this.FontOption||!this.FontOption.Family||this.FontOption.Size<=0)return null;var r="";return this.FontOption.Size>=0&&(r+=this.FontOption.Size*V()+"px "),r+=this.FontOption.Family,r},this.IsPointIn=function(r,n){if(!this.Frame||this.Status!=10)return-1;var e=this.Frame.Data;if(!e||!this.TextRect)return-1;var t=0;return this.Option&&this.Option.Zoom>=1&&(t=this.Option.Zoom*V()),this.Canvas.beginPath(),this.Canvas.rect(this.TextRect.Left-t,this.TextRect.Top-t,this.TextRect.Width+t*2,this.TextRect.Height+t*2),this.Canvas.isPointInPath(r,n)?100:-1}}function KC(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureGannFan",this.IsPointIn=this.IsPointIn_XYValue_Line,this.LinePoint=[],this.Font=16*V()+"px 微软雅黑",this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r&&r.length==2){this.AreaColor=It.ColorToRGBA(this.LineColor,.3),this.ClipFrame();var n=this.GetQuadrant(r[0],r[1]);if(this.SetLineWidth(),n===1||n===4){this.CalculateLines(r[0],r[1],n),this.DrawArea();for(var e in this.LinePoint){var t=this.LinePoint[e];this.DrawLine(t.Start,t.End,t.IsDottedLine)}for(var e in this.LinePoint){var t=this.LinePoint[e];t.Text&&t.PtEnd&&this.DrawTitle(t.PtEnd,t.Text)}}else this.DrawLine(r[0],r[1],!1);this.RestoreLineWidth(),this.Canvas.restore(),this.DrawPoint(r)}}},this.GetQuadrant=function(r,n){return r.X<n.X&&r.Y>n.Y?1:r.X<n.X&&r.Y>n.Y?2:r.X<n.X&&r.Y<n.Y?4:3},this.DrawLine=function(r,n,e){e&&this.Canvas.setLineDash([5,10]),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(r.X,r.Y),this.Canvas.lineTo(n.X,n.Y),this.Canvas.stroke(),e&&this.Canvas.setLineDash([])},this.DrawTitle=function(r,n){this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.font=this.Font,this.Canvas.fillText(n,r.X,r.Y)},this.DrawArea=function(){var r=null,n=null;for(var e in this.LinePoint){var t=this.LinePoint[e];t.Text=="1:8"?r=this.LinePoint[e]:t.Text=="8:1"&&(n=this.LinePoint[e])}!r||!n||(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(r.End.X,r.End.Y),this.Canvas.lineTo(r.Start.X,r.Start.Y),this.Canvas.lineTo(n.End.X,n.End.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(r,n,e){if(!this.Frame)return!1;this.Frame.ChartBorder.GetTopEx(),this.Frame.ChartBorder.GetRight(),this.Frame.ChartBorder.GetBottom();var t=[.5,1/3,.25,.125,2/3],a=["1:2","1:3","1:4","1:8","2:3"],s=["2:1","3:1","4:1","8:1","3:2"],o=new ot,h=new ot;o.X=r.X,o.Y=r.Y,h.X=n.X,h.Y=n.Y;var l=Math.abs(r.X-n.X),u=Math.abs(r.Y-n.Y);if(e===1){var f=this.CalculateExtendLinePoint(r,n),C={Start:o,End:f.Start,IsDottedLine:!1,PtEnd:h,Text:"1:1"};this.LinePoint.push(C);for(var D in t){if(l>5){C={Start:o,End:null,IsDottedLine:!1,PtEnd:new ot,Text:a[D]},C.PtEnd.Y=n.Y,C.PtEnd.X=r.X+l*t[D];var f=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=f.Start,this.LinePoint.push(C)}if(u>5){C={Start:o,End:null,IsDottedLine:!1,PtEnd:new ot,Text:s[D]},C.PtEnd.Y=r.Y-u*t[D],C.PtEnd.X=n.X;var f=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=f.Start,this.LinePoint.push(C)}}}else if(e==4){var f=this.CalculateExtendLinePoint(r,n),C={Start:o,End:f.End,IsDottedLine:!1,PtEnd:h,Text:"1:1"};this.LinePoint.push(C);for(var D in t){if(l>5){C={Start:o,End:null,IsDottedLine:!1,PtEnd:new ot,Text:a[D]},C.PtEnd.Y=n.Y,C.PtEnd.X=r.X+l*t[D];var f=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=f.End,this.LinePoint.push(C)}if(u>5){C={Start:o,End:null,IsDottedLine:!1,PtEnd:new ot,Text:s[D]},C.PtEnd.Y=r.Y+u*t[D],C.PtEnd.X=n.X;var f=this.CalculateExtendLinePoint(C.Start,C.PtEnd);C.End=f.End,this.LinePoint.push(C)}}}else return!1;return!0}}function im(){this.newMethod=KC,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureResistanceLine",this.CalculateLines=function(r,n,e){if(!this.Frame)return!1;this.Frame.ChartBorder.GetTopEx(),this.Frame.ChartBorder.GetRight(),this.Frame.ChartBorder.GetBottom();var t=[1/3,2/3],a=["3:1","3:2"],s=new ot,o=new ot;s.X=r.X,s.Y=r.Y,o.X=n.X,o.Y=n.Y,Math.abs(r.X-n.X);var h=Math.abs(r.Y-n.Y);if(e===1){var l=this.CalculateExtendLinePoint(r,n),u={Start:s,End:l.Start,IsDottedLine:!1,PtEnd:o,Text:"1:1"};this.LinePoint.push(u);for(var f in t)if(h>5){u={Start:s,End:null,IsDottedLine:!1,PtEnd:new ot,Text:a[f]},u.PtEnd.Y=r.Y-h*t[f],u.PtEnd.X=n.X;var l=this.CalculateExtendLinePoint(u.Start,u.PtEnd);u.End=l.Start,this.LinePoint.push(u)}}else if(e==4){var l=this.CalculateExtendLinePoint(r,n),u={Start:s,End:l.End,IsDottedLine:!1,PtEnd:o,Text:"1:1"};this.LinePoint.push(u);for(var f in t)if(h>5){u={Start:s,End:null,IsDottedLine:!1,PtEnd:new ot,Text:a[f]},u.PtEnd.Y=r.Y+h*t[f],u.PtEnd.X=n.X;var l=this.CalculateExtendLinePoint(u.Start,u.PtEnd);u.End=l.End,this.LinePoint.push(u)}}else return!1;return!0},this.DrawArea=function(){var r=null,n=null;for(var e in this.LinePoint){var t=this.LinePoint[e];t.Text=="1:1"?r=this.LinePoint[e]:t.Text=="3:1"&&(n=this.LinePoint[e])}!r||!n||(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(r.End.X,r.End.Y),this.Canvas.lineTo(r.Start.X,r.Start.Y),this.Canvas.lineTo(n.End.X,n.End.Y),this.Canvas.closePath(),this.Canvas.fill())}}function _h(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureGoldenSection",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Font=14*V()+"px 微软雅黑",this.GetSectionData=function(){var r=[0,.236,.382,.5,.618,.8,1,1.236,1.382,1.5,1.618,1.8,2];return r},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint();if(r&&r.length==2){this.AreaColor=It.ColorToRGBA(this.LineColor,.3),this.CalculateLines(r[0],r[1]),this.ClipFrame(),this.SetLineWidth();for(var n in this.LinePoint){var e=this.LinePoint[n];this.DrawLine(e.Start,e.End,e.IsDottedLine)}this.RestoreLineWidth();for(var n in this.LinePoint){var e=this.LinePoint[n];e.Text&&this.DrawTitle(e.Start,e.Text)}this.DrawPoint(r),this.Canvas.restore()}}},this.CalculateHSCreenLines=function(r,n){for(var e=this.GetSectionData(),t=this.Frame.ChartBorder.GetTop(),a=this.Frame.ChartBorder.GetBottom(),s=r.X-n.X,o=0;o<e.length;++o){var h=s*e[o],l={Start:new ot,End:new ot};l.Start.X=r.X-h,l.Start.Y=t,l.End.X=r.X-h,l.End.Y=a;var u="";o==0?u="Base ":u=(e[o]*100).toFixed(2)+"% ";var f=this.Frame.GetYData(l.Start.X);u+=f.toFixed(2),l.Text=u,this.LinePoint.push(l)}},this.CalculateLines=function(r,n){if(this.Frame.IsHScreen){this.CalculateHSCreenLines(r,n);return}for(var e=this.GetSectionData(),t=this.Frame.ChartBorder.GetLeft(),a=this.Frame.ChartBorder.GetRight(),s=r.Y-n.Y,o=0;o<e.length;++o){var h=s*e[o],l={Start:new ot,End:new ot};l.Start.Y=r.Y-h,l.Start.X=t,l.End.Y=r.Y-h,l.End.X=a;var u="";o==0?u="Base ":u=(e[o]*100).toFixed(2)+"% ";var f=this.Frame.GetYData(l.Start.Y);u+=f.toFixed(2),l.Text=u,this.LinePoint.push(l)}},this.DrawLine=function(r,n){this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(r.X,r.Y),this.Canvas.lineTo(n.X,n.Y),this.Canvas.stroke()},this.DrawTitle=function(r,n){this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom",this.Canvas.font=this.Font,this.Frame.IsHScreen?(this.Canvas.save(),this.Canvas.translate(r.X,r.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(n,0,0),this.Canvas.restore()):this.Canvas.fillText(n,r.X,r.Y)}}function rm(){this.newMethod=_h,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPicturePercentage",this.GetSectionData=function(){var r=[0,.25,.333,.5,1];return r}}function nm(){this.newMethod=_h,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureWaveBand",this.GetSectionData=function(){var r=[0,.125,.25,.375,.5,.625,.75,.875,1];return r}}function sm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureTriangle",this.PointCount=3,this.Font=16*V()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.LastPoint,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r){var n=r.slice(0);this.AreaColor=It.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.CalculateLines(n);for(var e in this.LinePoint){var t=this.LinePoint[e];this.DrawLine(t.Start,t.End)}this.DrawArea(n),this.DrawPoint(n),this.DrawTitle(n),this.Canvas.restore()}}},this.DrawArea=function(r){r.length==3&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(r[0].X,r[0].Y),this.Canvas.lineTo(r[1].X,r[1].Y),this.Canvas.lineTo(r[2].X,r[2].Y),this.Canvas.lineTo(r[0].X,r[0].Y),this.Canvas.closePath(),this.Canvas.fill())},this.DrawTitle=function(r){this.Status==10},this.SetLastPoint=function(r){this.LastPoint={X:r.X,Y:r.Y}},this.CalculateLines=function(r){if(this.PointStatus==2&&this.LastPoint){var n=new ot;n.X=this.LastPoint.X,n.Y=this.LastPoint.Y,r[2]=n}if(r.length===2){var e={Start:new ot,End:new ot};e.Start.Y=r[0].Y,e.Start.X=r[0].X,e.End.Y=r[1].Y,e.End.X=r[1].X,this.LinePoint.push(e)}else if(r.length===3){var e={Start:new ot,End:new ot};e.Start.Y=r[0].Y,e.Start.X=r[0].X,e.End.Y=r[1].Y,e.End.X=r[1].X,this.LinePoint.push(e),e={Start:new ot,End:new ot},e.Start.Y=r[1].Y,e.Start.X=r[1].X,e.End.Y=r[2].Y,e.End.X=r[2].X,this.LinePoint.push(e),e={Start:new ot,End:new ot},e.Start.Y=r[2].Y,e.Start.X=r[2].X,e.End.Y=r[0].Y,e.End.X=r[0].X,this.LinePoint.push(e)}}}function om(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureSymmetryAngle",this.PointCount=2,this.Font=16*V()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r){this.AreaColor=It.ColorToRGBA(this.LineColor,.3),this.ClipFrame(),this.CalculateLines(r);for(var n in this.LinePoint){var e=this.LinePoint[n];this.DrawLine(e.Start,e.End)}this.DrawArea(),this.DrawPoint(r),this.DrawTitle(r),this.Canvas.restore()}}},this.CalculateLines=function(r){if(r.length==2&&this.Frame){var n={Start:new ot,End:new ot};n.Start.Y=r[0].Y,n.Start.X=r[0].X,n.End.Y=r[1].Y,n.End.X=r[1].X,this.LinePoint.push(n),n={Start:new ot,End:new ot},n.Start.Y=r[0].Y,n.Start.X=r[0].X,n.End.Y=r[1].Y,n.End.X=r[0].X,this.LinePoint.push(n);var e=r[0].X-r[1].X;n={Start:new ot,End:new ot},n.Start.Y=r[0].Y,n.Start.X=r[0].X,n.End.Y=r[1].Y,n.End.X=r[0].X+e,this.LinePoint.push(n)}},this.DrawArea=function(){this.LinePoint.length==3&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[2].End.X,this.LinePoint[2].End.Y),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.closePath(),this.Canvas.fill())},this.DrawTitle=function(r){this.Status==10}}function hm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureCircle",this.PointCount=2,this.CircleData,this.GetXYCoordinate=this.GetXYCoordinate_default,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!(!r||r.length!=2)){this.AreaColor=It.ColorToRGBA(this.LineColor,.3),this.ClipFrame();var n=r[0].X-r[1].X,e=r[0].Y-r[1].Y,t=Math.sqrt(n*n+e*e);this.Canvas.fillStyle=this.AreaColor,this.Canvas.strokeStyle=this.LineColor,this.DrawLine(r[0],r[1]),this.Canvas.beginPath(),this.Canvas.arc(r[0].X,r[0].Y,t,0,2*Math.PI),this.Canvas.stroke(),this.Canvas.fill(),this.CircleData={X:r[0].X,Y:r[0].Y,R:t},this.DrawPoint(r),this.Canvas.restore()}}},this.IsPointIn=function(r,n,e){if(this.IsFrameMinSize()||this.Status!=10)return-1;var t=this.IsPointInXYValue(r,n,e);if(t>=0)return t;if(this.CircleData&&this.CircleData.R>8){var a=this.CircleData.X-r,s=this.CircleData.Y-n,o=Math.sqrt(a*a+s*s);if(o<this.CircleData.R&&o>this.CircleData.R-8)return 100}return-1}}function lm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureQuadrangle",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.PointCount=3,this.LastPoint,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r){this.AreaColor=It.ColorToRGBA(this.LineColor,.3);var n=r.slice(0);this.CalculateLines(n),this.ClipFrame();for(var e in this.LinePoint){var t=this.LinePoint[e];this.DrawLine(t.Start,t.End)}this.DrawArea(),this.DrawPoint(n),this.Canvas.restore()}}},this.SetLastPoint=function(r){this.LastPoint={X:r.X,Y:r.Y}},this.DrawArea=function(){this.LinePoint.length==4&&(this.Canvas.fillStyle=this.AreaColor,this.Canvas.beginPath(),this.Canvas.moveTo(this.LinePoint[0].Start.X,this.LinePoint[0].Start.Y),this.Canvas.lineTo(this.LinePoint[0].End.X,this.LinePoint[0].End.Y),this.Canvas.lineTo(this.LinePoint[1].End.X,this.LinePoint[1].End.Y),this.Canvas.lineTo(this.LinePoint[2].End.X,this.LinePoint[2].End.Y),this.Canvas.closePath(),this.Canvas.fill())},this.CalculateLines=function(r){if(this.PointStatus==2&&this.LastPoint){var n=new ot;n.X=this.LastPoint.X,n.Y=this.LastPoint.Y,r[2]=n}if(r.length==2){var e=this.CreateLineData(r[0],r[1]);this.LinePoint.push(e)}else if(r.length==3){var e=this.CreateLineData(r[0],r[1]);this.LinePoint.push(e);var e=this.CreateLineData(r[1],r[2]);this.LinePoint.push(e);var t=r[2].X-r[1].X,a=r[2].Y-r[1].Y,s=new ot;s.X=r[0].X+t,s.Y=r[0].Y+a;var e=this.CreateLineData(r[2],s);this.LinePoint.push(e);var e=this.CreateLineData(s,r[0]);this.LinePoint.push(e)}}}function um(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPictureFibonacci",this.PointCount=1,this.Font=14*V()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint();if(r&&(this.CalculateLines(),!(this.LinePoint.length<=0))){this.ClipFrame(),this.SetLineWidth();for(var n in this.LinePoint){var e=this.LinePoint[n];this.DrawLine(e.Start,e.End),this.DrawTitle(e.Start,e.Title)}this.RestoreLineWidth(),this.DrawPoint(r),this.Canvas.restore()}}},this.DrawTitle=function(r,n){this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.font=this.Font,this.Frame.IsHScreen?(this.Canvas.save(),this.Canvas.translate(r.X,r.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(n,2,10),this.Canvas.restore()):this.Canvas.fillText(n,r.X+2,r.Y+10)},this.CalculateHSCreenLines=function(){var r=this.Frame.Data;if(r){var n=null;if(this.Status==10){if(this.Value.length!=1)return;n=this.Value[0].XValue}else{if(this.Point.length!=1)return;n=parseInt(this.Frame.GetXData(this.Point[0].Y))+r.DataOffset}for(var e=this.Frame.ChartBorder.GetRightEx(),t=this.Frame.ChartBorder.GetLeftEx(),a=this.Frame.XPointCount,s=[1,2,3,5,8,13,21,34,55,89,144,233],o=0;o<s.length;++o){var h=n+s[o],l=h-r.DataOffset;if(!(l<0||l>=a)){var u=this.Frame.GetXFromIndex(h-r.DataOffset,!1),f={Start:new ot,End:new ot,Title:s[o]};f.Start.X=e,f.Start.Y=u,f.End.X=t,f.End.Y=u,this.LinePoint.push(f)}}}},this.CalculateLines=function(){if(!(this.Status<2)&&this.Frame){var r=this.Frame.Data;if(r){if(this.Frame.IsHScreen){this.CalculateHSCreenLines();return}var n=null;if(this.Status==10){if(this.Value.length!=1)return;n=this.Value[0].XValue}else{if(this.Point.length!=1)return;n=parseInt(this.Frame.GetXData(this.Point[0].X))+r.DataOffset}for(var e=this.Frame.ChartBorder.GetTopEx(),t=this.Frame.ChartBorder.GetBottom(),a=this.Frame.XPointCount,s=[1,2,3,5,8,13,21,34,55,89,144,233],o=0;o<s.length;++o){var h=n+s[o],l=h-r.DataOffset;if(!(l<0||l>=a)){var u=this.Frame.GetXFromIndex(h-r.DataOffset,!1),f={Start:new ot,End:new ot,Title:s[o]};f.Start.Y=e,f.Start.X=u,f.End.Y=t,f.End.X=u,this.LinePoint.push(f)}}}}}}function Eo(r){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawLinearRegression",this.PointCount=2,this.IsPointIn=this.IsPointIn_XYValue_Line,this.ChartBorder,this.Lines=[],this.IsShowMaxMinLine=!1,this.IsShowExtendLine=!1,this.ExtendLineDash=[5,5],this.MaxPoint,this.MinPoint,r&&(r.IsShowMaxMinLine==!0&&(this.IsShowMaxMinLine=!0),r.IsShowExtendLine==!0&&(this.IsShowExtendLine=!0)),this.ImportStorageData=function(n){n.IsShowMaxMinLine==!0&&(this.IsShowMaxMinLine=!0),n.IsShowExtendLine==!0&&(this.IsShowExtendLine=!0),n.Lines&&(this.Lines=n.Lines),n.MaxPoint&&n.MinPoint&&(this.MaxPoint=n.MaxPoint,this.MinPoint=n.MinPoint)},this.Super_ExportStorageData=this.ExportStorageData,this.ExportStorageData=function(){var n;return this.Super_ExportStorageData&&(n=this.Super_ExportStorageData(),n.IsShowMaxMinLine=this.IsShowMaxMinLine,n.IsShowExtendLine=this.IsShowExtendLine,n.Lines=this.Lines,this.IsShowMaxMinLine&&(n.MaxPoint=this.MaxPoint,n.MinPoint=this.MinPoint)),n},this.PointToValue_Backup=this.PointToValue,this.PointToValue=function(){this.Point[0]={X:this.Lines[0].X,Y:this.Lines[0].Y},this.Point[1]={X:this.Lines[this.Lines.length-1].X,Y:this.Lines[this.Lines.length-1].Y},this.PointToValue_Backup()},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var n=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!n||n.length!=2){this.Status==10&&(this.ClipFrame(),this.ChartBorder=this.Frame.ChartBorder,this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.DrawLinearLines(),this.RestoreLineWidth(),this.Canvas.restore());return}this.ClipFrame(),this.ChartBorder=this.Frame.ChartBorder,this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor;var e=n[0],t=n[1];if(this.Status==10)this.DrawLinearLines();else{var a=this.ChartBorder.GetTopEx(),s=this.ChartBorder.GetBottomEx(),o=this.PointToKLine([e,t]),h=this.Calculate(o);this.Lines=h.Points,this.MaxPoint=h.Max,this.MinPoint=h.Min,this.DrawLinearLines(),this.Canvas.beginPath(),this.Canvas.moveTo(e.X,a),this.Canvas.lineTo(e.X,s),this.Canvas.moveTo(t.X,a),this.Canvas.lineTo(t.X,s),this.Canvas.stroke()}this.RestoreLineWidth();var l={Start:e,End:t};this.LinePoint.push(l),this.DrawPoint(n),this.Canvas.restore()}},this.Calculate=function(n){var e=n[0],t=n[1];e.XValue>t.XValue&&(e=n[1],t=n[0]);var a=t.XValue-e.XValue+1,s=this.Frame.Data.Data,D=t.XValue,o=0,h=0,l=0,u=0,f,C,D,v,S,T;for(v=0,S=a;v<a&&v<=D;++v,--S)o+=S,h+=s[D-v].Close;for(o/=a,h/=a,v=0,S=a;v<a&&v<=D;++v,--S)l+=(S-o)*(s[D-v].Close-h),u+=(S-o)*(S-o);C=l/u,f=h-o*C;var I=[],F=null,E=null;for(v=0,T=a;v<a&&v<=D;++v,--T){var M=t.XIndex-v,O=t.XValue-v,S=this.Frame.GetXFromIndex(M),R=C*T+f,b=this.Frame.GetYFromData(R,!1),p={X:S,Y:b,XValue:O,YValue:R};I.push(p),(F==null||F.High<s[O].High)&&(F={X:S,Y:b,XValue:O,YValue:R,High:s[O].High}),(E==null||E.Low>s[O].Low)&&(E={X:S,Y:b,XValue:O,YValue:R,Low:s[O].Low})}return{Points:I,Slope:C,Const:f,Max:F,Min:E}},this.DrawLinearLines=function(){if(!this.Frame)return null;var n=this.Frame.Data;if(!n)return null;var e=this.Frame.XPointCount,t=n.DataOffset,a=this.Frame.IsHScreen,s=[];for(var o in this.Lines){var h=this.Lines[o],l=h.XValue-t;if(!(l<0||l>=e)){var u={};a||(u.X=this.Frame.GetXFromIndex(l,!1),u.Y=this.Frame.GetYFromData(h.YValue,!1),u.YValue=h.YValue),s.push(u)}}if(s.length>1){for(var o in s){var h=s[o];o==0?(this.Canvas.beginPath(),this.Canvas.moveTo(h.X,h.Y)):(this.Canvas.lineTo(h.X,h.Y),o==s.length-1&&this.Canvas.stroke())}this.DrawExtendLine(s)}if(this.IsShowMaxMinLine&&s.length>1&&this.MaxPoint&&this.MinPoint){var f=this.MaxPoint.High-this.MaxPoint.YValue;for(var o in s){var h=s[o];h.Y=this.Frame.GetYFromData(h.YValue+f,!1),o==0?(this.Canvas.beginPath(),this.Canvas.moveTo(h.X,h.Y)):(this.Canvas.lineTo(h.X,h.Y),o==s.length-1&&this.Canvas.stroke())}this.DrawExtendLine(s);var C=this.MinPoint.Low-this.MinPoint.YValue;for(var o in s){var h=s[o];h.Y=this.Frame.GetYFromData(h.YValue+C,!1),o==0?(this.Canvas.beginPath(),this.Canvas.moveTo(h.X,h.Y)):(this.Canvas.lineTo(h.X,h.Y),o==s.length-1&&this.Canvas.stroke())}this.DrawExtendLine(s)}},this.DrawExtendLine=function(n){if(this.IsShowExtendLine){var e=n[0],t=n[n.length-1],a;t.X>e.X?a=[e,t]:a=[t,e];var s=this.CalculateExtendLineEndPoint(a);this.Canvas.beginPath(),this.Canvas.moveTo(t.X,t.Y),this.Canvas.lineTo(s.X,s.Y),this.Canvas.setLineDash(this.ExtendLineDash),this.Canvas.stroke(),this.Canvas.setLineDash([])}}}function fm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawRuler",this.PointCount=2,this.Font=16*V()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.TitleColor=m.ChartDrawRuler.TitleColor,this.IsHScreen=!1,this.Draw=function(){this.LinePoint=[];var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r&&r.length==2){this.IsHScreen=this.Frame.IsHScreen,this.ClipFrame();var n=r[0],e=r[1],t=this.PointToKLine([n,e]),a=this.Calculate(t),s=c.IsNumber(a.Increase)?a.Increase.toFixed(2)+"%":"--",o=c.IsNumber(a.Risefall)?a.Risefall.toFixed(2):"--",h="间距:"+a.Count+" 涨跌:"+o+" 涨幅:"+s;this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(n.X,n.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.stroke(),this.RestoreLineWidth();var l={Start:n,End:e};this.LinePoint.push(l),this.DrawPoint(r),this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.font=this.Font,this.TitleColor?this.Canvas.fillStyle=this.TitleColor:c.IsNumber(a.Increase)?a.Increase>0?this.Canvas.fillStyle=m.UpTextColor:a.Increase<0?this.Canvas.fillStyle=m.DownTextColor:this.Canvas.fillStyle=m.UnchagneTextColor:this.Canvas.fillStyle=m.UnchagneTextColor;var u=3*V(),f=n.X,C=n.Y;this.IsHScreen?(this.Canvas.translate(f+u,C+u),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(h,0,0)):this.Canvas.fillText(h,f+u,C-u),this.Canvas.restore()}},this.Calculate=function(r){var n=r[0],e=r[1];n.XValue>e.XValue&&(n=r[1],e=r[0]);for(var t=this.Frame.Data.Data,a,s,o,h,l,u=0,f=n.XValue;f<=e.XValue;++f,++u){var C=t[f];u==0?(h=C.YClose,a=C.Open,l=C.Close,o=C.Low,s=C.High):(l=C.Close,o>C.Low&&(o=C.Low),s<C.High&&(s=C.High))}if(!c.IsPlusNumber(h)){var D=n.XValue-1;D>=0&&D<t.length&&(h=t[D].Close)}var v={YClose:h,Open:a,High:s,Low:o,Close:l,Count:u};return c.IsPlusNumber(h)&&(v.Increase=(l-h)/h*100,v.Risefall=l-h),v}}function Cm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPriceLine",this.Font=16*V()+"px 微软雅黑",this.PointCount=1,this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsHScreen=!1,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!0});if(r&&r.length==1){this.IsHScreen=this.Frame.IsHScreen;var n=r[0],e=this.Frame.ChartBorder;if(this.IsHScreen){var t=e.GetLeftEx(),a=e.GetRightEx();if(n.X<t||n.X>a)return;var s=e.GetBottom(),o={X:n.X,Y:s},h=this.Frame.GetYData(n.X,!1)}else{var s=e.GetBottomEx(),l=e.GetTopEx();if(n.Y<l||n.Y>s)return;var a=e.GetRight(),o={X:a,Y:n.Y},h=this.Frame.GetYData(n.Y,!1)}this.ClipFrame(),this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(n.X,n.Y),this.Canvas.lineTo(o.X,o.Y),this.Canvas.stroke(),this.RestoreLineWidth();var u={Start:n,End:o};this.LinePoint.push(u),this.DrawPoint(r),this.Canvas.textBaseline="bottom",this.Canvas.textAlign="left",this.Canvas.fillStyle=this.LineColor,this.Canvas.font=this.Font;var f=2*V(),C=n.X,D=n.Y;this.IsHScreen?(this.Canvas.translate(C+f,D+f),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(h.toFixed(2),0,0)):this.Canvas.fillText(h.toFixed(2),C+f,D-f),this.Canvas.restore()}}}}function Dm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPriceLineV2",this.Font=12*V()+"px 微软雅黑",this.PointCount=1,this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsHScreen=!1,this.LineWidth=1,this.IsDrawFirst=!0,this.TextColor="rgb(255,255,255)",this.Title,this.Super_SetOption=this.SetOption,this.SetOption=function(r){this.Super_SetOption&&this.Super_SetOption(r),r&&(r.TextColor&&(this.TextColor=r.TextColor),r.Title&&(this.Title=r.Title))},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!0});if(r&&r.length==1&&this.IsYValueInFrame(this.Value[0].YValue)){this.IsHScreen=this.Frame.IsHScreen;var n=this.Frame.ChartBorder,e=this.Frame.GetBorder();if(this.IsHScreen){var t=e.LeftEx,a=e.RightEx,s=e.Bottom,o=e.Top,h={X:r[0].X,Y:o};if(h.X<t||h.X>a)return;var l={X:r[0].X,Y:s},u=this.Frame.GetYData(h.X,!1)}else{var s=e.BottomEx,o=e.TopTitle,t=e.Left,a=e.Right,h={X:t,Y:r[0].Y};if(h.Y<o||h.Y>s)return;var l={X:a,Y:r[0].Y},u=this.Frame.GetYData(h.Y,!1)}this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(L(h.X),L(h.Y)),this.Canvas.lineTo(L(l.X),L(l.Y)),this.Canvas.stroke(),this.RestoreLineWidth();var f={Start:h,End:l};this.LinePoint.push(f);var C=V();this.Canvas.font=this.Font;var D=2*C,v=l.X,S=l.Y;this.Canvas.textBaseline="middle",this.Canvas.textAlign="left";var T=this.GetFontHeight(),I=u.toFixed(2),F=this.Canvas.measureText(I).width+2*D;if(this.IsHScreen){if(n.Bottom>10)var E={Left:v-T/2,Top:S,Width:T,Height:F};else{S=S-F;var E={Left:v-T/2,Top:S,Width:T,Height:F}}if(this.Canvas.fillStyle=this.LineColor,this.Canvas.fillRect(E.Left,E.Top,E.Width,E.Height),this.Canvas.save(),this.Canvas.translate(v,S+1*C),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(I,0,0),this.Canvas.restore(),this.Title){var F=this.Canvas.measureText(this.Title).width+2*C;if(n.Bottom>10)var M={Left:E.Left,Top:s-F-1*C,Width:T,Height:F};else var M={Left:E.Left,Top:E.Top-F-1*C,Width:T,Height:F};this.Canvas.fillStyle=this.LineColor,this.Canvas.fillRect(M.Left,M.Top,M.Width,M.Height),this.Canvas.save(),this.Canvas.translate(v,M.Top+1*C),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(this.Title,0,0),this.Canvas.restore()}}else{if(n.Right>10){var E={Left:v,Top:S-T/2-1*C,Width:F,Height:T};E.Left+E.Width>e.ChartWidth&&(E.Left=e.ChartWidth-E.Width-2*C)}else var E={Left:v-F,Top:S-T/2-1*C,Width:F,Height:T};if(this.Canvas.fillStyle=this.LineColor,this.Canvas.fillRect(E.Left,E.Top,E.Width,E.Height),this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(I,E.Left+D,S),this.Title){var F=this.Canvas.measureText(this.Title).width+2*C;if(n.Right>10){var M={Left:a-F-1*C,Top:E.Top,Width:F,Height:T};E.Left!=a&&(M.Left=E.Left-F-1*C)}else var M={Left:E.Left-F,Top:E.Top,Width:F,Height:T};this.Canvas.fillStyle=this.LineColor,this.Canvas.fillRect(M.Left,M.Top,M.Width,M.Height),this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(this.Title,M.Left+1*C,S)}}}}},this.DrawPrice=function(){}}function vm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawVerticalLine",this.PointCount=1,this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsHScreen=!1,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()&&!(!this.Frame||!this.Frame.Data)){var r=this.Frame.Data,n=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(n&&n.length==1){this.IsHScreen=this.Frame.IsHScreen;var e=n[0],t=this.Frame.ChartBorder;if(this.IsHScreen){var a=Math.round(this.Frame.GetXData(e.Y,!1))+r.DataOffset;a<0?a=0:a>=r.Data.length&&(a=r.Data.length-1);var s=this.Frame.GetXFromIndex(a-r.DataOffset,!1);s=he(this.LineWidth,s);var o=t.GetLeftEx(),h=t.GetRightEx(),l={X:o,Y:s},u={X:h,Y:s}}else{var a=Math.round(this.Frame.GetXData(e.X,!1))+r.DataOffset;a<0?a=0:a>=r.Data.length&&(a=r.Data.length-1);var f=this.Frame.GetXFromIndex(a-r.DataOffset,!1);f=he(this.LineWidth,f);var C=t.GetTopEx(),D=t.GetBottomEx(),l={X:f,Y:C},u={X:f,Y:D}}this.ClipFrame(),this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(l.X,l.Y),this.Canvas.lineTo(u.X,u.Y),this.Canvas.stroke(),this.RestoreLineWidth();var v={Start:l,End:u};this.LinePoint.push(v),this.Status==10&&this.DrawPoint(n),this.Canvas.restore()}}}}function cm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawWaveRuler",this.PointCount=3,this.Font=16*V()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.LastPoint,this.LinePoint,this.ScaleRuler=m.ChartDrawWaveRuler.ScaleRuler,this.RulerWidth=m.ChartDrawWaveRuler.RulerWidth,this.RulerLineWidth=m.ChartDrawWaveRuler.RulerLineWidth,this.MaxScaleRuler=m.ChartDrawWaveRuler.MaxScaleRuler,this.Font=m.ChartDrawWaveRuler.MaxScaleRuler,this.IsHScreen=!1,this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r){this.IsHScreen=this.Frame.IsHScreen,this.CalculateLines(r),this.ClipFrame(),this.SetLineWidth();for(var n in this.LinePoint){var e=this.LinePoint[n];this.DrawLine(e.Start,e.End)}r.length==3&&this.DrawWaveRuler(r),this.RestoreLineWidth(),this.DrawPoint(r),this.Canvas.restore()}}},this.SetLastPoint=function(r){this.LastPoint={X:r.X,Y:r.Y}},this.CalculateLines=function(r){if(this.PointStatus==2&&this.LastPoint){var n=new ot;n.X=this.LastPoint.X,n.Y=this.LastPoint.Y,r[2]=n}if(r.length==2){var e={Start:{X:r[0].X,Y:r[0].Y},End:{X:r[1].X,Y:r[1].Y}};this.LinePoint.push(e)}else if(r.length==3){var e={Start:{X:r[0].X,Y:r[0].Y},End:{X:r[1].X,Y:r[1].Y}};this.LinePoint.push(e),e={Start:{X:r[1].X,Y:r[1].Y},End:{X:r[2].X,Y:r[2].Y}},this.LinePoint.push(e)}},this.DrawWaveRuler=function(r){var n=r[1],e=r[0],t=r[2],a=this.RulerLineWidth*V();this.Canvas.lineWidth=a,this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.fillStyle=this.LineColor,this.Canvas.font=this.Font;var s=this.RulerWidth*V();if(this.IsHScreen){var o=e.X-n.X,h={X:t.X-this.MaxScaleRuler*o,Y:t.Y};this.DrawLine(t,h),this.LinePoint.push({Start:t,End:h});var l=t.Y-s/2,u=t.Y+s/2}else{var o=e.Y-n.Y,h={X:he(a,t.X),Y:t.Y-this.MaxScaleRuler*o};this.DrawLine({X:he(a,t.X),Y:t.Y},h),this.LinePoint.push({Start:t,End:h});var f=t.X-s/2,C=t.X+s/2}var D=4*V();for(var v in this.ScaleRuler){var S=this.ScaleRuler[v];if(this.IsHScreen){var f=t.X-S.Value*o,T=this.Frame.GetYData(f,!1);this.DrawLine({X:f,Y:l},{X:f,Y:u});var I=T.toFixed(2)+"  "+(S.Text?S.Text:S.Value.toFixed(3));this.Canvas.save(),this.Canvas.translate(f,t.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(I,D,0),this.Canvas.restore()}else{var l=t.Y-S.Value*o,T=this.Frame.GetYData(l,!1);this.DrawLine({X:f,Y:he(a,l)},{X:C,Y:he(a,l)});var I=T.toFixed(2)+"  "+(S.Text?S.Text:S.Value.toFixed(3));this.Canvas.fillText(I,C+D,l)}}}}function Sm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawWaveRuler2Point",this.PointCount=2,this.Font=14*V()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.PointRate=[510,517,511.4],this.LinePoint,this.CPoint,this.ScaleRuler=m.ChartDrawWaveRuler2Point.ScaleRuler,this.RulerWidth=m.ChartDrawWaveRuler2Point.RulerWidth,this.RulerLineWidth=m.ChartDrawWaveRuler2Point.RulerLineWidth,this.MaxScaleRuler=m.ChartDrawWaveRuler2Point.MaxScaleRuler,this.Font=m.ChartDrawWaveRuler2Point.MaxScaleRuler,this.IsHScreen=!1,this.Super_SetOption=this.SetOption,this.SetOption=function(r){this.Super_SetOption&&this.Super_SetOption(r),r&&r.PointRate&&(this.PointRate=r.PointRate)},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r){this.IsHScreen=this.Frame.IsHScreen,this.CalculateLines(r),this.ClipFrame(),this.SetLineWidth();for(var n in this.LinePoint){var e=this.LinePoint[n];this.DrawLine(e.Start,e.End)}var t=[r[0],r[1],this.CPoint];this.DrawWaveRuler(t),this.RestoreLineWidth(),this.DrawPoint(r),this.Canvas.restore()}}},this.CalculateLines=function(r){var n={Start:{X:r[0].X,Y:r[0].Y},End:{X:r[1].X,Y:r[1].Y}};this.LinePoint.push(n);var e=r[0].Y,t=r[1].Y,a=this.PointRate[1]-this.PointRate[0],s=this.PointRate[2]-this.PointRate[0],o=e-(e-t)*s/a;this.CPoint={X:r[1].X,Y:o}},this.DrawWaveRuler=function(r){var n=r[1],e=r[0],t=r[2],a=this.RulerLineWidth*V();this.Canvas.lineWidth=a,this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.fillStyle=this.LineColor,this.Canvas.font=this.Font;var s=this.RulerWidth*V();if(this.IsHScreen){var o=e.X-n.X,h={X:t.X-this.MaxScaleRuler*o,Y:t.Y};this.DrawLine(t,h),this.LinePoint.push({Start:t,End:h});var l=t.Y-s/2,u=t.Y+s/2}else{var o=e.Y-n.Y,h={X:he(a,t.X),Y:t.Y-this.MaxScaleRuler*o};this.DrawLine({X:he(a,t.X),Y:t.Y},h),this.LinePoint.push({Start:t,End:h});var f=t.X,C=t.X+s}var D=4*V();for(var v in this.ScaleRuler){var S=this.ScaleRuler[v];if(this.IsHScreen){var f=t.X-S.Value*o,T=this.Frame.GetYData(f,!1);this.DrawLine({X:f,Y:l},{X:f,Y:u});var I=T.toFixed(2)+"  "+(S.Text?S.Text:S.Value.toFixed(3));this.Canvas.save(),this.Canvas.translate(f,t.Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(I,D,0),this.Canvas.restore()}else{var l=t.Y-S.Value*o,T=this.Frame.GetYData(l,!1);this.DrawLine({X:f,Y:he(a,l)},{X:C,Y:he(a,l)});var I=T.toFixed(2)+"  "+(S.Text?S.Text:S.Value.toFixed(3));this.Canvas.fillText(I,C+D,l)}}}}function Tm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawBox",this.PointCount=2,this.Font=16*V()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsHScreen=!1,this.AvPriceLineDash=[5*V(),5*V()],this.KLineBorder,this.PointToValue_Backup=this.PointToValue,this.PointToValue=function(){this.Point[0]={X:this.KLineBorder.Left,Y:this.KLineBorder.Top},this.Point[1]={X:this.KLineBorder.Right,Y:this.KLineBorder.Bottom},this.PointToValue_Backup()},this.Draw=function(){if(this.LinePoint=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r&&r.length==2){this.IsHScreen=this.Frame.IsHScreen,this.ClipFrame();var n=r[0],e=r[1],t=this.PointToKLine([n,e]);X.Chart.Log("[ChartDrawBox::Draw] kPoint",t);var a=this.Calculate(t);X.Chart.Log("[ChartDrawBox::Draw] kDataInfo",a);var s=this.GetKLineBorder(r,a);this.KLineBorder=s,this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.strokeRect(B(s.Left),B(s.Top),B(s.Right-s.Left),B(s.Bottom-s.Top));var o;if(a.Amount>0&&a.Vol>0){var h=a.Amount/a.Vol;if(o="均价"+h.toFixed(2),this.Canvas.beginPath(),this.IsHScreen){var l=this.Frame.GetYFromData(h,!1);this.Canvas.moveTo(he(this.Canvas.lineWidth,l),s.Top),this.Canvas.lineTo(he(this.Canvas.lineWidth,l),s.Bottom)}else{var u=this.Frame.GetYFromData(h,!1);this.Canvas.moveTo(s.Left,he(this.Canvas.lineWidth,u)),this.Canvas.lineTo(s.Right,he(this.Canvas.lineWidth,u))}this.Canvas.setLineDash(this.AvPriceLineDash),this.Canvas.stroke(),this.Canvas.setLineDash([])}this.RestoreLineWidth(),this.DrawPoint(r),this.Canvas.textBaseline="top",this.Canvas.textAlign="left",this.Canvas.font=this.Font,this.Canvas.fillStyle=this.LineColor;var f=2*V(),C="K线数"+a.Count;this.IsHScreen?this.DrawText(C,s.Right,s.Top,f,f):this.DrawText(C,s.Left,s.Top,f,f),o&&(this.IsHScreen?this.DrawText(o,l,s.Top,f,f):this.DrawText(o,s.Left,u,f,f));var D=c.IsNumber(a.YClose)?a.YClose:a.Open,v=(a.Close-D)/D*100;C=v.toFixed(2)+"%",this.IsHScreen?this.DrawText(C,s.Right,s.Bottom,f,f):this.DrawText(C,s.Right,s.Top,f,f),v=a.Close-D,C=""+v.toFixed(2),this.Canvas.textBaseline="bottom",this.IsHScreen?this.DrawText(C,s.Left,s.Bottom,f,0):this.DrawText(C,s.Right,s.Bottom,f,0),this.Canvas.restore()}}},this.Calculate=function(r){var n=r[0],e=r[1];n.XValue>e.XValue&&(n=r[1],e=r[0]);for(var t=this.Frame.Data.Data,a,s,o,h,l,u=0,f=0,C=0,D=n.XValue;D<=e.XValue;++D,++C){var v=t[D];C==0?(h=v.YClose,a=v.Open,l=v.Close,o=v.Low,s=v.High):(l=v.Close,o>v.Low&&(o=v.Low),s<v.High&&(s=v.High)),u+=v.Vol,f+=v.Amount}var S={YClose:h,Open:a,High:s,Low:o,Close:l,Count:C,Vol:u,Amount:f};return S},this.GetKLineBorder=function(r,n){var e=r[0],t=r[1],a=this.Frame.Data;if(this.IsHScreen){var s=Math.round(this.Frame.GetXData(e.Y,!1))+a.DataOffset;s<0?s=0:s>=a.Data.length&&(s=a.Data.length-1);var o=this.Frame.GetXFromIndex(s-a.DataOffset,!1);s=Math.round(this.Frame.GetXData(t.Y,!1))+a.DataOffset,s<0?s=0:s>=a.Data.length&&(s=a.Data.length-1);var h=this.Frame.GetXFromIndex(s-a.DataOffset,!1),l=this.Frame.GetYFromData(n.High,!1),u=this.Frame.GetYFromData(n.Low,!1),f={Left:u,Top:o,Right:l,Bottom:h};return this.LinePoint.push({Start:{X:u,Y:o},End:{X:h,Y:o}}),this.LinePoint.push({Start:{X:u,Y:h},End:{X:h,Y:h}}),this.LinePoint.push({Start:{X:u,Y:o},End:{X:u,Y:h}}),this.LinePoint.push({Start:{X:l,Y:o},End:{X:l,Y:h}}),f}else{var s=Math.round(this.Frame.GetXData(e.X,!1))+a.DataOffset;s<0?s=0:s>=a.Data.length&&(s=a.Data.length-1);var C=this.Frame.GetXFromIndex(s-a.DataOffset,!1);s=Math.round(this.Frame.GetXData(t.X,!1))+a.DataOffset,s<0?s=0:s>=a.Data.length&&(s=a.Data.length-1);var D=this.Frame.GetXFromIndex(s-a.DataOffset,!1),v=this.Frame.GetYFromData(n.High,!1),S=this.Frame.GetYFromData(n.Low,!1),f={Left:C,Top:v,Right:D,Bottom:S};return this.LinePoint.push({Start:{X:C,Y:v},End:{X:D,Y:v}}),this.LinePoint.push({Start:{X:C,Y:S},End:{X:D,Y:S}}),this.LinePoint.push({Start:{X:C,Y:v},End:{X:C,Y:S}}),this.LinePoint.push({Start:{X:D,Y:v},End:{X:D,Y:S}}),f}},this.DrawText=function(r,n,e,t,a){this.IsHScreen?(this.Canvas.save(),this.Canvas.translate(n,e),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(r,t,a),this.Canvas.restore()):this.Canvas.fillText(r,n+t,e+a)}}function Uh(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawTwoPointDemo",this.PointCount=2,this.Font=16*V()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.IsHScreen=!1,this.PointInfo=[],this.PointToValue_Backup=this.PointToValue,this.PointToValue=function(){this.OnFinish(),this.PointToValue_Backup()},this.OnFinish=function(){for(var r in this.PointInfo){var n=this.PointInfo[r];!n||!n.Point||!c.IsNumber(n.Point.Y2)||(this.Point[r].Y=this.PointInfo[r].Point.Y2)}},this.Draw=function(){if(this.LinePoint=[],this.PointInfo=[],!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r){if(this.IsHScreen=this.Frame.IsHScreen,this.ClipFrame(),this.SetLineWidth(),r[0],r[1],this.CalculatePointInfo(r),this.Status==10)this.DrawEx();else for(var n=1;n<r.length;++n)this.DrawLine(r[n-1],r[n]);this.RestoreLineWidth(),this.DrawPoint(r),this.Canvas.restore()}}},this.CalculatePointInfo=function(r){if(!(!this.Frame||!this.Frame.Data)){var n=this.PointToKLine(r);if(this.PointCount==3&&this.PointStatus==2&&this.LastPoint){var e=new ot;e.X=this.LastPoint.X,e.Y=this.LastPoint.Y,r[2]=e}var t=this.Frame.Data;for(var a in n){var s=n[a],e=r[a],o=t.Data[s.XValue],h={KItem:o,Data:s,Point:{X:e.X,Y:e.Y}};this.PointInfo.push(h)}this.CalculateYPoint(),X.Chart.Log("[ChartDrawTwoPointDemo::CalculateLines] kPoint",this.PointInfo)}},this.CalculateYPoint=function(){var r=this.PointInfo[0],n=this.Frame.GetYFromData(r.KItem.Low,!1);r.Point.Y2=n;var e=this.PointInfo[1],t=this.Frame.GetYFromData(e.KItem.High,!1);e.Point.Y2=t},this.DrawEx=function(){var r=this.PointInfo[0],n=this.PointInfo[1],e=this.Frame.ChartBorder;e.GetRight();var t={X:r.Point.X,Y:r.Point.Y2},a={X:n.Point.X,Y:n.Point.Y2};this.DrawLine(t,a),this.LinePoint.push({Start:t,End:a}),this.Canvas.setLineDash([5,5]);var s=n.KItem.YClose*.09+n.KItem.High,o=this.Frame.GetYFromData(s,!1);this.DrawLine({X:this.ToFixedPoint(a.X),Y:a.Y},{X:this.ToFixedPoint(a.X),Y:o}),this.Canvas.textAlign="right",this.Canvas.textBaseline="center",this.Canvas.fillStyle="rgb(33,45,100)";for(var h=3;h>0;--h){var l=n.KItem.YClose*(.03*h)+n.KItem.High,o=this.Frame.GetYFromData(l,!1);o=this.ToFixedPoint(o),this.DrawLine({X:a.X,Y:o},{X:a.X+100,Y:o}),this.Canvas.fillText(l.toFixed(2),a.X-5,o)}this.Canvas.setLineDash([])},this.ToFixedPoint=function(r,n){return c.IsNumber(n)||(n=this.LineWidth),he(n,r)}}function JC(){this.newMethod=Uh,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawThreePointDemo",this.PointCount=3,this.SetLastPoint=function(r){this.LastPoint={X:r.X,Y:r.Y}},this.CalculateYPoint=function(){var r;for(var n in this.PointInfo){var e=this.PointInfo[n];n==0||n==2?r=this.Frame.GetYFromData(e.KItem.Low,!1):r=this.Frame.GetYFromData(e.KItem.High,!1),e.Point.Y2=r}},this.DrawEx=function(){var r=this.PointInfo[0],n=this.PointInfo[1],e=this.PointInfo[2],t=this.Frame.ChartBorder;t.GetRight(),t.GetLeft();var a={X:r.Point.X,Y:r.Point.Y2},s={X:n.Point.X,Y:n.Point.Y2},o={X:e.Point.X,Y:e.Point.Y2};this.DrawLine(a,s),this.DrawLine(s,o),this.LinePoint.push({Start:a,End:s}),this.LinePoint.push({Start:s,End:o}),this.Canvas.setLineDash([5,5]);var h=e.KItem.YClose*.09+e.KItem.High,l=this.Frame.GetYFromData(h,!1);this.DrawLine({X:this.ToFixedPoint(o.X),Y:o.Y},{X:this.ToFixedPoint(o.X),Y:l}),this.Canvas.textAlign="right",this.Canvas.textBaseline="center",this.Canvas.fillStyle="rgb(33,45,100)";for(var u=3;u>0;--u){var f=e.KItem.YClose*(.03*u)+e.KItem.High,l=this.Frame.GetYFromData(f,!1);l=this.ToFixedPoint(l),this.DrawLine({X:o.X,Y:l},{X:o.X+100,Y:l}),this.Canvas.fillText(f.toFixed(2),o.X-5,l)}this.Canvas.setLineDash([])}}function dm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawHLineSegment",this.PointCount=2,this.IsPointIn=this.IsPointIn_XYValue_Line,this.ChartBorder,this.PointToValue_Backup=this.PointToValue,this.PointToValue=function(){this.Frame.IsHScreen?this.Point[1].X=this.Point[0].X:this.Point[1].Y=this.Point[0].Y,this.PointToValue_Backup()},this.GetXYCoordinate=function(){if(this.IsFrameMinSize())return null;var r=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!0});return this.PointRange(r)},this.Draw=function(){if(this.Frame&&(this.IsHScreen=this.Frame.IsHScreen,this.LinePoint=[],!this.IsFrameMinSize())){var r=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!0});if(!(!r||r.length!=2)){this.ClipFrame(),this.ChartBorder=this.Frame.ChartBorder,this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor;var n=r[0],e=r[1];this.Status==10?this.DrawLine(n,e,!1):this.DrawVerticalLine(n,e),this.RestoreLineWidth();var t={Start:n,End:e};this.LinePoint.push(t),this.DrawPoint(r),this.Canvas.restore()}}},this.DrawVerticalLine=function(r,n){var e=this.Frame.Data;if(this.IsHScreen){var t=this.ChartBorder.GetLeft(),a=this.ChartBorder.GetRight(),s=Math.round(this.Frame.GetXData(r.Y,!1))+e.DataOffset;s<0?s=0:s>=e.Data.length&&(s=e.Data.length-1);var o=this.Frame.GetXFromIndex(s-e.DataOffset,!1);s=Math.round(this.Frame.GetXData(n.Y,!1))+e.DataOffset,s<0?s=0:s>=e.Data.length&&(s=e.Data.length-1);var h=this.Frame.GetXFromIndex(s-e.DataOffset,!1);this.Canvas.beginPath(),this.Canvas.moveTo(t,o),this.Canvas.lineTo(a,o),this.Canvas.moveTo(t,h),this.Canvas.lineTo(a,h),this.Canvas.stroke(),this.Canvas.beginPath(),this.Canvas.moveTo(r.X,o),this.Canvas.lineTo(r.X,h),this.Canvas.stroke()}else{var l=this.ChartBorder.GetTopEx(),u=this.ChartBorder.GetBottomEx(),s=Math.round(this.Frame.GetXData(r.X,!1))+e.DataOffset;s<0?s=0:s>=e.Data.length&&(s=e.Data.length-1);var f=this.Frame.GetXFromIndex(s-e.DataOffset,!1);s=Math.round(this.Frame.GetXData(n.X,!1))+e.DataOffset,s<0?s=0:s>=e.Data.length&&(s=e.Data.length-1);var C=this.Frame.GetXFromIndex(s-e.DataOffset,!1);this.Canvas.beginPath(),this.Canvas.moveTo(f,l),this.Canvas.lineTo(f,u),this.Canvas.moveTo(C,l),this.Canvas.lineTo(C,u),this.Canvas.stroke(),this.Canvas.beginPath(),this.Canvas.moveTo(f,r.Y),this.Canvas.lineTo(C,r.Y),this.Canvas.stroke()}}}function mm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawVolProfile",this.PointCount=2,this.IsPointIn=this.IsPointIn_XYValue_Line,this.ChartBorder,this.GetXYCoordinate=this.GetXYCoordinate_default,this.IsShowText=!0,this.VolType=0,this.BarPosition=0,this.VolFont,this.VAVol=60,this.BarWidthRate=.3,this.Data,this.MaxVol,this.MaxVolPrice,this.DataStatus=0,this.BGColor=m.ChartDrawVolProfile.BGColor,this.BorderColor=m.ChartDrawVolProfile.BorderColor,this.VolLineColor=m.ChartDrawVolProfile.VolLineColor,this.TextConfig=(0,Se.default)({Color:m.ChartDrawVolProfile.Text.Color,Family:m.ChartDrawVolProfile.Text.Family,FontMaxSize:m.ChartDrawVolProfile.Text.FontMaxSize,FontMinSize:m.ChartDrawVolProfile.Text.FontMinSize},"Color",m.ChartDrawVolProfile.Text.Color),this.BarColor=[m.ChartDrawVolProfile.UpVolColor,m.ChartDrawVolProfile.DownVolColor,m.ChartDrawVolProfile.AreaUpColor,m.ChartDrawVolProfile.AreaDonwColor],this.Super_SetOption=this.SetOption,this.SetOption=function(r){this.Super_SetOption&&this.Super_SetOption(r),r&&(r.BGColor&&(this.BGColor=r.BGColor),r.BorderColor&&(this.BGColor=r.BorderColor),r.VolLineColor&&(this.BGColor=r.VolLineColor),r.UpVolColor&&(this.BarColor[0]=r.UpVolColor),r.DownVolColor&&(this.BarColor[1]=r.DownVolColor),r.AreaUpColor&&(this.BarColor[2]=r.AreaUpColor),r.AreaDonwColor&&(this.BarColor[3]=r.AreaDonwColor),c.IsNumber(r.BarWidthRate)&&(this.BarWidthRate=r.BarWidthRate),c.IsBool(r.IsShowText)&&(this.IsShowText=r.IsShowText),c.IsNumber(r.VolType)&&(this.VolType=r.VolType),c.IsNumber(r.BarPosition)&&(this.BarPosition=r.BarPosition),c.IsNumber(r.VAVol)&&(this.VAVol=r.VAVol))},this.OnFinish=function(){this.RequestVolumeProfileData()},this.OnMoveFinish=function(){this.RequestVolumeProfileData()},this.IsDrawMain=function(){if(!this.GetActiveDrawPicture)return!0;var r=this.GetActiveDrawPicture();return r.Select.Guid!=this.Guid},this.RequestVolumeProfileData=function(){var r=this.Value[0],n=this.Value[1];r.XValue>n.XValue&&(r=this.Value[1],n=this.Value[0]);var e={Start:{Date:r.DateTime.Date,DataIndex:r.XValue},End:{Date:n.DateTime.Date,DataIndex:n.XValue},Chart:this};c.IsNumber(r.DateTime.Time)&&(e.Start.Time=r.DateTime.Time),c.IsNumber(n.DateTime.Time)&&(e.End.Time=n.DateTime.Time),e.ValueAreaVol=this.VAVol,this.DataStatus=0,this.HQChart&&this.HQChart.RequestVolumeProfileData&&this.HQChart.RequestVolumeProfileData(e)},this.OnRecvVolumeProfileData=function(r){if(!(!r||!c.IsNonEmptyArray(r.Data))){for(var n=0,e=0,t=null,a=0,s=0;a<r.Data.length;++a){var o=r.Data[a];for(e=0,s=0;s<o.Vol.length;++s){var h=o.Vol[s];c.IsNumber(h.Value)&&(e+=h.Value)}n<e&&(n=e,t=o.Price)}if(this.MaxVolPrice=t,this.MaxVol=n,!(this.MaxVolPrice<=0||this.MaxVol<=0)&&!(!c.IsNumber(r.MaxPrice)||!c.IsNumber(r.MinPrice))){var l=this.Frame.GetYFromData(r.MaxPrice,!1),u=this.Frame.GetYFromData(r.MinPrice,!1);this.Point[0].Y=l,this.Point[1].Y=u,this.PointToValue(),this.Data=r,this.DataStatus=1}}},this.Draw=function(){if(this.VolFont=null,this.IsDrawMain()||this.MainDraw(),!this.IsFrameMinSize()){this.Frame&&(this.ChartBorder=this.Frame.ChartBorder);var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!(!r||r.length!=2)){this.ClipFrame(),this.SetLineWidth();var n=r[0],e=r[1];this.Status==10?this.DataStatus==0&&this.DrawLineBorder(n,e):this.DrawLineBorder(n,e),this.RestoreLineWidth(),this.DrawPoint(r),this.Canvas.restore()}}},this.MainDraw=function(){this.LinePoint=[],!this.IsFrameMinSize()&&this.DataStatus==1&&this.Status==10&&(this.ClipFrame(),this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0}),this.DrawVolBar(),this.Canvas.restore())},this.DrawLineBorder=function(r,n){this.Canvas.strokeStyle=this.LineColor;var e=this.ChartBorder.GetTopEx(),t=this.ChartBorder.GetBottomEx();this.Canvas.beginPath(),this.Canvas.moveTo(r.X,r.Y),this.Canvas.lineTo(n.X,n.Y),this.Canvas.moveTo(r.X,e),this.Canvas.lineTo(r.X,t),this.Canvas.moveTo(n.X,e),this.Canvas.lineTo(n.X,t),this.Canvas.stroke()},this.DrawVolBar=function(){var r=this.Value[0],n=this.Value[1];r.XValue>n.XValue&&(r=this.Value[1],n=this.Value[0]);var e=this.GetKDataOffset(),t=this.GetPriceYOffset(this.Data.PriceOffset),a=this.Frame.GetXFromIndex(r.XValue-e,!1),s=this.Frame.GetXFromIndex(n.XValue-e,!1),o=this.Frame.GetYFromData(this.Data.MaxPrice)-t/2,h=this.Frame.GetYFromData(this.Data.MinPrice)+t/2,l=s-a,u=h-o,f=l*this.BarWidthRate;if(this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(a,o,l,u),this.MaxVolPrice>=this.Frame.HorizontalMin&&this.MaxVolPrice<=this.Frame.HorizontalMax){var C=2,D=he(C,this.Frame.GetYFromData(this.MaxVolPrice,!1));this.Canvas.lineWidth=C,this.Canvas.strokeStyle=this.VolLineColor,this.Canvas.beginPath(),this.Canvas.moveTo(a,D),this.Canvas.lineTo(s,D),this.Canvas.stroke();var v={Start:{X:a,Y:D},End:{X:s,Y:D}};this.LinePoint.push(v)}this.IsShowText&&(this.VolFont=this.GetDynamicVolTextFont(t,f),this.VolFont&&(this.Canvas.font=this.VolFont));for(var S=0;S<this.Data.Data.length;++S){var T=this.Data.Data[S];T.Price<this.Frame.HorizontalMin||T.Price>this.Frame.HorizontalMax||this.DrawVolBarItem(T,a,s,f,t)}},this.DrawVolBarItem=function(r,n,e,t,a){var s=n,o=e,h=this.Frame.GetYFromData(r.Price)-a/2,l=a-1;if(l<1&&(l=1),this.VolType==1){if(!r.TotalVol||!c.IsNumber(r.TotalVol.Value))return;var u=r.TotalVol.Value*t/this.MaxVol,f;if(c.IsNumber(r.TotalVol.ColorID)?f=this.BarColor[r.TotalVol.ColorID]:r.TotalVol.Color&&(f=r.TotalVol.Color),this.Canvas.fillStyle=f,this.BarPosition==1?this.Canvas.fillRect(o,B(h),-u,B(l)):this.Canvas.fillRect(s,B(h),u,B(l)),this.IsShowText&&this.VolFont){var C=c.FormatVolString(r.TotalVol.Value,this.HQChart.LanguageID);this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextConfig.Color,this.BarPosition==1?(this.Canvas.textAlign="right",this.Canvas.fillText(C,e-5,h+a/2)):(this.Canvas.textAlign="left",this.Canvas.fillText(C,n+5,h+a/2))}}else{for(var C="",D=0;D<r.Vol.length;++D){var v=r.Vol[D];if(c.IsNumber(v.Value)){var f;if(c.IsNumber(v.ColorID)?f=this.BarColor[v.ColorID]:v.Color&&(f=v.Color),!!f){var u=v.Value*t/this.MaxVol;this.Canvas.fillStyle=f,this.BarPosition==1?(this.Canvas.fillRect(o,B(h),-u,B(l)),o-=u):(this.Canvas.fillRect(s,B(h),u,B(l)),s+=u);var S=c.FormatVolString(v.Value,this.HQChart.LanguageID);C.length>0&&(C+="x"),C+=S}}}this.IsShowText&&this.VolFont&&(this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextConfig.Color,this.BarPosition==1?(this.Canvas.textAlign="right",this.Canvas.fillText(C,e-5,h+a/2)):(this.Canvas.textAlign="left",this.Canvas.fillText(C,n+5,h+a/2)))}},this.GetKDataOffset=function(){var r=this.HQChart.ChartPaint[0].Data;return r.DataOffset},this.GetPriceYOffset=function(r){var n=this.Frame,e=n.ChartBorder.GetHeightEx()*r/(n.HorizontalMax-n.HorizontalMin);return e},this.GetDynamicVolTextFont=function(r,n,e){var t=parseInt(r)-2;if(r<5&&(t=parseInt(r)),t>this.TextConfig.FontMaxSize?t=this.TextConfig.FontMaxSize:t<=0&&(t=1),t<this.TextConfig.FontMinSize)return null;var a=this.FormatFontString(t,this.TextConfig.Family,e);return a},this.FormatFontString=function(r,n,e){var t;return e?e.Weight&&(t=e.Weight+" "+r+"px "+n):t=r+"px "+n,t}}function Im(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawNote",this.PointCount=1,this.Text=m.ChartDrawNote.Text,this.FontOption={Family:m.ChartDrawNote.FontOption.Family,Size:m.ChartDrawNote.FontOption.Size},this.AryNoteText=[{Text:"输入内容 ......"}],this.NoteFontOption={Family:m.ChartDrawNote.NoteFontOption.Family,Size:m.ChartDrawNote.NoteFontOption.Size,Weight:m.ChartDrawNote.NoteFontOption.Weight,Style:m.ChartDrawNote.NoteFontOption.Style},this.NoteWidth=m.ChartDrawNote.NoteWidth,this.NoteMargin={Left:m.ChartDrawNote.NoteMargin.Left,Top:m.ChartDrawNote.NoteMargin.Top,Bottom:m.ChartDrawNote.NoteMargin.Bottom,Right:m.ChartDrawNote.NoteMargin.Right},this.NoteBGColor=m.ChartDrawNote.NoteBGColor,this.NoteTextColor=m.ChartDrawNote.NoteTextColor,this.NoteBorderColor=m.ChartDrawNote.NoteBorderColor,this.LineSpace=m.ChartDrawNote.LineSpace,this.ArrowSize=m.ChartDrawNote.ArrowSize,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!1,this.PtButtom,this.PtTop,this.TextRect=null,this.PtCenter,this.SetOption_Backup=this.SetOption,this.SetOption=function(r){if(this.SetOption_Backup(r),!!r){if(r.Text&&(this.Text=r.Text),r.FontOption&&this.SetFont(this.FontOption,r.FontOption),r.NoteFontOption&&this.SetFont(this.NoteFontOption,r.NoteFontOption),c.IsNumber(r.NoteWidth)&&(this.NoteWidth=r.NoteWidth),r.NoteMargin){var n=r.NoteMargin;c.IsNumber(n.Left)&&(this.NoteMargin.Left=n.Left),c.IsNumber(n.Top)&&(this.NoteMargin.Top=n.Top),c.IsNumber(n.Bottom)&&(this.NoteMargin.Bottom=n.Bottom),c.IsNumber(n.Right)&&(this.NoteMargin.Right=n.Right)}r.NoteBGColor&&(this.NoteBGColor=r.NoteBGColor),r.NoteTextColor&&(this.NoteTextColor=r.NoteTextColor),r.NoteBorderColor&&(this.NoteBorderColor=r.NoteBorderColor),c.IsNumber(r.LineSpace)&&(this.LineSpace=r.LineSpace),c.IsNumber(r.ArrowSize)&&(this.ArrowSize=r.ArrowSize),c.IsNonEmptyArray(r.AryNoteText)&&(this.AryNoteText=this.CloneArrayText(r.AryNoteText))}},this.ExportStorageData=function(){var r=this.ExportBaseData();if(r.Value=[],this.Value&&this.Value[0]){var n=this.Value[0];r.Value.push({XValue:n.XValue,YValue:n.YValue,DateTime:n.DateTime})}return r.NoteFont=this.NoteFont,r.NoteWidth=this.NoteWidth,r.NoteBGColor=this.NoteBGColor,r.NoteTextColor=this.NoteTextColor,r.NoteBorderColor=this.NoteBorderColor,r.LineSpace=this.LineSpace,r.ArrowSize=this.ArrowSize,r.NoteMargin={Left:this.NoteMargin.Left,Top:this.NoteMargin.Right,Bottom:this.NoteMargin.Bottom,Right:this.NoteMargin.Right},r.AryNoteText=this.CloneArrayText(this.AryNoteText),r},this.ImportStorageData=function(r){if(r.NoteFont&&(this.NoteFont=r.NoteFont),c.IsNumber(r.NoteWidth)&&(this.NoteWidth=r.NoteWidth),r.NoteMargin){var n=r.NoteMargin;c.IsNumber(n.Left)&&(this.NoteMargin.Left=n.Left),c.IsNumber(n.Top)&&(this.NoteMargin.Top=n.Top),c.IsNumber(n.Bottom)&&(this.NoteMargin.Bottom=n.Bottom),c.IsNumber(n.Right)&&(this.NoteMargin.Right=n.Right)}r.NoteBGColor&&(this.NoteBGColor=r.NoteBGColor),r.NoteTextColor&&(this.NoteTextColor=r.NoteTextColor),this.NoteBorderColor=r.NoteBorderColor,c.IsNumber(r.LineSpace)&&(this.LineSpace=r.LineSpace),c.IsNumber(r.ArrowSize)&&(this.ArrowSize=r.ArrowSize),this.AryNoteText=this.CloneArrayText(r.AryNoteText)},this.Draw=function(){if(this.PtButtom=null,this.PtTop=null,this.TextRect=null,this.PtCenter=null,!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!(!r||r.length!=1)){var n=this.GetTextFont();if(n){this.ClipFrame();var e=this.Frame.IsHScreen,t=V();if(this.Canvas.fillStyle=this.LineColor,this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.font=n,e){this.Canvas.translate(r[0].X,r[0].Y),this.Canvas.rotate(90*Math.PI/180),this.Canvas.fillText(this.Text,0,0),this.PtButtom={X:r[0].X,Y:r[0].Y+this.FontOption.Size*t/2+2},this.PtTop={X:r[0].X,Y:r[0].Y-this.FontOption.Size*t/2-2},this.PtCenter=r[0];var a={X:r[0].X-this.FontOption.Size*t/2-2,Y:r[0].Y}}else{this.Canvas.fillText(this.Text,r[0].X,r[0].Y),this.PtButtom={X:r[0].X,Y:r[0].Y+this.FontOption.Size*t/2+2},this.PtTop={X:r[0].X,Y:r[0].Y-this.FontOption.Size*t/2-2};var a={X:this.PtButtom.X,Y:this.PtButtom.Y}}var s=this.Canvas.measureText(this.Text).width;this.TextRect={},this.TextRect.Left=r[0].X-s/2,this.TextRect.Top=r[0].Y-this.FontOption.Size*t/2,this.TextRect.Width=s,this.TextRect.Height=this.FontOption.Size*t,this.IsShowNoteText()&&this.DrawText(),this.Canvas.restore(),this.DrawPoint([a])}}}},this.DrawText=function(){this.Canvas.font=this.GetFontString(this.NoteFontOption);var r=0,n=this.Canvas.measureText("擎").width,e=this.Frame.GetBorder(),t=V(),a=this.Frame.IsHScreen,s=this.NoteWidth,o=[];if(c.IsNonEmptyArray(this.AryNoteText))for(var h=0;h<this.AryNoteText.length;++h){var l=this.AryNoteText[h];if(l)if(r>0&&(r+=this.LineSpace),l.Text){var u=this.GetMultiLineText(l.Text,s);if(u&&c.IsNonEmptyArray(u.AryText))for(var f=0;f<u.AryText.length;++f){f>0&&(r+=this.LineSpace);var C=u.AryText[f];o.push(C),r+=n}}else o.push({Text:""}),r+=n}else r=n;var D={Width:s+this.NoteMargin.Left+this.NoteMargin.Right,Height:r+this.NoteMargin.Top+this.NoteMargin.Bottom,ArrowType:0};a?(D.Left=this.PtTop.X-D.Width/2-this.PtCenter.X,D.Top=this.PtTop.Y-D.Height-this.ArrowSize-this.PtCenter.Y,D.Right=D.Left+D.Width,D.Bottom=D.Top+D.Height,D.Arrow={X:this.PtTop.X-this.PtCenter.X,Y:this.PtTop.Y-this.PtCenter.Y},this.PtCenter.X+r+this.FontOption.Size*t/2+2+this.ArrowSize>e.RightEx&&(D.Top=this.PtButtom.Y+this.ArrowSize+this.PointRadius*t-this.PtCenter.Y,D.Bottom=D.Top+D.Height,D.Arrow.X=this.PtButtom.X-this.PtCenter.X,D.Arrow.Y=this.PtButtom.Y-this.PtCenter.Y,D.ArrowType=1)):(D.Left=this.PtTop.X-D.Width/2,D.Top=this.PtTop.Y-D.Height-this.ArrowSize,D.Right=D.Left+D.Width,D.Bottom=D.Top+D.Height,D.Arrow={X:this.PtTop.X,Y:this.PtTop.Y},D.Left<e.Left?(D.Left=e.Left,D.Right=D.Left+D.Width):D.Right>e.Right&&(D.Right=e.Right,D.Left=D.Right-D.Width),D.Top<e.TopEx&&(D.Top=this.PtButtom.Y+this.ArrowSize+this.PointRadius*t,D.Bottom=D.Top+D.Height,D.Arrow.X=this.PtButtom.X,D.Arrow.Y=this.PtButtom.Y,D.ArrowType=1)),this.DrawNoteBG(D),this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.fillStyle=this.NoteTextColor;for(var v=D.Left+this.NoteMargin.Left,S=D.Top+this.NoteMargin.Top,h=0;h<o.length;++h){var l=o[h];l&&(l.Text&&this.Canvas.fillText(l.Text,v,S),S+=n,S+=this.LineSpace)}},this.DrawNoteBG=function(r){if(this.Canvas.fillStyle=this.NoteBGColor,r.ArrowType==0||r.ArrowType==1){var n=new Path2D;if(r.ArrowType==0){n.moveTo(r.Left,r.Bottom),n.lineTo(r.Left,r.Top),n.lineTo(r.Right,r.Top),n.lineTo(r.Right,r.Bottom);var e=r.Arrow.X+this.ArrowSize*.6;n.lineTo(e,r.Bottom),n.lineTo(r.Arrow.X,r.Arrow.Y);var e=r.Arrow.X-this.ArrowSize*.6;n.lineTo(e,r.Bottom)}else{n.moveTo(r.Left,r.Top),n.lineTo(r.Left,r.Bottom),n.lineTo(r.Right,r.Bottom),n.lineTo(r.Right,r.Top);var e=r.Arrow.X+this.ArrowSize*.6;n.lineTo(e,r.Top),n.lineTo(r.Arrow.X,r.Arrow.Y);var e=r.Arrow.X-this.ArrowSize*.6;n.lineTo(e,r.Top)}n.closePath(),this.Canvas.fill(n),this.NoteBorderColor&&(this.Canvas.strokeStyle=this.NoteBorderColor,this.Canvas.stroke(n))}else this.Canvas.fillRect(r.Left,r.Top,r.Width,r.Height)},this.IsShowNoteText=function(){if(this.GetActiveDrawPicture){var r=this.GetActiveDrawPicture();return!(r.Move.Guid!=this.Guid&&r.Select.Guid!=this.Guid&&r.MoveOn.Guid!=this.Guid)}return!1},this.GetTextFont=function(){if(!this.FontOption||!this.FontOption.Family||this.FontOption.Size<=0)return null;var r="";return this.FontOption.Size>=0&&(r+=this.FontOption.Size*V()+"px "),r+=this.FontOption.Family,r},this.IsPointIn=function(r,n){if(!this.Frame||this.Status!=10)return-1;var e=this.Frame.Data;if(!e||!this.TextRect)return-1;var t=0;this.Option&&this.Option.Zoom>=1&&(t=this.Option.Zoom*V());var a={Left:this.TextRect.Left-t,Top:this.TextRect.Top-t,Width:this.TextRect.Width+t*2,Height:this.TextRect.Height+t*2};return a.Right=a.Left+a.Width,a.Bottom=a.Top+a.Height,r>a.Left&&r<a.Right&&n>a.Top&&n<a.Bottom?100:-1},this.GetCursorType=function(r){return r==100?"pointer":null}}function gm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawAnchoredText",this.PointCount=1,this.AryText=[{Text:"输入内容"}],this.TextColor=m.ChartDrawAnchoredText.TextColor,this.FontOption={Family:m.ChartDrawAnchoredText.FontOption.Family,Size:m.ChartDrawAnchoredText.FontOption.Size,Weight:m.ChartDrawAnchoredText.FontOption.Weight,Style:m.ChartDrawAnchoredText.FontOption.Style},this.TextMaxWidth=m.ChartDrawAnchoredText.TextMaxWidth,this.LineSpace=m.ChartDrawAnchoredText.LineSpace,this.BGColor=m.ChartDrawAnchoredText.BGColor,this.BorderColor=m.ChartDrawAnchoredText.BorderColor,this.TextMargin={Left:m.ChartDrawAnchoredText.TextMargin.Left,Top:m.ChartDrawAnchoredText.TextMargin.Top,Bottom:m.ChartDrawAnchoredText.TextMargin.Bottom,Right:m.ChartDrawAnchoredText.TextMargin.Right},this.TextRect,this.SetOption=function(r){r&&(r.TextColor&&(this.TextColor=r.TextColor),r.Text&&(this.Text=r.Text),r.FontOption&&this.SetFont(this.FontOption,r.FontOption),c.IsNumber(r.TextMaxWidth)&&(this.TextMaxWidth=r.TextMaxWidth),c.IsNonEmptyArray(r.AryText)&&(this.AryText=this.CloneArrayText(r.AryText)))},this.ExportStorageData=function(){var r=this.ExportBaseData(),n=this.Value[0];return r.Value=[{XValue:n.XValue,YValue:n.YValue}],r.FontOption={},this.SetFont(r.FontOption,this.FontOption),r.BGColor=this.BGColor,r.TextColor=this.TextColor,r.BorderColor=this.BorderColor,r.LineSpace=this.LineSpace,r.TextMaxWidth=this.TextMaxWidth,r.TextMargin={Left:this.TextMargin.Left,Top:this.TextMargin.Right,Bottom:this.TextMargin.Bottom,Right:this.TextMargin.Right},r.AryText=this.CloneArrayText(this.AryText),r},this.ImportStorageData=function(r){if(r.TextMargin){var n=r.TextMargin;c.IsNumber(n.Left)&&(this.TextMargin.Left=n.Left),c.IsNumber(n.Top)&&(this.TextMargin.Top=n.Top),c.IsNumber(n.Bottom)&&(this.TextMargin.Bottom=n.Bottom),c.IsNumber(n.Right)&&(this.TextMargin.Right=n.Right)}r.TextColor&&(this.TextColor=r.TextColor),this.BGColor=r.BGColor,this.BorderColor=r.BorderColor,this.TextMaxWidth=r.TextMaxWidth,c.IsNumber(r.LineSpace)&&(this.LineSpace=r.LineSpace),this.AryText=this.CloneArrayText(r.AryText)},this.Draw=function(){if(this.TextRect=null,!(this.Status<2)&&!(this.Point.length!=1||!this.Frame)&&!this.IsFrameMinSize()){var r=this.CalculateDrawPoint();!r||r.length!=1||(this.ClipFrame(),this.DrawMultiLineText(r[0]),this.Canvas.restore())}},this.ValueToPoint=function(){if(!this.Frame)return!1;var r=this.Value[0],n=this.XYValueToPoint(r.XValue,r.YValue);this.Point=[n]},this.PointToValue=function(){if(!this.Frame)return!1;var r=this.Frame.GetBorder(),n=this.Frame.IsHScreen;if(n){var e=r.LeftEx,t=r.Top,a=r.RightEx-e,s=r.Bottom-t,o=this.Point[0],h=(o.X-e)/a,l=(o.Y-t)/s;this.Value[0]={XValue:l,YValue:h}}else{var e=r.Left,t=r.TopEx,a=r.Right-e,s=r.BottomEx-t,o=this.Point[0],l=(o.X-e)/a,h=(o.Y-t)/s;this.Value[0]={XValue:l,YValue:h}}},this.XYValueToPoint=function(r,n){if(!this.Frame)return null;var e=this.Frame.IsHScreen,t=this.Frame.GetBorder();if(e){var a=t.LeftEx,s=t.Top,o=t.RightEx-a,h=t.Bottom-s,l=n*o+a,u=r*h+s;return{X:l,Y:u}}else{var a=t.Left,s=t.TopEx,o=t.Right-a,h=t.BottomEx-s,l=r*o+a,u=n*h+s;return{X:l,Y:u}}},this.CalculateDrawPoint=function(r){if(this.Status<2||this.Point.length!=1||!this.Frame)return null;var n=[];if(this.Status==10){var e=this.Value[0],t=this.XYValueToPoint(e.XValue,e.YValue);n.push(t)}else n=this.Point;return n},this.DrawMultiLineText=function(r){if(c.IsNonEmptyArray(this.AryText)){var n=0;this.Canvas.font=this.GetFontString(this.FontOption);var e=this.Canvas.measureText("擎").width;this.Frame.GetBorder();var t=this.Frame.IsHScreen,a={X:r.X,Y:r.Y};t&&(this.Canvas.translate(a.X,a.Y),this.Canvas.rotate(90*Math.PI/180),a.X=0,a.Y=0);for(var s=[],o=0,h=0;h<this.AryText.length;++h){var l=this.AryText[h];if(l)if(n>0&&(n+=this.LineSpace),this.TextMaxWidth>50&&l.Text){var u=this.GetMultiLineText(l.Text,this.TextMaxWidth);if(u&&c.IsNonEmptyArray(u.AryText))for(var f=0;f<u.AryText.length;++f){f>0&&(n+=this.LineSpace);var C=u.AryText[f];s.push(C),n+=e}}else{if(l.Text){var D=this.Canvas.measureText(l.Text).width+2;o<D&&(o=D)}s.push({Text:l.Text}),n+=e}}this.TextMaxWidth>50&&(o=this.TextMaxWidth);var v={Left:a.X,Bottom:a.Y,Height:n+this.TextMargin.Top+this.TextMargin.Bottom,Width:o+this.TextMargin.Left+this.TextMargin.Right};v.Top=v.Bottom-v.Height,v.Right=v.Left+v.Width,this.DrawBG(v),this.Canvas.fillStyle=this.TextColor,this.Canvas.textAlign="left",this.Canvas.textBaseline="top";for(var S=v.Left+this.TextMargin.Left,T=v.Top+this.TextMargin.Top,h=0;h<s.length;++h){var l=s[h];l&&(l.Text&&this.Canvas.fillText(l.Text,S,T),T+=e,T+=this.LineSpace)}t&&(v.Left=r.X,v.Top=r.Y,v.Width=n+this.TextMargin.Top+this.TextMargin.Bottom,v.Height=o+this.TextMargin.Left+this.TextMargin.Right,v.Right=v.Left+v.Width,v.Bottom=v.Top+v.Height),this.TextRect=v;var I={X:v.Left+v.Width/2,Y:v.Bottom};this.DrawPoint([I])}},this.DrawBG=function(r){if(!(!this.BGColor&&!this.BorderColor)){var n=new Path2D;n.rect(r.Left,r.Top,r.Width,r.Height),this.BGColor&&(this.Canvas.fillStyle=this.BGColor,this.Canvas.fill(n)),this.BorderColor&&(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.stroke(n))}},this.IsPointIn=function(r,n){if(!this.Frame||this.Status!=10||!this.TextRect)return-1;var e=this.TextRect;return r>e.Left&&r<e.Right&&n>e.Top&&n<e.Bottom?100:-1},this.GetCursorType=function(r){return r==100?"pointer":null}}function pm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPriceLabel",this.PointCount=1,this.OnlyMoveXIndex=!0,this.TextColor=m.ChartDrawPriceLabel.TextColor,this.FontOption={Family:m.ChartDrawPriceLabel.FontOption.Family,Size:m.ChartDrawPriceLabel.FontOption.Size,Weight:m.ChartDrawPriceLabel.FontOption.Weight,Style:m.ChartDrawPriceLabel.FontOption.Style},this.BGColor=m.ChartDrawPriceLabel.BGColor,this.BorderColor=m.ChartDrawPriceLabel.BorderColor,this.LabelOffset={X:10,Y:20},this.TextMargin={Left:m.ChartDrawPriceLabel.TextMargin.Left,Top:m.ChartDrawPriceLabel.TextMargin.Top,Bottom:m.ChartDrawPriceLabel.TextMargin.Bottom,Right:m.ChartDrawPriceLabel.TextMargin.Right},this.TextRect,this.SetOption=function(r){if(r&&(r.TextColor&&(this.TextColor=r.TextColor),r.BGColor&&(this.BGColor=r.BGColor),r.BorderColor&&(this.BorderColor=r.BorderColor),r.FontOption&&this.SetFont(this.FontOption,r.FontOption),r.LabelOffset)){var n=r.LabelOffset;c.IsNumber(n.X)&&(this.LabelOffset.X=n.X),c.IsNumber(n.Y)&&(this.LabelOffset.Y=n.Y)}},this.ExportStorageData=function(){var r=this.ExportBaseData(),n=this.Value[0];return r.Value=[{XValue:n.XValue,YValue:n.YValue}],r.BGColor=this.BGColor,r.TextColor=this.TextColor,r.BorderColor=this.BorderColor,r.TextMargin={Left:this.TextMargin.Left,Top:this.TextMargin.Right,Bottom:this.TextMargin.Bottom,Right:this.TextMargin.Right},r},this.ImportStorageData=function(r){if(r.TextMargin){var n=r.TextMargin;c.IsNumber(n.Left)&&(this.TextMargin.Left=n.Left),c.IsNumber(n.Top)&&(this.TextMargin.Top=n.Top),c.IsNumber(n.Bottom)&&(this.TextMargin.Bottom=n.Bottom),c.IsNumber(n.Right)&&(this.TextMargin.Right=n.Right)}r.TextColor&&(this.TextColor=r.TextColor),this.BGColor=r.BGColor,this.BorderColor=r.BorderColor},this.Draw=function(){if(this.TextRect=null,!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(!(!r||r.length!=1)){var n=r[0];this.ClipFrame(),this.DrawPriceLabel(n),this.Canvas.restore(),this.DrawPoint([n])}}},this.DrawPriceLabel=function(r){var n=this.GetFontString(this.FontOption);if(n){var e=this.Frame.IsHScreen,t,a,s=0;e?(this.Canvas.translate(r.X,r.Y),this.Canvas.rotate(90*Math.PI/180),t={X:0,Y:0},a=this.Frame.GetYData(r.X,!1),s=1):(t={X:r.X,Y:r.Y},a=this.Frame.GetYData(r.Y,!1));var o=2;this.Symbol&&this.Frame.Identify==0&&(o=fe(this.Symbol));var h=a.toFixed(o);this.Canvas.font=n;var l=t.X+this.LabelOffset.X,u=t.Y-this.LabelOffset.Y,f=this.Canvas.measureText("擎").width,C=this.Canvas.measureText(h).width,D={Left:l,Bottom:u,Width:C+this.TextMargin.Left+this.TextMargin.Right,Height:f+this.TextMargin.Top+this.TextMargin.Bottom};D.Top=D.Bottom-D.Height,D.Right=D.Left+D.Width,this.DrawBG(D,t);var v=D.Left+D.Width/2,S=D.Top+D.Height/2;this.Canvas.textAlign="center",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(h,v,S+s),e?(this.TextRect={Left:r.X+this.LabelOffset.Y,Top:r.Y+this.LabelOffset.X,Width:f+this.TextMargin.Top+this.TextMargin.Bottom,Height:C+this.TextMargin.Left+this.TextMargin.Right},this.TextRect.Right=this.TextRect.Left+this.TextRect.Width,this.TextRect.Bottom=this.TextRect.Top+this.TextRect.Height):this.TextRect=D}},this.DrawBG=function(r,n){var e=V(),t=new Path2D;t.moveTo(r.Left,r.Bottom),t.lineTo(r.Left,r.Top),t.lineTo(r.Right,r.Top),t.lineTo(r.Right,r.Bottom);var a=r.Left+15*e;t.lineTo(a,r.Bottom),t.lineTo(n.X,n.Y),a=r.Left+5*e,t.lineTo(a,r.Bottom),t.closePath(),this.BGColor&&(this.Canvas.fillStyle=this.BGColor,this.Canvas.fill(t)),this.BorderColor&&(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.stroke(t)),this.BGColor&&(this.Canvas.beginPath(),this.Canvas.arc(n.X,n.Y,2*e,0,360,!1),this.Canvas.fillStyle=this.BGColor,this.Canvas.fill())},this.IsPointIn=function(r,n){if(!this.Frame||this.Status!=10||!this.TextRect)return-1;var e=this.TextRect;return r>e.Left&&r<e.Right&&n>e.Top&&n<e.Bottom?100:-1},this.GetCursorType=function(r){return r==100?"pointer":null}}function Fm(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawPriceNote",this.PointCount=2,this.GetXYCoordinate=this.GetXYCoordinate_default,this.IsPointIn=this.IsPointIn_XYValue_Line,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.FontOption={Family:m.ChartDrawPriceNote.FontOption.Family,Size:m.ChartDrawPriceNote.FontOption.Size,Weight:m.ChartDrawPriceNote.FontOption.Weight,Style:m.ChartDrawPriceNote.FontOption.Style},this.TextMargin={Left:m.ChartDrawPriceNote.TextMargin.Left,Top:m.ChartDrawPriceNote.TextMargin.Top,Bottom:m.ChartDrawPriceNote.TextMargin.Bottom,Right:m.ChartDrawPriceNote.TextMargin.Right},this.BGColor=m.ChartDrawPriceNote.BGColor,this.BorderColor=m.ChartDrawPriceNote.BorderColor,this.TextColor=m.ChartDrawPriceNote.TextColor,this.BorderRoundRadius=3,this.TextRect,this.SetOption=function(r){r&&(r.TextColor&&(this.TextColor=r.TextColor),r.BGColor&&(this.BGColor=r.BGColor),r.BorderColor&&(this.BorderColor=r.BorderColor),r.FontOption&&this.SetFont(this.FontOption,r.FontOption))},this.ExportStorageData=function(){var r=this.ExportBaseData();r.Value=[];for(var n=0;n<this.Value.length;++n){var e=this.Value[n];r.Value.push({XValue:e.XValue,YValue:e.YValue})}return r.BGColor=this.BGColor,r.TextColor=this.TextColor,r.BorderColor=this.BorderColor,r.TextMargin={Left:this.TextMargin.Left,Top:this.TextMargin.Right,Bottom:this.TextMargin.Bottom,Right:this.TextMargin.Right},r},this.ImportStorageData=function(r){if(r.TextMargin){var n=r.TextMargin;c.IsNumber(n.Left)&&(this.TextMargin.Left=n.Left),c.IsNumber(n.Top)&&(this.TextMargin.Top=n.Top),c.IsNumber(n.Bottom)&&(this.TextMargin.Bottom=n.Bottom),c.IsNumber(n.Right)&&(this.TextMargin.Right=n.Right)}r.TextColor&&(this.TextColor=r.TextColor),this.BGColor=r.BGColor,this.BorderColor=r.BorderColor},this.Draw=function(){if(this.LinePoint=[],this.TextRect=null,!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!0,IsCheckY:!0});if(r&&r.length==2){this.ClipFrame();var n=r[0],e=r[1];this.LineWidth=1,this.SetLineWidth(),this.Canvas.strokeStyle=this.LineColor,this.Canvas.beginPath(),this.Canvas.moveTo(n.X,n.Y),this.Canvas.lineTo(e.X,e.Y),this.Canvas.stroke(),this.RestoreLineWidth(),this.DrawPriceLabel(n,e);var t={Start:n,End:e};this.LinePoint.push(t),this.DrawPoint(r),this.Canvas.restore()}}},this.DrawPriceLabel=function(r,n){var e=this.GetFontString(this.FontOption);if(e){var t=2;this.Symbol&&this.Frame.Identify==0&&(t=fe(this.Symbol));var a=V(),s={X:n.X,Y:n.Y},o=this.Frame.GetYData(r.Y,!1),h=o.toFixed(t),l=this.Canvas.measureText("擎").width,u=this.Canvas.measureText(h).width,f=this.CalculateAngle(r.X,r.Y,n.X,n.Y);if(f>=0&&f<=45||f>=315&&f<=360){var C=s.X,D=s.Y,v={Left:C,Bottom:D,Width:u+this.TextMargin.Left+this.TextMargin.Right,Height:l+this.TextMargin.Top+this.TextMargin.Bottom};v.Bottom=D+v.Height/2,v.Top=v.Bottom-v.Height,v.Right=v.Left+v.Width}else if(f>45&&f<=135){var C=s.X,D=s.Y,v={Left:C,Bottom:D,Width:u+this.TextMargin.Left+this.TextMargin.Right,Height:l+this.TextMargin.Top+this.TextMargin.Bottom};v.Left=C-v.Width/2,v.Top=v.Bottom-v.Height,v.Right=v.Left+v.Width}else if(f>=135&&f<=225){var C=s.X,D=s.Y,v={Width:u+this.TextMargin.Left+this.TextMargin.Right,Height:l+this.TextMargin.Top+this.TextMargin.Bottom};v.Bottom=D+v.Height/2,v.Top=v.Bottom-v.Height,v.Right=C,v.Left=v.Right-v.Width}else if(f>=225&&f<=315){var C=s.X,S=s.Y,v={Width:u+this.TextMargin.Left+this.TextMargin.Right,Height:l+this.TextMargin.Top+this.TextMargin.Bottom};v.Top=S,v.Bottom=v.Top+v.Height,v.Left=C-v.Width/2,v.Right=v.Left-v.Width}else return;this.DrawBG(v),this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.TextColor;var T=v.Left+this.TextMargin.Left,I=v.Top+v.Height/2,F=0;this.Canvas.fillText(h,T,I+F),this.BGColor&&(this.Canvas.beginPath(),this.Canvas.arc(r.X,r.Y,2*a,0,360,!1),this.Canvas.fillStyle=this.BGColor,this.Canvas.fill()),this.TextRect=v}},this.DrawBG=function(r){if(r){var n=V(),e=this.BorderRoundRadius*n,t=new Path2D;t.roundRect(L(r.Left),L(r.Top),B(r.Width),B(r.Height),[e]),this.BGColor&&(this.Canvas.fillStyle=this.BGColor,this.Canvas.fill(t)),this.BorderColor&&(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.stroke(t))}},this.IsPointIn=function(r,n){if(!this.Frame||this.Status!=10||!this.TextRect)return-1;var e=this.TextRect;return r>e.Left&&r<e.Right&&n>e.Top&&n<e.Bottom?1:this.IsPointIn_XYValue_Line(r,n)}}function Em(){this.newMethod=It,this.newMethod(),delete this.newMethod,this.ClassName="ChartDrawFibWedge",this.PointCount=3,this.Font=12*V()+"px 微软雅黑",this.IsPointIn=this.IsPointIn_XYValue_Line,this.GetXYCoordinate=this.GetXYCoordinate_default,this.PointToValue_Default=this.PointToValue,this.OnlyMoveXIndex=!0,this.IsSupportMagnet=!0,this.LastPoint,this.AreaConfig={AryData:[{Value:.236,Color:"rgb(242,52,69)",Enable:!0},{Value:.382,Color:"rgb(255,152,0)",Enable:!0},{Value:.5,Color:"rgb(76,175,80)",Enable:!0},{Value:.618,Color:"rgb(8,153,129)",Enable:!0},{Value:.786,Color:"rgb(0,188,212)",Enable:!0},{Value:1,Color:"rgb(120,123,134)",Enable:!0},{Value:1.618,Color:"rgb(41,98,255)",Enable:!1},{Value:2.618,Color:"rgb(242,54,69)",Enable:!1}],Opacity:.3},this.TextAngle,this.Radius,this.CalculateHypotenuse=function(r,n){var e=r.X-n.X,t=r.Y-n.Y,a=Math.sqrt(e*e+t*t);return a},this.MagnetXY=function(r){var n={IsFixedX:this.OnlyMoveXIndex};if(this.Option&&this.Option.Magnet&&this.Option.Magnet.Enable&&this.IsSupportMagnet&&this.Frame.Identify==0){var e=-1;this.Status==2&&(e=1),c.IsNumber(this.MovePointIndex)&&(e=this.MovePointIndex),e>=0&&(n.Magnet={Enable:!0,PointIndex:e,Distance:this.Option.Magnet.Distance,Type:this.Option.Magnet.Type})}this.AdjustPoint(r,n)},this.CalculateAllPoint=function(r,n,e){var t=[];t.push({X:r.X,Y:r.Y}),t.push({X:n.X,Y:n.Y}),this.MagnetXY(t),t.push({X:e.X,Y:e.Y});var a=this.CalculateHypotenuse(t[0],t[1]),s=t[0].X-t[2].X,o=t[0].Y-t[2].Y,h=Math.sqrt(s*s+o*o),l=s*a/h,u=o*a/h;return t[2].X=t[0].X-l,t[2].Y=t[0].Y-u,t},this.ValueToPoint_V2=function(r){if(!c.IsNonEmptyArray(r)||!this.Frame)return null;var n=this.Frame.Data;if(!n)return null;for(var e=this.Frame.IsHScreen,t=[],a=0;a<r.length;++a){var s=r[a],o=new ot;e?(o.Y=this.Frame.GetXFromIndex(s.XValue-n.DataOffset,!1),o.X=this.Frame.GetYFromData(s.YValue,!1)):(o.X=this.Frame.GetXFromIndex(s.XValue-n.DataOffset,!1),o.Y=this.Frame.GetYFromData(s.YValue,!1)),t[a]=o}return t},this.CalculateDrawPoint=function(r){if(this.Status<2||!this.Point.length||!this.Frame)return null;var n=[];if(this.Status==2)if(this.PointStatus==2&&this.LastPoint)n=this.CalculateAllPoint(this.Point[0],this.Point[1],this.LastPoint);else{for(var e=0;e<this.Point.length&&e<2;++e){var t=this.Point[e];n.push({X:t.X,Y:t.Y})}this.MagnetXY(n)}else if(this.Status==10){var a=this.Frame.Data;if(!a)return null;this.Frame.XPointCount;for(var s=this.Frame.IsHScreen,e=0;e<this.Value.length;++e){var t=this.Value[e];t.XValue-a.DataOffset;var o=new ot;s?(o.Y=this.Frame.GetXFromIndex(t.XValue-a.DataOffset,!1),o.X=this.Frame.GetYFromData(t.YValue,!1)):(o.X=this.Frame.GetXFromIndex(t.XValue-a.DataOffset,!1),o.Y=this.Frame.GetYFromData(t.YValue,!1)),n.push(o)}}else this.Status==20&&(n=this.CalculateAllPoint(this.Point[0],this.Point[1],this.Point[2]));return n},this.Draw=function(){if(this.LinePoint=[],this.TextAngle=null,this.Radius=null,!this.IsFrameMinSize()){var r=this.CalculateDrawPoint({IsCheckX:!1,IsCheckY:!1});if(c.IsNonEmptyArray(r)){var n=r.slice(0);this.CalculateLines(n),this.ClipFrame(),this.DrawArea(n),this.DrawLines(this.LinePoint),this.DrawPoint(n),this.DrawTitle(n),this.Canvas.restore()}}},this.DrawArea=function(r){if(r.length==3&&!(!this.AreaConfig||!c.IsNonEmptyArray(this.AreaConfig.AryData))){var n=r[0],e=this.CalculateHypotenuse(n,r[1]),t=this.CalculateAngle(n.X,n.Y,r[1].X,r[1].Y),a=this.CalculateAngle(n.X,n.Y,r[2].X,r[2].Y),s=t-a;if(s<0&&(s+=360),s>180){var o=t;t=a,a=o}var h=t-(t-a)/2;t-a<0&&(h-=180);for(var l=null,u=0;u<this.AreaConfig.AryData.length;++u){var f=this.AreaConfig.AryData[u];if(f.Enable){var C=e*f.Value,D=f.Color,v=It.ColorToRGBA(D,this.AreaConfig.Opacity),S=new Path2D;c.IsNumber(l)?(S.arc(n.X,n.Y,l,Math.PI/180*(360-t),Math.PI/180*(360-a)),S.arc(n.X,n.Y,C,Math.PI/180*(360-a),Math.PI/180*(360-t),!0)):(S.moveTo(n.X,n.Y),S.arc(n.X,n.Y,C,Math.PI/180*(360-t),Math.PI/180*(360-a))),this.Canvas.fillStyle=v,this.Canvas.fill(S),l=C}}for(var u=0;u<this.AreaConfig.AryData.length;++u){var f=this.AreaConfig.AryData[u];if(f.Enable){var C=e*f.Value,D=f.Color,S=new Path2D;S.arc(n.X,n.Y,C,Math.PI/180*(360-t),Math.PI/180*(360-a)),this.Canvas.strokeStyle=D,this.Canvas.stroke(S)}}this.Radius=e,this.TextAngle=h}},this.DrawTitle=function(r){if(r.length==3&&!(!this.AreaConfig||!c.IsNonEmptyArray(this.AreaConfig.AryData))){var n=r[0],e=Math.PI/180*(360-this.TextAngle);this.Canvas.font=this.Font;for(var t=0;t<this.AreaConfig.AryData.length;++t){var a=this.AreaConfig.AryData[t];if(a.Enable){var s=this.Radius*a.Value,o=a.Color,h=""+a.Value,l=Math.sin(e)*s+n.Y,u=Math.cos(e)*s+n.X;this.Canvas.fillStyle=o,this.Canvas.textAlign="left",this.Canvas.textBaseline="top",this.Canvas.fillText(h,u+2,l+2)}}}},this.SetLastPoint=function(r){this.LastPoint={X:r.X,Y:r.Y}},this.DrawLines=function(r){if(c.IsNonEmptyArray(r))for(var n=0;n<r.length;++n){var e=r[n];this.DrawLine(e.Start,e.End)}},this.CalculateLines=function(r){if(r.length===2){var n={Start:new ot,End:new ot};n.Start.Y=r[0].Y,n.Start.X=r[0].X,n.End.Y=r[1].Y,n.End.X=r[1].X,this.LinePoint.push(n)}else if(r.length===3){var n={Start:new ot,End:new ot};n.Start.Y=r[0].Y,n.Start.X=r[0].X,n.End.Y=r[1].Y,n.End.X=r[1].X,this.LinePoint.push(n),n={Start:new ot,End:new ot},n.Start.Y=r[0].Y,n.Start.X=r[0].X,n.End.Y=r[2].Y,n.End.X=r[2].X,this.LinePoint.push(n)}},this.IsPointIn=function(r,n,e){if(this.Status!=10)return-1;var t=this.IsPointInXYValue(r,n,this.AryPoint,e);return t>=0?t:(t=this.IsPointInLine(r,n,e),t>=0?100:-1)},this.IsPointInDots=function(r,n,e,t){if(!c.IsNonEmptyArray(e)||!this.Frame)return-1;var a=this.Frame.Data;if(!a||!this.Value)return-1;var s=5;t&&c.IsNumber(t.Zoom)?s+=t.Zoom:this.Option&&c.IsNumber(this.Option.Zoom)&&(s+=this.Option.Zoom),this.Frame.IsHScreen,s*=V();for(var o=0;o<e.length;++o){var h=e[o],l=new Path2D;if(l.arc(h.X,h.Y,s,0,360),this.Canvas.isPointInPath(l,r,n))return o}return-1},this.GetCursorType=function(r){return r==2?"ns-resize":null},this.PointToValue=function(){if(!this.Frame)return!1;var r=this.Point[2],n={X:r.X,Y:r.Y};if(!this.PointToValue_Default())return!1;var u=[this.Value[0],this.Value[1]],e=this.ValueToPoint_V2(u),t=this.CalculateHypotenuse(e[0],e[1]),a=e[0].X-n.X,s=e[0].Y-n.Y,o=Math.sqrt(a*a+s*s),h=a*t/o,l=s*t/o;this.Point[2].X=e[0].X-h,this.Point[2].Y=e[0].Y-l;var u=this.PointToValue_V2([this.Point[2]],{Type:1});return u?(this.Value[2]=u[0],!0):!1},this.PointToValue_V2=function(r,n){return this.Frame?this.Frame.ClassName=="MinuteFrame"||this.Frame.Class=="MinuteHScreenFrame"?this.PointToValue_Minute_V2(r,n):this.PointToValue_KLine_V2(r,n):null},this.PointToValue_KLine_V2=function(r,n){if(!c.IsNonEmptyArray(r)||!this.Frame)return null;var e=this.Frame.Data;if(!e)return null;var t=[],a=this.Frame.IsHScreen;if(a)for(var s=0;s<r.length;++s){var o=r[s],h=this.Frame.GetXData(o.Y,!1)+e.DataOffset,l=this.Frame.GetYData(o.X,!1),u={XValue:h,YValue:l,Type:1};t[s]=u}else for(var s=0;s<r.length;++s){var o=r[s],h=this.Frame.GetXData(o.X,!1)+e.DataOffset,l=this.Frame.GetYData(o.Y,!1),u={XValue:h,YValue:l,Type:1};t[s]=u}return t}}function zC(){this.DrawData=new Dt.default,this.StorageKey,this.GetEventCallback,this.Load=function(r){if(r){this.StorageKey=r;var n=localStorage[this.StorageKey];if(X.Chart.Log("[ChartDrawStorage::Load] Load to localStorage, key="+this.StorageKey+", cache="+n),!!n&&typeof n=="string"){var e=JSON.parse(n);for(var t in e){var a=e[t],s=new Dt.default;for(var o in a.Value){var h=a.Value[o];s.set(h.Key,h.Value)}this.DrawData.set(a.Key,s)}}}},this.Save=function(){if(this.StorageKey){var r=[],n=!0,e=!1,t=void 0;try{for(var a=(0,we.default)(this.DrawData),s;!(n=(s=a.next()).done);n=!0){var o=s.value,h=o[0],l=o[1],u={Key:h,Value:[]},f=!0,C=!1,D=void 0;try{for(var v=(0,we.default)(l),S;!(f=(S=v.next()).done);f=!0){var T=S.value;T[1]&&T[1].EnableSave===!1||u.Value.push({Key:T[0],Value:T[1]})}}catch(F){C=!0,D=F}finally{try{!f&&v.return&&v.return()}finally{if(C)throw D}}c.IsNonEmptyArray(u.Value)&&r.push(u)}}catch(F){e=!0,t=F}finally{try{!n&&a.return&&a.return()}finally{if(e)throw t}}X.Chart.Log("[ChartDrawStorage::Save] save to localStorage, key="+this.StorageKey);var I=(0,jr.default)(r);localStorage[this.StorageKey]=I}},this.GetItemKey=function(r){var n=r.Symbol+"-"+r.Period;return n},this.SaveDrawData=function(r){var n=this.GetItemKey(r),e=r.ExportStorageData();if(e){if(this.DrawData.has(n))X.Chart.Log("[ChartDrawStorage::SaveDrawData] Upate: key, drawPicture, data",n,r,e),this.DrawData.get(n).set(e.Guid,e);else{X.Chart.Log("[ChartDrawStorage::SaveDrawData] Insert: key, drawPicture, data",n,r,e);var t=new Dt.default;t.set(e.Guid,e),this.DrawData.set(n,t)}X.Chart.Log("[ChartDrawStorage::SaveDrawData] All draw data： ",this.DrawData),this.Save()}},this.DeleteDrawData=function(r){var n=this.GetItemKey(r);if(this.DrawData.has(n)){var e=this.DrawData.get(n);e.has(r.Guid)&&(e.delete(r.Guid),this.Save())}},this.Clear=function(){this.DrawData=new Dt.default,this.Save()},this.GetDrawData=function(r){var n=[],e=this.GetItemKey(r);if(!this.DrawData.has(e))return n;var t=this.DrawData.get(e),a=!0,s=!1,o=void 0;try{for(var h=(0,we.default)(t),l;!(a=(l=h.next()).done);a=!0){var u=l.value;n.push(u[1])}}catch(f){s=!0,o=f}finally{try{!a&&h.return&&h.return()}finally{if(s)throw o}}return n}}function ZC(){this.Data=[[1e-6,2e-6,1e-6,1e-7],[2e-6,4e-6,2e-6,2e-7],[4e-6,5e-6,4e-6,1e-7],[5e-6,1e-5,5e-6,5e-7],[1e-5,2e-5,1e-5,1e-6],[2e-5,4e-5,2e-5,2e-6],[4e-5,5e-5,4e-5,1e-6],[5e-5,1e-4,5e-5,5e-6],[1e-4,2e-4,1e-4,1e-5],[2e-4,4e-4,2e-4,2e-5],[4e-4,5e-4,4e-4,1e-5],[5e-4,.001,5e-4,5e-5],[.001,.002,.001,1e-4],[.002,.004,.002,2e-4],[.004,.005,.004,1e-4],[.005,.01,.005,5e-4],[.01,.02,.01,.001],[.02,.04,.02,.002],[.04,.05,.04,.001],[.05,.1,.05,.005],[.1,.2,.1,.01],[.2,.4,.2,.02],[.4,.5,.4,.01],[.5,1,.5,.05],[1,2,.5,.05],[2,4,.5,.05],[4,5,.5,.05],[5,10,.5,.05],[10,20,10,2],[20,40,20,5],[40,50,40,2],[50,100,50,10],[100,200,100,10],[200,400,200,20],[400,500,400,10],[500,1e3,500,50],[1e3,2e3,1e3,50],[2e3,4e3,2e3,50],[4e3,5e3,4e3,50],[5e3,1e4,5e3,100],[1e4,2e4,1e4,1e3],[2e4,4e4,1e4,1e3],[4e4,5e4,1e4,1e3],[5e4,1e5,1e4,1e3],[1e5,2e5,1e5,1e4],[2e5,4e5,1e5,1e4],[4e5,5e5,1e5,1e4],[5e5,1e6,1e5,1e4],[1e6,2e6,1e6,1e5],[2e6,4e6,1e6,1e5],[4e6,5e6,1e6,1e5],[5e6,1e7,1e6,1e5],[1e7,2e7,1e7,1e6],[2e7,4e7,1e7,1e6],[4e7,5e7,1e7,1e6],[5e7,1e8,1e7,1e6],[1e8,2e8,1e8,1e7],[2e8,4e8,1e8,1e7],[4e8,5e8,1e8,1e7],[5e8,1e9,1e8,1e7],[1e9,2e9,1e9,1e8],[2e9,4e9,1e9,1e8],[4e9,5e9,1e9,1e8],[5e9,1e10,1e9,1e8]],this.Find=function(r){for(var n in this.Data){var e=this.Data[n];if(r>e[0]&&r<=e[1]){var t={};return t.FixInterval=e[2],t.Increase=e[3],t}}return null}}function xm(){this.newMethod=ZC,this.newMethod(),delete this.newMethod,this.Data=[[1e-6,2e-6,1e-6,1e-7],[2e-6,4e-6,2e-6,2e-7],[4e-6,5e-6,4e-6,1e-7],[5e-6,1e-5,5e-6,5e-7],[1e-5,2e-5,1e-5,1e-6],[2e-5,4e-5,2e-5,2e-6],[4e-5,5e-5,4e-5,1e-6],[5e-5,1e-4,5e-5,5e-6],[1e-4,2e-4,1e-4,1e-5],[2e-4,4e-4,2e-4,2e-5],[4e-4,5e-4,4e-4,1e-5],[5e-4,.001,5e-4,5e-5],[.001,.002,.001,1e-4],[.002,.004,.002,1e-4],[.004,.005,.004,1e-4],[.005,.01,.005,5e-4],[.01,.02,.01,.001],[.02,.04,.02,.001],[.04,.05,.04,.001],[.05,.1,.05,.001],[.1,.2,.1,.01],[.2,.4,.2,.01],[.4,.5,.2,.01],[.5,.8,.2,.01],[.8,1,.5,.01],[1,2,.5,.05],[2,4,.5,.05],[4,5,.5,.05],[5,10,.5,.05],[10,12,10,2],[20,40,20,5],[40,50,40,2],[50,100,50,10],[100,200,100,10],[200,400,200,20],[400,500,400,10],[500,1e3,500,50],[1e3,2e3,1e3,50],[2e3,4e3,2e3,50],[4e3,5e3,4e3,50],[5e3,1e4,5e3,100],[1e4,2e4,1e4,1e3],[2e4,4e4,2e4,2e3],[4e4,5e4,4e4,1e3],[5e4,1e5,5e4,5e3],[1e5,2e5,1e5,1e4],[2e5,4e5,2e5,2e4],[4e5,5e5,4e5,1e4],[5e5,1e6,5e5,5e4],[1e6,2e6,1e6,1e5],[2e6,4e6,2e6,2e5],[4e6,5e6,4e6,1e5],[5e6,1e7,5e6,5e5],[1e7,2e7,1e7,1e6],[2e7,4e7,2e7,2e6],[4e7,5e7,4e7,1e6],[5e7,1e8,5e7,5e6],[1e8,2e8,1e8,1e7],[2e8,4e8,2e8,2e7],[4e8,5e8,4e8,1e7],[5e8,1e9,5e8,5e7],[1e9,2e9,1e9,1e8],[2e9,4e9,2e9,2e8],[4e9,5e9,4e9,1e8],[5e9,1e10,5e9,5e8]]}function QC(){this.IsDOMFrameTitle=!1,this.IsDOMFrameToolbar=!1,this.KLineToolbar={ModifyIndex:!0,ChangeIndex:!0,CloseIndex:!0,OverlayIndex:!1,MaxMinWindow:!0,TitleWindow:!0,ExportData:!1,IsShowOverlayToolbar:!0,IsShowOverlayFrame:!0},this.MinuteToolbar={ModifyIndex:!0,ChangeIndex:!0,CloseIndex:!0,OverlayIndex:!0,MaxMinWindow:!0,TitleWindow:!0,ExportData:!1},this.TooltipBGColor="rgb(255, 255, 255)",this.TooltipAlpha=.92,this.SelectRectBGColor="rgba(1,130,212,0.06)",this.UpBarColor="rgb(238,21,21)",this.DownBarColor="rgb(25,158,0)",this.UnchagneBarColor="rgb(0,0,0)",this.EmptyBarBGColor="rgb(255,255,255)",this.HighLowBarColor="rgb(41,98,255)",this.HLCArea={HighLineColor:"rgb(242,54,69)",LowLineColor:"rgb(8,153,129)",CloseLineColor:"rgb(224,227,227)",LineWidth:2*V(),UpAreaColor:"rgba(253,214,218, 0.5)",DownAreaColor:"rgba(205,235,230, 0.5)"},this.Minute={},this.Minute.VolBarColor=null,this.Minute.VolTitleColor="rgb(105,105,105)",this.Minute.PriceColor="rgb(50,171,205)",this.Minute.PriceLineWidth=1*V(),this.Minute.AreaPriceColor="rgba(50,171,205,0.1)",this.Minute.AvPriceColor="rgb(238,127,9)",this.Minute.PositionColor="rgb(218,165,32)",this.Minute.FrameSplitTextColor=null,this.Minute.Before={BGColor:"rgba(240,240,240,0.7)",LineColor:"rgb(50,171,205)",VolColor:["rgb(192,192,0)"],AvPriceColor:"rgb(190,190,190)",Point:{Color:"rgb(65,105,225)",Radius:2*V()},CloseIcon:{Family:"iconfont",Text:"",Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Size:12*V()}},this.Minute.After={BGColor:"rgba(240,240,240,0.7)",LineColor:"rgb(50,171,205)",VolColor:["rgb(192,192,0)"],AvPriceColor:"rgb(190,190,190)",Point:{Color:"rgb(65,105,225)",Radius:2*V()}},this.DefaultTextColor="rgb(43,54,69)",this.DefaultTextFont=14*V()+"px 微软雅黑",this.TitleFont=13*V()+"px 微软雅黑",this.IndexTitleBGColor="rgb(250,250,250)",this.IndexTitleBorderColor="rgb(180,180,180)",this.IndexTitleBorderMoveOnColor="rgb(0,0,0)",this.IndexTitleColor="rgb(43,54,69)",this.IndexTitleSelectedColor="rgb(65,105,225)",this.OverlayIndexTitleBGColor="rgba(255,255,255,0.7)",this.IndexTitleMerginLeft=1,this.Title={TradeIndexColor:"rgb(105,105,105)",ColorIndexColor:"rgb(112,128,144)",VolColor:"rgb(43,54,69)",AmountColor:"rgb(43,54,69)",DateTimeColor:"rgb(43,54,69)",SettingColor:"rgb(43,54,69)",NameColor:"rgb(43,54,69)",TurnoverRateColor:"rgb(43,54,69)",PositionColor:"rgb(43,54,69)"},this.UpTextColor="rgb(238,21,21)",this.DownTextColor="rgb(25,158,0)",this.UnchagneTextColor="rgb(0,0,0)",this.CloseLineColor="rgb(0,191,255)",this.CloseLineAreaColor=["rgba(0,191,255,0.8)","rgba(0,191,255,0.2)"],this.CloseLineWidth=2,this.FrameBorderPen="rgb(225,236,242)",this.MultiDayBorderPen="rgb(225,236,242)",this.FrameSplitPen="rgb(225,236,242)",this.FrameDotSplitPen="rgb(105,105,105)",this.FrameYLineDash=null,this.FrameXLineDash=null,this.FrameSplitTextColor="rgb(117,125,129)",this.FrameSplitTextFont=14*V()+"px 微软雅黑",this.FrameTitleBGColor="rgb(246,251,253)",this.Frame={XBottomOffset:1*V(),YTopOffset:2*V(),YTextPadding:[2,2]},this.ToolbarButtonStyle=0,this.FrameLogo={TextColor:"rgb(178,34,34)",Font:"bold "+16*V()+"px 微软雅黑",Text:""},this.Frame.PercentageText={PriceColor:"rgb(117,125,129)",PercentageColor:"rgb(117,125,129)",SplitColor:"rgb(117,125,129)",Font:14*V()+"px 微软雅黑"},this.FrameLogarithmic={OpenPriceFont:"bold "+14*V()+"px 微软雅黑",MinInterval:45*V()},this.FrameSplitIncrease={Increase:.1},this.FrameSplitAverage={Count:4},this.FrameGoldenSection={Golden:[0,.191,.382,.5,.618,.809,1]},this.FrameLatestPrice={TextColor:"rgb(255,255,255)",UpBarColor:"rgb(238,21,21)",DownBarColor:"rgb(25,158,0)",UnchagneBarColor:"rgb(0,0,0)",BGAlpha:.6,EmptyBGColor:"rgb(255,255,255)",OverlayTextColor:"rgb(255,255,255)"},this.FrameMargin=4,this.FrameLeftMargin=2,this.FrameRightMargin=2,this.DragSubFrameBorder={TopBorderHeight:6*V(),MinFrameHeight:50*V()},this.OverlayFrame={BolderPen:"rgb(190,190,190)",TitleColor:"rgb(105,105,105)",TitleFont:11*V()+"px arial"},this.CorssCursorBGColor="rgb(43,54,69)",this.CorssCursorTextColor="rgb(255,255,255)",this.CorssCursorTextFont=14*V()+"px 微软雅黑",this.CorssCursorHPenColor="rgb(130,130,130)",this.CorssCursorVPenColor="rgb(130,130,130)",this.CorssCursorXRangeBGColor="rgba(100,149,237,0.3)",this.CorssCursor={RightButton:{BGColor:"rgb(43,54,69)",PenColor:"rgb(255,255,255)",Icon:{Text:"",Color:"rgb(255,255,255)",Family:"iconfont",Size:18}}},this.LockBGColor="rgb(220, 220, 220)",this.LockTextColor="rgb(210, 34, 34)",this.Domain="https://opensource.zealink.com",this.CacheDomain="https://opensourcecache.zealink.com",this.PyIndexDomain="https://py.zealink.com",this.KLine={MaxMin:{Font:12*V()+"px 微软雅黑",Color:"rgb(43,54,69)",RightArrow:"→",LeftArrow:"←",HighYOffset:0,LowYOffset:0},Info:{Investor:{ApiUrl:"/API/NewsInteract",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#1c65db"}},Announcement:{ApiUrl:"/API/ReportList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f5a521"},IconFont2:{Family:"iconfont",Text:"",HScreenText:"",Color:"#ed7520"}},Pforecast:{ApiUrl:"/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#986cad"}},Research:{ApiUrl:"/API/InvestorRelationsList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#19b1b7"}},BlockTrading:{ApiUrl:"/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f39f7c"}},TradeDetail:{ApiUrl:"/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#b22626"}},IconLibrary:{Family:"iconfont",Icon:[{Text:"",HScreenText:"",Color:"#f39f7c"},{Text:"",HScreenText:"",Color:"#19b1b7"},{Text:"",HScreenText:"",Color:"#b22626"},{Text:"",HScreenText:"",Color:"#ed7520"}]}},NumIcon:{Color:"rgb(251,80,80)",Family:"iconfont",Text:["","","","","","","","","","","","","","","","","","","","",""]},TradeIcon:{Family:"iconfont",Buy:{Color:"rgb(255,15,4)",Text:"",HScreenText:""},Sell:{Color:"rgb(64,122,22)",Text:"",HScreenText:""}}},this.VirtualKLine={Color:"rgb(100,100,100)",LineDash:[2,2]},this.OrderFlow={UpColor:{BG:"rgb(223,191,180)",Border:"rgb(196,84,86)"},DownColor:{BG:"rgb(176,212,184)",Border:"rgb(66,94,74)"},UnchagneColor:{BG:"rgb(216,221,177)",Border:"rgb(209,172,129)"},Text:{Color:"rgb(92,96,89)",Family:"Arial",FontMaxSize:18,MaxValue:"8888"},Line:{UpDownColor:"rgb(0,0,0)",MiddleColor:"rgb(211,211,211)"},AlwaysShowOrderText:!0,POCGBColor:"rgba(178,34,34,0.8)",AskBarColor:"rgb(14,209,69)",BidBarColor:"rgb(236,28,36)"},this.OrderFlow_Style2={BarWidth:10,UpColor:"rgb(241,55,63)",DownColor:"rgb(75,105,150)",UnchagneColor:"rgb(79,79,79)"},this.OrderFlow_Style3={BarWidth:20,UpColor:"rgb(241,55,63)",DownColor:"rgb(75,105,150)",UnchagneColor:"rgb(79,79,79)"},this.Index={},this.Index.LineColor=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],this.OverlaySymbol={Random:0},this.OverlaySymbol.Color=["rgb(38,198,218)","rgb(103,58,183)","rgb(0,191,165)","rgb(130,177,255)"],this.Index.StockHistoryDayApiUrl="https://opensource.zealink.com/API/StockHistoryDay",this.Index.MarketLongShortApiUrl="https://opensource.zealink.com/API/FactorTiming",this.Index.MarketAttentionApiUrl="https://opensource.zealink.com/API/MarketAttention",this.Index.MarketHeatApiUrl="https://opensource.zealink.com/API/MarketHeat",this.Index.CustomIndexHeatApiUrl="https://opensource.zealink.com/API/QuadrantCalculate",this.Index.NotSupport={Font:14*V()+"px 微软雅黑",TextColor:"rgb(52,52,52)"},this.Buttons={CloseOverlayIndex:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:12*V(),MerginLeft:3},CloseWindow:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*V(),MerginLeft:4},ChangeIndex:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*V(),MerginLeft:4},OverlayIndex:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*V(),MerginLeft:4},ModifyIndexParam:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*V(),MerginLeft:4},MaxMinWindow:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*V(),MerginLeft:4},TitleWindow:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*V(),MerginLeft:4},ExportData:{Color:"rgb(0,0,0)",MoveOnColor:"rgb(30,144,255)",Family:"iconfont",Text:"",Size:13*V(),MerginLeft:4},Tooltip:{Font:14*V()+"px 微软雅黑",Color:"rgb(255,255,255)",ColorBG:"rgb(42,46,57)",ColorBorder:"rgb(0,0,0)"}},this.DrawPicture={LineColor:["rgb(41,98,255)"],PointColor:["rgb(41,98,255)","rgb(89,135,255)","rgb(255,255,255)"],XYCoordinate:{BGColor:"rgba(203,216,255,0.5)",TextBGColor:"rgb(52,101,255)",TextColor:"rgb(255,255,255)",Font:14*V()+"px 微软雅黑"},PointType:2,IsShowPoint:!1},this.ChartOX={Family:"iconfont",Up:{Color:"rgb(178,34,34)",Text:""},Down:{Color:"rgb(0,206,209)",Text:""},SquareLineColor:"rgb(119,136,153)"},this.KLineTrain={Font:"bold 14px arial",LastDataIcon:{Color:"rgb(0,0,205)",Text:"⬇"},BuyIcon:{Color:"rgb(0,205,102 )",Text:"B"},SellIcon:{Color:"rgb(255,127,36 )",Text:"S"},IconFont:{Family:"iconfont",Buy:{Text:"",HScreenText:"",Color:"rgb(255,140,0)"},Sell:{Text:"",HScreenText:"",Color:"rgb(6,79,18)"},Last:{Text:"",HScreenText:"",Color:"rgb(55,0,255)"}}},this.ChartKLineTable={TextFont:{Family:"Arial",FontMaxSize:25},ItemMergin:{Left:5,Right:5,Top:4,Bottom:2}},this.TooltipPaint={BGColor:"rgba(250,250,250,0.8)",BorderColor:"rgb(120,120,120)",TitleColor:"rgb(79, 79, 79)",TitleFont:13*V()+"px 微软雅黑",DateTimeColor:"rgb(105 105 105)",VolColor:"rgb(255, 185, 15)",AmountColor:"rgb(79, 79, 79)"},this.PCTooltipPaint={BGColor:"rgba(250,250,250)",BorderColor:"rgb(120,120,120)",TitleColor:"rgb(60,60,60)",TitleFont:12*V()+"px 微软雅黑",DateTimeColor:"rgb(60,60,60)",VolColor:"rgb(60,60,60)",AmountColor:"rgb(60,60,60)"},this.PCTooltip={LineHeight:25},this.Barrage={Font:16*V()+"px 微软雅黑",Height:20,Color:"RGB(109,109,109)"},this.MinuteInfo={TextColor:"rgb(84,143,255)",Font:14*V()+"px 微软雅黑",PointColor:"rgb(38,113,254)",LineColor:"rgb(120,167,255)",TextBGColor:"rgba(255,255,255,0.8)"},this.ChartDrawRuler={TitleColor:null},this.ChartDrawWaveRuler={RulerWidth:10,RulerLineWidth:1,MaxScaleRuler:2,Font:14*V()+"px 微软雅黑",ScaleRuler:[{Value:0,Text:"0.0%"},{Value:.382,Text:"38.2%"},{Value:.618,Text:"61.8%"},{Value:1,Text:"100%"},{Value:1.618,Text:"161.8%"},{Value:2,Text:"200%"}]},this.ChartDrawWaveRuler2Point={RulerWidth:20,RulerLineWidth:1,MaxScaleRuler:2,Font:14*V()+"px 微软雅黑",ScaleRuler:[{Value:0,Text:"base"},{Value:.618,Text:"61.8%"},{Value:1,Text:"100%"},{Value:1.618,Text:"161.8%"}]},this.ChartDrawVolProfile={BGColor:"rgba(244,250,254,0.8)",BorderColor:"rgba(255,255,255)",VolLineColor:"rgb(232,5,9)",UpVolColor:"rgba(103,179,238, 0.24)",DownVolColor:"rgba(237,208,105,0.24)",AreaUpColor:"rgb(103,179,238,0.7)",AreaDonwColor:"rgba(237,208,105,0.7)",Text:{Color:"rgb(0,0,0)",Family:"Arial",FontMaxSize:18,FontMinSize:6}},this.ChartVolProfileVisibleRange={VolLineColor:"rgb(232,5,9)",VolLineFont:14*V()+"px 微软雅黑",VolLineTextColor:"rgb(255,255,255)",UpVolColor:"rgba(103,179,238, 0.24)",DownVolColor:"rgba(237,208,105,0.24)",AreaUpColor:"rgb(103,179,238,0.7)",AreaDonwColor:"rgba(237,208,105,0.7)",Text:{Color:"rgb(0,0,0)",Family:"Arial",FontMaxSize:18,FontMinSize:6},VAHLineColor:"rgb(0,0,255)",VAHTextColor:"rgb(255,255,255)",VALLineColor:"rgb(0,0,255)",VALTextColor:"rgb(255,255,255)",VAFont:14*V()+"px 微软雅黑"},this.ChartDrawNote={Text:"",FontOption:{Family:"iconfont",Size:32},NoteFontOption:{Family:"微软雅黑",Size:12,Weight:null,Style:null},NoteWidth:200,NoteMargin:{Left:5,Top:5,Bottom:5,Right:5},NoteBGColor:"rgba(104,114,255,0.7)",NoteTextColor:"rgb(240,240,240)",NoteBorderColor:"rgb(220,220,220)",LineSpace:3,ArrowSize:10},this.ChartDrawAnchoredText={TextMargin:{Left:5,Top:5,Bottom:5,Right:5},BGColor:"rgba(104,114,255,0.7)",BorderColor:"rgb(220,220,220)",TextColor:"rgb(0,0,0)",FontOption:{Family:"微软雅黑",Size:12,Weight:null,Style:null},LineSpace:2,TextMaxWidth:-1},this.ChartDrawPriceLabel={TextMargin:{Left:10,Top:5,Bottom:5,Right:10},BGColor:"rgba(104,114,255,0.7)",BorderColor:"rgb(220,220,220)",TextColor:"rgb(0,0,0)",FontOption:{Family:"微软雅黑",Size:14,Weight:null,Style:null}},this.ChartDrawPriceNote={TextMargin:{Left:10,Top:5,Bottom:5,Right:10},BGColor:"rgba(104,114,255,0.7)",BorderColor:"rgb(220,220,220)",TextColor:"rgb(0,0,0)",FontOption:{Family:"微软雅黑",Size:14,Weight:null,Style:null}},this.DRAWICON={Icon:{MaxSize:24,MinSize:12,YOffset:0,Zoom:{Type:1,Value:1}},Text:{MaxSize:50,MinSize:12,YOffset:0,Zoom:{Type:1,Value:1},FontName:"Arial"}},this.DRAWTEXT={MaxSize:30,MinSize:20,YOffset:0,Zoom:{Type:1,Value:1},FontName:"微软雅黑"},this.DRAWNUMBER={MaxSize:30,MinSize:20,YOffset:0,Zoom:{Type:1,Value:1},FontName:"微软雅黑"},this.DRAWABOVE={YOffset:0},this.DRAWTEXT_FIX={Font:14*V()+"px 微软雅黑"},this.DRAWNUMBER_FIX={Font:14*V()+"px 微软雅黑"},this.DOTLINE={LineDash:[3,5]},this.DRAWSL={PixelWidth:15},this.CIRCLEDOT={Radius:1.3*V()},this.TIPICON={Family:"iconfont",TextFont:V()+"px 微软雅黑",Size:10*V(),Color:"rgb(255,165,0)"},this.POINTDOT={Radius:2*V()},this.DepthMapPaint={LineColor:"rgba(255,185,15)",AreaColor:["rgba(255,185,15,0.8)","rgba(255,185,15,0.4)"],TextColor:"rgba(255,255,255)",TextBGColor:"rgb(43,54,69)"},this.KLineYAxisBGPaint={Font:12*V()+"px 微软雅黑",LineColor:"rgb(117,125,129)",DiffValutTextColor:"rgb(117,125,129)",DiffValueBGColor:"rgb(251,140,1)"},this.StockChip={InfoColor:"rgb(0,0,0)",DayInfoColor:"rgb(255,255,255)",DefaultButton:{Color:"rgb(128,128,128)",MoveOnColor:"rgb(30,144,255)",SelectedColor:"rgb(255,0,0)",Family:"iconfont",Text:"",Size:13*V(),MerginLeft:4},LongButton:{Color:"rgb(128,128,128)",MoveOnColor:"rgb(30,144,255)",SelectedColor:"rgb(255,128,0)",Family:"iconfont",Text:"",Size:13*V(),MerginLeft:4},RecentButton:{Color:"rgb(128,128,128)",MoveOnColor:"rgb(30,144,255)",SelectedColor:"rgb(0,0,204)",Family:"iconfont",Text:"",Size:13*V(),MerginLeft:4}},this.DepthChart={BidColor:{Line:"rgb(82,176,123)",Area:"rgba(82,176,123,0.8)"},AskColor:{Line:"rgb(207,76,89)",Area:"rgba(207,76,89, 0.8)"},LineWidth:4},this.DepthCorss={BidColor:{Line:"rgb(82,176,123)"},AskColor:{Line:"rgb(207,76,89)"},LineWidth:2,LineDash:[3,3],Tooltip:{BGColor:"rgba(236,240,245, 0.8)",TextColor:"rgb(130,140,151)",Border:{Top:5,Left:20,Right:20,Bottom:5,ItemSpace:5},Font:14*V()+"px 微软雅黑"}},this.RectSelect={LineColor:"rgb(64,64,64)",LineWidth:1*V(),LineDotted:[3,3],AreaColor:"rgba(234,234,234,0.5)",SubAreaColor:"rgba(105,105,105,0.5)",RangeTextColor:"rgb(248,248,255)",RangeTextFont:14*V()+"px 微软雅黑",RangeTextBGColor:"rgb(43,54,69)",RangeTextSubColor:"rgb(255,255,255)",RangeTextSubFont:12*V()+"px 微软雅黑",RangeTextSubBGColor:"rgb(54,54,54)"},this.SelectedChart={LineWidth:1,LineColor:"rgb(55,100,100)",Radius:4,MinSpace:200,BGColor:"rgb(255,255,255)"},this.DragMovePaint={TextColor:"rgb(0,0,0)",Font:14*V()+"px 微软雅黑"},this.DealList={BorderColor:"rgb(192,192,192)",Header:{Color:"RGB(60,60,60)",Mergin:{Left:5,Right:5,Top:4,Bottom:2},Font:{Size:12,Name:"微软雅黑"}},Row:{Mergin:{Top:2,Bottom:2},Font:{Size:15,Name:"微软雅黑"},BarMergin:{Top:2,Left:3,Right:3,Bottom:2}},FieldColor:{Vol:"rgb(90,90,90)",Time:"rgb(60,60,60)",Deal:"rgb(90,90,90)",Index:"rgb(60,60,60)",BarTitle:"rgb(60,60,60)",Text:"rgb(60,60,60)",Bar:["rgb(255,0,0)","rgb(34,139,34)","rgb(119,136,153)","rgb(75,0,130)","rgb(65,105,225)","rgb(255,215,0)","rgb(255,0,255)","rgb(128,128,0)"]},UpTextColor:"rgb(238,21,21)",DownTextColor:"rgb(25,158,0)",UnchagneTextColor:"rgb(0,0,0)"},this.Report={BorderColor:"rgb(192,192,192)",SelectedColor:"rgb(180,240,240)",Header:{Color:"rgb(60,60,60)",SortColor:"rgb(255,0,0)",Mergin:{Left:5,Right:5,Top:4,Bottom:2},Font:{Size:12,Name:"微软雅黑"}},Item:{Mergin:{Top:2,Bottom:0,Left:5,Right:5},Font:{Size:15,Name:"微软雅黑"},BarMergin:{Top:2,Left:3,Right:3,Bottom:2},NameFont:{Size:14,Name:"微软雅黑"},SymbolFont:{Size:12,Name:"微软雅黑"}},FixedItem:{Font:{Size:15,Name:"微软雅黑"}},LimitBorder:{Color:"rgb(180,180,180)",Mergin:{Top:1,Bottom:1,Left:0,Right:0}},LimitColor:{UpColor:"rgb(255,0,0)",DownColor:"rgb(0,128,0)",TextColor:"rgb(250,250,250)"},FieldColor:{Index:"rgb(60,60,60)",Symbol:"rgb(60,60,60)",Name:"rgb(60,60,60)",Vol:"rgb(90,90,90)",Amount:"rgb(90,90,90)",Text:"rgb(60,60,60)"},UpTextColor:"rgb(238,21,21)",DownTextColor:"rgb(25,158,0)",UnchagneTextColor:"rgb(90,90,90)",CloseLine:{CloseColor:"rgb(30,144,255)",YCloseColor:"rgba(105,105,105,0.5)",AreaColor:"rgba(0,191,255,0.2)"},KLine:{UpColor:"rgb(255,0,0)",DownColor:"rgb(0,128,0)",UnchagneColor:"rgb(90,90,90)",DataWidth:16,DistanceWidth:3},Tab:{Font:{Size:12,Name:"微软雅黑"},ScrollBarWidth:100,ButtonColor:"rgb(252,252,252)",BarColor:"rgb(180,180,180)",BorderColor:"rgb(180,180,180)",Mergin:{Left:5,Right:5,Top:4,Bottom:2},TabTitleColor:"rgb(60,60,60)",TabSelectedTitleColor:"rgb(0,0,0)",TabSelectedBGColor:"rgb(252,252,252)",TabMoveOnTitleColor:"rgb(0,0,0)",TabBGColor:"rgb(220,220,220)"},PageInfo:{Font:{Size:15,Name:"微软雅黑"},TextColor:"rgb(0,0,0)",BGColor:"rgba(180,180,180,0.5)",Mergin:{Left:5,Right:5,Top:4,Bottom:2}},DragRow:{Color:"rgba(190,190,190,0.8)",TextColor:"rgba(0,0, 0, 0.8)",MoveRowColor:"rgb(240,128,128)",SrcRowColor:"rgb(180,240,240)"}},this.Keyboard={BorderColor:"rgb(192,192,192)",SelectedColor:"rgb(180,240,240)",TextColor:"rgb(0,0,0)",Item:{Mergin:{Top:2,Bottom:0,Left:1,Right:1},Font:{Size:15,Name:"微软雅黑"},BarMergin:{Top:2,Left:0,Right:0,Bottom:2},NameFont:{Size:14,Name:"微软雅黑"},SymbolFont:{Size:12,Name:"微软雅黑"}}},this.ScrollBar={BorderColor:"rgb(192,192,192)",XSplitTextFont:12*V()+"px 微软雅黑",XSplitTextColor:"rgb(0,0,0)",XSplitLineColor:"rgba(0,0,0,0.8)",BGChart:{Color:"rgb(135,206,250)",LineWidth:1,AreaColor:"rgba(135,206,250,0.5)"},Slider:{DateFont:14*V()+"px 微软雅黑",DateColor:"rgb(0,0,0)",BarColor:"rgb(207,207,207)",BarAreaColor:"rgba(232,232,232,0.65)"}},this.SetStyle=function(r){var n=function(O,R){O&&(O.Color&&(R.Color=O.Color),O.MoveOnColor&&(R.MoveOnColor=O.MoveOnColor),O.SelectedColor&&(R.SelectedColor=O.SelectedColor),O.Family&&(R.Family=O.Family),O.Text&&(R.Text=O.Text),c.IsNumber(O.Size)&&(R.Size=O.Size),c.IsNumber(O.MerginLeft)&&(R.MerginLeft=O.MerginLeft))};if(r.TooltipBGColor&&(this.TooltipBGColor=r.TooltipBGColor),r.TooltipAlpha&&(this.TooltipAlpha=r.TooltipAlpha),r.SelectRectBGColor&&(this.SelectRectBGColor=r.SelectRectBGColor),r.UpBarColor&&(this.UpBarColor=r.UpBarColor),r.DownBarColor&&(this.DownBarColor=r.DownBarColor),r.UnchagneBarColor&&(this.UnchagneBarColor=r.UnchagneBarColor),r.EmptyBarBGColor&&(this.EmptyBarBGColor=r.EmptyBarBGColor),r.HighLowBarColor&&(this.HighLowBarColor=r.HighLowBarColor),r.HLCArea){var e=r.HLCArea;e.HighLineColor&&(this.HLCArea.HighLineColor=e.HighLineColor),e.LowLineColor&&(this.HLCArea.LowLineColor=e.LowLineColor),e.CloseLineColor&&(this.HLCArea.CloseLineColor=e.CloseLineColor),e.UpAreaColor&&(this.HLCArea.UpAreaColor=e.UpAreaColor),e.DownAreaColor&&(this.HLCArea.DownAreaColor=e.DownAreaColor),c.IsNumber(e.LineWidth)&&(this.HLCArea.LineWidth=e.LineWidth)}if(r.Minute){if(r.Minute.VolBarColor&&(this.Minute.VolBarColor=r.Minute.VolBarColor),r.Minute.VolTitleColor&&(this.Minute.VolTitleColor=r.Minute.VolTitleColor),r.Minute.PriceColor&&(this.Minute.PriceColor=r.Minute.PriceColor),c.IsNumber(r.Minute.PriceLineWidth)&&(this.Minute.PriceLineWidth=r.Minute.PriceLineWidth),r.Minute.AvPriceColor&&(this.Minute.AvPriceColor=r.Minute.AvPriceColor),r.Minute.AreaPriceColor&&(this.Minute.AreaPriceColor=r.Minute.AreaPriceColor),r.Minute.PositionColor&&(this.Minute.PositionColor=r.Minute.PositionColor),r.Minute.FrameSplitTextColor&&(this.Minute.FrameSplitTextColor=r.Minute.FrameSplitTextColor),r.Minute.Before){var e=r.Minute.Before;e.BGColor&&(this.Minute.Before.BGColor=e.BGColor),e.LineColor&&(this.Minute.Before.LineColor=e.LineColor),e.VolColor&&(this.Minute.Before.VolColor=e.VolColor),e.AvPriceColor&&(this.Minute.Before.AvPriceColor=e.AvPriceColor),e.CloseIcon&&n(e.CloseIcon,this.Minute.Before.CloseIcon),e.Point&&(e.Point.Color&&(this.Minute.Before.Point.Color=e.Point.Color),e.Point.Radius&&(this.Minute.Before.Point.Radius=e.Point.Radius))}if(r.Minute.After){var e=r.Minute.After;e.BGColor&&(this.Minute.After.BGColor=e.BGColor),e.LineColor&&(this.Minute.After.LineColor=e.LineColor),e.VolColor&&(this.Minute.After.VolColor=e.VolColor),e.AvPriceColor&&(this.Minute.After.AvPriceColor=e.AvPriceColor),e.Point&&(e.Point.Color&&(this.Minute.After.Point.Color=e.Point.Color),e.Point.Radius&&(this.Minute.After.Point.Radius=e.Point.Radius))}}if(r.DefaultTextColor&&(this.DefaultTextColor=r.DefaultTextColor),r.DefaultTextFont&&(this.DefaultTextFont=r.DefaultTextFont),r.TitleFont&&(this.TitleFont=r.TitleFont),r.IndexTitleBGColor&&(this.IndexTitleBGColor=r.IndexTitleBGColor),r.IndexTitleBorderColor&&(this.IndexTitleBorderColor=r.IndexTitleBorderColor),r.IndexTitleBorderMoveOnColor&&(this.IndexTitleBorderMoveOnColor=r.IndexTitleBorderMoveOnColor),r.IndexTitleColor&&(this.IndexTitleColor=r.IndexTitleColor),r.IndexTitleSelectedColor&&(this.IndexTitleSelectedColor=r.IndexTitleSelectedColor),r.OverlayIndexTitleBGColor&&(this.OverlayIndexTitleBGColor=r.OverlayIndexTitleBGColor),r.UpTextColor&&(this.UpTextColor=r.UpTextColor),r.DownTextColor&&(this.DownTextColor=r.DownTextColor),r.UnchagneTextColor&&(this.UnchagneTextColor=r.UnchagneTextColor),r.CloseLineColor&&(this.CloseLineColor=r.CloseLineColor),r.CloseLineAreaColor&&(this.CloseLineAreaColor=r.CloseLineAreaColor),r.CloseLineWidth&&(this.CloseLineWidth=r.CloseLineWidth),r.FrameBorderPen&&(this.FrameBorderPen=r.FrameBorderPen),r.MultiDayBorderPen&&(this.MultiDayBorderPen=r.MultiDayBorderPen),r.FrameSplitPen&&(this.FrameSplitPen=r.FrameSplitPen),r.FrameDotSplitPen&&(this.FrameDotSplitPen=r.FrameDotSplitPen),r.FrameSplitTextColor&&(this.FrameSplitTextColor=r.FrameSplitTextColor),r.FrameSplitTextFont&&(this.FrameSplitTextFont=r.FrameSplitTextFont),r.FrameTitleBGColor&&(this.FrameTitleBGColor=r.FrameTitleBGColor),c.IsNumber(r.IndexTitleMerginLeft)&&(this.IndexTitleMerginLeft=r.IndexTitleMerginLeft),r.Frame&&(r.Frame.XBottomOffset&&(this.Frame.XBottomOffset=r.Frame.XBottomOffset),r.Frame.YTopOffset&&(this.Frame.YTopOffset=r.Frame.YTopOffset),r.Frame.PercentageText)){var e=r.Frame.PercentageText;e.PriceColor&&(this.Frame.PercentageText.PriceColor=e.PriceColor),e.PercentageColor&&(this.Frame.PercentageText.PercentageColor=e.PercentageColor),e.SplitColor&&(this.Frame.PercentageText.SplitColor=e.SplitColor),e.Font&&(this.Frame.PercentageText.Font=e.Font)}if(c.IsNumber(r.ToolbarButtonStyle)&&(this.ToolbarButtonStyle=r.ToolbarButtonStyle),c.IsBool(r.IsDOMFrameTitle)&&(this.IsDOMFrameTitle=r.IsDOMFrameTitle),r.FrameLatestPrice){var e=r.FrameLatestPrice;r.FrameLatestPrice.TextColor&&(this.FrameLatestPrice.TextColor=r.FrameLatestPrice.TextColor),r.FrameLatestPrice.UpBarColor&&(this.FrameLatestPrice.UpBarColor=r.FrameLatestPrice.UpBarColor),r.FrameLatestPrice.DownBarColor&&(this.FrameLatestPrice.DownBarColor=r.FrameLatestPrice.DownBarColor),r.FrameLatestPrice.UnchagneBarColor&&(this.FrameLatestPrice.UnchagneBarColor=r.FrameLatestPrice.UnchagneBarColor),r.FrameLatestPrice.BGAlpha&&(this.FrameLatestPrice.BGAlpha=r.FrameLatestPrice.BGAlpha),r.FrameLatestPrice.OverlayTextColor&&(this.FrameLatestPrice.OverlayTextColor=r.FrameLatestPrice.OverlayTextColor),e.EmptyBGColor&&(this.FrameLatestPrice.EmptyBGColor=e.EmptyBGColor)}if(r.CorssCursorBGColor&&(this.CorssCursorBGColor=r.CorssCursorBGColor),r.CorssCursorTextColor&&(this.CorssCursorTextColor=r.CorssCursorTextColor),r.CorssCursorTextFont&&(this.CorssCursorTextFont=r.CorssCursorTextFont),r.CorssCursorVPenColor&&(this.CorssCursorVPenColor=r.CorssCursorVPenColor),r.CorssCursorHPenColor&&(this.CorssCursorHPenColor=r.CorssCursorHPenColor),r.CorssCursorBorderColor&&(this.CorssCursorBorderColor=r.CorssCursorBorderColor),r.CorssCursorXRangeBGColor&&(this.CorssCursorXRangeBGColor=r.CorssCursorXRangeBGColor),r.CorssCursor&&r.CorssCursor.RightButton){var e=r.CorssCursor.RightButton;e.BGColor&&(this.CorssCursor.RightButton.BGColor=e.BGColor),e.PenColor&&(this.CorssCursor.RightButton.PenColor=e.PenColor),e.Icon&&(this.CorssCursor.RightButton.Icon=e.Icon)}if(r.KLine&&(this.KLine=r.KLine),r.VirtualKLine){var e=r.VirtualKLine;e.Color&&(this.VirtualKLine.Color=e.Color),e.LineDash&&(this.VirtualKLine.LineDash=e.LineDash)}if(r.Index&&(r.Index.LineColor&&(this.Index.LineColor=r.Index.LineColor),r.Index.NotSupport&&(this.Index.NotSupport=r.Index.NotSupport)),r.ColorArray&&(this.ColorArray=r.ColorArray),r.DrawPicture){var e=r.DrawPicture;e.LineColor&&(this.DrawPicture.LineColor=e.LineColor),e.PointColor&&(this.DrawPicture.PointColor=e.PointColor),e.XYCoordinate&&(this.DrawPicture.XYCoordinate=e.XYCoordinate),c.IsNumber(e.PointType)&&(this.DrawPicture.PointType=e.PointType),c.IsBool(e.IsShowPoint)&&(this.DrawPicture.IsShowPoint=e.IsShowPoint)}if(r.TooltipPaint&&(r.TooltipPaint.BGColor&&(this.TooltipPaint.BGColor=r.TooltipPaint.BGColor),r.TooltipPaint.BorderColor&&(this.TooltipPaint.BorderColor=r.TooltipPaint.BorderColor),r.TooltipPaint.TitleColor&&(this.TooltipPaint.TitleColor=r.TooltipPaint.TitleColor),r.TooltipPaint.TitleFont&&(this.TooltipPaint.TitleFont=r.TooltipPaint.TitleFont),r.TooltipPaint.DateTimeColor&&(this.TooltipPaint.DateTimeColor=r.TooltipPaint.DateTimeColor),r.TooltipPaint.VolColor&&(this.TooltipPaint.VolColor=r.TooltipPaint.VolColor),r.TooltipPaint.AmountColor&&(this.TooltipPaint.AmountColor=r.TooltipPaint.AmountColor)),r.PCTooltipPaint){var e=r.PCTooltipPaint;e.BGColor&&(this.PCTooltipPaint.BGColor=e.BGColor),e.BorderColor&&(this.PCTooltipPaint.BorderColor=e.BorderColor),e.TitleColor&&(this.PCTooltipPaint.TitleColor=e.TitleColor),e.TitleFont&&(this.PCTooltipPaint.TitleFont=e.TitleFont),e.DateTimeColor&&(this.PCTooltipPaint.DateTimeColor=e.DateTimeColor),e.VolColor&&(this.PCTooltipPaint.VolColor=e.VolColor),e.AmountColor&&(this.PCTooltipPaint.AmountColor=e.AmountColor)}if(r.MinuteInfo&&(r.MinuteInfo.TextColor&&(this.MinuteInfo.TextColor=r.MinuteInfo.TextColor),r.MinuteInfo.Font&&(this.MinuteInfo.Font=r.MinuteInfo.Font),r.MinuteInfo.PointColor&&(this.MinuteInfo.PointColor=r.MinuteInfo.PointColor),r.MinuteInfo.LineColor&&(this.MinuteInfo.LineColor=r.MinuteInfo.LineColor),r.MinuteInfo.TextBGColor&&(this.MinuteInfo.TextBGColor=r.MinuteInfo.TextBGColor)),r.Title&&(r.Title.TradeIndexColor&&(this.Title.TradeIndexColor=r.Title.TradeIndexColor),r.Title.ColorIndexColor&&(this.Title.ColorIndexColor=r.Title.ColorIndexColor),r.Title.VolColor&&(this.Title.VolColor=r.Title.VolColor),r.Title.AmountColor&&(this.Title.AmountColor=r.Title.AmountColor),r.Title.DateTimeColor&&(this.Title.DateTimeColor=r.Title.DateTimeColor),r.Title.NameColor&&(this.Title.NameColor=r.Title.NameColor),r.Title.SettingColor&&(this.Title.SettingColor=r.Title.SettingColor),r.Title.TurnoverRateColor&&(this.Title.TurnoverRateColor=r.Title.TurnoverRateColor),r.Title.PositionColor&&(this.Title.PositionColor=r.Title.PositionColor)),r.DRAWICON){if(r.DRAWICON.Icon){var e=r.DRAWICON.Icon;c.IsPlusNumber(e.MaxSize)&&(this.DRAWICON.Icon.MaxSize=e.MaxSize),c.IsPlusNumber(e.MinSize)&&(this.DRAWICON.Icon.MinSize=e.MinSize),e.Zoom&&(this.DRAWICON.Icon.Zoom=e.Zoom),c.IsNumber(e.YOffset)&&(this.DRAWICON.Icon.YOffset=e.YOffset)}if(r.DRAWICON.Text){var e=r.DRAWICON.Text;c.IsPlusNumber(e.MaxSize)&&(this.DRAWICON.Text.MaxSize=e.MaxSize),c.IsPlusNumber(e.MinSize)&&(this.DRAWICON.Text.MinSize=e.MinSize),e.Zoom&&(this.DRAWICON.Text.Zoom=e.Zoom),e.FontName&&(this.DRAWICON.Text.FontName=e.FontName),c.IsNumber(e.YOffset)&&(this.DRAWICON.Text.YOffset=e.YOffset)}}if(r.DRAWTEXT){var e=r.DRAWTEXT;c.IsPlusNumber(e.MaxSize)&&(this.DRAWICON.MaxSize=e.MaxSize),c.IsPlusNumber(e.MinSize)&&(this.DRAWICON.MinSize=e.MinSize),e.Zoom&&(this.DRAWTEXT.Zoom=e.Zoom),e.FontName&&(this.DRAWTEXT.FontName=e.FontName),c.IsNumber(e.YOffset)&&(this.DRAWTEXT.YOffset=e.YOffset)}if(r.DRAWTEXT_FIX){var e=r.DRAWTEXT_FIX;e.Font&&(this.DRAWTEXT_FIX.Font=e.Font)}if(r.DRAWNUMBER_FIX){var e=r.DRAWNUMBER_FIX;e.Font&&(this.DRAWNUMBER_FIX.Font=e.Font)}if(r.DRAWNUMBER){var e=r.DRAWNUMBER;c.IsPlusNumber(e.MaxSize)&&(this.DRAWNUMBER.MaxSize=e.MaxSize),c.IsPlusNumber(e.MinSize)&&(this.DRAWNUMBER.MinSize=e.MinSize),e.Zoom&&(this.DRAWNUMBER.Zoom=e.Zoom),e.FontName&&(this.DRAWNUMBER.FontName=e.FontName),c.IsNumber(e.YOffset)&&(this.DRAWNUMBER.YOffset=e.YOffset)}if(r.DRAWABOVE){var e=r.DRAWABOVE;c.IsNumber(e.YOffset)&&(this.DRAWABOVE.YOffset=e.YOffset)}if(r.DOTLINE&&(this.DOTLINE=r.DOTLINE),r.DRAWSL&&(this.DOTLINE=r.DRAWSL),r.DragSubFrameBorder&&(this.DragSubFrameBorder=r.DragSubFrameBorder),r.DepthMapPaint){var e=r.DepthMapPaint;e.LineColor&&(this.DepthMapPaint.LineColor=e.LineColor),e.AreaColor&&(this.DepthMapPaint.AreaColor=e.AreaColor),e.TextColor&&(this.DepthMapPaint.TextColor=e.TextColor),e.TextBGColor&&(this.DepthMapPaint.TextBGColor=e.TextBGColor)}if(r.KLineYAxisBGPaint){var e=r.KLineYAxisBGPaint;e.Font&&(this.KLineYAxisBGPaint.Font=e.Font),e.LineColor&&(this.KLineYAxisBGPaint.LineColor=e.LineColor),e.DiffValutTextColor&&(this.KLineYAxisBGPaint.DiffValutTextColor=e.DiffValutTextColor),e.DiffValueBGColor&&(this.KLineYAxisBGPaint.DiffValueBGColor=e.DiffValueBGColor)}if(r.StockChip){var e=r.StockChip;e.InfoColor&&(this.StockChip.InfoColor=e.InfoColor),e.DayInfoColor&&(this.StockChip.DayInfoColor=e.DayInfoColor),e.DefaultButton&&n(e.DefaultButton,this.StockChip.DefaultButton),e.LongButton&&n(e.LongButton,this.StockChip.LongButton),e.RecentButton&&n(e.RecentButton,this.StockChip.RecentButton)}if(r.DepthChart){var e=r.DepthChart;e.BidColor&&(e.BidColor.Line&&(this.DepthChart.BidColor.Line=e.BidColor.Line),e.BidColor.Area&&(this.DepthChart.BidColor.Area=e.BidColor.Area)),e.AskColor&&(e.AskColor.Line&&(this.DepthChart.AskColor.Line=e.AskColor.Line),e.AskColor.Area&&(this.DepthChart.AskColor.Area=e.AskColor.Area)),e.LineWidth&&(this.DepthChart.LineWidth=e.LineWidth)}if(r.DepthCorss){var e=r.DepthCorss;if(e.BidColor&&e.BidColor.Line&&(this.DepthCorss.BidColor.Line=e.BidColor.Line),e.AskColor&&e.AskColor.Line&&(this.DepthCorss.AskColor.Line=e.AskColor.Line),e.LineWidth&&(this.DepthCorss.LineWidth=e.LineWidth),e.LineDash&&(this.DepthCorss.LineDash=e.LineDash),e.Tooltip){var t=e.Tooltip;t.BGColor&&(this.DepthCorss.Tooltip.BGColor=t.BGColor),t.TextColor&&(this.DepthCorss.Tooltip.TextColor=t.TextColor),t.Font&&(this.DepthCorss.Tooltip.Font=t.Font),t.LineHeight&&(this.DepthCorss.Tooltip.LineHeight=t.LineHeight);var a=t.Border;c.IsNumber(a.Top)&&(this.DepthCorss.Tooltip.Border.Top=a.Top),c.IsNumber(a.Bottom)&&(this.DepthCorss.Tooltip.Border.Bottom=a.Bottom),c.IsNumber(a.Left)&&(this.DepthCorss.Tooltip.Border.Left=a.Left),c.IsNumber(a.Right)&&(this.DepthCorss.Tooltip.Border.Right=a.Right),c.IsNumber(a.ItemSpace)&&(this.DepthCorss.Tooltip.Border.ItemSpace=a.ItemSpace)}}if(r.CIRCLEDOT){var e=r.CIRCLEDOT;c.IsNumber(e.Radius)&&(this.CIRCLEDOT.Radius=e.Radius)}if(r.POINTDOT){var e=r.POINTDOT;c.IsNumber(e.Radius)&&(this.POINTDOT.Radius=e.Radius)}if(r.RectSelect){var e=r.RectSelect;e.LineColor&&(this.RectSelect.LineColor=e.LineColor),e.LineWidth>0&&(this.RectSelect.LineWidth=e.LineWidth),e.LineDotted&&(this.RectSelect.LineDotted=e.LineDotted),e.AreaColor&&(this.RectSelect.AreaColor=e.AreaColor),e.SubAreaColor&&(this.RectSelect.SubAreaColor=e.SubAreaColor),e.RangeTextColor&&(this.RectSelect.RangeTextColor=e.RangeTextColor),e.RangeTextFont&&(this.RectSelect.RangeTextFont=e.RangeTextFont),e.RangeTextBGColor&&(this.RectSelect.RangeTextBGColor=e.RangeTextBGColor),e.RangeTextSubColor&&(this.RectSelect.RangeTextSubColor=e.RangeTextSubColor),e.RangeTextSubFont&&(this.RectSelect.RangeTextSubFont=e.RangeTextSubFont),e.RangeTextSubBGColor&&(this.RectSelect.RangeTextSubBGColor=e.RangeTextSubBGColor)}if(r.OrderFlow&&(e=r.OrderFlow,e.UpColor&&(this.OrderFlow.UpColor=e.UpColor),e.DownColor&&(this.OrderFlow.DownColor=e.DownColor),e.UnchagneColor&&(this.OrderFlow.UnchagneColor=e.UnchagneColor),e.Text&&(this.OrderFlow.Text=e.Text),e.Line&&(this.OrderFlow.Line=e.Line)),r.OrderFlow_Style2&&(e=r.OrderFlow_Style2,e.UpColor&&(this.OrderFlow_Style2.UpColor=e.UpColor),e.DownColor&&(this.OrderFlow_Style2.DownColor=e.DownColor),e.UnchagneColor&&(this.OrderFlow_Style2.UnchagneColor=e.UnchagneColor),c.IsNumber(e.BarWidth)&&(this.OrderFlow_Style2.BarWidth=e.BarWidth)),r.ChartOX){var e=r.ChartOX;e.Family&&(this.ChartOX.Family=e.Family),e.Up&&(this.ChartOX.Up=e.Up),e.Down&&(this.ChartOX.Down=e.Down),e.SquareLineColor&&(this.ChartOX.SquareLineColor=e.SquareLineColor)}if(r.DealList){var e=r.DealList;if(e.BorderColor&&(this.DealList.BorderColor=e.BorderColor),e.UpTextColor&&(this.DealList.UpTextColor=e.UpTextColor),e.DownTextColor&&(this.DealList.DownTextColor=e.DownTextColor),e.UnchagneTextColor&&(this.DealList.UnchagneTextColor=e.UnchagneTextColor),e.CloseLineColor&&(this.DealList.CloseLineColor=e.CloseLineColor),e.Header){var s=e.Header;if(s.Color&&(this.DealList.Header.Color=s.Color),s.Mergin){var o=s.Mergin;c.IsNumber(o.Left)&&(this.DealList.Header.Mergin.Left=o.Left),c.IsNumber(o.Right)&&(this.DealList.Header.Mergin.Left=o.Right),c.IsNumber(o.Top)&&(this.DealList.Header.Mergin.Top=o.Top),c.IsNumber(o.Bottom)&&(this.DealList.Header.Mergin.Bottom=o.Bottom)}if(s.Font){var h=s.Font;h.Name&&(this.DealList.Header.Font.Name=h.Name),c.IsNumber(h.Size)&&(this.DealList.Header.Font.Size=h.Size)}}if(e.Row){var l=e.Row;if(l.Mergin){var o=l.Mergin;c.IsNumber(o.Top)&&(this.DealList.Row.Mergin.Top=o.Top),c.IsNumber(o.Bottom)&&(this.DealList.Row.Mergin.Bottom=o.Bottom)}if(l.Font){var h=l.Font;h.Name&&(this.DealList.Row.Font.Name=h.Name),c.IsNumber(h.Size)&&(this.DealList.Row.Font.Size=h.Size)}if(l.BarMergin){var o=l.BarMergin;c.IsNumber(o.Left)&&(this.DealList.Row.BarMergin.Left=o.Left),c.IsNumber(o.Top)&&(this.DealList.Row.BarMergin.Top=o.Top),c.IsNumber(o.Right)&&(this.DealList.Row.BarMergin.Right=o.Right),c.IsNumber(o.Bottom)&&(this.DealList.Row.BarMergin.Bottom=o.Bottom)}}if(e.FieldColor){var u=e.FieldColor;if(u.Vol&&(this.DealList.FieldColor.Vol=u.Vol),u.Time&&(this.DealList.FieldColor.Time=u.Time),u.Deal&&(this.DealList.FieldColor.Deal=u.Deal),u.Index&&(this.DealList.FieldColor.Index=u.Index),u.BarTitle&&(this.DealList.FieldColor.BarTitle=u.BarTitle),u.Text&&(this.DealList.FieldColor.Text=u.Text),c.IsNonEmptyArray(u.Bar))for(var f=0;f<u.Bar.length;++f)this.DealList.FieldColor.Bar[f]=u.Bar[f]}}if(r.Report){var e=r.Report;if(e.BorderColor&&(this.Report.BorderColor=e.BorderColor),e.UpTextColor&&(this.Report.UpTextColor=e.UpTextColor),e.DownTextColor&&(this.Report.DownTextColor=e.DownTextColor),e.UnchagneTextColor&&(this.Report.UnchagneTextColor=e.UnchagneTextColor),e.BorderColor&&(this.Report.SelectedColor=e.SelectedColor),e.CloseLine){var C=e.CloseLine;C.CloseColor&&(this.Report.CloseLine.CloseColor=C.CloseColor),C.YCloseColor&&(this.Report.CloseLine.YCloseColor=C.YCloseColor),C.AreaColor&&(this.Report.CloseLine.AreaColor=C.AreaColor)}if(e.KLine){var D=e.KLine;D.UpColor&&(this.Report.KLine.UpColor=D.UpColor),D.DownColor&&(this.Report.KLine.DownColor=D.DownColor),D.UnchagneColor&&(this.Report.KLine.UnchagneColor=D.UnchagneColor),c.IsNumber(D.DataWidth)&&(this.Report.KLine.DataWidth=D.DataWidth),c.IsNumber(D.DistanceWidth)&&(this.Report.KLine.DistanceWidth=D.DistanceWidth)}if(e.Header){var s=e.Header;if(s.Color&&(this.Report.Header.Color=s.Color),s.SortColor&&(this.Report.Header.SortColor=s.SortColor),s.Mergin){var o=s.Mergin;c.IsNumber(o.Left)&&(this.Report.Header.Mergin.Left=o.Left),c.IsNumber(o.Right)&&(this.Report.Header.Mergin.Left=o.Right),c.IsNumber(o.Top)&&(this.Report.Header.Mergin.Top=o.Top),c.IsNumber(o.Bottom)&&(this.Report.Header.Mergin.Bottom=o.Bottom)}if(s.Font){var h=s.Font;h.Name&&(this.Report.Header.Font.Name=h.Name),c.IsNumber(h.Size)&&(this.Report.Header.Font.Size=h.Size)}}if(e.Item){var l=e.Item;if(l.Mergin){var o=l.Mergin;c.IsNumber(o.Left)&&(this.Report.Item.Mergin.Left=o.Left),c.IsNumber(o.Right)&&(this.Report.Item.Mergin.Right=o.Right),c.IsNumber(o.Top)&&(this.Report.Item.Mergin.Top=o.Top),c.IsNumber(o.Bottom)&&(this.Report.Item.Mergin.Bottom=o.Bottom)}if(l.Font){var h=l.Font;h.Name&&(this.Report.Item.Font.Name=h.Name),c.IsNumber(h.Size)&&(this.Report.Item.Font.Size=h.Size)}if(l.BarMergin){var o=l.BarMergin;c.IsNumber(o.Left)&&(this.Report.Item.BarMergin.Left=o.Left),c.IsNumber(o.Top)&&(this.Report.Item.BarMergin.Top=o.Top),c.IsNumber(o.Right)&&(this.Report.Item.BarMergin.Right=o.Right),c.IsNumber(o.Bottom)&&(this.Report.Item.BarMergin.Bottom=o.Bottom)}if(l.NameFont){var h=l.NameFont;h.Name&&(this.Report.Item.NameFont.Name=h.Name),c.IsNumber(h.Size)&&(this.Report.Item.NameFont.Size=h.Size)}if(l.SymbolFont){var h=l.SymbolFont;h.Name&&(this.Report.Item.SymbolFont.Name=h.Name),c.IsNumber(h.Size)&&(this.Report.Item.SymbolFont.Size=h.Size)}}if(e.FixedItem){var l=e.FixedItem;if(l.Font){var h=l.Font;h.Name&&(this.Report.FixedItem.Font.Name=h.Name),c.IsNumber(h.Size)&&(this.Report.FixedItem.Font.Size=h.Size)}}if(e.LimitBorder){var v=e.LimitBorder;if(v.Color&&(this.Report.LimitBorder.Color=v.Color),v.Mergin){var o=v.Mergin;c.IsNumber(o.Left)&&(this.Report.LimitBorder.Mergin.Left=o.Left),c.IsNumber(o.Top)&&(this.Report.LimitBorder.Mergin.Top=o.Top),c.IsNumber(o.Right)&&(this.Report.LimitBorder.Mergin.Right=o.Right),c.IsNumber(o.Bottom)&&(this.Report.LimitBorder.Mergin.Bottom=o.Bottom)}}if(e.LimitColor){var v=e.LimitColor;v.UpColor&&(this.Report.LimitColor.UpColor=v.UpColor),v.DownColor&&(this.Report.LimitColor.DownColor=v.DownColor),v.TextColor&&(this.Report.LimitColor.UpColor=v.TextColor)}if(e.FieldColor){var u=e.FieldColor;if(u.Name&&(this.Report.FieldColor.Name=u.Name),u.Symbol&&(this.Report.FieldColor.Symbol=u.Symbol),u.Vol&&(this.Report.FieldColor.Vol=u.Vol),u.Amount&&(this.Report.FieldColor.Amount=u.Amount),u.Index&&(this.Report.FieldColor.Index=u.Index),u.BarTitle&&(this.Report.FieldColor.BarTitle=u.BarTitle),u.Text&&(this.Report.FieldColor.Text=u.Text),c.IsNonEmptyArray(u.Bar))for(var f=0;f<u.Bar.length;++f)this.Report.FieldColor.Bar[f]=u.Bar[f]}if(e.Tab){var S=e.Tab;if(S.Font){var h=S.Font;h.Name&&(this.Report.Tab.Font.Name=h.Name),c.IsNumber(h.Size)&&(this.Report.Tab.Font.Size=h.Size)}c.IsNumber(S.ScrollBarWidth)&&(this.Report.Tab.ScrollBarWidth=S.ScrollBarWidth),S.ButtonColor&&(this.Report.Tab.ButtonColor=S.ButtonColor),S.BarColor&&(this.Report.Tab.BarColor=S.BarColor),S.BorderColor&&(this.Report.Tab.BorderColor=S.BorderColor),S.TabTitleColor&&(this.Report.Tab.TabTitleColor=S.TabTitleColor),S.TabSelectedTitleColor&&(this.Report.Tab.TabSelectedTitleColor=S.TabSelectedTitleColor),S.TabSelectedBGColor&&(this.Report.Tab.TabSelectedBGColor=S.TabSelectedBGColor),S.TabMoveOnTitleColor&&(this.Report.Tab.TabMoveOnTitleColor=S.TabMoveOnTitleColor),S.TabBGColor&&(this.Report.Tab.TabBGColor=S.TabBGColor)}if(e.PageInfo){var T=e.PageInfo;if(T.Font){var h=T.Font;h.Name&&(this.Report.PageInfo.Font.Name=h.Name),c.IsNumber(h.Size)&&(this.Report.PageInfo.Font.Size=h.Size)}if(T.TextColor&&(this.Report.PageInfo.TextColor=T.TextColor),T.BGColor&&(this.Report.PageInfo.BGColor=T.BGColor),T.Mergin){var o=T.Mergin;c.IsNumber(o.Left)&&(this.Report.PageInfo.Mergin.Left=o.Left),c.IsNumber(o.Top)&&(this.Report.PageInfo.Mergin.Top=o.Top),c.IsNumber(o.Right)&&(this.Report.PageInfo.Mergin.Right=o.Right),c.IsNumber(o.Bottom)&&(this.Report.PageInfo.Mergin.Bottom=o.Bottom)}}if(e.DragRow){var I=e.DragRow;I.Color&&(this.Report.DragRow.Color=I.Color),I.TextColor&&(this.Report.DragRow.TextColor=I.TextColor),I.MoveRowColor&&(this.Report.DragRow.MoveRowColor=I.MoveRowColor),I.SrcRowColor&&(this.Report.DragRow.SrcRowColor=I.SrcRowColor)}}if(r.SelectedChart){var e=r.SelectedChart;c.IsNumber(e.LineWidth)&&(this.SelectedChart.LineWidth=e.LineWidth),c.IsNumber(e.Radius)&&(this.SelectedChart.Radius=e.Radius),c.IsNumber(e.MinSpace)&&(this.SelectedChart.MinSpace=e.MinSpace),e.LineColor&&(this.SelectedChart.LineColor=e.LineColor),e.LineColor&&(this.SelectedChart.BGColor=e.BGColor)}if(r.DragMovePaint){var e=r.DragMovePaint;e.TextColor&&(this.DragMovePaint.TextColor=e.TextColor),e.Font&&(this.DragMovePaint.Font=e.Font)}if(c.IsNumber(r.ToolbarButtonStyle)&&(this.ToolbarButtonStyle=r.ToolbarButtonStyle),r.Buttons){var F=r.Buttons;n(F.CloseOverlayIndex,this.Buttons.CloseOverlayIndex),n(F.CloseWindow,this.Buttons.CloseWindow),n(F.ChangeIndex,this.Buttons.ChangeIndex),n(F.OverlayIndex,this.Buttons.OverlayIndex),n(F.ModifyIndexParam,this.Buttons.ModifyIndexParam),n(F.MaxMinWindow,this.Buttons.MaxMinWindow),n(F.TitleWindow,this.Buttons.TitleWindow),n(F.ExportData,this.Buttons.ExportData)}if(r.ChartDrawVolProfile){var e=r.ChartDrawVolProfile;e.UpVolColor&&(this.ChartDrawVolProfile.UpVolColor=e.UpVolColor),e.DownVolColor&&(this.ChartDrawVolProfile.DownVolColor=e.DownVolColor),e.AreaUpColor&&(this.ChartDrawVolProfile.AreaUpColor=e.AreaUpColor),e.AreaDonwColor&&(this.ChartDrawVolProfile.AreaDonwColor=e.AreaDonwColor),e.BGColor&&(this.ChartDrawVolProfile.BGColor=e.BGColor),e.BorderColor&&(this.ChartDrawVolProfile.BorderColor=e.BorderColor),e.VolLineColor&&(this.ChartDrawVolProfile.VolLineColor=e.VolLineColor),e.Text&&(e.Text.Color&&(this.ChartDrawVolProfile.Text.Color=e.Text.Color),e.Text.Family&&(this.ChartDrawVolProfile.Text.Family=e.Text.Family),c.IsNumber(e.Text.FontMaxSize)&&(this.ChartDrawVolProfile.Text.FontMaxSize=e.Text.FontMaxSize),c.IsNumber(e.Text.FontMinSize)&&(this.ChartDrawVolProfile.Text.FontMinSize=e.Text.FontMinSize))}if(r.DisableLogo===!0&&this.FrameLogo&&(this.FrameLogo.Text=null),r.ScrollBar){var e=r.ScrollBar;if(e.BorderColor&&(this.ScrollBar.BorderColor=e.BorderColor),e.XSplitTextFont&&(this.ScrollBar.XSplitTextFont=e.XSplitTextFont),e.XSplitTextColor&&(this.ScrollBar.XSplitTextColor=e.XSplitTextColor),e.XSplitLineColor&&(this.ScrollBar.XSplitLineColor=e.XSplitLineColor),e.Slider){var E=e.Slider;E.DateFont&&(this.ScrollBar.Slider.DateFont=E.DateFont),E.DateColor&&(this.ScrollBar.Slider.DateColor=E.DateColor),E.BarColor&&(this.ScrollBar.Slider.BarColor=E.BarColor),E.BarAreaColor&&(this.ScrollBar.Slider.BarAreaColor=E.BarAreaColor)}if(e.BGChart){var E=e.BGChart;E.Color&&(this.ScrollBar.BGChart.Color=E.Color),E.AreaColor&&(this.ScrollBar.BGChart.AreaColor=E.AreaColor),c.IsPlusNumber(E.LineWidth)&&(this.ScrollBar.BGChart.LineWidth=E.LineWidth)}}}}var m=new QC,ke={LANGUAGE_CHINESE_ID:0,LANGUAGE_ENGLISH_ID:1,LANGUAGE_TRADITIONAL_CHINESE_ID:2};function Lm(){this.TextResource=new Dt.default([["Tooltip-Open",{CN:"开:",EN:"O:",TC:"開"}],["Tooltip-High",{CN:"高:",EN:"H:",TC:"高"}],["Tooltip-Low",{CN:"低:",EN:"L:",TC:"低"}],["Tooltip-Close",{CN:"收:",EN:"C:",TC:"收"}],["Tooltip-Increase",{CN:"幅:",EN:"I:",TC:"幅"}],["Tooltip-Vol",{CN:"量:",EN:"V:",TC:"量"}],["Tooltip-Amount",{CN:"额:",EN:"A:",TC:"額"}],["Tooltip-AvPrice",{CN:"均:",EN:"AP:",TC:"均"}],["Tooltip-Price",{CN:"价:",EN:"P:",TC:"價"}],["Tooltip-Exchange",{CN:"换:",EN:"E:",TC:"換"}],["Tooltip-Position",{CN:"持:",EN:"P:",TC:"持"}],["DivTooltip-Open",{CN:"开盘:",EN:"Open:",TC:"開盤"}],["DivTooltip-High",{CN:"最高:",EN:"High:",TC:"最高"}],["DivTooltip-Low",{CN:"最低:",EN:"Low:",TC:"最低"}],["DivTooltip-Close",{CN:"收盘:",EN:"Close:",TC:"收盤"}],["DivTooltip-Increase",{CN:"涨幅:",EN:"Increase:",TC:"漲幅"}],["DivTooltip-Vol",{CN:"数量:",EN:"Volume:",TC:"數量"}],["DivTooltip-Amount",{CN:"金额:",EN:"Amount:",TC:"金額"}],["DivTooltip-Exchange",{CN:"换手:",EN:"Exchange:",TC:"換手"}],["DivTooltip-Position",{CN:"持仓:",EN:"Position:",TC:"持倉"}],["DivTooltip-Price",{CN:"价格:",EN:"Open:",TC:"價格"}],["PCTooltip-Date",{CN:"日期",EN:"Date",TC:"日期"}],["PCTooltip-Time",{CN:"时间",EN:"Time",TC:"時間"}],["PCTooltip-Price",{CN:"价格",EN:"Price:",TC:"價格"}],["PCTooltip-AvPrice",{CN:"均价",EN:"AVPrice:",TC:"均價"}],["PCTooltip-Increase",{CN:"涨幅",EN:"Increase:",TC:"漲幅"}],["PCTooltip-Vol",{CN:"成交量",EN:"Volume:",TC:"成交量"}],["PCTooltip-Amount",{CN:"成交额",EN:"Amount:",TC:"成交額"}],["PCTooltip-AC-Price",{CN:"匹配价:",EN:"Price:",TC:"匹配價"}],["PCTooltip-AC-Increase",{CN:"竞价涨幅:",EN:"Increase:",TC:"競價漲幅"}],["PCTooltip-AC-Vol",{CN:"匹配量:",EN:"V:",TC:"匹配量"}],["PCTooltip-AC-NotMatchVol",{CN:"未匹配量:",EN:"NV:",TC:"未匹配量"}],["KTitle-Open",{CN:"开:",EN:"O:",TC:"開"}],["KTitle-High",{CN:"高:",EN:"H:",TC:"高"}],["KTitle-Low",{CN:"低:",EN:"L:",TC:"低"}],["KTitle-Close",{CN:"收:",EN:"C:",TC:"收"}],["KTitle-Increase",{CN:"幅:",EN:"I:",TC:"幅"}],["KTitle-Vol",{CN:"量:",EN:"V:",TC:"量"}],["KTitle-Amount",{CN:"额:",EN:"A:",TC:"額"}],["KTitle-Exchange",{CN:"换:",EN:"E:",TC:"換"}],["KTitle-Position",{CN:"持:",EN:"P:",TC:"持"}],["KTitle-Price",{CN:"价:",EN:"Price:",TC:"價"}],["MTitle-AC-Price",{CN:"匹配价:",EN:"C:",TC:"匹配價"}],["MTitle-AC-AvPrice",{CN:"匹配均价:",EN:"C:",TC:"匹配均價"}],["MTitle-AC-Increase",{CN:"竞价涨幅:",EN:"I:",TC:"競價漲幅"}],["MTitle-AC-Vol",{CN:"匹配量:",EN:"V:",TC:"匹配量"}],["MTitle-AC-NotMatchVol",{CN:"未匹配量:",EN:"NV:",TC:"未匹配量"}],["MTitle-AC-Amount",{CN:"匹配量金额:",EN:"A:",TC:"匹配量金额"}],["MTitle-AC-NotMatchAmount",{CN:"未匹配量金额:",EN:"NA:",TC:"未匹配量金额"}],["MTitle-Close",{CN:"价:",EN:"C:",TC:"價"}],["MTitle-AvPrice",{CN:"均:",EN:"AC:",TC:"均"}],["MTitle-Increase",{CN:"幅:",EN:"I:",TC:"幅"}],["MTitle-Vol",{CN:"量:",EN:"V:",TC:"量"}],["MTitle-Amount",{CN:"额:",EN:"A:",TC:"額"}],["MTitle-Position",{CN:"持:",EN:"P:",TC:"持"}],["MTitle-UpdateTime",{CN:"更新:",EN:"Update:",TC:"更新:"}],["日线",{CN:"日线",EN:"1D",TC:"日綫"}],["周线",{CN:"周线",EN:"1W",TC:"周綫"}],["双周",{CN:"双周",EN:"2W",TC:"雙周"}],["月线",{CN:"月线",EN:"1M",TC:"月綫"}],["半年",{CN:"半年",EN:"HY",TC:"半年"}],["年线",{CN:"年线",EN:"1Y",TC:"年綫"}],["1分",{CN:"1分",EN:"1Min",TC:"1分"}],["5分",{CN:"5分",EN:"5Min",TC:"5分"}],["15分",{CN:"15分",EN:"15Min",TC:"15分"}],["30分",{CN:"30分",EN:"30Min",TC:"30分"}],["60分",{CN:"60分",EN:"60Min",TC:"60分"}],["季线",{CN:"季线",EN:"1Q",TC:"季綫"}],["分笔",{CN:"分笔",EN:"Tick",TC:"分筆"}],["2小时",{CN:"2小时",EN:"2H",TC:"2小時"}],["4小时",{CN:"4小时",EN:"4H",TC:"4小時"}],["不复权",{CN:"不复权",EN:"No Right",TC:"不復權"}],["前复权",{CN:"前复权",EN:"Pro Right",TC:"前復權"}],["后复权",{CN:"后复权",EN:"Post Right",TC:"后復權"}],["日",{CN:"日",EN:"Sun.",TC:"日"}],["一",{CN:"一",EN:"Mon.",TC:"壹"}],["二",{CN:"二",EN:"Tues.",TC:"貳"}],["三",{CN:"三",EN:"Wed.",TC:"叁"}],["四",{CN:"四",EN:"Thur.",TC:"肆"}],["五",{CN:"五",EN:"Fri.",TC:"伍"}],["六",{CN:"六",EN:"Sat.",TC:"陸"}],["1月",{CN:"1月",EN:"Jan",TC:"1月"}],["2月",{CN:"2月",EN:"Feb",TC:"2月"}],["3月",{CN:"3月",EN:"Mar",TC:"3月"}],["4月",{CN:"4月",EN:"Apr",TC:"4月"}],["5月",{CN:"5月",EN:"May",TC:"5月"}],["6月",{CN:"6月",EN:"Jun",TC:"6月"}],["7月",{CN:"7月",EN:"Jul",TC:"7月"}],["8月",{CN:"8月",EN:"Aug",TC:"8月"}],["9月",{CN:"9月",EN:"Sept",TC:"9月"}],["10月",{CN:"10月",EN:"Oct",TC:"10月"}],["11月",{CN:"11月",EN:"Nov",TC:"11月"}],["12月",{CN:"12月",EN:"Dec",TC:"12月"}],["自定义分钟",{CN:"分",EN:"Min",TC:"分"}],["自定义日线",{CN:"日",EN:"D",TC:"日"}],["自定义秒",{CN:"秒",EN:"S",TC:"秒"}],["MVol-Vol",{CN:"成交量",EN:"Volume",TC:"成交量"}],["MVol-Position",{CN:"持仓量",EN:"Position",TC:"持倉量"}],["Depth-Price",{CN:"委托价",EN:"Price",TC:"委托價"}],["Depth-Sum",{CN:"累计",EN:"Sum",TC:"累計"}],["Toolbar-"+xt.MODIFY_INDEX_PARAM,{CN:"调整指标参数",EN:"Change indicator parameters",TC:"调整指标参数"}],["Toolbar-"+xt.CHANGE_INDEX,{CN:"选择指标",EN:"Change indicator",TC:"切换指标"}],["Toolbar-"+xt.CLOSE_INDEX_WINDOW,{CN:"关闭窗口",EN:"Delete window",TC:"关闭指标窗口"}],["Toolbar-"+xt.OVERLAY_INDEX,{CN:"叠加指标",EN:"Overlay indicator",TC:"叠加指标"}],["Toolbar-"+xt.MODIFY_OVERLAY_INDEX_PARAM,{CN:"调整叠加指标参数",EN:"Change overlay indicator parameters",TC:"调整叠加指标参数"}],["Toolbar-"+xt.MAX_MIN_WINDOW,{CN:"最大化",EN:"Maximize",TC:"最大化"}],["Toolbar-"+xt.TITLE_WINDOW,{CN:"折叠窗口",EN:"Collapse window",TC:"折叠窗口"}],["Toolbar-"+xt.EXPORT_DATA,{CN:"数据导出",EN:"Export data",TC:"数据导出"}],["Toolbar-"+xt.CLOSE_BEFOREOPEN_ID,{CN:"关闭集合竞价",EN:"Close call auction",TC:"关闭集合竞价"}],["Toolbar-"+xt.CLOSE_OVERLAY_INDEX,{CN:"关闭叠加指标",EN:"Delte overlay indicator",TC:"关闭叠加指标"}],["Toolbar-"+xt.CHIP_RECENT,{CN:"近期成本分布",EN:"Recent chip",TC:"近期成本分布"}],["Toolbar-"+xt.CHIP_LONG,{CN:"远期成本分布",EN:"Long chip",TC:"远期成本分布"}],["Toolbar-"+xt.CHIP_DEFULT,{CN:"默认筹码分布",EN:"Default chip",TC:"默认筹码分布"}],["Toolbar-"+xt.DRAW_PICTURE_DELETE,{CN:"删除",EN:"Delete",TC:"删除"}],["Toolbar-"+xt.DRAW_PICTURE_SETTING,{CN:"设置",EN:"Setting",TC:"设置"}]]),this.GetText=function(r,n){var e=this.TextResource.get(r);if(!e)return"";switch(n){case ke.LANGUAGE_CHINESE_ID:return e.CN;case ke.LANGUAGE_ENGLISH_ID:return e.EN;case ke.LANGUAGE_TRADITIONAL_CHINESE_ID:return e.TC;default:return e.CN}},this.SetTextResource=function(r,n){this.TextResource.set(r,n)},this.GetLanguageID=function(r){var n=null;switch(r){case"EN":n=ke.LANGUAGE_ENGLISH_ID;break;case"CN":n=ke.LANGUAGE_CHINESE_ID;break;case"TC":n=ke.LANGUAGE_TRADITIONAL_CHINESE_ID;break}return n}}var gt=new Lm;function Ja(){}Ja.Get=function(r){var n=new Dt.default([["市场多空",{IsMainIndex:!1,Create:function(){return new Hm}}],["市场择时",{IsMainIndex:!1,Create:function(){return new Ym}}],["市场关注度",{IsMainIndex:!1,Create:function(){return new km}}],["指数热度",{IsMainIndex:!1,Create:function(){return new Xm}}],["财务粉饰",{IsMainIndex:!1,Create:function(){return new _m}}],["自定义指数热度",{IsMainIndex:!1,Create:function(){return new Wm},Name:"自定义指数热度"}],["CJL",{IsMainIndex:!1,Create:function(){return new Vm}}],["OX",{IsMainIndex:!1,Create:function(){return new bm}}],["可视范围成交量分布图",{IsMainIndex:!0,Create:function(t){return new Gm(t)}}]]);return n.get(r)};function Zt(){}Zt.EMA=function(r,n){var e=[],t=0;if(t>=r.length)return e;for(;t<r.length&&!(r[t]!=null&&!isNaN(r[t]));++t);var a=t,s=t+1;e[a]=r[a];for(var o=t+1;o<r.length;++o,++a,++s)e[s]=(2*r[s]+(n-1)*e[a])/(n+1);return e};Zt.SMA=function(r,n,e){for(var t=[],a=0,s=null;a<r.length;++a)if(!(r[a]==null||isNaN(r[a]))){s=r[a],t[a]=s;break}for(++a;a<r.length;++a)t[a]=(e*r[a]+(n-e)*s)/n,s=t[a];return t};Zt.DMA=function(r,n){var e=[];if(r.length<0||r.length!=n.length)return e;for(var t=0;t<r.length;++t)if(r[t]!=null&&!isNaN(r[t])&&n[t]!=null&&!isNaN(n[t])){e[t]=r[t];break}for(t=t+1;t<r.length;++t)r[t]==null||n[t]==null?e[t]=null:r[t]<1?e[t]=n[t]*r[t]+(1-n[t])*e[t-1]:e[t]=r[t];return e};Zt.HHV=function(r,n){var e=[];if(n>r.length)return e;for(var t=-1e4,a=n,s=0;a<r.length;++a,++s){if(a<n+t)t=r[a]<r[t]?t:a;else for(s=(t=a-n+1)+1;s<=a;++s)r[s]>r[t]&&(t=s);e[a]=r[t]}return e};Zt.LLV=function(r,n){var e=[];if(n>r.length)return e;for(var t=-1e4,a=n;a<r.length;++a,++s){if(a<n+t)t=r[a]>r[t]?t:a;else for(var s=(t=a-n+1)+1;s<=a;++s)r[s]<r[t]&&(t=s);e[a]=r[t]}return e};Zt.REF=function(r,n){var e=[];if(r.length<=0||n>=r.length)return e;e=r.slice(0,r.length-n);for(var t=0;t<n;++t)e.unshift(null);return e};Zt.REFDATE=function(r,n){var e=[];if(r.length<=0)return e;n=r.length-1;for(var t in r)e[t]=r[n];return e};Zt.SUM=function(r,n){var e=[];if(n==0){e[0]=r[0];for(var t=1;t<r.length;++t)e[t]=e[t-1]+r[t]}else for(var t=n-1,a=0;t<r.length;++t,++a)for(var s=0;s<n;++s)s==0?e[t]=r[s+a]:e[t]+=r[s+a];return e};Zt.ARRAY_SUBTRACT=function(r,n){var e=[],t=typeof n=="number";if(t)for(var a in r)r[a]==null||isNaN(r[a])?e[a]=null:e[a]=r[a]-n;else for(var s=Math.max(r.length,n.length),a=0;a<s;++a)a<r.length&&a<n.length?r[a]==null||n[a]==null?e[a]=null:e[a]=r[a]-n[a]:e[a]=null;return e};Zt.ARRAY_GT=function(r,n){var e=[],t=typeof n=="number";if(t)for(var a in r)e[a]=r[a]>n?1:0;else for(var s=Math.max(r.length,n.length),a=0;a<s;++a)a<r.length&&a<n.length?e[a]=r[a]>n[a]?1:0:e[a]=null;return e};Zt.ARRAY_GTE=function(r,n){var e=[],t=typeof n=="number";if(t)for(var a in r)e[a]=r[a]>=n?1:0;else for(var s=Math.max(r.length,n.length),a=0;a<s;++a)a<r.length&&a<n.length?e[a]=r[a]>=n[a]?1:0:e[a]=null;return e};Zt.ARRAY_LT=function(r,n){var e=[],t=typeof n=="number";if(t)for(var a in r)e[a]=r[a]<n?1:0;else for(var s=Math.max(r.length,n.length),a=0;a<s;++a)a<r.length&&a<n.length?e[a]=r[a]<n[a]?1:0:e[a]=null;return e};Zt.ARRAY_LTE=function(r,n){var e=[],t=typeof n=="number";if(t)for(var a in r)e[a]=r[a]<=n?1:0;else for(var s=Math.max(r.length,n.length),a=0;a<s;++a)a<r.length&&a<n.length?e[a]=r[a]<=n[a]?1:0:e[a]=null;return e};Zt.ARRAY_EQ=function(r,n){var e=[],t=typeof n=="number";if(t)for(var a in r)e[a]=r[a]==n?1:0;else for(var s=Math.max(r.length,n.length),a=0;a<s;++a)a<r.length&&a<n.length?e[a]=r[a]==n[a]?1:0:e[a]=null;return e};Zt.ARRAY_IF=function(r,n,e){var t=[],a=[typeof n=="number",typeof e=="number"];for(var s in r)r[s]?a[0]?t[s]=n:t[s]=n[s]:a[1]?t[s]=e:t[s]=e[s];return t};Zt.ARRAY_AND=function(r,n){var e=[],t=typeof n=="number";if(t)for(var a in r)e[a]=r[a]&&n?1:0;else for(var s=Math.max(r.length,n.length),a=0;a<s;++a)a<r.length&&a<n.length?e[a]=r[a]&&n[a]?1:0:e[a]=0;return e};Zt.ARRAY_OR=function(r,n){var e=[],t=typeof n=="number";if(t)for(var a in r)e[a]=r[a]||n?1:0;else for(var s=Math.max(r.length,n.length),a=0;a<s;++a){if(a<r.length&&r[a]){e[a]=1;continue}if(a<n.length&&n[a]){e[a]=1;continue}e[a]=0}return e};Zt.ARRAY_MULTIPLY=function(r,n){if(arguments.length==2){var s=[],e=typeof n=="number";if(e)for(var t in r)r[t]==null||isNaN(r[t])?s[t]=null:s[t]=r[t]*n;else for(var a=Math.max(r.length,n.length),t=0;t<a;++t)t<r.length&&t<n.length?s[t]=r[t]*n[t]:s[t]=null;return s}for(var s=Zt.ARRAY_MULTIPLY(arguments[0],arguments[1]),t=2;t<arguments.length;++t)s=Zt.ARRAY_MULTIPLY(s,arguments[t]);return s};Zt.ARRAY_DIVIDE=function(r,n){var e=[],t=typeof n=="number";if(t)for(var a in r)e[a]=r[a]/n;else for(var s=Math.max(r.length,n.length),a=0;a<s;++a)a<r.length&&a<n.length?r[a]==null||n[a]==null||isNaN(r[a])||isNaN(n[a])||n[a]==0?e[a]=null:e[a]=r[a]/n[a]:e[a]=null;return e};Zt.ARRAY_ADD=function(r,n){if(arguments.length==2){var s=[],e=typeof n=="number";if(e)for(var t in r)s[t]=r[t]+n;else for(var a=Math.max(r.length,n.length),t=0;t<a;++t)t<r.length&&t<n.length?r[t]==null||n[t]==null||isNaN(r[t])||isNaN(n[t])?s[t]=null:s[t]=r[t]+n[t]:s[t]=null;return s}for(var s=Zt.ARRAY_ADD(arguments[0],arguments[1]),t=2;t<arguments.length;++t)s=Zt.ARRAY_ADD(s,arguments[t]);return s};Zt.MAX=function(r,n){var e=[],t=typeof n=="number";if(t)for(var a in r)r[a]==null?e[a]=null:e[a]=Math.max(r[a],n);else for(var s=Math.max(r.length,n.length),a=0;a<s;++a)a<r.length&&a<n.length?r[a]==null||n[a]==null?e[a]=null:e[a]=Math.max(r[a],n[a]):e[a]=null;return e};Zt.MIN=function(r,n){var e=[],t=typeof n=="number";if(t)for(var a in r)r[a]==null?e[a]=null:e[a]=Math.min(r[a],n);else for(var s=Math.max(r.length,n.length),a=0;a<s;++a)a<r.length&&a<n.length?r[a]==null||n[a]==null?e[a]=null:e[a]=Math.min(r[a],n[a]):e[a]=null;return e};Zt.ABS=function(r){var n=[];for(var e in r)r[e]==null?n[e]=null:n[e]=Math.abs(r[e]);return n};Zt.MA=function(r,n){for(var e=[],t=0,a=r.length;t<a;t++){if(t<n){e[t]=null;continue}for(var s=0,o=0;o<n;o++)s+=r[t-o];e[t]=s/n}return e};Zt.EXPMA=function(r,n){var e=[];if(n>=r.length)return e;for(var t=n;t<r.length;++t)if(r[t]!=null){e[t]=r[t];break}for(t=t+1;t<r.length;++t)e[t-1]!=null&&r[t]!=null?e[t]=(2*r[t]+(n-1)*e[t-1])/(n+1):e[t-1]!=null&&(e[t]=e[t-1]);return e};Zt.EXPMEMA=function(r,n){var e=[];if(n>=r.length)return e;for(var t=0;t<r.length&&!(r[t]&&!isNaN(r[t]));++t);for(var a=0,s=0;t<r.length&&s<n;++s,++t)r[t]&&!isNaN(r[t])?a+=r[t]:a+=r[t-1];for(e[t-1]=a/n;t<r.length;++t)e[t-1]!=null&&r[t]!=null?e[t]=(2*r[t]+(n-1)*e[t-1])/(n+1):e[t-1]!=null&&(e[t]=e[t-1]);return e};Zt.STD=function(r,n){for(var e=[],t=0,a=[],s=n-1;s<r.length;++s){t=0;for(var o=0;o<n;++o)t+=r[s-o];a[s]=t/n}for(var s=n-1;s<r.length;++s){t=0;for(var o=0;o<n;++o)t+=Math.pow(r[s-o]-a[s],2);e[s]=Math.sqrt(t/n)}return e};Zt.AVEDEV=function(r,n){for(var e=[],t=0,a=[],s=n-1;s<r.length;++s){t=0;for(var o=0;o<n;++o)t+=r[s-o];a[s]=t/n}for(var s=n-1;s<r.length;++s){t=0;for(var o=0;o<n;++o)t+=Math.abs(r[s-o]-a[s]);e[s]=t/n}return e};Zt.COUNT=function(r,n){for(var e=[],t=n-1;t<r.length;++t){for(var a=0,s=0;s<n;++s)r[t-s]&&++a;e[t]=a}return e};Zt.CROSS=function(r,n){var e=[];if(r.length!=n.length)return e=[];for(var t=0;t<r.length&&!(r[t]!=null&&!isNaN(r[t])&&n[t]!=null&&isNaN(n[t]));++t);for(++t;t<r.length;++t)e[t]=r[t]>n[t]&&r[t-1]<n[t-1]?1:0;return e};Zt.MULAR=function(r,n){var e=[];if(r.length<n)return e;for(var t=n;t<r.length;++t)if(r[t]!=null&&!isNaN(r[t])){e[t]=r[t];break}for(++t;t<r.length;++t)e[t]=e[t-1]*r[t];return e};Zt.STICKLINE=function(r,n,e){var t=[];if(r.length<=0)return t;var a=typeof n=="number",s=typeof e=="number";for(var o in r)if(t[o]=null,!isNaN(r[o])&&r[o])if(a&&s)t[o]={Value:n,Value2:e};else if(a&&!s){if(isNaN(e[o]))continue;t[o]={Value:n,Value2:e[o]}}else if(!a&&s){if(isNaN(n[o]))continue;t[o]={Value:n[o],Value2:e}}else{if(isNaN(n[o])||isNaN(e[o]))continue;t[o]={Value:n[o],Value2:e[o]}}return t};function Mm(){this.DataMap=new Dt.default([["RenkoCalculate",{Create:function(){return new Ku}}],["HeikinAshiCalculate",{Create:function(){return new Am}}],["LineBreakCalcuate",{Create:function(){return new Nm}}],["KagiCalculate",{Create:function(){return new Ku}}]]),this.Create=function(r){if(!this.DataMap.has(r))return null;var n=this.DataMap.get(r);return n.Create()}}var $C=new Mm;function Ku(){this.BrickSize=.05,this.SourceData,this.LastData,this.ATR={Count:14,BrickSize:.05},this.BrickSizeType=1,this.Symbol,this.FloatPrecision=2,this.ClassName="RenkoCalculate",this.SetOption=function(r){if(r&&(c.IsNumber(r.BrickSize)&&(this.BrickSize=r.BrickSize),c.IsNumber(r.BrickSizeType)&&(this.BrickSizeType=r.BrickSizeType),r.ATR)){var n=r.ATR;c.IsNumber(n.Count)&&(this.ATR.Count=n.Count)}},this.CalculateByClose=function(r){var n=new k;if(n.Data=[],n.Right=r.Right,n.Period=r.Period,n.DataType=r.DataType,n.Symbol=r.symbol,!c.IsNonEmptyArray(r.Data))return n;var e=this.BrickSize;this.BrickSizeType==1&&(e=this.ATR.BrickSize);var t=r.Data[0];this.LastData=Rt.Copy(t);for(var a=1;a<r.Data.length;){var t=r.Data[a],s=t.Close-this.LastData.Close,o=t.Close-this.LastData.Open;if(Math.abs(s)>=e&&Math.abs(o)>=e){var h=0;if(s>0||o>0){var l=this.LastData.Close,u=Math.max(this.LastData.Close,this.LastData.Open),f=u+e,C=f,D=u;h=t.Vol}else{var l=this.LastData.Close,u=Math.min(this.LastData.Close,this.LastData.Open),f=u-e,C=u,D=f;h=t.Vol}var v=new Rt;v.Date=t.Date,v.Time=t.Time,v.YClose=l,v.Open=u,v.High=C,v.Low=D,v.Close=f,v.Vol=this.LastData.Vol+h,n.Data.push(v),this.LastData.YClose=v.YClose,this.LastData.Open=v.Open,this.LastData.High=v.High,this.LastData.Low=v.Low,this.LastData.Close=v.Close,this.LastData.Date=v.Date,this.LastData.Time=v.Time,this.LastData.Vol=0}else this.LastData.Vol+=t.Vol,++a}return n},this.RecvHistoryData=function(r,n){return this.Symbol=n.Symbol,this.SourceData=r,this.FloatPrecision=fe(this.Symbol),this.BrickSizeType==1&&this.CalculateATR(),this.CalculateByClose(r)},this.Clear=function(){this.SourceData=null,this.LastData=null,this.Symbol=null},this.GetTitle=function(){if(this.BrickSizeType==1)var r="Renko [ATR("+this.ATR.Count+"), "+this.ATR.BrickSize+"]";else var r="Renko [Traditional, "+this.BrickSize+"]";return r},this.CalculateATR=function(){if(c.IsNonEmptyArray(this.SourceData.Data)){for(var r=this.SourceData.Data,n=r.length,e=[],t=n-1,a=0;t>=0&&a<this.ATR.Count;--t,++a){var s=r[t],l=Math.max(s.High-s.Low,s.High-s.Close,s.Close-s.Low);e.push(l)}for(var o=0,t=0;t<e.length;++t)o+=e[t];var h=o/e.length,l=h.toFixed(this.FloatPrecision);this.ATR.BrickSize=parseFloat(l)}}}function Am(){this.SourceData,this.Symbol,this.FloatPrecision=2,this.ClassName="HeikinAshiCalculate",this.Clear=function(){this.SourceData=null,this.LastData=null,this.Symbol=null},this.RecvHistoryData=function(r,n){return this.Symbol=n.Symbol,this.SourceData=r,this.FloatPrecision=fe(this.Symbol),this.Calculate(r)},this.GetTitle=function(){return"Heikin Ashi"},this.Calculate=function(r){var n=new k;if(n.Data=[],n.Right=r.Right,n.Period=r.Period,n.DataType=r.DataType,n.Symbol=r.symbol,!c.IsNonEmptyArray(r.Data))return n;for(var e=null,t=null,a=0;a<r.Data.length;++a){var s=r.Data[a],o=Rt.Copy(s);e?(o.Close=(s.Close+s.Open+s.High+s.Low)/4,o.Open=(e.Close+e.Open)/2,o.YClose=t,o.High=Math.max(o.Close,o.Open,s.High),o.Low=Math.min(o.Close,o.Open,s.Low),t=o.Close):(o.Open=(s.Close+s.Open)/2,o.Close=(s.Close+s.Open+s.High+s.Low)/4,t=o.Close),e=s,n.Data.push(o)}return n}}function Nm(){this.SourceData,this.Symbol,this.FloatPrecision=2,this.LineCount=3,this.ClassName="LineBreakCalcuate",this.Clear=function(){this.SourceData=null,this.LastData=null,this.Symbol=null},this.GetTitle=function(){return"Line Break ["+this.LineCount+"]"},this.RecvHistoryData=function(r,n){return this.Symbol=n.Symbol,this.SourceData=r,this.FloatPrecision=fe(this.Symbol),this.CalculateByClose(r)},this.CalculatePreviousKLine=function(r){for(var n=0;n<r.Data.length;++n){var e=r.Data[n];n==0?(r.High=e.High,r.Low=e.Low):(r.High<e.High&&(r.High=e.High),r.Low<e.Low&&(r.Low=e.Low)),r.Date=e.Date,r.Time=e.Time,r.Vol+=e.Vol,r.Amount+=e.Amount}},this.CalculateByClose=function(r){var n=new k;if(n.Data=[],n.Right=r.Right,n.Period=r.Period,n.DataType=r.DataType,n.Symbol=r.symbol,!c.IsNonEmptyArray(r.Data))return n;for(var e=0,t={High:null,Low:null,Date:null,Time:null,Direction:0};e<r.Data.length&&e<this.LineCount;++e){var a=r.Data[e];s==0?(t.High=a.High,t.Low=a.Low):(t.High<a.High&&(t.High=a.High),t.Low>a.Low&&(t.Low=a.Low)),t.Date=a.Date,t.Time=a.Time,t.Vol+=a.Vol,t.Amount+=a.Amount}for(var s=e;s<r.Data.length;++s){var a=r.Data[s];if(a.Close>t.High){var o=new Rt;o.YClose=t.Low,o.Open=t.High,o.Close=a.Close,o.Low=Math.min(o.Open,o.Close),o.High=Math.max(o.Open,o.Close),o.Date=a.Date,o.Time=a.Time,o.Vol=a.Vol,o.Amount=a.Amount,o.Direction=1,n.Data.push(o),t=o}else if(a.Close<t.Low){var o=new Rt;o.YClose=t.High,o.Open=t.Low,o.Close=a.Close,o.Low=Math.min(o.Open,o.Close),o.High=Math.max(o.Open,o.Close),o.Date=a.Date,o.Time=a.Time,o.Vol=a.Vol,o.Amount=a.Amount,o.Direction=2,n.Data.push(o),t=o}else t&&(t.Direction==1||t.Direction==2,t.Vol+=a.Vol,t.Amount+=a.Amount)}return n}}function Te(r,n){this.newMethod=Ar,this.newMethod(r,n),delete this.newMethod,this.ClassName="KLineChartContainer",this.WindowIndex=new Array,this.ColorIndex,this.TradeIndex,this.Symbol,this.Name,this.Period=0,this.IsApiPeriod=!1,this.Right=0,this.RightFormula=0,this.SourceData,this.MaxRequestDataCount=3e3,this.MaxRequestMinuteDayCount=5,this.PageSize=200,this.KLineDrawType=0,this.ScriptErrorCallback,this.FlowCapitalReady=!1,this.EnableFlowCapital={},this.EnableZoomUpDown=null,this.ChartDrawStorage=new zC,this.ChartDrawStorageCache=null,this.RightSpaceCount=0,this.SourceDataLimit=new Dt.default,this.CtrlMoveStep=5,this.CustomShow=null,this.OverlayIndexFrameWidth=60,this.ZoomType=0,this.IsZoomLockRight=!1,this.KLineSize=null,this.Page={Day:{Enable:!1,Index:0,Finish:!1},Minute:{Enable:!1,Index:0,Finish:!1}},this.DragDownload={Day:{Enable:!1,IsEnd:!1,Status:0},Minute:{Enable:!1,IsEnd:!1,Status:0},Tick:{Enable:!1,IsEnd:!1,Status:0}},this.ZoomDownload={Day:{Enable:!1,IsEnd:!1,Status:0},Minute:{Enable:!1,IsEnd:!1,Status:0},Tick:{Enable:!1,IsEnd:!1,Status:0}},this.IsAutoUpdate=!1,this.AutoUpdateFrequency=3e4,this.AutoUpdateTimer,this.KLineApiUrl=m.Domain+"/API/KLine2",this.MinuteKLineApiUrl=m.Domain+"/API/KLine3",this.DragMinuteKLineApiUrl=m.Domain+"/API/KLine4",this.DragKLineApiUrl=m.Domain+"/API/KLine5",this.ZoomMinuteKLineApiUrl=m.Domain+"/API/KLine4",this.ZoomKLineApiUrl=m.Domain+"/API/KLine5",this.RealtimeApiUrl=m.Domain+"/API/Stock",this.KLineMatchUrl=m.Domain+"/API/KLineMatch",this.StockHistoryDayApiUrl=m.Domain+"/API/StockHistoryDay",this.TickApiUrl=m.Domain+"/API/StockDetail",this.MinuteDialog,this.RightMenu,this.BeforeBindMainData=null,this.AfterBindMainData=null,this.KLineCalculate=null,this.KLineCalcOption=new Dt.default,this.ScrollBar=null,this.GetKLineCalulate=function(){var e=this.GetKLineDrawType(),t;if(e==10)t="RenkoCalculate";else if(e==11)t="HeikinAshiCalculate";else if(e==12)t="LineBreakCalcuate";else if(e==16)t="KagiCalculate";else return null;if((!this.KLineCalculate||this.KLineCalculate.ClassName!=t)&&(this.KLineCalculate=$C.Create(t),this.KLineCalculate.SetOption&&this.KLineCalcOption.has(t))){var a=this.KLineCalcOption.get(t);this.KLineCalculate.SetOption(a)}return this.KLineCalculate},this.SetKLineCalcOption=function(e,t){this.KLineCalcOption.set(e,t),this.KLineCalculate&&this.KLineCalculate.ClassName==e&&this.KLineCalculate.SetOption&&this.KLineCalculate.SetOption(t)},this.ClearKLineCaluate=function(){this.KLineCalculate&&this.KLineCalculate.Clear&&this.KLineCalculate.Clear()},this.ResetDragDownload=function(){this.DragDownload.Day.Status=0,this.DragDownload.Day.IsEnd=!1,this.DragDownload.Minute.Status=0,this.DragDownload.Minute.IsEnd=!1,this.DragDownload.Tick.Status=0,this.DragDownload.Tick.IsEnd=!1},this.ResetZoomDownload=function(){this.ZoomDownload.Day.Status=0,this.ZoomDownload.Day.IsEnd=!1,this.ZoomDownload.Minute.Status=0,this.ZoomDownload.Minute.IsEnd=!1,this.ZoomDownload.Tick.Status=0,this.ZoomDownload.Tick.IsEnd=!1},this.ResetPage=function(){this.Page.Day.Finish=!1,this.Page.Day.Index=0,this.Page.Minute.Finish=!1,this.Page.Minute.Index=0},this.AddCustomKLine=function(e,t){var a=this.ChartPaint[0];if(a&&e){if(a.CustomKLine||(a.CustomKLine=new Dt.default),Array.isArray(e))for(var s=0;s<e.length;++s){var o=e[s];a.CustomKLine.set(o.Key,o.Data)}else e&&a.CustomKLine.set(e.Key,e.Data);t&&t.Draw==!0&&this.Draw()}},this.ClearCustomKLine=function(e){var t=this.ChartPaint[0];t&&(t.ClearCustomKLine(),e&&e.Draw==!0&&this.Draw())},this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::StopAutoUpdate"),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.SandTableOperator=function(e){switch(e.ID){case 1:this.StopAutoUpdate(),e.Data&&this.ManualUpdateKData(e);break;case 2:this.ManualUpdateKData(e);break;case 3:e.IsAutoUpdate&&(this.IsAutoUpdate=e.IsAutoUpdate),this.ChangeSymbol(this.Symbol);break}},this.ManualUpdateKData=function(e){var t=e.Data,a=t.length,s=new k;s.Data=t,s.Period=this.Period,s.Right=this.Right,s.Symbol=this.Symbol,this.UpdateMainData(s,a),this.BindInstructionIndexData(s);for(var o=0;o<this.Frame.SubFrame.length;++o)this.BindIndexData(o,s);if(c.IsNumber(e.DataOffset)&&e.DataOffset>=0){var h=null;this.Frame.Data?h=this.Frame.Data:h=this.Frame.SubFrame[0].Frame.Data,h&&(h.DataOffset=e.DataOffset)}this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendManualKLineUpdateEvent(s)},this.GetKDataInfo=function(){if(!this.ChartPaint[0])return null;var e=this.ChartPaint[0],t={};return e.Data&&e.Data.Data&&(t.Data=e.Data.CloneData("HistoryData")),t.ShowRange=e.ShowRange,t.Period=this.Period,t.RightSpaceCount=this.RightSpaceCount,t},this.ChartOperator=function(e){var t=e.ID;if(t===ce.OP_SCROLL_LEFT||t===ce.OP_SCROLL_RIGHT){var a=t===ce.OP_SCROLL_LEFT,s=1;e.Step>0&&(s=e.Step);var o=this.GetMoveOneStepWidth();this.DataMove(s*o,a)?(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()):t===ce.OP_SCROLL_RIGHT&&this.DragDownloadData&&this.DragDownloadData()}else if(t===ce.OP_ZOOM_IN||t===ce.OP_ZOOM_OUT){var h={};if(h.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),t===ce.OP_ZOOM_IN){if(!this.Frame.ZoomUp(h))return}else if(!this.Frame.ZoomDown(h))return;this.CursorIndex=h.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw()}else if(t===ce.OP_GOTO_HOME){var l=this.ChartOperator_Temp_GetHistroyData();if(!l)return;var u=this.Frame.SubFrame[0].Frame.XPointCount;u-=this.RightSpaceCount;var f=l.Data.length-u;l.DataOffset=f,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,X.Chart.Log("[KLineChartContainer::ChartOperator] OP_GOTO_HOME, dataOffset="+l.DataOffset+" CursorIndex="+this.CursorIndex+" PageSize="+u),this.ChartOperator_Temp_Update()}else if(t===ce.OP_GOTO_END){var l=this.ChartOperator_Temp_GetHistroyData();if(!l)return;l.DataOffset=0,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,X.Chart.Log("[KLineChartContainer::ChartOperator] OP_GOTO_END "),this.ChartOperator_Temp_Update()}else if(t==ce.OP_LEFT_ZOOM_IN||t==ce.OP_LEFT_ZOOM_OUT){var l=this.ChartOperator_Temp_GetHistroyData();if(!l)return;var C=l.Data.length,u=this.Frame.SubFrame[0].Frame.XPointCount,D=l.DataOffset;if(t==ce.OP_LEFT_ZOOM_IN){if(c.IsNumber(e.Step)){if(u>=C)return;var s=e.Step;if(s>D&&(s=D),u+s>C&&(s=C-u),s<=0)return;u+=s,l.DataOffset-=s}}else if(t==ce.OP_LEFT_ZOOM_OUT){var v=this.GetMaxMinPageSize(),S=v.Min;if(c.IsNumber(e.Step)){if(u<S)return;var s=e.Step;if(u-s<S&&(s=u-S),s<=0)return;u-=s,l.DataOffset+=s}}for(var T in this.Frame.SubFrame){var I=this.Frame.SubFrame[T].Frame;I.XPointCount=u}l.DataOffset<0&&(l.DataOffset=0),this.ChartOperator_Temp_Update()}else if(t==ce.OP_RIGHT_ZOOM_IN||t==ce.OP_RIGHT_ZOOM_OUT){var l=this.ChartOperator_Temp_GetHistroyData();if(!l)return;var C=l.Data.length,u=this.Frame.SubFrame[0].Frame.XPointCount,D=l.DataOffset;if(t==ce.OP_RIGHT_ZOOM_IN){if(c.IsNumber(e.Step)){if(u>=C)return;var F=D+u,E=C-F;if(E<=0)return;var s=e.Step;if(s>E&&(s=E),s<=0)return;u+=s}}else if(t==ce.OP_RIGHT_ZOOM_OUT){var v=this.GetMaxMinPageSize(),S=v.Min;if(c.IsNumber(e.Step)){if(u<S)return;var s=e.Step;if(s>u&&(s=u),u-s<S&&(s=u-S),s<=0)return;u-=s}}for(var T in this.Frame.SubFrame){var I=this.Frame.SubFrame[T].Frame;I.XPointCount=u}l.DataOffset<0&&(l.DataOffset=0),this.ChartOperator_Temp_Update()}else if(t==ce.OP_SET_SELECTRECT){if(!this.ChartPaint[0]||!this.ChartPaint[0].Data)return!1;var l=this.ChartOperator_Temp_GetHistroyData();if(!c.IsNonEmptyArray(l.Data))return!1;var M=this.GetRectSelectPaint();if(!M||!k.IsDayPeriod(this.Period,!0))return!1;for(var O,R,b,p,T=0;T<l.Data.length;++T){var I=l.Data[T];if(I.Date==e.Start.Date&&(O={KItem:I,DataIndex:T}),I.Date==e.End.Date&&(R={KItem:I,DataIndex:T}),e.SubClient&&e.SubClient.Start&&I.Date==e.SubClient.Start.Date&&(b={KItem:I,DataIndex:T}),e.SubClient&&e.SubClient.End&&I.Date==e.SubClient.End.Date&&(p={KItem:I,DataIndex:T}),O&&R)break}if(!O||!R)return X.Chart.Warn("[KLineChartContainer::ChartOperator][OP_SET_SELECTRECT] can't find date. firstPoint, secondPoint, obj",O,R,e),!1;M.SetPoint(O.KItem,{Index:0,DataIndex:O.DataIndex}),M.SetPoint(R.KItem,{Index:1,DataIndex:R.DataIndex}),b&&p&&(M.SetPoint(b.KItem,{Index:3,DataIndex:b.DataIndex}),M.SetPoint(p.KItem,{Index:4,DataIndex:p.DataIndex})),c.IsBool(e.PreventClose)&&(M.PreventClose=e.PreventClose);var G=!1,Y=this.ChartPaint[0].DrawKRange;if(Y&&(Y.Start>=O.DataIndex&&Y.Start>=R.DataIndex||Y.End<=O.DataIndex&&Y.End<=R.DataIndex)){var Q=O.DataIndex,C=l.Data.length,u=this.ChartPaint[0].ShowRange.ShowCount;Q+u>C&&(Q=C-u),Q<0&&(Q=0),l.DataOffset=Q,G=!0}return G?this.ChartOperator_Temp_Update():this.Draw(),!0}else if(t==ce.OP_SET_SUB_SELECTRECT){if(!this.ChartPaint[0]||!this.ChartPaint[0].Data)return!1;var l=this.ChartOperator_Temp_GetHistroyData();if(!c.IsNonEmptyArray(l.Data))return!1;var M=this.GetRectSelectPaint();if(!M||!k.IsDayPeriod(this.Period,!0))return!1;for(var O,R,b,p,T=0;T<l.Data.length;++T){var I=l.Data[T];if(I.Date==e.Start.Date&&(O={KItem:I,DataIndex:T}),I.Date==e.End.Date&&(R={KItem:I,DataIndex:T}),O&&R)break}return!O||!R?(X.Chart.Warn("[KLineChartContainer::ChartOperator][OP_SET_SUB_SELECTRECT] can't find date. firstPoint, secondPoint, obj",O,R,e),!1):(M.SetPoint(O.KItem,{Index:3,DataIndex:O.DataIndex}),M.SetPoint(R.KItem,{Index:4,DataIndex:R.DataIndex}),this.Draw(),!0)}else if(t==ce.OP_SCROOLBAR_SLIDER_CHANGED){var l=this.ChartOperator_Temp_GetHistroyData();if(!l)return;if(e.Type==0)l.DataOffset=e.Start.Index,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,this.ChartOperator_Temp_Update();else if(e.Type==1||e.Type==2){e.Start.Index;var u=e.End.Index-e.Start.Index+1,ht=l.Data[e.Start.Index];l.Data[e.End.Index],this.Frame.SetXShowCount(u),l.DataOffset=e.Start.Index,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,this.ChartOperator_Temp_Update()}}else if(t==ce.OP_GOTO){if(!c.IsNumber(e.Date))return;var l=this.ChartOperator_Temp_GetHistroyData();if(!l)return;var f=null;if(k.IsDayPeriod(this.Period,!0))for(var T=0;T<l.Data.length;++T){var I=l.Data[T];if(I.Date>=e.Date){f=T;break}}else if(k.IsMinutePeriod(this.Period,!0)){var Ct=e.Time;if(c.IsPlusNumber(Ct))for(var T=0;T<l.Data.length;++T){var I=l.Data[T];if(I.Date>e.Date||I.Date==e.Date&&I.Time>=Ct){f=T;break}}else for(var T=0;T<l.Data.length;++T){var I=l.Data[T];if(I.Date>=e.Date){f=T;break}}}if(f===null){X.Chart.Log("[KLineChartContainer::ChartOperator] OP_GOTO can't find date="+e.Date+" time="+e.Time);return}var lt=this.Frame.SubFrame[0].Frame.XPointCount,dt=lt;e.PageSize>0&&(dt=e.PageSize),dt!=lt&&this.Frame.SetXShowCount(dt),l.DataOffset=f,this.CursorIndex=0,this.LastPoint.X=null,this.LastPoint.Y=null,this.ChartOperator_Temp_Update()}else if(t==ce.OP_CORSSCURSOR_GOTO){if(!c.IsNumber(e.Date))return;var Ut=c.IsNumber(e.Time),Wt=this.GetChartStatus();if(!Wt)return;var l=this.ChartOperator_Temp_GetHistroyData();if(!l)return;for(var ht=l.DataOffset,Qt=-1,T=ht,ye=0;T<l.Data.length&&ye<Wt.KLine.PageSize;++T,++ye){var I=l.Data[T];if(Ut){if(I.Date==e.Date&&I.Time==e.Time){Qt=ye;break}}else if(I.Date==e.Date){Qt=ye;break}}if(Qt<0)return;if(!this.Frame||!this.Frame.SubFrame[0]||!this.Frame.SubFrame[0].Frame)return!1;var Ne=this.Frame.SubFrame[0].Frame,Kt=Ne.GetXFromIndex(Qt),Oe=Ne.GetYFromData(I.Close),Ce={X:Kt,Y:Oe,IsInClient:this.IsMouseOnClient(Kt,Oe)};this.LastMouseStatus.OnMouseMove=Ce,this.LastMouseStatus.MoveOnPoint={X:Kt,Y:Oe};var na=this.GetEventCallback(et.ON_MOUSE_MOVE),sa=this.TitlePaint[0];na&&sa&&(sa.OnMouseMoveEvent=na);var pa=V(),Fa={};Fa.clientX=Kt/pa+this.UIElement.getBoundingClientRect().left,Fa.clientY=Oe/pa+this.UIElement.getBoundingClientRect().top,this.MoveOnPoint={X:Kt,Y:Oe},this.OnMouseMove(Kt,Oe,Fa),this.LastMouseStatus.MoveOnPoint=null,sa&&(sa.OnMouseMoveEvent=null)}},this.ChartOperator_Temp_GetHistroyData=function(){var e=null;return this.Frame.Data?e=this.Frame.SubFrame[0].Frame.Data:e=this.Frame.Data,e||null},this.ChartOperator_Temp_Update=function(){this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex()},this.OnWheel=function(e){var t=this;if(X.Chart.Log("[KLineChartContainer::OnWheel]",e),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var a=V(),s=(e.clientX-this.UIElement.getBoundingClientRect().left)*a,o=(e.clientY-this.UIElement.getBoundingClientRect().top)*a,h=!1;this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),h=this.Canvas.isPointInPath(s,o);var l=e.wheelDelta;c.IsObjectExist(e.wheelDelta)||(l=e.deltaY*-.01);var u=!0;if(this.EnableZoomUpDown&&this.EnableZoomUpDown.Wheel===!1&&(u=!1),this.SourceData&&this.SourceData.Data){if(h&&l<0&&u){var f={ZoomType:this.ZoomType,IsLockRight:this.IsZoomLockRight};f.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),this.Frame.ZoomDown(f,{ZoomDownloadDataCallback:function(D){t.ZoomDownloadData(D)}})&&(this.CursorIndex=f.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.OnKLinePageChange("wheel"))}else if(h&&l>0&&u){var f={ZoomType:this.ZoomType,IsLockRight:this.IsZoomLockRight};f.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),this.Frame.ZoomUp(f)&&(X.Chart.Log("[KLineChartContainer::OnWheel] cursorIndex ",f),this.CursorIndex=f.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.OnKLinePageChange("wheel"))}}h&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}},this.Create=function(e,t){var a=this;this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new gs,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=ze.Create("CorssCursor_XStringFormat"),this.ChartCorssCursor.StringFormatX.GetEventCallback=function(f){return a.GetEventCallback(f)},this.ChartCorssCursor.StringFormatX.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY=ze.Create("CorssCursor_YStringFormat"),this.ChartCorssCursor.StringFormatY.GetEventCallback=function(f){return a.GetEventCallback(f)},this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY.ExtendChartPaint=this.ExtendChartPaint,this.ChartSplashPaint=new Qa,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.HQChart=this,this.Frame=new yh,this.Frame.ChartBorder=new We,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.Frame.GetExtendChartRightWidth=function(){return a.GetExtendChartRightWidth()},this.Frame.GetExtendChartByClassName=function(f){return a.GetExtendChartByClassName(f)},this.Frame.GetEventCallback=function(f){return a.GetEventCallback(f)},this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(e),this.CreateMainKLine(),this.CreateExtendChart("RectSelectPaint",t?t.SelectRect:null),this.EnableIndexChartDrag&&this.CreateExtendChart("DragMovePaint");for(var s in this.Frame.SubFrame){var o=new za;o.Frame=this.Frame.SubFrame[s].Frame,o.Canvas=this.Canvas,o.LanguageID=this.LanguageID,o.GetEventCallback=function(f){return a.GetEventCallback(f)},o.SelectedChart=this.SelectedChart,this.TitlePaint.push(o)}this.ChartCorssCursor.StringFormatX.Frame=this.Frame.SubFrame[0].Frame,this.ChartCorssCursor.StringFormatY.Frame=this.Frame;var h=!0,l=!0;if(t&&t.Listener){var u=t.Listener;u.KeyDown===!1&&(h=!1,X.Chart.Log("[KLineChartContainer::Create] not register keydown event.")),u.Wheel===!1&&(l=!1,X.Chart.Log("[KLineChartContainer::Create] not register wheel event."))}h&&this.UIElement.addEventListener("keydown",function(f){a.OnKeyDown(f)},!0),l&&this.UIElement.addEventListener("wheel",function(f){a.OnWheel(f)},!0)},this.OnCustomKeyDown=function(e,t){return e==37&&t.ctrlKey?(this.MoveCorssCursorLeft(this.CtrlMoveStep),!0):e==39&&t.ctrlKey?(this.MoveCorssCursorRight(this.CtrlMoveStep),!0):!1},this.MoveCorssCursorLeft=function(e){var t=null;if(this.Frame.Data?t=this.Frame.Data:t=this.Frame.SubFrame[0].Frame.Data,!!t){if(t.DataOffset<=0&&this.CursorIndex<=0){this.DragDownloadData&&this.DragDownloadData();return}if(this.CursorIndex-e<0){t.DataOffset-=e,t.DataOffset<0&&(t.DataOffset=0,this.CursorIndex=0),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("keydown");return}this.CursorIndex-=e,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo(),this.ShowTooltipByKeyDown()}},this.MoveCorssCursorRight=function(e){var t=null;if(this.Frame.Data?t=this.Frame.Data:t=this.Frame.SubFrame[0].Frame.Data,!!t){var a=0;if(this.Frame.XPointCount?a=this.Frame.XPointCount:a=this.Frame.SubFrame[0].Frame.XPointCount,!(this.CursorIndex+t.DataOffset+1>=t.Data.length)){var s=!1;if(this.CursorIndex+e+t.DataOffset+1>t.Data.length&&(e=t.Data.length-1-t.DataOffset-this.CursorIndex,s=!0),this.CursorIndex+e>=a){var o=this.CursorIndex+e-(a-1);t.DataOffset+=o,s&&(this.CursorIndex=a-1),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("keydown");return}this.CursorIndex+=e,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo(),this.ShowTooltipByKeyDown()}}},this.GetKLineChart=function(){return this.ChartPaint[0]?this.ChartPaint[0]:null},this.CreateChildWindow=function(e){for(var t=this,a=this.GetEventCallback(et.ON_CREATE_FRAME),s=0;s<e;++s){var o=new We;o.UIElement=this.UIElement;var h=Oh.Create("KLineFrame",{ID:s});if(h.Canvas=this.Canvas,h.ChartBorder=o,h.Identify=s,h.RightSpaceCount=this.RightSpaceCount,h.GetEventCallback=function(D){return t.GetEventCallback(D)},this.ModifyIndexDialog&&(h.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(h.ChangeIndexEvent=this.ChangeIndexDialog.DoModal),h.HorizontalMax=20,h.HorizontalMin=10,s==0){h.YSplitOperator=new en,h.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price"),h.YSplitOperator.FrameSplitData2=this.FrameSplitData.get("double"),h.YSplitOperator.GetEventCallback=function(D){return t.GetEventCallback(D)},h.YSplitOperator.GetKLineChartCallback=function(){return t.GetKLineChart()},h.YSplitOperator.HQChart=this;var l=V();o.BottomSpace=15*l,o.TopSpace=15*l,h.GetEventCallback=function(D){return t.GetEventCallback(D)}}else h.YSplitOperator=new Pa,h.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),h.YSplitOperator.LanguageID=this.LanguageID,h.YSplitOperator.GetEventCallback=function(D){return t.GetEventCallback(D)},h.YSplitOperator.GetKLineChartCallback=function(){return t.GetKLineChart()},h.YSplitOperator.HQChart=this;h.YSplitOperator.Frame=h,h.YSplitOperator.ChartBorder=o,h.XSplitOperator=new pr,h.XSplitOperator.Frame=h,h.XSplitOperator.ChartBorder=o,h.XSplitOperator.LanguageID=this.LanguageID,h.XSplitOperator.GetEventCallback=function(D){return t.GetEventCallback(D)},s!=e-1&&(h.XSplitOperator.ShowText=!1);for(var u=h.HorizontalMin;u<=h.HorizontalMax;u+=1)h.HorizontalInfo[u]=new Ht,h.HorizontalInfo[u].Value=u,!(s==0&&u==h.HorizontalMin)&&(h.HorizontalInfo[u].Message[1]=u.toString(),h.HorizontalInfo[u].Font="14px 微软雅黑");var f=new dr;if(f.Frame=h,s==0?f.Height=20:f.Height=10,this.Frame.SubFrame[s]=f,a&&a.Callback){var C={SubFrame:this.Frame.SubFrame[s],WindowIndex:s};a.Callback(a,C,this)}}},this.CreateSubFrameItem=function(e){var t=this,a=new We;a.UIElement=this.UIElement;var s=new Tr;s.Canvas=this.Canvas,s.ChartBorder=a,s.Identify=e,s.GetEventCallback=function(C){return t.GetEventCallback(C)},this.ModifyIndexDialog&&(s.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(s.ChangeIndexEvent=this.ChangeIndexDialog.DoModal),s.HorizontalMax=20,s.HorizontalMin=10,s.YSplitOperator=new Pa,s.YSplitOperator.LanguageID=this.LanguageID,s.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),s.YSplitOperator.Frame=s,s.YSplitOperator.ChartBorder=a,s.XSplitOperator=new pr,s.XSplitOperator.Frame=s,s.XSplitOperator.ChartBorder=a,s.XSplitOperator.ShowText=!1,s.YSplitOperator.GetEventCallback=function(C){return t.GetEventCallback(C)},s.YSplitOperator.GetKLineChartCallback=function(){return t.GetKLineChart()},s.YSplitOperator.HQChart=this,s.XSplitOperator.Symbol=this.Symbol,s.XSplitOperator.Period=this.Period;var o=this.Frame.SubFrame[0].Frame.XPointCount;s.XPointCount=o,s.Data=this.ChartPaint[0].Data;for(var h=s.HorizontalMin;h<=s.HorizontalMax;h+=1)s.HorizontalInfo[h]=new Ht,s.HorizontalInfo[h].Value=h,s.HorizontalInfo[h].Message[1]=h.toString(),s.HorizontalInfo[h].Font="14px 微软雅黑";var l=new dr;l.Frame=s,l.Height=10;var u=this.GetEventCallback(et.ON_CREATE_FRAME);if(u&&u.Callback){var f={SubFrame:l,WindowIndex:e};u.Callback(u,f,this)}return l},this.CreateMainKLine=function(){var e=this,t=qn.Create("ChartKLine");t.Canvas=this.Canvas,t.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,t.ChartFrame=this.Frame.SubFrame[0].Frame,t.Name="Main-KLine",t.DrawType=this.KLineDrawType,t.Identify="Main-KLine",t.GetEventCallback=function(a){return e.GetEventCallback(a)},this.ChartPaint[0]=t,this.TitlePaint[0]=new XC,this.TitlePaint[0].Frame=this.Frame.SubFrame[0].Frame,this.TitlePaint[0].Canvas=this.Canvas,this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.TitlePaint[0].LanguageID=this.LanguageID,this.TitlePaint[0].HQChart=this,this.TitlePaint[0].GetEventCallback=function(a){return e.GetEventCallback(a)}},this.BindMainData=function(e,t){if(this.ChartPaint[0].Data=e,this.ChartPaint[0].Symbol=this.Symbol,this.KLineSize)if(this.KLineSize.DataWidth==null)t=this.Frame.SubFrame[0].Frame.XPointCount-this.RightSpaceCount;else{var a=this.Frame.SetDataWidth(this.KLineSize.DataWidth);t=a.XPointCount-this.RightSpaceCount,this.KLineSize.DataWidth=null}for(var s in this.Frame.SubFrame){var o=this.Frame.SubFrame[s].Frame;o.XPointCount=t+this.RightSpaceCount,o.Data=this.ChartPaint[0].Data,o.XSplitOperator.Symbol=this.Symbol,o.XSplitOperator.Period=this.Period}this.TitlePaint[0].Data=this.ChartPaint[0].Data,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=this.Name,this.TitlePaint[0].Period=this.Period,this.ChartCorssCursor.StringFormatX.Data=this.ChartPaint[0].Data,this.Frame.Data=this.ChartPaint[0].Data;for(var s in this.OverlayChartPaint){var o=this.OverlayChartPaint[s];o.MainData=this.ChartPaint[0].Data}var h=e.Data.length-t;h<0&&(h=0),this.ChartPaint[0].Data.DataOffset=h,this.ChartPaint[0].Period=this.Period,this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.CursorIndex=t,this.CursorIndex+h>=e.Data.length&&(this.CursorIndex=e.Data.length-1-h),this.CursorIndex<0&&(this.CursorIndex=0),this.CustomShow&&(this.SetCustomShow(this.CustomShow,e),this.CustomShow=null)},this.UpdateMainData=function(e,t){var a=null;if(this.Frame.Data?this.Frame.SubFrame&&this.Frame.SubFrame[0]&&(a=this.Frame.SubFrame[0].Frame.Data):a=this.Frame.Data,!!a){var s=this.Frame.SubFrame[0].Frame.XPointCount,o=0;t>0&&e.Data.length>t?(o=e.Data.length-t,X.Chart.Log("[KLineChartContainer::UpdateMainData]  [count="+t+"->"+e.Data.length+"], [newDataCount="+o+"], [Pagesize="+s+"]")):t==0&&e.Data.length>s&&(o=e.Data.length-s,X.Chart.Log("[KLineChartContainer::UpdateMainData] history data is empty. [count="+t+"->"+e.Data.length+"], [newDataCount="+o+"], [Pagesize="+s+"]")),this.ChartPaint[0].Data=e,this.ChartPaint[0].Symbol=this.Symbol,e.Data.length>s&&(this.ChartPaint[0].Data.DataOffset=a.DataOffset+o);for(var h in this.Frame.SubFrame){var l=this.Frame.SubFrame[h].Frame;l.Data=this.ChartPaint[0].Data,h==0&&(l.YSplitOperator.Symbol=this.Symbol,l.YSplitOperator.Data=this.ChartPaint[0].Data,l.YSplitOperator.Period=this.Period)}this.TitlePaint[0].Data=this.ChartPaint[0].Data,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=this.Name,this.ChartCorssCursor.StringFormatX.Data=this.ChartPaint[0].Data,this.Frame.Data=this.ChartPaint[0].Data;for(var h in this.OverlayChartPaint){var l=this.OverlayChartPaint[h];l.MainData=this.ChartPaint[0].Data}this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol}},this.SetCustomShow=function(e,t){if(!(!e||!e.Date||e.Date<19910101)){for(var a=e.Date,s=null,o=0;o<t.Data.length;++o){var h=t.Data[o];if(h.Date>=a){s=o;break}}if(s===null){X.Chart.Log("[KLineChartContainer::SetCustomShow] Can't find first date="+a);return}var l=t.Data.length-s;e.PageSize>0&&(l=e.PageSize);var u=l,f=this.GetMaxMinPageSize();l>f.Max?u=f.Max:l<f.Min&&(u=f.Min);for(var o in this.Frame.SubFrame){var h=this.Frame.SubFrame[o].Frame;h.XPointCount=u}this.ChartPaint[0].Data.DataOffset=s,this.CursorIndex=0}},this.OnDragSelectRectMouseUp=function(e){var t=this.GetRectSelectPaint();if(t){var a=t.GetSelectRectData();if(a){var s=V(),o=this.ChartCorssCursor,h=o.LastPoint.X/s,l=o.LastPoint.Y/s,u=!0,f=this.GetEventCallback(et.ON_DRAG_SELECT_RECT_MOUSEUP);if(f){var C={X:h,Y:l,SelectData:a,RectSelectPaint:t,IsShowMenu:!1};f.Callback(f,C,this),u=C.IsShowMenu}u&&this.SelectRectRightMenu&&(e.data={Chart:this,X:h,Y:l,SelectData:a,RectSelectPaint:t},this.SelectRectRightMenu.DoModal(e))}}},this.OnDragSubSelectRectMouseUp=function(e){var t=this.GetRectSelectPaint();if(t){var a=t.GetSelectRectData();if(a){var s=V(),o=this.ChartCorssCursor,h=o.LastPoint.X/s,l=o.LastPoint.Y/s,u=this.GetEventCallback(et.ON_DRAG_SUB_SELECT_RECT_MOUSEUP);if(u){var f={Start:t.SubClient.FirstPoint,End:t.SubClient.SecondPoint},C={X:h,Y:l,SubSelectData:f,RectSelectPaint:t};u.Callback(u,C,this)}}}},this.ShowSelectData=function(e){this.HideSelectRect(),this.SelectRectRightMenu&&this.SelectRectRightMenu.Hide(),X.Chart.Log("[KLineChartContainer::ShowSelectData] selectData",e);var t=e.Start,a=e.End-e.Start+1;X.Chart.Log("[KLineChartContainer::ShowSelectData] DataOffset="+t+", ShowCount="+a);for(var s in this.Frame.SubFrame){var o=this.Frame.SubFrame[s].Frame;o.XPointCount=a}this.ChartPaint[0].Data.DataOffset=t,this.CursorIndex=0,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex()},this.OnMarkRectSelect=function(e){var t=this.ChartCorssCursor;if(!(!t||t.Status==0)&&c.IsNumber(t.CursorIndex)&&!(!this.ChartPaint[0]||!this.ChartPaint[0].Data)){var a=this.GetRectSelectPaint();if(a){var s=t.CursorIndex;X.Chart.Log("[KLineChartContainer::OnMarkRectSelect] dataIndex",s);var o=this.ChartPaint[0].Data;s=parseInt(s.toFixed(0));var h=s+o.DataOffset;h>=o.Data.length&&(h=o.Data.length-1);var l=o.Data[h];if(X.Chart.Log("[KLineChartContainer::OnMarkRectSelect] item",l),!!this.SetRectSelectData(l,h)){var u=a.GetPointCount(),f=V();if(u==1){var C=this.GetEventCallback(et.ON_KEYDOWN_SELECT_RECT_FIRST);if(C&&C.Callback){var D={X:t.LastPoint.X/f,Y:t.LastPoint.Y/f,Item:l,Index:h,RectSelectPaint:a};C.Callback(C,D,this)}}else if(u==2){var v=a.GetSelectRectData(),C=this.GetEventCallback(et.ON_KEYDOWN_SELECT_RECT),S=!0;if(C&&C.Callback){var D={X:t.LastPoint.X/f,Y:t.LastPoint.Y/f,SelectData:v,RectSelectPaint:a,IsShowMenu:!0};C.Callback(C,D,this),S=D.IsShowMenu}S&&this.SelectRectRightMenu&&(e.data={Chart:this,X:t.LastPoint.X/f,Y:t.LastPoint.Y/f,SelectData:v,RectSelectPaint:a},this.SelectRectRightMenu.DoModal(e))}this.Draw()}}}},this.CreateWindowIndex=function(e){this.WindowIndex[e].Create(this,e)},this.BindIndexData=function(e,t,a){if(this.WindowIndex[e]){if(typeof this.WindowIndex[e].RequestData=="function"){this.WindowIndex[e].RequestData(this,e,t,a);return}if(typeof this.WindowIndex[e].ExecuteScript=="function"){this.WindowIndex[e].ExecuteScript(this,e,t);return}this.WindowIndex[e].BindData(this,e,t)}},this.BindOverlayIndexData=function(e,t,a){if(e.Script){if(typeof e.Script.RequestData=="function"){e.Script.RequestData(this,t,a);return}if(typeof e.Script.ExecuteScript=="function"){e.Script.ExecuteScript(this,t,a);return}e.Script.BindData(this,t,a)}},this.BindInstructionIndexData=function(e){this.ColorIndex&&typeof this.ColorIndex.ExecuteScript=="function"&&this.ColorIndex.ExecuteScript(this,0,e),this.TradeIndex&&typeof this.TradeIndex.ExecuteScript=="function"&&this.TradeIndex.ExecuteScript(this,0,e)},this.GetChartPaint=function(e){var t=new Array;for(var a in this.ChartPaint)if(a!=0){var s=this.ChartPaint[a];s.ChartFrame==this.Frame.SubFrame[e].Frame&&t.push(s)}return t},this.AutoUpdateEvent=function(e,t){var a=e?et.RECV_START_AUTOUPDATE:et.RECV_STOP_AUTOUPDATE;if(this.mapEvent.has(a)){var s=this,o=this.mapEvent.get(a),h={Stock:{Symbol:this.Symbol,Name:this.Name,Right:this.Right,Period:this.Period},Explain:t};e&&(h.Callback=function(l){k.IsDayPeriod(s.Period,!0)?s.RecvRealtimeData(l):(k.IsMinutePeriod(s.Period,!0)||k.IsSecondPeriod(s.Period))&&s.RecvMinuteRealtimeData(l)}),o.Callback(o,h,this)}},this.SendKLineUpdateEvent=function(e){var t=this.GetEventCallback(et.RECV_KLINE_UPDATE_DATA);if(t&&t.Callback){var a={HistoryData:e,Stock:{Symbol:this.Symbol,Name:this.Name}};return t.Callback(t,a,this),!0}return!1},this.SendManualKLineUpdateEvent=function(e){var t=this.GetEventCallback(et.RECV_KLINE_MANUAL_UPDATE_DATA);if(t&&t.Callback){var a={HistoryData:e,Stock:{Symbol:this.Symbol,Name:this.Name}};return t.Callback(t,a,this),!0}return!1},this.GetKLineDrawType=function(){return this.KLineDrawType},this.RequestHistoryData=function(){var e=this;if(this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.FlowCapitalReady=!1,this.ResetPage(),this.ResetDragDownload(),this.ResetZoomDownload(),this.Draw(),this.NetworkFilter){var t=this.GetKLineDrawType(),a={Name:"KLineChartContainer::RequestHistoryData",Explain:"日K数据",Request:{Url:e.KLineApiUrl,Type:"POST",Data:{symbol:e.Symbol,count:e.MaxRequestDataCount,field:["name","symbol","yclose","open","price","high","low","vol"],period:this.Period,right:this.Right,klineDrawType:t}},Self:this,PreventDefault:!1};if(this.NetworkFilter(a,function(s){e.ChartSplashPaint.EnableSplash(!1),e.RecvHistoryData(s);var o=e.Page.Day;o.Enable==!0&&o.Finish==!1?e.RequestHistoryPageData():(e.AutoUpdateEvent(!0,"KLineChartContainer::RequestHistoryData"),e.AutoUpdate())}),a.PreventDefault==!0)return}Lt.HttpRequest({url:this.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:e.Symbol,start:-1,count:e.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(o){e.ChartSplashPaint.EnableSplash(!1),e.RecvHistoryData(o);var h=e.Page.Day;h.Enable==!0&&h.Finish==!1?e.RequestHistoryPageData():(e.AutoUpdateEvent(!0,"KLineChartContainer::RequestHistoryData"),e.AutoUpdate())}})},this.BindAllOverlayIndexData=function(e){if(!(!this.Frame||!this.Frame.SubFrame))for(var t=0;t<this.Frame.SubFrame.length;++t){var a=this.Frame.SubFrame[t];for(var s in a.OverlayIndex){var o=a.OverlayIndex[s];this.BindOverlayIndexData(o,t,e)}}},this.RecvHistoryData=function(e){if(this.EnableVerifyRecvData&&e.symbol!=this.Symbol){X.Chart.Warn("[KLineChartContainer::RecvHistoryData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+e.symbol+"]");return}var t=Te.JsonDataToHistoryData(e),a=new k;a.Data=t,a.DataType=0,a.Symbol=e.symbol,this.SourceData=a,this.BeforeBindMainData&&this.BeforeBindMainData("RecvHistoryData");var s=new k;if(s.Data=t,s.Right=this.Right,s.Period=this.Period,s.DataType=0,s.Symbol=e.symbol,s.Right>0&&!this.IsApiPeriod){var o=s.GetRightData(s.Right,{AlgorithmType:this.RightFormula});s.Data=o}if(k.IsDayPeriod(s.Period,!1)&&!this.IsApiPeriod){var h=s.GetPeriodData(s.Period);s.Data=h}var l=this.GetKLineCalulate();if(l){var u=l.RecvHistoryData(s,{Symbol:this.Symbol,Function:"RecvHistoryData"});s=u,this.FlowCapitalReady=!0}this.Symbol=e.symbol,this.Name=e.name,this.BindMainData(s,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("RecvHistoryData"),this.Frame.SetSizeChage(!0);var f;this.Frame.SubFrame[0]&&(f=this.Frame.SubFrame[0].Frame),f&&f.YSplitOperator&&(f.YSplitOperator.Symbol=this.Symbol,f.YSplitOperator.Data=this.ChartPaint[0].Data,f.YSplitOperator.Period=this.Period);var C=this.Page.Day;(C.Enable==!1||C.Enable==!0&&C.Finish==!0)&&(this.ReqeustKLineInfoData({FunctionName:"RecvHistoryData"}),this.RequestFlowCapitalData(),this.RequestOverlayHistoryData(),this.CreateChartDrawPictureByStorage()),C.Enable&&(C.Index=1),this.BindInstructionIndexData(s);for(var D=0;D<this.Frame.SubFrame.length;++D)this.BindIndexData(D,s);if(this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdatePointByCursorIndex(2),this.Draw(),this.BindAllOverlayIndexData(s),this.mapEvent.has(et.RECV_HISTROY_DATA)){var v=this.mapEvent.get(et.RECV_HISTROY_DATA),e={HistoryData:s,Stock:{Symbol:this.Symbol,Name:this.Name}};v.Callback(v,e,this)}},this.RequestHistoryPageData=function(){var e=this;if(this.NetworkFilter){var t=this.SourceData.Data[0],a={Name:"KLineChartContainer::RequestHistoryPageData",Explain:"日K数据分页",Request:{Url:"none",Type:"POST",Data:{symbol:e.Symbol,index:e.Page.Day.Index,field:["name","symbol","yclose","open","price","high","low","vol"],firstDate:t.Date,first:{date:t.Date}}},Page:e.Page.Day,Self:this,PreventDefault:!1};if(this.NetworkFilter(a,function(s){e.RecvHistoryPageData(s);var o=e.Page.Day;o.Enable==!0&&o.Finish==!1?e.RequestHistoryPageData():e.AutoUpdate()}),a.PreventDefault==!0)return}setTimeout(function(){var s=e.Page.Day;s.Finish=!0;var o={data:[[20150218,12.54,12.5,12.74,11.95,12.27,117632441,1459671045],[20150219,12.27,12.1,12.23,11.9,12.23,95889423,1157078548],[20150220,12.23,12.17,12.17,11.9,12.05,67763439,815652761]],symbol:e.Symbol,name:e.Name};e.RecvHistoryPageData(o),s.Enable==!0&&s.Finish==!1?e.RequestHistoryPageData():e.AutoUpdate()},500)},this.RecvHistoryPageData=function(e){if(this.EnableVerifyRecvData&&e.symbol!=this.Symbol){X.Chart.Warn("[KLineChartContainer::RecvHistoryPageData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+e.symbol+"]");return}var t=Te.JsonDataToHistoryData(e),a=this.GetHistoryDataCount();for(var s in t){var o=t[s];this.SourceData.Data.splice(s,0,o)}var h=new k;if(h.Data=this.SourceData.Data,h.Period=this.Period,h.Right=this.Right,h.DataType=this.SourceData.DataType,h.Right>0&&h.Period<=3){var l=h.GetRightData(h.Right,{AlgorithmType:this.RightFormula});h.Data=l}if(k.IsDayPeriod(h.Period,!1)||k.IsMinutePeriod(h.Period,!1)){var u=h.GetPeriodData(h.Period);h.Data=u}this.UpdateMainData(h,a),this.BindInstructionIndexData(h);for(var s=0;s<this.Frame.SubFrame.length;++s)this.BindIndexData(s,h);var f=this.Page.Day;++f.Index,f.Enable==!0&&f.Finish==!0&&(this.RequestFlowCapitalData(),this.RequestOverlayHistoryData(),this.CreateChartDrawPictureByStorage()),this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()},this.ReqeustHistoryMinuteData=function(){var e=this;if(this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.FlowCapitalReady=!1,this.ResetPage(),this.ResetDragDownload(),this.ResetZoomDownload(),this.Draw(),this.NetworkFilter){var t=this.GetKLineDrawType(),a={Name:"KLineChartContainer::ReqeustHistoryMinuteData",Explain:"1分钟K线数据",Request:{Url:e.MinuteKLineApiUrl,Type:"POST",Data:{symbol:e.Symbol,count:e.MaxRequestMinuteDayCount,field:["name","symbol","yclose","open","price","high","low","vol"],period:this.Period,right:this.Right,klineDrawType:t}},Self:this,PreventDefault:!1};if(this.NetworkFilter(a,function(s){e.ChartSplashPaint.EnableSplash(!1),e.RecvMinuteHistoryData(s);var o=e.Page.Minute;o.Enable==!0&&o.Finish==!1?e.ReqeustHistoryMinutePageData():(e.AutoUpdateEvent(!0,"KLineChartContainer::ReqeustHistoryMinuteData"),e.AutoUpdate())}),a.PreventDefault==!0)return}Lt.HttpRequest({url:this.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:e.Symbol,start:-1,count:e.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(o){e.ChartSplashPaint.EnableSplash(!1),e.RecvMinuteHistoryData(o);var h=e.Page.Minute;h.Enable==!0&&h.Finish==!1?e.ReqeustHistoryMinutePageData():(e.AutoUpdateEvent(!0,"KLineChartContainer::ReqeustHistoryMinuteData"),e.AutoUpdate())}})},this.RecvMinuteHistoryData=function(e){if(this.EnableVerifyRecvData&&e.symbol!=this.Symbol){X.Chart.Warn("[KLineChartContainer::RecvMinuteHistoryData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+e.symbol+"]");return}var t=Te.JsonDataToMinuteHistoryData(e),a=new k;a.Data=t,a.DataType=1,a.Symbol=e.symbol,this.SourceData=a,this.BeforeBindMainData&&this.BeforeBindMainData("RecvMinuteHistoryData");var s=new k;if(s.Data=t,s.Right=this.Right,s.Period=this.Period,s.DataType=1,s.Symbol=e.symbol,s.Right>0&&!this.IsApiPeriod&&this.RightFormula>=1){var o=s.GetRightData(s.Right,{AlgorithmType:this.RightFormula});s.Data=o}if(k.IsMinutePeriod(s.Period,!1)&&!this.IsApiPeriod){var h=s.GetPeriodData(s.Period);s.Data=h}var l=this.GetKLineCalulate();if(l){var u=l.RecvHistoryData(s,{Symbol:this.Symbol,Function:"RecvMinuteHistoryData"});s=u,this.FlowCapitalReady=!0}this.Symbol=e.symbol,this.Name=e.name,this.BindMainData(s,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("RecvMinuteHistoryData"),this.Frame.SetSizeChage(!0);var f;this.Frame.SubFrame[0]&&(f=this.Frame.SubFrame[0].Frame),f&&f.YSplitOperator&&(f.YSplitOperator.Symbol=this.Symbol,f.YSplitOperator.Data=this.ChartPaint[0].Data,f.YSplitOperator.Period=this.Period);for(var C in this.OverlayChartPaint){var D=this.OverlayChartPaint[C];D.Data=null}var v=this.Page.Minute;(v.Enable==!1||v.Enable==!0&&v.Finish==!0)&&(this.ReqeustKLineInfoData({FunctionName:"RecvMinuteHistoryData"}),this.RequestFlowCapitalData(),this.RequestOverlayHistoryMinuteData(),this.CreateChartDrawPictureByStorage()),v.Enable&&++v.Index,this.BindInstructionIndexData(s);for(var C=0;C<this.Frame.SubFrame.length;++C)this.BindIndexData(C,s);if(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(2),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.BindAllOverlayIndexData(s),this.mapEvent.has(et.RECV_HISTROY_DATA)){var S=this.mapEvent.get(et.RECV_HISTROY_DATA),e={HistoryData:s,Stock:{Symbol:this.Symbol,Name:this.Name}};S.Callback(S,e,this)}},this.ReqeustHistoryMinutePageData=function(){var e=this;if(this.NetworkFilter){var t=this.SourceData.Data[0],a={Name:"KLineChartContainer::RecvHistoryMinutePageData",Explain:"1分钟K线数据分页",Request:{Url:"none",Type:"POST",Data:{symbol:e.Symbol,index:e.Page.Minute.Index,field:["name","symbol","yclose","open","price","high","low","vol"],firstDate:t.Date,first:{date:t.Date,time:t.Time}}},Page:e.Page.Minute,Self:this,PreventDefault:!1};if(this.NetworkFilter(a,function(s){e.RecvHistoryMinutePageData(s);var o=e.Page.Minute;o.Enable==!0&&o.Finish==!1?e.ReqeustHistoryMinutePageData():e.AutoUpdate()}),a.PreventDefault==!0)return}setTimeout(function(){var s=e.Page.Minute;s.Finish=!0;var o={data:[[20190906,14.58,14.71,14.71,14.71,14.71,1096425,16128411,925],[20190906,14.71,14.73,14.74,14.71,14.71,2154859,31731820,930],[20190906,14.71,14.71,14.71,14.68,14.69,1427516,20989208,931],[20190906,14.69,14.69,14.71,14.68,14.7,1680503,24694143,932],[20190906,14.7,14.69,14.7,14.65,14.65,1315900,19310964,933],[20190906,14.65,14.66,14.69,14.65,14.68,702955,10313842,934],[20190906,14.68,14.7,14.71,14.67,14.67,1735266,25495875,935],[20190906,14.67,14.68,14.7,14.67,14.67,739e3,10845398,936],[20190906,14.67,14.67,14.68,14.67,14.68,389800,5721266,937],[20190906,14.68,14.68,14.7,14.68,14.69,648477,9527859,938],[20190906,14.69,14.7,14.71,14.69,14.7,1128400,16589794,939],[20190906,14.7,14.7,14.71,14.69,14.71,714858,10509708,940],[20190906,14.71,14.71,14.71,14.69,14.69,401500,5900477,941],[20190906,14.69,14.69,14.71,14.69,14.69,1165684,17131034,942],[20190906,14.69,14.69,14.7,14.67,14.67,498516,7321024,943],[20190906,14.67,14.68,14.68,14.67,14.67,350126,5139012,944],[20190906,14.67,14.67,14.69,14.67,14.69,561600,8246789,945]]};e.RecvHistoryMinutePageData(o),s.Enable==!0&&s.Finish==!1?e.ReqeustHistoryMinutePageData():e.AutoUpdate()},500)},this.RecvHistoryMinutePageData=function(e){if(this.EnableVerifyRecvData&&e.symbol!=this.Symbol){X.Chart.Warn("[KLineChartContainer::RecvHistoryMinutePageData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+e.symbol+"]");return}var t=Te.JsonDataToMinuteHistoryData(e),a=this.GetHistoryDataCount();for(var s in t){var o=t[s];this.SourceData.Data.splice(s,0,o)}var h=new k;if(h.Data=this.SourceData.Data,h.Period=this.Period,h.Right=this.Right,h.DataType=this.SourceData.DataType,h.Right>0&&k.IsDayPeriod(h.Period,!1)){var l=h.GetRightData(h.Right,{AlgorithmType:this.RightFormula});h.Data=l}if(k.IsDayPeriod(h.Period,!1)||k.IsMinutePeriod(h.Period,!1)){var u=h.GetPeriodData(h.Period);h.Data=u}this.UpdateMainData(h,a),this.BindInstructionIndexData(h);for(var s=0;s<this.Frame.SubFrame.length;++s)this.BindIndexData(s,h);var f=this.Page.Minute;(f.Enable==!1||f.Enable==!0&&f.Finish==!0)&&(this.RequestFlowCapitalData(),this.CreateChartDrawPictureByStorage()),f.Enable&&++f.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()},this.RequestRealtimeData=function(){var e=this,t=[e.Symbol];for(var a in this.OverlayChartPaint){var s=this.OverlayChartPaint[a];s.Symbol&&s.MainData&&s.Status==Ie.STATUS_FINISHED_ID&&t.push(s.Symbol)}if(this.NetworkFilter){var o=this.GetKLineDrawType(),h={Name:"KLineChartContainer::RequestRealtimeData",Explain:"当天最新日线数据",Request:{Url:e.RealtimeApiUrl,Data:{symbol:t,field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time"],period:this.Period,right:this.Right,klineDrawType:o},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(h,function(l){e.RecvRealtimeData(l),e.AutoUpdate()}),h.PreventDefault==!0)return}Lt.HttpRequest({url:this.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time"],symbol:t,start:-1},type:"post",dataType:"json",async:!0,success:function(u){e.RecvRealtimeData(u),e.AutoUpdate()}})},this.RecvRealtimeData=function(e){if(this.IsOnTouch!=!0){var t=Te.JsonDataToRealtimeData(e,this.Symbol);if(t){var a=this.SourceData.Data[this.SourceData.Data.length-1],s=this.GetHistoryDataCount();if(this.SourceData.Data.length==0){var o=new Rt;Rt.CopyTo(o,t),this.SourceData.Data.push(o)}else if(a.Date==t.Date)X.Chart.Log("[KLineChartContainer::RecvRealtimeData] update kline by realtime data",t),Rt.CopyTo(a,t);else if(a.Date<t.Date){X.Chart.Log("[KLineChartContainer::RecvRealtimeData] insert kline by realtime data",t);var o=new Rt;Rt.CopyTo(o,t),!c.IsNumber(o.YClose)&&this.SourceData.Data.length>0&&(o.YClose=this.SourceData.Data[this.SourceData.Data.length-1].YClose),this.SourceData.Data.push(o)}else{for(var h=!1,l=this.SourceData.Data,u=l.length-1;u>=0;--u){var f=l[u];if(f.Date==t.Date){Rt.CopyTo(f,t),h=!0;break}}if(!h)return}var C=new k;if(C.Data=this.SourceData.Data,C.Period=this.Period,C.Right=this.Right,C.DataType=this.SourceData.DataType,C.Symbol=this.Symbol,C.Right>0&&k.IsDayPeriod(C.Period,!0)&&W.IsSHSZStockA(this.Symbol)&&!this.IsApiPeriod){var D=C.GetRightData(C.Right,{AlgorithmType:this.RightFormula});C.Data=D}if(!this.IsApiPeriod&&(k.IsDayPeriod(C.Period,!1)||k.IsMinutePeriod(C.Period,!1))){var v=C.GetPeriodData(C.Period);C.Data=v}var S=this.GetKLineCalulate();if(S){var T=S.RecvHistoryData(C,{Symbol:this.Symbol,Function:"RecvRealtimeData"});C=T,this.FlowCapitalReady=!0}this.UpdateMainData(C,s),this.UpdateOverlayRealtimeData(e),this.BindInstructionIndexData(C);for(var u=0;u<this.Frame.SubFrame.length;++u)this.BindIndexData(u,C);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendKLineUpdateEvent(C),this.BindAllOverlayIndexData(C)}}},this.UpdateOverlayRealtimeData=function(e){if(c.IsNonEmptyArray(this.OverlayChartPaint))for(var t=0;t<this.OverlayChartPaint.length;++t){var a=this.OverlayChartPaint[t];if(a.Symbol&&a.MainData&&a.Status==Ie.STATUS_FINISHED_ID){var s=Te.JsonDataToRealtimeData(e,a.Symbol);if(s){var o=a.SourceData,h=o.Data[o.Data.length-1];if(h.Date==s.Date)X.Chart.Log("[KLineChartContainer::UpdateOverlayRealtimeData] update kline by minute data",s),h.Close=s.Close,h.High=s.High,h.Low=s.Low,h.Vol=s.Vol,h.Amount=s.Amount;else if(a.Date<s.Date){X.Chart.Log("[KLineChartContainer::UpdateOverlayRealtimeData] insert kline by minute data",s);var l=new Rt;l.YClose=s.YClose,l.Open=s.Open,l.Close=s.Close,l.High=s.High,l.Low=s.Low,l.Vol=s.Vol,l.Amount=s.Amount,l.Date=s.Date,o.Data.push(l)}else continue;var u=new k;if(u.Data=o.Data,u.Period=this.Period,u.Right=this.Right,u.DataType=0,u.Right>0&&W.IsSHSZStockA(e.symbol)&&!this.IsApiPeriod){var f=u.GetRightData(u.Right,{AlgorithmType:this.RightFormula});u.Data=f}var C=this.SourceData.GetOverlayData(u.Data,this.IsApiPeriod);if(u.Data=C,k.IsDayPeriod(u.Period,!1)&&!this.IsApiPeriod){var D=u.GetPeriodData(u.Period);u.Data=D}a.Data=u}}}},this.RequestMinuteRealtimeData=function(){var e=this,t=[e.Symbol];for(var a in this.OverlayChartPaint){var s=this.OverlayChartPaint[a];s.Symbol&&s.MainData&&s.Status==Ie.STATUS_FINISHED_ID&&t.push(s.Symbol)}if(this.NetworkFilter){var o=this.GetKLineDrawType(),h={Name:"KLineChartContainer::RequestMinuteRealtimeData",Explain:"当天1分钟K线数据",Request:{Url:e.RealtimeApiUrl,Data:{symbol:t,field:["name","symbol","price","yclose","minutecount","minute","date","time"],period:this.Period,right:this.Right,klineDrawType:o},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(h,function(l){e.RecvMinuteRealtimeData(l),e.AutoUpdate()}),h.PreventDefault==!0)return}Lt.HttpRequest({url:this.RealtimeApiUrl,data:{field:["name","symbol","price","yclose","minutecount","minute","date","time"],symbol:t,start:-1},type:"post",dataType:"json",async:!0,success:function(u){e.RecvMinuteRealtimeData(u),e.AutoUpdate()}})},this.SetSourceDatatLimit=function(e){this.SourceDataLimit=new Dt.default;for(var t in e){var a=e[t];this.SourceDataLimit.set(a.Period,a.MaxCount),X.Chart.Log("[KLineChartContainer::SetSourceDatatLimit] Period="+a.Period+", MaxCount="+a.MaxCount)}},this.ReduceSourceData=function(){if(this.SourceDataLimit&&this.SourceDataLimit.has(this.Period)){var e=this.SourceDataLimit.get(this.Period),t=null;if(this.Frame.Data?this.Frame.SubFrame&&this.Frame.SubFrame[0]&&(t=this.Frame.SubFrame[0].Frame.Data):t=this.Frame.Data,!!t&&!(e<50)){for(var a=t.DataOffset,s=0;this.SourceData.Data.length>e;)this.SourceData.Data.shift(),--a,++s;s>0&&(a<0&&(a=0),t.DataOffset=a,X.Chart.Log("[KLineChartContainer::ReduceSourceData] remove data "+s+", dataOffset="+a))}}},this.RecvMinuteRealtimeDataV2=function(e){if(this.IsOnTouch!=!0){if(this.EnableVerifyRecvData&&e.symbol!=this.Symbol){X.Chart.Warn("[KLineChartContainer::RecvMinuteRealtimeDataV2] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+e.symbol+"]");return}var t=Te.JsonDataToMinuteHistoryData(e);if(!(!t||t.length<=0)){this.IsApiPeriod&&this.ReduceSourceData();var a=this.GetHistoryDataCount();if(this.SourceData&&this.SourceData.MergeMinuteData(t)){X.Chart.Log("[KLineChartContainer::RecvMinuteRealtimeDataV2] update kline by 1 minute data ["+a+"->"+this.SourceData.Data.length+"]");var s=new k;if(s.Data=this.SourceData.Data,s.Period=this.Period,s.Right=this.Right,s.DataType=this.SourceData.DataType,s.Symbol=this.Symbol,s.Right>0&&!this.IsApiPeriod&&this.RightFormula>=1){var o=s.GetRightData(s.Right,{AlgorithmType:this.RightFormula});s.Data=o}if((k.IsDayPeriod(s.Period,!1)||k.IsMinutePeriod(s.Period,!1))&&!this.IsApiPeriod){var h=s.GetPeriodData(s.Period);s.Data=h}var l=this.GetKLineCalulate();if(l){var u=l.RecvHistoryData(s,{Symbol:this.Symbol,Function:"RecvMinuteRealtimeDataV2"});s=u,this.FlowCapitalReady=!0}this.UpdateMainData(s,a),this.BindInstructionIndexData(s);for(var f=0;f<this.Frame.SubFrame.length;++f)this.BindIndexData(f,s);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendKLineUpdateEvent(s),this.BindAllOverlayIndexData(s)}}}},this.RecvMinuteRealtimeData=function(e){if(this.IsOnTouch!=!0){if(e.ver==2){this.RecvMinuteRealtimeDataV2(e);return}var t=Te.JsonDataToMinuteRealtimeData(e,this.Symbol);if(t){this.IsApiPeriod&&this.ReduceSourceData();var a=this.GetHistoryDataCount(),s=this.SourceData.Data.length;if(this.SourceData.MergeMinuteData(t)){X.Chart.Log("[KLineChartContainer::RecvMinuteRealtimeData] update kline by 1 minute data ["+s+"->"+this.SourceData.Data.length+"]");var o=new k;if(o.Data=this.SourceData.Data,o.Period=this.Period,o.Right=this.Right,o.DataType=this.SourceData.DataType,o.Symbol=this.Symbol,o.Right>0&&!this.IsApiPeriod&&this.RightFormula>=1){var h=o.GetRightData(o.Right,{AlgorithmType:this.RightFormula});o.Data=h}if((k.IsDayPeriod(o.Period,!1)||k.IsMinutePeriod(o.Period,!1))&&!this.IsApiPeriod){var l=o.GetPeriodData(o.Period);o.Data=l}var u=this.GetKLineCalulate();if(u){var f=u.RecvHistoryData(o,{Symbol:this.Symbol,Function:"RecvMinuteRealtimeData"});o=f,this.FlowCapitalReady=!0}this.UpdateMainData(o,a),this.UpdateOverlayMinuteRealtimeData(e),this.BindInstructionIndexData(o);for(var C=0;C<this.Frame.SubFrame.length;++C)this.BindIndexData(C,o);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(1),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.SendKLineUpdateEvent(o),this.BindAllOverlayIndexData(o)}}}},this.UpdateOverlayMinuteRealtimeData=function(e){for(var t in this.OverlayChartPaint){var a=this.OverlayChartPaint[t];if(a.Symbol&&a.MainData&&a.Status==Ie.STATUS_FINISHED_ID){if(e.ver==2)var s=Te.JsonDataToMinuteRealtimeDataV2(e,a.Symbol);else var s=Te.JsonDataToMinuteRealtimeData(e,a.Symbol);if(s){var o=a.SourceData;if(!o.MergeMinuteData(s))return;var h=new k;h.Data=o.Data,h.Period=this.Period,h.Right=this.Right,h.DataType=0;var l=this.SourceData.GetOverlayMinuteData(h.Data,this.IsApiPeriod);if(h.Data=l,k.IsMinutePeriod(h.Period,!1)&&!this.IsApiPeriod){var u=h.GetPeriodData(h.Period);h.Data=u}a.Data=h}}}},this.GetHistoryDataCount=function(){var e=null;if(this.Frame.Data?this.Frame.SubFrame&&this.Frame.SubFrame[0]&&(e=this.Frame.SubFrame[0].Frame.Data):e=this.Frame.Data,!e)return-1;var t=e.Data.length;return t},this.GetRequestDataCount=function(){var e={MaxRequestDataCount:this.MaxRequestDataCount,MaxRequestMinuteDayCount:this.MaxRequestMinuteDayCount};if(!this.SourceData||!this.SourceData.Data||this.SourceData.Data.length<=0)return e;if(k.IsDayPeriod(this.Period,!0)){var t=this.SourceData.Data.length;t>e.MaxRequestDataCount&&(e.MaxRequestDataCount=t)}else if(k.IsMinutePeriod(this.Period,!0)){var a,t=0;for(var s in this.SourceData.Data){var o=this.SourceData.Data[s];o.Date!=a&&++t,a=o.Date}t>e.MaxRequestMinuteDayCount&&(e.MaxRequestMinuteDayCount=t)}return e},this.RequestTickData=function(){var e=this;this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),e.ChartSplashPaint.EnableSplash(!0),e.Draw();var t=m.CacheDomain+"/cache/dealday/today/"+e.Symbol+".json";if(this.NetworkFilter){var a={Name:"KLineChartContainer::RequestTickData",Explain:"当天分笔数据",Request:{Url:t,Data:{symbol:e.Symbol},Type:"GET"},Self:this,PreventDefault:!1};if(this.NetworkFilter(a,function(s){e.ChartSplashPaint.EnableSplash(!1),e.RecvTickData(s),e.AutoUpdate()}),a.PreventDefault==!0)return}Lt.HttpRequest({url:t,data:{symbol:e.Symbol},type:"get",dataType:"json",async:!0,success:function(o){e.ChartSplashPaint.EnableSplash(!1),e.RecvTickData(o),e.AutoUpdate(1)},error:function(o,h){e.ChartSplashPaint.EnableSplash(!1),e.AutoUpdate()}})},this.RecvTickData=function(e){if(e.ver==2)var t=Te.JsonDataToTickDataV2(e);else var t=Te.JsonDataToTickData(e);var a=new k;a.Data=t,a.DataType=2,this.SourceData=a,this.BeforeBindMainData&&this.BeforeBindMainData("RecvTickData");var s=new k;s.Data=t,s.Right=this.Right,s.Period=this.Period,s.DataType=2,this.Symbol=e.symbol,this.Name=e.name,this.BindMainData(s,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("RecvTickData"),this.BindInstructionIndexData(s);for(var o,h=0;h<this.Frame.SubFrame.length;++h)h==0&&(o=this.Frame.SubFrame[h].Frame),this.BindIndexData(h,s);if(o&&o.YSplitOperator&&(o.YSplitOperator.Symbol=this.Symbol,o.YSplitOperator.Data=this.ChartPaint[0].Data,o.YSplitOperator.Period=this.Period,o.YSplitOperator.KLineChart=this.ChartPaint[0]),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex(),this.BindAllOverlayIndexData(s),this.mapEvent.has(et.RECV_HISTROY_DATA)){var l=this.mapEvent.get(et.RECV_HISTROY_DATA),e={HistoryData:s,Stock:{Symbol:this.Symbol,Name:this.Name}};l.Callback(l,e,this)}},this.RequestTickRealtimeData=function(){var e=this,t=0;if(this.SourceData&&this.SourceData.Data&&(t=this.SourceData.Data.length),this.NetworkFilter){var a={Name:"KLineChartContainer::RequestTickRealtimeData",Explain:"当天最新分笔数据",Request:{Url:e.TickApiUrl,Data:{symbol:e.Symbol,start:t,end:t+1e3},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(a,function(s){e.ChartSplashPaint.EnableSplash(!1),e.RecvTickRealtimeData(s),e.AutoUpdate()}),a.PreventDefault==!0)return}Lt.HttpRequest({url:e.TickApiUrl,data:{symbol:e.Symbol,start:t-10,end:t+1e3},type:"post",dataType:"json",async:!0,success:function(o){e.ChartSplashPaint.EnableSplash(!1),e.RecvTickRealtimeData(o),e.AutoUpdate()}})},this.RecvTickRealtimeData=function(e){if(e.ver==2)var t=Te.JsonDataToTickDataV2(e);else var t=Te.JsonDataToTickData(e);if(!(!t||t.length<=0)){var a=!1;e.redraw==!0&&(a=!0);var s=this.SourceData.Data,o=this.SourceData.Data.length,h=0;s.length>0&&(h=s[s.length-1].Time);var l=0;for(var u in t){var f=t[u];f.Time<=h||(s.push(f),++l)}if(!(l<=0&&a==!1)){var C=new k;C.Data=s,C.Right=this.Right,C.Period=this.Period,C.DataType=2,this.Symbol=e.symbol,this.Name=e.name,this.UpdateMainData(C,o),this.BindInstructionIndexData(C);for(var u=0;u<this.Frame.SubFrame.length;++u)this.BindIndexData(u,C);this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.UpdatePointByCursorIndex(),this.BindAllOverlayIndexData(C)}}},this.ClearIndexPaint=function(){if(this.Frame&&this.Frame.SubFrame)for(var e=0;e<this.Frame.SubFrame.length;++e){this.DeleteIndexPaint(e,!0);var t=this.Frame.SubFrame[e];if(c.IsNonEmptyArray(t.OverlayIndex))for(var a=0;a<t.OverlayIndex.length;++a){for(var s=t.OverlayIndex[a],o=0;o<s.ChartPaint.length;++o){var h=s.ChartPaint[o];h&&h.OnDestroy&&h.OnDestroy()}s.ChartPaint=[]}}for(var e=1;e<this.TitlePaint.length;++e){var t=this.TitlePaint[e];t.OverlayIndex=new Dt.default}},this.ChangePeriod=function(e,t){var a={Period:this.Period,Right:this.Right,KLineDrawType:this.KLineDrawType},s=!1,o=!1,h=null;if(t&&(t.KLine&&(c.IsNumber(t.KLine.DrawType)&&(s=!0),c.IsNumber(t.KLine.Right)&&(h=t.KLine.Right)),t.Reload==!0&&(o=!0)),this.Period==e&&o==!1){s&&this.ChangeKLineDrawType(t.KLine.DrawType);return}s&&this.ChangeKLineDrawType(t.KLine.DrawType,!1);var l=!0;if(this.SourceData){var l=!1;if(e>Ir&&e<=Is)this.SourceData.DataType!=0&&(l=!0);else if(e>fi&&e<=cr||e>$n&&e<=wh)(this.SourceData.DataType!=1||k.IsSecondPeriod(e))&&(l=!0);else switch(e){case 0:case 1:case 2:case 3:case 9:case 21:this.SourceData.DataType!=0&&(l=!0);break;case 4:case 5:case 6:case 7:case 8:case 11:case 12:this.SourceData.DataType!=1&&(l=!0);break;case 10:this.SourceData.DataType!=2&&(l=!0);break}}this.Period=e,h!=null&&(this.Right=h),this.ReloadChartDrawPicture(),this.ClearRectSelect(!0),this.Frame.ClearUpDonwFrameYData(),this.ClearCustomKLine();var u=this.GetKLineDrawType();(u==10||u==11||u==12||u==16)&&(l=!0);var f=this.GetEventCallback(et.ON_CHANGE_KLINE_PERIOD);if(f&&f.Callback){var C={IsApiPeriod:this.IsApiPeriod,Old:a,Now:{Period:this.Period,Right:this.Right,KLineDrawType:this.KLineDrawType},IsDataTypeChange:l};f.Callback(f,C,this),l=C.IsDataTypeChange}if(l==!1&&!this.IsApiPeriod){this.Update({UpdateCursorIndexType:2});return}this.ClearIndexPaint(),k.IsDayPeriod(this.Period,!0)?(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangePeriod"),this.ResetScrollBar(),this.ResetOverlaySymbolStatus(),this.RequestHistoryData()):k.IsMinutePeriod(this.Period,!0)||k.IsSecondPeriod(this.Period)?(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangePeriod"),this.ResetScrollBar(),this.ResetOverlaySymbolStatus(),this.ReqeustHistoryMinuteData()):k.IsTickPeriod(this.Period)&&(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangePeriod"),this.ResetScrollBar(),this.RequestTickData())},this.ChangeRight=function(e){if(W.IsEnableRight(this.Period,this.Symbol,this.RightFormula)){var t=this.Symbol.toUpperCase();if(!W.IsBIT(t)&&!(e<0||e>2)&&this.Right!=e)if(this.Right=e,this.IsApiPeriod)k.IsDayPeriod(this.Period,!0)?(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeRight"),this.ClearIndexPaint(),this.ResetOverlaySymbolStatus(),this.ResetScrollBar(),this.RequestHistoryData()):(k.IsMinutePeriod(this.Period,!0)||k.IsSecondPeriod(this.Period))&&(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeRight"),this.ClearIndexPaint(),this.ResetOverlaySymbolStatus(),this.ResetScrollBar(),this.ReqeustHistoryMinuteData());else{this.Update();return}}},this.SetFirstShowDate=function(e){if(!(!e||!e.Date)){var t={ID:ce.OP_GOTO,Date:e.Date};c.IsNumber(e.Time)&&(t.Time=e.Time),c.IsNumber(e.PageSize)&&(t.PageSize=e.PageSize),this.ChartOperator(t)}},this.DeleteIndexPaint=function(e,t){var a=new Array;for(var s in this.ChartPaint){var o=this.ChartPaint[s];s==0||o.ChartFrame!=this.Frame.SubFrame[e].Frame?a.push(o):t===!0&&o&&o.OnDestroy&&o.OnDestroy()}var h=this.Frame.SubFrame[e].Frame;h.YSpecificMaxMin=null,h.IsLocked=!1,h.YSplitScale=null,h.YSplitOperator.SplitType=h.YSplitOperator.DefaultSplitType,this.ChartPaint=a;var l=e+1;this.TitlePaint[l].Data=[],this.TitlePaint[l].Title=null},this.ShowKLine=function(e){this.ChartPaint.length<=0||!this.ChartPaint[0]||(this.ChartPaint[0].IsShow=e)},this.SetInstructionData=function(e,t){if(!(this.ChartPaint.length<=0||!this.ChartPaint[0])){var a=this.TitlePaint[1];e==2?(this.ChartPaint[0].ColorData=t.Data,a&&(a.ColorIndex={Name:t.Name,Param:t.Param})):e==1&&(this.ChartPaint[0].TradeData={Sell:t.Sell,Buy:t.Buy,Name:t.Name,Param:t.Param},a&&(a.TradeIndex={Name:t.Name,Param:t.Param}))}},this.ChangeInstructionIndex=function(e,t){var a=new J,s=a.Get(e);s&&(s.InstructionType!=1&&s.InstructionType!=2||(t&&t.Args&&(s.Args=t.Args),s.ID=e,this.ChangeInstructionScriptIndex(s)))},this.ChangeInstructionScriptIndex=function(e){if(e.InstructionType==1)this.TradeIndex=new de(e.Name,e.Script,e.Args,e);else if(e.InstructionType==2)this.ColorIndex=new de(e.Name,e.Script,e.Args,e);else return;var t=this.ChartPaint[0].Data;this.BindInstructionIndexData(t),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.CancelInstructionIndex=function(){if(!(this.ChartPaint.length<=0||!this.ChartPaint[0])){this.ColorIndex=null,this.TradeIndex=null,this.ChartPaint[0].ColorData=null,this.ChartPaint[0].TradeData=null;var e=this.TitlePaint[1];e&&(e.TradeIndex=null,e.ColorIndex=null),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.SetFrameToolbar=function(e,t){if(!(!t||!this.Frame.SubFrame[e]||!this.Frame.SubFrame[e].Frame)){var a=this.Frame.SubFrame[e].Frame,s=!1;c.IsBool(t.Modify)&&(a.ModifyIndex=t.Modify,s=!0),c.IsBool(t.Change)&&(a.ChangeIndex=t.Change,s=!0),c.IsBool(t.Close)&&(a.CloseIndex=t.Close,s=!0),c.IsBool(t.Overlay)&&(a.OverlayIndex=t.Overlay,s=!0),s&&(a.SizeChange=!0,a.ToolbarRect=null,a.DrawToolbar())}},this.ChangeScriptIndex=function(e,t,a){this.DeleteIndexPaint(e,!0),this.WindowIndex[e]=new de(t.Name,t.Script,t.Args,t),a&&a.Window&&this.SetFrameToolbar(e,a.Window),this.Frame.ClearUpDonwFrameYData({Index:e});var s=this.ChartPaint[0].Data;this.BindIndexData(e,s),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.OnKLinePageChange=function(e){if(this.ChartPaint[0]){for(var t=this.ChartPaint[0].Data,a=0;a<this.WindowIndex.length;++a){var s=this.WindowIndex[a];s&&s.IsUsePageData===!0&&this.BindIndexData(a,t,{Type:1})}for(var a=0;a<this.Frame.SubFrame.length;++a)for(var s=this.Frame.SubFrame[a],o=0;o<s.OverlayIndex.length;++o){var h=s.OverlayIndex[o];h&&h.Script&&h.Script.IsUsePageData==!0&&this.BindOverlayIndexData(h,a,t)}}},this.ChangeAPIIndex=function(e,t){this.DeleteIndexPaint(e,!0);var a=t.API;this.WindowIndex[e]=new Ma(a.Name,a.Script,a.Args,t),t&&t.Window&&this.SetFrameToolbar(e,t.Window),this.Frame.ClearUpDonwFrameYData({Index:e});var s=this.ChartPaint[0].Data;this.BindIndexData(e,s),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangeIndex=function(e,t,a){if(a&&a.API)return this.ChangeAPIIndex(e,a);var s=Ja.Get(t);if(!s){var o=new J,h=o.Get(t);if(!h)return;h.IsMainIndex?e=0:e==0&&(e=1);var l=h;return a&&(a.FloatPrecision>=0&&(l.FloatPrecision=a.FloatPrecision),a.StringFormat>0&&(l.StringFormat=a.StringFormat),a.Args&&(l.Args=a.Args),a.TitleFont&&(l.TitleFont=a.TitleFont),a.IsShortTitle&&(l.IsShortTitle=a.IsShortTitle),a.Lock&&(l.Lock=a.Lock)),this.ChangeScriptIndex(e,l,a)}s.IsMainIndex?e>0&&(e=0):e==0&&(e=1);var u=new Array;for(var f in this.ChartPaint){var C=this.ChartPaint[f];(f==0||C.ChartFrame!=this.Frame.SubFrame[e].Frame)&&u.push(C)}this.Frame.SubFrame[e].Frame.YSpecificMaxMin=null,this.Frame.SubFrame[e].Frame.IsLocked=!1,this.Frame.SubFrame[e].Frame.YSplitScale=null,this.ChartPaint=u;var D=e+1;this.TitlePaint[D].Data=[],this.TitlePaint[D].Title=null,this.WindowIndex[e]=s.Create(a),this.CreateWindowIndex(e);var v=this.ChartPaint[0].Data;this.BindIndexData(e,v),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangePyScriptIndex=function(e,t){this.DeleteIndexPaint(e),this.WindowIndex[e]=new Jh(t.Name,t.Script,t.Args);var a=this.ChartPaint[0].Data;this.BindIndexData(e,a),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.AddOverlayIndex=function(e){var t=this.CreateOverlayWindowsIndex(e);if(t){var a=this.ChartPaint[0].Data;this.BindOverlayIndexData(t,e.WindowIndex,a),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.CreateOverlayWindowsIndex=function(e){var t=this,a=e.IndexName,s=e.WindowIndex,o=null,h=null,l=null;if(e.API)o=e.API;else if(e.Script)h={Script:e.Script,ID:e.indexName,Name:e.indexName},e.Name&&(h.Name=e.Name);else{var u=new J;if(h=u.Get(a),!h&&(l=Ja.Get(a),!l))return console.warn("[KLineChartContainer::CreateOverlayIndex] can not find index["+a+"]"),null}var f=this.Frame.SubFrame[s];f.Interval=this.OverlayIndexFrameWidth;var C=new Qn;e.Identify&&(C.Identify=e.Identify);var D=this.ClassName==="KLineChartHScreenContainer"?new uC:new lC;if(D.Canvas=this.Canvas,D.MainFrame=f.Frame,D.ChartBorder=f.Frame.ChartBorder,D.GetEventCallback=function(E){return t.GetEventCallback(E)},e.ShowRightText===!0?D.IsShow=!0:e.ShowRightText===!1&&(D.IsShow=!1),c.IsBool(e.ShowToolbar)&&(D.IsShowToolbar=e.ShowToolbar),c.IsBool(e.IsShareY)&&(D.IsShareY=e.IsShareY),c.IsBool(e.IsShowIndexTitle)&&(D.IsShowIndexTitle=e.IsShowIndexTitle),c.IsBool(e.IsCalculateYMaxMin)&&(D.IsCalculateYMaxMin=e.IsCalculateYMaxMin),D.YSplitOperator=new Pa,D.YSplitOperator.LanguageID=this.LanguageID,D.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),D.YSplitOperator.Frame=D,D.YSplitOperator.ChartBorder=D.ChartBorder,D.YSplitOperator.SplitCount=f.Frame.YSplitOperator.SplitCount,D.YSplitOperator.GetEventCallback=function(E){return t.GetEventCallback(E)},D.YSplitOperator.GetKLineChartCallback=function(){return t.GetKLineChart()},D.YSplitOperator.OverlayIndex=C,D.YSplitOperator.HQChart=this,D.YSplitOperator.OverlayIdentify=C.Identify,e.Frame){var v=e.Frame;v.Custom&&(D.YSplitOperator.Custom=v.Custom),c.IsBool(v.IsYDrawMainFrame)&&(D.IsYDrawMainFrame=v.IsYDrawMainFrame),c.IsBool(v.IsShowToolbar)&&(D.IsShowToolbar=v.IsShowToolbar)}if(C.Frame=D,o){var S=new Ma(o.Name,o.Script,o.Args,e,!0);S.OverlayIndex={IsOverlay:!0,Identify:C.Identify,WindowIndex:s,Frame:C},C.Script=S}else if(h){var T=h.Args;e.Args&&(T=e.Args);var I={Name:h.Name,Script:h.Script,Args:T,ID:a,KLineType:h.KLineType,YSpecificMaxMin:h.YSpecificMaxMin,YSplitScale:h.YSplitScale,FloatPrecision:h.FloatPrecision,Condition:h.Condition,OutName:h.OutName};c.IsNumber(e.FloatPrecision)&&(I.FloatPrecision=e.FloatPrecision);var F=new rn(I.Name,I.Script,I.Args,I);F.OverlayIndex={IsOverlay:!0,Identify:C.Identify,WindowIndex:s,Frame:C},C.Script=F}else{var F=l.Create();F.OverlayIndex={IsOverlay:!0,Identify:C.Identify,WindowIndex:s,Frame:C},F.Create(this,s),C.Script=F}return f.OverlayIndex.push(C),C},this.DeleteOverlayWindowsIndex=function(e){this.DeleteOverlayIndex(e,null)&&(this.Frame.ResetXYSplit(!0),this.Draw())},this.ChangeKLineDrawType=function(e,t,a){if(!(this.KLineDrawType==e&&!a)){var s=this.KLineDrawType;this.KLineDrawType=e;var o=new Ee.default([5,7,8,10,11,12]);if(o.has(s)||o.has(e)){var h=this.ChartPaint[0];h&&(h.DrawType=this.KLineDrawType),this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeKLineDrawType"),k.IsDayPeriod(this.Period,!0)?(this.ResetOverlaySymbolStatus(),this.RequestHistoryData()):(k.IsMinutePeriod(this.Period,!0)||k.IsSecondPeriod(this.Period))&&(this.ResetOverlaySymbolStatus(),this.ReqeustHistoryMinuteData());return}for(var l=0;l<this.ChartPaint.length;++l){var u=this.ChartPaint[l];l==0?(u.DrawType=this.KLineDrawType,a&&c.IsBool(a.IsThinAKBar)&&(u.IsThinAKBar=a.IsThinAKBar)):u.ClassName=="ChartVolStick"&&(u.KLineDrawType=this.KLineDrawType)}for(var l in this.OverlayChartPaint){var u=this.OverlayChartPaint[l];u.DrawType=this.KLineDrawType}t!=!1&&(this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw())}},this.ChangeCoordinateType=function(e){if(!(!this.Frame&&!this.Frame.SubFrame)&&this.Frame.SubFrame.length){if(c.IsNumber(e)){var t=e;if(t==2)this.Frame.SubFrame[0].Frame.CoordinateType=1;else if(t==1)this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=t;else if(t==0)this.Frame.SubFrame[0].Frame.CoordinateType=0,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=0;else if(t==3)this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=2;else return}else e.Type>=0&&e.Type<=5&&(this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=e.Type),e.IsReverse===!0?this.Frame.SubFrame[0].Frame.CoordinateType=1:e.IsReverse==!1&&(this.Frame.SubFrame[0].Frame.CoordinateType=0);this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.ChangeIndexWindowCount=function(e,t){var a=this;if(!(e<=0)&&this.Frame.SubFrame.length!=e){this.Frame.RestoreIndexWindows();var s=this.Frame.SubFrame.length;if(s>e){for(var o=this.GetEventCallback(et.ON_DELETE_FRAME),h=s-1;h>=e;--h)if(this.DeleteIndexPaint(h),this.Frame.SubFrame[h].Frame.ClearToolbar(),o&&o.Callback){var l={SubFrame:this.Frame.SubFrame[h],WindowIndex:h};o.Callback(o,l,this)}this.Frame.SubFrame.splice(e,s-e),this.WindowIndex.splice(e,s-e);for(var h=0;h<this.Frame.SubFrame.length;++h){var u=this.Frame.SubFrame[h].Frame;h==this.Frame.SubFrame.length-1?u.XSplitOperator.ShowText=!0:u.XSplitOperator.ShowText=!1}this.Frame.SetSizeChage(!0),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()}else{for(var f=V(),h=s;h<e;++h){var C=this.CreateSubFrameItem(h);C.Frame.ChartBorder.TitleHeight*=f,this.Frame.SubFrame[h]=C;var D=new za;D.Frame=this.Frame.SubFrame[h].Frame,D.Canvas=this.Canvas,D.LanguageID=this.LanguageID,D.GetEventCallback=function(R){return a.GetEventCallback(R)},D.SelectedChart=this.SelectedChart,this.TitlePaint[h+1]=D}for(var h=0;h<this.Frame.SubFrame.length;++h){var u=this.Frame.SubFrame[h].Frame;h==this.Frame.SubFrame.length-1?u.XSplitOperator.ShowText=!0:u.XSplitOperator.ShowText=!1}this.Frame.SetSizeChage(!0),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw();var v=[{Index:"RSI"},{Index:"MACD"},{Index:"VOL"},{Index:"UOS"},{Index:"CHO"},{Index:"BRAR"}];t&&t.Windows.length>0&&(v=t.Windows);for(var S=new J,h=s;h<e;++h){var u=v[h%v.length],T=u.Index,I=S.Get(T),F=I.Args;u.Args&&(F=u.Args);var E={Name:I.Name,Script:I.Script,Args:F,ID:u.Index,KLineType:I.KLineType,YSpecificMaxMin:I.YSpecificMaxMin,YSplitScale:I.YSplitScale,FloatPrecision:I.FloatPrecision,Condition:I.Condition,OutName:I.OutName};this.WindowIndex[h]=new de(E.Name,E.Script,E.Args,E);var C=this.Frame.SubFrame[h];u.Modify!=null&&(this.Frame.SubFrame[h].Frame.ModifyIndex=u.Modify),u.Change!=null&&(this.Frame.SubFrame[h].Frame.ChangeIndex=u.Change),u.Close!=null&&(this.Frame.SubFrame[h].Frame.CloseIndex=u.Close),u.Overlay!=null&&(chart.Frame.SubFrame[h].Frame.OverlayIndex=u.Overlay),u.IsDrawTitleBG==!0&&(this.Frame.SubFrame[h].Frame.IsDrawTitleBG=u.IsDrawTitleBG),c.IsBool(u.IsShowNameArrow)&&(this.Frame.SubFrame[h].Frame.IsShowNameArrow=u.IsShowNameArrow),c.IsNumber(u.TitleHeight)?this.Frame.SubFrame[h].Frame.ChartBorder.TitleHeight=u.TitleHeight:u.TitleHeight=this.Frame.SubFrame[h].Frame.ChartBorder.TitleHeight,u.IsShowTitleArraw==!1&&(this.Frame.SubFrame[h].Frame.IsShowTitleArraw=!1),u.IsShowIndexName==!1&&(this.Frame.SubFrame[h].Frame.IsShowIndexName=!1),u.IsShowOverlayIndexName==!1&&(this.Frame.SubFrame[h].Frame.IsShowOverlayIndexName=!1),c.IsNumber(u.IndexParamSpace)&&(this.Frame.SubFrame[h].Frame.IndexParamSpace=u.IndexParamSpace),c.IsNumber(u.IndexTitleSpace)&&(this.Frame.SubFrame[h].Frame.IndexTitleSpace=u.IndexTitleSpace),u.IsShowXLine==!1&&(this.Frame.SubFrame[h].Frame.IsShowXLine=!1),u.IsShowYLine==!1&&(this.Frame.SubFrame[h].Frame.IsShowYLine=!1),c.IsBool(u.IsShowIndexTitle)&&(this.Frame.SubFrame[h].Frame.IsShowIndexTitle=u.IsShowIndexTitle),c.IsBool(u.IsShowLeftText)&&(C.Frame.IsShowYText[0]=u.IsShowLeftText,C.Frame.YSplitOperator.IsShowLeftText=u.IsShowLeftText),c.IsBool(u.IsShowRightText)&&(C.Frame.IsShowYText[1]=u.IsShowRightText,C.Frame.YSplitOperator.IsShowRightText=u.IsShowRightText),u.OverlayIndexType&&(c.IsNumber(u.OverlayIndexType.Position)&&(C.Frame.OverlayIndexType.Position=u.OverlayIndexType.Position),c.IsNumber(u.OverlayIndexType.LineSpace)&&(C.Frame.OverlayIndexType.LineSpace=u.OverlayIndexType.LineSpace));var M=this.ChartPaint[0].Data;this.BindIndexData(h,M)}}}},this.ChangeIndexTemplate=function(e){var t=this;if(e.Windows){var a=e.Windows.length;if(!(a<=0)){var s=this.Frame.SubFrame.length,o=null,h=null;e.KLine&&(c.IsNumber(e.KLine.Period)&&e.KLine.Period!=this.Period&&(o=e.KLine.Period),c.IsNumber(e.KLine.Right)&&e.KLine.Right!=this.Right&&(h=e.KLine.Right));for(var l=o!=null||h!=null,u=0;u<s;++u){this.DeleteIndexPaint(u);var f=this.Frame.SubFrame[u];f.YSpecificMaxMin=null,f.IsLocked=!1,f.YSplitScale=null}if(s>a){for(var C=this.GetEventCallback(et.ON_DELETE_FRAME),u=s-1;u>=a;--u)if(this.Frame.SubFrame[u].Frame.ClearToolbar(),C&&C.Callback){var D={SubFrame:this.Frame.SubFrame[u],WindowIndex:u};C.Callback(C,D,this)}this.Frame.SubFrame.splice(a,s-a),this.WindowIndex.splice(a,s-a)}else for(var u=s;u<a;++u){var v=this.CreateSubFrameItem(u);this.Frame.SubFrame[u]=v;var S=new za;S.Frame=this.Frame.SubFrame[u].Frame,S.Canvas=this.Canvas,S.LanguageID=this.LanguageID,S.GetEventCallback=function(Ct){return t.GetEventCallback(Ct)},S.SelectedChart=this.SelectedChart,this.TitlePaint[u+1]=S}for(var T=new J,u=0;u<a;++u){var I=u,F=e.Windows[u],E=null;e.Frame&&e.Frame.length>u&&(E=e.Frame[u]);var M=I+1;if(this.TitlePaint[M].Data=[],this.TitlePaint[M].Title=null,F.Script)this.WindowIndex[u]=new de(F.Name,F.Script,F.Args,F);else if(F.API){var O=F.API;this.WindowIndex[I]=new Ma(O.Name,O.Script,O.Args,F)}else{var R=F.Index,b=Ja.Get(R);if(b)this.WindowIndex[u]=b.Create(),this.CreateWindowIndex(I);else{var p=T.Get(R);if(p){var G=p.Args;e.Windows[u].Args&&(G=e.Windows[u].Args);var Y={Name:p.Name,Script:p.Script,Args:G,ID:R,KLineType:p.KLineType,YSpecificMaxMin:p.YSpecificMaxMin,YSplitScale:p.YSplitScale,FloatPrecision:p.FloatPrecision,Condition:p.Condition,OutName:p.OutName};F.TitleFont&&(Y.TitleFont=F.TitleFont),this.WindowIndex[u]=new de(Y.Name,Y.Script,Y.Args,Y)}}}this.SetSubFrameAttribute(this.Frame.SubFrame[u],F,E)}for(var u=0;u<this.Frame.SubFrame.length;++u){var F=this.Frame.SubFrame[u].Frame;u==this.Frame.SubFrame.length-1?F.XSplitOperator.ShowText=!0:F.XSplitOperator.ShowText=!1}if(l)this.Frame.SetSizeChage(!0),o!=null?this.ChangePeriod(o,e):h!=null&&this.ChangeRight(h);else{for(var Q=this.ChartPaint[0].Data,u=0;u<a;++u)this.BindIndexData(u,Q);this.UpdataDataoffset(),this.Frame.SetSizeChage(!0),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()}}}},this.RemoveIndexWindow=function(e,t){if(X.Chart.Log("[KLineChartContainer::RemoveIndexWindow] remove id",e),e==0){t&&t.DeleteMainIndex&&(this.DeleteIndexPaint(e),this.WindowIndex[e]=null,this.Frame.SetSizeChage(!0),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw());return}if(this.Frame.SubFrame&&!(e>=this.Frame.SubFrame.length)){this.Frame.RestoreIndexWindows();var a=this.Frame.SubFrame[e].Frame;this.DeleteIndexPaint(e),this.Frame.SubFrame[e].Frame.ClearToolbar();var s=this.GetEventCallback(et.ON_DELETE_FRAME);if(s&&s.Callback){var o={SubFrame:this.Frame.SubFrame[e],WindowIndex:e};s.Callback(s,o,this)}this.Frame.SubFrame.splice(e,1),this.WindowIndex.splice(e,1),this.TitlePaint.splice(e+1,1);for(var h=0;h<this.Frame.SubFrame.length;++h){var l=this.Frame.SubFrame[h].Frame;h==this.Frame.SubFrame.length-1?l.XSplitOperator.ShowText=!0:l.XSplitOperator.ShowText=!1,l.Identify=h}if(this.ChartDrawPicture.length>0){var u=[];for(var h in this.ChartDrawPicture){var l=this.ChartDrawPicture[h];l.Frame!=a&&u.push(l)}this.ChartDrawPicture=u}this.Frame.SetSizeChage(!0),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()}},this.GetIndexInfo=function(){var e=[];for(var t in this.WindowIndex){var a=this.WindowIndex[t],s={Name:a.Name};if(a.ID&&(s.ID=a.ID),a.Arguments){s.Args=[];for(var t in a.Arguments){var o=a.Arguments[t];s.Args.push({Name:o.Name,Value:o.Value})}}e.push(s)}return e},this.CreateExtendChart=function(e,t){var a;switch(e){case"筹码分布":return a=new Id,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.Left=this.Frame.ChartBorder.Right,a.SetOption(t),this.ExtendChartPaint.push(a),this.Frame.ChartBorder.Right+=a.Width,a;case"画图工具":return a=new BC,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.Left=this.Frame.ChartBorder.Right,a.SetOption(t),this.ExtendChartPaint.push(a),this.Frame.ChartBorder.Right+=a.Width,a;case"KLineTooltip":return t.Create&&typeof t.Create=="function"?a=t.Create():a=new Yh,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,t.LanguageID=this.LanguageID,a.SetOption(t),this.ExtendChartPaint.push(a),a;case"深度图":return a=new pd,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.SetOption(t),this.ExtendChartPaint.push(a),a;case"K线Y轴背景图":return a=new Fd,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.SetOption(t),this.ExtendChartPaint.push(a),a;case"背景图":return a=new Ed,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.SetOption(t),this.ExtendChartPaint.push(a),a;case"FrameSplitPaint":return a=new bC,a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.SetOption(t),this.ExtendChartPaint.push(a),a;default:return a=Sn.Create(e),a?(a.Canvas=this.Canvas,a.ChartBorder=this.Frame.ChartBorder,a.ChartFrame=this.Frame,a.HQChart=this,a.SetOption(t),this.ExtendChartPaint.push(a),a):null}},this.OnTouchFinished=function(){if(this.DragMode==be.CLICK_TOUCH_MODE_ID){if(this.TouchStatus.CorssCursorShow==!0&&this.TouchDrawCount>0)return;this.TouchStatus.CorssCursorShow=!1,this.DrawDynamicInfo();return}if(this.EnableClickModel===!0){if(this.ClickModel.IsShowCorssCursor==!0&&this.TouchDrawCount>0)return;this.ClickModel.IsShowCorssCursor=!1,this.DrawDynamicInfo();return}if(this.CorssCursorTouchEnd===!0){this.TouchDrawCount>0&&this.DrawDynamicInfo();return}for(var e in this.ExtendChartPaint){var t=this.ExtendChartPaint[e];t.ClassName==="KLineTooltipPaint"&&this.DrawDynamicInfo()}},this.LockIndex=function(e){if(e&&e.IndexName)for(var t in this.WindowIndex){var a=this.WindowIndex[t];if(a||conintue,a.Name==e.IndexName){a.SetLock(e),this.Update();break}}},this.TryClickLock=function(e,t){for(var a=0;a<this.Frame.SubFrame.length;++a){var s=this.Frame.SubFrame[a];if(s.Frame.IsLocked&&s.Frame.LockPaint){var o=new zr;if(s.Frame.LockPaint.GetTooltipData(e,t,o))return o.HQChart=this,o.Data.Callback&&o.Data.Callback(o),!0}}return!1},this.TryClickIndexTitle=function(e,t){for(var a in this.TitlePaint){var s=this.TitlePaint[a];if(s.IsClickTitle&&s.IsClickTitle(e,t)){var o={Point:{X:e,Y:t},Title:s.Title,FrameID:s.Frame.Identify};X.Chart.Log("[KLineChartContainer::TryClickIndexTitle] click title ",o);var h=this.GetEventCallback(et.ON_CLICK_INDEXTITLE);return h&&h.Callback&&h.Callback(h,o,this),!0}}return!1},this.SetSizeChange=function(e){this.Frame.SetSizeChage(e);for(var t in this.ExtendChartPaint){var a=this.ExtendChartPaint[t];a.SizeChange=e}},this.SetSizeChage=this.SetSizeChange,this.Update=function(e){if(this.SourceData){this.BeforeBindMainData&&this.BeforeBindMainData("Update");var t=new k;if(t.Data=this.SourceData.Data,t.Period=this.Period,t.Right=this.Right,t.DataType=this.SourceData.DataType,t.Symbol=this.Symbol,t.Right>0&&k.IsDayPeriod(t.Period,!0)){var a=t.GetRightData(t.Right,{AlgorithmType:this.RightFormula});t.Data=a}else if(t.Right>0&&k.IsMinutePeriod(t.Period,!0)&&this.RightFormula>=1){var a=t.GetRightData(t.Right,{AlgorithmType:this.RightFormula});t.Data=a}if(k.IsDayPeriod(t.Period,!1)||k.IsMinutePeriod(t.Period,!1)){var s=t.GetPeriodData(t.Period);t.Data=s}this.BindMainData(t,this.PageSize),this.AfterBindMainData&&this.AfterBindMainData("Update");for(var o,h=0;h<this.Frame.SubFrame.length;++h)h==0&&(o=this.Frame.SubFrame[h].Frame),this.BindIndexData(h,t);o&&o.YSplitOperator&&(o.YSplitOperator.Symbol=this.Symbol,o.YSplitOperator.Data=this.ChartPaint[0].Data,o.YSplitOperator.Period=this.Period);for(var h in this.OverlayChartPaint){var l=this.OverlayChartPaint[h];if(l.SourceData)if(k.IsMinutePeriod(this.Period,!0)){var t=new k;t.Data=l.SourceData.Data,t.Period=this.Period,t.Right=this.Right;var u=this.SourceData.GetOverlayMinuteData(t.Data,this.IsApiPeriod);if(t.Data=u,k.IsMinutePeriod(t.Period,!1)&&!this.IsApiPeriod){var s=t.GetPeriodData(t.Period);t.Data=s}l.Data=t}else{var t=new k;if(t.Data=l.SourceData.Data,t.Period=this.Period,t.Right=this.Right,t.Right>0&&W.IsSHSZStockA(l.Symbol)){var a=t.GetRightData(t.Right,{AlgorithmType:this.RightFormula});t.Data=a}var u=this.SourceData.GetOverlayData(t.Data,this.IsApiPeriod);if(t.Data=u,k.IsDayPeriod(t.Period,!1)&&!this.IsApiPeriod){var s=t.GetPeriodData(t.Period);t.Data=s}l.Data=t}}this.ReqeustKLineInfoData({FunctionName:"Update"}),this.CreateChartDrawPictureByStorage(),this.UpdataDataoffset(),e&&e.UpdateCursorIndexType>0?this.UpdatePointByCursorIndex(e.UpdateCursorIndexType):this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw();for(var h=0;h<this.Frame.SubFrame.length;++h){var l=this.Frame.SubFrame[h];for(var f in l.OverlayIndex){var C=l.OverlayIndex[f];this.BindOverlayIndexData(C,h,t)}}}},this.ChangeSymbol=function(e,t){if(this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"KLineChartContainer::ChangeSymbol"),this.ClearRectSelect(!0),this.ClearCustomKLine(),this.ClearKLineCaluate(),this.HideTooltip(),this.ResetScrollBar(),this.Symbol=e,!e){this.DrawEmpty();return}if(t&&t.KLine){var a=t.KLine;c.IsNumber(a.Right)&&(this.Right=a.Right),c.IsNumber(a.Period)&&(this.Period=a.Period)}if(W.IsSHSZIndex(e)&&(this.Right=0),this.ClearIndexPaint(),t&&t.Windows&&Array.isArray(t.Windows)&&t.Windows.length>0){var s=t.Windows,o=new J;for(var h in s){if(h>=this.WindowIndex.length)break;var a=s[h];if(a)if(a.Script)this.WindowIndex[h]=new de(a.Name,a.Script,a.Args,a);else if(a.API){var l=a.API;this.WindowIndex[h]=new Ma(l.Name,l.Script,l.Args,a)}else{var u=a.Index,f=o.Get(u);f&&(f.Args,a.Args&&(f.Args=a.Args),f.ID=u,this.WindowIndex[h]=new de(f.Name,f.Script,f.Args,f))}}}this.ReloadChartDrawPicture(),this.Frame.ClearUpDonwFrameYData(),k.IsDayPeriod(this.Period,!0)?this.RequestHistoryData():k.IsMinutePeriod(this.Period,!0)||k.IsSecondPeriod(this.Period)?this.ReqeustHistoryMinuteData():k.IsTickPeriod(this.Period)&&this.RequestTickData()},this.ReqeustKLineInfoData=function(e){if(e&&e.FunctionName=="RecvDragDayData")e.Update=!0;else{if(this.ChartPaint.length>0){var t=this.ChartPaint[0];t.InfoData=new Dt.default}e.Update=!1}if(c.IsNonEmptyArray(this.ChartInfo))for(var a=0;a<this.ChartInfo.length;++a)this.ChartInfo[a].RequestData(this,e)},this.SetKLineInfo=function(e,t){this.ChartInfo=[];for(var a in e){var s=La.Get(e[a]);if(s){var o=s.Create();o.MaxRequestDataCount=this.MaxRequestDataCount,this.ChartInfo.push(o)}}t==!0&&this.ReqeustKLineInfoData({FunctionName:"SetKLineInfo"})},this.AddKLineInfo=function(e,t){var a=La.GetClassInfo(e);if(!a){console.warn("[KLineChartContainer::AddKLineInfo] can't find infoname=",e);return}for(var s in this.ChartInfo){var h=this.ChartInfo[s];if(h.ClassName==a.ClassName)return}var o=La.Get(e);if(o){var h=o.Create();h.MaxRequestDataCount=this.MaxRequestDataCount,this.ChartInfo.push(h),t==!0&&h.RequestData(this)}},this.DeleteKLineInfo=function(e){var t=La.GetClassInfo(e);if(!t){console.warn("[KLineChartContainer::DeleteKLineInfo] can't find infoname=",e);return}for(var a in this.ChartInfo){var s=this.ChartInfo[a];if(s.ClassName==t.ClassName){this.ChartInfo.splice(a,1),this.UpdataChartInfo(),this.Draw();break}}},this.ClearKLineInfo=function(){if(!(!this.ChartInfo||this.ChartInfo.length<=0)){this.ChartInfo=[];var e=this.ChartPaint[0];e.InfoData=null,this.Draw()}},this.OverlaySymbol=function(e,t){for(var a in this.OverlayChartPaint){var s=this.OverlayChartPaint[a];if(s.Symbol===e)return console.warn("[KLineChartContainer::OverlaySymbol] overlay symbol="+e+" exist."),!1}var o=new zT;return o.Canvas=this.Canvas,o.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,o.ChartFrame=this.Frame.SubFrame[0].Frame,o.Name="Overlay-KLine",o.DrawType=this.KLineDrawType,o.Symbol=e,o.Identify="Overlay-KLine-"+e,t&&t.Color?o.Color=t.Color:o.Color=m.OverlaySymbol.Color[m.OverlaySymbol.Random%m.OverlaySymbol.Color.length],o.SetOption(t),++m.OverlaySymbol.Random,this.ChartPaint[0]&&this.ChartPaint[0].Data&&this.SourceData&&(o.MainData=this.ChartPaint[0].Data),this.OverlayChartPaint.push(o),k.IsDayPeriod(this.Period,!0)?this.RequestOverlayHistoryData():k.IsMinutePeriod(this.Period,!0)&&this.RequestOverlayHistoryMinuteData(),!0},this.RequestOverlayHistoryData=function(){var e=this;if(this.OverlayChartPaint.length&&!(!this.SourceData||!this.SourceData.Data))for(var t=this,a=this.GetRequestDataCount(),s=this.SourceData.Data[0].Date,o=function(){var C=e.OverlayChartPaint[h];if(!C.MainData||C.Status!=Ie.STATUS_NONE_ID)return"continue";var D=C.Symbol;if(!D||(C.Status=Ie.STATUS_REQUESTDATA_ID,e.NetworkFilter&&(l={Name:"KLineChartContainer::RequestOverlayHistoryData",Explain:"叠加股票日K线数据",Request:{Url:t.KLineApiUrl,Data:{symbol:D,count:a.MaxRequestDataCount,first:{date:s},field:["name","symbol","yclose","open","price","high","vol","amount"]},Type:"POST"},Self:e,PreventDefault:!1},e.NetworkFilter(l,function(v){C.Status=Ie.STATUS_RECVDATA_ID,t.RecvOverlayHistoryData(v,C)}),l.PreventDefault==!0)))return"continue";Lt.HttpRequest({url:e.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high"],symbol:D,start:-1,count:a.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(S){C.Status=Ie.STATUS_RECVDATA_ID,t.RecvOverlayHistoryData(S,C)}})},h=0;h<this.OverlayChartPaint.length;++h)var l,u=o()},this.RecvOverlayHistoryData=function(e,t){if(!t.IsDelete){var a=Te.JsonDataToHistoryData(e),s=new k;s.Data=a,s.DataType=0;var o=new k;if(o.Data=a,o.Period=this.Period,o.Right=this.Right,o.DataType=0,o.Right>0&&W.IsSHSZStockA(e.symbol)&&!this.IsApiPeriod){var h=o.GetRightData(o.Right,{AlgorithmType:this.RightFormula});o.Data=h}var l=this.SourceData.GetOverlayData(o.Data,this.IsApiPeriod);if(o.Data=l,k.IsDayPeriod(o.Period,!1)&&!this.IsApiPeriod){var u=o.GetPeriodData(o.Period);o.Data=u}t.Data=o,t.SourceData=s,t.Title=e.name,t.Symbol=e.symbol,t.Status=Ie.STATUS_FINISHED_ID,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=1,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.RequestOverlayHistoryMinuteData=function(){var e=this;if(this.OverlayChartPaint.length&&!(!this.SourceData||!this.SourceData.Data))for(var t=this,a=this.GetRequestDataCount(),s=this.SourceData.Data[0].Date,o=this.SourceData.Data[0].Time,h=function(){var D=e.OverlayChartPaint[l];if(!D.MainData||D.Status!=Ie.STATUS_NONE_ID)return"continue";var v=D.Symbol;if(!v||(D.Status=Ie.STATUS_REQUESTDATA_ID,e.NetworkFilter&&(u={Name:"KLineChartContainer::RequestOverlayHistoryMinuteData",Explain:"叠加股票分钟K线数据",Request:{Url:t.MinuteKLineApiUrl,Data:{symbol:v,count:a.MaxRequestMinuteDayCount,first:{date:s,time:o},field:["name","symbol","yclose","open","price","high","vol","amount"]},Type:"POST"},Self:e,PreventDefault:!1},e.NetworkFilter(u,function(S){D.Status=Ie.STATUS_RECVDATA_ID,t.RecvOveralyHistoryMinuteData(S,D)}),u.PreventDefault==!0)))return"continue";Lt.HttpRequest({url:e.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","vol","amount"],symbol:v,start:-1,count:a.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(T){D.Status=Ie.STATUS_RECVDATA_ID,t.RecvOveralyHistoryMinuteData(T,D)}})},l=0;l<this.OverlayChartPaint.length;++l)var u,f=h()},this.RecvOveralyHistoryMinuteData=function(e,t){if(this.EnableVerifyRecvData&&e.symbol!=t.Symbol){X.Chart.Warn("[MinuteChartContainer::RecvOveralyHistoryMinuteData] recv data symbol not match. paint["+t.Symbol+"] , Recv["+e.symbol+"]");return}var a=Te.JsonDataToMinuteHistoryData(e);if(a){var s=new k;s.Data=a,s.DataType=1;var o=new k;o.Data=a,o.Period=this.Period,o.Right=this.Right,o.DataType=1;var h=this.SourceData.GetOverlayMinuteData(o.Data,this.IsApiPeriod);if(o.Data=h,k.IsMinutePeriod(o.Period,!1)&&!this.IsApiPeriod){var l=o.GetPeriodData(o.Period);o.Data=l}t.Data=o,t.SourceData=s,t.Title=e.name,t.Symbol=e.symbol,t.Status=Ie.STATUS_FINISHED_ID,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=1,this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}},this.ResetOverlaySymbolStatus=function(){for(var e in this.OverlayChartPaint){var t=this.OverlayChartPaint[e];t.Status=Ie.STATUS_NONE_ID}},this.ClearOverlaySymbol=function(){for(var e in this.OverlayChartPaint){var t=this.OverlayChartPaint[e];t.IsDelete=!0}this.OverlayChartPaint=[],this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=0,this.UpdateFrameMaxMin(),this.Draw()},this.DeleteOverlaySymbol=function(e){for(var t in this.OverlayChartPaint){var a=this.OverlayChartPaint[t];if(a.Symbol===e)return a.IsDelete=!0,this.OverlayChartPaint.splice(t,1),this.OverlayChartPaint.length<=0&&(this.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType=0),this.UpdateFrameMaxMin(),this.Draw(),!0}return console.warn("[KLineChartContainer::DeleteOverlaySymbol] overlay symbol="+e+" not exist."),!1},this.RequestFlowCapitalData=function(){if(this.Symbol&&this.FlowCapitalReady!=!0){var e=this.Symbol.toUpperCase(),t=!0;if((W.IsBIT(e)||W.IsFutures(e))&&(t=!1),this.EnableFlowCapital&&W.IsBIT(e)&&this.EnableFlowCapital.BIT==!0&&(t=!0),!t){X.Chart.Log("[KLineChartContainer::RequestFlowCapitalData] symbol="+this.Symbol+" not need download data."),this.FlowCapitalReady=!0;return}var a=this,s=["name","date","symbol","capital.a"];if(this.NetworkFilter){var o={Name:"KLineChartContainer::RequestFlowCapitalData",Explain:"流通股本数据",Request:{Url:a.StockHistoryDayApiUrl,Data:{symbol:[this.Symbol],orderfield:"date",field:s},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(o,function(h){a.RecvFlowCapitalData(h)}),o.PreventDefault==!0)return}Lt.HttpRequest({url:this.StockHistoryDayApiUrl,data:{field:s,symbol:[this.Symbol],orderfield:"date"},type:"post",dataType:"json",async:!0,success:function(l){a.RecvFlowCapitalData(l)}})}},this.RecvFlowCapitalData=function(e){if(!(!e.stock||e.stock.length!=1)){var t=e.stock[0];if(this.EnableVerifyRecvData&&t.symbol!=this.Symbol){X.Chart.Warn("[MinuteChartContainer::RecvFlowCapitalData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+t.symbol+"]");return}var a=new Array;for(var s in t.stockday){var o=t.stockday[s],h=new yt;h.Date=o.date;var l=o.capital;l&&l.a>0&&(h.Value=l.a,a.push(h))}if(this.IsApiPeriod){var u=this.ChartPaint[0].Data,f=null;if(k.IsMinutePeriod(this.Period,!0)?f=u.GetMinuteFittingFinanceData(a):k.IsDayPeriod(this.Period,!0)&&(f=u.GetFittingFinanceData(a)),f&&u.Data&&f.length==u.Data.length)for(var C in u.Data){var o=u.Data[C];f[C]&&c.IsNumber(f[C].Value)&&(o.FlowCapital=f[C].Value)}}else if(k.IsMinutePeriod(this.Period,!0)){for(var f=this.SourceData.GetMinuteFittingFinanceData(a),C=0;C<this.SourceData.Data.length;++C){var o=this.SourceData.Data[C];f[C]&&c.IsNumber(f[C].Value)&&(o.FlowCapital=f[C].Value)}var D=this.ChartPaint[0].Data,v=new k;if(v.Data=this.SourceData.Data,D.Right>0&&this.RightFormula>=1){var S=v.GetRightData(D.Right,{AlgorithmType:this.RightFormula});v.Data=S}if(k.IsMinutePeriod(D.Period,!1)){var T=v.GetPeriodData(D.Period);v.Data=T}D.Data=v.Data}else{var f=this.SourceData.GetFittingFinanceData(a);for(var I in this.SourceData.Data){var o=this.SourceData.Data[I];f[I]&&c.IsNumber(f[I].Value)&&(o.FlowCapital=f[I].Value)}var D=this.ChartPaint[0].Data,v=new k;if(v.Data=this.SourceData.Data,D.Right>0){var S=v.GetRightData(D.Right,{AlgorithmType:this.RightFormula});v.Data=S}if(k.IsDayPeriod(D.Period,!1)){var T=v.GetPeriodData(D.Period);v.Data=T}D.Data=v.Data}this.FlowCapitalReady=!0;var F=!1;for(var C in this.ExtendChartPaint){var o=this.ExtendChartPaint[C];if(o.ClassName=="StockChip"){F=!0;break}}F&&this.Draw()}},this.CreateChartDrawPicture=function(e,t,a){var s=null,o=It.GetDrawPictureByName(e);if(o&&(s=o.Create(),(s.ClassName=="ChartDrawPictureText"||s.ClassName=="ChartDrawVolProfile")&&(s.HQChart=this)),!s&&It.MapIonFont.has(e)){var h=It.MapIonFont.get(e);s=new Wh,s.FontOption.Family=h.Family,s.Text=h.Text,h.Color&&(s.LineColor=h.Color)}if(!s)return!1;s.Canvas=this.Canvas,s.Status=0,s.Symbol=this.Symbol,s.Period=this.Period,s.Right=this.Right,s.Option=this.ChartDrawOption,a&&(s.FinishedCallback=a),t&&s.SetOption(t);var l=this;return s.Update=function(){l.DrawDynamicInfo()},s.GetActiveDrawPicture=function(){return l.GetActiveDrawPicture()},this.CurrentChartDrawPicture=s,!0},this.AddChartDrawPicture=function(e){if(!e||e.FrameID<0||e.FrameID>=this.Frame.SubFrame.length)return null;var t=this,a=It.GetDrawPictureByClassName(e.ClassName);if(!a)return null;var s=a.Create();return s.Canvas=this.Canvas,s.Status=10,s.Frame=this.Frame.SubFrame[e.FrameID].Frame,s.Symbol=this.Symbol,s.Period=this.Period,s.Right=this.Right,s.Option=this.ChartDrawOption,e.Value&&(s.Value=e.Value),e.Guid&&(s.Guid=e.Guid),s.ImportStorageData&&s.ImportStorageData(e),s.SetOption(e),e.EnableUpdateXValue&&s.UpdateXValue(),s.ValueToPoint(),s.GetActiveDrawPicture=function(){return t.GetActiveDrawPicture()},s.ClassName==="ChartDrawPictureText"&&(s.IsInitialized=!0),this.ChartDrawPicture.push(s),this.DrawDynamicInfo(),s},this.PasteChartDrawPicture=function(e,t,a){if(!e||!e.ClassName||t<0||t>=this.Frame.SubFrame.length)return null;var s=It.GetDrawPictureByClassName(e.ClassName);if(!s)return null;var o=s.Create();if(!o)return null;var h=this;return o.Canvas=this.Canvas,o.Status=10,o.Frame=this.Frame.SubFrame[t].Frame,o.Symbol=this.Symbol,o.Period=this.Period,o.Right=this.Right,o.Option=this.ChartDrawOption,o.GetActiveDrawPicture=function(){return h.GetActiveDrawPicture()},o.SetOption&&o.SetOption(e),this.RandomDrawPictureValue(o,e),o.PointToValue(),o.ClassName==="ChartDrawPictureText"&&(o.IsInitialized=!0),this.ChartDrawPicture.push(o),this.ChartDrawStorage&&this.ChartDrawStorage.SaveDrawData(o),this.DrawDynamicInfo(),o},this.RandomDrawPictureValue=function(e,t){if(c.IsNonEmptyArray(t.Value)){var a=this.GetKLineChart();if(!a||!a.Data||!c.IsNumber(a.Data.DataOffset)||a.Data.DataOffset<0||!c.IsNonEmptyArray(a.Data.Data))return null;var s=a.Data.Data;a.Data.DataOffset;var o=a.Data.DataOffset+a.ChartFrame.XPointCount-1;o>=s.length&&(o=s.length-1);var h=e.Frame.ChartBorder.GetHeight();e.Frame.HorizontalMax,e.Frame.HorizontalMin;var l=e.Frame.ChartBorder.GetBottomEx()-h*t.YFristScale,u={Max:5,Min:2},f=Math.floor(Math.random()*(u.Max-u.Min+1))+u.Min,C=t.Value[0].XIndex+f;e.Value=[];for(var D=0;D<t.Value.length;++D){var v=t.Value[D];e.Value[D]={XValue:C+v.XOffset},e.Point[D]={Y:l+v.YOffset,X:e.Frame.GetXFromIndex(C+v.XOffset,!1)}}}},this.MoveChartDrawPicture=function(e,t,a,s){var o=this.CurrentChartDrawPicture;if(!o)return!1;var h=V();a&&(h=1);var l=e*h,u=t*h;return o.Move(l,u,s),!0},this.UpdateChartDrawXValue=function(){for(var e in this.ChartDrawPicture){var t=this.ChartDrawPicture[e];t.UpdateXValue()}},this.OnRightMenu=function(e,t,a){var s=V();if(this.RightMenu){var o=this.Frame.PtInFrame(e*s,t*s);a.data={Chart:this,FrameID:o},this.RightMenu.DoModal(a)}var h=this.GetEventCallback(et.ON_CONTEXT_MENU);if(h){var o=this.Frame.PtInFrame(e*s,t*s),l={X:e,Y:t,Event:a,FrameID:o};h.Callback(h,l,this)}},this.ReloadChartDrawPicture=function(){if(this.ChartDrawPicture=[],this.ChartDrawStorageCache,this.ChartDrawStorage){this.ChartDrawStorageCache=this.ChartDrawStorage.GetDrawData({Symbol:this.Symbol,Period:this.Period});var e=this.GetEventCallback(et.ON_LOAD_DRAWPICTURE);if(e&&e.Callback){var t={Symbol:this.Symbol,Period:this.Period,DrawStorage:this.ChartDrawStorage,ChartDrawStorageCache:this.ChartDrawStorageCache};e.Callback(e,t,this)}}},this.CreateChartDrawPictureByStorage=function(){if(c.IsNonEmptyArray(this.ChartDrawStorageCache)){for(var e=0;e<this.ChartDrawStorageCache.length;++e){var t=this.ChartDrawStorageCache[e];if(!(t.FrameID<0||!this.Frame.SubFrame||this.Frame.SubFrame.length<t.FrameID)){var a=It.CreateChartDrawPicture(t);if(a){a.Canvas=this.Canvas,a.Status=10,a.Frame=this.Frame.SubFrame[t.FrameID].Frame,a.Option=this.ChartDrawOption,a.ImportStorageData&&a.ImportStorageData(t),a.UpdateXValue(),a.ValueToPoint();var s=this;a.GetActiveDrawPicture=function(){return s.GetActiveDrawPicture()},a.ClassName==="ChartDrawPictureText"&&(a.IsInitialized=!0),this.ChartDrawPicture.push(a)}}}this.ChartDrawStorageCache=null}},this.RequestKLineMatch=function(e,t){var a=this,s=t.Scope,o=t.WaitDialog;X.Chart.Log("[KLineChartContainer::RequestKLineMatch",e,s);for(var h=new Array,l=new Array,u=e.Start;u<e.End&&u<e.Data.Data.length;++u){var f=e.Data.Data[u];h.push(f.Date),l.push(f.Close)}var C={Stock:e.Stock,Index:{Start:e.Start,End:e.End},Date:{Start:h[0],End:h[h.length-1]},Minsimilar:s.Minsimilar,Plate:s.Plate,DayRegion:300};q.default.ajax({url:this.KLineMatchUrl,data:{userid:"guest",plate:s.Plate,period:this.Period,right:this.Right,dayregion:C.DayRegion,minsimilar:s.Minsimilar,sampledate:h,samplevalue:l},type:"post",dataType:"json",async:!0,success:function(v){o&&o.Close(),a.RecvKLineMatchData(v,C)},error:function(v,S,T){console.warn("[KLineChartContainer::RequestKLineMatch] failed",v,S,T),o&&o.Close()}})},this.RecvKLineMatchData=function(e,t){X.Chart.Log("[KLineChartContainer::RecvKLineMatchData] recv",e,t);var a=[];for(var s in e.match){var o=e.match[s];if(o.symbol!=t.Stock.Symbol)for(var h in o.data){var l=o.data[h],u={Symbol:o.symbol,Name:o.name,Similar:l.similar,Start:l.start,End:l.end};a.push(u)}}if(a.sort(function(D,v){return v.Similar-D.Similar}),X.Chart.Log("[KLineChartContainer::RecvKLineMatchData] filterData",a),this.mapEvent.has(et.RECV_KLINE_MATCH)){var o=this.mapEvent.get(et.RECV_KLINE_MATCH),e={Sample:t,Match:a,Source:e};o.Callback(o,e,this)}else{var f=new sI(this.Frame.ChartBorder.UIElement.parentNode),C={data:{Chart:this,MatchData:a,Sample:t,Source:e}};f.DoModal(C)}},this.UpdataChartInfo=function(){var e=null;if(this.Period==0){e=new Dt.default;for(var t in this.ChartInfo){var a=this.ChartInfo[t].Data;for(var s in a){var o=a[s];e.has(o.Date.toString())?e.get(o.Date.toString()).Data.push(o):e.set(o.Date.toString(),{Data:new Array(o)})}}}else if(k.IsDayPeriod(this.Period,!1)){e=new Dt.default;var h=this.ChartPaint[0].Data;if(h&&h.Data&&h.Data.length>0){var l=h.Data[0],u=[];for(var t in this.ChartInfo){var f=this.ChartInfo[t];for(var s in f.Data){var o=f.Data[s];o.Date>=l.Date&&u.push(o)}}u.sort(function(T,I){return T.Date-I.Date});for(var t=0;t<h.Data.length;){var C=h.Data[t];if(u.length<=0)break;var f=u[0];if(C.Date<f.Date){++t;continue}e.has(C.Date.toString())?e.get(C.Date.toString()).Data.push(f):e.set(C.Date.toString(),{Data:new Array(f)}),u.shift()}}}else if(k.IsMinutePeriod(this.Period,!0)){e=new Dt.default;var h=this.ChartPaint[0].Data;if(h&&h.Data&&h.Data.length>0){for(var D=h.Data[0],u=[],t=0,s=0;t<this.ChartInfo.length;++t){var f=this.ChartInfo[t];for(s=0;s<f.Data.length;++s){var o=f.Data[s];(o.Date>=D.Date||o.Date==D.Date&&o.Time>=D.Time)&&u.push(o)}}u.sort(function(F,E){return F.Date==E.Date?F.Time-E.Time:F.Date-E.Date});for(var t=0;t<h.Data.length;){var C=h.Data[t];if(u.length<=0)break;var f=u[0];if(C.Date<f.Date||C.Date==f.Date&&C.Time<f.Time){++t;continue}var v=C.Date+"-"+C.Time;e.has(v)?e.get(v).Data.push(f):e.set(v,{Data:new Array(f)}),u.shift()}}}var S=this.ChartPaint[0];S.InfoData=e},this.RecvWindowIndex=function(e,t){var a=this.WindowIndex[e];if(a&&typeof a.RecvSubscribeData=="function"){var s=this.ChartPaint[0].Data;a.RecvSubscribeData(t,this,e,s)}},this.UpdateWindowIndex=function(e){var t=new k;if(t.Data=this.SourceData.Data,t.Period=this.Period,t.Right=this.Right,!this.IsApiPeriod){if(t.Right>0){var a=t.GetRightData(t.Right,{AlgorithmType:this.RightFormula});t.Data=a}if(k.IsDayPeriod(t.Period,!1)||k.IsMinutePeriod(t.Period,!1)){var s=t.GetPeriodData(t.Period);t.Data=s}}if(typeof this.WindowIndex[e].ExecuteScript=="function"){var o=this.ChartPaint[0].Data;this.WindowIndex[e].ExecuteScript(this,e,o)}else if(typeof this.WindowIndex[e].RequestData=="function"){var o=this.ChartPaint[0].Data;this.WindowIndex[e].RequestData(this,e,o,null)}else this.WindowIndex[e].BindData(this,e,t);this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.GetOverlayIndexByIdentify=function(e){for(var t=0;t<this.Frame.SubFrame.length;++t){var a=this.Frame.SubFrame[t];if(c.IsNonEmptyArray(a.OverlayIndex))for(var s=0;s<a.OverlayIndex.length;++s){var o=a.OverlayIndex[s];if(o.Identify===e)return{OverlayItem:o,WindowIndex:t}}}return null},this.RecvOverlayIndex=function(e,t){var a=this.GetOverlayIndexByIdentify(e);if(a==null){console.warn("[KLineChartContainer::RecvOverlayIndex] can't find overlay index. [identify="+e+"]");return}if(a.Script&&typeof a.RecvSubscribeData=="function"&&this.ChartPaint[0]){var s=this.ChartPaint[0].Data;s&&a.Script.RecvSubscribeData(t,this,a.WindowIndex,s)}},this.UpdateOverlayIndex=function(e){var t=this.GetOverlayIndexByIdentify(e);if(t==null){console.warn("[KLineChartContainer::UpdateOverlayIndex] can't find overlay index. [identify="+e+"]");return}if(this.ChartPaint[0]){var a=this.ChartPaint[0].Data;a&&this.BindOverlayIndexData(t.OverlayItem,t.WindowIndex,a)}},this.ChangeWindowIndexParam=function(e){this.WindowIndex[e].Index[0].Param+=1,this.WindowIndex[e].Index[1].Param+=1,this.UpdateWindowIndex(e)},this.OnDoubleClick=function(e,t,a){if(this.EnableYDrag&&(this.EnableYDrag.Left||this.EnableYDrag.Right)&&this.Frame&&this.Frame.PtInFrameY){var s=V(),e=(a.clientX-this.UIElement.getBoundingClientRect().left)*s,t=(a.clientY-this.UIElement.getBoundingClientRect().top)*s,o=this.Frame.PtInFrameY(e,t);o&&o.Index>=0&&o.IsOverlay==!1&&this.CancelZoomUpDownFrameY(o)}var h;this.SelectedChart.EnableSelected&&(h=this.PtInChart(e,t));var l={SelectedChart:h};if(this.DBClickEvent(l,a),!h&&this.EnableZoomIndexWindow){var u=this.Frame.PtInFrame(e,t);if(X.Chart.Log("[KLineChartContainer::OnDoubleClick] frameId",u),u>=this.Frame.ZoomStartWindowIndex&&this.ZoomIndexWindow(u,{X:e,Y:t}))return this.Frame.SetSizeChage(!0),this.Draw(),!0}var f=null;if(this.mapEvent.has(et.DBCLICK_KLINE)&&(f=this.mapEvent.get(et.DBCLICK_KLINE)),!(!this.MinuteDialog&&!f)){var C=new zr;if(this.PtInChartPaintTooltip(e,t,C)&&C.Data){if(f){this.ClickChartTimer!=null&&(clearTimeout(this.ClickChartTimer),this.ClickChartTimer=null);var D={Tooltip:C,Stock:{Symbol:this.Symbol,Name:this.Name},X:a.clientX,Y:a.clientY};f.Callback(f,D,this)}this.MinuteDialog&&(a.data={Chart:this,Tooltip:C},this.MinuteDialog.DoModal(a))}}},this.CancelAutoUpdate=function(){typeof this.AutoUpdateTimer=="number"&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=void 0)},this.AutoUpdate=function(e){if(this.CancelAutoUpdate(),!!this.IsAutoUpdate&&this.Symbol){var t=this,a=W.GetMarketStatus(this.Symbol);if(a==0||a==3){this.AutoUpdateTimer=setTimeout(function(){t.AutoUpdate()},2e4);return}var s=this.AutoUpdateFrequency;a==1?this.AutoUpdateTimer=setTimeout(function(){t.AutoUpdate()},s):a==2&&(this.AutoUpdateTimer=setTimeout(function(){k.IsDayPeriod(t.Period,!0)?t.RequestRealtimeData():k.IsMinutePeriod(t.Period,!0)||k.IsSecondPeriod(t.Period)?t.RequestMinuteRealtimeData():k.IsTickPeriod(t.Period)&&t.RequestTickRealtimeData()},s))}},this.GetMaxMinPageSize=function(){var e={},t=this.Frame.ChartBorder.GetWidth(),a=ie[ie.length-1][0]+ie[ie.length-1][1];return e.Max=parseInt(t/a)-2,a=ie[0][0]+ie[0][1],e.Min=parseInt(t/a)-2,X.Chart.Log("[KLineChartContainer::GetMaxMinPageSize] Max="+e.Max+" Min="+e.Min),e},this.GetChartStatus=function(){var e=this.Frame.SubFrame[0].Frame;if(!e)return null;var t=e.Data;if(!t)return null;var a={KLine:{},Zoom:{}};return a.KLine.Count=t.Data.length,a.KLine.Offset=t.DataOffset,a.KLine.PageSize=e.XPointCount,a.Zoom.Index=e.ZoomIndex,a.Zoom.Max=ie.length,a},this.DragDownloadData=function(){var e=null;if(this.Frame.Data?e=this.Frame.SubFrame[0].Frame.Data:e=this.Frame.Data,!e)return!1;if(!(e.DataOffset>0)){if(k.IsMinutePeriod(this.Period,!0)||k.IsSecondPeriod(this.Period)){if(X.Chart.Log("[KLineChartContainer.DragDownloadData] Minute:[Enable="+this.DragDownload.Minute.Enable+", IsEnd="+this.DragDownload.Minute.IsEnd+", Status="+this.DragDownload.Minute.Status+", Period="+this.Period+"]"),!this.DragDownload.Minute.Enable||this.DragDownload.Minute.IsEnd||this.DragDownload.Minute.Status!=0)return;this.RequestDragMinuteData()}else if(k.IsDayPeriod(this.Period,!0)){if(X.Chart.Log("[KLineChartContainer.DragDownloadData] Day:[Enable="+this.DragDownload.Minute.Enable+", IsEnd="+this.DragDownload.Minute.IsEnd+", Status="+this.DragDownload.Minute.Status+"]"),!this.DragDownload.Day.Enable||this.DragDownload.Day.IsEnd||this.DragDownload.Day.Status!=0)return;this.RequestDragDayData()}else if(k.IsTickPeriod(this.Period)){if(X.Chart.Log("[KLineChartContainer.DragDownloadData] Tick:[Enable="+this.DragDownload.Tick.Enable+", IsEnd="+this.DragDownload.Tick.IsEnd+", Status="+this.DragDownload.Tick.Status+"]"),!this.DragDownload.Tick.Enable||this.DragDownload.Tick.IsEnd||this.DragDownload.Tick.Status!=0)return;this.RequestDragTickData()}}},this.ZoomDownloadData=function(e){var t=null;if(this.Frame.Data?t=this.Frame.SubFrame[0].Frame.Data:t=this.Frame.Data,!t)return!1;if(!(t.DataOffset>0)){if(k.IsMinutePeriod(this.Period,!0)||k.IsSecondPeriod(this.Period)){if(X.Chart.Log("[KLineChartContainer.ZoomDownloadData] Minute:[Enable="+this.ZoomDownload.Minute.Enable+", IsEnd="+this.ZoomDownload.Minute.IsEnd+", Status="+this.DragDownload.Minute.Status+", Period="+this.Period+"]"),!this.ZoomDownload.Minute.Enable||this.ZoomDownload.Minute.IsEnd||this.ZoomDownload.Minute.Status!=0)return;this.RequestZoomMinuteData(e)}else if(k.IsDayPeriod(this.Period,!0)){if(X.Chart.Log("[KLineChartContainer.ZoomDownloadData] Day:[Enable="+this.ZoomDownload.Minute.Enable+", IsEnd="+this.ZoomDownload.Minute.IsEnd+", Status="+this.DragDownload.Minute.Status+"]"),!this.ZoomDownload.Day.Enable||this.ZoomDownload.Day.IsEnd||this.ZoomDownload.Day.Status!=0)return;this.RequestZoomDayData(e)}else if(k.IsTickPeriod(this.Period)){if(X.Chart.Log("[KLineChartContainer.ZoomDownloadData] Tick:[Enable="+this.ZoomDownload.Tick.Enable+", IsEnd="+this.ZoomDownload.Tick.IsEnd+", Status="+this.DragDownload.Tick.Status+"]"),!this.ZoomDownload.Tick.Enable||this.ZoomDownload.Tick.IsEnd||this.ZoomDownload.Tick.Status!=0)return;this.RequestZoomTickData(e)}}},this.RequestDragTickData=function(){X.Chart.Log("[KLineChartContainer.RequestDragTickData] not finished.")},this.RequestPreviousMinuteData=function(e){var t=e.FuncName,a=e.FuncExplain,s=e.Download,o=e.Url,h=e.Count,l=this;this.AutoUpdateEvent(!1,t),this.CancelAutoUpdate(),s.Status=1;var u=this.SourceData.Data[0],f={field:["name","symbol","yclose","open","price","high","low","vol"],symbol:l.Symbol,enddate:u.Date,endtime:u.Time,count:h,first:{date:u.Date,time:u.Time}};if(c.IsNonEmptyArray(this.OverlayChartPaint)){f.overlay=[];for(var C=0;C<this.OverlayChartPaint.length;++C){var D=this.OverlayChartPaint[C];f.overlay.push({symbol:D.Symbol})}}if(this.NetworkFilter){var v={Name:t,Explain:a,Request:{Url:o,Type:"POST",Data:f,Period:this.Period,Right:this.Right},DragDownload:s,Option:e,Self:this,PreventDefault:!1,ZoomData:e.ZoomData};if(this.NetworkFilter(v,function(S){l.RecvPreviousMinuteData(S,e),s.Status=0,l.AutoUpdateEvent(!0,t),l.AutoUpdate()}),v.PreventDefault==!0)return}Lt.HttpRequest({url:o,data:f,type:"post",dataType:"json",async:!0,success:function(T){l.RecvPreviousMinuteData(T,e),s.Status=0,l.AutoUpdateEvent(!0,t),l.AutoUpdate()}})},this.RecvPreviousMinuteData=function(e,t){var a=t.Download,s=Te.JsonDataToMinuteHistoryData(e);if(!s||s.length<=0){a.IsEnd=!0,X.Chart.Log("[KLineChartContainer.RecvPreviousMinuteData] "+this.Symbol+" data end. FuncName="+t.FuncName);return}for(var o=this.GetHistoryDataCount(),h=this.SourceData.Data[0],l=null,u=s.length-1;u>=0;--u){var f=s[u];if(h.Date>f.Date||h.Date==f.Date&&h.Time>f.Time){l=u;break}else if(h.Date==f.Date&&h.Time==f.Time){h.YClose=f.YClose,l=u-1;break}}if(!(l==null&&l<0)){for(var u=0;u<s.length&&u<=l;++u){var f=s[u];this.SourceData.Data.splice(u,0,f)}var C=new k;if(C.Data=this.SourceData.Data,C.Period=this.Period,C.Right=this.Right,C.DataType=this.SourceData.DataType,C.Symbol=this.Symbol,!this.IsApiPeriod&&(k.IsDayPeriod(C.Period,!1)||k.IsMinutePeriod(C.Period,!1))){var D=C.GetPeriodData(C.Period);C.Data=D}var v=this.GetKLineCalulate();if(v){var S=v.RecvHistoryData(C,{Symbol:this.Symbol,Function:t.RecvFuncName});C=S,this.FlowCapitalReady=!0}if(this.UpdateMainData(C,o),t&&t.ZoomData){var T=t.ZoomData,I=T.PageSize-T.RightSpaceCount;C.DataOffset=C.Data.length-I,C.DataOffset<0&&(C.DataOffset=0)}this.UpdateOverlayDragMinuteData(e),this.BindInstructionIndexData(C);for(var u=0;u<this.Frame.SubFrame.length;++u)this.BindIndexData(u,C);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdateChartDrawXValue(),this.Draw(),this.BindAllOverlayIndexData(C)}},this.RequestZoomMinuteData=function(){var e={PageSize:requestData.PageSize,DataCount:requestData.DataCount,RightSpaceCount:requestData.RightSpaceCount},t={FuncName:"KLineChartContainer::RequestZoomMinuteData",FuncExplain:"缩放分钟|秒K线数据下载",RecvFuncName:"RecvZoomMinuteData",Download:this.DragDownload.Minute,Url:this.ZoomMinuteKLineApiUrl,Count:this.MaxRequestMinuteDayCount,ZoomData:e};this.RequestPreviousMinuteData(t)},this.RequestDragMinuteData=function(){var e={FuncName:"KLineChartContainer::RequestDragMinuteData",FuncExplain:"拖拽分钟|秒K线数据下载",RecvFuncName:"RecvDragMinuteData",Download:this.DragDownload.Minute,Url:this.DragMinuteKLineApiUrl,Count:this.MaxRequestMinuteDayCount};this.RequestPreviousMinuteData(e)},this.UpdateOverlayDragMinuteData=function(e){if(c.IsNonEmptyArray(this.OverlayChartPaint)){var t=e.overlay;if(c.IsNonEmptyArray(t))for(var a=0;a<this.OverlayChartPaint.length;++a){var s=this.OverlayChartPaint[a];if(s.Symbol&&s.MainData&&s.Status==Ie.STATUS_FINISHED_ID){for(var o=null,h=0;h<t.length;++h){var l=t[h];if(l.symbol==s.Symbol){o=l;break}}if(o){for(var u=Te.JsonDataToMinuteHistoryData(o),f=s.SourceData,C=f.Data[0],D=null,h=u.length-1;h>=0;--h){var v=u[h];if(C.Date>v.Date){D=h;break}else if(C.Date==v.Date&&C.Time>v.Time){D=h;break}else if(C.Date==v.Date&&C.Time==v.Time){C.YClose=v.YClose,D=h-1;break}}if(!(D==null&&D<0)){for(var h=0;h<u.length&&h<=D;++h){var v=u[h];f.Data.splice(h,0,v)}var S=new k;S.Data=f.Data,S.Period=this.Period,S.Right=this.Right,S.DataType=0;var T=this.SourceData.GetOverlayMinuteData(S.Data,this.IsApiPeriod);if(S.Data=T,k.IsMinutePeriod(S.Period,!1)&&!this.IsApiPeriod){var I=S.GetPeriodData(S.Period);S.Data=I}s.Data=S}}}}}},this.RequestPreviousDayData=function(e){var t=e.FuncName,a=e.FuncExplain,s=e.Download,o=e.Url,h=e.Count,l=this;this.AutoUpdateEvent(!1,t),this.CancelAutoUpdate(),s.Status=1;var u=this.SourceData.Data[0],f={field:["name","symbol","yclose","open","price","high","low","vol"],symbol:l.Symbol,enddate:u.Date,count:h,first:{date:u.Date}};if(c.IsNonEmptyArray(this.OverlayChartPaint)){f.overlay=[];for(var C=0;C<this.OverlayChartPaint.length;++C){var D=this.OverlayChartPaint[C];f.overlay.push({symbol:D.Symbol})}}if(this.NetworkFilter){var v={Name:t,Explain:a,Request:{Url:o,Type:"POST",Data:f,Period:this.Period,Right:this.Right},DragDownload:s,Self:this,PreventDefault:!1,ZoomData:e.ZoomData};if(this.NetworkFilter(v,function(S){l.RecvPreviousDayData(S,e),s.Status=0,l.AutoUpdateEvent(!0,t),l.AutoUpdate()}),v.PreventDefault==!0)return}Lt.HttpRequest({url:o,data:f,type:"post",dataType:"json",async:!0,success:function(T){l.RecvPreviousDayData(T,e),s.Status=0,l.AutoUpdateEvent(!0,t),l.AutoUpdate()}})},this.RecvPreviousDayData=function(e,t){var a=t.Download,s=Te.JsonDataToHistoryData(e);if(!s||s.length<=0){a.IsEnd=!0,X.Chart.Log("[KLineChartContainer.RecvPreviousDayData] "+this.Symbol+" data end. FuncName="+t.FuncName);return}for(var o=this.GetHistoryDataCount(),h=this.SourceData.Data[0],l=null,u=s.length-1;u>=0;--u){var f=s[u];if(h.Date>f.Date){l=u;break}else if(h.Date==f.Date){h.YClose=f.YClose,l=u-1;break}}if(!(l==null&&l<0)){for(var u=0;u<s.length&&u<=l;++u){var f=s[u];this.SourceData.Data.splice(u,0,f)}var C=new k;if(C.Data=this.SourceData.Data,C.Period=this.Period,C.Right=this.Right,C.DataType=this.SourceData.DataType,C.Symbol=this.Symbol,!this.IsApiPeriod&&(k.IsDayPeriod(C.Period,!1)||k.IsMinutePeriod(C.Period,!1))){var D=C.GetPeriodData(C.Period);C.Data=D}var v=this.GetKLineCalulate();if(v){var S=v.RecvHistoryData(C,{Symbol:this.Symbol,Function:t.RecvFuncName});C=S,this.FlowCapitalReady=!0}if(this.UpdateMainData(C,o),t&&t.ZoomData){var T=t.ZoomData,I=T.PageSize-T.RightSpaceCount;C.DataOffset=C.Data.length-I,C.DataOffset<0&&(C.DataOffset=0)}this.UpdateOverlayDragDayData(e),this.BindInstructionIndexData(C);for(var u=0;u<this.Frame.SubFrame.length;++u)this.BindIndexData(u,C);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.UpdateChartDrawXValue(),this.Draw(),this.ReqeustKLineInfoData({FunctionName:t.RecvFuncName,StartDate:h.Date}),this.BindAllOverlayIndexData(C)}},this.RequestZoomDayData=function(e){var t=this.MaxRequestDataCount;e.Count>t&&(t=e.Count);var a={PageSize:e.PageSize,DataCount:e.DataCount,RightSpaceCount:e.RightSpaceCount},s={FuncName:"KLineChartContainer::RequestZoomDayData",FuncExplain:"缩放日K数据下载",RecvFuncName:"RecvZoomDayData",Download:this.ZoomDownload.Day,Url:this.ZoomKLineApiUrl,Count:t,ZoomData:a};this.RequestPreviousDayData(s)},this.RequestDragDayData=function(){var e={FuncName:"KLineChartContainer::RequestDragDayData",FuncExplain:"拖拽日K数据下载",RecvFuncName:"RecvDragDayData",Download:this.DragDownload.Day,Url:this.DragKLineApiUrl,Count:this.MaxRequestDataCount};this.RequestPreviousDayData(e)},this.UpdateOverlayDragDayData=function(e){if(c.IsNonEmptyArray(this.OverlayChartPaint)){var t=e.overlay;if(c.IsNonEmptyArray(t))for(var a=0;a<this.OverlayChartPaint.length;++a){var s=this.OverlayChartPaint[a];if(s.Symbol&&s.MainData&&s.Status==Ie.STATUS_FINISHED_ID){for(var o=null,h=0;h<t.length;++h){var l=t[h];if(l.symbol==s.Symbol){o=l;break}}if(o){for(var u=Te.JsonDataToHistoryData(o),f=s.SourceData,C=f.Data[0],D=null,h=u.length-1;h>=0;--h){var v=u[h];if(C.Date>v.Date){D=h;break}else if(C.Date==v.Date){C.YClose=v.YClose,D=h-1;break}}if(!(D==null&&D<0)){for(var h=0;h<u.length&&h<=D;++h){var v=u[h];f.Data.splice(h,0,v)}var S=new k;if(S.Data=f.Data,S.Period=this.Period,S.Right=this.Right,S.DataType=0,S.Right>0&&W.IsSHSZStockA(o.symbol)&&!this.IsApiPeriod){var T=S.GetRightData(S.Right,{AlgorithmType:this.RightFormula});S.Data=T}var I=this.SourceData.GetOverlayData(S.Data,this.IsApiPeriod);if(S.Data=I,k.IsDayPeriod(S.Period,!1)&&!this.IsApiPeriod){var F=S.GetPeriodData(S.Period);S.Data=F}s.Data=S}}}}}},this.SetCustomVerical=function(e,t){if(this.Frame&&!(e>=this.Frame.SubFrame.length)){var a=this.Frame.SubFrame[e];a.Frame&&(a.Frame.CustomVerticalInfo=t)}},this.OnSize=function(){if(this.Frame&&this.Frame.OnSize){var e=this.Frame.OnSize();this.Frame.SetSizeChage(!0),e.Changed&&(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(2),this.UpdateFrameMaxMin()),this.Draw()}},this.ClickFrameButton=function(e,t){var a=this.GetEventCallback(et.ON_CLICK_FRAME_TOOLBAR);if(a&&a.Callback){var s={Info:e,PreventDefault:!1};if(a.Callback(a,s,this),s.PreventDefault)return}if(e.ID==xt.CLOSE_OVERLAY_INDEX){var o=e.IndexID;o&&this.DeleteOverlayWindowsIndex(o)}else if(e.ID==xt.MODIFY_OVERLAY_INDEX_PARAM){var o=e.IndexID,h=e.Frame;t.data={Chart:this,Identify:o,IsOverlay:!0},h.ModifyIndexEvent&&h.ModifyIndexEvent(t)}else if(e.ID==xt.CLOSE_INDEX_WINDOW){var h=e.Frame;this.RemoveIndexWindow(h.Identify)}else if(e.ID==xt.CHANGE_INDEX){var h=e.Frame;t.data={Chart:this,Identify:h.Identify,IsOverlay:!1},h.ChangeIndexEvent&&h.ChangeIndexEvent(t)}else if(e.ID==xt.MODIFY_INDEX_PARAM){var h=e.Frame;t.data={Chart:this,Identify:h.Identify,IsOverlay:!1},h.ModifyIndexEvent&&h.ModifyIndexEvent(t)}else if(e.ID==xt.OVERLAY_INDEX){var h=e.Frame;t.data={Chart:this,Identify:h.Identify,IsOverlay:!0},h.ChangeIndexEvent&&h.ChangeIndexEvent(t)}else if(e.ID==xt.MAX_MIN_WINDOW){var o=e.IndexID,h=e.Frame,l=e.FrameID;l>=this.Frame.ZoomStartWindowIndex&&this.ZoomIndexWindow(l,null)&&(this.Frame.SetSizeChage(!0),this.Draw())}else if(e.ID==xt.TITLE_WINDOW){var o=e.IndexID,h=e.Frame,l=e.FrameID;this.ShowIndexTitleOnly(l)&&(this.Frame.SetSizeChage(!0),this.Draw())}else if(e.ID==xt.EXPORT_DATA){var s=this.ExportData({Type:"CSV"});if(!s)return;var u=Date.now(),f="hqchart_"+this.Symbol+"_"+u+".csv",C=document.createElement("a"),D=new Blob([s],{type:"text/csv"});C.href=URL.createObjectURL(D),document.body.appendChild(C),C.setAttribute("download",f),C.click(),document.body.removeChild(C)}},this.ClickTitleButton=function(e,t){var a=this.GetEventCallback(et.ON_CLICK_TITLE_BUTTON);if(a&&a.Callback){var s={Info:e,PreventDefault:!1};if(a.Callback(a,s,this),s.PreventDefault)return}},this.ClickExtendChartButton=function(e,t){var a=this.GetEventCallback(et.ON_CLICK_EXTENDCHART_BUTTON);if(a&&a.Callback){var s={Info:e,PreventDefault:!1};if(a.Callback(a,s,this),s.PreventDefault)return}e.ID==xt.CHIP_DEFULT?(e.Chart.ShowType=0,this.Draw()):e.ID==xt.CHIP_LONG?(e.Chart.ShowType=1,this.Draw()):e.ID==xt.CHIP_RECENT&&(e.Chart.ShowType=2,this.Draw())},this.RequestVolumeProfileData=function(e){var t=this,a=e.Chart;if(this.NetworkFilter){var s={Name:"KLineChartContainer::RequestVolumeProfileData",Explain:"成交量分布图下载",Request:{Period:this.Period,Right:this.Right,Start:e.Start,End:e.End,Symbol:this.Symbol,ValueAreaVol:e.ValueAreaVol},Self:this,VolProfile:a,PreventDefault:!1};if(this.NetworkFilter(s,function(o){t.RecvVolumeProfileData(o,a)}),s.PreventDefault==!0)return}},this.RecvVolumeProfileData=function(e,t){t.OnRecvVolumeProfileData(e),this.Draw()},this.ExportMainData=function(e,t){var a=e.ExportKLineData(t);return a},this.UpdateScrollBar=function(){if(this.ScrollBar){var e=this.GetChartStatus();if(e){var t=this.ChartPaint[0].Data,a=e.KLine.Offset,s=a+e.KLine.PageSize-1,o={Start:a,End:s,Data:t,Draw:!0,RightSpaceCount:this.RightSpaceCount};if(this.Frame&&this.Frame.ChartBorder){var h=this.Frame.ChartBorder;o.Border={Left:h.Left,Right:h.Right}}this.ScrollBar.UpdateSlider(o)}}},this.ResetScrollBar=function(){this.ScrollBar&&this.ScrollBar.Reset({Draw:!0})}}Te.JsonDataToHistoryData=function(r){var n=[];if(!r.data)return n;var e=null;r.symbol&&(e=r.symbol.toUpperCase()),e&&W.IsFutures(e);for(var t=r.data,a=0,s=1,o=2,h=3,l=4,u=5,f=6,C=7,D=8,v=9,S=10,T=11,I=12,F=13,E=14,M=Ze.KLINE_ORDERFLOW,O=Ze.KLINE_COLOR_DATA,R=Ze.KLINE_HEATMAP,b=Ze.KLINE_DAY_EXTENDDATA,p=0;p<t.length;++p){var G=new Rt,Y=t[p];G.Date=Y[a],G.Open=Y[o],G.YClose=Y[s],G.Close=Y[u],G.High=Y[h],G.Low=Y[l],G.Vol=Y[f],G.Amount=Y[C],c.IsNumber(Y[D])&&(G.Position=Y[D]),c.IsNumber(Y[v])&&(G.FClose=Y[v]),c.IsNumber(Y[S])&&(G.YFClose=Y[S]),c.IsNumber(Y[T])&&(G.BFactor=Y[T]),c.IsNumber(Y[I])&&(G.AFactor=Y[I]),c.IsBool(Y[F])&&(G.IsVirtual=Y[F]),c.IsBool(Y[E])&&(G.IsNonTrade=Y[E]),!(!c.IsNumber(G.Open)&&G.IsVirtual!==!0)&&(Y[M]&&(G.OrderFlow=Y[M]),Y[O]&&(G.ColorData=Y[O]),Y[b]&&(G.ExtendData=Y[b]),Y[R]&&(G.HeatMap=Y[R]),n.push(G))}return n};Te.JsonDataToRealtimeData=function(r,n){if(!r.stock)return null;var e;for(var t in r.stock){var a=r.stock[t];if(a&&a.symbol==n){e=a;break}}if(!e)return null;var s=n.toUpperCase();W.IsSHSZ(s);var o=new Rt;return o.Date=e.date,o.Open=e.open,o.YClose=e.yclose,o.High=e.high,o.Low=e.low,o.Vol=e.vol,o.Amount=e.amount,o.Close=e.price,c.IsNumber(e.position)&&(o.Position=e.position),c.IsNumber(e.yclearing)&&(o.YFClose=e.yclearing),c.IsNumber(e.clearing)&&(o.FClose=e.clearing),c.IsNumber(e.bfactor)&&(o.BFactor=e.bfactor),c.IsNumber(e.afactor)&&(o.AFactor=e.afactor),e.colordata&&(o.ColorData=e.colordata),e.extendData&&(o.ExtendData=e.extendData),e.heatmapData&&(o.HeatMap=e.heatmapData),c.IsBool(e.isvirtual)&&(o.IsVirtual=e.isvirtual),c.IsBool(e.isnontrade)&&(o.IsNonTrade=e.isnontrade),o};Te.JsonDataToMinuteRealtimeData=function(r,n){if(!r.stock)return null;var e;for(var t in r.stock){var a=r.stock[t];if(a&&a.symbol==n){e=a;break}}if(!e)return null;var s=n.toUpperCase();W.IsSHSZ(s);var o=W.IsFutures(s),h=new Array,l=e.yclose,u=e.date;o&&e.yclearing&&(l=e.yclearing);for(var t in e.minute){var f=e.minute[t],C=new Rt;C.Close=f.price,C.Open=f.open,C.High=f.high,C.Low=f.low,C.Vol=f.vol,C.Amount=f.amount,f.date>0?C.Date=f.date:C.Date=u,C.Time=f.time,C.YClose=l,c.IsNumber(f.position)&&(C.Position=f.position),c.IsNumber(C.Close)||(C.Close=l,C.Open=C.High=C.Low=C.Close),c.IsNumber(C.Open)||(C.Open=null),c.IsNumber(C.Close)||(C.Close=null),c.IsNumber(C.High)||(C.High=null),c.IsNumber(C.Low)||(C.Low=null),c.IsNumber(f.price)&&(l=f.price),h[t]=C}return h};Te.JsonDataToMinuteRealtimeDataV2=function(r,n){if(!r||!r.overlay||!n)return null;for(var e=null,t=0;t<r.overlay.length;++t){var a=r.overlay[t];if(a.symbol==n){e=a;break}}if(!e)return null;var s=n.toUpperCase();W.IsSHSZ(s),W.IsFutures(s);for(var o=0,h=1,l=2,u=3,f=4,C=5,D=6,v=7,S=8,T=9,I=Ze.KLINE_ORDERFLOW,F=null,t=0;t<e.data.length;++t){var a=new Rt,E=e.data[t];a.Date=E[o],a.Open=E[l],a.YClose=E[h],a.Close=E[C],a.High=E[u],a.Low=E[f],a.Vol=E[D],a.Amount=E[v],a.Time=E[S],c.IsNumber(E[T])&&(a.Position=E[T]),c.IsNumber(a.YClose)||c.IsNumber(F)&&(a.YClose=F),c.IsNumber(a.Close)&&(F=a.Close),E[I]&&(a.OrderFlow=E[I]),aryMinuteData.push(a)}return aryMinuteData};Te.JsonDataToMinuteHistoryData=function(r){var n=null;r.symbol&&(n=r.symbol.toUpperCase()),n&&W.IsSHSZ(n),n&&W.IsFutures(n);for(var e=r.data,t=new Array,a=0,s=1,o=2,h=3,l=4,u=5,f=6,C=7,D=8,v=9,S=10,T=11,I=12,F=13,E=Ze.KLINE_ORDERFLOW,M=Ze.KLINE_COLOR_DATA,O=Ze.KLINE_HEATMAP,R=Ze.KLINE_MINUTE_EXTENDDATA,b=null,p=0;p<e.length;++p){var G=new Rt,Y=e[p];G.Date=Y[a],G.Open=Y[o],G.YClose=Y[s],G.Close=Y[u],G.High=Y[h],G.Low=Y[l],G.Vol=Y[f],G.Amount=Y[C],G.Time=Y[D],c.IsNumber(Y[v])&&(G.Position=Y[v]),c.IsNumber(Y[S])&&(G.FClose=Y[S]),c.IsNumber(Y[T])&&(G.YFClose=Y[T]),c.IsNumber(Y[I])&&(G.BFactor=Y[I]),c.IsNumber(Y[F])&&(G.AFactor=Y[F]),c.IsNumber(G.YClose)||c.IsNumber(b)&&(G.YClose=b),c.IsNumber(G.Close)&&(b=G.Close),Y[E]&&(G.OrderFlow=Y[E]),Y[M]&&(G.ColorData=Y[M]),Y[R]&&(G.ExtendData=Y[R]),Y[O]&&(G.HeatMap=Y[O]),t.push(G)}return t};Te.JsonDataToTickData=function(r){var n=[];if(!r.detail)return n;var e=r.date,t=r.yclose;for(var a in r.detail){var s=new Rt,o=r.detail[a];o&&(s.Date=e,s.Time=o[0],s.Low=s.High=s.Close=s.Open=o[1],s.YClose=t,s.Vol=o[2],s.Amount=o[3],s.Flag=o[4],c.IsNumber(s.Open)&&n.push(s))}return n};Te.JsonDataToTickDataV2=function(r){var n=[];if(!c.IsNonEmptyArray(r.data))return n;for(var e=0;e<r.data.length;++e){var t=new Rt,a=r.data[e];a&&(t.Date=a[0],t.Time=a[1],t.YClose=a[2],t.Low=t.High=t.Close=t.Open=a[3],n.push(t),a[4]&&(t.ExtendData=a[4]))}return n};function re(r,n,e){this.newMethod=Ar,this.newMethod(r,n,e),delete this.newMethod,this.ClassName="MinuteChartContainer",this.WindowIndex=new Array,this.Symbol,this.Name,this.SourceData,this.IndexBindData,this.IsAutoUpdate=!0,this.AutoUpdateFrequency=3e4,this.AutoUpdateTimer,this.TradeDate=0,this.DayCount=1,this.DayData,this.LimitPrice,this.IsShowBeforeData=!1,this.BeforeOpenData=null,this.IsBeforeData=!1,this.IsShowAfterData=!1,this.AfterCloseData=null,this.IsAfterData=!1,this.ShareAfterVol=0,this.ExtendWidth={Left:120,Right:120},this.IsShowLead=!0,this.IsShowMultiDayBeforeData=!1,this.MultiDayBeforeOpenData=null,this.IsShowMultiDayAfterData=!1,this.MultiDayAfterCloseData=null,this.MultiDayExtendWidth={Left:20,Right:20},this.ChartDrawStorage=new zC,this.ChartDrawStorageCache=null,this.MinuteApiUrl=m.Domain+"/API/Stock",this.HistoryMinuteApiUrl=m.Domain+"/API/StockMinuteData",this.ColorLineData,this.EnableSelectRect=!1,this.SelectRectDialog=null,this.CorssCursorIndex={DayIndex:-1,DataIndex:-1,Point:{X:-1,Y:-1},Type:-1},this.EnableNewIndex=!1,this.DayOffset={Offset:0,ShowDayCount:-1,DataOffset:0,DayCount:1},this.PageInfo={Enable:!1,Offset:-8888,ShowDayCount:4},this.ZoomStepPixel=50,this.SetCallCationDataBorder=function(t){if(t){var a={Left:t.Left?this.ExtendWidth.Left:0,Right:t.Right?this.ExtendWidth.Right:0};if(this.Frame.SetExtendWidth(a),t.MultiDay){var s=t.MultiDay,o={Left:s.Left?this.MultiDayExtendWidth.Left:0,Right:s.Right?this.MultiDayExtendWidth.Right:0};this.Frame.SetMultiDayMinuteWidth(o)}}},this.ReloadChartPaint=function(t){for(var a=0;a<this.ChartPaint.length;++a){var s=this.ChartPaint[a];s&&(s.ReloadResource&&s.ReloadResource(t),a==0?s.Name=="Minute-Line"&&(s.Color=m.Minute.PriceColor,s.AreaColor=m.Minute.AreaPriceColor):a==1?s.Name=="Minute-Average-Line"&&(s.Color=m.Minute.AvPriceColor):a==2&&s.Name=="Minute-Vol-Bar"&&(s.Color=m.Minute.VolBarColor))}},this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.ClickFrameButton=function(t,a){var s=this.GetEventCallback(et.ON_CLICK_FRAME_TOOLBAR);if(s&&s.Callback){var o={Info:t,PreventDefault:!1};if(s.Callback(s,o,this),o.PreventDefault)return}if(t.ID==xt.CLOSE_BEFOREOPEN_ID&&this.ShowCallAuctionData({Left:!1,Right:!1,MultiDay:{Left:!1,Right:!1}}),t.ID==xt.CLOSE_OVERLAY_INDEX){var h=t.IndexID;h&&this.DeleteOverlayWindowsIndex(h)}else if(t.ID==xt.MODIFY_OVERLAY_INDEX_PARAM){var h=t.IndexID,l=t.Frame;a.data={Chart:this,Identify:h,IsOverlay:!0},l.ModifyIndexEvent&&l.ModifyIndexEvent(a)}else if(t.ID==xt.CLOSE_INDEX_WINDOW){var l=t.Frame;this.RemoveIndexWindow(l.Identify)}else if(t.ID==xt.CHANGE_INDEX){var l=t.Frame;a.data={Chart:this,Identify:l.Identify,IsOverlay:!1},l.ChangeIndexEvent&&l.ChangeIndexEvent(a)}else if(t.ID==xt.MODIFY_INDEX_PARAM){var l=t.Frame;a.data={Chart:this,Identify:l.Identify,IsOverlay:!1},l.ModifyIndexEvent&&l.ModifyIndexEvent(a)}else if(t.ID==xt.OVERLAY_INDEX){var l=t.Frame;a.data={Chart:this,Identify:l.Identify,IsOverlay:!0},l.ChangeIndexEvent&&l.ChangeIndexEvent(a)}else if(t.ID==xt.MAX_MIN_WINDOW){var h=t.IndexID,l=t.Frame,u=t.FrameID;u>=this.Frame.ZoomStartWindowIndex&&this.ZoomIndexWindow(u,null)&&(this.Frame.SetSizeChage(!0),this.Draw())}else if(t.ID==xt.TITLE_WINDOW){var h=t.IndexID,l=t.Frame,u=t.FrameID;this.ShowIndexTitleOnly(u)&&(this.Frame.SetSizeChage(!0),this.Draw())}else if(t.ID==xt.EXPORT_DATA){var o=this.ExportData({Type:"CSV"});if(!o)return;var f=Date.now(),C="hqchart_"+this.Symbol+"_"+f+".csv",D=document.createElement("a"),v=new Blob([o],{type:"text/csv"});D.href=URL.createObjectURL(v),document.body.appendChild(D),D.setAttribute("download",C),D.click(),document.body.removeChild(D)}},this.ChartOperator=function(t){var a=t.ID;if(a===ce.OP_SCROLL_LEFT||a===ce.OP_SCROLL_RIGHT){if(this.DayCount==1||!this.PageInfo.Enable||!this.DayData)return!1;var s=a===ce.OP_SCROLL_LEFT,o=1;if(t.Step>0&&(o=t.Step),!this.DayOffset)return!1;if(s){var h=this.DayOffset.Offset;if(h+=o,h+this.DayOffset.ShowDayCount>this.DayOffset.DayCount&&(h=this.DayOffset.DayCount-this.DayOffset.ShowDayCount),h==this.DayOffset.Offset)return!1;this.DayOffset.Offset=h}else{var h=this.DayOffset.Offset;if(h-=o,h<0&&(h=0),h==this.DayOffset.Offset)return!1;this.DayOffset.Offset=h}return this.UpdateHistoryMinuteUI(null),this.SendPageChangedEvent(),!0}else if(a==ce.OP_SCROLL_GOTO){if(this.DayCount==1||!this.PageInfo.Enable||!this.DayData)return!1;if(c.IsNumber(t.ShowDayCount)&&(this.PageInfo.ShowDayCount=t.ShowDayCount,this.DayOffset.ShowDayCount=t.ShowDayCount),c.IsNumber(t.Offset)){var h=t.Offset;if(this.DayOffset.ShowDayCount>0&&h+this.DayOffset.ShowDayCount>=this.DayOffset.DayCount&&(h=this.DayOffset.DayCount-this.DayOffset.ShowDayCount),h==this.DayOffset.Offset)return!1;this.DayOffset.Offset=h}return this.UpdateHistoryMinuteUI(null),this.SendPageChangedEvent(),!0}else if(a==ce.OP_CORSSCURSOR_GOTO){if(!this.SourceData||!this.Frame||!this.Frame.SubFrame[0]||!this.Frame.SubFrame[0].Frame)return!1;var l=this.Frame.SubFrame[0].Frame;if(!c.IsNonEmptyArray(this.SourceData.Data))return!1;if(c.IsNumber(t.Time)&&c.IsNumber(t.Date)){for(var u=-1,f=null,C=null,D=0;D<this.SourceData.Data.length;++D){var v=this.SourceData.Data[D];if(c.IsNumber(v.Close)&&(C=v.Close),v.Time==t.Time&&v.Date==t.Date){u=D,f=v.Close;break}}if(u<0&&this.DayCount==1&&!(c.IsNumber(t.Type)&&t.Type>0)){for(var S=yr.GetTimeData(this.Symbol),D=0;D<S.length;++D)if(S[D]==t.Time){u=D,f=C;break}}if(u<0){if(t.Type==1){var I=-1,F=-1,E={X:I,Y:F,IsInClient:this.IsMouseOnClient(I,F)};this.LastMouseStatus.OnMouseMove=E,this.LastMouseStatus.MoveOnPoint={X:I,Y:F};var M=this.GetEventCallback(et.ON_MOUSE_MOVE),O=this.TitlePaint[0];M&&O&&(O.OnMouseMoveEvent=M);var T={clientX:I,clientY:F};this.MoveOnPoint={X:I,Y:F},this.OnMouseMove(I,F,T),this.LastMouseStatus.MoveOnPoint=null,O&&(O.OnMouseMoveEvent=null)}return}}var I=l.GetXFromIndex(u),F=l.GetYFromData(f),E={X:I,Y:F,IsInClient:this.IsMouseOnClient(I,F)};this.LastMouseStatus.OnMouseMove=E,this.LastMouseStatus.MoveOnPoint={X:I,Y:F};var M=this.GetEventCallback(et.ON_MOUSE_MOVE),O=this.TitlePaint[0];M&&O&&(O.OnMouseMoveEvent=M),this.MoveOnPoint={X:I,Y:F},this.OnMouseMove(I,F,{}),this.LastMouseStatus.MoveOnPoint=null,O&&(O.OnMouseMoveEvent=null)}},this.SendPageChangedEvent=function(){var t=this.GetEventCallback(et.ON_MINUTE_PAGE_CHANGED);if(!(!t||!t.Callback)){var a={DayOffset:this.DayOffset,DayData:this.DayData};t.Callback(t,a,this)}},this.IsMouseOnClient=function(t,a){var s=this.Frame.IsHScreen?this.Frame.ChartBorder.GetHScreenBorder():this.Frame.ChartBorder.GetBorder(),o={Left:s.Left,Top:s.Top,Right:s.Right,Bottom:s.Bottom};return t>=o.Left&&t<=o.Right&&a>=o.Top&&a<=o.Bottom},this.OnDragMode_One=function(t,a){var s=this.MouseDrag,o=t.X,h=t.Y;if(this.RectSelectDrag&&this.RectSelectDrag.Index>=0){if(o<5)return;var l={X:a.clientX,Y:a.clientY,PointIndex:this.RectSelectDrag.Index,Name:"MoveRectSelectLine"};this.MoveRectSelectPoint(l)&&(s.LastMove.X=a.clientX,this.Draw())}else{if(o<5&&h<5||!this.EnableSelectRect)return;this.UIElement.style.cursor="default";var u=s.Click.X-r.getBoundingClientRect().left,f=s.Click.Y-r.getBoundingClientRect().top,C=a.clientX-r.getBoundingClientRect().left,D=a.clientY-r.getBoundingClientRect().top;this.ShowSelectRect(u,f,C,D),s.LastMove.X=a.clientX,s.LastMove.Y=a.clientY}},this.OnMinuteSelectRectMouseUp=function(t){var a=this.MouseDrag;a.LastMove.X=t.clientX,a.LastMove.Y=t.clientY;var s=new nC,o=V();if(s.XStart=(a.Click.X-r.getBoundingClientRect().left)*o,s.YStart=(a.Click.Y-r.getBoundingClientRect().top)*o,s.XEnd=(a.LastMove.X-r.getBoundingClientRect().left)*o,s.YEnd=(a.LastMove.Y-r.getBoundingClientRect().top)*o,s.JSChartContainer=this,s.Stock={Symbol:this.Symbol,Name:this.Name},this.EnableSelectRect&&!this.BorderDrag&&this.GetSelectRectData(s)){var h=this.GetEventCallback(et.ON_SELECT_RECT),l=this.GetRectSelectPaint(),u=!0;if(h&&h.Callback){var f={X:a.LastMove.X-r.getBoundingClientRect().left,Y:a.LastMove.Y-r.getBoundingClientRect().top,SelectData:s,RectSelectPaint:l};h.Callback(h,f,this),u=!1}u&&this.SelectRectDialog?(t.data={Chart:this,X:a.LastMove.X-r.getBoundingClientRect().left,Y:a.LastMove.Y-r.getBoundingClientRect().top,SelectData:s,RectSelectPaint:l},this.SelectRectDialog.DoModal(t)):(this.HideSelectRect(),this.UpdateSelectRect(s.Start,s.End))}else this.TryClickPaintEvent(et.ON_CLICKUP_CHART_PAINT,this.ClickDownPoint,t),this.ClickEvent(t)},this.OnDragSelectRectMouseUp=function(t){var a=this.GetRectSelectPaint();if(a){var s=a.GetSelectRectData();if(s){var o=V(),h=this.ChartCorssCursor,l=h.LastPoint.X/o,u=h.LastPoint.Y/o,f=!0,C=this.GetEventCallback(et.ON_DRAG_SELECT_RECT_MOUSEUP);if(C){var D={X:l,Y:u,SelectData:s,RectSelectPaint:a,IsShowDialog:!1};C.Callback(C,D,this),f=D.IsShowDialog}f&&this.SelectRectDialog&&(t.data={Chart:this,X:l,Y:u,SelectData:s,RectSelectPaint:a},this.SelectRectDialog.DoModal(t))}}},this.UpdateSelectRect=function(t,a){if(!(!this.SourceData||!this.SourceData.Data)){var s=this.GetRectSelectPaint();if(s){var o=this.SourceData;if(!(!o||!c.IsNonEmptyArray(o.Data))){var h=o.Data.length,l=o.Data[t];a>=h&&(a=h-1);var u=o.Data[a];X.Chart.Log("[MinuteChartContainer::UpdateSelectRect]",l,u),s.SetPoint(l,{Index:0}),s.SetPoint(u,{Index:1}),this.Draw()}}}},this.MoveRectSelectPoint=function(t){var a=this.GetRectSelectPaint();if(!a||!this.SourceData||!this.SourceData.Data)return!1;var s=this.SourceData;if(!this.Frame.SubFrame[0])return!1;var o=this.Frame.SubFrame[0].Frame,h=V(),l=(t.X-r.getBoundingClientRect().left)*h,u=o.GetXData(l);u=parseInt(u.toFixed(0));var f=u+s.DataOffset;f>=s.Data.length&&(f=s.Data.length-1);var C=s.Data[f];if(X.Chart.Log("[MinuteChartContainer::MoveRectSelectPoint] point, item",t.PointIndex,C),!a.SetPoint(C,{Index:t.PointIndex}))return!1;var D=this.GetEventCallback(et.ON_DRAG_SELECT_RECT);if(D){var v=a.GetSelectRectData(),S={X:t.X,Y:t.Y,SelectData:v,RectSelectPaint:a};D.Callback(D,S,this)}return!0},this.GetLastCursorIndex=function(t){if(t.DataType==1)for(var a=t.Data.length-1;a>=0;--a){var s=t.Data[a];if(!(!s||!s.DayItem||!s.DayItem.Data)){t.IndexData.DayIndex=0,t.IndexData.DataIndex=s.DayItem.Data.length-1,t.IndexData.Type=s.Type;return}}else if(t.DataType==2)for(var a=t.Data.length-1;a>=0;--a)for(var o=t.Data[a],h=o.length-1;h>=0;--h){var s=o[h];if(!(!s||!s.DayItem||!s.DayItem.Data)){t.IndexData.DayIndex=a,t.IndexData.DataIndex=s.DayItem.Data.length-1,t.IndexData.Type=s.Type;return}}},this.GetFirstCursorIndex=function(t){if(t.DataType==1)for(var a=0;a<t.Data.length;++a){var s=t.Data[a];if(!(!s||!s.DayItem||!s.DayItem.Data)){t.IndexData.DayIndex=0,t.IndexData.DataIndex=0,t.IndexData.Type=s.Type;return}}else if(t.DataType==2)for(var a=0;a<t.Data.length;++a)for(var o=t.Data[a],h=0;h<o.length;++h){var s=o[h];if(!(!s||!s.DayItem||!s.DayItem.Data)){t.IndexData.DayIndex=a,t.IndexData.DataIndex=0,t.IndexData.Type=s.Type;return}}},this.GetAfterCloseData=function(){var t=null;return this.AfterCloseData&&this.IsShowAfterData&&(t=this.AfterCloseData),t},this.GetBeforeOpenData=function(){var t=null;return this.BeforeOpenData&&this.IsShowBeforeData&&(t=this.BeforeOpenData),t},this.MoveCorssCursorIndex=function(t){if(!this.EnableNewIndex||!this.Frame.SubFrame[0]||!this.Frame.SubFrame[0].Frame)return!1;var a=this.Frame.SubFrame[0].Frame;if(this.CorssCursorIndex.Type==1||this.CorssCursorIndex.Type==2||this.CorssCursorIndex.Type==3||this.CorssCursorIndex.Type==-1){var s=[],o=this.GetBeforeOpenData();s.push({DayItem:o,Type:2});var o=null;this.SourceData&&(o=this.SourceData),s.push({DayItem:o,Type:1});var o=this.GetAfterCloseData();s.push({DayItem:o,Type:3});var h={DataType:1,Data:s,IndexData:this.CorssCursorIndex,Point:{X:null,Y:null}},l=1;if(t.IsMoveLeft){if(this.CorssCursorIndex.DayIndex<0&&this.CorssCursorIndex.DataIndex<0&&(this.GetLastCursorIndex(h),l=0),a.MoveXIndexLeft(l,h)){this.LastPoint.X=h.Point.X,this.LastPoint.Y=h.Point.Y,this.CorssCursorIndex.Type==1&&(this.CursorIndex=this.CorssCursorIndex.CursorIndex);var t={ParentFunction:"MoveCorssCursorIndex",Point:{X:h.Point.X,Y:h.Point.Y},IsPhone:!1,ClientPos:this.CorssCursorIndex.Type};this.DrawDynamicInfo(t)}}else if(this.CorssCursorIndex.DayIndex<0&&this.CorssCursorIndex.DataIndex<0&&(this.GetFirstCursorIndex(h),l=0),a.MoveXIndexRight(l,h)){this.LastPoint.X=h.Point.X,this.LastPoint.Y=h.Point.Y,this.CorssCursorIndex.Type==1&&(this.CursorIndex=this.CorssCursorIndex.CursorIndex);var t={ParentFunction:"MoveCorssCursorIndex",Point:{X:h.Point.X,Y:h.Point.Y},IsPhone:!1,ClientPos:this.CorssCursorIndex.Type};this.DrawDynamicInfo(t)}}else if(this.CorssCursorIndex.Type==10||this.CorssCursorIndex.Type==20||this.CorssCursorIndex.Type==30||this.CorssCursorIndex.Type==-2){var s=[],u=0,f=this.DayData.length;this.DayOffset&&(c.IsNumber(this.DayOffset.Offset)&&(u=this.DayOffset.Offset),c.IsNumber(this.DayOffset.ShowDayCount)&&(f=this.DayOffset.ShowDayCount));for(var C=u,D=0;C<this.DayData.length&&D<f;++C,++D){var v=[],o=null;this.MultiDayBeforeOpenData&&this.IsShowMultiDayBeforeData&&(o=this.MultiDayBeforeOpenData[C]),v.push({DayItem:o,Type:20});var o=null;this.DayData&&(o=this.DayData[this.DayData.length-1-C]),v.push({DayItem:o,Type:10});var o=null;this.MultiDayAfterCloseData&&this.IsShowMultiDayAfterData&&(o=this.MultiDayAfterCloseData[C]),v.push({DayItem:o,Type:30}),s.push(v)}var h={DataType:2,Data:s,IndexData:this.CorssCursorIndex,Point:{X:null,Y:null}},l=1;if(t.IsMoveLeft){if(this.CorssCursorIndex.DayIndex<0&&this.CorssCursorIndex.DataIndex<0&&(this.GetLastCursorIndex(h),l=0),a.MoveXIndexLeft(l,h)){this.LastPoint.X=h.Point.X,this.LastPoint.Y=h.Point.Y,this.CorssCursorIndex.Type==10&&(this.CursorIndex=this.CorssCursorIndex.CursorIndex);var t={ParentFunction:"MoveCorssCursorIndex",Point:{X:h.Point.X,Y:h.Point.Y},IsPhone:!1,ClientPos:null};this.CorssCursorIndex.Type==10?t.ClientPos=1:this.CorssCursorIndex.Type==20?t.ClientPos=this.CorssCursorIndex.DayIndex+200:this.CorssCursorIndex.Type==30&&(t.ClientPos=this.CorssCursorIndex.DayIndex+300),this.DrawDynamicInfo(t)}}else if(this.CorssCursorIndex.DayIndex<0&&this.CorssCursorIndex.DataIndex<0&&(this.GetFirstCursorIndex(h),l=0),a.MoveXIndexRight(l,h)){this.LastPoint.X=h.Point.X,this.LastPoint.Y=h.Point.Y,this.CorssCursorIndex.Type==10&&(this.CursorIndex=this.CorssCursorIndex.CursorIndex);var t={ParentFunction:"MoveCorssCursorIndex",Point:{X:h.Point.X,Y:h.Point.Y},IsPhone:!1,ClientPos:null};this.CorssCursorIndex.Type==10?t.ClientPos=1:this.CorssCursorIndex.Type==20?t.ClientPos=this.CorssCursorIndex.DayIndex+200:this.CorssCursorIndex.Type==30&&(t.ClientPos=this.CorssCursorIndex.DayIndex+300),this.DrawDynamicInfo(t)}}},this.SetCorssCursorIndex=function(t){if(this.EnableNewIndex&&(X.Chart.Log("[MinuteChartContainer::SetCorssCursorIndex] option ",t),t.ParentFunction=="OnMouseMove")){this.CorssCursorIndex.Point.X=t.Point.X,this.CorssCursorIndex.Point.Y=t.Point.Y;var a=this.PtInClient_V2(t.Point.X,t.Point.Y);if(X.Chart.Log("[MinuteChartContainer::SetCorssCursorIndex] clientPos ",a),a<=0){this.CorssCursorIndex={DayIndex:-1,DataIndex:-1,Point:{X:-1,Y:-1},Type:a};return}if(!this.Frame.SubFrame[0]||!this.Frame.SubFrame[0].Frame){this.CorssCursorIndex={DayIndex:-1,DataIndex:-1,Point:{X:-1,Y:-1},Type:-1};return}var s=this.Frame.SubFrame[0].Frame;if(a==1||a==2||a==3){if(this.CorssCursorIndex.DayIndex=0,this.CorssCursorIndex.Type=a,a==2)s.GetLeftExtendXValidData(t.Point.X,{Data:this.BeforeOpenData,IndexData:this.CorssCursorIndex});else if(a==3)s.GetRightExtendXValidData(t.Point.X,{Data:this.AfterCloseData,IndexData:this.CorssCursorIndex});else if(a==1){var o=s.GetXData(t.Point.X);this.CorssCursorIndex.DataIndex=parseInt(o.toFixed(0))}}else if(a>=100&&a<=199){this.CorssCursorIndex.DayIndex=a-100,this.CorssCursorIndex.Type=10;var o=s.GetXData(t.Point.X),h=parseInt(o.toFixed(0));this.CorssCursorIndex.DataIndex=h%s.MinuteCount}else if(a>=200&&a<=299){this.CorssCursorIndex.DayIndex=a-200,this.CorssCursorIndex.Type=20;var l=this.MultiDayBeforeOpenData;if(this.DayOffset){var u=0,f=this.MultiDayBeforeOpenData.length;c.IsNumber(this.DayOffset.Offset)&&(u=this.DayOffset.Offset),c.IsNumber(this.DayOffset.ShowDayCount)&&(f=this.DayOffset.ShowDayCount),l=this.MultiDayBeforeOpenData.slice(u,u+f)}s.GetLeftExtendXValidData(t.Point.X,{Data:l,IndexData:this.CorssCursorIndex})}else if(a>=300&&a<=399){this.CorssCursorIndex.DayIndex=a-300,this.CorssCursorIndex.Type=30;var l=this.MultiDayAfterCloseData;if(this.DayOffset&&this.MultiDayAfterCloseData){var u=0,f=this.MultiDayAfterCloseData.length;c.IsNumber(this.DayOffset.Offset)&&(u=this.DayOffset.Offset),c.IsNumber(this.DayOffset.ShowDayCount)&&(f=this.DayOffset.ShowDayCount),l=this.MultiDayAfterCloseData.slice(u,u+f)}s.GetRightExtendXValidData(t.Point.X,{Data:l,IndexData:this.CorssCursorIndex})}this.LastPoint.X=this.CorssCursorIndex.Point.X,t.Point.X=this.CorssCursorIndex.Point.X}},this.PtInClient_V2=function(t,a){if(this.Canvas.beginPath(),this.Frame.IsHScreen===!0){var s=this.Frame.ChartBorder.GetHScreenBorder();this.Canvas.rect(s.Left,s.TopEx,s.Right-s.Left,s.BottomEx-s.TopEx)}else{var s=this.Frame.ChartBorder.GetBorder();if(s.DayBorder){for(var o=0;o<s.DayBorder.length;++o){var h=s.DayBorder[o];if(this.Canvas.beginPath(),this.Canvas.rect(h.LeftEx,s.TopEx,h.RightEx-h.LeftEx,s.BottomEx-s.TopEx),this.Canvas.isPointInPath(t,a))return 100+o;if(this.Canvas.beginPath(),this.Canvas.rect(h.Left,s.TopEx,h.LeftEx-h.Left,s.BottomEx-s.TopEx),this.Canvas.isPointInPath(t,a))return 200+o;if(this.Canvas.beginPath(),this.Canvas.rect(h.RightEx,s.TopEx,h.Right-h.RightEx,s.BottomEx-s.TopEx),this.Canvas.isPointInPath(t,a))return 300+o}return-2}this.Canvas.rect(s.LeftEx,s.Top,s.RightEx-s.LeftEx,s.Bottom-s.Top)}return this.Canvas.isPointInPath(t,a)?1:this.Frame.ChartBorder.LeftExtendWidth>10&&(this.Canvas.beginPath(),this.Frame.IsHScreen===!0?this.Canvas.rect(s.Left,s.Top,s.Right-s.Left,s.TopEx-s.Top):this.Canvas.rect(s.Left,s.Top,s.LeftEx-s.Left,s.Bottom-s.Top),this.Canvas.isPointInPath(t,a))?2:this.Frame.ChartBorder.RightExtendWidth>10&&(this.Canvas.beginPath(),this.Frame.IsHScreen===!0?this.Canvas.rect(s.Left,s.BottomEx,s.Right-s.Left,s.Bottom-s.BottomEx):this.Canvas.rect(s.RightEx,s.Top,s.Right-s.RightEx,s.Bottom-s.Top),this.Canvas.isPointInPath(t,a))?3:-1},this.OnTouchStart=function(t){if(this.DragMode!=0&&!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){if(this.IsOnTouch=!0,this.TouchDrawCount=0,this.PhonePinch=null,this.StopDragTimer(),this.EnableScrollUpDown==!1&&t.preventDefault(),this.IsPhoneDragging(t)){var a={Click:{},LastMove:{}},s=this.GetToucheData(t,this.IsForceLandscape),o=this.PointAbsoluteToRelative(s[0].clientX,s[0].clientY,!0);if(this.TryClickLock||this.TryClickIndexTitle){var h=o.X,l=o.Y;if(this.TryClickLock&&this.TryClickLock(h,l)||this.TryClickIndexTitle&&this.TryClickIndexTitle(h,l))return}a.Click.X=s[0].clientX,a.Click.Y=s[0].clientY,a.LastMove.X=s[0].clientX,a.LastMove.Y=s[0].clientY;var u=this,f=function(){if(u.ChartCorssCursor.IsShow===!0){var F=V(),E=a.Click.X-r.getBoundingClientRect().left*F,M=a.Click.Y-r.getBoundingClientRect().top*F;u.OnMouseMove(E,M,t)}};if(this.ChartDrawOption.IsLockScreen)if(this.MouseDrag=a,this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.IsSelected=!1),this.SelectChartDrawPicture=null,this.CurrentChartDrawPicture){var C=this.CurrentChartDrawPicture;C.Status==2?this.SetChartDrawPictureThirdPoint(a.Click.X,a.Click.Y,!0):(this.SetChartDrawPictureFirstPoint(a.Click.X,a.Click.Y,!0),this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo({Corss:!1,Tooltip:!1})),t.cancelable&&t.preventDefault();return}else{var D={};if(D.X=s[0].clientX-r.getBoundingClientRect().left,D.Y=s[0].clientY-r.getBoundingClientRect().top,this.GetChartDrawPictureByPoint(D)){D.ChartDrawPicture.Status=20,D.ChartDrawPicture.ValueToPoint(),D.ChartDrawPicture.MovePointIndex=D.PointIndex,D.ChartDrawPicture.IsSelected=!0,this.CurrentChartDrawPicture=D.ChartDrawPicture,this.SelectChartDrawPicture=D.ChartDrawPicture;var v=this.GetEventCallback(et.ON_CLICK_DRAWPICTURE);if(v&&v.Callback){var S={DrawPicture:D.ChartDrawPicture};v.Callback(v,S,this)}t.cancelable&&t.preventDefault();return}}else this.EnableScrollUpDown==!0&&(this.DragTimer=setTimeout(function(){a.Click.X==a.LastMove.X&&a.Click.Y==a.LastMove.Y&&(u.MouseDrag,u.MouseDrag=null,f(),u.PreventTouchEvent(t))},800)),this.MouseDrag=a,this.PhoneTouchInfo={Start:{X:s[0].clientX,Y:s[0].clientY},End:{X:s[0].clientX,Y:s[0].clientY}},this.SelectChartDrawPicture=null,this.EnableScrollUpDown==!1&&f();this.EnableZoomIndexWindow&&(this.PhoneDBClick.AddTouchStart(s[0].clientX,s[0].clientY,Date.now()),X.Chart.Log("[MinuteChartContainer::OnTouchStart] PhoneDBClick ",this.PhoneDBClick)),this.TouchEvent({EventID:et.ON_PHONE_TOUCH,FunctionName:"OnTouchStart"},t)}else if(this.IsPhonePinching(t)){var T={Start:{},Last:{}},s=this.GetToucheData(t,this.IsForceLandscape);T.Start={X:s[0].pageX,Y:s[0].pageY,X2:s[1].pageX,Y2:s[1].pageY},T.Last={X:s[0].pageX,Y:s[0].pageY,X2:s[1].pageX,Y2:s[1].pageY},this.PhonePinch=T,this.SelectChartDrawPicture=null}}},this.OnTouchMove=function(t){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var a=this.GetToucheData(t,this.IsForceLandscape);if(this.IsPhoneDragging(t)){var s=this.MouseDrag;if(s==null){var o=V(),h=a[0].clientX-r.getBoundingClientRect().left*o,l=a[0].clientY-r.getBoundingClientRect().top*o;this.OnMouseMove(h,l,t)}else{var u=this.GetMoveAngle(s.LastMove,{X:a[0].clientX,Y:a[0].clientY}),f=Math.abs(s.LastMove.X-a[0].clientX),C=Math.abs(s.LastMove.Y-a[0].clientY);if(f=parseInt(f),this.CurrentChartDrawPicture){var D=this.CurrentChartDrawPicture;if(D.Status==1||D.Status==2){if(f<5&&C<5)return;this.SetChartDrawPictureSecondPoint(a[0].clientX,a[0].clientY,!0)&&this.DrawDynamicInfo()}else if(D.Status==3)this.SetChartDrawPictureThirdPoint(a[0].clientX,a[0].clientY,!0)&&this.DrawDynamicInfo();else if(D.Status==20){if(f<5&&C<5)return;this.MoveChartDrawPicture(a[0].clientX-s.LastMove.X,a[0].clientY-s.LastMove.Y,!0)&&this.DrawDynamicInfo()}s.LastMove.X=a[0].clientX,s.LastMove.Y=a[0].clientY}else{if((C>0&&f<=3||u<=this.TouchMoveMinAngle)&&this.EnableScrollUpDown==!0){this.StopDragTimer();return}this.PreventTouchEvent(t),this.MouseDrag=null;var o=V(),h=a[0].clientX-r.getBoundingClientRect().left*o,l=a[0].clientY-r.getBoundingClientRect().top*o;this.OnMouseMove(h,l,t)}}this.PhoneTouchInfo&&(this.PhoneTouchInfo.End.X=a[0].clientX,this.PhoneTouchInfo.End.Y=a[0].clientY)}else if(this.IsPhonePinching(t)){this.PreventTouchEvent(t);var v=this.PhonePinch;if(!v)return;var S=Math.abs(a[0].pageY-a[1].pageY),T=Math.abs(v.Last.Y-v.Last.Y2),I=S-T,F=Math.abs(a[0].pageX-a[1].pageX),E=Math.abs(v.Last.X-v.Last.X2),M=F-E,O=this.ZoomStepPixel;if(Math.abs(M)>O){var R=this.GetEventCallback(et.ON_MINUTE_TOUCH_ZOOM);if(R&&R.Callback){var b={XStep:M,YStep:I,PreventDefault:!1};if(R.Callback(R,b,this),b.PreventDefault){this.PhonePinch=null,this.StopDragTimer();return}}}v.Last={X:a[0].pageX,Y:a[0].pageY,X2:a[1].pageX,Y2:a[1].pageY}}this.EnableScrollUpDown==!1?t.preventDefault():s==null?this.PreventTouchEvent(t):this.StopDragTimer()}},this.OnTouchEnd=function(t){if(X.Chart.Log("[MinuteChartContainer::OnTouchEnd]",t),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){if(this.CurrentChartDrawPicture){var a=this.CurrentChartDrawPicture;a.Status==2||a.Status==1||a.Status==3?(a.PointStatus=a.Status,this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo()):a.Status==20&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}if(this.EnableZoomIndexWindow){var s=Date.now();this.PhoneDBClick.AddTouchEnd(s),this.PhoneDBClick.IsVaildDBClick()&&(this.OnTouchDBClick(this.PhoneDBClick.Start),this.PhoneDBClick.Clear())}this.IsOnTouch=!1,this.StopDragTimer(),this.TouchEvent({EventID:et.ON_PHONE_TOUCH,FunctionName:"OnTouchEnd"},t),this.OnTouchFinished(),this.TouchDrawCount=0}},this.OnKeyDown=function(t){if(this.StopDisplayLatest(),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var a=t.keyCode?t.keyCode:t.which;switch(a){case 37:if(this.EnableNewIndex)this.MoveCorssCursorIndex({IsMoveLeft:!0});else{if(!c.IsNumber(this.CursorIndex)){var s=0;this.Frame.XPointCount?s=this.Frame.XPointCount:s=this.Frame.SubFrame[0].Frame.XPointCount,this.CursorIndex=s-1}if(this.CursorIndex=parseInt(this.CursorIndex),this.CursorIndex<=.99999){if(!this.DataMoveLeft())break;this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw()}else--this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo()}break;case 39:if(this.EnableNewIndex)this.MoveCorssCursorIndex({IsMoveLeft:!1});else{var s=0;if(this.Frame.XPointCount?s=this.Frame.XPointCount:s=this.Frame.SubFrame[0].Frame.XPointCount,c.IsNumber(this.CursorIndex)||(this.CursorIndex=0),this.CursorIndex=parseInt(this.CursorIndex),this.CursorIndex+1>=s){if(!this.DataMoveRight())break;this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw()}else{var o=null;if(this.Frame.Data?o=this.Frame.Data:o=this.Frame.SubFrame[0].Frame.Data,!o||this.CursorIndex+o.DataOffset+1>=o.Data.length)break;++this.CursorIndex,this.UpdatePointByCursorIndex(),this.DrawDynamicInfo()}}break;case 46:if(this.SelectChartDrawPicture){var h=this.SelectChartDrawPicture;X.Chart.Log(h,"drawPicturedrawPicturedrawPicture"),this.SelectChartDrawPicture=null,this.ClearChartDrawPicture(h)}else if(this.SelectedChart&&this.SelectedChart.Selected.Identify){var l=this.GetSelectedChartInfo(this.SelectedChart.Selected);l&&(l.Type==Ge.OVERLAY_INDEX?this.DeleteOverlayWindowsIndex(l.IndexID):l.Type==Ge.OVERLAY_MINUTE&&this.DeleteOverlaySymbol(l.Symbol))}break;case 32:this.OnMarkRectSelect(t);break;case 33:if(this.PageInfo.Enable){var u={ID:ce.OP_SCROLL_LEFT,Step:this.PageInfo.ShowDayCount};this.ChartOperator(u)}break;case 34:if(this.PageInfo.Enable){var u={ID:ce.OP_SCROLL_RIGHT,Step:this.PageInfo.ShowDayCount};this.ChartOperator(u)}break;default:return}t.preventDefault?t.preventDefault():t.returnValue=!1}},this.OnMarkRectSelect=function(t){var a=this.ChartCorssCursor;if(!(!a||a.Status==0)&&c.IsNumber(a.CursorIndex)&&!(!this.SourceData||!this.SourceData.Data)){var s=this.GetRectSelectPaint();if(s){var o=a.CursorIndex;X.Chart.Log("[MinuteChartContainer::OnMarkRectSelect] dataIndex",o);var h=this.SourceData;o=parseInt(o.toFixed(0));var l=o+h.DataOffset;l>=h.Data.length&&(l=h.Data.length-1);var u=h.Data[l];if(X.Chart.Log("[MinuteChartContainer::OnMarkRectSelect] item",u),!!this.SetRectSelectData(u)){var f=s.GetPointCount(),C=V();if(f==1){var D=this.GetEventCallback(et.ON_KEYDOWN_SELECT_RECT_FIRST);if(D&&D.Callback){var v={X:a.LastPoint.X/C,Y:a.LastPoint.Y/C,Item:u,Index:l,RectSelectPaint:s};D.Callback(D,v,this)}}else if(f==2){var S=s.GetSelectRectData(),D=this.GetEventCallback(et.ON_KEYDOWN_SELECT_RECT);if(D&&D.Callback){var v={X:a.LastPoint.X/C,Y:a.LastPoint.Y/C,SelectData:S,RectSelectPaint:s};D.Callback(D,v,this)}this.SelectRectDialog&&(t.data={Chart:this,X:a.LastPoint.X/C,Y:a.LastPoint.Y/C,SelectData:S,RectSelectPaint:s},this.SelectRectDialog.DoModal(t))}this.Draw()}}}},this.OnRightMenu=function(t,a,s){if(this.RightMenu){var o=this.Frame.PtInFrame(t,a);s.data={Chart:this,FrameID:o},this.RightMenu.DoModal(s)}var h=this.GetEventCallback(et.ON_CONTEXT_MENU);if(h){var o=this.Frame.PtInFrame(t,a),l={X:t,Y:a,Event:s,FrameID:o};h.Callback(h,l,this)}},this.OnWheel=function(t){X.Chart.Log("[MinuteChartContainer::OnWheel]",t)},this.OnDoubleClick=function(t,a,s){X.Chart.Log("[MinuteChartContainer::OnDoubleClick]",s),this.ClickChartTimer!=null&&(clearTimeout(this.ClickChartTimer),this.ClickChartTimer=null);var o;this.SelectedChart.EnableSelected&&(o=this.PtInChart(t,a));var h={SelectedChart:o};if(this.DBClickEvent(h,s),!o&&this.EnableZoomIndexWindow){var l=this.Frame.PtInFrame(t,a);X.Chart.Log("[MinuteChartContainer::OnDoubleClick] frameId",l),l>=this.Frame.ZoomStartWindowIndex&&this.ZoomIndexWindow(l,{X:t,Y:a})&&(this.Frame.SetSizeChage(!0),this.Draw())}},this.GetDataItem=function(t){if(!t||!c.IsNumber(t.Index)||!this.SourceData||!this.SourceData.Data)return null;var a=this.SourceData,s=t.ClientPos;if(s==2||s==3||s>=200&&s<=299||s>=300&&s<=399){if(!this.ChartCorssCursor||!this.ChartCorssCursor.CallAcutionXOperator)return null;var o=this.Frame.IsHScreen===!0,h=this.ChartCorssCursor.CallAcutionXOperator;if(h.Value=o?t.Point.Y:t.Point.X,h.Point={X:t.Point.X,Y:t.Point.Y},h.ClientPos=s,s==2){if(!this.BeforeOpenData)return null}else if(s==3){if(!this.AfterCloseData)return null}else if(s>=200&&s<=299){if(!this.MultiDayBeforeOpenData||!c.IsNonEmptyArray(this.MultiDayBeforeOpenData))return}else if(s>=300&&tclientPos<=399&&(!this.MultiDayAfterCloseData||!c.IsNonEmptyArray(this.MultiDayAfterCloseData)))return;if(h.Operator()){var f=h.Item;return{Type:s,Item:f,Index:h.DataIndex}}return null}var l=parseInt(t.Index.toFixed(0)),u=l+a.DataOffset;if(u>=a.Data.length)return null;var f=a.Data[u];return{Type:s,Item:f,Index:u}},this.UpdatePointByCursorIndex=function(){this.LastPoint.X=this.Frame.GetXFromIndex(this.CursorIndex);var t=this.CursorIndex;t=parseInt(t.toFixed(0));var a=this.Frame.SourceData;if(!(a.DataOffset+t>=a.Data.length)){var s=a.Data[a.DataOffset+t],o=null;s.Before?o=s.Before.Close:o=s.Close,this.LastPoint.Y=this.Frame.GetYFromData(o)}},this.Create=function(t,a){var s=this;this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new gs,this.ChartCorssCursor.PtInClient=function(C,D){return s.PtInClient(C,D)},this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=ze.Create("CorssCursor_Minute_XStringFormat"),this.ChartCorssCursor.StringFormatX.GetEventCallback=function(C){return s.GetEventCallback(C)},this.ChartCorssCursor.StringFormatY=ze.Create("CorssCursor_YStringFormat"),this.ChartCorssCursor.StringFormatY.GetEventCallback=function(C){return s.GetEventCallback(C)},this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY.ShareAfterVol=this.ShareAfterVol,this.ChartCorssCursor.CallAcutionXOperator=new Zo,this.ChartSplashPaint=new Qa,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.HQChart=this,this.Frame=new yh,this.Frame.ChartBorder=new We,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=25,this.Frame.ChartBorder.TitleHeight=0,this.Frame.ChartBorder.Left=50,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.Frame.GetExtendChartRightWidth=function(){return s.GetExtendChartRightWidth()},this.Frame.GetEventCallback=function(C){return s.GetEventCallback(C)},this.Frame.ZoomStartWindowIndex=2,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(t),this.CreateMainKLine(),this.CreateExtendChart("RectSelectPaint",a?a.SelectRect:null),this.EnableIndexChartDrag&&this.CreateExtendChart("DragMovePaint");for(var o in this.Frame.SubFrame){var h=new za;h.Frame=this.Frame.SubFrame[o].Frame,h.Canvas=this.Canvas,h.LanguageID=this.LanguageID,h.GetEventCallback=function(C){return s.GetEventCallback(C)},h.SelectedChart=this.SelectedChart,this.TitlePaint.push(h)}this.ChartCorssCursor.StringFormatX.Frame=this.Frame.SubFrame[0].Frame,this.ChartCorssCursor.StringFormatY.Frame=this.Frame,this.ChartCorssCursor.CallAcutionXOperator&&(this.ChartCorssCursor.CallAcutionXOperator.Frame=this.Frame.SubFrame[0].Frame);var l=!0,u=!0;if(a&&a.Listener){var f=a.Listener;f.KeyDown===!1&&(l=!1,X.Chart.Log("[MinuteChartContainer::Create] not register keydown event.")),f.Wheel===!1&&(u=!1,X.Chart.Log("[MinuteChartContainer::Create] not register wheel event."))}l&&this.UIElement.addEventListener("keydown",function(C){s.OnKeyDown(C)},!0),u&&this.UIElement.addEventListener("wheel",function(C){s.OnWheel(C)},!0)},this.CreateChildWindow=function(t){for(var a=this,s=this.GetEventCallback(et.ON_CREATE_FRAME),o=0;o<t;++o){var h=new We;h.UIElement=this.UIElement;var l=new Zn;l.Canvas=this.Canvas,l.ChartBorder=h,l.Identify=o,l.GlobalOption=this.GlobalOption,o<2&&(l.ChartBorder.TitleHeight=0),l.XPointCount=243,o>=2&&(this.ModifyIndexDialog&&(l.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(l.ChangeIndexEvent=this.ChangeIndexDialog.DoModal));var u=[9,8,7,6,5,4,3,2,1];l.HorizontalMax=u[0],l.HorizontalMin=u[u.length-1],o==0?(l.YSplitOperator=new GC,l.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price"),l.YSplitOperator.GetEventCallback=function(v){return a.GetEventCallback(v)},l.YSplitOperator.DayOffset=this.DayOffset,l.YSplitOperator.GlobalOption=this.GlobalOption,l.YSplitOperator.HQChart=this):(l.YSplitOperator=new Pa,l.YSplitOperator.LanguageID=this.LanguageID,l.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),l.YSplitOperator.GetEventCallback=function(v){return a.GetEventCallback(v)},o==1&&(l.YSplitOperator.ShareAfterVol=this.ShareAfterVol)),l.YSplitOperator.Frame=l,l.YSplitOperator.ChartBorder=h,l.XSplitOperator=new zo,l.XSplitOperator.Frame=l,l.XSplitOperator.ChartBorder=h,l.XSplitOperator.DayOffset=this.DayOffset,l.XSplitOperator.GetEventCallback=function(v){return a.GetEventCallback(v)},o!=t-1&&(l.XSplitOperator.ShowText=!1),l.XSplitOperator.Operator();for(var f in u)l.HorizontalInfo[f]=new Ht,l.HorizontalInfo[f].Value=u[f],!(o==0&&f==l.HorizontalMin)&&(l.HorizontalInfo[f].Message[1]=u[f].toString(),l.HorizontalInfo[f].Font="14px 微软雅黑");var C=new dr;if(C.Frame=l,o==0?C.Height=20:C.Height=10,this.Frame.SubFrame[o]=C,s&&s.Callback){var D={SubFrame:this.Frame.SubFrame[o],WindowIndex:o};s.Callback(s,D,this)}}},this.CreateSubFrameItem=function(t,a){var s=this,o=new We;if(o.UIElement=this.UIElement,a&&a.ChartBorder&&a.ChartBorder.MultiDayMinute){var h=a.ChartBorder.MultiDayMinute;o.MultiDayMinute.Count=h.Count,o.MultiDayMinute.Left=h.Left,o.MultiDayMinute.Right=h.Right}var l=new Zn;l.Canvas=this.Canvas,l.ChartBorder=o,l.Identify=t,l.XPointCount=243,l.GlobalOption=this.GlobalOption,t>=2&&(this.ModifyIndexDialog&&(l.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(l.ChangeIndexEvent=this.ChangeIndexDialog.DoModal));var u=[9,8,7,6,5,4,3,2,1];l.HorizontalMax=u[0],l.HorizontalMin=u[u.length-1],l.YSplitOperator=new Pa,l.YSplitOperator.LanguageID=this.LanguageID,l.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),l.YSplitOperator.Frame=l,l.YSplitOperator.ChartBorder=o,l.XSplitOperator=new zo,l.XSplitOperator.Frame=l,l.XSplitOperator.ChartBorder=o,l.XSplitOperator.ShowText=!1,l.XSplitOperator.DayOffset=this.DayOffset,l.XSplitOperator.GetEventCallback=function(T){return s.GetEventCallback(T)},l.YSplitOperator.GetEventCallback=function(T){return s.GetEventCallback(T)},l.XSplitOperator.Symbol=this.Symbol,this.DayCount>1&&(l.XSplitOperator.DayCount=this.DayData.length,l.XSplitOperator.DayData=this.DayData,l.DayCount=this.DayData.length);var f=this.Frame.SubFrame[0].Frame.XPointCount;l.XPointCount=f,l.Data=this.ChartPaint[0].Data;for(var C in u)l.HorizontalInfo[C]=new Ht,l.HorizontalInfo[C].Value=u[C],l.HorizontalInfo[C].Message[1]=u[C].toString(),l.HorizontalInfo[C].Font="14px 微软雅黑";var D=new dr;D.Frame=l,D.Height=10;var v=this.GetEventCallback(et.ON_CREATE_FRAME);if(v&&v.Callback){var S={SubFrame:D,WindowIndex:t};v.Callback(v,S,this)}return D},this.AddNewSubFrame=function(t){var a=this,s=this.Frame.SubFrame[0].Frame,o=this.Frame.SubFrame.length,h=this.CreateSubFrameItem(o,s),l=V();h.Frame.ChartBorder.TitleHeight*=l,this.Frame.SubFrame[o]=h;var u=new za;u.Frame=this.Frame.SubFrame[o].Frame,u.Canvas=this.Canvas,u.LanguageID=this.LanguageID,u.GetEventCallback=function(D){return a.GetEventCallback(D)},this.TitlePaint[o+1]=u,this.SetSubFrameOption(h,t);for(var f=0;f<this.Frame.SubFrame.length;++f){var C=this.Frame.SubFrame[f].Frame;f==this.Frame.SubFrame.length-1?C.XSplitOperator.ShowText=!0:C.XSplitOperator.ShowText=!1}return this.UpdataDataoffset(),this.Frame.SetSizeChage(!0),this.UpdateXShowText&&this.UpdateXShowText(),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw(),o},this.UpdateXShowText=function(){for(var t=!0,a=this.Frame.SubFrame.length-1;a>=0;--a){var s=this.Frame.SubFrame[a].Frame,o=this.Frame.SubFrame[a];t?(s.XSplitOperator.ShowText=!0,o.Height>0&&(t=!1)):s.XSplitOperator.ShowText=!1}},this.DeleteIndexPaint=function(t,a){var s=new Array;for(var o in this.ChartPaint){var h=this.ChartPaint[o];o==0||h.ChartFrame!=this.Frame.SubFrame[t].Frame?s.push(h):a===!0&&h&&h.OnDestroy&&h.OnDestroy()}var l=this.Frame.SubFrame[t].Frame;l.YSpecificMaxMin=null,l.IsLocked=!1,l.YSplitOperator.SplitType=l.YSplitOperator.DefaultSplitType,this.ChartPaint=s;var u=t+1;this.TitlePaint[u].Data=[],this.TitlePaint[u].Title=null},this.CreateStockInfo=function(){this.ExtendChartPaint[0]=new md,this.ExtendChartPaint[0].Canvas=this.Canvas,this.ExtendChartPaint[0].ChartBorder=this.Frame.ChartBorder,this.ExtendChartPaint[0].ChartFrame=this.Frame,this.Frame.ChartBorder.Right=300},this.CreateMainKLine=function(){var t=this,a=qn.Create("ChartMinutePriceLine");a.Canvas=this.Canvas,a.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,a.ChartFrame=this.Frame.SubFrame[0].Frame,a.Name="Minute-Line",a.Identify="Minute-Line",a.Color=m.Minute.PriceColor,a.LineWidth=m.Minute.PriceLineWidth,a.AreaColor=m.Minute.AreaPriceColor,a.GetEventCallback=function(h){return t.GetEventCallback(h)},this.ChartPaint[0]=a;var s=new Hh;s.Canvas=this.Canvas,s.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,s.ChartFrame=this.Frame.SubFrame[0].Frame,s.Name="Minute-Average-Line",s.Identify="Minute-Average-Line",s.Color=m.Minute.AvPriceColor,s.IsDrawArea=!1,this.ChartPaint[1]=s;var o=qn.Create("ChartMinuteVolumBar");o.Color=m.Minute.VolBarColor,o.Canvas=this.Canvas,o.ChartBorder=this.Frame.SubFrame[1].Frame.ChartBorder,o.ChartFrame=this.Frame.SubFrame[1].Frame,o.Name="Minute-Vol-Bar",o.Identify="Minute-Vol-Bar",o.ShareAfterVol=this.ShareAfterVol,this.ChartPaint[2]=o,this.TitlePaint[0]=new WC,this.TitlePaint[0].Frame=this.Frame.SubFrame[0].Frame,this.TitlePaint[0].Canvas=this.Canvas,this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.TitlePaint[0].LanguageID=this.LanguageID,this.TitlePaint[0].CallAcutionXOperator=new Zo,this.TitlePaint[0].CallAcutionXOperator.Frame=this.Frame.SubFrame[0].Frame},this.ChangeScriptIndex=function(t,a,s){this.DeleteIndexPaint(t,!0),this.WindowIndex[t]=new de(a.Name,a.Script,a.Args,a);var o=this.SourceData;this.BindIndexData(t,o),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangeAPIIndex=function(t,a){this.DeleteIndexPaint(t,!0);var s=a.API;this.WindowIndex[t]=new Ma(s.Name,s.Script,s.Args,a),a&&a.Window&&this.SetFrameToolbar(t,a.Window),this.Frame.ClearUpDonwFrameYData({Index:t});var o=this.ChartPaint[0].Data;this.BindIndexData(t,o),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()},this.ChangeIndex=function(t,a,s){if(!(this.Frame.SubFrame.length<3)){if(s&&s.API)return this.ChangeAPIIndex(t,s);var o=new J,h=o.Get(a);if(h){t<2&&(t=2),t>=this.Frame.SubFrame.length&&(t=2);var l={Name:h.Name,Script:h.Script,Args:h.Args,ID:a,KLineType:h.KLineType,YSpecificMaxMin:h.YSpecificMaxMin,YSplitScale:h.YSplitScale,FloatPrecision:h.FloatPrecision,Condition:h.Condition,StringFormat:h.StringFormat,OutName:h.OutName};return s&&(s.FloatPrecision>=0&&(l.FloatPrecision=s.FloatPrecision),s.StringFormat>0&&(l.StringFormat=s.StringFormat),s.Args&&(l.Args=s.Args),c.IsNumber(s.YSplitType)&&(l.YSplitType=s.YSplitType),s.Lock&&(l.Lock=s.Lock)),this.ChangeScriptIndex(t,l,s)}}},this.ChangeIndexWindowCount=function(t){var a=this;if(!(t<2)&&this.Frame.SubFrame.length!=t){var s=this.Frame.SubFrame.length;if(s>t){for(var o=this.GetEventCallback(et.ON_DELETE_FRAME),h=s-1;h>=t;--h){this.DeleteIndexPaint(h);var l=this.Frame.SubFrame[h].Frame;if(l.ClearToolbar&&l.ClearToolbar(),o&&o.Callback){var u={SubFrame:this.Frame.SubFrame[h],WindowIndex:h};o.Callback(o,u,this)}}this.Frame.SubFrame.splice(t,s-t),this.WindowIndex.splice(t,s-t)}else{for(var f=this.Frame.SubFrame[0].Frame,h=s;h<t;++h){var C=this.CreateSubFrameItem(h,f);this.Frame.SubFrame[h]=C;var D=new za;D.Frame=this.Frame.SubFrame[h].Frame,D.Canvas=this.Canvas,D.LanguageID=this.LanguageID,D.GetEventCallback=function(M){return a.GetEventCallback(M)},D.SelectedChart=this.SelectedChart,this.TitlePaint[h+1]=D}for(var v=["RSI","MACD","DMA","DMI","KDJ","WR"],S=new J,h=s;h<t;++h){var T=v[h%v.length],I=S.Get(T);this.WindowIndex[h]=new de(I.Name,I.Script,I.Args,I);var F=this.SourceData;this.BindIndexData(h,F)}for(var h=0;h<this.Frame.SubFrame.length;++h){var l=this.Frame.SubFrame[h].Frame;h==this.Frame.SubFrame.length-1?l.XSplitOperator.ShowText=!0:l.XSplitOperator.ShowText=!1}this.UpdataDataoffset()}this.UpdateXShowText(),this.Frame.SetSizeChage(!0),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()}},this.ChangeIndexTemplate=function(t){var a=this;if(Array.isArray(t.Windows)){var s=t.Windows.length,o=this.Frame.SubFrame.length,h=2;s+=h;var l=null;c.IsNumber(t.DayCount)&&t.DayCount!=this.DayCount&&(l=t.DayCount);for(var u=l!=null,f=h;f<o;++f){this.DeleteIndexPaint(f);var C=this.Frame.SubFrame[f];C.YSpecificMaxMin=null,C.IsLocked=!1,C.YSplitScale=null}if(o>s){for(var D=this.GetEventCallback(et.ON_DELETE_FRAME),f=o-1;f>=s;--f)if(this.Frame.SubFrame[f].Frame.ClearToolbar(),D&&D.Callback){var v={SubFrame:this.Frame.SubFrame[f],WindowIndex:f};D.Callback(D,v,this)}this.Frame.SubFrame.splice(s,o-s),this.WindowIndex.splice(s,o-s)}else for(var f=o;f<s;++f){var S=this.CreateSubFrameItem(f);this.Frame.SubFrame[f]=S;var T=new za;T.Frame=this.Frame.SubFrame[f].Frame,T.Canvas=this.Canvas,T.LanguageID=this.LanguageID,T.GetEventCallback=function(lt){return a.GetEventCallback(lt)},T.SelectedChart=this.SelectedChart,this.TitlePaint[f+1]=T}for(var I=new J,f=0;f<s;++f){var F=f,E=null,M=null;t.Frame&&t.Frame.length>f&&(M=t.Frame[F]),F>=h&&(E=t.Windows[F-h]);var O=F+1;if(this.TitlePaint[O].Data=[],this.TitlePaint[O].Title=null,E)if(E.Script)this.WindowIndex[F]=new de(E.Name,E.Script,E.Args,E);else if(E.API){var R=E.API;this.WindowIndex[F]=new Ma(R.Name,R.Script,R.Args,E)}else{var b=E.Index,p=Ja.Get(b);if(p)this.WindowIndex[F]=p.Create(),this.CreateWindowIndex(F);else{var G=I.Get(b);if(G){var Y=G.Args;E.Args&&(Y=E.Args);var Q={Name:G.Name,Script:G.Script,Args:Y,ID:b,KLineType:G.KLineType,YSpecificMaxMin:G.YSpecificMaxMin,YSplitScale:G.YSplitScale,FloatPrecision:G.FloatPrecision,Condition:G.Condition,OutName:G.OutName};E.TitleFont&&(Q.TitleFont=E.TitleFont),this.WindowIndex[F]=new de(Q.Name,Q.Script,Q.Args,Q)}}}this.SetSubFrameAttribute(this.Frame.SubFrame[F],E,M)}for(var f=0;f<this.Frame.SubFrame.length;++f){var E=this.Frame.SubFrame[f].Frame;f==this.Frame.SubFrame.length-1?E.XSplitOperator.ShowText=!0:E.XSplitOperator.ShowText=!1}if(u)this.Frame.SetSizeChage(!0),l!=null&&this.ChangeDayCount(l);else{for(var ht=this.SourceData,f=0;f<s;++f)this.BindIndexData(f,ht);this.UpdataDataoffset(),this.Frame.SetSizeChage(!0),this.UpdateXShowText&&this.UpdateXShowText(),this.ResetFrameXYSplit(),this.UpdateFrameMaxMin(),this.Draw()}}},this.RemoveIndexWindow=function(t){if(X.Chart.Log("[MinuteChartContainer::RemoveIndexWindow] remove id",t),!(t<2)&&this.Frame.SubFrame&&!(t>=this.Frame.SubFrame.length)){this.Frame.RestoreIndexWindows(),this.Frame.SubFrame[t].Frame,this.DeleteIndexPaint(t),this.Frame.SubFrame[t].Frame.ClearToolbar();var a=this.GetEventCallback(et.ON_DELETE_FRAME);if(a&&a.Callback){var s={SubFrame:this.Frame.SubFrame[t],WindowIndex:t};a.Callback(a,s,this)}this.Frame.SubFrame.splice(t,1),this.WindowIndex.splice(t,1),this.TitlePaint.splice(t+1,1);for(var o=0;o<this.Frame.SubFrame.length;++o){var h=this.Frame.SubFrame[o].Frame;o==this.Frame.SubFrame.length-1?h.XSplitOperator.ShowText=!0:h.XSplitOperator.ShowText=!1,h.Identify=o}this.Frame.SetSizeChage(!0),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw()}},this.AutoUpdateEvent=function(t,a){var s=t?et.RECV_START_AUTOUPDATE:et.RECV_STOP_AUTOUPDATE;if(this.mapEvent.has(s)){var o=this,h=this.mapEvent.get(s),l={Stock:{Symbol:this.Symbol,Name:this.Name,DayCount:this.DayCount},Explain:a};t&&(l.Callback=function(u){o.RecvMinuteData(u)}),h.Callback(h,l,this)}},this.ClearIndexPaint=function(){if(this.Frame&&this.Frame.SubFrame)for(var t=0;t<this.Frame.SubFrame.length;++t){t>=2&&this.DeleteIndexPaint(t,!0);var a=this.Frame.SubFrame[t];if(c.IsNonEmptyArray(a.OverlayIndex))for(var s=0;s<a.OverlayIndex.length;++s){for(var o=a.OverlayIndex[s],h=0;h<o.ChartPaint.length;++h){var l=o.ChartPaint[h];l&&l.OnDestroy&&l.OnDestroy()}o.ChartPaint=[]}}for(var t=1;t<this.TitlePaint.length;++t){var a=this.TitlePaint[t];a.OverlayIndex=new Dt.default}},this.ResetDayOffset=function(){this.PageInfo.Enable?(this.DayOffset.Offset=this.PageInfo.Offset,this.DayOffset.ShowDayCount=this.PageInfo.ShowDayCount):(this.DayOffset.Offset=0,this.DayOffset.ShowDayCount=-1),this.DayOffset.PageInfo=null},this.ChangeSymbol=function(t,a){if(this.StopDisplayLatest(),this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"MinuteChartContainer::ChangeSymbol"),this.Symbol=t,this.ResetDayOffset(),this.ClearIndexPaint(),this.ResetOverlaySymbolStatus(),this.ReloadChartDrawPicture(),a&&(c.IsNumber(a.DayCount)&&(this.DayCount=a.DayCount),c.IsNonEmptyArray(a.Windows)))for(var s=new J,o=0;o<a.Windows.length;++o){var h=2+o;if(h>=this.WindowIndex.length)break;var l=a.Windows[o];if(l)if(l.Script)this.WindowIndex[h]=new de(l.Name,l.Script,l.Args,l);else if(l.API){var u=l.API;this.WindowIndex[h]=new Ma(u.Name,u.Script,u.Args,l)}else{var f=l.Index,C=s.Get(f);C&&(C.Args,l.Args&&(C.Args=l.Args),C.ID=f,this.WindowIndex[h]=new de(C.Name,C.Script,C.Args,C))}}!t||this.DayCount<=0?this.DrawEmpty():(this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.Draw(),this.RequestData())},this.SetPageInfo=function(t){t&&(c.IsBool(t.Enable)&&(this.PageInfo.Enable=t.Enable),c.IsNumber(t.Offset)&&(this.PageInfo.Offset=t.Offset),c.IsNumber(t.ShowDayCount)&&(this.PageInfo.ShowDayCount=t.ShowDayCount))},this.ClearMinuteData=function(){this.SourceData=null,this.DayData=null,this.BeforeOpenData=null,this.AfterCloseData=null,this.MultiDayBeforeOpenData=null,this.MultiDayAfterCloseData=null},this.ChangeDayCount=function(t,a){t<0||(this.StopDisplayLatest(),this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"MinuteChartContainer::ChangeDayCount"),this.DayCount=t,this.ClearMinuteData(),a&&a.PageInfo&&(this.SetPageInfo(a.PageInfo),this.ResetDayOffset()),this.DayCount>1?this.ChartDrawPicture=[]:this.ReloadChartDrawPicture(),this.ClearIndexPaint(),this.ResetOverlaySymbolStatus(),this.RequestData())},this.OverlaySymbol=function(t,a){for(var s in this.OverlayChartPaint){var o=this.OverlayChartPaint[s];if(o.Symbol==t)return console.warn("[MinuteChartContainer::OverlaySymbol] overlay symbol="+t+" exist."),!1}var h=new id;return h.Canvas=this.Canvas,h.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,h.ChartFrame=this.Frame.SubFrame[0].Frame,h.Name="Overlay-Minute",h.Symbol=t,h.Identify="Overlay-Minute-"+t,a&&a.Color?h.Color=a.Color:h.Color=m.OverlaySymbol.Color[m.OverlaySymbol.Random%m.OverlaySymbol.Color.length],++m.OverlaySymbol.Random,this.ChartPaint[0].YClose>0&&this.ChartPaint[0].Data&&(h.MainData=this.ChartPaint[0].Data,h.MainYClose=this.ChartPaint[0].YClose),h.SetOption&&h.SetOption(a),this.OverlayChartPaint.push(h),this.DayCount<=1?this.RequestOverlayMinuteData():this.RequestOverlayHistoryMinuteData(),!0},this.ResetOverlaySymbolStatus=function(){for(var t in this.OverlayChartPaint){var a=this.OverlayChartPaint[t];a.Status=Ie.STATUS_NONE_ID}},this.DeleteOverlaySymbol=function(t){for(var a in this.OverlayChartPaint){var s=this.OverlayChartPaint[a];if(s.Symbol===t)return s.IsDelete=!0,this.OverlayChartPaint.splice(a,1),this.UpdateFrameMaxMin(),this.Draw(),!0}return console.warn("[MinuteChartContainer::DeleteOverlaySymbol] overlay symbol="+t+" not exist."),!1},this.ClearOverlaySymbol=function(){for(var t in this.OverlayChartPaint){var a=this.OverlayChartPaint[t];a.IsDelete=!0}this.OverlayChartPaint=[],this.Frame.SubFrame[0].Frame.YSplitOperator.OverlayChartPaint=this.OverlayChartPaint,this.TitlePaint[0].OverlayChartPaint=this.OverlayChartPaint,this.UpdateFrameMaxMin(),this.Draw()},this.ShowBeforeData=function(t,a){this.ShowCallAuctionData({Left:t},a)},this.ShowCallAuctionData=function(t,a){if(t){var s=!1;if(c.IsBool(t.Left)&&this.IsShowBeforeData!=t.Left&&(this.IsShowBeforeData=t.Left,s=!0),c.IsBool(t.Right)&&this.IsShowAfterData!=t.Right&&(this.IsShowAfterData=t.Right,s=!0),t.MultiDay){var o=t.MultiDay;c.IsBool(o.Left)&&this.IsShowMultiDayBeforeData!=o.Left&&(this.IsShowMultiDayBeforeData=o.Left,s=!0),c.IsBool(o.Right)&&this.IsShowMultiDayAfterData!=o.Right&&(this.IsShowMultiDayAfterData=o.Right,s=!0)}if(a){if(a.BeforeOpen){var o=a.BeforeOpen;c.IsNumber(o.Left)&&this.ExtendWidth.Left!=o.Left&&(this.ExtendWidth.Left=o.Left,s=!0)}if(a.AfterClose){var o=a.AfterClose;c.IsNumber(o.Right)&&this.ExtendWidth.Right!=o.Right&&(this.ExtendWidth.Right=o.Right,s=!0)}if(a.MultiDay){var o=a.MultiDay;c.IsNumber(o.Left)&&this.MultiDayExtendWidth.Left!=o.Left&&(this.MultiDayExtendWidth.Left=o.Left,s=!0),c.IsNumber(o.Right)&&this.MultiDayExtendWidth.Right!=o.Right&&(this.MultiDayExtendWidth.Right=o.Right,s=!0)}}s&&this.RequestData()}},this.RequestData=function(){this.DayCount<=1?this.RequestMinuteData():this.RequestHistoryMinuteData()},this.ChangeDrawType=function(t){if(!(this.ChartPaint.length<=0)){if(t==0)this.ChartPaint[0].IsDrawArea=!0;else if(t==1)this.ChartPaint[0].IsDrawArea=!1;else return;this.Draw()}},this.UpdateDataOffset=function(){this.SourceData.DataOffset=this.DayOffset.DataOffset;for(var t=0;t<this.ChartPaint.length;++t){var a=this.ChartPaint[t];a.Data&&(a.Data.DataOffset=this.DayOffset.DataOffset,(a.ClassName=="ChartMinuteVolumBar"||a.ClassName=="ChartMinutePriceLine")&&(a.DayOffset=this.DayOffset))}for(var t=0;t<this.OverlayChartPaint.length;++t){var a=this.OverlayChartPaint[t];a.Data&&(a.Data.DataOffset=this.DayOffset.DataOffset)}for(var t=0;t<this.Frame.SubFrame.length;++t)for(var s=this.Frame.SubFrame[t],o=0;o<s.OverlayIndex.length;++o)for(var h=s.OverlayIndex[o],l=0;l<h.ChartPaint.length;++l){var a=h.ChartPaint[l];a.Data&&(a.Data.DataOffset=this.DayOffset.DataOffset)}},this.RequestHistoryMinuteData=function(){var t=this;if(this.IsBeforeData=!1,this.IsAfterData=!1,this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.Draw(),this.NetworkFilter){var a={Name:"MinuteChartContainer::RequestHistoryMinuteData",Explain:"多日分时数据",Request:{Url:t.HistoryMinuteApiUrl,Data:{daycount:t.DayCount,symbol:t.Symbol},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(a,function(s){t.ChartSplashPaint.EnableSplash(!1),t.RecvHistoryMinuteData(s)}),a.PreventDefault==!0)return}Lt.HttpRequest({url:t.HistoryMinuteApiUrl,data:{symbol:t.Symbol,daycount:t.DayCount},type:"post",dataType:"json",async:!0,success:function(o){t.ChartSplashPaint.EnableSplash(!1),t.RecvHistoryMinuteData(o)}})},this.RecvHistoryMinuteData=function(t){if(this.EnableVerifyRecvData&&t.symbol!=this.Symbol){X.Chart.Warn("[MinuteChartContainer::RecvHistoryMinuteData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+t.symbol+"]");return}this.DayData=re.JsonDataToMinuteDataArray(t),this.ColorLineData=re.JsonDataToHistoryMinuteLineColorData(t),this.MultiDayBeforeOpenData=re.JosnDataToBeforeOpenDataArray(t),this.MultiDayAfterCloseData=re.JosnDataToAfterCloseDataArray(t);var a=re.JsonDataToHistoryMinuteLastUpdateTime(t);this.CaclutateCallCationYRange(),this.Symbol=t.symbol,this.Name=t.name,this.SetCallCationDataBorder({Left:!1,Right:!1,MultiDay:{Left:this.IsShowMultiDayBeforeData,Right:this.IsShowMultiDayAfterData}}),this.CaclutateLimitPrice(this.DayData[0].YClose,t.data[0].limitprice),this.UpdateHistoryMinuteUI(a),this.RecvMinuteDataEvent({FunctionName:"RecvHistoryMinuteData"}),this.RequestOverlayHistoryMinuteData(),this.BindAllOverlayIndexData(this.SourceData),this.AutoUpdateEvent(!0,"MinuteChartContainer::RequestHistoryMinuteData"),this.AutoUpdate()},this.CaclutateCallCationYRange=function(){var t=null,a=null;if(c.IsNonEmptyArray(this.MultiDayAfterCloseData)){for(var s={Max:null,Min:null},o=0;o<this.MultiDayAfterCloseData.length;++o){var h=this.MultiDayAfterCloseData[o];(s.Max==null||s.Max<h.VolMax)&&(s.Max=h.VolMax),(s.Min==null||s.Min>h.VolMin)&&(s.Min=h.VolMin)}t=s}if(c.IsNonEmptyArray(this.MultiDayBeforeOpenData)){for(var s={Max:null,Min:null},o=0;o<this.MultiDayBeforeOpenData.length;++o){var h=this.MultiDayBeforeOpenData[o];(s.Max==null||s.Max<h.VolMax)&&(s.Max=h.VolMax),(s.Min==null||s.Min>h.VolMin)&&(s.Min=h.VolMin)}a=s}if(this.ShareAfterVol==2&&t&&a){var l=Math.max(t.Max,a.Max),u=Math.min(t.Min,a.Min);t.Max=a.Max=l,t.Min=a.Min=u}if(t)for(var o=0;o<this.MultiDayAfterCloseData.length;++o){var h=this.MultiDayAfterCloseData[o];h.VolMax=t.Max,h.VolMin=t.Min}if(a)for(var o=0;o<this.MultiDayBeforeOpenData.length;++o){var h=this.MultiDayBeforeOpenData[o];h.VolMax=a.Max,h.VolMin=a.Min}},this.UpdateHistoryMinuteUI=function(t){var a=this.HistoryMinuteDataToArray(this.DayData),s=new k;if(s.Data=a,t&&(s.UpdateTime=t),this.SourceData=s,this.TradeDate=this.DayData[0].Date,this.PageInfo&&this.PageInfo.Enable){this.DayOffset.DayCount=this.DayData.length,this.DayOffset.ShowDayCount==-1&&(this.DayOffset.ShowDayCount=this.DayData.length),this.DayOffset.Offset==-8888&&(this.DayOffset.Offset=this.DayOffset.DayCount-this.DayOffset.ShowDayCount);var o=this.DayOffset.ShowDayCount;this.Frame.SetDayCount(o)}else{this.DayOffset.Offset=0,this.DayOffset.ShowDayCount=this.DayData.length;var o=this.DayOffset.ShowDayCount;this.Frame.SetDayCount(this.DayData.length)}var h=this.Symbol.toUpperCase(),l=this.DayData[0].YClose,u=W.IsFutures(h);c.IsNumber(this.DayData[0].YClearing)&&u&&(l=this.DayData[0].YClearing),this.BindMainData(s,l),W.IsForeignExchange(h)&&(this.ChartPaint[1].Data=null);for(var f=0;f<this.Frame.SubFrame.length;++f){var C=this.Frame.SubFrame[f];C.Frame.XSplitOperator.Symbol=this.Symbol,C.Frame.XSplitOperator.DayCount=o,C.Frame.XSplitOperator.DayData=this.DayData,C.Frame.XSplitOperator.Operator(),C.Frame.XSplitOperator.IsBeforeData=this.IsBeforeData,C.Frame.XSplitOperator.IsAfterData=this.IsAfterData,C.Frame.YSplitOperator.Symbol=this.Symbol,C.Frame.YSplitOperator.IsBeforeData=this.IsBeforeData,C.Frame.YSplitOperator.IsAfterData=this.IsAfterData;for(var D in C.OverlayIndex){var v=C.OverlayIndex[D];v.Frame.XPointCount=C.Frame.XPointCount,v.Frame.MinuteCount=C.Frame.MinuteCount}}if(this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.IsBeforeData=this.IsBeforeData,this.ChartCorssCursor.StringFormatX.IsAfterData=this.IsAfterData,this.TitlePaint[0].IsShowDate=!0,this.UpdateDataOffset(),this.UpdateFrameMaxMin(),this.Frame.SubFrame.length>2){var S=new k;S.Data=a;for(var T=2;T<this.Frame.SubFrame.length;++T)this.BindIndexData(T,S)}this.Frame.SetSizeChage(!0),this.Draw()},this.HistoryMinuteDataToArray=function(t){for(var a=[],s=t.length-1;s>=0;--s)for(var o=t[s],h=0;h<o.Data.length;++h)a.push(o.Data[h]);return a},this.UpdateLatestMinuteData=function(t,a,s){if(this.DayData){for(var o=0;o<this.DayData.length;++o){var h=this.DayData[o];if(h.Date===a){h.Data=t,s&&c.IsNumber(s.yclose)&&(h.YClose=s.yclose),s&&c.IsNumber(s.yclearing)&&(h.YClearing=s.yclearing);return}}if(this.DayData.length>0&&this.DayData[0].Date<a){var l=new k;l.Date=a,l.Data=t,s&&c.IsNumber(s.yclose)&&(l.YClose=s.yclose),s&&c.IsNumber(s.yclearing)&&(l.YClearing=s.yclearing),this.DayData.unshift(l)}}},this.UpdateLatestMinuteDataV2=function(t){if(this.DayCount>1){if(!this.DayData)return;for(var a=null,s=0;s<this.DayData.length;++s){var o=this.DayData[s];if(o.Date===date){a=o;break}}if(!a)return;for(var h=-1,l=t.Data[0],s=0;s<a.Data.length;++s){var o=a.Data[s];if(o.Date==l.Date&&o.Time==l.Time){h=s;break}}h<0&&(h=a.Data.length);for(var s=0,u=h;s<t.Data.length;++s,++u){var o=t.Data[s];a.Data[u]=o}}else{if(!this.SourceData)return;for(var h=-1,l=t.Data[0],s=0;s<this.SourceData.Data.length;++s){var o=this.SourceData.Data[s];if(o.Date==l.Date&&o.Time==l.Time){h=s;break}}h<0&&(h=this.SourceData.Data.length);for(var s=0,u=h;s<t.Data.length;++s,++u){var o=t.Data[s];this.SourceData.Data[u]=o}}},this.RequestMinuteData=function(){var t=this,a=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","minute","minutecount"],s=this.Symbol.toUpperCase();if(W.IsFutures(s)&&(a.push("clearing"),a.push("yclearing")),this.IsBeforeData=!1,this.IsShowBeforeData&&this.DayCount===1&&W.IsSHSZStockA(t.Symbol)&&(this.IsBeforeData=!0,a.push("before")),this.IsAfterData=!1,this.IsShowAfterData&&this.DayCount===1&&W.IsSHSZStockA(t.Symbol)&&(this.IsAfterData=!0),this.NetworkFilter){var o=null;if(this.DayCount>1){if(c.IsNonEmptyArray(this.DayData)){var h=this.DayData[0];o=h.GetDateRange()}}else this.SourceData&&(o=this.SourceData.GetDateRange());var l={Before:this.IsShowBeforeData&&this.DayCount===1,After:this.IsShowAfterData&&this.DayCount===1},u={Name:"MinuteChartContainer::RequestMinuteData",Explain:"最新分时数据",Request:{Url:t.MinuteApiUrl,Data:{field:a,symbol:[t.Symbol],callcation:l},Type:"POST"},Self:this,PreventDefault:!1};if(o&&(u.DateRange=o),this.NetworkFilter(u,function(f){t.ChartSplashPaint.EnableSplash(!1),t.RecvMinuteData(f)}),u.PreventDefault==!0)return}Lt.HttpRequest({url:t.MinuteApiUrl,data:{field:a,symbol:[t.Symbol],start:-1},type:"post",dataType:"json",async:!0,success:function(C){t.ChartSplashPaint.EnableSplash(!1),t.RecvMinuteData(C)}})},this.RecvMinuteDataEvent=function(t){if(this.mapEvent.has(et.RECV_MINUTE_DATA)){var a=this.mapEvent.get(et.RECV_MINUTE_DATA),s={MinuteData:this.SourceData,Stock:{Symbol:this.Symbol,Name:this.Name},Option:t};a.Callback(a,s,this)}},this.UpdateLineColorData=function(t,a){if(!this.ColorLineData){this.ColorLineData=t;return}var s=this.ColorLineData.filter(function(h,l,u){return h.Date!=a});if(c.IsNonEmptyArray(t))for(var o in t)s.push(t[o]);this.ColorLineData=s},this.UpdateCallCationData=function(t,a){if(t&&c.IsNonEmptyArray(this.MultiDayBeforeOpenData)){var s=this.MultiDayBeforeOpenData[this.MultiDayBeforeOpenData.length-1];s.Date==t.Date?this.MultiDayBeforeOpenData[this.MultiDayBeforeOpenData.length-1]=t:s.Date<t.Date&&this.MultiDayBeforeOpenData.push(t)}if(a&&c.IsNonEmptyArray(this.MultiDayAfterCloseData)){var s=this.MultiDayAfterCloseData[this.MultiDayAfterCloseData.length-1];s.Date==a.Date?this.MultiDayAfterCloseData[this.MultiDayAfterCloseData.length-1]=a:s.Date<a.Date&&this.MultiDayAfterCloseData.push(a)}this.CaclutateCallCationYRange()},this.RecvUpdateMinuteData=function(t){var a=re.JsonDataToUpdateMinuteData(t),s=re.JsonDataToMinuteLineColorData(t);this.BeforeOpenData=null,this.AfterCloseData=null;var o=re.JsonDataToBeforeOpenData(t),h=re.JsonDataToAfterCloseData(t),l=re.JsonDataToMinuteLastUpdateTime(t);if(this.DayCount>1){this.UpdateCallCationData(o,h),this.UpdateLineColorData(s,a.date),this.UpdateLatestMinuteDataV2(a),this.UpdateHistoryMinuteUI(l),this.RecvMinuteDataEvent({FunctionName:"RecvUpdateMinuteData"}),this.RequestOverlayMinuteData(),this.BindAllOverlayIndexData(this.SourceData),this.AutoUpdateEvent(!0,"MinuteChartContainer::RecvUpdateMinuteData"),this.AutoUpdate();return}this.UpdateLatestMinuteDataV2(a);var u=this.SourceData,f=this.SourceData.Data;if(this.ColorLineData=s,this.TradeDate=t.stock[0].date,this.Frame.SetDayCount(1),this.SourceData.UpdateTime=l,this.Symbol=a.Symbol,this.Name=a.Name,this.SetCallCationDataBorder({Left:this.IsBeforeData,Right:this.IsAfterData,MultiDay:{Left:!1,Right:!1}}),this.ShareAfterVol==2&&this.BeforeOpenData&&this.AfterCloseData){var C=Math.max(this.BeforeOpenData.VolMax,this.AfterCloseData.VolMax),D=Math.min(this.BeforeOpenData.VolMin,this.AfterCloseData.VolMin);this.BeforeOpenData.VolMax=this.AfterCloseData.VolMax=C,this.BeforeOpenData.VolMin=this.AfterCloseData.VolMin=D}var v=a.YClose,S=this.Symbol.toUpperCase(),T=W.IsFutures(S);a.YClearing>0&&T&&(v=a.YClearing),this.CaclutateLimitPrice(v,a.LimitPrice);var I=null;if(a.High>0&&a.Low>0&&(I={High:a.High,Low:a.Low}),this.BindMainData(u,v,I),this.Frame.SubFrame.length>2){var F=new k;F.Data=f;for(var E=2;E<this.Frame.SubFrame.length;++E)this.BindIndexData(E,F)}for(var M=0;M<this.Frame.SubFrame.length;++M){var O=this.Frame.SubFrame[M];if(O.Frame.XSplitOperator.Symbol=this.Symbol,O.Frame.XSplitOperator.DayCount=1,O.Frame.XSplitOperator.Operator(),O.Frame.YSplitOperator.Symbol=this.Symbol,c.IsNonEmptyArray(O.OverlayIndex))for(var R=0;R<O.OverlayIndex.length;++R){var b=O.OverlayIndex[R];b.Frame.XPointCount=O.Frame.XPointCount,b.Frame.MinuteCount=O.Frame.MinuteCount}}this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.Symbol=this.Symbol,W.IsSHSZ(S)&&(this.TitlePaint[0].IsShowDate=!1),t.stock[0].IsHistoryMinute==!0&&(this.TitlePaint[0].IsShowDate=!0);var p=this.GetChartMinuteInfo();p&&(p.SourceData=this.SourceData),this.RecvMinuteDataEvent({FunctionName:"RecvUpdateMinuteData"}),this.RequestMinuteInfoData(),this.RequestOverlayMinuteData(),this.CreateChartDrawPictureByStorage(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.BindAllOverlayIndexData(this.SourceData),this.AutoUpdateEvent(!0,"MinuteChartContainer::RecvUpdateMinuteData"),this.AutoUpdate()},this.RecvMinuteData=function(t){if(!t){X.Chart.Warn("[MinuteChartContainer::RecvMinuteData] recv data is null");return}if(t.dataType==1){this.RecvUpdateMinuteData(t);return}if(t.stock[0]){if(t.stock[0].symbol!=this.Symbol&&this.EnableVerifyRecvData){X.Chart.Warn("[MinuteChartContainer::RecvMinuteData] recv data symbol not match. HQChart["+this.Symbol+"] , Recv["+t.stock[0].symbol+"]");return}var a=re.JsonDataToMinuteData(t),s=re.JsonDataToMinuteLineColorData(t);this.BeforeOpenData=null,this.AfterCloseData=null;var o=re.JsonDataToBeforeOpenData(t),h=re.JsonDataToAfterCloseData(t),l=re.JsonDataToMinuteLastUpdateTime(t);if(this.IsBeforeData&&(this.BeforeOpenData=o),this.IsAfterData&&(this.AfterCloseData=h),this.DayCount>1){this.UpdateCallCationData(o,h),this.UpdateLineColorData(s,t.stock[0].date),this.UpdateLatestMinuteData(a,t.stock[0].date,t.stock[0]),this.UpdateHistoryMinuteUI(l),this.RecvMinuteDataEvent({FunctionName:"RecvMinuteData"}),this.RequestOverlayMinuteData(),this.BindAllOverlayIndexData(this.SourceData),this.AutoUpdateEvent(!0,"MinuteChartContainer::RecvMinuteData"),this.AutoUpdate();return}var u=new k;if(u.Data=a,u.UpdateTime=l,this.ColorLineData=s,this.TradeDate=t.stock[0].date,this.Frame.SetDayCount(1),this.SourceData=u,this.Symbol=t.stock[0].symbol,this.Name=t.stock[0].name,this.SetCallCationDataBorder({Left:this.IsBeforeData,Right:this.IsAfterData,MultiDay:{Left:!1,Right:!1}}),this.ShareAfterVol==2&&this.BeforeOpenData&&this.AfterCloseData){var f=Math.max(this.BeforeOpenData.VolMax,this.AfterCloseData.VolMax),C=Math.min(this.BeforeOpenData.VolMin,this.AfterCloseData.VolMin);this.BeforeOpenData.VolMax=this.AfterCloseData.VolMax=f,this.BeforeOpenData.VolMin=this.AfterCloseData.VolMin=C}var D=t.stock[0].yclose,v=this.Symbol.toUpperCase(),S=W.IsFutures(v);t.stock[0].yclearing>0&&S&&(D=t.stock[0].yclearing),this.CaclutateLimitPrice(D,t.stock[0].limitprice);var T=null;if(t.stock[0].high>0&&t.stock[0].low>0&&(T={High:t.stock[0].high,Low:t.stock[0].low}),this.BindMainData(u,D,T),this.Frame.SubFrame.length>2){var I=new k;I.Data=a;for(var F=2;F<this.Frame.SubFrame.length;++F)this.BindIndexData(F,I)}for(var E in this.Frame.SubFrame){var M=this.Frame.SubFrame[E];M.Frame.XSplitOperator.Symbol=this.Symbol,M.Frame.XSplitOperator.DayCount=1,M.Frame.XSplitOperator.Operator(),M.Frame.YSplitOperator.Symbol=this.Symbol;for(var O in M.OverlayIndex){var R=M.OverlayIndex[O];R.Frame.XPointCount=M.Frame.XPointCount,R.Frame.MinuteCount=M.Frame.MinuteCount}}this.ChartCorssCursor.StringFormatY.Symbol=this.Symbol,this.ChartCorssCursor.StringFormatX.Symbol=this.Symbol,W.IsSHSZ(v)&&(this.TitlePaint[0].IsShowDate=!1),t.stock[0].IsHistoryMinute==!0&&(this.TitlePaint[0].IsShowDate=!0);var b=this.GetChartMinuteInfo();b&&(b.SourceData=this.SourceData),this.RecvMinuteDataEvent({FunctionName:"RecvMinuteData"}),this.RequestMinuteInfoData(),this.RequestOverlayMinuteData(),this.CreateChartDrawPictureByStorage(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw(),this.BindAllOverlayIndexData(this.SourceData),this.AutoUpdateEvent(!0,"MinuteChartContainer::RecvMinuteData"),this.AutoUpdate()}},this.CaclutateLimitPrice=function(t,a){if(this.LimitPrice=null,a&&a.max>0&&a.min>0){this.LimitPrice={Max:a.max,Min:a.min};return}var s=W.GetLimitPriceRange(this.Symbol,this.Name);if(!s){X.Chart.Log("[MinuteChartContainer::CaclutateLimitPrice] "+this.Symbol+" no limit price.");return}t<=0||(this.LimitPrice={Max:t*(1+s.Max),Min:t*(1+s.Min)},X.Chart.Log("[MinuteChartContainer::CaclutateLimitPrice] "+this.Symbol+" yClose:"+t+" max:"+this.LimitPrice.Max+" min:"+this.LimitPrice.Min),this.LimitPrice.Max=parseFloat(this.LimitPrice.Max.toFixed(2)),this.LimitPrice.Min=parseFloat(this.LimitPrice.Min.toFixed(2)),X.Chart.Log("[MinuteChartContainer::CaclutateLimitPrice] "+this.Symbol+" tofixed(2) max:"+this.LimitPrice.Max+" min:"+this.LimitPrice.Min))},this.RequestOverlayMinuteData=function(){for(var t=this,a=this,s=this.TradeDate,o=function(){var D=t.OverlayChartPaint[h];if(!D.MainData||!(D.MainYClose>0)||D.Status!=Ie.STATUS_NONE_ID||(l=D.Symbol,!l)||(D.Status=Ie.STATUS_REQUESTDATA_ID,t.NetworkFilter&&(u={Name:"MinuteChartContainer::RequestOverlayMinuteData",Explain:"叠加股票最新分时数据",Request:{Url:a.HistoryMinuteApiUrl,Data:{days:[s],symbol:l},Type:"POST"},Self:t,PreventDefault:!1},t.NetworkFilter(u,function(v){D.Status=Ie.STATUS_RECVDATA_ID,a.RecvOverlayMinuteData(v,D)}),u.PreventDefault==!0)))return"continue";Lt.HttpRequest({url:a.HistoryMinuteApiUrl,data:{symbol:l,days:[s]},type:"post",dataType:"json",async:!0,success:function(S){D.Status=Ie.STATUS_RECVDATA_ID,a.RecvOverlayMinuteData(S,D)}})},h=0;h<this.OverlayChartPaint.length;++h)var l,u,f=o()},this.RecvMultiOverlayMinuteData=function(t){if(c.IsNonEmptyArray(t)){for(var a=!1,s=0;s<t.length;++s){var o=t[s];if(o.symbol)for(var h=0;h<this.OverlayChartPaint.length;++h){var l=this.OverlayChartPaint[h];if(!(!l.MainData||!(l.MainYClose>0))&&o.symbol==l.Symbol){this.RecvOverlayMinuteData(o,l,{Redraw:!1}),a=!0;break}}}a&&(this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw())}},this.RecvOverlayMinuteData=function(t,a,s){if(!a.IsDelete){if(this.EnableVerifyRecvData&&t.symbol!=a.Symbol){X.Chart.Warn("[MinuteChartContainer::RecvOverlayMinuteData] recv data symbol not match. paint["+a.Symbol+"] , Recv["+t.symbol+"]");return}var o=re.JsonDataToMinuteDataArray(t),h=null,l;if(this.DayCount>1){if(o.length<=0)return;var u=o[0];for(var f in a.SourceData){var C=a.SourceData[f];if(C.Date==u.Date){a.SourceData[f]=u;var D=this.HistoryMinuteDataToArray(a.SourceData),h=new k;h.Data=D,l=u.YClose;break}}if(h==null)return}else o.length>0?h=o[0]:h=new k,l=h.YClose;a.Data=h,a.Title=t.name,a.Symbol=t.symbol,a.YClose=l,a.Status=Ie.STATUS_FINISHED_ID;var v=!0;s&&s.Redraw==!1&&(v=!1),v&&(this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw())}},this.RequestOverlayHistoryMinuteData=function(){var t=this;if(c.IsNonEmptyArray(this.DayData)){for(var a=this,s=[],o=0;o<this.DayData.length;++o){var h=this.DayData[o];s.push(h.Date)}if(!(s.length<=0))for(var l=function(){var v=t.OverlayChartPaint[o];if(u=v.Symbol,!u||v.Status!=Ie.STATUS_NONE_ID||(v.Status=Ie.STATUS_REQUESTDATA_ID,t.NetworkFilter&&(f={Name:"MinuteChartContainer::RequestOverlayHistoryMinuteData",Explain:"叠加股票多日分时数据",Request:{Url:a.HistoryMinuteApiUrl,Data:{days:s,symbol:u},Type:"POST"},Self:t,PreventDefault:!1},t.NetworkFilter(f,function(S){v.Status=Ie.STATUS_RECVDATA_ID,a.RecvOverlayHistoryMinuteData(S,v)}),f.PreventDefault==!0)))return"continue";Lt.HttpRequest({url:a.HistoryMinuteApiUrl,data:{symbol:u,days:s},type:"post",dataType:"json",async:!0,success:function(T){v.Status=Ie.STATUS_RECVDATA_ID,a.RecvOverlayHistoryMinuteData(T,v)}})},o=0;o<this.OverlayChartPaint.length;++o)var u,f,C=l()}},this.RecvOverlayHistoryMinuteData=function(t,a){if(this.EnableVerifyRecvData&&t.symbol!=a.Symbol){X.Chart.Warn("[MinuteChartContainer::RecvOverlayHistoryMinuteData] recv data symbol not match. paint["+a.Symbol+"] , Recv["+t.symbol+"]");return}if(c.IsNonEmptyArray(this.DayData)){var s=re.JsonDataToMinuteDataArray(t);if(c.IsNonEmptyArray(s)){for(var o=[],h=0;h<this.DayData.length;++h){for(var l=this.DayData[h],u=!1,f=0;f<s.length;++f)if(l.Date==s[f].Date){o.push(s[f]),u=!0;break}if(!u){var C=new k;C.Date=l.Date,o.push(C)}}a.SourceData=o;var D=this.HistoryMinuteDataToArray(o),v=o[0].YClose,S=new k;S.Data=D,a.Data=S,a.Title=t.name,a.Symbol=t.symbol,a.YClose=v,a.Status=Ie.STATUS_FINISHED_ID,this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}}},this.CancelAutoUpdate=function(){typeof this.AutoUpdateTimer=="number"&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=void 0)},this.AutoUpdate=function(){if(this.CancelAutoUpdate(),!!this.IsAutoUpdate&&this.Symbol){var t=this,a=W.GetMarketStatus(this.Symbol);if(a==0||a==3){this.AutoUpdateTimer=setTimeout(function(){t.AutoUpdate()},2e4);return}var s=this.AutoUpdateFrequency;a==1?this.AutoUpdateTimer=setTimeout(function(){t.AutoUpdate()},s):a==2&&(this.AutoUpdateTimer=setTimeout(function(){t.ResetOverlaySymbolStatus(),t.RequestMinuteData()},s))}},this.BindIndexData=function(t,a){if(this.WindowIndex[t]){if(typeof this.WindowIndex[t].RequestData=="function"){this.WindowIndex[t].RequestData(this,t,a);return}if(typeof this.WindowIndex[t].ExecuteScript=="function"){this.WindowIndex[t].ExecuteScript(this,t,a);return}this.WindowIndex[t].BindData(this,t,a)}},this.BindMainData=function(t,a,s){var o=this.IsShowMultiDayBeforeData?this.MultiDayBeforeOpenData:null,h=this.IsShowMultiDayAfterData?this.MultiDayAfterCloseData:null,l=new k;if(l.Data=t.GetClose(),this.ChartPaint[0].Data=l,this.ChartPaint[0].YClose=a,this.ChartPaint[0].NotSupportMessage=null,this.ChartPaint[0].IsShowLead=!1,this.ChartPaint[0].LeadData=null,this.ChartPaint[0].BeforeOpenData=this.BeforeOpenData,this.ChartPaint[0].AfterCloseData=this.AfterCloseData,this.ChartPaint[0].MultiDayBeforeOpenData=o,this.ChartPaint[0].MultiDayAfterCloseData=h,this.ChartPaint[0].ColorLineData=this.ColorLineData,this.ChartPaint[0].Source=t,W.IsSHSZIndex(this.Symbol)&&this.DayCount==1&&this.IsShowLead){var u=new k;u.Data=t.GetLead(),this.ChartPaint[0].LeadData=u,this.ChartPaint[0].IsShowLead=!0}var f=this.Frame.SubFrame[0].Frame;f.YSplitOperator.YClose=a,f.YSplitOperator.Data=l,this.Frame.Data=this.ChartPaint[0].Data,this.Frame.SourceData=t;for(var C in this.Frame.SubFrame){var D=this.Frame.SubFrame[C].Frame;D.Data=t}l=new k,l.Data=t.GetMinuteAvPrice(),this.ChartPaint[1].Data=l;var v=this.Symbol.toUpperCase();W.IsForeignExchange(v)?this.ChartPaint[1].Data=null:W.IsShowAvPrice&&!W.IsShowAvPrice(v)&&(this.ChartPaint[1].Data=null),f.YSplitOperator.AverageData=l,f.YSplitOperator.OverlayChartPaint=this.OverlayChartPaint,f.YSplitOperator.LimitPrice=this.LimitPrice,f.YSplitOperator.MultiDayBeforeOpenData=o,f.YSplitOperator.MultiDayAfterCloseData=h,f.YSplitOperator.DayCount=this.DayCount,s?(f.YSplitOperator.High=s.High,f.YSplitOperator.Low=s.Low):(f.YSplitOperator.High=null,f.YSplitOperator.Low=null),this.ChartPaint[2].Data=t,this.ChartPaint[2].YClose=a,this.ChartPaint[2].Symbol=this.Symbol,this.ChartPaint[2].BeforeOpenData=this.BeforeOpenData,this.ChartPaint[2].AfterCloseData=this.AfterCloseData,this.ChartPaint[2].MultiDayBeforeOpenData=o,this.ChartPaint[2].MultiDayAfterCloseData=h;for(var C in this.Frame.SubFrame){var D=this.Frame.SubFrame[C];D.Frame.YSplitOperator.BeforeOpenData=this.BeforeOpenData,D.Frame.YSplitOperator.IsBeforeData=this.IsBeforeData,D.Frame.YSplitOperator.AfterCloseData=this.AfterCloseData,D.Frame.YSplitOperator.IsAfterData=this.IsAfterData,D.Frame.YSplitOperator.MultiDayBeforeOpenData=o,D.Frame.YSplitOperator.MultiDayAfterCloseData=h}W.IsShowMinutePostionLine(v)?this.BindOverlayPositionData(t,a):this.ClearBindOverlayPositionData(),this.TitlePaint[0].Data=this.SourceData,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=this.Name,this.TitlePaint[0].YClose=a,this.TitlePaint[0].BeforeOpenData=this.BeforeOpenData,this.TitlePaint[0].AfterCloseData=this.AfterCloseData,this.TitlePaint[0].MultiDayBeforeOpenData=this.IsShowMultiDayBeforeData?this.MultiDayBeforeOpenData:null,this.TitlePaint[0].MultiDayAfterCloseData=this.IsShowMultiDayAfterData?this.MultiDayAfterCloseData:null,this.TitlePaint[0].CallAcutionXOperator&&(this.TitlePaint[0].CallAcutionXOperator.BeforeOpenData=this.BeforeOpenData,this.TitlePaint[0].CallAcutionXOperator.AfterCloseData=this.AfterCloseData,this.TitlePaint[0].CallAcutionXOperator.MultiDayBeforeOpenData=o,this.TitlePaint[0].CallAcutionXOperator.MultiDayAfterCloseData=h,this.TitlePaint[0].CallAcutionXOperator.DayOffset=this.DayOffset),this.ChartCorssCursor&&this.ChartCorssCursor.StringFormatY&&(this.ChartCorssCursor.StringFormatY.YClose=a,this.ChartCorssCursor.StringFormatY.BeforeOpenData=this.BeforeOpenData,this.ChartCorssCursor.StringFormatY.AfterCloseData=this.AfterCloseData,this.ChartCorssCursor.StringFormatY.MultiDayBeforeOpenData=o,this.ChartCorssCursor.StringFormatY.MultiDayAfterCloseData=h,this.ChartCorssCursor.StringFormatY.DayOffset=this.DayOffset,this.ChartCorssCursor.StringFormatX.Data=this.ChartPaint[0].Data,this.ChartCorssCursor.StringFormatX.BeforeOpenData=this.BeforeOpenData,this.ChartCorssCursor.StringFormatX.AfterCloseData=this.AfterCloseData,this.ChartCorssCursor.StringFormatX.MultiDayBeforeOpenData=o,this.ChartCorssCursor.StringFormatX.MultiDayAfterCloseData=h,this.ChartCorssCursor.StringFormatX.DayOffset=this.DayOffset,this.ChartCorssCursor.CallAcutionXOperator&&(this.ChartCorssCursor.CallAcutionXOperator.BeforeOpenData=this.BeforeOpenData,this.ChartCorssCursor.CallAcutionXOperator.AfterCloseData=this.AfterCloseData,this.ChartCorssCursor.CallAcutionXOperator.MultiDayBeforeOpenData=o,this.ChartCorssCursor.CallAcutionXOperator.MultiDayAfterCloseData=h,this.ChartCorssCursor.CallAcutionXOperator.DayOffset=this.DayOffset)),this.ExtendChartPaint[0]&&(this.ExtendChartPaint[0].Symbol=this.Symbol,this.ExtendChartPaint[0].Name=this.Name);for(var C in this.OverlayChartPaint){var D=this.OverlayChartPaint[C];D.MainData=this.ChartPaint[0].Data,D.MainYClose=a}},this.BindOverlayPositionData=function(t,a){var s=this;if(!(this.Frame.SubFrame.length<2)){for(var o=null,h=null,l=this.Frame.SubFrame[1],u=null,f=0;f<l.OverlayIndex.length;++f){var C=l.OverlayIndex[f];if(C.Identify=="Position_Line_Frame"){u=C;break}}if(u){h=u.Frame;for(var f=0;f<u.ChartPaint.length;++f){var C=u.ChartPaint[f];if(C.Name=="Position-Line"){o=C;break}}o||(o=new Uu,o.Canvas=this.Canvas,o.Name="Position-Line",o.ChartBorder=h.ChartBorder,o.ChartFrame=h,o.Identify=u.Identify,o.Color=m.Minute.PositionColor,u.ChartPaint.push(o))}else{u=new Qn,u.Identify="Position_Line_Frame",this.ClassName=="MinuteChartContainer"?h=new _o:h=new Uo,h.Canvas=this.Canvas,h.MainFrame=l.Frame,h.ChartBorder=l.Frame.ChartBorder,h.GlobalOption=this.GlobalOption,u.Frame=h,h.YSplitOperator=new Pa,h.YSplitOperator.LanguageID=this.LanguageID,h.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),h.YSplitOperator.Frame=h,h.YSplitOperator.ChartBorder=h.ChartBorder,h.YSplitOperator.SplitCount=l.Frame.YSplitOperator.SplitCount,h.YSplitOperator.GetEventCallback=function(T){return s.GetEventCallback(T)},h.YSplitOperator.OverlayIdentify=u.Identify;var o=new Uu;o.Canvas=this.Canvas,o.Name="Position-Line",o.ChartBorder=h.ChartBorder,o.ChartFrame=h,o.Identify=u.Identify,o.Color=m.Minute.PositionColor,u.ChartPaint.push(o),l.OverlayIndex.push(u),l.Frame.RightFrame=h}var D=this.Frame.SubFrame[0].Frame.XPointCount;h.XPointCount=D,l.Frame.IsShowPositionTitle=!0;var v=new k;v.Data=t.GetPosition(),o.Data=v}},this.ClearBindOverlayPositionData=function(){if(!(this.Frame.SubFrame.length<2)){var t=this.Frame.SubFrame[1];t.Frame.RightFrame=null,t.Frame.IsShowPositionTitle=!1;for(var a in t.OverlayIndex){var s=t.OverlayIndex[a];if(s.Identify=="Position_Line_Frame"){t.OverlayIndex.splice(a,1);break}}}},this.GetOverlayIndexByIdentify=function(t){for(var a=0;a<this.Frame.SubFrame.length;++a){var s=this.Frame.SubFrame[a];if(c.IsNonEmptyArray(s.OverlayIndex))for(var o=0;o<s.OverlayIndex.length;++o){var h=s.OverlayIndex[o];if(h.Identify===t)return{OverlayItem:h,WindowIndex:a}}}return null},this.RecvOverlayIndex=function(t,a){var s=this.GetOverlayIndexByIdentify(t);if(s==null){console.warn("[MinuteChartContainer::RecvOverlayIndex] can't find overlay index. [identify="+t+"]");return}if(s.Script&&typeof s.RecvSubscribeData=="function"){var o=this.SourceData;o&&s.Script.RecvSubscribeData(a,this,s.WindowIndex,o)}},this.UpdateOverlayIndex=function(t){var a=this.GetOverlayIndexByIdentify(t);if(a==null){console.warn("[MinuteChartContainer::UpdateOverlayIndex] can't find overlay index. [identify="+t+"]");return}var s=this.SourceData;s&&this.BindOverlayIndexData(a.OverlayItem,a.WindowIndex,s)},this.AddOverlayIndex=function(t){var a=this.CreateOverlayWindowsIndex(t);if(a){var s=this.SourceData;this.BindOverlayIndexData(a,t.WindowIndex,s),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.CreateOverlayWindowsIndex=function(t){var a=this,s=t.IndexName,o=t.WindowIndex,h=null,l=null,u=null;if(t.API)h=t.API;else if(t.Script)l={Script:t.Script,ID:t.indexName,Name:t.indexName},t.Name&&(l.Name=t.Name);else{var f=new J;if(l=f.Get(s),!l&&(u=Ja.Get(s),!u))return console.warn("[MinuteChartContainer::CreateOverlayIndex] can not find index["+s+"]"),null}var C=this.Frame.SubFrame[o];C.Interval=this.OverlayIndexFrameWidth;var D=new Qn;t.Identify&&(D.Identify=t.Identify);var v=null;if(this.ClassName=="MinuteChartContainer"?v=new _o:v=new Uo,v.Canvas=this.Canvas,v.MainFrame=C.Frame,v.ChartBorder=C.Frame.ChartBorder,v.GlobalOption=this.GlobalOption,t.ShowRightText===!0?v.IsShow=!0:t.ShowRightText===!1&&(v.IsShow=!1),t.IsShareY===!0&&(v.IsShareY=!0),c.IsBool(t.IsCalculateYMaxMin)&&(v.IsCalculateYMaxMin=t.IsCalculateYMaxMin),v.YSplitOperator=new Pa,v.YSplitOperator.LanguageID=this.LanguageID,v.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),v.YSplitOperator.Frame=v,v.YSplitOperator.ChartBorder=v.ChartBorder,v.YSplitOperator.SplitCount=C.Frame.YSplitOperator.SplitCount,v.YSplitOperator.GetEventCallback=function(E){return a.GetEventCallback(E)},v.YSplitOperator.HQChart=this,v.YSplitOperator.OverlayIdentify=D.Identify,t.Frame){var S=t.Frame;S.Custom&&(v.YSplitOperator.Custom=S.Custom)}if(D.Frame=v,h){var T=new Ma(h.Name,h.Script,h.Args,t,!0);T.OverlayIndex={IsOverlay:!0,Identify:D.Identify,WindowIndex:o,Frame:D},D.Script=T}else if(l){var I=l;t.Args&&(I.Args=t.Args);var F=new rn(I.Name,I.Script,I.Args,I);F.OverlayIndex={IsOverlay:!0,Identify:D.Identify,WindowIndex:o,Frame:D},D.Script=F}else{var F=u.Create();F.OverlayIndex={IsOverlay:!0,Identify:D.Identify,WindowIndex:o,Frame:D},F.Create(this,o),D.Script=F}return C.OverlayIndex.push(D),D},this.DeleteOverlayWindowsIndex=function(t){this.DeleteOverlayIndex(t,null)&&(this.Frame.ResetXYSplit(!0),this.Draw())},this.BindAllOverlayIndexData=function(t){if(!(!this.Frame||!this.Frame.SubFrame))for(var a=0;a<this.Frame.SubFrame.length;++a){var s=this.Frame.SubFrame[a];for(var o in s.OverlayIndex){var h=s.OverlayIndex[o];this.BindOverlayIndexData(h,a,t)}}},this.BindOverlayIndexData=function(t,a,s){if(t.Script){if(typeof t.Script.RequestData=="function"){t.Script.RequestData(this,a,s);return}if(typeof t.Script.ExecuteScript=="function"){t.Script.ExecuteScript(this,a,s);return}t.Script.BindData(this,a,s)}},this.GetChartPaint=function(t){var a=new Array;for(var s in this.ChartPaint)if(!(s<3)){var o=this.ChartPaint[s];o.ChartFrame==this.Frame.SubFrame[t].Frame&&a.push(o)}return a},this.CreateWindowIndex=function(t){this.WindowIndex[t].Create(this,t)},this.GetIndexInfo=function(){var t=[];for(var a in this.WindowIndex){var s=this.WindowIndex[a],o={Name:s.Name};s.ID&&(o.ID=s.ID),t.push(o)}return t},this.OnTouchFinished=function(){if(this.CorssCursorTouchEnd===!0){this.DrawDynamicInfo();return}},this.CreateExtendChart=function(t,a){var s;switch(t){case"MinuteTooltip":return a.Create&&typeof a.Create=="function"?s=a.Create():s=new wC,s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,a.LanguageID=this.LanguageID,s.SetOption(a),this.ExtendChartPaint.push(s),s;case"MinutePCTooltip":return a.Create&&typeof a.Create=="function"?s=a.Create():s=new dd,s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,a.LanguageID=this.LanguageID,s.SetOption(a),this.ExtendChartPaint.push(s),s;case"画图工具":return s=new BC,s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,s.Left=this.Frame.ChartBorder.Right,s.SetOption(a),this.ExtendChartPaint.push(s),this.Frame.ChartBorder.Right+=s.Width,s;case"MinuteBackgroundPaint":return s=new xd,s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,a.LanguageID=this.LanguageID,s.SetOption(a),this.ExtendChartPaint.push(s),s;default:return s=Sn.Create(t),s?(s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.HQChart=this,s.SetOption(a),this.ExtendChartPaint.push(s),s):null}},this.SetMinuteInfo=function(t,a){this.ChartInfo=[];for(var s in t){var o=jn.Get(t[s]);if(o){var h=o.Create();this.ChartInfo.push(h)}}a==!0&&this.RequestMinuteInfoData()},this.GetChartMinuteInfo=function(){return this.ChartInfoPaint},this.CreateMinuteInfo=function(t){var a=new rd;return a.Canvas=this.Canvas,a.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,a.ChartFrame=this.Frame.SubFrame[0].Frame,a.HQChartBorder=this.Frame.ChartBorder,a.ChartMinutePrice=this.ChartPaint[0],t&&a.SetOption&&a.SetOption(t),this.ChartInfoPaint=a,a},this.RequestMinuteInfoData=function(){if(!(this.ChartInfo.length<=0)){var t=this.GetChartMinuteInfo();t||(t=this.CreateMinuteInfo(null)),t.SourceData=this.SourceData;for(var a in this.ChartInfo)this.ChartInfo[a].RequestData(this)}},this.UpdataChartInfo=function(){var t=this.GetChartMinuteInfo();if(t){var a=new Dt.default;for(var s in this.ChartInfo){var o=this.ChartInfo[s].Data;for(var h in o){var l=o[h],u=l.Date+" "+l.Time;a.has(u)?a.get(u).Data.push(l):a.set(u,{Data:new Array(l)})}}t.Data=a}},this.RecvWindowIndex=function(t,a){var s=this.WindowIndex[t];if(s&&typeof s.RecvSubscribeData=="function"){var o=this.SourceData;s.RecvSubscribeData(a,this,t,o)}},this.UpdateWindowIndex=function(t){if(!(t<2)){var a=this.SourceData;this.BindIndexData(t,a),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw()}},this.CreateChartDrawPicture=function(t,a,s){var o=null,h=It.GetDrawPictureByName(t);if(h&&(o=h.Create(),o.ClassName=="ChartDrawPictureText"&&(o.HQChart=this)),!o&&It.MapIonFont.has(t)){var l=It.MapIonFont.get(t);o=new Wh,o.FontOption.Family=l.Family,o.Text=l.Text,l.Color&&(o.LineColor=l.Color)}if(!o)return!1;o.Canvas=this.Canvas,o.Status=0,o.Symbol=this.Symbol,o.Period=888888888,o.Option=this.ChartDrawOption,s&&(o.FinishedCallback=s),a&&o.SetOption(a);var u=this;return o.Update=function(){u.DrawDynamicInfo()},o.GetActiveDrawPicture=function(){return u.GetActiveDrawPicture()},this.CurrentChartDrawPicture=o,X.Chart.Log("[MinuteChartContainer::CreateChartDrawPicture] ",t,this.CurrentChartDrawPicture),!0},this.AddChartDrawPicture=function(t){if(!t||t.FrameID<0||t.FrameID>=this.Frame.SubFrame.length)return null;var a=this,s=It.GetDrawPictureByClassName(t.ClassName);if(!s)return null;var o=s.Create();return o.Canvas=this.Canvas,o.Status=10,o.Frame=this.Frame.SubFrame[t.FrameID].Frame,o.Symbol=this.Symbol,o.Period=888888888,t.Value&&(o.Value=t.Value),t.Guid&&(o.Guid=t.Guid),o.ImportStorageData&&o.ImportStorageData(t),o.SetOption(t),t.EnableUpdateXValue&&o.UpdateXValue(),o.ValueToPoint(),o.GetActiveDrawPicture=function(){return a.GetActiveDrawPicture()},o.ClassName==="ChartDrawPictureText"&&(o.IsInitialized=!0),this.ChartDrawPicture.push(o),t.Draw==!0&&this.DrawDynamicInfo(),o},this.ReloadChartDrawPicture=function(){this.ChartDrawPicture=[],this.ChartDrawStorageCache,this.ChartDrawStorage&&(this.ChartDrawStorageCache=this.ChartDrawStorage.GetDrawData({Symbol:this.Symbol,Period:888888888}))},this.CreateChartDrawPictureByStorage=function(){if(!(!this.ChartDrawStorageCache||this.ChartDrawStorageCache.length<=0)){for(var t in this.ChartDrawStorageCache){var a=this.ChartDrawStorageCache[t];if(!(a.FrameID<0||!this.Frame.SubFrame||this.Frame.SubFrame.length<a.FrameID)){var s=It.CreateChartDrawPicture(a);s&&(s.Canvas=this.Canvas,s.Status=10,s.Frame=this.Frame.SubFrame[a.FrameID].Frame,s.UpdateXValue(),s.ValueToPoint(),s.ClassName==="ChartDrawPictureText"&&(s.IsInitialized=!0),this.ChartDrawPicture.push(s))}}this.ChartDrawStorageCache=null}},this.SetSizeChange=function(t){this.Frame.SetSizeChage(t);for(var a in this.ExtendChartPaint){var s=this.ExtendChartPaint[a];s.SizeChange=t}},this.SetSizeChage=this.SetSizeChange,this.GetDataIndexByPoint=function(t){var a=this.Frame;if(this.Frame.SubFrame&&this.Frame.SubFrame.length>0&&(a=this.Frame.SubFrame[0].Frame),!!a){var s=a.GetXData(t),o=parseInt(s.toFixed(0));return o}},this.GetSelectRectData=function(t){if(Math.abs(t.XStart-t.XEnd)<5)return!1;var a=this.PtInClient(t.XStart,t.YStart),s=this.PtInClient(t.XEnd,t.YEnd);t.StartClientPos=a,t.EndClientPos=s;var o=this.SourceData;if(!o||!c.IsNonEmptyArray(o.Data))return!1;var h=this.GetDataIndexByPoint(t.XStart),l=this.GetDataIndexByPoint(t.XEnd);if(Math.abs(h-l)<2)return!1;t.Data=o;var u=o.DataOffset;h+=u,l+=u,h>l?(t.Start=l,t.End=h):(t.Start=h,t.End=l);var f=o.Data.length;return t.End>=f&&(t.End=f-1),!0},this.Super_UpdateFrameMaxMin=this.UpdateFrameMaxMin,this.UpdateFrameMaxMin=function(){if(this.Super_UpdateFrameMaxMin(),this.DayCount==1){var t=this.Frame.SubFrame[1];t.Frame&&(t.Frame.XYSplit=!0)}},this.ExportMainData=function(t,a){var s=t.ExportMinuteData(a);return s},this.DisplayLatest=function(){var t=this.GetEventCallback(et.ON_DISPLAY_LATEST);if(t){var a={PreventDefault:!1};if(t.Callback(t,a,this),a.PreventDefault)return}this.CursorIndex=null,this.LastPoint.X=0,this.LastPoint.Y=0,this.GlobalOption.IsDisplayLatest=!0,this.DrawDynamicInfo()},this.TryClickIndexTitle=function(t,a){for(var s=0;s<this.TitlePaint.length;++s){var o=this.TitlePaint[s];if(o.IsClickTitle&&o.IsClickTitle(t,a)){var h={Point:{X:t,Y:a},Title:o.Title,FrameID:o.Frame.Identify};X.Chart.Log("[MinuteChartContainer::TryClickIndexTitle] click title ",h);var l=this.GetEventCallback(et.ON_CLICK_INDEXTITLE);return l&&l.Callback&&l.Callback(l,h,this),!0}}return!1}}re.JsonDataToBeforeOpenData=function(r){var n=r.stock[0].symbol,e=n.toUpperCase(),t=W.IsSHSZ(e),a=r.stock[0].yclose,s=r.stock[0],o=s.date,h={Data:[],TotalCount:15,Ver:1,Date:o},l=Ze.MINUTE_BEFOREOPEN_EXTENDDATA;if(s.beforeinfo&&(c.IsNumber(s.beforeinfo.totalcount)&&(h.TotalCount=s.beforeinfo.totalcount),c.IsNumber(s.beforeinfo.ver)&&(h.Ver=s.beforeinfo.ver)),h.Ver==1){if(c.IsNonEmptyArray(s.before))for(var u=0;u<s.before.length;++u){var f=new Dr,C=s.before[u];f.Time=C[0],f.Date=o,f.Price=C[1],f.Price?a=f.Price:f.Price=a,t?f.Vol[0]=C[2]/100:f.Vol[0]=C[2],f.Amount=C[3],c.IsNumber(C[4])&&C[4]>19000101&&(f.Date=C[4]),f.DateTime=f.Date+" "+f.Time,h.Data.push(f)}}else if(h.Ver==2){var D=0;for(var u in s.before){var f=new Dr,C=s.before[u];f.Time=C[0],f.Date=o,f.Price=C[1],f.Vol[0]=C[2],f.Vol[1]=C[3],f.ColorID=C[4],c.IsNumber(C[6])&&(f.Date=C[6]),f.DateTime=f.Date+" "+f.Time+")";var v=f.Vol[0]+f.Vol[1];c.IsNumber(C[5])&&(v=C[5]),v>D&&(D=v),C[l]&&(f.ExtendData=C[l]),h.Data.push(f)}h.VolMax=D,h.VolMin=0}else if(h.Ver==3){var D=0;for(var u in s.before){var f=new Dr,C=s.before[u];f.Time=C[0],f.Date=o,f.Price=C[1],f.AvPrice=C[2],f.Vol[0]=C[3],f.ColorID=C[4],f.DateTime=o.toString()+" "+f.Time.toString();var v=f.Vol[0];c.IsNumber(C[5])&&(v=C[5]),v>D&&(D=v),C[l]&&(f.ExtendData=C[l]),h.Data.push(f)}h.VolMax=D,h.VolMin=0}return h};re.JsonDataToAfterCloseData=function(r){r.stock[0].yclose;var n=r.stock[0],e=n.date;if(!n.afterinfo)return null;var t={Data:[],TotalCount:3*60,Ver:2,Date:e},a=n.afterinfo;c.IsNumber(a.totalcount)&&(t.TotalCount=a.totalcount),c.IsNumber(a.ver)&&(t.Ver=a.ver);var s=Ze.MINUTE_AFTERCLOSE_EXTENDDATA;if(t.Ver==1)for(var o=0;o<n.after.length;++o){var a=new vr,h=n.after[o];a.Time=h[0],a.Date=e,a.Price=h[1],a.Vol[0]=h[2],a.Amount=h[3],c.IsNumber(h[4])&&(a.Date=h[4]),a.DateTime=a.Date+" "+a.Time,t.Data.push(a)}else if(t.Ver==2){var l=0;for(var o in n.after){var a=new vr,h=n.after[o];a.Time=h[0],a.Date=e,a.Price=h[1],a.Vol[0]=h[2],a.Vol[1]=h[3],a.ColorID=h[4],a.DateTime=e.toString()+" "+a.Time.toString();var u=a.Vol[0]+a.Vol[1];c.IsNumber(h[5])&&(u=h[5]),u>l&&(l=u),h[s]&&(a.ExtendData=h[s]),t.Data.push(a)}t.VolMax=l,t.VolMin=0}else if(t.Ver==3){var l=0;for(var o in n.after){var a=new vr,h=n.after[o];a.Time=h[0],a.Date=e,a.Price=h[1],a.AvPrice=h[2],a.Vol[0]=h[3],a.ColorID=h[4],a.DateTime=e.toString()+" "+a.Time.toString();var u=a.Vol[0];c.IsNumber(h[5])&&(u=h[5]),u>l&&(l=u),h[s]&&(a.ExtendData=h[s]),t.Data.push(a)}t.VolMax=l,t.VolMin=0}return t};re.JsonDataToMinuteData=function(r,n){var e=r.stock[0].symbol,t=e.toUpperCase(),a=W.IsSHSZ(t),s=W.IsFutures(t),o=W.IsSHO(t),h=W.IsSZO(t),l=[],u=r.stock[0].yclose,f=r.stock[0].yclose,C=r.stock[0].yclose;if(s&&r.stock[0].yclearing&&(C=u=f=r.stock[0].yclearing),!c.IsNonEmptyArray(r.stock[0].minute))return l;for(var D=r.stock[0].date,v=0;v<r.stock[0].minute.length;++v){var S=r.stock[0].minute[v],T=new mr;T.Close=S.price,T.Open=S.open,T.High=S.high,T.Low=S.low,a?T.Vol=S.vol/100:T.Vol=S.vol,T.Amount=S.amount,S.date>0&&(D=S.date),T.DateTime=D.toString()+" "+S.time.toString(),T.Date=D,T.Time=S.time,(s||o||h||c.IsNumber(S.position))&&(T.Position=S.position),T.Increase=S.increase,T.Risefall=S.risefall,T.AvPrice=S.avprice,c.IsNumber(S.lead)&&(T.Lead=S.lead),c.IsNumber(T.Close)||(T.Close=u,T.Open=T.High=T.Low=T.Close),T.AvPrice||(T.AvPrice=f),C&&T.Close&&(T.Increase=(T.Close-C)/C*100);var I=Math.abs(T.AvPrice-T.Close);a&&I>T.Close*.13&&(T.AvPrice=f),c.IsNumber(S.price)&&(u=S.price),c.IsNumber(S.avprice)&&T.AvPrice===S.avprice&&(f=S.avprice),S.ExtendData&&(T.ExtendData=S.ExtendData),l[v]=T}return l};re.JsonDataToUpdateMinuteData=function(r){if(!r||!r.stock)return null;var n=r.stock[0];if(!c.IsNumber(n.date))return null;var e=r.stock[0].symbol,t=e.toUpperCase(),a=W.IsSHSZ(t),s={Date:n.date,Data:[],Symbol:e,Name:n.name},o=Ze.MINUTE_DAY_EXTENDDATA;if(c.IsNumber(n.high)&&(s.High=n.high),c.IsNumber(n.low)&&(s.Low=n.low),c.IsNumber(n.yclose)&&(s.YClose=n.yclose),c.IsNumber(n.YClearing)&&(s.YClearing=n.yclearing),c.IsNonEmptyArray(r.stock[0].minute))for(var h=0;h<n.minute.length;++h){var l=n.minute[h],u=new mr;u.Date=l[0],u.Time=l[1],u.Open=l[2],u.High=l[3],u.Low=l[4],u.Close=l[5],u.AvPrice=l[6],u.Vol=l[7],u.Amount=l[8],c.IsNumber(l[9])&&(u.Increase=l[9]),c.IsNumber(l[10])&&(u.Risefall=l[10]),c.IsNumber(l[11])&&(u.Lead=l[11]),l[o]&&(u.ExtendData=l[o]),u.DateTime=u.Date.toString()+" "+u.Time.toString(),a&&(u.Vol=u.Vol/100),c.IsNumber(s.YClose)&&u.Close&&(u.Increase=(u.Close-s.YClose)/s.YClose*100),s.Data.push(u)}return s};re.JsonDataToMinuteLineColorData=function(r){if(!r||!r.stock[0])return null;var n=r.stock[0];if(!n.linecolor||!c.IsNonEmptyArray(n.linecolor.data))return null;var e=[];for(var t in n.linecolor.data){var a=n.linecolor.data[t];if(!(!c.IsNumber(a.type)||!c.IsNumber(a.date)||!c.IsNumber(a.start)||!c.IsNumber(a.end)||!a.color)&&!(a.start>=a.end)){var s={Type:a.type,Date:a.date,Start:a.start,End:a.end,Color:a.color};c.IsPlusNumber(a.linewidth)&&(s.LineWidth=a.linewidth),e.push(s)}}return e};re.JsonDataToMinuteLastUpdateTime=function(r){if(!r||!r.stock[0])return null;var n=r.stock[0];return!c.IsNumber(n.date)||!c.IsNumber(n.time)?null:{Date:n.date,Time:n.time}};re.JsonDataToHistoryMinuteLastUpdateTime=function(r){if(!r||!r.updatetime)return null;var n=r.updatetime;return!c.IsNumber(n.date)||!c.IsNumber(n.time)?null:{Date:n.date,Time:n.time}};re.JsonDataToMinuteDataArray=function(r){var n=r.symbol,e=n.toUpperCase(),t=W.IsSHSZ(e),a=W.IsSHO(e),s=W.IsSZO(e),o=W.IsFutures(e),h=[],l=Ze.MINUTE_MULTI_DAY_EXTENDDATA;for(var u in r.data){var f=[],C=r.data[u],D=C.date,v=C.yclose,S=v,T=null,I=C.yclearing;for(var F in C.minute){var E=C.minute[F];E[2]&&(S=E[2]);var M=new mr;if(M.Close=E[2],M.Open=E[1],M.High=E[3],M.Low=E[4],t?M.Vol=E[5]/100:M.Vol=E[5],M.Amount=E[6],7<E.length&&E[7]>0&&(M.AvPrice=E[7]),M.DateTime=D.toString()+" "+E[0].toString(),M.Date=D,M.Time=E[0],8<E.length&&E[8]>0&&(M.Date=E[8],M.DateTime=M.Date.toString()+" "+E[0].toString()),(o||a||s)&&9<E.length&&(M.Position=E[9]),c.IsNumber(M.Close)||(M.Close=S,M.Open=M.High=M.Low=M.Close),!M.AvPrice&&T&&(M.AvPrice=T),M.Close&&v?M.Increase=(M.Close-v)/v*100:M.Increase=null,M.AvPrice&&t){var O=Math.abs(M.AvPrice-M.Close);O>M.Close*.13&&(M.AvPrice=T)}E.length>7&&E[7]>0&&M.AvPrice===E[7]&&(T=E[7]),E[l]&&(M.ExtendData=E[l]),f[F]=M}var R=new k;R.Data=f,R.YClose=v,R.Close=C.close,R.Date=D,c.IsNumber(I)&&(R.YClearing=I),h.push(R)}return h};re.JsonDataToHistoryMinuteLineColorData=function(r){if(!r)return null;var n=[];for(var e in r.data){var t=r.data[e];if(t.linecolor)for(var a in t.linecolor.data){var s=t.linecolor.data[a];if(!(!c.IsNumber(s.type)||!c.IsNumber(s.date)||!c.IsNumber(s.start)||!c.IsNumber(s.end)||!s.color)&&!(s.start>=s.end)){var o={Type:s.type,Date:s.date,Start:s.start,End:s.end,Color:s.color};c.IsPlusNumber(s.linewidth)&&(o.LineWidth=s.linewidth),n.push(o)}}}return n.length>0?n:null};re.JsonDataToCallAuctionItem=function(r,n,e,t){var a=!1;if(t){var s=t.toUpperCase();a=W.IsSHSZ(s)}var o=n.Date,h=e?Ze.MINUTE_BEFOREOPEN_EXTENDDATA:Ze.MINUTE_AFTERCLOSE_EXTENDDATA;if(n.Ver==1){var l=null;for(var u in r){var f=e?new Dr:new vr,C=r[u];f.Time=C[0],f.Date=o,f.Price=C[1],f.Price?l=f.Price:f.Price=l,f.Vol[0]=a?C[2]/100:C[2],f.Amount=C[3],c.IsNumber(C[4])&&(f.Date=C[4]),f.DateTime=f.Date+" "+f.Time,n.Data.push(f)}}else if(n.Ver==2){var D=0;for(var u in r){var f=e?new Dr:new vr,C=r[u];f.Time=C[0],f.Date=o,f.Price=C[1],f.Vol[0]=C[2],f.Vol[1]=C[3],f.ColorID=C[4],f.DateTime=o.toString()+" "+f.Time.toString();var v=f.Vol[0]+f.Vol[1];c.IsNumber(C[5])&&(v=C[5]),v>D&&(D=v),C[h]&&(f.ExtendData=C[h]),n.Data.push(f)}n.VolMax=D,n.VolMin=0}else if(beforeOpenData.Ver==3){var D=0;for(var u in r){var f=e?new Dr:new vr,C=r[u];f.Time=C[0],f.Date=o,f.Price=C[1],f.AvPrice=C[2],f.Vol[0]=C[3],f.ColorID=C[4],f.DateTime=o.toString()+" "+f.Time.toString();var v=f.Vol[0];c.IsNumber(C[5])&&(v=C[5]),v>D&&(D=v),C[h]&&(f.ExtendData=C[h]),n.Data.push(f)}n.VolMax=D,n.VolMin=0}};re.JosnDataToBeforeOpenDataArray=function(r){if(!r||!r.data)return null;var n=[];for(var e in r.data){var t=r.data[e],a={Data:[],TotalCount:15,Ver:1,Date:t.date};t.beforeinfo&&(c.IsNumber(t.beforeinfo.totalcount)&&(a.TotalCount=t.beforeinfo.totalcount),c.IsNumber(t.beforeinfo.ver)&&(a.Ver=t.beforeinfo.ver)),re.JsonDataToCallAuctionItem(t.before,a,!0,r.symbol),n.push(a)}return n.sort(function(s,o){return s.Date-o.Date}),n};re.JosnDataToAfterCloseDataArray=function(r){if(!r||!r.data)return null;var n=[];for(var e in r.data){var t=r.data[e],a={Data:[],TotalCount:15,Ver:1,Date:t.date};t.afterinfo&&(c.IsNumber(t.afterinfo.totalcount)&&(a.TotalCount=t.afterinfo.totalcount),c.IsNumber(t.afterinfo.ver)&&(a.Ver=t.afterinfo.ver)),re.JsonDataToCallAuctionItem(t.after,a,!1,r.symbol),n.push(a)}return n.sort(function(s,o){return s.Date-o.Date}),n};function Kh(r){this.newMethod=re,this.newMethod(r),delete this.newMethod,this.HistoryMinuteApiUrl="https://opensourcecache.zealink.com/cache/minuteday/day/",this.ClassName="HistoryMinuteChartContainer",this.CreateMainKLine=function(){var n=new Hh;n.Canvas=this.Canvas,n.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,n.ChartFrame=this.Frame.SubFrame[0].Frame,n.Name="Minute-Line",n.Color=m.Minute.PriceColor,this.ChartPaint[0]=n;var e=new Ye;e.Canvas=this.Canvas,e.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,e.ChartFrame=this.Frame.SubFrame[0].Frame,e.Name="Minute-Average-Line",e.Color=m.Minute.AvPriceColor,this.ChartPaint[1]=e;var e=new Bh;e.Color=m.Minute.VolBarColor,e.Canvas=this.Canvas,e.ChartBorder=this.Frame.SubFrame[1].Frame.ChartBorder,e.ChartFrame=this.Frame.SubFrame[1].Frame,e.Name="Minute-Vol-Bar",this.ChartPaint[2]=e,this.TitlePaint[0]=new WC,this.TitlePaint[0].Frame=this.Frame.SubFrame[0].Frame,this.TitlePaint[0].Canvas=this.Canvas,this.TitlePaint[0].IsShowDate=!0},this.ChangeTradeDate=function(n){n&&(this.TradeDate=n,this.RequestData())},this.RequestData=function(){var n=new Date,e=n.getFullYear()*1e4+(n.getMonth()+1)*100+n.getDate();e==this.TradeDate?this.RequestMinuteData():this.RequestHistoryMinuteData()},this.RequestHistoryMinuteData=function(){var n=this,e=this.HistoryMinuteApiUrl+this.TradeDate.toString()+"/"+this.Symbol+".json";Lt.HttpRequest({url:e,type:"get",dataType:"json",async:!0,success:function(a){n.ChartSplashPaint.EnableSplash(!1),n.RecvHistoryMinuteData(a)},error:function(a){n.ChartSplashPaint.EnableSplash(!1),n.RecvHistoryMinuteError(a)}})},this.RecvHistoryMinuteError=function(n){if(n.status==404){var e=new k;this.SourceData=e;for(var t in this.ChartPaint)this.ChartPaint[t].Data=e,t==0&&(this.ChartPaint[t].NotSupportMessage="没有权限访问!");this.TitlePaint[0].Data=this.SourceData,this.TitlePaint[0].Symbol=this.Symbol,this.TitlePaint[0].Name=null,this.Draw()}},this.RecvHistoryMinuteData=function(n){var e=Kh.JsonDataToMinuteData(n),t=new k;if(t.Data=e,this.TradeDate=n.date,this.SourceData=t,this.Symbol=n.symbol,this.Name=n.name,this.BindMainData(t,n.day.yclose),this.Frame.SubFrame.length>2){var a=new k;a.Data=e;for(var s=2;s<this.Frame.SubFrame.length;++s)this.BindIndexData(s,a)}this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}}Kh.JsonDataToMinuteData=function(r){var n=[];for(var e in r.minute.time){var t=new mr;r.minute.price[e]<=0&&e>0?(t.Close=n[e-1].Close,t.Open=n[e-1].Close,t.High=t.Close,t.Low=t.Close,t.Vol=r.minute.vol[e],t.Amount=r.minute.amount[e],t.DateTime=r.date.toString()+" "+r.minute.time[e].toString(),t.AvPrice=n[e-1].AvPrice):(t.Close=r.minute.price[e],t.Open=r.minute.open[e],t.High=r.minute.high[e],t.Low=r.minute.low[e],t.Vol=r.minute.vol[e],t.Amount=r.minute.amount[e],t.DateTime=r.date.toString()+" "+r.minute.time[e].toString(),t.AvPrice=r.minute.avprice[e]),t.Open<=0&&(t.Open=null),t.Close<=0&&(t.Close=null),t.AvPrice<=0&&(t.AvPrice=null),t.High<=0&&(t.High=null),t.Low<=0&&(t.Low=null),n[e]=t}return n};function Om(r){this.newMethod=Te,this.newMethod(r),delete this.newMethod,this.ClassName="CustomKLineChartContainer",this.CustomKLineApiUrl=m.Domain+"/API/IndexCalculate",this.CustomStock,this.QueryDate={Start:20180101,End:20180627},this.RequestHistoryData=function(){var n=this;this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.Draw(),Lt.HttpRequest({url:this.CustomKLineApiUrl,data:{stock:n.CustomStock,Name:n.Symbol,date:{startdate:n.QueryDate.Start,enddate:n.QueryDate.End}},type:"post",dataType:"json",async:!0,success:function(t){n.ChartSplashPaint.EnableSplash(!1),n.RecvHistoryData(t)}})},this.RecvHistoryData=function(n){var e=Te.JsonDataToHistoryData(n),t=new k;t.Data=e,t.DataType=0;var a=new k;if(a.Data=e,a.Right=this.Right,a.Period=this.Period,a.DataType=0,a.Right>0){var s=a.GetRightData(a.Right,{AlgorithmType:this.RightFormula});a.Data=s}if(k.IsDayPeriod(this.Period,!1)){var o=t.GetPeriodData(a.Period);a.Data=o}this.SourceData=t,this.Name=n.name,this.BindMainData(a,this.PageSize);for(var h=0;h<this.Frame.SubFrame.length;++h)this.BindIndexData(h,a);this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}}function qC(r,n){n===!0?(this.newMethod=jC,this.newMethod(r),delete this.newMethod):(this.newMethod=Te,this.newMethod(r),delete this.newMethod),this.BuySellPaint,this.TrainDataCount=300,this.TrainStartDate,this.AutoRunTimer=null,this.BuySellData=[],this.TrainCallback,this.DragMode=1,this.IsAutoUpdate=!1,this.KLineSourceData,this.TrainInfo={Start:{},End:{}},this.Super_RecvFlowCapitalData=this.RecvFlowCapitalData,this.CreateBuySellPaint=function(){var e=new Cd;e.Canvas=this.Canvas,e.ChartBorder=this.Frame.SubFrame[0].Frame.ChartBorder,e.ChartFrame=this.Frame.SubFrame[0].Frame,e.Name="KLine-Train-BuySell",this.ChartPaintEx[0]=e},this.GetKDataIndexByDateTime=function(e,t){if(!t||!e)return-1;for(var a=0;a<e.length;++a){var s=e[a];if(k.IsMinutePeriod(this.Period,!0)){if(c.IsNumber(this.TrainStartDate.Time)){if(s.Date>=this.TrainStartDate.Date&&s.Time>=this.TrainStartDate.Time)return a}else if(s.Date>=this.TrainStartDate.Date)return a}else if((k.IsDayPeriod(this.Period,!0)||k.IsTickPeriod(this.Period))&&s.Date>=this.TrainStartDate.Date)return a}return-1},this.AfterBindMainData=function(e){this.ChartPaintEx[0]||this.CreateBuySellPaint();var t=this.ChartPaint[0].Data;this.ChartPaintEx[0].Data=t;var a=t.Data[t.Data.length-1];this.TrainInfo.LastShowData=a,this.TrainInfo.LastData=this.SourceData.Data[this.SourceData.Data.length-1],e!="Update"&&this.UpdateTrainUICallback("开始")},this.BeforeBindMainData=function(e){if(e!="Update"){this.KLineSourceData=new k,this.KLineSourceData.Data=this.SourceData.Data.slice(0);var t=this.SourceData.Data.length,a=t-this.TrainDataCount-20,s=this.GetKDataIndexByDateTime(this.SourceData.Data,this.TrainStartDate);s>=0&&(a=s+1,t-a<this.TrainDataCount&&(this.TrainDataCount=t-a));var o=a-1,h=this.SourceData.Data[o];this.TrainInfo.Start.Index=o,this.TrainInfo.Start.Date=h.Date,this.TrainInfo.Start.Time=h.Time,this.TrainInfo.End.Index=o,this.TrainInfo.End.Date=h.Date,this.TrainInfo.End.Time=h.Time,this.TrainInfo.LastData=h,this.SourceData.Data.length=a}},this.Run=function(e){if(!this.AutoRunTimer&&!(this.TrainDataCount<=0)){var t=this;this.AutoRunTimer=setInterval(function(){t.MoveNextKLineData(e)||clearInterval(t.AutoRunTimer)},1e3)}},this.MoveNextKLineData=function(e){if(this.TrainDataCount<=0)return!1;var t=1;e&&e.Step>1&&(t=e.Step);for(var a=0,s=0;s<t;++s){var o=this.TrainInfo.End.Index+1;if(o>=this.KLineSourceData.Data.length)break;var h=this.KLineSourceData.Data[o];if(this.SourceData.Data.push(h),this.TrainInfo.End.Index=o,this.TrainInfo.End.Date=h.Date,this.TrainInfo.End.Time=h.Time,--this.TrainDataCount,++a,this.TrainDataCount<=0)break}if(a==0)return!1;var l=this.Frame.GetCurrentPageSize();return c.IsNumber(l)&&(this.PageSize=l-this.RightSpaceCount),e&&e.PageSize>0&&(this.PageSize=e.PageSize),this.Update(),this.TrainDataCount<=0?(this.FinishTrainData(),this.UpdateTrainUICallback("结束"),!1):(this.UpdateTrainUICallback("训练中"),!0)},this.UpdateTrainUICallback=function(e){if(this.mapEvent.has(et.RECV_TRAIN_MOVE_STEP)){var t=this.mapEvent.get(et.RECV_TRAIN_MOVE_STEP);if(t.Callback){var a={TrainDataCount:this.TrainDataCount,BuySellData:this.BuySellData,KLine:{Start:{Index:this.TrainInfo.Start.Index,Date:this.TrainInfo.Start.Date},End:{Index:this.TrainInfo.End.Index,Date:this.TrainInfo.End.Date}},LastData:this.TrainInfo.LastData,LastShowData:this.TrainInfo.LastShowData};c.IsNumber(this.TrainInfo.Start.Time)&&(a.KLine.Start.Time=this.TrainInfo.Start.Time),c.IsNumber(this.TrainInfo.End.Time)&&(a.KLine.End.Time=this.TrainInfo.End.Time),e&&(a.Description=e),this.TrainDataCount<=0&&(a.Symbol=this.Symbol,a.Name=this.Name),t.Callback(t,a,this)}}},this.FinishTrainData=function(){X.Chart.Log("[KLineTrainChartContainer::FinishTrainData] trian end ")},this.Stop=function(){this.AutoRunTimer!=null&&clearInterval(this.AutoRunTimer),this.AutoRunTimer=null},this.BuyOrSell=function(e,t){var a=this.TrainInfo.LastShowData;if(!a)return!1;var s=this.ChartPaintEx[0];if(!s)return!1;var o=this.ChartPaint[0].Data;if(!o||o.Data.length<=0)return!1;var h=o.Data.length-1,l={Date:this.TrainInfo.End.Date,Time:this.TrainInfo.End.Time,Price:e.Price,Vol:e.Vol,Op:0,ID:e.ID};e.Op==1&&(l.Op=1);var u=h;l.Key=u,this.BuySellData.push(l),s.AddTradeItem(l),t==!0&&this.Draw()},this.RestartTrain=function(e){X.Chart.Log("[KLineTrainChartContainer::RestartTrain] option ",e),this.TrainInfo={Start:{},End:{}},this.BuySellData=[],this.KLineSourceData=null;var t=this.ChartPaintEx[0];t&&(t.Data=null,t.ClearTradeData()),e.Symbol&&(this.Symbol=e.Symbol),c.IsNumber(e.Period)&&(this.Period=e.Period),c.IsNumber(e.Right)&&(this.Right=e.Right),e.Train&&(e.Train.DataCount>1&&(this.TrainDataCount=e.Train.DataCount),e.Train.DateTime&&(this.TrainStartDate=e.Train.DateTime));var a=this.Symbol;this.ChangeSymbol(a)},this.RecvFlowCapitalData=function(e){if(!(!e.stock||e.stock.length!=1)){var t=e.stock[0],a=new Array;for(var s in t.stockday){var o=t.stockday[s],h=new yt;h.Date=o.date;var l=o.capital;l&&l.a>0&&(h.Value=l.a,a.push(h))}if(k.IsMinutePeriod(this.Period,!0)){var v=this.SourceData.GetMinuteFittingFinanceData(a);for(var u in this.SourceData.Data){var o=this.SourceData.Data[u];v[u]&&(o.FlowCapital=v[u].Value)}var f=this.ChartPaint[0].Data,C=new k;if(C.Data=this.SourceData.Data,k.IsMinutePeriod(f.Period,!1)){var D=C.GetPeriodData(f.Period);C.Data=D}f.Data=C.Data;var v=this.KLineSourceData.GetMinuteFittingFinanceData(a);for(var S in this.KLineSourceData.Data){var o=this.KLineSourceData.Data[S];v[S]&&(o.FlowCapital=v[S].Value)}}else{var v=this.SourceData.GetFittingFinanceData(a);for(var T in this.SourceData.Data){var o=this.SourceData.Data[T];v[T]&&(o.FlowCapital=v[T].Value)}var f=this.ChartPaint[0].Data,C=new k;if(C.Data=this.SourceData.Data,f.Right>0){var I=C.GetRightData(f.Right,{AlgorithmType:this.RightFormula});C.Data=I}if(k.IsDayPeriod(f.Period,!1)){var D=C.GetPeriodData(f.Period);C.Data=D}f.Data=C.Data;var v=this.KLineSourceData.GetFittingFinanceData(a);for(var F in this.KLineSourceData.Data){var o=this.KLineSourceData.Data[F];v[F]&&(o.FlowCapital=v[F].Value)}}this.FlowCapitalReady=!0;var E=!1;for(var M in this.ExtendChartPaint){var o=this.ExtendChartPaint[M];if(o.ClassName=="StockChip"){E=!0;break}}E&&this.Draw()}},this.AutoUpdate()}function Rm(r,n){this.newMethod=qC,this.newMethod(r,n),delete this.newMethod,this.IsHScreen=n,this.IsZoomLockRight=!0,this.RightSpaceCount=0,this.RecvFlowCapitalData=function(e){this.Super_RecvFlowCapitalData(e)},this.BeforeBindMainData=function(e){},this.UpdateLastDataIcon=function(){if(this.ChartPaintEx[0]){var e=this.ChartPaintEx[0];e.LastDataIndex=this.TrainInfo.End.Index}},this.AfterBindMainData=function(e){if(this.ChartPaintEx[0]||(this.CreateBuySellPaint(),this.ChartPaintEx[0].LastDataDrawType=1),e!="Update"){var t=this.ChartOperator_Temp_GetHistroyData();if(!t)return!1;var a=t.Data.length,s=a-this.TrainDataCount-20,o=this.Frame.SubFrame[0].Frame.XPointCount,h=this.GetKDataIndexByDateTime(t.Data,this.TrainStartDate);h>=0&&(s=h+1,a-s<this.TrainDataCount&&(this.TrainDataCount=a-s));var l=s-o;t.DataOffset=l;var u=s-1,f=t.Data[u];this.TrainInfo.LastShowData=f,this.TrainInfo.LastData=f,this.TrainInfo.Start.Index=u,this.TrainInfo.Start.Date=f.Date,this.TrainInfo.Start.Time=f.Time,this.TrainInfo.End.Index=u,this.TrainInfo.End.Date=f.Date,this.TrainInfo.End.Time=f.Time,this.UpdateLastDataIcon(),this.UpdateTrainUICallback("开始")}},this.Super_UpdataDataoffset=this.UpdataDataoffset,this.UpdataDataoffset=function(){this.Super_UpdataDataoffset();var e=this.ChartPaint[0].Data;this.ChartPaintEx[0].Data=e},this.MoveNextKLineData=function(e){if(this.TrainDataCount<=0)return!1;var t=this.ChartOperator_Temp_GetHistroyData();if(!t)return!1;var a=1;e&&e.Step>1&&(a=e.Step);for(var s=t.Data.length,o=0,h=0;h<a;++h){var l=this.TrainInfo.End.Index+1;if(l>=s)break;var u=t.Data[l];if(this.TrainInfo.End.Index=l,this.TrainInfo.End.Date=u.Date,this.TrainInfo.End.Time=u.Time,--this.TrainDataCount,++o,this.TrainDataCount<=0)break}if(o==0)return!1;this.TrainInfo.LastShowData=u,this.TrainInfo.LastData=u;var f=this.TrainInfo.End.Index,C=this.Frame.SubFrame[0].Frame.XPointCount,D=f-C+1;return t.DataOffset=D,this.UpdateLastDataIcon(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.TrainDataCount<=0?(this.FinishTrainData(),this.UpdateTrainUICallback("结束"),!1):(this.UpdateTrainUICallback("训练中"),!0)},this.BuyOrSell=function(e,t){var a=this.TrainInfo.LastShowData;if(!a)return!1;var s=this.ChartPaintEx[0];if(!s)return!1;var o=this.ChartPaint[0].Data;if(!o||o.Data.length<=0)return!1;var h=this.TrainInfo.End.Index,l={Date:this.TrainInfo.End.Date,Time:this.TrainInfo.End.Time,Price:e.Price,Vol:e.Vol,Op:0,ID:e.ID};e.Op==1&&(l.Op=1);var u=h;l.Key=u,this.BuySellData.push(l),s.AddTradeItem(l),t==!0&&this.Draw()},this.DataMove=function(e,t){var a=this.GetMoveOneStepWidth(),s=e;if(e=parseInt(e/a),e<=0)return!1;var o=this.ChartOperator_Temp_GetHistroyData();if(!o)return!1;var h=0;if(this.Frame.XPointCount?h=this.Frame.XPointCount:h=this.Frame.SubFrame[0].Frame.XPointCount,!h)return!1;if(this.Frame.SubFrame&&this.Frame.SubFrame.length>0&&this.Frame.SubFrame[0].Frame){var l=this.Frame.SubFrame[0].Frame;(l.DataWidth<=1||l.DistanceWidth<=1)&&c.IsPlusNumber(this.StepPixel)&&(e=s*this.StepPixel)}if(t){if(this.RightSpaceCount>0){if(h+o.DataOffset>=o.Data.length+this.RightSpaceCount-1)return!1;o.DataOffset+=e,o.DataOffset+h>=o.Data.length+this.RightSpaceCount&&(o.DataOffset=o.Data.length-(h-this.RightSpaceCount))}else{var u=this.TrainInfo.End.Index+1;if(h+o.DataOffset>=u)return!1;o.DataOffset+=e,o.DataOffset+h>=u&&(o.DataOffset=u-h)}return!0}else return o.DataOffset<=0?!1:(o.DataOffset-=e,o.DataOffset<0&&(o.DataOffset=0),!0)},this.DataMoveRight=function(){var e=this.ChartOperator_Temp_GetHistroyData();if(!e)return!1;var t=0;if(this.Frame.XPointCount?t=this.Frame.XPointCount:t=this.Frame.SubFrame[0].Frame.XPointCount,!t)return!1;var a=this.TrainInfo.End.Index+1;return t+e.DataOffset>=a?!1:(++e.DataOffset,!0)}}function jC(r){this.newMethod=Te,this.newMethod(r),delete this.newMethod,this.ClassName="KLineChartHScreenContainer",this.OnMouseMove=function(n,e,t,a){this.LastPoint.X=n,this.LastPoint.Y=e,this.CursorIndex=this.Frame.GetXData(e);var s={ParentFunction:"OnMouseMove",Point:{X:n,Y:e},IsPhone:a===!0};this.DrawDynamicInfo(s)},r.onmousedown=function(n){if(this.JSChartContainer&&this.JSChartContainer.DragMode!=0){var e=V();if(this.JSChartContainer.TryClickLock){var t=(n.clientX-this.getBoundingClientRect().left)*e,a=(n.clientY-this.getBoundingClientRect().top)*e;if(this.JSChartContainer.TryClickLock(t,a))return}var s={Click:{},LastMove:{}};s.Click.X=n.clientX,s.Click.Y=n.clientY,s.LastMove.X=n.clientX,s.LastMove.Y=n.clientY,this.JSChartContainer.MouseDrag=s,document.JSChartContainer=this.JSChartContainer,this.JSChartContainer.SelectChartDrawPicture=null,r.ondblclick=function(o){var h=o.clientX-this.getBoundingClientRect().left,l=o.clientY-this.getBoundingClientRect().top;this.JSChartContainer&&this.JSChartContainer.OnDoubleClick(h,l,o)},document.onmousemove=function(o){if(this.JSChartContainer&&!(this.JSChartContainer.ChartSplashPaint&&this.JSChartContainer.ChartSplashPaint.IsEnableSplash==!0)){var h=this.JSChartContainer.MouseDrag;if(h){var l=Math.abs(h.LastMove.Y-o.clientY);if(this.JSChartContainer.DragMode==1){if(l<5)return;var u=this.JSChartContainer.GetMoveOneStepWidth();if(l<u)return;var f=!0;h.LastMove.Y<o.clientY&&(f=!1),this.JSChartContainer.DataMove(l,f)&&(this.JSChartContainer.UpdataDataoffset(),this.JSChartContainer.UpdatePointByCursorIndex(),this.JSChartContainer.UpdateFrameMaxMin(),this.JSChartContainer.ResetFrameXYSplit(),this.JSChartContainer.Draw()),h.LastMove.X=o.clientX,h.LastMove.Y=o.clientY}}}},document.onmouseup=function(o){document.onmousemove=null,document.onmouseup=null,this.JSChartContainer.MouseDrag=null,this.JSChartContainer.CurrentChartDrawPicture=null,this.JSChartContainer=null}}},this.OnTouchStart=function(n){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){this.PhonePinch=null,this.IsOnTouch=!0,this.TouchDrawCount=0,this.StopDragTimer();var e=this.IsSingleTouch(n);if(n.cancelable&&n.preventDefault(),this.IsPhoneDragging(n)){var t=this.GetToucheData(n,!1),a=this.PointAbsoluteToRelative(t[0].clientX,t[0].clientY,!0);if(this.TryClickLock||this.TryClickIndexTitle){var s=a.X,o=a.Y;if(this.TryClickLock&&this.TryClickLock(s,o)||this.TryClickIndexTitle&&this.TryClickIndexTitle(s,o))return}if(this.ClickFrameButton){var h=this.Frame.PtInButtons(a.X,a.Y);if(h){this.ClickFrameButton(h,n);return}}this.EnableVerticalDrag&&(this.VerticalDrag={IsDrag:!1},this.Frame.PtInFrameVertical(a.X,a.Y)&&(this.VerticalDrag.IsDrag=!0));var l=!0;this.ChartDrawOption.IsLockScreen?l=!1:this.DragMode==be.CLICK_TOUCH_MODE_ID?this.TouchStatus.CorssCursorShow==!0&&(l=!1):this.DragMode==be.DISABLE_DRAG_ID?l=!1:e||(l=!1),this.VerticalDrag&&(l=!1);var u={Click:{},LastMove:{}};if(u.Click.X=t[0].clientX,u.Click.Y=t[0].clientY,u.LastMove.X=t[0].clientX,u.LastMove.Y=t[0].clientY,this.MouseDrag=u,this.PhoneTouchInfo={Start:{X:t[0].clientX,Y:t[0].clientY},End:{X:t[0].clientX,Y:t[0].clientY}},this.SelectChartDrawPicture&&(this.SelectChartDrawPicture.IsSelected=!1),this.SelectChartDrawPicture=null,this.CurrentChartDrawPicture){var f=this.CurrentChartDrawPicture;f.Status==2?this.SetChartDrawPictureThirdPoint(u.Click.X,u.Click.Y,!0):(this.SetChartDrawPictureFirstPoint(u.Click.X,u.Click.Y,!0),this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo({Corss:!1,Tooltip:!1})),n.cancelable&&n.preventDefault();return}else{var C={};if(C.X=t[0].clientX-r.getBoundingClientRect().left,C.Y=t[0].clientY-r.getBoundingClientRect().top,this.GetChartDrawPictureByPoint(C)){C.ChartDrawPicture.Status=20,C.ChartDrawPicture.ValueToPoint(),C.ChartDrawPicture.MovePointIndex=C.PointIndex,C.ChartDrawPicture.IsSelected=!0,this.CurrentChartDrawPicture=C.ChartDrawPicture,this.SelectChartDrawPicture=C.ChartDrawPicture;var D=this.GetEventCallback(et.ON_CLICK_DRAWPICTURE);if(D&&D.Callback){var v={DrawPicture:C.ChartDrawPicture};D.Callback(D,v,this)}n.cancelable&&n.preventDefault();return}}if(l){var S=this;this.DragTimer=setTimeout(function(){u.Click.X==u.LastMove.X&&u.Click.Y==u.LastMove.Y&&(S.MouseDrag,S.MouseDrag=null,S.MoveCorssCursor(u.Click,n))},S.PressTime)}this.ChartDrawOption.IsLockScreen?this.MouseDrag=null:this.DragMode==be.CLICK_TOUCH_MODE_ID||(this.DragMode==be.DISABLE_DRAG_ID?(this.MouseDrag=null,this.MoveCorssCursor(u.Click,n)):this.VerticalDrag?this.VerticalDrag.IsDrag||this.MoveCorssCursor(u.Click,n):this.IsClickShowCorssCursor&&this.MoveCorssCursor(u.Click,n))}else if(this.IsPhonePinching(n)){var T={Start:{},Last:{}},t=this.GetToucheData(n,!1);T.Start={X:t[0].pageX,Y:t[0].pageY,X2:t[1].pageX,Y2:t[1].pageY},T.Last={X:t[0].pageX,Y:t[0].pageY,X2:t[1].pageX,Y2:t[1].pageY},this.PhonePinch=T,this.SelectChartDrawPicture=null}this.TouchEvent({EventID:et.ON_PHONE_TOUCH,FunctionName:"OnTouchStart"},n)}},this.OnTouchMove=function(n){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){n.cancelable&&n.preventDefault();var e=this.GetToucheData(n,!1);if(this.IsPhoneDragging(n)){var t=this.MouseDrag;if(t==null)this.ChartDrawOption.IsLockScreen||this.MoveCorssCursor({X:e[0].clientX,Y:e[0].clientY},n);else{var a=Math.abs(t.LastMove.Y-e[0].clientY),s=Math.abs(t.LastMove.X-e[0].clientX),o=this.DragMode==be.CLICK_TOUCH_MODE_ID&&this.TouchStatus.CorssCursorShow==!0;if(this.VerticalDrag&&(this.VerticalDrag.IsDrag===!0?o=!1:o=!0),this.CurrentChartDrawPicture){var h=this.CurrentChartDrawPicture;if(h.Status==1||h.Status==2){if(a<5&&s<5)return;this.SetChartDrawPictureSecondPoint(e[0].clientX,e[0].clientY,!0)&&this.DrawDynamicInfo()}else if(h.Status==3)this.SetChartDrawPictureThirdPoint(e[0].clientX,e[0].clientY,!0)&&this.DrawDynamicInfo();else if(h.Status==20){if(a<5&&s<5)return;this.MoveChartDrawPicture(e[0].clientX-t.LastMove.X,e[0].clientY-t.LastMove.Y,!0)&&this.DrawDynamicInfo()}t.LastMove.X=e[0].clientX,t.LastMove.Y=e[0].clientY}else if(o)this.MouseDrag,this.MouseDrag=null,this.MoveCorssCursor(t.Click,n);else if(this.DragMode==1||o==!1){if(a<5)return;var l=this.GetMoveOneStepWidth();if(a<l||this.EnableVerticalDrag&&(!this.VerticalDrag||!this.VerticalDrag.IsDrag))return;var u=!0;t.LastMove.Y<e[0].clientY&&(u=!1),this.DataMove(a,u)?(this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.ResetFrameXYSplit(),this.Draw(),this.OnKLinePageChange("OnTouchMove")):this.DragDownloadData&&this.DragDownloadData(),t.LastMove.X=e[0].clientX,t.LastMove.Y=e[0].clientY}}this.PhoneTouchInfo&&(this.PhoneTouchInfo.End.X=e[0].clientX,this.PhoneTouchInfo.End.Y=e[0].clientY)}else if(this.IsPhonePinching(n)){if(this.DragMode==be.DISABLE_DRAG_ID)return;var f=this.PhonePinch;if(!f)return;var C=Math.abs(e[0].pageX-e[1].pageX),D=Math.abs(f.Last.X-f.Last.X2),v=C-D;if(Math.abs(v)<5)return;if(v>0){var S={};if(S.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomUp(S))return;this.CursorIndex=S.Index,this.UpdatePointByCursorIndex(),this.UpdataDataoffset(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("OnTouchMove")}else{var S={};if(S.Index=parseInt(Math.abs(this.CursorIndex-.5).toFixed(0)),!this.Frame.ZoomDown(S))return;this.CursorIndex=S.Index,this.UpdataDataoffset(),this.UpdatePointByCursorIndex(),this.UpdateFrameMaxMin(),this.Draw(),this.ShowTooltipByKeyDown(),this.OnKLinePageChange("OnTouchMove")}f.Last={X:e[0].pageX,Y:e[0].pageY,X2:e[1].pageX,Y2:e[1].pageY}}}},this.OnTouchEnd=function(n){if(X.Chart.Log("[KLineChartHScreenContainer:OnTouchEnd]",n),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){if(this.CurrentChartDrawPicture){var e=this.CurrentChartDrawPicture;e.Status==2||e.Status==1||e.Status==3?(e.PointStatus=e.Status,this.FinishChartDrawPicturePoint()&&this.DrawDynamicInfo()):e.Status==20&&this.FinishMoveChartDrawPicture()&&this.DrawDynamicInfo()}this.IsOnTouch=!1,this.VerticalDrag=null,this.StopDragTimer(),this.TouchEvent({EventID:et.ON_PHONE_TOUCH,FunctionName:"OnTouchEnd"},n),this.OnTouchFinished(),this.TouchDrawCount=0}},this.Create=function(n){var e=this;this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new gs,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=ze.Create("CorssCursor_XStringFormat"),this.ChartCorssCursor.StringFormatX.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY=ze.Create("CorssCursor_YStringFormat"),this.ChartCorssCursor.StringFormatY.LanguageID=this.LanguageID,this.ChartCorssCursor.StringFormatY.ExtendChartPaint=this.ExtendChartPaint,this.ChartSplashPaint=new Qa,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.HQChart=this,this.Frame=new fC,this.Frame.ChartBorder=new We,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(n),this.CreateMainKLine();for(var t in this.Frame.SubFrame){var a=new za;a.Frame=this.Frame.SubFrame[t].Frame,a.Canvas=this.Canvas,a.LanguageID=this.LanguageID,a.GetEventCallback=function(s){return e.GetEventCallback(s)},a.SelectedChart=this.SelectedChart,this.TitlePaint.push(a)}this.UIElement.addEventListener("keydown",Nh,!0)},this.CreateChildWindow=function(n){for(var e=this,t=0;t<n;++t){var a=new We;a.UIElement=this.UIElement;var s=Oh.Create("KLineHScreenFrame",{ID:t});if(s.Canvas=this.Canvas,s.ChartBorder=a,s.Identify=t,s.RightSpaceCount=this.RightSpaceCount,this.ModifyIndexDialog&&(s.ModifyIndexEvent=this.ModifyIndexDialog.DoModal),this.ChangeIndexDialog&&(s.ChangeIndexEvent=this.ChangeIndexDialog.DoModal),s.HorizontalMax=20,s.HorizontalMin=10,t==0){s.YSplitOperator=new en,s.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price"),s.YSplitOperator.FrameSplitData2=this.FrameSplitData.get("double"),s.YSplitOperator.GetEventCallback=function(u){return e.GetEventCallback(u)};var o=V();a.TopSpace=12*o,a.BottomSpace=12*o}else s.YSplitOperator=new Pa,s.YSplitOperator.LanguageID=this.LanguageID,s.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double");s.YSplitOperator.Frame=s,s.YSplitOperator.ChartBorder=a,s.XSplitOperator=new pr,s.XSplitOperator.Frame=s,s.XSplitOperator.ChartBorder=a,s.XSplitOperator.GetEventCallback=function(u){return e.GetEventCallback(u)},t!=n-1&&(s.XSplitOperator.ShowText=!1);for(var h=s.HorizontalMin;h<=s.HorizontalMax;h+=1)s.HorizontalInfo[h]=new Ht,s.HorizontalInfo[h].Value=h,!(t==0&&h==s.HorizontalMin)&&(s.HorizontalInfo[h].Message[1]=h.toString(),s.HorizontalInfo[h].Font="14px 微软雅黑");var l=new dr;l.Frame=s,t==0?l.Height=20:l.Height=10,this.Frame.SubFrame[t]=l}}}function Ju(r){this.newMethod=re,this.newMethod(r),delete this.newMethod,this.ClassName="MinuteChartHScreenContainer",this.OnMouseMove=function(n,e,t,a){this.LastPoint.X=n,this.LastPoint.Y=e,this.CursorIndex=this.Frame.GetXData(e);var s=this.PtInClient(n,e),o={ParentFunction:"OnMouseMove",Point:{X:n,Y:e},IsPhone:a===!0,ClientPos:s};this.DrawDynamicInfo(o)},this.Create=function(n){var e=this;this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new gs,this.ChartCorssCursor.PtInClient=function(s,o){return e.PtInClient(s,o)},this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.StringFormatX=ze.Create("CorssCursor_Minute_XStringFormat"),this.ChartCorssCursor.StringFormatX.GetEventCallback=function(s){return e.GetEventCallback(s)},this.ChartCorssCursor.StringFormatY=ze.Create("CorssCursor_YStringFormat"),this.ChartCorssCursor.StringFormatY.GetEventCallback=function(s){return e.GetEventCallback(s)},this.ChartCorssCursor.CallAcutionXOperator=new Zo,this.ChartSplashPaint=new Qa,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.HQChart=this,this.Frame=new fC,this.Frame.ChartBorder=new We,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=25,this.Frame.ChartBorder.Left=50,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor.Frame=this.Frame,this.ChartSplashPaint.Frame=this.Frame,this.CreateChildWindow(n),this.CreateMainKLine();for(var t in this.Frame.SubFrame){var a=new za;a.Frame=this.Frame.SubFrame[t].Frame,a.Canvas=this.Canvas,a.LanguageID=this.LanguageID,a.GetEventCallback=function(s){return e.GetEventCallback(s)},a.SelectedChart=this.SelectedChart,this.TitlePaint.push(a)}this.ChartCorssCursor.StringFormatX.Frame=this.Frame.SubFrame[0].Frame,this.ChartCorssCursor.StringFormatY.Frame=this.Frame,this.ChartCorssCursor.CallAcutionXOperator.Frame=this.Frame.SubFrame[0].Frame,this.UIElement.addEventListener("keydown",Nh,!0)},this.CreateChildWindow=function(n){for(var e=this,t=0;t<n;++t){var a=new We;a.UIElement=this.UIElement;var s=new hC;s.Canvas=this.Canvas,s.ChartBorder=a,s.Identify=t,t<2&&(s.ChartBorder.TitleHeight=0),s.XPointCount=243;var o=[9,8,7,6,5,4,3,2,1];s.HorizontalMax=o[0],s.HorizontalMin=o[o.length-1],t==0?(s.YSplitOperator=new GC,s.YSplitOperator.FrameSplitData=this.FrameSplitData.get("price"),s.YSplitOperator.GetEventCallback=function(u){return e.GetEventCallback(u)},s.YSplitOperator.DayOffset=this.DayOffset,s.YSplitOperator.HQChart=this):(s.YSplitOperator=new Pa,s.YSplitOperator.LanguageID=this.LanguageID,s.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),s.YSplitOperator.GetEventCallback=function(u){return e.GetEventCallback(u)}),s.YSplitOperator.Frame=s,s.YSplitOperator.ChartBorder=a,s.XSplitOperator=new zo,s.XSplitOperator.Frame=s,s.XSplitOperator.ChartBorder=a,s.XSplitOperator.DayOffset=this.DayOffset,s.XSplitOperator.GetEventCallback=function(u){return e.GetEventCallback(u)},t!=n-1&&(s.XSplitOperator.ShowText=!1),s.XSplitOperator.Operator();for(var h in o)s.HorizontalInfo[h]=new Ht,s.HorizontalInfo[h].Value=o[h],!(t==0&&h==s.HorizontalMin)&&(s.HorizontalInfo[h].Message[1]=o[h].toString(),s.HorizontalInfo[h].Font="14px 微软雅黑");var l=new dr;l.Frame=s,t==0?l.Height=20:l.Height=10,this.Frame.SubFrame[t]=l}}}function ym(r){this.newMethod=Ar,this.newMethod(r),delete this.newMethod,this.ClassName="DepthChartContainer",this.Symbol,this.MapAsk=new Dt.default,this.MapBid=new Dt.default,this.IsAutoUpdate=!1,this.AutoUpdateFrequency=3e4,this.AutoUpdateTimer,this.DefaultZoom=.8,this.MaxVolRate=1.1,this.Create=function(n){var e=this;this.UIElement.JSChartContainer=this,this.ChartCorssCursor=new Rd,this.ChartCorssCursor.Canvas=this.Canvas,this.ChartCorssCursor.HQChart=this,this.ChartSplashPaint=new Qa,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.Frame=new WT,this.Frame.ChartBorder=new We,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.ChartBorder.TitleHeight=0,this.Frame.Canvas=this.Canvas,this.Frame.Identify=0;var t=new Pa;t.FrameSplitData=this.FrameSplitData.get("double"),t.LanguageID=this.LanguageID,t.Frame=this.Frame,t.SplitCount=5,t.LineType=3,t.IgnoreYValue=[0],t.ChartBorder=this.Frame.ChartBorder,t.GetEventCallback=function(h){return e.GetEventCallback(h)},this.Frame.YSplitOperator=t;var a=new Od;a.Frame=this.Frame,a.ChartBorder=this.Frame.ChartBorder,a.LanguageID=this.LanguageID,a.LineType=3,a.GetEventCallback=function(h){return e.GetEventCallback(h)},this.Frame.XSplitOperator=a,this.ChartCorssCursor&&(this.ChartCorssCursor.Frame=this.Frame),this.ChartSplashPaint.Frame=this.Frame;var s=new Dd;s.Canvas=this.Canvas,s.ChartBorder=this.Frame.ChartBorder,s.ChartFrame=this.Frame,s.Name="深度图",this.ChartPaint.push(s);var o=!0;n&&n.Wheel===!1&&(o=!1,X.Chart.Log("[DepthChartContainer::Create] not register wheel event.")),this.UIElement.addEventListener("keydown",function(h){e.OnKeyDown(h)},!0),o&&this.UIElement.addEventListener("wheel",function(h){e.OnWheel(h)},!0)},this.OnWheel=function(n){X.Chart.Log("[KLineChartContainer::OnWheel]",n);var e=n.clientX-this.UIElement.getBoundingClientRect().left,t=n.clientY-this.UIElement.getBoundingClientRect().top,a=!1;this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),a=this.Canvas.isPointInPath(e,t);var s=n.wheelDelta;c.IsObjectExist(n.wheelDelta)||(s=n.deltaY*-.01);var o=!0;this.EnableZoomUpDown&&this.EnableZoomUpDown.Wheel===!1&&(o=!1),a&&s<0&&o?this.Frame.ZoomDown()&&(this.UpdateFrameMaxMin(),this.Draw()):a&&s>0&&o&&this.Frame.ZoomUp()&&(this.UpdateFrameMaxMin(),this.Draw()),n.preventDefault?n.preventDefault():n.returnValue=!1},this.UIOnMouseDown=function(n){},this.OnTouchStart=function(n){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){this.IsOnTouch=!0,this.TouchDrawCount=0,this.PhonePinch=null;var e=this.IsSingleTouch(n);if((this.EnableScrollUpDown==!1||!e)&&n.cancelable&&n.preventDefault(),this.IsPhoneDragging(n)){var t={Click:{},LastMove:{}},a=this.GetToucheData(n,this.IsForceLandscape);t.Click.X=a[0].clientX,t.Click.Y=a[0].clientY,t.LastMove.X=a[0].clientX,t.LastMove.Y=a[0].clientY,this.MouseDrag=t,this.MoveCorssCursor(t.Click,n)}else if(this.IsPhonePinching(n)){var s={Start:{},Last:{}},a=this.GetToucheData(n,this.IsForceLandscape);s.Start={X:a[0].pageX,Y:a[0].pageY,X2:a[1].pageX,Y2:a[1].pageY},s.Last={X:a[0].pageX,Y:a[0].pageY,X2:a[1].pageX,Y2:a[1].pageY},this.PhonePinch=s}}},this.OnTouchMove=function(n){var e=this.GetToucheData(n,!1);if(this.IsPhoneDragging(n)){var t=this.MouseDrag;if(t==null){var a=V(),s=e[0].clientX-r.getBoundingClientRect().left*a,o=e[0].clientY-r.getBoundingClientRect().top*a;this.OnMouseMove(s,o,n)}else{var h=this.GetMoveAngle(t.LastMove,{X:e[0].clientX,Y:e[0].clientY}),l=Math.abs(t.LastMove.X-e[0].clientX),u=Math.abs(t.LastMove.Y-e[0].clientY);if(l=parseInt(l),(u>0&&l<=3||h<=this.TouchMoveMinAngle)&&this.EnableScrollUpDown==!0)return;this.PreventTouchEvent(n),this.MouseDrag=null;var a=V(),s=e[0].clientX-r.getBoundingClientRect().left*a,o=e[0].clientY-r.getBoundingClientRect().top*a;this.OnMouseMove(s,o,n)}}else if(this.IsPhonePinching(n)){this.PreventTouchEvent(n);var f=this.PhonePinch;if(!f||this.EnableZoomUpDown&&this.EnableZoomUpDown.Touch===!1)return;var C=Math.abs(e[0].pageY-e[1].pageY),D=Math.abs(f.Last.Y-f.Last.Y2),v=C-D,S=Math.abs(e[0].pageX-e[1].pageX),T=Math.abs(f.Last.X-f.Last.X2),I=S-T,F=this.ZoomStepPixel;if(Math.abs(v)<F&&Math.abs(I)<F)return;var E=v;if(Math.abs(v)<F&&(E=I),E>0){if(!this.Frame.ZoomUp())return;this.UpdateFrameMaxMin(),this.Draw()}else{if(!this.Frame.ZoomDown())return;this.UpdateFrameMaxMin(),this.Draw()}f.Last={X:e[0].pageX,Y:e[0].pageY,X2:e[1].pageX,Y2:e[1].pageY}}this.PreventTouchEvent(n)},this.OnTouchEnd=function(n){X.Chart.Log("[DepthChartContainer::OnTouchEnd]",n),this.IsOnTouch=!1,this.OnTouchFinished(),this.TouchDrawCount=0},this.OnTouchFinished=function(){if(this.CorssCursorTouchEnd===!0){this.DrawDynamicInfo();return}},this.ChangeSymbol=function(n){this.CancelAutoUpdate(),this.Symbol=n,this.MapBid=new Dt.default,this.MapAsk=new Dt.default,this.Frame.VerticalRange.Differ=null,this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.Draw(),this.RequestDepthData()},this.RequestDepthData=function(){var n=this;if(this.NetworkFilter){var e={Name:"DepthChartContainer::RequestDepthData",Explain:"深度图数据",Request:{Data:{symbol:n.Symbol}},Self:this,PreventDefault:!1};if(this.NetworkFilter(e,function(t){n.ChartSplashPaint.EnableSplash(!1),n.RecvDepthData(t),n.AutoUpdate()}),e.PreventDefault==!0)return}},this.RecvDepthData=function(n){this.UpdateAskAndBid(n);var e=(0,Xn.default)(this.MapAsk.values());e.sort(function(u,f){return u.Price-f.Price});var o=0;for(var t in e){var a=e[t];o+=a.Vol,e[t]={Price:a.Price,Vol:o}}var s=(0,Xn.default)(this.MapBid.values());s.sort(function(u,f){return f.Price-u.Price});var o=0;for(var t in s){var a=s[t];o+=a.Vol,s[t]={Price:a.Price,Vol:o}}var h={Asks:e,Bids:s},l=this.ChartPaint[0];l.Data=h,this.Frame.XSplitOperator.Symbol=this.Symbol,this.ChartCorssCursor.Data=h,this.ChartCorssCursor.Symbol=this.Symbol,this.UpdateFramePriceList(),this.UpdateFrameMaxMin(),this.Draw()},this.UpdateAskAndBid=function(n){n.datatype=="snapshot"&&(this.MapBid=new Dt.default,this.MapAsk=new Dt.default);for(var e in n.asks){var t=n.asks[e],a=parseFloat(t[0]),s=parseFloat(t[1]);if(this.MapAsk.has(a)){var o=this.MapAsk.get(a);s<=0?this.MapAsk.delete(a):o.Vol=s}else s>0&&this.MapAsk.set(a,{Price:a,Vol:s})}for(var e in n.bids){var t=n.bids[e],a=parseFloat(t[0]),s=parseFloat(t[1]);if(this.MapBid.has(a)){var o=this.MapBid.get(a);s<=0?this.MapBid.delete(a):o.Vol=s}else s>0&&this.MapBid.set(a,{Price:a,Vol:s})}},this.UpdateFramePriceList=function(){var n=(0,Xn.default)(this.MapAsk.keys()),e=(0,Xn.default)(this.MapBid.keys());n.sort(function(S,T){return S-T}),e.sort(function(S,T){return S-T});var t={Max:88,Min:8};if(n.length>1&&e.length>1){var a=n[0],s=n[n.length-1],o=e[0],h=e[e.length-1],l=s-a,u=h-o,f=Math.max(l,u),C={Min:a,Max:a+f},D={Max:h,Min:h-f};t={Max:C.Max,Min:D.Min}}this.Frame.SetPriceList(n,e);var v=this.Frame.VerticalRange;v.Max=t.Max,v.Center=t.Min+(t.Max-t.Min)/2,v.Min=t.Min,v.MaxDiffer=f,v.Ask=C,v.Bid=D,c.IsNumber(v.Differ)||(v.Differ=f*this.DefaultZoom),v.Min=v.Center-v.Differ,v.Max=v.Center+v.Differ},this.UpdateFrameMaxMin=function(){var n=this.ChartPaint[0].GetMaxMin();this.Frame.HorizontalMax=n.Max*this.MaxVolRate,this.Frame.HorizontalMin=0,this.Frame.XYSplit=!0},this.CancelAutoUpdate=function(){typeof this.AutoUpdateTimer=="number"&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=void 0)},this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.AutoUpdate=function(){if(this.CancelAutoUpdate(),!!this.IsAutoUpdate&&this.Symbol){var n=this,e=W.GetMarketStatus(this.Symbol);if(!(e==0||e==3)){var t=this.AutoUpdateFrequency;e==1?this.AutoUpdateTimer=setTimeout(function(){n.AutoUpdate()},t):e==2&&(this.AutoUpdateTimer=setTimeout(function(){n.RequestDepthData()},t))}}}}function Pm(r){this.newMethod=Ar,this.newMethod(r),delete this.newMethod,this.MainDataControl,this.Create=function(){this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new Qa,this.ChartSplashPaint.Canvas=this.Canvas,this.Frame=new _T,this.Frame.ChartBorder=new We,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartCorssCursor&&(this.ChartCorssCursor.Frame=this.Frame),this.ChartSplashPaint.Frame=this.Frame,this.CreateMainChart(),this.UIElement.addEventListener("keydown",Nh,!0)},this.SetMainDataConotrl=function(n){n&&(this.MainDataControl=n,this.ChartPaint=[],this.CreateMainChart(),this.Draw(),this.RequestData())},this.CreateMainChart=function(){if(this.MainDataControl){for(var n in this.MainDataControl.DataType){var e=this.MainDataControl.DataType[n];if(e.Type=="BAR"){var t=new nd;t.Canvas=this.Canvas,t.ChartBorder=this.Frame.ChartBorder,t.ChartFrame=this.Frame,t.Name=e.Name,e.Color&&(t.UpBarColor=e.Color),e.Color2&&(t.DownBarColor=e.Color2),this.ChartPaint.push(t)}else if(e.Type=="LINE"){var t=new Ye;t.Canvas=this.Canvas,t.ChartBorder=this.Frame.ChartBorder,t.ChartFrame=this.Frame,t.Name=e.Name,e.Color&&(t.Color=e.Color),this.ChartPaint.push(t)}}this.Frame.YSplitOperator=new Pa,this.Frame.YSplitOperator.FrameSplitData=this.FrameSplitData.get("double"),this.Frame.YSplitOperator.Frame=this.Frame,this.Frame.YSplitOperator.ChartBorder=this.Frame.ChartBorder,this.Frame.XSplitOperator=new Nd,this.Frame.XSplitOperator.Frame=this.Frame,this.Frame.XSplitOperator.ChartBorder=this.Frame.ChartBorder}},this.RequestData=function(){this.MainDataControl&&(this.MainDataControl.JSChartContainer=this,this.MainDataControl.RequestData())},this.UpdateMainData=function(n){var e=0;for(var t in n.Data){var a=new k;a.Data=n.Data[t],this.ChartPaint[t].Data=a,e<a.Data.length&&(e=a.Data.length)}this.Frame.XPointCount=e,this.Frame.Data=this.ChartPaint[0].Data,this.Frame.XData=n.XData,this.UpdateFrameMaxMin(),this.Frame.SetSizeChage(!0),this.Draw()}}function wm(r){this.Radius,this.newMethod=Ar,this.newMethod(r),delete this.newMethod,this.MainDataControl,this.OnMouseMove=function(n,e,t){},this.Create=function(){this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new Qa,this.ChartSplashPaint.Canvas=this.Canvas,this.Frame=new oC,this.Frame.ChartBorder=new We,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartSplashPaint.Frame=this.Frame,this.CreateMainChart()},this.SetMainDataConotrl=function(n){n&&(this.MainDataControl=n,this.ChartPaint=[],this.CreateMainChart(),this.Draw(),this.RequestData())},this.CreateMainChart=function(){if(this.MainDataControl)for(var n in this.MainDataControl.DataType){var e=this.MainDataControl.DataType[n];if(e.Type=="PIE"){var t=new vd;t.Canvas=this.Canvas,t.ChartBorder=this.Frame.ChartBorder,t.ChartFrame=this.Frame,t.Name=e.Name,this.Radius&&(t.Radius=this.Radius),this.ChartPaint.push(t)}else if(e.Type=="RADAR"){var t=new cd;t.Canvas=this.Canvas,t.ChartBorder=this.Frame.ChartBorder,t.ChartFrame=this.Frame,t.Name=e.Name,e.StartAngle&&(t.StartAngle=e.StartAngle),this.ChartPaint.push(t)}}},this.RequestData=function(){this.MainDataControl&&(this.MainDataControl.JSChartContainer=this,this.MainDataControl.RequestData())},this.UpdateMainData=function(n){for(var e in n.Data){var t=new k;t.Data=n.Data[e],this.ChartPaint[e].Data=t}this.Frame.SetSizeChage(!0),this.Draw()}}function Bm(r){this.newMethod=Ar,this.newMethod(r),delete this.newMethod,this.MainDataControl,this.OnMouseMove=function(n,e,t){},this.Create=function(){this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new Qa,this.ChartSplashPaint.Canvas=this.Canvas,this.Frame=new oC,this.Frame.ChartBorder=new We,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartSplashPaint.Frame=this.Frame,this.CreateMainChart()},this.SetMainDataConotrl=function(n){n&&(this.MainDataControl=n,this.ChartPaint=[],this.CreateMainChart(),this.Draw(),this.RequestData())},this.CreateMainChart=function(){if(this.MainDataControl){var n=new Sd;n.Canvas=this.Canvas,n.ChartBorder=this.Frame.ChartBorder,n.ChartFrame=this.Frame,n.Name=this.MainDataControl.DataType[0].Name,this.Radius&&(n.Radius=this.Radius),this.ChartPaint.push(n)}},this.RequestData=function(){this.MainDataControl&&(this.MainDataControl.JSChartContainer=this,this.MainDataControl.RequestData())},this.UpdateMainData=function(n){this.ChartPaint[0].Data=n.Data[0],this.Frame.SetSizeChage(!0),this.Draw()}}function ia(r,n){this.Name=r,this.Param=n,this.LineColor,this.ReqeustData=null}function $a(r){this.Index,this.Name=r,this.Script=null,this.ClassName="BaseIndex",this.OverlayIndex=null,this.GetEventCallback,this.Status=0,this.Guid=oe(),this.Create=function(n,e){},this.NotSupport=function(n,e,t){var a=this.IsOverlay();if(!a){n.DeleteIndexPaint(e);var s=n.Frame.SubFrame[e].Frame,o=new QT;o.Canvas=n.Canvas,o.ChartBorder=s.ChartBorder,o.ChartFrame=s,o.NotSupportMessage=t,n.ChartPaint.push(o)}},this.FormatIndexTitle=function(){var n=this.Name,e=null;for(var t in this.Index){var a=this.Index[t];a.Param!=null&&(e?e+=","+a.Param.toString():e=a.Param.toString())}return e&&(n+="("+e+")"),n},this.IsOverlay=function(){return!(!this.OverlayIndex||this.OverlayIndex.IsOverlay!=!0)},this.CreateChart=function(n){return new Ye},this.CreatePaints=function(n,e){var t=null,a=this.IsOverlay();a?(t=this.OverlayIndex.Frame.Frame,this.OverlayIndex.Frame.ChartPaint=[]):(t=n.Frame.SubFrame[e].Frame,n.DeleteIndexPaint(e));var s=[];for(var o in this.Index){var h=this.CreateChart(o);h.Color=this.Index[o].LineColor,h.Canvas=n.Canvas,h.Name=this.Name+"-"+o.toString(),h.ChartBorder=t.ChartBorder,h.ChartFrame=t,a?this.OverlayIndex.Frame.ChartPaint.push(h):n.ChartPaint.push(h),s.push(h)}return s},this.SendEvent=function(n,e,t,a){if(n.GetIndexEvent){var s=n.GetIndexEvent();if(s){var o={Data:this.GetOutData(),WindowIndex:e,Name:this.Name,HistoryData:t,Stock:{Symbol:n.Symbol,Name:n.Name}};a&&(o.Error=a),s.Callback(s,o,self)}}},this.GetOutData=function(){return null}}function bm(){this.newMethod=$a,this.newMethod("OX"),delete this.newMethod,this.ClassName="JSIndex_OX",this.IsUsePageData=!0,this.BlockSize=.5,this.Arguments=[{Name:"Reversal",Value:3}],this.SetArgs=function(r){if(!(!r||!c.IsNonEmptyArray(r)))for(var n=0;n<r.length;++n){var e=r[n];e.Name=="Reversal"&&this.SetParamValue(e.Name,e.Value)}},this.SetParamValue=function(r,n){for(var e=0;e<this.Arguments.length;++e){var t=this.Arguments[e];t.Name==r&&(t.Value=n)}},this.GetParamValue=function(r){for(var n=0;n<this.Arguments.length;++n){var e=this.Arguments[n];if(e.Name==r)return e.Value}},this.RequestData=function(r,n,e){return this.BindData(r,n,e),r.UpdataDataoffset(),r.UpdateFrameMaxMin(),r.Draw(),!0},this.CreatePaints=function(r,n){var e=null,t=this.IsOverlay();t?(e=this.OverlayIndex.Frame.Frame,this.OverlayIndex.Frame.ChartPaint=[]):(e=r.Frame.SubFrame[n].Frame,r.DeleteIndexPaint(n));var a=[],s=new ud;return s.Canvas=r.Canvas,s.Name=this.Name+"-0",s.ChartBorder=e.ChartBorder,s.ChartFrame=e,t?this.OverlayIndex.Frame.ChartPaint.push(s):r.ChartPaint.push(s),a.push(s),a},this.CalculateBlockSize=function(r,n){var e=r-n;return e<=5?.25:e<=20?.5:e<=100?1:e<=200?2:e<=500?5:e<=1e3?10:50},this.Calculate=function(r,n){if(!r.ChartPaint[0])return null;var e=r.ChartPaint[0].ShowRange;if(!e||!c.IsNonEmptyArray(n.Data))return null;for(var t=null,a=null,s=null,o=e.Start;o<=e.End&&o<n.Data.length;++o){var h=n.Data[o];t==null?c.IsNumber(h.High)&&(t=h.High):c.IsNumber(h.High)&&t<h.High&&(t=h.High),a==null?c.IsNumber(h.Low)&&(a=h.Low):c.IsNumber(h.Low)&&a>h.Low&&(a=h.Low),s==null&&c.IsNumber(h.High)&&(s=h.High)}var l=this.GetParamValue("Reversal"),u=this.CalculateBlockSize(t,a);this.BlockSize=u;for(var f={Max:t+u,Min:a-u,StartPrice:s,Data:[],BlockSize:u},C=1,D=s,v={Type:0,Data:[],Start:null,End:null},o=e.Start,S=0;o<=e.End&&o<n.Data.length;++o){var h=n.Data[o];if(C==1){if(h.High>=D+u){var T=parseInt((h.High-D)/u);for(S=0;S<T;++S)D+=u,v.Data.push(D)}else if(h.Low<=D-u*l){C=0,v&&c.IsNonEmptyArray(v.Data)&&f.Data.push(v),v={Type:1,Data:[],Start:null,End:null};var T=parseInt((D-h.Low)/u);for(S=0;S<T;++S)D-=u,v.Data.push(D)}}else if(h.Low<=D-u){var T=parseInt((D-h.Low)/u);for(S=0;S<T;++S)D-=u,v.Data.push(D)}else if(h.High>=D+u*l){C=1,v&&c.IsNonEmptyArray(v.Data)&&f.Data.push(v),v={Type:0,Data:[],Start:null,End:null};var T=parseInt((h.High-D)/u);for(S=0;S<T;++S)D+=u,v.Data.push(D)}v.Start==null&&(v.Start=h),v.End=h}return v&&c.IsNonEmptyArray(v.Data)&&f.Data.push(v),f},this.BindData=function(r,n,e){var t=this.CreatePaints(r,n),a=this.IsOverlay(),s=r.GetEventCallback(et.ON_CALCULATE_INDEX_OX);if(s&&s.Callback){var o={HQChart:r,WidnowIndex:n,HisData:e,OXData:null};s.Callback(s,o,this),t[0].OXData=o.OXData}else t[0].OXData=this.Calculate(r,e);var h=this.BlockSize,l=this.GetParamValue("Reversal"),u=this.Name+" BlockSize="+h+" Reversal="+l,f=n+1;if(a){var C=r.TitlePaint[f],D={Data:[],Title:""};C.OverlayIndex.set(this.OverlayIndex.Identify,D)}else r.TitlePaint[f].Title=u;return!0}}function Gm(r){this.newMethod=$a,this.newMethod("VRVR"),delete this.newMethod,this.ClassName="VolProfileVisibleRangeIndex",this.IsUsePageData=!0,this.ChartVolProfile,this.HQChart,this.WindowIndex,this.RequestTimer=null,this.DelayRequestFrequency=500,this.VolType=0,this.BarPosition=1,this.BarWidthRate=.3,this.Arguments=[{Name:"VAVol",Value:70},{Name:"BarPosition",Value:0}],this.SetArgs=function(n){if(!(!n||!c.IsNonEmptyArray(n)))for(var e=0;e<n.length;++e){var t=n[e];t.Name=="VAVol"?this.SetParamValue(t.Name,t.Value):t.Name=="BarPosition"&&this.SetParamValue(t.Name,t.Value)}},this.SetParamValue=function(n,e){for(var t=0;t<this.Arguments.length;++t){var a=this.Arguments[t];a.Name==n&&(a.Value=e)}},r&&(c.IsNumber(r.VolType)&&(this.VolType=r.VolType),c.IsNumber(r.BarWidthRate)&&(this.BarWidthRate=r.BarWidthRate),c.IsNumber(r.DelayRequestFrequency)&&(this.DelayRequestFrequency=r.DelayRequestFrequency),r.Args&&this.SetArgs(r.Args),c.IsNumber(r.BarPosition)&&(this.BarPosition=r.BarPosition,this.SetParamValue("BarPosition",this.BarPosition))),this.GetParamValue=function(n){for(var e=0;e<this.Arguments.length;++e){var t=this.Arguments[e];if(t.Name==n)return t.Value}},this.Create=function(n,e){this.HQChart=n,this.WindowIndex=e},this.CreateChart=function(n,e){var t=null,a=this.IsOverlay();a?(t=this.OverlayIndex.Frame.Frame,this.OverlayIndex.Frame.ChartPaint=[]):(t=n.Frame.SubFrame[e].Frame,n.DeleteIndexPaint(e));var s=[],o=new fd;return o.Canvas=n.Canvas,o.Name=this.Name+"-0",o.ChartBorder=t.ChartBorder,o.ChartFrame=t,o.HQChart=this.HQChart,o.Identify=this.Guid,o.SetOption(this),a?this.OverlayIndex.Frame.ChartPaint.push(o):n.ChartPaint.push(o),s.push(o),this.ChartVolProfile=o,s},this.CancelRequestTimer=function(){this.RequestTimer&&(clearTimeout(this.RequestTimer),this.RequestTimer=null)},this.RequestData=function(n,e,t,a){var s=this;this.CancelRequestTimer();var o=function(){var l=n.ChartPaint[0],u=l.Data;if(!(!u||c.IsNonEmptyArray(!u.Data))){var f=l.DrawKRange;if(!(!f||!c.IsNumber(f.Start)||!c.IsNumber(f.End))){var C=u.Data[f.Start],D=u.Data[f.End],v={Start:{Date:C.Date,DataIndex:f.Start},End:{Date:D.Date,DataIndex:f.End},Chart:s};c.IsNumber(C.Time)&&(v.Start.Time=C.Time),c.IsNumber(D.Time)&&(v.End.Time=D.Time),v.ValueAreaVol=s.Arguments[0].Value,s.Arguments[1].Value>0?s.BarPosition=1:s.BarPosition=0,s.ChartVolProfile&&s.ChartVolProfile.SetOption({BarPosition:s.BarPosition}),s.DataStatus=0,n&&n.RequestVolumeProfileData&&n.RequestVolumeProfileData(v)}}};return a&&a.Type==1?this.RequestTimer=setTimeout(function(){o()},this.DelayRequestFrequency):o(),!0},this.OnRecvVolumeProfileData=function(n){return this.BindData(n),this.HQChart.UpdataDataoffset(),this.HQChart.UpdateFrameMaxMin(),this.HQChart.Draw(),!0},this.BindData=function(n){(!this.ChartVolProfile||this.ChartVolProfile.IsDestroy==!0)&&this.CreateChart(this.HQChart,this.WindowIndex);var e=this.ChartVolProfile;if(e.Data=null,!(!n||!c.IsNonEmptyArray(n.Data))&&!(!c.IsNumber(n.MaxPrice)||!c.IsNumber(n.MinPrice))){for(var t=0,a=0,s=null,o=0,h=0;o<n.Data.length;++o){var l=n.Data[o];for(a=0,h=0;h<l.Vol.length;++h){var u=l.Vol[h];c.IsNumber(u.Value)&&(a+=u.Value)}t<a&&(t=a,s=l.Price)}if(!(this.maxVolPrice<=0||this.maxVol<=0)){e.MaxVolPrice=s,e.MaxVol=t,e.MaxPrice=n.MaxPrice,e.MinPrice=n.MinPrice,e.Data=n;var f=this.WindowIndex+1;this.HQChart.TitlePaint[f].Title="VPVR",this.HQChart.TitlePaint[f].Identify=this.Guid;var C=new kt(e.Data,"VPVR",e.Data);C.ChartClassName="ChartVolProfileVisibleRange",C.Chart=e,this.HQChart.TitlePaint[f].Data[0]=C}}}}function Vm(){this.newMethod=$a,this.newMethod("CJL"),delete this.newMethod,this.Index=new Array(new ia("VOL",null),new ia("OPID",null)),this.Index[0].LineColor=m.Index.LineColor[0],this.Index[1].LineColor=m.Index.LineColor[1],this.CreateChart=function(r){if(r==0){var n=new Gh;return n}else if(r==1){var n=new CC;return n.LineWidth=1*V(),n}},this.RequestData=function(r,n,e){return this.BindData(r,n,e),r.UpdataDataoffset(),r.UpdateFrameMaxMin(),r.Draw(),!0},this.BindData=function(r,n,e){var t=this.CreatePaints(r,n),a=this.IsOverlay();if(t.length!=this.Index.length)return!1;var s=e.GetVol(),o=e.GetPosition();t[0].HistoryData=e,t[0].Data.Data=s,t[1].Data.Data=o;var h=n+1;if(a){var l=r.TitlePaint[h],u={Data:[],Title:""};l.OverlayIndex.set(this.OverlayIndex.Identify,u);for(var f in t){var C=new kt(t[f].Data,this.Index[f].Name,this.Index[f].LineColor);l.OverlayIndex.get(this.OverlayIndex.Identify).Data[f]=C}}else r.TitlePaint[h].Data[0]=new kt(t[0].Data,this.Index[0].Name,this.Index[0].LineColor),r.TitlePaint[h].Data[1]=new kt(t[1].Data,this.Index[1].Name,this.Index[1].LineColor),r.TitlePaint[h].Title=this.Name;return!0}}function Hm(){this.newMethod=$a,this.newMethod("Long-Short"),delete this.newMethod,this.Index=new Array(new ia("多头区域",null),new ia("空头区域",null),new ia("市场多空指标",null)),this.Index[0].LineColor=m.UpBarColor,this.Index[1].LineColor=m.DownBarColor,this.Index[2].LineColor=m.Index.LineColor[0],this.LongShortData,this.CreateChart=function(r){if(r==2){var n=new Ye;return n.LineWidth=2,n}return new ad},this.GetOutData=function(){return{LongShortData:this.LongShortData}},this.RequestData=function(r,n,e){var t=this,a={HQChart:r,WindowIndex:n,HistoryData:e};return this.LongShortData=[],a.HQChart.Period>0?(this.NotSupport(a.HQChart,a.WindowIndex,"不支持周期切换"),a.HQChart.Draw(),this.SendEvent(r,n,e,"不支持周期切换"),!1):(Lt.HttpRequest({url:m.Index.MarketLongShortApiUrl,data:{},type:"post",dataType:"json",async:!0,success:function(o){t.RecvData(o,a),t.SendEvent(r,n,e)}}),!0)},this.RecvData=function(r,n){if(!(r.data.length<=0)){var e=new Array;for(var t in r.data){var a=r.data[t],s=new yt;s.Date=a[0],s.Value=a[1],e.push(s)}var o=n.HistoryData.GetFittingData(e),h=new k;h.Data=o,h.Period=n.HQChart.Period,h.Right=n.HQChart.Right,this.LongShortData=h.GetValue(),this.BindData(n.HQChart,n.WindowIndex,n.HistoryData),n.HQChart.UpdataDataoffset(),n.HQChart.UpdateFrameMaxMin(),n.HQChart.Draw()}},this.BindData=function(r,n,e){var t=this.CreatePaints(r,n),a=this.IsOverlay();if(t.length!=this.Index.length)return!1;t[2].Data.Data=this.LongShortData,t[0].Data.Data[0]=8,t[1].Data.Data[0]=1;var s=n+1;if(a){this.OverlayIndex.Frame.Frame.YSpecificMaxMin={Max:9,Min:0,Count:3};var o=r.TitlePaint[s],h={Data:[],Title:""};o.OverlayIndex.set(this.OverlayIndex.Identify,h);for(var l in t){var u=new kt(t[l].Data,this.Index[l].Name,this.Index[l].LineColor);l!=2&&(u.DataType="StraightLine"),o.OverlayIndex.get(this.OverlayIndex.Identify).Data[l]=u}}else{r.Frame.SubFrame[n].Frame.YSpecificMaxMin={Max:9,Min:0,Count:3};for(var l in t)r.TitlePaint[s].Data[l]=new kt(t[l].Data,this.Index[l].Name,this.Index[l].LineColor),l!=2&&(r.TitlePaint[s].Data[l].DataType="StraightLine")}return!0}}function Ym(){this.newMethod=$a,this.newMethod("Market-Timing"),delete this.newMethod,this.Index=new Array(new ia("因子择时",null)),this.TimingData,this.TitleColor=m.FrameSplitTextColor,this.CreateChart=function(r){return new Or},this.GetOutData=function(){return{TimingData:this.TimingData}},this.RequestData=function(r,n,e){var t=this,a={HQChart:r,WindowIndex:n,HistoryData:e};return this.LongShortData=[],a.HQChart.Period>0?(this.NotSupport(a.HQChart,a.WindowIndex,"不支持周期切换"),a.HQChart.Draw(),this.SendEvent(r,n,e,"不支持周期切换"),!1):(Lt.HttpRequest({url:m.Index.MarketLongShortApiUrl,data:{},type:"post",dataType:"json",async:!0,success:function(o){t.RecvData(o,a),t.SendEvent(r,n,e)}}),!0)},this.RecvData=function(r,n){if(!(r.data.length<=0)){var e=new Array;for(var t in r.data){var a=r.data[t],s=new yt;s.Date=a[0],s.Value=a[2],e.push(s)}var o=n.HistoryData.GetFittingData(e),h=new k;h.Data=o,h.Period=n.HQChart.Period,h.Right=n.HQChart.Right,this.TimingData=h.GetValue(),this.BindData(n.HQChart,n.WindowIndex,n.HistoryData),n.HQChart.UpdataDataoffset(),n.HQChart.UpdateFrameMaxMin(),n.HQChart.Draw()}},this.BindData=function(r,n,e){var t=this.CreatePaints(r,n),a=this.IsOverlay();if(t.length!=this.Index.length)return!1;t[0].Data.Data=this.TimingData,t[0].NotSupportMessage=null;var s=n+1;if(a){var o=r.TitlePaint[s],h={Data:[],Title:""};o.OverlayIndex.set(this.OverlayIndex.Identify,h);for(var l in t){var u=new kt(t[l].Data,this.Index[l].Name,this.Index[l].LineColor);u.StringFormat=wa.THOUSANDS,u.FloatPrecision=0,o.OverlayIndex.get(this.OverlayIndex.Identify).Data[l]=u}}else for(var l in t)r.TitlePaint[s].Data[l]=new kt(t[l].Data,this.Index[l].Name,this.TitleColor),r.TitlePaint[s].Data[l].StringFormat=wa.THOUSANDS,r.TitlePaint[s].Data[l].FloatPrecision=0;return!0}}function km(){this.newMethod=$a,this.newMethod("Market-Attention"),delete this.newMethod,this.Index=new Array(new ia("市场关注度",null)),this.Data,this.TitleColor=m.FrameSplitTextColor,this.ApiUrl=m.Index.MarketAttentionApiUrl,this.CreateChart=function(r){return new Or},this.GetOutData=function(){return{Data:this.Data}},this.SetFrame=function(r,n,e){var t=this.IsOverlay();t?this.OverlayIndex.Frame.Frame.YSpecificMaxMin={Max:6,Min:0,Count:3}:r.Frame.SubFrame[n].Frame.YSpecificMaxMin={Max:6,Min:0,Count:3}},this.RequestData=function(r,n,e){var t=this,a={HQChart:r,WindowIndex:n,HistoryData:e};return this.Data=[],a.HQChart.Period>0?(this.NotSupport(a.HQChart,a.WindowIndex,"不支持周期切换"),a.HQChart.Draw(),this.SendEvent(r,n,e,"不支持周期切换"),!1):(Lt.HttpRequest({url:this.ApiUrl,data:{symbol:a.HQChart.Symbol,startdate:20100101},type:"post",dataType:"json",async:!0,success:function(o){t.RecvData(o,a),t.SendEvent(r,n,e)}}),!0)},this.RecvData=function(r,n){if(!(r.date.length<0)){var e=new Array;for(var t in r.date){var a=new yt;a.Date=r.date[t],a.Value=r.value[t],e.push(a)}var s=n.HistoryData.GetFittingData(e),o=new k;o.Data=s,o.Period=n.HQChart.Period,o.Right=n.HQChart.Right,this.Data=o.GetValue(),this.BindData(n.HQChart,n.WindowIndex,n.HistoryData),this.SetFrame(n.HQChart,n.WindowIndex,n.HistoryData),n.HQChart.UpdataDataoffset(),n.HQChart.UpdateFrameMaxMin(),n.HQChart.Draw()}},this.BindData=function(r,n,e){var t=this.CreatePaints(r,n),a=this.IsOverlay();if(t.length!=this.Index.length)return!1;t[0].Data.Data=this.Data,t[0].NotSupportMessage=null;var s=n+1;if(a){var o=r.TitlePaint[s],h={Data:[],Title:""};o.OverlayIndex.set(this.OverlayIndex.Identify,h);for(var l in t){var u=new kt(t[l].Data,this.Index[l].Name,this.Index[l].LineColor);u.StringFormat=wa.THOUSANDS,u.FloatPrecision=0,o.OverlayIndex.get(this.OverlayIndex.Identify).Data[l]=u}}else for(var l in t)r.TitlePaint[s].Data[l]=new kt(t[l].Data,this.Index[l].Name,this.TitleColor),r.TitlePaint[s].Data[l].StringFormat=wa.THOUSANDS,r.TitlePaint[s].Data[l].FloatPrecision=0;return!0}}function Xm(){this.newMethod=$a,this.newMethod("Market-Heat"),delete this.newMethod,this.Index=new Array(new ia("热度",5),new ia("MA",10),new ia("MA",null)),this.Data,this.ApiUrl=m.Index.MarketHeatApiUrl,this.Index[0].LineColor=m.FrameSplitTextColor,this.Index[1].LineColor=m.Index.LineColor[0],this.Index[2].LineColor=m.Index.LineColor[1],this.CreateChart=function(r){return r==0?new Or:new Ye},this.RequestData=function(r,n,e){var t=this,a={HQChart:r,WindowIndex:n,HistoryData:e};return this.Data=[],a.HQChart.Period>0?(this.NotSupport(a.HQChart,a.WindowIndex,"不支持周期切换"),a.HQChart.Draw(),!1):(Lt.HttpRequest({url:this.ApiUrl,data:{symbol:a.HQChart.Symbol,startdate:20100101},type:"post",dataType:"json",async:!0,success:function(o){t.RecvData(o,a)}}),!0)},this.RecvData=function(r,n){if(!(r.date.length<0)){var e=new Array;for(var t in r.date){var a=new yt;a.Date=r.date[t],a.Value=r.value[t],e.push(a)}var s=n.HistoryData.GetFittingData(e),o=new k;o.Data=s,o.Period=n.HQChart.Period,o.Right=n.HQChart.Right,this.Data=o.GetValue(),this.BindData(n.HQChart,n.WindowIndex,n.HistoryData),n.HQChart.UpdataDataoffset(),n.HQChart.UpdateFrameMaxMin(),n.HQChart.Draw()}},this.BindData=function(r,n,e){var t=this.CreatePaints(r,n),a=this.IsOverlay();if(t.length!=this.Index.length)return!1;t[0].Data.Data=this.Data,t[0].NotSupportMessage=null;var s=Zt.MA(this.Data,this.Index[0].Param);t[1].Data.Data=s;var o=Zt.MA(this.Data,this.Index[1].Param);t[2].Data.Data=o;var h=n+1;if(a){var l=r.TitlePaint[h],u={Data:[],Title:""};l.OverlayIndex.set(this.OverlayIndex.Identify,u);for(var f in t){var C="";f==0?C=r.Name+this.Index[f].Name:C="MA"+this.Index[f-1].Param;var D=new kt(t[f].Data,C,this.Index[f].LineColor);D.StringFormat=wa.DEFAULT,D.FloatPrecision=2,l.OverlayIndex.get(this.OverlayIndex.Identify).Data[f]=D}}else for(var f in t){var C="";f==0?C=r.Name+this.Index[f].Name:C="MA"+this.Index[f-1].Param,r.TitlePaint[h].Data[f]=new kt(t[f].Data,C,this.Index[f].LineColor),r.TitlePaint[h].Data[f].StringFormat=wa.DEFAULT,r.TitlePaint[h].Data[f].FloatPrecision=2}return!0}}function Wm(){this.newMethod=$a,this.newMethod("Market-Heat"),delete this.newMethod,this.Index=new Array(new ia("区域",3),new ia("热度指数",10),new ia("MA",5),new ia("MA",10)),this.Data,this.ApiUrl=m.Index.CustomIndexHeatApiUrl,this.Index[1].LineColor=m.Index.LineColor[1],this.Index[2].LineColor=m.Index.LineColor[2],this.Index[3].LineColor=m.Index.LineColor[3],this.Create=function(r,n){for(var e in this.Index){var t=null;e==0?t=new IC:(t=new Ye,t.Color=this.Index[e].LineColor),t.Canvas=r.Canvas,t.Name=this.Name+"-"+e.toString(),t.ChartBorder=r.Frame.SubFrame[n].Frame.ChartBorder,t.ChartFrame=r.Frame.SubFrame[n].Frame,r.ChartPaint.push(t)}},this.RequestData=function(r,n,e){var t=this,a={HQChart:r,WindowIndex:n,HistoryData:e};return this.Data=[],a.HQChart.Period>0?(this.NotSupport(a.HQChart,a.WindowIndex,"不支持周期切换"),a.HQChart.Draw(),!1):(Lt.HttpRequest({url:this.ApiUrl,data:{stock:a.HQChart.CustomStock,date:{startdate:a.HQChart.QueryDate.Start,enddate:a.HQChart.QueryDate.End},day:[this.Index[0].Param,this.Index[1].Param]},type:"post",dataType:"json",async:!0,success:function(o){t.RecvData(o,a)}}),!0)},this.RecvData=function(r,n){if(!(r.data==null||r.data.length<0)){var e=new Array;for(var t in r.data){var a=r.data[t],s=new yt;s.Date=a[0],s.Value=a[1],e.push(s)}var o=n.HistoryData.GetFittingData(e),h=new k;h.Data=o,h.Period=n.HQChart.Period,h.Right=n.HQChart.Right,this.Data=h.GetValue(),this.BindData(n.HQChart,n.WindowIndex,n.HistoryData),n.HQChart.UpdataDataoffset(),n.HQChart.UpdateFrameMaxMin(),n.HQChart.Draw()}},this.BindData=function(r,n,e){var t=r.GetChartPaint(n);if(t.length!=this.Index.length)return!1;t[0].NotSupportMessage=null,t[0].Data.Data=[{Value:0,Value2:.2,Color:"rgb(50,205,50)",Title:"热度1",TitleColor:"rgb(245,255 ,250)"},{Value:.2,Value2:.4,Color:"rgb(255,140,0)",Title:"热度2",TitleColor:"rgb(245,255 ,250)"},{Value:.4,Value2:.8,Color:"rgb(255,106,106)",Title:"热度3",TitleColor:"rgb(245,255 ,250)"},{Value:.8,Value2:1,Color:"rgb(208, 32 ,144)",Title:"热度4",TitleColor:"rgb(245,255 ,250)"}],t[1].Data.Data=this.Data;var a=Zt.MA(this.Data,this.Index[2].Param);t[2].Data.Data=a;var s=Zt.MA(this.Data,this.Index[3].Param);t[3].Data.Data=s,r.Frame.SubFrame[n].Frame.YSpecificMaxMin={Max:1,Min:0,Count:3};for(var o=n+1,h=1;h<t.length;++h){var l=this.Index[h].Name;l=="MA"&&(l="MA"+this.Index[h].Param),r.TitlePaint[o].Data[h]=new kt(t[h].Data,l,this.Index[h].LineColor),r.TitlePaint[o].Data[h].StringFormat=wa.DEFAULT,r.TitlePaint[o].Data[h].FloatPrecision=2}return r.TitlePaint[o].Title="热度("+this.Index[0].Param+","+this.Index[1].Param+","+this.Index[2].Param+","+this.Index[3].Param+")",!0}}function _m(){this.newMethod=$a,this.newMethod("财务粉饰"),delete this.newMethod,this.Index=new Array(new ia("区域",null),new ia("系数",null)),this.Data,this.ApiUrl=m.Index.StockHistoryDayApiUrl,this.Index[0].LineColor=m.Index.LineColor[0],this.Index[1].LineColor="rgb(105,105,105)",this.CreateChart=function(r){return r==0?new IC:new dC},this.GetOutData=function(){return{Data:this.Data}},this.RequestData=function(r,n,e){var t=this,a={HQChart:r,WindowIndex:n,HistoryData:e};if(this.Data=[],a.HQChart.Period!=2)return this.NotSupport(a.HQChart,a.WindowIndex,"只支持月线"),a.HQChart.Draw(),this.SendEvent(r,n,e,"只支持月线"),!1;var s=["finance.benford","announcement2.quarter","announcement1.quarter","announcement3.quarter","announcement4.quarter"],o=[{item:["date","int32","gte","20130101"]},{item:["announcement1.year","int32","gte",0,"announcement2.year","int32","gte",0,"announcement3.year","int32","gte",0,"announcement4.year","int32","gte",0,"or"]}];return Lt.HttpRequest({url:this.ApiUrl,data:{symbol:[a.HQChart.Symbol],field:s,condition:o},type:"post",dataType:"json",async:!0,success:function(l){t.RecvData(l,a),t.SendEvent(r,n,e)}}),!0},this.JsonDataToMapSingleData=function(r){var n=r.stock[0].stockday,e=new Dt.default;for(var t in n){var a=n[t],s=new yt;if(s.Date=a.date,s.Value=new Array,a.finance1!=null&&a.announcement1!=null){var o=a.announcement1.year,h=a.announcement1.quarter,l=a.finance1.benford;s.Value.push({Year:o,Quarter:h,Value:l})}if(a.finance2!=null&&a.announcement2!=null){var u=a.announcement2.year,f=a.announcement2.quarter,C=a.finance2.benford;s.Value.push({Year:u,Quarter:f,Value:C})}if(a.finance3!=null&&a.announcement3!=null){var D=a.announcement3.year,v=a.announcement3.quarter,S=a.finance3.benford;s.Value.push({Year:D,Quarter:v,Value:S})}if(a.finance4!=null&&a.announcement4!=null){var T=a.announcement4.year,I=a.announcement4.quarter,F=a.finance4.benford;s.Value.push({Year:T,Quarter:I,Value:F})}e.set(s.Date,s)}var E=new Array,M=!0,O=!1,R=void 0;try{for(var b=(0,we.default)(e),p;!(M=(p=b.next()).done);M=!0){var a=p.value;E.push(a[1])}}catch(G){O=!0,R=G}finally{try{!M&&b.return&&b.return()}finally{if(O)throw R}}return E},this.RecvData=function(r,n){if(X.Chart.Log(r),!(r.stock==null||r.stock.length<=0)){var e=this.JsonDataToMapSingleData(r),t=n.HistoryData.GetFittingMonthData(e),a=new k;a.Data=t,a.Period=n.HQChart.Period,a.Right=n.HQChart.Right,this.Data=a.GetValue(),this.BindData(n.HQChart,n.WindowIndex,n.HistoryData),n.HQChart.UpdataDataoffset(),n.HQChart.UpdateFrameMaxMin(),n.HQChart.Draw()}},this.BindData=function(r,n,e){var t=this.CreatePaints(r,n);if(t.length!=this.Index.length)return!1;t[0].NotSupportMessage=null,t[0].Data.Data=[{Value:0,Value2:.2,Color:"rgb(50,205,50)",Title:"安全区",TitleColor:"rgb(245,255 ,250)"},{Value:.2,Value2:.4,Color:"rgb(255,140,0)",Title:"预警区",TitleColor:"rgb(245,255 ,250)"},{Value:.4,Value2:1,Color:"rgb(255,106,106)",Title:"警示区",TitleColor:"rgb(245,255 ,250)"}],t[1].Data.Data=this.Data,r.Frame.SubFrame[n].Frame.YSpecificMaxMin={Max:1,Min:0,Count:3};var a=n+1;return r.TitlePaint[a].Data[1]=new kt(t[1].Data,this.Index[1].Name,this.Index[1].LineColor),r.TitlePaint[a].Data[1].DataType="MultiReport",r.TitlePaint[a].Title=this.FormatIndexTitle(),!0}}function Jh(r,n,e,t){this.newMethod=$a,this.newMethod(r),delete this.newMethod,this.Script=n,this.Arguments=[],this.OutVar=[],this.ApiUrl=m.PyIndexDomain+"/hq/code",e&&(this.Arguments=e),this.RequestData=function(a,s,o){this.OutVar=[];var h=this,l={HQChart:a,WindowIndex:s,HistoryData:o},u="";for(var f in this.Arguments){u.length>0&&(u+=",");var C=this.Arguments[f];u+='"'+C.Name+'":'+C.Value}u="{"+u+"}";var D=JSON.parse(u),v=(0,jr.default)({code:this.Script,symbol:l.HQChart.Symbol,period:l.HQChart.Period,right:l.HQChart.Right,params:D,numcount:a.MaxRequestDataCount});return Lt.HttpRequest({url:this.ApiUrl,data:v,type:"post",dataType:"json",contentType:" application/json; charset=utf-8",async:!0,success:function(T){h.RecvData(T,l)},complete:function(T){},error:function(T,I){h.RecvError(T,I,l)}}),!0},this.RecvError=function(a,s,o){X.Chart.Log("[PyScriptIndex::RecvError] error",s),o.HQChart.ScriptErrorCallback&&o.HQChart.ScriptErrorCallback(s)},this.RecvData=function(a,s){if(a.code!=0){X.Chart.Log("[PyScriptIndex::RecvData] failed.",a),s.HQChart.ScriptErrorCallback&&s.HQChart.ScriptErrorCallback(a.msg);return}X.Chart.Log("[PyScriptIndex::RecvData] recv data.",a);var o=a.date;for(var h in a.data){for(var l=a.data[h],u=[],f=0;f<o.length&&f<o.length;++f)if(!(f>=l.data.length)){var C=new yt;C.Date=o[f],C.Value=l.data[f],u.push(C)}var D=s.HistoryData.GetFittingData(u),v=new k;v.Data=D,v.Period=s.HQChart.Period,v.Right=s.HQChart.Right;var S={Name:l.name,Type:l.graph,LineWidth:l.width,Data:v.GetValue(),Color:l.color};this.OutVar.push(S)}this.BindData(s.HQChart,s.WindowIndex,s.HistoryData),s.HQChart.UpdataDataoffset(),s.HQChart.UpdateFrameMaxMin(),s.HQChart.Draw()},this.BindData=function(a,s,o){a.DeleteIndexPaint(s);for(var h in this.OutVar){var l=this.OutVar[h];switch(l.Type){case"line":this.CreateLine(a,s,l,h);break;case"colorstick":this.CreateColorStock(a,s,l,h);break}}var u=s+1;a.TitlePaint[u].Title=this.Name;var f="";for(var C in this.Arguments){var D=this.Arguments[C];f.length>0&&(f+=","),f+=D.Value.toString()}return f.length>0&&(a.TitlePaint[u].Title=this.Name+"("+f+")"),!0},this.CreateLine=function(a,s,o,h){var l=new Ye;l.Canvas=a.Canvas,l.DrawType=1,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Color?l.Color=o.Color:l.Color=this.GetDefaultColor(h),o.LineWidth>0&&(l.LineWidth=o.LineWidth),o.IsShow==!1&&(l.IsShow=!1);var u=s+1;l.Data.Data=o.Data,a.TitlePaint[u].Data[h]=new kt(l.Data,o.Name,l.Color),a.ChartPaint.push(l)},this.CreateColorStock=function(a,s,o,h){var l=new Or;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame;var u=s+1;l.Data.Data=o.Data,a.TitlePaint[u].Data[h]=new kt(l.Data,o.Name,this.GetDefaultColor(h)),a.ChartPaint.push(l)},this.GetDefaultColor=function(a){var s=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],o=parseInt(a);return s[o%(s.length-1)]}}function Um(r,n,e,t){this.newMethod=Jh,this.newMethod(r),delete this.newMethod,this.JsonData,t.JsonData&&(this.JsonData=t.JsonData),this.RequestData=function(a,s,o){if(!this.JsonData)console.warn("[PyScriptIndex::RequestData] JsonData is null"),h.HQChart.ScriptErrorCallback&&h.HQChart.ScriptErrorCallback("json 数据不能为空");else{var h={HQChart:a,WindowIndex:s,HistoryData:o};this.JsonData.code=0;var l=this.JsonData;this.RecvData(l,h)}}}Jh.prototype.GetDefaultColor=function(r){var n=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],e=parseInt(r);return n[e%(n.length-1)]};function La(){}La.Get=function(r){var n=new Dt.default([["互动易",{Create:function(){return new Km}}],["公告",{Create:function(){return new Jm}}],["业绩预告",{Create:function(){return new zm}}],["调研",{Create:function(){return new Zm}}],["大宗交易",{Create:function(){return new Qm}}],["龙虎榜",{Create:function(){return new $m}}]]);return n.get(r)};La.GetClassInfo=function(r){var n=new Dt.default([["互动易",{ClassName:"InvestorInfo"}],["公告",{ClassName:"AnnouncementInfo"}],["业绩预告",{ClassName:"PforecastInfo"}],["调研",{ClassName:"ResearchInfo"}],["大宗交易",{ClassName:"BlockTrading"}],["龙虎榜",{ClassName:"TradeDetail"}]]);return n.get(r)};La.GetIconUrl=function(r){switch(r){case $t.INVESTOR:return m.KLine.Info.Investor.Icon;case $t.PFORECAST:return m.KLine.Info.Pforecast.Icon;case $t.ANNOUNCEMENT:return m.KLine.Info.Announcement.Icon;case $t.ANNOUNCEMENT_QUARTER_1:case $t.ANNOUNCEMENT_QUARTER_2:case $t.ANNOUNCEMENT_QUARTER_3:case $t.ANNOUNCEMENT_QUARTER_4:return m.KLine.Info.Announcement.IconQuarter;case $t.RESEARCH:return m.KLine.Info.Research.Icon;case $t.BLOCKTRADING:return m.KLine.Info.BlockTrading.Icon;case $t.TRADEDETAIL:return m.KLine.Info.TradeDetail.Icon;default:return m.KLine.Info.Announcement.Icon}};La.GetIconLibrary=function(r){var n=m.KLine.Info.IconLibrary;if(!n||!n.Icon)return m.KLine.Info.Announcement.IconFont;if(r>=0&&r<n.Icon.length){var e=n.Icon[r],t={Text:e.Text,HScreenText:e.HScreenText,Color:e.Color,Family:n.Family};return t}return m.KLine.Info.Announcement.IconFont};La.GetIconFont=function(r){if(r>=$t.ANNOUNCEMENT_EX_START&&r<=$t.ANNOUNCEMENT_EX_END){var n=r-$t.ANNOUNCEMENT_EX_START;return La.GetIconLibrary(n)}switch(r){case $t.INVESTOR:return m.KLine.Info.Investor.IconFont;case $t.PFORECAST:return m.KLine.Info.Pforecast.IconFont;case $t.ANNOUNCEMENT:return m.KLine.Info.Announcement.IconFont;case $t.ANNOUNCEMENT_QUARTER_1:case $t.ANNOUNCEMENT_QUARTER_2:case $t.ANNOUNCEMENT_QUARTER_3:case $t.ANNOUNCEMENT_QUARTER_4:return m.KLine.Info.Announcement.IconFont2;case $t.RESEARCH:return m.KLine.Info.Research.IconFont;case $t.BLOCKTRADING:return m.KLine.Info.BlockTrading.IconFont;case $t.TRADEDETAIL:return m.KLine.Info.TradeDetail.IconFont;default:return m.KLine.Info.Announcement.IconFont}};function Rr(){this.MaxRequestDataCount=1e3,this.StartDate=20160101,this.Data,this.ClassName="IKLineInfo",this.Explain="IKLineInfo",this.GetToday=function(){var r=new Date,n=r.getFullYear()*1e4+(r.getMonth()+1)*100+r.getDate();return n},this.GetRequestData=function(r){var n={Symbol:r.Symbol,MaxRequestDataCount:r.MaxRequestDataCount,MaxRequestMinuteDayCount:r.MaxRequestMinuteDayCount,Period:r.Period},e=null;return r.ChartOperator_Temp_GetHistroyData&&(e=r.ChartOperator_Temp_GetHistroyData()),e&&(n.DateRange=e.GetDateRange()),n},this.NetworkFilter=function(r,n){if(!r.NetworkFilter)return!1;var e=this,t={HQChart:r},a={Name:this.ClassName+"::RequestData",Explain:this.Explain,Request:this.GetRequestData(r),Self:this,HQChart:r,PreventDefault:!1};return n&&(n.Update==!0&&(a.Update={Start:{Date:n.StartDate}},t.Update={Start:{Date:n.StartDate}}),a.CallFunctionName=n.FunctionName),r.NetworkFilter(a,function(s){e.RecvData(s,t)}),a.PreventDefault==!0}}function Km(){this.newMethod=Rr,this.newMethod(),delete this.newMethod,this.ClassName="InvestorInfo",this.Explain="互动易",this.RequestData=function(r,n){var e=this,t={HQChart:r};if(this.Data=[],!this.NetworkFilter(r,n)){var a={filed:["question","answerdate","symbol","id"],symbol:[t.HQChart.Symbol],querydate:{StartDate:this.StartDate,EndDate:this.GetToday()},start:0,end:this.MaxRequestDataCount},s=m.Domain+m.KLine.Info.Investor.ApiUrl;return Lt.HttpRequest({url:s,data:a,type:"post",dataType:"json",async:!0,success:function(h){e.RecvData(h,t)}}),!0}},this.RecvData=function(r,n){if(!(r.list.length<=0)){for(var e in r.list){var t=r.list[e],a=new Nr;a.Date=t.answerdate,a.Title=t.question,a.InfoType=$t.INVESTOR,this.Data.push(a)}n.HQChart.UpdataChartInfo(),n.HQChart.Draw()}}}function Jm(){this.newMethod=Rr,this.newMethod(),delete this.newMethod,this.ClassName="AnnouncementInfo",this.Explain="公告",this.ApiType=1,this.RequestData=function(r,n){var e=this,t={HQChart:r};if(n&&n.Update===!0||(this.Data=[]),!this.NetworkFilter(r,n))if(this.ApiType==1){var a=m.CacheDomain+"/cache/analyze/shszreportlist/"+t.HQChart.Symbol+".json";Lt.HttpRequest({url:a,type:"get",dataType:"json",async:!0,success:function(o){e.RecvData(o,t)},error:function(o,h){e.RecvError(o,h,t)}})}else{var a=m.Domain+m.KLine.Info.Announcement.ApiUrl;Lt.HttpRequest({url:a,data:{filed:["title","releasedate","symbol","id"],symbol:[t.HQChart.Symbol],querydate:{StartDate:this.StartDate,EndDate:this.GetToday()},start:0,end:this.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(h){e.RecvData(h,t)},error:function(h,l){e.RecvError(h,l,t)}})}},this.RecvData=function(r,n){if(c.IsNonEmptyArray(r.report)){for(var e=[],t=0;t<r.report.length;++t){var a=r.report[t],s=new Nr;s.Date=a.releasedate,s.Title=a.title,s.InfoType=$t.ANNOUNCEMENT,c.IsNumber(a.time)&&(s.Time=a.time);for(var o in a.type){var h=a.type[o];switch(h){case"一季度报告":s.InfoType=$t.ANNOUNCEMENT_QUARTER_1;break;case"半年度报告":s.InfoType=$t.ANNOUNCEMENT_QUARTER_2;break;case"三季度报告":s.InfoType=$t.ANNOUNCEMENT_QUARTER_3;break;case"年度报告":s.InfoType=$t.ANNOUNCEMENT_QUARTER_4;break}}for(var o in a.typeex){var l=a.typeex[o];s.InfoType=$t.ANNOUNCEMENT_EX_START+l;break}e.push(s)}r.Update===!0&&this.Data.length>0?this.UpdateData(e):this.Data=e,n.HQChart.UpdataChartInfo(),n.HQChart.Draw()}},this.UpdateData=function(r){if(!(!r||r.length<=0)){var n=new Ee.default;for(var e in this.Data){var t=this.Data[e],a=t.Date+"-"+t.Time+"-"+t.InfoType+"-"+t.Title;n.add(a)}var s=0;for(var e in r){var t=r[e],a=t.Date+"-"+t.Time+"-"+t.InfoType+"-"+t.Title;n.has(a)||(this.Data.push(t),++s)}X.Chart.Log("[AnnouncementInfo::UpdateData] add new count="+s)}},this.RecvError=function(r,n,e){console.warn("[AnnouncementInfo::RecvError] error, http ",n,r)}}function zm(){this.newMethod=Rr,this.newMethod(),delete this.newMethod,this.ClassName="PforecastInfo",this.RequestData=function(r,n){var e=this,t={HQChart:r};this.Data=[];var a=m.Domain+m.KLine.Info.Pforecast.ApiUrl;return Lt.HttpRequest({url:a,data:{field:["pforecast.type","pforecast.reportdate","fweek"],condition:[{item:["pforecast.reportdate","int32","gte",this.StartDate]}],symbol:[t.HQChart.Symbol],start:0,end:this.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(o){e.RecvData(o,t)}}),!0},this.RecvData=function(r,n){if(r.stock.length==1&&!(r.stock[0].stockday.length<=0)){for(var e in r.stock[0].stockday){var t=r.stock[0].stockday[e];if(t.pforecast.length>0){var a=t.pforecast[0],s=new Nr;s.Date=t.date,s.Title=a.type,s.InfoType=$t.PFORECAST,s.ExtendData={Type:a.type,ReportDate:a.reportdate},t.fweek&&(s.ExtendData.FWeek={},t.fweek.week1!=null&&(s.ExtendData.FWeek.Week1=t.fweek.week1),t.fweek.week4!=null&&(s.ExtendData.FWeek.Week4=t.fweek.week4)),this.Data.push(s)}}n.HQChart.UpdataChartInfo(),n.HQChart.Draw()}}}function Zm(){this.newMethod=Rr,this.newMethod(),delete this.newMethod,this.ClassName="ResearchInfo",this.RequestData=function(r,n){var e=this,t={HQChart:r};this.Data=[];var a=m.Domain+m.KLine.Info.Research.ApiUrl;return Lt.HttpRequest({url:a,data:{filed:["releasedate","researchdate","level","symbol","id","type"],querydate:{StartDate:this.StartDate,EndDate:this.GetToday()},symbol:[t.HQChart.Symbol],start:0,end:this.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(o){e.RecvData(o,t)}}),!0},this.RecvData=function(r,n){if(!(r.list.length<=0)){for(var e in r.list){var t=r.list[e],a=new Nr;a.ID=t.id,a.Date=t.researchdate,a.InfoType=$t.RESEARCH,a.ExtendData={Level:t.level,Type:t.type},this.Data.push(a)}n.HQChart.UpdataChartInfo(),n.HQChart.Draw()}}}function Qm(){this.newMethod=Rr,this.newMethod(),delete this.newMethod,this.ClassName="BlockTrading",this.RequestData=function(r,n){var e=this,t={HQChart:r};this.Data=[];var a=m.Domain+m.KLine.Info.BlockTrading.ApiUrl;return Lt.HttpRequest({url:a,data:{field:["blocktrading.price","blocktrading.vol","blocktrading.premium","fweek","price"],condition:[{item:["date","int32","gte",this.StartDate]},{item:["blocktrading.vol","int32","gte","0"]}],symbol:[t.HQChart.Symbol],start:0,end:this.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(o){e.RecvData(o,t)}}),!0},this.RecvData=function(r,n){if(r.stock.length==1&&!(r.stock[0].stockday.length<=0)){for(var e in r.stock[0].stockday){var t=r.stock[0].stockday[e],a=new Nr;a.Date=t.date,a.InfoType=$t.BLOCKTRADING,a.ExtendData={Price:t.blocktrading.price,Premium:t.blocktrading.premium,Vol:t.blocktrading.vol,ClosePrice:t.price},t.fweek&&(a.ExtendData.FWeek={},t.fweek.week1!=null&&(a.ExtendData.FWeek.Week1=t.fweek.week1),t.fweek.week4!=null&&(a.ExtendData.FWeek.Week4=t.fweek.week4)),this.Data.push(a)}n.HQChart.UpdataChartInfo(),n.HQChart.Draw()}}}function $m(){this.newMethod=Rr,this.newMethod(),delete this.newMethod,this.ClassName="TradeDetail",this.RequestData=function(r,n){var e=this,t={HQChart:r};this.Data=[];var a=m.Domain+m.KLine.Info.TradeDetail.ApiUrl;return Lt.HttpRequest({url:a,data:{field:["tradedetail.typeexplain","tradedetail.type","fweek"],condition:[{item:["date","int32","gte",this.StartDate]},{item:["tradedetail.type","int32","gte","0"]}],symbol:[t.HQChart.Symbol],start:0,end:this.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(o){e.RecvData(o,t)}}),!0},this.RecvData=function(r,n){if(r.stock.length==1&&!(r.stock[0].stockday.length<=0)){for(var e in r.stock[0].stockday){var t=r.stock[0].stockday[e],a=new Nr;a.Date=t.date,a.InfoType=$t.TRADEDETAIL,a.ExtendData={Detail:new Array};for(var s in t.tradedetail){var o=t.tradedetail[s];a.ExtendData.Detail.push({Type:o.type,TypeExplain:o.typeexplain})}t.fweek&&(a.ExtendData.FWeek={},t.fweek.week1!=null&&(a.ExtendData.FWeek.Week1=t.fweek.week1),t.fweek.week4!=null&&(a.ExtendData.FWeek.Week4=t.fweek.week4)),this.Data.push(a)}n.HQChart.UpdataChartInfo(),n.HQChart.Draw()}}}function jn(){}jn.InfoMap=new Dt.default([["大盘异动",{Create:function(){return new jm}}]]);jn.Get=function(r){return jn.InfoMap.get(r)};function qm(){this.Data,this.ClassName="IMinuteInfo"}function jm(){this.newMethod=qm,this.newMethod(),delete this.newMethod,this.ClassName="MarketEventInfo",this.RequestData=function(r){var n=this;this.Data=[];var e={HQChart:r},t=m.CacheDomain+"/cache/analyze/shszevent/marketevent/concept/"+r.TradeDate+".json";if(r.NetworkFilter){var a={Name:"MarketEventInfo::RequestData",Explain:"大盘异动",Request:{Url:t,Type:"Get",Data:{Date:r.TradeDate,Symbol:r.Symbol}},Self:this,PreventDefault:!1};if(r.NetworkFilter(a,function(s){n.RecvData(s,e),e.HQChart.UpdataChartInfo(),e.HQChart.Draw()}),a.PreventDefault==!0)return}return Lt.HttpRequest({url:t,type:"get",dataType:"json",async:!0,success:function(o){n.RecvData(o,e)},error:function(o,h){console.warn("[MarketEventInfo::RequestData] error, http ",h,o)}}),!0},this.RecvData=function(r,n){for(var e in r.event){var t=r.event[e];for(var a in t.data){var s=t.data[a];if(Array.isArray(s)){if(s.length<2)continue;var o={Date:t.date,Time:s[0],Title:s[1],Type:0};s.length>=3&&s[2]&&typeof s[2]=="string"&&(o.Color=s[2]),s.length>=4&&s[3]&&typeof s[3]=="string"&&(o.BGColor=s[3]),this.Data.push(o)}else{if(!c.IsNumber(s.Date)||!c.IsNumber(s.Time)||!s.Title)continue;var o={Date:s.Date,Time:s.Time,Title:s.Title,Type:0};s.Color&&(o.Color=s.Color),s.BGColor&&(o.BGColor=s.BGColor),c.IsNumber(s.Price)&&(o.Price=s.Price),s.Content&&(o.Content=s.Content),s.Link&&(o.Link=s.Link),this.Data.push(o)}}}n.HQChart.UpdataChartInfo(),n.HQChart.Draw()}}function tI(){this.DataMap=new Dt.default([["ChartPictureSettingMenu",{Create:function(n){return new uI(n)}}],["ChartPictureTextSettingMenu",{Create:function(n){return new zh(n)}}]]),this.Create=function(r,n){if(!this.DataMap.has(r))return X.Warn("[DialogFactory::Create] can't find class="+r+"."),null;var e=this.DataMap.get(r);return e.Create(n)},this.Add=function(r,n){this.DataMap.set(r,{Create:n.Create})}}var tD=new tI;function qa(r){this.DivElement=r,this.ID=null,this.TimeOut=null,this.Hide=function(){(0,q.default)("#"+this.ID).hide()},this.Show=function(n,e,t,a){var s={display:"block"};c.IsNumber(n)&&(s.left=n+"px"),c.IsNumber(e)&&(s.top=e+"px"),c.IsNumber(t)&&(s.width=t+"px"),c.IsNumber(a)&&(s.height=a+"px"),(0,q.default)("#"+this.ID).css(s)}}function eI(r){this.newMethod=qa,this.newMethod(r),delete this.newMethod,this.Title={ID:oe()},this.ParamList={ID:oe()},this.ParamData=[],this.Identify,this.HQChart,this.IsOverlay=!1,this.IndexScript,this.Create=function(){this.ID=oe();var n=document.createElement("div");n.className="jchart-modifyindex-box",n.id=this.ID,n.innerHTML="<div class='parameter'>            <div class='parameter-header'>                <span></span>                <strong id='close' class='icon iconfont icon-close'></strong>            </div>            <div class='parameter-content'><input/>MA</div>            <div class='parameter-footer'>                <button class='submit' >确定</button>                <button class='cancel' >取消</button>            </div>        </div>",this.DivElement.appendChild(n),(0,q.default)("#"+this.ID+" .submit").click({divBox:this},function(a){a.data.divBox.Hide()});var e=n.getElementsByTagName("span")[0];e.id=this.Title.ID;var t=n.getElementsByClassName("parameter-content")[0];t.id=this.ParamList.ID},this.SetTitle=function(n){(0,q.default)("#"+this.Title.ID).html(n)},this.ClearParamList=function(){(0,q.default)("#"+this.ParamList.ID).empty(),this.ParamData=[]},this.BindParam=function(){for(var n=0;n<this.IndexScript.Arguments.length;++n){var e=this.IndexScript.Arguments[n];if(e.Name==null||isNaN(e.Value))break;var t=oe(),a='<input class="row-line" id="'+t+'" value="'+e.Value+'" type="number" step="1"/>'+e.Name+"<br>";(0,q.default)("#"+this.ParamList.ID).append(a),this.ParamData.push({ID:t,Value:e.Value})}for(var s=this,n=0;n<this.ParamData.length;++n){var e=this.ParamData[n];(0,q.default)("#"+e.ID).mouseup({ParamIndex:n},function(l){var u=parseInt((0,q.default)(this).val());if(!c.IsNumber(u)){alert("参数不能为空");return}var f=s.HQChart,C=s.Identify,D=l.data.ParamIndex,v=s.IndexScript,S=s.IsOverlay;v.Arguments[D].Value=u,S?f.UpdateOverlayIndex(C):f.UpdateWindowIndex(C)}),(0,q.default)("#"+e.ID).keyup({ParamIndex:n},function(l){var u=parseInt((0,q.default)(this).val());if(!c.IsNumber(u)){alert("参数不能为空");return}var f=s.HQChart,C=s.Identify,D=l.data.ParamIndex,v=s.IndexScript,S=s.IsOverlay;v.Arguments[D].Value=u,S?f.UpdateOverlayIndex(C):f.UpdateWindowIndex(C)})}},this.BindCancel=function(){var n=this;(0,q.default)("#"+this.ID+" .cancel"),(0,q.default)("#"+this.ID+" .cancel").unbind("click").click(function(e){var t=n.HQChart,a=n.Identify;n.RestoreParam();var s=n.IsOverlay;s?t.UpdateOverlayIndex(a):t.UpdateWindowIndex(a),n.IndexScript=null,n.Hide()}),(0,q.default)("#"+this.ID+" #close").unbind("click").click(function(e){var t=n.HQChart,a=n.Identify,s=n.IsOverlay;n.RestoreParam(),s?t.UpdateOverlayIndex(a):t.UpdateWindowIndex(a),n.IndexScript=null,n.Hide()})},this.RestoreParam=function(){if(this.IndexScript)for(var n=0;n<this.ParamData.length;++n){var e=this.ParamData[n];this.IndexScript.Arguments[n].Value=e.Value}},this.DoModal=function(n){var e=n.data.Chart,t=n.data.Identify,a=e.ModifyIndexDialog,s=n.data.IsOverlay===!0;if(a){if(a.ID==null&&a.Create(),a.Identify=t,a.HQChart=e,a.IsOverlay=s,s){var o=e.GetOverlayIndexByIdentify(t);if(!o||!o.OverlayItem.Script)return;a.IndexScript=o.OverlayItem.Script,a.SetTitle(a.IndexScript.Name+" 叠加指标参数设置")}else a.IndexScript=e.WindowIndex[t],a.SetTitle(a.IndexScript.Name+" 指标参数设置");a.ClearParamList(),a.BindParam(e,t),a.BindCancel(),a.Show()}}}function aI(r){this.newMethod=qa,this.newMethod(r),delete this.newMethod,this.DivElement=r,this.IndexTreeApiUrl="https://opensourcecache.zealink.com/cache/hqh5/index/commonindextree.json",this.OverlayIndexTreeApiUrl="https://opensourcecache.zealink.com/cache/hqh5/index/commonindextree.json",this.IsOverlayIndex=!1,this.Create=function(){var n=document.createElement("div");n.className="jchart-changeindex-box",n.id=this.ID=oe(),n.innerHTML=`<div class="target-panel">
            <div class="target-header">
                <span>换指标</span>
                <strong class="close-tar icon iconfont icon-close"></strong>
            </div>
            <div class="target-content">
                <div class="target-left">
                    <input type="text">
                    <ul></ul>
                </div>
                <div class="target-right">
                    <ul></ul>
                </div>
            </div>
        </div>`,this.DivElement.appendChild(n)},this.ReqeustData=function(){if((0,q.default)("#"+this.ID+" .target-left ul li").length>0)return!1;var n=this.IndexTreeApiUrl;this.IsOverlayIndex==!0&&(n=this.OverlayIndexTreeApiUrl),Lt.HttpRequest({url:n,type:"get",success:function(s){var o=s.list;e(o),t(o)}});function e(a){(0,q.default)(".target-left ul").html(""),q.default.each(a,function(s,o){var h;h="<li>"+o.node+"</li>",(0,q.default)(".target-left ul").append(h)}),(0,q.default)(".target-left ul li:first-child").addClass("active-list")}function t(a){var s,o=[];q.default.each(a,function(h,l){o.push(l.list)}),q.default.each(o[0],function(h,l){s="<li id="+l.id+">"+l.name+"</li>",(0,q.default)(".target-right ul").append(s)}),(0,q.default)(".target-left ul").delegate("li","click",function(){(0,q.default)(this).addClass("active-list").siblings().removeClass("active-list");var h=(0,q.default)(this).index();(0,q.default)(".target-right ul").html(""),q.default.each(o[h],function(l,u){s="<li id="+u.id+">"+u.name+"</li>",(0,q.default)(".target-right ul").append(s)})})}},this.BindClose=function(n){(0,q.default)("#"+this.ID+" .close-tar").click({Chart:n},function(e){var t=e.data.Chart;t.ChangeIndexDialog.Hide()})},this.BindSearch=function(n){(0,q.default)(".target-left input").on("input",{Chart:n},function(e){var t=new J,a=t.Search(e.target.value);(0,q.default)(".target-right ul").html("");for(var s in a){var o=a[s],h="<li id="+o+">"+o+"</li>";(0,q.default)(".target-right ul").append(h)}})},this.DoModal=function(n){var e=n.data.Chart,t=n.data.Identify,a=e.ChangeIndexDialog,s=n.data.IsOverlay;if(!a)return;a.ID==null&&a.Create(),a.IsOverlayIndex=s,a.ReqeustData(),o();function o(){(0,q.default)(".target-right ul").undelegate().delegate("li","click",function(){var h=(0,q.default)(this).attr("id");s?e.AddOverlayIndex({WindowIndex:t,IndexName:h}):e.ChangeIndex(t,h),(0,q.default)(this).addClass("active-list").siblings().removeClass("active-list")})}a.BindSearch(e),a.BindClose(e),a.Show()}}function iI(r){this.newMethod=qa,this.newMethod(r),delete this.newMethod,this.JSChart=null,this.Height=500,this.Width=600,this.Symbol,this.TradeDate,this.HistoryData,this.Show=function(n,e,t,a){var s=document.getElementById(this.ID);if(!s)return!1;var o=s.getElementsByClassName("minute-hqchart");if(!o||o.length!=1)return!1;var h=o[0];c.IsNumber(t)&&(s.style.width=t+"px"),c.IsNumber(a)&&(s.style.height=a+"px"),c.IsNumber(n)&&(s.style.left=n+"px"),c.IsNumber(e)&&(s.style.top=e+"px"),s.style.display="block";var l=h.offsetWidth,u=h.offsetTop;h.style.width=l+"px",h.style.height=a-u-5+"px"},this.Create=function(){this.ID=oe();var n=document.createElement("div");n.className="jchart-kline-minute-box",n.id=this.ID;var e=oe();n.innerHTML="<div><div class='minute-dialog-title'><span></span><strong class='close-munite icon iconfont icon-close'></strong></div><div class='minute-hqchart' id='"+e+"' ></div></div>",n.style.width=this.Height+"px",n.style.height=this.Width+"px",this.DivElement.appendChild(n),this.JSChart=_t.Init(document.getElementById(e));var t={Type:"历史分钟走势图",Symbol:this.Symbol,IsAutoUpdate:!1,IsShowRightMenu:!1,HistoryMinute:{TradeDate:this.TradeDate,IsShowName:!1,IsShowDate:!1}};this.JSChart.SetOption(t)},this.BindClose=function(n){(0,q.default)("#"+this.ID+" .close-munite").click({Chart:n},function(e){var t=e.data.Chart;t.MinuteDialog.Hide()})},this.DoModal=function(n){this.UpColor=m.UpTextColor,this.DownColor=m.DownTextColor,this.UnchagneColor=m.UnchagneTextColor;var e=n.data.Chart,t=n.data.Tooltip,a=e.MinuteDialog;if(a.Symbol=e.Symbol,a.TradeDate=t.Data.Date,!!a){a.ID==null?a.Create():(a.JSChart.JSChartContainer.TradeDate=a.TradeDate,a.JSChart.ChangeSymbol(this.Symbol)),n.clientX,n.clientY+10;var s=V();a.Show(500/s,100/s,600,500),a.JSChart.OnSize(),this.BindClose(e),this.GetColor=function(C,D){return C>D?this.UpColor:C<D?this.DownColor:this.UnchagneColor};var o=n.data.Chart.Name,h=n.data.Tooltip.Data;new Date(parseInt(h.Date/1e4),h.Date/100%100-1,h.Date%100);var l=h.Date.toString(),u=l.substring(0,4)+"-"+l.substring(4,6)+"-"+l.substring(6,8),f="<span>"+o+"</span><span>"+u+"</span>&nbsp;<span style='color:"+this.GetColor(h.Open,h.YClose)+";'>开:"+h.Open.toFixed(2)+"</span><span style='color:"+this.GetColor(h.High,h.YClose)+";'>高:"+h.High.toFixed(2)+"</span><span style='color:"+this.GetColor(h.Low,h.YClose)+";'>低:"+h.Low.toFixed(2)+"</span><span style='color:"+this.GetColor(h.Close,h.YClose)+";'>收:"+h.Close.toFixed(2)+"</span><span style='color:"+this.VolColor+";'>量:"+c.FormatValueString(h.Vol,2)+"</span><span style='color:"+this.AmountColor+";'>额:"+c.FormatValueString(h.Amount,2)+"</span>";(0,q.default)(".minute-dialog-title span").html(f)}}}function rI(r){this.newMethod=qa,this.newMethod(r),delete this.newMethod,this.SelectData,this.Dialog,this.HQChart,this.RectSelectPaint,this.Close=function(){this.Dialog&&(this.DivElement.removeChild(this.Dialog),this.Dialog=null,this.ID=null),this.RectSelectPaint&&(this.RectSelectPaint.PreventClose=!1)},this.Create=function(){this.ID=oe();var n=document.createElement("div");n.className="jchart-select-statistics-box",n.id=this.ID,n.innerHTML="<div class='parameter jchart-select-section'>            <div class='parameter-header'>                <span>分时图区间统计</span>                <strong id='close' class='icon iconfont icon-close'></strong>            </div>            <div class='parameter-content'>统计数据</div>        <div class='parameter-footer'>            <button id='close' class='submit' >确定</button>        </div>        </div>",this.DivElement.appendChild(n),this.Dialog=n,(0,q.default)("#"+this.ID+" #close").click({divBox:this},function(e){e.data.divBox.Close()})},this.BindData=function(){var n=this.SelectData.Data,e=this.SelectData.Start,t=this.SelectData.End;this.HQChart.UpdateSelectRect(e,t),this.RectSelectPaint&&(this.RectSelectPaint.PreventClose=!0);for(var a={Open:0,Close:0,High:0,Low:0,Vol:0,Amount:0,Date:{Start:{Time:null,Date:null},End:{Time:null,Date:null}},Count:0},s=e;s<=t&&s<n.Data.length;++s){var o=n.Data[s];s==e&&(a.Date.Start.Date=o.Date,a.Date.Start.Time=o.Time,a.Open=o.Close,a.High=o.High,a.Low=o.Low),a.Date.End.Date=o.Date,a.Date.End.Time=o.Time,a.Close=o.Close,a.Vol+=o.Vol,a.Amount+=o.Amount,++a.Count,a.High<o.High&&(a.High=o.High),a.Low>o.Low&&(a.Low=o.Low)}a.Vol>0&&(a.AvPrice=a.Amount/a.Vol),o.Open>0&&(a.Increase=(a.Close-a.Open)/a.Open*100,a.Amplitude=(a.High-a.Low)/a.Open*100);var h=fe(this.SelectData.Symbol),l=c.FormatDateString(a.Date.Start.Date),u=c.FormatDateString(a.Date.End.Date);l+=" "+c.FormatTimeString(a.Date.Start.Time,"HH:MM"),u+=" "+c.FormatTimeString(a.Date.End.Time,"HH:MM");var f="",C="",D="",v="";e<=0&&(f="BtnBackground"),e>=t&&(C="BtnBackground",D="BtnBackground"),t>=n.Data.length-1&&(v="BtnBackground");var S=document.createElement("div");S.className="jchart-select-table-right",S.innerHTML=`<div class="jchart-select-date">
            <span>开始: `+l+'<i class="start-date-left '+f+'"><</i><i class="start-date-right '+C+`">></i></span>
            <span>结束: `+u+'<i class="end-date-left '+D+'"><</i><i class="end-date-right '+v+`">></i></span>
            <span>总个数: `+a.Count+`</span>
        </div>
        <table>
            <tr><td><strong>起始价: </strong><span>`+a.Open.toFixed(h)+"</span></td>               <td><strong>终止价: </strong><span>"+a.Close.toFixed(h)+"</span></td>               <td><strong>均价: </strong><span>"+(c.IsNumber(a.AvPrice)?a.AvPrice.toFixed(h):"--.--")+`</span></td></tr>
            <tr><td><strong>最低价: </strong><span>`+a.Low.toFixed(h)+"</span></td>               <td><strong>最高价: </strong><span>"+a.High.toFixed(h)+'</span></td>               <td><strong>涨跌幅: </strong><span class="'+c.FormatValueColor(a.Increase)+'">'+a.Increase.toFixed(2)+`%</span></td></tr>
            <tr><td><strong>振幅: </strong><span>`+a.Amplitude.toFixed(2)+"%</span></td>               <td><strong>成交量: </strong><span>"+c.FormatValueString(a.Vol,2)+"股</span></td>               <td><strong>金额: </strong><span>"+c.FormatValueString(a.Amount,2)+`元</span></td></tr>
        </table>`,(0,q.default)(".parameter-content").html(S),this.BindEvent()},this.BindEvent=function(){var n=this;n.SelectData.Start>0&&(0,q.default)(".jchart-select-date .start-date-left").click(function(){n.SelectData.Start--,n.BindData(),n.HQChart.UpdateSelectRect(n.SelectData.Start,n.SelectData.End)}),n.SelectData.Start<n.SelectData.End&&((0,q.default)(".jchart-select-date .start-date-right").click(function(){n.SelectData.Start++,n.BindData(),n.HQChart.UpdateSelectRect(n.SelectData.Start,n.SelectData.End)}),(0,q.default)(".jchart-select-date .end-date-left").click(function(){n.SelectData.End--,n.BindData(),n.HQChart.UpdateSelectRect(n.SelectData.Start,n.SelectData.End)})),n.SelectData.End<n.SelectData.Data.Data.length-1&&(0,q.default)(".jchart-select-date .end-date-right").click(function(){n.SelectData.End++,n.BindData(),n.HQChart.UpdateSelectRect(n.SelectData.Start,n.SelectData.End)})},this.DoModal=function(n){var e=n.data.Chart;this.ID==null&&this.Create(),this.SelectData=n.data.SelectData,this.RectSelectPaint=n.data.RectSelectPaint,this.HQChart=e,this.HQChart.HideSelectRect(),this.BindData(),this.Show()}}function nI(r){this.newMethod=qa,this.newMethod(r),delete this.newMethod,this.SelectData,this.Dialog,this.HQChart,this.RectSelectPaint,this.Close=function(){this.Dialog&&(this.DivElement.removeChild(this.Dialog),this.Dialog=null),this.RectSelectPaint&&(this.RectSelectPaint.PreventClose=!1)},this.Create=function(){this.ID=oe();var n=document.createElement("div");n.className="jchart-select-statistics-box",n.id=this.ID,n.innerHTML="<div class='parameter jchart-select-section'>            <div class='parameter-header'>                <span>区间统计</span>                <strong id='close' class='icon iconfont icon-close'></strong>            </div>            <div class='parameter-content'>统计数据</div>        <div class='parameter-footer'>            <button id='close' class='submit' >确定</button>            <button id='match' class='submit' >形态匹配</button>        </div>        </div>",this.DivElement.appendChild(n),this.Dialog=n,(0,q.default)("#"+this.ID+" #close").click({divBox:this},function(e){e.data.divBox.Close()}),(0,q.default)("#"+this.ID+" #match").click({divBox:this},function(e){e.data.divBox.KLineMatch()})},this.BindData=function(){var n=this.SelectData.Data,e=this.SelectData.Start,t=this.SelectData.End;this.HQChart.UpdateSelectRect(e,t),this.RectSelectPaint&&(this.RectSelectPaint.PreventClose=!0);for(var a={Open:0,Close:0,High:0,Low:0,YClose:0,Vol:0,Amount:0,Date:{Start:{Time:null,Date:null},End:{Time:null,Date:null}},Count:0,KLine:{Up:0,Down:0,Unchanged:0}},s=e;s<=t&&s<n.Data.length;++s){var o=n.Data[s];s==e&&(a.Date.Start.Date=o.Date,a.Date.Start.Time=o.Time,a.Open=o.Open,a.High=o.High,a.Low=o.Low,a.YClose=o.YClose),a.Date.End.Date=o.Date,a.Date.End.Time=o.Time,a.Close=o.Close,a.Vol+=o.Vol,a.Amount+=o.Amount,++a.Count,a.High<o.High&&(a.High=o.High),a.Low>o.Low&&(a.Low=o.Low),o.Close>o.Open?++a.KLine.Up:o.Close<o.Open?++a.KLine.Down:++a.KLine.Unchanged}a.Vol>0&&(a.AvPrice=a.Amount/a.Vol),o.YClose>0&&(a.Increase=(a.Close-a.YClose)/a.YClose*100,a.Amplitude=(a.High-a.Low)/a.YClose*100);var h=fe(this.SelectData.Symbol),l=c.FormatDateString(a.Date.Start.Date),u=c.FormatDateString(a.Date.End.Date);k.IsMinutePeriod(this.HQChart.Period)?(l+=" "+c.FormatTimeString(a.Date.Start.Time,"HH:MM"),u+=" "+c.FormatTimeString(a.Date.End.Time,"HH:MM")):(k.IsSecondPeriod(this.HQChart.Period)||k.IsTickPeriod(this.HQChart.Period))&&(l+=" "+c.FormatTimeString(a.Date.Start.Time,"HH:MM:SS"),u+=" "+c.FormatTimeString(a.Date.End.Time,"HH:MM:SS"));var f="",C="",D="",v="";e<=0&&(f="BtnBackground"),e>=t&&(C="BtnBackground",D="BtnBackground"),t>=n.Data.length-1&&(v="BtnBackground");var S=document.createElement("div");S.className="jchart-select-table-right",S.innerHTML=`<div class="jchart-select-date">
            <span>开始: `+l+'<i class="start-date-left '+f+'"><</i><i class="start-date-right '+C+`">></i></span>
            <span>结束: `+u+'<i class="end-date-left '+D+'"><</i><i class="end-date-right '+v+`">></i></span>
            <span>总个数: `+a.Count+`</span>
        </div>
        <table>
            <tr><td><strong>起始价: </strong><span>`+a.YClose.toFixed(h)+"</span></td>               <td><strong>最终价: </strong><span>"+a.Close.toFixed(h)+"</span></td>               <td><strong>均价: </strong><span>"+(c.IsNumber(a.AvPrice)?a.AvPrice.toFixed(h):"--.--")+`</span></td></tr>
            <tr><td><strong>最低价: </strong><span>`+a.Low.toFixed(h)+"</span></td>               <td><strong>最高价: </strong><span>"+a.High.toFixed(h)+'</span></td>               <td><strong>涨跌幅: </strong><span class="'+c.FormatValueColor(a.Increase)+'">'+a.Increase.toFixed(2)+`%</span></td></tr>
            <tr><td><strong>振幅: </strong><span>`+a.Amplitude.toFixed(2)+"%</span></td>               <td><strong>成交量: </strong><span>"+c.FormatValueString(a.Vol,2)+"股</span></td>               <td><strong>金额: </strong><span>"+c.FormatValueString(a.Amount,2)+`元</span></td></tr>
            <tr><td><strong>阴线: </strong><span>`+a.KLine.Up+"</span></td>               <td><strong>阳线: </strong><span>"+a.KLine.Down+"</span></td>               <td><strong>平线: </strong><span>"+a.KLine.Unchanged+`</span></td></tr>
        </table>`,(0,q.default)(".parameter-content").html(S),this.BindEvent()},this.BindEvent=function(){var n=this;n.SelectData.Start>0&&(0,q.default)(".jchart-select-date .start-date-left").click(function(){n.SelectData.Start--,n.BindData(),n.HQChart.UpdateSelectRect(n.SelectData.Start,n.SelectData.End)}),n.SelectData.Start<n.SelectData.End&&((0,q.default)(".jchart-select-date .start-date-right").click(function(){n.SelectData.Start++,n.BindData(),n.HQChart.UpdateSelectRect(n.SelectData.Start,n.SelectData.End)}),(0,q.default)(".jchart-select-date .end-date-left").click(function(){n.SelectData.End--,n.BindData(),n.HQChart.UpdateSelectRect(n.SelectData.Start,n.SelectData.End)})),n.SelectData.End<n.SelectData.Data.Data.length-1&&(0,q.default)(".jchart-select-date .end-date-right").click(function(){n.SelectData.End++,n.BindData(),n.HQChart.UpdateSelectRect(n.SelectData.Start,n.SelectData.End)})},this.DoModal=function(n){var e=n.data.Chart;this.ID==null&&this.Create(),this.SelectData=n.data.SelectData,this.RectSelectPaint=n.data.RectSelectPaint,this.HQChart=e,this.HQChart.HideSelectRect(),this.BindData(),this.Show()},this.KLineMatch=function(n){var e=new oI(this.DivElement);e.DoModal({data:{Title:"计算中......",Chart:this.HQChart}}),this.Close();var t=this.HQChart,a={Scope:{Plate:["CNA.ci"],Minsimilar:.9},WaitDialog:e};t.RequestKLineMatch(this.SelectData,a)}}function sI(r){this.newMethod=qa,this.newMethod(r),delete this.newMethod,this.MatchData,this.Sample,this.Dialog,this.HQChart,this.PageData,this.Close=function(){this.DivElement.removeChild(this.Dialog)},this.Create=function(){this.ID=oe();var e=document.createElement("div");e.className="jchart-kline-match-box",e.id=this.ID,e.innerHTML=`<div class='parameter jchart-kline-match-box'>
            <div class='parameter-header'>
                <span>形态匹配</span>
                <strong id='close' class='icon iconfont icon-close'></strong>
            </div>
            <div class='parameter-content'>
                <p class='dataCount'></p>
                <table class='matchTable'>
                    <thead>
                        <tr>
                            <td>股票名称</td>
                            <td>匹配度</td>
                            <td>时间段</td>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <div class='pagination' data-current='1'></div>
            </div>
            <div class='parameter-footer'>
                <button id='close' class='submit' >确定</button>
            </div>
        </div>`.trim(),this.DivElement.appendChild(e),this.Dialog=e,(0,q.default)("#"+this.ID+" #close").click({divBox:this},function(t){t.data.divBox.Close()})},this.BindData=function(){X.Chart.Log("[KLineMatchDialog::BindData] 形态源: "+this.Sample.Stock.Name+" 区间:"+this.Sample.Date.Start+" - "+this.Sample.Date.End);var e=this.MatchData.length+1,t={NewData:{},MetaData:[],PageCount:0,Count:e},a=0;(0,q.default)("#"+this.ID+" .dataCount").html("个数："+e);for(var s=0;s<e;s++){var o={};if(s==0)o={Symbol:this.Sample.Stock.Symbol,Name:this.Sample.Stock.Name,Rate:"形态源",Color:"red",Date:this.Sample.Date.Start+"-"+this.Sample.Date.End};else{var h=this.MatchData[s-1];o={Symbol:h.Symbol,Name:h.Name,Rate:Number(h.Similar*100).toFixed(2),Color:"",Date:h.Start+"-"+h.End}}t.MetaData.push(o)}t.Count%10==0?a=t.Count/10:a=Math.floor(t.Count/10)+1,t.PageCount=a,this.PaginationMetaData(t),this.PageData=t,X.Chart.Log("[KLineMatchDialog::DoModal pageData]",t),this.RenderDom(1),this.PaginationInit("#"+this.ID,t.PageCount,this.paginationCallback)},this.RenderDom=function(e){var t=this.PageData.NewData[e];X.Chart.Log("[KLineMatchDialog::RenderDom currentPageData]",t);for(var a="",s=0;s<t.length;s++)a+=(`<tr>
                        <td class=`+t[s].Color+">"+t[s].Name+`</td>
                        <td class=`+t[s].Color+">"+t[s].Rate+`</td>
                        <td class=`+t[s].Color+">"+t[s].Date+`</td>
                    </tr>`).trim();(0,q.default)("#"+this.ID+" .matchTable tbody").html(a)};var n=this;this.paginationCallback=function(e){n.RenderDom(e),n.PaginationInit("#"+n.ID,n.PageData.PageCount,n.paginationCallback)},this.PaginationInit=function(e,t,a){var s="",o=(0,q.default)(e+" .pagination").data("current"),h=0,l=5;if(o<l)if(t>=l)for(var u=0;u<l;u++)s+=u+1!=o?"<span>"+(u+1)+"</span>":"<span class='active'>"+(u+1)+"</span>";else for(var u=0;u<t;u++)s+=u+1!=o?"<span>"+(u+1)+"</span>":"<span class='active'>"+(u+1)+"</span>";else{h=o+1>t?o:o+1;for(var f=o-3;f<=h;f++)s+=f!=o?"<span>"+f+"</span>":"<span class='active'>"+f+"</span>"}s="<span class='beforePage'>上一页</span>"+s+"<span class='nextPage'>下一页</span>",(0,q.default)(e+" .pagination").html(s),(0,q.default)(e+" .pagination span").bind("click",{maxpage:t,Callback:a},this.PaginationCurrentIndex)},this.PaginationCurrentIndex=function(e){var t=(0,q.default)(this).text();X.Chart.Log("[::PaginationCurrentIndex text]",t);var a=Number((0,q.default)(this).parent().data("current")),s=e.data.maxpage,o=e.data.Callback,h=1;t==="上一页"?h=a===1?a:a-1:t==="下一页"?h=a===s?a:a+1:h=Number(t),(0,q.default)(this).parent().data("current",h),o(h)},this.PaginationMetaData=function(e){for(var t={},a=e.MetaData,s=e.PageCount,o=0;o<s;o++){for(var h=[],l=0;l<10;l++){var u=10*o+l;if(u<=a.length-1){var f=a[u];h.push(f)}else break}t[o+1]=h}e.NewData=t},this.DoModal=function(e){var t=e.data.Chart;this.ID==null&&this.Create(),this.MatchData=e.data.MatchData,this.Sample=e.data.Sample,this.HQChart=t,this.BindData();var a=t.Frame.ChartBorder;tn();var s=a.GetWidth()/2,o=a.GetHeight()/2;this.Show(s,o,200,200)}}function oI(r){this.newMethod=qa,this.newMethod(r),delete this.newMethod,this.Title="加载中......",this.Dialog,this.Close=function(){this.Dialog&&(this.DivElement.removeChild(this.Dialog),this.Dialog=null)},this.SetTitle=function(n){this.Title=n,this.Dialog},this.Create=function(){this.ID=oe();var n=document.createElement("div");n.className="jchart-wait-box",n.id=this.ID,n.innerHTML=(`<div class='parameter jchart-kline-match-box'>
            <div class='parameter-header'>
                <span>`+this.Title+`</span>
            </div>
        </div>`).trim(),this.DivElement.appendChild(n),this.Dialog=n},this.DoModal=function(n){this.Title=n.data.Title;var e=n.data.Chart;this.ID==null&&this.Create();var t=e.Frame.ChartBorder;tn();var a=t.GetWidth()/2,s=t.GetHeight()/2;this.Show(a,s,200,40)}}function ts(r){this.newMethod=qa,this.newMethod(r),delete this.newMethod,this.option={},this.Create=function(){var n=this;this.ID=oe(),n.BindData(),n.BindEvent()},this.BindData=function(){var n=this,e=this.DivElement.id,t=(0,q.default)("#"+e);t.find("div[id^='topMenu_']").remove(),t.find("div[id^='childMenu_']").remove();var a=(0,q.default)("<div />");a.attr("id","topMenu_"+n.ID).addClass("context-menu-wrapper topmenu").hide(),t.append(a);var s=(0,q.default)("<table />");s.attr({id:"topTable_"+n.ID,cellspacing:"0",cellpadding:"0"}).addClass("context-menu"),a.append(s),s.append(n.childrenList(n.option.data));for(var o=0;o<n.option.data.length;o++){var h=typeof n.option.data[o].children<"u";if(h){var l=(0,q.default)("<div />");l.attr({id:"childMenu_"+n.ID+o,"data-index":o}).addClass("context-menu-wrapper").hide(),t.append(l);var u=(0,q.default)("<table />");u.attr({id:"childTable_"+n.ID+o,cellspacing:"0",cellpadding:"0"}).addClass("context-menu"),l.append(u),u.append(n.childrenList(n.option.data[o].children))}}},this.Update=function(){var n=this;n.BindData(),n.BindEvent()},this.childrenList=function(n){for(var e=[],t=0;t<n.length;t++){var a=typeof n[t].isBorder<"u"&&n[t].isBorder,s=(0,q.default)("<tr />");s.addClass("font_Arial context-menu"),a&&s.addClass("border");var o=(0,q.default)("<td />");n[t].selected?o.addClass("spacer context-menu").html("√"):o.addClass("spacer context-menu");var h=(0,q.default)("<td />");h.addClass("text").html(n[t].text);var l=(0,q.default)("<td />");l.addClass("right shortcut");var u=(0,q.default)("<td />");u.addClass(typeof n[t].children<"u"?"submenu-arrow":"context-menu spacer"),s.append(o).append(h).append(l).append(u),e.push(s)}return e},this.Show=function(n){var e=this;q.default.extend(e.option,n),e.ID?e.Update():e.Create();var t=(0,q.default)("#topMenu_"+e.ID),a=t.outerWidth(),s=t.outerHeight(),o=e.option.x,h=e.option.y;a>e.option.position.X+e.option.position.W-o&&(o=o-a),s>e.option.position.Y+e.option.position.H-h&&(h=h-s),t.hide(),t.css({position:"absolute",left:o+"px",top:h+"px"}).show(),this.isInit=!0},this.Hide=function(){var n=this;typeof q.default>"u"||((0,q.default)("#topMenu_"+n.ID).hide(),(0,q.default)("[id^='childMenu_"+n.ID+"']").hide())},this.BindEvent=function(){var n=this,e=(0,q.default)("[id^='childMenu_"+n.ID+"']");(0,q.default)("#topTable_"+n.ID).find("tr").mouseenter(function(){var t=(0,q.default)(this),a=t.index(),s=(0,q.default)("#topMenu_"+n.ID),o=(0,q.default)("#childMenu_"+n.ID+a),h=t.outerWidth(),l=t.outerHeight(),u=s.position().left+h+1,f=s.position().top+l*a;h>n.option.position.X+n.option.position.W-u&&(u=u-h-s.outerWidth()-2),o.outerHeight()>n.option.position.Y+n.option.position.H-f&&(f=s.position().top+s.outerHeight()-o.outerHeight()),e.hide(),o.css({left:u+"px",top:f+"px"}).show()}).mouseleave(function(){var t=(0,q.default)(this).index();setTimeout(function(){(0,q.default)("#childMenu_"+n.ID+t).attr("data-isShow")!=1&&(0,q.default)("#childMenu_"+n.ID+t).hide()},10)}).click(function(){var t=(0,q.default)(this),a=t.index();q.default.type(n.option.data[a].click)=="function"&&(n.option.data[a].click(n.option.returnData),t.hide())}).contextmenu(function(){return!1}),e.mouseenter(function(){(0,q.default)(this).attr("data-isShow","1")}).mouseleave(function(){(0,q.default)(this).attr("data-isShow","0")}).contextmenu(function(){return!1}),e.find("tr").click(function(){var t=(0,q.default)(this),a=parseInt(t.closest("div").attr("data-index")),s=t.index();q.default.type(n.option.data[a].children[s].click)=="function"&&(n.option.data[a].children[s].click(n.option.windowIndex||1),e.hide())})},this.GetPeriod=function(n){var e=[{text:"日线",Value:0,click:function(){n.ChangePeriod(0)}},{text:"周线",Value:1,click:function(){n.ChangePeriod(1)}},{text:"双周线",Value:21,click:function(){n.ChangePeriod(21)}},{text:"月线",Value:2,click:function(){n.ChangePeriod(2)}},{text:"季线",Value:9,click:function(){n.ChangePeriod(9)}},{text:"半年",Value:22,click:function(){n.ChangePeriod(22)}},{text:"年线",Value:3,click:function(){n.ChangePeriod(3)}},{text:"1分",Value:4,click:function(){n.ChangePeriod(4)}},{text:"5分",Value:5,click:function(){n.ChangePeriod(5)}},{text:"15分",Value:6,click:function(){n.ChangePeriod(6)}},{text:"30分",Value:7,click:function(){n.ChangePeriod(7)}},{text:"60分",Value:8,click:function(){n.ChangePeriod(8)}},{text:"2小时",Value:11,click:function(){n.ChangePeriod(11)}},{text:"4小时",Value:12,click:function(){n.ChangePeriod(12)}},{text:"分笔",Value:10,click:function(){n.ChangePeriod(10)}},{text:"自定义周期:3分钟",Value:20003,click:function(){n.ChangePeriod(20003)}},{text:"自定义周期:35分钟",Value:20035,click:function(){n.ChangePeriod(20035)}},{text:"自定义周期:8日",Value:40008,click:function(){n.ChangePeriod(40008)}}];for(var t in e){var a=e[t];if(a.Value==n.Period){a.selected=!0;break}}return e},this.GetRight=function(n){var e=[{text:"不复权",click:function(){n.ChangeRight(0)}},{text:"前复权",click:function(){n.ChangeRight(1)}},{text:"后复权",click:function(){n.ChangeRight(2)}}];return n.Right>=0&&n.Right<e.length&&(e[n.Right].selected=!0),e},this.GetIndex=function(n){return[{text:"均线",click:function(t){n.ChangeIndex(t,"均线")}},{text:"BOLL",click:function(t){n.ChangeIndex(t,"BOLL")},isBorder:!0},{text:"MACD",click:function(t){n.ChangeIndex(t,"MACD")}},{text:"KDJ",click:function(t){n.ChangeIndex(t,"KDJ")}},{text:"VOL",click:function(t){n.ChangeIndex(t,"VOL")}},{text:"RSI",click:function(t){n.ChangeIndex(t,"RSI")}},{text:"BRAR",click:function(t){n.ChangeIndex(t,"BRAR")}},{text:"WR",click:function(t){n.ChangeIndex(t,"WR")}},{text:"BIAS",click:function(t){n.ChangeIndex(t,"BIAS")}},{text:"OBV",click:function(t){n.ChangeIndex(t,"OBV")}},{text:"DMI",click:function(t){n.ChangeIndex(t,"DMI")}},{text:"CR",click:function(t){n.ChangeIndex(t,"CR")}},{text:"PSY",click:function(t){n.ChangeIndex(t,"PSY")}},{text:"CCI",click:function(t){n.ChangeIndex(t,"CCI")}},{text:"DMA",click:function(t){n.ChangeIndex(t,"DMA")}},{text:"TRIX",click:function(t){n.ChangeIndex(t,"TRIX")}},{text:"VR",click:function(t){n.ChangeIndex(t,"VR")}},{text:"EMV",click:function(t){n.ChangeIndex(t,"EMV")}},{text:"ROC",click:function(t){n.ChangeIndex(t,"ROC")}},{text:"MIM",click:function(t){n.ChangeIndex(t,"MIM")}},{text:"FSL",click:function(t){n.ChangeIndex(t,"FSL")}}]},this.GetColorIndex=function(n){var e=[{text:"十字星",click:function(a){n.ChangeInstructionIndex("五彩K线-十字星")}},{text:"早晨之星",click:function(a){n.ChangeInstructionIndex("五彩K线-早晨之星")}},{text:"垂死十字",click:function(a){n.ChangeInstructionIndex("五彩K线-垂死十字")}},{text:"三只乌鸦",click:function(a){n.ChangeInstructionIndex("五彩K线-三只乌鸦")}},{text:"光脚阴线",click:function(a){n.ChangeInstructionIndex("五彩K线-光脚阴线")}},{text:"黄昏之星",click:function(a){n.ChangeInstructionIndex("五彩K线-黄昏之星")}}];return n.ColorIndex&&(e[e.length-1].isBorder=!0,e.push({text:"删除五彩K线",click:function(a){n.CancelInstructionIndex()}})),e},this.GetTradeIndex=function(n){var e=[{text:"BIAS",click:function(a){n.ChangeInstructionIndex("交易系统-BIAS")}},{text:"CCI",click:function(a){n.ChangeInstructionIndex("交易系统-CCI")}},{text:"DMI",click:function(a){n.ChangeInstructionIndex("交易系统-DMI")}},{text:"KD",click:function(a){n.ChangeInstructionIndex("交易系统-KD")}},{text:"BOLL",click:function(a){n.ChangeInstructionIndex("交易系统-BOLL")}},{text:"KDJ",click:function(a){n.ChangeInstructionIndex("交易系统-KDJ")}}];return n.TradeIndex&&(e[e.length-1].isBorder=!0,e.push({text:"删除专家系统",click:function(a){n.CancelInstructionIndex()}})),e},this.GetOverlay=function(n){var e=[{text:"上证指数",click:function(){n.OverlaySymbol("000001.sh")}},{text:"深证成指",click:function(){n.OverlaySymbol("399001.sz")}},{text:"中小板指",click:function(){n.OverlaySymbol("399005.sz")}},{text:"创业板指",click:function(){n.OverlaySymbol("399006.sz")}},{text:"沪深300",click:function(){n.OverlaySymbol("000300.sh")}}];for(var t in n.OverlayChartPaint){var a=n.OverlayChartPaint[t],s=a.Symbol,o=new Dt.default([["000001.sh",0],["399001.sz",1],["399005.sz",2],["399006.sz",3],["000300.sh",4]]);if(o.has(s)){var h;(function(){h=e[o.get(s)];var l=s;h.selected=!0,h.click=function(){n.DeleteOverlaySymbol(l)}})()}}return n.OverlayChartPaint&&n.OverlayChartPaint.length>0&&(e[e.length-1].isBorder=!0,e.push({text:"取消叠加",click:function(){n.ClearOverlaySymbol()}})),e},this.GetKLineType=function(n){var e=[{text:"K线(空心阳线)",click:function(){n.ChangeKLineDrawType(3)}},{text:"K线(实心阳线)",click:function(){n.ChangeKLineDrawType(0)}},{text:"美国线",click:function(){n.ChangeKLineDrawType(2,!0,{IsThinAKBar:!1})}},{text:"收盘线",click:function(){n.ChangeKLineDrawType(1)}},{text:"收盘面积",click:function(){n.ChangeKLineDrawType(4)}},{text:"K线(空心阳线阴线)",click:function(){n.ChangeKLineDrawType(6)}},{text:"Heikin Ashi",click:function(){n.ChangeKLineDrawType(11)}},{text:"Line Break",click:function(){n.ChangeKLineDrawType(12)}},{text:"High-low",click:function(){n.ChangeKLineDrawType(13)}},{text:"HLC Area",click:function(){n.ChangeKLineDrawType(15)}}];switch(n.KLineDrawType){case 0:e[1].selected=!0;break;case 1:e[3].selected=!0;break;case 2:e[2].selected=!0;break;case 3:e[0].selected=!0;break;case 4:e[4].selected=!0;break;case 6:e[5].selected=!0;break;case 11:e[6].selected=!0;break;case 12:e[7].selected=!0;break;case 13:e[8].selected=!0;break;case 15:e[9].selected=!0;break}return e},this.GetIndexWindowCount=function(n){var e=[{text:"1个窗口",click:function(){n.ChangeIndexWindowCount(1)}},{text:"2个窗口",click:function(){n.ChangeIndexWindowCount(2)}},{text:"3个窗口",click:function(){n.ChangeIndexWindowCount(3)}},{text:"4个窗口",click:function(){n.ChangeIndexWindowCount(4)}},{text:"5个窗口",click:function(){n.ChangeIndexWindowCount(5)}}],t=n.Frame.SubFrame.length;return t-1>=0&&t-1<e.length&&(e[t-1].selected=!0),e},this.GetCoordinateType=function(n){var e=[{text:"普通坐标",click:function(){n.ChangeCoordinateType({Type:0})}},{text:"百分比坐标",click:function(){n.ChangeCoordinateType({Type:1})}},{text:"反转坐标",click:function(){n.ChangeCoordinateType({IsReverse:!0})}},{text:"对数坐标",click:function(){n.ChangeCoordinateType({Type:2})}},{text:"等比坐标",click:function(){n.ChangeCoordinateType({Type:3})}},{text:"等分坐标",click:function(){n.ChangeCoordinateType({Type:4})}},{text:"黄金分割",click:function(){n.ChangeCoordinateType({Type:5})}}];return n.Frame&&n.Frame.SubFrame&&n.Frame.SubFrame.length>0&&(n.Frame.SubFrame[0].Frame.CoordinateType==1&&(e[2].selected=!0,e[2].click=function(){n.ChangeCoordinateType({IsReverse:!1})}),n.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType==1?e[1].selected=!0:n.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType==0?e[0].selected=!0:n.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType==2?e[3].selected=!0:n.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType==3?e[4].selected=!0:n.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType==4?e[5].selected=!0:n.Frame.SubFrame[0].Frame.YSplitOperator.CoordinateType==5&&(e[6].selected=!0)),e},this.GetDragModeType=function(n){var e=[{text:"禁止拖拽",click:function(){n.DragMode=0}},{text:"启动拖拽",click:function(){n.DragMode=1}},{text:"区间选择",click:function(){n.DragMode=2}}];return n.DragMode>=0&&n.DragMode<e.length&&(e[n.DragMode].selected=!0),e},this.GetTools=function(n){var e=[],t=n.GetExtendChartByClassName("DrawToolsButton");t?e.push({text:"关闭画图工具",click:function(){for(var o=t.Chart.Width,h=parseInt(t.Index),l=h+1;l<n.ExtendChartPaint.length;++l){var u=n.ExtendChartPaint[l];u.ClassName=="StockChip"&&(u.Left-=o)}n.DeleteExtendChart(t),n.Frame.ChartBorder.Right-=o,n.SetSizeChange(!0),n.Draw()}}):e.push({text:"画图工具",click:function(){var o={Name:"画图工具",Top:n.Frame.ChartBorder.Top};n.CreateExtendChart(o.Name,o),n.SetSizeChange(!0),n.Draw()}});var a=n.GetExtendChartByClassName("StockChip");return a?e.push({text:"关闭移动筹码",click:function(){for(var o=a.Chart.Width,h=parseInt(a.Index),l=h+1;l<n.ExtendChartPaint.length;++l){var u=n.ExtendChartPaint[l];u.ClassName=="DrawToolsButton"&&(u.Left-=o)}n.DeleteExtendChart(a),n.Frame.ChartBorder.Right-=o,n.SetSizeChange(!0),n.Draw()}}):e.push({text:"移动筹码",click:function(){var o={Name:"筹码分布",ShowType:1,Width:230};n.CreateExtendChart(o.Name,o),n.SetSizeChange(!0),n.Draw()}}),e},this.GetKLineInfo=function(n){var e=new Ee.default;for(var t in n.ChartInfo){var a=n.ChartInfo[t];e.add(a.ClassName)}var s=["公告","业绩预告","调研","大宗交易","龙虎榜","互动易"],o=[];for(var t in s){var h=s[t],l=La.GetClassInfo(h);if(l){var a=this.CreateKlineInfoItem(h,e.has(l.ClassName),n);o.push(a)}}if(n.ChartInfo.length>0){o[o.length-1].isBorder=!0;var a={text:"删除所有",click:function(){n.ClearKLineInfo()}};o.push(a)}return o},this.CreateKlineInfoItem=function(n,e,t){var a={text:n,selected:e};return e?a.click=function(){t.DeleteKLineInfo(n)}:a.click=function(){t.AddKLineInfo(n,!0)},a},this.DoModal=function(n){var e=n.data.Chart,t=e.RightMenu,a=n.offsetX,s=n.offsetY,o=[{text:"分析周期",children:this.GetPeriod(e)},{text:"复权处理",children:this.GetRight(e)},{text:"指标切换",children:this.GetIndex(e)},{text:"五彩K线",children:this.GetColorIndex(e)},{text:"专家系统",children:this.GetTradeIndex(e)},{text:"信息地雷",children:this.GetKLineInfo(e)},{text:"叠加品种",children:this.GetOverlay(e)},{text:"主图线型",children:this.GetKLineType(e)},{text:"坐标类型",children:this.GetCoordinateType(e)},{text:"指标窗口个数",children:this.GetIndexWindowCount(e)},{text:"鼠标拖拽",children:this.GetDragModeType(e)},{text:"工具",children:this.GetTools(e)}],h=e.Symbol.toUpperCase();(W.IsSHSZIndex(e.Symbol)||W.IsBIT(h))&&o.splice(1,1);var l=n.data.FrameID,u=this.GetOverlayIndex(e,l);if(u&&u.length>0){var f={text:"删除叠加指标",children:this.GetDeleteOverlayIndex(e,u)};o.splice(3,0,f)}X.Chart.Log("[KLineRightMenu::DoModal]",l),t.Show({windowIndex:l,x:a+e.UIElement.offsetLeft,y:s+e.UIElement.offsetTop,position:e.Frame.Position,data:o}),(0,q.default)(document).click(function(){t.Hide()})},this.GetOverlayIndex=function(n,e){if(e>=n.Frame.SubFrame.length||e<0)return[];var t=[],a=n.Frame.SubFrame[e];for(var s in a.OverlayIndex){var o=a.OverlayIndex[s];t.push({Name:o.Script.Name,Identify:o.Identify})}return t},this.GetDeleteOverlayIndex=function(n,e){var t=[],a=function(){var h=e[s].Identify;t.push({text:e[s].Name,click:function(){n.DeleteOverlayWindowsIndex(h)}})};for(var s in e)a();return t}}function hI(r){this.newMethod=ts,this.newMethod(r),delete this.newMethod,this.DoModal=function(n){var e=n.data.Chart,t=this,a=n.data.X,s=n.data.Y,o=[{text:"区间统计",click:function(){X.Chart.Log("[KLineSelectRightMenu::click] 区间统计"),t.Hide();var l=new nI(r);l.DoModal(n)}},{text:"区间放大",click:function(){X.Chart.Log("[KLineSelectRightMenu::click] 区间放大");var l=n.data.Chart;l.ShowSelectData(n.data.SelectData)}}];t.Show({x:a,y:s,position:e.Frame.Position,data:o})},this.Show=function(n){var e=this;q.default.extend(e.option,n),e.ID||e.Create();var t="topMenu_"+e.ID,a=document.getElementById(t);a||e.Create();var s=(0,q.default)("#topMenu_"+e.ID),o=s.outerWidth(),h=s.outerHeight();s.contextmenu(function(){return!1});var l=e.option.x,u=e.option.y;o>e.option.position.X+e.option.position.W-l&&(l=l-o),h>e.option.position.Y+e.option.position.H-u&&(u=u-h),s.hide(),s.css({position:"absolute",left:l+"px",top:u+"px"}).show(),(0,q.default)("#topMenu_"+e.ID).find("tr").show(),this.isInit=!0}}function lI(r){this.newMethod=ts,this.newMethod(r),delete this.newMethod,this.DoModal=function(n){var e=n.data.Chart,t=e.RightMenu,a=n.offsetX,s=n.offsetY,o=[{text:"叠加品种",children:this.GetOverlay(e)},{text:"多日分时图",children:this.GetDayCount(e)},{text:"指标窗口个数",children:this.GetIndexWindowCount(e)},{text:"副图指标切换",children:this.GetIndex(e)},{text:"区间选择",children:this.GetSelectRect(e)}],h=e.Symbol;W.IsSHSZStockA(h)&&o.push({text:"集合竞价",children:this.GetShowBeforeData(e)}),o.push({text:"工具",children:this.GetTools(e)});var f=n.data.FrameID,l=this.GetOverlayIndex(e,f);if(l&&l.length>0){var u={text:"删除叠加指标",children:this.GetDeleteOverlayIndex(e,l)};o.splice(3,0,u)}var f=n.data.FrameID;X.Chart.Log("[MinuteRightMenu::DoModal]",f),t.Show({windowIndex:f,x:a+e.UIElement.offsetLeft,y:s+e.UIElement.offsetTop,position:e.Frame.Position,data:o}),(0,q.default)(document).click(function(){t.Hide()})},this.GetDayCount=function(n){var e=[{text:"当日分时图",click:function(){n.ChangeDayCount(1)},isBorder:!0},{text:"最近2日",click:function(){n.ChangeDayCount(2)}},{text:"最近3日",click:function(){n.ChangeDayCount(3)}},{text:"最近4日",click:function(){n.ChangeDayCount(4)}},{text:"最近5日",click:function(){n.ChangeDayCount(5)}},{text:"最近6日",click:function(){n.ChangeDayCount(6)}}];return n.DayCount-1>=0&&n.DayCount-1<e.length&&(e[n.DayCount-1].selected=!0),e},this.GetIndex=function(n){var e=[{text:"MACD",click:function(a){n.ChangeIndex(a,"MACD")}},{text:"DMI",click:function(a){n.ChangeIndex(a,"DMI")}},{text:"DMA",click:function(a){n.ChangeIndex(a,"DMA")}},{text:"BRAR",click:function(a){n.ChangeIndex(a,"BRAR")}},{text:"KDJ",click:function(a){n.ChangeIndex(a,"KDJ")}},{text:"RSI",click:function(a){n.ChangeIndex(a,"RSI")}},{text:"WR",click:function(a){n.ChangeIndex(a,"WR")}},{text:"CCI",click:function(a){n.ChangeIndex(a,"CCI")}},{text:"TRIX",click:function(a){n.ChangeIndex(a,"TRIX")}}];return e},this.GetShowBeforeData=function(n){if(n.IsShowBeforeData){var e=[{text:"隐藏",click:function(){n.ShowCallAuctionData({Left:!1,MultiDay:{Left:!1}})}}];return e}else{var e=[{text:"显示",click:function(){n.ShowCallAuctionData({Left:!0,MultiDay:{Left:!0}})}}];return e}},this.GetSelectRect=function(n){if(n.EnableSelectRect){var e=[{text:"禁用区间选择",click:function(){n.EnableSelectRect=!1}}];return e}else{var e=[{text:"启动区间选择",click:function(){n.EnableSelectRect=!0}}];return e}},this.GetIndexWindowCount=function(n){var e=[{text:"1个窗口",click:function(){n.ChangeIndexWindowCount(2)}},{text:"2个窗口",click:function(){n.ChangeIndexWindowCount(3)}},{text:"3个窗口",click:function(){n.ChangeIndexWindowCount(4)}},{text:"4个窗口",click:function(){n.ChangeIndexWindowCount(5)}},{text:"5个窗口",click:function(){n.ChangeIndexWindowCount(6)}}],t=n.Frame.SubFrame.length-1;return t-1>=0&&t-1<e.length&&(e[t-1].selected=!0),e},this.GetTools=function(n){var e=[],t=n.GetExtendChartByClassName("DrawToolsButton");return t?e.push({text:"关闭画图工具",click:function(){var s=t.Chart.Width;parseInt(t.Index),n.DeleteExtendChart(t),n.Frame.ChartBorder.Right-=s,n.SetSizeChange(!0),n.Draw()}}):e.push({text:"画图工具",click:function(){var s={Name:"画图工具",Top:n.Frame.ChartBorder.Top};n.CreateExtendChart(s.Name,s),n.SetSizeChange(!0),n.Draw()}}),e}}function uI(r){this.newMethod=qa,this.newMethod(r),delete this.newMethod,this.HQChart,this.ChartPicture,this.SubToolsDiv,this.SettingMenu,this.SettingPV,this.DoModal=function(n){if(!this.SubToolsDiv){this.ID=oe();var e=document.createElement("div");e.className="subTolls",e.id=this.ID,this.DivElement.appendChild(e),this.SubToolsDiv=e}this.HQChart=n.data.HQChart,this.ChartPicture=n.data.ChartPicture;var t=V(),a=this.HQChart.Frame.SubFrame[0].Frame,s=a.ChartBorder.Top+40,o=a.ChartBorder.Right,h=a.ChartBorder.GetLeft(),l=this.ChartPicture.ClassName,u=this.ChartPicture.LineColor;(u.indexOf("rgb(")==0||u.indexOf("RGB(")==0)&&(u=It.RGBToHex(u.toLowerCase()));var f="";l==="ChartDrawPictureText"?f='<span class="changes-color" title="改变图形颜色"><i class="iconfont icon-bianji"></i><input type="color" name="color" id="color" class="change-color" value="'+u+`"></span>
<span class="subtool-set" title="设置"><i class="iconfont icon-shezhi"></i></span><span class="subtool-del"><i class="iconfont icon-recycle_bin"></i></span>`:l=="ChartDrawVolProfile"?f='<span class="vp-set" title="设置"><i class="iconfont icon-shezhi"></i></span><span class="subtool-del"><i class="iconfont icon-recycle_bin"></i></span>':f='<p class="changes-color" title="改变图形颜色"><i class="iconfont icon-bianji"></i><input type="color" name="color" id="color" class="change-color" value="'+u+`"></p>
        <p class="subtool-del"><i class="iconfont icon-recycle_bin"></i></p>`,this.SubToolsDiv.style.right=o/t+"px",this.SubToolsDiv.style.top=s/t+"px",this.SubToolsDiv.innerHTML=f,this.SubToolsDiv.style.position="absolute",this.SubToolsDiv.style.display="block";var C=this.HQChart,D=this.ChartPicture;this.SubToolsDiv,(0,q.default)(".subtool-del").click(function(){C.SelectChartDrawPicture=null,C.ClearChartDrawPicture(D),(0,q.default)(".subTolls").css("display","none")});var v=this;(0,q.default)(".subtool-set").click(function(){(0,q.default)(v.SubToolsDiv).hide(),v.SettingMenu||(v.SettingMenu=new zh(a.ChartBorder.UIElement.parentNode)),v.SettingMenu.ChartPicture=D,v.SettingMenu.HQChart=C,v.SettingMenu.Position={Left:o+80,Top:s+20},v.SettingMenu.DoModal()}),(0,q.default)(".changes-color").click(function(){document.getElementById("color").click(),(0,q.default)(".change-color").change(function(){var S=(0,q.default)(".change-color").val();D.LineColor=S,D.PointColor=S,C.ChartDrawStorage&&C.ChartDrawStorage.SaveDrawData(D)})}),(0,q.default)(".vp-set").click(function(){v.SettingPV||(v.SettingPV=new fI(a.ChartBorder.UIElement.parentNode)),v.SettingPV.ChartPicture=D,v.SettingPV.HQChart=C,v.SettingPV.Position={Left:o+80,Top:s+20},v.SettingPV.DoModal()}),X.Chart.Log("[ChartPictureSettingMenu::DoModal]",{Top:s,Left:h,Right:o})}}function zh(r){this.newMethod=qa,this.newMethod(r),delete this.newMethod,this.ChartPicture,this.SettingDiv,this.Position,this.BackupData,this.Close=function(){this.SettingDiv&&this.DivElement.removeChild(this.SettingDiv)},this.DoModal=function(){var E=this.ChartPicture.Text,n=this.ChartPicture.FontOption,e=this.ChartPicture.LineColor;this.BackupData={Text:E,LineColor:e,FontOption:{Family:n.Family,Size:n.Size,Weight:n.Weight,Style:n.Style}},X.Chart.Log("[ChartPictureTextSettingMenu::DoModal] picture info",this.BackupData);var t=this,a=this.DivElement.getElementsByClassName("chartpicture-text-setting")[0];a?this.SettingDiv=a:(a=document.createElement("div"),a.className="chartpicture-text-setting",this.DivElement.appendChild(a),this.SettingDiv=a);var s='<div class="titleWrap"><span class="titleName">样式设置</span><i class="closeBtn iconfont icon-close"></i></div>',o=[10,11,12,14,16,20,24,28,32,40],h=["微软雅黑","宋体","Arial","仿宋"],l="",u="";h.forEach(function(M,O){u+=O!==0?"<p>"+M+"</P>":'<p class="active">'+M+"</P>"}),o.forEach(function(M,O){l+=O!==5?"<p>"+M+"</P>":'<p class="active">'+M+"</P>"});var f='<div class="contentWrap"><div class="styleOptions"><span class="colorPicker"><input type="color" id="fontColor" value="#1e90ff"></span><div class="likeSelect fontSelect"><span class="choicedText">微软雅黑</span><div class="selectList">'+u+'</div><i class="iconfont icon-xia"></i></div><div class="likeSelect fontSizeSelect"><span class="choicedText">20</span><div class="selectList">'+l+'</div><i class="iconfont icon-xia"></i></div><span class="strongFont likeBtn"><i class="iconfont icon-jiacu"></i></span><span class="italicsFont likeBtn"><i class="iconfont icon-qingxieL"></i></span></div><textarea class="tArea" id="tArea" placeholder="Text"></textarea></div>',C='<div class="btnsContainer"><span class="okBtn btn">确认</span><span class="cancelBtn btn">取消</span></div>',D=V(),v=s+f+C;this.SettingDiv.style.left=this.Position.Left/D+"px",this.SettingDiv.style.top=this.Position.Top/D+"px",this.SettingDiv.innerHTML=v,this.SettingDiv.style.position="absolute",this.SettingDiv.style.display="block",(0,q.default)(".chartpicture-text-setting .colorPicker").css({borderColor:t.ChartPicture.LineColor,"background-color":t.ChartPicture.LineColor});var S=this.ChartPicture.FontOption.Family;(0,q.default)(".chartpicture-text-setting .fontSelect .choicedText").html(S),h.forEach(function(M,O){M==S&&((0,q.default)(".chartpicture-text-setting .fontSelect p").removeClass("active"),(0,q.default)(".chartpicture-text-setting .fontSelect p").eq(O).addClass("active"))});var T=this.ChartPicture.FontOption.Size;(0,q.default)(".chartpicture-text-setting .fontSizeSelect .choicedText").html(T),o.forEach(function(M,O){M==T&&((0,q.default)(".chartpicture-text-setting .fontSizeSelect p").removeClass("active"),(0,q.default)(".chartpicture-text-setting .fontSizeSelect p").eq(O).addClass("active"))});var I=this.ChartPicture.FontOption.Weight;I!=null&&I=="bold"&&(0,q.default)(".chartpicture-text-setting .strongFont").addClass("hot");var F=this.ChartPicture.FontOption.Style;F!=null&&F=="italic"&&(0,q.default)(".chartpicture-text-setting .italicsFont").addClass("hot");var E=this.ChartPicture.Text;(0,q.default)(".chartpicture-text-setting .tArea").val(E),(0,q.default)(".chartpicture-text-setting #fontColor").change({Picture:this.ChartPicture},function(M){var O=(0,q.default)(this).val();(0,q.default)(this).parent().css({borderColor:O,"background-color":O});var R=M.data.Picture;R.LineColor=O,R.Update&&R.Update()}),(0,q.default)(".chartpicture-text-setting .fontSelect,.chartpicture-text-setting .fontSizeSelect").click(function(){(0,q.default)(this).find(".selectList").toggle(),(0,q.default)(this).toggleClass("hot")}),(0,q.default)(".chartpicture-text-setting .fontSelect p").click({Picture:this.ChartPicture},function(M){var O=(0,q.default)(this).closest(".fontSelect").find(".choicedText").html(),R=M.currentTarget.innerHTML;if(O!==R){(0,q.default)(this).closest(".fontSelect").find(".choicedText").html(R),(0,q.default)(this).siblings().removeClass("active"),(0,q.default)(this).addClass("active");var b=M.data.Picture;b.FontOption.Family=R,b.Update&&b.Update()}}),(0,q.default)(".chartpicture-text-setting .fontSizeSelect p").click({Picture:this.ChartPicture},function(M){var O=(0,q.default)(this).closest(".fontSizeSelect").find(".choicedText").html(),R=M.currentTarget.innerHTML;if(O!==R){(0,q.default)(this).closest(".fontSizeSelect").find(".choicedText").html(R),(0,q.default)(this).siblings().removeClass("active"),(0,q.default)(this).addClass("active");var b=M.data.Picture;b.FontOption.Size=Number(R),b.Update&&b.Update()}}),(0,q.default)(".chartpicture-text-setting .strongFont").click({Picture:this.ChartPicture},function(M){(0,q.default)(this).toggleClass("hot");var O=(0,q.default)(this).attr("class");if(O.indexOf("hot")>0){var R=M.data.Picture;R.FontOption.Weight="bold",R.Update&&R.Update()}}),(0,q.default)(".chartpicture-text-setting .italicsFont").click({Picture:this.ChartPicture},function(M){(0,q.default)(this).toggleClass("hot");var O=(0,q.default)(this).attr("class");if(O.indexOf("hot")>0){var R=M.data.Picture;R.FontOption.Style="italic",R.Update&&R.Update()}}),(0,q.default)(".chartpicture-text-setting .titleWrap .closeBtn,.chartpicture-text-setting .btnsContainer .cancelBtn").click({Picture:this.ChartPicture},function(M){var O=M.data.Picture;O.Text=t.BackupData.Text,O.LineColor=t.BackupData.LineColor,O.FontOption=t.BackupData.FontOption,O.Update&&O.Update(),t.Close()}),(0,q.default)(".chartpicture-text-setting .tArea").keyup({Picture:this.ChartPicture},function(M){X.Chart.Log('[ChartPictureTextSettingMenu::DoModal] $(".chartpicture-text-setting .tArea").keyup()');var O=(0,q.default)(this).val(),R=M.data.Picture;R.Text=O,R.Update&&R.Update()}),(0,q.default)(".chartpicture-text-setting .btnsContainer .okBtn").click(function(){t.Close(),t.HQChart&&t.HQChart.ChartDrawStorage&&t.HQChart.ChartDrawStorage.SaveDrawData(t.ChartPicture)})}}function fI(r){this.newMethod=qa,this.newMethod(r),delete this.newMethod,this.ChartPicture,this.SettingDiv,this.Position,this.ID=oe(),this.Close=function(){this.SettingDiv&&this.DivElement.removeChild(this.SettingDiv)},this.DoModal=function(){var n=this.ChartPicture.VAVol,e=this.ChartPicture.BarPosition,t=this,a=document.getElementById(this.ID);a?this.SettingDiv=a:(a=document.createElement("div"),a.className="jchart-modifyindex-box",a.id=this.ID,this.DivElement.appendChild(a),this.SettingDiv=a),a.innerHTML=`<div class='parameter'>            <div class='parameter-header'>                <span>固定范围成交量分布设置</span>                <strong id='close' class='icon iconfont icon-close'></strong>            </div>            <div class='parameter-content'>
                <input class='row-line' value=`+n+` />VAVol <br>
                <input class='row-line' value=`+e+` />BarPosition
            </div>            <div class='parameter-footer'>                <button class='submit' >确定</button>                <button class='cancel' >取消</button>            </div>        </div>`;var s=V(),o=this.HQChart.Frame.SubFrame[0].Frame,h=o.ChartBorder.Top+40,l=o.ChartBorder.Right;o.ChartBorder.GetLeft(),this.SettingDiv.style.right=l/s+"px",this.SettingDiv.style.top=h/s+"px",this.SettingDiv.style.position="absolute",this.SettingDiv.style.display="block";var u=a.getElementsByClassName("cancel")[0];u.onclick=function(){t.Close()};var f=a.getElementsByClassName("icon iconfont icon-close")[0];f.onclick=function(){t.Close()};var C=a.getElementsByClassName("submit")[0];C.onclick=function(){var D=a.getElementsByClassName("row-line")[0].value;t.ChartPicture.VAVol=parseFloat(D);var D=parseInt(a.getElementsByClassName("row-line")[1].value);t.ChartPicture.BarPosition=D>0?1:0,t.ChartPicture.RequestVolumeProfileData(),t.Close()}}}var W={SH:".SH",SZ:".SZ",SHSZ_C_Index:".CI",BJ:".BJ",SHO:".SHO",SZO:".SZO",HK:".HK",FHK:".FHK",SHFE:".SHF",SHFE2:".SHFE",CFFEX:".CFE",DCE:".DCE",CZCE:".CZC",GZFE:".GZFE",USA:".USA",FTSE:".FTSE",BIT:".BIT",BIZ:".BIZ",FOREX:".FOREX",NYMEX:".NYMEX",COMEX:".COMEX",NYBOT:".NYBOT",CBOT:".CBOT",LME:".LME",TOCOM:".TOCOM",IPE:".IPE",TW:".TW",JP:".JP",HSX:".HSX",HNX:".HNX",UPCOM:".UPCOM",ET:".ET",IsET:function(n){return n?n.indexOf(this.ET)>0:!1},IsETShowAvPrice:function(n){return!1},IsHSX:function(n){return n?n.indexOf(this.HSX)>0:!1},IsHNX:function(n){return n?n.indexOf(this.HNX)>0:!1},IsUPCOM:function(n){return n?n.indexOf(this.UPCOM)>0:!1},IsNYMEX:function(n){return n?n.indexOf(this.NYMEX)>0:!1},IsCOMEX:function(n){return n?n.indexOf(this.COMEX)>0:!1},IsNYBOT:function(n){return n?n.indexOf(this.NYBOT)>0:!1},IsCBOT:function(n){return n?n.indexOf(this.CBOT)>0:!1},IsLME:function(n){return n?n.indexOf(this.LME)>0:!1},IsTOCOM:function(n){return n?n.indexOf(this.TOCOM)>0:!1},IsIPE:function(n){return n?n.indexOf(this.IPE)>0:!1},IsForeignExchange:function(n){return n?n.indexOf(this.FOREX)>0:!1},IsFTSE:function(n){return n?n.indexOf(this.FTSE)>0:!1},IsFHK:function(n){return n?n.indexOf(this.FHK)>0:!1},IsBIT:function(n){return n?n.indexOf(this.BIT)>0||n.indexOf(this.BIZ)>0:!1},IsUSA:function(n){return n?n.indexOf(this.USA)>0:!1},IsSH:function(n){var e=n.length-this.SH.length,t=n.indexOf(this.SH);return t==e},IsSZ:function(n){var e=n.length-this.SZ.length,t=n.indexOf(this.SZ);return t==e},IsBJ:function(n){var e=n.length-this.BJ.length,t=n.indexOf(this.BJ);return t==e},IsSHSZCustomIndex:function(n){var e=n.length-this.SHSZ_C_Index.length,t=n.indexOf(this.SHSZ_C_Index);return t==e},IsSHO:function(n){var e=n.length-this.SHO.length,t=n.indexOf(this.SHO);return t==e},IsSZO:function(n){var e=n.length-this.SZO.length,t=n.indexOf(this.SZO);return t==e},IsHK:function(n){var e=n.length-this.HK.length,t=n.indexOf(this.HK);return t==e},IsTW:function(n){var e=n.length-this.TW.length,t=n.indexOf(this.TW);return t==e},IsJP:function(n){var e=n.length-this.JP.length,t=n.indexOf(this.JP);return t==e},IsSHFE:function(n){return n?n.indexOf(this.SHFE)>0||n.indexOf(this.SHFE2)>0:!1},IsCFFEX:function(n){return n?n.indexOf(this.CFFEX)>0:!1},IsDCE:function(n){return n?n.indexOf(this.DCE)>0:!1},IsCZCE:function(n){return n?n.indexOf(this.CZCE)>0:!1},IsGZFE:function(n){return n?n.indexOf(this.GZFE)>0:!1},IsChinaFutures:function(n){return this.IsSHO(n)||this.IsSZO(n)||this.IsGZFE(n)||this.IsCFFEX(n)||this.IsCZCE(n)||this.IsDCE(n)||this.IsSHFE(n)},IsFutures:function(n){return this.IsChinaFutures(n)||this.IsNYMEX(n)||this.IsCOMEX(n)||this.IsNYBOT(n)||this.IsCBOT(n)||this.IsLME(n)||this.IsTOCOM(n)},IsSHSZ:function(n){return this.IsSZ(n)||this.IsSH(n)||this.IsSHSZCustomIndex(n)},IsSHSZFund:function(n){if(!n)return!1;if(this.IsSH(n)){if(n.charAt(0)=="5"&&n.charAt(1)=="1")return!0}else if(this.IsSZ(n)&&n.charAt(0)=="1"&&(n.charAt(1)=="5"||n.charAt(1)=="6"||n.charAt(1)=="7"||n.charAt(1)=="8"))return!0;return!1},IsSHSZIndex:function(n){if(!n)return!1;var e=n.toUpperCase();if(this.IsSH(e)){var t=e.replace(".SH","");if(e.charAt(0)=="0"&&parseInt(t)<=3e3)return!0}else if(this.IsSZ(e)){if(e.charAt(0)=="3"&&e.charAt(1)=="9")return!0}else if(this.IsSHSZCustomIndex(e))return!0;return!1},IsSHSZStockA:function(n){if(!n)return!1;var e=n.toUpperCase();if(this.IsSH(e)){if(e.replace(".SH",""),e.charAt(0)=="6")return!0}else if(this.IsSZ(e)){if(e.charAt(0)=="0"){if(e.charAt(1)=="0"&&e.charAt(2)=="2"||e.charAt(1)!="7"&&e.charAt(1)!="8")return!0}else if(e.charAt(0)=="3"&&e.charAt(1)=="0"&&(e.charAt(2)=="0"||e.charAt(2)=="1"))return!0}return!1},IsBJStock:function(n){if(!n)return!1;var e=n.toUpperCase();if(!this.IsBJ(e))return!1;var t=e.charAt(0);return t=="4"||t=="8"},IsSHStockSTAR:function(n){if(!n)return!1;var e=n.toUpperCase();return this.IsSH(e)?e.charAt(0)=="6"&&e.charAt(1)=="8"&&e.charAt(2)=="8":!1},GetMarketStatus:function(n){if(!n)return 0;var e=n.toUpperCase(),t=new Date,a=t.getDay(),s=t.getHours()*100+t.getMinutes();if(this.IsUSA(e)){var o=Qh(-4),a=o.getDay(),s=o.getHours()*100+o.getMinutes();return a==6||a==0?0:s>1730?3:s<930?1:2}else return this.IsBIT(e)||this.IsForeignExchange(e)?2:this.IsFTSE(e)?a==6||a==0?0:s>=830&&s<=2359||s>=0&&s<=500?2:0:this.IsFHK(e)?a==6||a==0?0:s>=900&&s<=2359||s>=0&&s<=320?2:0:this.IsET(e)?this.GetETMarketStatus(n):this.IsHK(e)?a==6||a==0?0:s>1630?3:s<925?1:2:this.IsTW(e)?a==6||a==0?0:s>1410?3:s<820?1:2:this.IsJP(e)?a==6||a==0?0:s>1520?3:s<830?1:2:this.IsNYMEX(e)?this.GetNYMEXMarketStatus(e):this.IsCOMEX(e)?this.GetCOMEXMarketStatus(e):this.IsNYBOT(e)?this.GetNYBOTMarketStatus(e):this.IsCBOT(e)?this.GetCBOTMarketStatus(e):this.IsLME(e)?this.GetLMEMarketStatus(e):this.IsTOCOM(e)?this.GetTOCOMMarketStatus(e):this.IsChinaFutures(e)?a==6||a==0?0:this.IsCFFEX(e)?s>1540?3:s<910?1:2:s>=2100||s<=240||s>=830&&s<=1510?2:1:a==6||a==0?0:s>1540?3:s<910?1:2},GetLimitPriceRange:function(n,e){return this.IsSHSZStockA(n)?this.IsSHStockSTAR(n)?{Max:.2,Min:-.2}:e?e.indexOf("ST")>=0?{Max:.05,Min:-.05}:{Max:.1,Min:-.1}:null:null},GetDefaultDecimal:function(n){return 2},GetFHKDecimal:function(n){return 0},GetFTSEDecimal:function(n){return 0},GetBITDecimal:function(n){return 2},GetSHODecimal:function(n){return 4},GetETDecimal:function(n){return 2},GetHKDecimal:function(n){return 2},GetTWDecimal:function(n){return 2},GetJPDecimal:function(n){return 2},GetHSXDecimal:function(n){return 2},GetHNXDecimal:function(n){return 2},GetUPCOMDecimal:function(n){return 2},GetForeignExchangeDecimal:function(n){return 4},GetNYMEXDecimal:function(n){return Ki.GetDecimal(n)},GetCOMEXDecimal:function(n){return Ji.GetDecimal(n)},GetNYBOTDecimal:function(n){return zi.GetDecimal(n)},GetCBOTDecimal:function(n){return Zi.GetDecimal(n)},GetLMEDecimal:function(n){return Fr.GetDecimal(n)},GetTOCOMDecimal:function(n){return Er.GetDecimal(n)},GetIPEDecimal:function(n){return xr.GetDecimal(n)},GetETMarketStatus:function(n){return 2},GetNYMEXMarketStatus:function(n){return Ki.GetMarketStatus(n)},GetCOMEXMarketStatus:function(n){return Ji.GetMarketStatus(n)},GetNYBOTMarketStatus:function(n){return zi.GetMarketStatus(n)},GetCBOTMarketStatus:function(n){return Zi.GetMarketStatus(n)},GetLMEMarketStatus:function(n){return Fr.GetMarketStatus(n)},GetTOCOMMarketStatus:function(n){return Er.GetMarketStatus(n)},GetIPEMarketStatus:function(n){return xr.GetMarketStatus(n)},IsShowMinuteVolTitle:function(n){return n&&n.toUpperCase(),!1},IsShowMinutePostionLine:function(n){return!!(W.IsFutures(n)||W.IsSHO(n)||W.IsSZO(n))},IsShowMinuteColorVolBar:function(n){return!!m.Minute.VolBarColor},IsEnableRight:function(n,e,t){return!W.IsSHSZStockA(e)&&!W.IsBJStock(e)||k.IsTickPeriod(n)?!1:c.IsPlusNumber(t)?!0:!k.IsMinutePeriod(n,!0)}};function CI(){this.SHSZ=null,this.BJ=null,this.SHO=null,this.HK=null,this.Futures=new Dt.default,this.USA=null,this.FTSE=null,this.FHK=null,this.ForeEx=null,this.BIT=null,this.TW=null,this.JP=null,this.HSX=null,this.HNX=null,this.UPCOM=null,this.Initialize=function(){},this.GetET=function(r){throw{Name:"MinuteTimeStringData::GetET",Error:"not implement"}},this.GetSHSZ=function(r){return this.SHSZ||(this.SHSZ=this.CreateSHSZData()),this.SHSZ},this.GetBJ=function(r){return this.BJ||(this.BJ=this.CreateBJData()),this.BJ},this.GetSHO=function(){return this.SHO||(this.SHO=this.CreateSHOData()),this.SHO},this.GetHK=function(r){return this.HK||(this.HK=this.CreateHKData()),this.HK},this.GetTW=function(r){return this.TW&&(this.TW=this.CreateTWData()),this.TW},this.GetJP=function(r){return this.JP&&(this.JP=this.CreateJPData()),this.JP},this.GetHSX=function(r){return this.HSX&&(this.HSX=this.CreateHSXData()),this.HSX},this.GetHNX=function(r){return this.HNX&&(this.HSX=this.CreateHNXData()),this.HNX},this.GetUPCOM=function(r){return this.UPCOM&&(this.UPCOM=this.CreateUPCOMData()),this.UPCOM},this.GetFutures=function(r){if(!this.Futures.has(r.Name)){var n=this.CreateTimeData(r.Data);this.Futures.set(r.Name,n)}return this.Futures.get(r.Name)},this.GetUSA=function(){return this.USA||(this.USA=this.CreateUSAData(0)),this.USA},this.GetFTSE=function(){return this.FTSE||(this.FTSE=this.CreateFTSEData()),this.FTSE},this.GetFHK=function(){return this.FHK||(this.FHK=this.CreateFHKData()),this.FHK},this.GetForeignExchange=function(r){return this.ForeEx||(this.ForeEx=this.CreateForeignExchangeData()),this.ForeEx},this.GetBIT=function(r){return this.BIT||(this.BIT=this.CreateBITData()),this.BIT},this.CreateSHSZData=function(){var r=[{Start:925,End:925},{Start:930,End:1130},{Start:1300,End:1500}];return this.CreateTimeData(r)},this.CreateBJData=function(){var r=[{Start:925,End:925},{Start:930,End:1130},{Start:1300,End:1500}];return this.CreateTimeData(r)},this.CreateSHOData=function(){var r=[{Start:930,End:1129},{Start:1300,End:1500}];return this.CreateTimeData(r)},this.CreateHKData=function(){var r=[{Start:930,End:1200},{Start:1300,End:1600}];return this.CreateTimeData(r)},this.CreateTWData=function(){var r=[{Start:900,End:1330}];return this.CreateTimeData(r)},this.CreateJPData=function(){var r=[{Start:900,End:1130},{Start:1230,End:1500}];return this.CreateTimeData(r)},this.CreateFTSEData=function(){var r=[{Start:1700,End:2359},{Start:0,End:445},{Start:900,End:1630}];return this.CreateTimeData(r)},this.CreateFHKData=function(){var r=[{Start:1715,End:2359},{Start:0,End:300},{Start:915,End:1200},{Start:1300,End:1630}];return this.CreateTimeData(r)},this.CreateHSXData=function(){throw{Name:"MinuteTimeStringData::CreateHSXData",Error:"not implement"}},this.CreateHNXData=function(){throw{Name:"MinuteTimeStringData::CreateHNXData",Error:"not implement"}},this.CreateUPCOMData=function(){throw{Name:"MinuteTimeStringData::CreateUPCOMData",Error:"not implement"}},this.CreateUSAData=function(r){if(r==1){var n=[{Start:2130,End:2359},{Start:0,End:400}];return this.CreateTimeData(n)}else if(r==2){var e=[{Start:2230,End:2359},{Start:0,End:500}];return this.CreateTimeData(e)}else{var t=[{Start:930,End:1600}];return this.CreateTimeData(t)}},this.CreateForeignExchangeData=function(){var r=[{Start:600,End:2359},{Start:0,End:559}];return this.CreateTimeData(r)},this.CreateBITData=function(){var r=[{Start:600,End:2359},{Start:0,End:559}];return this.CreateTimeData(r)},this.CreateTimeData=function(r){var n=[];for(var e in r)for(var t=r[e],a=t.Start;a<=t.End;++a)a%100>=60||n.push(a);return n},this.GetTimeData=function(r){if(!r)return this.SHSZ;var n=r.toLocaleUpperCase();if(W.IsSH(n)||W.IsSZ(n))return this.GetSHSZ(n);if(W.IsBJ(n))return this.GetBJ(n);if(W.IsSHO(n)||W.IsSZO(n))return this.GetSHO();if(W.IsHK(n))return this.GetHK(n);if(W.IsTW(n))return this.GetTW(n);if(W.IsJP(n))return this.GetJP(n);if(W.IsUSA(n))return this.GetUSA(!0);if(W.IsCFFEX(n)||W.IsCZCE(n)||W.IsDCE(n)||W.IsSHFE(n)||W.IsGZFE(n)){var e=Tn.GetSplitData(n);return e?this.GetFutures(e):null}if(W.IsFTSE(n))return this.GetFTSE();if(W.IsFHK(n))return this.GetFHK();if(W.IsForeignExchange(n))return this.GetForeignExchange(n);if(W.IsET(n))return this.GetET(n);if(W.IsBIT(n))return this.GetBIT(n);if(W.IsHSX(n))return this.GetHSX(n);if(W.IsHNX(n))return this.GetHNX(n);if(W.IsUPCOM(n))return this.GetUPCOM(n);if(W.IsNYMEX(n)){var e=Ki.GetSplitData(n);return e?this.GetFutures(e):null}if(W.IsCOMEX(n)){var e=Ji.GetSplitData(n);return e?this.GetFutures(e):null}if(W.IsNYBOT(n)){var e=zi.GetSplitData(n);return e?this.GetFutures(e):null}if(W.IsCBOT(n)){var e=Zi.GetSplitData(n);return e?this.GetFutures(e):null}if(W.IsLME(n)){var e=Fr.GetSplitData(n);return e?this.GetFutures(e):null}if(W.IsTOCOM(n)){var e=Er.GetSplitData(n);return e?this.GetFutures(e):null}if(W.IsIPE(n)){var e=xr.GetSplitData(n);return e?this.GetFutures(e):null}}}function DI(){var r={Full:[[0,0,"rgb(200,200,200)","09:30"],[31,0,"RGB(200,200,200)","10:00"],[61,0,"RGB(200,200,200)","10:30"],[91,0,"RGB(200,200,200)","11:00"],[122,1,"RGB(200,200,200)","13:00"],[152,0,"RGB(200,200,200)","13:30"],[182,0,"RGB(200,200,200)","14:00"],[212,0,"RGB(200,200,200)","14:30"],[242,1,"RGB(200,200,200)","15:00"]],Simple:[[0,0,"rgb(200,200,200)","09:30"],[61,0,"RGB(200,200,200)","10:30"],[122,1,"RGB(200,200,200)","13:00"],[182,0,"RGB(200,200,200)","14:00"],[242,1,"RGB(200,200,200)","15:00"]],Min:[[0,0,"rgb(200,200,200)","09:30"],[122,1,"RGB(200,200,200)","13:00"],[242,1,"RGB(200,200,200)","15:00"]],Count:243,MiddleCount:122,GetData:function(u){return u<200?this.Min:u<400?this.Simple:this.Full}},n={Full:[[0,0,"rgb(200,200,200)","09:30"],[30,0,"RGB(200,200,200)","10:00"],[60,0,"RGB(200,200,200)","10:30"],[90,0,"RGB(200,200,200)","11:00"],[120,1,"RGB(200,200,200)","13:00"],[150,0,"RGB(200,200,200)","13:30"],[180,0,"RGB(200,200,200)","14:00"],[210,0,"RGB(200,200,200)","14:30"],[240,1,"RGB(200,200,200)","15:00"]],Simple:[[0,0,"rgb(200,200,200)","09:30"],[60,0,"RGB(200,200,200)","10:30"],[120,1,"RGB(200,200,200)","13:00"],[180,0,"RGB(200,200,200)","14:00"],[240,1,"RGB(200,200,200)","15:00"]],Min:[[0,0,"rgb(200,200,200)","09:30"],[120,1,"RGB(200,200,200)","13:00"],[240,1,"RGB(200,200,200)","15:00"]],Count:241,MiddleCount:120,GetData:function(u){return u<200?this.Min:u<400?this.Simple:this.Full}},e={Full:[[0,1,"RGB(200,200,200)","09:30"],[30,0,"RGB(200,200,200)","10:00"],[60,1,"RGB(200,200,200)","10:30"],[90,0,"RGB(200,200,200)","11:00"],[120,1,"RGB(200,200,200)","11:30"],[151,0,"RGB(200,200,200)","13:00"],[181,1,"RGB(200,200,200)","13:30"],[211,0,"RGB(200,200,200)","14:00"],[241,1,"RGB(200,200,200)","14:30"],[271,0,"RGB(200,200,200)","15:00"],[301,1,"RGB(200,200,200)","15:30"],[331,1,"RGB(200,200,200)","16:00"]],Simple:[[0,1,"RGB(200,200,200)","09:30"],[60,1,"RGB(200,200,200)","10:30"],[120,1,"RGB(200,200,200)","11:30"],[211,0,"RGB(200,200,200)","14:00"],[271,0,"RGB(200,200,200)","15:00"],[331,1,"RGB(200,200,200)","16:00"]],Min:[[0,1,"RGB(200,200,200)","09:30"],[151,0,"RGB(200,200,200)","13:00"],[331,1,"RGB(200,200,200)","16:00"]],Count:332,MiddleCount:151,GetData:function(u){return u<200?this.Min:u<450?this.Simple:this.Full}},t={Full:[[0,0,"rgb(200,200,200)","9:30"],[30,0,"RGB(200,200,200)","10:00"],[90,1,"RGB(200,200,200)","11:00"],[150,0,"RGB(200,200,200)","12:00"],[210,0,"RGB(200,200,200)","13:00"],[270,0,"RGB(200,200,200)","14:00"],[330,0,"RGB(200,200,200)","15:00"],[390,0,"RGB(200,200,200)","16:00"]],Simple:[[30,0,"rgb(200,200,200)","10:00"],[150,1,"RGB(200,200,200)","12:00"],[270,0,"RGB(200,200,200)","14:00"],[390,0,"RGB(200,200,200)","16:00"]],Min:[[30,0,"rgb(200,200,200)","10:00"],[210,1,"RGB(200,200,200)","13:00"],[390,0,"RGB(200,200,200)","16:00"]],Count:391,MiddleCount:211,GetData:function(u){return u<200?this.Min:u<400?this.Simple:this.Full}},a={Full:[[0,1,"RGB(200,200,200)","17:00"],[120,1,"RGB(200,200,200)","19:00"],[240,1,"RGB(200,200,200)","21:00"],[360,1,"RGB(200,200,200)","23:00"],[480,1,"RGB(200,200,200)","01:00"],[600,1,"RGB(200,200,200)","03:00"],[706,1,"RGB(200,200,200)","09:00"],[826,1,"RGB(200,200,200)","11:00"],[946,1,"RGB(200,200,200)","13:00"],[1066,1,"RGB(200,200,200)","15:00"],[1156,1,"RGB(200,200,200)","16:30"]],Simple:[[0,1,"RGB(200,200,200)","17:00"],[240,1,"RGB(200,200,200)","21:00"],[480,1,"RGB(200,200,200)","01:00"],[706,1,"RGB(200,200,200)","09:00"],[946,1,"RGB(200,200,200)","13:00"],[1156,1,"RGB(200,200,200)","16:30"]],Min:[[0,1,"RGB(200,200,200)","17:00"],[706,1,"RGB(200,200,200)","09:00"],[1156,1,"RGB(200,200,200)","16:30"]],Count:1157,MiddleCount:707,GetData:function(u){return u<200?this.Min:u<450?this.Simple:this.Full}},s={Full:[[0,1,"RGB(200,200,200)","17:15"],[105,1,"RGB(200,200,200)","19:00"],[225,1,"RGB(200,200,200)","21:00"],[345,1,"RGB(200,200,200)","23:00"],[586,0,"RGB(200,200,200)","09:15"],[691,1,"RGB(200,200,200)","11:00"],[812,1,"RGB(200,200,200)","14:00"],[963,1,"RGB(200,200,200)","16:30"]],Simple:[[0,1,"RGB(200,200,200)","17:15"],[225,1,"RGB(200,200,200)","21:00"],[586,0,"RGB(200,200,200)","09:15"],[752,1,"RGB(200,200,200)","13:00"],[963,1,"RGB(200,200,200)","16:30"]],Min:[[0,1,"RGB(200,200,200)","17:15"],[586,0,"RGB(200,200,200)","09:15"],[963,1,"RGB(200,200,200)","16:30"]],Count:963,MiddleCount:526,GetData:function(u){return u<200?this.Min:u<450?this.Simple:this.Full}},o={Full:[[0,1,"RGB(200,200,200)","06:00"],[120,1,"RGB(200,200,200)","08:00"],[240,1,"RGB(200,200,200)","10:00"],[360,1,"RGB(200,200,200)","12:00"],[480,0,"RGB(200,200,200)","14:00"],[600,1,"RGB(200,200,200)","16:00"],[720,1,"RGB(200,200,200)","18:00"],[840,1,"RGB(200,200,200)","20:00"],[960,1,"RGB(200,200,200)","22:00"],[1080,1,"RGB(200,200,200)","0:00"],[1200,1,"RGB(200,200,200)","02:00"],[1320,1,"RGB(200,200,200)","04:00"]],Simple:[[0,1,"RGB(200,200,200)","06:00"],[240,1,"RGB(200,200,200)","10:00"],[480,0,"RGB(200,200,200)","14:00"],[720,1,"RGB(200,200,200)","18:00"],[960,1,"RGB(200,200,200)","22:00"],[1200,1,"RGB(200,200,200)","02:00"]],Min:[[0,1,"RGB(200,200,200)","06:00"],[480,0,"RGB(200,200,200)","14:00"],[960,1,"RGB(200,200,200)","22:00"]],Count:1440,MiddleCount:600,GetData:function(u){return u<200?this.Min:u<450?this.Simple:this.Full}},h={Full:[[0,1,"RGB(200,200,200)","09:00"],[30,0,"RGB(200,200,200)","09:30"],[60,1,"RGB(200,200,200)","10:00"],[90,0,"RGB(200,200,200)","10:30"],[120,1,"RGB(200,200,200)","11:00"],[150,0,"RGB(200,200,200)","11:30"],[180,1,"RGB(200,200,200)","12:00"],[210,0,"RGB(200,200,200)","12:30"],[240,1,"RGB(200,200,200)","13:00"],[270,0,"RGB(200,200,200)","13:30"]],Simple:[[0,1,"RGB(200,200,200)","09:00"],[60,1,"RGB(200,200,200)","10:00"],[120,1,"RGB(200,200,200)","11:00"],[180,1,"RGB(200,200,200)","12:00"],[270,0,"RGB(200,200,200)","13:30"]],Min:[[0,1,"RGB(200,200,200)","09:00"],[60,1,"RGB(200,200,200)","11:00"],[270,0,"RGB(200,200,200)","13:30"]],Count:271,MiddleCount:151,GetData:function(u){return u<200?this.Min:u<450?this.Simple:this.Full}};this.GetCoordinateData=function(l,u){var f=null;if(!l)f=r;else{var C=l.toLocaleUpperCase();if(W.IsSH(C)||W.IsSZ(C)||W.IsSHSZIndex(C))f=this.GetSHSZData(C,u);else if(W.IsBJ(C))f=this.GetBJData(C,u);else if(W.IsSHO(C)||W.IsSZO(C))f=this.GetSHOData(C,u);else if(W.IsHK(C))f=this.GetHKData(C,u);else if(W.IsTW(C))f=this.GetTWData(C,u);else if(W.IsJP(C))f=this.GetJPData(C,u);else{if(W.IsCFFEX(C)||W.IsCZCE(C)||W.IsDCE(C)||W.IsSHFE(C)||W.IsGZFE(C))return this.GetChinatFuturesData(C,u);if(W.IsUSA(C))f=this.GetUSAData(C,u);else if(W.IsFTSE(C))f=this.GetFTSEData(C,u);else if(W.IsFHK(C))f=this.GetFHKData(C,u);else if(W.IsForeignExchange(C))f=this.GetForeignExchangeData(C);else if(W.IsBIT(C,u))f=this.GetBITData(C,u);else if(W.IsET(C))f=this.GetETData(C,u);else{if(W.IsNYMEX(C))return f=this.GetNYMEXData(C,u);if(W.IsCOMEX(C))return f=this.GetCOMEXData(C,u);if(W.IsNYBOT(C))return f=this.GetNYBOTData(C,u);if(W.IsCBOT(C))return f=this.GetCBOTData(C,u);if(W.IsLME(C))return f=this.GetLMEData(C,u);if(W.IsTOCOM(C))return f=this.GetTOCOMData(C,u);if(W.IsIPE(C))return f=this.GetIPEData(C,u);if(W.IsHSX(C))return f=this.GetHSXData(C,u);if(W.IsHNX(C))return f=this.GetHNXData(C,u);if(W.IsUPCOM(C))return f=this.GetUPCOMData(C,u)}}}var D={Count:f.Count,MiddleCount:f.MiddleCount,Data:f.GetData(u)};return D},this.GetSHSZData=function(l,u){var f=r;return f},this.GetBJData=function(l,u){var f=r;return f},this.GetUSAData=function(l,u){var f=t;return f},this.GetHKData=function(l,u){var f=e;return f},this.GetTWData=function(l,u){return h},this.GetSHOData=function(l,u){var f=n;return f},this.GetFuturesData=function(l,u,f){var C=f.GetSplitData(l);if(!C)return null;var D=yr.GetFutures(C);if(!D)return null;var v={Count:D.length},S=null,T=200,I=480;u<T?S=C.Coordinate.Min:u<I?S=C.Coordinate.Simple:S=C.Coordinate.Full;for(var F=[],E=0;E<D.length;++E)for(var M=D[E],O=0;O<S.length;++O){var R=S[O];if(M==R.Value){var b=[E,0,"RGB(200,200,200)",R.Text];F.push(b);break}}return v.Data=F,v},this.GetChinatFuturesData=function(l,u){return this.GetFuturesData(l,u,Tn)},this.GetNYMEXData=function(l,u){return this.GetFuturesData(l,u,Ki)},this.GetCOMEXData=function(l,u){return this.GetFuturesData(l,u,Ji)},this.GetNYBOTData=function(l,u){return this.GetFuturesData(l,u,zi)},this.GetCBOTData=function(l,u){return this.GetFuturesData(l,u,Zi)},this.GetLMEData=function(l,u){return this.GetFuturesData(l,u,Fr)},this.GetTOCOMData=function(l,u){return this.GetFuturesData(l,u,Er)},this.GetIPEData=function(l,u){return this.GetFuturesData(l,u,xr)},this.GetFTSEData=function(l,u){var f=a;return f},this.GetFHKData=function(l,u){var f=s;return f},this.GetForeignExchangeData=function(l,u){var f=o;return f},this.GetBITData=function(l,u){var f=o;return f},this.GetETData=function(l,u){throw{Name:"MinuteCoordinateData::GetETData",Error:"not implement"}},this.GetJPData=function(l,u){throw{Name:"MinuteCoordinateData::GetJPData",Error:"not implement"}},this.GetHSXData=function(l,u){throw{Name:"MinuteCoordinateData::GetHSXData",Error:"not implement"}},this.GetHNXData=function(l,u){throw{Name:"MinuteCoordinateData::GetHNXData",Error:"not implement"}},this.GetUPCOMData=function(l,u){throw{Name:"MinuteCoordinateData::GetUPCOMData",Error:"not implement"}}}function vI(){this.TIME_SPLIT=[{Name:"9:00-10:15,10:31-11:30,13:31-15:00",Data:[{Start:900,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1e3,Text:"10:00"},{Value:1330,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Min:[{Value:900,Text:"9:00"},{Value:1330,Text:"13:30"},{Value:1500,Text:"15:00"}]}},{Name:"9:30-11:30,13:01-15:15",Data:[{Start:930,End:1130},{Start:1301,End:1515}],Coordinate:{Full:[{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1515,Text:"15:15"}],Simple:[{Value:930,Text:"9:30"},{Value:1030,Text:"10:30"},{Value:1300,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1515,Text:"15:15"}],Min:[{Value:930,Text:"9:30"},{Value:1300,Text:"13:00"},{Value:1515,Text:"15:15"}]}},{Name:"9:30-11:30,13:00-15:00",Data:[{Start:930,End:1130},{Start:1301,End:1500}],Coordinate:{Full:[{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:930,Text:"9:30"},{Value:1030,Text:"10:30"},{Value:1300,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1500,Text:"15:00"}],Min:[{Value:930,Text:"9:30"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-23:30,9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:2100,End:2330},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-1:00,9:01-10:15,10:31-11:30,13:31-15:00",Data:[{Start:2100,End:2359},{Start:0,End:100},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-2:30,9:01-10:15,10:31-11:30,13:31-15:00",Data:[{Start:2100,End:2359},{Start:0,End:230},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-23:00,9:01-10:15,10:30-11:30,13:31-15:00",Data:[{Start:2100,End:2300},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:1030,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1500,Text:"15:00"}]}},{Name:"9:00-11:30,13:00-15:00",Data:[{Start:900,End:1130},{Start:1300,End:1500}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1e3,Text:"10:00"},{Value:1300,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1500,Text:"15:00"}],Min:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:00-23:00,9:00-10:15,10:30-11:30,13:30-15:00",Data:[{Start:2100,End:2300},{Start:900,End:1015},{Start:1030,End:1130},{Start:1330,End:1500}],Coordinate:{Full:[{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:1030,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1500,Text:"15:00"}]}},{Name:"9:01-10:15,10:31-11:30,13:31-15:00",Data:[{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:901,Text:"9:00"},{Value:930,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:901,Text:"9:00"},{Value:1e3,Text:"10:00"},{Value:1330,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Min:[{Value:901,Text:"9:00"},{Value:1330,Text:"13:30"},{Value:1500,Text:"15:00"}]}},{Name:"21:01-1:00,9:01-10:15,10:31-11:30,13:31-15:00",Data:[{Start:2101,End:2359},{Start:0,End:100},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2101,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2101,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2101,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:01-23:00,9:01-10:15,10:30-11:30,13:31-15:00",Data:[{Start:2101,End:2300},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2101,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:1030,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2101,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Min:[{Value:2101,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1500,Text:"15:00"}]}},{Name:"21:01-2:30,9:01-10:15,10:31-11:30,13:31-15:00",Data:[{Start:2101,End:2359},{Start:0,End:230},{Start:901,End:1015},{Start:1031,End:1130},{Start:1331,End:1500}],Coordinate:{Full:[{Value:2101,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:901,Text:"9:00"},{Value:1031,Text:"10:30"},{Value:1331,Text:"13:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:2101,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:901,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"}],Min:[{Value:2101,Text:"21:00"},{Value:901,Text:"9:00"},{Value:1500,Text:"15:00"}]}},{Name:"9:30-11:30,13:01-15:15",Data:[{Start:931,End:1130},{Start:1301,End:1515}],Coordinate:{Full:[{Value:931,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1301,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1515,Text:"15:15"}],Simple:[{Value:931,Text:"9:30"},{Value:1030,Text:"10:30"},{Value:1301,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1515,Text:"15:15"}],Min:[{Value:931,Text:"9:30"},{Value:1301,Text:"13:00"},{Value:1515,Text:"15:15"}]}},{Name:"9:31-11:30,13:01-15:00",Data:[{Start:931,End:1130},{Start:1301,End:1500}],Coordinate:{Full:[{Value:931,Text:"9:30"},{Value:1e3,Text:"10:00"},{Value:1030,Text:"10:30"},{Value:1100,Text:"11:00"},{Value:1301,Text:"13:00"},{Value:1330,Text:"13:30"},{Value:1400,Text:"14:00"},{Value:1430,Text:"14:30"},{Value:1500,Text:"15:00"}],Simple:[{Value:931,Text:"9:30"},{Value:1030,Text:"10:30"},{Value:1301,Text:"13:00"},{Value:1400,Text:"14:00"},{Value:1500,Text:"15:00"}],Min:[{Value:931,Text:"9:30"},{Value:1301,Text:"13:00"},{Value:1500,Text:"15:00"}]}}],this.MAP_TWOWORDS=new Dt.default([[W.DCE+"-JD",{Time:0,Decimal:0,Name:"鸡蛋"}],[W.DCE+"-FB",{Time:0,Decimal:2,Name:"纤板"}],[W.DCE+"-BB",{Time:0,Decimal:2,Name:"胶板"}],[W.DCE+"-PP",{Time:6,Decimal:0,Name:"丙烯"}],[W.DCE+"-JM",{Time:6,Decimal:1,Name:"焦煤"}],[W.DCE+"-EG",{Time:6,Decimal:0,Name:"乙二醇"}],[W.DCE+"-EB",{Time:6,Decimal:0,Name:"苯乙烯"}],[W.DCE+"-CS",{Time:6,Decimal:0,Name:"淀粉"}],[W.DCE+"-PG",{Time:6,Decimal:0,Name:"液化气"}],[W.DCE+"-RR",{Time:6,Decimal:0,Name:"梗米"}],[W.DCE+"-LH",{Time:0,Decimal:0,Name:"生猪"}],[W.SHFE+"-CU",{Time:4,Decimal:0,Name:"铜"}],[W.SHFE+"-AL",{Time:4,Decimal:0,Name:"铝"}],[W.SHFE+"-NI",{Time:4,Decimal:0,Name:"镍"}],[W.SHFE+"-SN",{Time:4,Decimal:0,Name:"沪锡"}],[W.SHFE+"-ZN",{Time:4,Decimal:0,Name:"沪锌"}],[W.SHFE+"-PB",{Time:4,Decimal:0,Name:"沪铅"}],[W.SHFE+"-RU",{Time:6,Decimal:0,Name:"天然橡胶"}],[W.SHFE+"-FU",{Time:6,Decimal:0,Name:"燃料油"}],[W.SHFE+"-RB",{Time:6,Decimal:0,Name:"螺纹钢"}],[W.SHFE+"-BU",{Time:6,Decimal:0,Name:"石油沥青"}],[W.SHFE+"-HC",{Time:6,Decimal:0,Name:"热轧卷板"}],[W.SHFE+"-SP",{Time:6,Decimal:0,Name:"纸浆"}],[W.SHFE+"-WR",{Time:0,Decimal:0,Name:"线材"}],[W.SHFE+"-AG",{Time:5,Decimal:0,Name:"白银"}],[W.SHFE+"-AU",{Time:5,Decimal:2,Name:"黄金"}],[W.SHFE+"-SS",{Time:4,Decimal:0,Name:"不锈钢"}],[W.SHFE+"-AO",{Time:4,Decimal:0,Name:"氧化铝"}],[W.SHFE+"-BR",{Time:6,Decimal:0,Name:"合成橡胶"}],[W.SHFE+"-NR",{Time:6,Decimal:1,Name:"20号胶"}],[W.SHFE+"-SC",{Time:5,Decimal:1,Name:"原油"}],[W.SHFE+"-LU",{Time:6,Decimal:0,Name:"低硫燃油"}],[W.SHFE+"-BC",{Time:4,Decimal:0,Name:"国际铜"}],[W.CZCE+"-CF",{Time:6,Decimal:0,Name:"棉花"}],[W.CZCE+"-SR",{Time:6,Decimal:0,Name:"白糖"}],[W.CZCE+"-MA",{Time:6,Decimal:0,Name:"甲醇"}],[W.CZCE+"-ZC",{Time:6,Decimal:1,Name:"动力煤"}],[W.CZCE+"-TA",{Time:6,Decimal:0,Name:"精对苯二甲酸(PTA)"}],[W.CZCE+"-RM",{Time:6,Decimal:0,Name:"菜籽粕"}],[W.CZCE+"-OI",{Time:6,Decimal:0,Name:"菜籽油"}],[W.CZCE+"-ME",{Time:3,Decimal:0,Name:"甲醇(老)"}],[W.CZCE+"-FG",{Time:6,Decimal:0,Name:"平板玻璃"}],[W.CZCE+"-WS",{Time:0,Decimal:0}],[W.CZCE+"-WT",{Time:0,Decimal:0}],[W.CZCE+"-GN",{Time:0,Decimal:0}],[W.CZCE+"-RO",{Time:0,Decimal:0}],[W.CZCE+"-RS",{Time:0,Decimal:0,Name:"菜籽"}],[W.CZCE+"-ER",{Time:0,Decimal:0}],[W.CZCE+"-RI",{Time:0,Decimal:0,Name:"早籼稻"}],[W.CZCE+"-WH",{Time:0,Decimal:0,Name:"强麦"}],[W.CZCE+"-AP",{Time:0,Decimal:0,Name:"苹果"}],[W.CZCE+"-PM",{Time:0,Decimal:0,Name:"普麦"}],[W.CZCE+"-QM",{Time:0,Decimal:0}],[W.CZCE+"-TC",{Time:0,Decimal:0}],[W.CZCE+"-JR",{Time:0,Decimal:0,Name:"粳稻"}],[W.CZCE+"-LR",{Time:0,Decimal:0,Name:"晚籼稻"}],[W.CZCE+"-SF",{Time:0,Decimal:0,Name:"硅铁"}],[W.CZCE+"-SM",{Time:0,Decimal:0,Name:"锰硅"}],[W.CZCE+"-CJ",{Time:0,Decimal:2,Name:"红枣"}],[W.CZCE+"-CY",{Time:6,Decimal:0,Name:"棉纱"}],[W.CZCE+"-UR",{Time:0,Decimal:0,Name:"尿素"}],[W.CZCE+"-SA",{Time:6,Decimal:0,Name:"纯碱"}],[W.CZCE+"-PF",{Time:6,Decimal:0,Name:"短纤"}],[W.CZCE+"-PK",{Time:0,Decimal:0,Name:"花生"}],[W.CFFEX+"-TF",{Time:1,Decimal:3,Name:"二债"}],[W.CFFEX+"-TS",{Time:1,Decimal:3,Name:"五债"}],[W.CFFEX+"-IH",{Time:2,Decimal:1,Name:"上证股指期货"}],[W.CFFEX+"-IC",{Time:2,Decimal:1,Name:"中证股指期货"}],[W.CFFEX+"-IF",{Time:2,Decimal:1,Name:"沪深股指期货"}],[W.CFFEX+"-IM",{Time:2,Decimal:1,Name:"中证1000股指期货"}],[W.GZFE+"-SI",{Time:0,Decimal:2,Name:"工业硅"}],[W.GZFE+"-LC",{Time:0,Decimal:2,Name:"碳酸锂"}]]),this.MAP_ONEWORD=new Dt.default([[W.DCE+"-C",{Time:6,Decimal:0,Name:"玉米"}],[W.DCE+"-L",{Time:6,Decimal:0,Name:"乙烯"}],[W.DCE+"-V",{Time:6,Decimal:0,Name:"PVC"}],[W.DCE+"-A",{Time:6,Decimal:0,Name:"豆一"}],[W.DCE+"-B",{Time:6,Decimal:0,Name:"豆二"}],[W.DCE+"-M",{Time:6,Decimal:0,Name:"豆粕"}],[W.DCE+"-Y",{Time:6,Decimal:0,Name:"豆油"}],[W.DCE+"-P",{Time:6,Decimal:0,Name:"棕榈"}],[W.DCE+"-J",{Time:6,Decimal:1,Name:"焦炭"}],[W.DCE+"-I",{Time:6,Decimal:1,Name:"铁矿"}],[W.CFFEX+"-T",{Time:1,Decimal:3,Name:"十债"}]]),this.AddNewFutures=function(r){if(r){var n=r.Suffix+"-"+r.Symbol,e={Time:r.Time,Decimal:r.Decimal,Name:r.Name};r.Symbol.length==1?this.MAP_ONEWORD.set(n,e):r.Symbol.length==2&&this.MAP_TWOWORDS.set(n,e)}},this.GetData=function(r){var n=r.charAt(0),e=r.substr(0,2),t=null,a=null;return W.IsDCE(r)?(t=W.DCE+"-"+n,a=W.DCE+"-"+e):W.IsSHFE(r)?(t=W.SHFE+"-"+n,a=W.SHFE+"-"+e):W.IsCFFEX(r)?(t=W.CFFEX+"-"+n,a=W.CFFEX+"-"+e):W.IsCZCE(r)?(t=W.CZCE+"-"+n,a=W.CZCE+"-"+e):W.IsGZFE(r)&&(t=W.GZFE+"-"+n,a=W.GZFE+"-"+e),this.MAP_TWOWORDS.has(a)?this.MAP_TWOWORDS.get(a):this.MAP_ONEWORD.has(t)?this.MAP_ONEWORD.get(t):null},this.GetSplitData=function(r){var n=this.GetData(r);return n?this.TIME_SPLIT[n.Time]:null},this.GetDecimal=function(r){var n=this.GetData(r);return n?n.Decimal:2}}function qi(){this.TIME_SPLIT=[{Name:"6:00-5:00",Data:[{Start:600,End:2359},{Start:0,End:500}],Coordinate:{Full:[{Value:600,Text:"6:00"},{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"},{Value:400,Text:"4:00"}],Simple:[{Value:600,Text:"6:00"},{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:600,Text:"6:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}}],this.TIME_SPLIT2=[{Name:"7:00-6:00",Data:[{Start:700,End:2359},{Start:0,End:600}],Coordinate:{Full:[{Value:700,Text:"7:00"},{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"},{Value:500,Text:"5:00"}],Simple:[{Value:700,Text:"7:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"},{Value:1900,Text:"19:00"},{Value:2300,Text:"23:00"},{Value:300,Text:"3:00"}],Min:[{Value:700,Text:"7:00"},{Value:1900,Text:"19:00"},{Value:500,Text:"5:00"}]}}],this.FUTURES_LIST=[{Symbol:"CL",Decimal:2,Time:0,Name:"原油"},{Symbol:"NG",Decimal:3,Time:0,Name:"天然气"},{Symbol:"RB",Decimal:4,Time:0,Name:"汽油"},{Symbol:"PL",Decimal:1,Time:0,Name:"铂金"},{Symbol:"PA",Decimal:2,Time:0,Name:"钯金"},{Symbol:"HR",Decimal:0,Time:0,Name:"热轧钢卷"},{Symbol:"QM",Decimal:3,Time:0,Name:"迷你原油"},{Symbol:"HO",Decimal:4,Time:0,Name:"燃油"}],this.MarketSuffix=".NYMEX",this.TimeType=0,this.GetFuturesInfo=function(r){if(r.indexOf(this.MarketSuffix)<=0)return null;for(var n in this.FUTURES_LIST){var e=this.FUTURES_LIST[n];if(r.indexOf(e.Symbol)==0)return e}return null},this.GetSplitData=function(r){var n=this.TimeType==0?this.TIME_SPLIT:this.TIME_SPLIT2,e=this.GetFuturesInfo(r);return e?n[e.Time]:n[0]},this.GetDecimal=function(r){var n=this.GetFuturesInfo(r);return n?n.Decimal:3},this.GetMarketStatus=function(r){var n=Qh(-4),e=new Date,t=n.getDay(),a=e.getHours()*100+e.getMinutes();return t==6||t==0?0:a>430&&a<730?1:2},this.AddNewFutures=function(r){if(r){for(var n={Symbol:r.Symbol,Time:r.Time,Decimal:r.Decimal,Name:r.Name},e=0;e<this.FUTURES_LIST.length;++e){var t=this.FUTURES_LIST[e];if(t.Symbol==n.Symbol){this.FUTURES_LIST[e]=n;return}}this.FUTURES_LIST.push(n)}}}function cI(){this.newMethod=qi,this.newMethod(),delete this.newMethod,this.FUTURES_LIST=[{Symbol:"GC",Decimal:1,Time:0,Name:"COMEX黄金"},{Symbol:"QO",Decimal:2,Time:0,Name:"迷你黄金"},{Symbol:"MG",Decimal:1,Time:0,Name:"微型黄金"},{Symbol:"QI",Decimal:4,Time:0,Name:"迷你白银"},{Symbol:"SI",Decimal:3,Time:0,Name:"COMEX白银"},{Symbol:"HG",Decimal:4,Time:0,Name:"COMEX铜"}],this.MarketSuffix=".COMEX"}function SI(){this.newMethod=qi,this.newMethod(),delete this.newMethod,this.TIME_SPLIT=[{Name:"9:00-2:20",Data:[{Start:900,End:2359},{Start:0,End:220}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:100,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1700,Text:"17:00"},{Value:100,Text:"1:00"}]}},{Name:"15:30-1:00",Data:[{Start:1530,End:2359},{Start:0,End:100}],Coordinate:{Full:[{Value:1600,Text:"16:00"},{Value:1700,Text:"17:00"},{Value:1800,Text:"18:00"},{Value:1900,Text:"19:00"},{Value:2e3,Text:"20:00"},{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:0,Text:"0:00"},{Value:100,Text:"1:00"}],Simple:[{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"}],Min:[{Value:1600,Text:"16:00"},{Value:2100,Text:"21:00"},{Value:100,Text:"1:00"}]}}],this.TIME_SPLIT2=[{Name:"10:00-3:20",Data:[{Start:1e3,End:2359},{Start:0,End:320}],Coordinate:{Full:[{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:1e3,Text:"10:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"16:30-2:00",Data:[{Start:1630,End:2359},{Start:0,End:200}],Coordinate:{Full:[{Value:1700,Text:"17:00"},{Value:1800,Text:"18:00"},{Value:1900,Text:"19:00"},{Value:2e3,Text:"20:00"},{Value:2100,Text:"21:00"},{Value:2200,Text:"22:00"},{Value:2300,Text:"23:00"},{Value:0,Text:"0:00"},{Value:100,Text:"1:00"},{Value:200,Text:"2:00"}],Simple:[{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"}],Min:[{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:200,Text:"2:00"}]}}],this.FUTURES_LIST=[{Symbol:"SB",Decimal:2,Time:1},{Symbol:"CT",Decimal:2,Time:0}],this.MarketSuffix=".NYBOT",this.GetMarketStatus=function(r){var n=Qh(-4),e=n.getDay(),t=n.getHours()*100+n.getMinutes();if(e==6||e==0)return 0;var a=this.GetFuturesInfo(r);if(!a)return 2;if(a.Symbol=="SB"){if(t>300&&t<1400)return 2}else if(a.Symbol=="CT")return t>=0&&t<=1500||t>=2e3&&t<=2359?2:1;return 0}}function TI(){this.newMethod=qi,this.newMethod(),delete this.newMethod,this.TIME_SPLIT=[{Name:"8:00-2:20",Data:[{Start:800,End:2359},{Start:0,End:220}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"8:00-2:45",Data:[{Start:800,End:2359},{Start:0,End:245}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"6:00-5:00",Data:[{Start:600,End:2359},{Start:0,End:500}],Coordinate:{Full:[{Value:600,Text:"6:00"},{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"},{Value:400,Text:"4:00"}],Simple:[{Value:600,Text:"6:00"},{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:600,Text:"6:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}},{Name:"08:00-20:45 21:31-02:20",Data:[{Start:800,End:2045},{Start:2131,End:2359},{Start:0,End:220}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"8:00-2:45",Data:[{Start:800,End:2045},{Start:2131,End:2359},{Start:0,End:245}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}},{Name:"06:00-04:15 04:31-05:00",Data:[{Start:600,End:2359},{Start:0,End:415},{Start:431,End:500}],Coordinate:{Full:[{Value:600,Text:"6:00"},{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"},{Value:400,Text:"4:00"}],Simple:[{Value:600,Text:"6:00"},{Value:1e3,Text:"10:00"},{Value:1400,Text:"14:00"},{Value:1800,Text:"18:00"},{Value:2200,Text:"22:00"},{Value:200,Text:"2:00"}],Min:[{Value:600,Text:"6:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}}],this.TIME_SPLIT2=[{Name:"9:00-3:20",Data:[{Start:900,End:2359},{Start:0,End:320}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1900,Text:"19:00"},{Value:300,Text:"3:00"}]}},{Name:"9:00-3:45",Data:[{Start:900,End:2359},{Start:0,End:345}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1900,Text:"19:00"},{Value:300,Text:"3:00"}]}},{Name:"7:00-6:00",Data:[{Start:700,End:2359},{Start:0,End:600}],Coordinate:{Full:[{Value:700,Text:"7:00"},{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"},{Value:500,Text:"5:00"}],Simple:[{Value:700,Text:"7:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"},{Value:1900,Text:"19:00"},{Value:2300,Text:"23:00"},{Value:300,Text:"3:00"}],Min:[{Value:700,Text:"7:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}},{Name:"09:00-21:45 22:31-03:20",Data:[{Start:900,End:2145},{Start:2231,End:2359},{Start:0,End:320}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1900,Text:"19:00"},{Value:300,Text:"3:00"}]}},{Name:"09:00-21:45 22:31-03:45",Data:[{Start:900,End:2145},{Start:2231,End:2359},{Start:0,End:345}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1900,Text:"19:00"},{Value:300,Text:"3:00"}]}},{Name:"07:00-05:15 05:31-06:00",Data:[{Start:700,End:2359},{Start:0,End:515},{Start:531,End:600}],Coordinate:{Full:[{Value:700,Text:"7:00"},{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"},{Value:500,Text:"5:00"}],Simple:[{Value:700,Text:"7:00"},{Value:1100,Text:"11:00"},{Value:1500,Text:"15:00"},{Value:1900,Text:"19:00"},{Value:2300,Text:"23:00"},{Value:300,Text:"3:00"}],Min:[{Value:700,Text:"7:00"},{Value:1800,Text:"18:00"},{Value:500,Text:"5:00"}]}}],this.FUTURES_LIST=[{Symbol:"ZC",Decimal:2,Time:0,Name:"玉米"},{Symbol:"XC",Decimal:2,Time:1,Name:"迷你玉米"},{Symbol:"ZS",Decimal:2,Time:0,Name:"大豆"},{Symbol:"XK",Decimal:2,Time:1,Name:"迷你大豆"},{Symbol:"ZL",Decimal:2,Time:0,Name:"豆油"},{Symbol:"ZR",Decimal:2,Time:0,Name:"稻谷"},{Symbol:"ZO",Decimal:2,Time:0,Name:"燕麦"},{Symbol:"ZW",Decimal:2,Time:0,Name:"小麦"},{Symbol:"XW",Decimal:2,Time:1,Name:"迷你小麦"},{Symbol:"ZM",Decimal:1,Time:0,Name:"豆粕"},{Symbol:"EH",Decimal:3,Time:2},{Symbol:"YM",Decimal:0,Time:2,Name:"小型道指"},{Symbol:"ES",Decimal:2,Time:2,Name:"小型标普"},{Symbol:"NQ",Decimal:2,Time:2,Name:"小型纳指"},{Symbol:"TY",Decimal:4,Time:2,Name:"10年美国债"},{Symbol:"TU",Decimal:4,Time:2,Name:"2年美国债"},{Symbol:"FV",Decimal:4,Time:2,Name:"5年美国债"},{Symbol:"US",Decimal:4,Time:2,Name:"30年美国债"},{Symbol:"UL",Decimal:4,Time:2,Name:"超国债"}],this.MarketSuffix=".CBOT"}function dI(){this.newMethod=qi,this.newMethod(),delete this.newMethod,this.TIME_SPLIT=[{Name:"LME 9:00-3:00",Data:[{Start:900,End:2359},{Start:0,End:300}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:300,Text:"3:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:100,Text:"1:00"}],Min:[{Value:900,Text:"9:00"},{Value:1800,Text:"18:00"},{Value:300,Text:"3:00"}]}}],this.TIME_SPLIT=[{Name:"LME 8:00-2:00",Data:[{Start:800,End:2359},{Start:0,End:200}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"}],Min:[{Value:800,Text:"8:00"},{Value:1800,Text:"18:00"},{Value:200,Text:"2:00"}]}}],this.FUTURES_LIST=[{Symbol:"SN",Decimal:0,Time:0,Name:"LME锡"},{Symbol:"AH",Decimal:2,Time:0,Name:"LME铝"},{Symbol:"PB",Decimal:2,Time:0,Name:"LME铅"},{Symbol:"ZS",Decimal:2,Time:0,Name:"LME锌"},{Symbol:"CA",Decimal:2,Time:0,Name:"LME铜"},{Symbol:"NI",Decimal:0,Time:0,Name:"LME镍"}],this.MarketSuffix=".LME"}function mI(){this.newMethod=qi,this.newMethod(),delete this.newMethod,this.TimeType=0,this.TIME_SPLIT=[{Name:"15:30-04:30 07:46-14:15",Data:[{Start:1530,End:2359},{Start:0,End:430},{Start:746,End:1415}],Coordinate:{Full:[{Value:1530,Text:"15:30"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:300,Text:"3:00"},{Value:430,Text:"4:30"},{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1415,Text:"14:15"}],Simple:[{Value:1530,Text:"15:30"},{Value:1900,Text:"19:00"},{Value:2300,Text:"23:00"},{Value:100,Text:"1:00"},{Value:430,Text:"4:30"},{Value:1100,Text:"11:00"},{Value:1415,Text:"14:15"}],Min:[{Value:1530,Text:"15:30"},{Value:100,Text:"1:00"},{Value:1415,Text:"14:15"}]}}],this.FUTURES_LIST=[{Symbol:"JRV",Decimal:0,Time:0,Name:"东京TSR20橡胶"},{Symbol:"JPL",Decimal:0,Time:0,Name:"东京铂金"},{Symbol:"JAU",Decimal:0,Time:0,Name:"东京黄金"},{Symbol:"JCO",Decimal:0,Time:0,Name:"中东原油"},{Symbol:"JRU",Decimal:1,Time:0,Name:"东京RSS3橡胶橡胶"},{Symbol:"JAG",Decimal:1,Time:0,Name:"日白银"},{Symbol:"JPA",Decimal:1,Time:0,Name:"日钯金"}],this.MarketSuffix=".TOCOM"}function II(){this.newMethod=qi,this.newMethod(),delete this.newMethod,this.MarketSuffix=".IPE",this.TIME_SPLIT=[{Name:"8:00-6:00",Data:[{Start:800,End:2359},{Start:0,End:600}],Coordinate:{Full:[{Value:800,Text:"8:00"},{Value:1e3,Text:"10:00"},{Value:1200,Text:"12:00"},{Value:1400,Text:"14:00"},{Value:1600,Text:"16:00"},{Value:1800,Text:"18:00"},{Value:2e3,Text:"20:00"},{Value:2200,Text:"22:00"},{Value:0,Text:"0:00"},{Value:200,Text:"2:00"},{Value:400,Text:"4:00"},{Value:600,Text:"6:00"}],Simple:[{Value:800,Text:"8:00"},{Value:1200,Text:"12:00"},{Value:1600,Text:"16:00"},{Value:2e3,Text:"20:00"},{Value:0,Text:"0:00"},{Value:400,Text:"4:00"},{Value:600,Text:"6:00"}],Min:[{Value:800,Text:"8:00"},{Value:2e3,Text:"20:00"},{Value:600,Text:"6:00"}]}}],this.TIME_SPLIT2=[{Name:"09:00-07:00",Data:[{Start:900,End:2359},{Start:0,End:700}],Coordinate:{Full:[{Value:900,Text:"9:00"},{Value:1100,Text:"11:00"},{Value:1300,Text:"13:00"},{Value:1500,Text:"15:00"},{Value:1700,Text:"17:00"},{Value:1900,Text:"19:00"},{Value:2100,Text:"21:00"},{Value:2300,Text:"23:00"},{Value:1,Text:"1:00"},{Value:300,Text:"3:00"},{Value:500,Text:"5:00"},{Value:700,Text:"7:00"}],Simple:[{Value:900,Text:"9:00"},{Value:1300,Text:"13:00"},{Value:1700,Text:"17:00"},{Value:2100,Text:"21:00"},{Value:1,Text:"1:00"},{Value:500,Text:"5:00"},{Value:700,Text:"7:00"}],Min:[{Value:900,Text:"9:00"},{Value:2100,Text:"21:00"},{Value:700,Text:"7:00"}]}}],this.FUTURES_LIST=[{Symbol:"RC",Decimal:2,Time:0,Name:"罗布斯塔咖啡"},{Symbol:"W",Decimal:2,Time:0,Name:"白糖"},{Symbol:"C",Decimal:2,Time:0,Name:"伦敦可可"},{Symbol:"R",Decimal:2,Time:0,Name:"长期英国国债"},{Symbol:"L",Decimal:2,Time:0,Name:"3个月英镑利率"},{Symbol:"T",Decimal:2,Time:0,Name:"WTI原油"},{Symbol:"G",Decimal:2,Time:0,Name:"低硫柴油"},{Symbol:"B",Decimal:2,Time:0,Name:"布伦特原油"}]}var yr=new CI,Zh=new DI,Tn=new vI,Ki=new qi,Ji=new cI,zi=new SI,Zi=new TI,Fr=new dI,Er=new mI,xr=new II;function fe(r){var n=2;if(!r)return n;var e=r.toUpperCase();return typeof W.GetCustomDecimal=="function"?W.GetCustomDecimal(e):(W.IsSHSZFund(e)?n=3:W.IsSHO(e)||W.IsSZO(e)?n=W.GetSHODecimal(e):W.IsChinaFutures(e)?n=Tn.GetDecimal(e):W.IsFHK(e)?n=W.GetFHKDecimal(e):W.IsFTSE(e)?n=W.GetFTSEDecimal(e):W.IsBIT(e)?n=W.GetBITDecimal(e):W.IsET(e)?n=W.GetETDecimal(e):W.IsForeignExchange(e)?n=W.GetForeignExchangeDecimal(e):W.IsNYMEX(e)?n=Ki.GetDecimal(e):W.IsCOMEX(e)?n=Ji.GetDecimal(e):W.IsNYBOT(e)?n=zi.GetDecimal(e):W.IsCBOT(e)?n=Zi.GetDecimal(e):W.IsLME(e)?n=Fr.GetDecimal(e):W.IsTOCOM(e)?n=Er.GetDecimal(e):W.IsIPE(e)?n=xr.GetDecimal(e):W.IsHK(e)?n=W.GetHKDecimal(e):W.IsTW(e)?n=W.GetTWDecimal(e):W.IsJP(e)?n=W.GetJPDecimal(e):W.IsHSX(e)?n=W.GetHSXDecimal(e):W.IsHNX(e)?n=W.GetHNXDecimal(e):W.IsUPCOM(e)?n=W.GetUPCOMDecimal(e):n=W.GetDefaultDecimal(e),n)}function Qh(r){if(typeof r=="number"){var n=new Date,e=n.getTime(),t=n.getTimezoneOffset()*6e4,a=e+t;return new Date(a+36e5*r)}}if(!X)var X={Chart:{Log:console.log,Warn:console.warn},Complier:{Log:console.log,Warn:console.warn}};var zt={Domain:"https://opensource.zealink.com",CacheDomain:"https://opensourcecache.zealink.com",DrawIcon:{Family:"iconfont",Data:new Dt.default([[1,{Text:"",Color:"rgb(243,28,15)"}],[2,{Text:"",Color:"rgb(87,247,41)"}],[3,{Text:"",Color:"rgb(237,153,0)"}],[4,{Text:"",Color:"rgb(237,153,0)"}],[5,{Text:"",Color:"rgb(237,153,0)"}],[6,{Text:"",Color:"rgb(140,57,208)"}],[7,{Text:"",Color:"rgb(246,135,37)"}],[8,{Text:"",Color:"rgb(85,231,56)"}],[9,{Text:"",Color:"rgb(227,61,41)"}],[10,{Text:"",Color:"rgb(216,78,48)"}],[11,{Text:"",Color:"rgb(249,187,0)"}],[12,{Text:"",Color:"rgb(249,187,0)"}],[13,{Text:"",Color:"rgb(216,42,0)"}],[14,{Text:"",Color:"rgb(58,90,236)"}],[15,{Text:"",Color:"rgb(227,149,0)"}],[16,{Text:"",Color:"rgb(208,82,78)"}],[17,{Text:"",Color:"rgb(234,114,26)"}],[18,{Text:"",Color:"rgb(116,25,255)"}],[19,{Text:"",Color:"rgb(102,9,11)"}],[20,{Text:"",Color:"rgb(127,125,137)"}],[21,{Text:"",Color:"rgb(110,188,255)"}],[22,{Text:"",Color:"rgb(238,79,51)"}],[23,{Text:"",Color:"rgb(244,71,0)"}],[24,{Text:"",Color:"rgb(102,183,248)"}],[25,{Text:"",Color:"rgb(234,88,231)"}],[26,{Text:"",Color:"rgb(242,171,0)"}],[27,{Text:"",Color:"rgb(87,247,168)"}],[28,{Text:"",Color:"rgb(97,204,113)"}],[29,{Text:"",Color:"rgb(84,115,193)"}],[30,{Text:"",Color:"rgb(141,51,255)"}],[31,{Text:"",Color:"rgb(200,126,24)"}],[32,{Text:"",Color:"rgb(195,41,32)"}],[33,{Text:"",Color:"rgb(215,85,194)"}],[34,{Text:"",Color:"rgb(250,222,105)"}],[35,{Text:"",Color:"rgb(112,249,224)"}],[36,{Text:"",Color:"rgb(217,107,98)"}],[37,{Text:"",Color:"rgb(114,231,17)"}],[38,{Text:"",Color:"rgb(238,31,25)"}],[39,{Text:"",Color:"rgb(92,247,113)"}],[40,{Text:"",Color:"rgb(175,175,175)"}],[41,{Text:"",Color:"rgb(252,228,23)"}],[42,{Text:"",Color:"rgb(88,195,235)"}],[43,{Text:"",Color:"rgb(55,74,94)"}],[44,{Text:"",Color:"rgb(248,175,33)"}],[45,{Text:"",Color:"rgb(194,180,112)"}],[46,{Text:"",Color:"rgb(50,153,28)"}],[47,{Text:"",Color:"rgb(17,65,152)"}],[48,{Text:"",Color:"rgb(194,55,26)"}],[49,{Text:"",Color:"rgb(243,0,0)"}]])},CustomDrawIcon:{Data:new Dt.default},CustomFunction:{Data:new Dt.default},CustomVariant:{Data:new Dt.default},GetDrawIcon:function(n){var e;if(zt.CustomDrawIcon.Data.has(n)){var t=zt.CustomDrawIcon.Data.get(n);return t.Symbol?e={Symbol:t.Symbol,Color:t.Color,IconFont:!1,ID:n}:e={Symbol:t.Text,Color:t.Color,Family:t.Family,IconFont:!0,ID:n},e}if(zt.DrawIcon.Data.has(n)){var a=zt.DrawIcon.Data.get(n);return e={Symbol:a.Text,Color:a.Color,Family:zt.DrawIcon.Family,IconFont:!0,ID:n},e}return null},GetDrawTextIcon:function(n){var e=new Dt.default([[1,{Symbol:"↑",Color:"rgb(238,44,44)"}],[2,{Symbol:"↓",Color:"rgb(0,139,69)"}],[3,{Symbol:"😧"}],[4,{Symbol:"😨"}],[5,{Symbol:"😁"}],[6,{Symbol:"😱"}],[7,{Symbol:"B",Color:"rgb(238,44,44)"}],[8,{Symbol:"S",Color:"rgb(0,139,69)"}],[9,{Symbol:"💰"}],[10,{Symbol:"📪"}],[11,{Symbol:"👆"}],[12,{Symbol:"👇"}],[13,{Symbol:"B",Color:"rgb(178,34,34)"}],[14,{Symbol:"S",Color:"rgb(0,139,69)"}],[36,{Symbol:"Χ",Color:"rgb(238,44,44)"}],[37,{Symbol:"X",Color:"rgb(0,139,69)"}],[38,{Symbol:"▲",Color:"rgb(238,44,44)"}],[39,{Symbol:"▼",Color:"rgb(0,139,69)"}],[40,{Symbol:"◉",Color:"rgb(238,44,44)"}],[41,{Symbol:"◈",Color:"rgb(238,44,44)"}],[42,{Symbol:"📌"}],[43,{Symbol:"💎"}],[44,{Symbol:"🥇"}],[45,{Symbol:"🥈"}],[46,{Symbol:"🥉"}],[47,{Symbol:"🏅"}]]),t=e.get(n);return t},IsCustomFunction:function(n){return!!zt.CustomFunction.Data.has(n)},IsCustomVariant:function(n){return!!zt.CustomVariant.Data.has(n)}},an={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"},zu={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},Je={FromCodePoint:function(n){return n<65536?String.fromCharCode(n):String.fromCharCode(55296+(n-65536>>10))+String.fromCharCode(56320+(n-65536&1023))},IsWhiteSpace:function(n){return n===32||n===9||n===11||n===12||n===160||n>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(n)>=0},IsLineTerminator:function(n){return n===10||n===13||n===8232||n===8233},IsIdentifierStart:function(n){return n===36||n===95||n>=65&&n<=90||n>=97&&n<=122||n===92||n===12304||n===12305||n===9650||n===9660||n>=128&&zu.NonAsciiIdentifierStart.test(Je.FromCodePoint(n))},IsIdentifierPart:function(n){return n===36||n===95||n>=65&&n<=90||n>=97&&n<=122||n>=48&&n<=57||n===92||n===35||n===12304||n===12305||n===9650||n===9660||n>=128&&zu.NonAsciiIdentifierPart.test(Je.FromCodePoint(n))},IsDecimalDigit:function(n){return n>=48&&n<=57},IsHexDigit:function(n){return n>=48&&n<=57||n>=65&&n<=70||n>=97&&n<=102},isOctalDigit:function(n){return n>=48&&n<=55}},ja={};ja[1]="Boolean";ja[2]="<end>";ja[3]="Identifier";ja[4]="Keyword";ja[5]="Null";ja[6]="Numeric";ja[7]="Punctuator";ja[8]="String";ja[9]="RegularExpression";ja[10]="Template";function Ka(){}Ka.GetPeriodInfo=function(r){var n=[{Name:"MIN1",Period:4,Order:1},{Name:"MIN5",Period:5,Order:2},{Name:"MIN15",Period:6,Order:3},{Name:"MIN30",Period:7,Order:4},{Name:"MIN60",Period:8,Order:5},{Name:"DAY",Period:0,Order:1e3},{Name:"MULTIDAY",Period:40002,Order:1002},{Name:"DAY2",Period:40002,Order:1002},{Name:"DAY3",Period:40003,Order:1003},{Name:"DAY4",Period:40004,Order:1004},{Name:"DAY5",Period:40005,Order:1005},{Name:"WEEK",Period:1,Order:1005},{Name:"DAY6",Period:40006,Order:1006},{Name:"DAY7",Period:40007,Order:1007},{Name:"DAY8",Period:40008,Order:1008},{Name:"DAY9",Period:40009,Order:1009},{Name:"DAY10",Period:40009,Order:1010},{Name:"WEEK2",Period:21,Order:1010},{Name:"DAY11",Period:40011,Order:1011},{Name:"DAY12",Period:40012,Order:1012},{Name:"DAY13",Period:40013,Order:1013},{Name:"DAY14",Period:40014,Order:1014},{Name:"MONTH",Period:2,Order:1030},{Name:"SEASON",Period:9,Order:1090},{Name:"HALFYEAR",Period:22,Order:1180},{Name:"YEAR",Period:3,Order:1365}];if(r.Name){for(var e in n)if(r.Name&&n[e].Name==r.Name)return n[e];return null}if(c.IsNumber(r.PeriodID)){for(var e in n)if(n[e].Period==r.PeriodID)return n[e];return null}return null};Ka.GetConvertValueName=function(r){var n;return r=="COVER_C"?n="CLOSE":r=="COVER_O"?n="OPEN":r=="COVER_H"?n="HIGH":r=="COVER_L"?n="LOW":r=="COVER_A"?n="AMOUNT":r=="COVER_V"&&(n="VOL"),n};function ps(){this.Error=[],this.RecordError=function(r){this.Error.push(r)},this.ConstructError=function(r,n){var e=new Error(r);try{throw e}catch(t){Wu.default&&NT.default&&(e=(0,Wu.default)(t),e.Column=n)}return e},this.CreateError=function(r,n,e,t,a){var s="Line "+n+": "+t,o=this.ConstructError(s,e);return o.Index=r,o.LineNumber=n,o.Description=t,o.Word=a,o},this.ThrowError=function(r,n,e,t,a){var s=this.CreateError(r,n,e,t,a);throw s},this.ThrowDownloadJob=function(r,n,e,t,a){var s=this.CreateError(r,n,e,t);throw s.Job=a,s}}function eD(r,n){this.Source=r,this.ErrorHandler=n,this.Length=r.length,this.Index=0,this.LineNumber=r.length>0?1:0,this.LineStart=0,this.CurlyStack=[],this.SaveState=function(){return{Index:this.Index,LineNumber:this.LineNumber,LineStart:this.LineStart}},this.RestoreState=function(e){this.Index=e.Index,this.LineNumber=e.LineNumber,this.LineStart=e.LineStart},this.IsEOF=function(){return this.Index>=this.Length},this.IsKeyword=function(e){return!1},this.CodePointAt=function(e){var t=this.Source.charCodeAt(e);if(t>=55296&&t<=56319){var a=this.Source.charCodeAt(e+1);if(a>=56320&&a<=57343){var s=t;t=(s-55296)*1024+a-56320+65536}}return t},this.Lex=function(){if(this.IsEOF())return{Type:2,Value:"",LineNumber:this.LineNumber,LineStart:this.LineStart,Start:this.Index,End:this.Index};var e=this.Source.charCodeAt(this.Index);return Je.IsIdentifierStart(e)?this.ScanIdentifier():e===40||e===41||e===59?this.ScanPunctuator():e===39||e===34?this.ScanStringLiteral():e==46?Je.IsDecimalDigit(this.Source.charCodeAt(this.Index+1))?this.ScanNumericLiteral():this.ScanPunctuator():Je.IsDecimalDigit(e)?this.ScanNumericLiteral():e>=55296&&e<57343&&Je.IsIdentifierStart(this.CodePointAt(this.Index))?this.ScanIdentifier():this.ScanPunctuator()},this.ScanIdentifier=function(){var e=void 0,t=this.Index,a=this.Source.charCodeAt(t)===92?this.GetComplexIdentifier():this.GetIdentifier();if(a.length?e=3:this.IsKeyword(a)?e=4:a==null?e=5:a=="true"||a=="false"?e=1:e=3,e!=3&&t+a.length!=this.Index)throw this.Index,this.Index=t,an.InvalidEscapedReservedWord;return(a=="AND"||a=="OR")&&(e=7),{Type:e,Value:a,LineNumber:this.LineNumber,LineStart:this.LineStart,Start:t,End:this.Index}},this.GetIdentifier=function(){for(var e=this.Index++;!this.IsEOF();){var t=this.Source.charCodeAt(this.Index);if(t==92)return this.Index=e,this.GetComplexIdentifier();if(t>=55296&&t<57343)return this.Index=e,this.GetComplexIdentifier();if(Je.IsIdentifierPart(t))++this.Index;else break}return this.Source.slice(e,this.Index)},this.ScanPunctuator=function(){var e=this.Index,t=this.Source[this.Index];switch(t){case"(":++this.Index;break;case")":case";":case",":++this.Index;break;case".":++this.Index;break;default:t=this.Source.substr(this.Index,3),t=="AND"?this.Index+=3:(t=this.Source.substr(this.Index,2),t==="&&"||t==="||"||t==="=="||t==="!="||t==="<="||t===">="||t==="=>"||t==":="||t=="OR"||t=="<>"?this.Index+=2:(t=this.Source[this.Index],"<>=!+-*%&|^/:".indexOf(t)>=0&&++this.Index))}return this.Index==e&&this.ThrowUnecpectedToken(),{Type:7,Value:t,LineNumber:this.LineNumber,LineStart:this.LineStart,Start:e,End:this.Index}},this.ScanStringLiteral=function(){var e=this.Index,t=this.Source[this.Index];++this.Index;for(var a="";!this.IsEOF();){var s=this.Source[this.Index++];if(s==t){t="";break}else{if(s=="\\")throw"not complete";if(Je.IsLineTerminator(s.charCodeAt(0)))break;a+=s}}return t!=""&&(this.Index=e,this.ThrowUnecpectedToken()),{Type:8,Value:a,LineNumber:this.LineNumber,LineStart:this.LineStart,Start:e,End:this.Index}},this.ScanNumericLiteral=function(){var e=this.Index,t=this.Source[this.Index],a="";if(t!="."){if(a=this.Source[this.Index++],t=this.Source[this.Index],a=="0"&&(t=="x"||t=="X"))return++this.Index,this.ScanHexLiteral(e);for(;Je.IsDecimalDigit(this.Source.charCodeAt(this.Index));)a+=this.Source[this.Index++];t=this.Source[this.Index]}if(t=="."){for(a+=this.Source[this.Index++];Je.IsDecimalDigit(this.Source.charCodeAt(this.Index));)a+=this.Source[this.Index++];t=this.Source[this.Index]}if(t=="e"||t=="E")if(a+=this.Source[this.Index++],t=this.Source[this.Index],(t=="+"||t=="-")&&(a+=this.Source[this.Index]),Je.IsDecimalDigit(this.Source.charCodeAt(this.Index)))for(;Je.IsDecimalDigit(this.Source.charCodeAt(this.Index));)a+=this.Source[this.Index++];else this.ThrowUnecpectedToken();return Je.IsIdentifierStart(this.Source.charCodeAt(this.Index))&&this.ThrowUnecpectedToken(),{Type:6,Value:parseFloat(a),LineNumber:this.LineNumber,LineStart:this.LineStart,Start:e,End:this.Index}},this.ScanComments=function(){var e=void 0;for(this.Index==0;!this.IsEOF();){var t=this.Source.charCodeAt(this.Index);if(Je.IsWhiteSpace(t))++this.Index;else if(Je.IsLineTerminator(t))++this.Index,t==13&&this.Source.charCodeAt(this.Index)==10&&++this.Index,++this.LineNumber,this.LineStart=this.Index;else if(t==47)if(t=this.Source.charCodeAt(this.Index+1),t==47)this.Index+=2,this.SkipSingleLineComment(2);else break;else if(t==123)this.Index+=1,this.SkipMultiLineComment();else break}return e},this.SkipMultiLineComment=function(){for(var e=[];!this.IsEOF();){var t=this.Source.charCodeAt(this.Index);if(Je.IsLineTerminator(t))++this.LineNumber,++this.Index,this.LineStart=this.Index;else{if(t==125)return this.Index+=1,e;++this.Index}}return e},this.SkipSingleLineComment=function(e){for(var t=[];!this.IsEOF();){var a=this.Source.charCodeAt(this.Index);if(++this.Index,Je.IsLineTerminator(a))return a===13&&this.Source.charCodeAt(this.Index)===10&&++this.Index,++this.LineNumber,this.LineStart=this.Index,t}return t},this.ThrowUnecpectedToken=function(e,t){return e||(e=an.UnexpectedTokenIllegal),this.ErrorHandler.ThrowError(this.Index,this.LineNumber,this.Index-this.LineStart+1,e,t)}}function gI(r){this.ErrorHandler=new ps,this.Scanner=new eD(r,this.ErrorHandler),this.Buffer=[],this.GetNextToken=function(){if(this.Buffer.length==0&&(this.Scanner.ScanComments(),!this.Scanner.IsEOF())){var n=this.Scanner.Lex(),e={Type:ja[n.Type],Value:this.Scanner.Source.slice(n.Start,n.End)};this.Buffer.push(e)}return this.Buffer.shift()}}var vt={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};function pI(r){this.IsNeedIndexData=!1,this.IsNeedLatestIndexData=!1,this.IsNeedSymbolData=!1,this.IsNeedMarginData=new Ee.default,this.IsNeedNewsAnalysisData=new Ee.default,this.NeedBlockIncreaseData=[],this.IsNeedSymbolExData=new Ee.default,this.NeedHK2SHSZData=[],this.IsNeedSectionFinance=new Dt.default,this.FunctionData=[],this.Dynainfo=[],this.IsAPIData=[],this.ExecuteIndex=[],this.OtherSymbolData=[],this.PeriodSymbolData=[],this.ErrorHandler=r,this.GetDataJobList=function(){var n=[];this.IsNeedSymbolData&&n.push({ID:K.JOB_DOWNLOAD_SYMBOL_DATA}),this.IsNeedIndexData&&n.push({ID:K.JOB_DOWNLOAD_INDEX_DATA}),this.IsNeedLatestIndexData&&n.push({ID:K.JOB_DOWNLOAD_LATEST_INDEX_DATA});for(var e=0;e<this.Dynainfo.length;++e){var t=this.Dynainfo[e];n.push(t)}for(var e in this.NeedBlockIncreaseData)n.push(this.NeedBlockIncreaseData[e]);var a=!0,s=!1,o=void 0;try{for(var h=(0,we.default)(this.IsNeedMarginData),l;!(a=(l=h.next()).done);a=!0){var u=l.value;n.push({ID:u})}}catch(Y){s=!0,o=Y}finally{try{!a&&h.return&&h.return()}finally{if(s)throw o}}for(var e in this.NeedHK2SHSZData)n.push(this.NeedHK2SHSZData[e]);var f=!0,C=!1,D=void 0;try{for(var v=(0,we.default)(this.IsNeedNewsAnalysisData),S;!(f=(S=v.next()).done);f=!0){var u=S.value;n.push({ID:u})}}catch(Y){C=!0,D=Y}finally{try{!f&&v.return&&v.return()}finally{if(C)throw D}}var T=!0,I=!1,F=void 0;try{for(var E=(0,we.default)(this.IsNeedSymbolExData),M;!(T=(M=E.next()).done);T=!0){var u=M.value;n.push({ID:u})}}catch(Y){I=!0,F=Y}finally{try{!T&&E.return&&E.return()}finally{if(I)throw F}}var O=!0,R=!1,b=void 0;try{for(var p=(0,we.default)(this.IsNeedSectionFinance),G;!(O=(G=p.next()).done);O=!0){var t=G.value;n.push({ID:K.JOB_DOWNLOAD_SECTION_SF,SF:t})}}catch(Y){R=!0,b=Y}finally{try{!O&&p.return&&p.return()}finally{if(R)throw b}}for(var e in this.IsAPIData){var t=this.IsAPIData[e];n.push(t)}for(var e in this.ExecuteIndex){var t=this.ExecuteIndex[e];n.push(t)}for(var e in this.OtherSymbolData){var t=this.OtherSymbolData[e];n.push(t)}for(var e in this.PeriodSymbolData){var t=this.PeriodSymbolData[e];n.push(t)}for(var e in this.FunctionData){var t=this.FunctionData[e];n.push(t)}return n},this.VerifySymbolVariable=function(n,e){var t=new Ee.default(["INDEXA","INDEXC","INDEXH","INDEXL","INDEXO","INDEXV","INDEXDEC","INDEXADV"]);if(t.has(n)){this.IsNeedIndexData=!0;return}var a=new Ee.default(["CLOSE","C","VOL","V","OPEN","O","HIGH","H","LOW","L","AMOUNT","AMO","VOLINSTK"]);if(a.has(n)){this.IsNeedSymbolData=!0;return}n==="VOLR"&&(this.IsNeedSymbolExData.has(K.JOB_DOWNLOAD_VOLR_DATA)||this.IsNeedSymbolExData.add(K.JOB_DOWNLOAD_VOLR_DATA));var s=new Ee.default(["CAPITAL","TOTALCAPITAL","EXCHANGE","HYBLOCK","DYBLOCK","GNBLOCK","FGBLOCK","ZSBLOCK","ZHBLOCK","ZDBLOCK","HYZSCODE","GNBLOCKNUM","FGBLOCKNUM","ZSBLOCKNUM","ZHBLOCKNUM","ZDBLOCKNUM","HYSYL","HYSJL"]);if(s.has(n)){var o={ID:K.JOB_DOWNLOAD_VARIANT,VariantName:n};e&&(o.Token={Index:e.Start,Line:e.LineNumber}),this.FunctionData.push(o);return}if(n=="FROMOPEN"){this.IsNeedLatestIndexData=!0;return}if(n=="ADVANCE"||n=="DECLINE"){var o={ID:K.JOB_DOWNLOAD_INDEX_INCREASE_DATA,IsSelfSymbol:!0,FunctionName:n};e&&(o.Token={Index:e.Start,Line:e.LineNumber}),this.NeedBlockIncreaseData.push(o);return}if(n.indexOf("#")>0){var h=n.split("#");if(h.length!=2){var l=n+", 跨周期语法错误, 变量名#周期";this.ThrowUnexpectedToken(e,l)}else{var u=["C","CLOSE","O","OPEN","H","HIGH","L","LOW","AMOUNT","AMO","VOL","V","VOLINSTK"];if(u.indexOf(h[0])<0){var l=n+", 跨周期语法错误, 数据只支持'OPEN,HIGH,LOW,CLOSE,VOL,AMOUNT,VOLINSTK'";this.ThrowUnexpectedToken(e,l)}var f=["MIN1","MIN5","MIN15","MIN30","MIN60","MIN120","MIN240","DAY","WEEK","MONTH","SEASON","YEAR","HALFYEAR","WEEK2","MULTIDAY","DAY2","DAY3","DAY4","DAY5","DAY6","DAY7","DAY8","DAY9","DAY10","DAY11","DAY12","DAY13","DAY14","DAY15"];if(f.indexOf(h[1])<0){var l=n+", 跨周期语法错误， 周期只支持'MIN1,MIN5,MIN15,MIN30,MIN60,DAY,WEEK,MONTH,SEASON,YEAR'";this.ThrowUnexpectedToken(e,l)}var o={ID:K.JOB_DOWNLOAD_SYMBOL_PERIOD_DATA,VarName:n,ValueName:h[0],PeriodName:h[1]};e&&(o.Token={Index:e.Start,Line:e.LineNumber}),this.PeriodSymbolData.push(o)}return}if(zt.IsCustomVariant(n)){var o={VariantName:n,ID:K.JOB_CUSTOM_VARIANT_DATA};e&&(o.Token={Index:e.Start,Line:e.LineNumber}),this.FunctionData.push(o);return}},this.VerifySymbolLiteral=function(n,e){if(c.IsString(n)&&n.indexOf("$")>0){var t=n.split("$");if(t.length!=2)return;var a={Literal:n,ID:K.JOB_DOWNLOAD_OTHER_SYMBOL_DATA};e&&(a.Token={Index:e.Start,Line:e.LineNumber}),this.OtherSymbolData.push(a)}},this.VerifySymbolFunction=function(n,e,t){if(zt.IsCustomFunction(n.Name)){var a={FunctionName:n.Name,ID:K.JOB_CUSTOM_FUNCTION_DATA,Args:e};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(a);return}if(n.Name=="DYNAINFO"){var a={ID:K.JOB_DOWNLOAD_SYMBOL_LATEST_DATA,Args:e,FunctionName:n.Name};this.Dynainfo.push(a);return}if(n.Name=="FINANCE"){var a={ID:K.JOB_DOWNLOAD_FINANCE,Args:e,FunctionName:n.Name};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(a);return}if(n.Name=="FINVALUE"){var a={ID:K.JOB_DOWNLOAD_FINVALUE,Args:e,FunctionName:n.Name};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(a);return}if(n.Name=="FINONE"){var a={ID:K.JOB_DOWNLOAD_FINONE,Args:e,FunctionName:n.Name};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(a);return}if(n.Name=="GPJYVALUE"){var a={ID:K.JOB_DOWNLOAD_GPJYVALUE,Args:e,FunctionName:n.Name};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(a);return}if(n.Name=="SCJYVALUE"){var a={ID:K.JOB_DOWNLOAD_SCJYVALUE,Args:e,FunctionName:n.Name};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(a);return}if(n.Name==="MARGIN"){var s=K.GetMarginJobID(e[0].Value);s&&!this.IsNeedMarginData.has(s)&&this.IsNeedMarginData.add(s);return}if(n.Name==="NEWS"){var o=K.GetNewsAnalysisID(e[0].Value);o&&!this.IsNeedNewsAnalysisData.has(o)&&this.IsNeedNewsAnalysisData.add(o);return}if(n.Name==="HK2SHSZ"){var a={ID:K.JOB_DOWNLOAD_HK_TO_SHSZ,Args:e,FunctionName:n.Name};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.NeedHK2SHSZData.push(a);return}if(n.Name=="COST"||n.Name=="WINNER"||n.Name=="PPART"||n.Name=="COSTEX"||n.Name=="LWINNER"||n.Name=="PWINNER"){var a={ID:K.JOB_DOWNLOAD_FINANCE,Args:[7],FunctionName:"FINANCE",FunctionName2:n.Name};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(a);return}if(n.Name=="INBLOCK"){var a={ID:K.JOB_DOWNLOAD_VARIANT,VariantName:"INBLOCK"};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.FunctionData.push(a);return}if(n.Name==="BETA"){this.IsNeedIndexData=!0;return}if(n.Name=="UPCOUNT"||n.Name=="DOWNCOUNT"){var a={ID:K.JOB_DOWNLOAD_INDEX_INCREASE_DATA,Args:e,FunctionName:n.Name};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.NeedBlockIncreaseData.push(a);return}if(n.Name=="STKINDI"||n.Name=="CALCSTOCKINDEX"){var a={ID:K.JOB_EXECUTE_INDEX,Args:e,FunctionName:n.Name};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.ExecuteIndex.push(a);return}if(n.Name=="COVER_C"||n.Name=="COVER_O"||n.Name=="COVER_H"||n.Name=="COVER_L"||n.Name=="COVER_A"||n.Name=="COVER_V"){var h=e[0].Value,l=["MIN1","MIN5","MIN15","MIN30","MIN60","DAY","WEEK","MONTH","SEASON","YEAR"];if(l.indexOf(h)<0){var u=n.Name+", 跨周期函数错误， 周期只支持'MIN1,MIN5,MIN15,MIN30,MIN60,DAY,WEEK,MONTH,SEASON,YEAR'";this.ThrowUnexpectedToken(t,u)}var f=Ka.GetConvertValueName(n.Name),a={ID:K.JOB_DOWNLOAD_SYMBOL_PERIOD_DATA,FunctionName:n.Name,ValueName:f,PeriodName:h};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.PeriodSymbolData.push(a);return}if(n.Name=="SF"){var C=K.GetSectionReportPeriod(e[0].Value,e[1].Value);if(!C)return;var D=K.GetSectionFinanceID(e[2].Value);if(!D)return;var v=C.Year+"-"+C.Quarter;if(this.IsNeedSectionFinance.has(v)){var S=this.IsNeedSectionFinance.get(v);S.Fields.has(D)||S.Fields.add(D)}else{var S={Period:C,Fields:new Ee.default([D])};this.IsNeedSectionFinance.set(v,S)}return}if(n.Name=="LOADAPIDATA"){var a={Name:n.Name,ID:K.JOB_DOWNLOAD_CUSTOM_API_DATA,Args:e};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.IsAPIData.push(a);return}var T=new Ee.default(["CLOSE","C","VOL","V","OPEN","O","HIGH","H","LOW","L","AMOUNT","AMO","VOLINSTK"]);if(T.has(n.Name)){var a={Name:n.Name,ID:K.JOB_DOWNLOAD_OTHER_SYMBOL_DATA,Args:e};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.OtherSymbolData.push(a);return}},this.VerifyMemberVariable=function(n,e,t){var a={ID:K.JOB_EXECUTE_INDEX,Member:{Object:n,Property:e}};t&&(a.Token={Index:t.Start,Line:t.LineNumber}),this.ExecuteIndex.push(a)},this.ExpressionStatement=function(n){return{Type:vt.ExpressionStatement,Expression:n}},this.Script=function(n){return{Type:vt.Program,Body:n,SourceType:"通达信脚本"}},this.SequenceExpression=function(n){return{Type:vt.SequenceExpression,Expression:n}},this.BinaryExpression=function(n,e,t){var a=n==="||"||n==="&&"||n=="AND"||n=="OR",s=a?vt.LogicalExpression:vt.BinaryExpression;return{Type:s,Operator:n,Left:e,Right:t}},this.Literal=function(n,e,t){return this.VerifySymbolLiteral(n,t),{Type:vt.Literal,Value:n,Raw:e}},this.Identifier=function(n,e){return this.VerifySymbolVariable(n,e),{Type:vt.Identifier,Name:n}},this.MemberIdentifier=function(n,e){return{Type:vt.Identifier,Name:n}},this.AssignmentExpression=function(n,e,t){return{Type:vt.AssignmentExpression,Operator:n,Left:e,Right:t}},this.UnaryExpression=function(n,e){return{Type:vt.UnaryExpression,Operator:n,Argument:e,Prefix:!0}},this.EmptyStatement=function(){return{Type:vt.EmptyStatement}},this.CallExpression=function(n,e,t){return this.VerifySymbolFunction(n,e,t),{Type:vt.CallExpression,Callee:n,Arguments:e}},this.StaticMemberExpression=function(n,e,t){return this.VerifyMemberVariable(n,e,t),{Type:vt.MemberExpression,Computed:!1,Object:n,Property:e}},this.Directive=function(n,e){return{Type:vt.ExpressionStatement,Expression:n,Directive:e}},this.ThrowUnexpectedToken=function(n,e){throw this.UnexpectedTokenError(n,e)},this.UnexpectedTokenError=function(n,e){var t=e||an.UnexpectedToken,a="ILLEGAL";if(n&&(a=n.Value),t=t.replace("%0",a),n&&typeof n.LineNumber=="number"){var s=n.Start,o=n.LineNumber,h=-1;return this.ErrorHandler.CreateError(s,o,h,t)}}}function $h(r){this.ErrorHandler=new ps,this.Scanner=new eD(r,this.ErrorHandler),this.Node=new pI(this.ErrorHandler),this.LookAhead={Type:2,Value:"",LineNumber:this.Scanner.LineNumber,LineStart:0,Start:0,End:0},this.HasLineTerminator=!1,this.Context={IsModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,FirstCoverInitializedNameError:null,IsAssignmentTarget:!1,IsBindingElement:!1,InFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},Strict:!1},this.PeratorPrecedence={")":0,";":0,",":0,"]":0,"||":1,OR:1,"&&":2,AND:2,"|":3,"^":4,"&":5,"==":6,"=":6,"!=":6,"<>":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.StartMarker={Index:0,Line:this.Scanner.LineNumber,Column:0},this.LastMarker={Index:0,Line:this.Scanner.LineNumber,Column:0},this.Initialize=function(){this.NextToken(),this.LastMarker={Index:this.Scanner.Index,Line:this.Scanner.LineNumber,Column:this.Scanner.Index-this.Scanner.LineStart}},this.CreateNode=function(){return{Index:this.StartMarker.Index,Line:this.StartMarker.Line,Column:this.StartMarker.Column}},this.StartNode=function(n,e){e==null&&(e=0);var t=n.Start-n.LineStart,a=n.LineNumber;return t<0&&(t+=e,a--),{Index:n.Start,Line:a,Column:t}},this.Match=function(n){return this.LookAhead.Type==7&&this.LookAhead.Value==n},this.Expect=function(n){var e=this.NextToken();(e.Type!=7||e.Value!=n)&&this.ThrowUnexpectedToken(e)},this.MatchAssign=function(){if(this.LookAhead.Type!=7)return!1;var n=this.LookAhead.Value;return n==":"||n==":="},this.GetTokenRaw=function(n){return this.Scanner.Source.slice(n.Start,n.End)},this.NextToken=function(){var n=this.LookAhead;this.LastMarker.Index=this.Scanner.Index,this.LastMarker.Line=this.Scanner.LineNumber,this.LastMarker.Column=this.Scanner.Index-this.Scanner.LineStart,this.CollectComments(),this.Scanner.Index!==this.StartMarker.Index&&(this.StartMarker.Index=this.Scanner.Index,this.StartMarker.Line=this.Scanner.LineNumber,this.StartMarker.Column=this.Scanner.Index-this.Scanner.LineStart);var e=this.Scanner.Lex();return this.HasLineTerminator=n.LineNumber!=e.LineNumber,e&&this.Context.Strict&&e.Type==3,this.LookAhead=e,n},this.CollectComments=function(){this.Scanner.ScanComments()},this.ParseScript=function(){for(var n=this.CreateNode(),e=this.ParseDirectivePrologues();this.LookAhead.Type!=2;)e.push(this.ParseStatementListItem());return this.Finalize(n,this.Node.Script(e))},this.ParseDirective=function(){var n=this.LookAhead,e=this.CreateNode(),t=this.ParseExpression(),a=t.Type===vt.Literal?this.GetTokenRaw(n).slice(1,-1):null;return this.ConsumeSemicolon(),this.Finalize(e,a?this.Node.Directive(t,a):this.Node.ExpressionStatement(t))},this.ParseDirectivePrologues=function(){for(var n=[];;){var e=this.LookAhead;if(e.Type!=8)break;var t=this.ParseDirective();n.push(t)}return n},this.ParseStatementListItem=function(){var n=void 0;return this.Context.IsAssignmentTarget=!0,this.Context.IsBindingElement=!0,this.LookAhead.Type==4||(n=this.ParseStatement()),n},this.ParseStatement=function(){var n=void 0;switch(this.LookAhead.Type){case 1:case 5:case 6:case 8:case 10:case 9:n=this.ParseExpressionStatement();break;case 7:var e=this.LookAhead.Value;e==="("?n=this.ParseExpressionStatement():e===";"?n=this.ParseEmptyStatement():n=this.ParseExpressionStatement();break;case 3:n=this.ParseLabelledStatement();break;case 4:break;default:n="error"}return n},this.ParseEmptyStatement=function(){var n=this.CreateNode();return this.Expect(";"),this.Finalize(n,this.Node.EmptyStatement())},this.ParseLabelledStatement=function(){var n=this.CreateNode(),e=this.ParseExpression();this.ConsumeSemicolon();var t=new this.Node.ExpressionStatement(e);return this.Finalize(n,t)},this.ParseExpression=function(){var n=this.LookAhead,e=this.IsolateCoverGrammar(this.ParseAssignmentExpression);if(this.Match(",")){var t=[];for(t.push(e);this.LookAhead.Type!=2&&this.Match(",");)this.NextToken(),t.push(this.IsolateCoverGrammar(this.ParseAssignmentExpression));e=this.Finalize(this.StartNode(n),this.Node.SequenceExpression(t))}return e},this.ParseAssignmentExpression=function(){var n=void 0,e=this.LookAhead,t=e;if(n=this.ParseConditionalExpression(),this.MatchAssign()){if(!this.Context.IsAssignmentTarget){var a=n.Marker;this.ThrowUnexpectedError(a.Index,a.Line,a.Column,an.InvalidLHSInAssignment)}!this.Match("=")&&!this.Match(":")?(this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1):this.ReinterpretExpressionAsPattern(n),t=this.NextToken();var s=t.Value,o=this.IsolateCoverGrammar(this.ParseAssignmentExpression);n=this.Finalize(this.StartNode(e),this.Node.AssignmentExpression(s,n,o)),this.Context.FirstCoverInitializedNameError=null}return n},this.ParseConditionalExpression=function(){this.LookAhead;var n=this.InheritCoverGrammar(this.ParseBinaryExpression);return n},this.ParseBinaryExpression=function(){var n=this.LookAhead,e=this.InheritCoverGrammar(this.ParseExponentiationExpression),t=this.LookAhead,a=this.BinaryPrecedence(t);if(a>0){this.NextToken(),this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1;for(var s=[n,this.LookAhead],o=e,h=this.IsolateCoverGrammar(this.ParseExponentiationExpression),l=[o,t.Value,h],u=[a];a=this.BinaryPrecedence(this.LookAhead),!(a<=0);){for(;l.length>2&&a<=u[u.length-1];){h=l.pop();var f=l.pop();u.pop(),o=l.pop(),s.pop();var C=this.StartNode(s[s.length-1]);l.push(this.Finalize(C,this.Node.BinaryExpression(f,o,h)))}l.push(this.NextToken().Value),u.push(a),s.push(this.LookAhead),l.push(this.IsolateCoverGrammar(this.ParseExponentiationExpression))}var D=l.length-1;e=l[D];for(var v=s.pop();D>1;){var S=s.pop(),T=v&&v.LineStart,I=this.StartNode(S,T),F=l[D-1];e=this.Finalize(I,this.Node.BinaryExpression(F,l[D-2],e)),D-=2,v=S}}return e},this.ParseExponentiationExpression=function(){this.LookAhead;var n=this.InheritCoverGrammar(this.ParseUnaryExpression);return n},this.ParseUnaryExpression=function(){var n=void 0;if(this.Match("+")||this.Match("-")){var e=this.StartNode(this.LookAhead),t=this.NextToken();n=this.InheritCoverGrammar(this.ParseUnaryExpression),n=this.Finalize(e,this.Node.UnaryExpression(t.Value,n)),this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1}else n=this.ParseUpdateExpression();return n},this.ParseUpdateExpression=function(){var n=void 0;return this.LookAhead,n=this.InheritCoverGrammar(this.ParseLeftHandSideExpressionAllowCall),n},this.ParseLeftHandSideExpressionAllowCall=function(){var n=this.LookAhead,e=void 0;for(e=this.InheritCoverGrammar(this.ParsePrimaryExpression);;)if(this.Match(".")){this.Context.IsBindingElement=!1,this.Context.IsAssignmentTarget=!0,this.Expect(".");var t=this.ParseMemberIdentifierName();e=this.Finalize(this.StartNode(n),this.Node.StaticMemberExpression(e,t,n))}else if(this.Match("(")){this.Context.IsBindingElement=!1,this.Context.IsAssignmentTarget=!1;var a=this.ParseArguments();e=this.Finalize(this.StartNode(n),this.Node.CallExpression(e,a,n))}else break;return e},this.IsIdentifierName=function(n){return n.Type===3||n.Type===4||n.Type===1||n.Type===5},this.ParseIdentifierName=function(){var n=this.CreateNode(),e=this.NextToken();return this.IsIdentifierName(e)||this.ThrowUnexpectedToken(e),this.Finalize(n,this.Node.Identifier(e.Value,e))},this.ParseMemberIdentifierName=function(){var n=this.CreateNode(),e=this.NextToken();return this.IsIdentifierName(e)||this.ThrowUnexpectedToken(e),this.Finalize(n,this.Node.MemberIdentifier(e.Value,e))},this.ParseArguments=function(){this.Expect("(");var n=[];if(!this.Match(")"))for(;;){var e=this.IsolateCoverGrammar(this.ParseAssignmentExpression);if(n.push(e),this.Match(")")||(this.ExpectCommaSeparator(),this.Match(")")))break}return this.Expect(")"),n},this.ExpectCommaSeparator=function(){this.Expect(",")},this.ParsePrimaryExpression=function(){var n=this.CreateNode(),e=void 0,t,a;switch(this.LookAhead.Type){case 3:t=this.NextToken(),e=this.Finalize(n,this.Node.Identifier(t.Value,t));break;case 6:case 8:this.Context.IsAssignmentTarget=!1,this.Context.IsBindingElement=!1,t=this.NextToken(),a=this.GetTokenRaw(t),e=this.Finalize(n,this.Node.Literal(t.Value,a,t));break;case 7:switch(this.LookAhead.Value){case"(":this.Context.IsBindingElement=!1,e=this.InheritCoverGrammar(this.ParseGroupExpression);break;default:e=this.ThrowUnexpectedToken(this.NextToken())}break;default:e=this.ThrowUnexpectedToken(this.NextToken())}return e},this.ParseGroupExpression=function(){var n=void 0;if(this.Expect("("),this.Match(")"))this.NextToken();else{this.LookAhead;var e=!1;if(this.Context.IsBindingElement=!0,n=this.InheritCoverGrammar(this.ParseAssignmentExpression),this.Match(",")){var t=[];for(this.Context.IsAssignmentTarget=!1,t.push(n);this.LookAhead.Type!=2&&this.Match(",");)this.NextToken(),this.Match(")")}e||(this.Expect(")"),this.Context.IsBindingElement=!1)}return n},this.ParseExpressionStatement=function(){var n=this.CreateNode(),e=this.ParseExpression();return this.ConsumeSemicolon(),this.Finalize(n,this.Node.ExpressionStatement(e))},this.ConsumeSemicolon=function(){this.Match(";")?this.NextToken():this.HasLineTerminator||(this.LastMarker.Index=this.StartMarker.Index,this.LastMarker.Line=this.StartMarker.Line,this.LastMarker.Column=this.StartMarker.Column)},this.ReinterpretExpressionAsPattern=function(n){switch(n.Type){}},this.Finalize=function(n,e){return e.Marker={Line:n.Line,Column:n.Column,Index:n.Index},e},this.BinaryPrecedence=function(n){var e=n.Value,t=void 0;return n.Type===7?t=this.PeratorPrecedence[e]||0:t=0,t},this.IsolateCoverGrammar=function(n){var e=this.Context.IsBindingElement,t=this.Context.IsAssignmentTarget,a=this.Context.FirstCoverInitializedNameError;this.Context.IsBindingElement=!0,this.Context.IsAssignmentTarget=!0,this.Context.FirstCoverInitializedNameError=null;var s=n.call(this);return this.Context.FirstCoverInitializedNameError!=null,this.Context.IsBindingElement=e,this.Context.IsAssignmentTarget=t,this.Context.FirstCoverInitializedNameError=a,s},this.InheritCoverGrammar=function(n){var e=this.Context.IsBindingElement,t=this.Context.IsAssignmentTarget,a=this.Context.FirstCoverInitializedNameError;this.Context.IsBindingElement=!0,this.Context.IsAssignmentTarget=!0,this.Context.FirstCoverInitializedNameError=null;var s=n.call(this);return this.Context.IsBindingElement=this.Context.IsBindingElement&&e,this.Context.IsAssignmentTarget=this.Context.IsAssignmentTarget&&t,this.Context.FirstCoverInitializedNameError=a||this.Context.FirstCoverInitializedNameError,s},this.ThrowUnexpectedToken=function(n,e){throw this.UnexpectedTokenError(n,e)},this.ThrowUnexpectedError=function(n,e,t,a){var s=a||"执行异常";return this.ErrorHandler.ThrowError(n,e,t,s)},this.UnexpectedTokenError=function(n,e){var t=e||an.UnexpectedToken,a="ILLEGAL";if(n&&(a=n.Value),t=t.replace("%0",a),n&&typeof n.LineNumber=="number"){var s=n.Start,o=n.LineNumber,h=this.LastMarker.Index-this.LastMarker.Column,l=n.Start-h+1;return this.ErrorHandler.CreateError(s,o,l,t)}else{var u=this.LastMarker.Index,f=this.LastMarker.Line,C=this.LastMarker.Column+1;return this.ErrorHandler.CreateError(u,f,C,t)}}}function Di(r,n){this.ErrorHandler=r,this.SymbolData=n,this.Add=function(e,t){var a=typeof e=="number",s=typeof t=="number";if(a&&s)return e+t;var o=[];if(!a&&!s){for(var h=Math.max(e.length,t.length),l=0;l<h;++l)o[l]=null,l<e.length&&l<t.length&&this.IsNumber(e[l])&&this.IsNumber(t[l])&&(o[l]=e[l]+t[l]);return o}var u=void 0,f=void 0;a?(u=e,f=t):(u=t,f=e);for(var C in f)o[C]=null,this.IsNumber(f[C])&&this.IsNumber(u)&&(o[C]=u+f[C]);return o},this.Subtract=function(e,t){var a=typeof e=="number",s=typeof t=="number";if(a&&s)return e-t;var o=[];if(!a&&!s){for(var h=Math.max(e.length,t.length),l=0;l<h;++l)o[l]=null,l<e.length&&l<t.length&&this.IsNumber(e[l])&&this.IsNumber(t[l])&&(o[l]=e[l]-t[l]);return o}if(a)for(var u in t)o[u]=null,this.IsNumber(e)&&this.IsNumber(t[u])&&(o[u]=e-t[u]);else for(var f in e)o[f]=null,this.IsNumber(e[f])&&this.IsNumber(t)&&(o[f]=e[f]-t);return o},this.Multiply=function(e,t){var a=typeof e=="number",s=typeof t=="number";if(a&&s)return e*t;var o=[];if(!a&&!s){for(var h=Math.max(e.length,t.length),l=0;l<h;++l)o[l]=null,l<e.length&&l<t.length&&this.IsNumber(e[l])&&this.IsNumber(t[l])&&(o[l]=e[l]*t[l]);return o}var u=void 0,f=void 0;a?(u=e,f=t):(u=t,f=e);for(var C in f)o[C]=null,this.IsNumber(f[C])&&this.IsNumber(u)&&(o[C]=u*f[C]);return o},this.Divide=function(e,t){var a=typeof e=="number",s=typeof t=="number";if(a&&s)return t==0?null:e/t;var o=[];if(!a&&!s){for(var h=Math.max(e.length,t.length),l=0;l<h;++l)o[l]=null,l<e.length&&l<t.length&&this.IsNumber(e[l])&&this.IsDivideNumber(t[l])&&(o[l]=e[l]/t[l]);return o}if(a)for(var u in t)o[u]=null,this.IsNumber(e)&&this.IsDivideNumber(t[u])&&(o[u]=e/t[u]);else for(var f in e)o[f]=null,this.IsNumber(e[f])&&this.IsDivideNumber(t)&&(o[f]=e[f]/t);return o},this.GT=function(e,t){var a=typeof e=="number",s=typeof t=="number";if(a&&s)return e>t?1:0;var o=[];if(!a&&!s){for(var h=Math.max(e.length,t.length),l=0;l<h;++l)o[l]=null,l<e.length&&l<t.length&&!isNaN(e[l])&&!isNaN(t[l])&&(o[l]=e[l]>t[l]?1:0);return o}if(a)for(var u in t)o[u]=null,!isNaN(e)&&!isNaN(t[u])&&(o[u]=e>t[u]?1:0);else for(var f in e)o[f]=null,!isNaN(e[f])&&!isNaN(t)&&(o[f]=e[f]>t?1:0);return o},this.GTE=function(e,t){var a=typeof e=="number",s=typeof t=="number";if(a&&s)return e>=t?1:0;var o=[];if(!a&&!s){for(var h=Math.max(e.length,t.length),l=0;l<h;++l)o[l]=null,l<e.length&&l<t.length&&!isNaN(e[l])&&!isNaN(t[l])&&(o[l]=e[l]>=t[l]?1:0);return o}if(a)for(var u in t)o[u]=null,!isNaN(e)&&!isNaN(t[u])&&(o[u]=e>=t[u]?1:0);else for(var f in e)o[f]=null,!isNaN(e[f])&&!isNaN(t)&&(o[f]=e[f]>=t?1:0);return o},this.LT=function(e,t){var a=typeof e=="number",s=typeof t=="number";if(a&&s)return e<t?1:0;var o=[];if(!a&&!s){for(var h=Math.max(e.length,t.length),l=0;l<h;++l)o[l]=null,l<e.length&&l<t.length&&!isNaN(e[l])&&!isNaN(t[l])&&(o[l]=e[l]<t[l]?1:0);return o}if(a)for(var u in t)o[u]=null,!isNaN(e)&&!isNaN(t[u])&&(o[u]=e<t[u]?1:0);else for(var f in e)o[f]=null,!isNaN(e[f])&&!isNaN(t)&&(o[f]=e[f]<t?1:0);return o},this.LTE=function(e,t){var a=typeof e=="number",s=typeof t=="number";if(a&&s)return e>=t?1:0;var o=[];if(!a&&!s){for(var h=Math.max(e.length,t.length),l=0;l<h;++l)o[l]=null,l<e.length&&l<t.length&&!isNaN(e[l])&&!isNaN(t[l])&&(o[l]=e[l]<=t[l]?1:0);return o}if(a)for(var u in t)o[u]=null,!isNaN(e)&&!isNaN(t[u])&&(o[u]=e<=t[u]?1:0);else for(var f in e)o[f]=null,!isNaN(e[f])&&!isNaN(t)&&(o[f]=e[f]<=t?1:0);return o},this.EQ=function(e,t){var a=typeof e=="number",s=typeof t=="number";if(a&&s)return e==t?1:0;var o=[];if(!a&&!s){for(var h=Math.max(e.length,t.length),l=0;l<h;++l)o[l]=null,l<e.length&&l<t.length&&!isNaN(e[l])&&!isNaN(t[l])&&(o[l]=e[l]==t[l]?1:0);return o}if(a)for(var u in t)o[u]=null,!isNaN(e)&&!isNaN(t[u])&&(o[u]=e==t[u]?1:0);else for(var f in e)o[f]=null,!isNaN(e[f])&&!isNaN(t)&&(o[f]=e[f]==t?1:0);return o},this.NEQ=function(e,t){var a=typeof e=="number",s=typeof t=="number";if(a&&s)return e!=t?1:0;var o=[];if(!a&&!s){for(var h=Math.max(e.length,t.length),l=0;l<h;++l)o[l]=null,l<e.length&&l<t.length&&!isNaN(e[l])&&!isNaN(t[l])&&(o[l]=e[l]!=t[l]?1:0);return o}if(a)for(var u in t)o[u]=null,!isNaN(e)&&!isNaN(t[u])&&(o[u]=e!=t[u]?1:0);else for(var f in e)o[f]=null,!isNaN(e[f])&&!isNaN(t)&&(o[f]=e[f]!=t?1:0);return o},this.And=function(e,t){var a=typeof e=="number",s=typeof t=="number";if(a&&s)return e&&t?1:0;var o=[];if(!a&&!s){for(var h=Math.max(e.length,t.length),l=0;l<h;++l)o[l]=null,l<e.length&&l<t.length&&!isNaN(e[l])&&!isNaN(t[l])&&(o[l]=e[l]&&t[l]?1:0);return o}if(a)for(var u in t)o[u]=null,!isNaN(e)&&!isNaN(t[u])&&(o[u]=e&&t[u]?1:0);else for(var f in e)o[f]=null,!isNaN(e[f])&&!isNaN(t)&&(o[f]=e[f]&&t?1:0);return o},this.Or=function(e,t){var a=typeof e=="number",s=typeof t=="number";if(a&&s)return e||t?1:0;var o=[];if(!a&&!s){for(var h=Math.max(e.length,t.length),l=0;l<h;++l)o[l]=null,l<e.length&&l<t.length&&!isNaN(e[l])&&!isNaN(t[l])&&(o[l]=e[l]||t[l]?1:0);return o}if(a)for(var u in t)o[u]=null,!isNaN(e)&&!isNaN(t[u])&&(o[u]=e||t[u]?1:0);else for(var f in e)o[f]=null,!isNaN(e[f])&&!isNaN(t)&&(o[f]=e[f]||t?1:0);return o},this.IF=function(e,t,a){var s=this.IsNumber(e),o=this.IsNumber(t),h=this.IsNumber(a),l=Array.isArray(t),u=Array.isArray(a);if(s)return e?t:a;var f=[];for(var C in e)e[C]?o?f[C]=t:l?f[C]=t[C]:f[C]=null:h?f[C]=a:u?f[C]=a[C]:f[C]=null;return f},this.IFN=function(e,t,a){return this.IF(e,a,t)},this.REF=function(e,t){var a=[];if(typeof t=="number"){if(e.length<=0||t>=e.length)return a;a=e.slice(0,e.length-t);for(var s=e[0],o=0;o<t;++o)a.unshift(s)}else for(var h=0;h<e.length;++h)if(a[h]=null,!(h>=t.length)){var l=t[h];l>=0&&l<=h?a[h]=e[h-l]:h?a[h]=a[h-1]:a[h]=e[h]}return a},this.REFV=function(e,t){var a=[];if(typeof t=="number"){if(e.length<=0||t>=e.length)return a;a=e.slice(0,e.length-t);for(var s=0;s<t;++s)a.unshift(null)}else for(var o=0;o<e.length;++o)if(a[o]=null,!(o>=t.length)){var h=t[o];h>=0&&h<=o&&(a[o]=e[o-h])}return a},this.REFX=function(e,t){var a=[];if(typeof t=="number"){if(e.length<=0)return a;if(t>=e.length)return e.length>0?e[e.length-1]:a;a=e.slice(t,e.length);for(var s=e[e.length-1],o=0;o<t;++o)a.push(s)}else for(var h=e.length,l=0;l<e.length;++l)if(a[l]=null,!(l>=t.length)){var u=t[l];u>=0&&u+l<h?a[l]=e[l+u]:l?a[l]=a[l-1]:a[l]=e[l]}return a},this.REFXV=function(e,t){var a=[];if(typeof t=="number"){if(e.length<=0||t>=e.length)return a;a=e.slice(t,e.length);for(var s=0;s<t;++s)a.push(null)}else for(var o=e.length,h=0;h<e.length;++h)if(a[h]=null,!(h>=t.length)){var l=t[h];l>=0&&l+h<o&&(a[h]=e[h+l])}return a},this.MAX=function(e,t){if(e.length==0&&this.ThrowUnexpectedNode(t,"MAX() Error: 参数个数不能为0"),e.length==1)return e[0];var a=[],s=[];for(var o in e){var h=e[o];c.IsNumber(h)?s.push(h):Array.isArray(h)&&a.push(h)}var l=null;if(s.length>0){l=s[0];for(var o=1;o<s.length;++o)l=Math.max(l,s[o])}var u=null;if(a.length>0){u=a[0].slice(0);for(var o=1;o<a.length;++o){var f=a[o];for(var C in f){var D=u[C],h=f[C];if(c.IsNumber(D)){if(!c.IsNumber(h)){u[C]=null;continue}u[C]=Math.max(D,h)}}}}if(u==null&&l!=null)return l;if(u&&l==null)return u;for(var o in u)c.IsNumber(u[o])&&(u[o]=Math.max(u[o],l));return u},this.MIN=function(e,t){if(e.length==0&&this.ThrowUnexpectedNode(t,"MIN() Error: 参数个数不能为0"),e.length==1)return e[0];var a=[],s=[];for(var o in e){var h=e[o];c.IsNumber(h)?s.push(h):Array.isArray(h)&&a.push(h)}var l=null;if(s.length>0){l=s[0];for(var o=1;o<s.length;++o)l=Math.min(l,s[o])}var u=null;if(a.length>0){u=a[0].slice(0);for(var o=1;o<a.length;++o){var f=a[o];for(var C in f){var D=u[C],h=f[C];if(c.IsNumber(D)){if(!c.IsNumber(h)){u[C]=null;continue}u[C]=Math.min(D,h)}}}}if(u==null&&l!=null)return l;if(u&&l==null)return u;for(var o in u)c.IsNumber(u[o])&&(u[o]=Math.min(u[o],l));return u},this.ABS=function(e){var t=[];for(var a in e)t[a]=null,isNaN(e[a])||(t[a]=Math.abs(e[a]));return t},this.MA=function(e,t){var a=[];if(t<=0)return a;if(Array.isArray(t)){for(var s=0;s<e.length;++s)if(a[s]=null,!(s>=t.length)){var C=t[s];if(this.IsNumber(C)&&!(C<=0)){for(var D=0,v=0,S=s,T=0;S>=0&&T<C;--S,++T)D+=e[S],++v;v>0&&(a[s]=D/v)}}}else{if(t<=0&&(t=1),!e||!e.length)return a;for(var s=0;s<e.length&&(a[s]=null,!this.IsNumber(e[s]));++s);for(var e=e.slice(0),o=0;s<e.length;++s,++o){if(o<t-1){a[s]=null;continue}for(var h=e[s-(t-1)],l=0,u=t-1;u>=0;--u){var f=e[s-u];this.IsNumber(f)?h=f:(f=h,e[s-u]=f),l+=f}a[s]=l/t}}return a},this.EMA=function(e,t){var a=[];if(e.length<=0)return a;if(Array.isArray(t))for(var s=0;s<t.length;++s){var o=t[s];if(this.IsNumber(o)&&(o=parseInt(o),!(o<=0))){o>s+1&&(o=s+1);for(var h=[2/(o+1),(o-1)/(o+1)],l=null,u=null,f=0;f<o;++f){var C=s-(o-f-1),D=e[C];this.IsNumber(D)||coninue,u==null?(l=D,u=l):(l=h[0]*D+h[1]*u,u=l)}a[s]=l}}else{if(t<=0)return a;for(var v=0;v<e.length&&!(e[v]!=null&&!isNaN(e[v]));++v);var S=v,T=v+1;a[S]=e[S];for(var s=v+1;s<e.length;++s,++S,++T)a[T]=(2*e[T]+(t-1)*a[S])/(t+1)}return a},this.XMA=function(e,t){for(var a=[],s=0;s<e.length&&!this.IsNumber(e[s]);++s);for(var o=parseInt((t-2)/2),h=0,l=0,u=0,f=0,C=s,D=0;C<e.length;++C){for(u=C-o-1,f=C+(t-o)-1,D=u;D<f;++D)D>=0&&D<e.length&&this.IsNumber(e[D])&&(h+=e[D],++l);l!=0?a[C]=h/l:a[C]=null,h=0,l=0}return a},this.SMA=function(e,t,a){var s=[];if(Array.isArray(t))for(var o=0;o<t.length;++o){var h=t[o];if(this.IsNumber(h)&&(h=parseInt(h),!(h<=0))){h>o+1&&(h=o+1);for(var l=null,u=null,f=0;f<h;++f){var C=o-(h-f-1),D=e[C];this.IsNumber(D)&&(l==null?(l=D,u=D):(u=(a*D+(h-a)*l)/h,l=u))}s[o]=u}}else{for(var o=0,v=null;o<e.length;++o)if(!(e[o]==null||isNaN(e[o]))){v=e[o],s[o]=v;break}for(++o;o<e.length;++o)s[o]=(a*e[o]+(t-a)*v)/t,v=s[o]}return s},this.DMA=function(e,t){var a=[];if(e.length<0||e.length!=t.length)return a;for(var s=0;s<e.length;++s)if(e[s]!=null&&!isNaN(e[s])&&t[s]!=null&&!isNaN(t[s])){a[s]=e[s];break}for(s=s+1;s<e.length;++s)e[s]==null||t[s]==null?a[s]=null:t[s]<1?a[s]=t[s]*e[s]+(1-t[s])*a[s-1]:a[s]=e[s];return a},this.WMA=function(e,t){var a=[];if(!e||!e.length)return a;if(Array.isArray(t)){for(S=0;S<t.length&&S<e.length;++S){a[S]=null;var s=t[S];if(!(s<=0)){for(var o=0,h=0,l=0,u=0,f=0;f<s;++f)if(l=S-(s-f-1),h=e[l],o=f,this.IsNumber(h)){u=h;break}if(!(o>=s)){for(var C=0,D=0,f=o,v=1;f<s;++f,++v)l=S-(s-f-1),h=e[l],this.IsNumber(h)?u=h:h=u,D+=v,C+=h*v;a[S]=C/D}}}return a}else{if(t<=0)return[];var S=0;for(S=0;S<e.length&&!this.IsNumber(e[S]);++S)a[S]=null;for(var e=e.slice(0),T=0;S<e.length;++S,++T){if(T<t-1){a[S]=null;continue}for(var u=e[S-(t-1)],C=0,D=0,f=t-1;f>=0;--f){var h=e[S-f];this.IsNumber(h)?u=h:(h=u,e[S-f]=h),D+=t-f,C+=h*(t-f)}a[S]=C/D}return a}},this.MEMA=function(l,t){var a=[];if(!l||!l.length)return a;var s=0,o=0;for(o=0;o<l.length&&!this.IsNumber(l[o]);++o)a[o]=null;if(s=o,t<1||s+t>=l.length)return a;for(var h=0,l=l.slice(0);s<o+t;++s)a[s]=null,!this.IsNumber(l[s])&&s-1>=0&&(l[s]=l[s-1]),h+=l[s];for(a[s-1]=h/t;s<l.length;++s)this.IsNumber(a[s-1])&&this.IsNumber(l[s])?a[s]=(l[s]+a[s-1]*(t-1))/t:s-1>-1&&this.IsNumber(a[s-1])?a[s]=a[s-1]:a[s]=null;return a},this.EXPMA=function(e,t){var a=[];if(t>=e.length)return a;for(var s=t;s<e.length;++s)if(e[s]!=null){a[s]=e[s];break}for(s=s+1;s<e.length;++s)a[s-1]!=null&&e[s]!=null?a[s]=(2*e[s]+(t-1)*a[s-1])/(t+1):a[s-1]!=null&&(a[s]=a[s-1]);return a},this.EXPMEMA=function(e,t){var a=[];if(t>=e.length)return a;for(var s=0;s<e.length&&!(e[s]&&!isNaN(e[s]));++s);for(var o=0,h=0;s<e.length&&h<t;++h,++s)e[s]&&!isNaN(e[s])?o+=e[s]:o+=e[s-1];for(a[s-1]=o/t;s<e.length;++s)a[s-1]!=null&&e[s]!=null?a[s]=(2*e[s]+(t-1)*a[s-1])/(t+1):a[s-1]!=null&&(a[s]=a[s-1]);return a},this.SUMBARS=function(e,t){var a=[];if(!e||!e.length||!t||!t.length)return a;for(var s=0,o=0,h=0;s<e.length&&!this.IsNumber(e[s]);++s)a[s]=null;for(o=e.length-1;o>=s;--o){var l=0;for(h=o,l=0;h>=s&&l<t[o];--h)l+=e[h];h<s?a[o]=null:a[o]=o-h}for(o=s+1;o<e.length;++o)a[o]==null&&(a[o]=a[o-1]);return a},this.REVERSE=function(e){if(this.IsNumber(e))return 0-e;for(var t=[],a=0;a<e.length&&!this.IsNumber(e[a]);++a)t[a]=null;for(;a<e.length;++a)this.IsNumber(e[a])?t[a]=0-e[a]:t[a]=null;return t},this.COUNT=function(e,t){if(Array.isArray(t)){for(var a=null,s=e.length,o=0;o<s;++o)if(this.IsNumber(e[o])){a=o;break}if(a==null)return[];for(var h=[],l=0,o=0;o<t.length;++o){var u=t[o];if(c.IsNumber(u)){u<1&&(u=o+1),l=0;for(var f=o,C=0;f>=0&&C<u;--f,++C)e[f]&&++l;h[o]=l}}return h}else{for(var u=t,s=e.length,u=u<1?s:u,o=0,f=0;o<s&&!this.IsNumber(e[o]);++o);for(var h=[],D=0;o<s&&f<u;++o,++f)D=e[o]?D+1:D,h[o]=D;for(;o<s;++o)e[o-u]&&D&&D--,D=e[o]?D+1:D,h[o]=D;return h}},this.HHV=function(e,t){var a=[];if(Array.isArray(t)){for(var s=null,o=0,h=0;o<e.length;++o)if(a[o]=null,!(o>=t.length)){s=null;var l=t[o];if(l>0&&l<=o)for(h=o-l;h<=o;++h)(s==null||s<e[h])&&(s=e[h]);else for(l=o,h=0;h<=o;++h)(s==null||s<e[h])&&(s=e[h]);a[o]=s}}else{if(!c.IsNonEmptyArray(e))return a;(t<=0||t>e.length)&&(t=e.length);var u=this.GetFirstVaildIndex(e);if(u>=e.length)return a;var f=u;f<e.length&&(a[f]=e[f]);for(var o=f+1,h=2;o<e.length&&h<t;++o,++h)e[o]>=e[f]&&(f=o),a[o]=e[f];for(;o<e.length;++o){if(o-f<t)f=e[o]<e[f]?f:o;else for(h=f=o-t+1;h<=o;++h)f=e[h]<e[f]?f:h;a[o]=e[f]}}return a},this.HV=function(e,t){var a=this.HHV(e,t);return this.REF(a,1)},this.LLV=function(e,t){var a=[];if(Array.isArray(t)){for(var s=0;s<e.length;++s)if(a[s]=null,!(s>=t.length)){var o=null,h=t[s];if(h>0&&h<=s)for(var l=s-h;l<=s;++l)(o==null||o>e[l])&&(o=e[l]);else{h=s;for(var l=0;l<=s;++l)(o==null||o>e[l])&&(o=e[l])}a[s]=o}}else{if(!c.IsNonEmptyArray(e))return a;(t<=0||t>e.length)&&(t=e.length);var u=this.GetFirstVaildIndex(e);if(u>=e.length)return a;var f=u;f<e.length&&(a[f]=e[f]);for(var s=f+1,l=2;s<e.length&&l<t;++s,++l)e[s]<=e[f]&&(f=s),a[s]=e[f];for(;s<e.length;++s){if(s-f<t)f=e[s]>e[f]?f:s;else for(l=f=s-t+1;l<=s;++l)f=e[l]>e[f]?f:l;a[s]=e[f]}}return a},this.LV=function(e,t){var a=this.LLV(e,t);return this.REF(a,1)},this.STD=function(e,t){var a=[];if(!Array.isArray(e))return a;var s=this.GetFirstVaildIndex(e);if(!c.IsNumber(t)||s+t>e.length||t<1)return a;var o=s,h=0,l=!0,u=0,f=0;for(o+=t-1;o<e.length;++o){if(u=0,l){for(l=!1,h=o-t+1;h<=o;++h)f+=e[h];f/=t}else f+=(e[o]-e[o-t])/t;for(h=o-t+1;h<=o;++h)u+=(e[h]-f)*(e[h]-f);a[o]=Math.sqrt(u/(t-1))}return a},this.AVEDEV=function(e,t){for(var a=[],s=0,o=[],h=t-1;h<e.length;++h){s=0;for(var l=0;l<t;++l)s+=e[h-l];o[h]=s/t}for(var h=t-1;h<e.length;++h){s=0;for(var l=0;l<t;++l)s+=Math.abs(e[h-l]-o[h]);a[h]=s/t}return a},this.CROSS=function(e,t){var a=[];if(Array.isArray(e)&&Array.isArray(t)){if(e.length!=t.length)return a=[];for(var s=0;s<e.length&&!(this.IsNumber(e[s])&&this.IsNumber(t[s]));++s);for(++s;s<e.length;++s)a[s]=e[s]>t[s]&&e[s-1]<t[s-1]?1:0}else if(Array.isArray(e)&&typeof t=="number"){for(var s=0;s<e.length&&!this.IsNumber(e[s]);++s);for(++s;s<e.length;++s)a[s]=e[s]>t&&e[s-1]<t?1:0}else if(typeof e=="number"&&Array.isArray(t)){for(var s=0;s<t.length&&!this.IsNumber(t[s]);++s);for(++s;s<t.length;++s)a[s]=t[s]<e&&t[s-1]>e?1:0}return a},this.CROSSDOWN=function(e,t){return this.CROSS(t,e)},this.CROSSUP=function(e,t){return this.CROSS(e,t)},this.MULAR=function(e,t){var a=[];if(Array.isArray(t))for(var o=0;o<e.length;++o){a[o]=null;var u=t[o];if(this.IsNumber(u)&&(u=parseInt(u),!(u<0)))for(var h=o,l=0;h>=0&&l<u;--h,++l)l==0?a[o]=e[h]:a[o]*=e[h]}else{if(e.length<t)return a;if(t==0){for(var s=t;s<e.length;++s)if(this.IsNumber(e[s])){a[s]=e[s];break}for(++s;s<e.length;++s)a[s]=a[s-1]*e[s]}else for(var o=t-1,h=0;o<e.length;++o,++h)for(var l=0;l<t;++l)l==0?a[o]=e[l+h]:a[o]*=e[l+h]}return a},this.SUM=function(e,t){var a=[];if(Array.isArray(t))for(var s=0;s<e.length;++s){a[s]=null;var l=t[s];if(l>0)for(var o=s,h=0;o>=0&&h<l;--o,++h)h==0?a[s]=e[o]:a[s]+=e[o]}else if(t==0){a[0]=e[0];for(var s=1;s<e.length;++s)a[s]=a[s-1]+e[s]}else for(var s=t-1,o=0;s<e.length;++s,++o)for(var h=0;h<t;++h)h==0?a[s]=e[h+o]:a[s]+=e[h+o];return a},this.BARSCOUNT=function(e){var t=[],a=null;for(var s in e){if(t[s]=0,a==null){if(!this.IsNumber(e[s]))continue;a=0}t[s]=a,++a}return t},this.DEVSQ=function(e,t){if(this.IsNumber(e)&&this.IsNumber(t))return 0;var a=[];if(Array.isArray(e)){var s=null;if(Array.isArray(t)){for(var h=t.length-1;h>=0;--h)if(this.IsNumber(t[h])){s=parseInt(t[h]);break}}else s=parseInt(t);if(!this.IsNumber(s))return a;var o=e.length,h=0,l=0,u=0,f=0,C=0;for(h=0;h<o&&!this.IsNumber(e[h]);++h)a[h]=null;if(s<1||h+s>o)return a;for(f=0;h<o&&l<s;++h,++l)f+=e[h]/s;if(l==s){for(C=0,h--;u<s;u++)C+=(e[h-u]-f)*(e[h-u]-f);a[h]=C,h++}for(;h<o;++h){for(f+=(e[h]-e[h-s])/s,C=0,u=0;u<s;++u)C+=(e[h-u]-f)*(e[h-u]-f);a[h]=C}}return a},this.NOT=function(e){var t=typeof e=="number";if(t)return e?0:1;var a=[];for(var s in e)a[s]=null,this.IsNumber(e[s])&&(a[s]=e[s]?0:1);return a},this.FORCAST=function(e,t){var a=[];typeof t!="number"&&(t=parseInt(t));var s=t,o=e.length;if(s<1||s>=o)return a;var h=0,l=0,u=0,f=0,C,D,v,S,T;for(S=0;S<o&&!this.IsNumber(e[S]);++S)a[S]=null;for(v=S+s-1;v<o;++v){for(h=l=u=f=0,S=0,T=s;S<s&&S<=v;++S,--T)h+=T,l+=e[v-S];for(h/=s,l/=s,S=0,T=s;S<s&&S<=v;++S,--T)u+=(T-h)*(e[v-S]-l),f+=(T-h)*(T-h);D=u/f,C=l-h*D,a[v]=D*s+C}return a},this.TSMA=function(e,t){var a=[];typeof t!="number"&&(t=parseInt(t));var s=t,o=e.length;if(s<1||s>=o)return a;var h=0,l=0,u=0,f=0,C,D,v,S,T;for(S=0;S<o&&!this.IsNumber(e[S]);++S)a[S]=null;for(v=S+s-1;v<o;++v){for(h=l=u=f=0,S=0,T=s;S<s&&S<=v;++S,--T)h+=T,l+=e[v-S];for(h/=s,l/=s,S=0,T=s;S<s&&S<=v;++S,--T)u+=(T-h)*(e[v-S]-l),f+=(T-h)*(T-h);D=u/f,C=l-h*D,a[v]=D*s+C+D}return a},this.SLOPE=function(e,t){var a=[];if(typeof t!="number"&&(t=parseInt(t)),t<1||!e.length||t>=e.length)return a;for(var s=0,o=0;o<e.length&&(a[o]=null,!this.IsNumber(e[o]));++o,++s);for(var h=void 0,l=void 0,u=void 0,f=void 0,C=s+t-1;C<e.length;++C){a[C]=null,h=l=u=f=0;for(var D=0;D<t&&D<=C;++D)h+=C-D,l+=e[C-D];for(h=h/t,l=l/t,D=0;D<t&&D<=C;++D)u+=(C-D-h)*(e[C-D]-l),f+=(C-D-h)*(C-D-h);f?a[C]=u/f:C&&(a[C]=a[C-1])}return a},this.STDP=function(e,t){var a=[];if(!Array.isArray(e))return a;var s=this.GetFirstVaildIndex(e);if(!c.IsNumber(t)||s+t>e.length||t<1)return a;var o=s,h=0,l=!0,u=0,f=0;for(o+=t-1;o<e.length;++o){if(u=0,l){for(l=!1,h=o-t+1;h<=o;++h)f+=e[h];f/=t}else f+=(e[o]-e[o-t])/t;for(h=o-t+1;h<=o;++h)u+=(e[h]-f)*(e[h]-f);a[o]=Math.sqrt(u/t)}return a},this.VAR=function(e,t){if(this.IsNumber(e)&&this.IsNumber(t))return 0;var a=[];if(Array.isArray(e)&&this.IsNumber(t)){var s=parseInt(t),o=e.length;if(s<=0||s>=o)return a;var h,l;for(h=0;h<o&&!this.IsNumber(e[h]);++h)a[h]=null;var u,f;for(l=0,h=h+s-1;h<o;++h){for(u=f=0,l=0;l<s&&l<=h;++l)u+=e[h-l]*e[h-l],f+=e[h-l];a[h]=(s*u-f*f)/s*(s-1)}}else if(Array.isArray(e)&&Array.isArray(t))for(var C=this.GetFirstVaildIndex(e),h=C;h<e.length;++h){var u=f=0;if(this.IsNumber(t[h])){var s=parseInt(t[h]);if(!(s<=0||h-(s-1)<0)){for(var l=0;l<s;++l)u+=e[h-l]*e[h-l],f+=e[h-l];a[h]=(s*u-f*f)/s*(s-1)}}}return a},this.VARP=function(e,t){var a=[];typeof t!="number"&&(t=parseInt(t));var s=t,o=e.length;if(s<1||s>=o)return a;var h=0,l=0;for(h=0;h<o&&!this.IsNumber(e[h]);++h)a[h]=null;for(var u=0,f=0;h<o&&l<s;++h,++l)u+=e[h]*e[h],f+=e[h];for(l==s&&(a[h-1]=(s*u-f*f)/(s*s));h<o;++h)u+=e[h]*e[h]-e[h-s]*e[h-s],f+=e[h]-e[h-s],a[h]=(s*u-f*f)/(s*s);return a},this.RANGE=function(e,t,a){var s=typeof e=="number",o=typeof t=="number",h=typeof a=="number";if(s&&o&&h)return e>Math.min(t,a)&&e<Math.max(t,a)?1:0;for(var l=[],u=void 0,f=void 0,C=0;C<e.length;++C)if(l[C]=null,u=e[C],!!this.IsNumber(u)){if(o)f=t;else{if(C>=t.length)continue;f=t[C]}if(this.IsNumber(f)){if(h)rangeValue2=a;else{if(C>=a.length)continue;rangeValue2=a[C]}this.IsNumber(rangeValue2)&&(l[C]=u>Math.min(f,rangeValue2)&&u<Math.max(f,rangeValue2)?1:0)}}return l},this.EXIST=function(e,t){if(typeof e=="number")return 0;if(Array.isArray(t)){var a=[];if(e.length<=0)return a;for(var s in e)a[s]=0;for(var s=0;s<t.length&&s<e.length;++s){var o=t[s];if(this.IsNumber(o)&&(o=parseInt(o),!(o<=0))){o>s+1&&(o=s+1);for(var h=!1,l=0,u=0;u<o;++u)if(l=e[s],this.IsNumber(l)&&l>0){h=!0;break}a[s]=h?1:0}}return a}else{t=parseInt(t);for(var f=null,a=[],l,C=0;C<e.length;++C)a[C]=null,l=e[C],this.IsNumber(l)&&l>0&&(f=C),f!=null&&C-f<t?a[C]=1:a[C]=0;return a}},this.TFILTER=function(e,t,a){if(!this.IsNumber(a))return[];if(a==1)return this.And(e,this.EQ(this.COUNT(e,this.BARSLAST(t)),1));if(a==2)return this.And(t,this.EQ(this.COUNT(t,this.BARSLAST(e)),1));if(a==0){for(var s=this.And(t,this.EQ(this.COUNT(t,this.BARSLAST(e)),1)),o=this.And(t,this.EQ(this.COUNT(t,this.BARSLAST(e)),1)),h=0;h<s.length;++h){var l=o[h];l>0&&(s[h]=2)}return s}return[]},this.FILTER=function(e,t){for(var a=[],s=0,o=0;s<e.length;++s)if(e[s]){for(a[s]=1,o=0;o<t&&o+s+1<e.length;++o)a[o+s+1]=0;s+=t}else a[s]=0;return a},this.BARSLAST=function(e){var t=[];if(!e)return t;for(var a=null,s=0;s<e.length;++s)t[s]=null,e[s]>0?a=0:a!=null&&++a,a!=null&&(t[s]=a);return t},this.BARSSINCEN=function(e,t){var a=[];if(this.IsNumber(t)&&Array.isArray(e)){var s=t;s<1&&(s=e.length);var o=this.GetFirstVaildIndex(e);if(o>=e.length)return a;var h=0;for(o<=s-1?h=s-1:h=o,a[h]=h-o;h<e.length;++h)if(this.IsNumber(a[h-1])){if(a[h-1]+1<s)a[h]=a[h-1]+1;else for(var l=h-s+1;l<=h;++l)if(!(Math.abs(e[l])<1e-6)){a[h]=h-l;break}}else Math.abs(e[h])<1e-6||(a[h]=0)}return a},this.BARSSINCE=function(e){for(var t=[],a=null,s=0;s<e.length;++s)t[s]=null,a==null?e[s]&&(a=0):++a,a&&(t[s]=a);return t},this.Trigonometric=function(e,t){if(Array.isArray(e)){var a=[];for(var s in e){var o=e[s];this.IsNumber(o)?a[s]=t(o):a[s]=null}return a}else return this.IsNumber(e)?t(e):null},this.ASIN=function(e){if(Array.isArray(e)){var t=[];for(var a in e){var s=e[a];if(t[a]=null,this.IsNumber(s)){if(s>=-1&&s<=1)t[a]=Math.asin(s);else if(a-1>=0){var o=t[a-1];this.IsNumber(o)&&(t[a]=o)}}}return t}else return this.IsNumber(e)?Math.acos(e):null},this.ACOS=function(e){if(Array.isArray(e)){var t=[];for(var a in e){var s=e[a];if(t[a]=null,this.IsNumber(s)){if(s>=-1&&s<=1)t[a]=Math.acos(s);else if(a-1>=0){var o=t[a-1];this.IsNumber(o)&&(t[a]=o)}}}return t}else return this.IsNumber(e)?Math.acos(e):null},this.LAST=function(e,t,a){if(!Array.isArray(e))return[];for(var s=[],o=e.length,h=t,l=a,u=0,f=0,C=0,D=0;u<o&&!e[u];++u);for(f=u,D=u-l+1;f<o;++f,++D){for(C=h==0?u:Math.max(u,f-h);C<D&&!(e[C]<=0);++C);s[f]=C<D?0:1}return s},this.ZIG=function(e,t){var a=this.SymbolData.Data,s=[];if(typeof e=="number")switch(e){case 0:e=a.GetOpen();break;case 1:e=a.GetHigh();break;case 2:e=a.GetLow();break;case 3:e=a.GetClose();break;default:return s}return this.ZIG_Calculate(e,t)},this.GetFirstVaildIndex=function(e){for(var t=0;t<e.length;++t)if(this.IsNumber(e[t]))return t;return e.length},this.ZIG_Calculate=function(e,t){var a=[],s=e.length,o=this.GetFirstVaildIndex(e),h=0,l=0,u=0,f=0,C=0;for(h=o+1,l=u=o;h<s-1&&u==o;++h)u=Math.abs(e[h]-e[o])*100>=t*e[o]?e[h]>e[o]?h:-h:o;for(;h<s-1;++h)if(e[h]>=e[h-1]&&e[h]>=e[h+1])if(u<0){if((e[h]-e[-u])*100<t*e[-u])continue;for(C=(e[l]-e[f=-u])/(-u-l),a[f--]=e[-u];f>=l;f--)a[f]=e[-u]+(-u-f)*C;l=-u,u=h}else e[h]>e[u]&&(u=h);else if(e[h]<=e[h-1]&&e[h]<=e[h+1])if(u>0){if((e[u]-e[h])*100<t*e[u])continue;for(C=(e[u]-e[f=l])/(u-l),a[f++]=e[l];f<=u;++f)a[f]=e[l]+(f-l)*C;l=u,u=-h}else e[h]<e[-u]&&(u=-h);if(Math.abs(u)>=s-2&&(u>0&&e[s-1]>=e[u]&&(u=s-1),u<0&&e[s-1]<=e[-u]&&(u=1-s)),u>0)for(C=(e[u]-e[f=l])/(u-l),a[f++]=e[l];f<=u;++f)a[f]=e[l]+(f-l)*C;else for(C=(e[l]-e[f=-u])/(-u-l),a[f--]=e[-u];f>=l;f--)a[f]=e[-u]+(-u-f)*C;if((u=Math.abs(u))<s-1)if(e[s-1]>=e[u])for(C=(e[s-1]-e[f=u])/(s-u),a[f++]=e[u];f<s;++f)a[f]=e[u]+(f-u)*C;else for(C=(e[u]-e[f=s-1])/(s-u),a[f--]=e[s-1];f>=u;f--)a[f]=e[s-1]+(s-f)*C;return a},this.JSDraw=null,this.CalculateZIGLine=function(e,t,a,s,o){this.JSDraw==null&&(this.JSDraw=new Pr(this.ErrorHandler));var h=t.Up,l=e;if(h)for(var u=e.ID+1;u<a.ID;++u){var f=s[u];this.IsNumber(f)&&l.Value<f&&(l={ID:u,Value:f})}else for(var u=e.ID+1;u<a.ID;++u){var f=s[u];this.IsNumber(f)&&l.Value>f&&(l={ID:u,Value:f})}t.Value=l.Value,t.ID=l.ID;var C={Start:{ID:e.ID,Value:e.Value},End:{ID:t.ID,Value:t.Value}},D=this.JSDraw.CalculateDrawLine(C);for(var u in D){var v=D[u];o[v.ID]=v.Value}if(a.ID==s.length-1){C={Start:{ID:t.ID,Value:t.Value},End:{ID:a.ID,Value:a.Value}},D=this.JSDraw.CalculateDrawLine(C);for(var u in D){var v=D[u];o[v.ID]=v.Value}}else e.ID=t.ID,e.Value=t.Value,t.ID=a.ID,t.Value=a.Value,t.Up=e.Value<t.Value},this.TROUGHBARS=function(e,t,a){var s=this.ZIG(e,t),o=[],h=a;if(h<1)return o;for(var l=s.length,u=[],C=0;C<h;++C)u[C]=0;var f=0,C=this.GetFirstVaildIndex(s)+1;for(h--;C<l&&s[C]>s[C-1];++C);for(;C<l&&s[C]<s[C-1];++C);for(u[0]=--C;C<l-1;++C){if(s[C]<s[C+1]){if(f){if(h)for(var D=u.slice(0),v=0;v<h;++v)u[v+1]=D[v];u[f=0]=C}}else f=1;u[h]&&(o[C]=C-u[h])}return u[h]&&(o[C]=C-u[h]),o},this.TROUGH=function(e,t,a){var s=this.ZIG(e,t),o=[],h=a;if(h<1)return o;for(var l=s.length,u=[],C=0;C<h;++C)u[C]=0;var C=1,f=0,C=this.GetFirstVaildIndex(s)+1;for(h--;C<l&&s[C]>s[C-1];++C);for(;C<l&&s[C]<s[C-1];++C);for(u[0]=--C;C<l-1;++C){if(s[C]<s[C+1]){if(f){if(h)for(var D=u.slice(0),v=0;v<h;++v)u[v+1]=D[v];u[f=0]=C}}else f=1;u[h]&&(o[C]=s[u[h]])}return u[h]&&(o[C]=s[u[h]]),o},this.PEAKBARS=function(e,t,a){var s=this.ZIG(e,t),o=[],h=s.length,l=a;if(l<1)return o;for(var u=[],C=0;C<l;++C)u[C]=0;var f=0,C=this.GetFirstVaildIndex(s)+1;for(l--;C<h&&s[C]<s[C-1];++C);for(;C<h&&s[C]>s[C-1];++C);for(u[0]=--C;C<h-1;++C){if(s[C]>s[C+1]){if(f){if(l)for(var D=u.slice(0),v=0;v<l;++v)u[v+1]=D[v];u[f=0]=C}}else f=1;u[l]&&(o[C]=C-u[l])}return u[l]&&(o[C]=C-u[l]),o},this.PEAK=function(e,t,a){var s=this.ZIG(e,t),o=[],h=s.length,l=a;if(l<1)return o;for(var u=0,f=[],C=0;C<l;++C)f[C]=0;var C=this.GetFirstVaildIndex(s)+1;for(l--;C<h&&s[C]<s[C-1];++C);for(;C<h&&s[C]>s[C-1];++C);for(f[0]=--C;C<h-1;++C){if(s[C]>s[C+1]){if(u){if(l)for(var D=f.slice(0),v=0;v<l;++v)f[v+1]=D[v];f[u=0]=C}}else u=1;f[l]&&(o[C]=s[f[l]])}return f[l]&&(o[C]=s[f[l]]),o},this.EVERY=function(e,t){var a=[];if(t<1)return a;if(c.IsNumber(t)){t=parseInt(t);for(var s=0;s<e.length&&(a[s]=null,!this.IsNumber(e[s]));++s);for(var o=0;s<e.length;++s)e[s]?o+=1:o=0,o==t?(a[s]=1,--o):a[s]=0}else if(Array.isArray(t))for(var s=0;s<t.length;++s){var h=t[s];if(a[s]=null,!!c.IsPlusNumber(h)){h=parseInt(h);for(var o=0,l=s,u=0;l>=0&&u<h;--l,++u)e[l]&&++o;a[s]=o==h?1:0}}return a},this.COST=function(e,t){var a=[],s=e/100;if(s<1e-6||s>1)return a;var o=this.SymbolData.Data.Data;if(!o||o.length<=0)return a;for(var h=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:t}),l=o[0].High,u=o[0].Low,f=0;f<o.length;++f){var C=o[f];u=Math.min(u,C.Low),l=Math.max(l,C.High)}(u>2e3||u<0||l>2e3||u<0)&&this.ThrowUnexpectedNode(t,"COST() 历史K线最大最小值错误, 超出(0,1000)范围");var D=parseInt(l*100+1),v=parseInt(u*100-1),S=0,T=0,I=0;l=D/100,u=v/100;var F=D-v+1;if(F<1)return a;for(var E=[],M=[],f=0;f<F;++f)E[f]=0,M[f]=0;for(var O=0,R=0,b=0,p=0,f=0;f<o.length;++f)if(!(f>=h.length)){if(h[f]>1){var G=o[f];O=G.Vol/h[f];for(var Y=0;Y<F;Y++)E[Y]*=1-O;S=parseInt(Math.min(D,Math.max(v,G.Low*100)))-v,T=parseInt(Math.min(D,Math.max(v,G.High*100)))-v,I=parseInt(Math.min(D,Math.max(v,G.Close*100)))-v;for(var Y=0;Y<F;++Y)M[Y]=0;var Q=parseInt((S+T+2*I)/4);if(Q==T||Q==S)M[Q]+=G.Vol;else{for(var ht=G.Vol/(Q-S),Ct=S;Ct<Q;++Ct)M[Ct]+=(Ct-S)*(ht/(Q-S));for(Ct;Ct<=T;++Ct)M[Ct]+=(Ct-T)*(ht/(Q-T))}for(var R=0,Y=S;Y<=T;Y++)E[Y]+=M[Y];for(var Y=0;Y<F;Y++)R+=E[Y];for(Y=0,p=b=0;Y<F;++Y)if(b+=E[Y],b>=R*s){p=(l-u)*Y/F+u;break}}a[f]=p}return a},this.WINNER=function(e,t){var a=[],s=this.SymbolData.Data.Data;if(!s||s.length<=0)return a;for(var o=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:t}),h=s[0].High,l=s[0].Low,u=0;u<s.length;++u){var f=s[u];l=Math.min(l,f.Low),h=Math.max(h,f.High)}(l>5e3||l<0||h>5e3||l<0)&&this.ThrowUnexpectedNode(t,"WINNER() 历史K线最大最小值错误, 超出(0,5000)范围");var C=parseInt(h*100+1),D=parseInt(l*100-1),v=0,S=0,T=0;h=C/100,l=D/100;var I=C-D+1;if(I<1)return a;for(var F=[],E=[],u=0;u<I;++u)F[u]=0,E[u]=0;for(var M=0,O=0,R=0,u=0;u<s.length;++u)if(!(u>=o.length)&&o[u]>1){var b=s[u];M=b.Vol/o[u];for(var p=0;p<I;p++)F[p]*=1-M;v=parseInt(Math.min(C,Math.max(D,b.Low*100)))-D,S=parseInt(Math.min(C,Math.max(D,b.High*100)))-D,T=parseInt(Math.min(C,Math.max(D,b.Close*100)))-D;for(var p=0;p<I;++p)E[p]=0;var G=parseInt((v+S+2*T)/4);if(G==S||G==v)E[G]+=b.Vol;else{for(var Y=b.Vol/(G-v),Q=v;Q<G;++Q)E[Q]+=(Q-v)*(Y/(G-v));for(Q;Q<=S;++Q)E[Q]+=(Q-S)*(Y/(G-S))}for(var O=0,p=v;p<=S;p++)F[p]+=E[p];for(var p=0;p<I;p++)O+=F[p];Array.isArray(e)?S=parseInt(Math.min(e[u]*100-D,I-1)):S=parseInt(Math.min(e*100-D,I-1));for(var p=0,R=0;p<=S;p++)R+=F[p];O>0?a[u]=R/O:u-1>=0&&(a[u]=a[u-1])}return a},this.COSTEX=function(e,t,a){var s=[],o=this.SymbolData.Data.Data;if(!o||o.length<=0)return s;for(var h=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:a}),l=o[0].High,u=o[0].Low,f=0;f<o.length;++f){var C=o[f];u=Math.min(u,C.Low),l=Math.max(l,C.High)}(u>5e3||u<0||l>5e3||u<0)&&this.ThrowUnexpectedNode(a,"COSTEX() 历史K线最大最小值错误, 超出(0,5000)范围");var D=parseInt(l*100+1),v=parseInt(u*100-1),S=0,T=0,I=0;l=D/100,u=v/100;var F=D-v+1;if(F<1)return s;for(var E=[],M=[],f=0;f<F;++f)E[f]=0,M[f]=0;for(var O=0,R=0,b=0,p=0,G=0,Y=0,f=0,Q=0;f<o.length;++f)if(!(f>=h.length)&&h[f]>1){var ht=o[f];O=ht.Vol/h[f];for(var Q=0;Q<F;Q++)E[Q]*=1-O;S=parseInt(Math.min(D,Math.max(v,ht.Low*100)))-v,T=parseInt(Math.min(D,Math.max(v,ht.High*100)))-v,I=parseInt(Math.min(D,Math.max(v,ht.Close*100)))-v;for(var Q=0;Q<F;++Q)M[Q]=0;var Ct=parseInt((S+T+2*I)/4);if(Ct==T||Ct==S)M[Ct]+=ht.Vol;else{for(var lt=ht.Vol/(Ct-S),dt=S;dt<Ct;++dt)M[dt]+=(dt-S)*(lt/(Ct-S));for(dt;dt<=T;++dt)M[dt]+=(dt-T)*(lt/(Ct-T))}for(var Q=S;Q<=T;Q++)E[Q]+=M[Q];for(var Q=0;Q<F;Q++);for(Array.isArray(e)?T=parseInt(Math.min(e[f]*100-v,F-1)):T=parseInt(Math.min(e*100-v,F-1)),Q=0,b=0,p=0;Q<=T;Q++)b+=E[Q],p+=.01*(Q+v)*E[Q];for(Array.isArray(t)?T=parseInt(Math.min(t[f]*100-v,F-1)):T=parseInt(Math.min(t*100-v,F-1)),Q=0,G=0,Y=0;Q<=T;Q++)G+=E[Q],Y+=.01*(Q+v)*E[Q];R=b-G,dPerVolRange=p-Y,Math.abs(dPerVolRange)>.001&&R!=0?s[f]=dPerVolRange/R:f-1>=0&&(s[f]=s[f-1])}return s},this.PPART=function(e,t){var a=[],s=e;if(s<0)return a;var o=this.SymbolData.Data.Data;if(!o||o.length<=0)return a;for(var h=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:t}),l=s,u=0;l<o.length;++l){var f=l-s;if(!(f<0)){var C=0;for(u=0;u<s;++u){var D=o[u+f];C+=D.Vol}if(l<h.length&&h[l]>0){var v=1-C/h[l];a[l]=v}}}return a},this.LWINNER=function(e,t,a){var s=e;s<=0&&this.ThrowUnexpectedNode(a,"LWINNER() 第1个参数错误");var o=[],h=this.SymbolData.Data.Data;if(!h||h.length<=0)return o;for(var l=this.SymbolData.GetStockCacheData({FunctionName:"FINANCE",Args:[7],ArgCount:1,Node:a}),u=0,f=0,C=s-1,D=0,v=0;C<h.length;++C){for(var S=C-s+1,T=h[S].High,I=h[S].Low,D=0;D<s;++D){var F=h[S+D];I=Math.min(I,F.Low),T=Math.max(T,F.High)}(I>5e3||I<0||T>5e3||I<0)&&this.ThrowUnexpectedNode(a,"LWINNER() 历史K线最大最小值错误, 超出(0,5000)范围");var E=parseInt(T*100+1),M=parseInt(I*100-1),O=0,R=0,b=0;T=E/100,I=M/100;var p=E-M+1;if(p<1)return o;for(var G=[],Y=[],D=0;D<p;++D)G[D]=0,Y[D]=0;for(D=0;D<s;++D){var Q=l[S+D];if(!(Q<1)){var ht=h[S+D],Ct=ht.Vol/Q;for(v=0;v<p;v++)G[v]*=1-Ct;O=parseInt(Math.min(E,Math.max(M,ht.Low*100)))-M,R=parseInt(Math.min(E,Math.max(M,ht.High*100)))-M,b=parseInt(Math.min(E,Math.max(M,ht.Close*100)))-M;for(var v=0;v<p;++v)Y[v]=0;var lt=parseInt((O+R+2*b)/4);if(lt==R||lt==O)Y[lt]+=ht.Vol;else{for(var dt=ht.Vol/(lt-O),Ut=O;Ut<lt;++Ut)Y[Ut]+=(Ut-O)*(dt/(lt-O));for(var Wt;Wt<=R;++Wt)Y[Wt]+=(Wt-R)*(dt/(lt-R))}u=0;for(var v=O;v<=R;v++)G[v]+=Y[v]}}for(var D=0;D<p;D++)u+=G[D];for(Array.isArray(t)?R=parseInt(Math.min(t[C]*100-M,p-1)):R=parseInt(Math.min(t*100-M,p-1)),f=0,v=0;v<=R;v++)f+=G[v];u>0&&f>0&&f<=u?o[C]=f/u:C-1>=0&&(o[C]=o[C-1])}return o},this.PWINNER=function(e,t,a){var s=[];return s},this.CalculateChip=function(e,t,a,s){for(var o={Min:null,Max:null,Data:[]},h=1,l=null,u=null,f=e;f>=0;--f){var C={},D=a[f];f==e?C.Vol=D.Vol*t[f]:C.Vol=D.Vol*h,C.Date=D.Date,C.High=D.High,C.Low=D.Low,(l==null||l<C.High)&&(l=C.High),(u==null||u<C.Low)&&(u=C.Low),o.Data[f]=C,h*=1-t[f]/100*s}return o.Max=l,o.Min=u,o},this.UPNDAY=function(e,t){var a=[];if(t<1||e==null||t>e.length)return a;for(var s=0,o=0;o<e.length;++o)if(a[o]=0,!(o-1<0)){if(!this.IsNumber(e[o])||!this.IsNumber(e[o-1])){s=0;continue}e[o]>e[o-1]?++s:s=0,s==t&&(a[o]=1,--s)}return a},this.DOWNNDAY=function(e,t){var a=[];if(t<1||e==null||t>e.length)return a;for(var s=0,o=0;o<e.length;++o)if(a[o]=0,!(o-1<0)){if(!this.IsNumber(e[o])||!this.IsNumber(e[o-1])){s=0;continue}e[o]<e[o-1]?++s:s=0,s==t&&(a[o]=1,--s)}return a},this.NDAY=function(e,t,a){var s=[];if(a<1||!Array.isArray(e)&&!Array.isArray(t)||e==null||t==null)return s;if(Array.isArray(e)&&Array.isArray(t)){if(a>=e.length||a>=t.length)return s;for(var o=Math.max(e.length,t.length),h=0,l=0;l<o;++l)if(s[l]=0,!(l>=e.length||l>=t.length)){if(!this.IsNumber(e[l])||!this.IsNumber(t[l])){h=0;continue}e[l]>t[l]?++h:h=0,h==a&&(s[l]=1,--h)}}else if(Array.isArray(e)&&!Array.isArray(t)){if(a>=e.length||!this.IsNumber(t))return;var h=0;for(var u in e){if(s[u]=0,!this.IsNumber(e[u])){h=0;continue}e[u]>t?++h:h=0,h==a&&(s[u]=1,--h)}}else if(!Array.isArray(e)&&Array.isArray(t)){if(a>=t.length||!this.IsNumber(e))return;var h=0;for(var f in t){if(s[f]=0,!this.IsNumber(t[f])){h=0;continue}e>t[f]?++h:h=0,h==a&&(s[f]=1,--h)}}return s},this.LONGCROSS=function(e,t,a){for(var s=[],o=Math.max(e.length,t.length),h=0;h<o;++h)s[h]=0,!(h-1<0)&&(h>=e.length||h>=t.length||!this.IsNumber(e[h])||!this.IsNumber(t[h])||!this.IsNumber(e[h-1])||!this.IsNumber(t[h-1])||e[h]>t[h]&&e[h-1]<t[h-1]&&(s[h]=1));for(var l=0,u=0;l<o;++l)if(s[l]){for(u=1;u<=a&&l-u>=0;++u)if(e[l-u]>=t[l-u]){s[l]=0;break}}return s},this.ISVALID=function(e){if(Array.isArray(e)){for(var t=[],a=0;a<e.length;++a){var s=e[a];s?t[a]=1:t[a]=0}return t}else return e?1:0},this.EXISTR=function(e,t,a){var s=[];if(!Array.isArray(e)||(t=parseInt(t),a=parseInt(a),t<=0&&(t=e.length),a<=0&&(a=1),a>t))return s;for(var s=[],o,h=0,l=0;h<e.length;++h)if(s[h]=null,!(h-t<0||h-a<0))for(s[h]=0,l=t;l>=a;--l){var o=e[h-l];if(this.IsNumber(o)&&o){s[h]=1;break}}return s},this.RELATE=function(e,t,a){var s=[];if(a<1&&(a=1),!Array.isArray(e)||!Array.isArray(t))return s;for(var o=this.CalculateAverage(e,a),h=this.CalculateAverage(t,a),l=Math.max(e.length,t.length),u=0,f=0;u<l;++u)if(s[u]=null,!(u>=e.length||u>=t.length||u>=o.length||u>=h.length)){var C=o[u],D=h[u],v=0,S=0,T=0;for(f=u-a+1;f<=u;++f)v+=(e[f]-C)*(t[f]-D),S+=Math.pow(e[f]-C,2),T+=Math.pow(t[f]-D,2);s[u]=v/a/(Math.sqrt(S/a)*Math.sqrt(T/a))}return s},this.CalculateAverage=function(e,t){var a=[];if(t<1)return a;for(var s=0,o=0;o<e.length&&!this.IsNumber(e[o]);++o);for(;o<e.length&&o<t;++o){a[o]=null;var h=e[o];this.IsNumber(h)&&(s+=h)}for(a[o-1]=s/t;o<e.length;++o){var h=e[o],l=e[o-t];this.IsNumber(h)||(h=0),this.IsNumber(l)||(l=0),s=s-l+h,a[o]=s/t}return a},this.COVAR=function(e,t,a){if(this.IsNumber(e)||this.IsNumber(t))return 0;var s=[];if(a<1&&(a=1),!Array.isArray(e)||!Array.isArray(t))return s;for(var o=this.CalculateAverage(e,a),h=this.CalculateAverage(t,a),l=Math.max(e.length,t.length),l=Math.max(e.length,t.length),u=0,f=0;u<l;++u)if(s[u]=null,!(u>=e.length||u>=t.length||u>=o.length||u>=h.length)){var C=o[u],D=h[u],v=0;for(f=u-a+1;f<=u;++f)v+=(e[f]-C)*(t[f]-D);s[u]=v/a}return s},this.HHVBARS=function(e,t){var a=[];if(!Array.isArray(e))return a;if(Array.isArray(t))for(var s=0;s<t.length;++s){a[s]=null;var o=t[s];if(this.IsNumber(o)){var h=s-o;h<0&&(h=0);for(var l=null,u=h;u<e.length;++u)if(this.IsNumber(e[u])){l=u;break}for(var f=0;u<e.length&&f<o;++f,++u)e[u]>=e[l]&&(l=u);l!=null&&(a[s]=s-l)}}else{t<1&&(t=e.length);for(var l=null,s=0;s<e.length;++s)if(a[s]=null,this.IsNumber(e[s])){l=s;break}var u=0;for(s=l+1;s<e.length&&u<t;++s,++u)e[s]>=e[l]&&(l=s),t==e.length&&(a[s]=s-l);for(;s<e.length;++s){if(s-l<t)e[s]>=e[l]&&(l=s);else for(l=s-t+1,u=l;u<=s;++u)e[u]>=e[l]&&(l=u);a[s]=s-l}}return a},this.LLVBARS=function(e,t){var a=[];if(!Array.isArray(e))return a;if(Array.isArray(t))for(var s=0;s<t.length;++s){a[s]=null;var o=t[s];if(this.IsNumber(o)){var h=s-o;h<0&&(h=0);for(var l=null,u=h;u<e.length;++u)if(this.IsNumber(e[u])){l=u;break}for(var f=0;u<e.length&&f<o;++f,++u)e[u]<=e[l]&&(l=u);l!=null&&(a[s]=s-l)}}else{t<1&&(t=e.length);for(var l=null,s=0;s<e.length;++s)if(a[s]=null,this.IsNumber(e[s])){l=s;break}var u=0;for(s=l+1;s<e.length&&u<t;++s,++u)e[s]<=e[l]&&(l=s),t==e.length&&(a[s]=s-l);for(;s<e.length;++s){if(s-l<t)e[s]<=e[l]&&(l=s);else for(l=s-t+1,u=l;u<=s;++u)e[u]<=e[l]&&(l=u);a[s]=s-l}}return a},this.BETA=function(e){var t=[],a=this.SymbolData.Data,s=this.SymbolData.IndexData;e<=0&&(e=1);for(var o=[],h=[],l=0;l<a.Data.length;++l){o[l]=0,h[l]=0;var u=a.Data[l],f=s.Data[l];u.Close>0&&u.YClose>0&&(o[l]=(u.Close-u.YClose)/u.YClose),f.Close>0&&f.YClose>0&&(h[l]=(f.Close-f.YClose)/f.YClose)}for(var C=this.CalculateAverage(o,e),D=this.CalculateAverage(h,e),v=0,S=0;v<a.Data.length;++v)if(t[v]=null,!(v>=o.length||v>=h.length||v>=C.length||v>=D.length)){var T=C[v],I=D[v],F=0,E=0;for(S=v-e+1;S<=v;++S){var M=h[S]-I,O=o[S]-T;F+=M*O,E+=M*M}this.IsDivideNumber(E)&&this.IsNumber(F)&&(t[v]=F/E)}return t},this.BETA2=function(e,t,a){var s=[];a<=0&&(a=1);for(var o=[null],h=[null],l=Math.max(e.length,t.length),u={X:e[0],Y:t[0]},f=1;f<l;++f){o[f]=0,h[f]=0;var C=e[f],D=t[f];u.X>0&&(o[f]=(C-u.X)/u.X),u.Y>0&&(h[f]=(D-u.Y)/u.Y),u={X:C,Y:D}}for(var v=this.CalculateAverage(o,a),S=this.CalculateAverage(h,a),f=0,T=0;f<l;++f)if(s[f]=null,!(f>=o.length||f>=h.length||f>=v.length||f>=S.length)){var I=v[f],F=S[f],E=0,M=0;for(T=f-a+1;T<=f;++T){var O=o[T]-I,R=h[T]-F;E+=O*R,M+=O*O}this.IsDivideNumber(M)&&this.IsNumber(E)&&(s[f]=E/M)}return s},this.SAR=function(e,t,a){var s=[],o=this.SymbolData.Data;if(e>=o.Data.length)return s;for(var h=null,l=null,u=0;u<e;++u){var f=o.Data[u];(h==null||h<f.High)&&(h=f.High),(l==null||l>f.Low)&&(l=f.Low)}var C=0,D=1,v=C;s[e-1]=l;for(var S=l,T=o.Data[0].High,I=t/100,u=e;u<o.Data.length;++u){var F=T,f=o.Data[u],E=o.Data[u-1];v==C?f.Low<s[u-1]?(v=D,T=f.Low,I=t/100,S=Math.max(f.High,E.High),S=Math.max(S,F+I*(T-F))):(v=C,f.High>F&&(T=f.High,I=Math.min(I+t/100,a/100)),S=Math.min(f.Low,E.Low),S=Math.min(S,s[u-1]+I*(T-s[u-1]))):v==D&&(f.High>s[u-1]?(v=C,T=f.High,I=t/100,S=Math.min(f.Low,E.Low),S=Math.min(S,s[u-1]+I*(T-F))):(v=D,f.Low<F&&(T=f.Low,I=Math.min(I+t/100,a/100)),S=Math.max(f.High,E.High),S=Math.max(S,s[u-1]+I*(T-s[u-1])))),s[u]=S}return s},this.SARTURN=function(e,t,a){var s=[],o=this.SAR(e,t,a),h=this.SymbolData.Data,l=0;for(l=0;l<o.length&&!this.IsNumber(o[l]);++l);var u=0;l<h.Data.length&&(u=h.Data[l].Close>o[l]);for(var f=l+1;f<h.Data.length;++f){var C=h.Data[f];C.Close<o[f]&&u?s[f]=-1:s[f]=C.Close>o[f]&&!u?1:0,u=C.Close>o[f]}return s},this.BACKSET=function(e,t){var a=[];if(!e)return a;var s=e.length;if(!this.IsNumber(s)||s<=0)return a;if(Array.isArray(t)){for(var o=0;o<s;++o)a[o]=0;for(var o=0;o<s;++o){var h=e[o],l=t[o];if(this.IsNumber(h)&&h&&this.IsNumber(l))for(var u=o,f=0;u>=0&&f<l;--u,++f)a[u]=1}}else{for(var o=0;o<s;++o)a[o]=0;for(var C=0;C<s&&!this.IsNumber(e[C]);++C);if(C==s)return a;for(var D=Math.min(s-C,Math.max(t,1)),o=s-1,u=0;o>=0;--o){var h=e[o];if(this.IsNumber(h)&&h)for(u=o;u>o-D;--u)a[u]=1}if(e[o])for(u=o;u>=C;--u)a[u]=1}return a},this.BETWEEN=function(e,t,a){var s=[],o=typeof e=="number",h=typeof t=="number",l=typeof a=="number";if(o&&h&&l)return e>=t&&e<=a?1:0;for(var u in e){s[u]=0;var f=e[u],C=null,D=null;h?C=t:u<t.length-1&&(C=t[u]),l?D=a:u<a.length-1&&(D=a[u]),!(C==null||D==null)&&(C>D?f>=D&&f<=C&&(s[u]=1):f<=D&&f>=C&&(s[u]=1))}return s},this.STRCAT=function(e,t){var a=[];return c.IsString(e)&&c.IsString(t)&&(a=e+t),a},this.VARCAT=function(e,t){var a=[];if(Array.isArray(e)&&Array.isArray(t))for(var s=Math.max(e.length,t.length),o="",h=0;h<s;++h){if(a[h]=null,o="",h<e.length){var l=e[h];c.IsString(l)&&(o+=l)}if(h<t.length){var l=t[h];c.IsString(l)&&(o+=l)}o!=""&&(a[h]=o)}else if(c.IsString(e)&&Array.isArray(t))for(var h=0;h<t.length;++h){a[h]=null;var l=t[h];c.IsString(l)&&(a[h]=e+l)}else if(Array.isArray(e)&&c.IsString(t))for(var h=0;h<e.length;++h){a[h]=null;var l=e[h];c.IsString(l)&&(a[h]=l+t)}else c.IsString(e)&&c.IsString(t)&&(a=e+t);return a},this.FINDSTR=function(e,t){var a=[],s,o;if(c.IsNumber(e)?s=e.toString():s=e,c.IsNumber(t)?o=t.toString():o=t,c.IsString(s)&&c.IsString(o))return s.indexOf(o)>=0?1:0;if(Array.isArray(e)&&c.IsString(o))for(var h=0;h<e.length;++h){var l=e[h];c.IsString(l)?a[h]=l.indexOf(o)>=0?1:0:c.IsNumber(l)?(s=l.toString(),a[h]=s.indexOf(o)>=0?1:0):a[h]=0}return a},this.STRLEN=function(e){if(c.IsString(e))return e.length;if(Array.isArray(e)){for(var t=[],a=0;a<e.length;++a){var s=e[a];c.IsString(s)?t[a]=s.length:t[a]=null}return t}return null},this.STRCMP=function(e,t){return c.IsString(e)&&c.IsString(t)?e==t?1:0:null},this.STRSPACE=function(e){var t=[];if(Array.isArray(e))for(var a=0;a<e.length;++a){t[a]=null;var s=e[a];c.IsString(s)&&(t[a]=s+" ")}else c.IsString(e)&&(t=e+" ");return t},this.CON2STR=function(e,t){var a=[];if(Array.isArray(e))for(var s=e.length-1;s>=0;--s){var o=e[s];if(this.IsNumber(o))return a=o.toFixed(t),a}else this.IsNumber(e)&&(a=e.toFixed(t));return a},this.VAR2STR=function(e,t){var a=[];if(Array.isArray(e))for(var s=0;s<e.length;++s){a[s]=null;var o=e[s];this.IsNumber(o)&&(a[s]=o.toFixed(t))}else this.IsNumber(e)&&(a=e.toFixed(t));return a},this.MOD=function(e,t){var a=[],s=typeof e=="number",o=typeof t=="number";if(s&&o)return Di.MOD(e,t);if(!s&&!o){for(var h=Math.max(e.length,t.length),l=0;l<h;++l)a[l]=null,l<e.length&&l<t.length&&this.IsNumber(e[l])&&this.IsNumber(t[l])&&(a[l]=Di.MOD(e[l],t[l]));return a}else if(s&&!o){for(var u in t)a[u]=null,this.IsNumber(e)&&this.IsNumber(t[u])&&(a[u]=Di.MOD(e,t[u]));return a}else if(!s&&o){for(var u in e)a[u]=null,this.IsNumber(e[u])&&this.IsNumber(t)&&(a[u]=Di.MOD(e[u],t));return a}return a},this.POW=function(e,t){var a=[];if(Array.isArray(e)&&Array.isArray(t))for(var s=0;s<e.length;++s){var o=e[s],h=t[s];this.IsNumber(o)&&this.IsNumber(h)?a[s]=Math.pow(o,h):a[s]=null}else if(c.IsNumber(e)&&Array.isArray(t))for(var s=0;s<t.length;++s){var l=t[s];this.IsNumber(l)?a[s]=Math.pow(e,l):a[s]=null}else{if(c.IsNumber(e)&&c.IsNumber(t))return Math.pow(e,t);if(Array.isArray(e)&&c.IsNumber(t))for(var s=0;s<e.length;++s){var l=e[s];this.IsNumber(l)?a[s]=Math.pow(l,t):a[s]=null}}return a},this.CEILING=function(e){var t=typeof e=="number";if(t)return parseInt(e);var a=[];for(var s in e){var o=e[s];this.IsNumber(o)?a[s]=parseInt(o):a[s]=null}return a},this.FLOOR=function(e){var t=typeof e=="number";if(t)return parseInt(e-1);var a=[];for(var s in e){var o=e[s];this.IsNumber(o)?a[s]=parseInt(o-1):a[s]=null}return a},this.ZTPRICE=function(e,t){if(!this.IsNumber(t))return null;if(Array.isArray(e)){var a=[];for(var s in e){var o=e[s];this.IsNumber(o)?a[s]=(1+t)*o:a[s]=null}return a}else if(this.IsNumber(e)){var a=(1+t)*e;return a}},this.DTPRICE=function(e,t){if(!this.IsNumber(t))return null;if(Array.isArray(e)){var a=[];for(var s in e){var o=e[s];this.IsNumber(o)?a[s]=(1-t)*o:a[s]=null}return a}else if(this.IsNumber(e)){var a=(1-t)*e;return a}},this.FRACPART=function(e){if(Array.isArray(e)){var t=[],a=0;for(var s in e){var o=e[s];this.IsNumber(o)?(a=parseInt(o),t[s]=o-a):t[s]=null}return t}else if(this.IsNumber(e)){a=parseInt(e);var t=e-a;return t}},this.SIGN=function(e){if(Array.isArray(e)){for(var t=[],a=0;a<e.length;++a){var s=e[a];t[a]=null,c.IsNumber(s)&&(s>0?t[a]=1:s==0?t[a]=0:t[a]=-1)}return t}else return e>0?1:e==0?0:-1},this.BARSLASTCOUNT=function(e){var t=null;if(Array.isArray(e)){if(t=[],e.length>0)for(var a=0,s=e.length-1;s>=0;--s){a=0;for(var o=s;o>=0&&e[o];--o)++a;t[s]=a}}else e?t=1:t=0;return t},this.INTPART=function(e){var t=null;if(Array.isArray(e)){t=[];for(var a in e){var s=e[a];this.IsNumber(s)?t[a]=parseInt(s):t[a]=null}}else this.IsNumber(e)&&(t=parseInt(e));return t},this.CONST=function(e){if(Array.isArray(e)){var t=e.length;return t>0?e[t-1]:null}else return e},this.TOPRANGE=function(e){if(this.IsNumber(e))return 0;var t=[];if(Array.isArray(e))for(var a=e.length,s=a-1;s>=0;--s){t[s]=0;var o=e[s];if(this.IsNumber(o)){for(var h=0,l=s-1;l>=0&&!(e[l]>o);--l)++h;t[s]=h}}return t},this.LOWRANGE=function(e){if(this.IsNumber(e))return 0;var t=[];if(Array.isArray(e))for(var a=e.length,s=a-1;s>=0;--s){t[s]=0;var o=e[s];if(this.IsNumber(o)){for(var h=0,l=s-1;l>=0&&!(e[l]<o);--l)++h;t[s]=h}}return t},this.FINDLOW=function(e,t,a,s){if(this.IsNumber(e))return e;var o=[];if(Array.isArray(e))for(var h=e.length,l=h-1;l>=0;--l){o[l]=null;for(var u=[],f=t;f<a;++f){var C=l-f;if(C<0)break;var D=e[C];this.IsNumber(D)&&u.push(D)}if(u.length>0){u.sort(function(S,T){return S-T});var C=s-1;C<0?C=0:C>=u.length&&(C=u.length-1),o[l]=u[C]}}return o},this.FINDHIGH=function(e,t,a,s){if(this.IsNumber(e))return e;var o=[];if(Array.isArray(e))for(var h=e.length,l=h-1;l>=0;--l){o[l]=null;for(var u=[],f=t;f<a;++f){var C=l-f;if(C<0)break;var D=e[C];this.IsNumber(D)&&u.push(D)}if(u.length>0){u.sort(function(S,T){return T-S});var C=s-1;C<0?C=0:C>=u.length&&(C=u.length-1),o[l]=u[C]}}return o},this.FINDHIGHBARS=function(e,t,a,s){if(this.IsNumber(e))return a-t-s;var o=[];if(Array.isArray(e))for(var h=e.length,l=h-1;l>=0;--l){o[l]=null;for(var u=[],f=t;f<a;++f){var C=l-f;if(C<0)break;var D=e[C];this.IsNumber(D)&&u.push({Value:D,Period:f})}if(u.length>0){u.sort(function(S,T){return T.Value-S.Value});var C=s-1;C<0?C=0:C>=u.length&&(C=u.length-1),o[l]=u[C].Period}}return o},this.FINDLOWBARS=function(e,t,a,s){if(this.IsNumber(e))return a-t-s;var o=[];if(Array.isArray(e))for(var h=e.length,l=h-1;l>=0;--l){o[l]=null;for(var u=[],f=t;f<a;++f){var C=l-f;if(C<0)break;var D=e[C];this.IsNumber(D)&&u.push({Value:D,Period:f})}if(u.length>0){u.sort(function(S,T){return S.Value-T.Value});var C=s-1;C<0?C=0:C>=u.length&&(C=u.length-1),o[l]=u[C].Period}}return o},this.HOD=function(e,t){var a=[];if(c.IsNumber(e))return 1;if(Array.isArray(e))for(var s=e.length,o=s-1;o>=0;--o){var h=e[o];if(c.IsNumber(h)){if(Array.isArray(t))var l=parseInt(t[o]);else var l=parseInt(t);t<=0&&(l=o);for(var u=1,f=o-1,C=1;f>=0&&C<l;--f,++C){var D=e[f];c.IsNumber(D)&&D>h&&++u}a[o]=u}}return a},this.LOD=function(e,t){var a=[];if(c.IsNumber(e))return 1;if(Array.isArray(e))for(var s=e.length,o=s-1;o>=0;--o){var h=e[o];if(c.IsNumber(h)){if(Array.isArray(t))var l=parseInt(t[o]);else var l=parseInt(t);t<=0&&(l=o);for(var u=1,f=o-1,C=1;f>=0&&C<l;--f,++C){var D=e[f];c.IsNumber(D)&&D<h&&++u}a[o]=u}}return a},this.BARSNEXT=function(e){if(!Array.isArray(e))return 0;for(var t=[],a=0;a<e.length;++a){t[a]=0;for(var s=a,o=0;s<e.length;++s,++o){var h=e[s];if(h>0){t[a]=o;break}}}return t},this.RAND=function(e){if(Array.isArray(e)){var t=[];for(var a in e){t[a]=null;var s=e[a],o=parseInt(s);o<=0||(t[a]=Math.ceil(Math.random()*o))}return t}else{var o=parseInt(e);if(o<=0)return null;for(var h=this.SymbolData.Data,l=h.Data.length,t=[],a=0;a<l;++a)t[a]=Math.ceil(Math.random()*o);return t}},this.AMA=function(e,t){var a=[],s;if(Array.isArray(t)){for(var o=e.length-1;o>=0;--o)if(this.IsNumber(t[o])){s=t[o];break}}else s=t;if(this.IsNumber(s)){if(s>1)return a;var h=0,l=0;for(h;h<e.length;++h)if(a[h]=null,this.IsNumber(e[h])){l=e[h],a[h]=l;break}for(var o=h+1;o<e.length;++o){var u=e[o];a[o]=a[o-1]+s*(u-a[o-1])}}return a},this.TMA=function(e,t,a){var s=[];if(this.IsNumber(t)&&t<=1&&this.IsNumber(a)&&a<1){var o=!1;for(var h in e)if(s[h]=null,o==!1){var l=e[h];this.IsNumber(l)&&(s[h]=l,s[h],o=!0)}else{var l=e[h];if(!this.IsNumber(l))continue;s[h]=t*s[h-1]+a*l,s[h]}}return s},this.ROUND=function(e){if(this.IsNumber(e))return Math.round(e);var t=[];if(Array.isArray(e))for(var a in e){var s=e[a];this.IsNumber(s)?t[a]=Math.round(s):t[a]=null}return t},this.ROUND2=function(e,t){var a=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12],s=0;if(this.IsNumber(t)&&(s=parseInt(t)),t<0?s=0:t>=a.length&&(s=a.length-1),this.IsNumber(e))return Math.round(e*a[s])/a[s];var o=[];if(Array.isArray(e))for(var h in e){var l=e[h];this.IsNumber(l)?o[h]=Math.round(l*a[s])/a[s]:o[h]=null}return o},this.TRMA=function(e,t){if(!this.IsNumber(t)||t<=0)return[];t=parseInt(t);var a=0,s=0;t%2==0?(a=parseInt(t/2),s=a+1):(a=parseInt((t+1)/2),s=a);var o=this.MA(e,a),h=this.MA(o,s);return h},this.VALUEWHEN=function(e,t){if(Array.isArray(e)){var a=[];if(Array.isArray(t)){var s=null;for(var o in e){if(o>=t.length){a[o]=s;continue}var h=t[o];e[o]?(a[o]=h,s=h):a[o]=s}}else{var s=null;for(var o in e)e[o]?(a[o]=t,s=t):a[o]=s}return a}else return e?1:0},this.HARMEAN=function(e,t){var a=[];if(Array.isArray(e)){if(Array.isArray(t))for(var s=0;s<e.length;++s){if(s>=t.length){a[s]=null;continue}var o=parseInt(t[s]);if(o<=0||o>s){a[s]=null;continue}for(var h=0,l=0;l<o;++l){var u=e[s-l];if(!this.IsNumber(u)||u==0){h=null;break}h+=1/u}h==null?a[s]=null:a[s]=1/(h/o)}else if(this.IsNumber(t)){if(t=parseInt(t),t<=0)return a;for(var s=0;s<e.length;++s){if(t>s){a[s]=null;continue}for(var h=0,l=0;l<t;++l){var u=e[s-l];if(!this.IsNumber(u)||u==0){h=null;break}h+=1/u}h==null?a[s]=null:a[s]=1/(h/t)}}}return a},this.DATETODAY=function(e){var t=[],a=new Date("1990-12-19"),s=19901219,o=1e3*60*60*24;if(Array.isArray(e))for(var h in e){t[h]=null;var l=e[h];if(this.IsNumber(l)){var u=l+19e6;if(!(u<s)){var f=parseInt(u/1e4),C=parseInt(u%1e4/100),D=parseInt(u%100),v=new Date(f+"-"+C+"-"+D);t[h]=Math.round((v-a)/o)}}}else if(this.IsNumber(e)){var u=e+19e6;if(u>=s){var f=parseInt(u/1e4),C=parseInt(u%1e4/100),D=parseInt(u%100),v=new Date(f+"-"+C+"-"+D);return Math.round((v-v)/o)}}return t},this.DAYTODATE=function(e){var t=new Date("1990-12-19"),a=[];if(Array.isArray(e))for(var s in e){a[s]=null;var o=e[s];if(this.IsNumber(o)){t.setDate(t.getDate()+o);var h=t.getFullYear()*1e4+(t.getMonth()+1)*100+t.getDate();h-=19e6,a[s]=h,t.setDate(t.getDate()-o)}}else if(this.IsNumber(e)){t.setDate(t.getDate()+e);var h=t.getFullYear()*1e4+(t.getMonth()+1)*100+t.getDate();return h-=19e6,h}return a},this.TIMETOSEC=function(e){var t=parseInt(e/1e4),a=parseInt(e%1e4/100),s=e%100,o=t*60*60+a*60+s;return o},this.SECTOTIME=function(e){var t=86400,a=60*60,s=60,o=Math.floor(e%t/a),h=Math.floor(e%a/s),l=e%s,u=o*1e4+h*100+l;return u},this.ANY=function(e,t){t<=0&&(t=1);var a=[];if(Array.isArray(e)){if(t>=e.length)return 0;for(var s=t,o=0;s<e.length;++s){var h=0;for(o=0;o<t;++o){var l=e[s-o];if(l>0){h=1;break}}a[s]=h}return a}else if(c.IsNumber(e)){if(e<=0||t>=this.SymbolData.Data.Data.length)return 0;for(var s=t;s<this.SymbolData.Data.Data.length;++s)a[s]=1;return a}else return 0},this.ALL=function(e,t){t<=0&&(t=1);var a=[];if(Array.isArray(e)){if(t>=e.length)return 0;for(var s=t,o=0;s<e.length;++s){var h=1;for(o=0;o<t;++o){var l=e[s-o];if(!(l>0)){h=0;break}}a[s]=h}return a}else if(c.IsNumber(e)){if(e<=0||t>=this.SymbolData.Data.Data.length)return 0;for(var s=t;s<this.SymbolData.Data.Data.length;++s)a[s]=1;return a}else return 0},this.TESTSKIP=function(e,t){if(Array.isArray(e)){if(e.length<=0)return!1;var a=e[e.length-1];return!!a}else return c.IsNumber(e)?!(e<=0):!!e},this.IFC=function(e){if(Array.isArray(e)){var t=e[e.length-1];return c.IsNumber(t)?t>0:!1}else return c.IsNumber(e)?e>0:!1},this.ALIGNRIGHT=function(e){if(Array.isArray(e)){for(var t=[],a=e.length-1,s=e.length-1;s>=0;--s){var o=e[s];(c.IsNumber(o)||c.IsString(o))&&(t[a]=o,--a)}for(var s=a;s>=0;--s)t[s]=null;return t}else return e},this.SUMBARS=function(e,t){var a=Array.isArray(e),s=Array.isArray(t),o=c.IsNumber(e),h=c.IsNumber(t),l=[];if(a&&h)for(var u=0,f=0;u<e.length;++u){for(var C=0,f=0,D=u-1;D>=0;--D,++f){var v=e[u];if(c.IsNumber(v)&&(C+=e[D],C>t))break}l[u]=f}else if(a&&s)for(var S=Math.max(e.length,t.length),u=0;u<S;++u){l[u]=null;var C=0,f=0,T=t[u];if(c.IsNumber(T)){for(var D=u-1;D>=0;--D,++f){var v=e[u];if(c.IsNumber(v)&&(C+=e[D],C>T))break}l[u]=f}}else if(o&&s)for(var u=0;u<t.length;++u){l[u]=null;var C=0,f=0,T=t[u];if(c.IsNumber(T)){for(var D=u-1;D>=0&&(C+=e,!(C>T));--D,++f);l[u]=f}}return l},this.STRFORMAT=function(e,t,a){var s=e.match(/{\d+}/g);if(!c.IsNonEmptyArray(s))return null;for(var o=new Dt.default,h=0;h<s.length;++h){var l=s[h];if(!(l.length<3)){var u=l.slice(1,l.length-1),f=parseInt(u),C={Src:l,Index:f,Text:null};o.set(f,C)}}for(var D=!1,v=0,h=1;h<t.length;++h){var l=t[h];Array.isArray(l)&&(D=!0,v<l.length&&(v=l.length))}if(D){for(var S=[],h=0;h<v;++h){var T=e,I=!0,F=!1,E=void 0;try{for(var M=(0,we.default)(o),O;!(I=(O=M.next()).done);I=!0){var l=O.value,R=l[1],C=t[R.Index+1],b="null";if(C)if(Array.isArray(C)){var u=C[h];u&&(b=""+u)}else b=""+C;T=T.replace(R.Src,b)}}catch(lt){F=!0,E=lt}finally{try{!I&&M.return&&M.return()}finally{if(F)throw E}}S[h]=T}return S}else{var S=e,p=!0,G=!1,Y=void 0;try{for(var Q=(0,we.default)(o),ht;!(p=(ht=Q.next()).done);p=!0){var l=ht.value,R=l[1],C=t[R.Index+1],b="null";C&&(b=""+C),S=S.replace(R.Src,b)}}catch(lt){G=!0,Y=lt}finally{try{!p&&Q.return&&Q.return()}finally{if(G)throw Y}}return S}},this.CallFunction=function(e,t,a,s){switch(e){case"MAX":case"MAX6":return this.MAX(t,a);case"MIN":case"MIN6":return this.MIN(t,a);case"REF":return this.REF(t[0],t[1]);case"REFV":return this.REFV(t[0],t[1]);case"REFX":return this.REFX(t[0],t[1]);case"REFXV":return this.REFXV(t[0],t[1]);case"REFX1":return this.REFX(t[0],t[1]);case"ABS":return this.ABS(t[0]);case"MA":return this.MA(t[0],t[1]);case"EMA":return this.EMA(t[0],t[1]);case"SMA":return this.SMA(t[0],t[1],t[2]);case"DMA":return this.DMA(t[0],t[1]);case"XMA":return this.XMA(t[0],t[1]);case"EXPMA":return this.EXPMA(t[0],t[1]);case"EXPMEMA":return this.EXPMEMA(t[0],t[1]);case"COUNT":return this.COUNT(t[0],t[1]);case"LLV":return this.LLV(t[0],t[1]);case"LV":return this.LV(t[0],t[1]);case"LLVBARS":return this.LLVBARS(t[0],t[1]);case"HHV":return this.HHV(t[0],t[1]);case"HV":return this.HV(t[0],t[1]);case"HHVBARS":return this.HHVBARS(t[0],t[1]);case"MULAR":return this.MULAR(t[0],t[1]);case"CROSS":return this.CROSS(t[0],t[1]);case"LONGCROSS":return this.LONGCROSS(t[0],t[1],t[2]);case"ISVALID":return this.ISVALID(t[0]);case"CROSSDOWN":return this.CROSSDOWN(t[0],t[1]);case"CROSSUP":return this.CROSSUP(t[0],t[1]);case"AVEDEV":return this.AVEDEV(t[0],t[1]);case"STD":return this.STD(t[0],t[1]);case"IF":case"IFF":case"IFELSE":return this.IF(t[0],t[1],t[2]);case"IFN":return this.IFN(t[0],t[1],t[2]);case"NOT":return this.NOT(t[0]);case"SUM":return this.SUM(t[0],t[1]);case"RANGE":return this.RANGE(t[0],t[1],t[2]);case"EXIST":return this.EXIST(t[0],t[1]);case"EXISTR":return this.EXISTR(t[0],t[1],t[2]);case"FILTER":return this.FILTER(t[0],t[1]);case"TFILTER":return this.TFILTER(t[0],t[1],t[2]);case"SLOPE":return this.SLOPE(t[0],t[1]);case"BARSLAST":return this.BARSLAST(t[0]);case"BARSCOUNT":return this.BARSCOUNT(t[0]);case"BARSSINCEN":return this.BARSSINCEN(t[0],t[1]);case"BARSSINCE":return this.BARSSINCE(t[0]);case"LAST":return this.LAST(t[0],t[1],t[2]);case"EVERY":return this.EVERY(t[0],t[1]);case"DEVSQ":return this.DEVSQ(t[0],t[1]);case"ZIG":return this.ZIG(t[0],t[1]);case"TROUGHBARS":return this.TROUGHBARS(t[0],t[1],t[2]);case"TROUGH":return this.TROUGH(t[0],t[1],t[2]);case"PEAKBARS":return this.PEAKBARS(t[0],t[1],t[2]);case"PEAK":return this.PEAK(t[0],t[1],t[2]);case"COST":return this.COST(t[0]);case"WINNER":return this.WINNER(t[0],a);case"PPART":return this.PPART(t[0],a);case"COSTEX":return this.COSTEX(t[0],t[1],a);case"LWINNER":return this.LWINNER(t[0],t[1],a);case"PWINNER":return this.PWINNER(t[0],t[1],a);case"FORCAST":return this.FORCAST(t[0],t[1]);case"TSMA":return this.TSMA(t[0],t[1]);case"STDP":return this.STDP(t[0],t[1]);case"VAR":return this.VAR(t[0],t[1]);case"VARP":return this.VARP(t[0],t[1]);case"UPNDAY":return this.UPNDAY(t[0],t[1]);case"DOWNNDAY":return this.DOWNNDAY(t[0],t[1]);case"NDAY":return this.NDAY(t[0],t[1],t[2]);case"RELATE":return this.RELATE(t[0],t[1],t[2]);case"COVAR":return this.COVAR(t[0],t[1],t[2]);case"BETA":return this.BETA(t[0]);case"BETA2":return this.BETA2(t[0],t[1],t[2]);case"WMA":return this.WMA(t[0],t[1]);case"MEMA":return this.MEMA(t[0],t[1]);case"SUMBARS":return this.SUMBARS(t[0],t[1]);case"REVERSE":return this.REVERSE(t[0]);case"SAR":return this.SAR(t[0],t[1],t[2]);case"SARTURN":return this.SARTURN(t[0],t[1],t[2]);case"BACKSET":return this.BACKSET(t[0],t[1]);case"BETWEEN":return this.BETWEEN(t[0],t[1],t[2]);case"STRCAT":return this.STRCAT(t[0],t[1]);case"CON2STR":return this.CON2STR(t[0],t[1]);case"VAR2STR":return this.VAR2STR(t[0],t[1]);case"VARCAT":return this.VARCAT(t[0],t[1]);case"STRSPACE":return this.STRSPACE(t[0]);case"FINDSTR":return this.FINDSTR(t[0],t[1]);case"STRCMP":return this.STRCMP(t[0],t[1]);case"STRLEN":return this.STRLEN(t[0]);case"STRFORMAT":return this.STRFORMAT(t[0],t,a);case"DTPRICE":return this.DTPRICE(t[0],t[1]);case"ZTPRICE":return this.ZTPRICE(t[0],t[1]);case"MOD":return this.MOD(t[0],t[1]);case"POW":return this.POW(t[0],t[1]);case"CEILING":return this.CEILING(t[0]);case"FLOOR":return this.FLOOR(t[0]);case"FRACPART":return this.FRACPART(t[0]);case"SIGN":return this.SIGN(t[0]);case"BARSLASTCOUNT":return this.BARSLASTCOUNT(t[0]);case"INTPART":return this.INTPART(t[0]);case"CONST":return this.CONST(t[0]);case"TOPRANGE":return this.TOPRANGE(t[0]);case"LOWRANGE":return this.LOWRANGE(t[0]);case"FINDLOW":return this.FINDLOW(t[0],t[1],t[2],t[3]);case"FINDLOWBARS":return this.FINDLOWBARS(t[0],t[1],t[2],t[3]);case"FINDHIGH":return this.FINDHIGH(t[0],t[1],t[2],t[3]);case"FINDHIGHBARS":return this.FINDHIGHBARS(t[0],t[1],t[2],t[3]);case"BARSNEXT":return this.BARSNEXT(t[0]);case"HOD":return this.HOD(t[0],t[1]);case"LOD":return this.LOD(t[0],t[1]);case"AMA":return this.AMA(t[0],t[1]);case"TMA":return this.TMA(t[0],t[1],t[2]);case"ROUND":return this.ROUND(t[0]);case"ROUND2":return this.ROUND2(t[0],t[1]);case"TRMA":return this.TRMA(t[0],t[1]);case"VALUEWHEN":return this.VALUEWHEN(t[0],t[1]);case"HARMEAN":return this.HARMEAN(t[0],t[1]);case"DATETODAY":return this.DATETODAY(t[0]);case"DAYTODATE":return this.DAYTODATE(t[0]);case"TIMETOSEC":return this.TIMETOSEC(t[0]);case"SECTOTIME":return this.SECTOTIME(t[0]);case"ANY":return this.ANY(t[0],t[1]);case"ALL":return this.ALL(t[0],t[1]);case"TESTSKIP":return this.TESTSKIP(t[0],a);case"SUMBARS":return this.SUMBARS(t[0],t[1]);case"ALIGNRIGHT":return this.ALIGNRIGHT(t[0]);case"ATAN":return this.Trigonometric(t[0],Math.atan);case"ACOS":return this.ACOS(t[0]);case"ASIN":return this.ASIN(t[0]);case"COS":return this.Trigonometric(t[0],Math.cos);case"SIN":return this.Trigonometric(t[0],Math.sin);case"TAN":return this.Trigonometric(t[0],Math.tan);case"LN":return this.Trigonometric(t[0],Math.log);case"LOG":return this.Trigonometric(t[0],MT.default);case"EXP":return this.Trigonometric(t[0],Math.exp);case"SQRT":return this.Trigonometric(t[0],Math.sqrt);case"RAND":return this.RAND(t[0]);default:this.ThrowUnexpectedNode(a,"函数"+e+"不存在",e)}},this.CallCustomFunction=function(e,t,a,s){var o=zt.CustomFunction.Data.get(e),h=a.GetStockCacheData({CustomName:e,Node:s});if(!o.Invoke)return{Out:h};X.Complier.Log("[JSAlgorithm::CallCustomFunction] call custom function functionInfo=",o);var l=this,u={Name:e,Args:t,Symbol:a.Symbol,Period:a.Period,Right:a.Right,KData:a.Data,DownloadData:h,ThrowError:function(C){l.ThrowUnexpectedNode(s,C)}};return o.Invoke(u)},this.ThrowUnexpectedNode=function(e,t,a){var s=e.Marker,o=t||"执行异常";return this.ErrorHandler.ThrowError(s.Index,s.Line,s.Column,o,a)}}Di.prototype.IsNumber=function(r){return!(r==null||isNaN(r))};Di.prototype.IsDivideNumber=function(r){return!(r==null||isNaN(r)||r==0)};Di.MOD=function(r,n){if(r<0&&n<0||r>=0&&n>=0){if(parseInt(r)==r&&parseInt(n)==n)return r%n;var e=parseFloat((r-Math.floor(r/n)*n).toFixed(1));return e}else{var t=Math.abs(r),a=Math.abs(n),e=Math.abs(Math.abs(n)*(Math.floor(t/a)+1)-Math.abs(r));return n<0&&(e=-e),e}};function Pr(r,n){this.ErrorHandler=r,this.SymbolData=n,this.DRAWTEXT=function(e,t,a){var s=[],o={DrawData:s,DrawType:"DRAWTEXT",Text:a};if(Array.isArray(e)){if(e.length<=0)return o;var h=this.IsNumber(t),l=!1;(t==="TOP"||t==="BOTTOM")&&(o.FixedPosition=t,l=!0);for(var u in e)s[u]=null,!(isNaN(e[u])||!e[u])&&(h||l?s[u]=t:this.IsNumber(t[u])&&(s[u]=t[u]))}else if(this.IsNumber(e)&&e){var h=this.IsNumber(t),l=!1;(t==="TOP"||t==="BOTTOM")&&(o.FixedPosition=t,l=!0);for(var u=0;u<this.SymbolData.Data.Data.length;++u)h||l?s[u]=t:this.IsNumber(t[u])&&(s[u]=t[u])}return o},this.DRAWTEXT_FIX=function(e,t,a,s,o){var h={Value:[],Text:[]},l={DrawData:h,DrawType:"DRAWTEXT_FIX",Text:null,Position:{X:t,Y:a,Type:s}};if(e.length<=0)return l;if(Array.isArray(e))for(var u in e)h.Text[u]=null,h.Value[u]=0,!(isNaN(e[u])||!e[u])&&(h.Value[u]=1,h.Text[u]=o);else if(e)for(var u=0;u<this.SymbolData.Data.Data.length;++u)h.Text[u]=o,h.Value[u]=1;return l},this.SUPERDRAWTEXT=function(e,t,a,s,o){var h=[],l={DrawData:h,DrawType:"SUPERDRAWTEXT",Text:a,YOffset:o,Direction:s,TextAlign:"center"};if(e.length<=0)return l;var u=typeof t=="number";for(var f in e)h[f]=null,!(isNaN(e[f])||!e[f])&&(u?h[f]=t:this.IsNumber(t[f])&&(h[f]=t[f]));return l},this.STICKLINE=function(e,t,a,s,o){var h=[],l={DrawData:h,DrawType:"STICKLINE",Width:s,Type:o};l.Width<0&&(l.Width=3);var u=typeof t=="number",f=typeof a=="number";if(Array.isArray(e)){if(e.length<=0)return l;for(var C in e)if(h[C]=null,!(isNaN(e[C])||!e[C]))if(u&&f)h[C]={Value:t,Value2:a};else if(u&&!f){if(isNaN(a[C]))continue;h[C]={Value:t,Value2:a[C]}}else if(!u&&f){if(isNaN(t[C]))continue;h[C]={Value:t[C],Value2:a}}else{if(isNaN(t[C])||isNaN(a[C]))continue;h[C]={Value:t[C],Value2:a[C]}}}else{if(!e)return l;for(var C=0;C<this.SymbolData.Data.Data.length;++C)if(h[C]=null,u&&f)h[C]={Value:t,Value2:a};else if(u&&!f){if(!c.IsNumber(a[C]))continue;h[C]={Value:t,Value2:a[C]}}else if(!u&&f){if(!c.IsNumber(t[C]))continue;h[C]={Value:t[C],Value2:a}}else{if(!c.IsNumber(t[C])||!c.IsNumber(a[C]))continue;h[C]={Value:t[C],Value2:a[C]}}}return l},this.DRAWLINE=function(e,t,a,s,o){var h=[],l={DrawData:h,DrawType:"DRAWLINE",Expand:o};if(e.length<=0)return l;for(var u=Math.max(e.length,a.length),f=!1,C=!1,D={Start:{},End:{},List:new Array},v=0;v<u;++v){if(h[v]=null,v<e.length&&v<a.length){if(f==!1&&C==!1){if(e[v]==null||!e[v])continue;f=!0,D.Start={ID:v,Value:t[v]}}else if(f==!0&&C==!1){var S=a[v]!=null&&a[v];if(!S){e[v]&&(D.Start={ID:v,Value:t[v]});continue}S&&(C=!0,D.End={ID:v,Value:s[v]})}else if(f==!0&&C==!0){var S=a[v]!=null&&a[v];if(S)D.End={ID:v,Value:s[v]};else if(e[v]){var T=this.CalculateDrawLine(D);for(var I in T){var F=T[I];h[F.ID]=F.Value}o==1&&this.CalculateDrawDataExtendLine(h,D.Start.ID-2),f=C=!1,D={Start:{},End:{}},f=!0,C=!1,D.Start={ID:v,Value:t[v]}}}}if(f==!0&&C==!0){var E=this.CalculateDrawLine(D);for(var M in E){var O=E[M];h[O.ID]=O.Value}}}return o==1&&this.CalculateDrawDataExtendLine(h),l},this.DRAWBAND=function(e,t,a,s){c.IsNumber(t)&&(t="rgb("+t+",0,0)"),c.IsNumber(s)&&(s="rgb("+s+",0,0)");var o=[],h={DrawData:o,DrawType:"DRAWBAND",Color:[null,null]};t&&(h.Color[0]=t.toLowerCase()),s&&(h.Color[1]=s.toLowerCase());var l=c.IsNumber(e),u=c.IsNumber(a);if(!l&&!u)for(var f=Math.max(e.length,a.length),C=0;C<f;++C){var D={Value:null,Value2:null};C<e.length&&(D.Value=e[C]),C<a.length&&(D.Value2=a[C]),o.push(D)}else if(l&&!u)for(var f=a.length,C=0;C<f;++C){var D={Value:e,Value2:null};C<a.length&&(D.Value2=a[C]),o.push(D)}else if(!l&&u)for(var f=e.length,C=0;C<f;++C){var D={Value:null,Value2:a};C<e.length&&(D.Value=e[C]),o.push(D)}else if(l&&u)for(var f=this.SymbolData.Data.Data.length,C=0;C<f;++C){var D={Value:e,Value2:a};o.push(D)}return h},this.GetDataByIndex=function(e,t){var a={Result:!1,Data:null};return this.IsNumber(e)?(a.Result=!0,a.Data=e):t<e.length?(a.Result=!0,a.Data=e[t]):a.Result=!1,a},this.FILLRGN=function(e,t,a){var s=[],o={DrawData:s,DrawType:"FILLRGN"};if(this.IsNumber(t),this.IsNumber(a),Array.isArray(e))for(var h in e){s[h]=null;var l=e[h];if(l){var u=this.GetDataByIndex(t,h);if(u.Result){var f=this.GetDataByIndex(a,h);if(f.Result){var C={Value:u.Data,Value2:f.Data};s[h]=C}}}}else if(e)for(var h=0;h<this.SymbolData.Data.Data.length;++h){s[h]=null;var u=this.GetDataByIndex(t,h);if(u.Result){var f=this.GetDataByIndex(a,h);if(f.Result){var C={Value:u.Data,Value2:f.Data};s[h]=C}}}return o},this.DRAWKLINE=function(e,t,a,s){for(var o=[],h={DrawData:o,DrawType:"DRAWKLINE"},l=Math.max(e.length,t.length,a.length,s.length),u=0;u<l;++u){var f={Open:null,High:null,Low:null,Close:null};u<e.length&&u<t.length&&u<a.length&&u<s.length&&(f.Open=t[u],f.High=e[u],f.Low=a[u],f.Close=s[u]),o[u]=f}return h},this.DRAWKLINE_IF=function(e,t,a,s,o){for(var h=[],l={DrawData:h,DrawType:"DRAWKLINE_IF"},u=Math.max(e.length,t.length,a.length,s.length,o.length),f=0;f<u;++f){var C={Open:null,High:null,Low:null,Close:null};f<t.length&&f<a.length&&f<s.length&&f<o.length&&f<e.length&&e[f]&&(C.Open=a[f],C.High=t[f],C.Low=s[f],C.Close=o[f]),h[f]=C}return l},this.DRAWCOLORKLINE=function(e,t,a){var s=[],o={DrawData:s,DrawType:"DRAWCOLORKLINE",IsEmptyBar:a!=0,Color:t};if(Array.isArray(e))for(var h=0;h<e.length&&h<this.SymbolData.Data.Data.length;++h){s[h]=null;var l=e[h];if(l){var u=this.SymbolData.Data.Data[h];u&&(s[h]={Open:u.Open,High:u.High,Low:u.Low,Close:u.Close})}}else if(e)for(var h=0;h<this.SymbolData.Data.Data.length;++h){s[h]=null;var u=this.SymbolData.Data.Data[h];u&&(s[h]={Open:u.Open,High:u.High,Low:u.Low,Close:u.Close})}return o},this.POLYLINE=function(e,t){var a=[],s={DrawData:a,DrawType:"POLYLINE"},o=typeof t=="number",h=!1,l=!1;if(o)if(this.IsNumber(e)){if(e)for(var u=this.SymbolData.Data.Data.length,f=0;f<u;++f)a[f]=t}else{var C=!1;for(var f in e)if(a[f]=null,C)a[f]=t;else{if(!e[f])continue;C=!0,a[f]=t}}else{var D={Start:{},End:{},List:new Array};for(var v in e)if(a[v]=null,h==!1&&l==!1){if(e[v]==null||!e[v]||v>=t.length||!this.IsNumber(t[v]))continue;h=!0,D.Start={ID:parseInt(v),Value:t[v]}}else if(h==!0&&l==!1){if(e[v]==null||!e[v]||v>=t.length||!this.IsNumber(t[v]))continue;D.End={ID:parseInt(v),Value:t[v]};var S=this.CalculateDrawLine(D);for(var T in S){var I=S[T];a[I.ID]=I.Value}var F={ID:D.End.ID,Value:D.End.Value};D={Start:F,End:{}}}this.CalculateDrawDataExtendLine(a)}return s},this.CalculateDrawDataExtendLine=function(e,t){if(!(t<0)){var a=null,s=e.length;this.IsNumber(t)&&t<s&&(s=t);for(var o=s-1;o>=0;--o)if(this.IsNumber(e[o])){a=o;break}if(a!=null&&a-1>=0)for(var h=a-1,o=a+1;o<s;++o){var l=e[h],u=e[a],f=(l-u)*(o-h)/(a-h);if(l-f<0)break;e[o]=l-f}}},this.DRAWNUMBER=function(e,t,a,s){var o={Value:[],Text:[]},h={DrawData:o,DrawType:"DRAWNUMBER"},l=2;c.IsNumber(s)&&(l=s);var u={DataType:0,SingleValue:null,ArrayValue:null};Array.isArray(t)?(u.ArrayValue=t,u.DataType=2):((t==="TOP"||t==="BOTTOM")&&(h.FixedPosition=t),u.SingleValue=t,u.DataType=1);var f={DataType:0,SingleValue:null,ArrayValue:null};if(Array.isArray(a)?(f.ArrayValue=a,f.DataType=2):(f.SingleValue=a,f.DataType=1,c.IsNumber(a)&&(c.IsInteger(a)?f.SingleValue=a.toString():text=a.toFixed(l))),Array.isArray(e))for(var C=0;C<e.length;++C)o.Value[C]=null,e[C]&&(o.Value[C]=this.DRAWNUMBER_Temp_PriceItem(C,u),o.Text[C]=this.DRAWNUMBER_Temp_NumberItem(C,f,l));else if(this.IsNumber(e)&&e)for(var C=0;C<this.SymbolData.Data.Data.length;++C)o.Value[C]=this.DRAWNUMBER_Temp_PriceItem(C,u),o.Text[C]=this.DRAWNUMBER_Temp_NumberItem(C,f,l);return h},this.DRAWNUMBER_Temp_PriceItem=function(e,t){return t?t.DataType==1?t.SingleValue:c.IsNonEmptyArray(t.ArrayValue)?t.ArrayValue[e]:null:null},this.DRAWNUMBER_Temp_NumberItem=function(e,t,a){if(!t)return null;if(t.DataType==1)return t.SingleValue;if(!c.IsNonEmptyArray(t.ArrayValue))return null;var s=t.ArrayValue[e];return this.IsNumber(s)?c.IsInteger(s)?s.toString():s.toFixed(a):s.toString()},this.DRAWNUMBER_FIX=function(e,t,a,s,o){var h={Value:[],Text:[]},l={DrawData:h,DrawType:"DRAWNUMBER_FIX",Position:{X:t,Y:a,Type:s}},u=c.IsNumber(o);if(Array.isArray(e)){for(var f in e)if(h.Text[f]=null,h.Value[f]=null,!!e[f])if(u)h.Text[f]=this.RemoveZero(o.toFixed(2)),h.Value[f]=o;else{if(f>=o.length||!c.IsNumber(o[f]))continue;var C=o[f];h.Text[f]=this.RemoveZero(C.toFixed(2)),h.Value[f]=C}}else if(e)for(var f=0;f<this.SymbolData.Data.Data.length;++f)if(u)h.Text[f]=this.RemoveZero(o.toFixed(2)),h.Value[f]=o;else{if(f>=o.length||!c.IsNumber(o[f]))continue;var C=o[f];h.Text[f]=this.RemoveZero(C.toFixed(2)),h.Value[f]=C}return l},this.DRAWICON=function(e,t,a){if(c.IsString(a)){var s=a.replace("ICO","");a=parseInt(s)}var o=zt.GetDrawIcon(a);o||zt.GetDrawTextIcon(a),o||(o={Symbol:"🚩"});var h=[],l={DrawData:h,DrawType:"DRAWICON",Icon:o,IconType:a};if(e.length<=0)return l;var u=typeof t=="number";if(typeof e=="number"){if(!e)return l;for(var f=0;f<this.SymbolData.Data.Data.length;++f)u?h[f]=t:f<t.length&&this.IsNumber(t[f])?h[f]=t[f]:h[f]=null;return l}for(var f in e)h[f]=null,e[f]&&(u?h[f]=t:this.IsNumber(t[f])&&(h[f]=t[f]));return l},this.ICON=function(e,t){if(c.IsString(t)){var a=t.replace("ICO","");t=parseInt(a)}var s=zt.GetDrawIcon(t);s||zt.GetDrawTextIcon(t),s||(s={Symbol:"🚩"});for(var o=[],h={DrawData:o,DrawType:"ICON",Icon:s},l=0;l<this.SymbolData.Data.Data.length;++l){var u=this.SymbolData.Data.Data[l];u&&(e==0?o[l]=u.Low:e==1&&(o[l]=u.High))}return h},this.TIPICON=function(e,t,a,s){if(c.IsString(a)){var o=a.replace("ICO","");a=parseInt(o)}var h=zt.GetDrawIcon(a),l=[],u={DrawData:l,DrawType:"TIPICON",Icon:h,IconType:a,Text:s};if(e.length<=0)return u;var f=typeof t=="number";if(c.IsNumber(e)){if(!e)return u;for(var C=0;C<this.SymbolData.Data.Data.length;++C)f?l[C]=t:C<t.length&&c.IsNumber(t[C])?l[C]=t[C]:l[C]=null}else if(Array.isArray(e))for(var C=0;C<e.length;++C)l[C]=null,e[C]&&(f?l[C]=t:c.IsNumber(t[C])&&(l[C]=t[C]));return u},this.DRAWCHANNEL=function(e,t,a,s,o,h,l){var u=[],f={DrawData:u,DrawType:"DRAWCHANNEL",Border:{}};if(e.length<=0)return f;if(s&&(f.Border.Color=s),l&&(f.AreaColor=l),o>0&&(f.Border.Width=o),h)if(h=="0")f.Border.Dotted=[];else{var C=h.split(",");f.Border.Dotted=[];for(var D in C){var v=C[D];if(v){var S=parseInt(C[D]);c.IsNumber(S)&&(S<=0||f.Border.Dotted.push(S))}}f.Border.Dotted.length<=0&&(f.Border.Dotted=null)}var T=typeof t=="number",I=typeof a=="number";if(typeof e=="number"){if(!e)return f;for(var D=0;D<this.SymbolData.Data.Data.length;++D)if(u[D]=null,T&&I)u[D]={Value:t,Value2:a};else if(T&&!I){if(isNaN(a[D]))continue;u[D]={Value:t,Value2:a[D]}}else if(!T&&I){if(isNaN(t[D]))continue;u[D]={Value:t[D],Value2:a}}else{if(isNaN(t[D])||isNaN(a[D]))continue;u[D]={Value:t[D],Value2:a[D]}}}else for(var D=0;D<e.length;++D)if(u[D]=null,!(isNaN(e[D])||!e[D]))if(T&&I)u[D]={Value:t,Value2:a};else if(T&&!I){if(isNaN(a[D]))continue;u[D]={Value:t,Value2:a[D]}}else if(!T&&I){if(isNaN(t[D]))continue;u[D]={Value:t[D],Value2:a}}else{if(isNaN(t[D])||isNaN(a[D]))continue;u[D]={Value:t[D],Value2:a[D]}}return f},this.RGB=function(e,t,a){var s="RGB("+e+","+t+","+a+")";return s},this.RGBA=function(e,t,a,s){var o="RGB("+e+","+t+","+a+","+s+")";return o},this.UPCOLOR=function(e){return e},this.DOWNCOLOR=function(e){return e},this.XMOVE=function(e){return e},this.YMOVE=function(e){return e},this.SOUND=function(e){return{Name:"SOUND",Value:e}},this.PLAYSOUND=function(e,t){return null},this.PARTLINE=function(e){var t=[],a={DrawData:t,DrawType:"PARTLINE"};if(e.length<3)return a;for(var s=e[0],o=[],h=1;h<e.length&&h+1<e.length;h+=2)o.push({Cond:e[h],RGB:e[h+1]});for(var h in s){var l={Value:null,RGB:null};t[h]=l;var u=s[h];if(this.IsNumber(u)){var f=null;for(var C in o){var D=o[C];if(Array.isArray(D.Cond)){if(h<D.Cond.length&&D.Cond[h]){f=D.RGB;break}}else if(this.IsNumber(D.Cond)&&D.Cond){f=D.RGB;break}}f&&(l.Value=u,l.RGB=f)}}return a},this.FILLRGN2=function(e){var t=[],a={DrawData:t,DrawType:"FILLRGN2"};if(e.length<4)return a;for(var s=e[0],o=e[1],h=[],l=2;l<e.length&&l+1<e.length;l+=2)h.push({Cond:e[l],Color:e[l+1]});for(var l=0;l<this.SymbolData.Data.Data.length;++l){t[l]=null;var u={Value:null,Value2:null,Color:null};for(var f in h){var C=h[f];if(Array.isArray(C.Cond)){if(l<C.Cond.length&&C.Cond[l]){u.Color=C.Color;break}}else if(this.IsNumber(C.Cond)&&C.Cond){u.Color=C.Color;break}}if(u.Color){if(Array.isArray(s)){if(l>=s.length||!this.IsNumber(s[l]))continue;u.Value=s[l]}else if(this.IsNumber(s))u.Value=s;else continue;if(Array.isArray(o)){if(l>=o.length||!this.IsNumber(o[l]))continue;u.Value2=o[l]}else if(this.IsNumber(o))u.Value2=o;else continue;t[l]=u}}return a},this.FLOATRGN=function(e){var t=[],a={DrawData:t,DrawType:"FLOATRGN"};if(e.length<4)return a;for(var s=e[0],o=e[1],h=[],l=2;l<e.length&&l+1<e.length;l+=2)h.push({Cond:e[l],Color:e[l+1]});for(var l=0;l<this.SymbolData.Data.Data.length;++l){t[l]=null;var u={Value:null,Value2:null,Color:null};for(var f in h){var C=h[f];if(Array.isArray(C.Cond)){if(l<C.Cond.length&&C.Cond[l]){u.Color=C.Color;break}}else if(this.IsNumber(C.Cond)&&C.Cond){u.Color=C.Color;break}}if(u.Color){if(Array.isArray(s)){if(l>=s.length||!this.IsNumber(s[l]))continue;u.Value=s[l]}else if(this.IsNumber(s))u.Value=s;else continue;if(Array.isArray(o)){if(l>=o.length||!this.IsNumber(o[l]))continue;u.Value2=o[l]}else if(this.IsNumber(o))u.Value2=o;else continue;t[l]=u}}return a},this.FILLBGRGN=function(e,t){var a=[],s={DrawData:a,DrawType:e==1?"FILLTOPRGN":"FILLBOTTOMRGN"};if(t.length<3)return s;for(var o=t[0],h=[],l=1;l<t.length&&l+1<t.length;l+=2)h.push({Cond:t[l],Color:t[l+1]});for(var l=0;l<this.SymbolData.Data.Data.length;++l){a[l]=null;var u={Value:null,Color:null};for(var f in h){var C=h[f];if(Array.isArray(C.Cond)){if(l<C.Cond.length&&C.Cond[l]){u.Color=C.Color;break}}else if(this.IsNumber(C.Cond)&&C.Cond){u.Color=C.Color;break}}if(u.Color){if(Array.isArray(o)){if(l>=o.length||!this.IsNumber(o[l]))continue;u.Value=o[l]}else if(this.IsNumber(o))u.Value=o;else continue;a[l]=u}}return s},this.FILLVERTICALRGN=function(e){var t=[],a={DrawData:t,DrawType:"FILLVERTICALRGN"};if(e.length<2)return a;for(var s=[],o=0;o<e.length&&o+1<e.length;o+=2)s.push({Cond:e[o],Color:e[o+1]});for(var o=0;o<this.SymbolData.Data.Data.length;++o){t[o]=null;var h={Color:null};for(var l in s){var u=s[l];if(Array.isArray(u.Cond)){if(o<u.Cond.length&&u.Cond[o]){h.Color=u.Color;break}}else if(this.IsNumber(u.Cond)&&u.Cond){h.Color=u.Color;break}}h.Color&&(t[o]=h)}return a},this.DRAWGBK=function(e,t,a,s){var o={Color:[],Angle:s};t&&o.Color.push(t),a&&o.Color.push(a);var h={DrawData:null,DrawType:"DRAWGBK"};if(Array.isArray(e))for(var l in e){var u=e[l];if(u){h.DrawData=o;break}}else e&&(h.DrawData=o);return h},this.DRAWGBK2=function(e,t,a,s){var o={Color:[],Angle:s};t&&o.Color.push(t),a&&o.Color.push(a);var h={DrawData:null,DrawType:"DRAWGBK2"};if(Array.isArray(e)){o.Data=[];for(var l in e){var u=e[l];o.Data[l]=u?1:0}h.DrawData=o}else e&&(h.DrawData=o,h.DrawType="DRAWGBK");return h},this.DRAWGBK_DIV=function(e,t,a,s,o){var h={AryColor:[t,a],ColorType:s,FillType:o,Data:[]},l={DrawData:h,DrawType:"DRAWGBK_DIV"};if(!this.SymbolData||!this.SymbolData.Data||!c.IsNonEmptyArray(this.SymbolData.Data.Data))return l;var u=this.SymbolData.Data.Data;if(Array.isArray(e))for(var f=0;f<u.length;++f){var C=e[f],D=null;if(C){var v=u[f];o==1?D={AryValue:[v.High,v.Low]}:o==2?D={AryValue:[v.Open,v.Close]}:D={AryValue:null}}h.Data[f]=D}else if(e)for(var f=0;f<u.length;++f){var v=u[f],D=null;o==1?D={AryValue:[v.High,v.Low]}:o==2?D={AryValue:[v.Open,v.Close]}:D={AryValue:null},h.Data[f]=D}return l},this.DRAWTEXT_LINE=function(e,t,a,s,o,h,l){var u={Text:{Title:a,Color:s},Line:{Type:h,Color:l}};o<=0&&(o=12),u.Text.Font=o*V()+"px 微软雅黑";var f={DrawData:null,DrawType:"DRAWTEXT_LINE"};if(Array.isArray(e))for(var C in e){var D=e[C];if(D){Array.isArray(t)?u.Price=t[C]:u.Price=t,f.DrawData=u;break}}else e&&(Array.isArray(t)?u.Price=t[0]:u.Price=t,f.DrawData=u);return f},this.DRAWRECTREL=function(e,t,a,s,o){var h={Rect:{Left:Math.min(e,a),Top:Math.min(t,s),Right:Math.max(a,e),Bottom:Math.max(s,t)},Color:o};o==0&&(h.Color=null);var l={DrawData:h,DrawType:"DRAWRECTREL"};return l},this.DRAWTEXTREL=function(e,t,a){var s={Point:{X:e,Y:t}};c.IsString(a)?s.Text=a:c.IsNonEmptyArray(a)&&(s.Text=a[0]);var o={DrawData:s,DrawType:"DRAWTEXTREL"};return o},this.DRAWTEXTABS=function(e,t,a){var s={Point:{X:e,Y:t}};c.IsString(a)?s.Text=a:c.IsNonEmptyArray(a)&&(s.Text=a[0]);var o={DrawData:s,DrawType:"DRAWTEXTABS"};return o},this.DRAWOVERLAYLINE=function(e,t,a){var s={Data:e,MainData:t};a&&typeof a=="string"&&(s.Title=a);var o={DrawData:s,DrawType:"DRAWOVERLAYLINE"};return o},this.DRAWSL=function(e,t,a,s,o){var h={Data:[],Option:[]},l={DrawData:h,DrawType:"DRAWSL"},u=this.IsNumber(t);if(Array.isArray(e))for(var f in e)h[f]=null,e[f]&&(u?(h.Data[f]=t,h.Option[f]={Slope:a,Length:s,Direct:o}):f<t.length&&this.IsNumber(t[f])&&(h.Data[f]=t[f],h.Option[f]={Slope:a,Length:s,Direct:o}));else if(e)for(var C=this.SymbolData.Data.Data.length,f=0;f<C;++f)h[f]=null,u?(h.Data[f]=t,h.Option[f]={Slope:a,Length:s,Direct:o}):f<t.length&&this.IsNumber(t[f])&&(h.Data[f]=t[f],h.Option[f]={Slope:a,Length:s,Direct:o});return l},this.VERTLINE=function(e,t){var a={Data:[],LineType:t},s={DrawData:a,DrawType:"VERTLINE"};if(Array.isArray(e))for(var o=0;o<e.length;++o){var h=e[o];h?a.Data[o]=1:a.Data[o]=0}return s},this.HORLINE=function(e,t,a,s){var o={Data:[],LineType:a,Extend:s},h={DrawData:o,DrawType:"HORLINE"};if(Array.isArray(e)&&Array.isArray(t))for(var l=0;l<e.length;++l){var u=e[l];if(o.Data[l]=null,!!u&&!(l>=t.length)){var f=t[l];c.IsNumber(f)&&(o.Data[l]=f)}}else if(Array.isArray(e)&&c.IsNumber(t))for(var l=0;l<e.length;++l){var u=e[l];o.Data[l]=null,u&&(o.Data[l]=t)}else if(c.IsNumber(e)&&e&&this.SymbolData&&this.SymbolData.Data&&this.SymbolData.Data.Data){if(Array.isArray(t)){for(var C=this.SymbolData.Data.Data.length,l=0;l<C;++l)if(o.Data[l]=null,!(l>=t.length)){var f=t[l];c.IsNumber(f)&&(o.Data[l]=f)}}else if(c.IsNumber(t))for(var C=this.SymbolData.Data.Data.length,l=0;l<C;++l)o.Data[l]=t}return h},this.BACKGROUND=function(e,t,a,s,o,h){var l={Margin:[0,1,1,1]};return e&&(l.Color=e),t&&(l.Border=t),c.IsNumber(a)&&(l.Margin[2]=a),c.IsNumber(s)&&(l.Margin[3]=s),c.IsNumber(o)&&(l.Margin[0]=o),c.IsNumber(h)&&(l.Margin[1]=h),l},this.CKLINE=function(e,t,a,s){var o={Color:e,LineWidth:1,LineType:0,LineDot:[3,3]};if(c.IsPlusNumber(t)&&(o.LineWidth=t),c.IsPlusNumber(a)&&(o.LineType=a),s){var h=s.split(","),l=[];for(var u in h){var f=h[u];if(f){var C=parseInt(h[u]);C<=0||l.push(C)}}l.length>0&&(o.LineDotted=l)}o.Data=[];for(var u=0;u<this.SymbolData.Data.Data.length;++u){var f=this.SymbolData.Data.Data[u];o.Data[u]={High:f.High,Low:f.Low}}return o}}Pr.prototype.CalculateDrawLine=function(r){r.List=[];for(var n=r.Start.ID;n<=r.End.ID;++n)r.List.push(n);var e=Math.abs(r.Start.Value-r.End.Value),t=r.List.length-1,a=[];if(a.push({ID:r.Start.ID,Value:r.Start.Value}),r.Start.Value>r.End.Value)for(var s=1;s<r.List.length-1;++s){var o=e*(r.List.length-1-s)/t+r.End.Value;a.push({ID:r.List[s],Value:o})}else for(var h=1;h<r.List.length-1;++h){var o=e*h/t+r.Start.Value;a.push({ID:r.List[h],Value:o})}return a.push({ID:r.End.ID,Value:r.End.Value}),a};Pr.prototype.IsNumber=function(r){return!(r==null||isNaN(r))};Pr.prototype.IsDrawFunction=function(r){var n=new Ee.default(["STICKLINE","DRAWTEXT","SUPERDRAWTEXT","DRAWLINE","DRAWBAND","DRAWKLINE","DRAWKLINE1","DRAWKLINE_IF","DRAWCOLORKLINE","PLOYLINE","POLYLINE","DRAWNUMBER","DRAWNUMBER_FIX","DRAWICON","DRAWCHANNEL","PARTLINE","DRAWTEXT_FIX","DRAWGBK","DRAWTEXT_LINE","DRAWRECTREL","DRAWTEXTABS","DRAWTEXTREL","DRAWOVERLAYLINE","FILLRGN","FILLRGN2","FILLTOPRGN","FILLBOTTOMRGN","FILLVERTICALRGN","FLOATRGN","DRAWSL","DRAWGBK2","DRAWGBK_DIV","VERTLINE","HORLINE","TIPICON"]);return!!n.has(r)};Pr.prototype.RemoveZero=function(r){for(;r.length>0;){var n=r.length-1,e=r[n];if(e=="0")r=r.substr(0,n);else if(e=="."){r=r.substr(0,n);break}else break}return r};var ni={YCLOSE:3,OPEN:4,HIGH:5,LOW:6,CLOSE:7,VOL:8,AMOUNT:10,AMPLITUDE:13,INCREASE:14,EXCHANGERATE:37};function Fs(r,n,e){this.AST=r,this.Execute=e,this.Symbol="600000.sh",this.Name,this.Data=null,this.PeriodData=new Dt.default,this.IsApiPeriod=!1,this.SourceData=null,this.MarketValue=null,this.Period=0,this.Right=0,this.DataType=0,this.IsBeforeData=!1,this.DayCount,this.Arguments=[],this.KLineApiUrl=zt.Domain+"/API/KLine2",this.MinuteKLineApiUrl=zt.Domain+"/API/KLine3",this.RealtimeApiUrl=zt.Domain+"/API/stock",this.HistoryMinuteApiUrl=m.Domain+"/API/StockMinuteData",this.StockHistoryDayApiUrl=zt.Domain+"/API/StockHistoryDay",this.StockHistoryDay3ApiUrl=zt.Domain+"/API/StockHistoryDay3",this.StockHistoryDay2ApiUrl=zt.Domain+"/API/StockHistoryDay2",this.StockNewsAnalysisApiUrl=zt.CacheDomain+"/cache/newsanalyze",this.HKToSHSZApiUrl=[zt.CacheDomain+"/cache/historyday/all/hk2shsz.json",zt.CacheDomain+"/cache/analyze/hk2shsz/hk2shsz.json",zt.Domain+"/API/HKToSHSZMinuteData",zt.CacheDomain+"/cache/analyze/hk2szshanalyze"],this.MaxRequestDataCount=1e3,this.MaxRequestMinuteDayCount=5,this.KLineDateTimeRange,this.LatestData=new Dt.default,this.IndexData,this.LatestIndexData,this.MarginData=new Dt.default,this.HKToSHSZData=new Dt.default,this.NewsAnalysisData=new Dt.default,this.ExtendData=new Dt.default,this.UserData=new Dt.default,this.CustomAPIData=new Dt.default,this.ScriptIndexOutData=new Dt.default,this.OtherSymbolData=new Dt.default,this.StockData=new Dt.default,this.SectionFinanceData=new Dt.default,this.ThrowSFPeirod=new Ee.default,this.NetworkFilter,this.DrawInfo,n&&(n.HQDataType&&(this.DataType=n.HQDataType),n.Data&&(this.Data=n.Data,this.DataType!=wt.MINUTE_ID&&this.DataType!=wt.MULTIDAY_MINUTE_ID&&this.DataType!=wt.HISTORY_MINUTE_ID&&(this.Period=n.Data.Period,this.Right=n.Data.Right)),n.SourceData&&(this.SourceData=n.SourceData),n.Symbol&&(this.Symbol=n.Symbol),n.Name&&(this.Name=n.Name),n.MaxRequestDataCount>0&&(this.MaxRequestDataCount=n.MaxRequestDataCount),n.MaxRequestMinuteDayCount>0&&(this.MaxRequestMinuteDayCount=n.MaxRequestMinuteDayCount),n.KLineApiUrl&&(this.KLineApiUrl=n.KLineApiUrl),n.Right&&(this.Right=n.Right),n.Period&&(this.Period=n.Period),n.IsBeforeData===!0&&(this.IsBeforeData=n.IsBeforeData),n.NetworkFilter&&(this.NetworkFilter=n.NetworkFilter),n.DayCount>0&&(this.DayCount=n.DayCount),n.Arguments&&(this.Arguments=n.Arguments),n.KLineRange&&(this.KLineDateTimeRange=n.KLineRange),n.IsApiPeriod&&(this.IsApiPeriod=n.IsApiPeriod),n.DrawInfo&&(this.DrawInfo=n.DrawInfo)),this.RecvError=function(t){throw X.Complier.Log("[JSSymbolData::RecvError] ajax error.",t.status),{FunctionName:"RecvError",Request:t}},this.GetLatestDataKey=function(a){var a="DYNAINFO-"+a;return a},this.GetLatestData=function(t){var a=this.JobArgumentsToArray(t,1),s=a[0],o=this.GetLatestDataKey(s);if(this.LatestData.has(o))return this.Execute.RunNextJob();var h=this;if(this.NetworkFilter){var l={Name:"JSSymbolData::GetLatestData",Explain:"DYNAINFO()",Args:a,Request:{Url:h.RealtimeApiUrl,Type:"POST",Data:{symbol:[this.Symbol],field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","exchangerate","amplitude"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(l,function(u){h.RecvLatestData(u),h.Execute.RunNextJob()}),l.PreventDefault==!0)return}Lt.HttpRequest({url:h.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","exchangerate","amplitude"],symbol:[this.Symbol]},type:"post",dataType:"json",async:!0,success:function(f){h.RecvLatestData(f),h.Execute.RunNextJob()},error:function(f){h.RecvError(f)}})},this.RecvLatestData=function(t){if(t.ver==2){this.RecvLatestDataVer2(t);return}if(!(!t.stock||t.stock.length!=1)){var a=t.stock[0];a&&(c.IsNumber(a.yclose)&&this.LatestData.set(ni.YCLOSE,a.yclose),c.IsNumber(a.open)&&this.LatestData.set(ni.OPEN,a.open),c.IsNumber(a.high)&&this.LatestData.set(ni.HIGH,a.high),c.IsNumber(a.low)&&this.LatestData.set(ni.LOW,a.low),c.IsNumber(a.price)&&this.LatestData.set(ni.CLOSE,a.price),c.IsNumber(a.vol)&&this.LatestData.set(ni.VOL,a.vol),c.IsNumber(a.amount)&&this.LatestData.set(ni.AMOUNT,a.amount),c.IsNumber(a.increase)&&this.LatestData.set(ni.INCREASE,a.increase),c.IsNumber(a.exchangerate)&&this.LatestData.set(ni.EXCHANGERATE,a.exchangerate),c.IsNumber(a.amplitude)&&this.LatestData.set(ni.AMPLITUDE,a.amplitude),X.Complier.Log("[JSSymbolData::RecvLatestData] symbol, LatestData",a.symbol,this.LatestData))}},this.RecvLatestDataVer2=function(t){if(c.IsNonEmptyArray(t.data)){for(var a=t.symbol,s=0;s<t.data.length;++s){var o=t.data[s];o&&c.IsNumber(o.id)&&(c.IsNumber(o.value)||c.IsString(o.value))&&(X.Complier.Log("[JSSymbolData::RecvLatestDataVer2] symbol="+a+" DYNAINFO("+o.id+")="+o.value+"."),this.LatestData.set(o.id,o.value))}X.Complier.Log("[JSSymbolData::RecvLatestDataVer2]",this.LatestData)}},this.GetLatestCacheData=function(t){return this.LatestData.has(t)?this.LatestData.get(t):null},this.GetLatestIndexData=function(){if(this.LatestIndexData)return this.Execute.RunNextJob();var t=this;if(this.NetworkFilter){var a={Name:"JSSymbolData::GetLatestIndexData",Explain:"最新大盘数据",Request:{Url:t.RealtimeApiUrl,Type:"POST",Data:{symbol:["000001.sh"],field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","amplitude"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(a,function(s){t.RecvLatestIndexData(s),t.Execute.RunNextJob()}),a.PreventDefault==!0)return}Lt.HttpRequest({url:t.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","time","increase","amplitude"],symbol:["000001.sh"]},type:"post",dataType:"json",async:!0,success:function(o){t.RecvLatestIndexData(o),t.Execute.RunNextJob()},error:function(o){t.RecvError(o)}})},this.RecvLatestIndexData=function(t){if(!(!t.stock||t.stock.length!=1)){var a=t.stock[0];this.LatestIndexData={Symbol:a.symbol,Name:a.name,Date:a.date,Time:a.time,YClose:a.yclose,Price:a.price,Open:a.open,High:a.high,Low:a.low,Vol:a.vol,Amount:a.amount,Increase:a.increase,Amplitude:a.amplitude},X.Complier.Log("[JSSymbolData::RecvLatestIndexData]",this.LatestIndexData)}},this.GetLatestIndexCacheData=function(t){if(!this.LatestIndexData)return null;switch(t){case"FROMOPEN":{var a=parseInt(this.LatestIndexData.Time/100),s=parseInt(a/100)*60+a%100,o=0;return s<=9*60+25?o=0:s<9*60+30?o=1:s<=11*60+30?o=s-(9*60+30)+1:s<13*60?o=121:s<=15*60?o=122+s-13*60:o=242,o}default:return null}},this.GetVolRateData=function(t,a){var s=t.ID.toString()+"-VolRate-"+this.Symbol;if(this.ExtendData.has(s))return this.Execute.RunNextJob();var o=this,h=30;if(this.NetworkFilter){var l=this.Data.GetDateRange(),h=1;this.DataType==wt.MULTIDAY_MINUTE_ID&&(h=this.DayCount);var u={Name:"JSSymbolData::GetVolRateData",Explain:"分时量比数据(成交量)",Request:{Url:o.KLineApiUrl,Type:"POST",Data:{symbol:o.Symbol,dayCount:h,field:["name","symbol","vol"],period:0,right:0,dateRange:l}},Self:this,PreventDefault:!1};if(this.NetworkFilter(u,function(C){o.RecvVolRateData(C,s),o.Execute.RunNextJob()}),u.PreventDefault==!0)return}Lt.HttpRequest({url:o.KLineApiUrl,data:{field:["name","symbol","vol"],symbol:o.Symbol,start:-1,count:h},type:"post",dataType:"json",async:!0,success:function(C){o.RecvVolRateData(C,s),o.Execute.RunNextJob()},error:function(C){o.RecvError(C)}})},this.RecvVolRateData=function(t,a){var s=0,o=0,h=new Dt.default;if(t.Ver==2){if(!c.IsNonEmptyArray(t.data))return;for(var l=0;l<t.data.length;++l){var u=t.data[l];c.IsNonEmptyArray(u)&&(u.length<2||c.IsNumber(u[0])&&c.IsPlusNumber(u[1])&&h.set(u[0],{AvgVol5:u[1]}))}}else{if(!c.IsNonEmptyArray(t.data))return;var f=241;c.IsNumber(t.minutecount)&&(f=t.minutecount);for(var l=0,C=0,D=0;l<t.data.length;++l){for(s=0,C=l,D=0;C>=0&&D<5;--C,++D){var u=t.data[C];c.IsNumber(u[6])&&(s+=u[6])}if(D>0){o=s/D/f;var u=t.data[l];h.set(u[0],{AvgVol5:o})}}}h.size>0&&this.ExtendData.set(a,h),X.Complier.Log("[JSSymbolData::RecvVolRateData]",h)},this.GetVolRateCacheData=function(t){var a=K.JOB_DOWNLOAD_VOLR_DATA.toString()+"-VolRate-"+this.Symbol;(!a||!this.ExtendData.has(a))&&this.Execute.ThrowUnexpectedNode(t,"不支持VOLR");for(var s=[],o=this.ExtendData.get(a),h=0,l=0,u=null,f=0,C=0;f<this.Data.Data.length;++f){s[f]=null;var D=this.Data.Data[f];if(l!=D.Date){if(u=null,C=0,h=0,o.has(D.Date)){var v=o.get(D.Date);u=v.AvgVol5}l=D.Date}u!=null&&(h+=D.Vol,s[f]=h/(C+1)/u*100,++C)}return s},this.GetIndexData=function(){if(this.IndexData)return this.Execute.RunNextJob();var t=this;if(k.IsDayPeriod(this.Period,!0)){if(this.NetworkFilter){var a=this.Data.GetDateRange(),s={Name:"JSSymbolData::GetIndexData",Explain:"大盘数据",Period:t.Period,Request:{Url:t.KLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol","up","down","stop","unchanged"],indexSymbol:"000001.sh",symbol:this.Symbol,period:this.Period,dateRange:a}},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(o){t.RecvIndexHistroyData(o),t.Execute.RunNextJob()}),s.PreventDefault==!0)return}Lt.HttpRequest({url:t.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","up","down","stop","unchanged"],symbol:"000001.sh",start:-1,count:t.MaxRequestDataCount+500},type:"post",dataType:"json",async:!0,success:function(h){t.RecvIndexHistroyData(h),t.Execute.RunNextJob()},error:function(h){t.RecvError(h)}})}else if(k.IsMinutePeriod(this.Period,!0)){if(this.NetworkFilter){var a=this.Data.GetDateRange(),s={Name:"JSSymbolData::GetIndexData",Explain:"大盘数据",Period:t.Period,Request:{Url:t.MinuteKLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],indexSymbol:"000001.sh",symbol:this.Symbol,period:this.Period,dateRange:a}},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(l){t.RecvIndexMinuteHistroyData(l),t.Execute.RunNextJob()}),s.PreventDefault==!0)return}Lt.HttpRequest({url:t.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:"000001.sh",start:-1,count:t.MaxRequestMinuteDayCount+5},type:"post",dataType:"json",async:!0,success:function(h){t.RecvIndexMinuteHistroyData(h),t.Execute.RunNextJob()},error:function(h){t.RecvError(h)}})}},this.RecvIndexHistroyData=function(t){X.Complier.Log("[JSSymbolData::RecvIndexHistroyData] recv data",t);var a=this.JsonDataToHistoryData(t);if(this.IndexData=new k,this.IndexData.DataType=0,this.IndexData.Data=a,this.IsApiPeriod==!0)this.IndexData.Period=this.Period,this.IndexData.Data=this.Data.FixKData(a,this.Period);else{var s=this.SourceData.GetOverlayData(this.IndexData.Data);if(this.IndexData.Data=s,k.IsDayPeriod(this.Period,!1)){var o=this.IndexData.GetPeriodData(this.Period);this.IndexData.Data=o}}},this.RecvIndexMinuteHistroyData=function(t){X.Complier.Log("[JSSymbolData::RecvIndexMinuteHistroyData] recv data",t);var a=this.JsonDataToMinuteHistoryData(t);if(this.IndexData=new k,this.IndexData.DataType=1,this.IndexData.Data=a,this.IsApiPeriod==!0)this.IndexData.Period=this.Period,this.IndexData.Data=this.Data.FixKData(a,this.Period);else if(k.IsMinutePeriod(this.Period,!1)){var s=this.IndexData.GetPeriodData(this.Period);this.IndexData.Data=s}},this.GetOtherSymbolParam=function(t){var a=t.split("$"),s=new Ee.default(["CLOSE","C","VOL","V","OPEN","O","HIGH","H","LOW","L","AMOUNT","AMO","VOLINSTK"]);if(!s.has(a[1]))return null;var o=a[0];if(o.length==6)o[0]=="6"||o[0]=="5"||o[0]=="8"||o[0]=="9"?o+=".SH":(o[0]=="0"||o[0]=="1"||o[0]=="2"||o[0]=="3")&&(o+=".SZ");else if(o.indexOf("SZ")==0)o=o.substr(2)+".SZ";else if(o.indexOf("SH")==0)o=o.substr(2)+".SH";else if(o.indexOf("_")>0){var h=o.split("_");o=h[1]+"."+h[0]}else return null;return{Symbol:o.toLowerCase(),DataName:a[1]}},this.GetOtherSymbolData=function(t){var a=this.Symbol;if(t.Literal){var s=this.GetOtherSymbolParam(t.Literal.toUpperCase());if(!s){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,t.Literal+" Error.")}a=s.Symbol}else{var s=t.Args;if(s.length>0){var h=s[0];if(h.Type==vt.Literal)a=h.Value;else if(h.Type==vt.Identifier){var l=!1;for(var u in this.Arguments){var f=this.Arguments[u];if(f.Name==h.Name){a=f.Value,l=!0;break}}if(!l){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,t.FunctionName+"() Error: can't read "+h.Name)}}}}if(t.Symbol=a.toLowerCase(),t.Symbol==this.Symbol)return this.Execute.RunNextJob();if(this.OtherSymbolData.has(t.Symbol))return this.Execute.RunNextJob();var C=this;if(this.DataType==wt.KLINE_ID&&k.IsDayPeriod(this.Period,!0)){if(this.NetworkFilter){var D=this.Data.GetDateRange(),v={Name:"JSSymbolData::GetOtherSymbolData",Explain:"指定个股数据",Request:{Data:{symbol:t.Symbol,right:C.Right,period:C.Period,dateRange:D}},Self:this,PreventDefault:!1};if(this.NetworkFilter(v,function(S){C.RecvOtherSymbolKData(S,t),C.Execute.RunNextJob()}),v.PreventDefault==!0)return}Lt.HttpRequest({url:C.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:C.MaxRequestDataCount+500},type:"post",dataType:"json",async:!0,success:function(T){C.RecvOtherSymbolKDayData(T,t),C.Execute.RunNextJob()},error:function(T){C.RecvError(T)}})}else if(k.IsMinutePeriod(this.Period,!0)||this.DataType==wt.MINUTE_ID||this.DataType==wt.MULTIDAY_MINUTE_ID){if(this.NetworkFilter){var D=this.Data.GetDateRange(),v={Name:"JSSymbolData::GetOtherSymbolData",Explain:"指定个股数据",Request:{Data:{symbol:t.Symbol,right:C.Right,period:C.Period,dateRange:D}},Self:this,PreventDefault:!1};if(this.NetworkFilter(v,function(I){C.RecvOtherSymbolKData(I,t),C.Execute.RunNextJob()}),v.PreventDefault==!0)return}Lt.HttpRequest({url:C.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:C.MaxRequestMinuteDayCount+5},type:"post",dataType:"json",async:!0,success:function(T){C.RecvOtherSymbolKMinuteData(T,t),C.Execute.RunNextJob()},error:function(T){C.RecvError(T)}})}},this.RecvOtherSymbolKData=function(t,a){X.Complier.Log("[JSSymbolData::RecvOtherSymbolKData] recv data",t);var s=new k,o=null,h=this.Period;this.DataType==wt.KLINE_ID&&k.IsDayPeriod(this.Period,!0)?(o=this.JsonDataToHistoryData(t),s.DataType=0):(o=this.JsonDataToMinuteHistoryData(t),s.DataType=1,(this.DataType==wt.MINUTE_ID||this.DataType==wt.MULTIDAY_MINUTE_ID)&&(h=4)),s.Period=this.Period,s.Right=this.Right,s.Data=this.Data.FixKData(o,h),this.OtherSymbolData.set(a.Symbol,s)},this.RecvOtherSymbolKDayData=function(t,a){X.Complier.Log("[JSSymbolData::RecvOtherSymbolKDayData] recv data",t);var s=this.JsonDataToHistoryData(t),o=new k;o.DataType=0,o.Data=s;var h=this.SourceData.GetOverlayData(o.Data);if(o.Data=h,k.IsDayPeriod(this.Period,!1)){var l=o.GetPeriodData(this.Period);o.Data=l}this.OtherSymbolData.set(a.Symbol,o)},this.RecvOtherSymbolKMinuteData=function(t,a){X.Complier.Log("[JSSymbolData::RecvOtherSymbolKMinuteData] recv data",t);var s=this.JsonDataToMinuteHistoryData(t),o=new k;if(o.DataType=1,o.Data=s,k.IsMinutePeriod(this.Period,!1)){var h=o.GetPeriodData(this.Period);o.Data=h}this.OtherSymbolData.set(a.Symbol,o)},this.GetOtherSymolCacheData=function(t){var a,s;if(t.FunctionName){s=t.FunctionName;var o=t.Args;if(o.length<=0)return this.GetSymbolCacheData(s);a=o[0].toString().toLowerCase()}else if(t.Literal){var o=this.GetOtherSymbolParam(t.Literal.toUpperCase());if(!o)return[];a=o.Symbol,s=o.DataName}if(a==this.Symbol)return this.GetSymbolCacheData(s);if(!this.OtherSymbolData.has(a))return[];var h=this.OtherSymbolData.get(a),l=a.toUpperCase();switch(s){case"CLOSE":case"C":return h.GetClose();case"VOL":case"V":return W.IsSHSZ(l)?h.GetVol(100):h.GetVol();case"OPEN":case"O":return h.GetOpen();case"HIGH":case"H":return h.GetHigh();case"LOW":case"L":return h.GetLow();case"AMOUNT":case"AMO":return h.GetAmount();case"VOLINSTK":return h.GetPosition()}},this.GetIndexCacheData=function(t){if(!this.IndexData)return new Array;switch(t){case"INDEXA":return this.IndexData.GetAmount();case"INDEXC":return this.IndexData.GetClose();case"INDEXH":return this.IndexData.GetHigh();case"INDEXL":return this.IndexData.GetLow();case"INDEXO":return this.IndexData.GetOpen();case"INDEXV":return this.IndexData.GetVol();case"INDEXADV":return this.IndexData.GetUp();case"INDEXDEC":return this.IndexData.GetDown()}},this.GetBlockSymbol=function(t){var a=new Dt.default([["沪深A股","CNA.ci"],["创业板","GEM.ci"],["沪市A股","SHA.ci"],["中小板","SME.ci"],["深市A股","SZA.ci"]]);if(a.has(t))return a.get(t);if(!t)return null;var s=null,o=t.toUpperCase();if(o.indexOf(".SH")>0||o.indexOf(".SZ")>0){var h=new Ee.default(["000001.SH","000003.SH","000016.SH","000300.SH","000905.SH","399001.SZ"," 399005.SZ","399006.SZ"]);if(!h.has(o))return null;s=t.replace(".SH",".sh"),s=t.replace(".SZ",".sz")}else t.indexOf(".CI")>0&&(s=t.replace(".CI",".ci"));return s},this.GetIndexIncreaseData=function(t){var a=null;if(t.IsSelfSymbol)a=this.Symbol;else{if(!t.Args||t.Args.length<=0){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,t.FunctionName+" Error: 参数不能为空")}a=t.Args[0].Value}var o=this.GetBlockSymbol(a);if(!o){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,t.FunctionName+" Error: can't support "+a)}var h=t.ID.toString()+"-UpCount-"+o,l=t.ID.toString()+"-DownCount-"+o;if(this.ExtendData.has(h)&&this.ExtendData.has(l))return this.Execute.RunNextJob();var u=this;if(this.NetworkFilter){var f={Type:this.DataType};this.DataType===wt.KLINE_ID&&(f.Period=this.Period);var C=this.Data.GetDateRange(),D={Name:"JSSymbolData::GetIndexIncreaseData",Explain:"涨停家数统计",DateRange:C,DataType:f,Request:{Url:"数据地址",Type:"POST",Data:{symbol:this.Symbol,blocksymbol:o,field:["up","down"]}},Self:this,PreventDefault:!1};if(this.NetworkFilter(D,function(S){this.DataType===wt.KLINE_ID?this.RecvHistoryIncreaseDataV2(S,{UpKey:h,DownKey:l}):this.RecvMinuteIncreaseDataV2(S,{UpKey:h,DownKey:l}),u.Execute.RunNextJob()}),D.PreventDefault==!0)return}if(this.DataType===wt.MINUTE_ID||this.DataType===wt.MULTIDAY_MINUTE_ID){var v=zt.CacheDomain+"/cache/analyze/increaseanalyze/"+o+".json";X.Complier.Log("[JSSymbolData::GetIndexIncreaseData] minute Get url=",v),Lt.HttpRequest({url:v,type:"get",dataType:"json",async:!0,success:function(T){u.RecvMinuteIncreaseData(T,{UpKey:h,DownKey:l}),u.Execute.RunNextJob()},error:function(T){u.RecvError(T)}})}else this.DataType===wt.KLINE_ID&&k.IsDayPeriod(this.Period,!0)?(X.Complier.Log("[JSSymbolData::GetIndexIncreaseData] K day Get url=",u.KLineApiUrl),Lt.HttpRequest({url:u.KLineApiUrl,data:{symbol:o,start:-1,count:u.MaxRequestDataCount,field:["up","down"]},type:"post",dataType:"json",async:!0,success:function(T){u.RecvHistoryIncreaseData(T,{UpKey:h,DownKey:l}),u.Execute.RunNextJob()},error:function(T){u.RecvError(T)}})):this.Execute.RunNextJob()},this.RecvHistoryIncreaseDataV2=function(t,a){X.Complier.Log("[JSSymbolData::RecvHistoryIncreaseData] recv data, key",t,a);var s=[],o=[];for(var h in t.data){var l=t.data[h],u=new yt,f=new yt,C=l[0],D=null;u.Date=C,f.Date=C,k.IsMinutePeriod(this.Period,!0)&&c.IsNumber(l[1])&&(D=l[1],u.Time=D,f.Time=D),u.Value=l[2],s[h]=u,f.Value=l[3],o[h]=f}var v=this.Data.GetFittingData2(s,0),S=this.Data.GetFittingData2(o,0);this.ExtendData.set(a.UpKey,v),this.ExtendData.set(a.DownKey,S)},this.RecvHistoryIncreaseData=function(t,a){X.Complier.Log("[JSSymbolData::RecvHistoryIncreaseData] recv data",t);var s=[],o=[];for(var h in t.data){var l=t.data[h],u=new yt,f=new yt;u.Date=l[0],u.Value=l[8],s[h]=u,f.Date=l[0],f.Value=l[9],o[h]=f}var C,D;this.SourceData?C=this.SourceData.GetFittingData(s):C=this.Data.GetFittingData(aryData),this.SourceData?D=this.SourceData.GetFittingData(o):D=this.Data.GetFittingData(aryData),this.ExtendData.set(a.UpKey,C),this.ExtendData.set(a.DownKey,D)},this.RecvMinuteIncreaseDataV2=function(t,a){X.Complier.Log("[JSSymbolData::RecvMinuteIncreaseDataV2] recv data, key",t,a)},this.RecvMinuteIncreaseData=function(t,a){if(X.Complier.Log("[JSSymbolData::RecvMinuteIncreaseData] recv data",t),!!t.minute){var s=t.minute;if(!(!s.time||!s.up||!s.down)){var o=[],h=[];if(this.IsBeforeData)for(var l=0,u=0;l<this.Data.Data.length;++l){o[l]=null,h[l]=null;var f=this.Data.Data[l];if(!f.Before){var C=f.DateTime;if(C){var D=C.split(" ");if(D.length==2){var v=parseInt(D[0]);v==t.date&&(o[l]=s.up[u],h[l]=s.down[u],++u)}}}}else for(var l=0,u=0;l<this.Data.Data.length;++l){o[l]=null,h[l]=null;var f=this.Data.Data[l],C=f.DateTime;if(C){var D=C.split(" ");if(D.length==2){var v=parseInt(D[0]);v==t.date&&(o[l]=s.up[u],h[l]=s.down[u],++u)}}}this.ExtendData.set(a.UpKey,o),this.ExtendData.set(a.DownKey,h)}}},this.GetIndexIncreaseCacheData=function(t,a,s){var o=this.GetBlockSymbol(a);o||this.Execute.ThrowUnexpectedNode(s,"不支持函数"+t+"("+a+")");var h;if(t=="UPCOUNT"||t=="ADVANCE"?h=K.JOB_DOWNLOAD_INDEX_INCREASE_DATA.toString()+"-UpCount-"+o:(t=="DOWNCOUNT"||t=="DECLINE")&&(h=K.JOB_DOWNLOAD_INDEX_INCREASE_DATA.toString()+"-DownCount-"+o),(!h||!this.ExtendData.has(h))&&this.Execute.ThrowUnexpectedNode(s,"不支持函数"+t+"("+a+")"),this.DataType===wt.MINUTE_ID||this.DataType===wt.MULTIDAY_MINUTE_ID)return this.ExtendData.get(h);if(this.DataType===wt.KLINE_ID&&k.IsDayPeriod(this.Period,!0)){var l=this.ExtendData.get(h),u=new k;if(u.Data=l,u.Period=this.Period,u.Period>0){var f=u.GetPeriodSingleData(u.Period);u.Data=f}return u.GetValue()}else return null},this.GetSymbolData=function(){if(this.Data)return this.Execute.RunNextJob();var t=this;if(this.DataType===wt.MINUTE_ID){Lt.HttpRequest({url:t.RealtimeApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol","amount","date","minute","time","minutecount"],symbol:[t.Symbol],start:-1},type:"post",dataType:"json",async:!0,success:function(o){t.RecvMinuteData(o),t.Execute.RunNextJob()}});return}if(this.DataType===wt.MULTIDAY_MINUTE_ID){Lt.HttpRequest({url:t.HistoryMinuteApiUrl,data:{symbol:t.Symbol,daycount:t.DayCount},type:"post",dataType:"json",async:!0,success:function(o){t.RecvMultiDayMinuteData(o),t.Execute.RunNextJob()}});return}if(k.IsDayPeriod(this.Period,!0)){if(this.NetworkFilter){var a={Name:"JSSymbolData::GetSymbolData",Explain:"日线数据",Request:{Url:t.RealtimeApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestDataCount,period:this.Period,right:this.Right}},Self:this,PreventDefault:!1};if(this.KLineDateTimeRange&&(a.Request.KLineDataTimeRange={Start:{Date:this.KLineDateTimeRange.Start.Date},End:{Date:this.KLineDateTimeRange.End.Date}},this.IsNumber(this.KLineDateTimeRange.Start.Time)&&(a.Request.KLineDataTimeRange.Start.Time=this.KLineDateTimeRange.Start.Time),this.IsNumber(this.KLineDateTimeRange.End.Time)&&(a.Request.KLineDataTimeRange.End.Time=this.KLineDateTimeRange.End.Time)),this.NetworkFilter(a,function(s){t.RecvHistroyData(s),t.Execute.RunNextJob()}),a.PreventDefault==!0)return}Lt.HttpRequest({url:t.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(o){t.RecvHistroyData(o),t.Execute.RunNextJob()},error:function(o){t.RecvError(o)}})}else if(k.IsMinutePeriod(this.Period,!0)){if(this.NetworkFilter){var a={Name:"JSSymbolData::GetSymbolData",Explain:"分钟K线数据",Request:{Url:t.MinuteKLineApiUrl,Type:"POST",Data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestMinuteDayCount,period:this.Period,right:this.Right}},Self:this,PreventDefault:!1};if(this.KLineDateTimeRange&&(a.Request.KLineDataTimeRange={Start:{Date:this.KLineDateTimeRange.Start.Date},End:{Date:this.KLineDateTimeRange.End.Date}},this.IsNumber(this.KLineDateTimeRange.Start.Time)&&(a.Request.KLineDataTimeRange.Start.Time=this.KLineDateTimeRange.Start.Time),this.IsNumber(this.KLineDateTimeRange.End.Time)&&(a.Request.KLineDataTimeRange.End.Time=this.KLineDateTimeRange.End.Time)),this.NetworkFilter(a,function(o){t.RecvMinuteHistroyData(o),t.Execute.RunNextJob()}),a.PreventDefault==!0)return}Lt.HttpRequest({url:this.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:t.Symbol,start:-1,count:t.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(o){t.RecvMinuteHistroyData(o),t.Execute.RunNextJob()},error:function(o){t.RecvError(o)}})}},this.RecvHistroyData=function(t){X.Complier.Log("[JSSymbolData::RecvHistroyData] recv data",t);var a=this.JsonDataToHistoryData(t);if(this.Data=new k,this.Data.DataType=0,this.Data.Data=a,this.SourceData=new k,this.SourceData.Data=a,!this.IsApiPeriod){if(this.Right>0){var s=this.Data.GetRightData(this.Right);this.Data.Data=s}if(k.IsDayPeriod(this.Period,!1)){var o=this.Data.GetPeriodData(this.Period);this.Data.Data=o}}this.Data.Right=this.Right,this.Data.Period=this.Period,this.Name=t.name},this.RecvMinuteHistroyData=function(t){X.Complier.Log("[JSSymbolData::RecvMinuteHistroyData] recv data",t);var a=this.JsonDataToMinuteHistoryData(t);if(this.Data=new k,this.Data.DataType=1,this.Data.Data=a,this.SourceData=new k,this.SourceData.Data=a,!this.IsApiPeriod){if(k.IsMinutePeriod(this.Period,!1)){var s=this.Data.GetPeriodData(this.Period);this.Data.Data=s}}this.Data.Period=this.Period,this.Name=t.name},this.RecvMinuteData=function(t){X.Complier.Log("[JSSymbolData::RecvMinuteData] recv data",t);var a=this.JsonDataToMinuteData(t);this.Data=new k,this.Data.DataType=2,this.Data.Data=a,this.Name=t.stock[0].name},this.RecvMultiDayMinuteData=function(t){var a=this.JsonDataToMultiDayMinuteData(t);this.Data=new k,this.Data.DataType=2,this.Data.Data=a,this.Name=t.name},this.GetSymbolCacheData=function(t){if(!this.Data)return new Array;var a=this.Symbol.toUpperCase();switch(t){case"CLOSE":case"C":return this.Data.GetClose();case"VOL":case"V":return W.IsSHSZ(a)?this.Data.GetVol(100):this.Data.GetVol();case"OPEN":case"O":return this.Data.GetOpen();case"HIGH":case"H":return this.Data.GetHigh();case"LOW":case"L":return this.Data.GetLow();case"AMOUNT":case"AMO":return this.Data.GetAmount();case"OPI":case"VOLINSTK":return this.Data.GetPosition();case"ZSTJJ":return this.Data.GetAvPrice();case"SETTLE":case"QHJSJ":return this.Data.GetSettlementPrice();case"ISEQUAL":return this.Data.GetIsEqual();case"ISUP":return this.Data.GetIsUp();case"ISDOWN":return this.Data.GetIsDown()}},this.GetSymbolPeriodData=function(t){var a=Ka.GetPeriodInfo({Name:t.PeriodName}).Period,s={PeriodID:a,PeriodName:t.PeriodName};if(a==this.Period&&this.Execute.RunNextJob(),this.IsApiPeriod){if(this.PeriodData.has(t.PeriodName))return this.Execute.RunNextJob()}else if(k.IsDayPeriod(a,!0)){if(k.IsDayPeriod(this.Period,!0))return this.Execute.RunNextJob();s={PeriodID:0,PeriodName:"DAY"}}else if(k.IsMinutePeriod(a,!0)){if(k.IsMinutePeriod(this.Period,!0))return this.Execute.RunNextJob();s={PeriodID:4,PeriodName:"MIN1"}}else return this.Execute.RunNextJob();var o=this;if(this.NetworkFilter){var h={Name:"JSSymbolData::GetSymbolPeriodData",Explain:"跨周期数据",Request:{Data:{field:["symbol","name",t.ValueName],period:t.PeriodName,symbol:o.Symbol}},Self:this,PreventDefault:!1};if(this.NetworkFilter(h,function(l){o.RecvSymbolPeriodData(l,s),o.Execute.RunNextJob()}),h.PreventDefault==!0)return}if(k.IsMinutePeriod(a,!0))Lt.HttpRequest({url:this.MinuteKLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:o.Symbol,start:-1,count:o.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(u){o.RecvSymbolPeriodData(u,s),o.Execute.RunNextJob()},error:function(u){o.RecvError(u)}});else if(k.IsDayPeriod(a,!0))Lt.HttpRequest({url:o.KLineApiUrl,data:{field:["name","symbol","yclose","open","price","high","low","vol"],symbol:o.Symbol,start:-1,count:o.MaxRequestDataCount},type:"post",dataType:"json",async:!0,success:function(u){o.RecvSymbolPeriodData(u,s),o.Execute.RunNextJob()},error:function(u){o.RecvError(u)}});else return this.Execute.RunNextJob()},this.RecvSymbolPeriodData=function(t,a){if(X.Complier.Log("[JSSymbolData::RecvSymbolPeriodData] data, periodInfo ",t,a),k.IsDayPeriod(a.PeriodID,!0)){var s=this.JsonDataToHistoryData(t),o=new k;o.DataType=0,o.Data=s,o.Right=0,o.Period=a.PeriodID,this.PeriodData.set(a.PeriodName,o)}else if(k.IsMinutePeriod(a.PeriodID,!0)){var s=this.JsonDataToMinuteHistoryData(t),h=new k;h.DataType=1,h.Data=s,h.Right=0,h.Period=a.PeriodID,this.PeriodData.set(a.PeriodName,h)}},this.GetSymbolPeriodCacheData=function(t,a){var s=Ka.GetPeriodInfo({Name:a});if(this.Period==s.Period)return this.GetSymbolCacheData(t);var o=null;if(this.IsApiPeriod){var h=Ka.GetPeriodInfo({PeriodID:this.Period});if(!h||h.Order>s.Order||!this.PeriodData.has(a))return null;o=this.PeriodData.get(a),o=o.Data}else{var h=Ka.GetPeriodInfo({PeriodID:this.Period});if(!h||h.Order>s.Order)return null;if(k.IsDayPeriod(s.Period,!0)&&k.IsMinutePeriod(this.Period,!0)){var l=this.PeriodData.get("DAY");s.Period==0?o=l.Data:o=l.GetPeriodData(s.Period)}else{var u=new k;if(u.Data=this.SourceData.Data,u.Period=this.Period,u.Right=this.Right,k.IsDayPeriod(s.Period,!0)&&u.Right>0){var f=u.GetRightData(u.Right);u.Data=f}o=u.GetPeriodData(s.Period)}}var C=this.Data.ConverPeriod(o,this.Period,s.Period),D=new k;D.Data=C;var v=this.Symbol.toUpperCase();switch(t){case"C":case"CLOSE":return D.GetClose();case"O":case"OPEN":return D.GetOpen();case"H":case"HIGH":return D.GetHigh();case"L":case"LOW":return D.GetLow();case"AMO":case"AMOUNT":return D.GetAmount();case"V":case"VOL":return W.IsSHSZ(v)?D.GetVol(100):D.GetVol();case"VOLINSTK":return D.GetPosition();default:return null}},this.GetSymbolPeriodCacheData2=function(t,a,s){var o=Ka.GetPeriodInfo({Name:a});if(!o)return null;var h=Ka.GetPeriodInfo({PeriodID:this.Period});if(!h||h.Order>o.Order)return null;var l;if(h.Period==o.Period)l=this.Data;else{var u;if(this.IsApiPeriod){if(!this.PeriodData.has(a))return null;u=this.PeriodData.get(a)}else if(k.IsMinutePeriod(h.Period,!0)&&k.IsDayPeriod(o.Period,!0)){var f=this.PeriodData.get("DAY");o.Period==0?u=f:u=f.GetPeriodData(o.Period)}else{var C=new k;if(C.Data=this.SourceData.Data,C.Period=this.Period,C.Right=this.Right,k.IsDayPeriod(o.Period,!0)&&C.Right>0){var D=C.GetRightData(C.Right);C.Data=D}u=C.GetPeriodData(o.Period)}var v=this.Data.ConverPeriod(u,this.Period,o.Period),l=new k;l.Data=v}if(c.IsPlusNumber(s)){var S=new k,v=l.GetRef(s);S.Data=v,l=S}var T=this.Symbol.toUpperCase();switch(t){case"C":case"CLOSE":return l.GetClose();case"O":case"OPEN":return l.GetOpen();case"H":case"HIGH":return l.GetHigh();case"L":case"LOW":return l.GetLow();case"AMO":case"AMOUNT":return l.GetAmount();case"V":case"VOL":return W.IsSHSZ(T)?l.GetVol(100):l.GetVol();case"VOLINSTK":return l.GetPosition();default:return null}},this.GetCurrBarsCount=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a=this.Data.Data.length,s=a-1;s>=0;--s)t.push(s+1);return t},this.GetBarPos=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a=this.Data.Data.length,s=0;s<a;++s)t.push(s+1);return t},this.GetTotalTradeMinuteCount=function(){var t=Zh.GetCoordinateData(this.Symbol);return t&&t.Count>0?t.Count-1:242},this.GetTotalBarsCount=function(){var t=this.Data.Data.length;return t},this.GetIsLastBar=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a=this.Data.Data.length,s=0;s<a;++s)s==a-1?t.push(1):t.push(0);return t},this.GetBarStatus=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a=this.Data.Data.length,s=0;s<a;++s)s==0?t[s]=1:s==a-1?t[s]=2:t[s]=0;return t},this.GetMarginCacheData=function(t,a){var s=K.GetMarginJobID(t);return s||this.Execute.ThrowUnexpectedNode(a,"不支持MARGIN("+t+")"),this.MarginData.has(s)?this.MarginData.get(s):[]},this.GetMarginData=function(t){if(this.MarginData.has(t))return this.Execute.RunNextJob();X.Complier.Log("[JSSymbolData::GetMarginData] jobID=",t);var a=this,s=["name","date","symbol"];switch(t){case K.JOB_DOWNLOAD_MARGIN_BALANCE:s.push("margin.balance");break;case K.JOB_DOWNLOAD_MARGIN_RATE:s.push("margin.rate");break;case K.JOB_DOWNLOAD_MARGIN_BUY_BALANCE:case K.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:case K.JOB_DOWNLOAD_MARGIN_BUY_REPAY:case K.JOB_DOWNLOAD_MARGIN_BUY_NET:s.push("margin.buy");break;case K.JOB_DOWNLOAD_MARGIN_SELL_BALANCE:case K.JOB_DOWNLOAD_MARGIN_SELL_VOLUME:case K.JOB_DOWNLOAD_MARGIN_SELL_REPAY:case K.JOB_DOWNLOAD_MARGIN_SELL_NET:s.push("margin.sell");break}Lt.HttpRequest({url:this.StockHistoryDayApiUrl,data:{field:s,symbol:[this.Symbol],orderfield:"date"},type:"post",dataType:"json",async:!0,success:function(h){a.RecvMarginData(h,t),a.Execute.RunNextJob()}})},this.RecvMarginData=function(t,a){if(X.Complier.Log(t),!(!t.stock||t.stock.length!=1)){var s=t.stock[0],o=new Array,h=[],l=[],u=[];for(var f in s.stockday){var C=s.stockday[f],D=C.margin;if(D){var v=new yt;switch(v.Date=C.date,a){case K.JOB_DOWNLOAD_MARGIN_BALANCE:if(!this.IsNumber(D.balance))continue;v.Value=D.balance,o.push(v);break;case K.JOB_DOWNLOAD_MARGIN_RATE:if(!this.IsNumber(D.rate))continue;v.Value=D.rate,o.push(v);break;case K.JOB_DOWNLOAD_MARGIN_BUY_BALANCE:case K.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:case K.JOB_DOWNLOAD_MARGIN_BUY_REPAY:case K.JOB_DOWNLOAD_MARGIN_BUY_NET:var S=D.buy;if(!S||!this.IsNumber(S.balance)||!this.IsNumber(S.amount)||!this.IsNumber(S.repay)||!this.IsNumber(S.net))continue;v.Value=S.balance;var I=new yt;I.Date=C.date,I.Value=S.amount;var F=new yt;F.Date=C.date,F.Value=S.repay;var E=new yt;E.Date=C.date,E.Value=S.net,o.push(v),h.push(I),l.push(F),u.push(E);break;case K.JOB_DOWNLOAD_MARGIN_SELL_BALANCE:case K.JOB_DOWNLOAD_MARGIN_SELL_VOLUME:case K.JOB_DOWNLOAD_MARGIN_SELL_REPAY:case K.JOB_DOWNLOAD_MARGIN_SELL_NET:var T=D.sell;if(!T||!this.IsNumber(T.balance)||!this.IsNumber(T.volume)||!this.IsNumber(T.repay)||!this.IsNumber(T.net))continue;v.Value=S.balance;var I=new yt;I.Date=C.date,I.Value=S.volume;var F=new yt;F.Date=C.date,F.Value=S.repay;var E=new yt;E.Date=C.date,E.Value=S.net,o.push(v),h.push(I),l.push(F),u.push(E);break;default:continue}}}var M=[];a===K.JOB_DOWNLOAD_MARGIN_BALANCE||a===K.JOB_DOWNLOAD_MARGIN_RATE?M.push({JobID:a,Data:o}):a===K.JOB_DOWNLOAD_MARGIN_BUY_BALANCE||a===K.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT||a===K.JOB_DOWNLOAD_MARGIN_BUY_REPAY||a===K.JOB_DOWNLOAD_MARGIN_BUY_NET?(M.push({JobID:K.JOB_DOWNLOAD_MARGIN_BUY_BALANCE,Data:o}),M.push({JobID:K.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT,Data:h}),M.push({JobID:K.JOB_DOWNLOAD_MARGIN_BUY_REPAY,Data:l}),M.push({JobID:K.JOB_DOWNLOAD_MARGIN_BUY_NET,Data:u})):(a===K.JOB_DOWNLOAD_MARGIN_SELL_BALANCE||a===K.JOB_DOWNLOAD_MARGIN_SELL_VOLUME||a===K.JOB_DOWNLOAD_MARGIN_SELL_REPAY||a===K.JOB_DOWNLOAD_MARGIN_SELL_NET)&&(M.push({JobID:K.JOB_DOWNLOAD_MARGIN_SELL_BALANCE,Data:o}),M.push({JobID:K.JOB_DOWNLOAD_MARGIN_SELL_VOLUME,Data:h}),M.push({JobID:K.JOB_DOWNLOAD_MARGIN_SELL_REPAY,Data:l}),M.push({JobID:K.JOB_DOWNLOAD_MARGIN_SELL_NET,Data:u}));for(var O in M){var R=this.SourceData.GetFittingData(M[O].Data),b=new k;if(b.Data=R,b.Period=this.Period,b.Period>0){var p=b.GetPeriodSingleData(b.Period);b.Data=p}var G=b.GetValue();this.MarginData.set(M[O].JobID,G)}}},this.GetNewsAnalysisCacheData=function(t,a){var s=K.GetNewsAnalysisID(t);return s||this.Execute.ThrowUnexpectedNode(a,"不支持NEWS("+t+")"),this.NewsAnalysisData.has(s)?this.NewsAnalysisData.get(s):[]},this.GetHKToSHSZData=function(t){var a=t.Args,s=this.Symbol;if(a.length>0){var o=a[0];if(o.Type==vt.Literal)s=o.Value;else if(o.Type==vt.Identifier){var h=!1;for(var l in this.Arguments){var u=this.Arguments[l];if(u.Name==o.Name){s=u.Value,h=!0;break}}if(!h){var f=t.Token;this.Execute.ErrorHandler.ThrowError(f.Index,f.Line,0,"HK2SHSZ() Error: can't read "+o.Name)}}}t.Symbol=s,s==1||s==2||s==3?this.GetHKToSHSZMarketData(s,t):this.GetHKToSHSZStockData(s,t)},this.GetHKToSHSZStockData=function(t,a){if(this.HKToSHSZData.has(t))return this.Execute.RunNextJob();var s=t.toLowerCase(),o=this,h=this.HKToSHSZApiUrl[3]+"/"+s+".json";Lt.HttpRequest({url:h,type:"get",dataType:"json",async:!0,success:function(u){o.RecvHKToSHSZStockData(u,a),o.Execute.RunNextJob()},error:function(u){console.warn("[JSSymbolData::GetHKToSHSZStockData] request url="+h+" failed. error="+u.status),o.RecvHKToSHSZStockData(null,a),o.Execute.RunNextJob()}})},this.RecvHKToSHSZStockData=function(v,a){if(v){for(var s=v.symbol,o=s.toUpperCase(),h=[],l=0;l<v.date.length;++l){var u=new yt;u.Date=v.date[l],u.Value=v.vol[l],h.push(u)}var f=this.Data.GetFittingData(h),C=new k;if(C.Data=f,C.Period=this.Period,C.Period>0){var D=C.GetPeriodSingleData(C.Period);C.Data=D}var v=C.GetValue();this.HKToSHSZData.set(o,v)}},this.GetHKToSHSZMarketData=function(t,a){if(this.HKToSHSZData.has(t))return this.Execute.RunNextJob();var s,o=0;this.DataType===wt.MINUTE_ID?o=1:this.DataType==wt.MULTIDAY_MINUTE_ID?o=2:this.Period<=3&&(o=0),s=this.HKToSHSZApiUrl[o];var h=this;X.Complier.Log("[JSSymbolData::GetHKToSHSZMarketData] code="+t+" url="+s+", dataType="+o),o===2?Lt.HttpRequest({url:s,data:{symbol:this.Symbol,daycount:this.MaxRequestMinuteDayCount},type:"post",dataType:"json",async:!0,success:function(u){h.RecvMulitMinuteHKToSHSZData(u,a),h.Execute.RunNextJob()}}):Lt.HttpRequest({url:s,type:"get",dataType:"json",async:!0,success:function(u){o==0?h.RecvHKToSHSZData(u,a):o==1&&h.RecvMinuteHKToSHSZData(u,a),h.Execute.RunNextJob()}})},this.RecvMinuteHKToSHSZData=function(t,a){var s=[],o=[],h=[];if(this.IsBeforeData){for(u in this.SourceData.Data){var l=this.SourceData.Data[u];if(l.Before)s.push(null),o.push(null),h.push(null);else break}for(var u=0;u<t.time.length;++u){var f=t.time[u];if(f!==925){var C=t.hk2sh[u],D=t.hk2sz[u],v=C+D;s.push(v),o.push(C),h.push(D)}}}else for(var u=0;u<t.time.length;++u){var f=t.time[u],C=t.hk2sh[u],D=t.hk2sz[u],v=C+D;s.push(v),o.push(C),h.push(D)}var S=[{Data:s,ID:1},{Data:o,ID:2},{Data:h,ID:3}];for(var u in S){var l=S[u];this.HKToSHSZData.set(l.ID,l.Data)}},this.RecvHKToSHSZData=function(t,a){for(var s=[],o=[],h=[],l=0;l<t.date.length;++l){var u=t.date[l],f=t.hk2sh[l]*1e6,C=t.hk2sz[l]*1e6,D=f+C,v=new yt;v.Date=u,v.Value=D;var S=new yt;S.Date=u,S.Value=f;var T=new yt;T.Date=u,T.Value=C,s.push(v),o.push(S),h.push(T)}var I=[{Data:s,ID:1},{Data:o,ID:2},{Data:h,ID:3}];for(var F in I){var E=this.Data.GetFittingData(I[F].Data),M=new k;if(M.Data=E,M.Period=this.Period,M.Period>0){var O=M.GetPeriodSingleData(M.Period);M.Data=O}var R=M.GetValue();this.HKToSHSZData.set(I[F].ID,R)}},this.RecvMulitMinuteHKToSHSZData=function(t,a){if(!(!t.data||t.data.length<=0)){for(var s=[],o=[],h=[],l=0,u=0;l<this.Data.Data.length&&u<t.data.length;){s[l]=null,o[l]=null,h[l]=null;var f=this.Data.Data[l],C=f.DateTime;if(!C){++l;continue}var D=C.split(" ");if(D.length!=2){++l;continue}var v=parseInt(D[0]),S=t.data[u];if(!S.minute||S.minute.length<=0){++u;continue}if(S.date>v){++l;continue}else if(S.date<v){++u;continue}for(var T in S.minute){var I=S.minute[T],F=I[1],E=I[2],M=F+E;s[l]=M,o[l]=F,h[l]=E,++l}++u}var O=[{Data:s,ID:1},{Data:o,ID:2},{Data:h,ID:3}];for(var l in O){var f=O[l];this.HKToSHSZData.set(f.ID,f.Data)}}},this.GetHKToSHSZCacheData=function(t,a){return t||(t=this.Symbol),typeof t=="string"&&(t=t.toUpperCase()),this.HKToSHSZData.has(t)?this.HKToSHSZData.get(t):[]},this.GetNewsAnalysisData=function(t){if(this.NewsAnalysisData.has(t))return this.Execute.RunNextJob();var a=this,s=new Dt.default([[K.JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE,"negative"],[K.JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH,"research"],[K.JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT,"interact"],[K.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE,"holderchange"],[K.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2,"holderchange"],[K.JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER,"trustholder"],[K.JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING,"Blocktrading"],[K.JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS,"companynews"],[K.JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS,"topmanagers"],[K.JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE,"Pledge"]]);if(!s.has(t)){this.Execute.RunNextJob();return}var o=s.get(t),h=this.StockNewsAnalysisApiUrl+"/"+o+"/"+this.Symbol+".json";Lt.HttpRequest({url:h,type:"get",dataType:"json",async:!0,success:function(u){a.RecvNewsAnalysisData(u,t),a.Execute.RunNextJob()},error:function(u,f){a.RecvNewsAnalysisDataError(u,f,t),a.Execute.RunNextJob()}})},this.RecvNewsAnalysisDataError=function(t,a,s){X.Complier.Log("[JSSymbolData::RecvNewsAnalysisDataError] ajax error.",t.status);for(var o=[],h=0;h<this.Data.Data.length;++h){var l=new yt;l.Date=this.Data.Data[h].Date,l.Value=0,o.push(l)}var u=new k;u.Data=o,this.NewsAnalysisData.set(s,u.GetValue())},this.RecvNewsAnalysisData=function(t,a){if(!(!t.data||!t.date)&&!(t.data.length<=0||t.data.length!=t.date.length))if(X.Complier.Log("[JSSymbolData::RecvNewsAnalysisData] jobID",a,t.update),a==K.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE||a==K.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2){for(var s=[],o=[],h=0;h<t.data.length;++h){var l=new yt;l.Date=t.date[h],l.Value=t.data[h],this.IsNumber(l.Value)&&s.push(l),h<t.data2.length&&(l=new yt,l.Date=t.date[h],l.Value=t.data2[h],this.IsNumber(l.Value)&&o.push(l))}var u=this.Data.GetFittingData2(s,0),f=new k;f.Data=u,this.NewsAnalysisData.set(K.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE,f.GetValue()),u=this.Data.GetFittingData2(o,0),f=new k,f.Data=u,this.NewsAnalysisData.set(K.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2,f.GetValue())}else{for(var s=[],h=0;h<t.data.length;++h){var l=new yt;l.Date=t.date[h],l.Value=t.data[h],s.push(l)}var C=this.Data.GetFittingData2(s,0),f=new k;f.Data=C,this.NewsAnalysisData.set(a,f.GetValue())}},this.GetSectionFinanceData=function(t){var a=t.SF[0],s=t.SF[1].Period;if(this.SectionFinanceData.has(a))return this.Execute.RunNextJob();X.Complier.Log("[JSSymbolData::GetSectionFinanceData] "+s.Year+"-"+s.Quarter);var o="announcement"+s.Quarter,h=this,l=["name","date","symbol",o,"finance"+s.Quarter],u=[o+".year","int32","eq",s.Year.toString()];Lt.HttpRequest({url:this.StockHistoryDayApiUrl,data:{field:l,symbol:[this.Symbol],condition:[{item:u}]},type:"post",dataType:"json",async:!0,success:function(C){h.RecvSectionFinanceData(C,t),h.Execute.RunNextJob()}})},this.RecvSectionFinanceData=function(u,a){if(!(!u.stock||u.stock.length!=1)){var s=u.stock[0];if(!(!s.stockday||s.stockday.length<=0)){var o=s.stockday[0],h=a.SF[1].Period,l=null;if(h.Quarter===1?l=o.finance1:h.Quarter===2?l=o.finance2:h.Quarter===3?l=o.finance3:h.Quarter===4&&(l=o.finance4),!!l){var u=new Dt.default([[K.JOB_DOWNLOAD_SECTION_F_01,l.currentassets],[K.JOB_DOWNLOAD_SECTION_F_02,l.monetaryfunds],[K.JOB_DOWNLOAD_SECTION_F_03,l.inventory],[K.JOB_DOWNLOAD_SECTION_F_04,l.currentliabilities],[K.JOB_DOWNLOAD_SECTION_F_05,l.ncurrentliabilities],[K.JOB_DOWNLOAD_SECTION_F_06,l.expenses3],[K.JOB_DOWNLOAD_SECTION_F_07,l.investmentincome],[K.JOB_DOWNLOAD_SECTION_F_08,l.pcnprofit],[K.JOB_DOWNLOAD_SECTION_F_09,l.nnetprofit],[K.JOB_DOWNLOAD_SECTION_F_10,l.npersearning],[K.JOB_DOWNLOAD_SECTION_F_11,l.woewa],[K.JOB_DOWNLOAD_SECTION_F_12,l.inprocess],[K.JOB_DOWNLOAD_SECTION_F_13,l.accdepreciation],[K.JOB_DOWNLOAD_SECTION_F_14,l.mholderprofit],[K.JOB_DOWNLOAD_SECTION_F_15,l.lossexchange],[K.JOB_DOWNLOAD_SECTION_F_16,l.baddebts],[K.JOB_DOWNLOAD_SECTION_F_17,l.fixedassets],[K.JOB_DOWNLOAD_SECTION_F_18,l.curdepreciation],[K.JOB_DOWNLOAD_SECTION_F_19,l.orevenues],[K.JOB_DOWNLOAD_SECTION_F_20,l.moprofit],[K.JOB_DOWNLOAD_SECTION_F_21,l.oprofit],[K.JOB_DOWNLOAD_SECTION_F_22,l.nprofit],[K.JOB_DOWNLOAD_SECTION_F_23,l.areceivable],[K.JOB_DOWNLOAD_SECTION_F_24,l.financialcost],[K.JOB_DOWNLOAD_SECTION_F_25,l.ccfo],[K.JOB_DOWNLOAD_SECTION_F_26,l.totalassets],[K.JOB_DOWNLOAD_SECTION_F_27,l.totalliabilities],[K.JOB_DOWNLOAD_SECTION_F_28,l.totalownersequity],[K.JOB_DOWNLOAD_SECTION_F_29,l.grossmargin],[K.JOB_DOWNLOAD_SECTION_F_30,l.percreserve],[K.JOB_DOWNLOAD_SECTION_F_31,l.peruprofit],[K.JOB_DOWNLOAD_SECTION_F_32,l.persearning],[K.JOB_DOWNLOAD_SECTION_F_33,l.pernetasset],[K.JOB_DOWNLOAD_SECTION_F_34,l.perccfo],[K.JOB_DOWNLOAD_SECTION_F_38,l.alratio],[K.JOB_DOWNLOAD_SECTION_F_39,l.profityoy]]);h.Quarter===4&&(u.set(K.JOB_DOWNLOAD_SECTION_F_35,l.nnprofitincrease),u.set(K.JOB_DOWNLOAD_SECTION_F_36,l.nnprofitspeed),u.set(K.JOB_DOWNLOAD_SECTION_F_37,l.nprofitincrease));var f=a.SF[0];this.SectionFinanceData.set(f,u)}}}},this.GetSectionFinanceCacheData=function(t,a,s,o){var h=K.GetSectionReportPeriod(t,a);h||this.Execute.ThrowUnexpectedNode(o,"不支持FS("+t+", "+a+", '"+s+"') 报告期错误");var l=K.GetSectionFinanceID(s);l||this.Execute.ThrowUnexpectedNode(o,"不支持FS("+t+", "+a+",'"+s+"') 财务数据字段名称错误");var u=h.Year+"-"+h.Quarter;if(!this.SectionFinanceData.has(u)&&!this.ThrowSFPeirod.has(u)){this.ThrowSFPeirod.add(u);var f={ID:K.JOB_DOWNLOAD_SECTION_SF,SF:[u,{Period:h,Fields:new Ee.default([l])}]};this.Execute.ThrowDownloadSF(o,f,"FS("+t+", "+a+", '"+s+"') 动态下载")}if(!this.SectionFinanceData.has(u))return this.Execute.ThrowUnexpectedNode(o,"不支持FS("+t+", "+a+", '"+s+"') 没有这期财务数据");var C=this.SectionFinanceData.get(u);return C.has(l)||this.Execute.ThrowUnexpectedNode(o,"不支持FS("+t+", "+a+", '"+s+"') 没有这期财务数据字段"),C.get(l)},this.GetFinOne=function(t){var a=this.JobArgumentsToArray(t,3),s=this.GetStockDataKey(t,a);if(this.StockData.has(s))return this.Execute.RunNextJob();var o=this;if(this.NetworkFilter){var h=this.Data.GetDateRange(),l={Name:"JSSymbolData::GetFinOne",Explain:"财务数据FINONE(ID,Y,MMDD)",JobID:t.ID,Request:{Url:o.StockHistoryDayApiUrl,Type:"POST",Data:{Args:a,symbol:this.Symbol,daterange:h}},Self:this,PreventDefault:!1};if(this.NetworkFilter(l,function(f){o.RecvStockValue(f,t,s,1),o.Execute.RunNextJob()}),l.PreventDefault==!0)return}var u=new MI({Job:t,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,Args:a,DataKey:s,Callback:function(C,D,v){o.RecvStockValue(C,D,v,1),o.Execute.RunNextJob()},ErrorCallback:function(C){o.AddStockValueError(s,C)}});u.Download()},this.GetStockDataKey=function(t,a){var s=t.FunctionName;if(a.length>0){s+="(";for(var o=0;o<a.length;++o)o>0&&(s+=","),s+=a[o].toString();s+=")"}return s},this.GetFinValue=function(t){var a=this.JobArgumentsToArray(t,1),s=a[0],o=this.GetStockDataKey(t,a);if(this.StockData.has(o))return this.Execute.RunNextJob();var h=this;if(this.NetworkFilter){var l=this.Data.GetDateRange(),u={Name:"JSSymbolData::GetFinValue",Explain:"财务数据FINVALUE(ID)",JobID:t.ID,Request:{Url:h.StockHistoryDayApiUrl,Type:"POST",Data:{id:s,symbol:this.Symbol,daterange:l}},Self:this,PreventDefault:!1};if(this.NetworkFilter(u,function(C){h.RecvStockValue(C,t,o,0),h.Execute.RunNextJob()}),u.PreventDefault==!0)return}var f=new iD({Job:t,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,Args:a,DataKey:o,Callback:function(D,v,S){h.RecvStockValue(D,v,S,0),h.Execute.RunNextJob()},ErrorCallback:function(D){h.AddStockValueError(o,D)}});f.Download()},this.GetFinance=function(t){var a=this.JobArgumentsToArray(t,1),s=a[0],o=this.GetStockDataKey(t,a);if(this.StockData.has(o))return this.Execute.RunNextJob();var h=this;if(this.NetworkFilter){var l=this.Data.GetDateRange(),u={Name:"JSSymbolData::GetFinance",Explain:"财务数据FINANCE(ID)",JobID:t.ID,Request:{Url:h.RealtimeApiUrl,Type:"POST",Data:{id:s,symbol:this.Symbol,daterange:l}},Self:this,PreventDefault:!1};if(this.NetworkFilter(u,function(C){h.RecvStockValue(C,t,o,0),h.Execute.RunNextJob()}),u.PreventDefault==!0)return}var f=new Zu({Job:t,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,RealtimeUrl:this.RealtimeApiUrl,Args:a,DataKey:o,Callback:function(D,v,S){h.RecvStockValue(D,v,S,0),h.Execute.RunNextJob()},ErrorCallback:function(D){h.AddStockValueError(o,D)}});f.Download()},this.GetGPJYValue=function(t){var a=this.JobArgumentsToArray(t,3),s=this.GetStockDataKey(t,a);if(this.StockData.has(s))return this.Execute.RunNextJob();var o=this,h=a[2]==1?0:2;if(this.NetworkFilter){var l=this.Data.GetDateRange(),u={Name:"JSSymbolData::GetGPJYValue",Explain:"股票交易类数据GPJYVALUE(ID,N,TYPE)",JobID:t.ID,Request:{Url:o.StockHistoryDayApiUrl,Type:"POST",Data:{Args:a,symbol:this.Symbol,daterange:l}},Self:this,PreventDefault:!1};if(this.NetworkFilter(u,function(C){o.RecvStockValue(C,t,s,h),o.Execute.RunNextJob()}),u.PreventDefault==!0)return}var f=new AI({Job:t,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,Args:a,DataKey:s,Callback:function(D,v,S){o.RecvStockValue(D,v,S,h),o.Execute.RunNextJob()},ErrorCallback:function(D){o.AddStockValueError(s,D)}});f.Download()},this.GetSCJYValue=function(t){var a=this.JobArgumentsToArray(t,3),s=this.GetStockDataKey(t,a);if(this.StockData.has(s))return this.Execute.RunNextJob();var o=this,h=a[2]==1?0:2;if(this.NetworkFilter){var l=this.Data.GetDateRange(),u={Name:"JSSymbolData::GetSCJYValue",Explain:"股票交易类数据SCJYVALUE(ID,N,TYPE)",JobID:t.ID,Request:{Url:o.StockHistoryDayApiUrl,Type:"POST",Data:{Args:a,symbol:this.Symbol,daterange:l}},Self:this,PreventDefault:!1};if(this.NetworkFilter(u,function(C){o.RecvStockValue(C,t,s,h),o.Execute.RunNextJob()}),u.PreventDefault==!0)return}var f=new NI({Job:t,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,Args:a,DataKey:s,Callback:function(D,v,S){o.RecvStockValue(D,v,S,h),o.Execute.RunNextJob()},ErrorCallback:function(D){o.AddStockValueError(s,D)}});f.Download()},this.GetVariantData=function(t){var a=t.VariantName;if(this.StockData.has(a))return this.Execute.RunNextJob();var s=this;if(this.NetworkFilter){var o=this.Data.GetDateRange(),h={Name:"JSSymbolData::GetVariantData",Explain:"变量数据下载",JobID:t.ID,Request:{Url:"数据地址",Type:"POST",Data:{VariantName:t.VariantName,symbol:this.Symbol,daterange:o}},Self:this,PreventDefault:!1};if(this.NetworkFilter(h,function(D){if(D.Error)s.AddStockValueError(a,D.Error);else{var v=0;c.IsNumber(D.DataType)&&(v=D.DataType),s.RecvStockValue(D.Data,t,a,v)}s.Execute.RunNextJob()}),h.PreventDefault==!0)return}var l=function(v){s.AddStockValueError(a,v)},u;if(t.VariantName=="CAPITAL"||t.VariantName=="TOTALCAPITAL"||t.VariantName=="EXCHANGE"){var f=function(v,S,T){s.RecvStockValue(v,S,T,0),s.Execute.RunNextJob()};u=new Zu({Job:t,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,RealtimeUrl:this.RealtimeApiUrl,Args:[t.VariantName],DataKey:a,Callback:f,ErrorCallback:l})}else if(t.VariantName=="HYBLOCK"||t.VariantName=="DYBLOCK"||t.VariantName=="GNBLOCK"){var f=function(S,T,I,F){s.RecvStockValue(S,T,I,F),s.Execute.RunNextJob()};u=new OI({Job:t,Symbol:this.Symbol,Url:this.StockHistoryDayApiUrl,RealtimeUrl:this.RealtimeApiUrl,Args:[t.VariantName],DataKey:a,Callback:f,ErrorCallback:l})}else if(t.VariantName=="INBLOCK"){var C=t.VariantName+", 请对接外部数据.";this.AddStockValueError(a,C),this.Execute.RunNextJob();return}else{var C="不支持变量"+t.VariantName+", 请对接外部数据.";this.AddStockValueError(a,C),this.Execute.RunNextJob();return}u.Download()},this.GetCustomVariantData=function(t){var a=t.VariantName;if(this.StockData.has(a))return this.Execute.RunNextJob();var s=zt.CustomVariant.Data.get(a),o=this;if(this.NetworkFilter){var h=this.Data.GetDateRange(),l={Name:"JSSymbolData::GetCustomVariantData",Explain:"自定义变量数据下载",JobID:t.ID,Request:{Url:"数据地址",Type:"POST",Data:{VariantName:t.VariantName,symbol:this.Symbol,daterange:h,period:this.Period}},Self:this,VariantInfo:s,PreventDefault:!1};this.NetworkFilter(l,function(u){u.Error?o.AddStockValueError(a,u.Error):o.RecvStockValue(u.Data,t,a,u.DataType),o.Execute.RunNextJob()})}else this.AddStockValueError(a,"自定义变量"+a+"下载失败"),this.Execute.RunNextJob()},this.GetCustomFunctionData=function(t){var a=t.FunctionName,s=zt.CustomFunction.Data.get(a);if(!s.IsDownload)return this.Execute.RunNextJob();if(this.StockData.has(a))return this.Execute.RunNextJob();var o=this;if(this.NetworkFilter){var h=this.Data.GetDateRange(),l={Name:"JSSymbolData::GetCustomFunctionData",Explain:"自定义函数数据下载",JobID:t.ID,Request:{Url:"数据地址",Type:"POST",Data:{FunctionName:t.FunctionName,symbol:this.Symbol,daterange:h,JobItem:t}},Self:this,FunctionInfo:s,PreventDefault:!1};this.NetworkFilter(l,function(u){u.Error?o.AddStockValueError(a,u.Error):o.RecvStockValue(u.Data,t,a,u.DataType),o.Execute.RunNextJob()})}else this.AddStockValueError(a,"自定义函数"+a+"下载失败"),this.Execute.RunNextJob()},this.RecvStockValue=function(t,a,s,o){if(!t){X.Complier.Log("[JSSymbolData::RecvStockValue] key="+s+" data is null");return}if(o==0)if(Array.isArray(t)){var h=this.Data,l;if(this.DataType==wt.KLINE_ID)if(k.IsDayPeriod(this.Period,!0))l=h.GetFittingFinanceData(t);else if(k.IsMinutePeriod(this.Period,!0))l=h.GetMinuteFittingFinanceData(t);else return;else l=h.GetMinuteFittingFinanceData(t);var u=new k;u.Data=l;var f=u.GetValue();if(s=="EXCHANGE")for(var C in f){var D=h.Data[C];c.IsPlusNumber(f[C])&&(f[C]=D.Vol/f[C]*100)}this.StockData.set(s,{Data:f})}else this.StockData.set(s,{Data:t.Value});else if(o==1)this.StockData.set(s,{Data:t.Value});else if(o==2){var h=this.Data,l;if(this.DataType==wt.KLINE_ID)if(k.IsDayPeriod(this.Period,!0))l=h.GetFittingTradeData(t,0);else if(k.IsMinutePeriod(this.Period,!0))l=h.GetMinuteFittingTradeData(t,0);else if(k.IsTickPeriod(this.Period))l=h.GetMinuteFittingTradeData(t,0);else return;else l=h.GetMinuteFittingTradeData(t,0);var u=new k;u.Data=l;var f=u.GetValue();this.StockData.set(s,{Data:f})}},this.AddStockValueError=function(t,a){this.StockData.set(t,{Error:a})},this.GetStockCacheData=function(t){var a;if(t.FunctionName)a=this.GetStockDataKey({FunctionName:t.FunctionName},t.Args);else if(t.VariantName)a=t.VariantName;else if(t.CustomName)a=t.CustomName;else return null;if(!this.StockData.has(a))return null;var s=this.StockData.get(a);return s.Error&&this.Execute.ThrowUnexpectedNode(t.Node,s.Error),s.Data},this.IsInBlock=function(t,a){var s=this.GetStockCacheData({VariantName:"INBLOCK",Node:a});if(!s)return 0;for(var o=s.split("|"),h=0;h<o.length;++h){var l=o[h];if(l==t)return 1}return 0},this.JobArgumentsToArray=function(t,a){var s=t.Args;if(s.length!=a){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,t.FunctionName+"() Error: argument count error.")}for(var h=[],l=0;l<s.length;++l){var u=s[l];if(c.IsNumber(u))h.push(u);else if(u.Type==vt.Literal)h.push(u.Value);else if(u.Type==vt.Identifier){var f=!1;for(var C in this.Arguments){var D=this.Arguments[C];if(D.Name==u.Name){h.push(D.Value),f=!0;break}}if(!f){var o=t.Token;this.Execute.ErrorHandler.ThrowError(o.Index,o.Line,0,t.FunctionName+"() Error: can't read "+u.Name)}}}return h},this.DownloadCustomAPIData=function(t){if(!this.NetworkFilter)return this.Execute.RunNextJob();var a=[];for(var s in t.Args){var o=t.Args[s];if(o.Type==vt.Literal)a.push(o.Value);else if(o.Type==vt.Identifier){var h=!1;for(var l in this.Arguments){var u=this.Arguments[l];if(u.Name==o.Name){a.push(u.Value),h=!0;break}}if(!h){var f=t.Token;this.Execute.ErrorHandler.ThrowError(f.Index,f.Line,0,"LoadAPIData() Error: can't read "+o.Name)}}else return this.Execute.RunNextJob()}var C=this,D={Name:"JSSymbolData::DownloadCustomAPIData",Explain:"下载自定义api数据",Period:this.Period,Right:this.Right,Symbol:this.Symbol,KData:this.Data,Cache:this.CustomAPIData,Args:a,Self:this,PreventDefault:!1};this.NetworkFilter(D,function(v){C.RecvCustomAPIData(v,a),C.Execute.RunNextJob()}),D.PreventDefault!=!0&&this.Execute.RunNextJob()},this.RecvCustomAPIData=function(t,a){t&&(t.Type==1?this.RecvCustomAPISingleData(t,a):this.RecvCustomAPIGroupData(t,a))},this.RecvCustomAPIGroupData=function(t,a){if(!(!t||!t.data)){var s=t.data,o=this.GenerateCustomAPIKey(a);if(k.IsMinutePeriod(this.Period,!0)){if(!s.date||!s.time)return;var h=s.date;s.time;for(var l in s)if(!(l=="date"||l=="time"))var u=s[l]}else if(k.IsDayPeriod(this.Period,!0)){if(!s.date)return;var h=s.date,f={__Type__:"Object"};for(var l in s)if(l!="date"){var u=s[l];if(Array.isArray(u)){var C=this.FittingCustomAPIArray(u,h);f[l]=C}else this.IsNumber(u)&&(f[l]=u)}this.CustomAPIData.set(o,f)}}},this.RecvCustomAPISingleData=function(t,a){var s=t.data,o=this.GenerateCustomAPIKey(a);if(k.IsMinutePeriod(this.Period,!0)){if(!s.date||!s.time)return;var h=s.date;s.time;for(var l in s)l=="date"||l=="time"||s[l]}else if(k.IsDayPeriod(this.Period,!0)){if(!s.date)return;var h=s.date,u=s.value,f=null;Array.isArray(u)?t.DataType==1?f=this.FittingCustomAPIFinanceArray(u,h):f=this.FittingCustomAPIArray(u,h):f=u,this.CustomAPIData.set(o,f)}},this.FittingCustomAPIFinanceArray=function(t,a,s){var o=this.Data,h=[];for(var l in t){var u=t[l],f=new yt;f.Date=a[l],s&&l<s.length&&(f.Time=s[l]),f.Value=u,h.push(f)}var C;if(k.IsDayPeriod(this.Period,!0))C=o.GetFittingFinanceData(h);else if(k.IsMinutePeriod(this.Period,!0))C=o.GetMinuteFittingFinanceData(h);else return null;var D=new k;D.Data=C;var v=D.GetValue();return v},this.FittingCustomAPIArray=function(t,a,s){var o=this.Data,h=[];for(var l in t){var u=t[l],f=new yt;f.Date=a[l],s&&l<s.length&&(f.Time=s[l]),f.Value=u,h.push(f)}var C;if(k.IsDayPeriod(this.Period,!0))C=o.GetFittingData(h);else if(k.IsMinutePeriod(this.Period,!0))C=o.GetMinuteFittingData(h);else return null;var D=new k;D.Data=C;var v=D.GetValue();return v},this.GenerateCustomAPIKey=function(t){if(t.length<=0)return"__12_EMPTY_ARGS__";var a="";for(var s in t)a.length>0&&(a+=","),a+=t[s];return a},this.GetCustomApiData=function(t){var a=this.GenerateCustomAPIKey(t);return this.CustomAPIData.has(a)?this.CustomAPIData.get(a):(X.Complier.Log("[JSSymbolData::GetCustomApiData] can't find api data key=["+a+"]"),null)},this.ReadArgumentValue=function(t,a){if(a.Name=t.Name,t.Type==vt.Literal)return a.Value=t.Value,!0;if(t.Type==vt.Identifier){var s=!1;for(var o in this.Arguments){var h=this.Arguments[o];if(h.Name==t.Name)return a.Value=h.Value,s=!0,!0}if(!s)return a.Error="can't read "+t.Name,!1}return a.Error="can't read "+t.Name+", type error.",!1},this.ReadIndexFunctionOut=function(t,a){var s={};if((typeof t>"u"?"undefined":(0,Wi.default)(t))==="object"){if(!this.ReadArgumentValue(t,s))return a.Error=s.Error,!1}else s.Value=t;return a.OutIndex=s.Value,a.Out=null,!0},this.ReadIndexFunctionValue=function(t,a){var s={};if((typeof t>"u"?"undefined":(0,Wi.default)(t))==="object"){if(!this.ReadArgumentValue(t,s))return a.Error=s.Error,!1}else s.Value=t;var o=s.Value.indexOf(".");if(o!=-1){a.Name=s.Value.slice(0,o);var h=s.Value.indexOf("#",o+1);h!=-1?(a.Out=s.Value.slice(o+1,h),a.Period=s.Value.slice(h+1)):a.Out=s.Value.slice(o+1)}else{var h=s.Value.indexOf("#");h!=-1?(a.Name=s.Value.slice(0,h),a.Period=s.Value.slice(h+1)):a.Name=s.Value}var l=new Dt.default([["DAY",0],["WEEK",1],["MONTH",2],["SEASON",9],["YEAR",3],["HALFYEAR",22],["WEEK2",21],["MIN1",4],["MIN5",5],["MIN15",6],["MIN30",7],["MIN60",8],["MIN120",11],["MIN240",12],["DAY2",40002],["MULTIDAY",40002],["DAY3",40003],["DAY4",40004],["DAY5",40005],["DAY6",40006],["DAY7",40007],["DAY8",40008],["DAY9",40009],["DAY10",40010],["DAY11",40011],["DAY12",40012],["DAY13",40013],["DAY14",40014],["DAY15",40015]]);if(a.Period){if(!l.has(a.Period))return a.Error=a.Period+", 周期错误",!1;a.PeriodID=l.get(a.Period)}return!0},this.ReadSymbolArgumentValue=function(t,a){var s={};if((typeof t>"u"?"undefined":(0,Wi.default)(t))==="object"){if(!this.ReadArgumentValue(t,s))return a.Error=s.Error,!1}else s.Value=t;s.Value==""&&(s.Value=this.Symbol);var o=s.Value;return o.indexOf(".SH")>0?a.Symbol=o.replace(".SH",".sh"):o.indexOf(".SZ")>0?a.Symbol=o.replace(".SZ",".sz"):o.indexOf("SH")==0?a.Symbol=o.slice(2)+".sh":o.indexOf("SZ")==0?a.Symbol=o.slice(2)+".sz":a.Symbol=o,!0},this.ReadIndexArgumentValue=function(t,a){a.Args=[];for(var s in a.SytemIndex.Args){var o=a.SytemIndex.Args[s];a.Args.push({Value:o.Value,Name:o.Name})}if(t.length>2&&a.SytemIndex.Args&&a.SytemIndex.Args.length>0)for(var s=2,h=0;s<t.length&&h<a.SytemIndex.Args.length;++s,++h){var l={},o=t[s];if((typeof o>"u"?"undefined":(0,Wi.default)(o))==="object"){if(!this.ReadArgumentValue(o,l))return a.Error=l.Error,!1}else l.Value=o;a.Args[h].Value=l.Value}return!0},this.GenerateScriptIndexKey=function(t){var a="",s=t.Args;for(var o in s){a.length>0&&(a+=",");var h=s[o];a+=h.Value.toString()}var l="ALL";t.Out?l=t.Out:c.IsPlusNumber(t.OutIndex)&&(l="Out["+(t.OutIndex-1)+"]");var u="("+t.Symbol+","+t.PeriodID+"), "+t.Name+"("+a+")=>"+l;return u},this.CallMemberScriptIndex=function(t){var a=this;if(t.Member.Object.Type!=vt.Identifier||t.Member.Property.Type!=vt.Identifier){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallMemberScriptIndex() Error: 参数错误")}var o=t.Member.Object.Name,h=t.Member.Property.Name;if(h==""||h==null){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallMemberScriptIndex() Error: "+o+"."+h+" 指标输出变量错误")}if(this.Execute.VarTable.has(o)){var l=this.Execute.VarTable.get(o);if(l.hasOwnProperty(h))return X.Complier.Log("[JSSymbolData::CallMemberScriptIndex] index data "+o+"."+h+" in cache."),this.Execute.RunNextJob()}var u=o+"."+h,f={Job:t,PeriodID:this.Period,Symbol:this.Symbol};if(!this.ReadIndexFunctionValue(u,f)){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallMemberScriptIndex() Error: '"+u+"' "+f.Error)}var C=new J,D=C.Get(f.Name);if(!D){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallMemberScriptIndex() Error: '"+u+"' "+f.Name+" 指标不存在")}if(Array.isArray(D.Args)&&D.Args.length>0){f.Args=[];for(var v in D.Args){var S=D.Args[v];f.Args.push({Value:S.Value,Name:S.Name})}}X.Complier.Log("[JSSymbolData::CallMemberScriptIndex] call script index",f);var T=this.Data.GetDateRange(),I={HQDataType:this.DataType,Symbol:f.Symbol,Name:"",Right:this.Right,Period:f.PeriodID,Data:null,SourceData:null,Callback:function(E,M,O){a.RecvMemberScriptIndexData(E,M,O),a.Execute.RunNextJob()},CallbackParam:f,Async:!0,MaxRequestDataCount:this.MaxRequestDataCount+30*2,MaxRequestMinuteDayCount:this.MaxRequestMinuteDayCount+2,Arguments:f.Args,IsBeforeData:this.IsBeforeData,NetworkFilter:this.NetworkFilter,IsApiPeriod:this.IsApiPeriod,KLineRange:T};Qe.Execute(D.Script,I,function(F,E){a.ExecuteScriptIndexError(F,E)})},this.CallScriptIndex=function(t){var a=this;if(t.Member)return this.CallMemberScriptIndex(t);if(!t.Args||!(t.Args.length>=2)){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallScriptIndex() Error: "+t.FunctionName+" 参数错误")}var o={Job:t,PeriodID:this.Period};if(!this.ReadSymbolArgumentValue(t.Args[0],o)){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallScriptIndex() Error: "+o.Error)}if(!this.ReadIndexFunctionValue(t.Args[1],o)){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallScriptIndex() Error: "+o.Error)}if(t.FunctionName=="CALCSTOCKINDEX"&&!this.ReadIndexFunctionOut(t.Args[2],o)){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallScriptIndex() Error: "+o.Error)}var h=new J,l=h.Get(o.Name);if(!l){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallScriptIndex() "+o.Name+" 指标不存在")}if(o.SytemIndex=l,!this.ReadIndexArgumentValue(t.Args,o)){var s=t.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallScriptIndex() "+o.Name+" 指标参数错误 : "+o.Error+" ")}X.Complier.Log("[JSSymbolData::CallScriptIndex] call script index",o);var u=null;if(this.Data&&this.Data.Data.length>0){var f=this.Data.Data[0],C=this.Data.Data[this.Data.Data.length-1];u={Start:{Date:f.Date,Time:f.Time},End:{Date:C.Date,Time:C.Time}}}var D={HQDataType:this.DataType,Symbol:o.Symbol,Name:"",Right:this.Right,Period:o.PeriodID,Data:null,SourceData:null,Callback:function(S,T,I){a.RecvScriptIndexData(S,T,I),a.Execute.RunNextJob()},CallbackParam:o,Async:!0,MaxRequestDataCount:this.MaxRequestDataCount+30*2,MaxRequestMinuteDayCount:this.MaxRequestMinuteDayCount+2,Arguments:o.Args,IsBeforeData:this.IsBeforeData,NetworkFilter:this.NetworkFilter,IsApiPeriod:this.IsApiPeriod,KLineRange:u};Qe.Execute(o.SytemIndex.Script,D,function(v,S){a.ExecuteScriptIndexError(v,S)})},this.RecvMemberScriptIndexData=function(t,a,s){X.Complier.Log("[JSSymbolData::RecvMemberScriptIndexData] ",t,a,s);var o=s.Data.Data,h=t,l=this.Data.FitKLineIndex(o,h,this.Period,a.PeriodID),u=a.Job.Member,f=u.Object.Name;u.Property.Name;var C={};this.Execute.VarTable.has(f)?C=this.Execute.VarTable.get(f):this.Execute.VarTable.set(f,C);for(var D in l){var v=t[D].Name;a.Period&&(v+="#"+a.Period),C[v]=l[D].Data}},this.RecvScriptIndexData=function(t,a,s){var o=this.GenerateScriptIndexKey(a);X.Complier.Log("[JSSymbolData::RecvScriptIndexData] ",t,a,s,o);var h=s.Data.Data,l=t;if(a.Out){for(var u=0;u<t.length;++u){var f=t[u];if(f.Name==a.Out){l=[f];break}}var C=this.Data.FitKLineIndex(h,l,this.Period,a.PeriodID);this.ScriptIndexOutData.set(o,C[0].Data)}else if(c.IsPlusNumber(a.OutIndex)){var D=a.OutIndex-1;l=[t[D]];var C=this.Data.FitKLineIndex(h,l,this.Period,a.PeriodID);this.ScriptIndexOutData.set(o,C[0].Data)}else{var C=this.Data.FitKLineIndex(h,l,this.Period,a.PeriodID),v={__Type__:"Object"};for(var u in C){var f=C[u];v[f.Name]=f.Data}this.ScriptIndexOutData.set(o,v)}},this.ExecuteScriptIndexError=function(t,a){var s=a.Job.Token;this.Execute.ErrorHandler.ThrowError(s.Index,s.Line,0,"CallScriptIndex() "+a.Name+" 指标执行错误 : "+t+" ")},this.GetScriptIndexOutData=function(t,a,s){var o={PeriodID:this.Period};this.ReadSymbolArgumentValue(t[0],o)||this.Execute.ThrowUnexpectedNode(a,s+"() 股票代码错误: "+o.Error),this.ReadIndexFunctionValue(t[1],o)||this.Execute.ThrowUnexpectedNode(a,s+"() 指标错误: "+o.Error),s=="CALCSTOCKINDEX"&&(this.ReadIndexFunctionOut(t[2],o)||this.Execute.ThrowUnexpectedNode(a,s+"() Error: "+o.Error));var h=new J,l=h.Get(o.Name);l||this.Execute.ThrowUnexpectedNode(a,s+"() 指标错误: "+o.Name+" 指标不存在"),o.SytemIndex=l,this.ReadIndexArgumentValue(t,o)||this.Execute.ThrowUnexpectedNode(a,s+"()  指标参数错误: "+o.Error);var u=this.GenerateScriptIndexKey(o);return this.ScriptIndexOutData.has(u)?this.ScriptIndexOutData.get(u):null},this.JsonDataToHistoryData=function(t){for(var a=t.data,s=new Array,o=0,h=1,l=2,u=3,f=4,C=5,D=6,v=7,S=8,T=9,I=10,F=11,E=0;E<a.length;++E){var M=new Rt;M.Date=a[E][o],M.Open=a[E][l],M.YClose=a[E][h],M.Close=a[E][C],M.High=a[E][u],M.Low=a[E][f],M.Vol=a[E][D],M.Amount=a[E][v],a[E].length>S&&(M.Up=a[E][S]),a[E].length>T&&(M.Down=a[E][T]),a[E].length>I&&(M.Stop=a[E][I]),a[E].length>F&&(M.Unchanged=a[E][F]),!(isNaN(M.Open)||M.Open<=0)&&s.push(M)}return s},this.JsonDataToMinuteHistoryData=function(t){for(var a=t.data,s=new Array,o=0,h=1,l=2,u=3,f=4,C=5,D=6,v=7,S=8,T=0;T<a.length;++T){var I=new Rt;I.Date=a[T][o],I.Open=a[T][l],I.YClose=a[T][h],I.Close=a[T][C],I.High=a[T][u],I.Low=a[T][f],I.Vol=a[T][D],I.Amount=a[T][v],I.Time=a[T][S],s.push(I)}for(var F=0;F<s.length;++F){var E=s[F];if(E==null&&coninue,isNaN(E.Open)||E.Open<=0||isNaN(E.High)||E.High<=0||isNaN(E.Low)||E.Low<=0||isNaN(E.Close)||E.Close<=0||isNaN(E.YClose)||E.YClose<=0)if(F==0)E.YClose>0&&(E.Open=E.YClose,E.High=E.YClose,E.Low=E.YClose,E.Close=E.YClose);else for(var M=F-1;M>=0;--M){var O=s[M];if(O==null&&coninue,O.Open>0&&O.High>0&&O.Low>0&&O.Close>0){E.YClose<=0&&(E.YClose=O.Close),E.Open=O.Open,E.High=O.High,E.Low=O.Low,E.Close=O.Close;break}}}return s},this.JsonDataToMinuteData=function(t){var a=new Array;for(var s in t.stock[0].minute){var o=t.stock[0].minute[s],h=new mr;h.Close=o.price,h.Open=o.open,h.High=o.high,h.Low=o.low,h.Vol=o.vol,h.Amount=o.amount,s==0?h.DateTime=t.stock[0].date.toString()+" 0925":h.DateTime=t.stock[0].date.toString()+" "+o.time.toString(),h.Date=t.stock[0].date,h.Time=o.time,h.Increase=o.increase,h.Risefall=o.risefall,h.AvPrice=o.avprice,a[s]=h}return a},this.JsonDataToMultiDayMinuteData=function(t){var a=t.symbol,s=a.toUpperCase(),o=W.IsSHSZ(s);W.IsChinaFutures(s);var h=[];for(var l in t.data){var E=[],u=t.data[l],f=u.date,C=u.yclose,D=C,v=null;for(var S in u.minute){var T=u.minute[S];T[2]&&(D=T[2]);var I=new mr;I.Close=T[2],I.Open=T[1],I.High=T[3],I.Low=T[4],I.Vol=T[5]/100,I.Amount=T[6],7<T.length&&T[7]>0&&(I.AvPrice=T[7],v=T[7]),I.DateTime=f.toString()+" "+T[0].toString(),I.Date=f,I.Time=T[0],I.Close||(I.Close=D,I.Open=I.High=I.Low=I.Close),!I.AvPrice&&v&&(I.AvPrice=v),I.Close&&C?I.Increase=(I.Close-C)/C*100:I.Increase=null,S==0&&(o&&(I.DateTime=f.toString()+" 0925"),I.IsFristData=!0),I.Open<=0&&(I.Open=null),I.Close<=0&&(I.Close=null),I.AvPrice<=0&&(I.AvPrice=null),I.High<=0&&(I.High=null),I.Low<=0&&(I.Low=null),I.AvPrice<=0&&(I.AvPrice=null),E[S]=I}var F=new k;F.Data=E,F.YClose=C,F.Close=u.close,F.Date=f,h.push(F)}for(var E=[],l=h.length-1;l>=0;--l){var I=h[l];for(var S in I.Data)E.push(I.Data[S])}return E},this.CODELIKE=function(t){return this.Symbol&&this.Symbol.indexOf(t)==0?1:0},this.NAMELIKE=function(t){return this.Name&&this.Name.indexOf(t)==0?1:0},this.SETCODE=function(){return this.Symbol.indexOf(".sh")?1:(this.Symbol.indexOf(".sz"),0)},this.GetSymbol=function(){return this.Symbol},this.GetName=function(){return this.Name},this.DATE=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a in this.Data.Data){var s=this.Data.Data[a];t[a]=s.Date-19e6}return t},this.YEAR=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a in this.Data.Data){var s=this.Data.Data[a];this.IsNumber(s.Date)?t[a]=parseInt(s.Date/1e4):t[a]=null}return t},this.DAY=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a in this.Data.Data){var s=this.Data.Data[a];this.IsNumber(s.Date)?t[a]=parseInt(s.Date%100):t[a]=null}return t},this.MONTH=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a in this.Data.Data){var s=this.Data.Data[a];this.IsNumber(s.Date)?t[a]=parseInt(s.Date%1e4/100):t[a]=null}return t},this.TIME=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a=0;a<this.Data.Data.length;++a){var s=this.Data.Data[a];this.IsNumber(s.Time)?t[a]=s.Time:t[a]=0}return t},this.TIME2=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a=0;a<this.Data.Data.length;++a){var s=this.Data.Data[a];this.IsNumber(s.Time)?t[a]=s.Time*100:t[a]=0}return t},this.DateTime=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a=k.IsMinutePeriod(this.Period,!0),s=0;s<this.Data.Data.length;++s){var o=this.Data.Data[s];a?t[s]=o.Date*1e4+o.Time:t[s]=o.Date}return t},this.WEEK=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;var a=new Date;for(var s in this.Data.Data){var o=this.Data.Data[s];if(t[s]=null,!!this.IsNumber(o.Date)){var h=parseInt(o.Date/1e4),l=parseInt(o.Date%1e4/100),u=o.Date%100;a.setFullYear(h,l-1,u),t[s]=a.getDay()}}return t},this.DAYSTOTODAY=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate()),o=0;o<this.Data.Data.length;++o){var h=this.Data.Data[o];if(t[o]=null,!!this.IsNumber(h.Date)){var l=parseInt(h.Date/1e4),u=parseInt(h.Date%1e4/100),f=h.Date%100,C=new Date(l,u-1,f),D=Math.ceil((s-C)/(24*60*60*1e3));t[o]=D}}return t},this.WEEKOFYEAR=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a in this.Data.Data){var s=this.Data.Data[a];if(t[a]=null,!!this.IsNumber(s.Date)){var o=parseInt(s.Date/1e4),h=parseInt(s.Date%1e4/100),l=s.Date%100,u=new Date(o,h-1,l),f=new Date(o,0,1),C=Math.ceil((u-f)/(24*60*60*1e3));C+=f.getDay()+1-1;var D=Math.ceil(C/7),v=D;t[a]=v}}return t},this.GetYearWeek=function(t){var a=new Date(t.getFullYear(),0,1),s=t.getDay();s==0&&(s=7);var o=a.getDay();o==0&&(o=7);var h=t.getTime()-a.getTime(),l=Math.floor((h+(o-s)*(24*60*60*1e3))/864e5);return Math.ceil(l/7)+1},this.REFDATE=function(t,a){var s=null;if(Array.isArray(a)?a.length>0&&(s=a[a.length-1]):this.IsNumber(a)&&(s=a),s==null)return null;s<5e6&&(s+=19e6);var o=null;for(var h in this.Data.Data)if(this.Data.Data[h].Date==s){o=parseInt(h);break}return o==null||o>=t.length?null:t[o]},this.PERIOD=function(){var t=[5,6,7,11,0,1,2,3,4,5,9];return this.Period>=0&&this.Period<=t.length-1?t[this.Period]:this.Period},this.GetDrawNull=function(){var t=[];if(!this.Data||!this.Data.Data||!this.Data.Data.length)return t;for(var a in this.Data.Data)t[a]=null;return t},this.SysParam=function(t,a){if(!this.DrawInfo)return[];if(t==2){if(a.IsUsePageData=!0,c.IsNumber(this.DrawInfo.Start))return this.DrawInfo.Start+1}else if(t==3){if(a.IsUsePageData=!0,c.IsNumber(this.DrawInfo.End))return this.DrawInfo.End+1}else if(t==4){if(a.IsUsePageData=!0,!c.IsNumber(this.DrawInfo.End)||!c.IsNumber(this.DrawInfo.Start))return[];if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return[];for(var s=null,o=this.DrawInfo.Start;o<=this.DrawInfo.End&&o<this.Data.Data.length;++o){var h=this.Data.Data[o];c.IsNumber(h.High)&&(s==null||s<h.High)&&(s=h.High)}return s}else if(t==5){if(a.IsUsePageData=!0,!c.IsNumber(this.DrawInfo.End)||!c.IsNumber(this.DrawInfo.Start))return[];if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return[];for(var l=null,o=this.DrawInfo.Start;o<=this.DrawInfo.End&&o<this.Data.Data.length;++o){var h=this.Data.Data[o];c.IsNumber(h.Low)&&(l==null||l>h.Low)&&(l=h.Low)}return l}return[]}}Fs.prototype.IsNumber=function(r){return!(r==null||isNaN(r))};Fs.prototype.IsDivideNumber=function(r){return!(r==null||isNaN(r)||r==0)};Fs.prototype.JsonDataToFinance=function(r){for(var n,e=1;e<=4;++e){switch(e){case 1:var t=r.finance1,a=r.announcement1;break;case 2:var t=r.finance2,a=r.announcement2;break;case 3:var t=r.finance3,a=r.announcement3;break;case 4:var t=r.finance4,a=r.announcement4;break}!t||!a||!this.IsNumber(a.year)||!this.IsNumber(a.quarter)||(n?n.Announcement.year<a.year&&(n={Date:r.date,Finance:t,Announcement:a}):n={Date:r.date,Finance:t,Announcement:a})}return n};var K={JOB_DOWNLOAD_SYMBOL_DATA:1,JOB_DOWNLOAD_INDEX_DATA:2,JOB_DOWNLOAD_SYMBOL_LATEST_DATA:3,JOB_DOWNLOAD_INDEX_INCREASE_DATA:4,JOB_DOWNLOAD_VOLR_DATA:5,JOB_DOWNLOAD_LATEST_INDEX_DATA:8,JOB_DOWNLOAD_OTHER_SYMBOL_DATA:9,JOB_DOWNLOAD_SYMBOL_PERIOD_DATA:10,JOB_DOWNLOAD_FINVALUE:301,JOB_DOWNLOAD_FINONE:302,JOB_DOWNLOAD_FINANCE:303,JOB_DOWNLOAD_GPJYVALUE:304,JOB_DOWNLOAD_VARIANT:305,JOB_DOWNLOAD_SCJYVALUE:306,JOB_DOWNLOAD_MARGIN_BALANCE:1e3,JOB_DOWNLOAD_MARGIN_RATE:1001,JOB_DOWNLOAD_MARGIN_BUY_BALANCE:1010,JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:1011,JOB_DOWNLOAD_MARGIN_BUY_REPAY:1012,JOB_DOWNLOAD_MARGIN_BUY_NET:1013,JOB_DOWNLOAD_MARGIN_SELL_BALANCE:1020,JOB_DOWNLOAD_MARGIN_SELL_VOLUME:1021,JOB_DOWNLOAD_MARGIN_SELL_REPAY:1022,JOB_DOWNLOAD_MARGIN_SELL_NET:1023,JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE:2e3,JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH:2001,JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT:2002,JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE:2003,JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2:2004,JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER:2005,JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING:2006,JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS:2007,JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS:2008,JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE:2009,JOB_DOWNLOAD_HK_TO_SH:2050,JOB_DOWNLOAD_HK_TO_SZ:2051,JOB_DOWNLOAD_HK_TO_SH_SZ:2052,JOB_DOWNLOAD_HK_TO_SHSZ:2053,JOB_CUSTOM_FUNCTION_DATA:6e3,JOB_CUSTOM_VARIANT_DATA:6001,JOB_DOWNLOAD_SECTION_SF:2e4,JOB_DOWNLOAD_SECTION_F_01:20001,JOB_DOWNLOAD_SECTION_F_02:20002,JOB_DOWNLOAD_SECTION_F_03:20003,JOB_DOWNLOAD_SECTION_F_04:20004,JOB_DOWNLOAD_SECTION_F_05:20005,JOB_DOWNLOAD_SECTION_F_06:20006,JOB_DOWNLOAD_SECTION_F_07:20007,JOB_DOWNLOAD_SECTION_F_08:20008,JOB_DOWNLOAD_SECTION_F_09:20009,JOB_DOWNLOAD_SECTION_F_10:20010,JOB_DOWNLOAD_SECTION_F_11:20011,JOB_DOWNLOAD_SECTION_F_12:20012,JOB_DOWNLOAD_SECTION_F_13:20013,JOB_DOWNLOAD_SECTION_F_14:20014,JOB_DOWNLOAD_SECTION_F_15:20015,JOB_DOWNLOAD_SECTION_F_16:20016,JOB_DOWNLOAD_SECTION_F_17:20017,JOB_DOWNLOAD_SECTION_F_18:20018,JOB_DOWNLOAD_SECTION_F_19:20019,JOB_DOWNLOAD_SECTION_F_20:20020,JOB_DOWNLOAD_SECTION_F_21:20021,JOB_DOWNLOAD_SECTION_F_22:20022,JOB_DOWNLOAD_SECTION_F_23:20023,JOB_DOWNLOAD_SECTION_F_24:20024,JOB_DOWNLOAD_SECTION_F_25:20025,JOB_DOWNLOAD_SECTION_F_26:20026,JOB_DOWNLOAD_SECTION_F_27:20027,JOB_DOWNLOAD_SECTION_F_28:20028,JOB_DOWNLOAD_SECTION_F_29:20029,JOB_DOWNLOAD_SECTION_F_30:20030,JOB_DOWNLOAD_SECTION_F_31:20031,JOB_DOWNLOAD_SECTION_F_32:20032,JOB_DOWNLOAD_SECTION_F_33:20033,JOB_DOWNLOAD_SECTION_F_34:20034,JOB_DOWNLOAD_SECTION_F_35:20035,JOB_DOWNLOAD_SECTION_F_36:20036,JOB_DOWNLOAD_SECTION_F_37:20037,JOB_DOWNLOAD_SECTION_F_38:20038,JOB_DOWNLOAD_SECTION_F_39:20039,JOB_DOWNLOAD_CUSTOM_API_DATA:3e4,JOB_EXECUTE_INDEX:30010,JOB_RUN_SCRIPT:1e4,GetMarginJobID:function(n){var e=new Dt.default([[1,K.JOB_DOWNLOAD_MARGIN_BALANCE],[2,K.JOB_DOWNLOAD_MARGIN_RATE],[3,K.JOB_DOWNLOAD_MARGIN_BUY_BALANCE],[4,K.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT],[5,K.JOB_DOWNLOAD_MARGIN_BUY_REPAY],[6,K.JOB_DOWNLOAD_MARGIN_BUY_NET],[7,K.JOB_DOWNLOAD_MARGIN_SELL_BALANCE],[8,K.JOB_DOWNLOAD_MARGIN_SELL_VOLUME],[9,K.JOB_DOWNLOAD_MARGIN_SELL_REPAY],[10,K.JOB_DOWNLOAD_MARGIN_SELL_NET]]);return e.has(n)?e.get(n):null},GetNewsAnalysisID:function(n){var e=new Dt.default([[1,K.JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE],[2,K.JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH],[3,K.JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT],[4,K.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE],[5,K.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2],[6,K.JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER],[7,K.JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING],[8,K.JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS],[9,K.JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS],[10,K.JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE]]);return e.has(n)?e.get(n):null},GetSectionFinanceID:function(n){var e=new Dt.default([["流动资产",K.JOB_DOWNLOAD_SECTION_F_01],["货币资金",K.JOB_DOWNLOAD_SECTION_F_02],["存货",K.JOB_DOWNLOAD_SECTION_F_03],["流动负债",K.JOB_DOWNLOAD_SECTION_F_04],["非流动负债",K.JOB_DOWNLOAD_SECTION_F_05],["三项费用",K.JOB_DOWNLOAD_SECTION_F_06],["投资收益",K.JOB_DOWNLOAD_SECTION_F_07],["归母净利润",K.JOB_DOWNLOAD_SECTION_F_08],["扣非净利润",K.JOB_DOWNLOAD_SECTION_F_09],["扣非每股收益",K.JOB_DOWNLOAD_SECTION_F_10],["加权平均净资产收益",K.JOB_DOWNLOAD_SECTION_F_11],["在建工程",K.JOB_DOWNLOAD_SECTION_F_12],["累计折旧",K.JOB_DOWNLOAD_SECTION_F_13],["少数股东利润",K.JOB_DOWNLOAD_SECTION_F_14],["汇兑损益",K.JOB_DOWNLOAD_SECTION_F_15],["坏账计提",K.JOB_DOWNLOAD_SECTION_F_16],["固定资产",K.JOB_DOWNLOAD_SECTION_F_17],["当期折旧",K.JOB_DOWNLOAD_SECTION_F_18],["营业总收入",K.JOB_DOWNLOAD_SECTION_F_19],["主营业务利润",K.JOB_DOWNLOAD_SECTION_F_20],["营业利润",K.JOB_DOWNLOAD_SECTION_F_21],["净利润",K.JOB_DOWNLOAD_SECTION_F_22],["应收账款",K.JOB_DOWNLOAD_SECTION_F_23],["财务费用",K.JOB_DOWNLOAD_SECTION_F_24],["经营性现金流",K.JOB_DOWNLOAD_SECTION_F_25],["资产总计",K.JOB_DOWNLOAD_SECTION_F_26],["负债总计",K.JOB_DOWNLOAD_SECTION_F_27],["所有者权益总计",K.JOB_DOWNLOAD_SECTION_F_28],["毛利率",K.JOB_DOWNLOAD_SECTION_F_29],["每股资本公积金",K.JOB_DOWNLOAD_SECTION_F_30],["每股未分配利润",K.JOB_DOWNLOAD_SECTION_F_31],["每股收益",K.JOB_DOWNLOAD_SECTION_F_32],["每股净资产",K.JOB_DOWNLOAD_SECTION_F_33],["每股经营性现金流",K.JOB_DOWNLOAD_SECTION_F_34],["扣非净利润涨幅",K.JOB_DOWNLOAD_SECTION_F_35],["扣非净利润涨速",K.JOB_DOWNLOAD_SECTION_F_36],["净利润涨幅",K.JOB_DOWNLOAD_SECTION_F_37],["资产负债率",K.JOB_DOWNLOAD_SECTION_F_38],["利润同比",K.JOB_DOWNLOAD_SECTION_F_39]]);return e.has(n)?e.get(n):null},GetSectionReportPeriod:function(n,e){return n>=2e3&&e>=1&&e<=4?{Year:n,Quarter:e}:null}};function FI(r,n){var e=this;this.AST=r,this.ErrorHandler=new ps,this.VarTable=new Dt.default,this.VarDrawTable=new Dt.default,this.OutVarTable=[],this.Arguments=[],this.ErrorCallback,this.GetEventCallback,this.IsUsePageData=!1,this.IndexCtrl,this.Debug=0,this.DebugFilter,this.Interrupt={Exit:!1},this.ConstVarTable=new Dt.default([["CLOSE",null],["VOL",null],["OPEN",null],["HIGH",null],["LOW",null],["AMOUNT",null],["C",null],["V",null],["O",null],["H",null],["L",null],["AMO",null],["VOLR",null],["VOLINSTK",null],["OPI",null],["QHJSJ",null],["SETTLE",null],["ZSTJJ",null],["ISEQUAL",null],["ISUP",null],["ISDOWN"],["DATE",null],["YEAR",null],["MONTH",null],["PERIOD",null],["WEEK",null],["TIME",null],["DAY",null],["DATETIME",null],["TIME2",null],["WEEKOFYEAR",null],["DAYSTOTODAY",null],["INDEXA",null],["INDEXC",null],["INDEXH",null],["INDEXL",null],["INDEXO",null],["INDEXV",null],["INDEXADV",null],["INDEXDEC",null],["ADVANCE",null],["DECLINE",null],["FROMOPEN",null],["TOTALFZNUM",null],["CURRBARSCOUNT",null],["TOTALBARSCOUNT",null],["ISLASTBAR",null],["BARSTATUS",null],["BARPOS",null],["CAPITAL",null],["TOTALCAPITAL",null],["EXCHANGE",null],["SETCODE",null],["CODE",null],["STKNAME",null],["TQFLAG",null],["HYBLOCK",null],["DYBLOCK",null],["GNBLOCK",null],["FGBLOCK",null],["ZSBLOCK",null],["ZHBLOCK",null],["ZDBLOCK",null],["HYZSCODE",null],["GNBLOCKNUM",null],["FGBLOCKNUM",null],["ZSBLOCKNUM",null],["ZHBLOCKNUM",null],["ZDBLOCKNUM",null],["HYSYL",null],["HYSJL",null],["DRAWNULL",null],["NULL",null],["MACHINEDATE",null],["MACHINETIME",null],["MACHINEWEEK",null]]),this.SymbolData=new Fs(this.AST,n,this),this.Algorithm=new Di(this.ErrorHandler,this.SymbolData),this.Draw=new Pr(this.ErrorHandler,this.SymbolData),this.JobList=[],this.UpdateUICallback=null,this.CallbackParam=null,this.IsSectionMode=!1,n&&(n.Callback&&(this.UpdateUICallback=n.Callback),n.CallbackParam&&(this.CallbackParam=n.CallbackParam,this.CallbackParam.HQChart&&(this.GetEventCallback=function(t){return e.CallbackParam.HQChart.GetEventCallback(t)})),n.Arguments&&(this.Arguments=n.Arguments),n.IsSectionMode&&(this.IsSectionMode=n.IsSectionMode),n.Self&&(this.IndexCtrl=n.Self),c.IsNumber(n.Debug)&&(this.Debug=n.Debug),n.DebugFilter&&(this.DebugFilter=n.DebugFilter)),this.Execute=function(){this.OutVarTable=[],this.VarTable=new Dt.default,this.VarDrawTable=new Dt.default,X.Complier.Log("[JSExecute::Execute] Load Arguments",this.Arguments);for(var t in this.Arguments){var a=this.Arguments[t];this.VarTable.set(a.Name,a.Value)}this.RunNextJob()},this.RunNextJob=function(){if(!(this.JobList.length<=0)){X.Complier.Log("[JSExecute::Execute] JobList",this.JobList);var t=this.JobList.shift();switch(t.ID){case K.JOB_DOWNLOAD_SYMBOL_DATA:return this.SymbolData.GetSymbolData();case K.JOB_DOWNLOAD_SYMBOL_PERIOD_DATA:return this.SymbolData.GetSymbolPeriodData(t);case K.JOB_DOWNLOAD_INDEX_DATA:return this.SymbolData.GetIndexData();case K.JOB_DOWNLOAD_LATEST_INDEX_DATA:return this.SymbolData.GetLatestIndexData();case K.JOB_DOWNLOAD_INDEX_INCREASE_DATA:return this.SymbolData.GetIndexIncreaseData(t);case K.JOB_DOWNLOAD_SYMBOL_LATEST_DATA:return this.SymbolData.GetLatestData(t);case K.JOB_DOWNLOAD_VOLR_DATA:return this.SymbolData.GetVolRateData(t);case K.JOB_DOWNLOAD_OTHER_SYMBOL_DATA:return this.SymbolData.GetOtherSymbolData(t);case K.JOB_DOWNLOAD_RELEASE_DATE_DATA:return this.SymbolData.GetCompanyReleaseDate(t.ID);case K.JOB_DOWNLOAD_MARGIN_BALANCE:case K.JOB_DOWNLOAD_MARGIN_RATE:case K.JOB_DOWNLOAD_MARGIN_BUY_BALANCE:case K.JOB_DOWNLOAD_MARGIN_BUY_AMOUNT:case K.JOB_DOWNLOAD_MARGIN_BUY_REPAY:case K.JOB_DOWNLOAD_MARGIN_BUY_NET:case K.JOB_DOWNLOAD_MARGIN_SELL_BALANCE:case K.JOB_DOWNLOAD_MARGIN_SELL_VOLUME:case K.JOB_DOWNLOAD_MARGIN_SELL_REPAY:case K.JOB_DOWNLOAD_MARGIN_SELL_NET:return this.SymbolData.GetMarginData(t.ID);case K.JOB_DOWNLOAD_NEWS_ANALYSIS_NEGATIVE:case K.JOB_DOWNLOAD_NEWS_ANALYSIS_RESEARCH:case K.JOB_DOWNLOAD_NEWS_ANALYSIS_INTERACT:case K.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE:case K.JOB_DOWNLOAD_NEWS_ANALYSIS_HOLDERCHANGE2:case K.JOB_DOWNLOAD_NEWS_ANALYSIS_TRUSTHOLDER:case K.JOB_DOWNLOAD_NEWS_ANALYSIS_BLOCKTRADING:case K.JOB_DOWNLOAD_NEWS_ANALYSIS_COMPANYNEWS:case K.JOB_DOWNLOAD_NEWS_ANALYSIS_TOPMANAGERS:case K.JOB_DOWNLOAD_NEWS_ANALYSIS_PLEDGE:return this.SymbolData.GetNewsAnalysisData(t.ID);case K.JOB_DOWNLOAD_HK_TO_SHSZ:return this.SymbolData.GetHKToSHSZData(t);case K.JOB_DOWNLOAD_SECTION_SF:return this.SymbolData.GetSectionFinanceData(t);case K.JOB_DOWNLOAD_FINONE:return this.SymbolData.GetFinOne(t);case K.JOB_DOWNLOAD_FINVALUE:return this.SymbolData.GetFinValue(t);case K.JOB_DOWNLOAD_FINANCE:return this.SymbolData.GetFinance(t);case K.JOB_DOWNLOAD_GPJYVALUE:return this.SymbolData.GetGPJYValue(t);case K.JOB_DOWNLOAD_SCJYVALUE:return this.SymbolData.GetSCJYValue(t);case K.JOB_DOWNLOAD_VARIANT:return this.SymbolData.GetVariantData(t);case K.JOB_CUSTOM_VARIANT_DATA:return this.SymbolData.GetCustomVariantData(t);case K.JOB_CUSTOM_FUNCTION_DATA:return this.SymbolData.GetCustomFunctionData(t);case K.JOB_DOWNLOAD_CUSTOM_API_DATA:return this.SymbolData.DownloadCustomAPIData(t);case K.JOB_EXECUTE_INDEX:return this.SymbolData.CallScriptIndex(t);case K.JOB_RUN_SCRIPT:return this.Debug===1&&this.DebugFilter?this.DebugRun():this.Run()}}},this.ReadSymbolData=function(t,a){switch(t){case"CLOSE":case"C":case"VOL":case"V":case"OPEN":case"O":case"HIGH":case"H":case"LOW":case"L":case"AMOUNT":case"AMO":case"OPI":case"VOLINSTK":case"SETTLE":case"QHJSJ":case"ZSTJJ":case"ISEQUAL":case"ISUP":case"ISDOWN":return this.SymbolData.GetSymbolCacheData(t);case"VOLR":return this.SymbolData.GetVolRateCacheData(a);case"INDEXA":case"INDEXC":case"INDEXH":case"INDEXH":case"INDEXO":case"INDEXV":case"INDEXL":case"INDEXADV":case"INDEXDEC":return this.SymbolData.GetIndexCacheData(t);case"CURRBARSCOUNT":return this.SymbolData.GetCurrBarsCount();case"BARPOS":return this.SymbolData.GetBarPos();case"TOTALBARSCOUNT":return this.SymbolData.GetTotalBarsCount();case"TOTALFZNUM":return this.SymbolData.GetTotalTradeMinuteCount();case"ISLASTBAR":return this.SymbolData.GetIsLastBar();case"BARSTATUS":return this.SymbolData.GetBarStatus();case"TOTALCAPITAL":case"CAPITAL":case"EXCHANGE":case"HYBLOCK":case"DYBLOCK":case"GNBLOCK":case"FGBLOCK":case"ZSBLOCK":case"ZHBLOCK":case"ZDBLOCK":case"HYZSCODE":case"GNBLOCKNUM":case"FGBLOCKNUM":case"ZSBLOCKNUM":case"ZHBLOCKNUM":case"ZDBLOCKNUM":case"HYSYL":case"HYSJL":return this.SymbolData.GetStockCacheData({VariantName:t,Node:a});case"SETCODE":return this.SymbolData.SETCODE();case"CODE":return this.SymbolData.GetSymbol();case"STKNAME":return this.SymbolData.GetName();case"TIME":return this.SymbolData.TIME();case"TIME2":return this.SymbolData.TIME2();case"DATE":return this.SymbolData.DATE();case"DATETIME":return this.SymbolData.DateTime();case"YEAR":return this.SymbolData.YEAR();case"MONTH":return this.SymbolData.MONTH();case"WEEK":return this.SymbolData.WEEK();case"DAY":return this.SymbolData.DAY();case"PERIOD":return this.SymbolData.PERIOD();case"FROMOPEN":return this.SymbolData.GetLatestIndexCacheData("FROMOPEN");case"DRAWNULL":case"NULL":return this.SymbolData.GetDrawNull();case"ADVANCE":case"DECLINE":return this.SymbolData.GetIndexIncreaseCacheData(t,this.SymbolData.Symbol,a);case"TQFLAG":return this.SymbolData.Right;case"MACHINEDATE":{var s=new Date;return s.getFullYear()*1e4+s.getMonth()*1*100+s.getDate()-19e6}case"MACHINETIME":{var s=new Date;return s.getHours()*1e4+s.getMinutes()*1*100+s.getSeconds()}case"MACHINEWEEK":{var s=new Date;return s.getDay()}case"WEEKOFYEAR":return this.SymbolData.WEEKOFYEAR();case"DAYSTOTODAY":return this.SymbolData.DAYSTOTODAY()}},this.ReadCustomVariant=function(t,a){return this.SymbolData.GetStockCacheData({VariantName:t,Node:a})},this.ReadVariable=function(t,a){if(this.ConstVarTable.has(t)){var s=this.ConstVarTable.get(t);return s==null&&(s=this.ReadSymbolData(t,a),this.ConstVarTable.set(t,s)),s}if(zt.IsCustomVariant(t))return this.ReadCustomVariant(t,a);if(this.VarTable.has(t))return this.VarTable.get(t);if(t.indexOf("#")>0){var o=t.split("#");return this.SymbolData.GetSymbolPeriodCacheData(o[0],o[1])}if(t.indexOf("COLOR")==0){var h=Qe.ColorVarToRGB(t);if(h)return h}return this.ThrowUnexpectedNode(a,"变量"+t+"不存在",t),null},this.ReadMemberVariable=function(t){var a=t.Object,s=t.Property,o=void 0;if(a.Type==vt.BinaryExpression||a.Type==vt.LogicalExpression?o=this.VisitBinaryExpression(a):a.Type==vt.CallExpression?o=this.VisitCallExpression(a):o=this.GetNodeValue(a),!o)return null;var h=o[s.Name];return h||null},this.SingleDataToArrayData=function(t){for(var a=this.SymbolData.Data.Data.length,s=[],o=0;o<a;++o)s[o]=t;return s},this.RunAST=function(){this.AST||this.ThrowError(),this.AST.Body||this.ThrowError();for(var t=0;t<this.AST.Body.length;++t){var a=this.AST.Body[t];if(this.RunASTNode(a,t),this.Interrupt&&this.Interrupt.Exit){X.Complier.Log("[JSExecute::RunAST] Interrupt",this.Interrupt);break}}return X.Complier.Log("[JSExecute::RunAST]",this.VarTable),this.OutVarTable},this.RunASTNode=function(t,a){this.VisitNode(t);var s=a;if(t.Type==vt.ExpressionStatement&&t.Expression){if(t.Expression.Type==vt.AssignmentExpression){if(t.Expression.Operator==":"&&t.Expression.Left){var o=t.Expression,h=o.Left.Name,l=this.VarTable.get(h);if(this.VarDrawTable.has(h)){var u=this.VarDrawTable.get(h);this.OutVarTable.push({Name:u.Name,Draw:u,Type:1})}else{var f=0;if(l&&(typeof l>"u"?"undefined":(0,Wi.default)(l))=="object"&&l.__Type__=="Object")f=1e3;else if(!this.IsSectionMode&&!Array.isArray(l))if(typeof l=="string"){var C=parseFloat(l);c.IsNumber(C)?l=this.SingleDataToArrayData(C):(l=this.SingleDataToArrayData(l),f=1001)}else l=this.SingleDataToArrayData(l);this.OutVarTable.push({Name:h,Data:l,Type:f})}}}else if(t.Expression.Type==vt.CallExpression){var D=t.Expression;if(this.Draw.IsDrawFunction(D.Callee.Name)){var v=D.Draw;v.Name=D.Callee.Name,this.OutVarTable.push({Name:v.Name,Draw:v,Type:1})}else if(D.Callee.Name==="IFC"&&D.Draw){var S=D.Draw;S.Name=S.DrawType,this.OutVarTable.push({Name:S.Name,Draw:S,Type:1})}else{var T=D.Out;M="__temp_c_"+D.Callee.Name+"_"+s+"__";var f=0;Array.isArray(T)||(T=this.SingleDataToArrayData(T)),this.OutVarTable.push({Name:M,Data:T,Type:f,NoneName:!0})}}else if(t.Expression.Type==vt.Identifier){var I=t.Expression.Name,F=this.ReadVariable(I,t.Expression),f=0;F&&(typeof F>"u"?"undefined":(0,Wi.default)(F))=="object"&&F.__Type__=="Object"?f=1e3:!this.IsSectionMode&&!Array.isArray(F)&&(typeof F=="string"?F=this.SingleDataToArrayData(parseFloat(F)):F=this.SingleDataToArrayData(F)),I="__temp_i_"+s+"__",this.OutVarTable.push({Name:I,Data:F,Type:f,NoneName:!0})}else if(t.Expression.Type==vt.Literal){var E=t.Expression.Value;c.IsString(E)&&E.indexOf("$")>0&&(E=this.SymbolData.GetOtherSymolCacheData({Literal:E})),M="__temp_li_"+s+"__";var f=0;this.OutVarTable.push({Name:M,Data:E,Type:f,NoneName:!0})}else if(t.Expression.Type==vt.BinaryExpression){var M="__temp_b_"+s+"__",O=t.Expression.Out,f=0;Array.isArray(O)||(O=this.SingleDataToArrayData(O)),this.OutVarTable.push({Name:M,Data:O,Type:f,NoneName:!0})}else if(t.Expression.Type==vt.LogicalExpression){var M="__temp_l_"+s+"__",R=t.Expression.Out,f=0;Array.isArray(R)||(R=this.SingleDataToArrayData(R)),this.OutVarTable.push({Name:M,Data:R,Type:f,NoneName:!0})}else if(t.Expression.Type==vt.SequenceExpression){for(var b=void 0,p=void 0,G=void 0,Y=void 0,Q=void 0,ht=void 0,Ct=!1,lt=!1,dt=!1,Ut=!1,Wt=!1,Qt=!1,ye=!1,Ne=!1,Kt=!1,Oe=!0,Ce=!1,na=!1,sa=!1,pa=!1,Fa=!0,St=!1,Mt=!1,Pt=!1,Et=-1,ee=-1,Fe=-1,De=null,Da=null,Va=null,Ha=null,oa=0;oa<t.Expression.Expression.length;++oa){var Gt=t.Expression.Expression[oa];if(Gt.Type==vt.AssignmentExpression&&Gt.Operator==":"&&Gt.Left){if(oa==0){b=Gt.Left.Name;var ji=this.VarTable.get(b);this.VarDrawTable.has(b)?p=this.VarDrawTable.get(b):Array.isArray(ji)||(ji=this.SingleDataToArrayData(ji),this.VarTable.set(b,ji))}}else if(Gt.Type==vt.Identifier){var ae=Gt.Name;if(ae==="COLORSTICK")Ct=!0;else if(ae==="POINTDOT")lt=!0;else if(ae==="CIRCLEDOT")Ut=!0;else if(ae==="DOTLINE")na=!0;else if(ae=="UPDOWNDOT")dt=!0;else if(ae==="LINESTICK")Wt=!0;else if(ae==="STICK")Qt=!0;else if(ae==="VOLSTICK")ye=!0;else if(ae=="LINEAREA")Ne=!0;else if(ae==="DRAWABOVE")St=!0;else if(ae==="DRAWCENTER")Mt=!0;else if(ae=="DRAWBELOW")Pt=!0;else if(ae=="STEPLINE")Kt=!0;else if(ae.indexOf("COLOR")==0)G=ae;else if(ae.indexOf("RGBX")==0&&ae.length==10)G=ae;else if(ae.indexOf("LINETHICK")==0)ht=ae;else if(ae=="ALIGN0")Et=0;else if(ae=="ALIGN1")Et=1;else if(ae=="ALIGN2")Et=2;else if(ae=="VALIGN0")ee=0;else if(ae=="VALIGN1")ee=1;else if(ae=="VALIGN2")ee=2;else if(ae.indexOf("NODRAW")==0)Oe=!1;else if(ae.indexOf("EXDATA")==0)Ce=!0;else if(ae.indexOf("LINEOVERLAY")==0)sa=!0;else if(ae.indexOf("NOTEXT")==0||ae.indexOf("NOTITLE")==0)Fa=!1;else if(ae.indexOf("FONTSIZE")==0){var Es=ae.replace("FONTSIZE","");Fe=parseInt(Es)}else if(oa==0){b=Gt.Name;var ha=this.ReadVariable(b,Gt);Array.isArray(ha)||(ha=this.SingleDataToArrayData(ha)),b="__temp_si_"+s+"__",pa=!0,this.VarTable.set(b,ha)}}else if(Gt.Type==vt.Literal){if(oa==0){var Oi=this.SingleDataToArrayData(Gt.Value);b=Gt.Value.toString(),this.VarTable.set(b,Oi)}}else if(Gt.Type==vt.CallExpression)if(oa==0)if(this.Draw.IsDrawFunction(Gt.Callee.Name))p=Gt.Draw,p.Name=Gt.Callee.Name;else{var Ri=Gt.Out;b="__temp_sc_"+Gt.Callee.Name+"_"+s+"__",pa=!0,this.VarTable.set(b,Ri)}else if(Gt.Callee.Name=="RGB"||Gt.Callee.Name=="RGBA")G=Gt.Out;else if(Gt.Callee.Name=="UPCOLOR")Y=Gt.Out;else if(Gt.Callee.Name=="DOWNCOLOR")Q=Gt.Out;else if(Gt.Callee.Name=="XMOVE")Va=Gt.Out;else if(Gt.Callee.Name=="YMOVE")Ha=Gt.Out;else if(Gt.Callee.Name=="SOUND")this.GetSoundEvent(),b=null;else if(Gt.Callee.Name=="ICON"){var At=this.VarTable.get(b);At&&(p=this.GetOutIconData(At,Gt.Draw),p&&(p.Name=Gt.Callee.Name)),b=null}else Gt.Callee.Name=="BACKGROUND"?(De=Gt.Draw,b=null):Gt.Callee.Name=="CKLINE"&&(Da=Gt.Draw,b=null);else if(Gt.Type==vt.BinaryExpression&&oa==0){b="__temp_sb_"+s+"__";var $e=Gt.Out;pa=!0,this.VarTable.set(b,$e)}}if(lt&&b){var tr=this.VarTable.get(b);Array.isArray(tr)||(tr=this.SingleDataToArrayData(tr));var wr={Name:b,Data:tr,Radius:m.POINTDOT.Radius,Type:3};G&&(wr.Color=G),ht&&(wr.LineWidth=ht),this.OutVarTable.push(wr)}else if(Ut&&b){var er=this.VarTable.get(b);Array.isArray(er)||(er=this.SingleDataToArrayData(er));var ar={Name:b,Data:er,Radius:m.CIRCLEDOT.Radius,Type:3};G&&(ar.Color=G),ht&&(ar.LineWidth=ht),this.OutVarTable.push(ar)}else if(dt&&b){var yi=this.VarTable.get(b);Array.isArray(yi)||(yi=this.SingleDataToArrayData(yi));var hi={Name:b,Data:yi,Radius:m.CIRCLEDOT.Radius,Type:3,UpDownDot:!0};G&&(hi.Color=G),ht&&(hi.LineWidth=ht),this.OutVarTable.push(hi)}else if(Wt&&b){var Ya=this.VarTable.get(b),ka={Name:b,Data:Ya,Type:4};G&&(ka.Color=G),ht&&(ka.LineWidth=ht),this.OutVarTable.push(ka)}else if(Qt&&b){var Ti=this.VarTable.get(b),Br={Name:b,Data:Ti,Type:5};G&&(Br.Color=G),ht&&(Br.LineWidth=ht),this.OutVarTable.push(Br)}else if(ye&&b){var ir=this.VarTable.get(b),Pi={Name:b,Data:ir,Type:6};G&&(Pi.Color=G),Y&&(Pi.UpColor=Y),Q&&(Pi.DownColor=Q),this.OutVarTable.push(Pi)}else if(Ne&&b){var mn=this.VarTable.get(b),wi={Name:b,Data:mn,Type:9};G&&(wi.Color=G),Y&&(wi.UpColor=Y),Q&&(wi.DownColor=Q),ht&&(wi.LineWidth=ht),this.OutVarTable.push(wi)}else if(Ct&&b){var di=this.VarTable.get(b),Xa={Name:b,Data:di,Color:G,Type:2};ht&&(Xa.LineWidth=ht),G&&(Xa.Color=G),Y&&(Xa.UpColor=Y),Q&&(Xa.DownColor=Q),this.OutVarTable.push(Xa)}else if(b&&G&&!p){var Bi=this.VarTable.get(b);Array.isArray(Bi)||(Bi=this.SingleDataToArrayData(Bi));var Na={Name:b,Data:Bi,Color:G,Type:0};ht&&(Na.LineWidth=ht),Oe==!1&&(Na.IsShow=!1),Ce==!0&&(Na.IsExData=!0),na==!0&&(Na.IsDotLine=!0),sa==!0&&(Na.IsOverlayLine=!0),pa==!0&&(Na.NoneName=!0),Fa==!1&&(Na.IsShowTitle=!1),Kt==!0&&(Na.Type=7),this.OutVarTable.push(Na)}else if(p){var xe={Name:p.Name,Draw:p,Type:1};G&&(xe.Color=G),na==!0&&(xe.IsDotLine=!0),ht&&(xe.LineWidth=ht),St&&(xe.IsDrawAbove=!0),Mt&&(xe.IsDrawCenter=!0),Pt&&(xe.IsDrawBelow=!0),Et>=0&&(xe.DrawAlign=Et),ee>=0&&(xe.DrawVAlign=ee),Fe>0&&(xe.DrawFontSize=Fe),De&&(xe.Background=De),Da&&(xe.VerticalLine=Da),c.IsNumber(Va)&&(xe.XOffset=Va),c.IsNumber(Ha)&&(xe.YOffset=Ha),this.OutVarTable.push(xe)}else if(b){var qe=this.VarTable.get(b),Ea={Name:b,Data:qe,Type:0};G&&(Ea.Color=G),ht&&(Ea.LineWidth=ht),Oe==!1&&(Ea.IsShow=!1),Ce==!0&&(Ea.IsExData=!0),na==!0&&(Ea.IsDotLine=!0),sa==!0&&(Ea.IsOverlayLine=!0),Fa==!1&&(Ea.IsShowTitle=!1),Kt==!0&&(Ea.Type=7),this.OutVarTable.push(Ea)}}}},this.GetOutIconData=function(t,a){if(Array.isArray(t)){for(var s=0;s<t.length&&s<a.DrawData.length;++s){var o=t[s];o<=0&&(a.DrawData[s]=null)}return a}return t?a:null},this.GetSoundEvent=function(){return this.GetEventCallback?this.GetEventCallback(et.ON_PLAY_SOUND):null},this.Run=function(){try{var t=this.RunAST();X.Complier.Log("[JSComplier.Run] execute finish",t),this.IndexCtrl&&(this.IndexCtrl.Status=0),this.UpdateUICallback&&(X.Complier.Log("[JSComplier.Run] invoke UpdateUICallback."),this.CallbackParam&&this.CallbackParam.Job&&this.CallbackParam.Job.ID==K.JOB_EXECUTE_INDEX?this.UpdateUICallback(t,this.CallbackParam,this.SymbolData):(this.CallbackParam&&this.CallbackParam.Self&&this.CallbackParam.Self.ClassName==="ScriptIndexConsole"&&(this.CallbackParam.JSExecute=this),this.IsUsePageData==!0&&(this.CallbackParam.Self.IsUsePageData=!0),this.UpdateUICallback(t,this.CallbackParam)))}catch(a){X.Complier.Log(a),a.Job?(X.Complier.Log("[JSComplier.Run] download job and reexectue",a.Job),this.JobList.push(a.Job),this.JobList.push({ID:K.JOB_RUN_SCRIPT}),this.Execute()):this.ErrorCallback&&(this.IndexCtrl&&(this.IndexCtrl.Status=0),this.ErrorCallback(a,this.CallbackParam))}},this.DebugRun_End=function(){var t=this.OutVarTable;X.Complier.Log("[JSComplier.DebugRun_End] execute finish",t),this.IndexCtrl&&(this.IndexCtrl.Status=0),this.UpdateUICallback&&(X.Complier.Log("[JSComplier.DebugRun_End] invoke UpdateUICallback."),this.CallbackParam&&this.CallbackParam.Job&&this.CallbackParam.Job.ID==K.JOB_EXECUTE_INDEX?this.UpdateUICallback(t,this.CallbackParam,this.SymbolData):(this.CallbackParam&&this.CallbackParam.Self&&this.CallbackParam.Self.ClassName==="ScriptIndexConsole"&&(this.CallbackParam.JSExecute=this),this.IsUsePageData==!0&&(this.CallbackParam.Self.IsUsePageData=!0),this.UpdateUICallback(t,this.CallbackParam)))},this.DebugRun_Next=function(t){var a=this;if(t.ExeLine<t.LineCount){var s=this.AST.Body[t.ExeLine];this.RunASTNode(s),++t.ExeLine,this.DebugFilter(t,function(){a.DebugRun_Next(t)})}else this.DebugRun_End(),t.Status=2,this.DebugFilter(t,null)},this.DebugRun=function(){var t=this;try{this.AST||this.ThrowError(),this.AST.Body||this.ThrowError();var a={LineCount:this.AST.Body.length,ExeLine:0,Self:this,Status:1};this.DebugFilter(a,function(){t.DebugRun_Next(a)})}catch(s){this.ErrorCallback&&(this.IndexCtrl&&(this.IndexCtrl.Status=0),this.ErrorCallback(s,this.CallbackParam))}},this.VisitNode=function(t){switch(t.Type){case vt.SequenceExpression:this.VisitSequenceExpression(t);break;case vt.ExpressionStatement:this.VisitNode(t.Expression);break;case vt.AssignmentExpression:this.VisitAssignmentExpression(t);break;case vt.BinaryExpression:case vt.LogicalExpression:this.VisitBinaryExpression(t);break;case vt.CallExpression:this.VisitCallExpression(t);break}},this.VisitSequenceExpression=function(t){for(var a in t.Expression){var s=t.Expression[a];this.VisitNode(s)}},this.VisitCallExpression=function(t){for(var a=t.Callee.Name,s=[],o=0;o<t.Arguments.length;++o){var h=t.Arguments[o],l;if(a==="IFC"&&o>=1)break;h.Type==vt.BinaryExpression||h.Type==vt.LogicalExpression?l=this.VisitBinaryExpression(h):h.Type==vt.CallExpression?l=this.VisitCallExpression(h):l=this.GetNodeValue(h),s.push(l)}if(a==="IFC"){var u=this.Algorithm.IFC(s[0]),h=u?t.Arguments[1]:t.Arguments[2],l;return h.Type==vt.BinaryExpression||h.Type==vt.LogicalExpression?l=this.VisitBinaryExpression(h):h.Type==vt.CallExpression?l=this.VisitCallExpression(h):l=this.GetNodeValue(h),t.Out=l,h.Draw&&(t.Draw=h.Draw),t.Out}if(zt.IsCustomFunction(a)){var f=this.Algorithm.CallCustomFunction(a,s,this.SymbolData,t);return t.Out=[],t.Draw=null,f&&(f.Out&&(t.Out=f.Out),f.Draw&&(t.Draw=f.Draw)),t.Out}switch(a){case"DYNAINFO":t.Out=this.SymbolData.GetLatestCacheData(s[0]);break;case"STICKLINE":t.Draw=this.Draw.STICKLINE(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"DRAWTEXT":t.Draw=this.Draw.DRAWTEXT(s[0],s[1],s[2]),t.Out=[];break;case"DRAWTEXT_FIX":t.Draw=this.Draw.DRAWTEXT_FIX(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"SUPERDRAWTEXT":t.Draw=this.Draw.SUPERDRAWTEXT(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"DRAWICON":t.Draw=this.Draw.DRAWICON(s[0],s[1],s[2]),t.Out=[];break;case"ICON":t.Draw=this.Draw.ICON(s[0],s[1]),t.Out=[];break;case"TIPICON":t.Draw=this.Draw.TIPICON(s[0],s[1],s[2],s[3]),t.Out=[];break;case"BACKGROUND":t.Draw=this.Draw.BACKGROUND(s[0],s[1],s[2],s[3],s[4],s[5]),t.Out=[];break;case"CKLINE":t.Draw=this.Draw.CKLINE(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"DRAWLINE":t.Draw=this.Draw.DRAWLINE(s[0],s[1],s[2],s[3],s[4]),t.Out=t.Draw.DrawData;break;case"DRAWBAND":t.Draw=this.Draw.DRAWBAND(s[0],s[1],s[2],s[3]),t.Out=[];break;case"FILLRGN":s.length>=4?t.Draw=this.Draw.FILLRGN2(s):t.Draw=this.Draw.FILLRGN(s[0],s[1],s[2]),t.Out=[];break;case"FLOATRGN":t.Draw=this.Draw.FLOATRGN(s),t.Out=[];break;case"FILLTOPRGN":t.Draw=this.Draw.FILLBGRGN(1,s),t.Out=[];break;case"FILLBOTTOMRGN":t.Draw=this.Draw.FILLBGRGN(0,s),t.Out=[];break;case"FILLVERTICALRGN":t.Draw=this.Draw.FILLVERTICALRGN(s),t.Out=[];break;case"DRAWKLINE":case"DRAWKLINE1":t.Draw=this.Draw.DRAWKLINE(s[0],s[1],s[2],s[3]),t.Out=[];break;case"DRAWKLINE_IF":t.Draw=this.Draw.DRAWKLINE_IF(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"DRAWCOLORKLINE":t.Draw=this.Draw.DRAWCOLORKLINE(s[0],s[1],s[2]),t.Out=[];break;case"PLOYLINE":case"POLYLINE":t.Draw=this.Draw.POLYLINE(s[0],s[1]),t.Out=t.Draw.DrawData;break;case"DRAWNUMBER":t.Draw=this.Draw.DRAWNUMBER(s[0],s[1],s[2],s[3]),t.Out=t.Draw.DrawData.Value;break;case"DRAWNUMBER_FIX":t.Draw=this.Draw.DRAWNUMBER_FIX(s[0],s[1],s[2],s[3],s[4]),t.Out=t.Draw.DrawData.Value;break;case"DRAWCHANNEL":t.Draw=this.Draw.DRAWCHANNEL(s[0],s[1],s[2],s[3],s[4],s[5],s[6]),t.Out=[];break;case"RGB":t.Out=this.Draw.RGB(s[0],s[1],s[2]);break;case"RGBA":t.Out=this.Draw.RGBA(s[0],s[1],s[2],s[3]);break;case"UPCOLOR":t.Out=this.Draw.UPCOLOR(s[0]);break;case"DOWNCOLOR":t.Out=this.Draw.DOWNCOLOR(s[0]);break;case"XMOVE":t.Out=this.Draw.XMOVE(s[0]);break;case"YMOVE":t.Out=this.Draw.YMOVE(s[0]);break;case"PARTLINE":t.Draw=this.Draw.PARTLINE(s),t.Out=[];break;case"DRAWGBK":t.Draw=this.Draw.DRAWGBK(s[0],s[1],s[2],s[3]),t.Out=[];break;case"DRAWGBK2":t.Draw=this.Draw.DRAWGBK2(s[0],s[1],s[2],s[3]),t.Out=[];break;case"DRAWGBK_DIV":t.Draw=this.Draw.DRAWGBK_DIV(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"DRAWTEXT_LINE":t.Draw=this.Draw.DRAWTEXT_LINE(s[0],s[1],s[2],s[3],s[4],s[5],s[6]),t.Out=[];break;case"DRAWRECTREL":t.Draw=this.Draw.DRAWRECTREL(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"DRAWTEXTREL":t.Draw=this.Draw.DRAWTEXTREL(s[0],s[1],s[2]),t.Out=[];break;case"DRAWTEXTABS":t.Draw=this.Draw.DRAWTEXTABS(s[0],s[1],s[2]),t.Out=[];break;case"DRAWOVERLAYLINE":t.Draw=this.Draw.DRAWOVERLAYLINE(s[0],s[1],s[2]),t.Out=t.Draw.DrawData.Data;break;case"DRAWSL":t.Draw=this.Draw.DRAWSL(s[0],s[1],s[2],s[3],s[4]),t.Out=[];break;case"VERTLINE":t.Draw=this.Draw.VERTLINE(s[0],s[1]),t.Out=t.Draw.DrawData.Data;break;case"HORLINE":t.Draw=this.Draw.HORLINE(s[0],s[1],s[2],s[3]),t.Out=t.Draw.DrawData.Data;break;case"CODELIKE":t.Out=this.SymbolData.CODELIKE(s[0]);break;case"NAMELIKE":case"NAMEINCLUDE":t.Out=this.SymbolData.NAMELIKE(s[1]);break;case"REFDATE":t.Out=this.SymbolData.REFDATE(s[0],s[1]);break;case"FINANCE":t.Out=this.SymbolData.GetStockCacheData({FunctionName:a,Args:s,ArgCount:1,Node:t});break;case"FINVALUE":t.Out=this.SymbolData.GetStockCacheData({FunctionName:a,Args:s,ArgCount:1,Node:t});break;case"FINONE":t.Out=this.SymbolData.GetStockCacheData({FunctionName:a,Args:s,ArgCount:3,Node:t});break;case"GPJYVALUE":t.Out=this.SymbolData.GetStockCacheData({FunctionName:a,Args:s,ArgCount:3,Node:t});break;case"SCJYVALUE":t.Out=this.SymbolData.GetStockCacheData({FunctionName:a,Args:s,ArgCount:3,Node:t});break;case"MARGIN":t.Out=this.SymbolData.GetMarginCacheData(s[0],t);break;case"HK2SHSZ":t.Out=this.SymbolData.GetHKToSHSZCacheData(s[0],t);break;case"NEWS":t.Out=this.SymbolData.GetNewsAnalysisCacheData(s[0],t);break;case"UPCOUNT":case"DOWNCOUNT":t.Out=this.SymbolData.GetIndexIncreaseCacheData(a,s[0],t);break;case"SF":t.Out=this.SymbolData.GetSectionFinanceCacheData(s[0],s[1],s[2],t);break;case"LOADAPIDATA":t.Out=this.SymbolData.GetCustomApiData(s);break;case"STKINDI":case"CALCSTOCKINDEX":t.Out=this.SymbolData.GetScriptIndexOutData(s,t,a);break;case"SOUND":t.Draw=this.Draw.SOUND(s[0]),t.Out=[];break;case"PLAYSOUND":t.Draw=this.Draw.PLAYSOUND(s[0],s[1]),t.Out=[];break;case"CLOSE":case"C":case"VOL":case"V":case"OPEN":case"O":case"HIGH":case"H":case"LOW":case"L":case"AMOUNT":case"AMO":t.Out=this.SymbolData.GetOtherSymolCacheData({FunctionName:a,Args:s});break;case"INBLOCK":t.Out=this.SymbolData.IsInBlock(s[0],t);break;case"COVER_C":case"COVER_O":case"COVER_H":case"COVER_L":case"COVER_A":case"COVER_V":return s.length==2?this.SymbolData.GetSymbolPeriodCacheData2(Ka.GetConvertValueName(a),s[0],s[1]):this.SymbolData.GetSymbolPeriodCacheData(Ka.GetConvertValueName(a),s[0]);case"SYSPARAM":return this.SymbolData.SysParam(s[0],this);case"TESTSKIP":var C=this.Algorithm.TESTSKIP(s[0],t);if(t.Out=null,C&&(this.Interrupt.Exit=!0,t&&t.Marker)){var D=t.Marker;this.Interrupt.Line=D.Line,this.Interrupt.Index=D.Index,this.Interrupt.Column=D.Column}break;default:t.Out=this.Algorithm.CallFunction(a,s,t,this.SymbolData);break}return t.Out},this.VisitAssignmentExpression=function(t){var a=t.Left;a.Type!=vt.Identifier&&this.ThrowUnexpectedNode(t);var s=a.Name,o=t.Right,h=null,l=null;if(o.Type==vt.BinaryExpression||o.Type==vt.LogicalExpression)h=this.VisitBinaryExpression(o);else if(o.Type==vt.CallExpression)h=this.VisitCallExpression(o),o.Draw&&(l=o.Draw);else if(o.Type==vt.Literal)h=o.Value,c.IsString(h)&&o.Value.indexOf("$")>0&&(h=this.SymbolData.GetOtherSymolCacheData({Literal:h}));else if(o.Type==vt.Identifier)h=this.ReadVariable(o.Name,o);else if(o.Type==vt.MemberExpression)h=this.ReadMemberVariable(o);else if(o.Type==vt.UnaryExpression)if(o.Operator=="-"){var u=this.GetNodeValue(o.Argument);h=this.Algorithm.Subtract(0,u)}else h=o.Argument.Value;l&&this.VarDrawTable.set(s,l),this.VarTable.set(s,h)},this.VisitBinaryExpression=function(t){var a=[];a.push(t);for(var s=null;a.length!=0;)if(s=a[a.length-1],s.Left&&t!=s.Left&&t!=s.Right)a.push(s.Left);else if(s.Right&&t!=s.Right)a.push(s.Right);else{var o=a.pop();if(o.Type==vt.BinaryExpression){var h=this.GetNodeValue(o.Left),l=this.GetNodeValue(o.Right);switch(o.Out=null,o.Operator){case"-":o.Out=this.Algorithm.Subtract(h,l);break;case"*":o.Out=this.Algorithm.Multiply(h,l);break;case"/":o.Out=this.Algorithm.Divide(h,l);break;case"+":o.Out=this.Algorithm.Add(h,l);break;case">":o.Out=this.Algorithm.GT(h,l);break;case">=":o.Out=this.Algorithm.GTE(h,l);break;case"<":o.Out=this.Algorithm.LT(h,l);break;case"<=":o.Out=this.Algorithm.LTE(h,l);break;case"==":case"=":o.Out=this.Algorithm.EQ(h,l);break;case"!=":case"<>":o.Out=this.Algorithm.NEQ(h,l);break}}else if(o.Type==vt.LogicalExpression){var u=this.GetNodeValue(o.Left),f=this.GetNodeValue(o.Right);switch(o.Out=null,o.Operator){case"&&":case"AND":o.Out=this.Algorithm.And(u,f);break;case"||":case"OR":o.Out=this.Algorithm.Or(u,f);break}}t=s}return t.Out},this.GetNodeValue=function(t){switch(t.Type){case vt.Literal:return t.Value;case vt.UnaryExpression:if(t.Operator=="-"){var a=this.GetNodeValue(t.Argument);return this.Algorithm.Subtract(0,a)}return t.Argument.Value;case vt.Identifier:var s=this.ReadVariable(t.Name,t);return s;case vt.BinaryExpression:case vt.LogicalExpression:return t.Out;case vt.CallExpression:return this.VisitCallExpression(t);case vt.MemberExpression:return this.ReadMemberVariable(t);default:this.ThrowUnexpectedNode(t)}},this.ThrowUnexpectedNode=function(t,a,s){var o=t.Marker,h=a||"执行异常";return this.ErrorHandler.ThrowError(o.Index,o.Line,o.Column,h,s)},this.ThrowDownloadSF=function(t,a,s){var o=t.Marker,h=s;return this.ErrorHandler.ThrowDownloadJob(o.Index,o.Line,o.Column,h,a)},this.ThrowError=function(){}}function EI(r,n){this.AST=r,this.ErrorHandler=new ps,this.ErrorCallback,this.UpdateUICallback,this.CallbackParam,this.JobList=[],this.VarTable=new Dt.default,this.OutVarTable=[],this.ConstVarTable=new Dt.default([["CLOSE","收盘价"],["VOL","成交量"],["OPEN","开盘价"],["HIGH","最高价"],["LOW","最低价"],["AMOUNT","成交量"],["C","收盘价"],["V","成交量"],["O","开盘价"],["H","最高价"],["L","最低价"],["AMO","成交量"],["VOLR","量比"],["VOLINSTK","持仓量"],["OPI","持仓量"],["ZSTJJ","均价"],["QHJSJ","结算价"],["SETTLE","结算价"],["DATE","日期"],["YEAR","年份"],["MONTH","月份"],["PERIOD","周期"],["WEEK","星期"],["TIME","时间"],["INDEXA","大盘成交额"],["INDEXC","大盘收盘价"],["INDEXH","大盘最高价"],["INDEXL","大盘最低价"],["INDEXO","大盘开盘价"],["INDEXV","大盘成交量"],["INDEXADV","大盘上涨家数"],["INDEXDEC","´大盘下跌家数"],["ADVANCE","上涨家数"],["DECLINE","下跌家数"],["FROMOPEN","当前离开盘分钟数"],["TOTALFZNUM","总分钟数"],["CURRBARSCOUNT","到最后交易的周期"],["TOTALBARSCOUNT","总的周期数"],["ISLASTBAR","是否是最后一个周期"],["BARSTATUS","数据位置状态"],["CAPITAL","当前流通股本(手)"],["TOTALCAPITAL","当前总股本(手)"],["EXCHANGE","换手率"],["SETCODE","市场类型"],["CODE","品种代码"],["STKNAME","品种名称"],["TQFLAG","当前复权状态"],["HYBLOCK","所属行业"],["DYBLOCK","所属地域"],["GNBLOCK","所属概念"],["FGBLOCK","所属风格板块"],["ZSBLOCK","所属指数板块"],["ZHBLOCK","所属组合板块"],["ZDBLOCK","所属自定义板块"],["HYZSCODE","所属行业的板块指数代码"],["GNBLOCKNUM","所属概念板块的个数"],["FGBLOCKNUM","所属风格板块的个数"],["ZSBLOCKNUM","所属指数板块的个数"],["ZHBLOCKNUM","所属组合板块的个数"],["ZDBLOCKNUM","所属自定义板块的个数"],["HYSYL","指数市盈率或个股所属行业的市盈率"],["HYSJL","指数市净率或个股所属行业的市净率"],["DRAWNULL","无效数据"]]),n&&(n.Callback&&(this.UpdateUICallback=n.Callback),n.CallbackParam&&(this.CallbackParam=n.CallbackParam),n.Arguments&&(this.Arguments=n.Arguments)),this.Run=function(){try{this.OutVarTable=[],this.VarTable=new Dt.default,X.Complier.Log("[JSExecute::JSExplainer] Load Arguments",this.Arguments);for(var e in this.Arguments){var t=this.Arguments[e];this.VarTable.set(t.Name,t.Value)}var a=this.RunAST();X.Complier.Log("[JSExplainer.Run] explain finish",a),this.UpdateUICallback&&(X.Complier.Log("[JSExplainer.Run] invoke UpdateUICallback."),this.UpdateUICallback(a))}catch(s){X.Complier.Log("[JSExplainer.Run] throw error ",s),this.ErrorCallback&&this.ErrorCallback(s,this.OutVarTable)}},this.RunAST=function(){this.AST||this.ThrowError(),this.AST.Body||this.ThrowError();for(var e in this.AST.Body){var t=this.AST.Body[e];if(this.VisitNode(t),t.Type==vt.ExpressionStatement&&t.Expression){if(t.Expression.Type==vt.AssignmentExpression){if(t.Expression.Operator==":"&&t.Expression.Left){var a=t.Expression,s=a.Left.Name,o="输出"+s+": "+this.VarTable.get(s);this.OutVarTable.push({Name:s,Data:o,Type:0})}else if(t.Expression.Operator==":="&&t.Expression.Left){var h=t.Expression,l=h.Left.Name,u="赋值"+l+": "+this.VarTable.get(l);this.OutVarTable.push({Name:l,Data:u,Type:0,IsOut:!1})}}else if(t.Expression.Type==vt.CallExpression){var f=t.Expression;if(this.IsDrawFunction(f.Callee.Name)){var C=f.Out,D=f.Callee.Name;this.OutVarTable.push({Name:D,Draw:"输出: "+C,Type:1})}else{var v=f.Out;F="__temp_c_"+f.Callee.Name+"_"+e+"__",this.OutVarTable.push({Name:F,Data:"输出: "+v,Type:0,NoneName:!0})}}else if(t.Expression.Type==vt.Identifier){var S=t.Expression.Name,T=this.ReadVariable(S,t.Expression);S="__temp_i_"+e+"__",this.OutVarTable.push({Name:S,Data:"输出: "+T,Type:0,NoneName:!0})}else if(t.Expression.Type==vt.Literal){var I=t.Expression.Value;c.IsString(I)&&I.indexOf("$")>0&&(I=this.GetOtherSymbolExplain({Literal:I},t)),F="__temp_li_"+e+"__",this.OutVarTable.push({Name:F,Data:"输出: "+I,Type:0,NoneName:!0})}else if(t.Expression.Type==vt.BinaryExpression){var F="__temp_b_"+e+"__",E=t.Expression.Out;this.OutVarTable.push({Name:F,Data:"输出: "+E,Type:0,NoneName:!0})}else if(t.Expression.Type==vt.LogicalExpression){var F="__temp_l_"+e+"__",M=t.Expression.Out;this.OutVarTable.push({Name:F,Data:"输出: "+M,Type:0,NoneName:!0})}else if(t.Expression.Type==vt.SequenceExpression){var O=void 0,R=void 0,b=void 0,p=void 0,G=void 0,Y=!1,Q=!1,ht=!1,Ct=!1,lt=!1,dt=!1,Ut=!0,Wt=!1,Qt=!1,ye=!1;for(var Ne in t.Expression.Expression){var Kt=t.Expression.Expression[Ne];if(Kt.Type==vt.AssignmentExpression&&Kt.Operator==":"&&Kt.Left){O=Kt.Left.Name;var Oe=this.VarTable.get(O);this.VarTable.set(O,Oe)}else if(Kt.Type==vt.Identifier){var Ce=Kt.Name;if(Ce==="COLORSTICK")Y=!0;else if(Ce==="POINTDOT")Q=!0;else if(Ce==="CIRCLEDOT")ht=!0;else if(Ce==="DOTLINE")Wt=!0;else if(Ce==="LINESTICK")Ct=!0;else if(Ce==="STICK")lt=!0;else if(Ce==="VOLSTICK")dt=!0;else if(Ce==="DRAWABOVE")ye=!0;else if(Ce.indexOf("COLOR")==0)p=Ce;else if(Ce.indexOf("LINETHICK")==0)G=Ce;else if(Ce.indexOf("NODRAW")==0)Ut=!1;else if(Ce.indexOf("EXDATA")!=0){if(Ce.indexOf("LINEOVERLAY")!=0){O=Kt.Name;var na=this.ReadVariable(O,Kt);O="__temp_si_"+e+"__",Qt=!0,this.VarTable.set(O,na)}}}else if(Kt.Type==vt.Literal){var sa=Kt.Value;O=Kt.Value.toString(),Qt=!0,this.VarTable.set(O,sa)}else if(Kt.Type==vt.CallExpression)if(this.IsDrawFunction(Kt.Callee.Name))b=Kt.Out,R=Kt.Callee.Name;else{var pa=Kt.Out;O="__temp_sc_"+Kt.Callee.Name+"_"+e+"__",Qt=!0,this.VarTable.set(O,pa)}else if(Kt.Type==vt.BinaryExpression){O="__temp_sb_"+e+"__";var Fa=Kt.Out;Qt=!0,this.VarTable.set(O,Fa)}}var St;if(b?St="输出: "+b:Qt?St="输出: "+this.VarTable.get(O):St="输出"+O+": "+this.VarTable.get(O),p&&(St+=",颜色"+this.GetColorExplain(p)),G&&(St+=",线段粗细"+this.GetLineWidthExplain(G)),Ut==!1&&(St+=",不显示"),Wt==!0&&(St+=",画虚线"),ye==!0&&(St+=",显示在位置之上"),Q&&O){St+=",画小圆点线";var Mt={Name:O,Data:St,Radius:m.POINTDOT.Radius,Type:3};this.OutVarTable.push(Mt)}else if(ht&&O){St+=",画小圆圈线";var Pt={Name:O,Data:St,Radius:m.CIRCLEDOT.Radius,Type:3};this.OutVarTable.push(Pt)}else if(Ct&&O){St+=",画出柱状线和指标线";var Et={Name:O,Data:St,Type:4};this.OutVarTable.push(Et)}else if(lt&&O){St+=",画柱状线";var ee={Name:O,Data:St,Type:5};this.OutVarTable.push(ee)}else if(dt&&O){St+=",画成交量柱状线";var Fe={Name:O,Data:St,Type:6};this.OutVarTable.push(Fe)}else if(O&&p){var De={Name:O,Data:St,Color:p,Type:0};this.OutVarTable.push(De)}else if(b){var Da={Name:R,Data:St,Type:1};this.OutVarTable.push(Da)}else if(Y&&O){St+=",画彩色柱状线";var Va={Name:O,Data:St,Color:p,Type:2};this.OutVarTable.push(Va)}else if(O){var Ha={Name:O,Data:St,Type:0};this.OutVarTable.push(Ha)}}}}return X.Complier.Log("[JSExplainer::Run]",this.VarTable),this.OutVarTable},this.VisitNode=function(e){switch(e.Type){case vt.SequenceExpression:this.VisitSequenceExpression(e);break;case vt.ExpressionStatement:this.VisitNode(e.Expression);break;case vt.AssignmentExpression:this.VisitAssignmentExpression(e);break;case vt.BinaryExpression:case vt.LogicalExpression:this.VisitBinaryExpression(e);break;case vt.CallExpression:this.VisitCallExpression(e);break}},this.VisitSequenceExpression=function(e){for(var t in e.Expression){var a=e.Expression[t];this.VisitNode(a)}},this.VisitCallExpression=function(e){var t=e.Callee.Name,a=[];for(var s in e.Arguments){var o=e.Arguments[s],h=void 0;o.Type==vt.BinaryExpression||o.Type==vt.LogicalExpression?h=this.VisitBinaryExpression(o):o.Type==vt.CallExpression?h=this.VisitCallExpression(o):h=this.GetNodeValue(o),a.push(h)}if(X.Complier.Log("[JSExplainer::VisitCallExpression]",t,"(",a.toString(),")"),zt.IsCustomFunction(t)){var l=this.Algorithm.CallCustomFunction(t,a,this.SymbolData,e);return e.Out=[],e.Draw=null,l&&(l.Out&&(e.Out=l.Out),l.Draw&&(e.Draw=l.Draw)),e.Out}return e.Out=this.CallFunctionExplain(t,a,e),e.Out},this.FUNCTION_INFO_LIST=new Dt.default([["REF",{Name:"REF",Param:{Count:2},ToString:function(t){return t[1]+"日前的"+t[0]}}],["REFX",{Name:"REFX",Param:{Count:2},ToString:function(t){return t[1]+"日后的"+t[0]}}],["REFV",{Name:"REFV",Param:{Count:2},ToString:function(t){return t[1]+"日前的(未作平滑处理)"+t[0]}}],["REFXV",{Name:"REFXV",Param:{Count:2},ToString:function(t){return t[1]+"日后的(未作平滑处理)"+t[0]}}],["REFDATE",{Name:"REFDATE",Param:{Count:2},ToString:function(t){return t[1]+"日"+t[0]}}],["COUNT",{Name:"COUNT",Param:{Count:2},ToString:function(t){return"统计"+t[1]+"日中满足"+t[0]+"的天数"}}],["BARSLASTCOUNT",{Name:"BARSLASTCOUNT",Param:{Count:1},ToString:function(t){return"条件"+t[0]+"连续成立次数"}}],["BARSCOUNT",{Name:"BARSCOUNT",Param:{Count:1},ToString:function(t){return t[0]+"有效数据周期数"}}],["BARSLAST",{Name:"BARSLAST",Param:{Count:1},ToString:function(t){return"上次"+t[0]+"不为0距今天数"}}],["BARSNEXT",{Name:"BARSNEXT",Param:{Count:1},ToString:function(t){return"下次"+t[0]+"不为0距今天数"}}],["BARSSINCEN",{Name:"BARSSINCEN",Param:{Count:2},ToString:function(t){return"在"+t[1]+"周期内首次"+t[0]+"距今天数"}}],["BARSSINCE",{Name:"BARSSINCE",Param:{Count:1},ToString:function(t){return"首次"+t[0]+"距今天数"}}],["HHV",{Name:"HHV",Param:{Count:2},ToString:function(t){return t[1]+"日内"+t[0]+"的最高值"}}],["LLV",{Name:"LLV",Param:{Count:2},ToString:function(t){return t[1]+"日内"+t[0]+"的最低值"}}],["ZTPRICE",{Name:"ZTPRICE",Param:{Count:2},ToString:function(t){return"计算涨停价"}}],["DTPRICE",{Name:"DTPRICE",Param:{Count:2},ToString:function(t){return"计算跌停价"}}],["BACKSET",{Name:"BACKSET",Param:{Count:2},ToString:function(t){return"若"+t[0]+"则将最近"+t[1]+"周期置为1"}}],["HOD",{Name:"HOD",Param:{Count:2},ToString:function(t){return t[1]+"日内"+t[0]+"的高值名次"}}],["LOD",{Name:"LOD",Param:{Count:2},ToString:function(t){return t[1]+"日内"+t[0]+"的低值名次"}}],["REVERSE",{Name:"REVERSE",Param:{Count:1},ToString:function(t){return t[0]+"的相反数"}}],["FILTER",{Name:"FILTER",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日过滤"}}],["FILTERX",{Name:"FILTERX",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日反向过滤"}}],["TFILTER",{Name:"TFILTER",Param:{Count:3},ToString:function(t){return"信号过滤(多头)"}}],["SUMBARS",{Name:"SUMBARS",Param:{Count:2},ToString:function(t){return t[0]+"累加至"+t[1]+"的天数"}}],["MA",{Name:"MA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日简单移动平均"}}],["SMA",{Name:"SMA",Param:{Count:3},ToString:function(t){return t[0]+"的"+t[1]+"日["+t[2]+"日权重]移动平均"}}],["MEMA",{Name:"MEMA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日平滑移动平均"}}],["EMA",{Name:"EMA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日指数移动平均"}}],["EXPMA",{Name:"EXPMA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日指数移动平均"}}],["EXPMEMA",{Name:"EXPMEMA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日指数平滑移动平均"}}],["WMA",{Name:"WMA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日加权移动平均"}}],["DMA",{Name:"DMA",Param:{Count:2},ToString:function(t){return"以"+t[1]+"为权重"+t[0]+"的动态移动平均"}}],["XMA",{Name:"XMA",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日偏移移动平均"}}],["RANGE",{Name:"RANGE",Param:{Count:3},ToString:function(t){return t[0]+"位于"+t[1]+"和"+t[2]+"之间"}}],["CONST",{Name:"CONST",Param:{Count:1},ToString:function(t){return t[0]+"的最后一日值"}}],["TOPRANGE",{Name:"TOPRANGE",Param:{Count:1},ToString:function(t){return"当前值是近"+t[0]+"周期的最大值"}}],["LOWRANGE",{Name:"LOWRANGE",Param:{Count:1},ToString:function(t){return"当前值是近"+t[0]+"周期的最小值"}}],["FINDHIGH",{Name:"FINDHIGH",Param:{Count:4},ToString:function(t){return t[0]+"在"+t[1]+"日前的"+t[2]+"天内第"+t[3]+"个最高价"}}],["FINDHIGHBARS",{Name:"FINDHIGHBARS",Param:{Count:4},ToString:function(t){return t[0]+"在"+t[1]+"日前的"+t[2]+"天内第"+t[3]+"个最高价到当前周期的周期数"}}],["FINDLOW",{Name:"FINDLOW",Param:{Count:4},ToString:function(t){return t[0]+"在"+t[1]+"日前的"+t[2]+"天内第"+t[3]+"个最低价"}}],["FINDLOWBARS",{Name:"FINDLOWBARS",Param:{Count:2},ToString:function(t){return t[0]+"在"+t[1]+"日前的"+t[2]+"天内第"+t[3]+"个最低价到当前周期的周期数"}}],["SUM",{Name:"SUM",Param:{Count:2},ToString:function(t){return""+t[0]+t[1]+"日累加"}}],["MULAR",{Name:"MULAR",Param:{Count:2},ToString:function(t){return t[0]+"和"+t[1]+"日累乘"}}],["AMA",{Name:"AMA",Param:{Count:2},ToString:function(t){return"以"+t[1]+"为权重"+t[0]+"的自适应均线"}}],["TMA",{Name:"TMA",Param:{Count:3},ToString:function(t){return t[0]+"的"+t[1]+"日["+t[2]+"日权重]移动平均"}}],["CROSS",{Name:"CROSS",Param:{Count:2},ToString:function(t){return t[0]+"上穿"+t[1]}}],["LONGCROSS",{Name:"LONGCROSS",Param:{Count:3},ToString:function(t){return t[0]+"小于"+t[1]+"保持"+t[2]+"个交易日后交叉上穿"}}],["UPNDAY",{Name:"UPNDAY",Param:{Count:2},ToString:function(t){return"最近"+t[1]+"日"+t[0]+"连涨"}}],["DOWNNDAY",{Name:"DOWNNDAY",Param:{Count:2},ToString:function(t){return"最近"+t[1]+"日"+t[0]+"连跌"}}],["NDAY",{Name:"NDAY",Param:{Count:3},ToString:function(t){return"最近"+t[2]+"日"+t[0]+"一直大于"+t[1]}}],["EXIST",{Name:"EXIST",Param:{Count:2},ToString:function(t){return"最近"+t[1]+"日存在"+t[0]}}],["EXISTR",{Name:"EXISTR",Param:{Count:3},ToString:function(t){return"从前"+t[1]+"日到前"+t[2]+"日存在"+t[0]}}],["EVERY",{Name:"EVERY",Param:{Count:2},ToString:function(t){return"最近"+t[1]+"日一直存在"+t[0]}}],["LAST",{Name:"LAST",Param:{Count:3},ToString:function(t){return"从前"+t[1]+"日到前"+t[2]+"日持续"+t[0]}}],["NOT",{Name:"NOT",Param:{Count:1},ToString:function(t){return t[0]+"取反"}}],["IF",{Name:"IF",Param:{Count:3},ToString:function(t){return"如果"+t[0]+",返回"+t[1]+",否则返回"+t[2]}}],["IFF",{Name:"IFF",Param:{Count:3},ToString:function(t){return"如果"+t[0]+",返回"+t[1]+",否则返回"+t[2]}}],["IFN",{Name:"IFN",Param:{Count:3},ToString:function(t){return"如果"+t[0]+",返回"+t[1]+",否则返回"+t[2]}}],["IFC",{Name:"IFC",Param:{Count:3},ToString:function(t){return"如果"+t[0]+",返回"+t[1]+",否则返回"+t[2]}}],["TESTSKIP",{Name:"TESTSKIP",Param:{Count:1},ToString:function(t){return"如果满足条件"+t[0]+",公式返回"}}],["VALUEWHEN",{Name:"VALUEWHEN",Param:{Count:2},ToString:function(t){return"如果"+t[0]+",返回"+t[1]+",否则返回上个输出值 "}}],["MAX",{Name:"MAX",Param:{Count:2},ToString:function(t){return t[0]+"和"+t[1]+"的较大值"}}],["MIN",{Name:"MIN",Param:{Count:2},ToString:function(t){return t[0]+"和"+t[1]+"的较小值"}}],["ACOS",{Name:"ACOS",Param:{Count:1},ToString:function(t){return t[0]+"的反余弦"}}],["ASIN",{Name:"ASIN",Param:{Count:1},ToString:function(t){return t[0]+"的反正弦"}}],["ATAN",{Name:"ATAN",Param:{Count:1},ToString:function(t){return t[0]+"的反正切"}}],["COS",{Name:"COS",Param:{Count:1},ToString:function(t){return t[0]+"的余弦"}}],["SIN",{Name:"SIN",Param:{Count:1},ToString:function(t){return t[0]+"的正弦"}}],["TAN",{Name:"TAN",Param:{Count:1},ToString:function(t){return t[0]+"的正切"}}],["EXP",{Name:"EXP",Param:{Count:1},ToString:function(t){return t[0]+"的指数"}}],["LN",{Name:"LN",Param:{Count:1},ToString:function(t){return t[0]+"的自然对数"}}],["LOG",{Name:"LOG",Param:{Count:1},ToString:function(t){return t[0]+"的对数"}}],["SQRT",{Name:"SQRT",Param:{Count:1},ToString:function(t){return t[0]+"的开方"}}],["ABS",{Name:"ABS",Param:{Count:1},ToString:function(t){return t[0]+"的绝对值"}}],["POW",{Name:"POW",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"乘幂"}}],["CEILING",{Name:"CEILING",Param:{Count:1},ToString:function(t){return t[0]+"的向上舍入"}}],["FLOOR",{Name:"FLOOR",Param:{Count:1},ToString:function(t){return t[0]+"的向上舍入"}}],["INTPART",{Name:"INTPART",Param:{Count:1},ToString:function(t){return t[0]+"的整数部分"}}],["BETWEEN",{Name:"BETWEEN",Param:{Count:3},ToString:function(t){return t[0]+"位于"+t[1]+"和"+t[2]+"之间"}}],["FRACPART",{Name:"FRACPART",Param:{Count:1},ToString:function(t){return t[0]+"的小数部分"}}],["ROUND",{Name:"ROUND",Param:{Count:1},ToString:function(t){return"对"+t[0]+"(进行)四舍五入"}}],["ROUND2",{Name:"ROUND2",Param:{Count:2},ToString:function(t){return"对"+t[0]+"(进行)四舍五入"}}],["SIGN",{Name:"SIGN",Param:{Count:1},ToString:function(t){return t[0]+"的符号"}}],["MOD",{Name:"MOD",Param:{Count:2},ToString:function(t){return t[0]+"关于"+t[1]+"的模"}}],["RAND",{Name:"RAND",Param:{Count:1},ToString:function(t){return"随机正整数"}}],["AVEDEV",{Name:"AVEDEV",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日平均绝对偏差"}}],["DEVSQ",{Name:"DEVSQ",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日数据偏差平方和"}}],["FORCAST",{Name:"FORCAST",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日线性回归预测值"}}],["TSMA",{Name:"TSMA",Param:{Count:2},ToString:function(t){return t[0]+"在"+t[1]+"个周期内的时间序列三角移动平均"}}],["SLOPE",{Name:"SLOPE",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日线性回归斜率"}}],["STD",{Name:"STD",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日估算标准差"}}],["STDP",{Name:"STDP",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日总体标准差"}}],["STDDEV",{Name:"STDDEV",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日标准偏差"}}],["VAR",{Name:"VAR",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日估算样本方差"}}],["VARP",{Name:"VARP",Param:{Count:2},ToString:function(t){return t[0]+"的"+t[1]+"日总体样本方差"}}],["COVAR",{Name:"COVAR",Param:{Count:3},ToString:function(t){return t[0]+"和"+t[1]+"的"+t[2]+"周期的协方差"}}],["RELATE",{Name:"RELATE",Param:{Count:3},ToString:function(t){return t[0]+"和"+t[1]+"的"+t[0]+"周期的相关系数"}}],["BETA",{Name:"BETA",Param:{Count:1},ToString:function(t){return"β(Beta)系数"}}],["BETAEX",{Name:"BETAEX",Param:{Count:3},ToString:function(t){return t[0]+"和"+t[1]+"的"+t[2]+"周期的相关放大系数"}}],["COST",{Name:"COST",Param:{Count:1},ToString:function(t){return"获利盘为"+t[0]+"%的成本分布"}}],["WINNER",{Name:"WINNER",Param:{Count:1},ToString:function(t){return"以"+t[0]+"计算的获利盘比例"}}],["LWINNER",{Name:"LWINNER",Param:{Count:2},ToString:function(t){return"最近"+t[0]+"日那部分成本以"+t[1]+"价格卖出的获利盘比例"}}],["PWINNER",{Name:"PWINNER",Param:{Count:2},ToString:function(t){return t[0]+"日前那部分成本以"+t[1]+"价格卖出的获利盘比例"}}],["COSTEX",{Name:"COSTEX",Param:{Count:2},ToString:function(t){return"位于价格"+t[0]+"和"+t[1]+"间的成本"}}],["PPART",{Name:"PPART",Param:{Count:2},ToString:function(t){return t[0]+"日前那部分成本占总成本的比例"}}],["SAR",{Name:"SAR",Param:{Count:3},ToString:function(t){return"步长为"+t[1]+"极限值为"+t[0]+"的"+t[2]+"日抛物转向"}}],["SARTURN",{Name:"SARTURN",Param:{Count:3},ToString:function(t){return"步长为"+t[1]+"极限值为"+t[0]+"的"+t[2]+"日抛物转向点"}}],["CON2STR",{Name:"CON2STR",Param:{Count:2},ToString:function(t){return t[0]+"转为字符串"}}],["VAR2STR",{Name:"VAR2STR",Param:{Count:2},ToString:function(t){return t[0]+"转为字符串"}}],["STR2CON",{Name:"STR2CON",Param:{Count:1},ToString:function(t){return t[0]+"转为数字"}}],["STRLEN",{Name:"STRLEN",Param:{Count:1},ToString:function(t){return"得到"+t[0]+"字符串长度"}}],["STRCAT",{Name:"STRCAT",Param:{Count:2},ToString:function(t){return"字符串相加"}}],["VARCAT",{Name:"VARCAT",Param:{Count:2},ToString:function(t){return"字符串相加"}}],["STRSPACE",{Name:"STRSPACE",Param:{Count:1},ToString:function(t){return"字符串"+t[0]+"加一空格"}}],["SUBSTR",{Name:"SUBSTR",Param:{Count:3},ToString:function(t){return"字符串"+t[0]+"中取一部分"}}],["STRCMP",{Name:"STRCMP",Param:{Count:2},ToString:function(t){return"字符串"+t[0]+"和字符串"+t[1]+"比较"}}],["FINDSTR",{Name:"FINDSTR",Param:{Count:2},ToString:function(t){return"字符串"+t[0]+"中查找字符串"+t[1]}}],["NAMEINCLUD",{Name:"NAMEINCLUD",Param:{Count:1},ToString:function(t){return"查找品种名称中包含"+t[0]}}],["CODELIKE",{Name:"CODELIKE",Param:{Count:1},ToString:function(t){return"查找品种名称中包含"+t[0]}}],["INBLOCK",{Name:"AVEDEV",Param:{Count:1},ToString:function(t){return"属于"+t[0]+"板块"}}],["STKINDI",{Name:"STKINDI",Param:{Dynamic:!0},ToString:function(t){return"指标引用"}}],["HHVBARS",{Name:"HHVBARS",Param:{Count:2},ToString:function(t){return t[1]==0?"历史"+t[0]+"新高距今天数":t[1]+"日内"+t[0]+"新高距今天数"}}],["LLVBARS",{Name:"LLVBARS",Param:{Count:2},ToString:function(t){return t[1]==0?"历史"+t[0]+"新低距今天数":t[1]+"日内"+t[0]+"新低距今天数"}}]]),this.CallFunctionExplain=function(e,t,a){if(this.FUNCTION_INFO_LIST.has(e)){var s=this.FUNCTION_INFO_LIST.get(e);return s.Param.Dynamic===!0||s.Param.Count!=t.length&&this.ThrowUnexpectedNode(a,"函数"+e+"参数个数不正确. 需要"+s.Param.Count+"个参数"),s.ToString(t)}switch(e){case"CALCSTOCKINDEX":return"引用"+t[0]+"的"+t[1]+"指标第"+t[2]+"个输出值";case"PEAK":case"PEAKBARS":case"ZIG":case"ZIGA":case"TROUGH":case"TROUGHBARS":return this.GetZIGExplain(e,t);case"FINANCE":return this.GetFinanceExplain(t);case"DYNAINFO":return this.GetDynainfoExplain(t);case"CLOSE":case"C":case"VOL":case"V":case"OPEN":case"O":case"HIGH":case"H":case"LOW":case"L":case"AMOUNT":case"AMO":return this.GetOtherSymbolExplain({FunctionName:e,Args:t},a);case"PLOYLINE":return"当满足条件"+t[0]+"时以"+t[1]+"位置为顶点画折线连接";case"DRAWLINE":return"当满足条件"+t[0]+"时,在"+t[1]+"位置画直线起点，当满足条件"+t[2]+"时,在"+t[3]+"位置画直线终点,"+t[4]+"表示是否延长";case"DRAWSL":return"当满足条件"+t[0]+"时,在"+t[1]+"位置画斜线线性回归,"+t[2]+"斜率,"+t[3]+"长度,"+t[4]+"方向";case"DRAWKLINE":case"DRAWKLINE1":return"K线";case"DRAWICON":return"当满足条件"+t[0]+"时,在"+t[1]+"位置画"+t[2]+"号图标";case"DRAWTEXT":return"当满足条件"+t[0]+"时,在"+t[1]+"位置书写文字";case"DRAWTEXT_FIX":return"当满足条件"+t[0]+"时,在横轴"+t[1]+"纵轴"+t[2]+"位置书写文字";case"DRAWNUMBER":return"当满足条件"+t[0]+"时,在"+t[1]+"位置书写数字";case"DRAWNUMBER_FIX":return"当满足条件"+t[0]+"时,在横轴"+t[1]+"纵轴"+t[2]+"位置书写数字";case"RGB":return"自定色["+t[0]+","+t[1]+","+t[2]+"]";case"DRAWBAND":return"画带状线";case"DRAWRECTREL":return"相对位置上画矩形.";case"DRAWGBK":return"填充背景";case"STICKLINE":var o="";return t[4]==-1?o="虚线空心柱":t[4]==0?o="实心柱":o="实线空心柱","当满足条件"+t[0]+"时, 在"+t[1]+"和"+t[2]+"位置之间画柱状线,宽度为"+t[3]+","+o;default:this.ThrowUnexpectedNode(a,"函数"+e+"不存在")}},this.GetDynainfoExplain=function(e){var t=new Dt.default([[3,"前收盘价"],[4,"开盘价"],[5,"最高价"],[6,"最低价"],[7,"现价"],[8,"总量"],[9,"现量"],[10,"总金额"],[11,"均价"],[12,"日涨跌"],[13,"振幅"],[14,"涨幅"],[15,"开盘时的成交金额"],[16,"前5日每分钟均量"],[17,"量比"],[18,"上涨家数"],[19,"下跌家数"]]),a=e[0];return t.has(a)?t.get(a):"即时行情["+a+"]"},this.GetFinanceExplain=function(e){var t=new Dt.default([[1,"总股本"],[2,"市场类型"],[3,"沪深品种类型"],[4,"沪深行业代码"],[5,"B股"],[6,"H股"],[7,"流通股本[股]"],[8,"股东人数[户]"],[9,"资产负债率%"],[10,"总资产"],[11,"流动资产"],[12,"固定资产"],[13,"无形资产"],[15,"流动负债"],[16,"少数股东权益"]]),a=e[0];return t.has(a)?t.get(a):"财务数据["+a+"]"},this.GetZIGExplain=function(e,t){var a=t[0];switch(a==0?a="开盘价":a==1?a="最高价":a==2?a="最低价":a==3&&(a="收盘价"),e){case"PEAK":return a+"的"+t[1]+"%之字转向的前"+t[2]+"个波峰值";case"PEAKBARS":return a+"的"+t[1]+"5%之字转向的前"+t[2]+"个波峰位置";case"ZIG":return a+"的"+t[1]+"的之字转向";case"ZIGA":return a+"变化"+t[1]+"的之字转向";case"TROUGH":return a+"的"+t[1]+"%之字转向的前"+t[2]+"个波谷值";case"TROUGHBARS":return a+"的"+t[1]+"%之字转向的前"+t[2]+"个波谷位置"}},this.GetColorExplain=function(e){var t=new Dt.default([["COLORBLACK","黑色"],["COLORBLUE","蓝色"],["COLORGREEN","绿色"],["COLORCYAN","青色"],["COLORRED","红色"],["COLORMAGENTA","洋红色"],["COLORBROWN","棕色"],["COLORLIGRAY","淡灰色"],["COLORGRAY","深灰色"],["COLORLIBLUE","淡蓝色"],["COLORLIGREEN","淡绿色"],["COLORLICYAN","淡青色"],["COLORLIRED","淡红色"],["COLORLIMAGENTA","淡洋红色"],["COLORWHITE","白色"],["COLORYELLOW","黄色"]]);return t.has(e)?t.get(e):e.indexOf("COLOR")==0?"#"+e.substr(5):"rgb(30,144,255)"},this.GetLineWidthExplain=function(e){var t=parseInt(e.replace("LINETHICK",""));return c.IsPlusNumber(t)?t:1},this.SymbolPeriodExplain=function(e,t){var a=new Dt.default([["CLOSE","收盘价"],["C","收盘价"],["VOL","成交量"],["V","成交量"],["OPEN","开盘价"],["O","开盘价"],["HIGH","最高价"],["H","最高价"],["LOW","最低价"],["L","最低价"],["AMOUNT","成交金额"],["AMO","成交金额"],["VOLINSTK","持仓量"]]),s=new Dt.default([["MIN1","1分钟"],["MIN5","5分钟"],["MIN15","15分钟"],["MIN30","30分钟"],["MIN60","60分钟"],["DAY","日"],["WEEK","周"],["MONTH","月"],["SEASON","季"],["YEAR","年"],["WEEK2","双周"],["HALFYEAR","半年"]]),o=e;a.has(e)&&(o=a.get(e));var h=t;return s.has(t)&&(h=s.get(t)),o+"[取"+h+"数据]"},this.GetOtherSymbolExplain=function(e,t){var a=new Dt.default([["CLOSE","收盘价"],["C","收盘价"],["VOL","成交量"],["V","成交量"],["OPEN","开盘价"],["O","开盘价"],["HIGH","最高价"],["H","最高价"],["LOW","最低价"],["L","最低价"],["AMOUNT","成交金额"],["AMO","成交金额"],["VOLINSTK","持仓量"]]);if(e.FunctionName){var s=e.Args,o=a.get(e.FunctionName);return"["+s[0]+"]"+o}else if(e.Literal){var h=e.Literal.toUpperCase(),s=h.split("$");if(!a.has(s[1]))return"";var l=s[0],o=a.get(s[1]);return"["+l+"]"+o}},this.IsDrawFunction=function(e){var t=new Ee.default(["STICKLINE","DRAWTEXT","SUPERDRAWTEXT","DRAWLINE","DRAWBAND","DRAWKLINE","DRAWKLINE1","DRAWKLINE_IF","PLOYLINE","POLYLINE","DRAWNUMBER","DRAWNUMBER_FIX","DRAWICON","DRAWCHANNEL","PARTLINE","DRAWTEXT_FIX","DRAWGBK","DRAWTEXT_LINE","DRAWRECTREL","DRAWTEXTABS","DRAWOVERLAYLINE","FILLRGN","FILLRGN2","FILLTOPRGN","FILLBOTTOMRGN","FILLVERTICALRGN","FLOATRGN","DRAWSL","DRAWGBK2"]);return!!t.has(e)},this.VisitAssignmentExpression=function(e){var t=e.Left;t.Type!=vt.Identifier&&this.ThrowUnexpectedNode(e);var a=t.Name,s=e.Right,o=null;if(s.Type==vt.BinaryExpression||s.Type==vt.LogicalExpression)o=this.VisitBinaryExpression(s);else if(s.Type==vt.CallExpression)o=this.VisitCallExpression(s);else if(s.Type==vt.Literal)o=s.Value,c.IsString(o)&&s.Value.indexOf("$")>0&&(o=this.GetOtherSymbolExplain({Literal:o},e));else if(s.Type==vt.Identifier)o=this.ReadVariable(s.Name,s);else if(s.Type==vt.MemberExpression)o=this.ReadMemberVariable(s);else if(s.Type==vt.UnaryExpression)if(s.Operator=="-"){var h=this.GetNodeValue(s.Argument);o="-"+h}else o=s.Argument.Value;X.Complier.Log("[JSExplainer::VisitAssignmentExpression]",a," = ",o),this.VarTable.set(a,o)},this.ReadMemberVariable=function(e){var t=e.Object,a=e.Property,s=void 0;if(t.Type==vt.BinaryExpression||t.Type==vt.LogicalExpression)s=this.VisitBinaryExpression(t);else if(t.Type==vt.CallExpression)s=this.VisitCallExpression(t);else{if(a.Name.indexOf("#")>0)var o=a.Name.split("#"),h=t.Name+"的"+o[0]+"[周期"+o[1]+"]";else var h=t.Name+"的"+a.Name;return h}if(!s)return null;var h=s[a.Name];return h||null},this.VisitBinaryExpression=function(e){var t=[];t.push(e);for(var a=null;t.length!=0;)if(a=t[t.length-1],a.Left&&e!=a.Left&&e!=a.Right)t.push(a.Left);else if(a.Right&&e!=a.Right)t.push(a.Right);else{var s=t.pop();if(s.Type==vt.BinaryExpression){var o=this.GetNodeValue(s.Left),h=this.GetNodeValue(s.Right);X.Complier.Log("[JSExplainer::VisitBinaryExpression] BinaryExpression",s,o,h),s.Out=null,s.Out="("+o+" "+s.Operator+" "+h+")",o=="收盘价"&&h=="开盘价"?s.Operator==">"?s.Out="(收阳线)":s.Operator=="<"?s.Out="(收阴线)":s.Operator=="="&&(s.Out="(平盘)"):o=="开盘价"&&h=="收盘价"&&(s.Operator=="<"?s.Out="(收阳线)":s.Operator==">"?s.Out="(收阴线)":s.Operator=="="&&(s.Out="(平盘)")),X.Complier.Log("[JSExplainer::VisitBinaryExpression] BinaryExpression",s)}else if(s.Type==vt.LogicalExpression){var l=this.GetNodeValue(s.Left),u=this.GetNodeValue(s.Right);switch(X.Complier.Log("[JSExecute::VisitBinaryExpression] LogicalExpression",s,l,u),s.Out=null,s.Operator){case"&&":case"AND":s.Out="("+l+" 并且 "+u+")";break;case"||":case"OR":s.Out="("+l+" 或者 "+u+")";break}X.Complier.Log("[JSExplainer::VisitBinaryExpression] LogicalExpression",s)}e=a}return e.Out},this.GetNodeValue=function(e){switch(e.Type){case vt.Literal:return e.Value;case vt.UnaryExpression:if(e.Operator=="-"){var t=this.GetNodeValue(e.Argument);return"-"+t}return e.Argument.Value;case vt.Identifier:var a=this.ReadVariable(e.Name,e);return a;case vt.BinaryExpression:case vt.LogicalExpression:return e.Out;case vt.CallExpression:return this.VisitCallExpression(e);default:this.ThrowUnexpectedNode(e)}},this.ReadVariable=function(e,t){if(this.ConstVarTable.has(e)){var a=this.ConstVarTable.get(e);return a}if(zt.IsCustomVariant(e))return this.ReadCustomVariant(e,t);if(this.VarTable.has(e))return this.VarTable.get(e);if(e.indexOf("#")>0){var s=e.split("#");return this.SymbolPeriodExplain(s[0],s[1])}return this.ThrowUnexpectedNode(t,"变量"+e+"不存在"),e},this.ThrowUnexpectedNode=function(e,t){var a=e.Marker,s=t||"执行异常";return this.ErrorHandler.ThrowError(a.Index,a.Line,a.Column,s)},this.ThrowError=function(){}}function Qe(){}Qe.Tokenize=function(r){X.Complier.Log("[JSComplier.Tokenize]",r);var n=new gI(r),e=[];try{for(;;){var t=n.GetNextToken();if(!t)break;e.push(t)}}catch{}return e};Qe.Parse=function(r){X.Complier.Log("[JSComplier.Parse]",r);var n=new $h(r);n.Initialize();var e=n.ParseScript(),t=e;return t};Qe.Execute=function(r,n,e){var t=function(){try{n.Self&&(n.Self.Status=1),X.Complier.Log("[JSComplier.Execute]",r,n),X.Complier.Log("[JSComplier.Execute] parser .....");var s=new $h(r);s.Initialize();var o=s.ParseScript(),h=o;X.Complier.Log("[JSComplier.Execute] parser finish.",h),n.Self&&(n.Self.Status=2),X.Complier.Log("[JSComplier.Execute] execute .....");var l=new FI(h,n);l.ErrorCallback=e,l.JobList=s.Node.GetDataJobList(),n.ClassName=="ScriptIndexConsole"&&l.JobList.unshift({ID:K.JOB_DOWNLOAD_SYMBOL_DATA}),l.JobList.push({ID:K.JOB_RUN_SCRIPT}),n.Self&&(n.Self.Status=3);var u=l.Execute()}catch(f){X.Complier.Log(f),e&&e(f,n.CallbackParam),n.Self&&(n.Self.Status=0)}};t(),X.Complier.Log("[JSComplier.Execute] async execute.")};Qe.Explain=function(r,n,e){var t=function(){try{X.Complier.Log("[JSComplier.Explain]",r,n),X.Complier.Log("[JSComplier.Explain] parser .....");var s=new $h(r);s.Initialize();var o=s.ParseScript(),h=o;X.Complier.Log("[JSComplier.Explain] parser finish.",h),X.Complier.Log("[JSComplier.Explain] explain .....");var l=new EI(h,n);l.ErrorCallback=e,l.JobList=s.Node.GetDataJobList(),l.JobList.push({ID:K.JOB_RUN_SCRIPT});var u=l.Run()}catch(f){X.Complier.Log(f),e&&e(f,n.CallbackParam)}};t(),X.Complier.Log("[JSComplier.Explain] async explain.")};Qe.SetDomain=function(r,n){r&&(zt.Domain=r),n&&(zt.CacheDomain=n)};Qe.AddIcon=function(r){zt.CustomDrawIcon.Data.set(r.ID,r)};Qe.AddFunction=function(r){if(!(!r||!r.Name)){var n=r.Name.toUpperCase();zt.CustomFunction.Data.set(n,r)}};Qe.AddVariant=function(r){if(!(!r||!r.Name)){var n=r.Name.toUpperCase();zt.CustomVariant.Data.set(n,r)}};Qe.ColorVarToRGB=function(r){var n=new Dt.default([["COLORBLACK","rgb(0,0,0)"],["COLORBLUE","rgb(18,95,216)"],["COLORGREEN","rgb(25,158,0)"],["COLORCYAN","rgb(0,255,198)"],["COLORRED","rgb(238,21,21)"],["COLORMAGENTA","rgb(255,0,222)"],["COLORBROWN","rgb(149,94,15)"],["COLORLIGRAY","rgb(218,218,218)"],["COLORGRAY","rgb(133,133,133)"],["COLORLIBLUE","rgb(94,204,255)"],["COLORLIGREEN","rgb(183,255,190)"],["COLORLICYAN","rgb(154,255,242)"],["COLORLIRED","rgb(255,172,172)"],["COLORLIMAGENTA","rgb(255,145,241)"],["COLORWHITE","rgb(255,255,255)"],["COLORYELLOW","rgb(255,198,0)"]]);if(n.has(r))return n.get(r);if(r.indexOf("COLOR")==0){var e=r.substr(5);if(e.length!=6)return null;var t=e.substr(0,2),a=parseInt(t,16);t=e.substr(2,2);var s=parseInt(t,16);t=e.substr(4,2);var o=parseInt(t,16);return"rgb("+o+","+s+","+a+")"}if(r.indexOf("RGBX")==0){var e=r.substr(4);if(e.length!=6)return null;var t=e.substr(0,2),o=parseInt(t,16);t=e.substr(2,2);var s=parseInt(t,16);t=e.substr(4,2);var a=parseInt(t,16);return"rgb("+o+","+s+","+a+")"}return null};var wt={KLINE_ID:0,MINUTE_ID:2,HISTORY_MINUTE_ID:3,MULTIDAY_MINUTE_ID:4},Ei={OVERLAY_BARS:"OVERLAY_BARS",KLINE_TABLE:"KLINE_TABLE",SCATTER_PLOT:"SCATTER_PLOT"};function xI(){this.DataMap=new Dt.default,this.Add=function(r,n){this.DataMap.set(r,{MinuteFittingCallback:n.MinuteFittingCallback,KLineFittingCallback:n.KLineFittingCallback,CreateChartCallback:n.CreateChartCallback,FormatTitleCallback:n.FormatTitleCallback})},this.Get=function(r){return this.DataMap.has(r)?this.DataMap.get(r):null},this.Has=function(r){return this.DataMap.has(r)}}var Qi=new xI;function de(r,n,e,t){this.newMethod=$a,this.newMethod(r),delete this.newMethod,this.ClassName="ScriptIndex",this.Script=n,this.Arguments=[],this.OutVar=[],this.ID,this.FloatPrecision=2,this.StringFormat,this.KLineType=null,this.InstructionType,this.YSpecificMaxMin=null,this.YSplitScale=null,this.Condition=null,this.OutName=null,this.YSplitType,this.IsLocked=!1,this.LockCallback=null,this.LockID=null,this.LockBG=null,this.LockTextColor=null,this.LockText=null,this.LockFont=null,this.LockCount=20,this.LockMinWidth=null,this.TitleFont=m.TitleFont,this.IsShortTitle=!1,this.IsUsePageData=!1,this.Debug,this.IsSync=!1,this.IsShow=!0,t&&(t.FloatPrecision>=0&&(this.FloatPrecision=t.FloatPrecision),t.StringFormat>0&&(this.StringFormat=t.StringFormat),t.ID&&(this.ID=t.ID),(t.KLineType>=0||t.KLineType===-1)&&(this.KLineType=t.KLineType),t.InstructionType&&(this.InstructionType=t.InstructionType),t.YSpecificMaxMin&&(this.YSpecificMaxMin=t.YSpecificMaxMin),t.YSplitScale&&(this.YSplitScale=t.YSplitScale),t.Condition&&(this.Condition=t.Condition),t.TitleFont&&(this.TitleFont=t.TitleFont),t.IsShortTitle&&(this.IsShortTitle=t.IsShortTitle),t.OutName&&(this.OutName=t.OutName),c.IsNumber(t.YSplitType)&&(this.YSplitType=t.YSplitType),c.IsBool(t.IsSync)&&(this.IsSync=t.IsSync),t.Debug&&c.IsPlusNumber(t.Debug.Count)&&t.Debug.Callback&&(this.Debug={Count:t.Debug.Count,Callback:t.Debug.Callback})),t&&t.Lock&&(t.Lock.IsLocked==!0&&(this.IsLocked=!0),t.Lock.Callback&&(this.LockCallback=t.Lock.Callback),t.Lock.ID&&(this.LockID=t.Lock.ID),t.Lock.BG&&(this.LockBG=t.Lock.BG),t.Lock.TextColor&&(this.LockTextColor=t.Lock.TextColor),t.Lock.Text&&(this.LockText=t.Lock.Text),t.Lock.Font&&(this.LockFont=t.Lock.Font),t.Lock.Count&&(this.LockCount=t.Lock.Count),t.Lock.MinWidth&&(this.LockMinWidth=t.Lock.MinWidth*V())),e&&(this.Arguments=e),this.CopyTo=function(a){a.FloatPrecision=this.FloatPrecision,a.StringFormat=this.StringFormat,a.KLineType=this.KLineType,a.InstructionType=this.InstructionType,a.Condition=this.Condition,a.TitleFont=this.TitleFont,a.IsShortTitle=this.IsShortTitle,a.OutName=this.OutName,a.Arguments=this.Arguments,a.Script=this.Script,a.Name=this.Name,a.ID=this.ID},this.SetLock=function(a){a.IsLocked==!0?(this.IsLocked=!0,a.Callback&&(this.LockCallback=a.Callback),a.ID&&(this.LockID=a.ID),a.BG&&(this.LockBG=a.BG),a.TextColor&&(this.LockTextColor=a.TextColor),a.Text&&(this.LockText=a.Text),a.Font&&(this.LockFont=a.Font),a.Count&&(this.LockCount=a.Count),a.MinWidth&&(this.LockMinWidth=a.MinWidth*V())):(this.IsLocked=!1,this.LockCallback=null,this.LockID=null,this.LockBG=null,this.LockTextColor=null,this.LockText=null,this.LockFont=null,this.LockCount=20)},this.ExecuteScript=function(a,s,o){this.OutVar=[];var h={HQChart:a,WindowIndex:s,HistoryData:o,Self:this},l=wt.KLINE_ID;a.ClassName==="MinuteChartContainer"||a.ClassName==="MinuteChartHScreenContainer"?a.DayCount>1?l=wt.MULTIDAY_MINUTE_ID:l=wt.MINUTE_ID:a.ClassName==="HistoryMinuteChartContainer"&&(l=wt.HISTORY_MINUTE_ID);var u={HQDataType:l,Symbol:a.Symbol,Name:a.Name,Data:o,SourceData:a.SourceData,Callback:this.RecvResultData,CallbackParam:h,Async:!0,MaxRequestDataCount:a.MaxRequestDataCount,MaxRequestMinuteDayCount:a.MaxRequestMinuteDayCount,Arguments:this.Arguments,Condition:this.Condition,IsBeforeData:a.IsBeforeData,IsApiPeriod:a.IsApiPeriod,DrawInfo:null,Self:this};if(this.Debug&&c.IsPlusNumber(this.Debug.Count)&&this.Debug.Callback&&(--this.Debug.Count,u.Debug=1,u.DebugFilter=this.Debug.Callback),a&&a.ChartPaint[0]){var f=a.ChartPaint[0];f&&f.DrawKRange&&(u.DrawInfo={Start:f.DrawKRange.Start,End:f.DrawKRange.End})}if(l===wt.HISTORY_MINUTE_ID&&(u.TrateDate=a.TradeDate),l===wt.MULTIDAY_MINUTE_ID&&(u.DayCount=a.DayCount),a.NetworkFilter&&(u.NetworkFilter=a.NetworkFilter),this.Condition&&!this.IsMeetCondition(h,u)){this.ShowConditionError(h,this.Condition.Message);return}var C=this.Script;Qe.Execute(C,u,a.ScriptErrorCallback)},this.IsMeetCondition=function(a,s){return X.Complier.Log("[ScriptIndex::IsMeetCondition] ",this.Condition),!(this.Condition.Period&&(!this.IsMeetPeriodCondition(a,s)||!this.IsMeetIncludeCondition(a,s)))},this.IsMeetPeriodCondition=function(a,s){if(!this.Condition.Period)return!0;for(var o in this.Condition.Period){var h=this.Condition.Period[o];switch(h){case se.MINUTE_ID:if(s.HQDataType==wt.MINUTE_ID)return!0;break;case se.MULTIDAY_MINUTE_ID:if(s.HQDataType==wt.MULTIDAY_MINUTE_ID)return!0;break;case se.KLINE_DAY_ID:case se.KLINE_WEEK_ID:case se.KLINE_MONTH_ID:case se.KLINE_YEAR_ID:case se.KLINE_TWOWEEK_ID:case se.KLINE_QUARTER_ID:case se.KLINE_MINUTE_ID:case se.KLINE_5_MINUTE_ID:case se.KLINE_15_MINUTE_ID:case se.KLINE_30_MINUTE_ID:case se.KLINE_60_MINUTE_ID:if(a.HQChart.Period==h)return!0;break}}return!1},this.IsMeetIncludeCondition=function(a,s){if(!this.Condition.Include||this.Condition.Include.length<=0)return!0;var o=a.HQChart.Symbol;o&&(o=o.toUpperCase());for(var h in this.Condition.Include){var l=this.Condition.Include[h];if(o==l)return!0}return!1},this.ShowConditionError=function(a,s){var o=a.HQChart,h=a.WindowIndex;o.DeleteIndexPaint(h),h==0&&o.ShowKLine(!0);var l="指标不支持当前品种或周期";s&&(l=s);var u=new Ye;u.Canvas=o.Canvas,u.ChartBorder=o.Frame.SubFrame[h].Frame.ChartBorder,u.ChartFrame=o.Frame.SubFrame[h].Frame,u.NotSupportMessage=l,o.ChartPaint.push(u),o.UpdataDataoffset(),o.UpdateFrameMaxMin(),o.Draw()},this.RecvResultData=function(a,s){var o=s.HQChart,h=s.WindowIndex,l=s.HistoryData;if(s.Self.OutVar=a,s.Self.BindData(o,h,l),s.Self.IsLocked==!1)s.HQChart.Frame.SubFrame[h].Frame.SetLock(null);else{var u={IsLocked:!0,Callback:s.Self.LockCallback,IndexName:s.Self.Name,ID:s.Self.LockID,BG:s.Self.LockBG,Text:s.Self.LockText,TextColor:s.Self.LockTextColor,Font:s.Self.LockFont,Count:s.Self.LockCount,MinWidth:s.Self.LockMinWidth};s.HQChart.Frame.SubFrame[h].Frame.SetLock(u)}if(s.HQChart.UpdataDataoffset(),s.HQChart.UpdateFrameMaxMin(),s.Self.IsSync===!1&&s.HQChart.Draw(),o.GetIndexEvent){var f=o.GetIndexEvent();if(f){var C=s.Self,D={OutVar:C.OutVar,WindowIndex:h,Name:C.Name,Arguments:C.Arguments,HistoryData:l,Stock:{Symbol:o.Symbol,Name:o.Name}};f.Callback(f,D,C)}}},this.SetChartIndexName=function(a){this.Name?a.IndexName=this.Name:this.ID&&a.IndexName==this.ID,a.Script=this},this.ReloadChartResource=function(a,s,o){var h=a.GetEventCallback(et.ON_RELOAD_INDEX_CHART_RESOURCE);if(!(!h||!h.Callback)){var l={Chart:o,IndexName:this.Name,IndexID:this.ID,HQChart:a,WindowIndex:s};h.Callback(h,l,this)}},this.CreateLine=function(a,s,o,h,l){if(l==7)var u=new Ko;else var u=new Ye;if(u.Canvas=a.Canvas,u.DrawType=1,u.Name=o.Name,u.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,u.ChartFrame=a.Frame.SubFrame[s].Frame,u.Identify=this.Guid,o.Color?u.Color=this.GetColor(o.Color):u.Color=this.GetDefaultColor(h),l==8&&(u.DrawType=2,u.BreakPoint=o.BreakPoint),o.LineWidth){var f=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(f)&&f>0&&(u.LineWidth=f)}o.IsDotLine&&(u.IsDotLine=!0),o.IsShow==!1&&(u.IsShow=!1);var C=s+1;u.Data.Data=o.Data,this.ReloadChartResource(a,s,u),o.IsShowTitle===!1||c.IsString(o.Name)&&o.Name.indexOf("NOTEXT")==0||(o.NoneName?a.TitlePaint[C].Data[h]=new kt(u.Data,null,u.Color):a.TitlePaint[C].Data[h]=new kt(u.Data,o.Name,u.Color),a.TitlePaint[C].Data[h].ChartClassName=u.ClassName),this.SetChartIndexName(u),a.ChartPaint.push(u)},this.CreateArea=function(a,s,o,h){var l=new $T;if(l.Canvas=a.Canvas,l.DrawType=1,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Identify=this.Guid,o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),o.DownColor?l.AreaColor=o.DownColor:o.UpColor&&(l.AreaColor=o.UpColor,l.AreaDirection=1),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));c.IsPlusNumber(u)&&(l.LineWidth=u)}c.IsNonEmptyArray(o.LineDash)&&(l.LineDash=o.LineDash),o.IsShow==!1&&(l.IsShow=!1);var f=s+1;l.Data.Data=o.Data,o.IsShowTitle===!1||c.IsString(o.Name)&&o.Name.indexOf("NOTEXT")==0||(o.NoneName?a.TitlePaint[f].Data[h]=new kt(l.Data,null,l.Color):a.TitlePaint[f].Data[h]=new kt(l.Data,o.Name,l.Color),a.TitlePaint[f].Data[h].ChartClassName=l.ClassName),this.SetChartIndexName(l),a.ChartPaint.push(l)},this.CreateOverlayLine=function(a,s,o,h,l){if(l==7)var u=new Ko;var u=new CC;if(u.Canvas=a.Canvas,u.DrawType=1,u.Name=o.Name,u.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,u.ChartFrame=a.Frame.SubFrame[s].Frame,o.Color?u.Color=this.GetColor(o.Color):u.Color=this.GetDefaultColor(h),o.LineWidth){var f=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(f)&&f>0&&(u.LineWidth=f)}o.IsDotLine&&(u.IsDotLine=!0),o.IsShow==!1&&(u.IsShow=!1);var C=s+1;u.Data.Data=o.Data,a.TitlePaint[C].Data[h]=new kt(u.Data,o.Name,u.Color),a.TitlePaint[C].Data[h].ChartClassName=u.ClassName,a.ChartPaint.push(u)},this.CreateBar=function(a,s,o,h){var l=new mC;l.Canvas=a.Canvas,o.Draw.Width>0?l.Width=o.Draw.Width:l.Width=0,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),l.Data.Data=o.Draw.DrawData,l.BarType=o.Draw.Type,this.SetChartIndexName(l),a.ChartPaint.push(l)},this.CreateText=function(a,s,o,h,l){var u=new Fi;u.Canvas=a.Canvas,u.Name=o.Name,u.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,u.ChartFrame=a.Frame.SubFrame[s].Frame,u.ReloadResource(),o.Color?u.Color=this.GetColor(o.Color):u.Color=this.GetDefaultColor(h),o.IsDrawCenter===!0&&(u.TextAlign="center"),o.IsDrawAbove===!0&&(u.Direction=1),o.IsDrawBelow===!0&&(u.Direction=2),o.Draw.Position&&(u.Position=o.Draw.Position),o.Draw.DrawData&&(u.Data.Data=o.Draw.DrawData),u.Text=o.Draw.Text,o.Draw.Direction>0&&(u.Direction=o.Draw.Direction),o.Draw.YOffset>0&&(u.YOffset=o.Draw.YOffset),o.Draw.TextAlign&&(u.TextAlign=o.Draw.TextAlign),o.DrawVAlign>=0&&(o.DrawVAlign==0?u.Direction=1:o.DrawVAlign==1?u.Direction=0:o.DrawVAlign==2&&(u.Direction=2)),o.DrawAlign>=0&&(o.DrawAlign==0?u.TextAlign="left":o.DrawAlign==1?u.TextAlign="center":o.DrawAlign==2&&(u.TextAlign="right")),o.DrawFontSize>0&&(u.FixedFontSize=o.DrawFontSize),o.Background&&(u.TextBG=o.Background),a.ChartPaint.push(u)},this.CreateDrawNumber=function(a,s,o,h){var l=new ed;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.ReloadResource(),o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),o.IsDrawCenter===!0&&(l.TextAlign="center"),o.IsDrawAbove===!0&&(l.TextBaseline="bottom"),o.IsDrawBelow===!0&&(l.TextBaseline="top"),l.Data.Data=o.Draw.DrawData.Value,l.Text=o.Draw.DrawData.Text,o.Draw.Direction>0&&(l.Direction=o.Draw.Direction),o.Draw.YOffset>0&&(l.YOffset=o.Draw.YOffset),o.Draw.TextAlign&&(l.TextAlign=o.Draw.TextAlign),o.Draw.FixedPosition==="TOP"?l.FixedPosition=1:o.Draw.FixedPosition==="BOTTOM"&&(l.FixedPosition=2),o.DrawVAlign>=0&&(o.DrawVAlign==0?l.TextBaseline="top":o.DrawVAlign==1?l.TextBaseline="middle":o.DrawVAlign==2&&(l.TextBaseline="bottom")),o.DrawAlign>=0&&(o.DrawAlign==0?l.TextAlign="left":o.DrawAlign==1?l.TextAlign="center":o.DrawAlign==2&&(l.TextAlign="right")),o.DrawFontSize>0&&(l.FixedFontSize=o.DrawFontSize),o.Background&&(l.TextBG=o.Background),o.VerticalLine&&(l.VerticalLine=o.VerticalLine),a.ChartPaint.push(l)},this.CreateDrawTextV2=function(a,s,o,h){var l=new Vh;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.ReloadResource(),o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),o.IsDrawCenter===!0&&(l.TextAlign="center"),o.IsDrawAbove===!0&&(l.TextBaseline="bottom"),o.IsDrawBelow===!0&&(l.TextBaseline="top"),o.Draw.DrawData&&(l.Data.Data=o.Draw.DrawData),l.Text=o.Draw.Text,o.Draw.Direction>0&&(l.Direction=o.Draw.Direction),o.Draw.YOffset>0&&(l.YOffset=o.Draw.YOffset),o.Draw.TextAlign&&(l.TextAlign=o.Draw.TextAlign),o.Draw.FixedPosition==="TOP"?l.FixedPosition=1:o.Draw.FixedPosition==="BOTTOM"&&(l.FixedPosition=2),o.DrawVAlign>=0&&(o.DrawVAlign==0?l.TextBaseline="top":o.DrawVAlign==1?l.TextBaseline="middle":o.DrawVAlign==2&&(l.TextBaseline="bottom")),o.DrawAlign>=0&&(o.DrawAlign==0?l.TextAlign="left":o.DrawAlign==1?l.TextAlign="center":o.DrawAlign==2&&(l.TextAlign="right")),o.DrawFontSize>0&&(l.FixedFontSize=o.DrawFontSize),o.Background&&(l.TextBG=o.Background),o.VerticalLine&&(l.VerticalLine=o.VerticalLine),c.IsNumber(o.YOffset)&&(l.ShowOffset.Y=o.YOffset),c.IsNumber(o.XOffset)&&(l.ShowOffset.X=o.XOffset),a.ChartPaint.push(l)},this.CreateMACD=function(a,s,o,h){var l=new Or;if(l.Canvas=a.Canvas,l.Identify=this.Guid,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(l.LineWidth=u)}var f=s+1;l.Data.Data=o.Data;var C=this.GetDefaultColor(h);o.Color&&(C=this.GetColor(o.Color)),o.UpColor&&(l.UpColor=o.UpColor),o.DownColor&&(l.DownColor=o.DownColor),this.ReloadChartResource(a,s,l),a.TitlePaint[f].Data[h]=new kt(l.Data,o.Name,C),this.SetChartIndexName(l),a.ChartPaint.push(l)},this.CreatePointDot=function(a,s,o,h,l){var u=new vC;if(u.Canvas=a.Canvas,u.Name=o.Name,u.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,u.ChartFrame=a.Frame.SubFrame[s].Frame,o.Color?u.Color=this.GetColor(o.Color):u.Color=this.GetDefaultColor(h),o.Radius&&(u.Radius=o.Radius),o.LineWidth){var f=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(f)&&f>0&&(u.Radius=f)}c.IsBool(o.UpDownDot)&&(u.EnableUpDownColor=o.UpDownDot,u.HistoryData=l);var C=s+1;u.Data.Data=o.Data,a.TitlePaint[C].Data[h]=new kt(u.Data,o.Name,u.Color),a.ChartPaint.push(u)},this.CreateStick=function(a,s,o,h){var l=new bh;if(l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(l.LineWidth=u)}var f=s+1;l.Data.Data=o.Data,this.ReloadChartResource(a,s,l),a.TitlePaint[f].Data[h]=new kt(l.Data,o.Name,l.Color),this.SetChartIndexName(l),a.ChartPaint.push(l)},this.CreateLineStick=function(a,s,o,h){var l=new cC;if(l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(l.LineWidth=u)}var f=s+1;l.Data.Data=o.Data,a.TitlePaint[f].Data[h]=new kt(l.Data,o.Name,l.Color),a.ChartPaint.push(l)},this.CreateStraightLine=function(a,s,o,h){var l=new Ye;if(l.DrawType=1,l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(l.LineWidth=u)}var f=s+1;l.Data.Data=o.Draw.DrawData,o.Name=="DRAWLINE"&&(a.TitlePaint[f].Data[h]=new kt(l.Data,null,l.Color)),a.ChartPaint.push(l)},this.CreateVolStick=function(a,s,o,h,l){var u=new Gh;u.Canvas=a.Canvas,u.Name=o.Name,u.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,u.ChartFrame=a.Frame.SubFrame[s].Frame,u.KLineDrawType=a.KLineDrawType,u.Identify=this.Guid,o.Color?u.Color=this.GetColor(o.Color):u.Color=this.GetDefaultColor(h),o.UpColor&&(u.UpColor=o.UpColor),o.DownColor&&(u.DownColor=o.DownColor);var f=s+1;u.Data.Data=o.Data,u.HistoryData=l,this.ReloadChartResource(a,s,u),a.TitlePaint[f].Data[h]=new kt(u.Data,o.Name,u.Color),this.SetChartIndexName(u),a.ChartPaint.push(u)},this.CreateBand=function(a,s,o,h){var l=new gC;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.FirstColor=o.Draw.Color[0],l.SecondColor=o.Draw.Color[1],l.Data.Data=o.Draw.DrawData,a.ChartPaint.push(l)},this.CreateFillRGN=function(a,s,o,h){var l=new pC;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Data.Data=o.Draw.DrawData,o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),a.ChartPaint.push(l)},this.CreateFillRGN2=function(a,s,o,h){var l=new FC;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Data.Data=o.Draw.DrawData,a.ChartPaint.push(l)},this.CreateFillBGRGN=function(a,s,o,h){var l=new od;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Data.Data=o.Draw.DrawData,a.ChartPaint.push(l)},this.CreateFLOATRGN=function(a,s,o,h){var l=new sd;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Data.Data=o.Draw.DrawData,a.ChartPaint.push(l)},this.CreateKLine=function(a,s,o,h){var l=new gr;l.Canvas=a.Canvas,l.Name=o.Name,l.Identify=this.Guid,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Data.Data=o.Draw.DrawData,l.IsShowMaxMinPrice=!1,l.IsShowKTooltip=!1,o.Color&&(l.UnchagneColor=l.DownColor=l.UpColor=this.GetColor(o.Color)),a.ChartPaint.push(l)},this.CreateDrawColorKLine=function(a,s,o,h){var l=new _u;l.Canvas=a.Canvas,l.Name=o.Name,l.DrawName="DRAWCOLORKLINE",l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Data.Data=o.Draw.DrawData,c.IsBool(o.Draw.IsEmptyBar)&&(l.IsEmptyBar=o.Draw.IsEmptyBar),o.Draw.Color&&(l.Color=o.Draw.Color),a.ChartPaint.push(l)},this.CreatePolyLine=function(a,s,o,h){var l=new Ye;if(l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),o.IsDotLine&&(l.IsDotLine=!0),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(l.LineWidth=u)}var f=s+1;l.Data.Data=o.Draw.DrawData,a.TitlePaint[f].Data[h]=new kt(l.Data," ",l.Color),a.ChartPaint.push(l)},this.CreateChartSlopeLine=function(a,s,o,h){var l=new td;if(l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),o.IsDotLine&&(l.IsDotLine=!0),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(l.LineWidth=u)}var f=s+1;l.Data.Data=o.Draw.DrawData.Data,l.Option=o.Draw.DrawData.Option,a.TitlePaint[f].Data[h]=new kt(l.Data,null,l.Color),a.ChartPaint.push(l)},this.CreateChartVericaltLine=function(a,s,o,h){var l=new SC;if(l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(l.LineWidth=u)}this.SetChartLineDash(l,o.Draw.DrawData),l.Data.Data=o.Draw.DrawData.Data,a.ChartPaint.push(l)},this.SetChartLineDash=function(a,s){if(c.IsNumber(s.LineType)){var o=s.LineType,h=V();switch(o){case 1:a.LineType=[10*h,10*h];break;case 2:a.LineType=[0,10*h],a.LineCap="square";break;case 3:a.LineType=[10*h,3*h,3*h,3*h];break;case 4:a.LineType=[10*h,3*h,3*h,3*h,3*h,3*h];break}}else if(c.IsString(s.LineType)){for(var l=s.LineType.split(","),u=[],f=0;f<l.length;++f)u.push(parseInt(l[f]));a.LineType=u}},this.CreateChartHorizontalLine=function(a,s,o,h){var l=new TC;if(l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(l.LineWidth=u)}this.SetChartLineDash(l,o.Draw.DrawData),l.ExtendType=o.Draw.DrawData.Extend,l.Data.Data=o.Draw.DrawData.Data,a.ChartPaint.push(l)},this.CreateBackgroud=function(a,s,o,h){var l=new xC;if(l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Draw&&o.Draw.DrawData){var u=o.Draw.DrawData;l.Color=u.Color,l.ColorAngle=u.Angle,u.Data&&(l.Data.Data=u.Data)}a.ChartPaint.push(l)},this.CreateBackgroundDiv=function(a,s,o,h){var l=new hd;if(l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Draw&&o.Draw.DrawData){var u=o.Draw.DrawData;l.AryColor=u.AryColor,l.ColorType=u.ColorType,u.Data&&(l.Data.Data=u.Data)}a.ChartPaint.push(l)},this.CreateLineMultiData=function(a,s,o,h){var l=new dC;if(l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Draw&&o.Draw.DrawData){var u=o.Draw.DrawData;l.Color=u.Color,u.PointColor&&(l.PointColor=u.PointColor),c.IsPlusNumber(u.PointRadius)&&(l.PointRadius=u.PointRadius),c.IsPlusNumber(u.LineWidth)&&(l.LineWidth=u.LineWidth),u.Data&&(l.Data.Data=u.Data)}var f=s+1,C=new kt(l.Data,o.Name,l.Color);C.DataType="MULTI_POINT_LINE",a.TitlePaint[f].Data[h]=C,a.ChartPaint.push(l)},this.CreateTextLine=function(a,s,o,h){var l=new LC;if(l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Draw&&o.Draw.DrawData){var u=o.Draw.DrawData;l.Text=u.Text,l.Line=u.Line,l.Price=u.Price}a.ChartPaint.push(l)},this.CreateNumberText=function(a,s,o,h){var l=new Fi;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.ReloadResource(),l.TextAlign="center",o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),o.IsDrawAbove?l.Direction=1:l.Direction=2,o.Draw.Position&&(l.Position=o.Draw.Position),l.Data.Data=o.Draw.DrawData.Value,l.Text=o.Draw.DrawData.Text,a.ChartPaint.push(l)},this.CreateDrawText=function(a,s,o,h){var l=new Fi;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.ReloadResource(),o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),o.IsDrawAbove?l.Direction=1:l.Direction=0,o.DrawFontSize>0&&(l.TextFont=o.DrawFontSize*V()+"px 微软雅黑"),l.DrawData=o.Draw.DrawData,a.ChartPaint.push(l)},this.CreateIcon=function(a,s,o,h){var l=new Fi;l.Canvas=a.Canvas,l.TextAlign="center",l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Direction=2,o.IsDrawAbove&&(l.Direction=1),o.DrawVAlign>=0&&(o.DrawVAlign==0?l.Direction=1:o.DrawVAlign==1?l.Direction=0:o.DrawVAlign==2&&(l.Direction=2)),o.DrawAlign>=0&&(o.DrawAlign==0?l.TextAlign="left":o.DrawAlign==1?l.TextAlign="center":o.DrawAlign==2&&(l.TextAlign="right")),l.Data.Data=o.Draw.DrawData;var u=o.Draw.Icon;u.IconFont==!0?(l.IconFont={Family:u.Family,Text:u.Symbol,Color:u.Color},o.Color&&(l.IconFont.Color=this.GetColor(o.Color))):(l.Text=u.Symbol,o.Color?l.Color=this.GetColor(o.Color):u.Color?l.Color=u.Color:l.Color="rgb(0,0,0)"),o.DrawFontSize>0&&(l.FixedFontSize=o.DrawFontSize),c.IsNumber(o.XOffset)&&(l.ShowOffset.X=o.XOffset),c.IsNumber(o.YOffset)&&(l.ShowOffset.Y=o.YOffset),a.ChartPaint.push(l)},this.CreateTipIcon=function(a,s,o,h){var l=new Jo;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,a.ChartPaint[0].IsMinuteFrame()?l.Data=a.SourceData:l.Data=a.ChartPaint[0].Data,l.Family=o.Draw.Icon.Family,l.TextFont=m.TIPICON.TextFont;var u=m.TIPICON.Size,f=m.TIPICON.Color,C=0,D=2;if(c.IsNumber(o.YOffset)&&(C=o.YOffset),o.Color&&(f=this.GetColor(o.Color)),o.DrawFontSize>0&&(u=o.DrawFontSize),o.DrawVAlign>=0&&(D=o.DrawVAlign),o.Draw&&c.IsNonEmptyArray(o.Draw.DrawData)&&o.Draw.Icon){var v=o.Draw.DrawData,S=[],T=Array.isArray(o.Draw.Text),I=null;!T&&o.Draw.Text&&(I={Text:o.Draw.Text});for(var F=0;F<v.length;++F){var E=v[F];if(c.IsNumber(E)){var M={Index:F,Value:E,SVG:{Symbol:o.Draw.Icon.Symbol,Size:u,Color:f,YOffset:C,VAlign:D}};if(T){var O=o.Draw.Text[F];O&&(M.Tooltip={Text:O})}else M.Tooltip=I;S.push(M)}}l.Texts=S}a.ChartPaint.push(l)},this.CreateChannel=function(a,s,o,h){var l=new EC;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Draw.AreaColor?l.AreaColor=o.Draw.AreaColor:o.Color?l.AreaColor=this.GetColor(o.Color):l.AreaColor=this.GetDefaultColor(h),o.Draw.Border.Color?l.LineColor=o.Draw.Border.Color:l.LineColor=null,o.Draw.Border.Dotted&&(l.LineDotted=o.Draw.Border.Dotted),o.Draw.Border.Width>0&&(l.LineWidth=o.Draw.Border.Width),l.Data.Data=o.Draw.DrawData,a.ChartPaint.push(l)},this.CreatePartLine=function(a,s,o,h){var l=new DC;if(l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));c.IsPlusNumber(u)&&(l.LineWidth=u)}l.Data.Data=o.Draw.DrawData,this.SetChartIndexName(l),a.ChartPaint.push(l)},this.CreateMultiLine=function(a,s,o,h){var l=new AC;if(l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Data=a.ChartPaint[0].Data,l.Lines=o.Draw.DrawData,o.Draw.Name&&(l.Name=o.Draw.Name),o.Draw.LineDash&&(l.LineDash=o.Draw.LineDash),c.IsNumber(o.Draw.LineWidth)&&(l.LineWidth=o.Draw.LineWidth),o.Draw.Arrow){var u=o.Draw.Arrow;u.Start==!0&&(l.Arrow.Start=!0),u.End==!0&&(l.Arrow.End=!0),c.IsNumber(u.Angle)&&(l.ArrawAngle=u.Angle),c.IsNumber(u.Length)&&(l.ArrawLength=u.Length),c.IsNumber(u.LineWidth)&&(l.ArrawLineWidth=u.LineWidth)}a.ChartPaint.push(l);var f=s+1,C=new kt(l.Data,l.Name,null);C.DataType="ChartMultiLine",C.Lines=l.Lines,a.TitlePaint[f].Data[h]=C},this.CreateMultiPoint=function(a,s,o,h){var l=new NC;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Data=a.ChartPaint[0].Data,l.PointGroup=o.Draw.DrawData,o.Draw.Name&&(l.Name=o.Draw.Name),a.ChartPaint.push(l);var u=s+1,f=new kt(l.Data,l.Name,null);f.DataType="ChartMultiPoint",f.PointGroup=l.PointGroup,a.TitlePaint[u].Data[h]=f},this.CreateMultiBar=function(a,s,o,h){var l=new MC;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Data=a.ChartPaint[0].Data,l.Bars=o.Draw.DrawData;var u=s+1,f=new kt({KData:l.Data,BarData:l.Bars},o.Name,null);f.IsShow=!1,f.DataType="MULTI_BAR",a.TitlePaint[u].Data[h]=f,a.ChartPaint.push(l)},this.CreateMultiText=function(a,s,o,h){var l=new OC;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Data=a.ChartPaint[0].Data,l.Texts=o.Draw.DrawData,a.ChartPaint.push(l)},this.CreateMultiSVGIcon=function(a,s,o,h){var l=new RC;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Data=a.ChartPaint[0].Data,l.Family=o.Draw.DrawData.Family,l.Icon=o.Draw.DrawData.Icon,a.ChartPaint.push(l)},this.CreateChartDrawSVG=function(a,s,o,h){var l=new Jo;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,a.ChartPaint[0].IsMinuteFrame()?l.Data=a.SourceData:l.Data=a.ChartPaint[0].Data,c.IsBool(o.Draw.DrawData.EnableTooltip)&&(l.EnableTooltip=o.Draw.DrawData.EnableTooltip),c.IsBool(o.Draw.DrawData.IsDrawFirst)&&(l.IsDrawFirst=o.Draw.DrawData.IsDrawFirst),l.Family=o.Draw.DrawData.Family,l.TextFont=o.Draw.DrawData.TextFont,l.Texts=o.Draw.DrawData.Data,a.ChartPaint.push(l)},this.CreateMulitHtmlDom=function(a,s,o,h){var l=new yC;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.HQChart=a,l.Data=a.ChartPaint[0].Data,l.Texts=o.Draw.DrawData,l.DrawCallback=o.Draw.Callback,a.ChartPaint.push(l)},this.CreateStackedBar=function(a,s,o,h){var l=new PC;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.HQChart=a,l.Identify=this.Guid,l.Data.Data=o.Draw.DrawData,c.IsNonEmptyArray(o.Draw.BarColor)&&(l.BarColor=o.Draw.BarColor),c.IsNonEmptyArray(o.Draw.BarName)&&(l.BarName=o.Draw.BarName),c.IsNumber(o.Draw.LineWidth)&&(l.LineWidth=o.Draw.LineWidth),c.IsNumber(o.Draw.BarType)&&(l.BarType=o.Draw.BarType),a.ChartPaint.push(l);var u=s+1,f=new kt(l.Data,l.BarName,l.BarColor);f.DataType="ChartStackedBar",a.TitlePaint[u].Data[h]=f},this.CreateKLineTable=function(a,s,o,h){var l=new ZT;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.HQChart=a,l.Identify=this.Guid,l.Data.Data=o.Draw.DrawData,c.IsNumber(o.Draw.RowCount)&&(l.RowCount=o.Draw.RowCount),c.IsBool(o.Draw.IsShowRowName)&&(l.IsShowRowName=o.Draw.IsShowRowName),c.IsNonEmptyArray(o.Draw.RowName)&&(l.RowName=o.Draw.RowName),o.Draw.BGColor&&(l.BGColor=o.Draw.BGColor),a.ChartPaint.push(l);var u=s+1,f=new kt(l.Data,l.BarName,l.BarColor);f.DataType="ChartKLineTable",a.TitlePaint[u].Data[h]=f},this.CreateScatterPlot=function(a,s,o,h){var l=new qT;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.HQChart=a,l.Identify=this.Guid,l.Data.Data=o.Draw.DrawData,l.Color=o.Draw.Color,l.Radius=o.Draw.Radius,a.ChartPaint.push(l)},this.CreateColorKLine=function(a,s,o,h){var l=new _u;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Data=a.ChartPaint[0].Data,l.KLineColor=o.Draw.DrawData.KLine,o.Color&&(l.Color=o.Color),a.ChartPaint.push(l)},this.CreateRectangle=function(a,s,o,h){var l=new ld;l.Canvas=a.Canvas,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,l.Color=[o.Draw.DrawData.Color],l.Rect=o.Draw.DrawData.Rect,o.Color&&(l.BorderColor=this.GetColor(o.Color)),a.ChartPaint.push(l)},this.CreateScriptOverlayLine=function(a,s,o,h){var l=new jT;if(l.Canvas=a.Canvas,l.DrawType=1,l.Name=o.Name,l.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,l.ChartFrame=a.Frame.SubFrame[s].Frame,o.Color?l.Color=this.GetColor(o.Color):l.Color=this.GetDefaultColor(h),o.LineWidth){var u=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(u)&&u>0&&(l.LineWidth=u)}o.IsDotLine&&(l.IsDotLine=!0),o.IsShow==!1&&(l.IsShow=!1);var f=s+1;l.Data.Data=o.Draw.DrawData.Data,l.MainData.Data=o.Draw.DrawData.MainData,o.Draw.DrawData.Title&&(a.TitlePaint[f].Data[h]=new kt(l.Data,o.Draw.DrawData.Title,l.Color)),a.ChartPaint.push(l)},this.CreateSelfKLine=function(a,s,o){var h=new gr;h.Canvas=a.Canvas,h.Name="Self Kline",h.Identify=this.Guid,h.ChartBorder=a.Frame.SubFrame[s].Frame.ChartBorder,h.ChartFrame=a.Frame.SubFrame[s].Frame,h.Data=o,h.IsShowMaxMinPrice=!1,h.IsShowKTooltip=!1,h.DrawType=this.KLineType,a.ChartPaint.push(h)},this.BindInstructionData=function(a,s,o){if(!(this.OutVar==null||this.OutVar.length<0)){var h="";for(var l in this.Arguments){var u=this.Arguments[l];h.length>0&&(h+=","),h+=u.Value.toString()}if(h.length>0&&(h="("+h+")"),this.InstructionType==2){var f=this.OutVar[this.OutVar.length-1];return a.SetInstructionData(this.InstructionType,{Data:f.Data,Name:this.Name,Param:h,ID:this.ID}),!0}else if(this.InstructionType==1){var C,D;for(var v in this.OutVar){var S=this.OutVar[v];S.Name=="ENTERLONG"?C=S.Data:S.Name=="EXITLONG"&&(D=S.Data)}return a.SetInstructionData(this.InstructionType,{Buy:C,Sell:D,Name:this.Name,Param:h,ID:this.ID}),!0}}},this.BindData=function(a,s,o){if(s==0&&this.InstructionType){this.BindInstructionData(a,s,o);return}if(a.DeleteIndexPaint(s),s==0&&a.ShowKLine(!0),!(this.OutVar==null||this.OutVar.length<0)){this.KLineType!=null&&(this.KLineType===0||this.KLineType===1||this.KLineType===2?this.CreateSelfKLine(a,s,o):this.KLineType===-1&&s==0&&a.ShowKLine(!1)),s>=1&&a.Frame&&(a.Frame.SubFrame[s].Frame.YSplitOperator.FloatPrecision=this.FloatPrecision,this.YSpecificMaxMin&&(a.Frame.SubFrame[s].Frame.YSpecificMaxMin=this.YSpecificMaxMin),this.YSplitScale&&(a.Frame.SubFrame[s].Frame.YSplitScale=this.YSplitScale)),c.IsNumber(this.YSplitType)&&(a.Frame.SubFrame[s].Frame.YSplitOperator.SplitType=this.YSplitType);for(var h in this.OutVar){var l=this.OutVar[h];if(l.IsExData!==!0&&!(l.Type==1e3||l.Type==1001)){if(l.Type==0)l.IsOverlayLine?this.CreateOverlayLine(a,s,l,h,l.Type):this.CreateLine(a,s,l,h,l.Type);else if(l.Type==1)switch(l.Draw.DrawType){case"STICKLINE":this.CreateBar(a,s,l,h);break;case"DRAWTEXT":this.CreateDrawTextV2(a,s,l,h);break;case"SUPERDRAWTEXT":this.CreateText(a,s,l,h);break;case"DRAWLINE":this.CreateStraightLine(a,s,l,h);break;case"DRAWBAND":this.CreateBand(a,s,l,h);break;case"FILLRGN":this.CreateFillRGN(a,s,l,h);break;case"FILLRGN2":this.CreateFillRGN2(a,s,l,h);break;case"FILLTOPRGN":case"FILLBOTTOMRGN":case"FILLVERTICALRGN":this.CreateFillBGRGN(a,s,l,h);break;case"FLOATRGN":this.CreateFLOATRGN(a,s,l,h);break;case"DRAWKLINE":case"DRAWKLINE1":this.CreateKLine(a,s,l,h);break;case"DRAWCOLORKLINE":this.CreateDrawColorKLine(a,s,l,h);break;case"DRAWKLINE_IF":this.CreateKLine(a,s,l,h);break;case"POLYLINE":this.CreatePolyLine(a,s,l,h);break;case"DRAWGBK":case"DRAWGBK2":this.CreateBackgroud(a,s,l,h);break;case"DRAWGBK_DIV":this.CreateBackgroundDiv(a,s,l,h);break;case"DRAWTEXT_LINE":this.CreateTextLine(a,s,l,h);break;case"DRAWNUMBER":this.CreateDrawNumber(a,s,l,h);break;case"DRAWNUMBER_FIX":case"DRAWTEXT_FIX":this.CreateNumberText(a,s,l,h);break;case"DRAWICON":this.CreateIcon(a,s,l,h);break;case"ICON":this.CreateIcon(a,s,l,h);break;case"TIPICON":this.CreateTipIcon(a,s,l,h);break;case"DRAWCHANNEL":this.CreateChannel(a,s,l,h);break;case"PARTLINE":this.CreatePartLine(a,s,l,h);break;case"DRAWRECTREL":this.CreateRectangle(a,s,l,h);break;case"DRAWTEXTABS":case"DRAWTEXTREL":this.CreateDrawText(a,s,l,h);break;case"DRAWOVERLAYLINE":this.CreateScriptOverlayLine(a,s,l,h);break;case"DRAWSL":this.CreateChartSlopeLine(a,s,l,h);break;case"VERTLINE":this.CreateChartVericaltLine(a,s,l,h);break;case"HORLINE":this.CreateChartHorizontalLine(a,s,l,h);break;case"MULTI_LINE":this.CreateMultiLine(a,s,l,h);break;case"MULTI_POINT":this.CreateMultiPoint(a,s,l,h);break;case"MULTI_BAR":this.CreateMultiBar(a,s,l,h);break;case"MULTI_TEXT":this.CreateMultiText(a,s,l,h);break;case"MULTI_SVGICON":this.CreateMultiSVGIcon(a,s,l,h);break;case"DRAWSVG":this.CreateChartDrawSVG(a,s,l,h);break;case"MULTI_HTMLDOM":this.CreateMulitHtmlDom(a,s,l,h);break;case"COLOR_KLINE":this.CreateColorKLine(a,s,l,h);break;case"KLINE_BG":this.CreateBackgroud(a,s,l,h);break;case"MULTI_POINT_LINE":this.CreateLineMultiData(a,s,l,h);break;case Ei.OVERLAY_BARS:this.CreateStackedBar(a,s,l,h);break;case Ei.KLINE_TABLE:this.CreateKLineTable(a,s,l,h);break;case Ei.SCATTER_PLOT:this.CreateScatterPlot(a,s,l,h);break;default:{var u=Qi.Get(l.Draw.DrawType);u&&u.CreateChartCallback&&u.CreateChartCallback(a,s,l,h,this)}break}else l.Type==2?this.CreateMACD(a,s,l,h):l.Type==3?this.CreatePointDot(a,s,l,h,o):l.Type==4?this.CreateLineStick(a,s,l,h):l.Type==5?this.CreateStick(a,s,l,h):l.Type==6?this.CreateVolStick(a,s,l,h,o):l.Type==7?this.CreateLine(a,s,l,h,l.Type):l.Type==8?this.CreateLine(a,s,l,h,l.Type):l.Type==9&&this.CreateArea(a,s,l,h);var f=a.TitlePaint[s+1];f&&f.Data&&h<f.Data.length&&(this.StringFormat>0&&(f.Data[h].StringFormat=this.StringFormat),this.FloatPrecision>=0&&(f.Data[h].FloatPrecision=this.FloatPrecision),this.OutName&&this.OutName.length>0&&this.Arguments&&this.Arguments.length>0&&f.SetDynamicTitle(this.OutName,this.Arguments))}}var C=s+1;if(a.TitlePaint[C].Title=this.Name,a.TitlePaint[C].Identify=this.Guid,a.TitlePaint[C].ArgumentsText=null,a.TitlePaint[C].Script=this,!this.IsShortTitle){for(var D="",v=0;v<this.Arguments.length;++v){var S=this.Arguments[v];D.length>0&&(D+=","),D+=S.Value.toString()}D.length>0&&(a.TitlePaint[C].ArgumentsText="("+D+")")}return this.TitleFont&&(a.TitlePaint[C].Font=this.TitleFont),!0}},this.GetDefaultColor=function(a){var s=null;m&&m.Index&&m.Index.LineColor&&(s=m.Index.LineColor),(!s||!Array.isArray(s))&&(s=["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"]);var o=parseInt(a);return s[o%(s.length-1)]},this.GetColor=function(a){if(a.indexOf("RGB(")==0)return a.toLowerCase();if(a.indexOf("rgb(")==0)return a;if(a.indexOf("RGBA(")==0)return a.toLowerCase();if(a.indexOf("rgba(")==0)return a;var s=Qe.ColorVarToRGB(a);return s||"rgb(30,144,255)"}}function rn(r,n,e,t){this.newMethod=de,this.newMethod(r,n,e,t),delete this.newMethod,this.ClassName="OverlayScriptIndex",this.OverlayIndex=null,this.ShowConditionError=function(a,s){var o=a.HQChart;a.WindowIndex;var h="指标不支持当前品种或周期";s&&(h=s);var l=this.OverlayIndex,u=l.Frame;u.ChartPaint=[];var f=new Ye;f.Canvas=o.Canvas,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,f.NotSupportMessage=h,u.ChartPaint.push(f),o.Draw()},this.BindData=function(a,s,o){if(!(!this.OverlayIndex||this.OverlayIndex.IsOverlay!=!0)&&(this.OverlayIndex.Frame.ChartPaint=[],!!c.IsNonEmptyArray(this.OutVar))){c.IsNumber(this.YSplitType)&&(this.OverlayIndex.Frame.Frame.YSplitOperator.SplitType=this.YSplitType);var h={Data:[],Title:this.Name,Frame:this.OverlayIndex.Frame.Frame,Script:this},l="";for(var u in this.Arguments){var f=this.Arguments[u];l.length>0&&(l+=","),l+=f.Value.toString()}l.length>0&&(h.Title=this.Name+"("+l+")");var C=s+1,D=a.TitlePaint[C];D.OverlayIndex.set(this.OverlayIndex.Identify,h),this.OverlayIndex.Frame.Frame.Title=h.Title,this.OutName&&this.OutName.length>0&&this.Arguments&&this.Arguments.length>0&&D.SetDynamicTitle(this.OutName,this.Arguments,this.OverlayIndex.Identify);for(var u=0;u<this.OutVar.length;++u){var v=this.OutVar[u];if(v.IsExData!==!0){if(v.Type==0)this.CreateLine(a,s,v,u,v.Type);else if(v.Type==1)switch(v.Draw.DrawType){case"STICKLINE":this.CreateBar(a,s,v,u);break;case"DRAWTEXT":this.CreateDrawTextV2(a,s,v,u);break;case"SUPERDRAWTEXT":this.CreateText(a,s,v,u);break;case"DRAWLINE":this.CreateStraightLine(a,s,v,u);break;case"DRAWBAND":this.CreateBand(a,s,v,u);break;case"DRAWKLINE":this.CreateKLine(a,s,v,u);break;case"DRAWKLINE_IF":this.CreateKLine(a,s,v,u);break;case"POLYLINE":this.CreatePolyLine(a,s,v,u);break;case"DRAWNUMBER":case"DRAWNUMBER_FIX":case"DRAWTEXT_FIX":this.CreateNumberText(a,s,v,u);break;case"DRAWICON":this.CreateIcon(a,s,v,u);break;case"DRAWCHANNEL":this.CreateChannel(a,s,v,u);break;case"DRAWTEXT_LINE":this.CreateTextLine(a,s,v,u);break;case"VERTLINE":this.CreateChartVericaltLine(a,s,v,u);break;case"HORLINE":this.CreateChartHorizontalLine(a,s,v,u);break;case"MULTI_LINE":this.CreateMultiLine(a,s,v,u);break;case"MULTI_POINT":this.CreateMultiPoint(a,s,v,u);break;case"MULTI_BAR":this.CreateMultiBar(a,s,v,u);break;case"MULTI_TEXT":this.CreateMultiText(a,s,v,u);break;case"MULTI_SVGICON":this.CreateMultiSVGIcon(a,s,v,u);break;case"DRAWSVG":this.CreateChartDrawSVG(a,s,v,u);break;case"MULTI_HTMLDOM":this.CreateMulitHtmlDom(a,s,v,u);break;case"KLINE_BG":this.CreateBackgroud(a,s,v,u);break;case"PARTLINE":this.CreatePartLine(a,s,v,u);break;case Ei.OVERLAY_BARS:this.CreateStackedBar(a,s,v,u);break;default:{var S=Qi.Get(v.Draw.DrawType);S&&S.CreateChartCallback&&S.CreateChartCallback(a,s,v,u,this)}break}else v.Type==2?this.CreateMACD(a,s,v,u):v.Type==3?this.CreatePointDot(a,s,v,u,o):v.Type==4?this.CreateLineStick(a,s,v,u):v.Type==5?this.CreateStick(a,s,v,u):v.Type==6?this.CreateVolStick(a,s,v,u,o):v.Type==7?this.CreateLine(a,s,v,u,v.Type):v.Type==8&&this.CreateLine(a,s,v,u,v.Type);var T=h.Data[u];T&&this.FloatPrecision>=0&&(T.FloatPrecision=this.FloatPrecision)}}return!0}},this.RecvResultData=function(a,s){var o=s.HQChart,h=s.WindowIndex,l=s.HistoryData;s.Self.OutVar=a,s.Self.BindData(o,h,l),s.HQChart.UpdataDataoffset(),s.HQChart.UpdateFrameMaxMin(),s.HQChart.Draw();var u=o.GetOverlayIndexEvent();if(u){var f=s.Self,C={OutVar:f.OutVar,WindowIndex:h,Name:f.Name,Arguments:f.Arguments,HistoryData:l,Identify:f.OverlayIndex.Identify,Stock:{Symbol:o.Symbol,Name:o.Name}};u.Callback(u,C,f)}},this.ReloadChartResource=function(a,s,o){var h=a.GetEventCallback(et.ON_RELOAD_OVERLAY_INDEX_CHART_RESOURCE);if(!(!h||!h.Callback)){var l=this.OverlayIndex,u=l.Frame,f=u.Script,C={Chart:o,IndexName:f.Name,IndexID:f.ID,HQChart:a,WindowIndex:s,Guid:l.Identify};h.Callback(h,C,this)}},this.CreateLine=function(a,s,o,h,l){var u=this.OverlayIndex,f=u.Frame;if(l==7)var C=new Ko;else var C=new Ye;if(C.Canvas=a.Canvas,C.DrawType=1,C.Name=o.Name,C.ChartBorder=f.Frame.ChartBorder,C.ChartFrame=f.Frame,C.Identify=u.Identify,o.Color?C.Color=this.GetColor(o.Color):C.Color=this.GetDefaultColor(h),l==8&&(C.DrawType=2,C.BreakPoint=o.BreakPoint),o.LineWidth){var D=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(D)&&D>0&&(C.LineWidth=D)}o.IsShow==!1&&(C.IsShow=!1),C.Data.Data=o.Data,this.ReloadChartResource(a,s,C);var v=s+1,S=a.TitlePaint[v],T=new kt(C.Data,o.Name,C.Color);T.ChartClassName=C.ClassName,S.OverlayIndex.get(u.Identify).Data[h]=T,this.SetChartIndexName(C),f.ChartPaint.push(C)},this.CreateBar=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new mC;f.Canvas=a.Canvas,o.Draw.Width>0?f.Width=o.Draw.Width:f.Width=1,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(h),f.Data.Data=o.Draw.DrawData,this.SetChartIndexName(f),u.ChartPaint.push(f)},this.CreateDrawTextV2=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new Vh;f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,f.ReloadResource(),o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(h),o.IsDrawCenter===!0&&(f.TextAlign="center"),o.IsDrawAbove===!0&&(f.TextBaseline="bottom"),o.IsDrawBelow===!0&&(f.TextBaseline="top"),o.Draw.DrawData&&(f.Data.Data=o.Draw.DrawData),f.Text=o.Draw.Text,o.Draw.Direction>0&&(f.Direction=o.Draw.Direction),o.Draw.YOffset>0&&(f.YOffset=o.Draw.YOffset),o.Draw.TextAlign&&(f.TextAlign=o.Draw.TextAlign),o.Draw.FixedPosition==="TOP"?f.FixedPosition=1:o.Draw.FixedPosition==="BOTTOM"&&(f.FixedPosition=2),o.DrawVAlign>=0&&(o.DrawVAlign==0?f.TextBaseline="top":o.DrawVAlign==1?f.TextBaseline="middle":o.DrawVAlign==2&&(f.TextBaseline="bottom")),o.DrawAlign>=0&&(o.DrawAlign==0?f.TextAlign="left":o.DrawAlign==1?f.TextAlign="center":o.DrawAlign==2&&(f.TextAlign="right")),o.DrawFontSize>0&&(f.FixedFontSize=o.DrawFontSize),o.Background&&(f.TextBG=o.Background),o.VerticalLine&&(f.VerticalLine=o.VerticalLine),c.IsNumber(o.XOffset)&&(f.ShowOffset.X=o.XOffset),c.IsNumber(o.YOffset)&&(f.ShowOffset.Y=o.YOffset),u.ChartPaint.push(f)},this.CreateText=function(a,s,o,h,l){var u=this.OverlayIndex,f=u.Frame,C=new Fi;C.Canvas=a.Canvas,C.Name=o.Name,C.ChartBorder=f.Frame.ChartBorder,C.ChartFrame=f.Frame,C.Identify=u.Identify,C.ReloadResource(),o.Color?C.Color=this.GetColor(o.Color):C.Color=this.GetDefaultColor(h),o.Draw.Position&&(C.Position=o.Draw.Position),o.Draw.DrawData&&(C.Data.Data=o.Draw.DrawData),C.Text=o.Draw.Text,o.Draw.Direction>0&&(C.Direction=o.Draw.Direction),o.Draw.YOffset>0&&(C.YOffset=o.Draw.YOffset),o.Draw.TextAlign&&(C.TextAlign=o.Draw.TextAlign),f.ChartPaint.push(C)},this.CreateMACD=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new Or;f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify;var C=s+1;f.Data.Data=o.Data;var D=a.TitlePaint[C],v=this.GetDefaultColor(h);o.Color&&(v=this.GetColor(o.Color)),o.UpColor&&(f.UpColor=o.UpColor),o.DownColor&&(f.DownColor=o.DownColor),this.ReloadChartResource(a,s,f),D.OverlayIndex.get(l.Identify).Data[h]=new kt(f.Data,o.Name,v),u.ChartPaint.push(f)},this.CreatePointDot=function(a,s,o,h,l){var u=this.OverlayIndex,f=u.Frame,C=new vC;if(C.Canvas=a.Canvas,C.Name=o.Name,C.ChartBorder=f.Frame.ChartBorder,C.ChartFrame=f.Frame,C.Identify=u.Identify,o.Color?C.Color=this.GetColor(o.Color):C.Color=this.GetDefaultColor(h),o.Radius&&(C.Radius=o.Radius),o.LineWidth){var D=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(D)&&D>0&&(C.Radius=D)}c.IsBool(o.UpDownDot)&&(C.EnableUpDownColor=o.UpDownDot,C.HistoryData=l);var v=s+1;C.Data.Data=o.Data;var S=a.TitlePaint[v];S.OverlayIndex.get(u.Identify).Data[h]=new kt(C.Data,o.Name,C.Color),f.ChartPaint.push(C)},this.CreateStick=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new bh;if(f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(h),o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(C)&&C>0&&(f.LineWidth=C)}var D=s+1;f.Data.Data=o.Data,this.ReloadChartResource(a,s,f);var v=a.TitlePaint[D];v.OverlayIndex.get(l.Identify).Data[h]=new kt(f.Data,o.Name,f.Color),u.ChartPaint.push(f)},this.CreateLineStick=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new cC;if(f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(h),o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(C)&&C>0&&(f.LineWidth=C)}var D=s+1;f.Data.Data=o.Data;var v=a.TitlePaint[D];v.OverlayIndex.get(l.Identify).Data[h]=new kt(f.Data,o.Name,f.Color),u.ChartPaint.push(f)},this.CreateStraightLine=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new Ye;if(f.DrawType=1,f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(h),o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(C)&&C>0&&(f.LineWidth=C)}f.Data.Data=o.Draw.DrawData,u.ChartPaint.push(f)},this.CreateVolStick=function(a,s,o,h,l){var u=this.OverlayIndex,f=u.Frame,C=new Gh;C.Canvas=a.Canvas,C.Name=o.Name,C.ChartBorder=f.Frame.ChartBorder,C.ChartFrame=f.Frame,C.Identify=u.Identify,C.KLineDrawType=a.KLineDrawType,o.Color?C.Color=this.GetColor(o.Color):C.Color=this.GetDefaultColor(h),o.UpColor&&(C.UpColor=o.UpColor),o.DownColor&&(C.DownColor=o.DownColor);var D=s+1;C.Data.Data=o.Data,C.HistoryData=l,this.ReloadChartResource(a,s,C);var v=a.TitlePaint[D];v.OverlayIndex.get(u.Identify).Data[h]=new kt(C.Data,o.Name,C.Color),this.SetChartIndexName(C),f.ChartPaint.push(C)},this.CreateBand=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new gC;f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,f.FirstColor=o.Draw.Color[0],f.SecondColor=o.Draw.Color[1],f.Data.Data=o.Draw.DrawData,u.ChartPaint.push(f)},this.CreateKLine=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new gr;f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,f.Data.Data=o.Draw.DrawData,f.IsShowMaxMinPrice=!1,f.IsShowKTooltip=!1,o.Color&&(f.UnchagneColor=f.DownColor=f.UpColor=this.GetColor(o.Color)),u.ChartPaint.push(f)},this.CreatePolyLine=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new Ye;if(f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(h),o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(C)&&C>0&&(f.LineWidth=C)}var D=s+1;f.Data.Data=o.Draw.DrawData;var v=a.TitlePaint[D];v.OverlayIndex.get(l.Identify).Data[h]=new kt(line.Data," ",line.Color),u.ChartPaint.push(f)},this.CreateNumberText=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new Fi;f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,f.ReloadResource(),f.TextAlign="center",o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(h),o.IsDrawAbove?f.Direction=1:f.Direction=2,o.Draw.Position&&(f.Position=o.Draw.Position),f.Data.Data=o.Draw.DrawData.Value,f.Text=o.Draw.DrawData.Text,u.ChartPaint.push(f)},this.CreateTextLine=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new LC;if(f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,o.Draw&&o.Draw.DrawData){var C=o.Draw.DrawData;f.Text=C.Text,f.Line=C.Line,f.Price=C.Price}u.ChartPaint.push(f)},this.CreateStackedBar=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new PC;f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,c.IsNonEmptyArray(o.Draw.BarColor)&&(f.BarColor=o.Draw.BarColor),c.IsNonEmptyArray(o.Draw.BarName)&&(f.BarName=o.Draw.BarName),c.IsNumber(o.Draw.LineWidth)&&(f.LineWidth=o.Draw.LineWidth),c.IsNumber(o.Draw.BarType)&&(f.BarType=o.Draw.BarType),f.Data.Data=o.Draw.DrawData;var C=s+1,D=a.TitlePaint[C],v=new kt(f.Data,f.BarName,f.BarColor);v.DataType="ChartStackedBar",D.OverlayIndex.get(l.Identify).Data[h]=v,u.ChartPaint.push(f)},this.CreateIcon=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new Fi;f.Canvas=a.Canvas,f.TextAlign="center",f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,o.DrawVAlign>=0&&(o.DrawVAlign==0?f.Direction=1:o.DrawVAlign==1?f.Direction=0:o.DrawVAlign==2&&(f.Direction=2)),o.DrawAlign>=0&&(o.DrawAlign==0?f.TextAlign="left":o.DrawAlign==1?f.TextAlign="center":o.DrawAlign==2&&(f.TextAlign="right")),c.IsNumber(o.XOffset)&&(f.ShowOffset.X=o.XOffset),c.IsNumber(o.YOffset)&&(f.ShowOffset.Y=o.YOffset),f.Data.Data=o.Draw.DrawData;var C=o.Draw.Icon;C.IconFont==!0?f.IconFont={Family:C.Family,Text:C.Symbol,Color:C.Color}:(f.Text=C.Symbol,o.Color?f.Color=this.GetColor(o.Color):C.Color?f.Color=C.Color:f.Color="rgb(0,0,0)"),u.ChartPaint.push(f)},this.CreateChannel=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new EC;f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,o.Draw.AreaColor?f.AreaColor=o.Draw.AreaColor:o.Color?f.AreaColor=this.GetColor(o.Color):f.AreaColor=this.GetDefaultColor(h),o.Draw.Border.Color?f.LineColor=o.Draw.Border.Color:f.LineColor=null,o.Draw.Border.Dotted&&(f.LineDotted=o.Draw.Border.Dotted),o.Draw.Border.Width>0&&(f.LineWidth=o.Draw.Border.Width),f.Data.Data=o.Draw.DrawData,u.ChartPaint.push(f)},this.CreatePartLine=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new DC;if(f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));c.IsPlusNumber(C)&&(f.LineWidth=C)}f.Data.Data=o.Draw.DrawData,this.SetChartIndexName(f),u.ChartPaint.push(f)},this.CreateMultiLine=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new AC;if(f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,f.Data=a.ChartPaint[0].Data,f.Lines=o.Draw.DrawData,o.Draw.LineDash&&(f.LineDash=o.Draw.LineDash),c.IsNumber(o.Draw.LineWidth)&&(f.LineWidth=o.Draw.LineWidth),o.Draw.Arrow){var C=o.Draw.Arrow;C.Start==!0&&(f.Arrow.Start=!0),C.End==!0&&(f.Arrow.End=!0),c.IsNumber(C.Angle)&&(f.ArrawAngle=C.Angle),c.IsNumber(C.Length)&&(f.ArrawLength=C.Length),c.IsNumber(C.LineWidth)&&(f.ArrawLineWidth=C.LineWidth)}u.ChartPaint.push(f)},this.CreateMultiPoint=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new NC;f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,f.Data=a.ChartPaint[0].Data,f.PointGroup=o.Draw.DrawData,u.ChartPaint.push(f)},this.CreateBackgroud=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new xC;if(f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,o.Draw&&o.Draw.DrawData){var C=o.Draw.DrawData;f.Color=C.Color,f.ColorAngle=C.Angle,C.Data&&(f.Data.Data=C.Data)}u.ChartPaint.push(f)},this.CreateMultiBar=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new MC;f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,f.Data=a.ChartPaint[0].Data,f.Bars=o.Draw.DrawData;var C=s+1,D=a.TitlePaint[C],v=new kt({KData:f.Data,BarData:f.Bars},o.Name,null);v.IsShow=!1,v.DataType="MULTI_BAR",D.OverlayIndex.get(l.Identify).Data[h]=v,u.ChartPaint.push(f)},this.CreateMultiText=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new OC;f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,f.Data=a.ChartPaint[0].Data,f.Texts=o.Draw.DrawData,u.ChartPaint.push(f)},this.CreateMultiSVGIcon=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new RC;f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,f.Data=a.ChartPaint[0].Data,f.Family=o.Draw.DrawData.Family,f.Icon=o.Draw.DrawData.Icon,u.ChartPaint.push(f)},this.CreateChartDrawSVG=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new Jo;f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,a.ChartPaint[0].IsMinuteFrame()?f.Data=a.SourceData:f.Data=a.ChartPaint[0].Data,c.IsBool(o.Draw.DrawData.EnableTooltip)&&(f.EnableTooltip=o.Draw.DrawData.EnableTooltip),c.IsBool(o.Draw.DrawData.IsDrawFirst)&&(f.IsDrawFirst=o.Draw.DrawData.IsDrawFirst),f.Family=o.Draw.DrawData.Family,f.TextFont=o.Draw.DrawData.TextFont,f.Texts=o.Draw.DrawData.Data,u.ChartPaint.push(f)},this.CreateMulitHtmlDom=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new yC;f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,f.HQChart=a,f.Data=a.ChartPaint[0].Data,f.Texts=o.Draw.DrawData,f.DrawCallback=o.Draw.Callback,u.ChartPaint.push(f)},this.CreateChartVericaltLine=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new SC;if(f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,f.HQChart=a,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(h),o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(C)&&C>0&&(f.LineWidth=C)}this.SetChartLineDash(f,o.Draw.DrawData),f.Data.Data=o.Draw.DrawData.Data,u.ChartPaint.push(f)},this.CreateChartHorizontalLine=function(a,s,o,h){var l=this.OverlayIndex,u=l.Frame,f=new TC;if(f.Canvas=a.Canvas,f.Name=o.Name,f.ChartBorder=u.Frame.ChartBorder,f.ChartFrame=u.Frame,f.Identify=l.Identify,f.HQChart=a,o.Color?f.Color=this.GetColor(o.Color):f.Color=this.GetDefaultColor(h),o.LineWidth){var C=parseInt(o.LineWidth.replace("LINETHICK",""));!isNaN(C)&&C>0&&(f.LineWidth=C)}this.SetChartLineDash(f,o.Draw.DrawData),f.ExtendType=o.Draw.DrawData.Extend,f.Data.Data=o.Draw.DrawData.Data,u.ChartPaint.push(f)},this.CreateSelfKLine=function(a,s,o){var h=this.OverlayIndex,l=h.Frame,u=new gr;u.Canvas=a.Canvas,u.Name="Self Kline",u.ChartBorder=l.Frame.ChartBorder,u.ChartFrame=l.Frame,u.Identify=h.Identify,u.Data=o,u.IsShowMaxMinPrice=!1,u.IsShowKTooltip=!1,u.DrawType=this.KLineType,l.ChartPaint.push(u)},this.GetDefaultColor=function(a){var s=["rgb(24,71,178)","rgb(42,230,215)","rgb(252,96,154)","rgb(0,128,255)","rgb(229,0,79)","rgb(68,114,196)","rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)"],o=parseInt(a);return s[o%(s.length-1)]}}function Ma(r,n,e,t,a){a?this.newMethod=rn:this.newMethod=de,this.newMethod(r,n,e,t),delete this.newMethod,this.ClassName="APIScriptIndex",this.IsOverlayIndex=a==!0,this.ApiUrl,this.HQDataType,this.Version=1,t&&t.API&&(t.API.Url&&(this.ApiUrl=t.API.Url),t.API.Name&&(this.Name=this.ID=t.API.Name),t.API.ID&&(this.ID=t.API.ID),t.API.Version>0&&(this.Version=t.API.Version),t.API.IsUsePageData===!0&&(this.IsUsePageData=t.API.IsUsePageData)),this.Super_CopyTo=this.CopyTo,this.CopyTo=function(s){this.Super_CopyTo(s),s.ApiUrl=this.ApiUrl,s.Version=this.Version,s.IsOverlayIndex=this.IsOverlayIndex},this.RecvSubscribeData=function(s,o,h,l){this.Version==2?this.RecvAPIData2(s,o,h,l):this.RecvAPIData(s,o,h,l)},this.ExecuteScript=function(s,o,h){X.Complier.Log("[APIScriptIndex::ExecuteScript] name, Arguments ",this.Name,this.Arguments);var l=wt.KLINE_ID,u=null;s.ClassName==="MinuteChartContainer"||s.ClassName==="MinuteChartHScreenContainer"?(s.DayCount>1?l=wt.MULTIDAY_MINUTE_ID:l=wt.MINUTE_ID,u=h.GetDateRange()):s.ClassName==="HistoryMinuteChartContainer"?l=wt.HISTORY_MINUTE_ID:u=h.GetDateRange();var f=[];if(this.Arguments)for(var C in this.Arguments){var D=this.Arguments[C];f.push({name:D.Name,value:D.Value})}var v;s.GetRequestDataCount&&(v=s.GetRequestDataCount());var S=this,T={indexname:this.ID,symbol:s.Symbol,script:this.Script,args:f,period:s.Period,right:s.Right,hqdatatype:l};if(u&&(T.DateRange=u),v&&(T.maxdatacount=v.MaxRequestDataCount,T.maxminutedaycount=v.MaxRequestMinuteDayCount),(l==wt.MULTIDAY_MINUTE_ID||l==wt.MINUTE_ID)&&(T.daycount=s.DayCount),this.HQDataType=l,s.NetworkFilter){var I={Name:"APIScriptIndex::ExecuteScript",Explain:"指标计算",Request:{Url:S.ApiUrl,Type:"POST",Data:T},Self:this,HQChart:s,PreventDefault:!1};if(s.NetworkFilter(I,function(F){S.Version==2?S.RecvAPIData2(F,s,o,h):S.RecvAPIData(F,s,o,h)}),I.PreventDefault==!0)return}Lt.HttpRequest({url:S.ApiUrl,data:T,type:"post",dataType:"json",async:!0,success:function(E){S.RecvAPIData(E,s,o,h)},error:function(E){S.RecvError(E)}})},this.RecvAPIData2=function(s,o,h,l){if(X.Complier.Log("[APIScriptIndex::RecvAPIData2] recv data ",this.Name,s),this.HQDataType==wt.KLINE_ID?(this.OutVar=this.ConvertToLocalData(s,o),X.Complier.Log("[APIScriptIndex::RecvAPIData2] conver to OutVar ",this.OutVar)):this.HQDataType==wt.MINUTE_ID?(this.OutVar=this.ConvertToLocalData(s,o),X.Complier.Log("[APIScriptIndex::RecvAPIData2] conver to OutVar ",this.OutVar)):this.HQDataType==wt.MULTIDAY_MINUTE_ID&&(this.OutVar=this.ConvertToLocalData(s,o),X.Complier.Log("[APIScriptIndex::RecvAPIData2] conver to OutVar ",this.OutVar)),this.BindData(o,h,l),o.UpdataDataoffset(),o.UpdateFrameMaxMin(),o.Draw(),o.GetIndexEvent){var u=o.GetIndexEvent();if(u){var s={OutVar:this.OutVar,WindowIndex:h,Name:this.Name,Arguments:this.Arguments,HistoryData:l,Stock:{Symbol:o.Symbol,Name:o.Name}};u.Callback(u,s,this)}}},this.ConvertToLocalData=function(s,o){var h=s.OutVar;if(o.ClassName=="MinuteChartContainer"||o.ClassName=="MinuteChartHScreenContainer")var l=o.SourceData,u=l.GetAPIDataIndex(s.Date,s.Time);else{var l=o.ChartPaint[0].Data;if(k.IsDayPeriod(s.Period,!0))var u=l.GetAPIDataIndex(s.Date);else var u=l.GetAPIDataIndex(s.Date,s.Time)}var f=[];for(var C in h){var D=h[C],v={Type:D.Type,Name:D.Name};if(D.Type==0){v.Data=[];for(var S=0;S<u.length;++S){var T=u[S];T.Index<0?v.Data[S]=null:v.Data[S]=D.Data[T.Index]}v.Name&&v.Name.indexOf("@NODRAW@")>=0&&(v.Name=v.Name.replace("@NODRAW@",""))}else if(D.Type==1){v.Name=D.DrawType,v.Draw={DrawType:D.DrawType};var I=D.Draw;switch(D.DrawType){case"STICKLINE":{for(var F=[],S=0;S<u.length;++S){F[S]=null;var T=u[S],E=T.Index;if(!(E<0)){var M=I.Price[E],O=I.Price2[E];!c.IsNumber(M)||!c.IsNumber(O)||(F[S]={Value:M,Value2:O})}}v.Draw.DrawData=F,v.Draw.Width=I.Width,v.Draw.Type=I.Empty}break;case"DRAWTEXT":{for(var F=[],R=[],S=0;S<u.length;++S){F[S]=null;var T=u[S],E=T.Index;if(!(E<0)){var M=I.Price[E];if(c.IsNumber(M)&&(F[S]=M),Array.isArray(I.Text)){var D=I.Text[E];c.IsString(D)&&(R[S]=D)}}}Array.isArray(I.Text)?v.Draw.Text=R:v.Draw.Text=I.Text,v.Draw.DrawData=F}break;case"DRAWNUMBER":{for(var F={Value:[],Text:[]},S=0;S<u.length;++S){F.Value[S]=null,F.Text[S]=null;var T=u[S],E=T.Index;if(!(E<0)){var M=I.Price[E],b=I.Number[E];!c.IsNumber(M)||!c.IsNumber(b)||(F.Value[S]=M,F.Text[S]=b.toFixed(2))}}v.Draw.DrawData=F}break;case"DRAWBAND":{for(var F=[],S=0;S<u.length;++S){F[S]=null;var T=u[S],E=T.Index;if(!(E<0)){var M=I.Val1[E],O=I.Val2[E];!c.IsNumber(M)||!c.IsNumber(O)||(F[S]={Value:M,Value2:O})}}v.Draw.DrawData=F,v.Draw.Color=[null,null],I.Color1&&(v.Draw.Color[0]=I.Color1.toLowerCase()),I.Color2&&(v.Draw.Color[1]=I.Color2.toLowerCase())}break;case"DRAWKLINE":{for(var F=[],S=0;S<u.length;++S){var D={Open:null,High:null,Low:null,Close:null};F[S]=D;var T=u[S],E=T.Index;if(!(E<0)){var p=I.High[E],G=I.Low[E],Y=I.Open[E],Q=I.Close[E];c.IsPlusNumber(p)&&c.IsPlusNumber(G)&&c.IsPlusNumber(Y)&&c.IsPlusNumber(Q)&&(D.Open=Y,D.Close=Q,D.High=p,D.Low=G)}}v.Draw.DrawData=F}break;case"DRAWTEXT_FIX":{for(var F={Value:[],Text:[]},S=0;S<u.length;++S){F.Value[S]=0,F.Text[S]=null;var T=u[S],E=T.Index;if(!(E<0)){var ht=I.Cond[E];ht&&(F.Value[S]=1,F.Text[S]=I.Text)}}v.Draw.DrawData=F,v.Draw.Position={X:I.X,Y:I.Y,Type:I.Type}}break;case"DRAWNUMBER_FIX":{for(var F={Value:[],Text:[]},S=0;S<u.length;++S){F.Value[S]=null,F.Text[S]=null;var T=u[S],E=T.Index;if(!(E<0)){var Ct=I.Number[E];c.IsNumber(Ct)&&(F.Value[S]=Ct,F.Text[S]=c.RemoveZero(Ct.toFixed(2)))}}v.Draw.DrawData=F,v.Draw.Position={X:I.X,Y:I.Y,Type:I.Type}}break;case"DRAWICON":{var lt=zt.GetDrawIcon(I.Type);lt||zt.GetDrawTextIcon(I.Type),lt||(lt={Symbol:"🚩"}),v.Draw.Icon=lt;for(var F=[],S=0;S<u.length;++S){F[S]=null;var T=u[S],E=T.Index;if(!(E<0)){var Ct=I.Price[E];c.IsNumber(Ct)&&(F[S]=Ct)}}v.Draw.DrawData=F}break;case"PARTLINE":{for(var F=[],S=0;S<u.length;++S){F[S]={Value:null,RGB:null};var T=u[S],E=T.Index;if(!(E<0)){var dt=I.Color[E];if(c.IsString(dt)){var Ct=I.Price[E];c.IsNumber(Ct)&&(F[S].Value=Ct,F[S].RGB=dt)}}}v.Draw.DrawData=F}break;case"FILLRGN":{for(var F=[],S=0;S<u.length;++S){F[S]=null;var T=u[S],E=T.Index;if(!(E<0)){var dt=I.Color[E];if(c.IsString(dt)){var Ct=I.Price[E];if(c.IsNumber(Ct)){var Ut=I.Price2[E];c.IsNumber(Ut)&&(F[S]={Value:Ct,Value2:Ut,Color:dt})}}}}v.Draw.DrawData=F,v.Draw.DrawType="FILLRGN2"}break;default:continue}}else continue;for(var C in D.Attribute){var Wt=D.Attribute[C];switch(Wt){case"COLORSTICK":v.Type=2;break;case"POINTDOT":v.Radius=m.POINTDOT.Radius,v.Type=3;break;case"CIRCLEDOT":v.Radius=m.CIRCLEDOT.Radius,v.Type=3;break;case"DOTLINE":v.IsDotLine=!0;break;case"DRAWABOVE":v.IsDrawAbove=!0;break;case"LINESTICK":v.Type=4;break;case"STICK":v.Type=5;break;case"VOLSTICK":v.Type=6;break;case"LINEAREA":v.Type=9;break;case"NODRAW":v.IsShow=!1;break;case"NONE_OUT_NAME":v.NoneName=!0;break;case"NOTEXT":v.IsShowTitle=!1;break}Wt.indexOf("COLOR")==0?v.Color=Wt:Wt.indexOf("LINETHICK")==0&&(v.LineWidth=Wt)}f.push(v)}return f},this.RecvAPIData=function(s,o,h,l){if(X.Complier.Log("[APIScriptIndex::RecvAPIData] recv data ",this.Name,s),s.code==0){if(o.EnableVerifyRecvData&&(!s.stock||o.Symbol!=s.stock.symbol)){X.Chart.Warn("[APIScriptIndex::RecvAPIData] recv data symbol not match. HQChart["+o.Symbol+"]");return}if(s.error&&c.IsString(s.error.message)){var u={HQChart:o,WindowIndex:h,HistoryData:l,Self:this};this.ShowConditionError(u,s.error.message);return}if(s.outdata&&s.outdata.name&&(this.Name=s.outdata.name),s.outdata.args){this.Arguments=[];for(var f in s.outdata.args){var C=s.outdata.args[f];this.Arguments.push({Name:C.name,Value:C.value})}}if(this.HQDataType==wt.KLINE_ID?(this.OutVar=this.FittingData(s.outdata,o),X.Complier.Log("[APIScriptIndex::RecvAPIData] conver to OutVar ",this.OutVar)):this.OutVar=this.FittingMinuteData(s.outdata,o),this.BindData(o,h,l),this.IsLocked==!1)o.Frame.SubFrame[h].Frame.SetLock(null);else{var D={IsLocked:!0,Callback:this.LockCallback,IndexName:this.Name,ID:this.LockID,BG:this.LockBG,Text:this.LockText,TextColor:this.LockTextColor,Font:this.LockFont,Count:this.LockCount,MinWidth:this.LockMinWidth};o.Frame.SubFrame[h].Frame.SetLock(D)}if(o.UpdataDataoffset(),o.UpdateFrameMaxMin(),s.Redraw===!1||o.Draw(),o.GetIndexEvent){var v=o.GetIndexEvent();if(v){var s={OutVar:this.OutVar,WindowIndex:h,Name:this.Name,Arguments:this.Arguments,HistoryData:l,Stock:{Symbol:o.Symbol,Name:o.Name}};v.Callback(v,s,this)}}}},this.FittingArray=function(s,o,h,l,u){var f=l.ChartPaint[0].Data,C=[];for(var D in s){var v=s[D],S=new yt;S.Date=o[D],h&&D<h.length&&(S.Time=h[D]),S.Value=v,C.push(S)}var T;k.IsDayPeriod(l.Period,!0)?T=f.GetFittingData(C):T=f.GetMinuteFittingData(C);var I=new k;I.Data=T;var F;return u==1?F=I.GetObject():F=I.GetValue(),F},this.FittingMultiLine=function(s,o,h,l){var u=l.ChartPaint[0].Data;if(k.IsDayPeriod(l.Period,!0)){var u=l.ChartPaint[0].Data,f=[];for(var C in s){var D=s[C];for(var v in D.Point){var S=D.Point[v];f.push(S)}}return f.sort(function(F,E){return F.Date-E.Date}),u.GetDateIndex(f),s}else if(k.IsMinutePeriod(l.Period,!0)||k.IsTickPeriod(l.Period)||k.IsSecondPeriod(l.Period)){var u=l.ChartPaint[0].Data,f=[];for(var C in s){var D=s[C];for(var v in D.Point){var S=D.Point[v];f.push(S)}}return f.sort(function(E,M){return E.Date==M.Date?E.Time-M.Time:E.Date-M.Date}),u.GetDateTimeIndex(f),s}else if(this.HQDataType==wt.MINUTE_ID||this.HQDataType==wt.MULTIDAY_MINUTE_ID){var T=l.SourceData,f=[];for(var C in s){var D=s[C];for(var v in D.Point){var S=D.Point[v];f.push(S)}}return f.sort(function(F,E){return F.Date==E.Date?F.Time-E.Time:F.Date-E.Date}),T.GetDateTimeIndex(f),s}return null},this.FittingMultiText=function(s,o,h,l){if(k.IsDayPeriod(l.Period,!0)){var u=l.ChartPaint[0].Data;return s.sort(function(C,D){return C.Date-D.Date}),u.GetDateIndex(s),s}else if(k.IsMinutePeriod(l.Period,!0)||k.IsTickPeriod(l.Period)||k.IsSecondPeriod(l.Period)){var u=l.ChartPaint[0].Data;return s.sort(function(D,v){return D.Date==v.Date?D.Time-v.Time:D.Date-v.Date}),u.GetDateTimeIndex(s),s}else if(this.HQDataType==wt.MINUTE_ID||this.HQDataType==wt.MULTIDAY_MINUTE_ID){var f=l.SourceData;return s.sort(function(C,D){return C.Date==D.Date?C.Time-D.Time:C.Date-D.Date}),f.GetDateTimeIndex(s),s}return null},this.FittingData=function(s,o){var h=s.outvar,l=s.date,u=s.time;o.ChartPaint[0].Data;var f=[];if(!h)return f;for(var C=0;C<h.length;++C){var D=h[C],v={Name:D.name,Type:D.type};if(D.color&&(v.Color=D.color),D.data)v.Data=this.FittingArray(D.data,l,u,o),D.color&&(v.Color=D.color),D.linewidth&&(v.LineWidth=D.linewidth),D.isshow==!1&&(v.IsShow=!1),D.isexdata==!0&&(v.IsExData=!0),D.BreakPoint&&(v.BreakPoint=D.BreakPoint),f.push(v);else if(D.Draw){var S=D.Draw,T={};if(S.DrawType=="DRAWICON")T.Icon=S.Icon,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData=this.FittingArray(S.DrawData,l,u,o),v.Draw=T,f.push(v);else if(S.DrawType=="DRAWTEXT")T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData=this.FittingArray(S.DrawData,l,u,o),v.Draw=T,f.push(v);else if(S.DrawType=="STICKLINE")T.Name=S.Name,T.Type=S.Type,T.Width=S.Width,T.DrawType=S.DrawType,T.DrawData=this.FittingArray(S.DrawData,l,u,o,1),v.Draw=T,f.push(v);else if(S.DrawType=="DRAWBAND")T.Name=S.Name,T.Type=S.Type,T.DrawType=S.DrawType,T.DrawData=this.FittingArray(S.DrawData,l,u,o,1),T.Color=S.Color,v.Draw=T,f.push(v);else if(S.DrawType=="MULTI_LINE"){if(T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData=this.FittingMultiLine(S.DrawData,l,u,o),c.IsNonEmptyArray(T.DrawData))for(var I=0;I<T.DrawData.length;++I)this.GetKLineData(T.DrawData[I].Point,o);v.Draw=T,S.LineDash&&(T.LineDash=S.LineDash),S.Arrow&&(T.Arrow=S.Arrow),c.IsNumber(S.LineWidth)&&(T.LineWidth=S.LineWidth),f.push(v)}else if(S.DrawType=="MULTI_POINT"){if(T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData=this.FittingMultiLine(S.DrawData,l,u,o),c.IsNonEmptyArray(T.DrawData))for(var I=0;I<T.DrawData.length;++I)this.GetKLineData(T.DrawData[I].Point,o);v.Draw=T,f.push(v)}else if(S.DrawType=="MULTI_BAR")T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData=this.FittingMultiLine(S.DrawData,l,u,o),v.Draw=T,f.push(v);else if(S.DrawType==Ei.OVERLAY_BARS)T.Name=S.Name,T.Type=S.Type,T.DrawType=S.DrawType,T.BarName=S.BarName,T.BarColor=S.BarColor,T.LineWidth=S.LineWidth,T.BarType=S.BarType,T.DrawData=this.FittingArray(S.DrawData,l,u,o,1),v.Draw=T,f.push(v);else if(S.DrawType==Ei.SCATTER_PLOT)T.Name=S.Name,T.Type=S.Type,T.DrawType=S.DrawType,T.DrawData=this.FittingArray(S.DrawData,l,u,o,1),T.Color=S.Color,T.Radius=S.Radius,v.Draw=T,f.push(v);else if(S.DrawType==Ei.KLINE_TABLE)T.Name=S.Name,T.Type=S.Type,T.DrawType=S.DrawType,T.DrawData=this.FittingArray(S.DrawData,l,u,o,1),T.RowCount=S.RowCount,T.RowName=S.RowName,T.IsShowRowName=S.IsShowRowName,T.BGColor=S.BGColor,v.Draw=T,f.push(v);else if(S.DrawType=="MULTI_TEXT")T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData=this.FittingMultiText(S.DrawData,l,u,o),this.GetKLineData(T.DrawData,o),v.Draw=T,f.push(v);else if(S.DrawType=="MULTI_SVGICON")T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData={Icon:this.FittingMultiText(S.DrawData.Icon,l,u,o),Family:S.DrawData.Family},this.GetKLineData(T.DrawData.Icon,o),v.Draw=T,f.push(v);else if(S.DrawType=="DRAWSVG")T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData={Data:this.FittingMultiText(S.Data,l,u,o),Family:S.Family,TextFont:S.TextFont,EnableTooltip:S.EnableTooltip,IsDrawFirst:S.IsDrawFirst},this.GetKLineData(T.DrawData.Data,o),v.Draw=T,f.push(v);else if(S.DrawType=="MULTI_HTMLDOM")T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.Callback=S.Callback,T.DrawData=this.FittingMultiText(S.DrawData,l,u,o),this.GetKLineData(T.DrawData,o),v.Draw=T,f.push(v);else if(S.DrawType=="COLOR_KLINE"){T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType;var F=this.FittingMultiText(S.DrawData.KLine,l,u,o),E=new Dt.default;for(var C in F){var D=F[C];E.set(D.Index,D)}T.DrawData={KLine:E},S.Color&&(v.Color=S.Color),v.Draw=T,f.push(v)}else if(S.DrawType=="KLINE_BG")T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData={},T.DrawData.Color=S.Color,T.DrawData.Angle=S.Angle,S.Ver==2?T.DrawData.Data=this.FittingKLineBG_V2(S.DrawData,o):T.DrawData.Data=this.FittingKLineBG(S.DrawData,o),v.Draw=T,v.Name=S.DrawType,f.push(v);else if(S.DrawType=="MULTI_POINT_LINE")T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData={},T.DrawData.Color=S.Color,T.DrawData.PointRadius=S.PointRadius,T.DrawData.PointColor=S.PointColor,T.DrawData.LineWidth=S.LineWidth,T.DrawData.Data=this.FittingMultiPointLine(S.DrawData,o),v.Draw=T,f.push(v);else if(S.DrawType=="PARTLINE")T.Name=S.Name,T.Type=S.Type,T.DrawType=S.DrawType,T.DrawData=this.FittingArray(S.DrawData,l,u,o,1),v.Draw=T,S.LineWidth&&(v.LineWidth=S.LineWidth),f.push(v);else{var M=Qi.Get(S.DrawType);M&&M.KLineFittingCallback&&M.KLineFittingCallback(D,v,{Date:l,Time:u,HQChart:o},this)&&f.push(v)}}}return f},this.GetKLineData=function(s,o){if(s&&Array.isArray(s)){if(this.HQDataType==wt.MINUTE_ID||this.HQDataType==wt.MULTIDAY_MINUTE_ID)var h=o.SourceData;else var h=o.ChartPaint[0].Data;for(var l in s){var u=s[l];if(c.IsString(u.Value)&&c.IsNumber(u.Index)&&!(u.Index<0||u.Index>=h.Data.length)){var f=u.Value.toUpperCase(),C=h.Data[u.Index];switch(f){case"HIGH":case"H":u.Value=C.High;break;case"L":case"LOW":u.Value=C.Low;break;case"C":case"CLOSE":u.Value=C.Close;break}}}}},this.FittingKLineBG=function(s,o){var h=o.ChartPaint[0].Data,l=[];if(k.IsDayPeriod(o.Period,!0)){for(var u=!1,f=0,C=0;f<h.Data.length;){l[f]=0;var D=h.Data[f];if(C>=s.length){++f;continue}var v=s[C];v.Date<D.Date?++C:(v.Date>D.Date||(u=!0,l[f]=1,++C),++f)}if(u)return l}else if(k.IsMinutePeriod(o.Period,!0)){for(var u=!1,f=0,C=0;f<h.Data.length;){l[f]=0;var D=h.Data[f];if(C>=s.length){++f;continue}var v=s[C];v.Date<D.Date||v.Date==D.Date&&v.Time<D.Time?++C:(v.Date>D.Date||v.Date==D.Date&&v.Time>D.Time||(u=!0,l[f]=1,++C),++f)}if(u)return l}return null},this.FittingKLineBG_V2=function(s,o){var h=o.ChartPaint[0].Data,l=[];if(k.IsDayPeriod(o.Period,!0)){for(var u=!1,f=0,C=0;f<h.Data.length;++f){l[f]=0;var D=h.Data[f],v=D.Date;for(C=0;C<s.length;++C){var S=s[C];if(v>=S.Start.Date&&v<=S.End.Date){l[f]=1,u=!0;break}}}if(u)return l}else if(k.IsMinutePeriod(o.Period,!0)){for(var T=[],f=0;f<s.length;++f){var I=s[f],F=I.Start.Date*1e4;c.IsNumber(I.Start.Time)&&(F+=I.Start.Time);var E=I.End.Date*1e4;c.IsNumber(I.End.Time)&&(E+=I.End.Time),T.push({Start:F,End:E})}for(var u=!1,f=0,C=0;f<h.Data.length;++f){l[f]=0;var D=h.Data[f],v=D.Date*1e4+D.Time;for(C=0;C<T.length;++C){var S=T[C];if(v>=S.Start&&v<=S.End){l[f]=1,u=!0;break}}}if(u)return l}return null},this.FittingMinuteData=function(s,o){for(var h=s.outvar,l=s.date,u=s.time,f=[],C=0;C<h.length;++C){var D=h[C],v={Name:D.name,Type:D.type};if(D.data)v.Data=this.FittingMinuteArray(D.data,l,u,o),D.color&&(v.Color=D.color),D.linewidth>=1&&(v.LineWidth=D.linewidth),D.isshow==!1&&(v.IsShow=!1),D.isexdata==!0&&(v.IsExData=!0),D.BreakPoint&&(v.BreakPoint=D.BreakPoint),f.push(v);else if(D.Draw){var S=D.Draw,T={};if(S.DrawType=="DRAWICON")T.Icon=S.Icon,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData=this.FittingMinuteArray(S.DrawData,l,u,o),v.Draw=T,f.push(v);else if(S.DrawType=="DRAWTEXT")T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData=this.FittingMinuteArray(S.DrawData,l,u,o),v.Draw=T,f.push(v);else if(S.DrawType=="STICKLINE")T.Name=S.Name,T.Type=S.Type,T.Width=S.Width,T.DrawType=S.DrawType,T.DrawData=this.FittingMinuteArray(S.DrawData,l,u,o,1),v.Draw=T,f.push(v);else if(S.DrawType==Ei.OVERLAY_BARS)T.Name=S.Name,T.Type=S.Type,T.DrawType=S.DrawType,T.BarName=S.BarName,T.BarColor=S.BarColor,T.LineWidth=S.LineWidth,T.DrawData=this.FittingMinuteArray(S.DrawData,l,u,o,1),v.Draw=T,f.push(v);else if(S.DrawType=="MULTI_LINE"){T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData=this.FittingMultiLine(S.DrawData,l,u,o);for(var I in T.DrawData)this.GetKLineData(T.DrawData[I].Point,o);v.Draw=T,S.LineDash&&(T.LineDash=S.LineDash),S.Arrow&&(T.Arrow=S.Arrow),f.push(v)}else if(S.DrawType=="MULTI_POINT"){if(T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData=this.FittingMultiLine(S.DrawData,l,u,o),c.IsNonEmptyArray(T.DrawData))for(var I=0;I<T.DrawData.length;++I)this.GetKLineData(T.DrawData[I].Point,o);v.Draw=T,f.push(v)}else if(S.DrawType=="MULTI_TEXT")T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData=this.FittingMultiText(S.DrawData,l,u,o),this.GetKLineData(T.DrawData,o),v.Draw=T,f.push(v);else if(S.DrawType=="MULTI_SVGICON")T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData={Icon:this.FittingMultiText(S.DrawData.Icon,l,u,o),Family:S.DrawData.Family},this.GetKLineData(T.DrawData.Icon,o),v.Draw=T,f.push(v);else if(S.DrawType=="DRAWSVG")T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.DrawData={Data:this.FittingMultiText(S.Data,l,u,o),Family:S.Family,TextFont:S.TextFont,EnableTooltip:S.EnableTooltip,IsDrawFirst:S.IsDrawFirst},this.GetKLineData(T.DrawData.Data,o),v.Draw=T,f.push(v);else if(S.DrawType=="MULTI_HTMLDOM")T.Text=S.Text,T.Name=S.Name,T.DrawType=S.DrawType,T.Callback=S.Callback,T.DrawData=this.FittingMultiText(S.DrawData,l,u,o),this.GetKLineData(T.DrawData,o),v.Draw=T,f.push(v);else{var F=Qi.Get(S.DrawType);F&&F.MinuteFittingCallback&&F.MinuteFittingCallback(D,v,{Date:l,Time:u,HQChart:o},this)&&f.push(v)}}}return f},this.FittingMinuteArray=function(s,o,h,l,u){var f=l.SourceData,C=[];for(var D in s){var v=s[D],S=new yt;S.Date=o[D],h&&D<h.length&&(S.Time=h[D]),S.Value=v,C.push(S)}var T;u==5?T=f.GetMinuteFittingDataV2(C):T=f.GetMinuteFittingData(C);var I=new k;I.Data=T;var F=I.GetValue();return F},this.FittingMultiPointLine=function(s,o){var h=o.Period,l=s.Data,u=[];if(k.IsDayPeriod(h,!0)){var f=l[0],C=o.ChartPaint[0].Data,D=C.Data[0],v=0,S=0;if(f.Date>D.Date){var T=0;for(v=0;v<C.Data.length;++v){var I=C.Data[v];if(I.Date==f.Date)break;if(I.Date>f.Date){v=T;break}T=v}}else for(S=0;S<l.length;++S){var F=l[S];if(F.Date>=D.Date)break}for(var E=null,M=v,O=S;M<C.Data.length&&O<l.length;){var I=C.Data[M],F=l[O];F.Date<=I.Date?(u[M]||(u[M]=[]),u[M].push({Date:F.Date,Value:F.Value,Data:F.Data,KDate:I.Date,Type:1}),E=F,++O):(E&&!u[M]&&(u[M]={Date:E.Date,Value:E.Value,Type:0}),++M)}if(E)for(;M<C.Data.length;++M)u[M]||(u[M]={Date:E.Date,Value:E.Value,Type:0});return u}else if(k.IsMinutePeriod(h,!0)){var C=o.ChartPaint[0].Data;return u}}}function LI(r,n,e){this.newMethod=de,this.newMethod(r,null,n,null),delete this.newMethod,this.JsonData,e.JsonData&&(this.JsonData=e.JsonData),this.RequestData=function(t,a,s){if(!this.JsonData){console.warn("[LocalJsonDataIndex::RequestData] JsonData is null"),param.HQChart.ScriptErrorCallback&&param.HQChart.ScriptErrorCallback("json 数据不能为空");return}this.OutVar=this.FittingData(this.JsonData,s),this.BindData(t,a,s)},this.FittingData=function(t,a){outVar=t.OutVar,date=t.Date,time=t.Time,result=[];for(i in outVar){if(item=outVar[i],X.Complier.Log("[LocalJsonDataIndex::FittingData] item",item),item.Type!=0&&item.Type!=3){console.warn("[LocalJsonDataIndex::FittingData] can't support ",item.Name,item.Type);continue}var s=[];outVarItem={Name:item.Name,Type:item.Type};for(j in item.Data){var o=new yt;o.Date=date[j],time&&j<time.length&&(o.Time=time[j]),o.Value=item.Data[j],s.push(o)}if(a.Period<4)var h=a.GetFittingData(s);else var h=a.GetMinuteFittingData(s);var l=new k;l.Data=h,outVarItem.Data=l.GetValue(),result.push(outVarItem)}return result}}function aD(r){this.ID,this.Name,this.Script,this.Arguments=[],this.ClassName="ScriptIndexConsole",this.ErrorCallback,this.FinishCallback,this.IsSectionMode=!1,this.NetworkFilter,r&&(r.Name&&(this.Name=r.Name),r.Script&&(this.Script=r.Script),r.ID&&(this.ID=r.ID),r.Args&&(this.Arguments=r.Args),r.ErrorCallback&&(this.ErrorCallback=r.ErrorCallback),r.FinishCallback&&(this.FinishCallback=r.FinishCallback),r.IsSectionMode&&(this.IsSectionMode=r.IsSectionMode),r.NetworkFilter&&(this.NetworkFilter=r.NetworkFilter)),this.ExecuteScript=function(n){this.OutVar=[];var e={Self:this},t={HQDataType:n.HQDataType,Symbol:n.Stock.Symbol,Name:n.Stock.Name,Period:n.Period,Right:n.Right,Callback:this.RecvResultData,CallbackParam:e,Async:!0,MaxRequestDataCount:n.Request.MaxDataCount,MaxRequestMinuteDayCount:n.Request.MaxMinuteDayCount,Arguments:this.Arguments,IsSectionMode:this.IsSectionMode,ClassName:"ScriptIndexConsole",NetworkFilter:this.NetworkFilter};n.HQDataType===wt.HISTORY_MINUTE_ID&&(t.TrateDate=n.Request.TradeDate),n.HQDataType==wt.MULTIDAY_MINUTE_ID&&(t.DayCount=n.DayCount);var a=this.Script;Qe.Execute(a,t,this.ErrorCallback)},this.RecvResultData=function(n,e){var t=e.Self,a=e.JSExecute,s=null;a.SymbolData.Data&&(s=a.SymbolData.Data.GetDate());var o={Out:n,Date:s,Stock:{Name:a.SymbolData.Name,Symbol:a.SymbolData.Symbol},Index:{Name:t.Name,ID:t.ID}};(a.SymbolData.DataType==wt.MULTIDAY_MINUTE_ID||a.SymbolData.DataType==wt.MINUTE_ID||a.SymbolData.DataType==wt.KLINE_ID&&k.IsMinutePeriod(a.SymbolData.Period,!0))&&(o.Time=a.SymbolData.Data.GetTime()),t.FinishCallback&&t.FinishCallback(o,e.JSExecute)}}aD.SetDomain=function(r,n){Qe.SetDomain(r,n)};function iD(r){this.Url=r.Url,this.Job=r.Job,this.Symbol=r.Symbol,this.Args=r.Args,this.DataKey=r.DataKey,this.RecvCallback=r.Callback,this.ErrorCallback=r.ErrorCallback,this.Download=function(){var n=this,e=this.GetFieldList();if(!e){message=this.Job.FunctionName+"("+this.Args[0]+") can't support.",this.ErrorCallback(message),n.RecvCallback(null,n.Job,n.DataKey);return}Lt.HttpRequest({url:this.Url,data:{field:e,symbol:[this.Symbol],condition:[{item:["finance","doc","exists","true"]}],start:0,end:200},type:"post",dataType:"json",async:!0,success:function(a){var s=n.ToHQChartData(a);s&&s.sort(function(o,h){return o.Date-h.Date}),n.RecvCallback(s,n.Job,n.DataKey)}})},this.ToHQChartData=function(n){if(!n.stock||n.stock.length!=1)return null;var e=[],t=new Ee.default,a=n.stock[0];for(var s in a.stockday){var o=a.stockday[s];if(o.announcement1){var h=this.ToHQChartItemData(o.announcement1,o.finance1,o);h&&!t.has(h.Date)&&(e.push(h),t.add(h.Date))}if(o.announcement2){var h=this.ToHQChartItemData(o.announcement2,o.finance2,o);h&&!t.has(h.Date)&&(e.push(h),t.add(h.Date))}if(o.announcement3){var h=this.ToHQChartItemData(o.announcement3,o.finance3,o);h&&!t.has(h.Date)&&(e.push(h),t.add(h.Date))}if(o.announcement4){var h=this.ToHQChartItemData(o.announcement4,o.finance4,o);h&&!t.has(h.Date)&&(e.push(h),t.add(h.Date))}}return e},this.ToHQChartItemData=function(n,e,t){var a=this.Args[0],s=n.year*1e4,o=n.quarter;switch(o){case 1:s+=331;break;case 2:s+=630;break;case 3:s+=930;break;case 4:s+=1231;break;default:return null}var h={Date:s,Value:0};switch(a){case 0:h.Value=s%1e6;break;case 1:h.Value=e.persearning;break;case 3:h.Value=e.peruprofit;break;case 4:h.Value=e.pernetasset;break;case 5:h.Value=e.percreserve;break;case 6:h.Value=e.woewa;break;case 7:h.Value=e.perccfo;break;case 8:h.Value=e.monetaryfunds;break;case 11:h.Value=e.areceivable;break}return h},this.GetFieldList=function(){var n=this.Args[0];switch(n){case 0:return["finance.date"];case 1:return["finance.persearning"];case 3:return["finance.peruprofit"];case 4:return["finance.pernetasset"];case 5:return["finance.percreserve"];case 6:return["finance.woewa"];case 7:return["finance.perccfo"];case 8:return["finance.monetaryfunds"];case 11:return["finance.areceivable"];default:return null}}}function MI(r){this.newMethod=iD,this.newMethod(r),delete this.newMethod,this.Download=function(){var n=this,e=this.GetFieldList();if(!e){message=this.Job.FunctionName+"("+this.Args[0]+", "+this.Args[1]+", "+this.Args[2]+") can't support.",this.ErrorCallback(message),n.RecvCallback(null,n.Job,n.DataKey);return}var t=[{item:["finance","doc","exists","true"]}],a=this.Args[1],s=this.Args[2],o=0,h=3,l=null;a==0&&s==0||(a==0&&s<300?(o=s,h=200):s==0&&a<1e3?l=a:a>1909&&(s==331?(t=[{item:["announcement1.year","int32","eq",a]},{item:["finance1","doc","exists","true"]}],e.push("announcement1.year"),e.push("announcement1.quarter")):s==630?(t=[{item:["announcement2.year","int32","eq",a]},{item:["finance2","doc","exists","true"]}],e.push("announcement2.year"),e.push("announcement2.quarter")):s==930?(t=[{item:["announcement3.year","int32","eq",a]},{item:["finance3","doc","exists","true"]}],e.push("announcement4.year"),e.push("announcement4.quarter")):(t=[{item:["announcement4.year","int32","eq",a]},{item:["finance4","doc","exists","true"]}],e.push("announcement4.year"),e.push("announcement4.quarter")))),Lt.HttpRequest({url:this.Url,data:{field:e,symbol:[this.Symbol],condition:t,start:0,end:h},type:"post",dataType:"json",async:!0,success:function(f){var C=n.ToHQChartData(f),D=null;C&&C.length>0&&(C.sort(function(v,S){return S.Date-v.Date}),l==null?D=C[o]:D=n.GetPreYearData(C,l)),n.RecvCallback(D,n.Job,n.DataKey)}})},this.GetPreYearData=function(n,e){if(e==331||e==630||e==930||e==1231)for(var t in n){var a=n[t];if(a.Date%1e4==e)return a}else{for(var s=n[0].Date%1e3,t=1,o=0;t<n.length;++t){var a=n[t];if(a.Date%1e4==s&&(++o,o==e))return a}return null}}}function Zu(r){this.Url=r.Url,this.RealtimeUrl=r.RealtimeUrl,this.Job=r.Job,this.Symbol=r.Symbol,this.Args=r.Args,this.DataKey=r.DataKey,this.RecvCallback=r.Callback,this.ErrorCallback=r.ErrorCallback,this.Download=function(){var n=this.Args[0];switch(n){case 1:case 7:case"EXCHANGE":this.DownloadHistoryData(n);break;case 3:this.GetSymbolType(n);break;case 9:case 18:case 30:case 32:case 33:case 34:case 38:case 40:case 41:case 42:case 43:case"CAPITAL":case"TOTALCAPITAL":case 100:this.DownloadRealtimeData(n);break;default:this.DownloadRealtimeData(n);break}},this.GetSymbolType=function(n){var e=1;W.IsSHSZIndex(this.Symbol)&&(e=0);var t={Date:null,Value:e};this.RecvCallback(t,this.Job,this.DataKey)},this.DownloadRealtimeData=function(n){var e=this,t=this.GetFieldList();if(!t){this.Job.FunctionName2?message=this.Job.FunctionName2+" can't support.":this.Job.FunctionName?message=this.Job.FunctionName+"("+this.Args[0]+") can't support.":message=this.Args[0]+" can't support.",this.ErrorCallback(message),e.RecvCallback(null,e.Job,e.DataKey);return}Lt.HttpRequest({url:this.RealtimeUrl,data:{field:t,symbol:[this.Symbol],condition:[],start:0,end:10},type:"post",dataType:"json",async:!0,success:function(s){var o=e.RealtimeDataToHQChartData(s);e.RecvCallback(o,e.Job,e.DataKey)}})},this.DownloadHistoryData=function(n){var e=this,t=this.GetFieldList();if(!t){message=this.Job.FunctionName+"("+this.Args[0]+") can't support.",this.ErrorCallback(message),e.RecvCallback(null,e.Job,e.DataKey);return}Lt.HttpRequest({url:this.Url,data:{field:t,symbol:[this.Symbol],condition:[],start:0,end:200},type:"post",dataType:"json",async:!0,success:function(s){var o=e.ToHQChartData(s);o&&o.sort(function(h,l){return h.Date-l.Date}),e.RecvCallback(o,e.Job,e.DataKey)}})},this.GetFieldList=function(){var n=this.Args[0];switch(n){case 1:return["capital.total","capital.date"];case 7:return["capital.a","capital.date"];case"EXCHANGE":return["capital.a","capital.date"];case 9:return["finance.peruprofit","symbol","date"];case 18:return["finance.percreserve","symbol","date"];case 30:return["finance.nprofit","symbol","date"];case 32:return["finance.peruprofit","symbol","date"];case 33:return["finance.persearning","symbol","date"];case 34:return["finance.pernetasset","symbol","date"];case 38:return["finance.persearning","symbol","date"];case 40:return["capital.a","capital.date","symbol","date","price"];case 41:return["capital.total","capital.date","symbol","date","price"];case"CAPITAL":return["capital.a","capital.date","symbol","date"];case"TOTALCAPITAL":return["capital.total","capital.date","symbol","date"];case 42:return["company.releasedate","symbol","date"];case 43:return["dividendyield","symbol","date"];case 100:return["shareholder","symbol","date"];default:return null}},this.RealtimeDataToHQChartData=function(n,a){if(!n.stock||n.stock.length!=1)return null;var t=n.stock[0],a=this.Args[0],s=t.date;switch(a){case 9:return t.finance?{Date:s,Value:t.finance.peruprofit}:null;case 18:return t.finance?{Date:s,Value:t.finance.percreserve}:null;case 30:return t.finance?{Date:s,Value:t.finance.nprofit}:null;case 32:return t.finance?{Date:s,Value:t.finance.peruprofit}:null;case 33:return t.finance?{Date:s,Value:t.finance.persearning}:null;case 34:return t.finance?{Date:s,Value:t.finance.pernetasset}:null;case 38:return t.finance?{Date:s,Value:t.finance.persearning}:null;case 40:return t.capital?{Date:s,Value:t.capital.a*t.price}:null;case 41:return t.capital?{Date:s,Value:t.capital.total*t.price}:null;case 42:if(!t.company)return null;{var o=t.company.releasedate,h=parseInt(o/1e4),l=parseInt(o%1e4/100),u=o%100,f=new Date(h,l-1,u),C=new Date,D=parseInt((C.getTime()-f.getTime())/(1e3*60*60*24));return{Date:s,Value:D+1}}case 43:return t.dividendyield?{Date:s,Value:t.dividendyield.quarter4}:null;case 100:return t.shareholder?{Date:s,Value:t.shareholder.count}:null;case"CAPITAL":return t.capital?{Date:s,Value:t.capital.a/100}:null;case"TOTALCAPITAL":return t.capital?{Date:s,Value:t.capital.total/100}:null}},this.ToHQChartData=function(n){if(!n.stock||n.stock.length!=1)return null;var e=[],t=new Ee.default,a=n.stock[0],s=this.Args[0];for(var o in a.stockday){var h=a.stockday[o],l=this.ToHQChartItemData(h,s);l&&!t.has(l.Date)&&(e.push(l),t.add(l.Date))}return e},this.ToHQChartItemData=function(n,e){if(!n)return null;var t=n.date;switch(e){case 1:return n.capital?{Date:t,Value:n.capital.total}:null;case 7:case"EXCHANGE":return n.capital?{Date:t,Value:n.capital.a}:null;default:return null}}}function AI(r){this.Url=r.Url,this.RealtimeUrl=r.RealtimeUrl,this.Job=r.Job,this.Symbol=r.Symbol,this.Args=r.Args,this.DataKey=r.DataKey,this.RecvCallback=r.Callback,this.ErrorCallback=r.ErrorCallback,this.Download=function(){var n=this,e=this.GetFieldList();if(!e){message=this.Job.FunctionName+"("+this.Args[0]+", "+this.Args[1]+", "+this.Args[2]+") can't support.",this.ErrorCallback(message),n.RecvCallback(null,n.Job,n.DataKey,!0);return}Lt.HttpRequest({url:this.Url,data:{field:e,symbol:[this.Symbol],orderfield:"date",order:-1,start:0,end:5},type:"post",dataType:"json",async:!0,success:function(a){var s=n.ToHQChartData(a);s&&s.length>0&&s.sort(function(o,h){return o.Date-h.Date}),n.RecvCallback(s,n.Job,n.DataKey)}})},this.GetFieldList=function(){var n=this.Args[0];switch(n){case 1:return["shareholder","date","symbol"];case 2:return["tradedetail.buy","tradedetail.sell","date","symbol"];case 3:return["margin","date","symbol"];case 4:return["blocktrading.amount","blocktrading.price","date","symbol"];default:return null}},this.ToHQChartData=function(n){if(!n.stock||n.stock.length!=1)return null;var e=[],t=new Ee.default,a=n.stock[0],s=this.Args[0],o=this.Args[1];for(var h in a.stockday){var l=a.stockday[h],u=this.ToHQChartItemData(l,s,o);u&&!t.has(u.Date)&&(e.push(u),t.add(u.Date))}return e},this.ToHQChartItemData=function(n,e,t){if(!n)return null;var a=n.date;switch(e){case 1:return n.shareholder?{Date:a,Value:n.shareholder.count}:null;case 2:return!n.tradedetail&&n.tradedetail[0]?null:t==0?{Date:a,Value:n.tradedetail[0].buy}:{Date:a,Value:n.tradedetail[0].sell};case 3:if(!n.margin)return null;if(t==0){if(n.margin.buy)return{Date:a,Value:n.margin.buy.balance}}else if(n.margin.sell)return{Date:a,Value:n.margin.sell.balance};return null;case 4:return n.blocktrading?t==0?{Date:a,Value:n.blocktrading.price}:{Date:a,Value:n.blocktrading.amount}:null;default:return null}}}function NI(r){this.Url=r.Url,this.Job=r.Job,this.Symbol=r.Symbol,this.Args=r.Args,this.DataKey=r.DataKey,this.RecvCallback=r.Callback,this.ErrorCallback=r.ErrorCallback,this.Download=function(){var n=this,e=this.GetQueryCondtion();if(!e){message=this.Job.FunctionName+"("+this.Args[0]+", "+this.Args[1]+", "+this.Args[2]+") can't support.",this.ErrorCallback(message),n.RecvCallback(null,n.Job,n.DataKey,!0);return}Lt.HttpRequest({url:this.Url,data:{field:e.Field,symbol:e.Symbol,condition:e.Cond,start:0,end:2e3},type:"post",dataType:"json",async:!0,success:function(a){var s=n.ToHQChartData(a);s&&s.sort(function(o,h){return o.Date-h.Date}),n.RecvCallback(s,n.Job,n.DataKey)}})},this.GetQueryCondtion=function(){var n=new Date,e=n.getFullYear()*1e4+(n.getMonth()+1)*100+n.getDate();n.setDate(n.getDate()-100);var t=n.getFullYear()*1e4+(n.getMonth()+1)*100+n.getDate(),a=this.Args[0];switch(a){case 1:var s={Symbol:["CNA.ci"],Field:["margin"],Cond:[{item:["date","int32","gte",t.toString(),"lte",e.toString()]},{item:["margin","doc","exists","true"]}]};return s}},this.ToHQChartData=function(n){if(!n.stock||n.stock.length!=1)return null;var e=[],t=new Ee.default,a=n.stock[0],s=this.Args[0],o=this.Args[1];for(var h in a.stockday){var l=a.stockday[h],u=this.ToHQChartItemData(l,s,o);u&&!t.has(u.Date)&&(e.push(u),t.add(u.Date))}return e},this.ToHQChartItemData=function(n,e,t){if(!n)return null;var a=n.date,s=null;switch(e){case 1:return n.margin?(s=n.margin,t==1?!s.buy||!c.IsNumber(s.buy.balance)?null:{Date:a,Value:s.buy.balance}:c.IsNumber(s.sell.balance)?{Date:a,Value:s.sell.balance}:null):null;default:return null}}}function OI(r){this.Url=r.Url,this.RealtimeUrl=r.RealtimeUrl,this.Job=r.Job,this.Symbol=r.Symbol,this.Args=r.Args,this.DataKey=r.DataKey,this.RecvCallback=r.Callback,this.ErrorCallback=r.ErrorCallback,this.Download=function(){var n=this.Args[0];switch(n){case"HYBLOCK":case"DYBLOCK":case"GNBLOCK":this.DownloadGroupName(n);break}},this.DownloadGroupName=function(n){var e=this,t=["name","symbol"];n=="HYBLOCK"?t.push("industry"):n=="DYBLOCK"?t.push("region"):n=="GNBLOCK"&&t.push("concept"),Lt.HttpRequest({url:e.RealtimeUrl,data:{field:t,symbol:[this.Symbol]},type:"post",dataType:"json",async:!0,success:function(s){var o=e.RecvGroupName(s);e.RecvCallback(o,e.Job,e.DataKey,1)},error:function(s){e.ErrorCallback(s)}})},this.RecvGroupName=function(n){if(!n.stock||n.stock.length!=1)return null;var e=n.stock[0],t=this.Args[0],a=null;if(t=="HYBLOCK"){var s=e.industry;if(!s)return null;var a;for(var o in s){var h=s[o];a=h.name}}else if(t=="DYBLOCK"){var l=e.region;if(!l)return null;for(var o in l){var h=l[o];a=h.name}}else if(t=="GNBLOCK"){var u=e.concept;if(!u)return null;a="";for(var o in u){var h=u[o];a.length>0&&(a+=" "),a+=h.name}}return{Value:a}}}function RI(){var r={BGColor:"rgb(0,0,0)",TooltipBGColor:"rgb(255, 255, 255)",TooltipAlpha:.92,SelectRectBGColor:"rgba(1,130,212,0.06)",UpBarColor:"rgb(238,21,21)",DownBarColor:"rgb(25,158,0)",UnchagneBarColor:"rgb(228,228,228)",EmptyBarBGColor:"rgb(0,0,0)",HLCArea:{HighLineColor:"rgb(238,21,21)",LowLineColor:"rgb(25,158,0)",CloseLineColor:"rgb(156,156,156)",LineWidth:2*V(),UpAreaColor:"rgba(238,21,21, 0.3)",DownAreaColor:"rgba(25,158,0, 0.3)"},Minute:{VolBarColor:null,PriceColor:"rgb(25,180,231)",AreaPriceColor:"rgba(63,158,255,.3)",AvPriceColor:"rgb(255,236,0)",PositionColor:"rgb(218,165,32)",VolTitleColor:"rgb(190,190,190)",Before:{BGColor:"rgba(105,105,105,0.5)",AvPriceColor:"rgb(248,248,255)",CloseIcon:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"}},After:{BGColor:"rgba(105,105,105,0.5)",AvPriceColor:"rgb(248,248,255)"}},DefaultTextColor:"rgb(101,104,112)",DefaultTextFont:14*V()+"px 微软雅黑",TitleFont:13*V()+"px 微软雅黑",IndexTitleColor:"rgb(190, 190 ,190)",IndexTitleBGColor:"rgb(0,0,0)",IndexTitleBorderColor:"rgb(211, 211, 211)",IndexTitleBorderMoveOnColor:"rgb(30,144,255)",UpTextColor:"rgb(238,21,21)",DownTextColor:"rgb(25,158,0)",UnchagneTextColor:"rgb(190, 190 ,190)",CloseLineColor:"rgb(178,34,34)",Title:{TradeIndexColor:"rgb(105,105,105)",ColorIndexColor:"rgb(112,128,144)",VolColor:"rgb(190, 190 ,190)",AmountColor:"rgb(190, 190 ,190)",DateTimeColor:"rgb(190, 190 ,190)",SettingColor:"rgb(190, 190 ,190)",NameColor:"rgb(190, 190 ,190)",TurnoverRateColor:"rgb(101,104,112)",PositionColor:"rgb(101,104,112)"},FrameBorderPen:"rgba(236,236,236,0.13)",MultiDayBorderPen:"rgba(236,236,236,0.5)",FrameSplitPen:"rgba(236,236,236,0.13)",FrameSplitTextColor:"rgb(101,104,112)",FrameSplitTextFont:12*V()+"px 微软雅黑",FrameTitleBGColor:"rgb(0,0,0)",OverlayIndexTitleBGColor:"rgba(0,0,0,0.7)",Frame:{XBottomOffset:1*V(),PercentageText:{PriceColor:"rgb(101,104,112)",PercentageColor:"rgb(101,104,112)",SplitColor:"rgb(101,104,112)",Font:14*V()+"px 微软雅黑"}},FrameLatestPrice:{TextColor:"rgb(255,255,255)",UpBarColor:"rgb(238,21,21)",DownBarColor:"rgb(25,158,0)",UnchagneBarColor:"rgb(190,190,190)",BGAlpha:.6,EmptyBGColor:"rgb(0,0,0)"},CorssCursorBGColor:"rgb(43,54,69)",CorssCursorTextColor:"rgb(255,255,255)",CorssCursorTextFont:12*V()+"px 微软雅黑",CorssCursorHPenColor:"rgb(130,130,130)",CorssCursorVPenColor:"rgb(130,130,130)",CorssCursor:{RightButton:{BGColor:"rgb(43,54,69)",PenColor:"rgb(255,255,255)",Icon:{Text:"",Color:"rgb(255,255,255)",Family:"iconfont",Size:18}}},OrderFlow:{UpColor:{BG:"rgb(223,191,180)",Border:"rgb(196,84,86)"},DownColor:{BG:"rgb(176,212,184)",Border:"rgb(66,94,74)"},UnchagneColor:{BG:"rgb(216,221,177)",Border:"rgb(209,172,129)"},Text:{Color:"rgb(248,248,255)",Family:"Arial",FontMaxSize:16,MaxValue:"8888"},Line:{UpDownColor:"rgb(220,220,220)",MiddleColor:"rgb(211,211,211)"}},KLine:{MaxMin:{Font:12*V()+"px 微软雅黑",Color:"rgb(255,250,240)",RightArrow:"→",LeftArrow:"←",HighYOffset:0,LowYOffset:0},Info:{Investor:{ApiUrl:"/API/NewsInteract",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#1c65db"}},Announcement:{ApiUrl:"/API/ReportList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f5a521"},IconFont2:{Family:"iconfont",Text:"",HScreenText:"",Color:"#ed7520"}},Pforecast:{ApiUrl:"/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#986cad"}},Research:{ApiUrl:"/API/InvestorRelationsList",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#19b1b7"}},BlockTrading:{ApiUrl:"/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#f39f7c"}},TradeDetail:{ApiUrl:"/API/StockHistoryDay",IconFont:{Family:"iconfont",Text:"",HScreenText:"",Color:"#b22626"}}},NumIcon:{Color:"rgb(251,80,80)",Family:"iconfont",Text:["","","","","","","","","","","","","","","","","","","","",""]},TradeIcon:{Family:"iconfont",Buy:{Color:"rgb(255,15,4)",Text:"",HScreenText:""},Sell:{Color:"rgb(64,122,22)",Text:"",HScreenText:""}}},VirtualKLine:{Color:"rgb(119,136,153)",LineDash:[2,2]},Index:{LineColor:["rgb(255,189,09)","rgb(22,198,255)","rgb(174,35,161)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],NotSupport:{Font:14*V()+"px 微软雅黑",TextColor:"rgb(250,250,250)"}},ColorArray:["rgb(255,174,0)","rgb(25,199,255)","rgb(175,95,162)","rgb(236,105,65)","rgb(68,114,196)","rgb(229,0,79)","rgb(0,128,255)","rgb(252,96,154)","rgb(42,230,215)","rgb(24,71,178)"],Buttons:{CloseOverlayIndex:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},CloseWindow:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},ChangeIndex:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},OverlayIndex:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},ModifyIndexParam:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},MaxMinWindow:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},TitleWindow:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"},ExportData:{MoveOnColor:"rgb(255,255,255)",Color:"rgb(156,156,156)"}},DrawPicture:{LineColor:["rgb(41,98,255)"],PointColor:["rgb(41,98,255)","rgb(89,135,255)","rgb(0,0,0)"]},TooltipPaint:{BGColor:"rgba(20,20,20,0.8)",BorderColor:"rgb(210,210,210)",TitleColor:"rgb(210,210,210)",TitleFont:13*V()+"px 微软雅黑",DateTimeColor:"rgb(210,210,210)",VolColor:"rgb(255, 185, 15)",AmountColor:"rgb(210,210,210)"},PCTooltipPaint:{BGColor:"rgba(20,20,20,0.8)",BorderColor:"rgb(210,210,210)",TitleColor:"rgb(210,210,210)",TitleFont:12*V()+"px 微软雅黑",DateTimeColor:"rgb(210,210,210)",VolColor:"rgb(161,154,3)",AmountColor:"rgb(161,154,3)"},MinuteInfo:{TextColor:"rgb(84,143,255)",Font:14*V()+"px 微软雅黑",PointColor:"rgb(38,113,254)",LineColor:"rgb(120,167,255)",TextBGColor:"rgba(255,255,255,1)"},DepthMapPaint:{LineColor:"rgba(255,185,15)",AreaColor:"rgba(255,185,15,0.8)",TextColor:"rgba(255,255,255)",TextBGColor:"rgb(43,54,69)"},KLineYAxisBGPaint:{Font:12*V()+"px 微软雅黑",TextColor:"rgb(255,255,255)",LineColor:"rgb(255,255,255)"},StockChip:{InfoColor:"rgb(255,255,255)",DayInfoColor:"rgb(0,0,0)"},DepthChart:{BidColor:{Line:"rgb(82,176,123)",Area:"rgba(82,176,123,0.5)"},AskColor:{Line:"rgb(207,76,89)",Area:"rgba(207,76,89, 0.5)"},LineWidth:4},DepthCorss:{BidColor:{Line:"rgb(82,176,123)"},AskColor:{Line:"rgb(207,76,89)"},LineWidth:2,LineDash:[3,3],Tooltip:{BGColor:"rgba(54,54,54, 0.8)",TextColor:"rgb(203,215,224)",Border:{Top:5,Left:20,Bottom:5,Center:5},Font:14*V()+"px 微软雅黑",LineHeight:16}},ChartDrawVolProfile:{BGColor:"rgba(244,250,254,0.3)",BorderColor:"rgba(255,255,255)",VolLineColor:"rgb(232,5,9)",UpVolColor:"rgba(103,179,238, 0.24)",DownVolColor:"rgba(237,208,105,0.24)",AreaUpColor:"rgb(103,179,238,0.7)",AreaDonwColor:"rgba(237,208,105,0.7)",Text:{Color:"rgb(0,0,0)",Family:"Arial",FontMaxSize:18,FontMinSize:6}},RectSelect:{LineColor:"rgb(115,83,64)",LineWidth:1*V(),LineDotted:[3,3],AreaColor:"rgba(26,13,7,0.5)"},SelectedChart:{LineWidth:1,LineColor:"rgb(55,100,100)",Radius:4,MinSpace:200,BGColor:"rgb(255,255,255)"},DragMovePaint:{TextColor:"rgb(255,255,255)"},DealList:{BorderColor:"rgb(38,38,41)",Header:{Color:"RGB(245,245,245)",Mergin:{Left:5,Right:5,Top:4,Bottom:2},Font:{Size:12,Name:"微软雅黑"}},Row:{Mergin:{Top:2,Bottom:2},Font:{Size:15,Name:"微软雅黑"},BarMergin:{Top:2,Left:3,Right:3,Bottom:2}},FieldColor:{Vol:"rgb(192,192,0)",Time:"rgb(245,245,245)",Deal:"rgb(111,128,112)",Index:"rgb(245,245,245)",BarTitle:"rgb(245,245,245)",Text:"rgb(245,245,245)"},UpTextColor:"rgb(238,21,21)",DownTextColor:"rgb(25,158,0)",UnchagneTextColor:"rgb(228,228,228)"},Report:{BorderColor:"rgb(38,38,41)",SelectedColor:"rgb(49,48,56)",Header:{Color:"RGB(245,245,245)",SortColor:"rgb(255,0,0)",Mergin:{Left:5,Right:5,Top:4,Bottom:2},Font:{Size:12,Name:"微软雅黑"}},Item:{Mergin:{Top:2,Bottom:0,Left:5,Right:5},Font:{Size:15,Name:"微软雅黑"},BarMergin:{Top:2,Left:3,Right:3,Bottom:2},NameFont:{Size:14,Name:"微软雅黑"},SymbolFont:{Size:12,Name:"微软雅黑"}},FixedItem:{Font:{Size:15,Name:"微软雅黑"}},LimitBorder:{Color:"rgb(64,64,64)",Mergin:{Top:1,Bottom:1,Left:0,Right:0}},FieldColor:{Index:"rgb(245,245,245)",Symbol:"rgb(255,255,255)",Name:"rgb(255,255,255)",Amount:"rgb(2,226,244)",Vol:"rgb(192,192,0)",BarTitle:"rgb(245,245,245)",Text:"rgb(245,245,245)"},CloseLine:{CloseColor:"rgb(30,144,255)",YCloseColor:"rgba(220,220,220,0.5)",AreaColor:"rgba(220,220,220,0.2)"},KLine:{UpColor:"rgb(255,0,0)",DownColor:"rgb(0,128,0)",UnchagneColor:"rgb(240,240,240)",DataWidth:16,DistanceWidth:3},UpTextColor:"rgb(238,21,21)",DownTextColor:"rgb(25,158,0)",UnchagneTextColor:"rgb(228,228,228)",Tab:{Font:{Size:12,Name:"微软雅黑"},ScrollBarWidth:100,ButtonColor:"rgb(13,12,15)",BarColor:"rgb(48,48,48)",BorderColor:"rgb(48,48,48)",TabTitleColor:"rgb(153,153,153)",TabSelectedTitleColor:"rgb(255,255,255)",TabSelectedBGColor:"rgb(13,12,15)",TabMoveOnTitleColor:"rgb(255,255,255)",TabBGColor:"rgb(28,28,31)"},PageInfo:{Font:{Size:15,Name:"微软雅黑"},TextColor:"rgb(255,255,255)",BGColor:"rgba(49,48,56,0.8)",Mergin:{Left:5,Right:5,Top:4,Bottom:2}},DragRow:{Color:"rgba(255,250, 250,0.8)",TextColor:"rgba(0,0, 0, 0.8)",MoveRowColor:"rgb(135,206,250)",SrcRowColor:"rgb(49,48,56)"}},ScrollBar:{BorderColor:"rgb(38,38,41)",XSplitTextColor:"rgb(240,240,240)",XSplitLineColor:"rgb(38,38,41)",Slider:{DateFont:14*V()+"px 微软雅黑",DateColor:"rgb(240,240,240)",BarColor:"rgb(105,105,105)",BarAreaColor:"rgba(128,128,128,0.65)"},BGChart:{Color:"rgb(105,113,125)",LineWidth:1,AreaColor:"rgba(24,28,42,0.5)"}}};return r}var $o={BLACK_ID:1,WHITE_ID:0};function rD(){}rD.GetStyleConfig=function(r){switch(r){case $o.BLACK_ID:return RI();case $o.WHITE_ID:return new QC;default:return null}};function qo(r){this.DivElement=r,this.JSChartContainer,this.CanvasElement=document.createElement("canvas"),this.CanvasElement.className="jsdeallist-drawing",this.CanvasElement.id=oe(),this.CanvasElement.setAttribute("tabindex",0),this.CanvasElement.style&&(this.CanvasElement.style.outline="none"),r.hasChildNodes()&&X.Chart.Log("[JSDealChart::JSDealList] divElement hasChildNodes",r.childNodes),r.appendChild(this.CanvasElement),this.OnSize=function(){var n=parseInt(this.DivElement.style.height.replace("px",""));this.CanvasElement.height=n,this.CanvasElement.width=parseInt(this.DivElement.style.width.replace("px","")),this.CanvasElement.style.width=this.CanvasElement.width+"px",this.CanvasElement.style.height=this.CanvasElement.height+"px";var e=V();this.CanvasElement.height*=e,this.CanvasElement.width*=e,X.Chart.Log("[JSDealChart::OnSize] devicePixelRatio="+window.devicePixelRatio+", height="+this.CanvasElement.height+", width="+this.CanvasElement.width),this.JSChartContainer&&this.JSChartContainer.OnSize&&this.JSChartContainer.OnSize()},this.SetOption=function(n){var e=this.CreateJSDealChartContainer(n);if(!e)return!1;n.OnCreatedCallback&&n.OnCreatedCallback(e),this.JSChartContainer=e,this.DivElement.JSChart=this,n.Symbol?e.ChangeSymbol(n.Symbol):e.Draw()},this.CreateJSDealChartContainer=function(n){var e=new es(this.CanvasElement);if(e.Create(n),n.NetworkFilter&&(e.NetworkFilter=n.NetworkFilter),c.IsNonEmptyArray(n.Column)&&e.SetColumn(n.Column),this.SetChartBorder(e,n),n.IsAutoUpdate!=null&&(e.IsAutoUpdate=n.IsAutoUpdate),n.AutoUpdateFrequency>0&&(e.AutoUpdateFrequency=n.AutoUpdateFrequency),c.IsBool(n.EnableFilter)&&(e.EnableFilter=n.EnableFilter),n.EventCallback)for(var t=0;t<n.EventCallback.length;++t){var a=n.EventCallback[t];e.AddEventCallback(a)}return e},this.SetChartBorder=function(n,e){if(e.Border){e.Border,c.IsNumber(e.Border.Left)&&(n.Frame.ChartBorder.Left=e.Border.Left),c.IsNumber(e.Border.Right)&&(n.Frame.ChartBorder.Right=e.Border.Right),c.IsNumber(e.Border.Top)&&(n.Frame.ChartBorder.Top=e.Border.Top),c.IsNumber(e.Border.Bottom)&&(n.Frame.ChartBorder.Bottom=e.Border.Bottom);var t=V();n.Frame.ChartBorder.Left*=t,n.Frame.ChartBorder.Right*=t,n.Frame.ChartBorder.Top*=t,n.Frame.ChartBorder.Bottom*=t}},this.ChangeSymbol=function(n,e){this.JSChartContainer&&this.JSChartContainer.ChangeSymbol(n,e)},this.SetColumn=function(n,e){this.JSChartContainer&&this.JSChartContainer.SetColumn(n,e)},this.EnableFilter=function(n,e){this.JSChartContainer&&this.JSChartContainer.EnableFilter(n,e)},this.AddEventCallback=function(n){this.JSChartContainer&&typeof this.JSChartContainer.AddEventCallback=="function"&&(X.Chart.Log("[JSDealChart:AddEventCallback] obj=",n),this.JSChartContainer.AddEventCallback(n))},this.ReloadResource=function(n){this.JSChartContainer&&typeof this.JSChartContainer.ReloadResource=="function"&&(X.Chart.Log("[JSDealChart:ReloadResource] "),this.JSChartContainer.ReloadResource(n))}}qo.Init=function(r){var n=new qo(r);return n.OnSize(),n};function es(r){this.ClassName="JSDealChartContainer",this.Frame,this.ChartPaint=[],this.ChartSplashPaint=null,this.LoadDataSplashTitle="数据加载中",this.Canvas=r.getContext("2d"),this.ShowCanvas=null,this.Symbol,this.Name,this.TradeDate,this.NetworkFilter,this.Data={DataOffset:0,Data:[]},this.SourceData={DataOffset:0,Data:[]},this.IsShowLastPage=!0,this.mapEvent=new Dt.default,this.AutoUpdateTimer=null,this.AutoUpdateFrequency=15e3,this.LoadDataSplashTitle="数据加载中",this.UIElement=r,this.LastPoint=new ot,this.IsDestroy=!1,this.ChartDestory=function(){this.IsDestroy=!0,this.StopAutoUpdate()},this.EnableFilterData=!1,this.FilterData=function(n){if(!this.EnableFilterData)return n;var e=this.GetEventCallback(et.ON_FILTER_DEAL_DATA);if(!e||!e.Callback)return n;var t={Data:n,Result:[]};return e.Callback(e,t,this),t.Result},this.EnableFilter=function(n,e){this.EnableFilterData=n,this.Data.Data=this.FilterData(this.SourceData.Data),this.Data.DataOffset=0,e&&(e.GotoLastPage==!0&&this.GotoLastPage(),e.Redraw==!0&&this.Draw())},this.CloneArray=function(n){var e=[];if(!c.IsNonEmptyArray(n))return e;for(var t=0;t<n.length;++t)e.push(n[t]);return e},this.Create=function(n){var e=this;this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new Qa,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.Frame=new yI,this.Frame.ChartBorder=new We,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartSplashPaint.Frame=this.Frame;var t=new PI;t.Frame=this.Frame,t.ChartBorder=this.Frame.ChartBorder,t.Canvas=this.Canvas,t.GetEventCallback=function(o){return e.GetEventCallback(o)},this.ChartPaint[0]=t,n&&(c.IsBool(n.IsSingleTable)&&(t.IsSingleTable=n.IsSingleTable),c.IsBool(n.IsShowHeader)&&(t.IsShowHeader=n.IsShowHeader),c.IsBool(n.IsShowLastPage)&&(this.IsShowLastPage=n.IsShowLastPage),c.IsNumber(n.BorderLine)&&(this.Frame.BorderLine=n.BorderLine));var a=!0,s=!0;n&&(n.KeyDown===!1&&(a=!1,X.Chart.Log("[JSDealChartContainer::Create] not register keydown event.")),n.Wheel===!1&&(s=!1,X.Chart.Log("[JSDealChartContainer::Create] not register wheel event."))),a&&this.UIElement.addEventListener("keydown",function(o){e.OnKeyDown(o)},!0),s&&this.UIElement.addEventListener("wheel",function(o){e.OnWheel(o)},!0)},this.Draw=function(){if(!(this.UIElement.width<=0||this.UIElement.height<=0)){this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height);var n=V();if(this.Canvas.lineWidth=n,this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash){this.Frame.Draw({IsEnableSplash:this.ChartSplashPaint.IsEnableSplash}),this.ChartSplashPaint.Draw();return}this.Frame.Draw(),this.Frame.DrawLogo();for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.IsDrawFirst&&t.Draw()}for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.IsDrawFirst||t.Draw()}}},this.ChangeSymbol=function(n,e){this.Symbol=n,this.Data=null,this.SourceData=null;var t=this.ChartPaint[0];if(t&&(t.Data=null),e&&c.IsNumber(e.TradeDate)&&(this.TradeDate=e.TradeDate),!this.Symbol){this.Draw();return}this.RequestDealData()},this.CancelAutoUpdate=function(){typeof this.AutoUpdateTimer=="number"&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=null)},this.AutoUpdateEvent=function(n,e){var t=n?et.RECV_START_AUTOUPDATE:et.RECV_STOP_AUTOUPDATE;if(this.mapEvent.has(t)){var a=this,s=this.mapEvent.get(t),o={Stock:{Symbol:this.Symbol,Name:this.Name,DayCount:this.DayCount},Explain:e};n&&(o.Callback=function(h){a.RecvDealUpdateData(h)}),s.Callback(s,o,this)}},this.RequestDealData=function(){this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.EnableSplash(!0),this.Draw();var n=this;if(this.NetworkFilter){var e={Name:"JSDealChartContainer::RequestDealData",Explain:"成交明细",Request:{Data:{symbol:n.Symbol,tradeDate:n.TradeDate}},Self:this,PreventDefault:!1};if(this.NetworkFilter(e,function(a){n.ChartSplashPaint.EnableSplash(!1),n.RecvDealData(a),n.AutoUpdateEvent(!0,"JSDealChartContainer::RequestDealData"),n.AutoUpdate()}),e.PreventDefault==!0)return}var t=m.CacheDomain+"/cache/dealday/today/"+this.Symbol+".json";Lt.HttpRequest({url:t,type:"get",dataType:"json",async:!0,success:function(s){n.ChartSplashPaint.EnableSplash(!1),n.RecvDealData(s),n.AutoUpdate(1)},error:function(s,o){n.ChartSplashPaint.EnableSplash(!1),n.AutoUpdate()}})},this.RecvDealData=function(n){var e=es.JsonDataToDealData(n);this.SourceData={DataOffset:0,Data:e},this.Data={DataOffset:0,Data:this.FilterData(this.CloneArray(e))},this.Symbol=n.symbol,this.Name=n.name;var t=this.ChartPaint[0];if(t.Data=this.Data,t.Symbol=this.Symbol,t.YClose=n.yclose,t.Open=n.open,this.IsShowLastPage){var a=t.GetPageSize(!0),s=e.length-a;s<0&&(s=0),this.Data.DataOffset=s}this.Draw()},this.RequestDealUpdateData=function(){var n=this;if(this.NetworkFilter){var e={Name:"JSDealChartContainer::RequestDealUpdateData",Explain:"增量成交明细",Request:{Data:{symbol:n.Symbol}},Self:this,PreventDefault:!1};if(this.Data&&c.IsNonEmptyArray(this.Data.Data)){var t=this.Data.Data[this.Data.Data.length-1];e.LastItem=t}if(this.NetworkFilter(e,function(a){n.RecvDealUpdateData(a),n.AutoUpdate()}),e.PreventDefault==!0)return}},this.RecvDealUpdateData=function(n){var e=es.JsonDataToDealData(n);c.IsNonEmptyArray(e)&&(n.UpdateType===1?(this.SourceData.Data=e,this.Data.Data=this.FilterData(this.CloneArray(e)),this.Data.DataOffset>=this.Data.Data.length&&(this.Data.DataOffset=0)):(this.AddDealData(this.SourceData,e),this.AddDealData(this.Data,this.FilterData(e))),this.Draw())},this.AddDealData=function(n,e){if(!n.Data)n.Data=e;else{var t=0,a=this.ChartPaint[0];a&&(t=a.GetPageSize());for(var s=0;s<e.length;++s)n.Data.push(e[s]),n.DataOffset+t<n.Data.length&&++n.DataOffset}},this.AutoUpdate=function(n){if(this.CancelAutoUpdate(),!!this.IsAutoUpdate&&this.Symbol){var e=this,t=W.GetMarketStatus(this.Symbol);if(!(t==0||t==3)){var a=this.AutoUpdateFrequency;t==1?this.AutoUpdateTimer=setTimeout(function(){e.AutoUpdate()},a):t==2&&(this.AutoUpdateTimer=setTimeout(function(){e.RequestDealUpdateData()},a))}}},this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"JSDealChartContainer::StopAutoUpdate"),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.AddEventCallback=function(n){if(!(!n||!n.event||!n.callback)){var e={Callback:n.callback,Source:n};this.mapEvent.set(n.event,e)}},this.RemoveEventCallback=function(n){this.mapEvent.has(n)&&this.mapEvent.delete(n)},this.GetEventCallback=function(n){if(!this.mapEvent.has(n))return null;var e=this.mapEvent.get(n);return e},this.OnSize=function(){if(this.Frame){this.SetSizeChange(!0);var n=this.ChartPaint[0];if(n&&this.Data&&this.Data.DataOffset>0&&c.IsNonEmptyArray(this.Data.Data)){var e=n.GetPageSize(!0);e+this.Data.DataOffset>=this.Data.Data.length&&this.GotoLastPage()}this.Draw()}},this.SetSizeChange=function(n){var e=this.ChartPaint[0];e&&(e.SizeChange=n)},this.OnWheel=function(n){if(X.Chart.Log("[JSDealChartContainer::OnWheel]",n),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)&&!(!this.Data||!c.IsNonEmptyArray(this.Data.Data))){var e=n.clientX-this.UIElement.getBoundingClientRect().left,t=n.clientY-this.UIElement.getBoundingClientRect().top,a=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),a=this.Canvas.isPointInPath(e,t),!!a){var s=this.ChartPaint[0];if(s){var o=n.wheelDelta;c.IsObjectExist(n.wheelDelta)||(o=n.deltaY*-.01),o<0?this.GotoNextPage()&&this.Draw():o>0&&this.GotoPreviousPage()&&this.Draw(),n.preventDefault?n.preventDefault():n.returnValue=!1}}}},this.OnKeyDown=function(n){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var e=n.keyCode?n.keyCode:n.which;switch(e){case 38:this.GotoPreviousPage()&&this.Draw();break;case 40:this.GotoNextPage()&&this.Draw();break}n.preventDefault?n.preventDefault():n.returnValue=!1}},this.GotoNextPage=function(){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return!1;var n=this.ChartPaint[0];if(!n)return!1;var e=n.GetPageSize();if(e>this.Data.Data.length)return!1;var t=this.Data.DataOffset+e;return t+e==this.Data.Data.length-1?!1:(t+e>this.Data.Data.length?this.Data.DataOffset=this.Data.Data.length-e:this.Data.DataOffset=t,!0)},this.GotoPreviousPage=function(){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return!1;var n=this.ChartPaint[0];if(!n||this.Data.DataOffset<=0)return!1;var e=n.GetPageSize(),t=this.Data.DataOffset;return t-=e,t<0&&(t=0),this.Data.DataOffset=t,!0},this.GotoLastPage=function(){var n=this.ChartPaint[0];if(n){var e=n.GetPageSize(!0),t=this.Data.Data.length-e;t<0&&(t=0),this.Data.DataOffset=t}},this.SetColumn=function(n,e){var t=this.ChartPaint[0];t&&(t.SetColumn(n),t.SizeChange=!0,e&&e.Redraw&&this.Draw())},this.ReloadResource=function(n){this.Frame.ReloadResource(n);for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.ReloadResource&&t.ReloadResource(n)}n&&n.Redraw&&(this.SetSizeChange(!0),this.Draw())}}es.JsonDataToDealData=function(r){r.symbol;var n=[];if(!c.IsNonEmptyArray(r.detail))return n;for(var e=0;e<r.detail.length;++e){var t=r.detail[e],a={Time:t[0],Price:t[1],Vol:t[2],BS:t[4],Amount:t[3]};a.Source=t,t[5]&&(a.StrTime=t[5]),t[6]&&(a.ID=t[6]),n.push(a)}return n};function yI(){this.ChartBorder,this.Canvas,this.BorderColor=m.DealList.BorderColor,this.LogoTextColor=m.FrameLogo.TextColor,this.LogoTextFont=m.FrameLogo.Font,this.ReloadResource=function(r){this.BorderColor=m.DealList.BorderColor,this.LogoTextColor=m.FrameLogo.TextColor,this.LogoTextFont=m.FrameLogo.Font},this.Draw=function(r){var n=L(this.ChartBorder.GetLeft()),e=L(this.ChartBorder.GetTop()),t=L(this.ChartBorder.GetRight()),a=L(this.ChartBorder.GetBottom()),s=t-n,o=a-e;c.IsNumber(this.BorderLine)?(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),(this.BorderLine&1)>0&&(this.Canvas.moveTo(n,e),this.Canvas.lineTo(t,e)),(this.BorderLine&2)>0&&(this.Canvas.moveTo(n,a),this.Canvas.lineTo(t,a)),(this.BorderLine&4)>0&&(this.Canvas.moveTo(n,e),this.Canvas.lineTo(n,a)),(this.BorderLine&8)>0&&(this.Canvas.moveTo(t,e),this.Canvas.lineTo(t,a)),this.Canvas.stroke()):(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(n,e,s,o))},this.DrawLogo=function(){var r=m.FrameLogo.Text;if(c.IsString(r)){this.Canvas.fillStyle=this.LogoTextColor,this.Canvas.font=this.LogoTextFont,this.Canvas.textAlign="left",this.Canvas.textBaseline="bottom";var n=this.ChartBorder.GetLeft()+5,e=this.ChartBorder.GetBottom()-5;this.Canvas.fillText(r,n,e)}}}var ue={TIME_ID:0,PRICE_ID:1,VOL_ID:2,DEAL_ID:3,BS_ID:4,UPDOWN_ID:5,STRING_TIME_ID:6,INDEX_ID:7,MULTI_BAR_ID:8,CENTER_BAR_ID:9,CUSTOM_TEXT_ID:10};function PI(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ChartDealList",this.IsDrawFirst=!1,this.GetEventCallback,this.Data,this.Symbol,this.YClose,this.Open,this.Decimal=2,this.IsSingleTable=!1,this.IsShowHeader=!0,this.SizeChange=!0,this.UpColor=m.DealList.UpTextColor,this.DownColor=m.DealList.DownTextColor,this.UnchagneColor=m.DealList.UnchagneTextColor,this.BorderColor=m.DealList.BorderColor,this.HeaderFontConfig={Size:m.DealList.Header.Font.Size,Name:m.DealList.Header.Font.Name},this.HeaderColor=m.DealList.Header.Color,this.HeaderMergin={Left:m.DealList.Header.Mergin.Left,Right:m.DealList.Header.Mergin.Right,Top:m.DealList.Header.Mergin.Top,Bottom:m.DealList.Header.Mergin.Bottom},this.ItemFontConfig={Size:m.DealList.Row.Font.Size,Name:m.DealList.Row.Font.Name},this.RowMergin={Top:m.DealList.Row.Mergin.Top,Bottom:m.DealList.Row.Mergin.Bottom},this.BarMergin={Top:m.DealList.Row.BarMergin.Top,Left:m.DealList.Row.BarMergin.Left,Right:m.DealList.Row.BarMergin.Right,Bottom:m.DealList.Row.BarMergin.Bottom},this.HeaderFont=12*V()+"px 微软雅黑",this.ItemFont=15*V()+"px 微软雅黑",this.RowCount=0,this.TableWidth=0,this.TableCount=0,this.HeaderHeight=0,this.Column=[{Type:ue.TIME_ID,Title:"时间",TextAlign:"center",Width:null,TextColor:m.DealList.FieldColor.Time,MaxText:"88:88:88",Foramt:"HH:MM:SS"},{Type:ue.PRICE_ID,Title:"价格",TextAlign:"center",Width:null,MaxText:"888888.88"},{Type:ue.VOL_ID,Title:"成交",TextAlign:"right",Width:null,TextColor:m.DealList.FieldColor.Vol,MaxText:"888888"},{Type:ue.BS_ID,Title:"",TextAlign:"right",Width:null,MaxText:"擎"}],this.RectClient={},this.ReloadResource=function(r){this.UpColor=m.DealList.UpTextColor,this.DownColor=m.DealList.DownTextColor,this.UnchagneColor=m.DealList.UnchagneTextColor,this.BorderColor=m.DealList.BorderColor,this.HeaderFontConfig={Size:m.DealList.Header.Font.Size,Name:m.DealList.Header.Font.Name},this.HeaderColor=m.DealList.Header.Color,this.HeaderMergin={Left:m.DealList.Header.Mergin.Left,Right:m.DealList.Header.Mergin.Right,Top:m.DealList.Header.Mergin.Top,Bottom:m.DealList.Header.Mergin.Bottom},this.ItemFontConfig={Size:m.DealList.Row.Font.Size,Name:m.DealList.Row.Font.Name},this.RowMergin={Top:m.DealList.Row.Mergin.Top,Bottom:m.DealList.Row.Mergin.Bottom};for(var n=0;n<this.Column.length;++n){var e=this.Column[n];e.Type==ue.TIME_ID||e.Type==ue.STRING_TIME_ID?e.TextColor=m.DealList.FieldColor.Time:e.Type==ue.VOL_ID?e.TextColor=m.DealList.FieldColor.Vol:e.Type==ue.DEAL_ID?e.TextColor=m.DealList.FieldColor.Deal:e.Type==ue.INDEX_ID&&(e.TextColor=m.DealList.FieldColor.Index)}},this.SetColumn=function(r){if(c.IsNonEmptyArray(r)){this.Column=[];for(var n=0;n<r.length;++n){var e=r[n],t=this.GetDefaultColunm(e.Type);if(t){if(e.Title&&(t.Title=e.Title),e.TextAlign&&(t.TextAlign=e.TextAlign),e.TextColor&&(t.TextColor=e.TextColor),e.MaxText&&(t.MaxText=e.MaxText),e.Type==ue.MULTI_BAR_ID||e.Type==ue.CENTER_BAR_ID){if(!c.IsNumber(e.DataIndex))continue;t.DataIndex=e.DataIndex}this.Column.push(t)}}}},this.GetDefaultColunm=function(r){for(var n=[{Type:ue.TIME_ID,Title:"时间",TextAlign:"center",Width:null,TextColor:m.DealList.FieldColor.Time,MaxText:"88:88:88",Foramt:"HH:MM:SS"},{Type:ue.PRICE_ID,Title:"价格",TextAlign:"center",Width:null,MaxText:"888888.88"},{Type:ue.VOL_ID,Title:"成交",TextAlign:"right",Width:null,TextColor:m.DealList.FieldColor.Vol,MaxText:"888888"},{Type:ue.BS_ID,Title:"",TextAlign:"right",Width:null,MaxText:"擎"},{Type:ue.DEAL_ID,Title:"笔数",TextAlign:"right",Width:null,TextColor:m.DealList.FieldColor.Deal,MaxText:"8888"},{Type:ue.UPDOWN_ID,Title:"涨跌",TextAlign:"right",Width:null,MaxText:"-8888.88"},{Type:ue.STRING_TIME_ID,Title:"时间",TextAlign:"center",Width:null,TextColor:m.DealList.FieldColor.Time,MaxText:"88:88:88"},{Type:ue.INDEX_ID,Title:"序号",TextAlign:"center",Width:null,TextColor:m.DealList.FieldColor.Index,MaxText:"88888"},{Type:ue.MULTI_BAR_ID,Title:"柱子",TextAlign:"center",Width:null,TextColor:m.DealList.FieldColor.BarTitle,MaxText:"888888"},{Type:ue.CENTER_BAR_ID,Title:"柱子2",TextAlign:"center",Width:null,TextColor:m.DealList.FieldColor.BarTitle,MaxText:"888888"},{Type:ue.CUSTOM_TEXT_ID,Title:"自定义",TextAlign:"center",Width:null,TextColor:m.DealList.FieldColor.Text,MaxText:"擎擎擎擎擎"}],e=0;e<n.length;++e){var t=n[e];if(t.Type==r)return t}return null},this.Draw=function(){this.SizeChange?this.CalculateSize():this.UpdateCacheData(),this.DrawBorder(),this.DrawHeader(),this.DrawBody(),this.SizeChange=!1},this.UpdateCacheData=function(){this.RectClient.Left=this.ChartBorder.GetLeft(),this.RectClient.Right=this.ChartBorder.GetRight(),this.RectClient.Top=this.ChartBorder.GetTop(),this.RectClient.Bottom=this.ChartBorder.GetBottom(),this.Decimal=fe(this.Symbol)},this.GetPageSize=function(r){r&&this.CalculateSize();var n=this.TableCount*this.RowCount;return n},this.CalculateSize=function(){this.UpdateCacheData();var r=V();this.HeaderFont=this.HeaderFontConfig.Size*r+"px "+this.HeaderFontConfig.Name,this.ItemFont=this.ItemFontConfig.Size*r+"px "+this.ItemFontConfig.Name,this.Canvas.font=this.ItemFont;for(var n=0,e=0,t=0;t<this.Column.length;++t){var a=this.Column[t];e=this.Canvas.measureText(a.MaxText).width,a.Width=e+4,n+=a.Width}var s=this.RectClient.Right-this.RectClient.Left;this.TableCount=parseInt(s/n),this.IsSingleTable&&(this.TableCount=1),this.TableWidth=s/this.TableCount,this.HeaderHeight=this.GetFontHeight(this.HeaderFont,"擎")+this.HeaderMergin.Top+this.HeaderMergin.Bottom,this.IsShowHeader||(this.HeaderHeight=0),this.RowHeight=this.GetFontHeight(this.ItemFont,"擎")+this.HeaderMergin.Top+this.HeaderMergin.Bottom,this.RowCount=parseInt((this.RectClient.Bottom-this.RectClient.Top-this.HeaderHeight)/this.RowHeight)},this.DrawHeader=function(){if(this.IsShowHeader){var r=this.RectClient.Left+this.HeaderMergin.Left,n=this.RectClient.Top,e=n+this.HeaderMergin.Top+(this.HeaderHeight-this.HeaderMergin.Top-this.HeaderMergin.Bottom)/2;this.Canvas.font=this.HeaderFont,this.Canvas.fillStyle=this.HeaderColor;for(var t=0,a=0;t<this.TableCount;++t){var s=r+this.TableWidth*t,o=s;for(a=0;a<this.Column.length;++a){var h=this.Column[a],l=h.Width;a==this.Column.length-1&&(l=this.TableWidth-(o-s)-this.HeaderMergin.Right-this.HeaderMergin.Left);var u=o;h.TextAlign=="center"?(u=o+l/2,this.Canvas.textAlign="center"):h.TextAlign=="right"?(u=o+l,this.Canvas.textAlign="right"):this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(h.Title,u,e),o+=h.Width}}}},this.DrawBorder=function(){var r=L(this.RectClient.Left),n=L(this.RectClient.Right),e=L(this.RectClient.Top),t=L(this.RectClient.Bottom);this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),this.IsShowHeader&&(this.Canvas.moveTo(r,e+this.HeaderHeight),this.Canvas.lineTo(n,e+this.HeaderHeight));for(var a=L(r+this.TableWidth),s=1;s<this.TableCount;++s)this.Canvas.moveTo(a,e),this.Canvas.lineTo(a,t),a=L(a+this.TableWidth);this.Canvas.stroke()},this.DrawBody=function(){if(this.Data&&c.IsNonEmptyArray(this.Data.Data)){this.Canvas.font=this.ItemFont;for(var r=this.RectClient.Top+this.HeaderHeight,n=this.RectClient.Left+this.HeaderMergin.Left,e=this.Data.Data.length,t=this.Data.DataOffset,a=0,s=0;a<this.TableCount;++a){var o=n+this.TableWidth*a,h=o,l=r;for(s=0;s<this.RowCount&&t<e;++s,++t){var u=this.Data.Data[t];this.DrawRow(u,h,l,t),l+=this.RowHeight}}}},this.DrawRow=function(r,n,e,t,a){for(var s=n,o=n+this.TableWidth,h=0;h<this.Column.length;++h){var l=this.Column[h],u=l.TextColor,f=null,C=l.Width,D=l.TextAlign;if(n+C>o)break;if(h==this.Column.length-1&&(C=this.TableWidth-(n-s)-this.HeaderMergin.Right-this.HeaderMergin.Left),l.Type==ue.TIME_ID)f=c.FormatTimeString(r.Time,l.Foramt);else if(l.Type==ue.STRING_TIME_ID)f=r.StrTime;else if(l.Type==ue.PRICE_ID)r.Price>this.YClose?u=this.UpColor:r.Price<this.YClose?u=this.DownColor:u=this.UnchagneColor,f=r.Price.toFixed(this.Decimal);else if(l.Type==ue.VOL_ID)f=c.FormatValueString(r.Vol,0),u=this.GetVolColor(l,r);else if(l.Type==ue.DEAL_ID)f=c.FormatValueString(r.Deal,0);else if(l.Type==ue.BS_ID)r.BS==1?(f="B",u=this.UpColor):r.BS==2&&(f="S",u=this.DownColor);else if(l.Type==ue.UPDOWN_ID){if(c.IsNumber(this.YClose)){var v=r.Price-this.YClose;f=v.toFixed(2),v>0?u=this.UpColor:v<0?u=this.DownColor:u=this.UnchagneColor}}else if(l.Type==ue.INDEX_ID)f=(t+1).toString();else if(l.Type==ue.MULTI_BAR_ID){var S={Left:n,Top:e,Width:C,Height:this.RowHeight};this.DrawMultiBar(l,r,S)}else if(l.Type==ue.CENTER_BAR_ID){var S={Left:n,Top:e,Width:C,Height:this.RowHeight};this.DrawCenterBar(l,r,S)}else if(l.Type==ue.CUSTOM_TEXT_ID){var T={Text:null,TextColor:null,TextAlign:null},S={Left:n,Top:e,Width:C,Height:this.RowHeight};this.DrawCustomText(l,r,S,t,h,T)&&(T.Text&&(f=T.Text),T.TextColor&&(u=T.TextColor),T.TextAlign&&(D=T.TextAlign))}this.DrawItemText(f,u,D,n,e,C),n+=l.Width}},this.DrawItemText=function(r,n,e,t,a,s){var o=t;e=="center"?(o=t+s/2,this.Canvas.textAlign="center"):e=="right"?(o=t+s,this.Canvas.textAlign="right"):this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillStyle=n,r&&this.Canvas.fillText(r,o,a+this.RowHeight/2)},this.DrawMultiBar=function(r,n,e){if(!n.Source||!c.IsNonEmptyArray(n.Source))return!1;var t=n.Source[r.DataIndex];if(!t||!c.IsNonEmptyArray(t.Value))return!1;for(var a=e.Width-this.BarMergin.Left-this.BarMergin.Right,s=e.Left+this.BarMergin.Left,o=e.Top+this.RowMergin.Top+this.BarMergin.Top,h=e.Height-this.RowMergin.Top-this.RowMergin.Bottom-this.BarMergin.Top-this.BarMergin.Bottom,l=s+a,u=0;u<t.Value.length;++u){var f=t.Value[u];if(!(f<=0)){if(s>=l)break;var C=a*f;C<1&&(C=1),s+C>l&&(C=l-s);var D=u;c.IsNonEmptyArray(t.Color)&&u<t.Color.length&&(D=t.Color[u]),this.Canvas.fillStyle=m.DealList.FieldColor.Bar[D],this.Canvas.fillRect(s,o,C,h),s+=C}}return!0},this.DrawCenterBar=function(r,n,e){if(!n.Source||!c.IsNonEmptyArray(n.Source))return!1;var t=n.Source[r.DataIndex];if(!t||!c.IsNonEmptyArray(t.Value))return!1;for(var a=(e.Width-this.BarMergin.Left-this.BarMergin.Right)/2,s=e.Left+this.BarMergin.Left,o=s+a,h=e.Top+this.RowMergin.Top+this.BarMergin.Top,l=e.Height-this.RowMergin.Top-this.RowMergin.Bottom-this.BarMergin.Top-this.BarMergin.Bottom,u=0;u<t.Value.length&&u<2;++u){var f=t.Value[u];if(!(f<=0)){f>1&&(f=1);var C=a*f;C<1&&(C=1);var D=u;c.IsNonEmptyArray(t.Color)&&u<t.Color.length&&(D=t.Color[u]),this.Canvas.fillStyle=m.DealList.FieldColor.Bar[D],u==0?this.Canvas.fillRect(o,h,-C,l):this.Canvas.fillRect(o,h,C,l)}}},this.DrawCustomText=function(r,n,e,t,a,s){var o=this.GetEventCallback(et.ON_DRAW_DEAL_TEXT);if(!o||!o.Callback)return!1;var h={Data:n,DataIndex:t,ColumnIndex:a,ColumnInfo:r,Out:{Text:null,TextColor:null,TextAlign:null}};return o.Callback(o,h,this),h.Out.Text?(s.Text=h.Out.Text,h.Out.TextColor&&(s.TextColor=h.Out.TextColor),h.Out.TextAlign&&(s.TextAlign=h.Out.TextAlign),!0):!1},this.GetVolColor=function(r,n){var e=this.GetEventCallback(et.ON_DRAW_DEAL_VOL_COLOR);if(e&&e.Callback){var t={Data:n,TextColor:null};if(e.Callback(e,t,this),t.TextColor)return t.TextColor}return r.TextColor},this.GetFontHeight=function(r,n){return Aa(this.Canvas,r,n)}}function nn(r){this.DivElement=r,this.JSChartContainer,this.CanvasElement=document.createElement("canvas"),this.CanvasElement.className="jsreportlist-drawing",this.CanvasElement.id=oe(),this.CanvasElement.setAttribute("tabindex",0),this.CanvasElement.style&&(this.CanvasElement.style.outline="none"),r.hasChildNodes()&&X.Chart.Log("[JSReportChart::JSReportChart] divElement hasChildNodes",r.childNodes),r.appendChild(this.CanvasElement),this.OnSize=function(){var n=parseInt(this.DivElement.style.height.replace("px",""));this.CanvasElement.height=n,this.CanvasElement.width=parseInt(this.DivElement.style.width.replace("px","")),this.CanvasElement.style.width=this.CanvasElement.width+"px",this.CanvasElement.style.height=this.CanvasElement.height+"px";var e=V();this.CanvasElement.height*=e,this.CanvasElement.width*=e,X.Chart.Log("[JSReportChart::OnSize] devicePixelRatio="+window.devicePixelRatio+", height="+this.CanvasElement.height+", width="+this.CanvasElement.width),this.JSChartContainer&&this.JSChartContainer.OnSize&&this.JSChartContainer.OnSize()},this.SetOption=function(n){var e=this.CreateJSReportChartContainer(n);if(!e)return!1;n.OnCreatedCallback&&n.OnCreatedCallback(e),this.JSChartContainer=e,this.DivElement.JSChart=this,n.Symbol&&(e.Symbol=n.Symbol),n.Name&&(e.Name=n.Name);var t={Callback:null};e.Symbol&&(t.Callback=function(){e.RequestMemberListData()}),e.RequestStockListData(t)},this.CreateJSReportChartContainer=function(n){var e=new wI(this.CanvasElement);if(e.Create(n),n.NetworkFilter&&(e.NetworkFilter=n.NetworkFilter),c.IsNonEmptyArray(n.Column)&&e.SetColumn(n.Column),c.IsNonEmptyArray(n.Tab)&&e.SetTab(n.Tab),c.IsNumber(n.TabSelected)&&e.SetSelectedTab(n.TabSelected),c.IsBool(n.EnableDragRow)&&(e.EnableDragRow=n.EnableDragRow),c.IsNumber(n.DragRowType)&&(e.DragRowType=n.DragRowType),c.IsBool(n.EnableDragHeader)&&(e.EnableDragHeader=n.EnableDragHeader),n.SortInfo){var t=n.SortInfo;c.IsNumber(t.Field)&&(e.SortInfo.Field=t.Field),c.IsNumber(t.Sort)&&(e.SortInfo.Sort=t.Sort)}if(this.SetChartBorder(e,n),n.IsAutoUpdate!=null&&(e.IsAutoUpdate=n.IsAutoUpdate),n.AutoUpdateFrequency>0&&(e.AutoUpdateFrequency=n.AutoUpdateFrequency),c.IsBool(n.EnableFilter)&&(e.EnableFilter=n.EnableFilter),n.EventCallback)for(var a=0;a<n.EventCallback.length;++a){var t=n.EventCallback[a];e.AddEventCallback(t)}return e},this.SetChartBorder=function(n,e){if(e.Border){e.Border,c.IsNumber(e.Border.Left)&&(n.Frame.ChartBorder.Left=e.Border.Left),c.IsNumber(e.Border.Right)&&(n.Frame.ChartBorder.Right=e.Border.Right),c.IsNumber(e.Border.Top)&&(n.Frame.ChartBorder.Top=e.Border.Top),c.IsNumber(e.Border.Bottom)&&(n.Frame.ChartBorder.Bottom=e.Border.Bottom);var t=V();n.Frame.ChartBorder.Left*=t,n.Frame.ChartBorder.Right*=t,n.Frame.ChartBorder.Top*=t,n.Frame.ChartBorder.Bottom*=t}},this.ChangeSymbol=function(n,e){this.JSChartContainer&&this.JSChartContainer.ChangeSymbol(n,e)},this.SetColumn=function(n,e){this.JSChartContainer&&this.JSChartContainer.SetColumn(n,e)},this.EnableFilter=function(n,e){this.JSChartContainer&&this.JSChartContainer.EnableFilter(n,e)},this.AddEventCallback=function(n){this.JSChartContainer&&typeof this.JSChartContainer.AddEventCallback=="function"&&(X.Chart.Log("[JSReportChart:AddEventCallback] obj=",n),this.JSChartContainer.AddEventCallback(n))},this.ReloadResource=function(n){this.JSChartContainer&&typeof this.JSChartContainer.ReloadResource=="function"&&(X.Chart.Log("[JSReportChart:ReloadResource] "),this.JSChartContainer.ReloadResource(n))},this.ChartDestory=function(){this.JSChartContainer&&typeof this.JSChartContainer.ChartDestory=="function"&&this.JSChartContainer.ChartDestory()},this.Draw=function(){this.JSChartContainer&&typeof this.JSChartContainer.Draw=="function"&&(X.Chart.Log("[JSReportChart:Draw] "),this.JSChartContainer.Draw())}}nn.Init=function(r){var n=new nn(r);return n.OnSize(),n};nn.SetStyle=function(r){r&&m.SetStyle(r)};nn.GetResource=function(){return m};function Wn(){this.OriginalSymbol,this.Symbol,this.Name,this.YClose,this.Open,this.Price,this.High,this.Low,this.Amount,this.Vol,this.Increase,this.UpDown,this.Exchange,this.Amplitude,this.BuyPrice,this.BuyVol,this.SellPrice,this.SellVol,this.AvPrice,this.LimitHigh,this.LimitLow,this.VolIn,this.VolOut,this.DealNum,this.OutShares,this.TotalShares,this.MarketValue,this.CircMarketValue,this.CloseLine,this.ExtendData}function wI(r){this.ClassName="JSReportChartContainer",this.Frame,this.ChartPaint=[],this.ChartSplashPaint=null,this.LoadDataSplashTitle="数据加载中",this.SplashTitle={StockList:"下载码表中.....",MemberList:"下载成分中....."},this.Canvas=r.getContext("2d"),this.Tooltip=document.createElement("div"),this.Tooltip.className="jsreport-tooltip",this.Tooltip.style.background=m.TooltipBGColor,this.Tooltip.style.opacity=m.TooltipAlpha,this.Tooltip.style["pointer-events"]="none",this.Tooltip.id=oe(),r.parentNode.appendChild(this.Tooltip),this.Symbol,this.Name,this.NetworkFilter,this.Data={XOffset:0,YOffset:0,Data:[]},this.SourceData={Data:[]},this.BlockData=new Dt.default,this.MapStockData=new Dt.default,this.FixedRowData={Data:[],Type:0,Symbol:[]},this.FlashBG=new Dt.default,this.FlashBGTimer=null,this.GlobalOption={FlashBGCount:0},this.SortInfo={Field:-1,Sort:0},this.DragRow,this.DragColumnWidth,this.EnableDragRow=!1,this.DragRowType=0,this.AutoDragScrollTimer=null,this.EnablePageScroll=!1,this.DragMove,this.DragHeader,this.EnableDragHeader=!1,this.mapEvent=new Dt.default,this.AutoUpdateTimer=null,this.AutoUpdateFrequency=15e3,this.DelayUpdateTimer=null,this.DelayUpdateFrequency=500,this.UIElement=r,this.LastPoint=new ot,this.IsOnTouch=!1,this.TouchDrag,this.TouchMoveMinAngle=70,this.YStepPixel=5*V(),this.XStepPixel=10*V(),this.PageUpDownCycle=!0,this.DragPageCycle=!0,this.DragXScroll=null,this.IsDestroy=!1,this.ChartDestory=function(){this.IsDestroy=!0,this.StopAutoUpdate()},this.StopAutoDragScrollTimer=function(){X.Chart.Log("[JSReportChartContainer::StopAutoDragScrollTimer] stop "),this.EnablePageScroll=!1,this.AutoDragScrollTimer!=null&&(clearTimeout(this.AutoDragScrollTimer),this.AutoDragScrollTimer=null)},this.AutoScrollPage=function(n){var e=this;this.AutoDragScrollTimer=setTimeout(function(){e.ChartOperator_Temp_ScrollPage(n)},300)},this.ChartOperator_Temp_ScrollPage=function(n){if(this.EnablePageScroll){var e=this.GetReportChart();if(e){if(n>0){var t=e.GetCurrentPageStatus();if(t.IsEnd)return;this.MoveYOffset(n,!1),++n}else if(n<0){if(this.Data.YOffset<=0)return;this.MoveYOffset(n,!1),--n}else return;this.Draw(),this.EnablePageScroll&&this.AutoScrollPage(n)}}},this.ClearFixedRowData=function(){this.FixedRowData.Data=[],this.FixedRowData.Symbol=[]},this.SetFixedRowCount=function(n){var e=this.GetReportChart();e&&(e.FixedRowCount=n)},this.Create=function(n){var e=this;this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new Qa,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.IsEnableSplash=!0,this.Frame=new BI,this.Frame.ChartBorder=new We,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartSplashPaint.Frame=this.Frame;var t=new bI;if(t.Frame=this.Frame,t.ChartBorder=this.Frame.ChartBorder,t.Canvas=this.Canvas,t.UIElement=this.UIElement,t.GetEventCallback=function(f){return e.GetEventCallback(f)},t.GetStockDataCallback=function(f){return e.GetStockData(f)},t.GetBlockDataCallback=function(f){return e.GetBlockData(f)},t.GetFlashBGDataCallback=function(f,C){return e.GetFlashBGData(f,C)},t.Data=this.Data,t.GlobalOption=this.GlobalOption,t.FixedRowData=this.FixedRowData,t.SortInfo=this.SortInfo,t.Tab=new GI,t.Tab.Frame=this.Frame,t.Tab.Canvas=this.Canvas,t.Tab.ChartBorder=this.Frame.ChartBorder,t.Tab.Report=t,this.ChartPaint[0]=t,n&&n.PageInfo===!0){var a=new VI;a.Frame=this.Frame,a.ChartBorder=this.Frame.ChartBorder,a.Canvas=this.Canvas,a.Report=t,this.ChartPaint[1]=a}if(n&&(c.IsBool(n.IsShowHeader)&&(t.IsShowHeader=n.IsShowHeader),c.IsNumber(n.FixedColumn)&&(t.FixedColumn=n.FixedColumn),c.IsNumber(n.BorderLine)&&(this.Frame.BorderLine=n.BorderLine),c.IsBool(n.TabShow)&&(t.Tab.IsShow=n.TabShow),c.IsNumber(n.FixedRowCount)&&(t.FixedRowCount=n.FixedRowCount),c.IsBool(n.ItemBorder)&&(t.IsDrawBorder=n.ItemBorder),c.IsNumber(n.SelectedModel)&&(t.SelectedModel=n.SelectedModel),c.IsNonEmptyArray(n.FixedSymbol))){t.FixedRowCount=0,this.FixedRowData.Type=1,this.FixedRowData.Symbol=[];for(var s=n.FixedSymbol,o=0;o<s.length;++o){var h=s[o];this.FixedRowData.Symbol.push(h.Symbol),++t.FixedRowCount}}var l=!0,u=!0;n&&(n.KeyDown===!1&&(l=!1,X.Chart.Log("[JSDealChartContainer::Create] not register keydown event.")),n.Wheel===!1&&(u=!1,X.Chart.Log("[JSDealChartContainer::Create] not register wheel event."))),l&&this.UIElement.addEventListener("keydown",function(f){e.OnKeyDown(f)},!0),u&&this.UIElement.addEventListener("wheel",function(f){e.OnWheel(f)},!0),this.UIElement.ondblclick=function(f){e.UIOnDblClick(f)},this.UIElement.onmousedown=function(f){e.UIOnMouseDown(f)},this.UIElement.onmouseup=function(f){e.UIOnMounseUp(f)},this.UIElement.oncontextmenu=function(f){e.UIOnContextMenu(f)},this.UIElement.onmousemove=function(f){e.UIOnMouseMove(f)},this.UIElement.onmouseout=function(f){e.UIOnMounseOut(f)},this.UIElement.onmouseleave=function(f){e.UIOnMouseleave(f)},this.UIElement.ontouchstart=function(f){e.OnTouchStart(f)},this.UIElement.ontouchmove=function(f){e.OnTouchMove(f)},this.UIElement.ontouchend=function(f){e.OnTouchEnd(f)}},this.Draw=function(){if(!(this.UIElement.width<=0||this.UIElement.height<=0)){this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height);var n=V();if(this.Canvas.lineWidth=n,this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash){this.Frame.Draw({IsEnableSplash:this.ChartSplashPaint.IsEnableSplash}),this.ChartSplashPaint.Draw();return}this.Frame.Draw(),this.Frame.DrawLogo();for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.IsDrawFirst&&t.Draw()}for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.IsDrawFirst||t.Draw()}this.GlobalOption.FlashBGCount>0&&this.DelayDraw(500)}},this.DelayDraw=function(n){var e=this;typeof this.FlashBGTimer=="number"&&(clearTimeout(this.FlashBGTimer),this.FlashBGTimer=null),this.FlashBGTimer=setTimeout(function(){e.Draw()},n)},this.ResetReportStatus=function(){this.Data.XOffset=0,this.Data.YOffset=0},this.ResetReportSelectStatus=function(){var n=this.GetReportChart();n&&(n.SelectedRow=-1,n.SelectedFixedRow=-1)},this.ClearData=function(){this.SourceData.Data=[],this.Data.Data=[],this.BlockData=new Dt.default},this.ResetSortStatus=function(){this.SortInfo.Field=-1,this.SortInfo.Sort=0},this.SetSymbolList=function(n,e){if(this.ClearData(),this.ResetReportStatus(),this.ResetSortStatus(),c.IsNonEmptyArray(n))for(var t=0;t<n.length;++t)this.Data.Data.push(n[t]);var a=this.ChartPaint[0];a&&(a.Data=this.Data),this.Draw()},this.ChangeSymbol=function(n,e){if(this.Symbol=n,this.ClearData(),this.ResetReportStatus(),this.ResetSortStatus(),this.ResetReportSelectStatus(),e){if(c.IsNumber(e.TabSelected)){var t=this.GetTabChart();t&&(t.SelectedTabIndex=e.TabSelected)}if(Array.isArray(e.FixedSymbol)){var a=this.GetReportChart();if(a){a.FixedRowCount=0,this.FixedRowData.Type=1,this.FixedRowData.Symbol=[];for(var s=e.FixedSymbol,o=0;o<s.length;++o){var h=s[o];this.FixedRowData.Symbol.push(h.Symbol),++a.FixedRowCount}this.SetSizeChange(!0)}}if(e.SortInfo){var h=e.SortInfo;c.IsNumber(h.Field)&&(this.SortInfo.Field=h.Field),c.IsNumber(h.Sort)&&(this.SortInfo.Sort=h.Sort)}}this.RequestMemberListData()},this.RequestMemberListData=function(){var n=this;if(this.NetworkFilter){var e={Name:"JSReportChartContainer::RequestMemberListData",Explain:"板块成分数据",Request:{Data:{symbol:this.Symbol}},Self:this,PreventDefault:!1};if(this.SortInfo.Field>=0&&this.SortInfo.Sort>0){var t=this.GetReportChart();if(t){var a=t.Column[this.SortInfo.Field];e.Sort={Column:a,Field:this.SortInfo.Field,Sort:this.SortInfo.Sort}}}if(this.NetworkFilter(e,function(s){n.ChartSplashPaint.EnableSplash(!1),n.RecvMemberListData(s)}),e.PreventDefault==!0)return}throw{Name:"JSReportChartContainer::RequestMemberListData",Error:"(板块成分数据)不提供内置测试数据"}},this.RecvMemberListData=function(n){if(this.ClearData(),c.IsNonEmptyArray(n.data))for(var e=0;e<n.data.length;++e)this.Data.Data.push(n.data[e]),this.SourceData.Data.push(n.data[e]);this.Draw(),this.UpdateStockData()},this.AutoUpdateEvent=function(n,e){var t=n?et.RECV_START_AUTOUPDATE:et.RECV_STOP_AUTOUPDATE;if(this.mapEvent.has(t)){var a=this,s=this.mapEvent.get(t),o={Stock:{Symbol:this.Symbol,Name:this.Name,DayCount:this.DayCount},Explain:e};n&&(o.Callback=function(h){a.RecvDealUpdateData(h)}),s.Callback(s,o,this)}},this.RequestStockListData=function(n){this.ChartSplashPaint.SetTitle(this.SplashTitle.StockList),this.ChartSplashPaint.EnableSplash(!0),this.Draw();var e=this;if(this.NetworkFilter){var t={Name:"JSReportChartContainer::RequestStockListData",Explain:"码表数据",Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(a){e.ChartSplashPaint.EnableSplash(!1),e.RecvStockListData(a,n)}),t.PreventDefault==!0)return}throw{Name:"JSReportChartContainer::RequestStockListData",Error:"(码表数据)不提供内置测试数据"}},this.RecvStockListData=function(n,e){if(c.IsNonEmptyArray(n.data))for(var t=0;t<n.data.length;++t){var a=n.data[t],s=a[0],o=null;this.MapStockData.has(s)?o=this.MapStockData.get(s):(o=new Wn,o.OriginalSymbol=s,this.MapStockData.set(s,o)),o.Symbol=this.GetSymbolNoSuffix(s),o.Name=a[1],this.ReadStockJsonData(o,a)}if(e&&e.Callback){e.Callback();return}this.Draw(),this.UpdateStockData()},this.UpdateMapStockData=function(n){if(!(!n||!c.IsNonEmptyArray(n.data)))for(var e=0;e<n.data.length;++e){var t=n.data[e],a=t[0],s=null;this.MapStockData.has(a)?s=this.MapStockData.get(a):(s=new Wn,s.OriginalSymbol=a,this.MapStockData.set(a,s)),s.Symbol=this.GetSymbolNoSuffix(a),s.Name=t[1],this.ReadStockJsonData(s,t)}},this.GetStockData=function(n){return!this.MapStockData||!this.MapStockData.has(n)?null:this.MapStockData.get(n)},this.GetBlockData=function(n){return!this.BlockData||!this.BlockData.has(n)?null:this.BlockData.get(n)},this.SetFlashBGItem=function(n,e){var t={ID:e.ID,Color:e.Color,Count:1};if(c.IsNumber(e.Count)&&(t.Count=e.Count),c.IsNumber(e.Time)?t.Time=e.Time:t.Time=Date.now(),this.FlashBG.has(n)){var a=this.FlashBG.get(n);a.LastTime=t.Time,a.Data.set(t.ID,t)}else{var a={LastTime:t.Time,Data:new Dt.default([[t.ID,t]])};this.FlashBG.set(n,a)}},this.GetFlashBGData=function(n,e){if(!this.FlashBG||!this.FlashBG.has(n))return null;var t=3*1e3,a=this.FlashBG.get(n);if(e-a.LastTime>=t)return this.FlashBG.delete(n),null;if(!a.Data||a.Data.size<=0)return this.FlashBG.delete(n),null;var s=[],o=!0,h=!1,l=void 0;try{for(var u=(0,we.default)(a.Data),f;!(o=(f=u.next()).done);o=!0){var C=f.value,D=C[1];(e-D.Time>=t||D.Count<=0)&&s.push(D.ID)}}catch(S){h=!0,l=S}finally{try{!o&&u.return&&u.return()}finally{if(h)throw l}}if(c.IsNonEmptyArray(s)){for(var v=0;v<s.length;++v)a.Data.delete(s[v]);if(a.Data.size<=0)return this.FlashBG.delete(n),null}return a},this.DelayUpdateStockData=function(){var n=this;this.DelayUpdateTimer!=null&&(clearTimeout(this.DelayUpdateTimer),this.DelayUpdateTimer=null);var e=this.DelayUpdateFrequency;this.DelayUpdateTimer=setTimeout(function(){n.UpdateStockData()},e)},this.UpdateStockData=function(){if(c.IsNonEmptyArray(this.Data.Data)){var n=this.ChartPaint[0];if(n){if(this.SortInfo&&this.SortInfo.Field>=0&&this.SortInfo.Sort>0){var e=n.Column[this.SortInfo.Field];if(e.Sort==2){this.RequestStockSortData(e,this.SortInfo.Field,this.SortInfo.Sort);return}}var t=n.ShowSymbol;c.IsNonEmptyArray(t)&&this.RequestStockData(t)}}},this.RequestStockData=function(n){var e=this;if(this.NetworkFilter){var t={Name:"JSDealChartContainer::RequestStockData",Explain:"报价列表股票数据",Request:{Data:{stocks:n}},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(a){e.RecvStockData(a),e.AutoUpdate()}),t.PreventDefault==!0)return}throw{Name:"JSReportChartContainer::RequestStockData",Error:"(报价列表股票数据)不提供内置测试数据"}},this.RecvStockData=function(n){var e=new Ee.default;if(c.IsNonEmptyArray(n.data))for(var t=0;t<n.data.length;++t){var a=n.data[t],s=a[0];if(s){var o=null;this.MapStockData.has(s)?o=this.MapStockData.get(s):(o=new Wn,o.OriginalSymbol=s,o.Symbol=this.GetSymbolNoSuffix(s),this.MapStockData.set(s,o)),this.ReadStockJsonData(o,a),e.has(s)||e.add(s)}}var h=this.ChartPaint[0];if(h){for(var l=!1,u=h.ShowSymbol,t=0;t<u.length;++t)if(e.has(u[t].Symbol)){l=!0;break}l&&this.Draw()}},this.ReadStockJsonData=function(n,e){c.IsString(e[1])&&(n.Name=e[1]),c.IsNumber(e[2])&&(n.YClose=e[2]),c.IsNumber(e[3])&&(n.Open=e[3]),c.IsNumber(e[4])&&(n.High=e[4]),c.IsNumber(e[5])&&(n.Low=e[5]),c.IsNumber(e[6])&&(n.Price=e[6]),c.IsNumber(e[7])&&(n.Vol=e[7]),c.IsNumber(e[8])&&(n.Amount=e[8]),c.IsNumber(e[9])&&(n.BuyPrice=e[9]),c.IsNumber(e[10])&&(n.BuyVol=e[10]),c.IsNumber(e[11])&&(n.SellPrice=e[11]),c.IsNumber(e[12])&&(n.SellVol=e[12]),c.IsNumber(e[13])&&(n.AvPrice=e[13]),c.IsNumber(e[14])&&(n.OutShares=e[14]),c.IsNumber(e[15])&&(n.TotalShares=e[15]),c.IsNumber(e[16])&&(n.LimitHigh=e[16]),c.IsNumber(e[17])&&(n.LimitLow=e[17]),c.IsNumber(e[18])&&(n.VolIn=e[18]),c.IsNumber(e[19])&&(n.VolOut=e[19]),c.IsNumber(e[20])&&(n.DealNum=e[20]),c.IsNumber(e[21])&&(n.Increase=e[21]),c.IsNumber(e[22])&&(n.UpDown=e[22]),c.IsNumber(e[23])&&(n.Exchange=e[23]),c.IsNumber(e[24])&&(n.Amplitude=e[24]),c.IsNumber(e[25])&&(n.CircMarketValue=e[25]),c.IsNumber(e[26])&&(n.MarketValue=e[26]),e[27]&&(n.NameEx=e[27]),c.IsNumber(e[21])||c.IsNumber(n.Price)&&c.IsNumber(n.YClose)&&n.YClose!=0&&(n.Increase=(n.Price-n.YClose)/n.YClose*100),c.IsNumber(e[22])||c.IsNumber(n.Price)&&c.IsNumber(n.YClose)&&(n.UpDown=n.Price-n.YClose),c.IsNumber(e[23])||c.IsNumber(n.Vol)&&c.IsNumber(n.OutShares)&&n.OutShares>0&&(n.Exchange=n.Vol/n.OutShares*100),c.IsNumber(e[24])||c.IsNumber(n.High)&&c.IsNumber(n.Low)&&c.IsNumber(n.YClose)&&n.YClose!=0&&(n.Amplitude=(n.High-n.Low)/n.YClose*100),c.IsNumber(e[25])||c.IsNumber(n.OutShares)&&c.IsNumber(n.Price)&&(n.CircMarketValue=n.OutShares*n.Price),c.IsNumber(e[26])||c.IsNumber(n.TotalShares)&&c.IsNumber(n.Price)&&(n.MarketValue=n.TotalShares*n.Price),e[30]&&(n.ExtendData=e[30]),e[31]&&this.BlockData.set(n.OriginalSymbol,e[31]),e[32]&&(n.CloseLine=e[32]),e[33]&&(n.KLine=e[33])},this.GetSymbolNoSuffix=function(n){var e=n.lastIndexOf(".");return e>0?n.substring(0,e):n},this.CancelAutoUpdate=function(){typeof this.AutoUpdateTimer=="number"&&(clearTimeout(this.AutoUpdateTimer),this.AutoUpdateTimer=null)},this.AutoUpdate=function(n){if(this.CancelAutoUpdate(),!!this.IsAutoUpdate){var e=this,t=2,a=this.GetEventCallback(et.ON_REPORT_MARKET_STATUS);if(a&&a.Callback){var s={MarketStatus:2};a.Callback(a,s,this),c.IsNumber(s.MarketStatus)&&(t=s.MarketStatus)}if(!(t==0||t==3)){var o=this.AutoUpdateFrequency;t==1?this.AutoUpdateTimer=setTimeout(function(){e.AutoUpdate()},o):t==2&&(this.AutoUpdateTimer=setTimeout(function(){e.UpdateStockData()},o))}}},this.StopAutoUpdate=function(){this.CancelAutoUpdate(),this.AutoUpdateEvent(!1,"JSDealChartContainer::StopAutoUpdate"),this.IsAutoUpdate&&(this.IsAutoUpdate=!1)},this.AddEventCallback=function(n){if(!(!n||!n.event||!n.callback)){var e={Callback:n.callback,Source:n};this.mapEvent.set(n.event,e)}},this.RemoveEventCallback=function(n){this.mapEvent.has(n)&&this.mapEvent.delete(n)},this.GetEventCallback=function(n){if(!this.mapEvent.has(n))return null;var e=this.mapEvent.get(n);return e},this.OnSize=function(){this.Frame&&(this.SetSizeChange(!0),this.Draw(),this.DelayUpdateStockData())},this.SetSizeChange=function(n){for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t&&(t.SizeChange=n)}},this.OnWheel=function(n){if(X.Chart.Log("[JSReportChartContainer::OnWheel]",n),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)&&!(!this.Data||!c.IsNonEmptyArray(this.Data.Data))){var e=n.clientX-this.UIElement.getBoundingClientRect().left,t=n.clientY-this.UIElement.getBoundingClientRect().top,a=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),a=this.Canvas.isPointInPath(e,t),!!a){var s=this.ChartPaint[0];if(s){var o=n.wheelDelta;c.IsObjectExist(n.wheelDelta)||(o=n.deltaY*-.01),o<0?this.GotoNextPage(this.PageUpDownCycle)&&(this.Draw(),this.DelayUpdateStockData()):o>0&&this.GotoPreviousPage(this.PageUpDownCycle)&&(this.Draw(),this.DelayUpdateStockData()),n.preventDefault?n.preventDefault():n.returnValue=!1}}}},this.OnKeyDown=function(n){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var e=this.GetReportChart();if(e){var t=n.keyCode?n.keyCode:n.which;switch(t){case 33:this.GotoPreviousPage(this.PageUpDownCycle)&&(this.Draw(),this.DelayUpdateStockData());break;case 34:this.GotoNextPage(this.PageUpDownCycle)&&(this.Draw(),this.DelayUpdateStockData());break;case 38:var a=this.MoveSelectedRow(-1);a&&(a.Redraw&&this.Draw(),a.Update&&this.DelayUpdateStockData());break;case 40:var a=this.MoveSelectedRow(1);a&&(a.Redraw&&this.Draw(),a.Update&&this.DelayUpdateStockData());break;case 37:this.MoveXOffset(-1)&&this.Draw();break;case 39:this.MoveXOffset(1)&&this.Draw();break}n.preventDefault?n.preventDefault():n.returnValue=!1}}},this.UIOnDblClick=function(n){var e=V(),t=(n.clientX-this.UIElement.getBoundingClientRect().left)*e,a=(n.clientY-this.UIElement.getBoundingClientRect().top)*e,s=this.ChartPaint[0];s&&s.OnDblClick(t,a,n)},this.UIOnMouseDown=function(n){var e=this;this.DragXScroll=null,this.DragHeader=null,this.DragColumnWidth=null,this.DragMove={Click:{X:n.clientX,Y:n.clientY},Move:{X:n.clientX,Y:n.clientY},PreMove:{X:n.clientX,Y:n.clientY}};var t=V(),a=(n.clientX-this.UIElement.getBoundingClientRect().left)*t,s=(n.clientY-this.UIElement.getBoundingClientRect().top)*t,o=this.ChartPaint[0];if(o){var h=o.PtInHeaderDragBorder(a,s);if(h)this.DragColumnWidth={ClickPoint:{X:a,Y:s},LastPoint:{X:a,Y:s},ClickData:h,ColumnWidth:h.Column.Width};else{var l=o.OnMouseDown(a,s,n);if(!l)return;if((l.Type==2||l.Type==4)&&(n.button==0||n.button==2))n.button==0&&l.Type==2&&this.EnableDragRow&&this.SortInfo.Sort<=0&&(this.DragRow={Click:{X:n.clientX,Y:n.clientY},LastMove:{X:n.clientX,Y:n.clientY},Data:l}),l.Redraw==!0&&this.Draw();else if(l.Type==3&&n.button==0)this.DragHeader={ClickPoint:{X:a,Y:s},Click:{X:n.clientX,Y:n.clientY},ClickData:l,LastMove:{X:n.clientX,Y:n.clientY},MovePoint:null,MoveToData:null};else if(l.Type==1&&n.button==0){var u=l.Tab;u.Type==1?this.MoveXOffset(-1)&&this.Draw():u.Type==2?this.MoveXOffset(1)&&this.Draw():u.Type==3?this.DragXScroll={Click:{X:a,Y:s},LastMove:{X:a,Y:s}}:u.Type==4?this.SetXOffset(u.Pos)&&this.Draw():u.Type==5&&this.OnClickTab(u,n)}}}document.onmousemove=function(f){e.DocOnMouseMove(f)},document.onmouseup=function(f){e.DocOnMouseUp(f)}},this.UIOnMounseUp=function(n){console.log('"UIOnMounseUp')},this.UIOnContextMenu=function(n){n.preventDefault()},this.UIOnMouseMove=function(n){var e=V(),t=(n.clientX-this.UIElement.getBoundingClientRect().left)*e,a=(n.clientY-this.UIElement.getBoundingClientRect().top)*e;if(!this.DragRow&&!this.DrawHeader&&!this.DragColumnWidth){var s=this.GetTabChart();if(s){var o=s.PtInTab(t,a);if(o){var h=o.Index;s.MoveOnTabIndex!=h&&(s.MoveOnTabIndex=h,this.Draw())}}var l={Cursor:"default",Name:"Default"},u=this.GetReportChart(),f=null;if(u){var C=u.PtInHeaderDragBorder(t,a);C?(l={Cursor:"col-resize",Name:"DragHeaderWidth"},X.Chart.Log("[JSReportChartContainer::UIOnMouseMove] drag column width ",C)):f=u.PtInCell(t,a)}var D=this.GetEventCallback(et.ON_REPORT_MOUSE_MOVE);if(D){var v={X:t,Y:a,Cell:f};D.Callback(D,v,this)}l&&(this.UIElement.style.cursor=l.Cursor)}},this.UIOnMounseOut=function(n){var e=this.GetTabChart();e&&e.MoveOnTabIndex>=0&&(e.MoveOnTabIndex=-1,this.Draw())},this.UIOnMouseleave=function(n){var e=this.GetTabChart();e&&e.MoveOnTabIndex>=0&&(e.MoveOnTabIndex=-1,this.Draw())},this.DocOnMouseMove=function(n){if(this.DragMove.PreMove.X=this.DragMove.Move.X,this.DragMove.PreMove.Y=this.DragMove.Move.Y,this.DragMove.Move.X=n.clientX,this.DragMove.Move.Y=n.clientX,(this.DragMove.Move.X!=this.DragMove.PreMove.X||this.DragMove.Move.Y!=this.DragMove.PreMove.Y)&&this.StopAutoDragScrollTimer(),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var e=V(),t=(n.clientX-this.UIElement.getBoundingClientRect().left)*e,a=(n.clientY-this.UIElement.getBoundingClientRect().top)*e;if(this.DragRow){var s=this.DragRow,o=s.LastMove.Y-n.clientY;if(Math.abs(o)<2)return;var h=this.GetReportChart();if(s.LastMove.X=n.clientX,s.LastMove.Y=n.clientY,s.Inside={X:t,Y:a},h){var l=h.OnDrawgRow(t,a,n);if(l)if(l.Type==2)l.Data.DataIndex!=s.Data.Row.DataIndex&&(s.MoveRow=l);else if(l.Type==7){var u=h.GetCurrentPageStatus();u.IsEnd||(this.MoveYOffset(1,!1),s.MoveRow=null,this.EnablePageScroll=!0,this.AutoScrollPage(2))}else l.Type==5&&this.Data.YOffset>0&&(this.MoveYOffset(-1,!1),s.MoveRow=null,this.EnablePageScroll=!0,this.AutoScrollPage(-2));h.DragRow=s}this.Draw()}else if(this.DragXScroll){var f=this.ChartPaint[0];if(!f||!f.Tab)return;this.DragXScroll.LastMove.X=t,this.DragXScroll.LastMove.Y=a;var C=f.Tab.GetScrollPostionByPoint(t,a);this.SetXOffset(C)&&this.Draw()}else if(this.DragHeader&&this.DragHeader.ClickData){if(this.DragHeader.ClickData.Header.IsFixed||!this.EnableDragHeader)return;var D=n.clientX-this.DragHeader.Click.X,v=n.clientY-this.DragHeader.Click.Y;if(Math.abs(v)<=1&&Math.abs(D)<=1)return;this.DragHeader.LastMove.X=n.clientX,this.DragHeader.LastMove.Y=n.clientY,this.DragHeader.MovePoint?(this.DragHeader.MovePoint.X=t,this.DragHeader.MovePoint.Y=a):this.DragHeader.MovePoint={X:t,Y:a},this.OnMoveDragHeader(t,a,n),this.ShowDragHeaderTooltip(t,a,n)}else if(this.DragColumnWidth&&this.DragColumnWidth.ClickData){var D=t-this.DragColumnWidth.ClickPoint.X;if(Math.abs(D)<1)return;var S=this.DragColumnWidth.ColumnWidth+D;if(S<=10)return;var T=this.DragColumnWidth.ClickData.Index,I=this.GetEventCallback(et.ON_REPORT_DRAG_COLUMN_WIDTH);if(I&&I.Callback){var F={Index:T,Width:S,PreventDefault:!1};if(this.DragColumnWidth&&this.DragColumnWidth.ClickData&&(F.Column=this.DragColumnWidth.ClickData.Column),I.Callback(I,F,this),F.PreventDefault)return}this.SetColumnFixedWidth(T,S),this.DragColumnWidth.LastPoint.X=t,this.DragColumnWidth.LastPoint.Y=a}}},this.SetColumnFixedWidth=function(n,e){var t=this.ChartPaint[0];if(t){var a=t.Column[n];a&&(a.FixedWidth=e,this.SetSizeChange(!0),this.Draw())}},this.OnMoveDragHeader=function(n,e,t){var a=this.ChartPaint[0];if(a){var s=this.DragHeader.ClickData;if(this.DragHeader.MoveToData=null,!s.Header.IsFixed){var o=this.DragHeader.ClickPoint.Y,h=a.OnMouseDown(n,o,t);if(!h||!h.Header||h.Header.IsFixed||h.Header.Index==s.Header.Index)return;this.DragHeader.MoveToData=h,console.log("[JSReportChartContainer::OnMoveDragHeader] Click[Index="+s.Header.Index+", Title="+s.Header.Column.Title+"] => Move[Index="+h.Header.Index+", Title="+h.Header.Column.Title+"]")}}},this.ShowDragHeaderTooltip=function(n,e,t){if(this.DragHeader){var a=this.DragHeader;if(!(!a.ClickData||!a.MovePoint)){var s=this.GetEventCallback(et.ON_REPORT_DRAG_HEADER_TOOLTIP);if(s){var o={PreventDefault:!1,e:t,X:n,Y:e,DragHeader:this.DragHeader,Tooltip:this.Tooltip};if(s.Callback(s,o,this),o.PreventDefault)return}var h=a.ClickData.Header.Column.Title;this.Tooltip.className="jchart-chartdrawsvg-tooltip",this.Tooltip.style.position="absolute",this.Tooltip.style.left=t.clientX+"px",this.Tooltip.style.top=t.clientY+"px",this.Tooltip.style.width="100px",this.Tooltip.style.height=null,this.Tooltip.innerHTML=h,this.Tooltip.style.display="block"}}},this.HideTooltip=function(){this.Tooltip.style.display!="none"&&(this.Tooltip.style.display="none")},this.DocOnMouseUp=function(n){document.onmousemove=null,document.onmouseup=null,this.StopAutoDragScrollTimer(),this.HideTooltip();var e=this.GetReportChart(),t={Cursor:"default",Name:"Default"},a=!1;this.DragRow&&(e&&(this.OnDragRow(),e.DragRow=null),a=!0);var s=this.DragHeader;if(this.DragHeader=null,this.DragXScroll=null,this.DragRow=null,this.DragMove=null,this.DragColumnWidth=null,a&&this.Draw(),s){var o=s.ClickData,h=s.MoveToData;o&&h?this.SwapColumn(o.Header.Index,h.Header.Index,{Redraw:!0}):this.OnClickHeader(o,n)}t&&(this.UIElement.style.cursor=t.Cursor)},this.OnDragRow=function(){if(!(!this.SourceData||!c.IsNonEmptyArray(this.SourceData.Data))&&!(!this.DragRow||!this.DragRow.MoveRow)){var n=this.DragRow,e=n.Data.Row.DataIndex,t=n.MoveRow.Data.DataIndex;if(!(e==t||e<0||t<0)){var a=this.SourceData.Data;if(!(e>=a.length||t>=a.length)){var s=this.GetEventCallback(et.ON_REPORT_DRAG_ROW);if(s){var o={Symbol:this.Symbol,Src:{Index:e,Symbol:a[e]},To:{Index:t,Symbol:a[t]},PreventDefault:!1};if(s.Callback(s,o,this),o.PreventDefault)return}if(this.DragRowType==1){var h=a[e];a[e]=a[t],a[t]=h,this.Data.Data=a.slice(0)}else{var l=a[e];a.splice(e,1),a.splice(t,0,l),this.Data.Data=a.slice(0)}var u=this.GetReportChart();u&&(u.SelectedModel==0?u.SelectedRow=n.MoveRow.Data.Index:u.SelectedRow=n.MoveRow.Data.DataIndex)}}}},this.IsPhoneDragging=function(n){var e=n.changedTouches.length,t=n.touches.length;return e==1&&t==1},this.GetTouchData=function(n){for(var e=[],t=V(),a=0;a<n.touches.length;++a){var s=n.touches[a],o={clientX:s.clientX*t,clientY:s.clientY*t,pageX:s.pageX*t,pageY:s.pageY*t,InsideX:(s.clientX-this.UIElement.getBoundingClientRect().left)*t,InsideY:(s.clientY-this.UIElement.getBoundingClientRect().top)*t};e.push(o)}return e},this.GetMoveAngle=function(n,e){var t=Math.abs(n.X-e.X),a=Math.abs(n.Y-e.Y),s=Math.atan(t/a)*180/Math.PI;return s},this.PreventTouchEvent=function(n){n.cancelable&&n.preventDefault(),n.stopPropagation()},this.OnTouchStart=function(n){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){this.IsOnTouch=!0;var e=this.GetReportChart();if(e&&this.IsPhoneDragging(n)){var t={Click:{},LastMove:{},InsideClick:{}},a=this.GetTouchData(n);t.Click.X=a[0].clientX,t.Click.Y=a[0].clientY,t.InsideClick.X=a[0].InsideX,t.InsideClick.Y=a[0].InsideY,t.LastMove.X=a[0].clientX,t.LastMove.Y=a[0].clientY,t.IsXMove=!1,t.IsYMove=!1,e.IsPtInBody(t.InsideClick.X,t.InsideClick.Y)&&(this.TouchDrag=t),this.TouchInfo={InsideClick:{X:a[0].InsideX,Y:a[0].InsideY},Click:{X:a[0].clientX,Y:a[0].clientY}},this.PreventTouchEvent(n)}}},this.OnDragYOffset=function(n,e,t,a){if(t<5)return!1;var s=!0;n.LastMove.Y<e[0].clientY&&(s=!1);var o=this.YStepPixel;o<=0&&(o=5);var h=parseInt(t/o);return h<=0?!1:(s==!1&&(h*=-1),this.MoveYOffset(h,this.DragPageCycle)&&(n.IsYMove=!0,this.Draw(),this.DelayUpdateStockData()),!0)},this.OnDragXOffset=function(n,e,t,a){if(t<5)return!1;var s=!0;n.LastMove.X<e[0].clientX&&(s=!1);var o=this.XStepPixel;o<=0&&(o=5);var h=parseInt(t/o);return h<=0?!1:(s||(h*=-1),this.MoveXOffset(h)&&(n.IsXMove=!0,this.Draw()),!0)},this.OnTouchMove=function(n){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var e=this.GetReportChart();if(e){var t=this.GetTouchData(n);if(this.IsPhoneDragging(n)){var a=this.TouchDrag;if(this.TouchInfo.Move={X:t[0].clientX,Y:t[0].clientY},a){this.PreventTouchEvent(n);var s=this.GetMoveAngle(a.LastMove,{X:t[0].clientX,Y:t[0].clientY}),o=Math.abs(a.LastMove.X-t[0].clientX),h=Math.abs(a.LastMove.Y-t[0].clientY);if(a.IsYMove==!0){if(this.ShowPageInfo(!0),!this.OnDragYOffset(a,t,h,n))return}else if(a.IsXMove==!0){if(!this.OnDragXOffset(a,t,o,n))return}else if(h>0&&s<this.TouchMoveMinAngle){if(this.ShowPageInfo(!0),!this.OnDragYOffset(a,t,h,n))return}else if(o>0&&s>=this.TouchMoveMinAngle){if(!this.OnDragXOffset(a,t,o,n))return}else return;a.LastMove.X=t[0].clientX,a.LastMove.Y=t[0].clientY}}}}},this.OnTouchEnd=function(n){X.Chart.Log("[JSReportChartContainer:OnTouchEnd]",n),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)&&(this.ShowPageInfo(!1),this.OnTouchClick(this.TouchInfo,n),this.IsOnTouch=!1,this.TouchDrag=null,this.TouchInfo=null)},this.OnTouchClick=function(n,e){if(!n||!n.Click||n.Move)return!1;var t=n.InsideClick,a=this.GetReportChart();if(!a)return!1;var s=a.OnMouseDown(t.X,t.Y,e);if(!s)return!1;s.Type==2||s.Type==4?s.Redraw==!0&&this.Draw():s.Type==3&&this.OnClickHeader(s,e),X.Chart.Log("[JSReportChartContainer:OnTouchClick] clickData",s)},this.GetTabChart=function(){var n=this.ChartPaint[0];return n?n.Tab:null},this.GetReportChart=function(){var n=this.ChartPaint[0];return n},this.GotoNextPage=function(n){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return!1;var e=this.ChartPaint[0];if(!e)return!1;var t=e.GetPageSize();if(t>this.Data.Data.length)return!1;if(this.Data.YOffset+t>=this.Data.Data.length)return n===!0?(this.Data.YOffset=0,!0):!1;this.Data.YOffset+=t;var a=this.Data.Data.length-this.Data.YOffset;return e.SelectedModel==0&&e.SelectedRow>a-1&&(e.SelectedRow=a-1),!0},this.GotoPreviousPage=function(n){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return!1;var e=this.ChartPaint[0];if(!e)return!1;var t=e.GetPageSize();if(t>this.Data.Data.length)return!1;if(this.Data.YOffset<=0)return n===!0?(this.Data.YOffset=this.Data.Data.length-t,!0):!1;var a=this.Data.YOffset;return a-=t,a<0&&(a=0),this.Data.YOffset=a,!0},this.MoveYOffset=function(n,e){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return!1;var t=this.ChartPaint[0];if(!t)return!1;var a=t.GetCurrentPageStatus();if(a.IsSinglePage)return!1;if(n>0){var s=this.Data.Data.length,o=a.PageSize,h=this.Data.YOffset;if(e)for(var l=0;l<n;++l)++h,h+o>s&&(h=0);else{if(h+o>=s)return!1;for(var l=0;l<n&&!(h+o+1>s);++l)++h}return this.Data.YOffset=h,!0}else if(n<0){n=Math.abs(n);var h=this.Data.YOffset;if(e)for(var o=a.PageSize,l=0;l<n;++l)--h,h<0&&(h=this.Data.Data.length-o);else{if(this.Data.YOffset<=0)return!1;for(var l=0;l<n&&!(h-1<0);++l)--h}return this.Data.YOffset=h,!0}return!1},this.MoveSelectedRow=function(n){var e=this.ChartPaint[0];if(!e||!c.IsNonEmptyArray(this.Data.Data))return null;var t={Redraw:!1,Update:!1};if(e.SelectedModel==0){var a=e.GetCurrentPageStatus(),s=a.End-a.Start+1,o=a.SelectedRow;if(n>0)return o+=n,o=o%s,e.SelectedRow=o,e.SelectedFixedRow=-1,t.Redraw=!0,t;if(n<0)return o+=n,o<0&&(o=o%s,o=s+o),e.SelectedRow=o,e.SelectedFixedRow=-1,t.Redraw=!0,t}else if(e.SelectedModel==1){var a=e.GetCurrentPageStatus(),s=a.PageSize,o=a.SelectedRow;if(n>0){if(o<0||o<a.Start||o>a.End)return e.SelectedRow=a.Start,t.Redraw=!0,t;for(var h=this.Data.YOffset,l=0;l<n;++l)++o,o>a.End&&++h,o>=this.Data.Data.length&&(o=0,h=0);return t.Redraw=!0,t.Update=h!=this.Data.YOffset,e.SelectedRow=o,this.Data.YOffset=h,t}else if(n<0){if(o<0||o<a.Start||o>a.End)return e.SelectedRow=a.End,t.Redraw=!0,t;n=Math.abs(n);for(var h=this.Data.YOffset,l=0;l<n;++l)--o,o<a.Start&&--h,o<0&&(o=this.Data.Data.length-1,h=this.Data.Data.length-s,h<0&&(h=0));return t.Redraw=!0,t.Update=h!=this.Data.YOffset,e.SelectedRow=o,this.Data.YOffset=h,t}}return null},this.MoveXOffset=function(n){var e=this.ChartPaint[0];if(!e)return!1;var t=e.GetXScrollRange();if(t<=0)return!1;if(n>0){if(this.Data.XOffset>=t)return!1;for(var a=0;a<n&&!(this.Data.XOffset>=t);++a)++this.Data.XOffset;return!0}else if(n<0){if(this.Data.XOffset<=0)return!1;n=Math.abs(n);for(var a=0;a<n&&!(this.Data.XOffset-1<0);++a)--this.Data.XOffset;return!0}return!1},this.SetXOffset=function(n){if(!c.IsNumber(n))return!1;var e=this.ChartPaint[0];if(!e)return!1;var t=e.GetXScrollRange();return n<0&&(n=0),n>t&&(n=t),this.Data.XOffset=n,!0},this.GotoLastPage=function(){var n=this.ChartPaint[0];if(n){var e=n.GetPageSize(!0),t=this.Data.Data.length-e;t<0&&(t=0),this.Data.DataOffset=t}},this.SetColumn=function(n,e){var t=this.ChartPaint[0];t&&(t.SetColumn(n),t.SizeChange=!0,e&&e.Redraw&&this.Draw())},this.SetTab=function(n,e){var t=this.ChartPaint[0];if(t){var a=t.Tab;a&&(a.SetTabList(n),e&&e.Redraw&&this.Draw())}},this.SetSelectedTab=function(n,e){var t=this.ChartPaint[0];if(t){var a=t.Tab;a&&(a.SelectedTabIndex=n)}},this.ReloadResource=function(n){this.Frame.ReloadResource(n);for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.ReloadResource&&t.ReloadResource(n)}n&&n.Redraw&&(this.SetSizeChange(!0),this.Draw())},this.OnClickHeader=function(n,e){var t=this,a=n.Header;if(a.Column&&(a.Column.Sort==1||a.Column.Sort==2)){var s=a.Index,o={Field:this.SortInfo.Field,Sort:this.SortInfo.Sort},h=a.Column.SortType;if(o.Field!=s)o.Field=s,o.Sort=h[0];else if(h.length==1)o.Sort=h[0];else for(var l=0;l<h.length;++l)if(o.Sort==h[l]){o.Sort=h[(l+1)%h.length];break}if(a.Column.Sort==1||a.Column.Sort==2){if(o.Sort==0){this.Data.Data=[];for(var l=0;l<this.SourceData.Data.length;++l)this.Data.Data.push(this.SourceData.Data[l])}else if(a.Column.Sort==1){var u=this.GetEventCallback(et.ON_REPORT_LOCAL_SORT);if(u&&u.Callback){var f={Column:a.Column,SortInfo:o,SymbolList:this.Data.Data,Result:null};u.Callback(u,f,this),Array.isArray(f.Result)&&(this.Data.Data=f.Result)}else this.Data.Data.sort(function(C,D){return t.LocalSort(C,D,a.Column,o.Sort)})}else if(a.Column.Sort==2){if(!c.IsNonEmptyArray(this.Data.Data))return;this.SortInfo.Field=o.Field,this.SortInfo.Sort=o.Sort,this.Data.YOffset=0,this.ResetReportSelectStatus(),this.RequestStockSortData(a.Column,o.Field,o.Sort);return}this.Data.YOffset=0,this.ResetReportSelectStatus(),this.SortInfo.Field=o.Field,this.SortInfo.Sort=o.Sort,this.Draw(),this.DelayUpdateStockData()}}},this.OnClickTab=function(n,e){if(n.Tab){var t=!1,a=V(),s=(e.clientX-this.UIElement.getBoundingClientRect().left)*a;(e.clientY-this.UIElement.getBoundingClientRect().top)*a;var o={Left:this.UIElement.getBoundingClientRect().left,Top:this.UIElement.getBoundingClientRect().top};if(n.Tab.IsMenu){var h=this.GetEventCallback(et.ON_CLICK_REPORT_TABMENU);if(h&&h.Callback){t=!0;var l=n.Rect,u={Left:l.Left/a,Right:l.Right/a,Top:l.Top/a,Bottom:l.Bottom/a},f={Data:n,IsSide:{X:s,Y:s},UIElement:o,Rect:u,e,Redraw:t};h.Callback(h,f,this),c.IsBool(f.Redraw)&&(t=f.Redraw)}this.SetSelectedTab(n.Index)}else{var h=this.GetEventCallback(et.ON_CLICK_REPORT_TAB);if(h&&h.Callback){var f={Data:n,IsSide:{X:s,Y:s},UIElement:o,e,Redraw:t};h.Callback(h,f,this),c.IsBool(f.Redraw)&&(t=f.Redraw)}this.SetSelectedTab(n.Index)}t&&this.Draw()}},this.SwapColumn=function(n,e,t){var a=this.GetReportChart();a&&a.SwapColumn(n,e)&&t&&t.Redraw&&(this.SetSizeChange(!0),this.Draw())},this.LocalSort=function(n,e,t,a){switch(t.Type){case rt.SYMBOL_ID:case rt.NAME_ID:return this.LocalStringSort(n,e,t,a);case rt.NAME_EX_ID:return this.LocalNameExSort(n,e,t,a);case rt.PRICE_ID:case rt.VOL_ID:case rt.INCREASE_ID:case rt.UPDOWN_ID:case rt.BUY_PRICE_ID:case rt.SELL_PRICE_ID:case rt.AMOUNT_ID:case rt.BUY_VOL_ID:case rt.SELL_VOL_ID:case rt.YCLOSE_ID:case rt.OPEN_ID:case rt.HIGH_ID:case rt.LOW_ID:case rt.AVERAGE_PRICE_ID:case rt.OUTSTANDING_SHARES_ID:case rt.TOTAL_SHARES_ID:case rt.CIRC_MARKET_VALUE_ID:case rt.MARKET_VALUE_ID:case rt.EXCHANGE_RATE_ID:case rt.AMPLITUDE_ID:case rt.LIMIT_HIGH_ID:case rt.LIMIT_LOW_ID:case rt.VOL_IN_ID:case rt.VOL_OUT_ID:return this.LocalNumberSort(n,e,t,a);case rt.CUSTOM_NUMBER_TEXT_ID:return this.LoacCustomNumberSort(n,e,t,a);case rt.CUSTOM_STRING_TEXT_ID:return this.LoacCustomStringSort(n,e,t,a);case rt.CUSTOM_DATETIME_TEXT_ID:return this.LoacCustomDateTimeSort(n,e,t,a);default:return 0}},this.GetStockExtendData=function(n,e){if(c.IsNumber(e.DataIndex)){if(e.DataIndex<0)return null;var t=this.GetStockData(n);return!t||!t.ExtendData?null:t.ExtendData[e.DataIndex]}if(c.IsNumber(e.BlockIndex)){if(e.BlockIndex<0)return null;var t=this.GetBlockData(n);return t?t[e.BlockIndex]:null}return null},this.LocalNameExSort=function(n,e,t,a){var s=this.GetStockData(n),o=this.GetStockData(e),h="",l="";return a==2&&(h="啊啊啊啊啊",l="啊啊啊啊啊"),s&&s.Name&&(h=s.Name),o&&o.Name&&(l=o.Name),a==1?l<h?-1:l<h?1:0:h<l?-1:h>l?1:0},this.LocalStringSort=function(n,e,t,a){var s=this.GetStockData(n),o=this.GetStockData(e),h="",l="";a==2&&(h="啊啊啊啊啊",l="啊啊啊啊啊");var u=as.get(t.Type);return s&&s[u]&&(h=s[u]),o&&o[u]&&(l=o[u]),a==1?l<h?-1:l<h?1:0:h<l?-1:h>l?1:0},this.LocalNumberSort=function(n,e,t,a){var s=this.GetStockData(n),o=this.GetStockData(e),h=-99999999999999,l=-99999999999999;a==2&&(h=l=99999999999999);var u=as.get(t.Type);return s&&c.IsNumber(s[u])&&(h=s[u]),o&&c.IsNumber(o[u])&&(l=o[u]),a==1?l<h?-1:l<h?1:0:h<l?-1:h>l?1:0},this.LoacCustomNumberSort=function(n,e,t,a){var s=-99999999999999,o=-99999999999999;a==2&&(s=o=99999999999999);var h=this.GetStockExtendData(n,t);c.IsNumber(h)&&(s=h);var h=this.GetStockExtendData(e,t);return c.IsNumber(h)&&(o=h),a==1?o<s?-1:o<s?1:0:s<o?-1:s>o?1:0},this.LoacCustomDateTimeSort=function(n,e,t,a){var s=-99999999999999,o=-99999999999999;a==2&&(s=o=99999999999999);var h=this.GetStockExtendData(n,t);c.IsNumber(h)&&(s=h);var h=this.GetStockExtendData(e,t);return c.IsNumber(h)&&(o=h),a==1?o<s?-1:o<s?1:0:s<o?-1:s>o?1:0},this.RequestStockSortData=function(n,e,t){var a=this.ChartPaint[0];if(a){var s=this,o=this.Data.YOffset,h=a.GetPageSize(),l=o+h;if(l>=this.Data.Data.length&&(l=this.Data.Data.length-1),this.NetworkFilter){var u={Name:"JSDealChartContainer::RequestStockSortData",Explain:"报价列表股票排序数据",Request:{Data:{range:{start:o,end:l,count:this.Data.Data.length},column:{name:n.Title,type:n.Type,index:e,ID:n.ID},sort:t,symbol:this.Symbol,name:this.Name,pageSize:h}},Self:this,PreventDefault:!1};if(a.FixedRowCount>0&&a.FixedRowData.Type==1){for(var f=[],C=0;C<a.FixedRowData.Symbol.length;++C){var D=a.FixedRowData.Symbol[C];D&&f.push(D)}u.Request.FixedSymbol=f}if(this.NetworkFilter(u,function(v){s.RecvStockSortData(v),s.AutoUpdate()}),u.PreventDefault==!0)return}throw{Name:"JSReportChartContainer::RequestStockSortData",Error:"(报价列表股票排序数据)不提供内置测试数据"}}},this.RecvStockSortData=function(n){var e=[];if(c.IsNonEmptyArray(n.data))for(var t=0;t<n.data.length;++t){var a=n.data[t],s=a[0];if(s){var o=null;this.MapStockData.has(s)?o=this.MapStockData.get(s):(o=new Wn,o.OriginalSymbol=s,o.Symbol=this.GetSymbolNoSuffix(s),this.MapStockData.set(s,o)),this.ReadStockJsonData(o,a),e.push(s)}}if(c.IsNonEmptyArray(n.index))for(var t=0;t<n.index.length;++t){var h=n.index[t],l=e[t],u=this.Data.Data[h];l!=u&&(this.Data.Data[h]=l)}var f=this.ChartPaint[0];f&&this.Draw()},this.ShowPageInfo=function(n){var e=this.ChartPaint[1];return e?(e.IsShow=n,!0):!1}}function BI(){this.ChartBorder,this.Canvas,this.BorderLine=null,this.BorderColor=m.Report.BorderColor,this.LogoTextColor=m.FrameLogo.TextColor,this.LogoTextFont=m.FrameLogo.Font,this.ReloadResource=function(r){this.BorderColor=m.Report.BorderColor,this.LogoTextColor=m.FrameLogo.TextColor,this.LogoTextFont=m.FrameLogo.Font},this.Draw=function(){var r=L(this.ChartBorder.GetLeft()),n=L(this.ChartBorder.GetTop()),e=L(this.ChartBorder.GetRight()),t=L(this.ChartBorder.GetBottom()),a=e-r,s=t-n;c.IsNumber(this.BorderLine)?(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),(this.BorderLine&1)>0&&(this.Canvas.moveTo(r,n),this.Canvas.lineTo(e,n)),(this.BorderLine&2)>0&&(this.Canvas.moveTo(r,t),this.Canvas.lineTo(e,t)),(this.BorderLine&4)>0&&(this.Canvas.moveTo(r,n),this.Canvas.lineTo(r,t)),(this.BorderLine&8)>0&&(this.Canvas.moveTo(e,n),this.Canvas.lineTo(e,t)),this.Canvas.stroke()):(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(r,n,a,s))},this.DrawLogo=function(){var r=m.FrameLogo.Text;if(c.IsString(r)){this.Canvas.fillStyle=this.LogoTextColor,this.Canvas.font=this.LogoTextFont,this.Canvas.textAlign="right",this.Canvas.textBaseline="bottom";var n=this.ChartBorder.GetRight()-30,e=this.ChartBorder.GetBottom()-5;this.Canvas.fillText(r,n,e)}}}var rt={SYMBOL_ID:0,NAME_ID:1,PRICE_ID:2,VOL_ID:3,INCREASE_ID:4,UPDOWN_ID:5,BUY_PRICE_ID:6,SELL_PRICE_ID:7,AMOUNT_ID:8,BUY_VOL_ID:9,SELL_VOL_ID:10,YCLOSE_ID:11,OPEN_ID:12,HIGH_ID:13,LOW_ID:14,AVERAGE_PRICE_ID:15,INDEX_ID:16,OUTSTANDING_SHARES_ID:17,TOTAL_SHARES_ID:18,CIRC_MARKET_VALUE_ID:19,MARKET_VALUE_ID:20,EXCHANGE_RATE_ID:21,AMPLITUDE_ID:22,LIMIT_HIGH_ID:23,LIMIT_LOW_ID:24,VOL_IN_ID:25,VOL_OUT_ID:26,NAME_EX_ID:27,CLOSE_LINE_ID:28,KLINE_ID:29,SYMBOL_NAME_ID:99,CUSTOM_STRING_TEXT_ID:100,CUSTOM_NUMBER_TEXT_ID:101,CUSTOM_DATETIME_TEXT_ID:102,CUSTOM_ICON_ID:103},as=new Dt.default([[rt.SYMBOL_ID,"Symbol"],[rt.NAME_ID,"Name"],[rt.PRICE_ID,"Price"],[rt.INCREASE_ID,"Increase"],[rt.UPDOWN_ID,"UpDown"],[rt.VOL_ID,"Vol"],[rt.BUY_PRICE_ID,"BuyPrice"],[rt.SELL_PRICE_ID,"SellPrice"],[rt.AMOUNT_ID,"Amount"],[rt.BUY_VOL_ID,"BuyVol"],[rt.SELL_VOL_ID,"SellVol"],[rt.YCLOSE_ID,"YClose"],[rt.OPEN_ID,"Open"],[rt.HIGH_ID,"High"],[rt.LOW_ID,"Low"],[rt.AVERAGE_PRICE_ID,"AvPrice"],[rt.OUTSTANDING_SHARES_ID,"OutShares"],[rt.TOTAL_SHARES_ID,"TotalShares"],[rt.CIRC_MARKET_VALUE_ID,"CircMarketValue"],[rt.MARKET_VALUE_ID,"MarketValue"],[rt.EXCHANGE_RATE_ID,"Exchange"],[rt.AMPLITUDE_ID,"Amplitude"],[rt.LIMIT_HIGH_ID,"LimitHigh"],[rt.LIMIT_LOW_ID,"LimitLow"],[rt.VOL_IN_ID,"VolIn"],[rt.VOL_OUT_ID,"VolOut"],[rt.NAME_EX_ID,"NameEx"]]);function bI(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ChartReport",this.UIElement,this.IsDrawFirst=!1,this.GetEventCallback,this.GetStockDataCallback,this.GetFlashBGDataCallback,this.GetBlockDataCallback,this.Data,this.FixedRowData,this.SortInfo,this.FixedColumn=2,this.FixedRowCount=0,this.IsShowHeader=!0,this.SizeChange=!0,this.SelectedModel=0,this.SelectedRow=-1,this.SelectedFixedRow=-1,this.IsDrawBorder=1,this.ShowSymbol=[],this.DragRow,this.Tab,this.GlobalOption,this.UpColor=m.Report.UpTextColor,this.DownColor=m.Report.DownTextColor,this.UnchagneColor=m.Report.UnchagneTextColor,this.BorderColor=m.Report.BorderColor,this.SelectedColor=m.Report.SelectedColor,this.HeaderFontConfig={Size:m.Report.Header.Font.Size,Name:m.Report.Header.Font.Name},this.HeaderColor=m.Report.Header.Color,this.SortColor=m.Report.Header.SortColor,this.HeaderMergin={Left:m.Report.Header.Mergin.Left,Right:m.Report.Header.Mergin.Right,Top:m.Report.Header.Mergin.Top,Bottom:m.Report.Header.Mergin.Bottom},this.ItemFontConfig={Size:m.Report.Item.Font.Size,Name:m.Report.Item.Font.Name},this.ItemFixedFontConfg={Size:m.Report.FixedItem.Font.Size,Name:m.Report.FixedItem.Font.Name},this.ItemMergin={Left:m.Report.Item.Mergin.Left,Right:m.Report.Item.Mergin.Right,Top:m.Report.Item.Mergin.Top,Bottom:m.Report.Item.Mergin.Bottom},this.BarMergin={Top:m.Report.Item.BarMergin.Top,Left:m.Report.Item.BarMergin.Left,Right:m.Report.Item.BarMergin.Right,Bottom:m.Report.Item.BarMergin.Bottom},this.LimitDrawType=0,this.LimitBorderColor=m.Report.LimitBorder.Color,this.LimitUpBGColor=m.Report.LimitColor.UpColor,this.LimitDownBGColor=m.Report.LimitColor.DownColor,this.LimitTextColor=m.Report.LimitColor.TextColor,this.LimitMergin={Top:m.Report.LimitBorder.Mergin.Top,Left:m.Report.LimitBorder.Mergin.Left,Right:m.Report.LimitBorder.Mergin.Right,Bottom:m.Report.LimitBorder.Mergin.Bottom},this.DragRowColor=m.Report.DragRow.Color,this.DragRowTextColor=m.Report.DragRow.TextColor,this.DragMoveRowColor=m.Report.DragRow.MoveRowColor,this.DragSrcRowColor=m.Report.DragRow.SrcRowColor,this.CloseLineConfig={CloseColor:m.Report.CloseLine.CloseColor,YCloseColor:m.Report.CloseLine.YCloseColor,AreaColor:m.Report.CloseLine.AreaColor},this.KLineConfig={UpColor:m.Report.KLine.UpColor,DownColor:m.Report.KLine.DownColor,UnchagneColor:m.Report.KLine.UnchagneColor,DataWidth:m.Report.KLine.DataWidth,DistanceWidth:m.Report.KLine.DistanceWidth},this.ItemSymbolFontConfig={Size:m.Report.Item.SymbolFont.Size,Name:m.Report.Item.SymbolFont.Name},this.ItemNameFontConfg={Size:m.Report.Item.NameFont.Size,Name:m.Report.Item.NameFont.Name},this.HeaderFont=12*V()+"px 微软雅黑",this.ItemFont=15*V()+"px 微软雅黑",this.ItemFixedFont=15*V()+"px 微软雅黑",this.ItemSymbolFont=12*V()+"px 微软雅黑",this.ItemNameFont=15*V()+"px 微软雅黑",this.ItemNameHeight=0,this.RowCount=0,this.HeaderHeight=0,this.FixedRowHeight=0,this.RowHeight=0,this.BottomToolbarHeight=0,this.IsShowAllColumn=!1,this.Column=[{Type:rt.INDEX_ID,Title:"序号",TextAlign:"center",Width:null,TextColor:m.Report.FieldColor.Index,MaxText:"8888"},{Type:rt.SYMBOL_ID,Title:"代码",TextAlign:"left",Width:null,TextColor:m.Report.FieldColor.Symbol,MaxText:"888888"},{Type:rt.NAME_ID,Title:"名称",TextAlign:"left",Width:null,TextColor:m.Report.FieldColor.Name,MaxText:"擎擎擎擎"},{Type:rt.INCREASE_ID,Title:"涨幅%",TextAlign:"right",Width:null,MaxText:"-888.88"}],this.RectClient={},this.TooltipRect=[],this.ReloadResource=function(r){this.UpColor=m.Report.UpTextColor,this.DownColor=m.Report.DownTextColor,this.UnchagneColor=m.Report.UnchagneTextColor,this.BorderColor=m.Report.BorderColor,this.SelectedColor=m.Report.SelectedColor,this.HeaderFontConfig={Size:m.Report.Header.Font.Size,Name:m.Report.Header.Font.Name},this.HeaderColor=m.Report.Header.Color,this.SortColor=m.Report.Header.SortColor,this.HeaderMergin={Left:m.Report.Header.Mergin.Left,Right:m.Report.Header.Mergin.Right,Top:m.Report.Header.Mergin.Top,Bottom:m.Report.Header.Mergin.Bottom},this.ItemFontConfig={Size:m.Report.Item.Font.Size,Name:m.Report.Item.Font.Name},this.ItemMergin={Left:m.Report.Item.Mergin.Left,Right:m.Report.Item.Mergin.Right,Top:m.Report.Item.Mergin.Top,Bottom:m.Report.Item.Mergin.Bottom},this.BarMergin={Top:m.Report.Item.BarMergin.Top,Left:m.Report.Item.BarMergin.Left,Right:m.Report.Item.BarMergin.Right,Bottom:m.Report.Item.BarMergin.Bottom},this.LimitBorderColor=m.Report.LimitBorder.Color,this.LimitMergin={Top:m.Report.LimitBorder.Mergin.Top,Left:m.Report.LimitBorder.Mergin.Left,Right:m.Report.LimitBorder.Mergin.Right,Bottom:m.Report.LimitBorder.Mergin.Bottom};for(var n=0;n<this.Column.length;++n){var e=this.Column[n];e.Type==rt.INDEX_ID?e.TextColor=m.Report.FieldColor.Index:e.Type==rt.SYMBOL_ID?e.TextColor=m.Report.FieldColor.Symbol:e.Type==rt.NAME_ID?e.TextColor=m.Report.FieldColor.Name:e.Type==rt.VOL_ID||e.Type==rt.BUY_VOL_ID||e.Type==rt.SELL_VOL_ID?e.TextColor=m.Report.FieldColor.Vol:e.Type==rt.AMOUNT_ID?e.TextColor=m.Report.FieldColor.Amount:e.Type==rt.VOL_IN_ID?e.TextColor=m.Report.DownTextColor:e.Type==rt.VOL_OUT_ID?e.TextColor=m.Report.UpTextColor:e.TextColor=m.Report.FieldColor.Text}this.Tab&&this.Tab.ReloadResource(r)},this.SetColumn=function(r){if(c.IsNonEmptyArray(r)){this.Column=[];for(var n=0;n<r.length;++n){var e=r[n],t=this.GetDefaultColunm(e.Type);if(t){if(e.Title&&(t.Title=e.Title),e.TextAlign&&(t.TextAlign=e.TextAlign),e.TextColor&&(t.TextColor=e.TextColor),e.MaxText&&(t.MaxText=e.MaxText),e.ID&&(t.ID=e.ID),c.IsNumber(e.Sort)&&(t.Sort=e.Sort),c.IsBool(e.EnableTooltip)&&(t.EnableTooltip=e.EnableTooltip),c.IsNumber(e.FixedWidth)&&(t.FixedWidth=e.FixedWidth),c.IsBool(e.EnableDragWidth)&&(t.EnableDragWidth=e.EnableDragWidth),c.IsBool(e.IsDrawCallback)?t.IsDrawCallback=e.IsDrawCallback:t.IsDrawCallback=!1,(e.Sort==1||e.Sort==2)&&(t.SortType=[1,2],c.IsNonEmptyArray(e.SortType)&&(t.SortType=e.SortType.slice())),e.Type==rt.CUSTOM_STRING_TEXT_ID){if(!c.IsNumber(e.DataIndex)&&!c.IsNumber(e.BlockIndex))continue;c.IsNumber(e.DataIndex)&&(t.DataIndex=e.DataIndex),c.IsNumber(e.BlockIndex)&&(t.BlockIndex=e.BlockIndex)}else if(e.Type==rt.CUSTOM_NUMBER_TEXT_ID){if(!c.IsNumber(e.DataIndex)&&!c.IsNumber(e.BlockIndex))continue;c.IsNumber(e.DataIndex)&&(t.DataIndex=e.DataIndex),c.IsNumber(e.BlockIndex)&&(t.BlockIndex=e.BlockIndex),t.Decimal=2,t.FormatType=0,t.ColorType=0,c.IsNumber(e.Decimal)&&(t.Decimal=e.Decimal),c.IsNumber(e.FormatType)&&(t.FormatType=e.FormatType),c.IsNumber(e.ColorType)&&(t.ColorType=e.ColorType)}else if(e.Type==rt.CUSTOM_DATETIME_TEXT_ID){if(!c.IsNumber(e.DataIndex)&&!c.IsNumber(e.BlockIndex))continue;c.IsNumber(e.DataIndex)&&(t.DataIndex=e.DataIndex),c.IsNumber(e.BlockIndex)&&(t.BlockIndex=e.BlockIndex),t.FormatType=0,t.ValueType=0,c.IsNumber(e.FormatType)&&(t.FormatType=e.FormatType),c.IsNumber(e.ValueType)&&(t.FormatType=e.ValueType)}else e.Type==rt.CUSTOM_ICON_ID||e.Type==rt.CLOSE_LINE_ID&&c.IsBool(e.IsDrawArea)&&(t.IsDrawArea=e.IsDrawArea);this.Column.push(t)}}}},this.SwapColumn=function(r,n){if(!c.IsNumber(r)||!c.IsNumber(n))return!1;var e=this.Column.length;if(r<0||r>=e||n<0||n>=e)return!1;if(r!=n){var t=this.Column[r];return this.Column[r]=this.Column[n],this.Column[n]=t,!0}},this.GetXScrollPos=function(){return this.Data.XOffset},this.GetXScrollRange=function(){var r=this.Column.length-this.FixedColumn-3;return r<0?0:r},this.GetDefaultColunm=function(r){for(var n=[{Type:rt.INDEX_ID,Title:"序号",TextAlign:"center",Width:null,TextColor:m.Report.FieldColor.Index,MaxText:"8888"},{Type:rt.SYMBOL_ID,Title:"代码",TextAlign:"left",Width:null,TextColor:m.Report.FieldColor.Symbol,MaxText:"888888"},{Type:rt.NAME_ID,Title:"名称",TextAlign:"left",Width:null,TextColor:m.Report.FieldColor.Name,MaxText:"擎擎擎擎0"},{Type:rt.NAME_EX_ID,Title:"名称",TextAlign:"left",Width:null,TextColor:m.Report.FieldColor.Name,MaxText:"擎擎擎擎擎擎"},{Type:rt.SYMBOL_NAME_ID,Title:"股票名称",TextAlign:"left",Width:null,TextColor:m.Report.FieldColor.Name,MaxText:"擎擎擎擎0"},{Type:rt.INCREASE_ID,Title:"涨幅%",TextAlign:"right",Width:null,MaxText:"-888.88"},{Type:rt.PRICE_ID,Title:"现价",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:rt.UPDOWN_ID,Title:"涨跌",TextAlign:"right",Width:null,MaxText:"-888.88"},{Type:rt.AMPLITUDE_ID,Title:"振幅%",TextAlign:"right",Width:null,MaxText:"888.88"},{Type:rt.BUY_PRICE_ID,Title:"买价",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:rt.SELL_PRICE_ID,Title:"卖价",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:rt.AVERAGE_PRICE_ID,Title:"均价",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:rt.OPEN_ID,Title:"今开",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:rt.HIGH_ID,Title:"最高",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:rt.LOW_ID,Title:"最低",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:rt.YCLOSE_ID,Title:"昨收",TextAlign:"right",Width:null,MaxText:"88888.88"},{Type:rt.VOL_ID,Title:"总量",TextAlign:"right",TextColor:m.Report.FieldColor.Vol,Width:null,MaxText:"8888.8擎"},{Type:rt.AMOUNT_ID,Title:"总金额",TextAlign:"right",TextColor:m.Report.FieldColor.Amount,Width:null,MaxText:"8888.8擎"},{Type:rt.EXCHANGE_RATE_ID,Title:"换手%",TextAlign:"right",TextColor:m.Report.FieldColor.Text,Width:null,MaxText:"88.88"},{Type:rt.OUTSTANDING_SHARES_ID,Title:"流通股本",TextAlign:"right",TextColor:m.Report.FieldColor.Text,Width:null,MaxText:"8888.8擎"},{Type:rt.TOTAL_SHARES_ID,Title:"总股本",TextAlign:"right",TextColor:m.Report.FieldColor.Text,Width:null,MaxText:"8888.8擎"},{Type:rt.CIRC_MARKET_VALUE_ID,Title:"流通市值",TextAlign:"right",TextColor:m.Report.FieldColor.Text,Width:null,MaxText:"8888.8擎"},{Type:rt.MARKET_VALUE_ID,Title:"总市值",TextAlign:"right",TextColor:m.Report.FieldColor.Text,Width:null,MaxText:"8888.8擎"},{Type:rt.VOL_IN_ID,Title:"内盘",TextAlign:"right",TextColor:m.Report.DownTextColor,Width:null,MaxText:"8888.8擎"},{Type:rt.VOL_OUT_ID,Title:"外盘",TextAlign:"right",TextColor:m.Report.UpTextColor,Width:null,MaxText:"8888.8擎"},{Type:rt.CLOSE_LINE_ID,Title:"走势",TextAlign:"center",TextColor:m.Report.CloseLineColor,Width:null,MaxText:"88888.88888"},{Type:rt.BUY_VOL_ID,Title:"买量",TextAlign:"right",TextColor:m.Report.FieldColor.Vol,Width:null,MaxText:"8888.8擎"},{Type:rt.SELL_VOL_ID,Title:"卖量",TextAlign:"right",TextColor:m.Report.FieldColor.Vol,Width:null,MaxText:"8888.8擎"},{Type:rt.CUSTOM_STRING_TEXT_ID,Title:"自定义",TextAlign:"center",Width:null,TextColor:m.Report.FieldColor.Text,MaxText:"擎擎擎擎擎"},{Type:rt.CUSTOM_NUMBER_TEXT_ID,Title:"自定义",TextAlign:"center",Width:null,TextColor:m.Report.FieldColor.Text,MaxText:"擎擎擎擎擎"},{Type:rt.CUSTOM_DATETIME_TEXT_ID,Title:"自定义",TextAlign:"center",Width:null,TextColor:m.Report.FieldColor.Text,MaxText:"9999-99-99"},{Type:rt.CUSTOM_ICON_ID,Title:"  ",TextAlign:"left",FixedWidth:20,TextColor:m.Report.FieldColor.Text},{Type:rt.KLINE_ID,Title:"K线",TextAlign:"left",FixedWidth:50,TextColor:m.Report.FieldColor.Text}],e=0;e<n.length;++e){var t=n[e];if(t.Type==r)return t}return null},this.Draw=function(){if(this.ShowSymbol=[],this.TooltipRect=[],this.GlobalOption&&(this.GlobalOption.FlashBGCount=0),this.SizeChange?this.CalculateSize():this.UpdateCacheData(),this.Canvas.save(),this.Canvas.beginPath(),this.Canvas.rect(this.RectClient.Left,this.RectClient.Top,this.RectClient.Right-this.RectClient.Left,this.RectClient.Bottom-this.RectClient.Top),this.Canvas.clip(),this.DrawHeader(),this.DrawBody(),this.Canvas.restore(),this.Tab&&this.BottomToolbarHeight>0){var r=this.ChartBorder.GetBottom();this.Tab.DrawTab(this.RectClient.Left,r-this.BottomToolbarHeight,this.RectClient.Right,r),this.Tab.DrawScrollbar(this.RectClient.Left,r-this.BottomToolbarHeight,this.RectClient.Right,r)}this.DrawBorder(),this.DrawDragRow(),this.SizeChange=!1},this.UpdateCacheData=function(){this.RectClient.Left=this.ChartBorder.GetLeft(),this.RectClient.Right=this.ChartBorder.GetRight(),this.RectClient.Top=this.ChartBorder.GetTop(),this.RectClient.Bottom=this.ChartBorder.GetBottom()-this.BottomToolbarHeight},this.GetPageSize=function(r){r&&this.CalculateSize();var n=this.RowCount;return n},this.GetCurrentPageStatus=function(){var r={Start:this.Data.YOffset,PageSize:this.RowCount,IsEnd:!1,SelectedRow:this.SelectedRow,IsSinglePage:!1,DataCount:0};return c.IsNonEmptyArray(this.Data.Data)?(r.End=this.Data.YOffset+this.RowCount-1,r.IsSinglePage=this.Data.Data.length<=this.RowCount,r.DataCount=this.Data.Data.length,r.End>=this.Data.Data.length-1&&(r.IsEnd=!0),r.End>=this.Data.Data.length&&(r.End=this.Data.Data.length-1)):(r.Star=0,r.End=0,r.IsEnd=!0,r.IsSinglePage=!0),r},this.CalculateSize=function(){this.Tab&&this.Tab.IsShow?(this.Tab.CalculateSize(),this.BottomToolbarHeight=this.Tab.Height):this.BottomToolbarHeight=0,this.UpdateCacheData();var r=V();this.HeaderFont=this.HeaderFontConfig.Size*r+"px "+this.HeaderFontConfig.Name,this.ItemFont=this.ItemFontConfig.Size*r+"px "+this.ItemFontConfig.Name,this.ItemFixedFont=this.ItemFixedFontConfg.Size*r+"px "+this.ItemFixedFontConfg.Name,this.ItemSymbolFont=this.ItemSymbolFontConfig.Size*r+"px "+this.ItemSymbolFontConfig.Name,this.ItemNameFont=this.ItemNameFontConfg.Size*r+"px "+this.ItemNameFontConfg.Name,this.RowHeight=this.GetFontHeight(this.ItemFont,"擎")+this.ItemMergin.Top+this.ItemMergin.Bottom,this.FixedRowHeight=this.GetFontHeight(this.ItemFixedFont,"擎")+this.ItemMergin.Top+this.ItemMergin.Bottom,this.Canvas.font=this.ItemFont;for(var n=0,e=0;e<this.Column.length;++e){var t=this.Column[e];if(t.Type==rt.SYMBOL_NAME_ID){this.Canvas.font=this.ItemNameFont;var a=this.Canvas.measureText(t.MaxText).width,s=this.GetFontHeight(this.ItemNameFont,"擎");this.ItemNameHeight=s,this.Canvas.font=this.ItemSymbolFont;var o=this.Canvas.measureText(t.MaxText).width,h=this.GetFontHeight(this.ItemSymbolFont,"擎");this.Canvas.font=this.ItemFont,n=Math.max(a,o),t.Width=n+4+this.ItemMergin.Left+this.ItemMergin.Right;var l=s+h+this.ItemMergin.Top+this.ItemMergin.Bottom;l>this.RowHeight&&(this.RowHeight=l),l>this.FixedRowHeight&&(this.FixedRowHeight=l)}else c.IsNumber(t.FixedWidth)?n=t.FixedWidth:n=this.Canvas.measureText(t.MaxText).width,t.Width=n+4+this.ItemMergin.Left+this.ItemMergin.Right}this.Canvas.font=this.HeaderFont;for(var e=0;e<this.Column.length;++e){var t=this.Column[e];if(!(!t.Title||t.Title.length<=0)){var u=t.Title;t.Sort>0&&(u+="↓"),n=this.Canvas.measureText(u).width,n+=4+this.HeaderMergin.Left+this.HeaderMergin.Right,t.Width<n&&(t.Width=n)}}this.HeaderHeight=this.GetFontHeight(this.HeaderFont,"擎")+this.HeaderMergin.Top+this.HeaderMergin.Bottom,this.IsShowHeader||(this.HeaderHeight=0),this.FixedRowCount<=0&&(this.FixedRowHeight=0),this.RowCount=parseInt((this.RectClient.Bottom-this.RectClient.Top-this.HeaderHeight-this.FixedRowHeight*this.FixedRowCount)/this.RowHeight);for(var f=0,C=this.RectClient.Right-this.RectClient.Left,e=0;e<this.Column.length;++e){var t=this.Column[e];f+=t.Width}this.IsShowAllColumn=f<C},this.DrawHeader=function(){if(this.IsShowHeader){var r=this.RectClient.Left,n=this.RectClient.Top,e=n+this.HeaderMergin.Top+(this.HeaderHeight-this.HeaderMergin.Top-this.HeaderMergin.Bottom)/2;this.Canvas.font=this.HeaderFont,this.Canvas.fillStyle=this.HeaderColor;for(var t=r,a=0;a<this.FixedColumn&&a<this.Column.length;++a){var s=this.Column[a],o=s.Width,h=o-this.HeaderMergin.Left-this.HeaderMergin.Right,l=t+this.HeaderMergin.Left;this.SortInfo&&this.SortInfo.Field==a&&this.SortInfo.Sort>0?this.DrawSortHeader(s.Title,s.TextAlign,l,e,h,this.SortInfo.Sort):this.DrawText(s.Title,s.TextAlign,l,e,h),t+=s.Width}for(var a=this.FixedColumn+this.Data.XOffset;a<this.Column.length;++a){var s=this.Column[a],o=s.Width,h=o-this.HeaderMergin.Left-this.HeaderMergin.Right,l=t+this.HeaderMergin.Left;this.SortInfo&&this.SortInfo.Field==a&&this.SortInfo.Sort>0?this.DrawSortHeader(s.Title,s.TextAlign,l,e,h,this.SortInfo.Sort):this.DrawText(s.Title,s.TextAlign,l,e,h),t+=s.Width}}},this.DrawText=function(r,n,e,t,a){n=="center"?(e=e+a/2,this.Canvas.textAlign="center"):n=="right"?(e=e+a,this.Canvas.textAlign="right"):this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(r,e,t)},this.DrawSortHeader=function(r,n,e,t,a,s){var o=s==1?"↓":"↑",h=this.Canvas.measureText(o).width,l=this.Canvas.measureText(r).width+2;this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",n=="center"?e=e+a/2-(h+l)/2:n=="right"&&(e=e+a-h-l),this.Canvas.fillText(r,e,t),this.Canvas.fillStyle=this.SortColor,this.Canvas.fillText(o,e+l,t),this.Canvas.fillStyle=this.HeaderColor},this.DrawBorder=function(){if(this.IsDrawBorder){var r=this.RectClient.Left,n=this.RectClient.Right,e=this.RectClient.Top;this.RectClient.Bottom,this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),this.Canvas.moveTo(r,L(e+this.HeaderHeight)),this.Canvas.lineTo(n,L(e+this.HeaderHeight));for(var s=e+this.HeaderHeight+this.RowHeight,o=s,t=0;t<this.FixedRowCount;++t){var a=L(s);this.Canvas.moveTo(r,a),this.Canvas.lineTo(n,a),o=s,s+=this.FixedRowHeight}for(var s=e+this.HeaderHeight+this.RowHeight+this.FixedRowHeight*this.FixedRowCount,o=s,t=0;t<this.RowCount;++t){var a=L(s);this.Canvas.moveTo(r,a),this.Canvas.lineTo(n,a),o=s,s+=this.RowHeight}for(var h=r,t=0;t<this.FixedColumn&&t<this.Column.length;++t){var l=this.Column[t],u=L(h+l.Width);this.Canvas.moveTo(u,e),this.Canvas.lineTo(u,o),h+=l.Width}for(var t=this.FixedColumn+this.Data.XOffset;t<this.Column.length;++t){var l=this.Column[t],u=L(h+l.Width);this.Canvas.moveTo(u,e),this.Canvas.lineTo(u,o),h+=l.Width}this.Canvas.stroke()}},this.DrawBody=function(){if(this.Data&&c.IsNonEmptyArray(this.Data.Data)){this.Canvas.font=this.ItemFont;var r=this.RectClient.Top+this.HeaderHeight,n=this.RectClient.Left,e=this.RectClient.Right-this.RectClient.Left,t=r;this.Canvas.font=this.ItemFixedFont;for(var a=0;a<this.FixedRowCount;++a)this.SelectedFixedRow==a&&(this.Canvas.fillStyle=this.SelectedColor,this.Canvas.fillRect(n,t,e,this.FixedRowHeight)),this.FixedRowData.Type==1?this.DrawFixedSymbolRow(t,a):this.DrawFixedRow(t,a),t+=this.FixedRowHeight;t=r+this.FixedRowHeight*this.FixedRowCount,this.Canvas.font=this.ItemFont;for(var a=this.Data.YOffset,s=0;a<this.Data.Data.length&&s<this.RowCount;++a,++s){var o=this.Data.Data[a],h=!1;if(this.SelectedModel==0?s==this.SelectedRow&&(h=!0):a==this.SelectedRow&&(h=!0),this.DragRow){if(this.DragRow.Data){var l=this.DragRow.Data.Row.DataIndex;l==a&&(this.Canvas.fillStyle=this.DragSrcRowColor,this.Canvas.fillRect(n,t,e,this.RowHeight))}if(this.DragRow.MoveRow){var l=this.DragRow.MoveRow.Data.DataIndex;l==a&&(this.Canvas.fillStyle=this.DragMoveRowColor,this.Canvas.fillRect(n,t,e,this.RowHeight))}h=!1}h&&(this.Canvas.fillStyle=this.SelectedColor,this.Canvas.fillRect(n,t,e,this.RowHeight)),this.DrawRow(o,t,a),this.ShowSymbol.push({Index:a,Symbol:o}),t+=this.RowHeight}}},this.DrawFixedSymbolRow=function(r,n){if(this.RectClient.Left,this.RectClient.Right,!(!this.FixedRowData||!c.IsNonEmptyArray(this.FixedRowData.Symbol))){var e=this.FixedRowData.Symbol[n];e&&(this.DrawRow(e,r,n,1),this.ShowSymbol.push({Index:n,Symbol:e,RowType:1}))}},this.DrawFixedRow=function(r,n){for(var e=this.RectClient.Left,t=this.RectClient.Right,a=0;a<this.FixedColumn&&a<this.Column.length;++a){var s=this.Column[a];if(this.DrawFixedItem(n,a,s,e,r),e+=s.Width,e>=t)break}for(var a=this.FixedColumn+this.Data.XOffset;a<this.Column.length;++a){var s=this.Column[a];if(this.DrawFixedItem(n,a,s,e,r),e+=s.Width,e>=t)break}},this.DrawFixedItem=function(r,n,e,t,a){var s=t+this.ItemMergin.Left,o=e.Width-this.ItemMergin.Left-this.ItemMergin.Right,h={Text:null,TextColor:e.TextColor,TextAlign:e.TextAlign};if(this.GetFixedRowTextDrawInfo(r,n,e,h)){this.DrawItemText(h.Text,h.TextColor,h.TextAlign,s,a,o);return}if(!(!this.FixedRowData||!c.IsNonEmptyArray(this.FixedRowData.Data))){var l=this.FixedRowData.Data,u=l[r];if(c.IsNonEmptyArray(u)){var f=u[n];!f||!f.Text||(h.Text=f.Text,f.Color&&(h.TextColor=f.Color),f.TextAlign&&(h.TextAlign=f.TextAlign),this.DrawItemText(h.Text,h.TextColor,h.TextAlign,s,a,o))}}},this.DrawRow=function(r,n,e,t){var a=this.RectClient.Left,s=this.RectClient.Right,o={Symbol:r,Stock:null,Block:null};this.GetStockDataCallback&&(o.Stock=this.GetStockDataCallback(r)),this.GetBlockDataCallback&&(o.Block=this.GetBlockDataCallback(r)),this.GetFlashBGDataCallback&&(o.FlashBG=this.GetFlashBGDataCallback(r,Date.now())),o.Decimal=fe(r);for(var h=0;h<this.FixedColumn&&h<this.Column.length;++h){var l=this.Column[h];if(this.DrawItem(e,o,l,a,n,t),a+=l.Width,a>=s)break}for(var h=this.FixedColumn+this.Data.XOffset;h<this.Column.length;++h){var l=this.Column[h];if(this.DrawItem(e,o,l,a,n,t),a+=l.Width,a>=s)break}},this.DrawItem=function(r,n,e,t,a,s){e.Width;var o=t+this.ItemMergin.Left,h=e.Width-this.ItemMergin.Left-this.ItemMergin.Right,l=n.Stock,u={Text:null,TextColor:e.TextColor,TextAlign:e.TextAlign},f={Left:t,Top:a,Width:e.Width,Height:this.RowHeight};if(f.Right=f.Left+f.Width,f.Bottom=f.Top+f.Height,u.Rect=f,e.EnableTooltip===!0&&this.TooltipRect.push({Rect:f,Stock:l,Index:r,Column:e,RowType:s}),e.Type==rt.INDEX_ID){if(s==1)return;u.Text=(r+1).toString()}else if(e.Type==rt.SYMBOL_ID)l&&l.Symbol?u.Text=l.Symbol:u.Text=n.Symbol,this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.SYMBOL_NAME_ID)this.DrawSymbolName(n,e,t,a,s),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.NAME_ID)l&&l.Name&&c.IsString(l.Name)&&(u.Text=this.TextEllipsis(l.Name,h,e.MaxText),u.TextColor=this.GetNameColor(e,n.Symbol,s)),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.NAME_EX_ID){if(l&&l.NameEx){var C=l.NameEx;u.Text=this.TextEllipsis(C.Text,h,e.MaxText),u.TextColor=this.GetNameColor(e,n.Symbol,s),C.Symbol&&(u.Symbol=C.Symbol)}}else if(e.Type==rt.PRICE_ID)l&&this.GetPriceDrawInfo(l.Price,l,n,u,{LimitBG:!0}),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.OPEN_ID)l&&(this.DrawLimitPriceBorder(l.Open,l,t,a,e.Width),this.GetPriceDrawInfo(l.Open,l,n,u,{LimitBG:!0})),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.HIGH_ID)l&&(this.DrawLimitPriceBorder(l.High,l,t,a,e.Width),this.GetPriceDrawInfo(l.High,l,n,u,{LimitBG:!0})),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.LOW_ID)l&&(this.DrawLimitPriceBorder(l.Low,l,t,a,e.Width),this.GetPriceDrawInfo(l.Low,l,n,u,{LimitBG:!0})),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.YCLOSE_ID)l&&this.GetPriceDrawInfo(l.YClose,l,n,u),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.BUY_PRICE_ID)l&&this.GetPriceDrawInfo(l.BuyPrice,l,n,u),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.SELL_PRICE_ID)l&&this.GetPriceDrawInfo(l.SellPrice,l,n,u),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.AVERAGE_PRICE_ID)l&&this.GetPriceDrawInfo(l.AvPrice,l,n,u),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.EXCHANGE_RATE_ID)l&&c.IsNumber(l.Exchange)&&(u.Text=l.Exchange.toFixed(2)),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.BUY_VOL_ID)l&&c.IsNumber(l.BuyVol)&&(u.Text=this.FormatVolString(l.BuyVol)),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.SELL_VOL_ID)l&&c.IsNumber(l.SellVol)&&(u.Text=this.FormatVolString(l.SellVol)),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.VOL_ID)l&&c.IsNumber(l.Vol)&&(u.Text=this.FormatVolString(l.Vol)),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.VOL_IN_ID)l&&c.IsNumber(l.VolIn)&&(u.Text=this.FormatVolString(l.VolIn)),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.VOL_OUT_ID)l&&c.IsNumber(l.VolOut)&&(u.Text=this.FormatVolString(l.VolOut)),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.TOTAL_SHARES_ID)l&&c.IsNumber(l.TotalShares)&&(u.Text=this.FormatVolString(l.TotalShares)),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.OUTSTANDING_SHARES_ID)l&&c.IsNumber(l.OutShares)&&(u.Text=this.FormatVolString(l.OutShares)),this.FormatDrawInfo(e,l,u,n);else if(e.Type==rt.CIRC_MARKET_VALUE_ID||e.Type==rt.MARKET_VALUE_ID||e.Type==rt.AMOUNT_ID){var D=as.get(e.Type);l&&c.IsNumber(l[D])&&(u.Text=this.FormatVolString(l[D])),this.FormatDrawInfo(e,l,u,n)}else if(e.Type==rt.INCREASE_ID||e.Type==rt.AMPLITUDE_ID||e.Type==rt.UPDOWN_ID){var D=as.get(e.Type);if(l&&c.IsNumber(l[D])){var v=l[D];u.Text=v.toFixed(2),u.TextColor=this.GetUpDownColor(v,0)}this.FormatDrawInfo(e,l,u,n)}else if(e.Type==rt.CUSTOM_STRING_TEXT_ID)this.GetCustomStringDrawInfo(n,e,u);else if(e.Type==rt.CUSTOM_NUMBER_TEXT_ID)this.GetCustomNumberDrawInfo(n,e,u);else if(e.Type==rt.CUSTOM_DATETIME_TEXT_ID)this.GetCustomDateTimeDrawInfo(n,e,u);else if(e.Type==rt.CUSTOM_ICON_ID)this.GetCustomIconDrawInfo(n,e,u);else if(e.Type==rt.CLOSE_LINE_ID){var f={Left:t,Top:a,Width:e.Width,Height:this.RowHeight};f.Right=f.Left+f.Width,f.Bottom=f.Top+f.Height,this.DrawLine(l.CloseLine,e,f)}else if(e.Type==rt.KLINE_ID){var f={Left:t,Top:a,Width:e.Width,Height:this.RowHeight};f.Right=f.Left+f.Width,f.Bottom=f.Top+f.Height,this.DrawKLine(l.KLine,e,f,n)}if(s==3&&(u.TextColor=this.DragRowTextColor),u.Symbol)this.DrawItemTextEx(u,o,a,h);else if(e.Type==rt.CUSTOM_ICON_ID)this.DrawIconItem(u,o,a,h);else{if(n.FlashBG&&n.FlashBG.Data&&e.ID!=null&&n.FlashBG.Data.has(e.ID)){var S=n.FlashBG.Data.get(e.ID),T={Rect:u.Rect,BGColor:S.Color};--S.Count,this.DrawItemBG(T),this.GlobalOption&&++this.GlobalOption.FlashBGCount}this.DrawItemBG(u),this.DrawItemText(u.Text,u.TextColor,u.TextAlign,o,a,h,u.BGColor)}},this.DrawSymbolName=function(r,n,e,t,a){var s=r.Stock,o=r.Symbol,h;if(s&&(o=s.Symbol,h=s.Name),!(!o&&!h)){var l=t+this.ItemMergin.Top+this.ItemNameHeight,u=e+this.ItemMergin.Left,f=u,C=n.Width-this.ItemMergin.Left-this.ItemMergin.Right,D=n.TextAlign;D=="center"?(f=u+C/2,this.Canvas.textAlign="center"):D=="right"?(f=u+C-2,this.Canvas.textAlign="right"):(f+=2,this.Canvas.textAlign="left");var v=this.GetNameColor(n,o,a),S=h;S&&(this.Canvas.textBaseline="ideographic",this.Canvas.fillStyle=v,this.Canvas.font=this.ItemNameFont,S=this.TextEllipsis(S,C,n.MaxText),S&&this.Canvas.fillText(S,f,l)),S=o,S&&(this.Canvas.textBaseline="top",this.Canvas.font=this.ItemSymbolFont,this.Canvas.fillStyle=v,this.Canvas.fillText(S,f,l)),this.Canvas.font=this.ItemFont}},this.DrawLimitPriceBorder=function(r,n,e,t,a){if(!(!c.IsNumber(r)||!n)){var s=!1;if(c.IsNumber(n.LimitHigh)&&r>=n.LimitHigh&&(s=!0),c.IsNumber(n.LimitLow)&&r<=n.LimitLow&&(s=!0),!!s){var o=e+this.ItemMergin.Left+this.LimitMergin.Left,h=a-this.ItemMergin.Left-this.ItemMergin.Right-this.LimitMergin.Left-this.LimitMergin.Right,l=t+this.ItemMergin.Top+this.LimitMergin.Top,u=this.RowHeight-this.ItemMergin.Top-this.ItemMergin.Bottom-this.LimitMergin.Top-this.LimitMergin.Bottom;this.Canvas.strokeStyle=this.LimitBorderColor,this.Canvas.strokeRect(L(o),L(l),B(h),B(u))}}},this.GetExtendData=function(r,n){return c.IsNumber(n.DataIndex)?!r.Stock||!r.Stock.ExtendData?null:n.DataIndex<0?void 0:r.Stock.ExtendData[n.DataIndex]:c.IsNumber(n.BlockIndex)?!r.Block||n.BlockIndex<0?void 0:r.Block[n.BlockIndex]:null},this.GetCustomStringDrawInfo=function(r,n,e){var t=this.GetExtendData(r,n);if(n.IsDrawCallback){this.GetCustomTextDrawInfo(n,r.Symbol,t,e,r);return}c.IsString(t)&&(e.Text=t)},this.GetCustomNumberDrawInfo=function(r,n,e){var t=this.GetExtendData(r,n);if(n.IsDrawCallback){this.GetCustomTextDrawInfo(n,r.Symbol,t,e,r);return}if(c.IsNumber(t)){switch(n.FormatType){case 1:e.Text=t.toFixed(n.Decimal);break;case 2:e.Text=c.FormatValueThousandsString(t,n.Decimal);break;case 3:e.Text=this.FormatVolString(t);break;default:e.Text=c.FormatValueString(t,n.Decimal);break}switch(n.ColorType){case 1:e.TextColor=this.GetUpDownColor(t,0);break;case 2:c.IsNumber(r.Stock.YClose)?e.TextColor=this.GetUpDownColor(t,r.Stock.YClose):e.TextColor=this.UnchagneColor;break}}},this.GetCustomDateTimeDrawInfo=function(r,n,e){var t=this.GetExtendData(r,n);if(c.IsNumber(t)){if(n.IsDrawCallback){this.GetCustomTextDrawInfo(n,r.Symbol,t,e,r);return}n.ValueType==0&&(n.FormatType==1?e.Text=c.FormatDateString(t,"YYYY/MM/DD"):e.Text=c.FormatDateString(t))}},this.GetCustomIconDrawInfo=function(r,n,e){if(n.IsDrawCallback){this.GetCustomIconData(n,r.Symbol,e,r);return}},this.GetCustomIconData=function(r,n,e,t){var a=this.GetEventCallback(et.ON_REPORT_DRAW_CUSTOM_ICON);if(!a||!a.Callback)return!1;var s={Symbol:n,Column:r,Data:t,Out:{Text:null,TextColor:null,TextAlign:null,Font:null}};return a.Callback(a,s,this),s.Out.Text&&(e.Text=s.Out.Text),s.Out.TextColor&&(e.TextColor=s.Out.TextColor),s.Out.TextAlign&&(e.TextAlign=s.Out.TextAlign),s.Out.BGColor&&(e.BGColor=s.Out.BGColor),s.Out.Font&&(e.Font=s.Out.Font),!0},this.GetPriceDrawInfo=function(r,n,e,t,a){if(!c.IsNumber(r))return!1;t.Text=r.toFixed(e.Decimal),c.IsNumber(n.YClose)?t.TextColor=this.GetUpDownColor(r,n.YClose):t.TextColor=this.UnchagneColor,a&&a.LimitBG&&(c.IsNumber(n.LimitHigh)&&r>=n.LimitHigh&&(t.BGColor=this.LimitUpBGColor,t.TextColor=this.LimitTextColor),c.IsNumber(n.LimitLow)&&r<=n.LimitLow&&(t.BGColor=this.LimitDownBGColor,t.TextColor=this.LimitTextColor))},this.GetUpDownColor=function(r,n){return r>n?this.UpColor:r<n?this.DownColor:this.UnchagneColor},this.FormatVolString=function(r,n){return c.FormatVolString(r,n)},this.DrawItemBG=function(r){if(r.BGColor&&r.Rect){var n=r.Rect;this.Canvas.fillStyle=r.BGColor,this.Canvas.fillRect(n.Left,n.Top,n.Width,n.Height)}},this.DrawItemText=function(r,n,e,t,a,s,o){if(r){var h=t;e=="center"?(h=t+s/2,this.Canvas.textAlign="center"):e=="right"?(h=t+s-2,this.Canvas.textAlign="right"):(h+=2,this.Canvas.textAlign="left");var l=this.Canvas.measureText(r).width+1,u=!1;if(l>=s){this.Canvas.save(),u=!0;var f={Left:t,Top:a+this.ItemMergin.Top,Width:s,Height:this.RowHeight};this.Canvas.beginPath(),this.Canvas.rect(f.Left,f.Top,f.Width,f.Height),this.Canvas.clip()}this.Canvas.textBaseline="middle",this.Canvas.fillStyle=n,this.Canvas.fillText(r,h,a+this.ItemMergin.Top+this.RowHeight/2),u&&this.Canvas.restore()}},this.DrawItemTextEx=function(r,n,e,t){var a=r.Text,s=r.TextColor,o=r.Symbol,h=r.TextAlign,l=this.Canvas.measureText(a).width+1,u=l,f=o.Size*V()+"px "+o.Family;this.Canvas.font=f;for(var C=[],D=0;D<o.Data.length;++D){var v=o.Data[D],S=this.Canvas.measureText(v.Text).width+1;if(u+S>t)break;u+=S,C[D]=S}var T=n,I=e+this.ItemMergin.Top+this.RowHeight/2;h=="center"?T=n+(t-u)/2:h=="right"?T=n+(t-u):T+=2,this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.font=this.ItemFont,this.Canvas.fillStyle=s,this.Canvas.fillText(a,T,I),T+=l,this.Canvas.font=f;for(var D=0;D<C.length;++D){var v=o.Data[D];this.Canvas.fillStyle=v.Color,this.Canvas.fillText(v.Text,T,I),T+=C[D]}this.Canvas.font=this.ItemFont},this.DrawIconItem=function(r,n,e,t){if(!(!r||!r.Font||!r.Text)){var a=r.Text,s=r.TextColor,o=r.TextAlign;this.Canvas.font=r.Font;var h=this.Canvas.measureText(a).width+1,l=n,u=e+this.ItemMergin.Top+this.RowHeight/2;o=="center"?l=n+(t-h)/2:o=="right"?l=n+(t-h):l+=2,this.Canvas.textBaseline="middle",this.Canvas.textAlign="left",this.Canvas.fillStyle=s,this.Canvas.fillText(a,l,u),this.Canvas.font=this.ItemFont}},this.TextEllipsis=function(r,n,e){if(!r)return null;if(r.length<e.length)return r;var t=e.length-3;if(t<0)return null;for(var a=r.slice(0,t),s=t;s<r.length;++s){var o=a+r[s]+"...",h=this.Canvas.measureText(o).width;if(h>n){a+="...";break}a+=r[s]}return a},this.DrawMultiBar=function(r,n,e){if(!n.Source||!c.IsNonEmptyArray(n.Source))return!1;var t=n.Source[r.DataIndex];if(!t||!c.IsNonEmptyArray(t.Value))return!1;for(var a=e.Width-this.BarMergin.Left-this.BarMergin.Right,s=e.Left+this.BarMergin.Left,o=e.Top+this.RowMergin.Top+this.BarMergin.Top,h=e.Height-this.RowMergin.Top-this.RowMergin.Bottom-this.BarMergin.Top-this.BarMergin.Bottom,l=s+a,u=0;u<t.Value.length;++u){var f=t.Value[u];if(!(f<=0)){if(s>=l)break;var C=a*f;C<1&&(C=1),s+C>l&&(C=l-s);var D=u;c.IsNonEmptyArray(t.Color)&&u<t.Color.length&&(D=t.Color[u]),this.Canvas.fillStyle=m.DealList.FieldColor.Bar[D],this.Canvas.fillRect(s,o,C,h),s+=C}}return!0},this.DrawCenterBar=function(r,n,e){if(!n.Source||!c.IsNonEmptyArray(n.Source))return!1;var t=n.Source[r.DataIndex];if(!t||!c.IsNonEmptyArray(t.Value))return!1;for(var a=(e.Width-this.BarMergin.Left-this.BarMergin.Right)/2,s=e.Left+this.BarMergin.Left,o=s+a,h=e.Top+this.RowMergin.Top+this.BarMergin.Top,l=e.Height-this.RowMergin.Top-this.RowMergin.Bottom-this.BarMergin.Top-this.BarMergin.Bottom,u=0;u<t.Value.length&&u<2;++u){var f=t.Value[u];if(!(f<=0)){f>1&&(f=1);var C=a*f;C<1&&(C=1);var D=u;c.IsNonEmptyArray(t.Color)&&u<t.Color.length&&(D=t.Color[u]),this.Canvas.fillStyle=m.DealList.FieldColor.Bar[D],u==0?this.Canvas.fillRect(o,h,-C,l):this.Canvas.fillRect(o,h,C,l)}}},this.DrawLine=function(r,n,e){if(!r||!c.IsNonEmptyArray(r.Data))return!1;var t=e.Width-this.ItemMergin.Left-this.ItemMergin.Right,a=e.Left+this.ItemMergin.Left,s=e.Top+this.ItemMergin.Top,o=e.Height-this.ItemMergin.Top-this.ItemMergin.Bottom,h=a+t,l=s+o,u=function(p){var G=r.Count;if(G==1)return p==0?a:h;if(G<=0)return a;if(p>=G)return h;var Y=a+t*p/G;return Y},f=r.Max,C=r.Min;if(c.IsNumber(r.YClose))if(r.YClose==f&&r.YClose==C)f=r.YClose+r.YClose*.1,C=r.YClose-r.YClose*.1;else{var D=Math.max(Math.abs(r.YClose-f),Math.abs(r.YClose-C));f=r.YClose+D,C=r.YClose-D}var v=function(G){if(G<=C)return l;if(G>=f)return s;var G=o*(G-C)/(f-C);return l-G};this.Canvas.save();var S=null;if(c.IsNumber(r.YClose)){var M=v(r.YClose);M=L(M),S=M,this.Canvas.setLineDash([2,2]),this.Canvas.strokeStyle=this.CloseLineConfig.YCloseColor,this.Canvas.beginPath(),this.Canvas.moveTo(a,M),this.Canvas.lineTo(h,M),this.Canvas.stroke(),this.Canvas.setLineDash([])}r.Color?this.Canvas.strokeStyle=r.Color:this.Canvas.strokeStyle=this.CloseLineConfig.CloseColor;for(var T=!0,I={},F=0,E,M,O=0;O<r.Data.length;++O){var R=r.Data[O];c.IsNumber(R)&&(E=u(O),M=v(R),T?(this.Canvas.beginPath(),this.Canvas.moveTo(E,M),T=!1,I={X:E,Y:M}):this.Canvas.lineTo(E,M),++F)}F>0&&(this.Canvas.stroke(),n.IsDrawArea&&c.IsNumber(S)&&(this.Canvas.lineTo(E,S),this.Canvas.lineTo(I.X,S),this.Canvas.closePath(),this.SetFillStyle(this.CloseLineConfig.AreaColor,a,s,a,l),this.Canvas.fill())),this.Canvas.restore()},this.DrawKLine=function(r,n,e,t){if(n.IsDrawCallback){var a=this.GetEventCallback(et.ON_REPORT_DRAW_KLINE);if(a||a.Callback){var s={Column:n,Data:t,KLineData:r,Rect:e,PreventDefault:!1};if(a.Callback(a,s,this),s.PreventDefault)return}}if(r&&c.IsNonEmptyArray(r.Data)){var o=r.Data[1],h=r.Data[2],l=[{Open:r.Data[0],High:o,Low:h,Close:r.Data[3]}];this.DrawKLineBar(l,o,h,e)}},this.DrawKLineBar=function(r,n,e,t){for(var a=4,o=t.Left+this.ItemMergin.Left,s=t.Width-this.ItemMergin.Left-this.ItemMergin.Right,o=t.Left+this.ItemMergin.Left,h=t.Top+this.ItemMergin.Top+a,l=t.Height-this.ItemMergin.Top-this.ItemMergin.Bottom-a*2,u=o+s,f=h+l,C=function(Y){if(Y<=e)return f;if(Y>=n)return h;var Y=l*(Y-e)/(n-e);return f-Y},D=this.KLineConfig.DataWidth,v=this.KLineConfig.DistanceWidth,S=o,T,I,F=0;F<r.length;++F,S+=D+v){var E=r[F];if(T=S,I=S+D,I>u)break;var M=C(E.Low),O=C(E.High),R=C(E.Open),b=C(E.Close);E.Open<E.Close?this.DrawKBarItem(E,D,this.KLineConfig.UpColor,1,T,I,M,O,R,b):E.Open>E.Close?this.DrawKBarItem(E,D,this.KLineConfig.DownColor,0,T,I,M,O,R,b):this.DrawKBarItem(E,D,this.KLineConfig.UnchagneColor,0,T,I,M,O,R,b)}},this.DrawKBarItem=function(r,n,e,t,a,s,o,h,l,u){var f=!1;t==1&&(f=!0);var C=Math.min(l,u),D=Math.max(l,u),v=Math.max(r.Open,r.Close),S=Math.min(r.Open,r.Close);this.Canvas.fillStyle=e,this.Canvas.strokeStyle=e;var T=a+(s-a)/2;if(f&&n%2!=0&&(n-=1),n>=4){if(r.High>v){this.Canvas.beginPath();var I=T;f&&(I=a+n/2),this.Canvas.moveTo(L(I),L(C)),this.Canvas.lineTo(L(I),L(h)),this.Canvas.stroke()}if(Math.abs(D-C)<1?this.Canvas.fillRect(B(a),B(C),B(n),1):f?(this.Canvas.beginPath(),this.Canvas.rect(L(a),L(C),B(n),B(D-C)),this.Canvas.stroke()):this.Canvas.fillRect(B(a),B(C),B(n),B(D-C)),r.Low<S){this.Canvas.beginPath();var I=T;f&&(I=a+n/2),this.Canvas.moveTo(L(I),L(D)),this.Canvas.lineTo(L(I),L(o)),this.Canvas.stroke()}}},this.SetFillStyle=function(r,n,e,t,a){if(Array.isArray(r)){var s=this.Canvas.createLinearGradient(n,e,t,a),o=1/r.length;for(var h in r)s.addColorStop(h*o,r[h]);this.Canvas.fillStyle=s}else this.Canvas.fillStyle=r},this.GetCustomTextDrawInfo=function(r,n,e,t,a){var s=this.GetEventCallback(et.ON_DRAW_CUSTOM_TEXT);if(!s||!s.Callback)return!1;var o={Symbol:n,Column:r,Value:e,Data:a,Out:{Text:null,TextColor:null,TextAlign:null}};return s.Callback(s,o,this),o.Out.Text&&(t.Text=o.Out.Text),o.Out.TextColor&&(t.TextColor=o.Out.TextColor),o.Out.TextAlign&&(t.TextAlign=o.Out.TextAlign),o.Out.BGColor&&(t.BGColor=o.Out.BGColor),!0},this.FormatDrawInfo=function(r,n,e,t){if(!r.IsDrawCallback)return!1;var a=this.GetEventCallback(et.ON_REPORT_FORMAT_DRAW_INFO);if(!a||!a.Callback)return!1;var s={Stock:n,Column:r,Data:t,DrawInfo:e};a.Callback(a,s,this)},this.GetFixedRowTextDrawInfo=function(r,n,e,t){var a=this.GetEventCallback(et.ON_DRAW_REPORT_FIXEDROW_TEXT);if(!a||!a.Callback)return!1;var s={RowIndex:r,ColIndex:n,Column:e,Data:this.FixedRowData,Out:{Text:null,TextColor:null,TextAlign:null}};return a.Callback(a,s,this),s.Out.Text&&(t.Text=s.Out.Text),s.Out.TextColor&&(t.TextColor=s.Out.TextColor),s.Out.TextAlign&&(t.TextAlign=s.Out.TextAlign),!0},this.GetVolColor=function(r,n){var e=this.GetEventCallback(et.ON_DRAW_DEAL_VOL_COLOR);if(e&&e.Callback){var t={Data:n,TextColor:null};if(e.Callback(e,t,this),t.TextColor)return t.TextColor}return r.TextColor},this.GetNameColor=function(r,n,e){var t=this.GetEventCallback(et.ON_DRAW_REPORT_NAME_COLOR);if(t&&t.Callback){var a={Symbol:n,TextColor:null,RowType:e};if(t.Callback(t,a,this),a.TextColor)return a.TextColor}return r.TextColor},this.GetFontHeight=function(r,n){return Aa(this.Canvas,r,n)},this.OnMouseDown=function(r,n,e){if(!this.Data)return null;if(this.Tab){var t=this.Tab.OnMouseDown(r,n,e);if(t)return{Type:1,Tab:t}}var a=V(),s={X:r/a,Y:n/a};if(this.UIElement)var o={Left:this.UIElement.getBoundingClientRect().left,Top:this.UIElement.getBoundingClientRect().top};else var o={Left:null,Top:null};var u=this.PtInFixedBody(r,n);if(u){var h=!0,l=et.ON_CLICK_REPORT_FIXEDROW;return e.button==2&&(l=et.ON_RCLICK_REPORT_FIXEDROW),this.SendClickEvent(l,{Data:u,X:r,Y:n,e,Inside:s,UIElement:o}),this.SelectedFixedRow=u.Index,this.SelectedRow=-1,{Type:4,Redraw:h,Row:u}}var u=this.PtInBody(r,n);if(u){var h=!0;this.SelectedModel==0?(this.SelectedRow==u.Index&&(h=!1),this.SelectedRow=u.Index,this.SelectedFixedRow=-1):(this.SelectedRow==u.DataIndex&&(h=!1),this.SelectedRow=u.DataIndex,this.SelectedFixedRow=-1);var l=et.ON_CLICK_REPORT_ROW;return e.button==2&&(l=et.ON_RCLICK_REPORT_ROW),this.SendClickEvent(l,{Data:u,X:r,Y:n,e,Inside:s,UIElement:o}),{Type:2,Redraw:h,Row:u}}var f=this.PtInHeader(r,n);if(f){var l=et.ON_CLICK_REPORT_HEADER;return e.button==2?l=et.ON_RCLICK_REPORT_HEADER:e.button==0&&(l=et.ON_CLICK_REPORT_HEADER),this.SendClickEvent(l,{Data:u,X:r,Y:n,e,Inside:s,UIElement:o}),{Type:3,Redraw:h,Header:f}}return null},this.OnDrawgRow=function(r,n,e){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return null;var t=this.RowHeight/2,a=this.RectClient.Top+this.HeaderHeight,s=this.ChartBorder.GetChartWidth(),o=a+this.FixedRowHeight*this.FixedRowCount;if(n<o+t)return{Type:5};for(var h=this.Data.YOffset,l=0;h<this.Data.Data.length&&l<this.RowCount;++h,++l){var u=this.Data.Data[h],f={Left:0,Top:o,Right:s,Bottom:o+this.RowHeight};if(f.Top+=t,f.Bottom+=t,r>=f.Left&&r<=f.Right&&n>=f.Top&&n<=f.Bottom){var C={DataIndex:h,Index:l,Symbol:u,Pos:0};return l==0?C.Pos=1:l==this.RowCount-1&&(C.Pos=2),{Type:2,Data:C}}o+=this.RowHeight}return l<this.RowCount?{Type:6}:{Type:7}},this.OnDblClick=function(r,n,e){if(!this.Data)return!1;var t=this.PtInHeaderDragBorder(r,n);if(t)return this.SendClickEvent(et.ON_DBCLICK_REPORT_DRAG_COLUMN_WIDTH,{Data:t,X:r,Y:n}),!0;var a=this.PtInBody(r,n);return a?(this.SendClickEvent(et.ON_DBCLICK_REPORT_ROW,{Data:a,X:r,Y:n}),!0):!1},this.PtInBody=function(r,n){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return null;var e=this.RectClient.Top+this.HeaderHeight,t=this.RectClient.Left,a=this.RectClient.Right;this.RectClient.Right-this.RectClient.Left;for(var s=e+this.FixedRowHeight*this.FixedRowCount,o=this.Data.YOffset,h=0;o<this.Data.Data.length&&h<this.RowCount;++o,++h){var l=this.Data.Data[o],u={Left:t,Top:s,Right:a,Bottom:s+this.RowHeight};if(r>=u.Left&&r<=u.Right&&n>=u.Top&&n<=u.Bottom){var f={Rect:u,DataIndex:o,Index:h,Symbol:l};return f.Item=this.PtInItem(r,n,u.Top,u.Bottom),f}s+=this.RowHeight}return null},this.PtInFixedBody=function(r,n){if(this.FixedRowCount<=0)return null;var e=this.RectClient.Top+this.HeaderHeight,t=this.RectClient.Left,a=this.RectClient.Right;this.RectClient.Right-this.RectClient.Left;for(var s=e,o=0;o<this.FixedRowCount;++o){var h={Left:t,Top:s,Right:a,Bottom:s+this.FixedRowHeight};if(r>=h.Left&&r<=h.Right&&n>=h.Top&&n<=h.Bottom){var l={Rect:h,Index:o};return l.Item=this.PtInItem(r,n,h.Top,h.Bottom),l}s+=this.FixedRowHeight}return null},this.PtInItem=function(r,n,e,t){for(var a=this.RectClient.Left,s=this.RectClient.Right,o=a,h=0;h<this.FixedColumn&&h<this.Column.length;++h){var l=this.Column[h],u={Left:o,Right:o+l.Width,Top:e,Bottom:t};if(r>=u.Left&&r<=u.Right&&n>=u.Top&&n<=u.Bottom)return{Rect:u,Column:l,Index:h,IsFixed:!0};o+=l.Width}for(var h=this.FixedColumn+this.Data.XOffset;h<this.Column.length;++h){var l=this.Column[h];if(o>=s)break;var u={Left:o,Right:o+l.Width,Top:e,Bottom:t};if(r>=u.Left&&r<=u.Right&&n>=u.Top&&n<=u.Bottom)return{Rect:u,Column:l,Index:h,IsFixed:!1};o+=l.Width}return null},this.PtInHeader=function(r,n){if(!this.IsShowHeader)return null;var e=this.RectClient.Left,t=this.RectClient.Right,a=this.RectClient.Top,s=a+this.HeaderHeight;return r>=e&&r<=t&&n>=a&&n<=s?this.PtInItem(r,n,a,s):null},this.IsPtInBody=function(r,n){var e=this.RectClient.Top+this.HeaderHeight,t=this.RectClient.Left,a=this.RectClient.Right,s=this.RectClient.Bottom;return r>=t&&r<=a&&n>=e&&n<=s},this.IsPtInHeader=function(r,n){if(!this.IsShowHeader)return!1;var e=this.RectClient.Left,t=this.RectClient.Right,a=this.RectClient.Top,s=a+this.HeaderHeight;return r>=e&&r<=t&&n>=a&&n<=s},this.SendClickEvent=function(r,n){var e=this.GetEventCallback(r);e&&e.Callback&&e.Callback(e,n,this)},this.DrawDragRow=function(){if(this.DragRow){var r=this.DragRow;if(!(!r.Data||!r.Inside||!r.Data.Row)){var n=r.Data.Row.DataIndex;if(!(!c.IsNumber(n)||n<0)){var e=r.Inside.Y-this.RowHeight/2,t=e,a=this.RectClient.Left,s=this.RectClient.Right-this.RectClient.Left;this.Canvas.fillStyle=this.DragRowColor,this.Canvas.fillRect(a,e,s,this.RowHeight);var o=this.Data.Data[n],h={Symbol:o,Stock:null,Block:null};this.GetStockDataCallback&&(h.Stock=this.GetStockDataCallback(o)),this.GetBlockDataCallback&&(h.Block=this.GetBlockDataCallback(o)),h.Decimal=fe(o);var l=this.RectClient.Right;this.Canvas.font=this.ItemFont;for(var u=0;u<this.FixedColumn&&u<this.Column.length;++u){var f=this.Column[u];if(this.DrawItem(n,h,f,a,t,3),a+=f.Width,a>=l)break}for(var u=this.FixedColumn+this.Data.XOffset;u<this.Column.length;++u){var f=this.Column[u];if(this.DrawItem(n,h,f,a,t,3),a+=f.Width,a>=l)break}}}}},this.PtInCell=function(r,n){if(!c.IsNonEmptyArray(this.TooltipRect))return null;for(var e=0;e<this.TooltipRect.length;++e){var t=this.TooltipRect[e],a=t.Rect;if(a&&r>=a.Left&&r<=a.Right&&n>=a.Top&&n<=a.Bottom)return{Rect:t.Rect,Stock:t.Stock,Column:t.Column,Index:t.Index}}},this.PtInHeaderDragBorder=function(r,n){if(!this.IsShowHeader)return null;var e=this.RectClient.Left,t=this.RectClient.Right,a=this.RectClient.Top,s=a+this.HeaderHeight;if(!(r>=e&&r<=t&&n>=a&&n<=s))return null;for(var o=e,h=5*V(),l=0;l<this.FixedColumn&&l<this.Column.length;++l){var u=this.Column[l];if(u.EnableDragWidth===!0){var f={Right:o+u.Width,Top:a,Bottom:s};if(f.Left=f.Right-h,r>=f.Left&&r<=f.Right&&n>=f.Top&&n<=f.Bottom)return{Rect:f,Column:u,Index:l,IsFixed:!0}}o+=u.Width}for(var l=this.FixedColumn+this.Data.XOffset;l<this.Column.length;++l){var u=this.Column[l];if(o>=t)break;if(u.EnableDragWidth===!0){var f={Right:o+u.Width,Top:a,Bottom:s};if(f.Left=f.Right-h,r>=f.Left&&r<=f.Right&&n>=f.Top&&n<=f.Bottom)return{Rect:f,Column:u,Index:l,IsFixed:!1}}o+=u.Width}return null}}function GI(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ChartReportTab",this.IsDrawFirst=!1,this.GetEventCallback,this.Report,this.IsShow=!0,this.TabList=[],this.SelectedTabIndex=-1,this.MoveOnTabIndex=-1,this.MaxPos=15,this.CurrentPos=15,this.Step=1,this.ScrollBarWidth=m.Report.Tab.ScrollBarWidth,this.ButtonColor=m.Report.Tab.ButtonColor,this.BarColor=m.Report.Tab.BarColor,this.BorderColor=m.Report.Tab.BorderColor,this.Mergin={Left:2,Right:2,Top:2,Bottom:2},this.TabFontConfig={Size:m.Report.Tab.Font.Size,Name:m.Report.Tab.Font.Name},this.TabFont,this.TabTitleColor=m.Report.Tab.TabTitleColor,this.TabSelectedTitleColor=m.Report.Tab.TabSelectedTitleColor,this.TabSelectedBGColor=m.Report.Tab.TabSelectedBGColor,this.TabMoveOnTitleColor=m.Report.Tab.TabMoveOnTitleColor,this.TabBGColor=m.Report.Tab.TabBGColor,this.TabMergin={Top:m.Report.Tab.Mergin.Top,Left:m.Report.Tab.Mergin.Left,Right:m.Report.Tab.Mergin.Right,Bottom:m.Report.Tab.Mergin.Bottom},this.Height,this.ButtonSize=25,this.TabWidth=0,this.RectScroll={Left:null,Right:null,Bar:null,Client:null},this.ReloadResource=function(r){this.ScrollBarWidth=m.Report.Tab.ScrollBarWidth,this.ButtonColor=m.Report.Tab.ButtonColor,this.BarColor=m.Report.Tab.BarColor,this.BorderColor=m.Report.Tab.BorderColor,this.TabFontConfig={Size:m.Report.Tab.Font.Size,Name:m.Report.Tab.Font.Name},this.TabTitleColor=m.Report.Tab.TabTitleColor,this.TabSelectedTitleColor=m.Report.Tab.TabSelectedTitleColor,this.TabSelectedBGColor=m.Report.Tab.TabSelectedBGColor,this.TabMoveOnTitleColor=m.Report.Tab.TabMoveOnTitleColor,this.TabBGColor=m.Report.Tab.TabBGColor,this.TabMergin={Top:m.Report.Tab.Mergin.Top,Left:m.Report.Tab.Mergin.Left,Right:m.Report.Tab.Mergin.Right,Bottom:m.Report.Tab.Mergin.Bottom}},this.SetTabList=function(r){this.TabList=[];for(var n=0;n<r.length;++n){var e=r[n];if(e.Title){var t={Title:e.Title,IsMenu:!1,FixedSymbol:[],FixedRowCount:0};if(e.ID&&(t.ID=e.ID),e.MenuID&&(t.MenuID=e.MenuID),c.IsBool(e.IsMenu)&&(t.IsMenu=e.IsMenu),c.IsNonEmptyArray(e.FixedSymbol))for(var a=0;a<e.FixedSymbol.length;++a){var s=e.FixedSymbol[a];!s||!s.Symbol||(t.FixedSymbol.push(s),++t.FixedRowCount)}this.TabList.push(t)}}},this.CalculateSize=function(){var r=V();this.TabFont=this.TabFontConfig.Size*r+"px "+this.TabFontConfig.Name,this.Height=this.GetFontHeight(this.TabFont,"8")+this.Mergin.Top+this.Mergin.Bottom;var n=Math.min(25,this.Height-this.Mergin.Top-this.Mergin.Bottom);this.ButtonSize=n},this.DrawScrollbar=function(o,n,e,t){this.RectScroll={Left:null,Right:null,Bar:null,Client:null};var a=this.Report.GetXScrollPos(),s=this.Report.GetXScrollRange();if(!(s<=0)&&!this.Report.IsShowAllColumn){var o=o+this.TabWidth;if(!(o+this.ScrollBarWidth*2>e)){this.MaxPos=s,this.CurrentPos=a;var h=this.ButtonSize,l={Left:o+this.Mergin.Left,Top:t-h-this.Mergin.Bottom,Width:h,Height:h};l.Right=l.Left+h,l.Bottom=l.Top+h;var u={Left:e-h-this.Mergin.Right,Top:l.Top,Width:h,Height:h};u.Right=u.Left+h,u.Bottom=u.Top+h,this.Canvas.fillStyle=this.ButtonColor,this.Canvas.fillRect(l.Left,l.Top,l.Width,l.Height),this.Canvas.fillRect(u.Left,u.Top,u.Width,u.Height),this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(l.Left,l.Top,l.Width,l.Height),this.Canvas.strokeRect(u.Left,u.Top,u.Width,u.Height);var f=u.Left-2-(l.Right+2),C=f-this.ScrollBarWidth,D=C*this.CurrentPos/this.MaxPos,v=l.Right+2+D,S={Left:v,Top:l.Top,Width:this.ScrollBarWidth,Height:l.Height};S.Right=S.Left+this.ScrollBarWidth,S.Bottom=l.Bottom,this.Canvas.fillStyle=this.BarColor,this.Canvas.fillRect(S.Left,S.Top,S.Width,S.Height),this.RectScroll.Left=l,this.RectScroll.Right=u,this.RectScroll.Bar=S,this.RectScroll.Client={Left:l.Right,Right:u.Left,Top:l.Top,Bottom:l.Bottom}}}},this.DrawTab=function(r,n,e,t){this.TabWidth=0,this.Canvas.font=this.TabFont,this.Canvas.textBaseline="bottom";var a=t-n,s=r+1,o=t-this.TabMergin.Bottom,h=0,l,u=0,f=0;for(f=0;f<this.TabList.length;++f){var C=this.TabList[f];l=C.Title,C.IsMenu&&(l+="▲"),h=s+this.TabMergin.Left,u=this.Canvas.measureText(l).width;var D={Left:s,Top:n,Width:u+this.TabMergin.Left+this.TabMergin.Right,Height:a};if(D.Right=D.Left+D.Width,D.Bottom=D.Top+D.Height,D.Right>e)break;var v=this.TabBGColor;f==this.SelectedTabIndex&&(v=this.TabSelectedBGColor),this.Canvas.fillStyle=v,this.Canvas.fillRect(D.Left,D.Top,D.Width,D.Height),this.Canvas.textAlign="left";var S=this.TabTitleColor;f==this.MoveOnTabIndex&&(S=this.TabMoveOnTitleColor),f==this.SelectedTabIndex&&(S=this.TabSelectedTitleColor),this.Canvas.fillStyle=S,this.Canvas.fillText(l,h,o),C.Rect=D,s+=D.Width+1,this.TabWidth+=D.Width+1}for(;f<this.TabList.length;++f){var C=this.TabList[f];C.Rect=null}},this.OnMouseDown=function(r,n,e){var t=this.PtInTab(r,n);return t||this.PtInScroll(r,n)},this.PtInScroll=function(r,n){if(!this.RectScroll)return null;if(this.RectScroll.Left){var e=this.RectScroll.Left;if(r>=e.Left&&r<=e.Right&&n>=e.Top&&n<=e.Bottom)return{Type:1,Rect:e}}if(this.RectScroll.Right){var e=this.RectScroll.Right;if(r>=e.Left&&r<=e.Right&&n>=e.Top&&n<=e.Bottom)return{Type:2,Rect:e}}if(this.RectScroll.Bar){var e=this.RectScroll.Bar;if(r>=e.Left&&r<=e.Right&&n>=e.Top&&n<=e.Bottom)return{Type:3,Rect:e}}if(this.RectScroll.Client){var e=this.RectScroll.Client;if(r>=e.Left&&r<=e.Right&&n>=e.Top&&n<=e.Bottom)return{Type:4,Rect:e,Pos:this.GetScrollPostionByPoint(r,n)}}return null},this.PtInTab=function(r,n){for(var e=0;e<this.TabList.length;++e){var t=this.TabList[e];if(t.Rect){var a=t.Rect;if(r>=a.Left&&r<=a.Right&&n>=a.Top&&n<=a.Bottom){var s={Type:5,Rect:a,Tab:t,Index:e};return t.IsMenu==!0&&s.Type==6,s}}}return null},this.GetFontHeight=function(r,n){return Aa(this.Canvas,r,n)},this.GetScrollPostionByPoint=function(r,n){var e=this.RectScroll.Client,t=e.Right-e.Left-this.ScrollBarWidth,a=parseInt(this.MaxPos*(r-e.Left)/t);return a}}function VI(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ChartPageInfo",this.IsDrawFirst=!1,this.IsShow=!1,this.SizeChange=!0,this.Report,this.FontConfig={Size:m.Report.PageInfo.Font.Size,Name:m.Report.PageInfo.Font.Name},this.TextColor=m.Report.PageInfo.TextColor,this.BGColor=m.Report.PageInfo.BGColor,this.Mergin={Top:m.Report.PageInfo.Mergin.Top,Left:m.Report.PageInfo.Mergin.Left,Right:m.Report.PageInfo.Mergin.Right,Bottom:m.Report.PageInfo.Mergin.Bottom},this.Font,this.TextHeight=0,this.ReloadResource=function(r){this.FontConfig={Size:m.Report.PageInfo.Font.Size,Name:m.Report.PageInfo.Font.Name},this.TextColor=m.Report.PageInfo.TextColor,this.BGColor=m.Report.PageInfo.BGColor,this.Mergin={Top:m.Report.PageInfo.Mergin.Top,Left:m.Report.PageInfo.Mergin.Left,Right:m.Report.PageInfo.Mergin.Right,Bottom:m.Report.PageInfo.Mergin.Bottom}},this.Draw=function(){if(this.IsShow&&this.Report){var r=this.Report.GetCurrentPageStatus();if(!r.IsSinglePage){if(this.SizeChange){var n=V();this.Font=this.FontConfig.Size*n+"px "+this.FontConfig.Name,this.TextHeight=Aa(this.Canvas,this.Font,"擎")+this.Mergin.Top+this.Mergin.Bottom}var e=this.ChartBorder.GetLeft(),t=this.ChartBorder.GetRight(),a=this.ChartBorder.GetBottom()-2,s=e+(t-e)/2,o=r.DataCount+"/"+r.DataCount;this.Canvas.font=this.Font;var h=this.Canvas.measureText(o).width+4,l=s-h/2-this.Mergin.Left,u=a-this.TextHeight;this.Canvas.fillStyle=this.BGColor,this.Canvas.fillRect(l,u,h+(this.Mergin.Left+this.Mergin.Right),this.TextHeight),o=r.Start+1+"/"+r.DataCount,this.Canvas.textAlign="center",this.Canvas.textBaseline="bottom",this.Canvas.fillStyle=this.TextColor,this.Canvas.fillText(o,s,a-this.Mergin.Bottom),this.SizeChange=!1}}}}function rs(r){this.DivElement=r,this.JSChartContainer,this.CanvasElement=document.createElement("canvas"),this.CanvasElement.className="jskeyboard-drawing",this.CanvasElement.id=oe(),this.CanvasElement.setAttribute("tabindex",0),this.CanvasElement.style&&(this.CanvasElement.style.outline="none"),r.hasChildNodes()&&X.Chart.Log("[JSKeyboardChart::JSRepoJSKeyboardChartrtChart] divElement hasChildNodes",r.childNodes),r.appendChild(this.CanvasElement),this.OnSize=function(){var n=parseInt(this.DivElement.style.height.replace("px",""));this.CanvasElement.height=n,this.CanvasElement.width=parseInt(this.DivElement.style.width.replace("px","")),this.CanvasElement.style.width=this.CanvasElement.width+"px",this.CanvasElement.style.height=this.CanvasElement.height+"px";var e=V();this.CanvasElement.height*=e,this.CanvasElement.width*=e,X.Chart.Log("[JSKeyboardChart::OnSize] devicePixelRatio="+window.devicePixelRatio+", height="+this.CanvasElement.height+", width="+this.CanvasElement.width),this.JSChartContainer&&this.JSChartContainer.OnSize&&this.JSChartContainer.OnSize()},this.SetOption=function(n){var e=this.CreateJSKeyboardChartContainer(n);if(!e)return!1;n.OnCreatedCallback&&n.OnCreatedCallback(e),this.JSChartContainer=e,this.DivElement.JSChart=this,e.Draw()},this.CreateJSKeyboardChartContainer=function(n){var e=new HI(this.CanvasElement);if(e.Create(n),n.NetworkFilter&&(e.NetworkFilter=n.NetworkFilter),c.IsNonEmptyArray(n.Column)&&e.SetColumn(n.Column),c.IsNumber(n.BorderLine)&&(e.Frame.BorderLine=n.BorderLine),this.SetChartBorder(e,n),n.EventCallback)for(var t=0;t<n.EventCallback.length;++t){var a=n.EventCallback[t];e.AddEventCallback(a)}return e},this.SetChartBorder=function(n,e){if(e.Border){e.Border,c.IsNumber(e.Border.Left)&&(n.Frame.ChartBorder.Left=e.Border.Left),c.IsNumber(e.Border.Right)&&(n.Frame.ChartBorder.Right=e.Border.Right),c.IsNumber(e.Border.Top)&&(n.Frame.ChartBorder.Top=e.Border.Top),c.IsNumber(e.Border.Bottom)&&(n.Frame.ChartBorder.Bottom=e.Border.Bottom);var t=V();n.Frame.ChartBorder.Left*=t,n.Frame.ChartBorder.Right*=t,n.Frame.ChartBorder.Top*=t,n.Frame.ChartBorder.Bottom*=t}},this.SetColumn=function(n,e){this.JSChartContainer&&this.JSChartContainer.SetColumn(n,e)},this.AddEventCallback=function(n){this.JSChartContainer&&typeof this.JSChartContainer.AddEventCallback=="function"&&(X.Chart.Log("[JSKeyboardChart:AddEventCallback] obj=",n),this.JSChartContainer.AddEventCallback(n))},this.ReloadResource=function(n){this.JSChartContainer&&typeof this.JSChartContainer.ReloadResource=="function"&&(X.Chart.Log("[JSKeyboardChart:ReloadResource] "),this.JSChartContainer.ReloadResource(n))},this.ChartDestory=function(){this.JSChartContainer&&typeof this.JSChartContainer.ChartDestory=="function"&&this.JSChartContainer.ChartDestory()},this.Draw=function(){this.JSChartContainer&&typeof this.JSChartContainer.Draw=="function"&&(X.Chart.Log("[JSKeyboardChart:Draw] "),this.JSChartContainer.Draw())},this.SetSymbolData=function(n){this.JSChartContainer&&typeof this.JSChartContainer.Draw=="function"&&(X.Chart.Log("[JSKeyboardChart:SetSymbolData] ",n),this.JSChartContainer.SetSymbolData(n))},this.Search=function(n){this.JSChartContainer&&typeof this.JSChartContainer.Search=="function"&&(X.Chart.Log("[JSKeyboardChart:Search] ",n),this.JSChartContainer.Search(n))},this.OnKeyDown=function(n){this.JSChartContainer&&typeof this.JSChartContainer.OnKeyDown=="function"&&(X.Chart.Log("[JSKeyboardChart:OnKeyDown] ",n),this.JSChartContainer.OnKeyDown(n))},this.ClearSearch=function(n){this.JSChartContainer&&typeof this.JSChartContainer.ClearSearch=="function"&&(X.Chart.Log("[JSKeyboardChart:ClearSearch] ",n),this.JSChartContainer.ClearSearch(n))}}rs.Init=function(r){var n=new rs(r);return n.OnSize(),n};rs.SetStyle=function(r){r&&m.SetStyle(r)};function HI(r){this.ClassName="JSKeyboardChartContainer",this.Frame,this.ChartPaint=[],this.Canvas=r.getContext("2d"),this.ShowCanvas=null,this.NetworkFilter,this.Data={XOffset:0,YOffset:0,Data:[]},this.MapSymbol=new Dt.default,this.SourceData={Data:[]},this.mapEvent=new Dt.default,this.UIElement=r,this.LastPoint=new ot,this.DragYScroll=null,this.IsDestroy=!1,this.ChartDestory=function(){this.IsDestroy=!0},this.ClearSearch=function(n){this.Data.Data=[],this.Data.XOffset=0,this.Data.YOffset=0,n&&n.Redraw==!0&&this.Draw()},this.Search=function(n){var e=[],t=[];this.MapSymbol.clear(),this.Data.Data=[],this.Data.XOffset=0,this.Data.YOffset=0;var a=n.trim();if(a.length>0)for(var s=0;s<this.SourceData.Data.length;++s){var o=this.SourceData.Data[s];this.SearchSymbol(o,a,e,t)||this.SearchSpell(o,a,e,t)}(c.IsNonEmptyArray(e)||c.IsNonEmptyArray(t))&&(this.Data.Data=e.concat(t)),this.ChartPaint[0].SelectedRow=0,X.Chart.Log("[JSKeyboardChart:Search] search="+a+", source="+this.SourceData.Data.length+" match="+this.Data.Data.length),this.Draw()},this.SearchSymbol=function(n,e,t,a){var s=n.Symbol.indexOf(e);return s<0?!1:(s==0?t.push(n.Symbol):a.push(n.Symbol),this.MapSymbol.set(n.Symbol,n),!0)},this.SearchSpell=function(n,e,t,a){if(!c.IsString(n.Spell))return!1;var s=n.Spell.indexOf(e);return s!=0?!1:(t.push(n.Symbol),this.MapSymbol.set(n.Symbol,n),!0)},this.SetSymbolData=function(n){this.SourceData.Data=n},this.Create=function(n){var e=this;this.UIElement.JSChartContainer=this,this.Frame=new YI,this.Frame.ChartBorder=new We,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas;var t=new kI;t.Frame=this.Frame,t.ChartBorder=this.Frame.ChartBorder,t.Canvas=this.Canvas,t.UIElement=this.UIElement,t.GetEventCallback=function(o){return e.GetEventCallback(o)},t.GetStockDataCallback=function(o){return e.GetStockData(o)},t.Data=this.Data,this.ChartPaint[0]=t;var a=!0,s=!0;n&&(n.KeyDown===!1&&(a=!1,X.Chart.Log("[JSKeyboardChartContainer::Create] not register keydown event.")),n.Wheel===!1&&(s=!1,X.Chart.Log("[JSKeyboardChartContainer::Create] not register wheel event."))),a&&this.UIElement.addEventListener("keydown",function(o){e.OnKeyDown(o)},!0),s&&this.UIElement.addEventListener("wheel",function(o){e.OnWheel(o)},!0),this.UIElement.ondblclick=function(o){e.UIOnDblClick(o)},this.UIElement.onmousedown=function(o){e.UIOnMouseDown(o)},this.UIElement.oncontextmenu=function(o){e.UIOnContextMenu(o)},this.UIElement.onmousemove=function(o){e.UIOnMouseMove(o)},this.UIElement.onmouseout=function(o){e.UIOnMounseOut(o)},this.UIElement.onmouseleave=function(o){e.UIOnMouseleave(o)}},this.Draw=function(){if(!(this.UIElement.width<=0||this.UIElement.height<=0)){this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height);var n=V();this.Canvas.lineWidth=n,this.Frame.Draw(),this.Frame.DrawLogo();for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.IsDrawFirst&&t.Draw()}for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.IsDrawFirst||t.Draw()}}},this.GetStockData=function(n){return this.MapSymbol.has(n)?this.MapSymbol.get(n):null},this.ResetStatus=function(){this.Data.XOffset=0,this.Data.YOffset=0},this.ResetSelectStatus=function(){var n=this.GetReportChart();n&&(n.SelectedRow=-1,n.SelectedFixedRow=-1)},this.AddEventCallback=function(n){if(!(!n||!n.event||!n.callback)){var e={Callback:n.callback,Source:n};this.mapEvent.set(n.event,e)}},this.RemoveEventCallback=function(n){this.mapEvent.has(n)&&this.mapEvent.delete(n)},this.GetEventCallback=function(n){if(!this.mapEvent.has(n))return null;var e=this.mapEvent.get(n);return e},this.OnSize=function(){this.Frame&&(this.SetSizeChange(!0),this.Draw())},this.SetSizeChange=function(n){for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t&&(t.SizeChange=n)}},this.OnWheel=function(n){if(X.Chart.Log("[JSKeyboardChartContainer::OnWheel]",n),!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)&&!(!this.Data||!c.IsNonEmptyArray(this.Data.Data))){var e=n.clientX-this.UIElement.getBoundingClientRect().left,t=n.clientY-this.UIElement.getBoundingClientRect().top,a=!1;if(this.Canvas.beginPath(),this.Canvas.rect(this.Frame.ChartBorder.GetLeft(),this.Frame.ChartBorder.GetTop(),this.Frame.ChartBorder.GetWidth(),this.Frame.ChartBorder.GetHeight()),a=this.Canvas.isPointInPath(e,t),!!a){var s=this.ChartPaint[0];if(s){var o=n.wheelDelta;c.IsObjectExist(n.wheelDelta)||(o=n.deltaY*-.01),o<0?this.GotoNextPage(this.PageUpDownCycle)&&this.Draw():o>0&&this.GotoPreviousPage(this.PageUpDownCycle)&&this.Draw(),n.preventDefault?n.preventDefault():n.returnValue=!1}}}},this.OnKeyDown=function(n){if(!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var e=this.GetReportChart();if(e){var t=n.keyCode?n.keyCode:n.which;switch(t){case 33:this.GotoPreviousPage(this.PageUpDownCycle)&&this.Draw();break;case 34:this.GotoNextPage(this.PageUpDownCycle)&&this.Draw();break;case 38:var a=this.MoveSelectedRow(-1);a&&a.Redraw&&this.Draw();break;case 40:var a=this.MoveSelectedRow(1);a&&a.Redraw&&this.Draw();break;case 37:this.MoveXOffset(-1)&&this.Draw();break;case 39:this.MoveXOffset(1)&&this.Draw();break;case 13:this.OnSelectedSymbol();break}n.preventDefault?n.preventDefault():n.returnValue=!1}}},this.OnSelectedSymbol=function(){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return!1;var n=this.ChartPaint[0];if(!n)return!1;var e=n.GetSelectedSymbol(),t=this.GetEventCallback(et.ON_KEYBOARD_SELECTED);t&&t.Callback&&t.Callback(t,{Data:e},this)},this.UIOnDblClick=function(n){var e=V(),t=(n.clientX-this.UIElement.getBoundingClientRect().left)*e,a=(n.clientY-this.UIElement.getBoundingClientRect().top)*e,s=this.ChartPaint[0];s&&s.OnDblClick(t,a,n)&&this.OnSelectedSymbol()},this.UIOnMouseDown=function(n){var e=this;this.DragXScroll=null,this.DragMove={Click:{X:n.clientX,Y:n.clientY},Move:{X:n.clientX,Y:n.clientY},PreMove:{X:n.clientX,Y:n.clientY}};var t=V(),a=(n.clientX-this.UIElement.getBoundingClientRect().left)*t,s=(n.clientY-this.UIElement.getBoundingClientRect().top)*t,o=this.ChartPaint[0];if(o){var h=o.OnMouseDown(a,s,n);if(!h)return;h.Type==2&&(n.button==0||n.button==2)&&h.Redraw==!0&&this.Draw()}document.onmousemove=function(l){e.DocOnMouseMove(l)},document.onmouseup=function(l){e.DocOnMouseUp(l)}},this.UIOnContextMenu=function(n){n.preventDefault()},this.UIOnMouseMove=function(n){var e=V();(n.clientX-this.UIElement.getBoundingClientRect().left)*e,(n.clientY-this.UIElement.getBoundingClientRect().top)*e},this.UIOnMounseOut=function(n){},this.UIOnMouseleave=function(n){},this.DocOnMouseMove=function(n){if(this.DragMove.PreMove.X=this.DragMove.Move.X,this.DragMove.PreMove.Y=this.DragMove.Move.Y,this.DragMove.Move.X=n.clientX,this.DragMove.Move.Y=n.clientX,!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var e=V(),t=(n.clientX-this.UIElement.getBoundingClientRect().left)*e,a=(n.clientY-this.UIElement.getBoundingClientRect().top)*e;if(this.DragRow){var s=this.DragRow,o=s.LastMove.Y-n.clientY;if(Math.abs(o)<2)return;var h=this.GetReportChart();if(s.LastMove.X=n.clientX,s.LastMove.Y=n.clientY,s.Inside={X:t,Y:a},h){var l=h.OnDrawgRow(t,a,n);if(l)if(l.Type==2)l.Data.DataIndex!=s.Data.Row.DataIndex&&(s.MoveRow=l);else if(l.Type==7){var u=h.GetCurrentPageStatus();u.IsEnd||(this.MoveYOffset(1,!1),s.MoveRow=null,this.EnablePageScroll=!0,this.AutoScrollPage(2))}else l.Type==5&&this.Data.YOffset>0&&(this.MoveYOffset(-1,!1),s.MoveRow=null,this.EnablePageScroll=!0,this.AutoScrollPage(-2));h.DragRow=s}this.Draw()}else if(this.DragXScroll){var f=this.ChartPaint[0];if(!f||!f.Tab)return;this.DragXScroll.LastMove.X=t,this.DragXScroll.LastMove.Y=a;var C=f.Tab.GetScrollPostionByPoint(t,a);this.SetXOffset(C)&&this.Draw()}}},this.DocOnMouseUp=function(n){document.onmousemove=null,document.onmouseup=null;var e=this.GetEventCallback(et.ON_KEYBOARD_MOUSEUP);e&&e.Callback&&e.Callback(e,{},this)},this.GetMoveAngle=function(n,e){var t=Math.abs(n.X-e.X),a=Math.abs(n.Y-e.Y),s=Math.atan(t/a)*180/Math.PI;return s},this.PreventTouchEvent=function(n){n.cancelable&&n.preventDefault(),n.stopPropagation()},this.OnDragYOffset=function(n,e,t,a){if(t<5)return!1;var s=!0;n.LastMove.Y<e[0].clientY&&(s=!1);var o=this.YStepPixel;o<=0&&(o=5);var h=parseInt(t/o);return h<=0?!1:(s==!1&&(h*=-1),this.MoveYOffset(h,this.DragPageCycle)&&(n.IsYMove=!0,this.Draw(),this.DelayUpdateStockData()),!0)},this.OnDragXOffset=function(n,e,t,a){if(t<5)return!1;var s=!0;n.LastMove.X<e[0].clientX&&(s=!1);var o=this.XStepPixel;o<=0&&(o=5);var h=parseInt(t/o);return h<=0?!1:(s||(h*=-1),this.MoveXOffset(h)&&(n.IsXMove=!0,this.Draw()),!0)},this.GetReportChart=function(){var n=this.ChartPaint[0];return n},this.GotoNextPage=function(n){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return!1;var e=this.ChartPaint[0];if(!e)return!1;var t=e.GetPageSize();return t>this.Data.Data.length?!1:this.Data.YOffset+t>=this.Data.Data.length?n===!0?(this.Data.YOffset=0,!0):!1:(this.Data.YOffset+=t,this.Data.Data.length-this.Data.YOffset,e.SelectedRow=this.Data.YOffset,!0)},this.GotoPreviousPage=function(n){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return!1;var e=this.ChartPaint[0];if(!e)return!1;var t=e.GetPageSize();if(t>this.Data.Data.length)return!1;if(this.Data.YOffset<=0)return n===!0?(this.Data.YOffset=this.Data.Data.length-t,!0):!1;var a=this.Data.YOffset;return a-=t,a<0&&(a=0),this.Data.YOffset=a,e.SelectedRow=this.Data.YOffset,!0},this.MoveYOffset=function(n,e){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return!1;var t=this.ChartPaint[0];if(!t)return!1;var a=t.GetCurrentPageStatus();if(a.IsSinglePage)return!1;if(n>0){var s=this.Data.Data.length,o=a.PageSize,h=this.Data.YOffset;if(e)for(var l=0;l<n;++l)++h,h+o>s&&(h=0);else{if(h+o>=s)return!1;for(var l=0;l<n&&!(h+o+1>s);++l)++h}return this.Data.YOffset=h,!0}else if(n<0){n=Math.abs(n);var h=this.Data.YOffset;if(e)for(var o=a.PageSize,l=0;l<n;++l)--h,h<0&&(h=this.Data.Data.length-o);else{if(this.Data.YOffset<=0)return!1;for(var l=0;l<n&&!(h-1<0);++l)--h}return this.Data.YOffset=h,!0}return!1},this.GotoLastPage=function(){var n=this.ChartPaint[0];if(n){var e=n.GetPageSize(!0),t=this.Data.Data.length-e;t<0&&(t=0),this.Data.DataOffset=t}},this.SetColumn=function(n,e){var t=this.ChartPaint[0];t&&(t.SetColumn(n),t.SizeChange=!0,e&&e.Redraw&&this.Draw())},this.ReloadResource=function(n){this.Frame.ReloadResource(n);for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.ReloadResource&&t.ReloadResource(n)}n&&n.Redraw&&(this.SetSizeChange(!0),this.Draw())},this.MoveSelectedRow=function(n){var e=this.ChartPaint[0];if(!e||!c.IsNonEmptyArray(this.Data.Data))return null;var t={Redraw:!1},a=e.GetCurrentPageStatus();a.PageSize;var s=a.SelectedRow;if(n>0){if(s<0||s<a.Start||s>a.End)return e.SelectedRow=a.Start,t.Redraw=!0,t;for(var o=this.Data.YOffset,h=0;h<n&&(++s,s>a.End&&++o,!(s>=this.Data.Data.length));++h)t.Redraw=!0,e.SelectedRow=s,this.Data.YOffset=o;return t}else if(n<0){if(s<0||s<a.Start||s>a.End)return e.SelectedRow=a.End,t.Redraw=!0,t;n=Math.abs(n);for(var o=this.Data.YOffset,h=0;h<n&&(--s,s<a.Start&&--o,!(s<0));++h)t.Redraw=!0,e.SelectedRow=s,this.Data.YOffset=o;return t}}}function YI(){this.ChartBorder,this.Canvas,this.BorderLine=null,this.BorderColor=m.Report.BorderColor,this.LogoTextColor=m.FrameLogo.TextColor,this.LogoTextFont=m.FrameLogo.Font,this.ReloadResource=function(r){this.BorderColor=m.Report.BorderColor,this.LogoTextColor=m.FrameLogo.TextColor,this.LogoTextFont=m.FrameLogo.Font},this.Draw=function(){var r=L(this.ChartBorder.GetLeft()),n=L(this.ChartBorder.GetTop()),e=L(this.ChartBorder.GetRight()),t=L(this.ChartBorder.GetBottom()),a=e-r,s=t-n;c.IsNumber(this.BorderLine)?(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),(this.BorderLine&1)>0&&(this.Canvas.moveTo(r,n),this.Canvas.lineTo(e,n)),(this.BorderLine&2)>0&&(this.Canvas.moveTo(r,t),this.Canvas.lineTo(e,t)),(this.BorderLine&4)>0&&(this.Canvas.moveTo(r,n),this.Canvas.lineTo(r,t)),(this.BorderLine&8)>0&&(this.Canvas.moveTo(e,n),this.Canvas.lineTo(e,t)),this.Canvas.stroke()):(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(r,n,a,s))},this.DrawLogo=function(){var r=m.FrameLogo.Text;if(c.IsString(r)){this.Canvas.fillStyle=this.LogoTextColor,this.Canvas.font=this.LogoTextFont,this.Canvas.textAlign="right",this.Canvas.textBaseline="bottom";var n=this.ChartBorder.GetRight()-30,e=this.ChartBorder.GetBottom()-5;this.Canvas.fillText(r,n,e)}}}var ki={SHORT_SYMBOL_ID:0,SYMBOL_ID:1,NAME_ID:2,TYPE_ID:3};function kI(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ChartSymbolList",this.UIElement,this.IsDrawFirst=!1,this.GetEventCallback,this.Data,this.SizeChange=!0,this.SelectedRow=-1,this.IsDrawBorder=!1,this.ShowSymbol=[],this.BorderColor=m.Keyboard.BorderColor,this.SelectedColor=m.Keyboard.SelectedColor,this.TextColor=m.Keyboard.TextColor,this.ItemFontConfig={Size:m.Keyboard.Item.Font.Size,Name:m.Keyboard.Item.Font.Name},this.ItemMergin={Left:m.Keyboard.Item.Mergin.Left,Right:m.Keyboard.Item.Mergin.Right,Top:m.Keyboard.Item.Mergin.Top,Bottom:m.Keyboard.Item.Mergin.Bottom},this.ItemFont=15*V()+"px 微软雅黑",this.ItemSymbolFont=12*V()+"px 微软雅黑",this.ItemNameFont=15*V()+"px 微软雅黑",this.ItemNameHeight=0,this.RowCount=0,this.RowHeight=0,this.Column=[{Type:ki.SHORT_SYMBOL_ID,Title:"代码",TextAlign:"left",Width:null,MaxText:"888888"},{Type:ki.NAME_ID,Title:"名称",TextAlign:"left",Width:null,MaxText:"擎擎擎擎擎擎"},{Type:ki.TYPE_ID,Title:"类型",TextAlign:"right",Width:null,MaxText:"擎擎擎擎"}],this.RectClient={},this.ReloadResource=function(r){},this.SetColumn=function(r){c.IsNonEmptyArray(r)},this.Draw=function(){this.ShowSymbol=[],this.SizeChange?this.CalculateSize():this.UpdateCacheData(),this.Canvas.save(),this.Canvas.beginPath(),this.Canvas.rect(this.RectClient.Left,this.RectClient.Top,this.RectClient.Right-this.RectClient.Left,this.RectClient.Bottom-this.RectClient.Top),this.Canvas.clip(),this.DrawBody(),this.Canvas.restore(),this.DrawBorder(),this.SizeChange=!1},this.UpdateCacheData=function(){this.RectClient.Left=this.ChartBorder.GetLeft(),this.RectClient.Right=this.ChartBorder.GetRight(),this.RectClient.Top=this.ChartBorder.GetTop(),this.RectClient.Bottom=this.ChartBorder.GetBottom()},this.GetPageSize=function(r){r&&this.CalculateSize();var n=this.RowCount;return n},this.GetCurrentPageStatus=function(){var r={Start:this.Data.YOffset,PageSize:this.RowCount,IsEnd:!1,SelectedRow:this.SelectedRow,IsSinglePage:!1,DataCount:0};return c.IsNonEmptyArray(this.Data.Data)?(r.End=this.Data.YOffset+this.RowCount-1,r.IsSinglePage=this.Data.Data.length<=this.RowCount,r.DataCount=this.Data.Data.length,r.End>=this.Data.Data.length-1&&(r.IsEnd=!0),r.End>=this.Data.Data.length&&(r.End=this.Data.Data.length-1)):(r.Star=0,r.End=0,r.IsEnd=!0,r.IsSinglePage=!0),r},this.CalculateSize=function(){this.UpdateCacheData();var r=V();this.ItemFont=this.ItemFontConfig.Size*r+"px "+this.ItemFontConfig.Name,this.RowHeight=this.GetFontHeight(this.ItemFont,"擎")+this.ItemMergin.Top+this.ItemMergin.Bottom;var n=this.RectClient.Left,e=this.RectClient.Right;this.Canvas.font=this.ItemFont;for(var t=0,a=0;a<this.Column.length;++a){var s=this.Column[a];t=this.Canvas.measureText(s.MaxText).width,s.Width=t+4+this.ItemMergin.Left+this.ItemMergin.Right,a==this.Column.length-1&&n+s.Width<e&&(s.Width=e-n),n+=s.Width}this.RowCount=parseInt((this.RectClient.Bottom-this.RectClient.Top)/this.RowHeight)},this.DrawText=function(r,n,e,t,a){n=="center"?(e=e+a/2,this.Canvas.textAlign="center"):n=="right"?(e=e+a,this.Canvas.textAlign="right"):this.Canvas.textAlign="left",this.Canvas.textBaseline="middle",this.Canvas.fillText(r,e,t)},this.DrawBorder=function(){if(this.IsDrawBorder){var r=this.RectClient.Left,n=this.RectClient.Right,e=this.RectClient.Top;this.RectClient.Bottom,this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),this.Canvas.moveTo(r,L(e)),this.Canvas.lineTo(n,L(e));for(var t=e+this.RowHeight,a=t,s=0;s<this.RowCount;++s){var o=L(t);this.Canvas.moveTo(r,o),this.Canvas.lineTo(n,o),a=t,t+=this.RowHeight}for(var h=r,s=this.Data.XOffset;s<this.Column.length;++s){var l=this.Column[s],u=L(h+l.Width);this.Canvas.moveTo(u,e),this.Canvas.lineTo(u,a),h+=l.Width}this.Canvas.stroke()}},this.GetSelectedSymbol=function(){return this.SelectedRow<0||this.SelectedRow>=this.Data.Data.length?null:{Symbol:this.Data.Data[this.SelectedRow],RowID:this.SelectedRow}},this.DrawBody=function(){if(this.Data&&c.IsNonEmptyArray(this.Data.Data)){this.Canvas.font=this.ItemFont;var r=this.RectClient.Top,n=this.RectClient.Left,e=this.RectClient.Right-this.RectClient.Left,t=r;this.Canvas.font=this.ItemFont;for(var a=this.Data.YOffset,s=0;a<this.Data.Data.length&&s<this.RowCount;++a,++s){var o=this.Data.Data[a],h=!1;a==this.SelectedRow&&(h=!0),h&&(this.Canvas.fillStyle=this.SelectedColor,this.Canvas.fillRect(n+1,t,e,this.RowHeight)),this.DrawRow(o,t,a),this.ShowSymbol.push({Index:a,Symbol:o}),t+=this.RowHeight}}},this.DrawRow=function(r,n,e,t){var a=this.RectClient.Left,s=this.RectClient.Right,o={Symbol:r,Stock:null,Block:null};this.GetStockDataCallback&&(o.Stock=this.GetStockDataCallback(r));for(var h=this.Data.XOffset;h<this.Column.length;++h){var l=this.Column[h];if(this.DrawItem(e,o,l,a,n,t),a+=l.Width,a>=s)break}},this.DrawItem=function(r,n,e,t,a,s){e.Width;var o=t+this.ItemMergin.Left,h=e.Width-this.ItemMergin.Left-this.ItemMergin.Right,l=n.Stock,u={Text:null,TextColor:this.TextColor,TextAlign:e.TextAlign};e.Type==ki.SHORT_SYMBOL_ID?(l&&l.ShortSymbol?u.Text=l.ShortSymbol:u.Text=n.Symbol,l.Color&&(u.TextColor=l.Color)):e.Type==ki.NAME_ID?l&&l.Name&&(u.Text=this.TextEllipsis(l.Name,h,e.MaxText),l.Color&&(u.TextColor=l.Color)):e.Type==ki.TYPE_ID&&l&&l.Type&&(u.Text=this.TextEllipsis(l.Type,h,e.MaxText),l.Color&&(u.TextColor=l.Color)),this.DrawItemText(u.Text,u.TextColor,u.TextAlign,o,a,h)},this.DrawItemText=function(r,n,e,t,a,s){if(r){var o=t;e=="center"?(o=t+s/2,this.Canvas.textAlign="center"):e=="right"?(o=t+s-2,this.Canvas.textAlign="right"):(o+=2,this.Canvas.textAlign="left"),this.Canvas.textBaseline="middle",this.Canvas.fillStyle=n,this.Canvas.fillText(r,o,a+this.ItemMergin.Top+this.RowHeight/2)}},this.TextEllipsis=function(r,n,e){if(!r)return null;if(r.length<e.length)return r;var t=e.length-3;if(t<0)return null;for(var a=r.slice(0,t),s=t;s<r.length;++s){var o=a+r[s]+"...",h=this.Canvas.measureText(o).width;if(h>n){a+="...";break}a+=r[s]}return a},this.GetFontHeight=function(r,n){return Aa(this.Canvas,r,n)},this.OnMouseDown=function(r,n,e){if(!this.Data)return null;var t=V(),a={X:r/t,Y:n/t};if(this.UIElement)var s={Left:this.UIElement.getBoundingClientRect().left,Top:this.UIElement.getBoundingClientRect().top};else var s={Left:null,Top:null};var o=this.PtInBody(r,n);if(o){var h=!0;this.SelectedModel==0?(this.SelectedRow==o.Index&&(h=!1),this.SelectedRow=o.Index,this.SelectedFixedRow=-1):(this.SelectedRow==o.DataIndex&&(h=!1),this.SelectedRow=o.DataIndex,this.SelectedFixedRow=-1);var l=et.ON_CLICK_REPORT_ROW;return e.button==2&&(l=et.ON_RCLICK_REPORT_ROW),this.SendClickEvent(l,{Data:o,X:r,Y:n,e,Inside:a,UIElement:s}),{Type:2,Redraw:h,Row:o}}return null},this.OnDrawgRow=function(r,n,e){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return null;var t=this.RowHeight/2,a=this.RectClient.Top+this.HeaderHeight,s=this.ChartBorder.GetChartWidth(),o=a;if(n<o+t)return{Type:5};for(var h=this.Data.YOffset,l=0;h<this.Data.Data.length&&l<this.RowCount;++h,++l){var u=this.Data.Data[h],f={Left:0,Top:o,Right:s,Bottom:o+this.RowHeight};if(f.Top+=t,f.Bottom+=t,r>=f.Left&&r<=f.Right&&n>=f.Top&&n<=f.Bottom){var C={DataIndex:h,Index:l,Symbol:u,Pos:0};return l==0?C.Pos=1:l==this.RowCount-1&&(C.Pos=2),{Type:2,Data:C}}o+=this.RowHeight}return l<this.RowCount?{Type:6}:{Type:7}},this.OnDblClick=function(r,n,e){if(!this.Data)return!1;var t=this.PtInBody(r,n);return!!t},this.PtInBody=function(r,n){if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return null;var e=this.RectClient.Top,t=this.RectClient.Left,a=this.RectClient.Right;this.RectClient.Right-this.RectClient.Left;for(var s=e,o=this.Data.YOffset,h=0;o<this.Data.Data.length&&h<this.RowCount;++o,++h){var l=this.Data.Data[o],u={Left:t,Top:s,Right:a,Bottom:s+this.RowHeight};if(r>=u.Left&&r<=u.Right&&n>=u.Top&&n<=u.Bottom){var f={Rect:u,DataIndex:o,Index:h,Symbol:l};return f.Item=this.PtInItem(r,n,u.Top,u.Bottom),f}s+=this.RowHeight}return null},this.PtInItem=function(r,n,e,t){for(var a=this.RectClient.Left,s=this.RectClient.Right,o=a,h=0;h<this.FixedColumn&&h<this.Column.length;++h){var l=this.Column[h],u={Left:o,Right:o+l.Width,Top:e,Bottom:t};if(r>=u.Left&&r<=u.Right&&n>=u.Top&&n<=u.Bottom)return{Rect:u,Column:l,Index:h};o+=l.Width}for(var h=this.FixedColumn+this.Data.XOffset;h<this.Column.length;++h){var l=this.Column[h];if(o>=s)break;var u={Left:o,Right:o+l.Width,Top:e,Bottom:t};if(r>=u.Left&&r<=u.Right&&n>=u.Top&&n<=u.Bottom)return{Rect:u,Column:l,Index:h};o+=l.Width}return null},this.IsPtInBody=function(r,n){var e=this.RectClient.Top,t=this.RectClient.Left,a=this.RectClient.Right,s=this.RectClient.Bottom;return r>=t&&r<=a&&n>=e&&n<=s},this.SendClickEvent=function(r,n){var e=this.GetEventCallback(r);e&&e.Callback&&e.Callback(e,n,this)}}function sn(r){this.DivElement=r,this.JSChartContainer,this.CanvasElement=document.createElement("canvas"),this.CanvasElement.className="jsscrollbar-drawing",this.CanvasElement.id=oe(),this.CanvasElement.setAttribute("tabindex",0),this.CanvasElement.style&&(this.CanvasElement.style.outline="none"),r.hasChildNodes()&&X.Chart.Log("[JSScrollBarChart::JSScrollBarChart] divElement hasChildNodes",r.childNodes),r.appendChild(this.CanvasElement),this.OnSize=function(){var n=parseInt(this.DivElement.style.height.replace("px",""));this.CanvasElement.height=n,this.CanvasElement.width=parseInt(this.DivElement.style.width.replace("px","")),this.CanvasElement.style.width=this.CanvasElement.width+"px",this.CanvasElement.style.height=this.CanvasElement.height+"px";var e=V();this.CanvasElement.height*=e,this.CanvasElement.width*=e,X.Chart.Log("[JSScrollBarChart::OnSize] devicePixelRatio="+window.devicePixelRatio+", height="+this.CanvasElement.height+", width="+this.CanvasElement.width),this.JSChartContainer&&this.JSChartContainer.OnSize&&this.JSChartContainer.OnSize()},this.SetOption=function(n){var e=this.CreateJSScrollBarChartContainer(n);if(!e)return!1;n.OnCreatedCallback&&n.OnCreatedCallback(e),e.Draw(),this.JSChartContainer=e,this.DivElement.JSChart=this},this.CreateJSScrollBarChartContainer=function(n){var e=new XI(this.CanvasElement);if(e.Create(n),c.IsNumber(n.DelayDragFrequency)&&(e.DelayDragFrequency=n.DelayDragFrequency),this.SetChartBorder(e,n),n.EventCallback)for(var t=0;t<n.EventCallback.length;++t){var a=n.EventCallback[t];e.AddEventCallback(a)}return e},this.SetChartBorder=function(n,e){if(e.Border){var t=e.Border;c.IsNumber(e.Border.Left)&&(n.Frame.ChartBorder.Left=e.Border.Left),c.IsNumber(e.Border.Right)&&(n.Frame.ChartBorder.Right=e.Border.Right),c.IsNumber(e.Border.Top)&&(n.Frame.ChartBorder.Top=e.Border.Top),c.IsNumber(e.Border.Bottom)&&(n.Frame.ChartBorder.Bottom=e.Border.Bottom);var a=V();n.Frame.ChartBorder.Left*=a,n.Frame.ChartBorder.Right*=a,n.Frame.ChartBorder.Top*=a,n.Frame.ChartBorder.Bottom*=a,c.IsBool(t.AutoLeft)&&(n.AutoMargin.Left=t.AutoLeft),c.IsBool(t.AutoRight)&&(n.AutoMargin.Right=t.AutoRight)}},this.AddEventCallback=function(n){this.JSChartContainer&&typeof this.JSChartContainer.AddEventCallback=="function"&&(X.Chart.Log("[JSScrollBarChart:AddEventCallback] obj=",n),this.JSChartContainer.AddEventCallback(n))},this.ReloadResource=function(n){this.JSChartContainer&&typeof this.JSChartContainer.ReloadResource=="function"&&(X.Chart.Log("[JSScrollBarChart:ReloadResource] "),this.JSChartContainer.ReloadResource(n))},this.ChartDestory=function(){this.JSChartContainer&&typeof this.JSChartContainer.ChartDestory=="function"&&this.JSChartContainer.ChartDestory()},this.Draw=function(){this.JSChartContainer&&typeof this.JSChartContainer.Draw=="function"&&(X.Chart.Log("[JSScrollBarChart:Draw] "),this.JSChartContainer.Draw())},this.RecvData=function(n,e){this.JSChartContainer&&typeof this.JSChartContainer.RecvData=="function"&&(X.Chart.Log("[JSScrollBarChart:RecvData] "),this.JSChartContainer.RecvData(n,e))},this.UpdateSlider=function(n){this.JSChartContainer&&typeof this.JSChartContainer.UpdateSlider=="function"&&(X.Chart.Log("[JSScrollBarChart:UpdateSlider] "),this.JSChartContainer.UpdateSlider(n))},this.Reset=function(n){this.JSChartContainer&&typeof this.JSChartContainer.Reset=="function"&&(X.Chart.Log("[JSScrollBarChart:Reset] "),this.JSChartContainer.Reset(n))},this.ReloadResource=function(n){this.JSChartContainer&&typeof this.JSChartContainer.ReloadResource=="function"&&(X.Chart.Log("[JSScrollBarChart:ReloadResource] "),this.JSChartContainer.ReloadResource(n))}}sn.Init=function(r){var n=new sn(r);return n.OnSize(),n};sn.SetStyle=function(r){r&&m.SetStyle(r)};sn.GetResource=function(){return m};function XI(r){this.ClassName="JSScrollBarChartContainer",this.Frame,this.ChartPaint=[],this.ChartSplashPaint=null,this.LoadDataSplashTitle="无数据",this.Canvas=r.getContext("2d"),this.ShowCanvas=null,this.XOffsetData={Start:-1,End:-1,Count:0},this.SourceData,this.SliderChart,this.DragMove,this.DragSlider,this.DragTimer,this.DelayDragFrequency=150,this.AutoMargin={Left:!1,Right:!1},this.mapEvent=new Dt.default,this.UIElement=r,this.LastPoint=new ot,this.IsDestroy=!1,this.HQChart=null,this.ChartDestory=function(){this.IsDestroy=!0},this.AddEventCallback=function(n){if(!(!n||!n.event||!n.callback)){var e={Callback:n.callback,Source:n};this.mapEvent.set(n.event,e)}},this.RemoveEventCallback=function(n){this.mapEvent.has(n)&&this.mapEvent.delete(n)},this.GetEventCallback=function(n){if(!this.mapEvent.has(n))return null;var e=this.mapEvent.get(n);return e},this.Create=function(n){var e=this;this.UIElement.JSChartContainer=this,this.ChartSplashPaint=new Qa,this.ChartSplashPaint.Canvas=this.Canvas,this.ChartSplashPaint.SetTitle(this.LoadDataSplashTitle),this.ChartSplashPaint.IsEnableSplash=!0,this.Frame=new WI,this.Frame.ChartBorder=new We,this.Frame.ChartBorder.UIElement=this.UIElement,this.Frame.ChartBorder.Top=30,this.Frame.ChartBorder.Left=5,this.Frame.ChartBorder.Bottom=20,this.Frame.Canvas=this.Canvas,this.ChartSplashPaint.Frame=this.Frame;var t=new UI;t.ChartFrame=this.Frame,t.ChartBorder=this.Frame.ChartBorder,t.Canvas=this.Canvas,t.GetEventCallback=function(a){return e.GetEventCallback(a)},this.ChartPaint.push(t);var t=new _I;t.ChartFrame=this.Frame,t.ChartBorder=this.Frame.ChartBorder,t.Canvas=this.Canvas,t.OffsetData=this.XOffsetData,t.GetEventCallback=function(a){return e.GetEventCallback(a)},this.SliderChart=t,this.ChartPaint.push(t),this.UIElement.onmousedown=function(a){e.UIOnMouseDown(a)},this.UIElement.oncontextmenu=function(a){e.UIOnContextMenu(a)},this.UIElement.onmousemove=function(a){e.UIOnMouseMove(a)},this.UIElement.onmouseout=function(a){e.UIOnMounseOut(a)},this.UIElement.onmouseleave=function(a){e.UIOnMouseleave(a)}},this.Draw=function(){if(!(this.UIElement.width<=0||this.UIElement.height<=0)){this.Canvas.clearRect(0,0,this.UIElement.width,this.UIElement.height);var n=V();if(this.Canvas.lineWidth=n,this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash){this.Frame.Draw({IsEnableSplash:this.ChartSplashPaint.IsEnableSplash}),this.ChartSplashPaint.Draw();return}this.Frame.Draw(),this.Frame.DrawLogo();for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.IsDrawFirst&&t.Draw()}for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.IsDrawFirst||t.Draw()}}},this.OnSize=function(){this.Frame&&(this.SetSizeChange(!0),this.Draw())},this.SetSizeChange=function(n){for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t&&(t.SizeChange=n)}},this.UpdateFrameMaxMin=function(){for(var n=null,e=null,t=0;t<this.ChartPaint.length;++t){var a=this.ChartPaint[t];if(a.GetMaxMin){var s=a.GetMaxMin();s==null||s.Max==null||s.Min==null||((n==null||n<s.Max)&&(n=s.Max),(e==null||e>s.Min)&&(e=s.Min))}}c.IsNumber(n)&&c.IsNumber(e)&&(this.Frame.HorizontalMax=n,this.Frame.HorizontalMin=e)},this.UIOnDblClick=function(n){},this.CancelDragTimer=function(){this.DragTimer&&(clearTimeout(this.DragTimer),this.DragTimer=null)},this.UIOnMouseDown=function(n){var e=this;this.CancelDragTimer(),this.DragSlider=null,this.DragMove={Click:{X:n.clientX,Y:n.clientY},Move:{X:n.clientX,Y:n.clientY},PreMove:{X:n.clientX,Y:n.clientY}};var t=V(),a=(n.clientX-this.UIElement.getBoundingClientRect().left)*t,s=(n.clientY-this.UIElement.getBoundingClientRect().top)*t;if(this.SliderChart){var o=this.SliderChart.PtInChart(a,s);if(!o)return;this.DragSlider={Click:{X:n.clientX,Y:n.clientY},LastMove:{X:n.clientX,Y:n.clientY},Data:o},this.DragSlider.DrawCount=0}document.onmousemove=function(h){e.DocOnMouseMove(h)},document.onmouseup=function(h){e.DocOnMouseUp(h)}},this.UIOnContextMenu=function(n){n.preventDefault()},this.UIOnMouseMove=function(n){var e=V(),t=(n.clientX-this.UIElement.getBoundingClientRect().left)*e,a=(n.clientY-this.UIElement.getBoundingClientRect().top)*e;if(!this.DragSlider){var s=s={Cursor:"default"},o=this.SliderChart.PtInChart(t,a);if(o)switch(o.Data.Type){case 0:s={Cursor:"move",Name:"SliderChart"};break;case 1:case 2:s={Cursor:"ew-resize",Name:"SliderChart"};break}s&&(this.UIElement.style.cursor=s.Cursor)}},this.UIOnMounseOut=function(n){},this.UIOnMouseleave=function(n){},this.DocOnMouseMove=function(n){var e=this;if(this.DragMove.PreMove.X=this.DragMove.Move.X,this.DragMove.PreMove.Y=this.DragMove.Move.Y,this.DragMove.Move.X=n.clientX,this.DragMove.Move.Y=n.clientX,!(this.ChartSplashPaint&&this.ChartSplashPaint.IsEnableSplash==!0)){var t=V(),a=(n.clientX-this.UIElement.getBoundingClientRect().left)*t,s=(n.clientY-this.UIElement.getBoundingClientRect().top)*t;if(X.Chart.Log("[JSScrollBarChartContainer::DocOnMouseMove] x="+a+", y="+s),this.DragSlider){var o=this.DragSlider,h=(n.clientX-o.LastMove.X)*t;if(Math.abs(h)<1)return;var l=this.GetPageRange(),u=this.Frame.ChartBorder.GetLeft(),f=this.Frame.ChartBorder.GetRight();this.SliderChart.DragMode=!0;var C=o.Data.Data.Type,D=this.SliderChart.XStart+h,v=this.SliderChart.XEnd+h;C==0?(D<u?(D=l.First.XStart,v=l.First.XEnd):v>=f&&(D=l.Last.XStart,v=l.Last.XEnd),this.SliderChart.XStart=D,this.SliderChart.XEnd=v):C==1?(D<=u&&(D=l.First.XStart),this.SliderChart.XStart=D):C==2&&(v>=f&&(v=l.Last.XEnd),this.SliderChart.XEnd=v),o.UpdateData={XStart:D,XEnd:v,Type:C},o.LastMove.X=n.clientX,o.LastMove.Y=n.clientY,o.DrawCount==0?this.DragUpdate(o):this.DragTimer=setTimeout(function(){e.DragUpdate(e.DragSlider)},this.DelayDragFrequency)}}},this.DocOnMouseUp=function(n){document.onmousemove=null,document.onmouseup=null,this.CancelDragTimer();var e=this.DragSlider;this.DragMove=null,this.DragSlider=null,this.SliderChart.DragMode=!1,this.DragUpdate(e)},this.DragUpdate=function(n){!n||!n.UpdateData||(this.UpdateXDataOffset(n.UpdateData),this.Draw(),++n.DrawCount)},this.Reset=function(n){this.SourceData=null,this.XOffsetData.Start=-1,this.XOffsetData.End=-1,this.XOffsetData.Count=0,this.Frame.Data=null;for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.Data=null}this.ChartSplashPaint&&(this.ChartSplashPaint.IsEnableSplash=!0),n.Draw&&this.Draw()},this.UpdateSlider=function(n){if(!this.SliderChart.DragMode){var e=!1;(this.AutoMargin.Left||this.AutoMargin.Right)&&n.Border&&(this.AutoMargin.Left&&this.Frame.ChartBorder.Left!=n.Border.Left&&(e=!0),this.AutoMargin.Right&&this.Frame.ChartBorder.Right!=n.Border.Right&&(e=!0));var t=n.Data;if(!(this.XOffsetData.Start==n.Start&&this.XOffsetData.End==n.End&&this.SourceData==t&&!e)){this.SourceData=t;var a=t.Data.length;c.IsNumber(n.RightSpaceCount)&&(a+=n.RightSpaceCount),this.Frame.XPointCount=a,this.Frame.Data=t,this.XOffsetData.Count=a,this.XOffsetData.Start=n.Start,this.XOffsetData.End=n.End;for(var s=0;s<this.ChartPaint.length;++s){var o=this.ChartPaint[s];o.Data=t}this.AutoMargin.Left&&n.Border&&c.IsNumber(n.Border.Left)&&(this.Frame.ChartBorder.Left=n.Border.Left),this.AutoMargin.Right&&n.Border&&c.IsNumber(n.Border.Right)&&(this.Frame.ChartBorder.Right=n.Border.Right),this.UpdateFrameMaxMin(),this.ChartSplashPaint&&(this.ChartSplashPaint.IsEnableSplash=!1),n.Draw&&this.Draw()}}},this.UpdateXDataOffset=function(n){if(n.Type==0){var e=this.Frame.GetXData(n.XStart);e=parseInt(e);var t=e-this.XOffsetData.Start;this.XOffsetData.Start=e,this.XOffsetData.End+=t}else if(n.Type==1){var e=this.Frame.GetXData(n.XStart);e=parseInt(e),this.XOffsetData.Start=e}else if(n.Type==2){var a=this.Frame.GetXData(n.XEnd);a=parseInt(a),this.XOffsetData.End=a}var s=this.SourceData.Data[this.XOffsetData.End],o=this.SourceData.Data[this.XOffsetData.Start],h={Type:n.Type,Count:this.XOffsetData.Count};if(this.XOffsetData.End>this.XOffsetData.Start?(h.Start={Index:this.XOffsetData.Start,Item:o},h.End={Index:this.XOffsetData.End,Item:s}):(h.Start={Index:this.XOffsetData.End,Item:s},h.End={Index:this.XOffsetData.Start,Item:o}),this.HQChart&&this.HQChart.JSChartContainer){var l=this.HQChart.JSChartContainer;if(l.ChartOperator){var n={ID:ce.OP_SCROOLBAR_SLIDER_CHANGED,Start:h.Start,End:h.End,Type:h.Type};l.ChartOperator(n)}}var u=this.GetEventCallback(et.ON_SCROLLBAR_SLIDER_CHANGED);u&&u.Callback(u,h,this)},this.ReloadResource=function(n){this.Frame.ReloadResource(n);for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.ReloadResource&&t.ReloadResource(n)}n&&n.Redraw&&(this.SetSizeChange(!0),this.Draw())},this.GetPageRange=function(){var n={},e=Math.abs(this.XOffsetData.Start-this.XOffsetData.End);n.ShowCount=e;var s=this.Frame.GetXFromIndex(0),a=this.Frame.GetXFromIndex(e);n.First={XStart:s,XEnd:a};var t=this.Frame.XPointCount-1,a=this.Frame.GetXFromIndex(t),s=this.Frame.GetXFromIndex(t-e);return n.Last={XStart:s,XEnd:a},n},this.ReloadResource=function(n){this.Frame.ReloadResource(n);for(var e=0;e<this.ChartPaint.length;++e){var t=this.ChartPaint[e];t.ReloadResource&&t.ReloadResource(n)}n.Draw==!0&&this.Draw()}}function WI(){this.ChartBorder,this.Canvas,this.BorderLine=null,this.Data,this.Count=0,this.ClassName="JSScrollBarFrame",this.HorizontalMax=10,this.HorizontalMin=5,this.XPointCount=0,this.XSplitTextFont=m.ScrollBar.XSplitTextFont,this.XSplitTextColor=m.ScrollBar.XSplitTextColor,this.XSplitLineColor=m.ScrollBar.XSplitLineColor,this.BorderColor=m.ScrollBar.BorderColor,this.LogoTextColor=m.FrameLogo.TextColor,this.LogoTextFont=m.FrameLogo.Font,this.ReloadResource=function(r){this.BorderColor=m.ScrollBar.BorderColor,this.LogoTextColor=m.FrameLogo.TextColor,this.LogoTextFont=m.FrameLogo.Font},this.Draw=function(){this.DrawBorder(),this.DrawLogo(),this.DrawVertical()},this.DrawLogo=function(){var r=m.FrameLogo.Text;if(c.IsString(r)){this.Canvas.fillStyle=this.LogoTextColor,this.Canvas.font=this.LogoTextFont,this.Canvas.textAlign="left",this.Canvas.textBaseline="top";var n=this.ChartBorder.GetLeft()+2,e=this.ChartBorder.GetTop()+2;this.Canvas.fillText(r,n,e)}},this.DrawBorder=function(){var r=L(this.ChartBorder.GetLeft()),n=L(this.ChartBorder.GetTop()),e=L(this.ChartBorder.GetRight()),t=L(this.ChartBorder.GetBottom()),a=e-r,s=t-n;c.IsNumber(this.BorderLine)?(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.beginPath(),(this.BorderLine&1)>0&&(this.Canvas.moveTo(r,n),this.Canvas.lineTo(e,n)),(this.BorderLine&2)>0&&(this.Canvas.moveTo(r,t),this.Canvas.lineTo(e,t)),(this.BorderLine&4)>0&&(this.Canvas.moveTo(r,n),this.Canvas.lineTo(r,t)),(this.BorderLine&8)>0&&(this.Canvas.moveTo(e,n),this.Canvas.lineTo(e,t)),this.Canvas.stroke()):(this.Canvas.strokeStyle=this.BorderColor,this.Canvas.strokeRect(r,n,a,s))},this.GetXFromIndex=function(r){var n=this.XPointCount;if(n==1)return r==0?this.ChartBorder.GetLeft():this.ChartBorder.GetRight();if(n<=0)return this.ChartBorder.GetLeft();if(r>=n)return this.ChartBorder.GetRight();var e=this.ChartBorder.GetLeft()+this.ChartBorder.GetWidth()*r/n;return e},this.GetYFromData=function(r){if(r<=this.HorizontalMin)return this.ChartBorder.GetBottomEx();if(r>=this.HorizontalMax)return this.ChartBorder.GetTopEx();var n=this.ChartBorder.GetHeightEx()*(r-this.HorizontalMin)/(this.HorizontalMax-this.HorizontalMin);return this.ChartBorder.GetBottomEx()-n},this.GetXData=function(r){return r<=this.ChartBorder.GetLeft()?0:r>=this.ChartBorder.GetRight()?this.XPointCount:(r-this.ChartBorder.GetLeft())*(this.XPointCount*1/this.ChartBorder.GetWidth())},this.GetPreSetpWidth=function(){return this.XPointCount*1/this.ChartBorder.GetWidth()},this.DrawVertical=function(){if(!(this.ChartBorder.Bottom<=5)&&!(!this.Data||!c.IsNonEmptyArray(this.Data.Data))){var r=this.Data.Data[0],n=parseInt(r.Date/1e4),e=r.Date%1e4;this.Canvas.font=this.XSplitTextFont,this.Canvas.fillStyle=this.XSplitTextColor,this.Canvas.textBaseline="top";var t=this.ChartBorder.GetBottom()+2,a=this.ChartBorder.GetTop(),s=this.ChartBorder.GetBottom(),o=0,h=k.IsMinutePeriod(this.Data.Period,!0);if(h)for(var l=0;l<this.Data.Data.length;++l){var r=this.Data.Data[l],u=r.Date%1e4;if(l==0){var f=c.FormatDateString(r.Date,"MM-DD"),C=this.ChartBorder.GetLeft();this.Canvas.textAlign="left",this.Canvas.fillText(f,C,t);var D=this.Canvas.measureText(f).width+2;o=C+D,e=u;continue}if(u!=e){var f=c.FormatDateString(r.Date,"MM-DD"),C=this.GetXFromIndex(l),D=this.Canvas.measureText(f).width+2;C-D/2>o&&(this.Canvas.textAlign="center",this.Canvas.fillText(f,C,t),o=C+D/2),C=L(C),this.Canvas.strokeStyle=this.XSplitLineColor,this.Canvas.beginPath(),this.Canvas.moveTo(C,a),this.Canvas.lineTo(C,s),this.Canvas.stroke(),e=u}}else for(var l=0;l<this.Data.Data.length;++l){var r=this.Data.Data[l],v=parseInt(r.Date/1e4);if(l==0){var f=""+v,C=this.ChartBorder.GetLeft(),D=this.Canvas.measureText(f).width+2;this.Canvas.textAlign="left",this.Canvas.fillText(f,C,t),o=C+D,n=v;continue}if(v!=n){var f=""+v,C=this.GetXFromIndex(l),D=this.Canvas.measureText(f).width+2;C-D/2>o&&(this.Canvas.textAlign="center",this.Canvas.fillText(f,C,t),o=C+D/2),C=L(C),this.Canvas.strokeStyle=this.XSplitLineColor,this.Canvas.beginPath(),this.Canvas.moveTo(C,a),this.Canvas.lineTo(C,s),this.Canvas.stroke(),n=v}}}}}function _I(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="SliderChart",this.OffsetData,this.Color=m.ScrollBar.Slider.BarAreaColor,this.BarColor=m.ScrollBar.Slider.BarColor,this.BarWidth=10,this.BarPadding=10,this.DateFont=m.ScrollBar.Slider.DateFont,this.DateColor=m.ScrollBar.Slider.DateColor,this.AryRect=[],this.XStart,this.XEnd,this.SizeChange=!0,this.DragMode=!1,this.ReloadResource=function(r){this.Color=m.ScrollBar.Slider.BarAreaColor,this.BarColor=m.ScrollBar.Slider.BarColor,this.DateFont=m.ScrollBar.Slider.DateFont,this.DateColor=m.ScrollBar.Slider.DateColor},this.Draw=function(){if(this.AryRect=[],!(!this.OffsetData||!c.IsPlusNumber(this.OffsetData.Count))&&!(!c.IsNumber(this.OffsetData.Start)||!c.IsNumber(this.OffsetData.End))){var r=this.ChartBorder.GetTop(),n=this.ChartBorder.GetBottom(),e,t;if(this.DragMode){var a=this.XStart,s=this.XEnd,o=this.ChartFrame.GetXData(a),h=this.ChartFrame.GetXData(s);o=parseInt(o),h=parseInt(h),e={Data:this.Data.Data[this.OffsetData.Start],X:a,Type:o<h?0:1},t={Data:this.Data.Data[this.OffsetData.End],X:s,Type:h>o?1:0}}else{var l=this.OffsetData.Start,u=this.OffsetData.End,a=this.ChartFrame.GetXFromIndex(l),s=this.ChartFrame.GetXFromIndex(u);this.XStart=a,this.XEnd=s,e={Data:this.Data.Data[this.OffsetData.Start],X:a,Type:a<s?0:1},t={Data:this.Data.Data[this.OffsetData.End],X:s,Type:s>a?1:0}}this.Canvas.fillStyle=this.Color;var T={Left:Math.min(a,s),Top:r,Width:Math.abs(s-a),Height:n-r};T.Right=T.Left+T.Width,T.Bottom=T.Top+T.Height,this.Canvas.fillRect(T.Left,T.Top,T.Width,T.Height),this.AryRect.push({Rect:T,Type:0});var f=V(),C=this.BarWidth*f,D=n-r-this.BarPadding*2*f,S=a-this.BarWidth/2,v=r+this.BarPadding*f;this.Canvas.fillStyle=this.BarColor;var T={Left:S,Top:v,Width:C,Height:D};T.Right=T.Left+T.Width,T.Bottom=T.Top+T.Height,this.Canvas.fillRect(T.Left,T.Top,T.Width,T.Height),this.AryRect.push({Rect:T,Type:1});var S=s-this.BarWidth/2,T={Left:S,Top:v,Width:C,Height:D};T.Right=T.Left+T.Width,T.Bottom=T.Top+T.Height,this.Canvas.fillRect(T.Left,T.Top,T.Width,T.Height),this.AryRect.push({Rect:T,Type:2}),this.DrawDateTime(e),this.DrawDateTime(t)}},this.DrawDateTime=function(r){if(!(!r||!r.Data)){var n=c.FormatDateString(r.Data.Date),e=this.ChartBorder.GetTop(),t=this.ChartBorder.GetBottom(),a=k.IsMinutePeriod(this.Data.Period,!0),s=null;if(a&&(s=c.FormatTimeString(r.Data.Time,"HH:MM")),r.Type==0){this.Canvas.textAlign="right";var o=r.X-this.BarWidth/2}else if(r.Type==1){this.Canvas.textAlign="left";var o=r.X+this.BarWidth/2}this.Canvas.font=this.DateFont;var h=this.Canvas.measureText("擎").width;this.Canvas.textBaseline="middle",this.Canvas.fillStyle=this.DateColor;var l=e+(t-e)/2;this.Canvas.fillText(n,o,l),s&&(l+=h,this.Canvas.fillText(s,o,l))}},this.PtInChart=function(r,n){if(!c.IsNonEmptyArray(this.AryRect))return null;for(var e=this.AryRect.length-1;e>=0;--e){var t=this.AryRect[e],a=t.Rect;if(r>=a.Left&&r<=a.Right&&n>=a.Top&&n<=a.Bottom)return{Data:t}}return null}}function UI(){this.Canvas,this.ChartBorder,this.ChartFrame,this.Name,this.ClassName="ScrollBarBGChart",this.SizeChange=!0,this.Data,this.Color=m.ScrollBar.BGChart.Color,this.LineWidth=m.ScrollBar.BGChart.LineWidth,this.AreaColor=m.ScrollBar.BGChart.AreaColor,this.ReloadResource=function(r){this.Color=m.ScrollBar.BGChart.Color,this.LineWidth=m.ScrollBar.BGChart.LineWidth,this.AreaColor=m.ScrollBar.BGChart.AreaColor},this.Draw=function(){if(!(!this.Data||!c.IsNonEmptyArray(this.Data.Data))){this.Canvas.save(),this.LineWidth>0&&(this.Canvas.lineWidth=this.LineWidth*V());var r=this.ChartBorder.GetBottom();this.Canvas.strokeStyle=this.Color;for(var n=!0,e=0,t,a,s={},o=0;o<this.Data.Data.length;++o){var h=this.Data.Data[o],l=h.Close;c.IsNumber(l)&&(t=this.ChartFrame.GetXFromIndex(o),a=this.ChartFrame.GetYFromData(l),n?(this.Canvas.beginPath(),this.Canvas.moveTo(t,a),n=!1,s={X:t,Y:a}):this.Canvas.lineTo(t,a),++e)}e>0&&(this.Canvas.stroke(),this.Canvas.lineTo(t,r),this.Canvas.lineTo(s.X,r),this.Canvas.closePath(),this.Canvas.fillStyle=this.AreaColor,this.Canvas.fill()),this.Canvas.restore()}},this.GetMaxMin=function(){var r={Max:null,Min:null};if(!this.Data||!c.IsNonEmptyArray(this.Data.Data))return r;for(var n=0;n<this.Data.Data.length;++n){var e=this.Data.Data[n],t=e.Close;c.IsNumber(t)&&((r.Max==null||r.Max<t)&&(r.Max=t),(r.Min==null||r.Min>t)&&(r.Min=t))}return r}}var KI="1.1.12314";function JI(){var r=`*************************************************************************************************************
*
*   HQChart                                             Ver: `+KI+` 
*                             
*   License: Apache License 2.0                                                                              
*   Source: https://github.com/jones2000/HQChart
*
*************************************************************************************************************
`;console.log(r)}JI();th.default=(me={jsChartInit:_t.Init,jsChartStyle:_t.SetStyle,JSChart:_t,ChartData:k,SingleData:yt,HistoryData:Rt,MARKET_SUFFIX_NAME:W,IFrameSplitOperator:c,FrameSplitKLinePriceY:en,FrameSplitKLineX:pr,JSKLineInfoMap:La,JSCHART_EVENT_ID:et,JSCHART_OPERATOR_ID:ce,JSCHART_DATA_FIELD_ID:Ze,JSCHART_CUSTOM_YCOORDINATE_ID:Ua,JSAlgorithm:Di,JSComplier:Qe,JSIndexScript:J,GetDevicePixelRatio:V},(0,Se.default)(me,"GetDevicePixelRatio",V),(0,Se.default)(me,"ScriptIndexConsole",aD),(0,Se.default)(me,"STYLE_TYPE_ID",$o),(0,Se.default)(me,"HQChartStyle",rD),(0,Se.default)(me,"JSConsole",X),(0,Se.default)(me,"KLineTooltipPaint",Yh),(0,Se.default)(me,"MinuteTooltipPaint",wC),(0,Se.default)(me,"ChartDrawTwoPointDemo",Uh),(0,Se.default)(me,"ChartDrawThreePointDemo",JC),(0,Se.default)(me,"CoordinateInfo",Ht),(0,Se.default)(me,"JSDealChart",qo),(0,Se.default)(me,"DEAL_COLUMN_ID",ue),(0,Se.default)(me,"JSReportChart",nn),(0,Se.default)(me,"REPORT_COLUMN_ID",rt),(0,Se.default)(me,"JSKeyboardChart",rs),(0,Se.default)(me,"KEYBOARD_COLUMN_ID",ki),(0,Se.default)(me,"JSScrollBarChart",sn),(0,Se.default)(me,"IChartPainting",bt),(0,Se.default)(me,"IExtendChartPainting",ga),(0,Se.default)(me,"IChartTitlePainting",kh),(0,Se.default)(me,"IChartDrawPicture",It),(0,Se.default)(me,"DynamicTitleData",kt),(0,Se.default)(me,"CONDITION_PERIOD",se),(0,Se.default)(me,"ChartMinuteVolumBar",Bh),(0,Se.default)(me,"ChartKLine",gr),(0,Se.default)(me,"KLineFrame",Tr),(0,Se.default)(me,"JS_Frame",{KLineFrame:Tr,KLineHScreenFrame:Rh}),(0,Se.default)(me,"JS_ChangeStringFormat",{IChangeStringFormat:Ga,HQMinuteTimeStringFormat:kC,HQDateStringFormat:YC,HQPriceStringFormat:HC}),(0,Se.default)(me,"JS_ID",{JSCHART_EVENT_ID:et,JSCHART_OPERATOR_ID:ce,JSCHART_DRAG_ID:be,JSCHART_BUTTON_ID:xt,JSCHART_DATA_FIELD_ID:Ze}),me);var qh={};Object.defineProperty(qh,"__esModule",{value:!0});var zI=ds,Qu=dn(zI),ZI=eC,Ae=dn(ZI),QI=Ah,Pe=dn(QI),$I=tC,Be=dn($I),_n,qI=iC,Me=dn(qI);function dn(r){return r&&r.__esModule?r:{default:r}}function jI(){this.Domain="https://opensource.zealink.com",this.CacheDomain="https://opensourcecache.zealink.com"}var ua=new jI;function tg(){this.Stop,this.Down,this.Up,this.Unchanged,this.UpStock={Symbol:null,Name:null},this.DownStock={Symbol:null,Name:null}}function eg(){this.Good,this.GoodIncrease={Day1:null,Week1:null,Week4:null}}function ag(r,n,e){this.arySymbol=new Array,this.SortField=r,this.Order=n,this.TagID=new Be.default([e])}function ig(){this.ROE,this.Date,this.PerSEarning,this.EPS,this.PerNetAsset,this.NProfit,this.NProfitIncrease,this.NnetProfit,this.NnProfitIncrease,this.NnProfitSpeed,this.Benford,this.SetData=function(r){isNaN(r.roe)||(this.ROE=r.roe),isNaN(r.finance.date)||(this.Date=r.finance.date),isNaN(r.finance.persearning)||(this.PerSEarning=r.finance.persearning),isNaN(r.finance.eps)||(this.EPS=r.finance.eps),isNaN(r.finance.pernetasset)||(this.PerNetAsset=r.finance.pernetasset),isNaN(r.finance.nprofit)||(this.NProfit=r.finance.nprofit),isNaN(r.finance.nprofitincrease)||(this.NProfitIncrease=r.finance.nprofitincrease),isNaN(r.finance.nnetprofit)||(this.NnetProfit=r.finance.nnetprofit),isNaN(r.finance.nnprofitincrease)||(this.NnProfitIncrease=r.finance.nnprofitincrease),isNaN(r.finance.nnprofitspeed)||(this.NnProfitSpeed=r.finance.nnprofitspeed),isNaN(r.finance.benford)||(this.Benford=r.finance.benford)}}function rg(){this.Date,this.A,this.Total,this.ARate,this.SetData=function(r){isNaN(r.capital.date)||(this.Date=r.capital.date),isNaN(r.capital.a)||(this.A=r.capital.a),isNaN(r.capital.total)||(this.Total=r.capital.total),isNaN(r.capital.arate)||(this.ARate=r.capital.arate)}}function ng(){this.SuperIn,this.SuperOut,this.BigIn,this.BigOut,this.MidIn,this.MidOut,this.SmallIn,this.SmallOut,this.MainIn,this.MainOut,this.MainNetIn,this.SetData=function(r){this.SuperIn=r.superin,this.SuperOut=r.superout,this.BigIn=r.bigin,this.BigOut=r.bigout,this.MidIn=r.midin,this.MidOut=r.midout,this.SmallIn=r.smallin,this.SmallOut=r.smallout,this.MainIn=r.mainin,this.MainOut=r.mainout,this.MainNetIn=r.mainnetin}}function xo(){this.SuperIn,this.SuperOut,this.BigIn,this.BigOut,this.MidIn,this.MidOut,this.SmallIn,this.SmallOut,this.MainIn,this.MainOut,this.MainNetIn,this.MainNetInRatio,this.SetData=function(r){this.SuperIn=r.superin,this.SuperOut=r.superout,this.BigIn=r.bigin,this.BigOut=r.bigout,this.MidIn=r.midin,this.MidOut=r.midout,this.SmallIn=r.smallin,this.SmallOut=r.smallout,this.MainIn=r.mainin,this.MainOut=r.mainout,this.MainNetIn=r.mainnetin,this.MainNetInRatio=r.mainnetinratio}}function Un(){this.DDX,this.DDY,this.DDZ,this.SetData=function(r){this.DDX=r.ddx,this.DDY=r.ddy,this.DDZ=r.ddz}}function sg(){this.Name,this.Business,this.Vol,this.Price,this.ReleaseDate,this.Competence,this.SetData=function(r){r.company&&(this.Name=r.company.name,this.Business=r.company.business,this.Vol=r.company.vol,this.Price=r.company.price,this.ReleaseDate=r.company.releasedate,this.Competence=r.company.corecompetence)}}function og(){this.Industry,this.Region,this.Concept,this.SetData=function(r){this.SetIndustryData(r),this.SetRegionData(r),this.SetConceptData(r)},this.SetIndustryData=function(r){if(r.industry){this.Industry=[];for(var n in r.industry){var e=r.industry[n];this.Industry.push({Name:e.name,Symbol:e.symbol})}}},this.SetRegionData=function(r){if(r.region){this.Region=[];for(var n in r.region){var e=r.region[n];this.Region.push({Name:e.name,Symbol:e.symbol})}}},this.SetConceptData=function(r){if(r.concept){this.Concept=[];for(var n in r.concept){var e=r.concept[n];this.Concept.push({Name:e.name,Symbol:e.symbol})}}}}function hg(){this.IsMargin=!1,this.IsHK=!1,this.IsSHHK=!1,this.IsSZHK=!1,this.STType=0,this.HK,this.SetData=function(r){r.events&&(isNaN(r.events.margin)||(this.IsMargin=r.events.margin==1),isNaN(r.events.hk)||(this.IsHK=r.events.hk==1),isNaN(r.events.shhk)||(this.IsSHHK=r.events.shhk==1),isNaN(r.events.szhk)||(this.IsSZHK=r.events.szhk==1),isNaN(r.events.st)||(this.STType=r.events.st),this.IsHK&&r.events.hksymbol&&r.events.hkname&&(this.HK={Symbol:r.events.hksymbol,Name:r.events.hkname}))}}function $u(r){var n=r.toUpperCase();if(n.indexOf(".SH")>0){if(n=n.replace(".SH",""),n.charAt(0)=="0"&&parseInt(n)<=3e3)return!0}else if(n.indexOf(".SZ")>0){if(n=n.replace(".SZ",""),n.charAt(0)=="3"&&n.charAt(1)=="9")return!0}else if(n.indexOf(".CI")>0)return!0;return!1}function jo(r){this.Symbol=r,this.Name,this.Open,this.Price,this.High,this.Low,this.YClose,this.Vol,this.Amount,this.Date,this.Time,this.ExchangeRate,this.Amplitude,this.VolRatio,this.Increase,this.MaxPrice,this.MinPrice,this.RFPrice,this.IndexTop,this.Week,this.MinuteAmplitude={},this.RiseFallSpeed={},this.MAmount={},this.GetBaseData=function(n,e){switch(this.BaseDataTagID.add(n),e){case it.SYMBOL:return this.Symbol;case it.NAME:return this.Name;case it.OPEN:return this.Open;case it.PRICE:return this.Price;case it.YCLOSE:return this.YClose;case it.HIGH:return this.High;case it.LOW:return this.Low;case it.VOL:return this.Vol;case it.AMOUNT:return this.Amount;case it.DATE:return this.Date;case it.TIME:return this.Time;case it.INCREASE:return this.Increase;case it.EXCHANGE_RATE:return this.ExchangeRate;case it.AMPLITUDE:return this.Amplitude;case it.MAX_PRICE:return this.MaxPrice;case it.MIN_PRICE:return this.MinPrice;case it.RISE_FALL_PRICE:return this.RFPrice;case it.VOLRATIO:return this.VolRatio;case it.INDEXTOP:return this.IndexTop;case it.WEEK:return this.Week}},this.Heat,this.GetHeatData=function(n){return this.HeatTagID.add(n),this.Heat},this.Sort=new Pe.default,this.GetSortData=function(n,e,t){var a=e.toString()+"-"+t.toString();if(!this.Sort.has(a)){var s=new ag(e,t,n);return this.Sort.set(a,s),s}var s=this.Sort.get(a);return s.TagID.add(n),s},this.Buy5,this.GetBuy5=function(n){return this.BuySellTagID.add(n),this.Buy5},this.Sell5,this.GetSell5=function(n){return this.BuySellTagID.add(n),this.Sell5},this.Deal,this.GetDeal=function(n){return this.DealTagID.add(n),this.Deal},this.MarketValue,this.FlowMarketValue,this.Bookrate,this.Bookdiffer,this.PE,this.PE2,this.PE3,this.PB,this.GetDerivative=function(n,e){switch(this.DerivativeTagID.add(n),e){case it.MARKET_VALUE:return this.MarketValue;case it.FLOW_MARKET_VALUE:return this.FlowMarketValue;case it.BOOK_RATE:return this.Bookrate;case it.BOOK_DIFFER:return this.Bookdiffer;case it.PE:return this.PE;case it.PE2:return this.PE2;case it.PE3:return this.PE3;case it.PB:return this.PB}},this.Finance,this.GetFinance=function(n,e){if(!this.Finance)return this.FinanceTagID.add(n),null;switch(e){case it.ROE:return this.Finance.ROE;case it.FINANCE_DATE:return this.Finance.Date;case it.FINANCE_PERSEARNING:return this.Finance.PerSEarning;case it.FINANCE_PERNETASSET:return this.Finance.PerNetAsset;case it.FINANCE_NPROFIT:return this.Finance.NProfit;case it.FINANCE_NPROFITINCREASE:return this.Finance.NProfitIncrease;case it.FINANCE_NNETPROFIT:return this.Finance.NnetProfit;case it.FINANCE_NNPROFITINCREASE:return this.Finance.NnProfitIncrease;case it.FINANCE_NNPROFITSPEED:return this.Finance.NnProfitSpeed;case it.FINANCE_EPS:return this.Finance.EPS;case it.FINANCE_BENFORD:return this.Finance.Benford}},this.Capital,this.GetCapital=function(n,e){if(!this.Capital)return this.CapitalTagID.add(n),null;switch(e){case it.CAPITAL_TOTAL:return this.Capital.Total;case it.CAPITAL_A:return this.Capital.A;case it.CAPTIAL_ARATE:return this.Capital.ARate}},this.CapitalFlowDay,this.CapitalFlowDay3,this.CapitalFlowDay5,this.CapitalFlowDay10,this.GetCapitalFlowDay=function(n,e){var t=null;switch(e){case it.CAPITAL_FLOW_DAY:this.CapitalFlowDayID.add(n),this.CapitalFlowDay&&(t=this.CapitalFlowDay);break;case it.CAPITAL_FLOW_DAY3:this.CapitalFlowDay3ID.add(n),this.CapitalFlowDay3&&(t=this.CapitalFlowDay3);break;case it.CAPITAL_FLOW_DAY5:this.CapitalFlowDay5ID.add(n),this.CapitalFlowDay5&&(t=this.CapitalFlowDay5);break;case it.CAPITAL_FLOW_DAY10:this.CapitalFlowDay10ID.add(n),this.CapitalFlowDay10&&(t=this.CapitalFlowDay10);break}return t},this.DDE,this.DDE3,this.DDE5,this.DDE10,this.GetDDE=function(n,e){var t=null;switch(e){case it.DDE:this.DDEID.add(n),this.DDE&&(t=this.DDE);break;case it.DDE3:this.DDE3ID.add(n),this.DDE3&&(t=this.DDE3);break;case it.DDE5:this.DDE5ID.add(n),this.DDE5&&(t=this.DDE5);break;case it.DDE10:this.DDE10ID.add(n),this.DDE10&&(t=this.DDE10);break}return t},this.Event,this.GetEvent=function(n,e){return this.Event?this.Event:(this.EventTagID.add(n),null)},this.Company,this.GetCompany=function(n,e){if(!this.Company)return this.CompanyTagID.add(n),null;switch(e){case it.COMPANY_NAME:return this.Company.Name;case it.COMPANY_BUSINESS:return this.Company.Business;case it.COMPANY_VOL:return this.Company.Vol;case it.COMPANY_PRICE:return this.Company.Price;case it.COMPANY_RELEASEDATE:return this.Company.ReleaseDate;case it.COMPANY_COMPETENCE:return this.Company.Competence}},this.Plate,this.GetPlate=function(n,e){if(!this.Plate)return this.PlateTagID.add(n),null;switch(e){case it.PLATE_INDUSTRY:return this.Plate.Industry;case it.PLATE_CONCEPT:return this.Plate.Concept;case it.PLATE_REGION:return this.Plate.Region}},this.TagID=new Be.default,this.BaseDataTagID=new Be.default,this.HeatTagID=new Be.default,this.BuySellTagID=new Be.default,this.DealTagID=new Be.default,this.DerivativeTagID=new Be.default,this.FinanceTagID=new Be.default,this.CapitalTagID=new Be.default,this.CapitalFlowDayID=new Be.default,this.CapitalFlowDay3ID=new Be.default,this.CapitalFlowDay5ID=new Be.default,this.CapitalFlowDay10ID=new Be.default,this.DDEID=new Be.default,this.DDE3ID=new Be.default,this.DDE5ID=new Be.default,this.DDE10ID=new Be.default,this.EventTagID=new Be.default,this.CompanyTagID=new Be.default,this.PlateTagID=new Be.default,this.AttachTagID=function(n){this.TagID.add(n)},this.ClearTagID=function(){this.TagID.clear(),this.BaseDataTagID.clear(),this.HeatTagID.clear(),this.BuySellTagID.clear(),this.DealTagID.clear(),this.DerivativeTagID.clear(),this.FinanceTagID.clear(),this.CapitalTagID.clear(),this.CapitalFlowDayID.clear(),this.CapitalFlowDay3ID.clear(),this.CapitalFlowDay5ID.clear(),this.CapitalFlowDay10ID.clear(),this.DDEID.clear(),this.DDE3ID.clear(),this.DDE5ID.clear(),this.DDE10ID.clear(),this.EventTagID.clear(),this.CompanyTagID.clear();var n=!0,e=!1,t=void 0;try{for(var a=(0,Ae.default)(this.Sort),s;!(n=(s=a.next()).done);n=!0){var o=s.value;o[1].TagID.clear()}}catch(h){e=!0,t=h}finally{try{!n&&a.return&&a.return()}finally{if(e)throw t}}},this.RemoveTagID=function(n){this.TagID.delete(n),this.BaseDataTagID.delete(n),this.HeatTagID.delete(n),this.BuySellTagID.delete(n),this.DealTagID.delete(n),this.DerivativeTagID.delete(n),this.FinanceTagID.delete(n),this.CapitalTagID.delete(n),this.CapitalFlowDayID.delete(n),this.CapitalFlowDay3ID.delete(n),this.CapitalFlowDay5ID.delete(n),this.CapitalFlowDay10ID.delete(n),this.DDEID.delete(n),this.DDE3ID.delete(n),this.DDE5ID.delete(n),this.DDE10ID.delete(n),this.EventTagID.delete(n),this.CompanyTagID.delete(n);var e=!0,t=!1,a=void 0;try{for(var s=(0,Ae.default)(this.Sort),o;!(e=(o=s.next()).done);e=!0){var h=o.value;h[1].TagID.delete(n)}}catch(l){t=!0,a=l}finally{try{!e&&s.return&&s.return()}finally{if(t)throw a}}},this.SetBaseData=function(n){this.Name=n.name,this.YClose=n.yclose,this.Price=n.price,this.High=n.high,this.Low=n.low,this.Open=n.open,this.Vol=n.vol,this.Amount=n.amount,this.Date=n.date,this.Time=n.time,this.Increase=n.increase,isNaN(n.exchangerate)||(this.ExchangeRate=n.exchangerate),isNaN(n.amplitude)||(this.Amplitude=n.amplitude),isNaN(n.volratio)||(this.VolRatio=n.volratio),this.Name.indexOf("ST")>=0?(this.MaxPrice=(1+.05)*this.Open,this.MinPrice=(1-.05)*this.Open):(this.MaxPrice=(1+.1)*this.Open,this.MinPrice=(1-.1)*this.Open),this.Price&&this.YClose&&(this.RFPrice=this.Price-this.YClose),n.week&&(this.Week={},this.Week.Week1=n.week.week1,this.Week.Week4=n.week.week4,this.Week.Week13=n.week.week13,this.Week.Week26=n.week.week26,this.Week.Week52=n.week.week52)},this.SetDerivativeData=function(n){this.MarketValue=n.marketvalue,this.FlowMarketValue=n.flowmarketvalue,this.Bookrate=n.bookrate,this.Bookdiffer=n.bookdiffer,this.PE=n.pe,this.PE2=n.pe2,this.PE3=n.pe3,this.PB=n.pb},this.SetFinanceData=function(n){console.log(n),n.finance&&(this.Finance=new ig,this.Finance.SetData(n))},this.SetCapitalData=function(n){n.capital&&(this.Capital=new rg,this.Capital.SetData(n))},this.SetIndexBaseData=function(n){this.SetBaseData(n);var e=new tg;n.indextop&&(e.Up=n.indextop.up,e.Down=n.indextop.down,e.Unchanged=n.indextop.unchanged,e.Stop=n.indextop.stop,e.UpStock.Symbol=n.indextop.upstock.symbol,e.UpStock.Name=n.indextop.upstock.name,e.DownStock.Symbol=n.indextop.downstock.symbol,e.DownStock.Name=n.indextop.downstock.name),this.IndexTop=e},this.SetBuySellData=function(n){this.SetBaseData(n),this.Buy5=new Array,this.Sell5=new Array;for(var e in n.buy){var t=n.buy[e];this.Buy5.push({Price:t.price,Vol:t.vol})}for(var e in n.sell){var t=n.sell[e];this.Sell5.push({Price:t.price,Vol:t.vol})}},this.SetDealData=function(n){this.Price=n.price,this.High=n.high,this.Low=n.low,this.Vol=n.vol,this.Amount=n.amount,this.Date=n.date,this.Time=n.time,this.Increase=n.increase,this.Deal=new Array;for(var e in n.deal){var t=n.deal[e];if(!(isNaN(t.price)||isNaN(t.time))){var a="";t.bs===0?a="B":t.bs===1&&(a="S"),this.Deal.push({Price:t.price,Amount:t.amount,Vol:t.vol,Time:t.time,BS:a})}}},this.SetHeatData=function(n){var e=new eg;e.Good=n.quadrant.good,e.GoodIncrease.Day1=n.quadrant.gincrease.day1,e.GoodIncrease.Week1=n.quadrant.gincrease.week1,e.GoodIncrease.Week4=n.quadrant.gincrease.week4,this.Heat=e},this.SetCapitalFlowDayData=function(n,e){if(n)switch(e){case ct.CAPITAL_FLOW_DAY_DATA:this.CapitalFlowDay=new ng,this.CapitalFlowDay.SetData(n);break;case ct.CAPITAL_FLOW_DAY3_DATA:this.CapitalFlowDay3=new xo,this.CapitalFlowDay3.SetData(n);break;case ct.CAPITAL_FLOW_DAY5_DATA:this.CapitalFlowDay5=new xo,this.CapitalFlowDay5.SetData(n);break;case ct.CAPITAL_FLOW_DAY10_DATA:this.CapitalFlowDay10=new xo,this.CapitalFlowDay10.SetData(n);break}},this.SetDDE=function(n,e){if(n){switch(e){case ct.DDE_DAY_DATA:this.DDE=new Un,this.DDE.SetData(n);break;case ct.DDE_DAY3_DATA:this.DDE3=new Un,this.DDE3.SetData(n);break;case ct.DDE_DAY5_DATA:this.DDE5=new Un,this.DDE5.SetData(n);break;case ct.DDE_DAY10_DATA:this.DDE10=new Un,this.DDE10.SetData(n);break}return n}},this.SetEventData=function(n){n.events&&(this.Event=new hg,this.Event.SetData(n))},this.SetCompanyData=function(n){n.company&&(this.Company=new sg,this.Company.SetData(n))},this.SetPlateData=function(n){!n.industry&&!n.region&&!n.concept||(this.Plate=new og,this.Plate.SetData(n))},this.SetData=function(n){n.name&&(this.Name=n.name),isNaN(n.yclose)||(this.YClose=n.yclose),isNaN(n.price)||(this.Price=n.price),isNaN(n.high)||(this.High=n.high),isNaN(n.low)||(this.Low=n.low),isNaN(n.vol)||(this.Vol=n.vol),isNaN(n.amount)||(this.Amount=n.amount),isNaN(n.date)||(this.Date=n.date),isNaN(n.time)||(this.Time=n.time),isNaN(n.increase)||(this.Increase=n.increase),isNaN(n.marketvalue)||(this.MarketValue=n.marketvalue),isNaN(n.flowmarketvalue)||(this.FlowMarketValue=n.flowmarketvalue),isNaN(n.bookrate)||(this.Bookrate=n.bookrate),isNaN(n.bookdiffer)||(this.Bookdiffer=n.bookdiffer),isNaN(n.pe)||(this.PE=n.pe),isNaN(n.pb)||(this.PB=n.pb),n.finance&&this.SetFinanceData(n),n.finance&&this.SetFinanceDetailData(n),n.capital&&this.SetCapitalData(n),n.mamplitude&&(isNaN(n.mamplitude[1])||(this.MinuteAmplitude.M1=n.mamplitude[1]),isNaN(n.mamplitude[3])||(this.MinuteAmplitude.M3=n.mamplitude[3]),isNaN(n.mamplitude[5])||(this.MinuteAmplitude.M5=n.mamplitude[5]),isNaN(n.mamplitude[10])||(this.MinuteAmplitude.M10=n.mamplitude[10]),isNaN(n.mamplitude[15])||(this.MinuteAmplitude.M15=n.mamplitude[15])),n.risefallspeed&&(isNaN(n.risefallspeed[1])||(this.RiseFallSpeed.M1=n.risefallspeed[1]),isNaN(n.risefallspeed[3])||(this.RiseFallSpeed.M3=n.risefallspeed[3]),isNaN(n.risefallspeed[5])||(this.RiseFallSpeed.M5=n.risefallspeed[5]),isNaN(n.risefallspeed[10])||(this.RiseFallSpeed.M10=n.risefallspeed[10]),isNaN(n.risefallspeed[15])||(this.RiseFallSpeed.M15=n.risefallspeed[15])),n.mamount&&(isNaN(n.mamount[1])||(this.MAmount.M1=n.mamount[1]),isNaN(n.mamount[3])||(this.MAmount.M5=n.mamount[3]),isNaN(n.mamount[5])||(this.MAmount.M5=n.mamount[5]),isNaN(n.mamount[10])||(this.MAmount.M10=n.mamount[10]),isNaN(n.mamount[15])||(this.MAmount.M15=n.mamount[15]))}}var it={SYMBOL:0,NAME:1,OPEN:2,PRICE:3,HIGH:4,LOW:5,YCLOSE:6,VOL:7,AMOUNT:8,DATE:9,TIME:10,INCREASE:11,BUY5:12,SELL5:13,DEAL:14,AMPLITUDE:15,MARKET_VALUE:16,FLOW_MARKET_VALUE:17,BOOK_RATE:18,BOOK_DIFFER:19,PE:20,PB:21,EXCHANGE_RATE:23,ROE:24,FINANCE_DATE:25,FINANCE_PERSEARNING:26,FINANCE_PERNETASSET:27,FINANCE_NPROFIT:28,FINANCE_NPROFITINCREASE:29,FINANCE_NNETPROFIT:30,FINANCE_NNPROFITINCREASE:31,FINANCE_NNPROFITSPEED:32,FINANCE_EPS:33,MAX_PRICE:34,MIN_PRICE:35,RISE_FALL_PRICE:36,FINANCE_BENFORD:37,RISEFALLSPEED_1:38,RISEFALLSPEED_3:39,RISEFALLSPEED_5:40,RISEFALLSPEED_10:41,RISEFALLSPEED_15:42,MINUTE_AMPLITUDE_1:43,MINUTE_AMPLITUDE_3:44,MINUTE_AMPLITUDE_5:45,MINUTE_AMPLITUDE_10:46,MINUTE_AMPLITUDE_15:47,MINUTE_AMOUNT_1:48,MINUTE_AMOUNT_3:49,MINUTE_AMOUNT_5:50,MINUTE_AMOUNT_10:51,MINUTE_AMOUNT_15:52,COMPANY_NAME:53,PLATE_INDUSTRY:54,PLATE_CONCEPT:55,PLATE_REGION:56,COMPANY_BUSINESS:57,COMPANY_VOL:58,COMPANY_PRICE:59,COMPANY_RELEASEDATE:60,COMPANY_COMPETENCE:61,CAPITAL_FLOW_DAY:67,CAPITAL_FLOW_DAY3:68,CAPITAL_FLOW_DAY5:69,CAPITAL_FLOW_DAY10:70,DDE:71,DDE3:72,DDE5:73,DDE10:74,EVENTS:75,CAPITAL_A:76,CAPITAL_TOTAL:77,CAPTIAL_ARATE:78,VOLRATIO:79,PE2:80,PE3:81,INDEXTOP:100,WEEK:101,HEAT:102},qu={m_mapFiled:new Pe.default([[it.NAME,"name"],[it.SYMBOL,"symbol"],[it.PRICE,"price"],[it.INCREASE,"increase"],[it.PE,"pe"],[it.FINANCE_BENFORD,"finance.benford"],[it.YCLOSE,"yclose"],[it.RISEFALLSPEED_1,"risefallspeed.1"],[it.RISEFALLSPEED_3,"risefallspeed.3"],[it.RISEFALLSPEED_5,"risefallspeed.5"],[it.RISEFALLSPEED_10,"risefallspeed.10"],[it.RISEFALLSPEED_15,"risefallspeed.15"],[it.MINUTE_AMPLITUDE_1,"mamplitude.1"],[it.MINUTE_AMPLITUDE_3,"mamplitude.3"],[it.MINUTE_AMPLITUDE_5,"mamplitude.5"],[it.MINUTE_AMPLITUDE_10,"mamplitude.10"],[it.MINUTE_AMPLITUDE_15,"mamplitude.15"],[it.MINUTE_AMOUNT_1,"mamount.1"],[it.MINUTE_AMOUNT_3,"mamount.3"],[it.MINUTE_AMOUNT_5,"mamount.5"],[it.MINUTE_AMOUNT_10,"mamount.10"],[it.MINUTE_AMOUNT_15,"mamount.15"]]),GetFieldName:function(n){return this.m_mapFiled.has(n)?this.m_mapFiled.get(n):null}};function nD(r,n){this.JSStock=r,this.TagID=n,this.Get=function(e,t){var a=r.Get(e,this.TagID);if(!a)return null;switch(t){case it.SYMBOL:case it.NAME:case it.OPEN:case it.PRICE:case it.YCLOSE:case it.HIGH:case it.LOW:case it.VOL:case it.AMOUNT:case it.DATE:case it.TIME:case it.INCREASE:case it.EXCHANGE_RATE:case it.AMPLITUDE:case it.MAX_PRICE:case it.MIN_PRICE:case it.RISE_FALL_PRICE:case it.INDEXTOP:case it.WEEK:case it.VOLRATIO:return a.GetBaseData(this.TagID,t);case it.HEAT:return a.GetHeatData(this.TagID);case it.BUY5:return a.GetBuy5(this.TagID);case it.SELL5:return a.GetSell5(this.TagID);case it.DEAL:return a.GetDeal(this.TagID);case it.MARKET_VALUE:case it.FLOW_MARKET_VALUE:case it.BOOK_RATE:case it.BOOK_DIFFER:case it.PE:case it.PE2:case it.PE3:case it.PB:return a.GetDerivative(this.TagID,t);case it.ROE:case it.FINANCE_DATE:case it.FINANCE_PERSEARNING:case it.FINANCE_PERNETASSET:case it.FINANCE_NPROFIT:case it.FINANCE_NPROFITINCREASE:case it.FINANCE_NNETPROFIT:case it.FINANCE_NNPROFITINCREASE:case it.FINANCE_NNPROFITSPEED:case it.FINANCE_EPS:case it.FINANCE_BENFORD:return a.GetFinance(this.TagID,t);case it.PLATE_INDUSTRY:case it.PLATE_CONCEPT:case it.PLATE_REGION:return a.GetPlate(this.TagID,t);case it.CAPITAL_FLOW_DAY:case it.CAPITAL_FLOW_DAY3:case it.CAPITAL_FLOW_DAY5:case it.CAPITAL_FLOW_DAY10:return a.GetCapitalFlowDay(this.TagID,t);case it.DDE:case it.DDE3:case it.DDE5:case it.DDE10:return a.GetDDE(this.TagID,t);case it.EVENTS:return a.GetEvent(this.TagID,t);case it.COMPANY_NAME:case it.COMPANY_BUSINESS:case it.COMPANY_VOL:case it.COMPANY_PRICE:case it.COMPANY_RELEASEDATE:case it.COMPANY_COMPETENCE:return a.GetCompany(this.TagID,t);case it.CAPITAL_A:case it.CAPTIAL_ARATE:case it.CAPITAL_TOTAL:return a.GetCapital(this.TagID,t);default:return null}},this.GetSort=function(e,t,a){var s=r.Get(e,this.TagID);return s==null?s:s.GetSortData(this.TagID,t,a)},this.EndRead=function(e){e==!0&&this.JSStock.ReqeustData()},this.SetQueryField=function(e,t){for(var a in t)this.Get(e,t[a])}}function lg(){this.Symbol,this.Callback,this.Order=-1,this.SortField,this.Field,this.Plate,this.Data=new Pe.default,this.ApiUrl=ua.Domain+"/API/StockHistoryDay",this.PageSize=20,this.PageIndex=1,this.Count,this.currentData=null,this.RequsetData=function(r,n){var e=this,t=typeof e.Symbol=="string"?[this.Symbol]:this.Symbol,a=t?t.length:0;this.Plate?this.currentData={plate:this.Plate,symbol:t,start:0,end:this.PageSize,field:this.Field,orderfield:this.SortField,order:this.Order,condition:r.GetQuery(),condition2:n?n.GetQuery():[]}:this.currentData={symbol:t,start:0,end:a,field:this.Field,orderfield:this.SortField,order:this.Order,condition:r.GetQuery(),condition2:n?n.GetQuery():[]},Me.default.ajax({url:this.ApiUrl,data:e.currentData,method:"POST",dataType:"json",success:function(o){e.Count=o.data.count,e.RecvData(o,r)},fail:function(o){e.RecvError(o,r)}})},this.GetNextPage=function(){var r=this;this.PageSize*this.PageIndex<this.Count?(this.currentData.start=this.PageSize*this.PageIndex,this.PageIndex++,this.currentData.end=this.PageSize*this.PageIndex,Me.default.ajax({url:this.ApiUrl,data:r.currentData,method:"POST",dataType:"json",success:function(e){r.RecvData(e)},fail:function(e){r.RecvError(e)}})):alert("数据已全部加载")},this.RecvData=function(r,n){var e=r.data;for(var t in e.stock){var a=e.stock[t],s=a.symbol,o={};this.Data.has(s)?o=this.Data.get(s):(o={Symbol:a.symbol,Name:a.name,Data:new Pe.default},this.Data.set(s,o)),this.SetStockData(a,o)}this.Callback&&this.Callback(this,n)},this.SetStockData=function(r,n){for(var e in r.stockday){var t=r.stockday[e],a=t.date,s=new Pe.default;this.SetFinanceData(t,s),this.SetBlocktradingData(t,s),this.SetChangesData(t,s),this.SetLiftingData(t,s),this.SetPforecastData(t,s),this.SetShortIndicatorsData(t,s),n.Data.set(a,s)}return n},this.SetFinanceData=function(r,n){var e=r.finance1;e&&(isNaN(e.nprofitincrease)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_NPROFITINCREASE,e.nprofitincrease),isNaN(e.nnprofitincrease)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_NNPROFITINCREASE,e.nnprofitincrease),isNaN(e.nnprofitspeed)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_NNPROFITSPEED,e.nnprofitspeed),isNaN(e.benford)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_BENFORD,e.benford));var t=r.announcement1;t&&(isNaN(t.year)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_YEAR,t.year),isNaN(t.quarter)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE1_QUARTER,t.quarter));var e=r.finance2;e&&(isNaN(e.nprofitincrease)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_NPROFITINCREASE,e.nprofitincrease),isNaN(e.nnprofitincrease)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_NNPROFITINCREASE,e.nnprofitincrease),isNaN(e.nnprofitspeed)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_NNPROFITSPEED,e.nnprofitspeed),isNaN(e.benford)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_BENFORD,e.benford));var t=r.announcement2;t&&(isNaN(t.year)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_YEAR,t.year),isNaN(t.quarter)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE2_QUARTER,t.quarter));var e=r.finance3;e&&(isNaN(e.nprofitincrease)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_NPROFITINCREASE,e.nprofitincrease),isNaN(e.nnprofitincrease)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_NNPROFITINCREASE,e.nnprofitincrease),isNaN(e.nnprofitspeed)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_NNPROFITSPEED,e.nnprofitspeed),isNaN(e.benford)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_BENFORD,e.benford));var t=r.announcement3;t&&(isNaN(t.year)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_YEAR,t.year),isNaN(t.quarter)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE3_QUARTER,t.quarter));var e=r.finance4;e&&(isNaN(e.nprofitincrease)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_NPROFITINCREASE,e.nprofitincrease),isNaN(e.nnprofitincrease)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_NNPROFITINCREASE,e.nnprofitincrease),isNaN(e.nnprofitspeed)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_NNPROFITSPEED,e.nnprofitspeed),isNaN(e.benford)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_BENFORD,e.benford));var t=r.announcement4;t&&(isNaN(t.year)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_YEAR,t.year),isNaN(t.quarter)||n.set(STOCK_HISTORY_FIELD_NAME.FINANCE4_QUARTER,t.quarter))},this.SetBlocktradingData=function(r,n){var e=r.blocktrading;e&&n.set(STOCK_HISTORY_FIELD_NAME.BLOCK_TRADING,{Premium:e.premium,Price:e.price,Vol:e.vol,Amount:e.amount})},this.SetChangesData=function(r,n){var e=r.changes;e&&n.set(STOCK_HISTORY_FIELD_NAME.HOLDERS_CHANGES,{List:e.list})},this.SetLiftingData=function(r,n){var e=r.lifting;e&&n.set(STOCK_HISTORY_FIELD_NAME.LIFTING,{Lifting:e})},this.SetPforecastData=function(r,n){var e=r.pforecast;e&&n.set(STOCK_HISTORY_FIELD_NAME.PFORECAST,{Lowprofit:e[0].lowprofit,Highprofit:e[0].highprofit,Lowchange:e[0].lowchange,Highchange:e[0].highchange,Reportdate:e[0].reportdate})},this.SetShortIndicatorsData=function(r,n){var e=r.policy;if(e){var t=["三只乌鸦","乌云盖顶","黄昏之星","巨量阴线","头肩顶","射击之星","倾盆大雨","断头铡刀","淡友反攻","空方炮","连续1周空头排列"],a=0,s=[],o=0,h="";e.forEach(function(l){var u=t.some(function(f){return f===l.name});u&&(a++,s.push(l.time))}),a?(o=Math.max.apply(s,s),h=e.find(function(l){return l.time===o}).name):h="",console.log(h,a,"latestName-targetedCount"),n.set(STOCK_HISTORY_FIELD_NAME.SHORTIND_ICATORS,{latestIndicatorName:h,indicatorCount:a})}},this.RecvError=function(r,n){},this.CreateCondition=function(r){return new QueryCondition(r)}}ra.Init=function(){var r=new ra;return r};ra.SetDomain=function(r,n){r&&(ua.Domain=r),n&&(ua.CacheDomain=n)};ra.GetSearchStock=function(r){return new ug(r)};ra.GetShortTerm=function(r){return new fg(r)};ra.GetDealDay=function(r){return new Cg(r)};ra.GetBlockMember=function(r){return new Dg(r)};ra.GetBlockTop=function(){return new vg};ra.GetMinuteImage=function(r){return new cg(r)};ra.GetHistoryDayData=function(r){return new Sg(r)};ra.GetDealPriceListData=function(r){return new Tg(r)};ra.GetLatestDetailData=function(r){return new dg(r)};ra.GetAnalylisPlate=function(){return new mg};ra.GetStockHistory=function(){return new lg};var ct={BASE_DATA:1,INDEX_BASE_DATA:2,HEAT_DATA:3,SORT_DATA:4,BUY_SELL_DATA:5,DEAL_DATA:6,DERIVATIVE_DATA:7,FINANCE_DATA:8,SEARCH_STOCK_DATA:9,SELF_STOCK_DATA:10,LOGON_DATA:11,BLOCK_MEMBER_DATA:13,SHORT_TERM_DATA:14,COMPANY_DATA:15,PLATE_DATA:16,CAPITAL_DATA:17,CAPITAL_FLOW_DAY_DATA:23,CAPITAL_FLOW_DAY3_DATA:24,CAPITAL_FLOW_DAY5_DATA:25,CAPITAL_FLOW_DAY10_DATA:26,DDE_DAY_DATA:27,DDE_DAY3_DATA:28,DDE_DAY5_DATA:29,DDE_DAY10_DATA:30,DEAL_DAY_DATA:105,EVENT_DATA:106,IMAGE_MINUTE_DATA:107,HISTORY_DAY_DATA:108,DEAL_PRICE_LIST_DATA:109,LATEST_DETAIL_DATA:110};function ra(){this.MapStock=new Pe.default,this.MapTagCallback=new Pe.default,this.RequestVersion=new Array([100,100,100]),this.RealtimeApiUrl=ua.Domain+"/API/Stock",this.PlateQuadrantApiUrl=ua.Domain+"/API/StockPlateQuadrant",this.IsAutoUpdate=!0,this.AutoUpateTimeout=15e3,this.Timeout,this.NetworkFilter,this.GetStockRead=function(r,n){var e=!0,t=!1,a=void 0;try{for(var s=(0,Ae.default)(this.MapStock),o;!(e=(o=s.next()).done);e=!0){var h=o.value;h[1].RemoveTagID(r)}}catch(u){t=!0,a=u}finally{try{!e&&s.return&&s.return()}finally{if(t)throw a}}this.MapTagCallback.set(r,n);var l=new nD(this,r);return l},this.Unsubscribe=function(r){var n=!0,e=!1,t=void 0;try{for(var a=(0,Ae.default)(this.MapStock),s;!(n=(s=a.next()).done);n=!0){var o=s.value;o[1].RemoveTagID(r)}}catch(h){e=!0,t=h}finally{try{!n&&a.return&&a.return()}finally{if(e)throw t}}},this.UnsubscribeStock=function(r,n){var e=!0,t=!1,a=void 0;try{for(var s=(0,Ae.default)(this.MapStock),o;!(e=(o=s.next()).done);e=!0){var h=o.value;if(h[0]===r){n?h[1].RemoveTagID(n):h[1].ClearTagID(),console.log("[JSStock::UnsubscribeStock] symbol="+r+", tagID="+n);break}}}catch(l){t=!0,a=l}finally{try{!e&&s.return&&s.return()}finally{if(t)throw a}}},this.Get=function(r,n){this.MapStock.has(r)||this.MapStock.set(r,new jo(r));var e=this.MapStock.get(r);return n&&e.AttachTagID(n),e},this.RequestData=function(){this.ClearTimer();var r=new Array,n=new Array,e=new Array,t=new Array,a=new Array,s=new Array,o=new Array,h=[],l=[],u=[],f=[],C=[],D=[],v=[],S=[],T=new Array,I=new Array,F=new Array,E=new Array,M=!0,O=!1,R=void 0;try{for(var b=(0,Ae.default)(this.MapStock),p;!(M=(p=b.next()).done);M=!0){var G=p.value,Y=G[1],Q=G[0];Y.BaseDataTagID.size>0&&($u(Q)?n.push(Q):r.push(Q)),Y.BuySellTagID.size>0&&t.push(Q),Y.CapitalFlowDayID.size>0&&h.push(Q),Y.CapitalFlowDay3ID.size>0&&l.push(Q),Y.CapitalFlowDay5ID.size>0&&u.push(Q),Y.CapitalFlowDay10ID.size>0&&f.push(Q),Y.DDEID.size>0&&C.push(Q),Y.DDE3ID.size>0&&D.push(Q),Y.DDE5ID.size>0&&v.push(Q),Y.DDE10ID.size>0&&S.push(Q),Y.HeatTagID.size>0&&e.push(Q),Y.DealTagID.size>0&&a.push(Q),Y.DerivativeTagID.size>0&&s.push(Q),Y.FinanceTagID.size>0&&o.push(Q),Y.CapitalTagID.size>0&&E.push(Q),Y.Event==null&&Y.EventTagID.size>0&&T.push(Q),Y.Company==null&&Y.CompanyTagID.size>0&&I.push(Q),G[1].Plate==null&&G[1].PlateTagID.size>0&&F.push(G[0])}}catch(ht){O=!0,R=ht}finally{try{!M&&b.return&&b.return()}finally{if(O)throw R}}t.length>0&&this.RequestBuySellData(t),r.length>0&&this.RequestBaseData(r),n.length>0&&this.RequestIndexBaseData(n),e.length>0&&this.RequestIndexHeatData(e),a.length>0&&this.RequestDealData(a),s.length>0&&this.RequestDerivativeData(s),o.length>0&&this.RequestFinanceData(o),E.length>0&&this.RequestCapitalData(E),h.length>0&&this.RequestSubDocumentData(h,"flowday"),l.length>0&&this.RequestSubDocumentData(l,"flowday3"),u.length>0&&this.RequestSubDocumentData(u,"flowday5"),f.length>0&&this.RequestSubDocumentData(f,"flowday10"),C.length>0&&this.RequestSubDocumentData(C,"dde"),D.length>0&&this.RequestSubDocumentData(D,"dde3"),v.length>0&&this.RequestSubDocumentData(v,"dde5"),S.length>0&&this.RequestSubDocumentData(S,"dde10"),T.length>0&&this.RequestEventData(T),I.length>0&&this.RequestCompanyData(I),F.length>0&&this.RequestPlateData(F),this.ReqeustAllSortData()},this.ReqeustData=this.RequestData,this.RequestBaseData=function(r){var n=this,e=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","increase","exchangerate","amplitude","volratio"];if(this.NetworkFilter){var t={Name:"JSStock::RequestBaseData",Explain:"股票基础数据",ID:ct.BASE_DATA,Request:{Url:n.RealtimeApiUrl,Data:{field:e,symbol:r},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(a){n.RecvData(a,ct.BASE_DATA)}),t.PreventDefault==!0)return}Me.default.ajax({url:this.RealtimeApiUrl,data:{field:e,symbol:r},type:"post",dataType:"json",async:!0,success:function(s){n.RecvData(s,ct.BASE_DATA)},error:function(s){n.RecvError(s,ct.BASE_DATA)}})},this.RequestDerivativeData=function(r){var n=this,e=["name","symbol","marketvalue","flowmarketvalue","pe","pe2","pe3","pb","bookrate","bookdiffer"];if(this.NetworkFilter){var t={Name:"JSStock::RequestDerivativeData",Explain:"实时衍生数据",ID:ct.DERIVATIVE_DATA,Request:{Url:n.RealtimeApiUrl,Data:{field:e,symbol:r},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(a){n.RecvData(a,ct.DERIVATIVE_DATA)}),t.PreventDefault==!0)return}Me.default.ajax({url:this.RealtimeApiUrl,data:{field:e,symbol:r},type:"post",dataType:"json",async:!0,success:function(s){n.RecvData(s,ct.DERIVATIVE_DATA)},error:function(s){n.RecvError(s,ct.DERIVATIVE_DATA)}})},this.RequestFinanceData=function(r){var n=this,e=["name","symbol","roe","finance"];if(this.NetworkFilter){var t={Name:"JSStock::RequestFinanceData",Explain:"财务数据",ID:ct.FINANCE_DATA,Request:{Url:n.RealtimeApiUrl,Data:{field:e,symbol:r},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(a){n.RecvData(a,ct.FINANCE_DATA)}),t.PreventDefault==!0)return}Me.default.ajax({url:this.RealtimeApiUrl,data:{field:e,symbol:r},type:"post",dataType:"json",async:!0,success:function(s){n.RecvData(s,ct.FINANCE_DATA)},error:function(s){n.RecvError(s,ct.FINANCE_DATA)}})},this.RequestCapitalData=function(r){var n=this,e=["name","symbol","capital"];if(this.NetworkFilter){var t={Name:"JSStock::RequestCapitalData",Explain:"股本数据",ID:ct.CAPITAL_DATA,Request:{Url:n.RealtimeApiUrl,Data:{field:e,symbol:r},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(a){n.RecvData(a,ct.CAPITAL_DATA)}),t.PreventDefault==!0)return}Me.default.ajax({url:this.RealtimeApiUrl,data:{field:e,symbol:r},type:"post",dataType:"json",async:!0,success:function(s){n.RecvData(s,ct.CAPITAL_DATA)},error:function(s){n.RecvError(s,ct.CAPITAL_DATA)}})},this.RequestBuySellData=function(r){var n=this,e=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","increase","buy","sell","exchangerate","amplitude"];if(this.NetworkFilter){var t={Name:"JSStock::RequestBuySellData",Explain:"买卖盘数据",ID:ct.BUY_SELL_DATA,Request:{Url:n.RealtimeApiUrl,Data:{field:e,symbol:r},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(a){n.RecvData(a,ct.BUY_SELL_DATA)}),t.PreventDefault==!0)return}Me.default.ajax({url:this.RealtimeApiUrl,data:{field:e,symbol:r},type:"post",dataType:"json",async:!0,success:function(s){n.RecvData(s,ct.BUY_SELL_DATA)},error:function(s){n.RecvError(s,ct.BUY_SELL_DATA)}})},this.RequestDealData=function(r){var n=this,e=["name","symbol","price","high","low","vol","amount","date","time","increase","deal"];if(this.NetworkFilter){var t={Name:"JSStock::RequestDealData",Explain:"分笔数据",ID:ct.DEAL_DATA,Request:{Url:n.RealtimeApiUrl,Data:{field:e,symbol:r},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(a){n.RecvData(a,ct.DEAL_DATA)}),t.PreventDefault==!0)return}Me.default.ajax({url:this.RealtimeApiUrl,data:{field:e,symbol:r},type:"post",dataType:"json",async:!0,success:function(s){n.RecvData(s,ct.DEAL_DATA)},error:function(s){n.RecvError(s,ct.DEAL_DATA)}})},this.RequestIndexBaseData=function(r){var n=this,e=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","indextop","increase"];if(this.NetworkFilter){var t={Name:"JSStock::RequestIndexBaseData",Explain:"指数基础数据(包含上涨下跌家数)",ID:ct.INDEX_BASE_DATA,Request:{Url:n.RealtimeApiUrl,Data:{field:e,symbol:r},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(t,function(a){n.RecvData(a,ct.INDEX_BASE_DATA)}),t.PreventDefault==!0)return}Me.default.ajax({url:this.RealtimeApiUrl,data:{field:e,symbol:r},type:"post",dataType:"json",async:!0,success:function(s){console.log(s),n.RecvData(s,ct.INDEX_BASE_DATA)},error:function(s){n.RecvError(s,ct.INDEX_BASE_DATA)}})},this.RequestIndexHeatData=function(r){var n=this;Me.default.ajax({url:this.PlateQuadrantApiUrl,data:{plate:r},type:"post",dataType:"json",async:!0,success:function(t){n.RecvData(t,ct.HEAT_DATA)},error:function(t){n.RecvError(t,ct.HEAT_DATA)}})},this.ReqeustAllSortData=function(){var r=new Array,n=!0,e=!1,t=void 0;try{for(var a=(0,Ae.default)(this.MapStock),s;!(n=(s=a.next()).done);n=!0){var o=s.value;if($u(o[0])&&!(o[1].Sort==null||o[1].Sort.size<=0)){var h=!0,l=!1,u=void 0;try{for(var f=(0,Ae.default)(o[1].Sort),C;!(h=(C=f.next()).done);h=!0){var D=C.value,v=D[1],S={Plate:o[0],SortField:v.SortField,Order:v.Order,TagID:v.TagID};r.push(S)}}catch(I){l=!0,u=I}finally{try{!h&&f.return&&f.return()}finally{if(l)throw u}}}}}catch(I){e=!0,t=I}finally{try{!n&&a.return&&a.return()}finally{if(e)throw t}}for(var T in r){var D=r[T];this.ReqeustSortData(D)}},this.ReqeustSortData=function(r){var n=this,e=r,t="";switch(e.SortField){case it.INCREASE:t="increase";break;case it.PRICE:t="price";break;default:return}var a=["name","symbol","yclose","open","price","high","low","vol","amount","date","time","week","increase","exchangerate"];if(this.NetworkFilter){var s={Name:"JSStock::ReqeustSortData",Explain:"板块排序数据",ID:ct.SORT_DATA,Request:{Url:n.RealtimeApiUrl,Data:{field:a,plate:[r.Plate],orderfield:t,order:r.Order,ordernull:1,filterstop:1},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(o){n.RecvData(o,ct.SORT_DATA,e)}),s.PreventDefault==!0)return}Me.default.ajax({url:this.RealtimeApiUrl,data:{field:a,plate:[r.Plate],orderfield:t,order:r.Order,ordernull:1,filterstop:1},type:"post",dataType:"json",async:!0,success:function(h){n.RecvData(h,ct.SORT_DATA,e)},error:function(h){n.RecvError(h,ct.SORT_DATA,e)}})},this.RequestSubDocumentData=function(r,n){var e=this,t=new Pe.default([["flowday",{Field:"flowday",RecvID:ct.CAPITAL_FLOW_DAY_DATA}],["flowday3",{Field:"flowday3",RecvID:ct.CAPITAL_FLOW_DAY3_DATA}],["flowday5",{Field:"flowday5",RecvID:ct.CAPITAL_FLOW_DAY5_DATA}],["flowday10",{Field:"flowday10",RecvID:ct.CAPITAL_FLOW_DAY10_DATA}],["dde",{Field:"dde",RecvID:ct.DDE_DAY_DATA}],["dde3",{Field:"dde3",RecvID:ct.DDE_DAY3_DATA}],["dde5",{Field:"dde5",RecvID:ct.DDE_DAY5_DATA}],["dde10",{Field:"dde10",RecvID:ct.DDE_DAY10_DATA}]]);if(t.has(n)){var a=t.get(n);if(this.NetworkFilter){var s={Name:"JSStock::RequestSubDocumentData",Explain:"子文档数据",ID:a.RecvID,Request:{Url:e.RealtimeApiUrl,Data:{field:["symbol",a.Field],symbol:r,start:0,end:50},Type:"POST"},Self:this,PreventDefault:!1};if(this.NetworkFilter(s,function(o){e.RecvData(o,a.RecvID)}),s.PreventDefault==!0)return}Me.default.ajax({url:this.RealtimeApiUrl,data:{field:["symbol",a.Field],symbol:r,start:0,end:50},type:"post",dataType:"json",success:function(h){e.RecvData(h,a.RecvID)},error:function(h){e.RecvError(h,a.RecvID)}})}},this.RequestEventData=function(r){var n=this;Me.default.ajax({url:this.RealtimeApiUrl,data:{field:["symbol","events.margin","events.shhk","events.hk","events.st","events.hksymbol","events.hkname","events.szhk"],symbol:r,start:0,end:50},type:"POST",dataType:"json",success:function(t){n.RecvData(t,ct.EVENT_DATA)},error:function(t){n.RecvError(t,ct.EVENT_DATA)}})},this.RequestCompanyData=function(r){var n=this;Me.default.ajax({url:this.RealtimeApiUrl,data:{field:["name","symbol","company"],symbol:r,start:0,end:50},type:"POST",dataType:"json",success:function(t){n.RecvData(t,ct.COMPANY_DATA)},error:function(t){n.RecvError(t,ct.COMPANY_DATA)}})},this.RequestPlateData=function(r){var n=this;Me.default.ajax({url:this.RealtimeApiUrl,data:{field:["name","symbol","industry","region","concept"],symbol:r,start:0,end:50},type:"POST",dataType:"json",success:function(t){n.RecvData(t,ct.PLATE_DATA)},error:function(t){n.RecvError(t,ct.PLATE_DATA)}})},this.RecvError=function(r,n,e){console.log("RecvError: datatype="+n.toString()),console.log(r);var t=this;this.Timeout&&clearTimeout(this.Timeout),this.Timeout=setTimeout(function(){t.ReqeustData()},this.AutoUpateTimeout*2)},this.RecvData=function(r,n,e){var t;switch(n){case ct.BASE_DATA:case ct.INDEX_BASE_DATA:t=this.RecvBaseData(r,n);break;case ct.HEAT_DATA:t=this.RecvHeatData(r,n);break;case ct.SORT_DATA:t=this.RecvSortData(r,n,e);break;case ct.BUY_SELL_DATA:t=this.RecvBuySellData(r,n);break;case ct.DEAL_DATA:t=this.RecvDealData(r,n);break;case ct.DERIVATIVE_DATA:t=this.RecvDerivativeData(r,n);break;case ct.FINANCE_DATA:t=this.RecvFinanceData(r,n);break;case ct.CAPITAL_DATA:t=this.RecvCapitalData(r,n);break;case ct.CAPITAL_FLOW_DAY_DATA:case ct.CAPITAL_FLOW_DAY3_DATA:case ct.CAPITAL_FLOW_DAY5_DATA:case ct.CAPITAL_FLOW_DAY10_DATA:case ct.DDE_DAY_DATA:case ct.DDE_DAY3_DATA:case ct.DDE_DAY5_DATA:case ct.DDE_DAY10_DATA:t=this.RecvSubDocumentData(r,n);break;case ct.EVENT_DATA:t=this.RecvEventData(r,n);break;case ct.COMPANY_DATA:t=this.RecvCompanyData(r,n);break;case ct.PLATE_DATA:t=this.RecvPlateData(r,n);break}var a=!0,s=!1,o=void 0;try{for(var h=(0,Ae.default)(t),l;!(a=(l=h.next()).done);a=!0){var u=l.value;this.MapTagCallback.has(u[0])&&this.MapTagCallback.get(u[0])(u[0],u[1],n,this)}}catch(f){s=!0,o=f}finally{try{!a&&h.return&&h.return()}finally{if(s)throw o}}this.AutoUpdate()},this.ClearTimer=function(){this.Timeout&&(clearTimeout(this.Timeout),this.Timeout=null)},this.AutoUpdate=function(){if(this.ClearTimer(),!!this.IsAutoUpdate){var r=this,n=!1,e=!0,t=!1,a=void 0;try{for(var s=(0,Ae.default)(this.MapStock),o;!(e=(o=s.next()).done);e=!0){var h=o.value,l=sD.GetMarketStatus(h[0]);if(l==2){this.Timeout=setTimeout(function(){r.ReqeustData()},this.AutoUpateTimeout);return}else l==1&&(n=!0)}}catch(u){t=!0,a=u}finally{try{!e&&s.return&&s.return()}finally{if(t)throw a}}n&&(this.Timeout=setTimeout(function(){r.AutoUpdate()},this.AutoUpateTimeout))}},this.RecvBaseData=function(r,n){var e=new Pe.default;for(var t in r.stock){var a=r.stock[t],s=this.MapStock.get(a.symbol);if(s){switch(n){case ct.BASE_DATA:s.SetBaseData(a);break;case ct.INDEX_BASE_DATA:s.SetIndexBaseData(a);break;default:continue}if(s.TagID.size>0){var o=!0,h=!1,l=void 0;try{for(var u=(0,Ae.default)(s.TagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;e.has(C)?e.get(C).push(s.Symbol):e.set(C,new Array(s.Symbol))}}catch(D){h=!0,l=D}finally{try{!o&&u.return&&u.return()}finally{if(h)throw l}}}}}return e},this.RecvBuySellData=function(r,n){var e=new Pe.default;for(var t in r.stock){var a=r.stock[t],s=this.MapStock.get(a.symbol);if(s){if(s.SetBuySellData(a),s.TagID.size>0){var o=!0,h=!1,l=void 0;try{for(var u=(0,Ae.default)(s.TagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;e.has(C)?e.get(C).push(s.Symbol):e.set(C,new Array(s.Symbol))}}catch(F){h=!0,l=F}finally{try{!o&&u.return&&u.return()}finally{if(h)throw l}}}if(s.BuySellTagID.size>0){var D=!0,v=!1,S=void 0;try{for(var T=(0,Ae.default)(s.BuySellTagID),I;!(D=(I=T.next()).done);D=!0){var C=I.value;e.has(C)?e.get(C).push(s.Symbol):e.set(C,new Array(s.Symbol))}}catch(F){v=!0,S=F}finally{try{!D&&T.return&&T.return()}finally{if(v)throw S}}}}}return e},this.RecvDerivativeData=function(r,n){var e=new Pe.default;for(var t in r.stock){var a=r.stock[t],s=this.MapStock.get(a.symbol);if(s&&(s.SetDerivativeData(a),s.DerivativeTagID.size>0)){var o=!0,h=!1,l=void 0;try{for(var u=(0,Ae.default)(s.DerivativeTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;e.has(C)?e.get(C).push(s.Symbol):e.set(C,new Array(s.Symbol))}}catch(D){h=!0,l=D}finally{try{!o&&u.return&&u.return()}finally{if(h)throw l}}}}return e},this.RecvFinanceData=function(r,n){var e=new Pe.default;for(var t in r.stock){var a=r.stock[t],s=this.MapStock.get(a.symbol);if(s&&(s.SetFinanceData(a),s.FinanceTagID.size>0)){var o=!0,h=!1,l=void 0;try{for(var u=(0,Ae.default)(s.FinanceTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;e.has(C)?e.get(C).push(s.Symbol):e.set(C,new Array(s.Symbol))}}catch(D){h=!0,l=D}finally{try{!o&&u.return&&u.return()}finally{if(h)throw l}}}}return e},this.RecvCapitalData=function(r,n){var e=new Pe.default;for(var t in r.stock){var a=r.stock[t],s=this.MapStock.get(a.symbol);if(s&&(s.SetCapitalData(a),s.CapitalTagID.size>0)){var o=!0,h=!1,l=void 0;try{for(var u=(0,Ae.default)(s.CapitalTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;e.has(C)?e.get(C).push(s.Symbol):e.set(C,new Array(s.Symbol))}}catch(D){h=!0,l=D}finally{try{!o&&u.return&&u.return()}finally{if(h)throw l}}}}return e},this.RecvDealData=function(r,n){var e=new Pe.default;for(var t in r.stock){var a=r.stock[t],s=this.MapStock.get(a.symbol);if(s&&(s.SetDealData(a),s.DealTagID.size>0)){var o=!0,h=!1,l=void 0;try{for(var u=(0,Ae.default)(s.DealTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;e.has(C)?e.get(C).push(s.Symbol):e.set(C,new Array(s.Symbol))}}catch(D){h=!0,l=D}finally{try{!o&&u.return&&u.return()}finally{if(h)throw l}}}}return e},this.RecvHeatData=function(r,n){var e=new Pe.default;for(var t in r.data){var a=r.data[t],s=this.MapStock.get(a.symbol);if(s&&(s.SetHeatData(a),s.HeatTagID.size>0)){var o=!0,h=!1,l=void 0;try{for(var u=(0,Ae.default)(s.HeatTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;e.has(C)?e.get(C).push(s.Symbol):e.set(C,new Array(s.Symbol))}}catch(D){h=!0,l=D}finally{try{!o&&u.return&&u.return()}finally{if(h)throw l}}}}return e},this.RecvSortData=function(r,n,e){var t=new Pe.default,a=new Array,s=this.MapStock.get(e.Plate);for(var o in r.stock){var h=r.stock[o];if(a.push(h.symbol),this.MapStock.has(h.symbol)){var l=this.MapStock.get(h.symbol);l.SetBaseData(h)}else{var l=new jo(h.symbol);l.SetBaseData(h),this.MapStock.set(h.symbol,l)}}var u=e.SortField.toString()+"-"+e.Order.toString();if(!s.Sort.has(u))return t;var f=s.Sort.get(u);f.arySymbol=a;var C=!0,D=!1,v=void 0;try{for(var S=(0,Ae.default)(e.TagID),T;!(C=(T=S.next()).done);C=!0){var h=T.value;t.set(h,new Array([s.Symbol]))}}catch(I){D=!0,v=I}finally{try{!C&&S.return&&S.return()}finally{if(D)throw v}}return t},this.RecvSubDocumentData=function(r,n){var e=new Pe.default;for(var t in r.stock){var a=r.stock[t],s=this.MapStock.get(a.symbol);if(s){var o=null;switch(n){case ct.CAPITAL_FLOW_DAY_DATA:s.SetCapitalFlowDayData(a.flowday,n),o=s.CapitalFlowDayID;break;case ct.CAPITAL_FLOW_DAY3_DATA:s.SetCapitalFlowDayData(a.flowday3,n),o=s.CapitalFlowDay3ID;break;case ct.CAPITAL_FLOW_DAY5_DATA:s.SetCapitalFlowDayData(a.flowday5,n),o=s.CapitalFlowDay5ID;break;case ct.CAPITAL_FLOW_DAY10_DATA:s.SetCapitalFlowDayData(a.flowday10,n),o=s.CapitalFlowDay10ID;break;case ct.DDE_DAY_DATA:s.SetDDE(a.dde,n),o=s.DDEID;break;case ct.DDE_DAY3_DATA:s.SetDDE(a.dde3,n),o=s.DDE3ID;break;case ct.DDE_DAY5_DATA:s.SetDDE(a.dde5,n),o=s.DDE5ID;break;case ct.DDE_DAY10_DATA:s.SetDDE(a.dde10,n),o=s.DDE10ID;break}if(o&&o.size>0){var h=!0,l=!1,u=void 0;try{for(var f=(0,Ae.default)(o),C;!(h=(C=f.next()).done);h=!0){var D=C.value;e.has(D)?e.get(D).push(s.Symbol):e.set(D,new Array(s.Symbol))}}catch(v){l=!0,u=v}finally{try{!h&&f.return&&f.return()}finally{if(l)throw u}}}}}return e},this.RecvEventData=function(r,n){var e=new Pe.default;for(var t in r.stock){var a=r.stock[t],s=this.MapStock.get(a.symbol);if(s&&(s.SetEventData(a),s.EventTagID.size>0)){var o=!0,h=!1,l=void 0;try{for(var u=(0,Ae.default)(s.EventTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;e.has(C)?e.get(C).push(s.Symbol):e.set(C,new Array(s.Symbol))}}catch(D){h=!0,l=D}finally{try{!o&&u.return&&u.return()}finally{if(h)throw l}}}}return e},this.RecvCompanyData=function(r,n){var e=new Pe.default;for(var t in r.stock){var a=r.stock[t],s=this.MapStock.get(a.symbol);if(s&&(s.SetCompanyData(a),s.CompanyTagID.size>0)){var o=!0,h=!1,l=void 0;try{for(var u=(0,Ae.default)(s.CompanyTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;e.has(C)?e.get(C).push(s.Symbol):e.set(C,new Array(s.Symbol))}}catch(D){h=!0,l=D}finally{try{!o&&u.return&&u.return()}finally{if(h)throw l}}}}return e},this.RecvPlateData=function(r,n){var e=new Pe.default;for(var t in r.stock){var a=r.stock[t],s=this.MapStock.get(a.symbol);if(s&&(s.SetPlateData(a),s.PlateTagID.size>0)){var o=!0,h=!1,l=void 0;try{for(var u=(0,Ae.default)(s.PlateTagID),f;!(o=(f=u.next()).done);o=!0){var C=f.value;e.has(C)?e.get(C).push(s.Symbol):e.set(C,new Array(s.Symbol))}}catch(D){h=!0,l=D}finally{try{!o&&u.return&&u.return()}finally{if(h)throw l}}}}return e}}function ug(r){this.SearchStockApiUrl=ua.Domain+"/API/StockSpell",this.UpdateUICallback=r,this.PageSize=50,this.Count,this.EndOffset,this.Data=new Array,this.SearchString="",this.SearchType=0,this.Search=function(n,e){if(this.SearchString==n&&this.SearchType==e)typeof this.UpdateUICallback=="function"&&this.UpdateUICallback(this);else{this.SearchString=n,this.SearchType=e,this.Count=0,this.EndOffset=0,this.Data=[];var t=this.PageSize-1;this.ReqeustSearchStock(this.SearchString,this.SearchType,this.EndOffset,t)}},this.IsEndPage=function(){return this.Count<=0?!0:this.EndOffset>this.Count-1},this.NextPage=function(){if(!(this.EndOffset+1>this.Count)){var n=this.EndOffset+this.PageSize;this.ReqeustSearchStock(this.SearchString,this.SearchType,this.EndOffset,n)}},this.ReqeustSearchStock=function(n,e,t,a){var s=this;Me.default.ajax({url:this.SearchStockApiUrl,data:{input:n,start:t,end:a,type:e},type:"post",dataType:"json",async:!0,success:function(h){s.RecvSearchStockData(h,ct.SEARCH_STOCK_DATA)},error:function(h){s.RecvError(h,ct.SEARCH_STOCK_DATA)}})},this.RecvSearchStockData=function(n){for(var e in n.stock){var t=n.stock[e];this.Data.push({Name:t.name,Symbol:t.symbol,Type:t.type})}n.count==0?(this.Count=0,this.EndOffset=0):(this.Count==0&&(this.Count=n.count),this.EndOffset=n.end,this.Count>0&&this.EndOffset>this.Count&&(this.EndOffset=this.Count-1)),typeof this.UpdateUICallback=="function"&&this.UpdateUICallback(this)},this.RecvError=function(n,e){console.log("[SearchStock::RecvError] datatype="+e.toString()),console.log(n),typeof this.UpdateUICallback=="function"&&this.UpdateUICallback(this,"error")}}function Si(){this.IsAutoUpdate=!0,this.AutoUpateTimeout=5e3,this.Timeout,this.ApiUrl,this.Data,this.Error,this.UpdateUICallback,this.RequestData=function(){},this.Stop=function(){this.IsAutoUpdate=!1,this.Timeout&&clearTimeout(this.Timeout)},this.AutoUpate=function(){if(this.Timeout&&clearTimeout(this.Timeout),!!this.IsAutoUpdate&&(this.Timeout&&clearTimeout(this.Timeout),!!this.IsAutoUpdate)){var r=this;if(this.Symbol){var n=sD.GetMarketStatus(this.Symbol);n==2?this.Timeout=setTimeout(function(){r.RequestData()},this.AutoUpateTimeout):n==1&&(this.Timeout=setTimeout(function(){r.AutoUpdate()},this.AutoUpateTimeout))}else{var r=this,e=new Date,t=e.getHours()*100+e.getMinutes();e.getDay()>0&&e.getDay()<6&&t>=930&&t<1530&&(this.Timeout=setTimeout(function(){r.RequestData()},this.AutoUpateTimeout))}}},this.InvokeUpdateUICallback=function(){this.UpdateUICallback&&this.UpdateUICallback(this)}}function fg(r){this.newMethod=Si,this.newMethod(),delete this.newMethod,this.Symbol=r,this.ApiUrl=ua.Domain+"/API/StockShortTerm",this.Count=20,this.RequestData=function(){var n=this,e={count:this.Count};this.Symbol&&(e.symbol=this.Symbol),Me.default.ajax({url:this.ApiUrl,data:e,type:"post",dataType:"json",async:!0,success:function(a){n.RecvData(a,ct.SHORT_TERM_DATA)},fail:function(a){n.RecvError(a,ct.SHORT_TERM_DATA)}})},this.RecvData=function(n,e){this.Data=[];for(var t in n.shortterm){var a=n.shortterm[t];this.Data.push({Date:a.date,Name:a.name,Symbol:a.symbol,Time:a.time,Content:a.content,TypeInfo:a.typeinfo,Type:a.type})}this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()},this.RecvError=function(n,e){}}function Cg(r){this.newMethod=Si,this.newMethod(),delete this.newMethod,this.Symbol=r,this.Date,this.RequestData=function(){this.Data=null,this.Error=null;var n=this,e=ua.CacheDomain+"/cache/dealday/day/"+this.Date+"/"+this.Symbol+".json";console.log("[DealDay::RequestData] cache url ",e),Me.default.ajax({url:e,type:"get",dataType:"json",async:!0,success:function(a){n.RecvData(a,ct.DEAL_DAY_DATA)},error:function(a){n.RecvError(a,ct.DEAL_DAY_DATA)}})},this.RecvData=function(n,e){if(!n.day||!n.deal){this.InvokeUpdateUICallback();return}var t=n.deal.amount,a=n.deal.price,s=n.deal.time,o=n.deal.vol,h=n.deal.flag;if(!h||!o||!s||!a||!t){this.InvokeUpdateUICallback();return}for(var l={Date:n.date,Open:n.day.open,Close:n.day.price,YClose:n.day.yclose,Symbol:n.symbol,Name:n.name,Deal:[],PriceList:[]},u=new Pe.default,f=0,C=Math.min(s.length,o.length,h.length,a.length,t.length),D=0;D<C;++D){var v={Time:s[D],Vol:o[D],Flag:"",Price:a[D],Amount:t[D]};h[D]===0?v.Flag="B":h[D]===1&&(v.Flag="S"),v.Time>15e4&&(v.Time=15e4),l.Deal.push(v);var S;u.has(v.Price)?(S=u.get(v.Price),S.Vol+=v.Vol):(S={Vol:v.Vol,Price:v.Price,BuyVol:0,SellVol:0,NoneVol:0},u.set(v.Price,S)),h[D]===0?S.BuyVol+=v.Vol:h[D]===1?S.SellVol+=v.Vol:S.NoneVol+=v.Vol,f+=v.Vol}var T=!0,I=!1,F=void 0;try{for(var E=(0,Ae.default)(u),M;!(T=(M=E.next()).done);T=!0){var O=M.value,R=O[1];f>0&&(R.Proportion=R.Vol/f),l.PriceList.push(R)}}catch(b){I=!0,F=b}finally{try{!T&&E.return&&E.return()}finally{if(I)throw F}}l.PriceList.sort(function(b,p){return p.Price-b.Price}),this.Data=l,this.InvokeUpdateUICallback()},this.RecvError=function(n,e){console.log("[DealDay::RecvError] status="+n.status+" statusText="+n.statusText+" responseText="+n.responseText),this.Error={Status:n.status,Message:n.responseText},this.InvokeUpdateUICallback()}}function Dg(r){this.newMethod=Si,this.newMethod(),delete this.newMethod,this.ApiUrl=ua.Domain+"/API/StockBlockMember",this.PageSize=10,this.Start=0,this.OrderField,this.Order,this.Symbol=r,this.OrderNull=0,this.Field=new Array,this.Data=new Array,this.PageInfo,this.SetField=function(n){this.Field=new Array;for(var e in n){var t=n[e],a=qu.GetFieldName(t);a!=null&&this.Field.push(a)}return this.Field.length>0},this.SetOrder=function(n,e){this.Order=null,this.OrderField=null;var t=qu.GetFieldName(n);return t==null?!1:(this.OrderField=t,this.Order=e,!0)},this.RequestData=function(){this.Data=[];var n=this;Me.default.ajax({url:this.ApiUrl,data:{symbol:this.Symbol,field:this.Field,order:this.Order,orderfield:this.OrderField,start:this.Start,end:this.Start+this.PageSize,ordernull:this.OrderNull},type:"post",dataType:"json",success:function(t){n.RecvData(t,ct.BLOCK_MEMBER_DATA)},error:function(t){n.RecvError(t,ct.BLOCK_MEMBER_DATA)}})},this.RecvData=function(n,e){for(var t in n.stock){var a=n.stock[t];if(a.symbol!=null){var s=new jo(a.symbol);s.SetData(a),this.Data.push(s)}}this.PageInfo={Count:n.count,Start:n.start,End:n.end},typeof this.UpdateUICallback=="function"&&this.UpdateUICallback(this),this.AutoUpate()},this.RecvError=function(n,e){}}function vg(){this.newMethod=Si,this.newMethod(),delete this.newMethod,this.BlockType=1,this.Count=20,this.OrderField="increase",this.Order=-1,this.Field=["symbol","price","name","vol","increase","indextop","risefall"],this.ApiUrl=ua.Domain+"/API/StockBlockTop",this.SetField=function(r){},this.ReqeustData=function(){var r=this;Me.default.ajax({url:this.ApiUrl,data:{blocktype:this.BlockType,start:0,end:this.Count,field:this.Field,orderfield:this.OrderField,order:this.Order},type:"post",dataType:"json",async:!0,success:function(e){r.RecvData(e,ct.BLOCK_TOP_DATA)},fail:function(e){r.RecvError(e,ct.BLOCK_TOP_DATA)}})},this.RecvData=function(r,n){var e=r;this.Data=[],this.resCount=e.count;for(var t in e.stock){var a=e.stock[t];if(a.indextop!=null)var s={Down:a.indextop.down,Stop:a.indextop.stop,Up:a.indextop.up,Unchanged:a.indextop.unchanged,DownStock:{Name:a.indextop.downstock.name,Symbol:a.indextop.downstock.symbol},UpStock:{Name:a.indextop.upstock.name,Symbol:a.indextop.upstock.symbol}};this.Data.push({Name:a.name,Symbol:a.symbol,Increase:a.increase,Risefall:a.risefall,IndexTop:s})}this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()},this.RecvError=function(r,n){}}function cg(r){this.newMethod=Si,this.newMethod(),delete this.newMethod,this.ApiUrl=ua.Domain+"/API/StockMinuteImage",this.Symbol=[r],this.Data=[],this.RequestData=function(){this.Data=[];var n=this;Me.default.ajax({url:this.ApiUrl,data:{symbol:this.Symbol},type:"post",dataType:"json",success:function(t){n.RecvData(t,ct.IMAGE_MINUTE_DATA)},error:function(t){n.RecvError(t,ct.IMAGE_MINUTE_DATA)}})},this.RecvData=function(n,e){for(var t in n.symbol){var a={Symbol:n.symbol[t],Image:n.imagerelative[t]};this.Data.push(a)}typeof this.UpdateUICallback=="function"&&this.UpdateUICallback(this)},this.RecvError=function(n,e){}}function Sg(r){this.newMethod=Si,this.newMethod(),delete this.newMethod,this.Symbol=r,this.RequestData=function(){this.Data=null,this.Error=null;var n=this,e=ua.CacheDomain+"/cache/historyday/all/"+this.Symbol+".json";console.log("[HistoryDayData::RequestData] cache url ",e),Me.default.ajax({url:e,type:"get",dataType:"json",async:!0,success:function(a){n.RecvData(a,ct.HISTORY_DAY_DATA)},error:function(a){n.RecvError(a,ct.HISTORY_DAY_DATA)}})},this.RecvData=function(n,e){if(!n.symbol||!n.name){this.InvokeUpdateUICallback();return}var t=n.amount,a=n.close,s=n.date,o=n.high,h=n.low,l=n.open,u=n.vol,f=n.yclose;if(!t||!a||!s||!o||!h||!l||!u||!f){this.InvokeUpdateUICallback();return}for(var C={UpdateDate:n.update,Symbol:n.symbol,Name:n.name,KLine:[]},D=0;D<s.length;++D){var v={Date:s[D],YClose:f[D],Open:l[D],High:o[D],Low:h[D],Close:a[D],Vol:u[D],Amount:t[D]};C.KLine.push(v)}this.Data=C,this.InvokeUpdateUICallback()},this.RecvError=function(n,e){console.log("[HistoryDayData::RecvError] status="+n.status+" statusText="+n.statusText+" responseText="+n.responseText),this.Error={Status:n.status,Message:n.responseText},this.InvokeUpdateUICallback()},this.GetWeekData=function(){if(!this.Data||!this.Data.KLine)return[];var n=this.GetDayPeriodData(1);return n},this.GetMonthData=function(){if(!this.Data||!this.Data.KLine)return[];var n=this.GetDayPeriodData(2);return n},this.GetDayPeriodData=function(n){var e=new Array,t=0,a=null;for(var s in this.Data.KLine){var o=!1,h=this.Data.KLine[s];switch(n){case 1:var l=this.GetFirday(h.Date);l!=t&&(o=!0,t=l);break;case 2:parseInt(h.Date/100)!=parseInt(t/100)&&(o=!0,t=h.Date);break;case 3:parseInt(h.Date/1e4)!=parseInt(t/1e4)&&(o=!0,t=h.Date);break}if(o){if(a={},a.Date=h.Date,e.push(a),h.Open==null||h.Close==null)continue;a.Open=h.Open,a.High=h.High,a.Low=h.Low,a.YClose=h.YClose,a.Close=h.Close,a.Vol=h.Vol,a.Amount=h.Amount}else{if(a==null||h.Open==null||h.Close==null)continue;a.Open==null||a.Close==null?(a.Open=h.Open,a.High=h.High,a.Low=h.Low,a.YClose=h.YClose,a.Close=h.Close,a.Vol=h.Vol,a.Amount=h.Amount):(a.High<h.High&&(a.High=h.High),a.Low>h.Low&&(a.Low=h.Low),a.Close=h.Close,a.Vol+=h.Vol,a.Amount+=h.Amount,a.Date=h.Date)}}return e},this.GetFirday=function(n){var e=new Date(parseInt(n/1e4),n/100%100-1,n%100),t=e.getDay();if(t==5)return n;var a=e.getTime();if(t<5){var s=864e5*(5-t);a+=s}else{var s=864e5*(t-5);a-=s}e.setTime(a);var o=e.getFullYear()*1e4+(e.getMonth()+1)*100+e.getDate();return e.getDay(),o}}function Tg(r){this.newMethod=Si,this.newMethod(),delete this.newMethod,this.Symbol=r,this.ApiUrl=ua.Domain+"/API/StockPriceList",this.RequestData=function(){if(this.Symbol){var n=this,e={};Array.isArray(this.Symbol)?e.Symbol=this.Symbol:e.Symbol=[this.Symbol],Me.default.ajax({url:this.ApiUrl,data:e,type:"post",dataType:"json",async:!0,success:function(a){n.RecvData(a,ct.DEAL_PRICE_LIST_DATA)},fail:function(a){n.RecvError(a,ct.DEAL_PRICE_LIST_DATA)}})}},this.RecvData=function(n,e){if(this.Data=null,!(n.statistics.length<=0)){this.Data={Day:{},PriceList:[]};var t=n.data[0];this.Data.Day={Date:t.date,YClose:t.yclose,Price:t.price,Vol:t.vol,Time:t.time},this.Data.Stock={Symbol:t.symbol,Name:t.name};var a=n.statistics[0];for(var s in a.list){var o=a.list[s],h={Price:o[0],Vol:o[1],BuyVol:o[2],SellVol:o[3],NoneVol:o[4]};t.vol>0&&(h.Proportion=h.Vol/t.vol),this.Data.PriceList.push(h)}this.UpdateUICallback&&this.UpdateUICallback(this),this.AutoUpate()}},this.RecvError=function(n,e){}}function dg(r){this.newMethod=Si,this.newMethod(),delete this.newMethod,this.IsAutoUpdate=!1,this.Symbol=r,this.PageSize=20,this.Request=function(n,e){this.Error=null;var t=this,a=n*e,s=a+e,o=ua.Domain+"/API/StockDetail";console.log("[LatestDetailData::RequestData] url="+o+", start="+a+" , end="+s),Me.default.ajax({url:o,data:{symbol:this.Symbol,start:a,end:s},type:"post",dataType:"json",async:!0,success:function(l){t.RecvData(l,ct.LATEST_DETAIL_DATA)},error:function(l){t.RecvError(l,ct.LATEST_DETAIL_DATA)}})},this.RequestData=function(){this.Data={Deal:[],Count:0,Reqeust:{PageIndex:0},Response:{}},this.Request(0,this.PageSize)},this.RequestPage=function(n){this.Data||(this.Data={Deal:[],Count:0}),this.Data.Reqeust={PageIndex:n},this.Data.Response={};for(var e=n*this.PageSize,t=e+this.PageSize,a=!0,s=e;s<t;++s)if(!this.Data.Deal[s]){a=!1;break}a?(this.Data.Response={Start:e,End:t},this.InvokeUpdateUICallback()):this.Request(n,this.PageSize)},this.RecvData=function(n,e){if(this.Data.Count=n.count,!n.detail){this.InvokeUpdateUICallback();return}this.Data.Day={YClose:n.yclose,Open:n.open,Close:n.price,Date:n.date},this.Data.Stock={Symbol:n.symbol,Name:n.name};for(var t=n.start,a=0,s=t;a<n.detail.length;++a,++s){var o=n.detail[a],h={Time:o[0],Price:o[1],Vol:o[2],Amount:o[3],Flag:""};o[4]===0?h.Flag="B":o[4]===1&&(h.Flag="S"),this.Data.Deal[s]=h}this.Data.Response={Start:n.start,End:n.end},this.InvokeUpdateUICallback()},this.RecvError=function(n,e){console.log("[LatestDetailData::RecvError] status="+n.status+" statusText="+n.statusText+" responseText="+n.responseText),this.Error={Status:n.status,Message:n.responseText},this.InvokeUpdateUICallback()}}function mg(){this.newMethod=Si,this.newMethod(),delete this.newMethod,this.ApiUrl=ua.Domain+"/api/StockListAnalyze",this.PolicyGuid,this.Plate="",this.SymbolList=[],this.RequestData=function(){var r=this;Me.default.ajax({url:r.ApiUrl,data:{PolicyGuid:r.PolicyGuid,Plate:r.Plate,Symbol:r.SymbolList},type:"post",dataType:"json",async:!0,success:function(e){r.RecvData(e)},error:function(e){r.RecvError(e)}})},this.RecvData=function(r){this.Data={};var n=r;if(n.count!=0){if(n.concept){var e=[];for(var t in n.concept.data){var a=n.concept.data[t],s={};s.Name=a[0],s.Symbol=a[1],s.Ratio=a[2],s.Count=a[3],s.Increase=a[4],s.Price=a[5],s.Week1=a[6],s.Week4=a[7],e.push(s)}this.Data.Concept=e}n.distributed&&(this.Data.Distributed=n.distributed),n.industry&&(this.Data.Industry=n.industry),n.quadrant&&(this.Data.Quadrant=n.quadrant),n.region&&(this.Data.Region=n.region),this.UpdateUICallback&&this.UpdateUICallback(this)}},this.RecvError=function(r){console.log(r)}}var sD={SH:".SH",SZ:".SZ",HK:".HK",SHFE:".SHF",CFFEX:".CFE",DCE:".DCE",CZCE:".CZC",USA:".USA",IsUSA:function(n){return n?n.indexOf(this.USA)>0:!1},IsSH:function(n){var e=n.length-this.SH.length,t=n.indexOf(this.SH);return t==e},IsSZ:function(n){var e=n.length-this.SZ.length,t=n.indexOf(this.SZ);return t==e},IsHK:function(n){var e=n.length-this.HK.length,t=n.indexOf(this.HK);return t==e},IsSHFE:function(n){return n.indexOf(this.SHFE)>0},IsCFFEX:function(n){return n.indexOf(this.CFFEX)>0},IsDCE:function(n){return n.indexOf(this.DCE)>0},IsCZCE:function(n){return n.indexOf(this.CZCE)>0},IsChinaFutures:function(n){return this.IsCFFEX(n)||this.IsCZCE(n)||this.IsDCE(n)||this.IsSHFE(n)},IsSHSZ:function(n){return this.IsSZ(n)||this.IsSH(n)},IsSHSZFund:function(n){if(!n)return!1;if(this.IsSH(n)){if(n.charAt(0)=="5"&&n.charAt(1)=="1")return!0}else if(this.IsSZ(n)&&n.charAt(0)=="1"&&(n.charAt(1)=="5"||n.charAt(1)=="6"||n.charAt(1)=="7"||n.charAt(1)=="8"))return!0;return!1},IsSHSZIndex:function(n){if(!n)return!1;var e=n.toUpperCase();if(this.IsSH(e)){var t=e.replace(".SH","");if(e.charAt(0)=="0"&&parseInt(t)<=3e3)return!0}else if(this.IsSZ(e)){if(e.charAt(0)=="3"&&e.charAt(1)=="9")return!0}else if(e.indexOf(".CI")>0)return!0;return!1},IsSHSZStockA:function(n){if(!n)return!1;var e=n.toUpperCase();if(this.IsSH(e)){if(e.replace(".SH",""),e.charAt(0)=="6")return!0}else if(this.IsSZ(e)&&e.charAt(0)=="0"&&(e.charAt(1)=="0"&&e.charAt(1)=="2"||e.charAt(1)!="7"&&e.charAt(1)!="8"))return!0;return!1},IsSHStockSTAR:function(n){if(!n)return!1;var e=n.toUpperCase();return this.IsSH(e)?e.charAt(0)=="6"&&e.charAt(1)=="8"&&e.charAt(2)=="8":!1},GetMarketStatus:function(n){if(!n)return 0;var e=n.toUpperCase();if(this.IsUSA(e)){var t=GetLocalTime(-4);return s=t.getDay(),o=t.getHours()*100+t.getMinutes(),s==6||s==0?0:o>1730?3:o<930?1:2}else{var a=new Date,s=a.getDay(),o=a.getHours()*100+a.getMinutes();return s==6||s==0?0:o>1540?3:o<925?1:2}}};qh.default=(_n={JSStockInit:ra.Init,STOCK_FIELD_NAME:it,JSStock:ra,StockRead:nD},(0,Qu.default)(_n,"STOCK_FIELD_NAME",it),(0,Qu.default)(_n,"RECV_DATA_TYPE",ct),_n);var jh={};Object.defineProperty(jh,"__esModule",{value:!0});var Ig=Ah,ju=gg(Ig);function gg(r){return r&&r.__esModule?r:{default:r}}function tl(){this.HistoryData,this.BuyData,this.SellData,this.IndexClose,this.NetCalculateModel=0,this.InitialCapital=1e4,this.Data=new ju.default,this.SetPolicyData=function(r){this.HistoryData=r.KLineData,this.BuyData=r.BuyData,this.SellData=r.SellData,r.IndexClose&&(this.IndexClose=r.IndexClose)},this.ClearData=function(){this.Data=new ju.default},this.GetBSData=function(r){for(var n=null,e=0;e<this.HistoryData.length;++e){var t=this.HistoryData[e];if(t.Date>=r){n=e;break}}if(n===null)return null;console.log("[RegressionTest::GetBSData] startDate="+r+" index="+n);for(var a=[],s=null,e=n;e<this.HistoryData.length;++e){var o=this.BuyData[e],h=this.SellData[e],l=this.HistoryData[e];if(s===null){if(o>0){var u={Data:l,Count:0};e+1<this.HistoryData.length&&(u.NextOpen=this.HistoryData[e+1].Open),s={B:[u],S:null}}}else{for(var f in s.B)++s.B[f].Count;if(o>0){var u={Data:l,Count:0};e+1<this.HistoryData.length&&(u.NextOpen=this.HistoryData[e+1].Open),s.B.push(u)}else h>0&&(s.S={Data:l},a.push(s),s=null)}}var C={StartDate:this.HistoryData[n].Date,StartIndex:n,Count:this.HistoryData.length-n,BSData:a};return console.log("[RegressionTest::GetBSData] data",C),C},this.Calculate=function(r){var n={Count:r.Count,Max:null,Min:null,Average:null},e={Count:0,Days:0,Success:0,Fail:0,SuccessRate:0};for(var t in r.BSData){var a=r.BSData[t];for(var s in a.B){var o=a.B[s];(n.Max===null||n.Max<o.Count)&&(n.Max=o.Count),(n.Min===null||n.Min>o.Count)&&(n.Min=o.Count),++e.Count,e.Days+=o.Count,a.S.Data.Close>o.Data.Open?++e.Success:++e.Fail}}e.Count>0&&(n.Average=e.Days/e.Count,e.SuccessRate=e.Success/e.Count);var h=1,l;for(var t in r.BSData){var a=r.BSData[t];this.NetCalculateModel===1&&a.B[0].NextOpen>0?l=a.B[0].NextOpen:l=a.B[0].Data.Open;var u=a.S.Data.Close,f=(u-l)/l+1;h*=f}h-=1;var C=this.HistoryData[r.StartIndex].Close,D=this.HistoryData[this.HistoryData.length-1].Close,v=(D-C)/C;console.log("[RegressionTest::Calculate] stock profit first["+this.HistoryData[r.StartIndex].Date+", YClose="+this.HistoryData[r.StartIndex].YClose+"] end["+this.HistoryData[this.HistoryData.length-1].Date+", Close="+this.HistoryData[this.HistoryData.length-1].Close+"]");var S=this.CaclulateNetValue(r),T=null,I=null;S&&S.length>0&&(T=this.CaclulateMaxDropdown(S),this.IndexClose&&(I=this.CaclulateBeta(S)));var F={Day:n,Trade:e,Profit:h,StockProfit:v,Excess:h-v,NetValue:S,MaxDropdown:T,Beta:I,BSDataPair:r.BSData};return console.log("[RegressionTest::Calculate] NetCalculateModel, result ",this.NetCalculateModel,F),F},this.CaclulateNetValue=function(r){for(var n=r.StartIndex,e=[],t={Position:0,Cache:this.InitialCapital},a=null,s,o=n;o<this.HistoryData.length;++o){var h=this.BuyData[o],l=this.SellData[o],u=this.HistoryData[o],f={Date:u.Date,Position:t.Position,Cache:t.Cache,Open:u.Open,Close:u.Close};if(f.MarketValue=f.Position*f.Close+f.Cache,a===null){if(h>0){a={B:{Data:u},S:null},this.NetCalculateModel===1&&o+1<this.HistoryData.length&&this.HistoryData[o+1].Open>0?s=this.HistoryData[o+1].Open:s=f.Open;var C=parseInt(f.Cache/s),D=f.Cache-s*C;f.Position=C,f.Cache=D,f.MarketValue=f.Position*f.Close+f.Cache}}else if(l>0){a.S={Data:u},a=null;var v=f.Position*f.Close;f.Position=0,f.Cache+=v,f.MarketValue=f.Position*f.Close+f.Cache}t.Position=f.Position,t.Cache=f.Cache,f.Net=f.MarketValue/this.InitialCapital,this.IndexClose&&(f.IndexClose=this.IndexClose[o]),e.push(f)}if(e.length<=0)return[];for(var S=[],o=0;o<e.length;++o){var T=e[o],I={Net:T.Net,Date:T.Date,Close:T.Close};T.IndexClose&&(I.IndexClose=T.IndexClose),S.push(I)}return S},this.CaclulateMaxDropdown=function(r){for(var n=r[0].Net,e=0,t,a=1;a<r.length;++a){var s=r[a],o=1-s.Net/n;e<o&&(e=o,t=s),n<s.Net&&(n=s.Net)}return console.log("[RegressionTest::CaclulateMaxDropdown] maxDay",t),e},this.CaclulateBeta=function(r){for(var n=r[0],e=[],t=[],a=0,s=0,o=1;o<r.length;++o){e[o-1]=0,t[o-1]=0;var h=r[o];h.IndexClose>0&&n.IndexClose>0&&(e[o-1]=(h.IndexClose-n.IndexClose)/n.IndexClose),h.Net>0&&n.Net>0&&(t[o-1]=(h.Net-n.Net)/n.Net),a+=e[o-1],s+=t[o-1],n=h}for(var l=a/e.length,u=s/t.length,f=0,o=0;o<e.length;++o)f+=(t[o]-u)*(e[o]-l);for(var C=0,o=0;o<e.length;++o)C+=(e[o]-l)*(e[o]-l);return f/C},this.Execute=function(r){for(var n in r){var e=r[n];if(this.Data.has(e.Name)){console.log("[RegressionTest::Execute] id="+n+" Name="+e.Name+" Date:"+e.Date+" is exsit.");continue}console.log("[RegressionTest::Execute] id="+n+" Name="+e.Name+" Date:"+e.Date);var t=this.GetBSData(e.Date),a=this.Calculate(t);this.Data.set(e.Name,a)}}}tl.CaclulateOverlayData=function(r){if(!r.Main||!r.Sub)return null;var n=r.Main.length;for(var e in r.Sub){var t=r.Sub[e];if(t.length!=n)return console.log("[RegressionTest::OverlayData] id="+e+" data count not match. MainData count="+n),null}var a=[],s={Sub:[]};s.Main=r.Main[0],a.push([]);for(var e=0;e<r.Sub.length;++e){var o=r.Sub[e];s.Sub[e]=o[0],a.push([])}for(var e=0;e<r.Main.length;++e){var h=r.Main[e],l=(h-s.Main)/s.Main;a[0][e]=l;for(var u=0;u<r.Sub.length;++u){var o=r.Sub[u],f=o[e],C=(f-s.Sub[u])/s.Sub[u];a[u+1][e]=C}}return a};tl.GetPolicyData=function(r){var n={KLineData:null,IndexClose:null,BuyData:null,SellData:null};n.KLineData=r.HistoryData.Data;for(var e in r.OutVar){var t=r.OutVar[e];t.Name=="INDEXCLOSE"?n.IndexClose=t.Data:t.Name=="DRAWICON"&&t.Draw&&t.Draw.Icon&&(t.Draw.Icon.ID===13?n.BuyData=t.Draw.DrawData:t.Draw.Icon.ID===14&&(n.SellData=t.Draw.DrawData))}return n.KLineData&&n.BuyData&&n.SellData?n:null};jh.default={RegressionTest:tl};Zr.Chart=th.default;Zr.Stock=qh.default;Zr.RegressionTest=jh.default;const Ca=r=>(av("data-v-5836b379"),r=r(),iv(),r),pg={class:"chanrt-box"},Fg=Ca(()=>Ot("span",null,"sh",-1)),Eg=Ca(()=>Ot("img",{class:"refresh",src:rv,alt:""},null,-1)),xg={style:{width:"80px",height:"20px"}},Lg={id:"app2"},Mg={id:"minuteChart",ref:"minute"},Ag={id:"kline",ref:"kline"},Ng={class:"flexStart stati-box"},Og={class:"stati-list"},Rg=Ca(()=>Ot("p",null,"最高",-1)),yg={class:"stati-list"},Pg=Ca(()=>Ot("p",null,"最低",-1)),wg={class:"stati-list"},Bg=Ca(()=>Ot("p",null,"涨停",-1)),bg={class:"stati-list"},Gg=Ca(()=>Ot("p",null,"跌停",-1)),Vg={class:"stati-list"},Hg=Ca(()=>Ot("p",null,"今开",-1)),Yg={class:"stati-list"},kg=Ca(()=>Ot("p",null,"昨收",-1)),Xg={class:"stati-list"},Wg=Ca(()=>Ot("p",null,"振幅",-1)),_g={class:"stati-list"},Ug=Ca(()=>Ot("p",null,"换手率",-1)),Kg={class:"stati-list"},Jg=Ca(()=>Ot("p",null,"成交量",-1)),zg={class:"stati-list"},Zg=Ca(()=>Ot("p",null,"成交额",-1)),Qg={class:"stati-list"},$g=Ca(()=>Ot("p",null,"市盈率",-1)),qg={class:"stati-list"},jg=Ca(()=>Ot("p",null,"市净率",-1)),tp={class:"flexBetween trading-box"},ep={key:0,src:nv,alt:""},ap={key:1,src:sv,alt:""},ip=Ca(()=>Ot("p",null,"自选",-1)),rp={__name:"ChanrtPage",setup(r){const n=zD(),e=ZD();function t(){}const a=ta({Name:"1分钟",Value:4}),s=ta(!0),o=ta(0),h=ta("分时"),l=ta("300466"),u=ta(""),f=ta(!1),C=ta(),D=ta([{Name:"1分钟",Value:4},{Name:"5分钟",Value:5},{Name:"15分钟",Value:6},{Name:"30分钟",Value:7},{Name:"60分钟",Value:8}]),v=ta([{Name:"分时",Value:1},{Name:"五日",Value:5},{Name:"日线",Value:0},{Name:"周线",Value:1},{Name:"月线",Value:2}]);QD(()=>a.value,(St,Mt)=>{p(a.value.Name,a.value.Value)}),t.GetKlineOption=function(St){return{Type:"历史K线图",Windows:[{Index:"均线",Modify:!1,Change:!1},{Index:"VOL",Modify:!1,Change:!1,IsDrawTitleBG:!0},{Index:"MACD",Modify:!1,Change:!1,IsDrawTitleBG:!0}],Symbol:St,IsAutoUpate:!0,IsShowRightMenu:!1,KLine:{DragMode:3,Right:1,Period:0,MaxReqeustDataCount:1e3,MaxRequestMinuteDayCount:15,PageSize:50,IsShowTooltip:!1},KLineTitle:{IsShowName:!1,IsShowSettingInfo:!1},Border:{Left:20,Right:20,Top:1,Bottom:1},Frame:[{SplitCount:3,IsShowLeftText:!1,IsShowRightText:!0,Custom:[{Type:0,Position:"left"}]},{SplitCount:2,StringFormat:0},{SplitCount:2,StringFormat:0}]}},t.GetMinuteOption=function(St){return{Type:"分钟走势图",Symbol:St,IsAutoUpate:!0,IsShowRightMenu:!1,IsShowCorssCursorInfo:!1,DayCount:1,Border:{Left:1,Right:1,Top:25,Bottom:25},KLineTitle:{IsShowName:!1,IsShowSettingInfo:!1},Frame:[{SplitCount:5,StringFormat:0},{SplitCount:3,StringFormat:0}]}},t.GetPeriodData=function(St){const Mt=new Map([["分时",{Value:1,KLineShow:!1,MinuteShow:!0}],["五日",{Value:5,KLineShow:!1,MinuteShow:!0}],["日线",{Value:0,KLineShow:!0,MinuteShow:!1}],["周线",{Value:1,KLineShow:!0,MinuteShow:!1}],["月线",{Value:2,KLineShow:!0,MinuteShow:!1}],["年线",{Value:3,KLineShow:!0,MinuteShow:!1}],["1分钟",{Value:4,KLineShow:!0,MinuteShow:!1}],["5分钟",{Value:5,KLineShow:!0,MinuteShow:!1}],["15分钟",{Value:6,KLineShow:!0,MinuteShow:!1}],["30分钟",{Value:7,KLineShow:!0,MinuteShow:!1}],["60分钟",{Value:8,KLineShow:!0,MinuteShow:!1}]]);return Mt.has(St)?Mt.get(St):null};const S=ta({JSChart:null,IsShow:!0,Option:t.GetMinuteOption(l.value)}),T=ta({JSChart:null,IsShow:!1,Option:t.GetKlineOption(l.value)}),I=ta(),F=ta();$D(()=>{u.value=e.query.title,l.value=e.query.code,e.query.prefix?I.value=e.query.prefix+"."+l.value:I.value=l.value,O(),p(h.value,o.value),pe.dispatch("market/getStockInfo",I.value),pe.dispatch("watchlist/get",I.value),pe.state.watchlist.status&&(s.value=!0)});let E=ta(),M=ta();const O=()=>{var St=354,Mt=window.innerWidth;E.value=document.getElementById("kline"),E.value.style.width=Mt+"px",E.value.style.height=St+"px",M.value=document.getElementById("minuteChart"),M.value.style.width=Mt+"px",M.value.style.height=St+"px"},R=()=>{if(S.value.JSChart)return;S.value.Option.Symbol=l.value;let St=Zr.Chart.JSChart.Init(M.value);S.value.Option.NetworkFilter=(Mt,Pt)=>{lt(Mt,Pt)},St.SetOption(S.value.Option),S.value.JSChart=St},b=()=>{if(T.value.JSChart)return;T.value.Option.Symbol=l.value;let St=Zr.Chart.JSChart.Init(E.value);T.value.Option.NetworkFilter=(Mt,Pt)=>{Q(Mt,Pt)},St.SetOption(T.value.Option),T.value.JSChart=St},p=(St,Mt)=>{var Pt=t.GetPeriodData(St);Pt&&(Pt.KLineShow&&Y(Pt.Value),T.value.IsShow=Pt.KLineShow,Pt.MinuteShow&&G(Pt.Value),S.value.IsShow=Pt.MinuteShow)},G=St=>{S.value.JSChart?(O(),S.value.JSChart.OnSize(),S.value.JSChart.ChangeDayCount(St)):(S.value.Option.DayCount=St,R())},Y=St=>{T.value.JSChart?T.value.JSChart.ChangePeriod(St):(T.value.Option.KLine.Period=St,b())},Q=(St,Mt)=>{switch(St.Name){case"KLineChartContainer::ReqeustHistoryMinuteData":ht(St,Mt,{PageSize:50});break;case"KLineChartContainer::RequestHistoryData":ye(St,Mt);break}},ht=(St,Mt,Pt)=>{On.post("market/stock",{symbol:I.value}).then(Et=>{let Fe={code:0,data:Ct(Et.items)};Fe.symbol=Et.code+".sh",Fe.name=Et.name,St.Self.PageSize=Pt.PageSize,Mt(Fe)})},Ct=St=>{let Mt=[];return St.forEach(function(Pt){let Et=Pt.split(","),[ee,Fe]=Et[0].split(" "),De=ee.replace(/-/g,""),Da=Fe.replace(/:/g,"");Mt.push([parseInt(Da),parseFloat(Et[1]),parseFloat(Et[3]),parseFloat(Et[4]),parseFloat(Et[1]),parseInt(Et[5]),parseInt(Et[6]),parseFloat(Et[4]),parseInt(De)])}),Mt},lt=(St,Mt)=>{switch(St.Name){case"MinuteChartContainer::RequestMinuteData":Ut(St,Mt);break;case"MinuteChartContainer::RequestHistoryMinuteData":dt(St,Mt);break}},dt=(St,Mt,Pt)=>{On.post("market/fiveStock",{symbol:I.value}).then(Et=>{let ee=Wt(Et,Et.prePrice),Fe={symbol:Et.code+".sh",name:Et.name,data:ee,code:0};Mt(Fe)})},Ut=(St,Mt,Pt)=>{On.post("market/stock",{symbol:I.value}).then(Et=>{let ee=Qt(Et,Et.prePrice),Fe={stock:[{symbol:Et.code+".sh",minute:ee,name:Et.name,yclose:Et.prePrice,date:Et.date.split("-").join("")}],code:0};F.value=Et.date,sa(),Mt(Fe)})},Wt=(St,Mt)=>{let Pt=[];return St.items.forEach(function(Et){Et.date=Et.date.replace(/-/g,""),Et.yClose=Mt;let ee=[];Et.minute.forEach(function(Fe){let De=Fe.split(","),[Da,Va]=De[0].split(" "),Ha=Da.replace(/-/g,""),oa=Va.replace(/:/g,"");ee.push([parseInt(oa),parseFloat(De[1]),parseFloat(De[3]),parseFloat(De[4]),parseFloat(De[1]),parseInt(De[5]),parseInt(De[6]),parseFloat(De[4]),parseInt(Ha)]),Mt=parseFloat(De[2])}),Et.minute=ee,Pt.push(Et)}),Pt},Qt=(St,Mt)=>{let Pt=[];return St.items.forEach(function(Et){let ee=Et.split(","),[Fe,De]=ee[0].split(" "),Da=Fe.replace(/-/g,""),Va=De.replace(/:/g,"");Pt.push({date:parseInt(Da),time:parseInt(Va),open:parseFloat(ee[1]),high:parseFloat(ee[3]),low:parseFloat(ee[4]),price:parseFloat(ee[1]),vol:parseInt(ee[5]),amount:parseInt(ee[6]),avprice:parseFloat(ee[4])})}),Pt},ye=(St,Mt)=>{console.log("prefix_symbol.value",I.value),On.post("market/dayKLine",{symbol:I.value}).then(Pt=>{let Et={};Et.name=Pt.name,Et.symbol=Pt.code,Ne(Pt,Mt,Et)})},Ne=(St,Mt,Pt)=>{let Et=[],ee=null;St.items.forEach(function(Fe){let De=Fe.split(",");Et.push([De[0].split("-").join(""),ee,parseFloat(De[1]),parseFloat(De[3]),parseFloat(De[4]),parseFloat(De[2]),parseFloat(De[7]),parseFloat(De[8])]),ee=parseFloat(De[2])}),Pt.code=0,Pt.data=Et,Mt(Pt)},Kt=St=>{if(St<0)return"green";if(St===0||St==="")return"black";if(St>0)return"red"},Oe=St=>(St/1e4).toFixed(2)+"万",Ce=St=>(St/1e9).toFixed(2)+"亿",na=()=>{pe.getters.token||(pe.dispatch("snackbar/warning",{active:!0,body:"请现登录！"}),n.push("Login")),pe.dispatch("watchlist/push",{code:parseFloat(I.value),name:u.value,price:pe.state.market.stock_info.price,percentage:pe.state.market.stock_info.e}).then(St=>{let Mt=pe.state.watchlist.status?0:1;pe.dispatch("watchlist/updateStatus",Mt),Mt?pe.dispatch("snackbar/success",{active:!0,body:"关注成功！"}):pe.dispatch("snackbar/success",{active:!0,body:"已取消关注！"})})},sa=()=>{let St=new Date().toLocaleDateString("zh-CN",{timeZone:"Asia/Shanghai",year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-");new Date().toLocaleString("zh-CN",{timeZone:"Asia/Shanghai",hour12:!1,timeStyle:"short"}),(St!=F.value||pa()==!1)&&(f.value=!0,C.value=F.value)},pa=()=>{let St=new Date(new Date().toLocaleString("zh-CN",{timeZone:"Asia/Shanghai",hour12:!1})),Mt=new Date(St);Mt.setHours(9,30,0,0);let Pt=new Date(St);Pt.setHours(11,30,0,0);let Et=new Date(St);Et.setHours(13,0,0,0);let ee=new Date(St);return ee.setHours(15,0,0,0),St>Mt&&St<Pt||St>Et&&St<ee},Fa=(St,Mt,Pt,Et)=>{console.log(Mt,Pt,Et),n.push({path:St,query:{code:Pt,title:Mt,prefix:Et}})};return(St,Mt)=>(Wr(),An("div",pg,[Us(hv,null,{headerCenter:Nn(()=>[Ot("h2",null,[Fg,zs(" "+He(u.value)+"（"+He(l.value)+"）",1)]),Ks(Ot("p",null,[zs("休市中 "),Ot("span",null,He(C.value),1)],512),[[Js,f.value]])]),headerRight:Nn(()=>[Eg]),_:1}),Ot("div",{class:qD(["flexCenter argument-box","text-"+Kt(Ke(pe).state.market.stock_info.l)])},[Ot("h2",null,He(Ke(pe).state.market.stock_info.price),1),Ot("div",null,[Ot("p",null,He(Ke(pe).state.market.stock_info.l),1),Ot("p",null,He(Ke(pe).state.market.stock_info.e+"%"),1)])],2),Us(uv,{grow:"",modelValue:St.model,"onUpdate:modelValue":Mt[1]||(Mt[1]=Pt=>St.model=Pt)},{default:Nn(()=>[(Wr(!0),An(jD,null,tv(v.value,(Pt,Et)=>(Wr(),ev(fv,{onClick:ee=>p(Pt.Name,Et),key:Et},{default:Nn(()=>[zs(He(Pt.Name),1)]),_:2},1032,["onClick"]))),128)),Ot("div",xg,[Us(Cv,{modelValue:a.value,"onUpdate:modelValue":Mt[0]||(Mt[0]=Pt=>a.value=Pt),hint:`${a.value.Name}, ${a.value.Value}`,items:D.value,"item-title":"Name","item-value":"Value",label:"Select","persistent-hint":"","return-object":"","single-line":"",density:"compact","hide-details":"","loader-height":"5",height:"auto"},null,8,["modelValue","hint","items"])])]),_:1},8,["modelValue"]),Ot("div",Lg,[Ks(Ot("div",Mg,null,512),[[Js,S.value.IsShow]]),Ks(Ot("div",Ag,null,512),[[Js,T.value.IsShow]])]),Ot("div",Ng,[Ot("div",Og,[Rg,Ot("span",null,He(Ke(pe).state.market.stock_info.high),1)]),Ot("div",yg,[Pg,Ot("span",null,He(Ke(pe).state.market.stock_info.low),1)]),Ot("div",wg,[Bg,Ot("span",null,He(Ke(pe).state.market.stock_info.zhangting),1)]),Ot("div",bg,[Gg,Ot("span",null,He(Ke(pe).state.market.stock_info.dieting),1)]),Ot("div",Vg,[Hg,Ot("span",null,He(Ke(pe).state.market.stock_info.jinkai),1)]),Ot("div",Yg,[kg,Ot("span",null,He(Ke(pe).state.market.stock_info.zuoshou),1)]),Ot("div",Xg,[Wg,Ot("span",null,He(Ke(pe).state.market.stock_info.zhenfu+"%"),1)]),Ot("div",_g,[Ug,Ot("span",null,He(Ke(pe).state.market.stock_info.huanshou+"%"),1)]),Ot("div",Kg,[Jg,Ot("span",null,He(Oe(Ke(pe).state.market.stock_info.jiaoliang)+"手"),1)]),Ot("div",zg,[Zg,Ot("span",null,He(Ce(Ke(pe).state.market.stock_info.jiaoe)),1)]),Ot("div",Qg,[$g,Ot("span",null,He(Ke(pe).state.market.stock_info.yinlv+"%"),1)]),Ot("div",qg,[jg,Ot("span",null,He(Ke(pe).state.market.stock_info.jinglv+"%"),1)])]),Ot("div",tp,[Ot("div",{onClick:na},[Ke(pe).state.watchlist.status?(Wr(),An("img",ep)):(Wr(),An("img",ap)),ip]),Ot("div",{class:"trading-btn",onClick:Mt[2]||(Mt[2]=Pt=>Fa("/Trading",u.value,l.value,I.value))},"交易")])]))}},Ep=lv(rp,[["__scopeId","data-v-5836b379"]]);export{Ep as default};
